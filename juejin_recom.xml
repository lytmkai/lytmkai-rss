<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[我和TRAE的这一年]]></title>    <link>https://juejin.cn/post/7598403436699582498</link>    <guid>https://juejin.cn/post/7598403436699582498</guid>    <pubDate>2026-01-24T02:38:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598403436699582498" data-draft-id="7598450302615715886" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我和TRAE的这一年"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-24T02:38:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="纱雾13"/> <meta itemprop="url" content="https://juejin.cn/user/3419926705742091"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我和TRAE的这一年
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3419926705742091/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    纱雾13
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T02:38:45.000Z" title="Sat Jan 24 2026 02:38:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">我和TRAE的这一年</h2>
<p>也是和Trae走过一年了！也使用了Trae做出了大大小小的项目，也学会了很多技术栈，也使用Trae参加了一些比赛都获得不错的佳绩了，来看看我和Trae的2025吧</p>
<p><strong>相遇</strong></p>
<p>相遇即在printf("MarsCode"),我还记得那是2024年6月份,我在教室看草坪发布会,我还记得<strong>海建</strong>和<strong>旭东</strong>老师在草坪上演示Marscode的能力,那个时候就深深的爱上了这个插件,在日常的学习还有一些项目的生成都是很不错的!那个时候只能使用ChatGPT豆包这类的生成后代码然后CV,出错再来一遍,现在不需要了!真的很惊艳~然后就到2025年的假期的时候还有超多由杜昔月老师的共学课程,在直播间和她的小助理一起使用Marscode生成一些代码,那个时候就认定了,觉得这个社区很不错,能学到好多开发的技术!也获得了很多周边!
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/575637b9768b4e289c330be82ce4b431~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=TPu5S8scp%2FWQGPH7kdqwhyghY5w%3D" alt="img_v3_02tf_594afca5-d3aa-4606-a881-ff2367ee2d0g.jpg" loading="lazy"/></p>
<p><strong>Trae 社区活动真的好多!</strong></p>
<p>8月份进入到了飞书的社群,这里活动更加丰富了,且社群比之前大了好多!有好多大佬进入到这个群里,在这里真的学到了特别多!
也是在这个时候,觉得是我学生时代写的代码和开发项目的巅峰了,在这里参加了各种种类的活动
例如发表到Trae公众号的借用大模型的能力去进行规范事务的一个项目
<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3W2wmNS8NpzReUn5ifSsMQ" target="_blank" title="https://mp.weixin.qq.com/s/3W2wmNS8NpzReUn5ifSsMQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/3W2wmNS8N…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8409f118b20341248a6b100d624deb98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=rnE2So5Q89o4p5MqcqHzCh6SFyw%3D" alt="img_v3_02tf_4ec1b381-bb29-4387-b0cb-9b6f9a14689g.jpg" loading="lazy"/>
<img src="" alt="" loading="lazy"/></p>
<p>当然还有在1024程序员节的时候,演示过的项目等等等等超多
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70c4d4f4ba384336b74988d6a84ca439~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=MPvIyJ%2BhkFwsIvTLsYSvbCoU6fY%3D" alt="img_v3_02tf_f4ce8d62-bd58-4b9a-8c7c-13962f1ab33g.png" loading="lazy"/></p>
<p>当然因为我还是一个学生,使用Trae参加了一些互联网开发的比赛均获得了省里不错的成绩!</p>
<p><strong>Trae的线下活动!</strong></p>
<p>不得不说,我的第一次线下参加关于编程类的活动就是Trae,真的参加第一次,就想参加第二次,学到了很多有干料的开发技巧!</p>
<p>第一次参加的Trae的活动!(luna莫怪我拍的不好看)
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7aa63c6df9724399a9ffac8cf3bc4423~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=qOFQa9WtFCrk7jLLWT2A2qKB8Ko%3D" alt="img_v3_02tf_c9ace577-1c7f-4c3e-a45d-a2189d0b3ceg.png" loading="lazy"/>
第一次参加Hackathon,就获得了一等奖!且我的同学们也都获取了佳绩!真的很不错的线下体验!
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c196da2aa6104a93831761340497faf6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=sMuNUoHGQTgZoRkbfgZUK9KjLvE%3D" alt="img_v3_02tf_0add46fe-f608-4a5f-a12e-e968fc864b6g.jpg" loading="lazy"/>
<strong>Trae周边!</strong></p>
<p>当然这一年也获得了超多的周边!(不完全统计)
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da676d6bb54d4a40978b2d58248bb05e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=BrsX4s7vdvza83M0j6Uh9OyIvJQ%3D" alt="img_v3_02tf_fee564d7-7fa0-4a5c-93ae-06f3b743207g.jpg" loading="lazy"/></p>
<p><strong>使用 Trae 开源自己的 skill</strong></p>
<p>最佳 skill 概念特别好，也是使用 Trae 去做出自己的一套 skill文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwcn1msagbpwc.feishu.cn%2Fwiki%2FP7VPw22RfinnVHk2FeXcvtFfn7b%3Ffrom%3Dfrom_copylink" target="_blank" title="https://wcn1msagbpwc.feishu.cn/wiki/P7VPw22RfinnVHk2FeXcvtFfn7b?from=from_copylink" ref="nofollow noopener noreferrer">Trae Skills 开发技巧</a>
自己检索了现在比较流行的 anthropics/skills、vercel-labs/agent-skills 及ComposioHQ/awesome-claude-skills 这3 个库的精华，自己整合构建出这个skills 库
省流示例如下：</p>
<p>一句话开发，就有专门的 skill 去自动分配任务</p>
<pre><code class="hljs">我想开发一个 简单的 todolist 项目，请带我走一遍全流程。
</code></pre>
<p>就会自动的去划分任务出来，配合 Trae 的 todolist 实现高效开发
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5aeea57884fa46979bffba972d64688d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=9eJkN%2BUuHsVL9ZoqqajJwf0Kom0%3D" alt="img_v3_02u6_21f61828-5395-470a-92d4-a8720f61749g.jpg" loading="lazy"/></p>
<p><strong>最后!</strong></p>
<p>那最后呢,希望Trae越来越好,在2026实现更多跨时代的一些功能,惊艳的功能,让 <strong>The Real AI Engineer</strong> 更加伟大!‌</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026：拒绝 AI 焦虑，我手写了一个 ReAct 智能体]]></title>    <link>https://juejin.cn/post/7598947628468125742</link>    <guid>https://juejin.cn/post/7598947628468125742</guid>    <pubDate>2026-01-25T16:00:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598947628468125742" data-draft-id="7598881914204258354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026：拒绝 AI 焦虑，我手写了一个 ReAct 智能体"/> <meta itemprop="keywords" content="前端,Agent,AIGC"/> <meta itemprop="datePublished" content="2026-01-25T16:00:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="辰枫"/> <meta itemprop="url" content="https://juejin.cn/user/2946346892407735"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026：拒绝 AI 焦虑，我手写了一个 ReAct 智能体
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2946346892407735/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    辰枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T16:00:43.000Z" title="Sun Jan 25 2026 16:00:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>2025年史称“Agent”元年，自从 ChatGPT 的爆火，自己也一直使用的是 Chat 类的 AI工具。其它类型的工具只是推特上看到，但是自己很少使用。有时在自己推特的 timline上会出现很多爆火的AI工具，刷多了会对于自己产生一些焦虑，但仅仅是产生（毕竟人在自己的舒适区，是很难自己走出来的）。加上最近的招聘市场和公司都很注重 Agent 这块，所以决定花时间好好研究下 Agent。为未来做准备，同时也会包装自己。</p>
<p>整体的学习大纲，用最近听到一句话来说“<strong>体系完整先于逻辑自洽和观点正误</strong>”，先学习整体的 Agent 的整体框架再慢慢研究。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae9e11edd0e94dc6ab9e9c5bc22d3e1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L6w5p6r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769961643&amp;x-signature=Qm9qAEnllqVh%2Bvmxa3tsltT10k0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">什么是AI Agent</h2>
<blockquote>
<p><em>“AI agents are software systems that use AI to pursue goals and complete tasks on behalf of users. They show reasoning, planning, and memory and have a level of autonomy to make decisions, learn, and adapt.”</em> <em>— Google Cloud</em></p>
<p>AI 智能体是使用 AI来实现目标和代表用户完成任务的软件系统，其表现中推理、规划和记忆能力。并且有一定的自主性，能够自主学习、适应和做出决定</p>
</blockquote>
<p>这里引用<a href="https://link.juejin.cn?target=https%3A%2F%2Fbaoyu.io%2Fblog%2Fai-agent-frontend-rebirth-from-failure" target="_blank" title="https://baoyu.io/blog/ai-agent-frontend-rebirth-from-failure" ref="nofollow noopener noreferrer">宝王老师</a>对于 AI Agent 的定义：</p>
<p>AI Agent 是为了实现一个目标，循环调用工具的大语言模型。</p>
<ul>
<li>工具循环（Tools）：模型调用工具 -&gt; 获取结果 -&gt; 继续推理</li>
<li>有明确终点：为达成目标，而不是无限调用</li>
<li>目标来源灵活：可以来自用户，也可以来自另一个 LLM</li>
<li>基础记忆能力：通过对话历史保存上下文信息</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68f21815462a4cd6b623d30cca302c1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L6w5p6r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769961643&amp;x-signature=fVJpQmQSLJJ64JEmpAeWo%2FdQaB4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">AI Agent （AI 智能体）经典范式</h2>
<h3 data-id="heading-3">ReAct范式</h3>
<p>在 ReAct 范式出现之前，主流的方法可以分为两类：</p>
<ul>
<li>“纯思考”：如<strong>思维链（Chain-of-Thought）</strong> ,引导模型进行复杂的逻辑推理，但无法与外界进行交互，容易生成幻觉</li>
<li>“纯行动”：模型直接输出执行的动作，缺乏规划和纠错能力</li>
</ul>
<h4 data-id="heading-4"><strong>什么是 ReAct 范式</strong></h4>
<p>从字面上看ReAct 单词读和<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2F" target="_blank" title="https://react.dev/" ref="nofollow noopener noreferrer">前端框架 React</a>一样发音，只是把 A进行了大写，但是是完全不同的东西。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2210.03629" target="_blank" title="https://arxiv.org/abs/2210.03629" ref="nofollow noopener noreferrer">ReAct (Reason 和 Act)</a>最早是由<a href="https://link.juejin.cn?target=https%3A%2F%2Fysymyth.github.io%2F" target="_blank" title="https://ysymyth.github.io/" ref="nofollow noopener noreferrer">姚顺雨</a>于 2022 年提出，其核心思想是模仿人类解决问题的方式，将<strong>思考(Reasoning)与行动(Acting)结合</strong>起来。形成一个“思考 -&gt; 行动-&gt;观察”的循环。ReAct 的精妙之处在于，它认识到<strong>思考与行动是相辅相成的</strong>，思考指导行动，而行动的结果又会反过来为思考提供依据。在执行上的是通过一种特殊的Prompt 来引导 LLM，使其每一步都遵循一个固定的轨迹。</p>
<ol>
<li><strong>Thought (思考)</strong> ：在执行任务前，先进行分析当前任务情况、分析任务、规划下一步，或者反思上一步的结果</li>
<li><strong>Action (行动)</strong> ：根据上一步的思考结果决定采用的具体行动，通常会调用外部的 Tools</li>
<li><strong>Observation (观察)</strong> ：这是执行 Action 后从 Tools 返回的结果</li>
</ol>
<p>在这个范式中，Agent会不断的 Loop这个流程，将新的观察结果追加到历史的记录中，形成一个不断增长的上下文，直到 Thought 中判断已经找到正确的答案，然后输出结果。整个过程中<strong>思考使任务更具有目标性，而行动又为下一次的思考提供了事实依据</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0add9da7a86342159d070efcb9e45ead~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L6w5p6r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769961643&amp;x-signature=FSZZisLXpeIhHHWRQYSa5f%2FwaaM%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">ReAct适用场景</h4>
<ul>
<li><strong>需要外部知识的任务</strong>：查询实时信息</li>
<li><strong>需要精确计算的任务</strong>：数据计算问题</li>
<li><strong>需要与 API交互的任务</strong>：如操作数据库、调用某个 API 完成任务</li>
</ul>
<h4 data-id="heading-6">什么是工具（Tools）</h4>
<p>上面介绍了 ReAct 整体的范式，提到了一个概念 Tools，那么什么是 Tools 呢？</p>
<p>我们都知道 LLM是一个用固定数据训练出来的模型，有自主思考的能力相当于大脑，但是只有大脑还不够还要有“手和脚”与真实的外部世界交互。这些手和脚就是 Tools</p>
<h4 data-id="heading-7">ReAct智能体实战</h4>
<p>了解完了 ReAct 整体的概念，下面我们通过一个具体的需求来实际体验下。</p>
<p>需求：<strong>你需要编写一个智能体，用于<strong><strong>分析</strong></strong>用户的需求，回答用户的问题</strong>。</p>
<p>例如：小米手机的最新手机是哪一款？</p>
<h5 data-id="heading-8">需求分析</h5>
<p>想要解决这个问题，我们需为Agent 提供一个网页搜索的工具。让 LLM 调用去实时搜索信息，然后基于搜索的结果让 LLM再判断是不是正确的结果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66812aaa54fe48c794a708c8d4050060~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L6w5p6r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769961643&amp;x-signature=HkoVvEGls1VThbMzBfyCxMQzwdE%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-9">编码实现</h5>
<h6 data-id="heading-10">系统提示词（Prompt）</h6>
<p>基于 ReAct 整体的机制，我们需要设置一个提示词。主要包含以下点：</p>
<ol>
<li>定义LLM 的角色或使用场景</li>
<li>定义 LLM可使用的工具</li>
<li>定义 LLM响应的格式，从而方便的让程序处理</li>
<li>定义用户的问题和整个思考的过程即动态上下文</li>
</ol>
<p>根据以上几点，我们设计的系统提示词如下：</p>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REACT_PROMPT_TEMPLATE</span> = <span class="hljs-string">`
请注意， 你是一个有能力调用外部工具的智能助手

可用工具如下：
{tools}

请严格按以下格式回应：

Thought: 你的思考过程，用于分析问题、拆解任务和规划下一步行动
Action: 你采取的行动必须是以下格式之一：
- `</span>{{tool_name}}[{{tool_input}}]<span class="hljs-string">`:调用一个可用工具
- `</span><span class="hljs-title class_">Finish</span>[最终答案]<span class="hljs-string">`: 当你认为已经获取最终答案时

现在请开始解决以下问题：
Question: {question}
History: {history}
`</span>;
</code></pre>
<h6 data-id="heading-11"><strong>工具（Tools）</strong></h6>
<p>按提示词的设计，这里我们先编写给LLM调用的工具函数，选用<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fserpapi%2Fserpapi-javascript" target="_blank" title="https://github.com/serpapi/serpapi-javascript" ref="nofollow noopener noreferrer"> SerpApi</a>，根据官方提供的 SDK 封装一个函数（使用前需要去<a href="https://link.juejin.cn?target=https%3A%2F%2Fserpapi.com%2F" target="_blank" title="https://serpapi.com/" ref="nofollow noopener noreferrer">官网</a>注册一个账号获取免费的额度）。</p>
<blockquote>
<p>SearchApi 是一个强大的实时SERP API，可提供来自Google 搜索、Google 招聘、YouTube、Google 新闻等搜索引擎集合的结构化数据</p>
</blockquote>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">import</span> { getJson } <span class="hljs-keyword">from</span> <span class="hljs-string">'serpapi'</span>;
<span class="hljs-keyword">import</span> { requireEnv } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;

<span class="hljs-comment">/**
 * 基于 SerApi实现的网页搜索工具
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">query</span>
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">query: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> apiKey = requireEnv(<span class="hljs-string">'SERPAPI_API_KEY'</span>);
    <span class="hljs-keyword">if</span> (!apiKey) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'错误：SERPAPI_API_KEY没有定义在.env 文件中'</span>;
    }
    
    <span class="hljs-keyword">const</span> params = {
      <span class="hljs-attr">engine</span>: <span class="hljs-string">'google'</span>,
      <span class="hljs-attr">q</span>: query,
      <span class="hljs-attr">api_key</span>: apiKey,
      <span class="hljs-attr">gl</span>: <span class="hljs-string">'cn'</span>,
      <span class="hljs-attr">hl</span>: <span class="hljs-string">'zh-cn'</span>,
    };

    <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getJson</span>(params);

    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(results.<span class="hljs-property">answer_box_list</span>)) {
      <span class="hljs-keyword">return</span> results.<span class="hljs-property">answer_box_list</span>.<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>);
    }

    <span class="hljs-keyword">if</span> (results.<span class="hljs-property">answer_box</span> &amp;&amp; results.<span class="hljs-property">answer_box</span>.<span class="hljs-property">answer</span>) {
      <span class="hljs-keyword">return</span> results.<span class="hljs-property">answer_box</span>.<span class="hljs-property">answer</span>;
    }

    <span class="hljs-keyword">if</span> (
      results.<span class="hljs-property">knowledge_graph</span> &amp;&amp;
      results.<span class="hljs-property">knowledge_graph</span>.<span class="hljs-property">description</span>
    ) {
      <span class="hljs-keyword">return</span> results.<span class="hljs-property">knowledge_graph</span>.<span class="hljs-property">description</span>;
    }

    <span class="hljs-keyword">if</span> (
      <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(results.<span class="hljs-property">organic_results</span>) &amp;&amp;
      results.<span class="hljs-property">organic_results</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>
    ) {
      <span class="hljs-comment">// 如果没有直接答案，则返回前三个有机结果的摘要</span>
      <span class="hljs-keyword">const</span> snippets = results.<span class="hljs-property">organic_results</span>
        .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)
        .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">res: <span class="hljs-built_in">any</span>, i: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">`[<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>] <span class="hljs-subst">${res.title || <span class="hljs-string">''</span>}</span>\n<span class="hljs-subst">${res.snippet || <span class="hljs-string">''</span>}</span>`</span>;
        });
      <span class="hljs-keyword">return</span> snippets.<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n\n'</span>);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-string">`对不起，没有找到关于 '<span class="hljs-subst">${query}</span>' 的信息。`</span>;
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`发生错误: <span class="hljs-subst">${error}</span>`</span>;
  }
}
</code></pre>
<p>为了后续我们方便的添加新的 Tools 我们需要构造一个通用的工具构造器</p>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Tools</span> = {
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">func</span>: <span class="hljs-title class_">Function</span>;
};

<span class="hljs-comment">/**
 * 工具执行器，负责管理和执行工具
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ToolsExecutor</span> {
  <span class="hljs-attr">tools</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Tools</span>&gt;;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tools</span> = {};
  }

  <span class="hljs-title function_">registerTool</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, desc: <span class="hljs-built_in">string</span>, func: <span class="hljs-built_in">Function</span></span>) {
    <span class="hljs-keyword">if</span> (name <span class="hljs-keyword">in</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tools</span>)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'同名工具已存在，将进行覆盖'</span>);
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tools</span>[name] = { <span class="hljs-attr">description</span>: desc, <span class="hljs-attr">func</span>: func };
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`工具 <span class="hljs-subst">${name}</span> 已注册 \n`</span>);
  }

  <span class="hljs-title function_">getTool</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {    
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tools</span>).<span class="hljs-title function_">includes</span>(name)) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tools</span>[name]?.<span class="hljs-property">func</span>;
    }
  }

  <span class="hljs-title function_">getAvailableTools</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> allTools = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [name, info] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tools</span>)) {
      allTools.<span class="hljs-title function_">push</span>(<span class="hljs-string">`- <span class="hljs-subst">${name}</span>: <span class="hljs-subst">${info?.description}</span>`</span>);
    }

    <span class="hljs-keyword">return</span> allTools.<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>);
  }
}
</code></pre>
<p>接下来我们测试这些函数</p>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">import</span> { search } <span class="hljs-keyword">from</span> <span class="hljs-string">"./tools"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">'dotenv'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  dotenv.<span class="hljs-title function_">config</span>();
  <span class="hljs-keyword">const</span> executor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToolsExecutor</span>();
  executor.<span class="hljs-title function_">registerTool</span>(
    <span class="hljs-string">'Search'</span>,
    <span class="hljs-string">'基于 SerApi实现的网页搜索工具'</span>,
    search
  );

  <span class="hljs-keyword">const</span> toolFunc = executor.<span class="hljs-title function_">getTool</span>(<span class="hljs-string">'Search'</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'可用工具列表:'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(executor.<span class="hljs-title function_">getAvailableTools</span>());

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n 执行 Search 工具:`</span>);
  <span class="hljs-keyword">if</span> (toolFunc) {
    <span class="hljs-title function_">toolFunc</span>(<span class="hljs-string">'人工智能的未来是什么？'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'搜索结果:'</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);
    });
  }
}
<span class="hljs-title function_">main</span>();

&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 执行结果如下：
工具 <span class="hljs-title class_">Search</span> 已注册 

可用工具列表:
- <span class="hljs-title class_">Search</span>: 基于 <span class="hljs-title class_">SerApi</span>实现的网页搜索工具

 执行 <span class="hljs-title class_">Search</span> 工具:
搜索结果:
[<span class="hljs-number">1</span>] 人工智能的未来
<span class="hljs-variable constant_">AI</span> 未来的定义将是转向用于实验的开源大规模模型，以及开发更小、更高效的<span class="hljs-variable constant_">AI</span> 模型，以提高易用性并降低成本。

[<span class="hljs-number">2</span>] <span class="hljs-number">2025</span>,人工智能走向何方？我们如何拥抱变化？
“当前，新一代人工智能等数字技术正在爆发式发展，将进一步推动制造业的效率变革，未来有望带动工厂的研发、生产、组织和服务全方面的革新。”中国信息通信研 ...

[<span class="hljs-number">3</span>] 中国人工智能的未来之路
在人口老龄化的大背景下，人工智能对推动中国未来的经济增长将起到至关重要的作用。中国的劳动年龄人口最早将在<span class="hljs-number">2024</span>年达到峰值，并在之后的<span class="hljs-number">50</span>年中减少五分之一。麦肯锡全球 ...
</code></pre>
<h6 data-id="heading-12">实现Agent</h6>
<p>首先，我们要对接大模型厂商提供的服务，OpenAI的接口规范，已经成为 LLM 行业的接口标准。国内的厂商基本都兼容了此标准</p>
<p>免费的厂商服务？现在基本国内的大模型厂商在注册账号之后基本都会提供一定的免费额度，我这里使用的火山引擎下的火山方舟的服务。</p>
<p>先安装<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenai%2Fopenai-node" target="_blank" title="https://github.com/openai/openai-node" ref="nofollow noopener noreferrer">open ai sdk</a> <code>npm install openai</code>，然后我们基于这个 SDK 封装一个通用的llm 对接类，方便后续复用</p>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'openai'</span>;
<span class="hljs-keyword">import</span> { requireEnv } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-keyword">type</span> <span class="hljs-title class_">ChatCompletionMessageParam</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'openai/resources'</span>;

<span class="hljs-comment">/**
 *  Hello Agents 定制的 LLM 客户端
 *  它用于调用任何兼容 OpenAI 接口的服务，并默认使用流式响应
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloAgentsLLM</span> {
  <span class="hljs-attr">model</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">apiKey</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">baseUrl</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">timeout</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">client</span>: <span class="hljs-title class_">OpenAI</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    model?: <span class="hljs-built_in">string</span>,
    apiKey?: <span class="hljs-built_in">string</span>,
    baseUrl?: <span class="hljs-built_in">string</span>,
    timeout: <span class="hljs-built_in">number</span> = <span class="hljs-number">60</span>,
  </span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> = model || requireEnv(<span class="hljs-string">'LLM_MODEL_ID'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">apiKey</span> = apiKey || requireEnv(<span class="hljs-string">'LLM_API_KEY'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseUrl</span> = baseUrl || requireEnv(<span class="hljs-string">'LLM_BASE_URL'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">timeout</span> = requireEnv(<span class="hljs-string">'LLM_TIMEOUT'</span>)
      ? <span class="hljs-title class_">Number</span>(requireEnv(<span class="hljs-string">'LLM_TIMEOUT'</span>))
      : timeout;

    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">baseUrl</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">apiKey</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
        <span class="hljs-string">'模型 ID、API 密钥和服务地址必须被提供或在.env 文件中定义'</span>,
      );
    }

    <span class="hljs-comment">// console.log(this.baseUrl)</span>

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
      <span class="hljs-attr">baseURL</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseUrl</span>,    
      <span class="hljs-attr">apiKey</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">apiKey</span>,
      <span class="hljs-comment">// timeout: this.timeout Error: Request timed out.</span>
    });
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">think</span>(<span class="hljs-params">messages: <span class="hljs-built_in">Array</span>&lt;ChatCompletionMessageParam&gt;, temperature = <span class="hljs-number">0</span></span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'开始调用大模型'</span>);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span>.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
        <span class="hljs-attr">model</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span>,
        <span class="hljs-attr">messages</span>: messages,
        <span class="hljs-attr">temperature</span>: temperature,
        <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span>,
      });

      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'调用大模型成功 \n'</span>);

      <span class="hljs-keyword">const</span> collectedContent = [];
      <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> response) {
        <span class="hljs-comment">// 处理每个 chunk        </span>
        <span class="hljs-keyword">const</span> c = chunk.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">delta</span>.<span class="hljs-property">content</span> || <span class="hljs-string">""</span>;
        collectedContent.<span class="hljs-title function_">push</span>(c);
      }
      <span class="hljs-keyword">return</span> collectedContent.<span class="hljs-title function_">join</span>(<span class="hljs-string">""</span>)
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`调用 LLM API时发生错误: <span class="hljs-subst">${e}</span>`</span>)
        <span class="hljs-keyword">return</span>
    }
  }
}
</code></pre>
<p>接下，我们按 ReAct 范式的规范，实现 ReActAgent。</p>
<ol>
<li>在整个 Agent中我们需要初始化：llm客户端、可调用的工具、整个交互的历史信息</li>
</ol>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReActAgent</span> {
  <span class="hljs-attr">llmClient</span>: <span class="hljs-title class_">HelloAgentsLLM</span>;
  <span class="hljs-attr">toolsExecutor</span>: <span class="hljs-title class_">ToolsExecutor</span>;
  <span class="hljs-attr">maxStep</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">history</span>: <span class="hljs-built_in">string</span>[];

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    llmClient: HelloAgentsLLM,
    toolsExecutor: ToolsExecutor,
    maxStep = <span class="hljs-number">5</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">llmClient</span> = llmClient;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">toolsExecutor</span> = toolsExecutor;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxStep</span> = maxStep;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span> = [];
      }
  }
</code></pre>
<ol start="2">
<li>接下来我们来实现核心的 run 方法：</li>
</ol>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">async</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">question: <span class="hljs-built_in">string</span></span>) {
   <span class="hljs-comment">// 1. 重置整体流程</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span> = [];
    <span class="hljs-keyword">let</span> currentStep = <span class="hljs-number">0</span>;

    <span class="hljs-comment">// 2. 循环调用LLM</span>
    <span class="hljs-keyword">while</span> (currentStep &lt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxStep</span>) {
      currentStep += <span class="hljs-number">1</span>;

      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`--- 执行第 <span class="hljs-subst">${currentStep}</span> 步 ---`</span>);

      <span class="hljs-comment">// 2.1 根据提示词的模版，传入参数。获取完整版本提示词 </span>
      <span class="hljs-keyword">const</span> toolsDesc = <span class="hljs-variable language_">this</span>.<span class="hljs-property">toolsExecutor</span>.<span class="hljs-title function_">getAvailableTools</span>();
      <span class="hljs-comment">// 历史上下文拼接</span>
      <span class="hljs-keyword">let</span> historyStr = <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>);

      <span class="hljs-keyword">const</span> prompt = <span class="hljs-title function_">formatPrompt</span>(<span class="hljs-variable constant_">REACT_PROMPT_TEMPLATE</span>, {
        <span class="hljs-attr">tools</span>: toolsDesc,
        <span class="hljs-attr">question</span>: question,
        <span class="hljs-attr">history</span>: historyStr,
      });

      <span class="hljs-keyword">let</span> <span class="hljs-attr">messages</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">ChatCompletionMessageParam</span>&gt; = [
        {
          <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>,
          <span class="hljs-attr">content</span>: prompt,
        },
      ];
        
      <span class="hljs-comment">// 2.2 请求 LLM,获取响应</span>
      <span class="hljs-keyword">const</span> responseTxt = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">llmClient</span>.<span class="hljs-title function_">think</span>(messages);

      <span class="hljs-keyword">if</span> (!responseTxt) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`错误：大模型返回异常`</span>);
        <span class="hljs-keyword">break</span>;
      }
 }
</code></pre>
<p>之前我们要求 LLM 在返回时必须带有以下格式：</p>
<pre><code class="hljs language-TS" lang="TS">请严格按以下格式回应：

<span class="hljs-title class_">Thought</span>: 你的思考过程，用于分析问题、拆解任务和规划下一步行动
<span class="hljs-title class_">Action</span>: 你采取的行动必须是以下格式之一：
- <span class="hljs-string">`{{tool_name}}[{{tool_input}}]`</span>:调用一个可用工具
- <span class="hljs-string">`Finish[最终答案]`</span>: 当你认为已经获取最终答案时
</code></pre>
<p>接下来，我们只要使用正则表达式，来提取 LLM 的响应即可：</p>
<pre><code class="hljs language-typescript" lang="typescript">    <span class="hljs-comment">/**
     * 解析 LLM 输出，提取 Thought 和 Action
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">_parseOutput</span>(<span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>): { <span class="hljs-attr">thought</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>; <span class="hljs-attr">action</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> } {
        <span class="hljs-keyword">const</span> thoughtMatch = text.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/Thought: (.*)/</span>);
        <span class="hljs-keyword">const</span> actionMatch = text.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/Action: (.*)/</span>);
        <span class="hljs-keyword">const</span> thought = thoughtMatch?.[<span class="hljs-number">1</span>]?.<span class="hljs-title function_">trim</span>() ?? <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">const</span> action = actionMatch?.[<span class="hljs-number">1</span>]?.<span class="hljs-title function_">trim</span>() ?? <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">return</span> { thought, action };
    }
  <span class="hljs-comment">/**
   * 解析 Action 字符串，提取工具名称和输入
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">_parseAction</span>(<span class="hljs-attr">actionText</span>: <span class="hljs-built_in">string</span>): [<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>, <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>] {
    <span class="hljs-keyword">const</span> match = actionText.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/(\w+)[(.*)]/</span>);
    <span class="hljs-keyword">if</span> (match) {
      <span class="hljs-keyword">return</span> [match[<span class="hljs-number">1</span>] ?? <span class="hljs-literal">null</span>, match[<span class="hljs-number">2</span>] ?? <span class="hljs-literal">null</span>];
    }
    <span class="hljs-keyword">return</span> [<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>];
  }

  <span class="hljs-comment">/**
   * 解析 Action 输入，提取参数
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">_parseActionInput</span>(<span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> {
    <span class="hljs-keyword">const</span> inputMatch = text.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\w+[(.*)]/</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(inputMatch)
    <span class="hljs-keyword">return</span> inputMatch &amp;&amp; <span class="hljs-keyword">typeof</span> inputMatch[<span class="hljs-number">1</span>] === <span class="hljs-string">'string'</span> ? inputMatch[<span class="hljs-number">1</span>] : <span class="hljs-literal">null</span>;
  }
</code></pre>
<ul>
<li><code>_parseOutput</code>：负责从 LLM返回的消息中提取 Thought 和 Action 两个最主要的部分</li>
<li><code>_parseAction</code>：负责Action 字符串中，提取工具名和参数，例如：Search[Oppo]，工具名：Search，参数：Oppo</li>
</ul>
<p>解析响应结果并执行工具函数</p>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">const</span> {thought, action} = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_parseOutput</span>(responseTxt);
<span class="hljs-keyword">if</span>(thought) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`思考：<span class="hljs-subst">${thought}</span> \n`</span>)
  }

  <span class="hljs-keyword">if</span>(!action) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'没有下一步Action, 流程终止'</span>)
    <span class="hljs-keyword">break</span>;
  }
  
  <span class="hljs-keyword">if</span>(action.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'`Finish'</span>)) {
    <span class="hljs-keyword">const</span> finalAnswer = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_parseActionInput</span>(action)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`最终答案：<span class="hljs-subst">${finalAnswer}</span> \n`</span>)
    <span class="hljs-keyword">return</span> finalAnswer;
  }

  <span class="hljs-keyword">const</span> [toolName, toolInput] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_parseAction</span>(action);
  <span class="hljs-keyword">if</span>(!toolInput || !toolName) {
    <span class="hljs-keyword">continue</span>;
  }

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`行动: <span class="hljs-subst">${toolName}</span> <span class="hljs-subst">${toolInput}</span>\n`</span>)

  <span class="hljs-keyword">const</span> toolFun = <span class="hljs-variable language_">this</span>.<span class="hljs-property">toolsExecutor</span>.<span class="hljs-title function_">getTool</span>(toolName)
  <span class="hljs-keyword">let</span> observation = <span class="hljs-string">`错误： 未找到名为 '<span class="hljs-subst">${toolName}</span>' 的工具`</span>
  <span class="hljs-keyword">if</span>(toolFun) {
    <span class="hljs-comment">// 使用 call 来实现工具函数的执行</span>
    observation = <span class="hljs-keyword">await</span> toolFun.<span class="hljs-title function_">call</span>(<span class="hljs-literal">null</span>, toolInput)
  }
</code></pre>
<p>这段代码就是，解析 LLM响应的结果，如果以 <code>Finish</code> 开始就代表 LLM已经给出了最终的结果，如果不是则需要提取<code>Action</code>，并执行 <code>Action</code>获取响应结果。</p>
<p>最后把本次调用响应的结果（<code>observation</code>），放入到 history 中，供下次 LLM 思考参考</p>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`观察 <span class="hljs-subst">${observation}</span> \n\n`</span>)
<span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">`Action: <span class="hljs-subst">${action}</span>`</span>)
<span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">`Observation: <span class="hljs-subst">${observation}</span>`</span>)
</code></pre>
<p>当然，在 while 循环中设置的有 max_step。程序并不会无限循环，达到一定次数自动停止。</p>
<p>下面是运行 console 结果：</p>
<pre><code class="hljs language-TS" lang="TS">工具 <span class="hljs-title class_">Search</span> 已注册 

--- 执行第 <span class="hljs-number">1</span> 步 ---
开始调用大模型
调用大模型成功 

<span class="hljs-title class_">Thought</span>: 为了回答这个问题，我需要查找小米最新发布的手机型号及其主要卖点。由于小米会定期发布新手机，我需要通过搜索工具获取最新的信息。

<span class="hljs-title class_">Action</span>: <span class="hljs-string">`Search[小米最新手机型号和卖点]`</span>
思考：为了回答这个问题，我需要查找小米最新发布的手机型号及其主要卖点。由于小米会定期发布新手机，我需要通过搜索工具获取最新的信息。 

行动: <span class="hljs-title class_">Search</span> 小米最新手机型号和卖点

观察 [<span class="hljs-number">1</span>] 小米全系列选购指南：<span class="hljs-number">2026</span>年爆款机型+各系列核心卖点_手机
小米数字系列定位<span class="hljs-number">3999</span>元以上高端市场，是追求旗舰性能与均衡体验用户的首选。小米<span class="hljs-number">17</span>搭载骁龙<span class="hljs-number">8</span> <span class="hljs-title class_">Gen5</span>处理器，配备2K <span class="hljs-variable constant_">LTPO</span>直屏与5300mAh电池，支持90W快充，机身 ...

[<span class="hljs-number">2</span>] 手机 - 小米商城
<span class="hljs-title class_">Redmi</span> 14C. <span class="hljs-number">599</span>起. <span class="hljs-variable constant_">CPU</span>型号<span class="hljs-title class_">MediaTek</span> <span class="hljs-title class_">Helio</span> <span class="hljs-variable constant_">G81</span>-<span class="hljs-title class_">Ultra</span> ; <span class="hljs-title class_">Redmi</span> <span class="hljs-title class_">Note</span> <span class="hljs-number">14</span> <span class="hljs-title class_">Pro</span>. <span class="hljs-number">1149</span>起 · <span class="hljs-variable constant_">CPU</span>型号天玑<span class="hljs-number">7300</span>-<span class="hljs-title class_">Ultra</span> ; <span class="hljs-title class_">Xiaomi</span> <span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版. <span class="hljs-number">7999</span>起 · <span class="hljs-variable constant_">CPU</span>型号第五代骁龙<span class="hljs-number">8</span>至尊版 ...

[<span class="hljs-number">3</span>] 小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span>的最强卖点，却成了用户退货的理由
小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span>徕卡版因变焦环松动问题引发用户不满，官方回应称是设计预留活动空间所致，但未能消除质疑。该问题涉及产品设计、制造公差和用户体验。 


--- 执行第 <span class="hljs-number">2</span> 步 ---
开始调用大模型
调用大模型成功 

<span class="hljs-title class_">Thought</span>: 根据搜索结果，小米最新的手机型号是小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版。它的卖点包括搭载第五代骁龙<span class="hljs-number">8</span>至尊版处理器，以及徕卡版的影像系统。不过，搜索结果也提到了一些用户对变焦环松动的反馈。为了更全面地了解这款手机的卖点，我需要进一步搜索小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版的详细规格和官方宣传信息。

<span class="hljs-title class_">Action</span>: <span class="hljs-string">`Search[小米17 Ultra 徕卡版 官方卖点]`</span>
思考：根据搜索结果，小米最新的手机型号是小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版。它的卖点包括搭载第五代骁龙<span class="hljs-number">8</span>至尊版处理器，以及徕卡版的影像系统。不过，搜索结果也提到了一些用户对变焦环松动的反馈。为了更全面地了解这款手机的卖点，我需要进一步搜索小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版的详细规格和官方宣传信息。 

行动: <span class="hljs-title class_">Search</span> 小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版 官方卖点

观察 [<span class="hljs-number">1</span>] <span class="hljs-title class_">Xiaomi</span> <span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版
<span class="hljs-title class_">Xiaomi</span> <span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版，方方面面尽徕卡。徕卡相机感设计，徕卡经典红标，中框精雕横滚花，镌刻徕卡铭文。创新大师变焦环，如相机般精密操控；支持功能自定义，时刻服务你的 ...

[<span class="hljs-number">2</span>] <span class="hljs-title class_">Xiaomi</span> <span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版立即购买-小米商城
<span class="hljs-title class_">Xiaomi</span> <span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版 ; <span class="hljs-number">299</span>元. <span class="hljs-title class_">Xiaomi</span> <span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 保值换新服务 · <span class="hljs-number">299</span>元 ; <span class="hljs-title class_">MiCare</span> 无忧版已省<span class="hljs-number">500</span>元. 加购后碎屏保升级为<span class="hljs-number">2</span>年多次，详见服务介绍 · <span class="hljs-number">499</span>元 ; 延长保<span class="hljs-number">1</span>年<span class="hljs-number">349</span>元. 性能 ...

[<span class="hljs-number">3</span>] 小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span>的最强卖点，却成了用户退货的理由
小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span>徕卡版因变焦环松动问题引发用户不满，官方回应称是设计预留活动空间所致，但未能消除质疑。该问题涉及产品设计、制造公差和用户体验。 


--- 执行第 <span class="hljs-number">3</span> 步 ---
开始调用大模型
调用大模型成功 

<span class="hljs-title class_">Thought</span>: 根据搜索结果，小米最新的手机型号是小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版。它的卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计。虽然变焦环设计引发了一些用户的不满，但官方解释这是设计预留的活动空间。因此，可以确认小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版是小米最新的手机，其卖点主要集中在徕卡合作的高端相机体验和设计上。

<span class="hljs-title class_">Action</span>: <span class="hljs-string">`Finish[小米最新的手机是小米17 Ultra 徕卡版。它的主要卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计，提供如相机般的精密操控体验。]`</span>
思考：根据搜索结果，小米最新的手机型号是小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版。它的卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计。虽然变焦环设计引发了一些用户的不满，但官方解释这是设计预留的活动空间。因此，可以确认小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版是小米最新的手机，其卖点主要集中在徕卡合作的高端相机体验和设计上。 
-- 变量 ---
[
  <span class="hljs-string">'Finish[小米最新的手机是小米17 Ultra 徕卡版。它的主要卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计，提供如相机般的精密操控体验。]'</span>,
  <span class="hljs-string">'小米最新的手机是小米17 Ultra 徕卡版。它的主要卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计，提供如相机般的精密操控体验。'</span>,
  <span class="hljs-attr">index</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">input</span>: <span class="hljs-string">'`Finish[小米最新的手机是小米17 Ultra 徕卡版。它的主要卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计，提供如相机般的精密操控体验。]`'</span>,
  <span class="hljs-attr">groups</span>: <span class="hljs-literal">undefined</span>
]
最终答案：小米最新的手机是小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版。它的主要卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计，提供如相机般的精密操控体验。
</code></pre>
<p>注意</p>
<p>由于大模型能力的不同，不确认我们的搜索结果也一样。我这里使用的是<code>deepseek-v3-250324</code>这个模型执行的结果。</p>
<p>最后，想看全部的代码请在这里查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjavaswing%2Flearn-agent%2Ftree%2Ffeature%2Fts%2Fchap4%2Fts" target="_blank" title="https://github.com/javaswing/learn-agent/tree/feature/ts/chap4/ts" ref="nofollow noopener noreferrer">github.com/javaswing/l…</a></p>
<h2 data-id="heading-13">总结</h2>
<p>本文，通过对于 ReAct 范式的介绍，并结合 HelloAgent一书中的例子进行了实践。对于 Agent的开发有了体感。征途刚刚开始。</p>
<h2 data-id="heading-14">参考</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.google.com%2Fdiscover%2Fwhat-are-ai-agents" target="_blank" title="https://cloud.google.com/discover/what-are-ai-agents" ref="nofollow noopener noreferrer">cloud.google.com/discover/wh…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Faiagent.app%2F" target="_blank" title="https://aiagent.app/" ref="nofollow noopener noreferrer">aiagent.app/</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fbaoyu.io%2Fblog%2Fai-agent-frontend-rebirth-from-failure" target="_blank" title="https://baoyu.io/blog/ai-agent-frontend-rebirth-from-failure" ref="nofollow noopener noreferrer">baoyu.io/blog/ai-age…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdatawhalechina.github.io%2Fhello-agents%2F%23%2F.%2Fchapter4%2F%25E7%25AC%25AC%25E5%259B%259B%25E7%25AB%25A0%2520%25E6%2599%25BA%25E8%2583%25BD%25E4%25BD%2593%25E7%25BB%258F%25E5%2585%25B8%25E8%258C%2583%25E5%25BC%258F%25E6%259E%2584%25E5%25BB%25BA" target="_blank" title="https://datawhalechina.github.io/hello-agents/#/./chapter4/%E7%AC%AC%E5%9B%9B%E7%AB%A0%20%E6%99%BA%E8%83%BD%E4%BD%93%E7%BB%8F%E5%85%B8%E8%8C%83%E5%BC%8F%E6%9E%84%E5%BB%BA" ref="nofollow noopener noreferrer">datawhalechina.github.io/hello-agent…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ibm.com%2Fthink%2Ftopics%2Freact-agent" target="_blank" title="https://www.ibm.com/think/topics/react-agent" ref="nofollow noopener noreferrer">www.ibm.com/think/topic…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact-lm.github.io%2F" target="_blank" title="https://react-lm.github.io/" ref="nofollow noopener noreferrer">react-lm.github.io/</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零开始：手把手教你创建 Vue 3 + TypeScript 项目]]></title>    <link>https://juejin.cn/post/7599094262591946762</link>    <guid>https://juejin.cn/post/7599094262591946762</guid>    <pubDate>2026-01-25T17:35:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599094262591946762" data-draft-id="7599094262591930378" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零开始：手把手教你创建 Vue 3 + TypeScript 项目"/> <meta itemprop="keywords" content="Vue.js,TypeScript"/> <meta itemprop="datePublished" content="2026-01-25T17:35:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鱼予余"/> <meta itemprop="url" content="https://juejin.cn/user/1345457964195192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零开始：手把手教你创建 Vue 3 + TypeScript 项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457964195192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鱼予余
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T17:35:03.000Z" title="Sun Jan 25 2026 17:35:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文将带你一步步创建完整的 Vue 3 项目，包含现代化的开发工具链、代码规范和最佳实践。适合前端开发者学习和参考。</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>Vue 3 带来了 Composition API、更好的 TypeScript 支持和性能优化，是现代前端开发的较广泛的选择。本教程将从环境搭建开始，逐步创建完整的 Vue 3 项目。</p>
<h2 data-id="heading-1">环境准备</h2>
<h3 data-id="heading-2">1. Node.js 环境</h3>
<p>Vue 3 项目需要 Node.js 环境，推荐使用 LTS 版本。</p>
<h4 data-id="heading-3">Windows 系统</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 访问 Node.js 官网下载安装包</span>
<span class="hljs-comment"># https://nodejs.org/</span>

<span class="hljs-comment"># 或使用 nvm-windows 管理多个版本</span>
<span class="hljs-comment"># 1. 下载 nvm-windows: https://github.com/coreybutler/nvm-windows/releases</span>
<span class="hljs-comment"># 2. 安装并重启命令行</span>
nvm install 20.19.0
nvm use 20.19.0
</code></pre>
<h4 data-id="heading-4">macOS 系统</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 Homebrew 安装</span>
brew install node

<span class="hljs-comment"># 或使用 nvm 管理版本</span>
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
<span class="hljs-built_in">source</span> ~/.bashrc
nvm install 20.19.0
nvm use 20.19.0
</code></pre>
<h4 data-id="heading-5">验证安装</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查版本</span>
node --version  <span class="hljs-comment"># 应显示 v20.19.0 或更高</span>
npm --version   <span class="hljs-comment"># 应显示 10.x.x 或更高</span>
</code></pre>
<h3 data-id="heading-6">2. 包管理工具</h3>
<p>推荐使用 npm 或 pnpm，yarn 也可以。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 全局安装 pnpm (可选)</span>
npm install -g pnpm

<span class="hljs-comment"># 检查版本</span>
pnpm --version
</code></pre>
<h3 data-id="heading-7">3. IDE 配置</h3>
<p>推荐使用 VS Code，并安装 Vue 相关插件。</p>
<h4 data-id="heading-8">必需插件</h4>
<ul>
<li><strong>Vue (Official)</strong> - Vue 官方插件，提供语法高亮和智能提示</li>
<li><strong>TypeScript Importer</strong> - 自动导入 TypeScript 类型</li>
<li><strong>Prettier</strong> - 代码格式化</li>
<li><strong>ESLint</strong> - 代码检查</li>
</ul>
<h4 data-id="heading-9">VS Code 设置</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// .vscode/settings.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"typescript.preferences.importModuleSpecifier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"relative"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.formatOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"esbenp.vscode-prettier"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.codeActionsOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"source.fixAll.eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-10">项目创建</h2>
<h3 data-id="heading-11">方法一：使用 Vite 官方模板</h3>
<p>Vite 是 Vue 官方推荐的构建工具，速度快，开发体验好。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建项目</span>
npm create vue@latest vue-course

<span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> vue-course
</code></pre>
<h4 data-id="heading-12">配置选项</h4>
<p>在创建过程中选择以下配置：</p>
<pre><code class="hljs">✅ TypeScript
✅ JSX
✅ Vue Router
✅ Pinia
✅ ESLint
✅ Prettier
</code></pre>
<h3 data-id="heading-13">方法二：手动创建项目</h3>
<p>如果你喜欢自定义配置，可以手动创建。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建项目目录</span>
<span class="hljs-built_in">mkdir</span> vue-course
<span class="hljs-built_in">cd</span> vue-course

<span class="hljs-comment"># 初始化 package.json</span>
npm init -y

<span class="hljs-comment"># 安装核心依赖</span>
npm install vue@latest @vue/compiler-sfc@latest
npm install -D @vitejs/plugin-vue@latest vite@latest
npm install -D typescript@latest vue-tsc@latest
</code></pre>
<h2 data-id="heading-14">项目配置</h2>
<h3 data-id="heading-15">1. Vite 配置</h3>
<p>创建 <code>vite.config.ts</code> 文件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
<span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-comment">// https://vitejs.dev/config/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()],
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>)
    }
  },
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">port</span>: <span class="hljs-number">5173</span>,
    <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">target</span>: <span class="hljs-string">'esnext'</span>,
    <span class="hljs-attr">minify</span>: <span class="hljs-string">'esbuild'</span>,
    <span class="hljs-attr">outDir</span>: <span class="hljs-string">'dist'</span>
  }
})
</code></pre>
<h3 data-id="heading-16">2. TypeScript 配置</h3>
<p>创建 <code>tsconfig.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"extends"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@vue/tsconfig/tsconfig.dom.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"env.d.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*.vue"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"exclude"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/**/__tests__/*"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"composite"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"paths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"@/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"./src/*"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"vite/client"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>创建 <code>tsconfig.node.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"extends"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@vue/tsconfig/tsconfig.dom.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"vite.config.*"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"composite"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"node"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>创建 <code>env.d.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/// &lt;reference types="vite/client" /&gt;</span>

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'*.vue'</span> {
  <span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">DefineComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">component</span>: <span class="hljs-title class_">DefineComponent</span>&lt;{}, {}, <span class="hljs-built_in">any</span>&gt;
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> component
}
</code></pre>
<h3 data-id="heading-17">3. ESLint 配置</h3>
<p>创建 <code>eslint.config.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> js <span class="hljs-keyword">from</span> <span class="hljs-string">'@eslint/js'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'eslint-plugin-vue'</span>
<span class="hljs-keyword">import</span> typescript <span class="hljs-keyword">from</span> <span class="hljs-string">'@typescript-eslint/eslint-plugin'</span>
<span class="hljs-keyword">import</span> typescriptParser <span class="hljs-keyword">from</span> <span class="hljs-string">'@typescript-eslint/parser'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'app/files-to-lint'</span>,
    <span class="hljs-attr">files</span>: [<span class="hljs-string">'**/*.{ts,mts,tsx,vue}'</span>],
  },

  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'app/files-to-ignore'</span>,
    <span class="hljs-attr">ignores</span>: [<span class="hljs-string">'**/dist/**'</span>, <span class="hljs-string">'**/dist-ssr/**'</span>, <span class="hljs-string">'**/coverage/**'</span>],
  },

  js.<span class="hljs-property">configs</span>.<span class="hljs-property">recommended</span>,
  ...vue.<span class="hljs-property">configs</span>[<span class="hljs-string">'flat/essential'</span>],

  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'app/vue-rules'</span>,
    <span class="hljs-attr">files</span>: [<span class="hljs-string">'**/*.vue'</span>],
    <span class="hljs-attr">languageOptions</span>: {
      <span class="hljs-attr">parser</span>: vue.<span class="hljs-property">parser</span>,
      <span class="hljs-attr">parserOptions</span>: {
        <span class="hljs-attr">parser</span>: typescriptParser,
        <span class="hljs-attr">extraFileExtensions</span>: [<span class="hljs-string">'.vue'</span>],
        <span class="hljs-attr">sourceType</span>: <span class="hljs-string">'module'</span>,
      },
    },
  },

  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'app/typescript-rules'</span>,
    <span class="hljs-attr">files</span>: [<span class="hljs-string">'**/*.{ts,mts,tsx,vue}'</span>],
    <span class="hljs-attr">languageOptions</span>: {
      <span class="hljs-attr">parser</span>: typescriptParser,
      <span class="hljs-attr">parserOptions</span>: {
        <span class="hljs-attr">ecmaVersion</span>: <span class="hljs-number">2020</span>,
        <span class="hljs-attr">sourceType</span>: <span class="hljs-string">'module'</span>,
      },
    },
    <span class="hljs-attr">rules</span>: {
      ...typescript.<span class="hljs-property">configs</span>.<span class="hljs-property">recommended</span>.<span class="hljs-property">rules</span>,
      <span class="hljs-string">'@typescript-eslint/no-unused-vars'</span>: <span class="hljs-string">'error'</span>,
      <span class="hljs-string">'@typescript-eslint/explicit-function-return-type'</span>: <span class="hljs-string">'off'</span>,
    },
  },
]
</code></pre>
<h3 data-id="heading-18">4. Prettier 配置</h3>
<p>创建 <code>.prettierrc.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"semi"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"singleQuote"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tabWidth"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trailingComma"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"es5"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"printWidth"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"endOfLine"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lf"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-19">项目结构搭建</h2>
<h3 data-id="heading-20">1. 基础文件结构</h3>
<pre><code class="hljs language-arduino" lang="arduino">vue-course/
├── <span class="hljs-keyword">public</span>/
│   ├── favicon.ico
├── src/
│   ├── assets/
│   │   ├── base.css
│   │   ├── main.css
│   │   └── logo.svg
│   ├── components/
│   │   ├── HelloWorld.vue
│   │   ├── TheWelcome.vue
│   │   ├── WelcomeItem.vue
│   │   └── icons/
│   ├── views/
│   │   ├── HomeView.vue
│   │   └── AboutView.vue
│   ├── router/
│   │   └── index.ts
│   ├── stores/
│   │   └── counter.ts
│   ├── App.vue
│   ├── main.ts
│   └── mcp-server.ts
├── .vscode/
│   └── settings.json
├── index.html
├── package.json
├── vite.config.ts
├── tsconfig.json
├── tsconfig.app.json
├── tsconfig.node.json
├── env.d.ts
├── eslint.config.ts
├── .prettierrc.json
└── README.md
</code></pre>
<h3 data-id="heading-21">2. 入口文件</h3>
<p><code>src/main.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-keyword">import</span> <span class="hljs-string">'./assets/main.css'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">createPinia</span>())
app.<span class="hljs-title function_">use</span>(router)

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<p><code>index.html</code>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/svg+xml"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/favicon.ico"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue Course<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/main.ts"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-22">3. 根组件</h3>
<p><code>src/App.vue</code>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div id="app"&gt;
    &lt;header class="app-header"&gt;
      &lt;h1&gt;Vue 3 项目&lt;/h1&gt;
      &lt;nav&gt;
        &lt;router-link to="/"&gt;首页&lt;/router-link&gt;
        &lt;router-link to="/about"&gt;关于&lt;/router-link&gt;
      &lt;/nav&gt;
    &lt;/header&gt;

    &lt;main class="app-main"&gt;
      &lt;router-view /&gt;
    &lt;/main&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
// 组件逻辑
&lt;/script&gt;

&lt;style scoped&gt;
.app-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 2rem;
  background: #f8f9fa;
  border-bottom: 1px solid #e9ecef;
}

.app-main {
  padding: 2rem;
  min-height: calc(100vh - 80px);
}
&lt;/style&gt;
</code></pre>
<h2 data-id="heading-23">路由配置</h2>
<h3 data-id="heading-24">1. 安装 Vue Router</h3>
<pre><code class="hljs language-bash" lang="bash">npm install vue-router@4
</code></pre>
<h3 data-id="heading-25">2. 路由配置</h3>
<p><code>src/router/index.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createRouter, createWebHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Home'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/HomeView.vue'</span>),
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">'首页'</span> }
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'About'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/AboutView.vue'</span>),
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">'关于'</span> }
  }
]

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">BASE_URL</span>),
  routes
})

<span class="hljs-comment">// 路由守卫</span>
router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> {
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`<span class="hljs-subst">${to.meta.title}</span> - Vue Course`</span>
  <span class="hljs-title function_">next</span>()
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router
</code></pre>
<h3 data-id="heading-26">3. 创建页面组件</h3>
<p><code>src/views/HomeView.vue</code>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="home"&gt;
    &lt;h2&gt;欢迎使用 Vue 3&lt;/h2&gt;
    &lt;p&gt;当前计数: {{ count }}&lt;/p&gt;
    &lt;button @click="increment" class="btn"&gt;增加&lt;/button&gt;
    &lt;button @click="decrement" class="btn"&gt;减少&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref } from 'vue'

const count = ref(0)

const increment = () =&gt; count.value++
const decrement = () =&gt; count.value--
&lt;/script&gt;

&lt;style scoped&gt;
.home {
  text-align: center;
  padding: 2rem;
}

.btn {
  margin: 0 0.5rem;
  padding: 0.5rem 1rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  background: white;
  cursor: pointer;
}

.btn:hover {
  background: #f0f0f0;
}
&lt;/style&gt;
</code></pre>
<h2 data-id="heading-27">状态管理</h2>
<h3 data-id="heading-28">1. 安装 Pinia</h3>
<pre><code class="hljs language-bash" lang="bash">npm install pinia
</code></pre>
<h3 data-id="heading-29">2. 配置 Pinia</h3>
<p>已经在 <code>main.ts</code> 中配置了。</p>
<h3 data-id="heading-30">3. 创建 Store</h3>
<p><code>src/stores/counter.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 状态</span>
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)

  <span class="hljs-comment">// 计算属性</span>
  <span class="hljs-keyword">const</span> doubleCount = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> count.<span class="hljs-property">value</span> * <span class="hljs-number">2</span>)

  <span class="hljs-comment">// 动作</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"/>) =&gt; {
    count.<span class="hljs-property">value</span>++
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">decrement</span> = (<span class="hljs-params"/>) =&gt; {
    count.<span class="hljs-property">value</span>--
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">reset</span> = (<span class="hljs-params"/>) =&gt; {
    count.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>
  }

  <span class="hljs-keyword">return</span> {
    count,
    doubleCount,
    increment,
    decrement,
    reset
  }
})
</code></pre>
<h3 data-id="heading-31">4. 在组件中使用</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;p&gt;计数: {{ counter.count }}&lt;/p&gt;
    &lt;p&gt;双倍: {{ counter.doubleCount }}&lt;/p&gt;
    &lt;button @click="counter.increment"&gt;+&lt;/button&gt;
    &lt;button @click="counter.decrement"&gt;-&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { useCounterStore } from '@/stores/counter'

const counter = useCounterStore()
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-32">样式配置</h2>
<h3 data-id="heading-33">1. 全局样式</h3>
<p><code>src/assets/main.css</code>（项目中使用的是main.css）：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-id">#app</span> {
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1280px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2rem</span>;
  <span class="hljs-attribute">font-weight</span>: normal;
}

<span class="hljs-selector-tag">a</span>,
<span class="hljs-selector-class">.green</span> {
  <span class="hljs-attribute">text-decoration</span>: none;
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsla</span>(<span class="hljs-number">160</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">37%</span>, <span class="hljs-number">1</span>);
  <span class="hljs-attribute">transition</span>: <span class="hljs-number">0.4s</span>;
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">hover</span>: <span class="hljs-attribute">hover</span>) {
  <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">hsla</span>(<span class="hljs-number">160</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">37%</span>, <span class="hljs-number">0.2</span>);
  }
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">min-width</span>: <span class="hljs-number">1024px</span>) {
  <span class="hljs-selector-tag">body</span> {
    <span class="hljs-attribute">display</span>: flex;
    place-items: center;
  }

  <span class="hljs-selector-id">#app</span> {
    <span class="hljs-attribute">display</span>: grid;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">2rem</span>;
  }
}
</code></pre>
<p><code>src/assets/base.css</code>：</p>
<pre><code class="hljs language-css" lang="css">*,
*<span class="hljs-selector-pseudo">::before</span>,
*<span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-selector-tag">html</span> {
  <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">'Segoe UI'</span>, Roboto, sans-serif;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.5</span>;
  -webkit-text-size-adjust: <span class="hljs-number">100%</span>;
}

<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
}

<span class="hljs-selector-tag">h1</span>, <span class="hljs-selector-tag">h2</span>, <span class="hljs-selector-tag">h3</span>, <span class="hljs-selector-tag">h4</span>, <span class="hljs-selector-tag">h5</span>, <span class="hljs-selector-tag">h6</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1rem</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.2</span>;
}

<span class="hljs-selector-tag">p</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1rem</span> <span class="hljs-number">0</span>;
}

<span class="hljs-selector-tag">a</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#007acc</span>;
  <span class="hljs-attribute">text-decoration</span>: none;
}

<span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">text-decoration</span>: underline;
}

<span class="hljs-selector-tag">button</span> {
  <span class="hljs-attribute">font-family</span>: inherit;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">cursor</span>: pointer;
}

<span class="hljs-selector-tag">img</span> {
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: auto;
}
</code></pre>
<h2 data-id="heading-34">开发和构建</h2>
<h3 data-id="heading-35">1. 开发服务器</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动开发服务器</span>
npm run dev

<span class="hljs-comment"># 或使用自定义端口</span>
npm run dev -- --port 3000
</code></pre>
<h3 data-id="heading-36">2. 构建生产版本</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 构建生产版本</span>
npm run build

<span class="hljs-comment"># 预览构建结果</span>
npm run preview
</code></pre>
<h3 data-id="heading-37">3. 代码检查</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 代码格式化</span>
npm run format

<span class="hljs-comment"># 代码检查</span>
npm run lint

<span class="hljs-comment"># 类型检查</span>
npm run type-check
</code></pre>
<h2 data-id="heading-38">部署选项</h2>
<h3 data-id="heading-39">1. 静态站点部署</h3>
<h4 data-id="heading-40">Vercel</h4>
<pre><code class="hljs language-bash" lang="bash">npm i -g vercel
vercel
</code></pre>
<h4 data-id="heading-41">Netlify</h4>
<pre><code class="hljs language-bash" lang="bash">npm i -g netlify-cli
netlify deploy
</code></pre>
<h2 data-id="heading-42">常见问题</h2>
<h3 data-id="heading-43">1. 依赖安装失败</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 清理缓存</span>
npm cache clean --force
<span class="hljs-built_in">rm</span> -rf node_modules package-lock.json

<span class="hljs-comment"># 使用国内镜像</span>
npm config <span class="hljs-built_in">set</span> registry https://registry.npmmirror.com

<span class="hljs-comment"># 重新安装</span>
npm install
</code></pre>
<h3 data-id="heading-44">2. TypeScript 错误</h3>
<p>确保 <code>tsconfig.json</code> 配置正确：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"extends"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@vue/tsconfig/tsconfig.dom.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"env.d.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*.vue"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-45">3. 热重载不工作</h3>
<p>检查 Vite 配置：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">hmr</span>: <span class="hljs-literal">true</span>
  }
})
</code></pre>
<h2 data-id="heading-46">总结</h2>
<p>通过本教程，你已经创建了一个完整的 Vue 3 项目，包含：</p>
<ul>
<li>✅ 现代化的开发工具链</li>
<li>✅ TypeScript 支持</li>
<li>✅ 组件化架构</li>
<li>✅ 状态管理</li>
<li>✅ 路由系统</li>
<li>✅ 代码规范</li>
<li>✅ 静态站点部署</li>
</ul>
<p>这个项目结构可以作为你开发 Vue 3 应用的起点。根据实际需求，你可以继续添加更多功能，如国际化、权限管理、数据可视化等。</p>
<h2 data-id="heading-47">资源链接</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2F" target="_blank" title="https://vuejs.org/" ref="nofollow noopener noreferrer">Vue 3 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvitejs.dev%2F" target="_blank" title="https://vitejs.dev/" ref="nofollow noopener noreferrer">Vite 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Frouter.vuejs.org%2F" target="_blank" title="https://router.vuejs.org/" ref="nofollow noopener noreferrer">Vue Router 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpinia.vuejs.org%2F" target="_blank" title="https://pinia.vuejs.org/" ref="nofollow noopener noreferrer">Pinia 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.typescriptlang.org%2F" target="_blank" title="https://www.typescriptlang.org/" ref="nofollow noopener noreferrer">TypeScript 文档</a></li>
</ul>
<hr/>
<p><strong>发布时间</strong>: 2026年1月
<strong>技术标签</strong>: Vue.js, TypeScript, Vite, 前端开发</p>
<p>希望这篇教程对你有帮助！如果有问题欢迎在评论区交流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一次 scrollIntoView 在 Android 企微中失效的踩坑实录]]></title>    <link>https://juejin.cn/post/7599017594519814170</link>    <guid>https://juejin.cn/post/7599017594519814170</guid>    <pubDate>2026-01-26T00:20:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599017594519814170" data-draft-id="7597946284678397971" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一次 scrollIntoView 在 Android 企微中失效的踩坑实录"/> <meta itemprop="keywords" content="前端,Vue.js,Vant"/> <meta itemprop="datePublished" content="2026-01-26T00:20:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="zhEng"/> <meta itemprop="url" content="https://juejin.cn/user/4398498737560861"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一次 scrollIntoView 在 Android 企微中失效的踩坑实录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4398498737560861/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    zhEng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:20:23.000Z" title="Mon Jan 26 2026 00:20:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="an-old-hope">.hljs-comment,.hljs-quote{color:#b6b18b}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#eb3c54}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e7ce56}.hljs-attribute{color:#ee7c2b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#4fb4d7}.hljs-section,.hljs-title{color:#78bb65}.hljs-keyword,.hljs-selector-tag{color:#b45ea4}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1d21;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>这是一个看起来“理所当然”，却足以让你怀疑人生的Bug。</strong></p>
<p>它不会在你本地出现，不会在 iOS 上出现，甚至在大多数 Android 浏览器上也“表现正常”。</p>
<p>但它会在 <strong>Android 企业微信</strong> 里，悄无声息地让你的页面—— 滚动不到指定位置</p>
</blockquote>
<h2 data-id="heading-0">1、事情的起点：一个再正常不过的需求</h2>
<p>故事要从一个<strong>移动端项目</strong>说起。</p>
<p>页面很常见：</p>
<ul>
<li>使用 <strong>Vant 组件库</strong></li>
<li>一个 <code>Form</code> 表单</li>
<li>若干个输入项</li>
</ul>
<p>需求也很常见：</p>
<blockquote>
<p>提交表单时触发校验，校验失败就自动滚动到对应的表单项位置。</p>
</blockquote>
<p>做过 PC 或移动端表单的人都知道，这几乎是“标配能力”。</p>
<p>在 Vant 中，对应的实现路径也非常清晰，校验失败后，调用滚动方法</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> formRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);
formRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span> {
    <span class="hljs-comment">// TODO</span>
}).<span class="hljs-title function_">cathc</span>(<span class="hljs-function"><span class="hljs-params">err</span>=&gt;</span> {
    <span class="hljs-keyword">const</span> name = err?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">name</span> ?? <span class="hljs-string">''</span>;
    name &amp;&amp; formRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">scrollToField</span>(name)
})
</code></pre>
<p>在 <strong>PC 端</strong>，这种体验甚至已经“理所当然”。</p>
<h2 data-id="heading-1">2、测试的一句话，让事情开始变味</h2>
<p>提测之后，测试小姐姐提了一个<strong>非常合理、也非常人性化的建议</strong>：</p>
<blockquote>
<p>「现在滚动是瞬间跳过去的，能不能加个过渡？看起来有点生硬。」</p>
</blockquote>
<p>听起来是不是很简单？👉 <strong>“加个平滑滚动而已。”</strong></p>
<p>我第一时间翻了 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fvant-ui.github.io%2Fvant%2F%23%2Fzh-CN%2Fform" target="_blank" title="https://vant-ui.github.io/vant/#/zh-CN/form" ref="nofollow noopener noreferrer">Vant 官方文档</a></strong>。</p>
<p>文档里对 <code>scrollToField</code> 的描述是这样的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc9e2460f5a240d595262201a4501103~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgemhFbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991623&amp;x-signature=2moLcqwkbdEnyDVT2XEdfMB3WQM%3D" alt="image.png" loading="lazy"/></p>
<p>类似：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">scrollToField</span>(<span class="hljs-attr">name</span>: string, alignToTop?: boolean)
</code></pre>
<p>但问题在于：</p>
<ul>
<li>文档<strong>没有提</strong>平滑滚动</li>
<li>也<strong>没有提</strong>是否支持更复杂的滚动配置</li>
</ul>
<p>不过，作为一个习惯 <strong>“不完全相信文档”的前端</strong>，我做了一件很自然的事——👉 <strong>去看源码。</strong></p>
<h2 data-id="heading-2">3、源码一看：这不就有戏了吗？</h2>
<p>在 Vant 的源码里，我很快找到了实现：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// packages/vant/src/form/Form.tsx</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">scrollToField</span> = (<span class="hljs-params">
  name: string,
  options?: boolean | ScrollIntoViewOptions,
</span>) =&gt; {
  children.<span class="hljs-title function_">some</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">name</span> === name) {
      item.<span class="hljs-property">$el</span>.<span class="hljs-title function_">scrollIntoView</span>(options);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  });
};
</code></pre>
<p>看到这里，好家伙，这不是直接透传 <code>scrollIntoView</code> 吗？</p>
<p>也就是说：</p>
<ul>
<li>不仅能传 <code>boolean</code></li>
<li>还能直接传 <code>ScrollIntoViewOptions</code></li>
</ul>
<p>那事情就简单了。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> formRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);
formRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span> {
    <span class="hljs-comment">// TODO 校验通过</span>
}).<span class="hljs-title function_">cathc</span>(<span class="hljs-function"><span class="hljs-params">err</span>=&gt;</span> {
    <span class="hljs-keyword">const</span> name = err?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">name</span> ?? <span class="hljs-string">''</span>;
    name &amp;&amp; formRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">scrollToField</span>(name, {
      <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
      <span class="hljs-attr">block</span>: <span class="hljs-string">'center'</span>
    })
});
</code></pre>
<p>本地一测：</p>
<ul>
<li>✅ 滚动顺滑</li>
<li>✅ 居中展示</li>
<li>✅ 体验明显提升</li>
</ul>
<h2 data-id="heading-3">4、Bug 来了，而且来得很“安静”</h2>
<p>没过多久，测试小姐姐提了一个 Bug。</p>
<p>描述非常简短：</p>
<blockquote>
<p>「 现在触发校验之后，页面好像滚动不过去了 」</p>
</blockquote>
<p>我第一反应是：</p>
<blockquote>
<p>不可能吧？我刚刚还测过。</p>
</blockquote>
<p>于是我拿起，🍎 <strong>iPhone 16 Pro</strong> 手机，点击表单提交按钮，触发校验</p>
<ul>
<li>一切正常</li>
<li>平滑滚动</li>
<li>定位精准</li>
</ul>
<p>🤔 <strong>我心想：</strong></p>
<blockquote>
<p>那这是啥问题？「 于是我换了测试同款手机 」</p>
</blockquote>
<p><strong>真凶现身：Android + 企业微信</strong> 测试环境复现条件逐渐清晰：</p>
<ul>
<li><strong>Android 手机</strong></li>
<li><strong>企业微信内置浏览器</strong></li>
<li>特定系统版本</li>
</ul>
<p>关键信息最终锁定为：</p>
<ul>
<li>MagicOS 8.0（荣耀 / 华为系，基于 Android 14）</li>
<li>企业微信 5.0.3 （内置 X5 / 系统 WebView）</li>
</ul>
<p>现象也非常“诡异”：</p>
<ul>
<li><code>scrollToField</code> <strong>被调用了</strong></li>
<li>页面<strong>没有任何报错</strong></li>
<li>但页面就是<strong>没有滚动</strong></li>
</ul>
<h2 data-id="heading-4">5、真相：Android WebView 并不“讲武德”</h2>
<p>深入排查后，问题逐渐明朗：</p>
<p><strong>(1)Android WebView 对 <code>scrollIntoView</code> 支持并不完整</strong></p>
<p>在 Android WebView / X5 内核 中：</p>
<ul>
<li>✅ <code>scrollIntoView()</code> 基本可用</li>
<li>❌ <code>block: 'center'</code> 经常被忽略</li>
<li>❌ <code>behavior: 'smooth'</code> 在复杂布局中，会被打断或失效</li>
</ul>
<p><strong>(2) 企业微信 Android 端不是“纯浏览器”</strong></p>
<p>企业微信 Android 端：</p>
<ul>
<li>使用的是系统 WebView 或 X5 内核</li>
<li>滚动是原生 + JS 混合实现</li>
<li>smooth 滚动有「<strong>动画被中断</strong>」的情况</li>
</ul>
<p>而 iOS WKWebView：</p>
<ul>
<li>对 <code>scrollIntoView({ block: 'center' })</code> 支持是规范级别的</li>
<li>滚动计算非常稳定</li>
</ul>
<p>👉 所以看到的是：「 苹果：完美  ;  安卓：玄学 」</p>
<p><strong>（3）Android 对「center」的计算有 Bug（尤其 Android 13+）</strong></p>
<p>在 Android 12+，特别是 14：</p>
<ul>
<li><code>block: 'center'</code> 的中心点</li>
<li>会<strong>忽略滚动容器 padding</strong></li>
<li>或错误使用 <code>offsetParent</code></li>
</ul>
<p>这在 <strong>企微 + MagicOS</strong> 组合下非常容易触发。</p>
<h2 data-id="heading-5">6、最终方案：别再指望 scrollIntoView 了</h2>
<p>问题明确后，解决思路也就清晰了。</p>
<p><strong>方案一：Android 端不使用 <code>smooth</code></strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> isAndroid = <span class="hljs-regexp">/Android/i</span>.<span class="hljs-title function_">test</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">navigator</span>.<span class="hljs-property">userAgent</span>);

element.<span class="hljs-title function_">scrollIntoView</span>({
  <span class="hljs-attr">behavior</span>: isAndroid ? <span class="hljs-string">'auto'</span> : <span class="hljs-string">'smooth'</span>,
  <span class="hljs-attr">block</span>: <span class="hljs-string">'center'</span>
});
</code></pre>
<p><strong>方案二（最稳）：自己计算滚动距离</strong></p>
<p>核心思想只有一句话： <strong>自己算 <code>scrollTop</code>，别把命运交给 WebView。</strong></p>
<p>示例：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 将目标元素滚动到容器中间
 * <span class="hljs-doctag">@param</span> container 滚动元素
 * <span class="hljs-doctag">@param</span> target 目标元素
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">scrollToCenter</span>(container, target) =&gt; {
  <span class="hljs-keyword">const</span> containerRect = container.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-keyword">const</span> targetRect = target.<span class="hljs-title function_">getBoundingClientRect</span>();

  <span class="hljs-keyword">const</span> offset =
    targetRect.<span class="hljs-property">top</span> -
    containerRect.<span class="hljs-property">top</span> -
    container.<span class="hljs-property">clientHeight</span> / <span class="hljs-number">2</span> +
    target.<span class="hljs-property">clientHeight</span> / <span class="hljs-number">2</span>;

  container.<span class="hljs-title function_">scrollTo</span>({
    <span class="hljs-attr">top</span>: container.<span class="hljs-property">scrollTop</span> + offset,
    <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>
  });
}
</code></pre>
<p>usage</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> formRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);
formRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span> {
    <span class="hljs-comment">// TODO 校验通过</span>
}).<span class="hljs-title function_">cathc</span>(<span class="hljs-function"><span class="hljs-params">err</span>=&gt;</span> {
    <span class="hljs-keyword">const</span> name = err?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">name</span> ?? <span class="hljs-string">''</span>;
    <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'app'</span>);
    <span class="hljs-keyword">const</span> target = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByClassName</span>(<span class="hljs-string">'van-field__error-message'</span>)?.[<span class="hljs-number">0</span>]
    <span class="hljs-title function_">scrollToCenter</span>(container, target);
});
</code></pre>
<p>上线测试：</p>
<ul>
<li>✅ Android 企业微信</li>
<li>✅ iOS</li>
<li>✅ 本地浏览器</li>
</ul>
<p><strong>全部通过。</strong></p>
<p>测试小姐姐给了一个评价：「这次的体验很好 👍」 那一刻，真的值了。</p>
<h2 data-id="heading-6">7、踩坑总结</h2>
<p>如果你也在做类似的事情，建议直接收藏：</p>
<ul>
<li>
<p>不要在 Android 企业微信中过度依赖 <code>scrollIntoView</code> 的高级配置项</p>
</li>
<li>
<p>尤其是：</p>
<ul>
<li><code>behavior: 'smooth'</code></li>
<li><code>block: 'center'</code></li>
</ul>
</li>
<li>
<p><strong>iOS 正常 ≠ 代码在所有环境都正确</strong></p>
</li>
</ul>
<p>这类问题的本质往往不是：</p>
<blockquote>
<p>你写错了代码*，</p>
</blockquote>
<p>而是：</p>
<blockquote>
<p><strong>你刚好踩到了 WebView 的能力边界了。</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HagiCode 实践：如何利用 GitHub Actions 实现 Docusaurus 自动部署]]></title>    <link>https://juejin.cn/post/7599268297202384934</link>    <guid>https://juejin.cn/post/7599268297202384934</guid>    <pubDate>2026-01-26T00:56:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297202384934" data-draft-id="7599094262592192522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HagiCode 实践：如何利用 GitHub Actions 实现 Docusaurus 自动部署"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-26T00:56:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="newbe36524"/> <meta itemprop="url" content="https://juejin.cn/user/2682464104098654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HagiCode 实践：如何利用 GitHub Actions 实现 Docusaurus 自动部署
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2682464104098654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    newbe36524
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:56:23.000Z" title="Mon Jan 26 2026 00:56:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">为 HagiCode 添加 GitHub Pages 自动部署支持</h2>
<blockquote>
<p>本项目早期代号为 PCode，现已正式更名为 HagiCode。本文记录了如何为项目引入自动化静态站点部署能力，让内容发布像喝水一样简单。</p>
</blockquote>

<h3 data-id="heading-1">背景/引言</h3>
<p>在 HagiCode 的开发过程中，我们遇到了一个很现实的问题：随着文档和提案越来越多，如何高效地管理和展示这些内容成了当务之急。我们决定引入 GitHub Pages 来托管我们的静态站点，但是手动构建和部署实在是太麻烦了——每次改动都要本地构建、打包，然后手动推送到 <code>gh-pages</code> 分支。这不仅效率低下，还容易出错。</p>
<p>为了解决这个问题（主要是为了偷懒），我们需要一套自动化的部署流程。本文将详细记录如何为 HagiCode 项目添加 GitHub Actions 自动部署支持，让我们只需专注于内容创作，剩下的交给自动化流程。</p>
<h3 data-id="heading-2">关于 HagiCode</h3>
<blockquote>
<p>嘿，介绍一下我们正在做的东西</p>
</blockquote>
<p>我们正在开发 <strong>HagiCode</strong>——一款 AI 驱动的代码智能助手，让开发体验变得更智能、更便捷、更有趣。</p>
<p><strong>智能</strong>——AI 全程辅助，从想法到代码，让编码效率提升数倍。<strong>便捷</strong>——多线程并发操作，充分利用资源，开发流程顺畅无阻。<strong>有趣</strong>——游戏化机制和成就系统，让编码不再枯燥，充满成就感。</p>
<p>项目正在快速迭代中，如果你对技术写作、知识管理或者 AI 辅助开发感兴趣，欢迎来 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHagiCode-org%2Fsite" target="_blank" title="https://github.com/HagiCode-org/site" ref="nofollow noopener noreferrer">GitHub</a> 看看～</p>
<h3 data-id="heading-3">目标分析</h3>
<p>在动手之前，我们得先明确这次任务到底要干啥。毕竟磨刀不误砍柴工嘛。</p>
<h4 data-id="heading-4">核心需求</h4>
<ol>
<li><strong>自动化构建</strong>：当代码推送到 <code>main</code> 分支时，自动触发构建流程。</li>
<li><strong>自动部署</strong>：构建成功后，自动将生成的静态文件部署到 GitHub Pages。</li>
<li><strong>环境一致性</strong>：确保 CI 环境和本地构建环境一致，避免"本地能跑，线上报错"的尴尬。</li>
</ol>
<h4 data-id="heading-5">技术选型</h4>
<p>考虑到 HagiCode 是基于 Docusaurus 构建的（一种非常流行的 React 静态站点生成器），我们可以利用 GitHub Actions 来实现这一目标。</p>
<h3 data-id="heading-6">配置 GitHub Actions 工作流</h3>
<p>GitHub Actions 是 GitHub 提供的 CI/CD 服务。通过在代码仓库中定义 YAML 格式的工作流文件，我们可以定制各种自动化任务。</p>
<h4 data-id="heading-7">创建工作流文件</h4>
<p>我们需要在项目根目录下的 <code>.github/workflows</code> 文件夹中创建一个新的配置文件，比如叫 <code>deploy.yml</code>。如果文件夹不存在，记得先手动创建一下。</p>
<p>这个配置文件的核心逻辑如下：</p>
<ol>
<li><strong>触发条件</strong>：监听 <code>main</code> 分支的 <code>push</code> 事件。</li>
<li><strong>运行环境</strong>：最新版的 Ubuntu。</li>
<li><strong>构建步骤</strong>：
<ul>
<li>检出代码</li>
<li>安装 Node.js</li>
<li>安装依赖 (<code>npm install</code>)</li>
<li>构建静态文件 (<code>npm run build</code>)</li>
</ul>
</li>
<li><strong>部署步骤</strong>：使用官方提供的 <code>action-gh-pages</code> 将构建产物推送到 <code>gh-pages</code> 分支。</li>
</ol>
<h4 data-id="heading-8">关键配置代码</h4>
<p>以下是我们最终采用的配置模板：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">to</span> <span class="hljs-string">GitHub</span> <span class="hljs-string">Pages</span>

<span class="hljs-comment"># 触发条件：当推送到 main 分支时</span>
<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">main</span>
    <span class="hljs-comment"># 可以根据需要添加路径过滤，比如只有文档变动才构建</span>
    <span class="hljs-comment"># paths:</span>
    <span class="hljs-comment">#   - 'docs/**'</span>
    <span class="hljs-comment">#   - 'package.json'</span>

<span class="hljs-comment"># 设置权限，这对于部署到 GitHub Pages 很重要</span>
<span class="hljs-attr">permissions:</span>
  <span class="hljs-attr">contents:</span> <span class="hljs-string">read</span>
  <span class="hljs-attr">pages:</span> <span class="hljs-string">write</span>
  <span class="hljs-attr">id-token:</span> <span class="hljs-string">write</span>

<span class="hljs-comment"># 并发控制：取消同一分支的旧构建</span>
<span class="hljs-attr">concurrency:</span>
  <span class="hljs-attr">group:</span> <span class="hljs-string">"pages"</span>
  <span class="hljs-attr">cancel-in-progress:</span> <span class="hljs-literal">false</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>
        <span class="hljs-comment"># 注意：必须设置 fetch-depth: 0，否则可能导致构建版本号不准确</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">fetch-depth:</span> <span class="hljs-number">0</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Node</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v4</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">20</span> <span class="hljs-comment"># 建议与本地开发环境保持一致</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">'npm'</span>     <span class="hljs-comment"># 启用缓存可以加速构建过程</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span>
        <span class="hljs-comment"># 使用 npm ci 而不是 npm install，因为它更快、更严格，适合 CI 环境</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">website</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-comment"># 如果你的站点构建需要环境变量，在这里配置</span>
          <span class="hljs-comment"># NODE_ENV: production</span>
          <span class="hljs-comment"># PUBLIC_URL: /your-repo-name</span>
          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">artifact</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/upload-pages-artifact@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">./build</span> <span class="hljs-comment"># Docusaurus 默认输出目录</span>

  <span class="hljs-attr">deploy:</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">name:</span> <span class="hljs-string">github-pages</span>
      <span class="hljs-attr">url:</span> <span class="hljs-string">${{</span> <span class="hljs-string">steps.deployment.outputs.page_url</span> <span class="hljs-string">}}</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">needs:</span> <span class="hljs-string">build</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">to</span> <span class="hljs-string">GitHub</span> <span class="hljs-string">Pages</span>
        <span class="hljs-attr">id:</span> <span class="hljs-string">deployment</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/deploy-pages@v4</span>
</code></pre>
<h3 data-id="heading-9">实施过程中的坑点</h3>
<p>在实际操作中，我们遇到了一些问题，这里分享出来希望大家能避开（或者提前准备好解决方案）。</p>
<h4 data-id="heading-10">1. GitHub Token 权限问题</h4>
<p>最开始配置的时候，部署总是报错 403 (Forbidden)。查了好久才发现，是因为 GitHub 默认的 <code>GITHUB_TOKEN</code> 并没有写入 Pages 的权限。</p>
<p><strong>解决方案</strong>：在仓库的 <code>Settings</code> -&gt; <code>Actions</code> -&gt; <code>General</code> -&gt; <code>Workflow permissions</code> 中，务必选择 <strong>"Read and write permissions"</strong>。</p>
<h4 data-id="heading-11">2. 构建目录路径错误</h4>
<p>Docusaurus 默认把构建好的静态文件放在 <code>build</code> 目录。但是有些项目（比如 Create React App 默认是 <code>build</code>，Vite 默认是 <code>dist</code>）可能配置不一样。如果在 Actions 中报错找不到文件，记得去 <code>docusaurus.config.js</code> 里检查一下输出路径配置。</p>
<h4 data-id="heading-12">3. 子路径问题</h4>
<p>如果你的仓库不是用户主页（即不是 <code>username.github.io</code>），而是项目主页（比如 <code>username.github.io/project-name</code>），你需要配置 <code>baseUrl</code>。</p>
<p>在 <code>docusaurus.config.js</code> 中：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">url</span>: <span class="hljs-string">'https://HagiCode-org.github.io'</span>, <span class="hljs-comment">// 你的 GitHub URL</span>
  <span class="hljs-attr">baseUrl</span>: <span class="hljs-string">'/site/'</span>, <span class="hljs-comment">// 如果你的仓库叫 site，这里就填 /site/</span>
  <span class="hljs-comment">// ...</span>
};
</code></pre>
<p>这一点很容易被忽略，配置不对会导致页面打开全是白屏，因为资源路径加载不到。</p>
<h3 data-id="heading-13">验证成果</h3>
<p>配置完所有东西并推送代码后，我们就可以去 GitHub 仓库的 <strong>Actions</strong> 标签页看戏了。</p>
<p>你会看到黄色的圆圈（工作流正在运行），变绿就代表成功啦！如果变红了，点击进去查看日志，通常都能排查出问题（大部分时候是拼写错误或者路径配置不对）。</p>
<p>构建成功后，访问 <code>https://&lt;你的用户名&gt;.github.io/&lt;仓库名&gt;/</code> 就能看到崭新的站点了。</p>
<h3 data-id="heading-14">总结</h3>
<p>通过引入 GitHub Actions，我们成功实现了 HagiCode 文档站的自动化部署。这不仅节省了手动操作的时间，更重要的是保证了发布流程的标准化。现在不管是哪位小伙伴更新了文档，只要合并到 <code>main</code> 分支，几分钟后就能在线上看到最新的内容。</p>
<p><strong>核心收益</strong>：</p>
<ul>
<li><strong>效率提升</strong>：从"手动打包、手动上传"变成"代码即发布"。</li>
<li><strong>降低错误</strong>：消除了人为操作失误的可能性。</li>
<li><strong>体验优化</strong>：让开发者更专注于内容质量，而不是被繁琐的部署流程困扰。</li>
</ul>
<p>虽然配置 CI/CD 刚开始有点麻烦（尤其是各种权限和路径问题），但这是一次性投入，长期回报巨大的工作。强烈建议所有静态站点项目都接入类似的自动化流程。</p>
<h3 data-id="heading-15">参考资料</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.github.com%2Fen%2Factions" target="_blank" title="https://docs.github.com/en/actions" ref="nofollow noopener noreferrer">GitHub Actions 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocusaurus.io%2Fdocs%2Fdeployment" target="_blank" title="https://docusaurus.io/docs/deployment" ref="nofollow noopener noreferrer">Docusaurus 部署指南</a></li>
<li>[actions-gh-pages Action 使用说明](<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com" target="_blank" title="https://github.com" ref="nofollow noopener noreferrer">github.com</a> peaceiris/actions-gh-pages)</li>
</ul>
<hr/>
<p>感谢您的阅读,如果您觉得本文有用,快点击下方点赞按钮👍,让更多的人看到本文。</p>
<p>本内容采用人工智能辅助协作,经本人审核,符合本人观点与立场。</p>
<h3 data-id="heading-16">元信息</h3>
<ul>
<li><strong>本文作者:</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.newbe.pro" target="_blank" title="https://www.newbe.pro" ref="nofollow noopener noreferrer">newbe36524</a></li>
<li><strong>本文链接:</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fhagicode-org.github.io%2Fsite%2Fblog%2F2026%2F01%2F25%2Fdocusaurus-auto-deployment-with-github-actions" target="_blank" title="https://hagicode-org.github.io/site/blog/2026/01/25/docusaurus-auto-deployment-with-github-actions" ref="nofollow noopener noreferrer">hagicode-org.github.io/site/blog/2…</a></li>
<li><strong>版权声明:</strong> 本博客所有文章除特别声明外,均采用 BY-NC-SA 许可协议。转载请注明出处!</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解决 Vite 开发服务器启动报错：spawn EPERM]]></title>    <link>https://juejin.cn/post/7598767580306571318</link>    <guid>https://juejin.cn/post/7598767580306571318</guid>    <pubDate>2026-01-26T01:05:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598767580306571318" data-draft-id="7598767580306554934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解决 Vite 开发服务器启动报错：spawn EPERM"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-26T01:05:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="独守一隅"/> <meta itemprop="url" content="https://juejin.cn/user/2963939079500248"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解决 Vite 开发服务器启动报错：spawn EPERM
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2963939079500248/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    独守一隅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:05:57.000Z" title="Mon Jan 26 2026 01:05:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">问题现象</h2>
<p>在 Windows 系统下运行 Vite 开发服务器时，控制台报错：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-built_in">Error</span>: spawn EPERM 
     at ChildProcess.<span class="hljs-title function_ invoke__">spawn</span> (<span class="hljs-attr">node</span>:internal/<span class="hljs-attr">child_process</span>:<span class="hljs-number">420</span>:<span class="hljs-number">11</span>) 
     at Object.<span class="hljs-title function_ invoke__">spawn</span> (<span class="hljs-attr">node</span>:<span class="hljs-attr">child_process</span>:<span class="hljs-number">787</span>:<span class="hljs-number">9</span>) 
     at <span class="hljs-title function_ invoke__">baseOpen</span> (<span class="hljs-attr">file</span>:///<span class="hljs-attr">E</span>:/标签溯源/code/TraceGuard-UI/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.<span class="hljs-attr">js</span>:<span class="hljs-number">26487</span>:<span class="hljs-number">36</span>)
</code></pre>
<p>开发服务器无法正常启动，或者启动后立即崩溃。</p>
<h2 data-id="heading-1">发生原因</h2>
<p>这个错误通常由以下几个因素导致：</p>
<h3 data-id="heading-2">1. Vite 自动打开浏览器功能</h3>
<p>在 <code>vite.config.js</code> 配置文件中，<code>server.open</code> 选项被设置为 <code>true</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">server</span>: {
  <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>,
  <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 这里是问题所在</span>
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>当 <code>open: true</code> 时，Vite 会在服务器启动后自动调用系统默认浏览器打开开发地址。</p>
<h3 data-id="heading-3">2. Windows 权限限制</h3>
<p>在 Windows 系统上，Node.js 的 <code>child_process.spawn()</code> 方法尝试启动浏览器进程时，可能会遇到以下权限问题：</p>
<ul>
<li><strong>权限不足</strong>：当前进程没有足够的权限启动外部应用程序</li>
<li><strong>安全策略限制</strong>：Windows Defender 或企业安全策略阻止了进程创建</li>
<li><strong>路径问题</strong>：浏览器可执行文件路径无法正确解析</li>
</ul>
<h3 data-id="heading-4">3. 端口占用（次要原因）</h3>
<p>如果配置的端口（如 80）已被其他进程占用，也可能导致类似的错误。</p>
<h2 data-id="heading-5">解决方案</h2>
<h3 data-id="heading-6">方案一：禁用自动打开浏览器（推荐）</h3>
<p>修改 <code>vite.config.js</code> 文件，将 <code>open</code> 选项设置为 <code>false</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ mode, command }</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">server</span>: {
      <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>,
      <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">open</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// 改为 false，禁用自动打开浏览器</span>
      <span class="hljs-attr">proxy</span>: {
        <span class="hljs-comment">// ... 其他配置</span>
      }
    },
    <span class="hljs-comment">// ... 其他配置</span>
  }
})
</code></pre>
<p><strong>优点</strong>：</p>
<ul>
<li>彻底解决权限问题</li>
<li>不影响开发服务器功能</li>
<li>可以手动选择浏览器访问</li>
</ul>
<p><strong>使用方式</strong>：
启动开发服务器后，在浏览器中手动访问 <code>http://localhost:80</code></p>
<h3 data-id="heading-7">方案二：指定浏览器路径</h3>
<p>如果确实需要自动打开浏览器，可以指定浏览器可执行文件的完整路径：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">server</span>: {
  <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>,
  <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">open</span>: <span class="hljs-string">'chrome'</span>,  <span class="hljs-comment">// 或者指定完整路径</span>
  <span class="hljs-comment">// 或者</span>
  <span class="hljs-attr">open</span>: <span class="hljs-string">'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'</span>
}
</code></pre>
<p><strong>注意</strong>：这种方式仍然可能遇到权限问题，不如方案一稳定。</p>
<h3 data-id="heading-8">方案三：以管理员身份运行</h3>
<p>以管理员身份运行终端或 IDE，然后执行 <code>npm run dev</code> 命令。</p>
<p><strong>缺点</strong>：</p>
<ul>
<li>不是长期解决方案</li>
<li>可能带来安全风险</li>
<li>不推荐作为常规做法</li>
</ul>
<h2 data-id="heading-9">验证修复</h2>
<p>修改配置后，重新启动开发服务器：</p>
<pre><code class="hljs language-bash" lang="bash">npm run dev
</code></pre>
<p>应该看到类似以下的成功输出：</p>
<pre><code class="hljs language-arduino" lang="arduino">  VITE v6<span class="hljs-number">.3</span><span class="hljs-number">.5</span>  ready in xxx ms

  ➜  Local:   http:<span class="hljs-comment">//localhost:80/</span>
  ➜  Network: http:<span class="hljs-comment">//192.168.x.x:80/</span>
  ➜  press h + enter to show help
</code></pre>
<p>然后在浏览器中手动访问 <code>http://localhost:80</code> 即可。</p>
<h2 data-id="heading-10">总结</h2>
<p><code>spawn EPERM</code> 错误是 Windows 系统下 Vite 开发服务器的常见问题，主要原因是自动打开浏览器功能触发了权限限制。最简单有效的解决方案是禁用自动打开浏览器功能，改为手动访问开发地址。</p>
<p>这种方式不仅解决了权限问题，还提供了更好的开发体验——你可以自由选择浏览器和打开时机。</p>
<h2 data-id="heading-11">相关资源</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vitejs.dev%2Fconfig%2F%23server-open" target="_blank" title="https://cn.vitejs.dev/config/#server-open" ref="nofollow noopener noreferrer">Vite 官方文档 - server.open</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fchild_process.html%23child_processspawncommand-args-options" target="_blank" title="https://nodejs.org/api/child_process.html#child_processspawncommand-args-options" ref="nofollow noopener noreferrer">Node.js child_process.spawn() 文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🔥🔥🔥 React18 源码学习 - DIFF算法]]></title>    <link>https://juejin.cn/post/7598830215258800164</link>    <guid>https://juejin.cn/post/7598830215258800164</guid>    <pubDate>2026-01-26T01:43:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598830215258800164" data-draft-id="7598588085597929512" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🔥🔥🔥 React18 源码学习 - DIFF算法"/> <meta itemprop="keywords" content="源码阅读"/> <meta itemprop="datePublished" content="2026-01-26T01:43:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yyyao"/> <meta itemprop="url" content="https://juejin.cn/user/4266531531793976"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🔥🔥🔥 React18 源码学习 - DIFF算法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4266531531793976/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yyyao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:43:45.000Z" title="Mon Jan 26 2026 01:43:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">前言</h2>
<p>本文的<code>React</code>代码版本为<code>18.2.0</code></p>
<p>可调试的代码仓库为：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyyyao-hh%2Freact-debug%2Ftree%2Fmaster-pure" target="_blank" title="https://github.com/yyyao-hh/react-debug/tree/master-pure" ref="nofollow noopener noreferrer">GitHub - yyyao-hh/react-debug at master-pure</a></p>
<p>在<code>React</code>的世界里，每次状态更新都会触发组件的重新渲染。如果直接销毁旧<code>DOM</code>节点并创建新节点，性能开销将无法承受。<code>React</code>通过调和（<code>Reconciliation</code>） 过程，配合<code>DIFF</code>算法，找出需要更新的最小节点集合，实现了高效的<code>UI</code>更新。</p>
<p>本文将带你深<code>React18</code>源码，揭示<code>DIFF</code>算法的核心原理、实现细节和优化策略。</p>
<h2 data-id="heading-1">DIFF 算法的策略</h2>
<h3 data-id="heading-2">策略一：同级比较</h3>
<p><code>React</code>只会对同一层级的节点进行比较，不会跨层级追踪节点变化。</p>
<h3 data-id="heading-3">策略二：类型不同则销毁重建</h3>
<p>如果节点类型改变，<code>React</code>会直接销毁整个子树，重新构建新的节点。</p>
<h3 data-id="heading-4">策略三：Key 值优化列表更新</h3>
<p><code>React</code>使用<code>key</code>来匹配原有树上的子元素，匹配成功就会进行复用。通过<code>key</code>标识节点的稳定性，<code>React</code>可以更准确地识别节点的移动、添加和删除，使得树的转换效率得以提高。</p>
<p>比如：两个同级兄弟节点位置进行了调换，存在<code>key</code>的情况下两个节点都会被复用，而不是卸载重新构建。</p>
<h2 data-id="heading-5">DIFF 算法的入口</h2>
<p>在上一节我们讲构建<code>Fiber</code>树的时候，讲到了<code>beginWork</code>方法内部主要是根据<code>tag</code>分发逻辑，处理不同类型的<code>Fiber</code>节点。将处理方法的返回的子节点作为下一个遍历节点</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/* packages/react-reconciler/src/ReactFiberBeginWork.old.js */</span>

function beginWork(
  current: Fiber | <span class="hljs-literal">null</span>,
  workInProgress: Fiber,
  renderLanes: Lanes,
): Fiber | <span class="hljs-literal">null</span> {
  <span class="hljs-keyword">if</span>(...) {...}; <span class="hljs-comment">// 满足一定条件下执行熔断策略</span>

  switch (workInProgress.tag) {
    case IndeterminateComponent: <span class="hljs-keyword">return</span> mountIndeterminateComponent(...);
    case LazyComponent: <span class="hljs-keyword">return</span> mountLazyComponent(...);
    case FunctionComponent: <span class="hljs-keyword">return</span> updateFunctionComponent(...);
    case ClassComponent: <span class="hljs-keyword">return</span> updateClassComponent(...);
    case HostRoot: <span class="hljs-keyword">return</span> updateHostRoot(...);
    case HostComponent: <span class="hljs-keyword">return</span> updateHostComponent(...);
    case HostText: <span class="hljs-keyword">return</span> updateHostText(...);
    case SuspenseComponent: <span class="hljs-keyword">return</span> updateSuspenseComponent(...);
    case HostPortal: <span class="hljs-keyword">return</span> updatePortalComponent(...);
    case ForwardRef: <span class="hljs-keyword">return</span> updateForwardRef(...);
    case Fragment: <span class="hljs-keyword">return</span> updateFragment(...);
    case Mode: <span class="hljs-keyword">return</span> updateMode(...);
    case Profiler: <span class="hljs-keyword">return</span> updateProfiler(...);
    case ContextProvider: <span class="hljs-keyword">return</span> updateContextProvider(...);
    case ContextConsumer: <span class="hljs-keyword">return</span> updateContextConsumer(...);
    case MemoComponent: <span class="hljs-keyword">return</span> updateMemoComponent(...);
    case SimpleMemoComponent: <span class="hljs-keyword">return</span> updateSimpleMemoComponent(...);
    case IncompleteClassComponent: <span class="hljs-keyword">return</span> mountIncompleteClassComponent(...);
    case SuspenseListComponent: <span class="hljs-keyword">return</span> updateSuspenseListComponent(...);
    case ScopeComponent: <span class="hljs-keyword">return</span> updateScopeComponent(...);
    case OffscreenComponent: <span class="hljs-keyword">return</span> updateOffscreenComponent(...);
    case LegacyHiddenComponent: <span class="hljs-keyword">return</span> updateLegacyHiddenComponent(...);
    case CacheComponent: <span class="hljs-keyword">return</span> updateCacheComponent(...);
    case TracingMarkerComponent: <span class="hljs-keyword">return</span> updateTracingMarkerComponent(...);
  }
}
</code></pre>
<p>这些不同的处理逻辑最终都会走到<code>reconcileChildren</code>函数中去处理，这里简单以类组件（<code>ClassComponent</code>）和函数式组件（<code>FunctionComponent</code>）的举例：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 类组件 (ClassComponent)</span>
function <span class="hljs-built_in">updateClassComponent</span>(...) {
  const nextUnitOfWork = <span class="hljs-built_in">finishClassComponent</span>(...);
  
  return nextUnitOfWork;
}

function <span class="hljs-built_in">finishClassComponent</span>(...) {
  <span class="hljs-built_in">reconcileChildren</span>(current, workInProgress, nextChildren, renderLanes);

  return workInProgress<span class="hljs-selector-class">.child</span>;
}

<span class="hljs-comment">// 函数式组件 (FunctionComponent)</span>
function <span class="hljs-built_in">updateFunctionComponent</span>(...) {
  <span class="hljs-built_in">reconcileChildren</span>(current, workInProgress, nextChildren, renderLanes);
  
  return workInProgress<span class="hljs-selector-class">.child</span>;
}
</code></pre>
<pre><code class="hljs language-ini" lang="ini">/* src/react/packages/react-reconciler/src/ReactFiberBeginWork.old.js */

export function reconcileChildren(...) {
  if (<span class="hljs-attr">current</span> === null) {
    <span class="hljs-attr">workInProgress.child</span> = mountChildFibers(...)<span class="hljs-comment">;</span>
  } else {
    <span class="hljs-attr">workInProgress.child</span> = reconcileChildFibers(...)<span class="hljs-comment">;</span>
  }
}
</code></pre>
<pre><code class="hljs language-ini" lang="ini">/* src/react/packages/react-reconciler/src/ReactChildFiber.old.js */

export const <span class="hljs-attr">reconcileChildFibers</span> = ChildReconciler(<span class="hljs-literal">true</span>)<span class="hljs-comment">;</span>
export const <span class="hljs-attr">mountChildFibers</span> = ChildReconciler(<span class="hljs-literal">false</span>)<span class="hljs-comment">;</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/* src/react/packages/react-reconciler/src/ReactChildFiber.old.js */</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ChildReconciler</span>(<span class="hljs-params">shouldTrackSideEffects</span>) {

  ...

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">reconcileChildFibers</span>(<span class="hljs-params"/>) {}

  <span class="hljs-keyword">return</span> reconcileChildFibers;
}
</code></pre>
<p>所以<code>reconcileChildFibers</code>函数是实现<code>Diff</code>算法的核心方法</p>
<h2 data-id="heading-6">DIFF 算法的实现</h2>
<p>我们紧接着入口之后，来分析<code>reconcileChildFibers</code>函数的内部逻辑。</p>
<ol>
<li>
<p>首先处理顶级且无<code>key</code>的<code>Fragment</code>元素，满足条件则直接使用它的孩子。这里值得注意的两点：</p>
<p>a.  存在<code>key</code>的<code>Fragment</code>不满足条件，于是乎在下方“处理单元素”逻辑中又会处理一下。</p>
<p>b.  非顶级的<code>Fragment</code>依旧不满足条件，在下方“处理数组元素”的逻辑中会进行处理。</p>
</li>
<li>
<p>如果是一个对象，那么它是一个<code>ReactElement</code>。分为普通元素、<code>Lazy</code>组件、<code>Portal</code>组件、节点数组、可迭代对象分别进行处理；</p>
</li>
<li>
<p>如果是<code>string</code>或<code>number</code>类型，调用处理文本节点的方法。</p>
</li>
<li>
<p>剩余情况：可能为<code>null</code>、<code>undefined</code>、<code>false</code>或<code>''</code>，不能转化为<code>Fiber</code>节点，因此直接删除所有旧子<code>Fiber</code>节点。</p>
</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">function <span class="hljs-title">reconcileChildFibers</span>(<span class="hljs-params">
  returnFiber: Fiber,
  currentFirstChild: Fiber | <span class="hljs-literal">null</span>,
  newChild: any,
  lanes: Lanes,
</span>): Fiber | <span class="hljs-literal">null</span></span> {
  
  <span class="hljs-comment">/* 1. 顶级无key的Fragment元素, 直接使用它的children */</span>
  <span class="hljs-keyword">const</span> isUnkeyedTopLevelFragment =
    <span class="hljs-keyword">typeof</span> newChild === <span class="hljs-string">'object'</span> &amp;&amp;
    newChild !== <span class="hljs-literal">null</span> &amp;&amp;
    newChild.type === REACT_FRAGMENT_TYPE &amp;&amp;
    newChild.key === <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span> (isUnkeyedTopLevelFragment) {
    newChild = newChild.props.children;
  }

  <span class="hljs-comment">/* 2. 处理对象类型 */</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> newChild === <span class="hljs-string">'object'</span> &amp;&amp; newChild !== <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">switch</span> (newChild.$$<span class="hljs-keyword">typeof</span>) {
      <span class="hljs-comment">// 2.1 React 元素</span>
      <span class="hljs-keyword">case</span> REACT_ELEMENT_TYPE:
        <span class="hljs-keyword">return</span> placeSingleChild(
          reconcileSingleElement(
            returnFiber,
            currentFirstChild,
            newChild,
            lanes,
          ),
        );
      <span class="hljs-comment">// 2.2 Portal</span>
      <span class="hljs-keyword">case</span> REACT_PORTAL_TYPE:
        <span class="hljs-keyword">return</span> placeSingleChild(
          reconcileSinglePortal(
            returnFiber,
            currentFirstChild,
            newChild,
            lanes,
          ),
        );
      <span class="hljs-comment">// 2.3 懒加载组件</span>
      <span class="hljs-keyword">case</span> REACT_LAZY_TYPE:
        <span class="hljs-keyword">const</span> payload = newChild._payload;
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">init</span> = newChild._init;
        <span class="hljs-keyword">return</span> reconcileChildFibers(
          returnFiber,
          currentFirstChild,
          <span class="hljs-keyword">init</span>(payload),
          lanes,
        );
    }

    <span class="hljs-comment">// 2.4. 数组类型处理</span>
    <span class="hljs-keyword">if</span> (isArray(newChild)) {
      <span class="hljs-keyword">return</span> reconcileChildrenArray(
        returnFiber,
        currentFirstChild,
        newChild,
        lanes,
      );
    }

    <span class="hljs-comment">// 2.5 可迭代对象处理</span>
    <span class="hljs-keyword">if</span> (getIteratorFn(newChild)) {
      <span class="hljs-keyword">return</span> reconcileChildrenIterator(
        returnFiber,
        currentFirstChild,
        newChild,
        lanes,
      );
    }

    <span class="hljs-comment">// 2.6 无效对象类型错误</span>
    throwOnInvalidObjectType(returnFiber, newChild);
  }

  <span class="hljs-comment">/* 3. 处理文本节点类型 */</span>
  <span class="hljs-keyword">if</span> (
    (<span class="hljs-keyword">typeof</span> newChild === <span class="hljs-string">'string'</span> &amp;&amp; newChild !== <span class="hljs-string">''</span>) ||
    <span class="hljs-keyword">typeof</span> newChild === <span class="hljs-string">'number'</span>
  ) {
    <span class="hljs-keyword">return</span> placeSingleChild(
      reconcileSingleTextNode(
        returnFiber,
        currentFirstChild,
        <span class="hljs-string">''</span> + newChild,
        lanes,
      ),
    );
  }

  <span class="hljs-comment">/* 4. 剩余情况 */</span>
  <span class="hljs-keyword">return</span> deleteRemainingChildren(returnFiber, currentFirstChild);
}
</code></pre>
<h3 data-id="heading-7">处理单节点</h3>
<p><code>reconcileSingleElement</code>方法用于处理当新的子节点是一个单独的元素（不是数组或文本节点）时的情况。</p>
<p>它的处理分为两个阶段，判断条件便是<code>child !== null</code></p>
<ol>
<li>更新阶段（<code>while</code>循环）</li>
<li>初始化阶段或在循环中不满足复用条件（<code>while</code>循环之后）</li>
</ol>
<p>首先<code>while</code>循环的逻辑：遍历旧子<code>Fiber</code>节点，尝试找到可以复用的<code>Fiber</code>节点：</p>
<ul>
<li>如果<code>key</code>相同且<code>type</code>相同，则复用并删除其他兄弟节点；</li>
<li>如果<code>key</code>相同但<code>type</code>不同，则删除包括当前节点在内的所有子节点，然后跳出循环；</li>
<li>如果<code>key</code>不同，则标记当前<code>child</code>为删除，继续遍历下一个兄弟节点。</li>
</ul>
<p>然后是循环之后的逻辑：遍历完或<code>break</code>后未找到可复用节点，直接创建新的<code>Fiber</code>节点。</p>
<pre><code class="hljs language-ini" lang="ini">function reconcileSingleElement(
  returnFiber: Fiber,
  currentFirstChild: Fiber | null,
  element: ReactElement,
  lanes: Lanes,
): Fiber {
  const <span class="hljs-attr">key</span> = element.key<span class="hljs-comment">;</span>
  let <span class="hljs-attr">child</span> = currentFirstChild<span class="hljs-comment">;</span>
  /**
   * 1. 更新阶段
   * - 如果key相同且type相同, 则复用并删除其他兄弟节点
   * - 如果key相同但type不同, 则删除包括当前节点在内的所有子节点, 然后跳出循环
   * - 如果key不同, 则标记当前child为删除, 继续遍历下一个兄弟节点
   */
  while (child !== null) {
    if (<span class="hljs-attr">child.key</span> === key) {
      const <span class="hljs-attr">elementType</span> = element.type<span class="hljs-comment">;</span>
      if (<span class="hljs-attr">elementType</span> === REACT_FRAGMENT_TYPE) {
        if (<span class="hljs-attr">child.tag</span> === Fragment) {
          deleteRemainingChildren(returnFiber, child.sibling)<span class="hljs-comment">;</span>
          const <span class="hljs-attr">existing</span> = useFiber(child, element.props.children)<span class="hljs-comment">;</span>
          <span class="hljs-attr">existing.return</span> = returnFiber<span class="hljs-comment">;</span>
          return existing<span class="hljs-comment">;</span>
        }
      } else {
        if (
          <span class="hljs-attr">child.elementType</span> === elementType ||
          (__DEV__
            ? isCompatibleFamilyForHotReloading(child, element)
            : false) ||
          (typeof <span class="hljs-attr">elementType</span> === <span class="hljs-string">'object'</span> &amp;&amp;
            elementType !== null &amp;&amp;
            elementType.$$<span class="hljs-attr">typeof</span> === REACT_LAZY_TYPE &amp;&amp;
            resolveLazy(elementType) === child.type)
        ) {
          deleteRemainingChildren(returnFiber, child.sibling)<span class="hljs-comment">;</span>
          const <span class="hljs-attr">existing</span> = useFiber(child, element.props)<span class="hljs-comment">;</span>
          <span class="hljs-attr">existing.ref</span> = coerceRef(returnFiber, child, element)<span class="hljs-comment">;</span>
          <span class="hljs-attr">existing.return</span> = returnFiber<span class="hljs-comment">;</span>
          return existing<span class="hljs-comment">;</span>
        }
      }
      // key相同, 类型不同, 删除该节点和其兄弟节点
      deleteRemainingChildren(returnFiber, child)<span class="hljs-comment">;</span>
      break<span class="hljs-comment">;</span>
    } else {
      // 如果key不同, 则标记当前child为删除, 继续遍历下一个兄弟节点
      deleteChild(returnFiber, child)<span class="hljs-comment">;</span>
    }
    <span class="hljs-attr">child</span> = child.sibling<span class="hljs-comment">;</span>
  }

  /**
   * 2. 初始化阶段 ｜ 或循环中不满足复用条件, 直接创建新的Fiber节点
   */
  if (<span class="hljs-attr">element.type</span> === REACT_FRAGMENT_TYPE) { // Fragment 组件
    const <span class="hljs-attr">created</span> = createFiberFromFragment(
      element.props.children,
      returnFiber.mode,
      lanes,
      element.key,
    )<span class="hljs-comment">;</span>
    <span class="hljs-attr">created.return</span> = returnFiber<span class="hljs-comment">;</span>
    return created<span class="hljs-comment">;</span>
  } else { // 原生DOM元素、函数组件、类组件等
    const <span class="hljs-attr">created</span> = createFiberFromElement(element, returnFiber.mode, lanes)<span class="hljs-comment">;</span>
    <span class="hljs-attr">created.ref</span> = coerceRef(returnFiber, currentFirstChild, element)<span class="hljs-comment">;</span>
    <span class="hljs-attr">created.return</span> = returnFiber<span class="hljs-comment">;</span>
    return created<span class="hljs-comment">;</span>
  }
}
</code></pre>
<blockquote>
<p>总结下<code>reconcileSingleElement</code>方法的作用：负责处理单个<code>React</code>元素的更新，它的目标：</p>
<ol>
<li>在现有子节点链表中找到可以复用的节点</li>
<li>删除不需要的旧节点（打标记，<code>commit</code>阶段处理）</li>
<li>创建新的<code>Fiber</code>节点（如果没有可复用的）</li>
</ol>
</blockquote>
<h3 data-id="heading-8">处理多节点</h3>
<p><code>reconcileChildrenArray</code>函数负责协调一个数组类型的子元素列表。</p>
<ol>
<li>第一次循环：同时遍历旧的子<code>Fiber</code>节点链表和新的子元素数组，直到其中一个遍历完。<br/>
在遍历中，通过<code>updateSlot</code>函数尝试复用旧节点（<code>key</code>相同则复用，否则返回<code>null</code>）。</li>
</ol>

<ol>
<li>
<ol>
<li>如果复用失败（<code>key</code>不同），则跳出循环。</li>
<li>如果复用成功，但是位置可能发生变化，则通过<code>placeChild</code>标记位置（是否需要移动）。</li>
</ol>
</li>
</ol>

<ol start="2">
<li>如果新子元素数组遍历完（<code>newIdx === newChildren.length</code>），说明剩下的旧节点都是多余，需要删除。</li>
<li>如果旧节点链表遍历完（<code>oldFiber === null</code>），说明剩下的新子元素都是需要新增的，直接循环创建新的<code>Fiber</code>节点。</li>
<li>如果以上都不是，说明有节点位置发生变化（比如中间插入了新节点，或者节点被删除导致旧节点有剩余），此时将剩余的旧节点放入一个<code>Map</code>中（<code>key</code>作为索引，如果没有<code>key</code>则用<code>index</code>），然后继续遍历新子元素数组，从<code>Map</code>中查找可复用的节点，并标记移动。</li>
<li>最后，如果还有旧节点未被复用，则标记删除。</li>
</ol>
<pre><code class="hljs language-ini" lang="ini">function reconcileChildrenArray(
  returnFiber: Fiber,
  currentFirstChild: Fiber | null,
  newChildren: Array&lt;*&gt;,
  lanes: Lanes,
): Fiber | null {
  let resultingFirstChild: Fiber | <span class="hljs-attr">null</span> = null<span class="hljs-comment">; // 结果链表的头节点</span>
  let previousNewFiber: Fiber | <span class="hljs-attr">null</span> = null<span class="hljs-comment">;    // 上一个创建的Fiber</span>

  let <span class="hljs-attr">oldFiber</span> = currentFirstChild<span class="hljs-comment">; // 旧Fiber链表的节点, 开始指向同层的第一个节点</span>
  let <span class="hljs-attr">lastPlacedIndex</span> = <span class="hljs-number">0</span><span class="hljs-comment">;          // 已经处理完的节点中，最后一个"不需要移动"的节点在旧列表中的位置</span>
  let <span class="hljs-attr">newIdx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;                   // 新children数组的当前索引</span>
  let <span class="hljs-attr">nextOldFiber</span> = null<span class="hljs-comment">;          // 下一个要处理的旧Fiber（临时存储）</span>
  /**
   * 1. 同时遍历旧的子Fiber节点链表和新的子元素数组, 直到其中一个遍历完
   */
  for (<span class="hljs-comment">; oldFiber !== null &amp;&amp; newIdx &lt; newChildren.length; newIdx++) {</span>
    if (oldFiber.index &gt; newIdx) {
      <span class="hljs-attr">nextOldFiber</span> = oldFiber<span class="hljs-comment">;</span>
      <span class="hljs-attr">oldFiber</span> = null<span class="hljs-comment">;</span>
    } else {
      <span class="hljs-attr">nextOldFiber</span> = oldFiber.sibling<span class="hljs-comment">;</span>
    }
    // updateSlot: 尝试复用旧节点（key相同则复用，否则返回null）
    const <span class="hljs-attr">newFiber</span> = updateSlot(
      returnFiber,
      oldFiber,
      newChildren<span class="hljs-section">[newIdx]</span>,
      lanes,
    )<span class="hljs-comment">;</span>
    // 匹配失败, 不能复用
    if (<span class="hljs-attr">newFiber</span> === null) {
      if (<span class="hljs-attr">oldFiber</span> === null) {
        <span class="hljs-attr">oldFiber</span> = nextOldFiber<span class="hljs-comment">;</span>
      }
      break<span class="hljs-comment">;</span>
    }
    if (shouldTrackSideEffects) {
      if (oldFiber &amp;&amp; <span class="hljs-attr">newFiber.alternate</span> === null) {
        deleteChild(returnFiber, oldFiber)<span class="hljs-comment">;</span>
      }
    }
    <span class="hljs-attr">lastPlacedIndex</span> = placeChild(newFiber, lastPlacedIndex, newIdx)<span class="hljs-comment">;</span>
    // 
    if (<span class="hljs-attr">previousNewFiber</span> === null) {
      <span class="hljs-attr">resultingFirstChild</span> = newFiber<span class="hljs-comment">;</span>
    } else {
      <span class="hljs-attr">previousNewFiber.sibling</span> = newFiber<span class="hljs-comment">;</span>
    }
    <span class="hljs-attr">previousNewFiber</span> = newFiber<span class="hljs-comment">;</span>
    <span class="hljs-attr">oldFiber</span> = nextOldFiber<span class="hljs-comment">;</span>
  }

  /**
   * 2. 如果新子元素数组遍历完, 说明剩下的旧节点都是多余, 需要删除
   */
  if (<span class="hljs-attr">newIdx</span> === newChildren.length) {
    deleteRemainingChildren(returnFiber, oldFiber)<span class="hljs-comment">;</span>
    return resultingFirstChild<span class="hljs-comment">;</span>
  }

  /**
   * 3. 如果旧节点链表遍历完, 说明剩下的新子元素都是需要新增的, 直接循环创建
   */
  if (<span class="hljs-attr">oldFiber</span> === null) {
    for (<span class="hljs-comment">; newIdx &lt; newChildren.length; newIdx++) {</span>
      const <span class="hljs-attr">newFiber</span> = createChild(returnFiber, newChildren[newIdx], lanes)<span class="hljs-comment">;</span>
      if (<span class="hljs-attr">newFiber</span> === null) {
        continue<span class="hljs-comment">;</span>
      }
      <span class="hljs-attr">lastPlacedIndex</span> = placeChild(newFiber, lastPlacedIndex, newIdx)<span class="hljs-comment">;</span>
      if (<span class="hljs-attr">previousNewFiber</span> === null) {
        <span class="hljs-attr">resultingFirstChild</span> = newFiber<span class="hljs-comment">;</span>
      } else {
        <span class="hljs-attr">previousNewFiber.sibling</span> = newFiber<span class="hljs-comment">;</span>
      }
      <span class="hljs-attr">previousNewFiber</span> = newFiber<span class="hljs-comment">;</span>
    }
    return resultingFirstChild<span class="hljs-comment">;</span>
  }

  /**
   * 4. 如果以上都不是, 说明有节点位置发生变化, 此时将剩余的旧节点放入一个Map中,
   * 然后继续遍历新子元素数组, 从Map中查找可复用的节点, 并标记移动
   */
  const <span class="hljs-attr">existingChildren</span> = mapRemainingChildren(returnFiber, oldFiber)<span class="hljs-comment">;</span>
  for (<span class="hljs-comment">; newIdx &lt; newChildren.length; newIdx++) {</span>
    const <span class="hljs-attr">newFiber</span> = updateFromMap(
      existingChildren,
      returnFiber,
      newIdx,
      newChildren<span class="hljs-section">[newIdx]</span>,
      lanes,
    )<span class="hljs-comment">;</span>
    if (newFiber !== null) {
      if (shouldTrackSideEffects) {
        if (newFiber.alternate !== null) {
          existingChildren.delete(
            <span class="hljs-attr">newFiber.key</span> === null ? newIdx : newFiber.key,
          )<span class="hljs-comment">;</span>
        }
      }
      <span class="hljs-attr">lastPlacedIndex</span> = placeChild(newFiber, lastPlacedIndex, newIdx)<span class="hljs-comment">;</span>
      if (<span class="hljs-attr">previousNewFiber</span> === null) {
        <span class="hljs-attr">resultingFirstChild</span> = newFiber<span class="hljs-comment">;</span>
      } else {
        <span class="hljs-attr">previousNewFiber.sibling</span> = newFiber<span class="hljs-comment">;</span>
      }
      <span class="hljs-attr">previousNewFiber</span> = newFiber<span class="hljs-comment">;</span>
    }
  }

  /**
   * 5. 最后, 如果还有旧节点未被复用, 则标记删除
   */
  if (shouldTrackSideEffects) {
    existingChildren.forEach(<span class="hljs-attr">child</span> =&gt; deleteChild(returnFiber, child))<span class="hljs-comment">;</span>
  }

  return resultingFirstChild<span class="hljs-comment">;</span>
}
</code></pre>
<blockquote>
<p>总结下<code>reconcileChildrenArray</code>方法的作用：负责协调一个数组类型的子元素列表，它的设计：</p>
<p>第一阶段：顺序比较（处理相同位置节点）</p>
<p>↓</p>
<p>第二阶段：处理新增/删除边界</p>
<p>↓</p>
<p>第三阶段：<code>Map</code>查找（处理节点移动）</p>
</blockquote>
<h2 data-id="heading-9">实际案例：列表重排的DIFF过程</h2>
<p>假设有如下列表更新：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 更新前</span>
&lt;<span class="hljs-selector-tag">ul</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">A</span>"&gt;<span class="hljs-selector-tag">A</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">B</span>"&gt;<span class="hljs-selector-tag">B</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">C</span>"&gt;<span class="hljs-selector-tag">C</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">D</span>"&gt;<span class="hljs-selector-tag">D</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
&lt;/<span class="hljs-selector-tag">ul</span>&gt;

<span class="hljs-comment">// 更新后(D移动到B之前)</span>
&lt;<span class="hljs-selector-tag">ul</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">A</span>"&gt;<span class="hljs-selector-tag">A</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">D</span>"&gt;<span class="hljs-selector-tag">D</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">B</span>"&gt;<span class="hljs-selector-tag">B</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">C</span>"&gt;<span class="hljs-selector-tag">C</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
&lt;/<span class="hljs-selector-tag">ul</span>&gt;
</code></pre>
<p><code>DIFF</code>过程：</p>
<ol>
<li>第一轮遍历：比较<code>A-A</code>（复用），比较<code>B-D</code>（<code>key</code>不同，跳出第一轮）</li>
<li>建立Map：<code>{B: B_Fiber, C: C_Fiber, D: D_Fiber}</code></li>
<li>第二轮遍历：</li>
</ol>
<ul>
<li>
<ul>
<li>处理<code>D</code>：从<code>Map</code>中找到<code>D_Fiber</code>，<code>lastPlacedIndex=0</code>，<code>oldIndex=3&gt;0</code>，不需要移动</li>
<li>处理<code>B</code>：从<code>Map</code>中找到<code>B_Fiber</code>，<code>lastPlacedIndex=3</code>，<code>oldIndex=1&lt;3</code>，需要移动</li>
<li>处理<code>C</code>：从<code>Map</code>中找到<code>C_Fiber</code>，<code>lastPlacedIndex=3</code>，<code>oldIndex=2&lt;3</code>，需要移动</li>
</ul>
</li>
</ul>
<ol start="4">
<li>结果：<code>D</code>保持原位，<code>B</code>和<code>C</code>向后移动</li>
</ol>
<h2 data-id="heading-10">总结</h2>
<p><code>React</code>的<code>DIFF</code>算法是一个经过精心设计和不断优化的复杂系统。从<code>React16</code>的<code>Fiber</code>架构到<code>React18</code>的并发特性，<code>DIFF</code>算法始终围绕着以下核心目标：</p>
<ol>
<li><strong>高效性</strong>：通过<code>O(n)</code>复杂度的算法快速找出差异</li>
<li><strong>稳定性</strong>：确保在可中断渲染中<code>UI</code>的一致性</li>
<li><strong>可预测性</strong>：开发者可以通过<code>key</code>等手段控制更新行为</li>
<li><strong>渐进增强</strong>：支持并发渲染，提高应用响应速度</li>
</ol>
<p>下一章我们将了解真实<code>DOM</code>的变更：<code>commit</code>阶段</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建产物优化：如何让包体积减少 60%？]]></title>    <link>https://juejin.cn/post/7598563188113031220</link>    <guid>https://juejin.cn/post/7598563188113031220</guid>    <pubDate>2026-01-26T01:48:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598563188113031220" data-draft-id="7598699872540344339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建产物优化：如何让包体积减少 60%？"/> <meta itemprop="keywords" content="前端,前端工程化"/> <meta itemprop="datePublished" content="2026-01-26T01:48:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端小小栈"/> <meta itemprop="url" content="https://juejin.cn/user/1081575170131006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建产物优化：如何让包体积减少 60%？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1081575170131006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端小小栈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:48:48.000Z" title="Mon Jan 26 2026 01:48:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端工程化的链路中，如果说 CI/CD 是传送带，那么**构建产物（Bundle）**就是最终交付给用户的“货物”。对于一个拥有 8 年经验的开发者来说，优化体积不只是为了“好看”，更是为了减少 HTTP 传输损耗、降低浏览器解析耗时（Parse Cost），从而直接提升业务转化率。</p>
<p>本篇我们将深入构建引擎底层，实战拆解如何通过“外科手术级”的手段，将包体积硬生生砍掉 60%。</p>
<hr/>
<h2 data-id="heading-0">一、 瘦身第一步：依赖的“大扫除”</h2>
<p>很多时候，包体积臃肿是因为我们引入了“核武器”却只用来“切菜”。</p>
<h3 data-id="heading-1">1. 彻底清算“巨无霸”库</h3>
<ul>
<li>
<p><strong>Moment.js -&gt; dayjs：</strong> Moment 包含大量语言包且体积巨大。换成 API 几乎一致的 <code>dayjs</code>，体积直接从 200KB+ 降至 2KB。</p>
</li>
<li>
<p><strong>Lodash 的正确姿势：</strong> 拒绝 <code>import _ from 'lodash'</code>。</p>
<ul>
<li><strong>方案 A：</strong> 使用 <code>import get from 'lodash/get'</code>。</li>
<li><strong>方案 B：</strong> 配置 <code>babel-plugin-lodash</code> 自动按需引入。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">2. 揭秘 Tree Shaking 的“失效”真相</h3>
<p>为什么明明用了 ESM，有些代码还是删不掉？</p>
<ul>
<li><strong>Side Effects（副作用）：</strong> 只要模块顶层有全局赋值或修改原型链的行为，编译器就不敢删它。</li>
<li><strong>实战：</strong> 在 <code>package.json</code> 中明确声明 <code>"sideEffects": false</code>（或指定特定文件），这是开启极致压缩的通行证。</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、 进阶：分而治之（Code Splitting）</h2>
<p>把一个 2MB 的主包拆成十个 200KB 的小包，利用浏览器的<strong>并发下载</strong>和<strong>持久化缓存</strong>，用户体感速度会快得多。</p>
<h3 data-id="heading-4">1. 路由级懒加载（Dynamic Import）</h3>
<p>在现代框架中，这是标配。</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">AdminDash</span> = () =&gt; import(<span class="hljs-string">'./views/AdminDash.vue'</span>)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-5">2. 策略化拆包：SplitChunks</h3>
<p>不要指望构建工具的默认配置。在 Webpack 或 Vite (Rollup) 中手动划分缓存组：</p>
<ul>
<li><strong>Runtime Chunk：</strong> 提取引导代码（Manifest），防止业务代码变动导致 Hash 变化。</li>
<li><strong>Vendor Chunk：</strong> 将 <code>vue/react</code> 等极少变动的框架代码独立打包。</li>
<li><strong>Commons Chunk：</strong> 提取被多个页面同时引用的公共组件。</li>
</ul>
<hr/>
<h2 data-id="heading-6">三、 底层黑科技：现代语法与压缩</h2>
<h3 data-id="heading-7">1. 目标浏览器：Browserslist</h3>
<p>如果你还在为 IE11 打包，那么你的产物里会充斥着大量的 Polyfill（补丁代码）。</p>
<ul>
<li><strong>配置：</strong> 修改 <code>.browserslistrc</code>，放弃过时的浏览器。</li>
<li><strong>结果：</strong> 移除大量的 <code>core-js</code> 注入，产物直接缩水 20%-30%。</li>
</ul>
<h3 data-id="heading-8">2. 压缩引擎的更迭：从 Terser 到 ESBuild/SWC</h3>
<ul>
<li>在生产环境使用 <strong>ESBuild</strong> 或 <strong>Terser (Parallel mode)</strong> 进行极致压缩。</li>
<li>开启 <code>drop_console: true</code>，自动剔除所有 <code>console.log</code> 指令。</li>
</ul>
<hr/>
<h2 data-id="heading-9">四、 终极杀招：从资源本身下手</h2>
<h3 data-id="heading-10">1. 图片的“降维打击”</h3>
<p>图片通常占包体积的大头，但它们不该在 JS 包里。</p>
<ul>
<li><strong>WebP 转换：</strong> 利用 <code>image-minimizer-webpack-plugin</code> 自动将图片转为 WebP 格式。</li>
<li><strong>小图内联：</strong> 设置 <code>data-uri</code> 阈值（如 4KB），减少小图片的 HTTP 请求数。</li>
</ul>
<h3 data-id="heading-11">2. 开启 Gzip / Brotli（全栈必会）</h3>
<p>这是工程化与运维的配合：</p>
<ul>
<li>在构建阶段生成 <code>.gz</code> 或 <code>.br</code> 文件。</li>
<li>配置 Nginx 开启 <code>gzip_static on;</code>。Brotli 的压缩率通常比 Gzip 还要高出 15%-20%。</li>
</ul>
<hr/>
<h2 data-id="heading-12">💡 给前端开发者的硬核贴士</h2>
<ul>
<li><strong>可视化是优化的前提：</strong> 永远先跑一遍 <code>webpack-bundle-analyzer</code> 或 <code>rollup-plugin-visualizer</code>。<strong>你看不见的 Bug 没法修，你看不见的体积没法减。</strong></li>
<li><strong>警惕第三方 SDK：</strong> 很多统计、地图、在线客服的 SDK 及其庞大，尽量通过 CDN 异步加载，不要打包进主包。</li>
</ul>
<hr/>
<h3 data-id="heading-13">结语</h3>
<p>产物优化不是一次性的工作，而是一个持续的观测过程。通过依赖精简、智能拆包、现代标准和高效压缩，包体积减少 60% 并不是神话，而是工程化能力的自然体现。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[低代码与脚手架：打造自研的 CLI 工具]]></title>    <link>https://juejin.cn/post/7598710324168179727</link>    <guid>https://juejin.cn/post/7598710324168179727</guid>    <pubDate>2026-01-26T01:49:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598710324168179727" data-draft-id="7598435950410874890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="低代码与脚手架：打造自研的 CLI 工具"/> <meta itemprop="keywords" content="前端,前端工程化"/> <meta itemprop="datePublished" content="2026-01-26T01:49:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端小小栈"/> <meta itemprop="url" content="https://juejin.cn/user/1081575170131006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            低代码与脚手架：打造自研的 CLI 工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1081575170131006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端小小栈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:49:39.000Z" title="Mon Jan 26 2026 01:49:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>对于 8 年经验的资深开发者来说， <strong>“懒”是最高级的赞美</strong>。如果你发现自己在一个月内重复配置了三次同样的 Lint 规则、复制了五次同样的目录结构，那么你就该意识到：<strong>你的生产力正在被这种低效的“搬运”吞噬。</strong></p>
<p>在前端工程化体系中，<strong>CLI（命令行界面）工具</strong>是封装团队最佳实践、实现“一键基建”的核心武器。</p>
<hr/>
<h2 data-id="heading-0">一、 为什么我们要“自研” CLI？</h2>
<p>市面上已经有 <code>create-react-app</code> 或 <code>vue-cli</code>，为什么还要自研？</p>
<ol>
<li><strong>业务强绑定：</strong> 官方工具是普适的，但自研工具可以内置公司私有的组件库、埋点 SDK、SSO 登录逻辑和 CI/CD 模版。</li>
<li><strong>技术栈收敛：</strong> 强制团队统一使用 pnpm、特定版本的 TypeScript 或 Tailwind CSS，减少维护成本。</li>
<li><strong>流程自动化：</strong> 除了拉取模板，CLI 还可以集成自动创建 Git 仓库、自动分配权限、自动生成 API 代码等功能。</li>
</ol>
<hr/>
<h2 data-id="heading-1">二、 CLI 工具的“权力清单”：核心技术选型</h2>
<p>要写一个专业的 CLI，你需要这套成熟的 Node.js 工具链：</p>
<ul>
<li><strong><code>commander</code> / <code>yargs</code>：</strong> 命令参数解析（如 <code>my-cli create &lt;name&gt;</code>）。</li>
<li><strong><code>inquirer</code> / <code>prompts</code>：</strong> 命令行交互，让用户做选择题或填空题。</li>
<li><strong><code>chalk</code> / <code>picocolors</code>：</strong> 让你的终端输出变得五颜六色（成功是绿的，报错是红的）。</li>
<li><strong><code>ora</code>：</strong> 终端加载动画（Spinner），让等待过程不焦虑。</li>
<li><strong><code>execa</code>：</strong> 增强版的 <code>child_process</code>，用于执行 git clone 或 pnpm install。</li>
<li><strong><code>download-git-repo</code>：</strong> 远程下载 GitHub/GitLab 上的模版仓库。</li>
</ul>
<hr/>
<h2 data-id="heading-2">三、 实战：三步打造一个项目脚手架</h2>
<h3 data-id="heading-3">第一步：命令定义</h3>
<p>在 <code>bin/index.js</code> 中定义入口，利用 <code>commander</code> 监听 <code>create</code> 命令。</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
<span class="hljs-keyword">const</span> { program } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'commander'</span>);

program
  .<span class="hljs-title function_">command</span>(<span class="hljs-string">'create &lt;project-name&gt;'</span>)
  .<span class="hljs-title function_">description</span>(<span class="hljs-string">'创建一个新的项目模板'</span>)
  .<span class="hljs-title function_">action</span>(<span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> {
    <span class="hljs-comment">// 逻辑代码</span>
  });

program.<span class="hljs-title function_">parse</span>(process.<span class="hljs-property">argv</span>);
</code></pre>
<h3 data-id="heading-4">第二步：交互问询</h3>
<p>询问用户需要什么功能，比如是否需要 Pinia、是否需要 E2E 测试。</p>
<p>JavaScript</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">const</span> questions = [
  {
    <span class="hljs-keyword">type</span>: <span class="hljs-string">'list'</span>,
    name: <span class="hljs-string">'template'</span>,
    message: <span class="hljs-string">'请选择项目模板'</span>,
    choices: [<span class="hljs-string">'Vue3-Vite-Starter'</span>, <span class="hljs-string">'React-Next-Admin'</span>],
  },
  {
    <span class="hljs-keyword">type</span>: <span class="hljs-string">'confirm'</span>,
    name: <span class="hljs-string">'install'</span>,
    message: <span class="hljs-string">'是否自动安装依赖？'</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-literal">true</span>,
  }
];
</code></pre>
<h3 data-id="heading-5">第三步：模版拉取与动态渲染</h3>
<ul>
<li><strong>静态模式：</strong> 直接从 GitLab 仓库 <code>git clone</code> 对应的分支。</li>
<li><strong>动态模式（更高级）：</strong> 使用 <code>handlebars</code> 模板引擎，根据用户刚才的选择，动态修改 <code>package.json</code> 中的字段（如项目名称、作者、依赖项）。</li>
</ul>
<hr/>
<h2 data-id="heading-6">四、 进阶：从脚手架到低代码（Low-Code）</h2>
<p>如果 CLI 解决的是“从 0 到 1”的基建问题，那么<strong>低代码/弱代码</strong>解决的就是“从 1 到 N”的效率问题。</p>
<ol>
<li><strong>Schema 驱动代码生成：</strong> 编写一个脚本，读取 Swagger/OpenAPI 的 JSON 结构，自动生成 TypeScript 类型定义和 API 请求函数。</li>
<li><strong>区块（Block）复用：</strong> 类似 Ant Design Pro，通过 CLI 一键插入一个“登录页面区块”或“表格筛选区块”，而不是手动复制粘贴代码。</li>
<li><strong>内联脚本（In-place Scripts）：</strong> 比如开发一个 <code>my-cli add-page &lt;name&gt;</code> 命令，它能自动在 <code>src/views</code> 创建文件，并顺便在 <code>router.js</code> 里插好路由配置。</li>
</ol>
<hr/>
<h2 data-id="heading-7">💡 给前端开发者的硬核贴士</h2>
<ul>
<li><strong>版本管理：</strong> CLI 自身也要记得做版本检查（比如检测到旧版本时提示 <code>npm update -g my-cli</code>），否则会导致团队成员用的模版版本不统一。</li>
<li><strong>本地开发调试：</strong> 在 CLI 项目目录下执行 <code>npm link</code>（或 <code>pnpm link --global</code>），这样你就可以在全局直接使用你正在开发的命令了。</li>
<li><strong>别忘了 <code>chmod +x</code>：</strong> 确保你的入口脚本有执行权限，并且顶部带有 <code>#!/usr/bin/env node</code>。</li>
</ul>
<hr/>
<h3 data-id="heading-8">结语</h3>
<p>自研 CLI 是前端工程师从“使用者”向“建设者”转变的标志。它沉淀了你的技术深度，也将你从繁琐的配置中彻底解脱。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[raychart 基于 Vue 的 3D 图表可视化实践：移动端优先从交互到性能的一次系统升级 🚀]]></title>    <link>https://juejin.cn/post/7598734303174869044</link>    <guid>https://juejin.cn/post/7598734303174869044</guid>    <pubDate>2026-01-26T01:50:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303174869044" data-draft-id="7598734303174819892" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="raychart 基于 Vue 的 3D 图表可视化实践：移动端优先从交互到性能的一次系统升级 🚀"/> <meta itemprop="keywords" content="前端,数据可视化,Vue.js"/> <meta itemprop="datePublished" content="2026-01-26T01:50:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一颗烂土豆"/> <meta itemprop="url" content="https://juejin.cn/user/764915822371912"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            raychart 基于 Vue 的 3D 图表可视化实践：移动端优先从交互到性能的一次系统升级 🚀
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/764915822371912/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一颗烂土豆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:50:48.000Z" title="Mon Jan 26 2026 01:50:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">raychart 基于 Vue 的 3D 图表可视化实践：移动端优先从交互到性能的一次系统升级 🚀</h2>
<p>先说结论：做 3D 图表可视化编辑器时，移动端优先并不是“迁就小屏”，而是帮你把复杂度收敛到正确的地方。3D 图表的信息密度高、交互多、渲染重，如果按桌面端思维直接堆功能，结果通常是功能齐全但体验割裂。我们在 raychart 的 Vue 技术栈里把编辑器先打磨成“手机也能顺畅使用”的体验，再向桌面扩展，最终移动端更好用、桌面端也更清晰。</p>
<h3 data-id="heading-1">为什么 3D 图表可视化更需要移动端优先 📱</h3>
<p>移动端限制不是坏事，而是设计的天然约束。小屏幕会迫使你重新定义“最重要的交互路径”，也会倒逼你把功能收敛成清晰的层级结构。对基于 Vue 的 3D 图表可视化来说，这正是体验提升的关键。</p>
<ul>
<li>交互路径更短：移动端需要“少步骤完成关键任务”</li>
<li>信息层级更清晰：控制项必须分组、折叠、聚焦</li>
<li>性能更稳：移动端的硬件限制驱动我们优化默认值</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fchart3js.netlify.app%2F%23%2F" target="_blank" title="https://chart3js.netlify.app/#/" ref="nofollow noopener noreferrer">RayChart 预览地址:  https://chart3js.netlify.app/#/</a>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a90f667a248a40d9bc6aea593461dadb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769998322&amp;x-signature=TlQ6bVdzJpaPsut%2B50X7zT2Mjy0%3D" alt="ScreenShot_2026-01-26_092915_641.png" loading="lazy"/></p>
<h3 data-id="heading-2">项目中如何落地：从控制模块的边界开始 🧩</h3>
<p>我们把图表设置拆分为多个独立控制模块，每个模块只负责一个清晰的任务边界，例如：</p>
<ul>
<li>数据控制：输入与编辑数据点 🧮</li>
<li>坐标控制：管理坐标系与维度映射 🧭</li>
<li>光照控制：灯光类型、强度与阴影 💡</li>
<li>主题控制：配色方案和默认颜色 🎨</li>
</ul>
<p>这种结构直接服务移动端优先的目标：把复杂系统拆成可理解的小块，让用户在小屏幕上也能顺畅完成配置。桌面端只是展示空间更大，但交互路径依然保持简洁。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c978e947808345d8a2f68099e1aac78b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769998322&amp;x-signature=1G%2FGpMvLKFGSo39qtKJTITDtGQ4%3D" alt="ScreenShot_2026-01-26_092942_569.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58ec649f094a45f79f6d98707ccaad73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769998322&amp;x-signature=n%2BbYFXgItK8Jc%2FWUArmb4FWCqaE%3D" alt="ScreenShot_2026-01-26_092954_321.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8177ad2fd614861ad4d6b501da50395~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769998322&amp;x-signature=mjGspFsDUgyZgZFcNFn3hd8niyU%3D" alt="ScreenShot_2026-01-26_092925_249.png" loading="lazy"/></p>
<h3 data-id="heading-3">移动端优先带来的三类收益 ✅</h3>
<h4 data-id="heading-4">1. 交互体验更“可预期” 🤝</h4>
<p>移动端用户通常只关心最核心的操作：切换图表、调参数、预览效果。我们把这些动作放在最短路径上，次要配置收进折叠区域。结果是桌面端也同样清爽，用户更快找到关键设置。</p>
<h4 data-id="heading-5">2. 设计一致性更强 🧱</h4>
<p>为了适配小屏幕，我们统一了组件大小、间距、配色和状态样式，形成稳定的一致性。这种一致性一旦建立，桌面端也同步获得更可靠的视觉体验。</p>
<h4 data-id="heading-6">3. 性能优化更有效 ⚡</h4>
<p>3D 图表可视化的性能瓶颈多在光照、阴影、材质等环节。移动端优先的限制迫使我们设置更合理的默认值，例如：</p>
<ul>
<li>默认灯光数量更克制</li>
<li>阴影为可选项而非强制项</li>
<li>材质细节更收敛</li>
</ul>
<p>这些优化也让桌面端获得更稳定的帧率和更低的功耗。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89ee2863b2c44125b6235252828716ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769998322&amp;x-signature=Yb6vXnthiDBGQE%2BYEsvmjn0f%2FSA%3D" alt="ScreenShot_2026-01-26_094809_782.png" loading="lazy"/></p>
<h3 data-id="heading-7">总结：移动端优先不是妥协，而是效率策略 🎯</h3>
<p>移动端优先的价值不在于“做个能在手机上跑的版本”，而在于用它作为一种强约束，让系统更简单、更清晰、更高效。对 3D 图表这种复杂交互场景来说，它可以帮助我们：</p>
<ul>
<li>快速收敛需求边界</li>
<li>建立明确的控制层级</li>
<li>统一 UI 的风格与节奏</li>
<li>同时提升移动端与桌面端体验</li>
</ul>
<p>如果你也在做 3D 图表、Vue 可视化编辑器或复杂配置系统，建议试着从移动端出发设计一次，你会更快发现真正有价值的交互路径。</p>
<h3 data-id="heading-8">关键词 🔎</h3>
<p>3D 图表、3D 可视化、Vue、Vue3、前端可视化、图表编辑器、移动端优先、交互设计、性能优化</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一次吃透「移除元素」：双指针的最朴素、也最重要的形态]]></title>    <link>https://juejin.cn/post/7598807837868916762</link>    <guid>https://juejin.cn/post/7598807837868916762</guid>    <pubDate>2026-01-26T02:15:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598807837868916762" data-draft-id="7596845113281331209" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一次吃透「移除元素」：双指针的最朴素、也最重要的形态"/> <meta itemprop="keywords" content="LeetCode,算法"/> <meta itemprop="datePublished" content="2026-01-26T02:15:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="YukiMori23"/> <meta itemprop="url" content="https://juejin.cn/user/4022441007125707"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一次吃透「移除元素」：双指针的最朴素、也最重要的形态
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4022441007125707/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    YukiMori23
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:15:15.000Z" title="Mon Jan 26 2026 02:15:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>LeetCode 27｜简单<br/>
核心思想：快慢指针（双指针）<br/>
关键词：原地修改、覆盖、不关心顺序</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、题目回顾</h2>
<p>给你一个数组 <code>nums</code> 和一个值 <code>val</code>，你需要 <strong>原地移除所有等于 <code>val</code> 的元素</strong>，并返回移除后数组的新长度。</p>
<p>要求：</p>
<ul>
<li>不使用额外数组</li>
<li>不关心新数组后面的内容</li>
<li>返回的是“有效元素的长度”</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">nums</span> = [<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], val = <span class="hljs-number">3</span>
返回 2
nums 前 2 个元素为 <span class="hljs-section">[2,2]</span>
</code></pre>
<hr/>
<h2 data-id="heading-1">二、这道题最容易踩的坑</h2>
<p>很多人一开始会纠结：</p>
<ul>
<li>“删元素后数组怎么变？”</li>
<li>“是不是要真的把数组缩短？”</li>
<li>“后面的值要不要清空？”</li>
</ul>
<p>但题目其实已经偷偷告诉你答案了：</p>
<blockquote>
<p><strong>你只需要保证前 k 个元素是正确的，后面是什么不重要。</strong></p>
</blockquote>
<p>这一点非常关键。</p>
<hr/>
<h2 data-id="heading-2">三、核心思路：双指针在“做什么”？</h2>
<p>我们用两个指针：</p>
<ul>
<li><code>right</code>：扫描整个数组（读）</li>
<li><code>left</code>：指向下一个“应该被保留下来的位置”（写）</li>
</ul>
<p>它们的分工非常明确：</p>
<blockquote>
<p><strong>right 负责看每一个元素，left 只在“遇到合法元素”时前进。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-3">四、代码实现（Java）</h2>
<pre><code class="hljs language-ini" lang="ini">class Solution {
    public int removeElement(int<span class="hljs-section">[]</span> nums, int val) {
        int <span class="hljs-attr">n</span> = nums.length<span class="hljs-comment">;</span>
        int <span class="hljs-attr">left</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>

        for (int <span class="hljs-attr">right</span> = <span class="hljs-number">0</span><span class="hljs-comment">; right &lt; n; right++) {</span>
            if (nums<span class="hljs-section">[right]</span> != val) {
                nums<span class="hljs-section">[left]</span> = nums<span class="hljs-section">[right]</span><span class="hljs-comment">;</span>
                left++<span class="hljs-comment">;</span>
            }
        }

        return left<span class="hljs-comment">;</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-4">五、逐行拆解这段代码的“真实含义”</h2>
<h3 data-id="heading-5">1. <code>left</code> 指针的意义</h3>
<pre><code class="hljs language-ini" lang="ini">int <span class="hljs-attr">left</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
</code></pre>
<p><code>left</code> 永远指向：</p>
<blockquote>
<p><strong>下一个可以放“有效元素”的位置</strong></p>
</blockquote>
<p>它不是在找 val，也不是在删除元素，而是在“维护结果数组的长度”。</p>
<hr/>
<h3 data-id="heading-6">2. <code>right</code> 指针在干嘛？</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-keyword">right</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-keyword">right</span> <span class="hljs-operator">&lt;</span> n; <span class="hljs-keyword">right</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>) {
</code></pre>
<p><code>right</code> 是一个<strong>纯扫描指针</strong>：</p>
<ul>
<li>从头到尾看一遍数组</li>
<li>不回头、不跳跃</li>
<li>保证每个元素只看一次</li>
</ul>
<hr/>
<h3 data-id="heading-7">3. 为什么只在 <code>!= val</code> 时才赋值？</h3>
<pre><code class="hljs language-ini" lang="ini">if (nums<span class="hljs-section">[right]</span> != val) {
    nums<span class="hljs-section">[left]</span> = nums<span class="hljs-section">[right]</span><span class="hljs-comment">;</span>
    left++<span class="hljs-comment">;</span>
}
</code></pre>
<p>这一步非常精髓：</p>
<ul>
<li>
<p>如果当前元素是 <code>val</code></p>
<ul>
<li>直接跳过，相当于“删掉”</li>
</ul>
</li>
<li>
<p>如果不是 <code>val</code></p>
<ul>
<li>把它覆盖写到 <code>left</code> 的位置</li>
<li><code>left</code> 前进，表示有效长度 +1</li>
</ul>
</li>
</ul>
<p><strong>注意：这是“覆盖”，不是交换。</strong></p>
<hr/>
<h2 data-id="heading-8">六、用一个具体例子走一遍</h2>
<p>输入：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">nums</span> = [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>]
<span class="hljs-attr">val</span> = <span class="hljs-number">2</span>
</code></pre>
<p>执行过程：</p>




































































<table><thead><tr><th>right</th><th>nums[right]</th><th>是否保留</th><th>left</th><th>nums 前部</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>是</td><td>1</td><td>[0]</td></tr><tr><td>1</td><td>1</td><td>是</td><td>2</td><td>[0,1]</td></tr><tr><td>2</td><td>2</td><td>否</td><td>2</td><td>[0,1]</td></tr><tr><td>3</td><td>2</td><td>否</td><td>2</td><td>[0,1]</td></tr><tr><td>4</td><td>3</td><td>是</td><td>3</td><td>[0,1,3]</td></tr><tr><td>5</td><td>0</td><td>是</td><td>4</td><td>[0,1,3,0]</td></tr><tr><td>6</td><td>4</td><td>是</td><td>5</td><td>[0,1,3,0,4]</td></tr><tr><td>7</td><td>2</td><td>否</td><td>5</td><td>[0,1,3,0,4]</td></tr></tbody></table>
<p>最终返回 <code>left = 5</code>。</p>
<hr/>
<h2 data-id="heading-9">七、为什么这道题不需要交换？</h2>
<p>有些双指针题会用“左右交换”，但这里不需要，原因是：</p>
<ul>
<li>题目不要求保留原有顺序之外的任何信息</li>
<li>我们只关心“哪些值留下”</li>
<li>覆盖写入比交换更简单、更稳定</li>
</ul>
<p>这类写法也被称为：</p>
<blockquote>
<p><strong>慢指针构造结果，快指针遍历输入</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-10">八、时间与空间复杂度</h2>
<ul>
<li>
<p>时间复杂度：<code>O(n)</code></p>
<ul>
<li>每个元素只看一次</li>
</ul>
</li>
<li>
<p>空间复杂度：<code>O(1)</code></p>
<ul>
<li>原地修改，没有额外数组</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-11">九、这道题在整个双指针体系里的位置</h2>
<p>这是<strong>最基础、最干净</strong>的双指针模型：</p>
<ul>
<li>没有排序</li>
<li>没有边界博弈</li>
<li>没有复杂条件</li>
</ul>
<p>但它是下面这些题的“地基”：</p>
<ul>
<li>移除重复元素</li>
<li>移动零</li>
<li>有效数组长度类问题</li>
<li>原地过滤问题</li>
</ul>
<p>一句话总结它的思想：</p>
<blockquote>
<p><strong>用一个指针遍历世界，用另一个指针构造答案。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-12">十、最后的小总结</h2>
<p>这道题的难点不在代码，而在观念转变：</p>
<ul>
<li>不要执着于“删除”</li>
<li>把问题转化为“保留什么”</li>
<li>用指针去描述“状态变化”</li>
</ul>
<p>当你真正理解了这道题，<br/>
后面很多数组题都会突然变得顺眼。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[移动端 Web 开发学习笔记：从视口到流式布局，一篇带你真正入门]]></title>    <link>https://juejin.cn/post/7599268297202761766</link>    <guid>https://juejin.cn/post/7599268297202761766</guid>    <pubDate>2026-01-26T02:16:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297202761766" data-draft-id="7598499504170369062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="移动端 Web 开发学习笔记：从视口到流式布局，一篇带你真正入门"/> <meta itemprop="keywords" content="CSS,HTML"/> <meta itemprop="datePublished" content="2026-01-26T02:16:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="YukiMori23"/> <meta itemprop="url" content="https://juejin.cn/user/4022441007125707"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            移动端 Web 开发学习笔记：从视口到流式布局，一篇带你真正入门
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4022441007125707/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    YukiMori23
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:16:22.000Z" title="Mon Jan 26 2026 02:16:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在开始移动端 Web 开发之前，我一直以为「移动端就是把 PC 页面缩小」。<br/>
真正系统学完一轮之后才发现，<strong>视口、像素比、二倍图、布局方案</strong>，每一个点都决定了页面体验的好坏。</p>
<p>这篇文章是我在学习 <strong>移动端 Web 开发（流式布局方向）</strong> 时的完整总结，适合刚从 PC 端转向移动端，或者对移动端概念比较模糊的同学。</p>
<hr/>
<h2 data-id="heading-0">一、移动端开发的现状与特点</h2>
<h3 data-id="heading-1">1. 移动端浏览器现状</h3>
<p>移动端常见浏览器包括：</p>
<ul>
<li>UC 浏览器</li>
<li>QQ 浏览器</li>
<li>百度手机浏览器</li>
<li>Safari（iOS）</li>
<li>Chrome（Android）</li>
</ul>
<p>一个非常重要的事实是：</p>
<p><strong>国内主流移动端浏览器，基本都基于 WebKit 内核。</strong></p>
<p>这意味着：</p>
<ul>
<li>H5 + CSS3 可以放心使用</li>
<li>私有前缀重点关注 <code>-webkit-</code></li>
<li>不需要像 PC 时代那样被 IE 折磨</li>
</ul>
<hr/>
<h3 data-id="heading-2">2. 屏幕碎片化问题</h3>
<p>移动设备的分辨率极其碎片化，例如：</p>
<ul>
<li>Android：720×1280、1080×1920、2K、4K</li>
<li>iPhone：750×1334、1242×2208 等</li>
</ul>
<p>但作为前端开发者：</p>
<p><strong>不需要纠结 dp、dpi、ppi 等概念</strong><br/>
我们关心的是：<br/>
CSS 像素如何映射到设备屏幕。</p>
<hr/>
<h2 data-id="heading-3">二、视口（Viewport）是移动端的第一道门槛</h2>
<p>很多移动端布局问题，根源都在 <strong>视口没理解清楚</strong>。</p>
<h3 data-id="heading-4">1. 三种视口的区别</h3>
<h4 data-id="heading-5">1）布局视口（Layout Viewport）</h4>
<ul>
<li>浏览器默认的布局宽度</li>
<li>大多数移动端默认是 <strong>980px</strong></li>
<li>用来兼容早期 PC 页面</li>
</ul>
<p>这也是为什么 <strong>不加 viewport 标签时，页面会整体缩小</strong>。</p>
<hr/>
<h4 data-id="heading-6">2）视觉视口（Visual Viewport）</h4>
<ul>
<li>用户当前看到的区域</li>
<li>可以通过手指缩放改变</li>
<li>不影响布局视口</li>
</ul>
<hr/>
<h4 data-id="heading-7">3）理想视口（Ideal Viewport）</h4>
<ul>
<li>设备最理想的展示宽度</li>
<li>设备有多宽，布局就有多宽</li>
<li>移动端开发真正想要的视口</li>
</ul>
<hr/>
<h3 data-id="heading-8">2. 标准 viewport 写法（必须掌握）</h3>
<pre><code class="hljs language-ini" lang="ini">&lt;meta 
  <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> 
  <span class="hljs-attr">content</span>=<span class="hljs-string">"
    width=device-width,
    initial-scale=1.0,
    maximum-scale=1.0,
    minimum-scale=1.0,
    user-scalable=no
  "</span>
&gt;
</code></pre>
<p>这段代码的作用是：</p>
<ul>
<li>布局视口等于设备宽度</li>
<li>默认不缩放</li>
<li>禁止用户手动缩放</li>
</ul>
<p>这是<strong>移动端页面的标配</strong>。</p>
<hr/>
<h2 data-id="heading-9">三、二倍图与像素比：为什么图片会模糊</h2>
<h3 data-id="heading-10">1. 物理像素 vs CSS 像素</h3>
<p>在 Retina 屏幕下：</p>
<ul>
<li>1 个 CSS 像素 ≠ 1 个物理像素</li>
<li>iPhone 常见的是 <strong>2 倍、3 倍像素比</strong></li>
</ul>
<p>例如：</p>
<ul>
<li>页面上显示 50×50</li>
<li>实际需要 100×100 或 150×150 的图片资源</li>
</ul>
<hr/>
<h3 data-id="heading-11">2. 二倍图的解决方案</h3>
<p>图片本身使用更大的尺寸，但在 CSS 中压缩显示。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">img</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
}
</code></pre>
<p>如果原图是 100×100，就能在 Retina 屏上保持清晰。</p>
<hr/>
<h3 data-id="heading-12">3. 背景图的处理方式</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">bg@2x.png</span>);
  <span class="hljs-attribute">background-size</span>: <span class="hljs-number">50px</span> <span class="hljs-number">50px</span>;
}
</code></pre>
<p>关键点在于：</p>
<ul>
<li>图片是二倍图</li>
<li><code>background-size</code> 写成设计稿尺寸</li>
</ul>
<hr/>
<h2 data-id="heading-13">四、移动端开发方案选择</h2>
<h3 data-id="heading-14">1. 两种主流方案</h3>
<h4 data-id="heading-15">方案一：单独制作移动端页面（主流）</h4>
<ul>
<li>m.jd.com</li>
<li>m.taobao.com</li>
</ul>
<p>特点：</p>
<ul>
<li>专门为手机设计</li>
<li>性能和体验最好</li>
<li>维护成本较高</li>
</ul>
<hr/>
<h4 data-id="heading-16">方案二：响应式页面</h4>
<ul>
<li>同一套 HTML</li>
<li>通过媒体查询适配不同设备</li>
</ul>
<p>缺点很明显：</p>
<ul>
<li>样式复杂</li>
<li>维护成本高</li>
<li>移动端体验一般</li>
</ul>
<p><strong>实际项目中，大厂基本都选择第一种方案。</strong></p>
<hr/>
<h2 data-id="heading-17">五、移动端技术解决方案汇总</h2>
<h3 data-id="heading-18">1. CSS 初始化推荐 normalize.css</h3>
<p>相比 reset.css，normalize.css 的优点是：</p>
<ul>
<li>保留有价值的默认样式</li>
<li>修复浏览器差异</li>
<li>模块化、文档完善</li>
</ul>
<hr/>
<h3 data-id="heading-19">2. CSS3 盒子模型（移动端强烈推荐）</h3>
<pre><code class="hljs language-css" lang="css">* {
  <span class="hljs-attribute">box-sizing</span>: border-box;
}
</code></pre>
<p>优点：</p>
<ul>
<li>padding、border 不会撑大盒子</li>
<li>布局更直观</li>
<li>非常适合移动端</li>
</ul>
<hr/>
<h3 data-id="heading-20">3. 移动端常见特殊样式</h3>
<pre><code class="hljs language-css" lang="css">* {
  -webkit-tap-highlight-<span class="hljs-attribute">color</span>: transparent;
}

<span class="hljs-selector-tag">input</span>,
<span class="hljs-selector-tag">button</span> {
  -webkit-appearance: none;
}

<span class="hljs-selector-tag">img</span>,
<span class="hljs-selector-tag">a</span> {
  -webkit-touch-callout: none;
}
</code></pre>
<p>这些样式可以：</p>
<ul>
<li>去掉点击高亮</li>
<li>统一表单样式</li>
<li>禁止长按弹出菜单</li>
</ul>
<hr/>
<h2 data-id="heading-21">六、移动端常见布局方式</h2>
<h3 data-id="heading-22">1. 流式布局（百分比布局）</h3>
<p>流式布局的核心思想：</p>
<ul>
<li>宽度使用百分比</li>
<li>随屏幕变化自适应</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
}

<span class="hljs-selector-class">.item</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50%</span>;
}
</code></pre>
<hr/>
<h3 data-id="heading-23">2. 限制最大最小宽度（常用技巧）</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">320px</span>;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">640px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
}
</code></pre>
<p>好处是：</p>
<ul>
<li>防止页面过窄或过宽</li>
<li>常用于电商移动端页面</li>
</ul>
<h2 data-id="heading-24">七、总结</h2>
<p>通过这一阶段的学习，我对移动端 Web 开发有了几个明确的认知：</p>
<ul>
<li>视口是移动端布局的基础</li>
<li>二倍图是清晰显示的关键</li>
<li>流式布局是最常用的移动端布局方式</li>
<li>CSS3 盒模型极大降低了布局复杂度</li>
<li>移动端开发更注重体验和性能</li>
</ul>
<p>如果你正准备从 PC 端转向移动端，这些内容几乎是<strong>必经之路</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[代码 Review 的艺术：如何委婉地告诉同事你写的代码是一坨屎？]]></title>    <link>https://juejin.cn/post/7598563188113555508</link>    <guid>https://juejin.cn/post/7598563188113555508</guid>    <pubDate>2026-01-26T02:51:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598563188113555508" data-draft-id="7598563188113244212" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="代码 Review 的艺术：如何委婉地告诉同事你写的代码是一坨屎？"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-26T02:51:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            代码 Review 的艺术：如何委婉地告诉同事你写的代码是一坨屎？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:51:19.000Z" title="Mon Jan 26 2026 02:51:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f31cf1d8f7694552850b417aabbca749~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000679&amp;x-signature=uyDxD5sQkiJP0d%2BM7jFaL%2Bth5aI%3D" alt="1_HEyuDA6Y8gOkNaHMPoU_ew.png" loading="lazy"/></p>
<p>有一天下午四点，我点开了同事刚提的一个 PR, 先上代码👇：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// PR</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handle</span>(<span class="hljs-params">list</span>) {
  <span class="hljs-keyword">const</span> list1 = []
  <span class="hljs-keyword">let</span> temp = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; list.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (list[i]) {
      <span class="hljs-keyword">if</span> (list[i].<span class="hljs-property">status</span>) {
        <span class="hljs-keyword">if</span> (list[i].<span class="hljs-property">status</span> === <span class="hljs-string">'active'</span>) {
          <span class="hljs-keyword">if</span> (list[i].<span class="hljs-property">type</span>) {
            <span class="hljs-keyword">if</span> (list[i].<span class="hljs-property">type</span> === <span class="hljs-string">'user'</span>) {
              <span class="hljs-comment">// 在 for 里 await 查库</span>
              temp = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">query</span>(
                <span class="hljs-string">'SELECT * FROM users WHERE id = ?'</span>,
                [list[i].<span class="hljs-property">id</span>]
              )

              <span class="hljs-keyword">if</span> (temp &amp;&amp; temp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
                list1.<span class="hljs-title function_">push</span>(temp[<span class="hljs-number">0</span>])
              }
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">if</span> (a === <span class="hljs-number">1</span>) {
                <span class="hljs-comment">// 什么都不干</span>
              }
            }
          }
        }
      }
    }
  }

  <span class="hljs-keyword">return</span> list1
}
</code></pre>
<p>第一眼，还行。<br/>
第二眼，嗯？<br/>
第三眼，我开始怀疑人生。</p>
<p>变量叫 <code>a</code>、<code>temp</code>、<code>list1</code>，<code>if-else</code> 套了六层，在 <code>for</code> 里 <code>await</code> 查库，像一锅没加盖的乱炖。</p>
<p>我当时脑子里只有一个念头：<br/>
<strong>这玩意要是上线了，今晚谁都别睡😡😡😡。</strong></p>
<p>但问题是——<br/>
你不能在评论区直接敲一句🤔：</p>
<blockquote>
<p>这段代码太烂了，建议重写。</p>
</blockquote>
<p>你可以这么想，但不能这么说。<br/>
因为你不是在写技术博客，你是在上班😖。</p>
<p>Code Review 本来是为了让项目更稳，结果很多时候，反而成了团队关系的坟头。</p>
<p>后来我慢慢意识到一件事：<br/>
你要做的，不是指出问题，而是——  <strong>让对方愿意帮你把问题改掉。</strong></p>
<hr/>
<h3 data-id="heading-0">先说个核心原则：别对人下手，先对代码下手</h3>
<p>CR 最容易翻车的点，就一个字：<strong>你</strong>。</p>
<p><strong>你这里写错了。你为什么不判空。你这逻辑不太行。</strong></p>
<p>只要你用了-<strong>你</strong>，对方心里的防御盾基本就举起来了😒。</p>
<p>更聪明的做法，是把对象换掉。</p>
<ul>
<li>换成我们</li>
<li>换成这段代码</li>
<li>换成如果这个场景</li>
<li>换成我们下次如何防范</li>
</ul>
<p>比如：</p>
<p><strong>我们这里可能要考虑一下空变量的情况。这段逻辑在并发高的时候，可能会有点风险，这个写法在数据量大的时候，性能可能撑不住的</strong></p>
<p>意思一点没变，但<strong>攻击性直接砍半</strong>。
敌人是 Bug，不是你的同事😃。</p>
<hr/>
<h3 data-id="heading-1">一些能救命的 CR 话术（真的可以试试）</h3>
<h4 data-id="heading-2">变量名随便起，看不懂</h4>
<p>你心里想的是：</p>
<blockquote>
<p>这 <code>list1</code> 到底是个啥？</p>
</blockquote>
<p>但你可以这么说：</p>
<blockquote>
<p>这个 <code>list1</code> 里装的主要是什么数据来着？<br/>
要不要换个更具体点的名字，比如 <code>activeUserList</code>？<br/>
这样后面维护的人（包括未来的我们）会省不少事。</p>
</blockquote>
<p>重点不在你命名不行，而是以后接受的人会感谢你的🤔。</p>
<hr/>
<h4 data-id="heading-3">if-else 套到你头皮发麻</h4>
<p>别说逻辑太乱了。</p>
<p>你可以说：</p>
<blockquote>
<p>这里我看了一下，逻辑稍微有点绕，我读了两遍才理顺。<br/>
要不要考虑用提前 return 的方式拆一下？<br/>
缩进少一点，后面看起来也轻松些。</p>
</blockquote>
<p>先承认是<strong>我读得有点费劲</strong>，<br/>
再给建议，<br/>
最后用商量的语气收尾。</p>
<p>对方台阶都有了，基本不会炸。</p>
<hr/>
<h4 data-id="heading-4">明显的性能隐患</h4>
<p>比如循环里查库、循环里调接口。</p>
<p>可以这样：</p>
<blockquote>
<p>这个写法在当前数据量下应该没啥问题。<br/>
我主要有点担心，如果后面数据上来，接口时间会不会被拉长。<br/>
要不这里改成批量查或者并发一下？稳一点。</p>
</blockquote>
<p>这句话的潜台词只有一个：  <strong>我是在给项目兜底🥱。</strong></p>
<hr/>
<h4 data-id="heading-5">完全看不懂他在干嘛？</h4>
<p>这时候千万别装懂。</p>
<p>你可以说：</p>
<blockquote>
<p>这块我好像没太跟上你的思路，<br/>
能不能简单说下这里为什么要这么处理？<br/>
或者加点注释也行，我怕下次有人接手会有点懵。</p>
</blockquote>
<p>很多时候，对方在解释的过程中，<br/>
<strong>自己就会发现问题。</strong></p>
<p>你甚至都不用再补刀的。</p>
<hr/>
<h3 data-id="heading-6">顺便说一句：别做格式检查！</h3>
<p>CR 不是让你盯着：</p>
<ul>
<li>少没少空格</li>
<li>单引号还是双引号</li>
<li>换行对不对</li>
<li>有没有写注释</li>
<li>有没有加 commit 标签</li>
</ul>
<p>你在 PR 里留 20 条这种评论，<br/>
对方只会想一件事：<br/>
<strong>这人是不是有点烦😥。</strong></p>
<p>格式这种事，交给工具就完了😖。</p>
<p>ESLint、Prettier、Husky，甚至是AI整理代码<br/>
能解决 80% 的低级争吵。</p>
<p>如果真的乱到影响阅读，可以一句话带过：</p>
<blockquote>
<p>这一块缩进好像有点乱，<br/>
跑一下 lint 自动修一下就行，<br/>
我们主要还是看下逻辑。</p>
</blockquote>
<p>点到为止😒。</p>
<hr/>
<h3 data-id="heading-7">真到必须重写的时候，别在评论区硬刚</h3>
<p>有些代码，确实已经到了不改不行的程度。<br/>
但就算这样，也别在 PR 评论区写小作文。</p>
<p>人多的地方，<strong>没人愿意认输。</strong></p>
<p>更好的方式是：</p>
<p><strong>私聊？语音？当面？</strong></p>
<p>开场也别太重：</p>
<blockquote>
<p>刚看了下那个 PR，有一块我有点担心，咱们对一下怎么样？</p>
</blockquote>
<p>把风险讲清楚，<br/>
把后果讲明白，<br/>
共识达成了，再让他自己改。</p>
<p><strong>给成年人留面子，成本真的很低的😁。</strong></p>
<hr/>
<h3 data-id="heading-8">说个实在的</h3>
<p>Code Review 从来都不是，谁技术更牛谁说了算的。你今天指出的问题，  很可能是为了防止哪天半夜两点，  把他从被窝里拽起来修 Bug。</p>
<p>这不是找茬，这是在剩你的时间。</p>
<p>所以以后 CR 的时候：</p>
<ul>
<li>少一点命令</li>
<li>多一点商量</li>
<li>少一点你怎么这样？</li>
<li>多一点我们是不是可以？</li>
</ul>
<p><strong>代码是冷的，但一起写代码的人，最好别凉😃。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c42393a3a5c4fb48f9e701fbcdfb185~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000679&amp;x-signature=anfU6PIaqsUpkEmlfqVc6ORDEBs%3D" alt="1_bh0C57IWRr6orsCDJXCFDA_abgbhi.webp" loading="lazy"/></p>
<blockquote>
<p>灵感来自于上面👆这本书，希望对大家有帮助😁。
也整理出来了一些想法，望大家喜欢 👉 <a href="https://link.juejin.cn?target=https%3A%2F%2Ferpanomer.nurverse.com%2Fblog%2Fwhy-did-i-start-spending-less-time-browsing-tech-communities" target="_blank" title="https://erpanomer.nurverse.com/blog/why-did-i-start-spending-less-time-browsing-tech-communities" ref="nofollow noopener noreferrer">为什么我开始减少逛技术社区，而是去读非技术的书？</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e9709052ba042c1bb782d2287ad019a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000679&amp;x-signature=Q8acvYFa5YfVHRnZ9w0uAyhoi0Q%3D" alt="谢谢大家.gif" loading="lazy"/></p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[让写作更有“手感”：开源 Tiptap Writing Kit（支持 Vue / React）]]></title>    <link>https://juejin.cn/post/7598767580307079222</link>    <guid>https://juejin.cn/post/7598767580307079222</guid>    <pubDate>2026-01-26T02:37:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598767580307079222" data-draft-id="7598767580307046454" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让写作更有“手感”：开源 Tiptap Writing Kit（支持 Vue / React）"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-26T02:37:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="普罗米修斯基"/> <meta itemprop="url" content="https://juejin.cn/user/2436983109989272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让写作更有“手感”：开源 Tiptap Writing Kit（支持 Vue / React）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436983109989272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    普罗米修斯基
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:37:48.000Z" title="Mon Jan 26 2026 02:37:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">让写作更有“手感”：开源 Tiptap Writing Kit（支持 Vue / React）</h2>
<p>如果你在做内容创作平台、AI 写作工具或知识库编辑器，一定遇到过这个问题：功能很全，但“写起来不舒服”。<br/>
我最近把自己在项目里沉淀的写作体验能力抽出来，开源了 <strong>Tiptap Writing Kit</strong>，目标很明确：<strong>让写作更顺手、更像在真实写作</strong>。</p>
<p>这是一套基于 Tiptap 的增强组件，提供 <strong>排版控制、标尺辅助、打字音效/特效、查找替换、选中气泡菜单</strong> 等功能，并同时支持 <strong>Vue 3 / React</strong>。</p>
<hr/>
<h3 data-id="heading-1">效果预览</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d673e188310400dacb607eb40a51e1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmu572X57Gz5L-u5pav5Z-6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999868&amp;x-signature=YCJPPpmRk161aCEkfjvo7hM78NI%3D" alt="CPT2601261032-1521x782.gif" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-2">一句话亮点</h3>
<ul>
<li>面向写作场景：不是通用编辑器，而是“写作体验”增强</li>
<li>Vue / React 双端支持，核心能力共享</li>
<li>轻量：按需启用，体验增强不臃肿</li>
<li>可配置：字体、行高、内容宽度、段间距、标尺风格、快捷键、气泡菜单都能改</li>
</ul>
<hr/>
<h3 data-id="heading-3">在线 Demo</h3>
<ul>
<li>Vue Demo：<a href="https://link.juejin.cn?target=https%3A%2F%2Fyilujian.github.io%2Ftiptap-writing-kit%2Fvue%2F" target="_blank" title="https://yilujian.github.io/tiptap-writing-kit/vue/" ref="nofollow noopener noreferrer">yilujian.github.io/tiptap-writ…</a></li>
<li>React Demo：<a href="https://link.juejin.cn?target=https%3A%2F%2Fyilujian.github.io%2Ftiptap-writing-kit%2Freact%2F" target="_blank" title="https://yilujian.github.io/tiptap-writing-kit/react/" ref="nofollow noopener noreferrer">yilujian.github.io/tiptap-writ…</a></li>
</ul>
<blockquote>
<p>建议在电脑端打开，有明显的“写作手感”变化。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">功能一览</h3>
<ul>
<li><strong>排版控制</strong>：字体/字号/行高/内容宽度/段间距</li>
<li><strong>标尺线</strong>：写作时的视觉节奏辅助</li>
<li><strong>打字音效 &amp; 特效</strong>：可选的轻量反馈（crisp / drop / typewriter、splash / ripple / mist / fire / cheer）</li>
<li><strong>查找/替换</strong>：内置面板 + 快捷键支持</li>
<li><strong>选中气泡菜单</strong>：支持自定义按钮、图标与样式</li>
<li><strong>快捷键配置</strong>：find / save 等可完全自定义</li>
</ul>
<hr/>
<h3 data-id="heading-5">快速上手</h3>
<h4 data-id="heading-6">React</h4>
<pre><code class="hljs language-bash" lang="bash">npm i tiptap-writing-kit-react
</code></pre>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">InkEditor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'tiptap-writing-kit-react'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'tiptap-writing-kit-react/style.css'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">InkEditor</span> /&gt;</span></span>
}
</code></pre>
<h4 data-id="heading-7">Vue 3</h4>
<pre><code class="hljs language-bash" lang="bash">npm i tiptap-writing-kit-vue
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { InkEditor } from 'tiptap-writing-kit-vue'
import 'tiptap-writing-kit-vue/style.css'
&lt;/script&gt;

&lt;template&gt;
  &lt;InkEditor /&gt;
&lt;/template&gt;
</code></pre>
<hr/>
<h3 data-id="heading-8">自定义气泡菜单（示例）</h3>
<h4 data-id="heading-9">React</h4>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">InkEditor</span>
  bubbleMenuRender={<span class="hljs-function">(<span class="hljs-params">{ actions, labels, onAction, isActive }</span>) =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      {actions.map((action) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
          <span class="hljs-attr">key</span>=<span class="hljs-string">{action}</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">twk-bubble-btn</span> ${<span class="hljs-attr">isActive</span>(<span class="hljs-attr">action</span>) ? '<span class="hljs-attr">is-active</span>' <span class="hljs-attr">:</span> ''}`}
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> onAction(action)}
        &gt;
          {labels[action]}
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )}
/&gt;
</code></pre>
<h4 data-id="heading-10">Vue</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;InkEditor&gt;
  &lt;template #bubble-menu="{ actions, labels, onAction, isActive }"&gt;
    &lt;button
      v-for="action in actions"
      :key="action"
      class="twk-bubble-btn"
      :class="{ 'is-active': isActive(action) }"
      @click="onAction(action)"
    &gt;
      {{ labels[action] }}
    &lt;/button&gt;
  &lt;/template&gt;
&lt;/InkEditor&gt;
</code></pre>
<hr/>
<h3 data-id="heading-11">为什么开源这个组件？</h3>
<p>我之前在实际项目中做过 AI 写作平台，发现在“写作体验”上差 1 步，用户就会跳出。<br/>
于是把这些体验增强能力抽象成组件，希望帮助更多内容类产品“更像在写作”。</p>
<hr/>
<h3 data-id="heading-12">适用场景</h3>
<ul>
<li>AI 写作 / 小说创作 / 长文编辑</li>
<li>内容管理后台的编辑器体验升级</li>
<li>知识库、文档编辑工具</li>
</ul>
<hr/>
<h3 data-id="heading-13">仓库地址</h3>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyilujian%2Ftiptap-writing-kit" target="_blank" title="https://github.com/yilujian/tiptap-writing-kit" ref="nofollow noopener noreferrer">github.com/yilujian/ti…</a></li>
<li>npm：
<ul>
<li><code>tiptap-writing-kit-core</code></li>
<li><code>tiptap-writing-kit-react</code></li>
<li><code>tiptap-writing-kit-vue</code></li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-14">路线图（Roadmap）</h3>
<ul>
<li>更丰富的气泡菜单组件与主题</li>
<li>编辑器内的轻量模板系统</li>
<li>可插拔的“写作状态”辅助（字数、段落节奏、节拍）</li>
</ul>
<hr/>
<h3 data-id="heading-15">最后</h3>
<p>如果你正在做内容产品，希望写作体验更“像笔尖在纸上”，欢迎试试。<br/>
如果你愿意给我一个 <strong>Star</strong> 或者反馈建议，对项目帮助非常大。</p>
<p>谢谢阅读，欢迎交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[社区译文 | 区分 FUD 和现实：MySQL 真的被放弃了吗？]]></title>    <link>https://juejin.cn/post/7598734303175311412</link>    <guid>https://juejin.cn/post/7598734303175311412</guid>    <pubDate>2026-01-26T02:53:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303175311412" data-draft-id="7598563188113571892" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="社区译文 | 区分 FUD 和现实：MySQL 真的被放弃了吗？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-26T02:53:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱可生开源社区"/> <meta itemprop="url" content="https://juejin.cn/user/1480387593251847"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            社区译文 | 区分 FUD 和现实：MySQL 真的被放弃了吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1480387593251847/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱可生开源社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:53:07.000Z" title="Mon Jan 26 2026 02:53:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>作者：Julia Vural，Percona 工程师。</p>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.percona.com%2Fblog%2Fseparating-fud-and-reality-has-mysql-really-been-abandoned%2F%25EF%25BC%258CJan" target="_blank" title="https://www.percona.com/blog/separating-fud-and-reality-has-mysql-really-been-abandoned/%EF%BC%8CJan" ref="nofollow noopener noreferrer">www.percona.com/blog/separa…</a> 22, 2026</p>
<p>爱可生开源社区翻译，本文约 900 字，预计阅读需要 3 分钟。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff53315a722649c79b851272a3343d15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000786&amp;x-signature=F3b693C%2BsQEclaXfmU7FWd1aEnI%3D" alt="640 (78).webp" loading="lazy"/></p>
<p>过去几周，MySQL 社区再次出现关于 <em>"Oracle 已停止开发 MySQL"</em> 或 <em>"MySQL 将被放弃"</em> 的说法，引发了更多讨论和担忧。一些图表显示，2025 年 10 月之后 GitHub 的提交数量似乎停止增长，而一些博客文章和论坛讨论也对这些迹象进行了字面解读，这进一步加剧了人们的担忧。</p>
<p>作为一名公开分析过 MySQL 代码库活动，并且每天都在 Percona 公司使用 MySQL 的人，我想清楚地区分数据实际显示的内容和数据未显示的内容。</p>
<p><strong>这篇文章并非对 Oracle 的盲目辩护。我们常常不同意 Oracle 的某些决定，并且会公开表达我们的观点。但公平至关重要------尤其是在恐惧、不确定性和怀疑（FUD）开始影响客户和更广泛的生态系统时。</strong></p>
<h2 data-id="heading-0">关于"停止对 MySQL 维护"的说法</h2>
<p>我们最近收到社区<a href="https://link.juejin.cn?target=https%3A%2F%2Fforums.percona.com%2Ft%2Fupstream-being-abandoned-will-percona-continue-to-maintain-mysql%2F40061" title="https://forums.percona.com/t/upstream-being-abandoned-will-percona-continue-to-maintain-mysql/40061" target="_blank" ref="nofollow noopener noreferrer">一个令人惊讶的问题</a>：MySQL 真的被放弃了吗？他们还附上了 <a href="https://link.juejin.cn?target=https%3A%2F%2Foptimizedbyotto.com%2Fpost%2Freasons-to-stop-using-mysql%2F" title="https://optimizedbyotto.com/post/reasons-to-stop-using-mysql/" target="_blank" ref="nofollow noopener noreferrer">Otto Kekäläinen 的帖子</a>中分享的图表。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38ce4ab0c20045eab43493be98d90218~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000786&amp;x-signature=TjzRaiyv7pNbI3%2FaD70O3XzHaEI%3D" alt="640 (79).webp" loading="lazy"/>
这一结论通常是从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmysql%2Fmysql-server%2F" title="https://github.com/mysql/mysql-server/" target="_blank" ref="nofollow noopener noreferrer">GitHub 公共仓库</a> 的活动图表中得出的 ，该图表确实显示存在很长一段时间没有可见的提交。</p>
<p>图表本身没有错，但解读并不完整。</p>
<h2 data-id="heading-1">缺失的背景信息：MySQL 的实际开发过程</h2>
<p><strong>错误在于假设 MySQL 是在 GitHub 上开发的，但事实并非如此。</strong></p>
<p>多年来，Oracle 一直遵循一套特定的工作流程，即在私有的封闭代码库中进行实时工程开发。GitHub 仅作为公共镜像和发布平台，而非活跃的开发工作空间。因此，代码会以大型的、整合的"代码包"的形式发布，与官方版本同步，而不是以每日增量提交的形式出现。</p>
<p>换句话说：</p>
<p><strong>GitHub 是一个异步发布镜像，而不是开发记录系统。</strong></p>
<p>这意味着：</p>
<ul>
<li>
<p>GitHub 上缺乏增量提交并不意味着缺乏开发。</p>
</li>
<li>
<p>预计版本发布之间会有较长的平静期。</p>
</li>
<li>
<p>突然的大规模提交爆发是正常的发布机制。</p>
</li>
</ul>
<p>这种开发模式并不新鲜，它已经沿用多年。有人会说这不是 <em>"真正的开源开发模式"</em> 吗？也许会，但最终，在 2026 年 1 月 21 日（在最近发布的 9.6.0、8.4.8 和 8.0.45 版本之后）绘制的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmysql%2Fmysql-server%2Fgraphs%2Fcommit-activity" title="https://github.com/mysql/mysql-server/graphs/commit-activity" target="_blank" ref="nofollow noopener noreferrer">同一张图表</a> 看起来不再像是被弃用了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd344fa691a946d7b47920d2b4f7d907~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000786&amp;x-signature=t%2FKLqQr2dzcrrpEvQvhrm%2BtoMrI%3D" alt="640 (55).png" loading="lazy"/></p>
<p>MySQL 的"弃用"案例完美地提醒我们，<strong>指标的价值取决于我们对所衡量系统的理解。</strong></p>
<p>GitHub 图表上的停滞不前并不总是意味着项目正在走向衰亡；很多时候，它只是引擎在紧闭的大门后静默运转的体现。虽然我们可以讨论 Oracle 开发模式的透明度，但我们不应该将不同的工作流程误解为缺乏工作。<strong>事实并非总是如表面所见，以貌取人或以镜像来判断数据库都是错误的。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[详解Metadata 和 Reflector]]></title>    <link>https://juejin.cn/post/7599268297202941990</link>    <guid>https://juejin.cn/post/7599268297202941990</guid>    <pubDate>2026-01-26T02:51:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297202941990" data-draft-id="7598181989968379931" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="详解Metadata 和 Reflector"/> <meta itemprop="keywords" content="前端,Node.js,NestJS"/> <meta itemprop="datePublished" content="2026-01-26T02:51:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端付豪"/> <meta itemprop="url" content="https://juejin.cn/user/1741228277763278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            详解Metadata 和 Reflector
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1741228277763278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端付豪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:51:06.000Z" title="Mon Jan 26 2026 02:51:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>装饰器声明后，启动 Nest 应用，对象会创建好，依赖也给注入了，为啥 ？</p>
<p>先看 Reflect 的 metadata</p>
<p>Reflect.get 是获取对象属性值</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/562071b365744875b19b93514cbe30ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000666&amp;x-signature=JV7WeA7VQI2ihOjslei89%2BF6hY4%3D" alt="image.png" loading="lazy"/></p>
<p>Reflect.set 是设置对象属性值
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0e6e5fa37d74b2e8b8f5f0754a83f99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000666&amp;x-signature=w85RhuQScK5EXRs4pJmovJQ2FPw%3D" alt="image.png" loading="lazy"/></p>
<p>Reflect.has 是判断对象属性是否存在</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f56d40e3e2b44d958c149552c8440747~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000666&amp;x-signature=wuq%2BKkgl%2BKVtPKrkPwE%2BVPY9zwA%3D" alt="image.png" loading="lazy"/></p>
<p>Reflect.apply 是调用某个方法，传入对象和参数</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f59e86c78fd45968d84c6b5263b1b74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000666&amp;x-signature=NHxRwvMXrs3Y77HTb2SQj%2FkDEt8%3D" alt="image.png" loading="lazy"/></p>
<p>Reflect.construct 是用构造器创建对象实例，传入构造器参数</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6deae394d30640fdbd0a5f61990babbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000666&amp;x-signature=1KUvQTr9zWNr%2BOEhe88UYj7EI7U%3D" alt="image.png" loading="lazy"/></p>
<p>Nest 用到的 api</p>
<pre><code class="hljs language-ini" lang="ini">Reflect.defineMetadata(metadataKey, metadataValue, target)<span class="hljs-comment">;</span>

Reflect.defineMetadata(metadataKey, metadataValue, target, propertyKey)<span class="hljs-comment">;</span>


let <span class="hljs-attr">result</span> = Reflect.getMetadata(metadataKey, target)<span class="hljs-comment">;</span>

let <span class="hljs-attr">result</span> = Reflect.getMetadata(metadataKey, target, propertyKey)<span class="hljs-comment">;</span>
</code></pre>
<p>Reflect.defineMetadata 和 Reflect.getMetadata 分别用于设置和获取某个类的元数据，如果最后传入了属性名，还可以单独为某个属性设置元数据</p>
<p>那元数据存在哪？</p>
<p>存在类或者对象上，如果给类或者类的静态属性添加元数据，那就保存在类上</p>
<p>如果给实例属性添加元数据，那就保存在对象上，用类似 [[metadata]] 的 key 来存</p>
<p>支持装饰器的方式使用：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Reflect</span>.<span class="hljs-built_in">metadata</span>(metadataKey, metadataValue)
class C {

  <span class="hljs-variable">@Reflect</span>.<span class="hljs-built_in">metadata</span>(metadataKey, metadataValue)
  <span class="hljs-built_in">method</span>() {
  }
}
</code></pre>
<p>基础封装</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Meta</span>(<span class="hljs-params">metadataKey: <span class="hljs-built_in">string</span>, metadataValue: <span class="hljs-built_in">any</span></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">metadata</span>(metadataKey, metadataValue)
}
</code></pre>
<p>实际例子</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Validate</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target, propertyKey, descriptor</span>) {
    <span class="hljs-keyword">const</span> types = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getMetadata</span>(
      <span class="hljs-string">'design:paramtypes'</span>,
      target,
      propertyKey
    )

    <span class="hljs-keyword">const</span> original = descriptor.<span class="hljs-property">value</span>

    descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
      args.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">arg, index</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-title class_">Type</span> = types[index]
        <span class="hljs-keyword">if</span> (!(arg <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Type</span>) &amp;&amp; <span class="hljs-keyword">typeof</span> arg !== <span class="hljs-title class_">Type</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">toLowerCase</span>()) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
            <span class="hljs-string">`参数 <span class="hljs-subst">${index}</span> 类型错误，期望 <span class="hljs-subst">${Type.name}</span>`</span>
          )
        }
      })
      <span class="hljs-keyword">return</span> original.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args)
    }
  }
}

</code></pre>
<p>使用</p>
<pre><code class="hljs language-scss" lang="scss">class MathService {

  <span class="hljs-keyword">@Validate</span>()
  add(<span class="hljs-attribute">a</span>: number, <span class="hljs-attribute">b</span>: number) {
    return <span class="hljs-selector-tag">a</span> + <span class="hljs-selector-tag">b</span>
  }
}

new <span class="hljs-built_in">MathService</span>()<span class="hljs-selector-class">.add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)     <span class="hljs-comment">// ✅</span>
new <span class="hljs-built_in">MathService</span>()<span class="hljs-selector-class">.add</span>('<span class="hljs-number">1</span>', <span class="hljs-number">2</span>)   <span class="hljs-comment">// ❌</span>

</code></pre>
<p>Nest 的实现原理就是通过装饰器给 class 或者对象添加元数据，然后初始化的时候取出这些元数据，进行依赖的分析，然后创建对应的实例对象就可以了。</p>
<p>所以说，nest 实现的核心就是 Reflect metadata 的 api</p>
<h3 data-id="heading-0">安装依赖 &amp; 打开配置</h3>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> reflect-metadata
</code></pre>
<p><code>tsconfig.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"experimentalDecorators"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"emitDecoratorMetadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>入口文件最顶部：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> <span class="hljs-string">'reflect-metadata'</span>
</code></pre>
<h3 data-id="heading-1">自己写一个装饰器</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyController</span>(<span class="hljs-params">path: string</span>): <span class="hljs-title class_">ClassDecorator</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">target</span>) =&gt;</span> {
    <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineMetadata</span>(<span class="hljs-string">'path'</span>, path, target)
  }
}
</code></pre>
<p><strong>这一行是核心：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineMetadata</span>(key, value, target)
</code></pre>
<blockquote>
<p>👆 把 <code>path</code> 这个信息，挂到 class 上</p>
</blockquote>
<h3 data-id="heading-2">使用这个装饰器</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@MyController(<span class="hljs-string">'/user'</span>)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {}
</code></pre>
<hr/>
<h3 data-id="heading-3">运行时把元数据读出来</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getMetadata</span>(<span class="hljs-string">'path'</span>, <span class="hljs-title class_">UserController</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path) <span class="hljs-comment">// /user</span>
</code></pre>
<p>🔑 <strong>到这里你已经实现了 Nest 的第一步</strong></p>
<h2 data-id="heading-4">Nest 的 Controller / Injectable 本质</h2>
<h3 data-id="heading-5">Controller 装饰器 ≈</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Controller(<span class="hljs-string">'/user'</span>)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {}
</code></pre>
<p>等价于：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineMetadata</span>(<span class="hljs-string">'path'</span>, <span class="hljs-string">'/user'</span>, <span class="hljs-title class_">UserController</span>)
</code></pre>
<hr/>
<h3 data-id="heading-6">Injectable 装饰器 ≈</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Injectable()</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {}
</code></pre>
<p>等价于：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineMetadata</span>(<span class="hljs-string">'injectable'</span>, <span class="hljs-literal">true</span>, <span class="hljs-title class_">UserService</span>)
</code></pre>
<hr/>
<h2 data-id="heading-7">依赖注入是怎么“自动知道”的？</h2>
<h3 data-id="heading-8">关键：<strong>构造函数参数的类型元数据</strong></h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Injectable()</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {}
</code></pre>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Injectable()</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">private</span> userService: UserService) {}
}
</code></pre>
<h3 data-id="heading-9">TypeScript 在背后偷偷干了什么？</h3>
<p>开启 <code>emitDecoratorMetadata</code> 后：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getMetadata</span>(<span class="hljs-string">'design:paramtypes'</span>, <span class="hljs-title class_">UserController</span>)
</code></pre>
<p>得到：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[ UserService ]</span>
</code></pre>
<p>💥 <strong>这一步是 Nest DI 的灵魂</strong></p>
<hr/>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> <span class="hljs-string">'reflect-metadata'</span>

<span class="hljs-meta">@Injectable()</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {}

<span class="hljs-meta">@Injectable()</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">private</span> userService: UserService) {}
}

<span class="hljs-keyword">const</span> deps = Reflect.getMetadata(
  <span class="hljs-string">'design:paramtypes'</span>,
  UserController
)

console.log(deps)
<span class="hljs-comment">// [ [class UserService] ]</span>
</code></pre>
<hr/>
<h2 data-id="heading-10">Nest 初始化时到底在干嘛？</h2>
<p>可以理解成这几步👇</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">function <span class="hljs-title">bootstrap</span>()</span> {
  <span class="hljs-comment">// 1. 扫描所有 class</span>
  <span class="hljs-comment">// 2. 找 @Controller / @Injectable</span>
  <span class="hljs-comment">// 3. 读取元数据</span>
  <span class="hljs-comment">// 4. 分析依赖</span>
  <span class="hljs-comment">// 5. new 实例</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-11">极简 DI 容器</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> container = <span class="hljs-keyword">new</span> Map()

<span class="hljs-function">function <span class="hljs-title">createInstance</span>(<span class="hljs-params">target</span>)</span> {
  <span class="hljs-keyword">const</span> deps =
    Reflect.getMetadata(<span class="hljs-string">'design:paramtypes'</span>, target) || []

  <span class="hljs-keyword">const</span> <span class="hljs-keyword">params</span> = deps.map(dep =&gt; {
    <span class="hljs-keyword">if</span> (!container.has(dep)) {
      container.<span class="hljs-keyword">set</span>(dep, createInstance(dep))
    }
    <span class="hljs-keyword">return</span> container.<span class="hljs-keyword">get</span>(dep)
  })

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> target(...<span class="hljs-keyword">params</span>)
}
</code></pre>
<p>使用：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">controller</span> = createInstance(UserController)
</code></pre>
<p>👉 <strong>这就是 Nest DI 的雏形</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[BFC (Block Formatting Context) 详解]]></title>    <link>https://juejin.cn/post/7598734303175344180</link>    <guid>https://juejin.cn/post/7598734303175344180</guid>    <pubDate>2026-01-26T02:54:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303175344180" data-draft-id="7598734303175082036" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="BFC (Block Formatting Context) 详解"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-26T02:54:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="娜妹子辣"/> <meta itemprop="url" content="https://juejin.cn/user/3421335918747976"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            BFC (Block Formatting Context) 详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3421335918747976/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    娜妹子辣
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:54:15.000Z" title="Mon Jan 26 2026 02:54:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>BFC（Block Formatting Context，块级格式化上下文）</strong>  是 CSS 渲染中的一个核心概念，它决定了<strong>块级元素如何布局、如何与兄弟/子元素交互</strong>。<strong>理解 BFC 能解决很多经典布局问题（如浮动塌陷、外边距重叠等）。</strong></p>
<h2 data-id="heading-0">🧠 一、什么是 BFC？</h2>
<blockquote>
<p><strong>BFC 是 Web 页面中一个独立的渲染区域</strong>，内部的块级元素按照特定规则布局，<strong>且不会与外部元素相互影响</strong>。</p>
</blockquote>
<p>你可以把它想象成一个“<strong>隔离的盒子</strong>”：</p>
<ul>
<li>盒子内部的元素按规则排列</li>
<li>盒子外部的元素不会干扰内部</li>
<li>盒子也不会被外部元素干扰</li>
</ul>
<h2 data-id="heading-1">二、BFC 的触发条件（如何创建 BFC？）</h2>













































































<table><thead><tr><th>触发方式</th><th>是否常用</th><th>副作用</th><th>兼容性</th><th>推荐度</th><th>适用场景</th></tr></thead><tbody><tr><td><code>display: flow-root</code></td><td>✅ 现代首选</td><td>❌ 无</td><td>Chrome 58+ / FF 53+ / Safari 10.1+</td><td>⭐⭐⭐⭐⭐</td><td><strong>通用场景（现代浏览器）</strong></td></tr><tr><td><code>overflow: hidden/auto/scroll</code></td><td>✅ 广泛使用</td><td>⚠️ 可能裁剪内容</td><td>✅ 全浏览器</td><td>⭐⭐⭐⭐</td><td>需要兼容旧浏览器时</td></tr><tr><td><code>float: left/right</code></td><td>⚠️ 逐渐淘汰</td><td>⚠️ 脱离文档流</td><td>✅ 全浏览器</td><td>⭐⭐</td><td>传统浮动布局（不推荐新项目）</td></tr><tr><td><code>position: absolute/fixed</code></td><td>⚠️ 特定场景</td><td>⚠️ 脱离文档流</td><td>✅ 全浏览器</td><td>⭐⭐</td><td>定位元素（非布局目的）</td></tr><tr><td><code>display: inline-block</code></td><td>⚠️ 有局限</td><td>⚠️ 行内块特性（间隙、基线对齐）</td><td>✅ 全浏览器</td><td>⭐⭐</td><td>行内布局（非块级容器）</td></tr><tr><td><code>display: table-cell</code></td><td>⚠️ 少用</td><td>⚠️ 表格布局行为</td><td>✅ 全浏览器</td><td>⭐</td><td>模拟表格（不推荐）</td></tr><tr><td><code>display: flex/grid</code></td><td>✅ 现代布局</td><td>⚠️ 改变子元素布局模型</td><td>✅ 现代浏览器</td><td>⭐⭐⭐</td><td><strong>本身是布局容器时</strong></td></tr><tr><td><code>contain: layout/style/paint</code></td><td>⚠️ 新特性</td><td>⚠️ 性能隔离（可能影响渲染）</td><td>Chrome 52+ / FF 69+</td><td>⭐⭐</td><td>性能优化场景</td></tr></tbody></table>
<h2 data-id="heading-2">三、BFC 的核心作用（解决什么问题？）</h2>
<h3 data-id="heading-3">场景一：父容器包含浮动子元素（<strong>解决父容器高度塌陷</strong>）</h3>
<pre><code class="hljs language-ini" lang="ini">html
运行html
&lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span> style=<span class="hljs-string">"float: left"</span>&gt;Child <span class="hljs-number">1</span>&lt;/div&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span> style=<span class="hljs-string">"float: left"</span>&gt;Child <span class="hljs-number">2</span>&lt;/div&gt;
&lt;/div&gt;
</code></pre>



































<table><thead><tr><th>方案</th><th>代码</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong><code>flow-root</code></strong></td><td><code>.parent { display: flow-root; }</code></td><td>无副作用、语义清晰</td><td>不支持 IE</td></tr><tr><td><strong><code>overflow: hidden</code></strong></td><td><code>.parent { overflow: hidden; }</code></td><td>全兼容</td><td>可能裁剪阴影</td></tr><tr><td><strong><code>::after</code> clearfix</strong></td><td><code>.parent::after { content:""; display:table; clear:both }</code></td><td>全兼容、无裁剪</td><td>代码冗余</td></tr><tr><td><strong><code>flex</code></strong></td><td><code>.parent { display: flex; }</code></td><td>现代、自动 BFC</td><td>改变子元素布局</td></tr></tbody></table>
<blockquote>
</blockquote>
<h3 data-id="heading-4">场景二：解决Margin折叠</h3>
<pre><code class="hljs language-js" lang="js">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"box1"</span>&gt;<span class="hljs-title class_">Box</span> <span class="hljs-number">1</span>&lt;/div&gt; 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box2"</span>&gt;</span>Box 2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>





























































<table><thead><tr><th>方案</th><th>CSS 代码</th><th>是否生效</th><th>副作用</th><th>推荐度</th></tr></thead><tbody><tr><td><strong>无处理</strong></td><td>—</td><td>❌ 折叠（间距=30px）</td><td>—</td><td>⭐</td></tr><tr><td><strong><code>flow-root</code></strong></td><td><code>.box2 { display: flow-root; }</code></td><td>✅ 间距=50px</td><td>❌ 无</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong><code>overflow: hidden</code></strong></td><td><code>.box2 { overflow: hidden; }</code></td><td>✅ 间距=50px</td><td>⚠️ 可能裁剪内容</td><td>⭐⭐⭐</td></tr><tr><td><strong><code>float: left</code></strong></td><td><code>.box2 { float: left; width: 100%; }</code></td><td>✅ 间距=50px</td><td>⚠️ 脱离文档流</td><td>⭐</td></tr><tr><td><strong><code>position: absolute</code></strong></td><td><code>.box2 { position: absolute; }</code></td><td>✅ 但布局错乱</td><td>⚠️ 完全脱离流</td><td>⭐</td></tr><tr><td><strong><code>inline-block</code></strong></td><td><code>.box2 { display: inline-block; width: 100%; }</code></td><td>✅ 间距=50px</td><td>⚠️ 行内块间隙/对齐问题</td><td>⭐⭐</td></tr><tr><td><strong><code>flex</code> 容器</strong></td><td>给父容器加 <code>display: flex; flex-direction: column;</code></td><td>✅ 间距=50px</td><td>⚠️ 改变子元素布局模型</td><td>⭐⭐⭐</td></tr></tbody></table>
<h3 data-id="heading-5">场景3：自适应两栏布局</h3>
<pre><code class="hljs language-js" lang="js">&lt;!-- 两栏布局：左侧固定，右侧自适应 --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layout"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sidebar"</span>&gt;</span>侧边栏<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>主内容区域<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/* 传统方法的问题 */</span>
.<span class="hljs-property">sidebar</span> {
  <span class="hljs-attr">float</span>: left;
  <span class="hljs-attr">width</span>: 200px;
  <span class="hljs-attr">background</span>: #ff6b6b;
  <span class="hljs-attr">height</span>: 300px;
}

.<span class="hljs-property">content</span> {
  <span class="hljs-comment">/* 问题：内容会被浮动元素覆盖 */</span>
  <span class="hljs-attr">background</span>: #4ecdc4;
  <span class="hljs-attr">height</span>: 300px;
}

<span class="hljs-comment">/* BFC解决方案 */</span>
.<span class="hljs-property">content</span>-bfc {
  <span class="hljs-attr">overflow</span>: hidden; <span class="hljs-comment">/* 创建BFC，避开浮动元素 */</span>
  <span class="hljs-attr">background</span>: #4ecdc4;
  <span class="hljs-attr">height</span>: 300px;
  <span class="hljs-comment">/* BFC区域不会与float box重叠 */</span>
}
</code></pre>
<h3 data-id="heading-6">场景4：防止元素被浮动元素覆盖</h3>
<pre><code class="hljs language-js" lang="js">&lt;!-- 文字环绕问题 --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"float-box"</span>&gt;</span>浮动盒子<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-content"</span>&gt;</span>
    这是一段很长的文字内容，在没有BFC的情况下，
    文字会环绕浮动元素。但有时我们希望文字内容
    独立成块，不被浮动元素影响。
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>
<pre><code class="hljs language-js" lang="js">.<span class="hljs-property">float</span>-box {
  <span class="hljs-attr">float</span>: left;
  <span class="hljs-attr">width</span>: 100px;
  <span class="hljs-attr">height</span>: 100px;
  <span class="hljs-attr">background</span>: #ff6b6b;
  margin-<span class="hljs-attr">right</span>: 10px;
}

<span class="hljs-comment">/* 问题：文字环绕浮动元素 */</span>
.<span class="hljs-property">text</span>-content {
  <span class="hljs-attr">background</span>: #f0f0f0;
  <span class="hljs-attr">padding</span>: 10px;
}

<span class="hljs-comment">/* 解决方案：创建BFC */</span>
.<span class="hljs-property">text</span>-content-bfc {
  <span class="hljs-attr">background</span>: #f0f0f0;
  <span class="hljs-attr">padding</span>: 10px;
  <span class="hljs-attr">overflow</span>: hidden; <span class="hljs-comment">/* 创建BFC，不与浮动元素重叠 */</span>
}
</code></pre>
<h2 data-id="heading-7">四、BFC vs IFC vs FFC</h2>
<p>全屏复制</p>



































<table><thead><tr><th>上下文</th><th>全称</th><th>触发条件</th><th>用途</th></tr></thead><tbody><tr><td><strong>BFC</strong></td><td>Block Formatting Context</td><td><code>overflow: hidden</code>, <code>display: flow-root</code> 等</td><td>块级布局、解决浮动塌陷</td></tr><tr><td><strong>IFC</strong></td><td>Inline Formatting Context</td><td>行内元素、<code>display: inline</code></td><td>文本、行内元素布局</td></tr><tr><td><strong>FFC</strong></td><td>Flex Formatting Context</td><td><code>display: flex</code></td><td>弹性布局</td></tr><tr><td><strong>GFC</strong></td><td>Grid Formatting Context</td><td><code>display: grid</code></td><td>网格布局</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker搭建Mysql8的主从复制]]></title>    <link>https://juejin.cn/post/7599094262593077258</link>    <guid>https://juejin.cn/post/7599094262593077258</guid>    <pubDate>2026-01-26T02:54:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599094262593077258" data-draft-id="7599268297202925606" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker搭建Mysql8的主从复制"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-26T02:54:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="优秀的颜"/> <meta itemprop="url" content="https://juejin.cn/user/960313319521178"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker搭建Mysql8的主从复制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/960313319521178/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    优秀的颜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:54:17.000Z" title="Mon Jan 26 2026 02:54:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Docker搭建Mysql8的主从复制</h2>
<p>通过Docker部署Mysql主从复制，Docker安装在前篇有，直接演示：</p>
<h3 data-id="heading-1">拉取镜像</h3>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 获取有哪些镜像</span>
<span class="hljs-string">docker</span> <span class="hljs-string">search</span> <span class="hljs-string">mysql</span>

<span class="hljs-comment"># 拉取MySQL镜像</span>
<span class="hljs-string">docker</span> <span class="hljs-string">pull</span> <span class="hljs-string">mysql:8.0.32</span>

<span class="hljs-comment"># 查看镜像</span>
<span class="hljs-string">docker</span> <span class="hljs-string">images</span>
</code></pre>
<h3 data-id="heading-2">主节点的配置</h3>
<p>创建数据存储目录</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">/docker/mysql/master/data</span>
</code></pre>
<p>创建日志目录</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">/docker/mysql/master/logs</span>
</code></pre>
<p>创建配置文件目录</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">/docker/mysql/master/conf</span>
</code></pre>
<p>进行快速启动 - 查看镜像是否有问题
注：不同的版本的配置文件位置不同，可通过快速创建，查看mysql的对应的配置文件位置，进行对应映射。</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 快速启动  -d是进行守护进程启动</span>
<span class="hljs-string">docker</span> <span class="hljs-string">run</span> <span class="hljs-string">-p</span> <span class="hljs-number">3306</span><span class="hljs-string">:3306</span> <span class="hljs-string">--name</span> <span class="hljs-string">mysql8</span> <span class="hljs-string">-e</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=123456</span> <span class="hljs-string">-d</span> <span class="hljs-string">mysql:8.0.32</span>
 
<span class="hljs-comment"># 启动成功后，进入容器内部拷贝配置文件，到宿主主机</span>
<span class="hljs-string">docker</span> <span class="hljs-string">cp</span>  <span class="hljs-string">mysql8:/etc/mysql</span> <span class="hljs-string">/docker/mysql/master/conf</span>
 
<span class="hljs-comment"># 删除刚才的容器，重新创建容器</span>
<span class="hljs-string">docker</span> <span class="hljs-string">stop</span> <span class="hljs-string">mysql8</span>
<span class="hljs-string">docker</span> <span class="hljs-string">rm</span> <span class="hljs-string">mysql8</span>
</code></pre>
<p>运行容器</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">docker</span> <span class="hljs-string">run</span> <span class="hljs-string">-p</span> <span class="hljs-number">3340</span><span class="hljs-string">:3306</span> <span class="hljs-string">--name</span> <span class="hljs-string">mysql_master</span> <span class="hljs-string">--privileged=true</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/docker/mysql/master/conf:/etc/mysql/conf.d</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/docker/mysql/master/logs:/var/log/mysql</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/docker/mysql/master/data:/var/lib/mysql</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/etc/localtime:/etc/localtime</span> <span class="hljs-string">\</span>
<span class="hljs-string">-e</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=123456</span> <span class="hljs-string">-d</span> <span class="hljs-string">mysql:8.0.32</span> <span class="hljs-string">--init-connect="SET</span> <span class="hljs-string">collation_connection=utf8mb4_0900_ai_ci"</span> <span class="hljs-string">--init-connect="SET</span> <span class="hljs-string">NAMES</span> <span class="hljs-string">utf8mb4"</span> <span class="hljs-string">--skip-character-set-client-handshake</span> 
</code></pre>
<p>进入容器</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">docker</span> <span class="hljs-string">ps</span> <span class="hljs-string">-a</span>
<span class="hljs-string">docker</span> <span class="hljs-string">exec</span> <span class="hljs-string">-it</span> <span class="hljs-string">mysql_master</span> <span class="hljs-string">/bin/bash</span>
<span class="hljs-string">docker</span> <span class="hljs-string">exec</span> <span class="hljs-string">-it</span> <span class="hljs-string">mysql_master</span> <span class="hljs-string">env</span> <span class="hljs-string">LANG=C.UTF-8</span> <span class="hljs-string">/bin/bash</span> <span class="hljs-comment"># 进入容器，这种进入避免显示中午乱码</span>

<span class="hljs-comment"># 打开MySQL，输入密码</span>
<span class="hljs-string">mysql</span> <span class="hljs-string">-uroot</span> <span class="hljs-string">-p</span>
<span class="hljs-comment"># 查看数据库</span>
<span class="hljs-string">show</span> <span class="hljs-string">databases;</span>
<span class="hljs-comment"># 创建数据库</span>
<span class="hljs-string">create</span> <span class="hljs-string">database</span> <span class="hljs-string">数据库;</span>

<span class="hljs-comment"># 如果远程链接失败，可以修改默认密码校验方式（第三方工具可以连接上）</span>
<span class="hljs-string">ALTER</span> <span class="hljs-string">USER</span> <span class="hljs-string">'root'</span><span class="hljs-string">@'%'</span> <span class="hljs-string">IDENTIFIED</span>  <span class="hljs-string">WITH</span> <span class="hljs-string">mysql_native_password</span> <span class="hljs-string">BY</span> <span class="hljs-string">'密码'</span><span class="hljs-string">;</span>
</code></pre>
<p>配置远程连接（对外连接的）</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 在MySQL下执行</span>
<span class="hljs-string">use</span> <span class="hljs-string">mysql;</span>
<span class="hljs-comment"># 创建对外访问的用户和权限</span>
<span class="hljs-string">CREATE</span> <span class="hljs-string">USER</span> <span class="hljs-string">'用户名'</span><span class="hljs-string">@'%'</span> <span class="hljs-string">IDENTIFIED</span> <span class="hljs-string">WITH</span> <span class="hljs-string">mysql_native_password</span> <span class="hljs-string">BY</span> <span class="hljs-string">'密码'</span><span class="hljs-string">;</span>
<span class="hljs-comment"># 授权全部的权限（范围大）</span>
<span class="hljs-comment"># GRANT ALL ON *.* TO '用户名'@'%' WITH GRANT OPTION;</span>
<span class="hljs-comment"># 刷新权限</span>
<span class="hljs-string">FLUSH</span> <span class="hljs-string">PRIVILEGES;</span>

<span class="hljs-comment"># 退出</span>
<span class="hljs-string">exit</span>
</code></pre>
<p>创建自定义的配置文件（主服务器配置文件）</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">cd</span> <span class="hljs-string">/docker/mysql/master/conf</span>
<span class="hljs-string">touch</span> <span class="hljs-string">my.cnf</span>
</code></pre>
<p>my.cnf文件内容：</p>
<pre><code class="hljs language-yml" lang="yml">[<span class="hljs-string">client</span>]
<span class="hljs-comment"># mysql客户端默认字符集</span>
<span class="hljs-string">default-character-set=utf8mb4</span>
[<span class="hljs-string">mysql</span>]
<span class="hljs-string">default-character-set=utf8mb4</span>
[<span class="hljs-string">mysqld</span>]
<span class="hljs-comment"># 跳过密码登录</span>
<span class="hljs-comment">#skip-grant-tables</span>
<span class="hljs-comment">#bind-address = 127.0.0.1</span>
<span class="hljs-string">init_connect='SET</span> <span class="hljs-string">collation_connection</span> <span class="hljs-string">=</span> <span class="hljs-string">utf8mb4_general_ci'</span>
<span class="hljs-string">init_connect='SET</span> <span class="hljs-string">NAMES</span> <span class="hljs-string">utf8mb4'</span>
<span class="hljs-comment"># mysql服务端默认字符集</span>
<span class="hljs-string">character-set-server=utf8mb4</span>
<span class="hljs-string">collation-server=utf8mb4_general_ci</span>
<span class="hljs-string">skip-character-set-client-handshake</span>
<span class="hljs-comment"># datadir=/var/lib/mysql  </span>

<span class="hljs-comment"># 主服务器唯一ID 默认是1</span>
<span class="hljs-string">server-id=1</span>
<span class="hljs-comment"># 设置不要复制的数据库</span>
<span class="hljs-string">binlog-ignore-db=mysql</span>
<span class="hljs-string">binlog-ignore-db=information_schema</span>
<span class="hljs-string">binlog-ignore-db=performance_schema</span>
<span class="hljs-comment"># 设置需要复制的数据库（先创建好）</span>
<span class="hljs-string">binlog-do-db=数据库名</span>
<span class="hljs-comment"># 启用二进制日志，日志的存放地址(默认是binlog)，就是在show master status;看到Filed名字</span>
<span class="hljs-string">log-bin=/var/lib/mysql/mysql-bin</span>
<span class="hljs-comment"># 主机，1 只读 0 读写（默认是0）</span>
<span class="hljs-string">read-only=0</span>
<span class="hljs-comment"># 设置logbin格式 有3种格式 </span>
<span class="hljs-comment"># STATEMENT(函数支持不好) 写指令，会出现主从数据不同步，now（）函数</span>
<span class="hljs-comment"># ROW(行模式大量修改效率不行，但支持存储引擎) - 默认的</span>
<span class="hljs-comment"># MIXED (综合，推荐)</span>
<span class="hljs-string">binlog_format=mixed</span>
<span class="hljs-comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span>
<span class="hljs-comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span>
<span class="hljs-string">slave_skip_errors=1062</span>
<span class="hljs-comment"># 二进制日志过期清理时间，默认是0（不自动清理）</span>
<span class="hljs-string">expire_logs_days=7</span>
<span class="hljs-comment"># 单个二进制日志大小</span>
<span class="hljs-string">max_binlog_size=200M</span>
<span class="hljs-comment"># 设置每隔多少次事务提交操作，将这些操作写入二进制日志文件</span>
<span class="hljs-string">sync_binlog=1</span>
<span class="hljs-comment"># 使用mysql_native_password插件的认证</span>
<span class="hljs-comment"># default_authentication_plugin=mysql_native_password</span>
</code></pre>
<p>重启mysql容器</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">docker</span> <span class="hljs-string">ps</span> <span class="hljs-string">-a</span>
<span class="hljs-string">docker</span> <span class="hljs-string">restart</span> <span class="hljs-string">容器id</span>
</code></pre>
<h4 data-id="heading-3"><strong>创建用户并授权给从机</strong></h4>
<p>主机创建用户：</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 连接上Mysql服务，执行</span>
<span class="hljs-string">create</span> <span class="hljs-string">user</span> <span class="hljs-string">'用户名'</span><span class="hljs-string">@'%'</span> <span class="hljs-string">identified</span> <span class="hljs-string">with</span> <span class="hljs-string">mysql_native_password</span> <span class="hljs-string">by</span> <span class="hljs-string">'密码'</span><span class="hljs-string">;</span>
<span class="hljs-comment"># 授权复制的权限 ON后的*.*代表全部的库和表</span>
<span class="hljs-string">GRANT</span> <span class="hljs-string">REPLICATION</span> <span class="hljs-string">SLAVE</span> <span class="hljs-string">ON</span> <span class="hljs-string">*.*</span> <span class="hljs-string">TO</span> <span class="hljs-string">'用户名'</span><span class="hljs-string">@'%';</span>
<span class="hljs-comment"># 刷新权限</span>
<span class="hljs-string">FLUSH</span> <span class="hljs-string">PRIVILEGES;</span>

<span class="hljs-comment"># 如果远程链接失败，可以修改默认密码校验方式（第三方工具可以连接上）</span>
<span class="hljs-string">alter</span> <span class="hljs-string">user</span> <span class="hljs-string">'用户名'</span><span class="hljs-string">@'%'</span> <span class="hljs-string">identified</span> <span class="hljs-string">with</span> <span class="hljs-string">mysql_native_password</span> <span class="hljs-string">by</span> <span class="hljs-string">'密码'</span><span class="hljs-string">;</span>
</code></pre>
<p>查询主机的状态：</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">show</span> <span class="hljs-string">master</span> <span class="hljs-string">status;</span>
<span class="hljs-comment"># 执行上面命令，得到 File(binlog日志) Position(接入点) Binlog_Do_DB(要复制的数据库) Binlog_IgnoreDB()</span>
<span class="hljs-comment"># 需要记录一下File、Position</span>
</code></pre>
<h3 data-id="heading-4">从节点配置</h3>
<p>创建数据目录</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">/docker/mysql/slave/data</span>
</code></pre>
<p>创建日志目录</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">/docker/mysql/slave/logs</span>
</code></pre>
<p>创建配置文件目录</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">/docker/mysql/slave/conf</span>
</code></pre>
<p>创建自定义的配置文件</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">cd</span> <span class="hljs-string">/docker/mysql/slave/conf</span>
<span class="hljs-string">touch</span> <span class="hljs-string">my.cnf</span>
</code></pre>
<p>mysql.cnf文件内容：</p>
<pre><code class="hljs language-yml" lang="yml">[<span class="hljs-string">client</span>]
<span class="hljs-comment"># mysql客户端默认字符集</span>
<span class="hljs-string">default-character-set=utf8mb4</span>
[<span class="hljs-string">mysql</span>]
<span class="hljs-string">default-character-set=utf8mb4</span>
[<span class="hljs-string">mysqld</span>]
<span class="hljs-comment"># 跳过密码登录</span>
<span class="hljs-comment">#skip-grant-tables</span>
<span class="hljs-comment">#bind-address = 127.0.0.1</span>
<span class="hljs-string">init_connect='SET</span> <span class="hljs-string">collation_connection</span> <span class="hljs-string">=</span> <span class="hljs-string">utf8mb4_general_ci'</span>
<span class="hljs-string">init_connect='SET</span> <span class="hljs-string">NAMES</span> <span class="hljs-string">utf8mb4'</span>
<span class="hljs-comment"># mysql服务端默认字符集</span>
<span class="hljs-string">character-set-server=utf8mb4</span>
<span class="hljs-string">collation-server=utf8mb4_general_ci</span>
<span class="hljs-string">skip-character-set-client-handshake</span>
<span class="hljs-comment"># datadir=/var/lib/mysql  </span>

<span class="hljs-comment"># 从服务器唯一ID</span>
<span class="hljs-string">server-id</span> <span class="hljs-string">=</span> <span class="hljs-number">2</span>  
<span class="hljs-comment"># 开启中继日志</span>
<span class="hljs-string">relay-log=mysql-relay</span>
<span class="hljs-comment"># 从机，1 只读 0 读写（默认是0）</span>
<span class="hljs-string">read-only=1</span>
<span class="hljs-comment"># 启用二进制日志，日志的存放地址，如果从机变成主机可以继续使用bin日志</span>
<span class="hljs-comment"># log-bin=mysql-slave-bin</span>
<span class="hljs-comment"># 使用mysql_native_password插件的认证</span>
<span class="hljs-comment"># default_authentiction_plugin=mysql_native_password</span>
</code></pre>
<p>运行容器</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">docker</span> <span class="hljs-string">run</span> <span class="hljs-string">-p</span> <span class="hljs-number">3341</span><span class="hljs-string">:3306</span> <span class="hljs-string">--name</span> <span class="hljs-string">mysql_slave</span> <span class="hljs-string">--privileged=true</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/docker/mysql/slave/conf:/etc/mysql/conf.d</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/docker/mysql/slave/logs:/var/log/mysql</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/docker/mysql/slave/data:/var/lib/mysql</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/etc/localtime:/etc/localtime</span> <span class="hljs-string">\</span>
<span class="hljs-string">-e</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=123456</span> <span class="hljs-string">-d</span> <span class="hljs-string">mysql:8.0.32</span> <span class="hljs-string">--init-connect="SET</span> <span class="hljs-string">collation_connection=utf8mb4_0900_ai_ci"</span> <span class="hljs-string">--init-connect="SET</span> <span class="hljs-string">NAMES</span> <span class="hljs-string">utf8mb4"</span> <span class="hljs-string">--skip-character-set-client-handshake</span> 
</code></pre>
<p>进入容器</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">docker</span> <span class="hljs-string">ps</span> <span class="hljs-string">-a</span>
<span class="hljs-string">docker</span> <span class="hljs-string">exec</span> <span class="hljs-string">-it</span> <span class="hljs-string">mysql_slave</span> <span class="hljs-string">/bin/bash</span>
</code></pre>
<p>配置远程连接（对外连接的）</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 打开MySQL，输入密码</span>
<span class="hljs-string">mysql</span> <span class="hljs-string">-uroot</span> <span class="hljs-string">-p</span>
<span class="hljs-comment"># 查看数据库</span>
<span class="hljs-string">show</span> <span class="hljs-string">databases;</span>
<span class="hljs-comment"># 创建数据库</span>
<span class="hljs-string">create</span> <span class="hljs-string">database</span> <span class="hljs-string">数据库;</span>
<span class="hljs-comment"># 查看数据库</span>
<span class="hljs-comment"># 在MySQL下执行</span>
<span class="hljs-string">use</span> <span class="hljs-string">mysql;</span>
<span class="hljs-comment"># 创建对外访问的用户和权限</span>
<span class="hljs-string">CREATE</span> <span class="hljs-string">USER</span> <span class="hljs-string">'用户名'</span><span class="hljs-string">@'%'</span> <span class="hljs-string">IDENTIFIED</span> <span class="hljs-string">BY</span> <span class="hljs-string">'密码'</span><span class="hljs-string">;</span>
<span class="hljs-string">GRANT</span> <span class="hljs-string">ALL</span> <span class="hljs-string">ON</span> <span class="hljs-string">*.*</span> <span class="hljs-string">TO</span> <span class="hljs-string">'用户名'</span><span class="hljs-string">@'%'</span> <span class="hljs-string">WITH</span> <span class="hljs-string">GRANT</span> <span class="hljs-string">OPTION;</span>
<span class="hljs-string">FLUSH</span> <span class="hljs-string">PRIVILEGES;</span>

<span class="hljs-comment"># 退出</span>
<span class="hljs-string">exit</span>
</code></pre>
<h4 data-id="heading-5">设置同步信息</h4>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 停止同步(之前配置过，需要执行)</span>
<span class="hljs-string">stop</span> <span class="hljs-string">slave;</span>

<span class="hljs-comment"># 设置同步</span>
<span class="hljs-string">CHANGE</span> <span class="hljs-string">MASTER</span> <span class="hljs-string">TO</span> <span class="hljs-string">MASTER_HOST='主机IP地址',</span>
<span class="hljs-string">MASTER_PORT=端口,</span>
<span class="hljs-string">MASTER_USER='主机用户',MASTER_PASSWORD='主机用户的密码',</span>
<span class="hljs-string">MASTER_LOG_FILE='binlog日志名字',</span>
<span class="hljs-string">MASTER_CONNECT_RETRY=30,</span>
<span class="hljs-string">MASTER_LOG_POS=具体的接入点值;</span>

<span class="hljs-comment"># MASTER_CONNECT_RETRY 是如果连接失败，重试时间间隔，默认60秒</span>
</code></pre>
<p>如果操作失败，需要重新配置，执行下面2个命令</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">stop</span> <span class="hljs-string">slave;</span>    <span class="hljs-comment"># 停止同步操作</span>
<span class="hljs-string">reset</span> <span class="hljs-string">master;</span>  <span class="hljs-comment"># 重置主从配置，删除之前的中继日志，会再生成一份新的</span>
</code></pre>
<p>开始同步</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">start</span> <span class="hljs-string">slave;</span>
</code></pre>
<p>检查是否成功</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">show</span> <span class="hljs-string">slave</span> <span class="hljs-string">status</span> <span class="hljs-string">\G;</span>  <span class="hljs-comment"># 检查状态</span>
<span class="hljs-comment"># 如果结果下面的字段为Yes 代表配置成功</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">Slave_IO_Running:</span> <span class="hljs-literal">Yes</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">Slave_SQL_Running:</span> <span class="hljs-literal">Yes</span>
</code></pre>
<p>停止和重置</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 从机上执行，停止I/O 线程和SQL线程的操作</span>
<span class="hljs-string">stop</span> <span class="hljs-string">slave;</span> 

<span class="hljs-comment"># 从机上执行，用于删除SLAVE数据库的relaylog日志文件，并重新启用新的relaylog文件</span>
<span class="hljs-string">reset</span> <span class="hljs-string">slave;</span>

<span class="hljs-comment"># 主机上执行，删除所有的binglog日志文件，并将日志索引文件清空，重新开始所有新的日志文件</span>
<span class="hljs-string">reset</span> <span class="hljs-string">master;</span>
</code></pre>
<h3 data-id="heading-6">验证</h3>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 从主机上，创建表、插入SQL语句</span>
<span class="hljs-comment"># 创建表</span>
<span class="hljs-string">CREATE</span> <span class="hljs-string">TABLE</span> <span class="hljs-string">`emp`</span> <span class="hljs-string">(</span>
  <span class="hljs-string">`id`</span> <span class="hljs-string">int(11)</span> <span class="hljs-string">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-string">COMMENT</span> <span class="hljs-string">'主键'</span><span class="hljs-string">,</span>
  <span class="hljs-string">`name`</span> <span class="hljs-string">varchar(255)</span>  <span class="hljs-string">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-string">COMMENT</span> <span class="hljs-string">'员工名'</span><span class="hljs-string">,</span>
  <span class="hljs-string">`age`</span> <span class="hljs-string">int(11)</span> <span class="hljs-string">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-string">COMMENT</span> <span class="hljs-string">'年龄'</span><span class="hljs-string">,</span>
  <span class="hljs-string">`did`</span> <span class="hljs-string">int(11)</span> <span class="hljs-string">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-string">COMMENT</span> <span class="hljs-string">'部门id'</span><span class="hljs-string">,</span>
  <span class="hljs-string">PRIMARY</span> <span class="hljs-string">KEY</span> <span class="hljs-string">(`id`)</span>
<span class="hljs-string">)</span> <span class="hljs-string">ENGINE=InnoDB</span> <span class="hljs-string">DEFAULT</span> <span class="hljs-string">CHARSET=utf8mb4</span> <span class="hljs-string">COLLATE=utf8mb4_0900_ai_ci</span> <span class="hljs-string">COMMENT='部门表';</span>
<span class="hljs-string">INSERT</span> <span class="hljs-string">INTO</span> <span class="hljs-string">emp</span> <span class="hljs-string">(`id`,</span> <span class="hljs-string">`name`,</span> <span class="hljs-string">`age`,</span> <span class="hljs-string">`did`)</span> <span class="hljs-string">VALUES</span> <span class="hljs-string">(1,</span> <span class="hljs-string">'刘备'</span><span class="hljs-string">,</span> <span class="hljs-number">55</span><span class="hljs-string">,</span> <span class="hljs-number">1</span><span class="hljs-string">);</span>
<span class="hljs-comment"># 分别 在主机和从机进行查询该SQL语句</span>
<span class="hljs-string">select</span> <span class="hljs-string">*</span> <span class="hljs-string">from</span>  <span class="hljs-string">emp;</span>
<span class="hljs-comment"># 如：都看到相同的数据，代表成功</span>
</code></pre>
<h3 data-id="heading-7">常见问题</h3>
<p>启动主从同步后，常见错误是<code>Slave_IO_Running： No 或者 Connecting</code> 的情况，此时查看下方的 <code>Last_IO_ERROR</code>错误日志，根据日志中显示的错误信息在网上搜索解决方案即可</p>
<p>一 常见错误：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">`Last_IO_Error: Got fatal <span class="hljs-keyword">error</span> <span class="hljs-number">1236</span> <span class="hljs-keyword">from</span> master <span class="hljs-keyword">when</span> reading data <span class="hljs-keyword">from</span> <span class="hljs-keyword">binary</span> log: <span class="hljs-comment">'Client requested master to start replication from position &gt; file size'`</span>
</code></pre>
<p>解决：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 在从机停止slave</span>
SLAVE STOP;

<span class="hljs-comment">-- 在主机查看mater状态</span>
<span class="hljs-keyword">SHOW</span> MASTER STATUS;
<span class="hljs-comment">-- 在主机刷新日志</span>
FLUSH LOGS;
<span class="hljs-comment">-- 再次在主机查看mater状态（会发现File和Position发生了变化）</span>
<span class="hljs-keyword">SHOW</span> MASTER STATUS;
<span class="hljs-comment">-- 修改从机连接主机的SQL，并重新连接即可</span>
</code></pre>
<p>二：启动docker容器后提示 <code>WARNING: IPv4 forwarding is disabled. Networking will not work.</code></p>
<p>解决：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#修改配置文件：</span>
vim /usr/lib/sysctl.d/00-system.conf
<span class="hljs-comment">#追加</span>
<span class="hljs-attr">net.ipv4.ip_forward</span>=<span class="hljs-number">1</span>
<span class="hljs-comment">#接着重启网络</span>
systemctl restart network
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[收藏！LLM开发全链路：5大步骤+15大框架，从数据治理到RLHF一文通关]]></title>    <link>https://juejin.cn/post/7599094262592045066</link>    <guid>https://juejin.cn/post/7599094262592045066</guid>    <pubDate>2026-01-26T00:11:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599094262592045066" data-draft-id="7598480267218845730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="收藏！LLM开发全链路：5大步骤+15大框架，从数据治理到RLHF一文通关"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-26T00:11:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AIFrontiers"/> <meta itemprop="url" content="https://juejin.cn/user/4443547050451306"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            收藏！LLM开发全链路：5大步骤+15大框架，从数据治理到RLHF一文通关
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4443547050451306/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AIFrontiers
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:11:42.000Z" title="Mon Jan 26 2026 00:11:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读35分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FoRUjkoUcHOrMtHfVHkr5Cw" target="_blank" title="https://mp.weixin.qq.com/s/oRUjkoUcHOrMtHfVHkr5Cw" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/oRUjkoUcH…</a></p>
<p><strong>LLM</strong> <strong>往期文章推荐</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fcx3qY42Lp0L3RaSOgsH77A" target="_blank" title="https://mp.weixin.qq.com/s/cx3qY42Lp0L3RaSOgsH77A" ref="nofollow noopener noreferrer">小白也能看懂的RL-PPO</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FnfN0dWT3ZfDuW7ZGfaG6dA" target="_blank" title="https://mp.weixin.qq.com/s/nfN0dWT3ZfDuW7ZGfaG6dA" ref="nofollow noopener noreferrer">收藏！强化学习从入门到封神：5 本经典教材 + 8 大实战项目 + 7个免费视频，一站式搞定</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F4_6CBXMJhqmiYKSzsAXncg" target="_blank" title="https://mp.weixin.qq.com/s/4_6CBXMJhqmiYKSzsAXncg" ref="nofollow noopener noreferrer">小白也能看懂的RLHF：基础篇</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F8O7W8--x14-b1d3M9IS_3w" target="_blank" title="https://mp.weixin.qq.com/s/8O7W8--x14-b1d3M9IS_3w" ref="nofollow noopener noreferrer">小白也能看懂的RLHF-PPO：原理篇</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9KT9LrMTXDGHSvGFrQhRkg" target="_blank" title="https://mp.weixin.qq.com/s/9KT9LrMTXDGHSvGFrQhRkg" ref="nofollow noopener noreferrer">小白也能看懂的LLM-RL算法：PPO/DPO/GRPO/GSPO</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9f4mqYVGKNS-LhmHLl6CXw" target="_blank" title="https://mp.weixin.qq.com/s/9f4mqYVGKNS-LhmHLl6CXw" ref="nofollow noopener noreferrer">收藏！LLM-RL训练框架：3大流派+6大框架，一文搞定</a></p>
<p>在上一篇<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9f4mqYVGKNS-LhmHLl6CXw" target="_blank" title="https://mp.weixin.qq.com/s/9f4mqYVGKNS-LhmHLl6CXw" ref="nofollow noopener noreferrer">收藏！LLM-RL训练框架：3大流派+6大框架，一文搞定</a>中，我们重点讨论了LLM训练技术的开源框架，并未涉及LLM训练的其他环节。在人工智能领域从模型中心化向数据中心化范式转移的背景下，LLM的成功不仅依赖于模型参数规模的爆炸式增长，更取决于全链路工程化的精细程度。</p>
<p>这一链路涵盖了从海量异构数据的精炼、超大规模分布式环境下的模型训练、特定任务驱动的指令微调，到最终模型输出与人类价值观对齐的RLHF阶段。如近的开源生态系统已涌现出一批高性能、模块化且落地性强的代码框架，这些工具极大地降低了开发者训练、微调和部署私有化大模型的门槛。本篇将对这一全链路中的核心开源框架进行深度的技术解构，分析其底层机制、性能指标及行业应用场景。</p>
<h2 data-id="heading-0">1 分布式数据清洗与编排引擎</h2>
<p>数据质量是LLM性能的生命线。当前工业界的共识是，高质量的合成数据和经过严苛清洗的NLP语料对提升模型逻辑推理能力至关重要。当数据规模达到PB级时，单机处理变得不可行。异构脏数据的处理流程需要复杂的任务编排和大规模分布式计算的支持。</p>
<h3 data-id="heading-1">1.1 <strong>Data-Juicer</strong></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89ddcae485144e6d8eac40455408cb66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=5KG9FkaBX4rfG39k1cNDOolCkgM%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>gitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdatajuicer%2Fdata-juicer" target="_blank" title="https://github.com/datajuicer/data-juicer" ref="nofollow noopener noreferrer">github.com/datajuicer/…</a> 5.8k⭐</p>
</li>
<li>
<p>说明文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdatajuicer.github.io%2Fdata-juicer%2Fzh_CN%2Fmain%2Fdocs_index_ZH.html" target="_blank" title="https://datajuicer.github.io/data-juicer/zh_CN/main/docs_index_ZH.html" ref="nofollow noopener noreferrer">datajuicer.github.io/data-juicer…</a></p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2501.14755v2" target="_blank" title="https://arxiv.org/pdf/2501.14755v2" ref="nofollow noopener noreferrer">arxiv.org/pdf/2501.14…</a></p>
</li>
</ul>
<h4 data-id="heading-2"><strong>核心特点</strong></h4>
<ul>
<li>
<p><strong>一站式与系统化</strong>：涵盖了数据分析、清洗、过滤、转换、去重及合成的完整链路。它不仅是一个工具包，更是一个完整的系统，提供了100多个核心算子。</p>
</li>
<li>
<p><strong>多模态支持</strong>：除了基础的文本数据，Data-Juicer 2.0及后续版本深度支持图像、视频、音频等多种模态，能够处理复杂的交织多模态数据。</p>
</li>
<li>
<p><strong>高效扩展</strong>：基于Ray和CUDA优化，支持单机到数千核集群的弹性扩展，性能经工业级验证。</p>
</li>
<li>
<p><strong>数据-模型共开发（Sandbox）</strong> ：提供沙盒机制，允许开发者在小规模数据上快速迭代实验，通过反馈循环和可视化工具快速验证数据改进对模型效果的影响。</p>
</li>
</ul>
<h4 data-id="heading-3">适用场景</h4>
<ul>
<li>
<p><strong>预训练/微调加速</strong>：对海量网页数据去噪，或筛选高质量、高多样性的指令微调数据。</p>
</li>
<li>
<p><strong>多模态生成训练</strong>：为类似Sora的视频生成或多模态大模型准备精细化标注与清洗后的语料。</p>
</li>
<li>
<p><strong>自动化数据工程</strong>：利用AI算子自动生成、重写数据，或探索最优数据混合比例。</p>
</li>
</ul>
<h4 data-id="heading-4">优缺点</h4>
<p><strong>优点</strong>：① 工业级成熟度：源自阿里巴巴通义实验室，经过大规模生产环境验证，算子丰富且性能优异；② 生态集成度高：与ModelScope（魔搭社区）、LLaMA-Factory、Ray等主流大模型生态深度打通，方便开发者集成到现有流水线；③ 灵活易用：对于新手，可以直接使用官方提供的最佳实践配置；对于高级用户，可以通过 Python 灵活自定义算子。</p>
<p><strong>缺点</strong>：① 学习成本：算子库庞大，需一定时间摸索最佳参数组合；② 资源需求：部分高级算子（如模型打分）依赖计算资源，处理海量数据时成本较高。</p>
<h3 data-id="heading-5">1.2 Datatrove</h3>
<ul>
<li>github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fdatatrove" target="_blank" title="https://github.com/huggingface/datatrove" ref="nofollow noopener noreferrer">github.com/huggingface…</a> 2.8k⭐</li>
</ul>
<h4 data-id="heading-6">关键特<strong>性</strong></h4>
<ul>
<li>
<p><strong>平台无关的流水线</strong>：代码在本地机器、Slurm集群或 Ray集群上运行时几乎不需要改动。它通过执行器机制抽象了底层算力。</p>
</li>
<li>
<p><strong>低</strong> <strong>内存</strong> <strong>占用与流式处理</strong>：采用生成器模式，数据以流的形式通过处理模块，即便处理数百TB的数据，内存消耗也能控制在较低水平。</p>
</li>
<li>
<p><strong>强大的去重功能</strong>：内置了工业级的去重算法，包括MinHash（模糊去重）和Exact Substring（精确子串去重），这是处理网页抓取数据的关键。</p>
</li>
<li>
<p><strong>容错与断点续传</strong>：能够自动跟踪已完成的任务，如果作业在集群中崩溃，重启后会自动跳过已处理的部分。</p>
</li>
</ul>
<h4 data-id="heading-7">适用场景</h4>
<ul>
<li>
<p><strong>LLM</strong> <strong>预训练清洗</strong>：处理Common Crawl等原始网页快照，提取纯净文本并剔除低质量内容。。</p>
</li>
<li>
<p><strong>超大规模去重</strong>：在海量数据中精准剔除重复或高度相似的文档。</p>
</li>
<li>
<p><strong>分布式</strong> <strong>数据工程</strong>：利用Slurm或Ray等集群环境快速处理万亿规模的数据集。</p>
</li>
</ul>
<h4 data-id="heading-8">优缺点</h4>
<p><strong>优点</strong>：① 极致的扩展性：不是为了处理小样本设计的，而是为了处理万亿级Token设计的，在Slurm或Ray分布式环境下表现极佳；②简洁的API：Pythonic风格，模块化程度高，易于自定义扩展；③ 与生态深度集成：与Hugging Face Hub和fsspec深度整合，支持直接读写S3、Hugging Face数据仓库。</p>
<p><strong>缺点</strong>：①主要侧重文本：理论上虽然可以处理其他数据，但目前其生态和预置算子主要集中在文本领域。在多模态（图像、视频）算子的丰富度上，目前弱于Data-Juicer；② 文档相对精简：相比一些商业化或历史悠久的框架，其详细文档和教程仍在完善中，更多依赖示例代码（Examples）。</p>
<h2 data-id="heading-9">2 分布式预训练与模型训练底层架构</h2>
<p>当数据准备就绪后，如何将其高效地输入到分布式计算集群中进行训练成为核心挑战。因单个GPU的显存（如H100的80GB）远不足以容纳100+B参数的模型、及其优化器状态和梯度，分布式并行策略成为了现代训练框架的基石。</p>
<h3 data-id="heading-10">2.1 Megatron-LM</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/543728942fb54ffe99c39cd4fcceb735~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=Vl3MZyjRupsHVfxnhR13ExIyn50%3D" alt="" loading="lazy"/></p>
<ul>
<li>Github : <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FNVIDIA%2FMegatron-LM" target="_blank" title="https://github.com/NVIDIA/Megatron-LM" ref="nofollow noopener noreferrer">github.com/NVIDIA/Mega…</a> 15k⭐</li>
<li>官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nvidia.com%2Fmegatron-core%2Findex.html" target="_blank" title="https://docs.nvidia.com/megatron-core/index.html" ref="nofollow noopener noreferrer">docs.nvidia.com/megatron-co…</a></li>
<li>论文1：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F1909.08053" target="_blank" title="https://arxiv.org/pdf/1909.08053" ref="nofollow noopener noreferrer">arxiv.org/pdf/1909.08…</a></li>
<li>论文2：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2104.04473" target="_blank" title="https://arxiv.org/pdf/2104.04473" ref="nofollow noopener noreferrer">arxiv.org/pdf/2104.04…</a></li>
<li>论文3：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2205.05198" target="_blank" title="https://arxiv.org/pdf/2205.05198" ref="nofollow noopener noreferrer">arxiv.org/pdf/2205.05…</a></li>
</ul>
<p>Megatron-LM作为由NVIDIA深度开发的分布式训练框架，核心贡献在于提出并完善了多维并行体系，特别是针对 Transformer 结构的深度优化，在大模型预训练领域占据着举足轻重的地位。其设计哲学始终围绕着如何榨干NVIDIA GPU的每一分性能，特别是利用高性能NVLink互联和CUDA内核融合技术。</p>
<h4 data-id="heading-11">关键特性与底层架构分析</h4>
<p>核心贡献在于提出并完善了多维并行体系，特别是针对 Transformer结构的深度优化。</p>
<ul>
<li><strong>多维</strong> <strong>并行计算</strong> <strong>架构</strong>：将计算任务在三个维度进行解耦：层内计算（张量并行）、层间计算（流水线并行）以及批次数据（数据并行）。张量并行（Tensor Parallelism）是一种层内并行技术，将Transformer层的矩阵乘法操作沿列或行进行拆分。例如，在注意力机制的QKV投影层，通过将输出维度（列）切分到不同GPU，每个进程仅需存储和计算部分参数，最后通过All-Reduce操作聚合梯度。这种精细化的切分使得单卡无法容纳的大型层得以在节点内高效运行。</li>
<li><strong>流水线</strong> <strong>并行</strong> <strong>的1F1B调度</strong>：为了解决跨层并行的负载均衡问题，Megatron-LM引入了1F1B（One-Forward-One-Backward）调度算法。通过将全局批次切分为多个微批次（Micro-batches），1F1B允许不同的流水线阶段在同一时间点并行处理不同的微批次，极大地压缩了流水线气泡（Pipeline Bubble）占用的时间比例，从而提升了集群的整体利用率。</li>
<li><strong>序列</strong> <strong>并行</strong> <strong>与上下文并行</strong>：针对长文本训练需求，实现了序列并行（Sequence Parallelism），它将非张量并行部分（如LayerNorm和Dropout）沿序列维度进一步拆分，有效减少了冗余的显存占用。而在处理超长上下文（如 32K及以上tokens）时，上下文并行（Context Parallelism）则通过跨设备分配序列片段来应对激活值内存激增的挑战。</li>
<li><strong>Megatron Core (MCore)</strong> ：作为该框架的最新演进版本，MCore采用了模块化、组件化的设计理念。它通过Composable APIs允许用户灵活构建自定义训练流程，并集成了混合专家模型的先进支持，包括针对 DeepSeek-V3等架构的深度优化，支持 DeepEP、HybridEP等高效的Token调度算法，旨在实现异构数据中心规模下的高弹性能。</li>
</ul>
<h4 data-id="heading-12">适合场景与性能边界</h4>
<p>Megatron-LM专为拥有高性能计算集群（尤其是具备 NVLink 节点内互联的高端NVIDIA GPU环境）的团队设计。它是训练基础大模型（如Deepseek等级模型）的参考实现，特别是在需要追求极致的TFLOPS吞吐量时，其定制化的CUDA内核融合技术（能减少显存访问开销约 40%）展现出了巨大的技术优势。</p>
<h4 data-id="heading-13">优缺点</h4>
<p><strong>优点</strong>：① 性能极致：通过高度优化的算子融合和硬件感知通信，实现业界最高的显存和算力效率 ；② 稳定性强：作为NVIDIA官方维护项目，对Hopper/Blackwell等新架构的支持最为迅速且深度；③ 工业标准：其提出的3D并行方案已成为大规模训练的事实标准。</p>
<p><strong>缺点</strong>：① 开发难度高：代码侵入性强，对非Transformer架构的适配极其复杂，需要深厚的系统编程功底；② 灵活性受限：由于过度依赖NVLink和专有算子，在非同构网络或显存极度受限的异构环境下表现不如DeepSpeed。</p>
<h3 data-id="heading-14">2.2  DeepSpeed</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/324a2f8b379c40989b2c089f27950f70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=cRaCMZaCUP9JPm%2Fm9Z7ZtcDsuko%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>gitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepspeedai%2FDeepSpeed" target="_blank" title="https://github.com/deepspeedai/DeepSpeed" ref="nofollow noopener noreferrer">github.com/deepspeedai…</a> 41.3k⭐</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2FDeepSpeedExamples" target="_blank" title="https://github.com/microsoft/DeepSpeedExamples" ref="nofollow noopener noreferrer">github.com/microsoft/D…</a> 6.8k⭐</li>
</ul>
</li>
<li>
<p>官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeepspeed.readthedocs.io%2Fen%2Fstable%2Fzero3.html" target="_blank" title="https://deepspeed.readthedocs.io/en/stable/zero3.html" ref="nofollow noopener noreferrer">deepspeed.readthedocs.io/en/stable/z…</a></p>
</li>
<li>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.deepspeed.ai%2F" target="_blank" title="https://www.deepspeed.ai/" ref="nofollow noopener noreferrer">www.deepspeed.ai/</a></p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2308.01320" target="_blank" title="https://arxiv.org/pdf/2308.01320" ref="nofollow noopener noreferrer">arxiv.org/pdf/2308.01…</a></p>
</li>
</ul>
<p>DeepSpeed是微软在大模型训练领域推出的另一力作，其设计重心在于解决大模型训练中的显存瓶颈问题。通过零冗余优化器（ZeRO）系列技术，DeepSpeed极大地降低了训练超大规模模型的准入门槛。</p>
<h4 data-id="heading-15">关键技术深度解析</h4>
<p>DeepSpeed的核心架构由ZeRO优化器及其衍生的异构存储技术构成。</p>
<ul>
<li>
<p><strong>ZeRO</strong> <strong>优化器</strong> <strong>（ZeRO-1/2/3）</strong> ：ZeRO技术的精髓在于消除模型状态的冗余存储。在传统数据并行中，每个GPU都保存完整的模型状态，而ZeRO则将这些状态进行分片（Sharding）。ZeRO-1仅对优化器状态进行分片；ZeRO-2进一步对梯度进行分片；ZeRO-3则实现了对参数、梯度和优化器状态的全量分片存储。这种策略使得显存消耗随设备数的增加而线性下降。</p>
</li>
<li>
<p><strong>ZeRO-Offload与ZeRO-Infinity</strong>：针对显存严重短缺的场景，DeepSpeed提出了异构内存利用方案。ZeRO-Offload利用CPU内存存储并处理优化器状态更新，而ZeRO-Infinity则将这一思路推向极致，通过高效的Infinity Offload引擎同时利用GPU显存、CPU内存和NVMe SSD，支持在单个GPU上训练高达130亿参数的模型，或在集群上支持万亿参数规模。</p>
</li>
<li>
<p><strong>DeepSpeed-Ulysses序列</strong> <strong>并行</strong>：相比Megatron的序列并行，Ulysses采用了一种更通用的All-to-All通信机制。它在注意力计算前后重新分配数据，使得每个GPU能够完整地看到全局上下文，但仅负责计算部分注意力头，这在长序列训练中展现出了极佳的带宽效率。</p>
</li>
<li>
<p><strong>混合3D</strong> <strong>并行</strong> <strong>集成</strong>：DeepSpeed通过与Megatron-LM的深度融合，将ZeRO技术与张量并行、流水线并行相结合，形成了一套完整的万亿级模型训练方案。其提供的TiledLinear模块进一步通过内存平铺技术减少了算子的峰值内存需求。</p>
</li>
</ul>
<h4 data-id="heading-16">适合场景</h4>
<p>DeepSpeed是资源异构或受限环境下的不二之选。无论是需要在中小规模集群上微调百亿参数模型，还是在跨节点的非高速互联环境下进行预训练，其强大的显存管理能力都能确保持续运行。此外，由于其与 Hugging Face等开源生态结合紧密，它是研究人员和企业进行快速实验和模型私有化部署的首选框架。</p>
<h4 data-id="heading-17">优缺点</h4>
<p><strong>优点</strong>：① 显存效率极高：ZeRO-3与Infinity技术极大地打破了内存墙，支持单机训练超大规模模型；② 易用性与兼容性：通过简单的JSON配置文件即可启用复杂功能，无需大规模重构PyTorch代码；③ 生态开放：支持包括AMD、Intel 在内的多种硬件平台，广泛集成于第三方库。</p>
<p><strong>缺点</strong>：① 通信开销风险：在开启深度Offload模式下，由于受限于PCIe带宽，计算效率可能大幅下降；② 复杂系统集成：在将ZeRO与3D并行结合使用时，参数配置与负载均衡的调优极其繁琐。</p>
<h3 data-id="heading-18">2.3 Colossal-AI</h3>
<ul>
<li>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhpcaitech%2FColossalAI" target="_blank" title="https://github.com/hpcaitech/ColossalAI" ref="nofollow noopener noreferrer">github.com/hpcaitech/C…</a> 41.3k⭐</p>
</li>
<li>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcolossalai.org%2F" target="_blank" title="https://colossalai.org/" ref="nofollow noopener noreferrer">colossalai.org/</a></p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2110.14883" target="_blank" title="https://arxiv.org/pdf/2110.14883" ref="nofollow noopener noreferrer">arxiv.org/pdf/2110.14…</a></p>
</li>
</ul>
<p>Colossal-AI由潞晨科技团队开发，致力于通过统一的并行接口和智能化的内存管理，将复杂的分布式训练大众化。其最大的特色在于对异构内存的精细化控制以及自动并行化搜索技术。</p>
<h4 data-id="heading-19">关键技术特性分析</h4>
<p>Colossal-AI引入了一系列旨在提升资源利用率和开发效率的底层机制。</p>
<ul>
<li>
<p><strong>Gemini动态异构</strong> <strong>内存</strong> <strong>管理器</strong>：Gemini是Colossal-AI的核心组件，其设计灵感源于PatrickStar。它采用块状内存管理策略，将参数、梯度及优化器状态组织成连续的内存块。Gemini的先进之处在于其Warmup机制：在训练的第一步，系统会实时监测非模型数据（如激活值）的内存波动，据此动态调整模型数据在GPU与CPU间的存放比例。这种自适应的逐出策略能有效减少内存碎片，并充分利用空闲的CPU显存空间。</p>
</li>
<li>
<p><strong>自动并行化搜索</strong>：区别于其他框架的显著标志。通过ColoTracer静态图分析技术，系统可以将并行策略的制定转化为一个约束优化问题。它不仅能自动搜索张量并行的切分方案，还能结合激活值检查点的插入位置，找到比人类专家手动配置更优的执行计划。这极大降低了对系统架构师的依赖。</p>
</li>
<li>
<p><strong>多维</strong> <strong>张量</strong> <strong>并行</strong> <strong>架构</strong>：除了传统的1D张量并行，Colossal-AI还实现了2D、2.5D和3D张量并行。利用复杂的分布式矩阵乘法算法，它能够在更大规模的集群中进一步减少通信量，实现超线性的并行加速比。</p>
</li>
<li>
<p><strong>Booster与Shardformer生态</strong>：Colossal-AI提供了Booster插件系统，支持对开源社区（如Hugging Face, Timm）中的模型进行非侵入式的分布式包装。Shardformer可以在不改变原始模型定义的情况下，通过JIT编译和内核替换，自动注入并行算子、FlashAttention及FusedNorm等性能增强项。</p>
</li>
</ul>
<h4 data-id="heading-20">适合场景</h4>
<p>Colossal-AI非常适合那些需要训练多样化模型结构、且希望减少手动调优工作量的团队。在视觉Transformer (ViT) 以及对显存利用率要求极高的长序列任务中，其动态管理机制表现卓越。此外，其作为PyTorch Lightning的合作伙伴，也吸引了大量追求开发效率的科研用户。</p>
<h4 data-id="heading-21">优缺点</h4>
<p><strong>优点</strong>：① 极佳的显存容忍度：Chunk机制相比原生ZeRO能显著降低内存碎片，提升训练稳定性；② 自动化程度最高：一键式并行策略搜索极大地简化了从单机到集群的迁移过程；③ 多维并行方案丰富：针对不同集群拓扑提供了更灵活的算法选择。</p>
<p><strong>缺点</strong>：① 稳定性尚需打磨：部分前沿特性（如某些自动并行模式）在复杂异构环境下的健壮性仍有提升空间；② 维护复杂性：底层集成的各种优化插件较多，对初学者的排错能力有一定要求。</p>
<h3 data-id="heading-22">2.4 torchtitan</h3>
<ul>
<li>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpytorch%2Ftorchtitan" target="_blank" title="https://github.com/pytorch/torchtitan" ref="nofollow noopener noreferrer">github.com/pytorch/tor…</a> 5k⭐</li>
<li>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenreview.net%2Fpdf%3Fid%3DWuQtmIkiUL" target="_blank" title="https://openreview.net/pdf?id=WuQtmIkiUL" ref="nofollow noopener noreferrer">openreview.net/pdf?id=WuQt…</a></li>
</ul>
<p>torchtitan是PyTorch官方团队近期推出的原生分布式预训练参考框架。它的出现标志着PyTorch正致力于在核心库层面统一各种分布式并行原语，从而提供一个轻量级、模块化且高度可组合的标杆实现。</p>
<h4 data-id="heading-23">架构设计哲学与关键原语</h4>
<p>torchtitan的核心优势在于其完全基于PyTorch原生组件，如DTensor、DeviceMesh和FSDP2，而非依赖繁重的外部封装。</p>
<ul>
<li>
<p><strong>DTensor 与 DeviceMesh 抽象</strong>：这是torchtitan的基石。DeviceMesh将集群中的计算节点抽象为一个多维逻辑网格，管理底层的进程组通信。DTensor（Distributed Tensor）则允许开发者以单设备语义编写代码，通过在DTensor上定义分片、复制或部分聚合等状态，系统会自动推导并执行必要的重分布通信操作。这种设计极大地简化了多维并行的逻辑复杂性。</p>
</li>
<li>
<p><strong>FSDP2 (Fully Sharded Data Parallel 2)</strong> ：torchtitan率先集成了FSDP2。相比于第一代FSDP 的FlatParameter设计，FSDP2采用了基于参数维度的DTensor分片，具有更强的组合性，并能与torch.compile实现深度融合。实验数据显示，FSDP2在吞吐量上提升了约1.5%，且内存占用降低了7%。</p>
</li>
<li>
<p><strong>硬件软件协同设计与可组合4D</strong> <strong>并行</strong>：框架原生支持数据并行、张量并行、流水线并行及上下文并行的叠加（即4D并行）。torchtitan引入了Float8混合精度训练、SymmetricMemory共享内存通信优化以及异步检查点保存。其设计的精妙之处在于模块的解耦，模型定义保持算法中立，而并行策略作为独立的层进行包装。</p>
</li>
<li>
<p><strong>编译器驱动的内核融合</strong>：深度集成torch.compile，支持区域级编译优化。通过将Transformer Block作为一个整体进行编译，框架能自动实现算子融合与显存复用，减少了对昂贵的手写CUDA内核的依赖，同时也提升了跨硬件平台的迁移能力。</p>
</li>
</ul>
<h4 data-id="heading-24">适合场景</h4>
<p>torchtitan适用于希望紧随PyTorch技术栈、进行最前沿架构实验或追求代码长期可维护性的团队。它是训练Llama 3.1等尖端开源模型的官方推荐参考系统。由于其代码量极简且遵循标准的PyTorch编程模式，它也非常适合用于教学和分布式系统原理的研究。</p>
<h4 data-id="heading-25">优缺点</h4>
<p><strong>优点</strong>：① 极致的原生性：与PyTorch核心深度绑定，无第三方框架带来的兼容性包袱；② 模块化与可组合性：4D并行的实现逻辑清晰，便于研究人员自定义并行策略；③ 先进的优化技术：率先集成Float8、torch.compile等官方最新成果，具备极高的扩展潜力。</p>
<p><strong>缺点</strong>：① 成熟度稍欠：相比Megatron或DeepSpeed，其在万亿参数级的大规模工业化生产环境中，相关辅助工具（如监控、故障恢复）仍处于快速完善阶段；② 功能覆盖面：目前的重心主要集中在基础LLM训练，对MoE、多模态等复杂场景的开箱即用支持尚未达到DeeSpeed的丰富程度。</p>
<h2 data-id="heading-26">3 合成数据与问答对生成</h2>
<p>AI领域从判别式模型向生成式大语言模型演进中，高质量指令数据成为决定模型性能、领域专业性与对齐效果的关键。传统监督微调高度依赖人类标注，不仅规模化生产成本高，且在深层逻辑推理、长链数学证明和垂直行业知识相关标注中，易因标注者能力局限导致质量波动。为突破该瓶颈，学界与工业界研发出多种自动化数据合成框架，依托教师模型的生成能力，将少量种子指令或原始文档转化为海量结构化问答对。</p>
<h3 data-id="heading-27">3.1 Self-Instruct</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c827264f75ca47569a4cc0428bc2dd97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=V4cKkTL2xLqsPiSM2xhsUq4srFA%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyizhongw%2Fself-instruct" target="_blank" title="https://github.com/yizhongw/self-instruct" ref="nofollow noopener noreferrer">github.com/yizhongw/se…</a> 4.6k⭐</p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2212.10560" target="_blank" title="https://arxiv.org/pdf/2212.10560" ref="nofollow noopener noreferrer">arxiv.org/pdf/2212.10…</a></p>
</li>
</ul>
<p>Self-Instruct框架是由华盛顿大学等机构在2022年底提出的，其核心贡献在于提出了一种几乎不需要人工干预的指令数据自增长路径。在LLM发展早期，该框架的出现极大地民主化了模型微调的过程，使得研究者能够以极低的成本将预训练模型转化为指令遵循模型。</p>
<h4 data-id="heading-28">迭代自引导的生成机制</h4>
<p>其底层逻辑是一种迭代的自引导算法。该过程始于一个包含175个由人类编写的种子任务的微型集合。每个任务由一条指令和相应的&lt;输入, 输出&gt;示例组成。框架通过利用LLM的上下文学习能力，从任务池中随机抽取少量示例作为提示词，引导模型生成新的指令、输入以及对应的输出。</p>
<p>在具体的任务生成阶段，Self-Instruct展现了严密的逻辑分层。为了确保生成的实例具有高质量的格式，框架首先要求模型生成指令，随后对其进行任务类型识别。这种识别机制将任务分为“分类任务”与“非分类任务”两类，并针对性地应用不同的实例生成策略：</p>




















<table><thead><tr><th><strong>生成策略</strong></th><th><strong>应用场景</strong></th><th><strong>执行逻辑</strong></th></tr></thead><tbody><tr><td><strong>输入优先</strong></td><td>非分类任务</td><td>先引导模型根据指令生成输入背景，再根据指令和输入生成输出回复。</td></tr><tr><td><strong>输出优先</strong></td><td>分类任务</td><td>先让模型列出所有可能的类别标签，再针对每个标签反向生成符合逻辑的输入内容，以避免模型倾向于生成单一标签的偏见。</td></tr></tbody></table>
<p>这种差异化的生成路径确保了在处理诸如情感分析等简单分类任务时，数据集的分布不会因模型的逻辑惯性而向某一类别倾斜。</p>
<h4 data-id="heading-29">启发式过滤与多样性保障</h4>
<p>为了解决模型自生成过程中的<strong>幻觉</strong>与<strong>重复</strong>问题，框架采用两层筛选机制：</p>
<ul>
<li>
<p><strong>相似度去重：</strong> 利用ROUGE-L指标，剔除与现有任务池相似度超过0.7的冗余指令。</p>
</li>
<li>
<p><strong>针对性清洗：</strong></p>
<ul>
<li>
<p><strong>长度过滤：</strong> 确保任务完整且重点突出。</p>
</li>
<li>
<p><strong>依赖排除：</strong> 屏蔽包含图像、文件等模型无法处理的外部关键词。</p>
</li>
<li>
<p><strong>格式规范：</strong> 移除无效标点开头或非英文的生成内容。</p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-30">实验成果与性能提升</h4>
<p>Self-Instruct成功从GPT-3中提取了5.2万条指令及8.2万个实例：</p>
<ul>
<li>
<p><strong>性能飞跃：</strong> 在SuperNI基准测试中，GPT-3的指令遵循能力提升了33.1%。</p>
</li>
<li>
<p><strong>对标结果：</strong> 仅依靠合成数据微调，其实际表现已接近InstructGPT-001的水平。</p>
</li>
</ul>
<h3 data-id="heading-31">3.2 <strong>WizardLM</strong></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/effced3d01354b64a817042828717b18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=PosbyZYqEWLql%2F50N7IqB5u2AuE%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnlpxucan%2FWizardLM" target="_blank" title="https://github.com/nlpxucan/WizardLM" ref="nofollow noopener noreferrer">github.com/nlpxucan/Wi…</a> 9.5k⭐</p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fproceedings.iclr.cc%2Fpaper_files%2Fpaper%2F2024%2Ffile%2F82eec786fdfbbfa53450c5feb7d1ac92-Paper-Conference.pdf" target="_blank" title="https://proceedings.iclr.cc/paper_files/paper/2024/file/82eec786fdfbbfa53450c5feb7d1ac92-Paper-Conference.pdf" ref="nofollow noopener noreferrer">proceedings.iclr.cc/paper_files…</a></p>
</li>
</ul>
<p>如果说Self-Instruct解决了数据从无到有的问题，WizardL则专注于数据由简入繁的质变。</p>
<h4 data-id="heading-32">Evol-Instruct的进化逻辑与操作算子</h4>
<p>Evol-Instruct是WizardLM的核心算法，它不再是从种子任务中水平扩张，而是通过垂直进化不断改写指令。该机制通过提示词引导LLM执行六种具体的进化操作：</p>
<ul>
<li>
<p><strong>深度进化</strong>：</p>
<ul>
<li><strong>添加约束</strong>：向原指令引入更多限制性条件。例如将"写一个故事"进化为"写一个关于量子力学的悬疑故事，且不能使用‘科学’这个词"。</li>
<li><strong>深化</strong>：要求模型在更高、更抽象的认知层面上探讨原有的主题。</li>
<li><strong>具体化</strong>：将泛化的概念指令转化为细节丰富的特定场景，增加处理实际问题的复杂性。</li>
<li><strong>增加推理步骤</strong>：强制要求模型展示多步逻辑推导过程，而非直接给出答案。</li>
<li><strong>复杂化输入</strong>：通过引入干扰信息、错误逻辑或极其复杂的上下文背景来测试模型的稳健性。</li>
</ul>
</li>
<li>
<p><strong>广度进化</strong>：</p>
<ul>
<li><strong>变异</strong>：基于原指令生成一条全新的、在主题或技能上更具挑战性的指令，旨在扩展数据集的领域覆盖范围和技能多样性</li>
</ul>
</li>
</ul>
<p>通过定制Prompt模板实现操作，模型按进化指令生成回复，经多轮迭代将简单种子指令转化为复杂推理任务。</p>
<h4 data-id="heading-33">指令消除器：严苛的质量守门人</h4>
<p>在进化过程中，模型可能会生成逻辑不通、无法完成或毫无增量的指令。WizardLM引入了"指令消除器"作为过滤机制，将以下四类失败任务予以剔除：</p>
<ul>
<li><strong>无信息增量</strong>: 进化的指令与原指令内容基本一致，没有实质性的复杂度提升，通常利用GPT-4进行自动判定。</li>
<li><strong>执行失败</strong>: 模型生成的回复包含"对不起/sorry"等道歉词汇，且回复长度少于80字，表明任务已超出模型处理能力。</li>
<li><strong>输出退化</strong>: 回复仅包含标点符号、停用词或生成过程中产生的无效字符。</li>
<li><strong>模板泄露</strong>: 进化的指令中直接包含了进化 Prompt 中的引导性词汇，如"#Rewritten Prompt#"等。</li>
</ul>
<p>这种基于"进化-淘汰"的物竞天择机制，确保了最终产生的数据集（如WizardLM-70k）在质量分布上向高难度区间倾斜。</p>
<h4 data-id="heading-34">专用领域的衍生应用</h4>
<p>Evol-Instruct普适性强，可助力多垂直领域打造顶尖模型：WizardCoder针对编程任务进化，在代码生成领域超越更大参数量模型；WizardMath结合强化学习形成RLEIF机制，通过复杂数学推理链生成与步骤级评分，大幅提升模型逻辑严密性。</p>
<h3 data-id="heading-35">3.3 Easy Dataset</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6c87e8f05f542f483648a19a5b6b23b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=WI7lTmu6Uah0Q06ejJ28gqs0Hwg%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Feasy-dataset" target="_blank" title="https://github.com/ConardLi/easy-dataset" ref="nofollow noopener noreferrer">github.com/ConardLi/ea…</a> 12.9k⭐</p>
</li>
<li>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.easy-dataset.com%2F" target="_blank" title="https://docs.easy-dataset.com/" ref="nofollow noopener noreferrer">docs.easy-dataset.com/</a></p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2507.04009v1" target="_blank" title="https://arxiv.org/pdf/2507.04009v1" ref="nofollow noopener noreferrer">arxiv.org/pdf/2507.04…</a></p>
</li>
</ul>
<p>与探索算法边界的Self-Instruct、WizardLM不同，Easy Dataset框架聚焦垂直领域模型训练的工程痛点。金融、医疗、法律等行业的高质量指令数据多隐藏在各类非结构化文档中，难以高效利用，而这款集成化GUI 数据工程套件，实现了从文档解析到模型评估的全链路闭环。</p>
<h4 data-id="heading-36">自适应文档处理与语义切分</h4>
<p>Easy Dataset的首要核心功能是其"自适应文档处理"模块。针对传统文本切分工具容易导致语义断裂的问题，该框架集成了多种智能切分算法：</p>
<ul>
<li>
<p><strong>Markdown</strong> <strong>结构感知切分</strong>：能够识别文档的分级标题结构，确保每一个切分出的文本块在逻辑上是完整的。</p>
</li>
<li>
<p><strong>代码感知切分</strong>：针对技术文档，自动识别代码块并防止其在切分过程中被截断 。</p>
</li>
<li>
<p><strong>混合切分策略</strong>：结合语义相似度与固定长度约束，产生既符合计算效率又具备语义连贯性的文本块。</p>
</li>
</ul>
<h4 data-id="heading-37">角色驱动的合成</h4>
<p>为了提升合成数据的多样性和专业性，Easy Dataset引入了创新的"角色驱动合成"机制。系统会根据文档内容自动生成"流派-受众对"。例如，当处理一份复杂的法律合规文档时，系统会设定不同的提问与回答角色：</p>
<ul>
<li>
<p><strong>角色A</strong>：法律专家（针对专业条文进行深度解析）。</p>
</li>
<li>
<p><strong>角色B</strong>：初级法务（针对合规操作流程进行提问）。</p>
</li>
<li>
<p><strong>角色C</strong>：企业高管（针对合规风险点进行总结性询问）。</p>
</li>
</ul>
<p>这种角色驱动的Prompting策略，使得从同一段非结构化文本中可以延伸出多条视角迥异、风格多元的QA对，极大地模拟了真实世界中复杂的人机交互场景。</p>
<h4 data-id="heading-38">人机协作的视觉化管理</h4>
<p>Easy Dataset最大的工程优势在于其直观的图形用户界面，这使得非技术出身的行业专家也能深度参与数据建设过程。</p>
<ul>
<li>
<p><strong>文档预处理</strong>：视觉化调节切分阈值，实时查看切分后的文本块，并支持全局标签树构建。</p>
</li>
<li>
<p><strong>指令</strong> <strong>生成</strong>：批量构建基于文本块的任务，支持手动修改生成的指令，通过标签树管理知识点分布。</p>
</li>
<li>
<p><strong>回复增强</strong>：利用LLM生成包含思维链的详细回答，并提供AI辅助纠偏和质量分级。</p>
</li>
<li>
<p><strong>数据集导出</strong>：一键导出为Alpaca或ShareGPT格式，并自动生成 LLaMA Factory配置文件。</p>
</li>
</ul>
<p>人机协作模式有效缓解纯合成数据的幻觉问题，用户可在界面一键优化逻辑、事实有误的回答，保障训练集的严谨性。</p>
<h4 data-id="heading-39">评估闭环与 Arena 系统</h4>
<p>Easy Dataset v1.7.0进一步强化了其评估能力，引入了模型竞技场（Arena）、自动化评估模块。用户不仅可以合成训练数据，还可以同步合成包含判断、单选、多选、简答、开放式五大题型的测试集。教师模型量化评分并生成评估报告，形成生成 — 训练准备 — 评估反馈闭环，是工业界落地便捷的数据工程套件。</p>
<h3 data-id="heading-40">3.4 技术选型建议</h3>
<ul>
<li><strong>通用对齐阶段</strong>：预训练基础模型先通过Self-Instruct构建广覆盖指令基座，掌握基础对话范式。</li>
<li><strong>专业逻辑突破阶段</strong>：面向代码、数学、复杂咨询的模型，引入WizardLM算法，多轮进化打造人类标注难穷尽的逻辑难点。</li>
<li><strong>行业模型落地阶段</strong>：特定行业模型采用Easy Dataset路径，以行业规档为底座，通过角色驱动合成专业贴合业务的问答数据集。</li>
</ul>
<h2 data-id="heading-41">4 有监督微调（SFT）与参数高效适配框架</h2>
<p>预训练赋予了模型博学，而有监督微调（SFT）则赋予了模型听从指令的能力。随着模型规模的增长，全参数微调的成本变得难以承受，为了平衡模型性能与资源利用率，有监督微调（SFT）结合参数高效适配（PEFT）技术成为了行业主流方案。</p>
<h3 data-id="heading-42">4.1 LlamaFactory</h3>
<ul>
<li>
<p>gitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhiyouga%2FLlamaFactory" target="_blank" title="https://github.com/hiyouga/LlamaFactory" ref="nofollow noopener noreferrer">github.com/hiyouga/Lla…</a> 66.1k⭐</p>
</li>
<li>
<p>官方文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.llamafactory.com.cn%2Fdocs%2Fdocuments%2Fintroduct" target="_blank" title="https://docs.llamafactory.com.cn/docs/documents/introduct" ref="nofollow noopener noreferrer">docs.llamafactory.com.cn/docs/docume…</a></p>
</li>
</ul>
<p>LlamaFactory以微调的民主化为核心理念，是易用、高效、高集成的LLM训练平台。它通过抽象底层逻辑，将复杂的分布式训练、数据格式转化、模型兼容等问题封装于统一接口，其特色的LLaMA Board可视化界面，支持用户无代码完成从数据准备、模型加载到微调启动、损失监控及权重合并的全流程操作。更多内容见<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9f4mqYVGKNS-LhmHLl6CXw" target="_blank" title="https://mp.weixin.qq.com/s/9f4mqYVGKNS-LhmHLl6CXw" ref="nofollow noopener noreferrer">收藏！LLM-RL训练框架：3大流派+6大框架，一文搞定</a>。</p>
<h4 data-id="heading-43">关键技术特性与算法矩阵</h4>
<p>LlamaFactory展现了极强的Day 0支持能力，即在 Llama 3/4、Qwen 2.5/3、DeepSeek-R1 等前沿模型发布的第一时间提供适配。在算法层面，该框架集成了目前最广泛的PEFT算法矩阵。</p>
<ul>
<li>
<p><strong>基础微调模式</strong>: 全量参数微调、冻结微调、LoRA、QLoRA (2/3/4/5/6/8-bit)</p>
</li>
<li>
<p><strong>先进</strong> <strong>适配器</strong> <strong>算法</strong>: DoRA、LoRA+、rsLoRA、PiSSA、LoftQ、OFT</p>
</li>
<li>
<p><strong>优化器</strong> <strong>与</strong> <strong>内存</strong> <strong>管理</strong>: GaLore、BAdam、Adam-mini、Muon、FlashAttention-2、Liger Kernel</p>
</li>
<li>
<p><strong>对齐与</strong> <strong>强化学习</strong>: SFT、PPO、DPO、KTO、ORPO、SimPO</p>
</li>
</ul>
<p>LlamaFactory在数据处理上支持主流数据集格式及多轮对话、多模态数据处理，内置Native DDP、DeepSpeed、FSDP等分布式训练策略，可在中大规模GPU集群运行，还深度适配昇腾NPU，覆盖驱动安装、CANN配置及加速算子集成。</p>
<h4 data-id="heading-44">适合场景</h4>
<ul>
<li>
<p><strong>科研实验与原型验证</strong>：研究人员可以利用WebUI快速测试不同PEFT算法对特定任务的效果，无需在工程细节上浪费时间。</p>
</li>
<li>
<p><strong>快速领域定制</strong>：中小企业或开发团队需要将通用模型转化为特定垂直领域的助手时，LlamaFactory提供了最快的落地路径。</p>
</li>
<li>
<p><strong>国产化替代</strong>：在需要基于昇腾NPU进行自主可控的大模型微调时，LlamaFactory的NPU训练方案提供了详尽的工程参考。</p>
</li>
</ul>
<h4 data-id="heading-45">优缺点</h4>
<p><strong>优点</strong>：① 交互极致友好：LLaMA Board可视化界面是目前开源社区中成熟度最高的GUI工具，极大降低了非工程背景用户的门槛；② 兼容性极其广泛：支持模型超过100种，涵盖了当前市场上绝大多数主流及小众架构；③ 算法跟进迅速：社区活跃度极高，新算法（如GaLore、DoRA）的集成速度处于行业领先水平。</p>
<p><strong>缺点</strong>：①单卡极限优化不足：虽然集成了Unsloth的加速算子，但在纯粹的单卡极致效率上，仍略逊于原生Unsloth框架；② 工程复杂度较高：由于功能过于丰富，底层代码库较为庞大，对于希望进行深度二次开发的用户来说，代码的学习曲线可能较陡。</p>
<h3 data-id="heading-46">4.2 Unsloth</h3>
<ul>
<li>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Funslothai%2Funsloth" target="_blank" title="https://github.com/unslothai/unsloth" ref="nofollow noopener noreferrer">github.com/unslothai/u…</a> 51.1k⭐</p>
</li>
<li>
<p>说明文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Funsloth.ai%2Fdocs" target="_blank" title="https://unsloth.ai/docs" ref="nofollow noopener noreferrer">unsloth.ai/docs</a></p>
</li>
</ul>
<h4 data-id="heading-47">核心机制：Triton内核与手动反向传播</h4>
<p>Unsloth颠覆了开发者对显存占用的认知，由Daniel Han和Michael Han兄弟开发，核心是极致性能优化与深度挖掘硬件潜力。该框架舍弃PyTorch默认算子实现，基于OpenAI的Triton语言手写线性层、RoPE位置嵌入等几乎所有关键计算内核。</p>
<p>其核心价值在于消除冗余的中间张量存储：标准PyTorch流程中，反向传播需保留大量激活值，是显存消耗的主要来源。Unsloth通过手动编写反向传播逻辑，结合内核融合技术，让单次GPU调用完成多个计算步骤，大幅减少VRAM的读写次数。</p>
<h4 data-id="heading-48">性能表现与显存节省数据</h4>
<p>根据官方及社区的实测数据，Unsloth在微调任务中相比基准（HF+FA2）的优势。</p>
<ul>
<li><strong>训练速度</strong>：提速 2x 至 5x，部分场景甚至达到 10x 以上</li>
<li><strong>显存</strong> <strong>占用</strong>：减少70%至80%，极大地缓解了OOM问题</li>
<li><strong>精度保持</strong>：0%精度损失，通过数学上的精确等价实现优化而非近似</li>
<li><strong>上下文支持</strong>：在80GB显存下支持高达500K的上下文窗口训练</li>
</ul>
<p>此外，Unsloth的动态4-bit量化技术优化自bitsandbytes，通过动态保护关键权重，以不足10%的显存开销提升4-bit模型微调精度，在MMLU等基准上表现更优。</p>
<h4 data-id="heading-49">适合场景</h4>
<ul>
<li>
<p><strong>消费级</strong> <strong>显卡</strong> <strong>训练</strong>：在RTX 3060 (12GB) 或RTX 4090 (24GB) 上微调Llama 7B甚至20B规模的模型，这是传统框架难以完成的任务。</p>
</li>
<li>
<p><strong>长文本任务训练</strong>：对于需要极长上下文（如法律文书、长篇小说分析）的微调，Unsloth的内存管理能力是核心优势。</p>
</li>
<li>
<p><strong>高频迭代任务</strong>：在需要频繁调整参数、快速看到训练结果的场景下，2-5倍的速度提升意味着研发周期的指数级缩短。</p>
</li>
</ul>
<h4 data-id="heading-50">优缺点</h4>
<p><strong>优点</strong>：① 效率断层领先：在单卡微调领域，Unsloth的速度和显存效率目前处于无敌地位；② 零部署痛苦：提供丰富的Google Colab和Kaggle笔记本模板，且支持一键导出至GGUF、vLLM等多种部署格式；③ RL支持卓越：针对GRPO算法进行了内存优化，使其成为当前复现DeepSeek-R1风格推理模型最经济的工具。</p>
<p><strong>缺点</strong>：① 多卡支持较弱：长期以来其开源版本主要针对单卡优化，虽然可以通过一些非官方手段接入多卡，但成熟的分布式支持（Pro版）尚未全面开源；② 模型结构敏感：由于算子是手写的，当模型引入全新的算子或结构（如非Transformer架构）时，需要开发者手动更新内核，兼容性扩展相对滞后。</p>
<h3 data-id="heading-51">4.3 ms-swift</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb205d3733df44018b318c1143d68368~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=4WjcVkYJH5%2F5NtVzYIFDxrR6hGE%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelscope%2Fms-swift" target="_blank" title="https://github.com/modelscope/ms-swift" ref="nofollow noopener noreferrer">github.com/modelscope/…</a> 12.3k⭐</p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2408.05517" target="_blank" title="https://arxiv.org/abs/2408.05517" ref="nofollow noopener noreferrer">arxiv.org/abs/2408.05…</a></p>
</li>
</ul>
<p>ms-swift（Scalable lightWeight Infrastructure for Fine-Tuning)阿里是ModelScope社区推出的全能型大模型微调框架，区别于LlamaFactory的易用性和Unsloth的性能追求，其以工业级的深度与广度为设计目标。该框架深度融合ModelScope生态，支持600余种纯文本模型、300余种多模态模型，覆盖图像、视频、音频等全模态输入。</p>
<p>ms-swift实现了辅助数据标注、微调训练、EvalScope评测、量化及vLLM/SGLang部署的全链路闭环，一站式工具链大幅降低企业生产环境中跨平台迁移的工程损耗。</p>
<h4 data-id="heading-52">核心技术：Megatron 扩展与国产硬件适配</h4>
<p>在处理超大规模模型时，ms-swift引入了Megatron并行技术，支持张量并行（TP）、流水线并行（PP）、上下文并行（CP）等复杂策略。通过Megatron-SWIFT模块，该框架在微调 MoE（专家混合）模型时的加速比可达10倍以上。</p>
<p>ms-swift对国产化算力的支持最为彻底。它不仅支持 NVIDIA A100/H100，还针对昇腾NPU、寒武纪、寒武纪及国内主流算力平台进行了深度调优。其在昇腾NPU上支持基于CANN的底层加速，并能够配合DeepSpeed实现大规模分布式训练。</p>
<ul>
<li>
<p><strong>模型支持：</strong> 支持Qwen-VL, InternVL, GLM-4.5V, Ovis等300+多模态模型</p>
</li>
<li>
<p><strong>多模态优化</strong>：引入多模态打包技术（Packing），训练速度提升100%+</p>
</li>
<li>
<p><strong>强化学习</strong> <strong>族群</strong>：内置GRPO, DAPO, GSPO, RLOO, Reinforce++等全系列强化学习算法</p>
</li>
<li>
<p><strong>部署后端</strong>: 集成vLLM, SGLang, LMDeploy，提供标准的OpenAI API接口</p>
</li>
</ul>
<h4 data-id="heading-53">适合场景</h4>
<p>ms-swift是企业级项目及超大规模任务的首选：</p>
<ul>
<li>
<p><strong>多模态模型微调</strong>：在处理包含视觉、语音、视频的跨模态对齐任务时，ms-swift提供了最成熟的模板与算子支持。</p>
</li>
<li>
<p><strong>大规模集群训练</strong>：当微调任务需要跨越数十台甚至上百台服务器，并利用复杂的并行策略时，ms-swift的Megatron架构是核心保障。</p>
</li>
<li>
<p><strong>国产化工业落地</strong>：对于必须部署在国产硬件环境（如金融、政务云）的AI项目，ms-swift提供了最完备的驱动与框架兼容性支持。</p>
</li>
</ul>
<h4 data-id="heading-54">优缺点</h4>
<p><strong>优点</strong>：① 多模态支持之王：目前开源界对视觉、语音模型微调支持最全面、优化最深入的框架之一; ② 国产算力之友：在昇腾等国产芯片上的表现最为稳定，且有ModelScope社区的强大技术支持; ③并行策略完备：真正支持千亿级参数模型的并行训练与优化，具备极强的可扩展性。</p>
<p><strong>缺点</strong>：① 学习难度最高：由于集成了Megatron和海量的工业级参数，其配置复杂度高于LlamaFactory，对开发者的工程水平有较高要求; ② 环境依赖较重：在安装分布式及国产硬件支持模块时，对系统库、编译器版本有较严苛的要求，初次部署可能耗时较长。</p>
<h2 data-id="heading-55">5 强化学习与人类偏好对齐（RLHF）</h2>
<p>RLHF是大模型通往智能的最后一步，通过与人类价值观的对齐，模型能够学会拒绝有害指令并在复杂任务中表现得更有逻辑。随着DPO（直接偏好优化）和 GRPO（组相对策略优化）等算法的普及，对齐框架正在向高性能生成和灵活策略切换方向演进。</p>
<p>因前一篇<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9f4mqYVGKNS-LhmHLl6CXw" target="_blank" title="https://mp.weixin.qq.com/s/9f4mqYVGKNS-LhmHLl6CXw" ref="nofollow noopener noreferrer">收藏！LLM-RL训练框架：3大流派+6大框架，一文搞定</a>做过介绍，这里不过多阐述，只给一个汇总表格。</p>

























<table><thead><tr><th>框架名称</th><th>核心技术方案</th><th>适用场景</th></tr></thead><tbody><tr><td>OpenRLHF</td><td>Ray + vLLM架构、分布式多模型分发</td><td>大规模集群下的高吞吐 PPO/DPO/GRPO训练</td></tr><tr><td>veRL</td><td>3D-HybridEngine、训练与采样高效重塑</td><td>超大规模MoE模型的高性能强化学习对齐</td></tr><tr><td>TRL</td><td>深度集成PEFT、Hugging Face原生支持</td><td>使用HF生态进行轻量级对齐实验</td></tr></tbody></table>
<h2 data-id="heading-56">6 选型建议</h2>
<p>大模型全链路已形成高度协同的开源生态，数据制备环节可通过Easy-dataset将企业内部文档直接抽离为问答对，并搭配Data-Juicer完成质量清洗；模型微调环节针对处理好的数据集，可采用Llama-Factory调用生成的配置开展微调，若资源受限还能结合Unsloth实现加速；智能对齐环节则借助OpenRLHF进行强化学习对齐，让模型具备更优的逻辑推理能力与价值观对齐效果，其中逻辑推理可达到O1级思考水平。建议企业开发者优先尝试Easy-dataset与Llama-Factory的组合方案，该方案是目前上手最快、工程化程度最高的数据—微调闭环方案。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[若依框架日志管理系统深度解析：从AOP切面到异步处理的完整实现]]></title>    <link>https://juejin.cn/post/7598838597559664674</link>    <guid>https://juejin.cn/post/7598838597559664674</guid>    <pubDate>2026-01-26T03:00:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598838597559664674" data-draft-id="7598734303174852660" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="若依框架日志管理系统深度解析：从AOP切面到异步处理的完整实现"/> <meta itemprop="keywords" content="后端,Java,全栈"/> <meta itemprop="datePublished" content="2026-01-26T03:00:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_Joey_"/> <meta itemprop="url" content="https://juejin.cn/user/4402858757729463"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            若依框架日志管理系统深度解析：从AOP切面到异步处理的完整实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4402858757729463/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _Joey_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:00:54.000Z" title="Mon Jan 26 2026 03:00:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、系统概述</h2>
<h3 data-id="heading-1">1.1 功能简介</h3>
<p>若依框架的日志管理系统提供：</p>
<ul>
<li><strong>操作日志</strong>：记录业务操作（增删改查、导入导出等）</li>
</ul>

<ul>
<li><strong>登录日志</strong>：记录用户登录/登出</li>
</ul>

<ul>
<li><strong>异步处理</strong>：日志写入不阻塞主流程</li>
</ul>

<ul>
<li><strong>敏感信息过滤</strong>：自动过滤密码等敏感字段</li>
</ul>
<h3 data-id="heading-2">1.2 日志类型</h3>
<h4 data-id="heading-3">1.2.1 操作日志（SysOperLog）</h4>
<p>记录业务操作，包含：</p>
<ul>
<li>操作模块、业务类型、操作人员</li>
</ul>

<ul>
<li>请求URL、IP、地点</li>
</ul>

<ul>
<li>请求参数、返回结果</li>
</ul>

<ul>
<li>操作状态、错误信息</li>
</ul>

<ul>
<li>执行时间、耗时</li>
</ul>
<h4 data-id="heading-4">1.2.2 登录日志（SysLogininfor）</h4>
<p>记录登录信息，包含：</p>
<ul>
<li>用户名、登录状态</li>
</ul>

<ul>
<li>IP、登录地点</li>
</ul>

<ul>
<li>浏览器、操作系统</li>
</ul>

<ul>
<li>登录时间、提示消息</li>
</ul>
<hr/>
<h2 data-id="heading-5">二、架构设计</h2>
<h3 data-id="heading-6">2.1 整体架构图</h3>
<pre><code class="hljs language-java" lang="java">┌─────────────────────────────────────────────────────────┐
│                     Controller层                        │
│  ┌──────────────────────────────────────────────────┐   │
│  │  <span class="hljs-meta">@Log</span>注解标记需要记录日志的方法                    │   │
│  └──────────────────────────────────────────────────┘   │
└───────────────────┬─────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────┐
│                    AOP切面层                             │
│  ┌──────────────────────────────────────────────────┐   │
│  │  LogAspect (操作日志切面)                         │   │
│  │  - <span class="hljs-meta">@Before</span>: 记录开始时间                          │   │
│  │  - <span class="hljs-meta">@AfterReturning</span>: 正常返回处理                  │   │
│  │  - <span class="hljs-meta">@AfterThrowing</span>: 异常处理                       │   │
│  └──────────────────────────────────────────────────┘   │
└───────────────────┬─────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────┐
│                  异步任务管理层                          │
│  ┌──────────────────────────────────────────────────┐   │
│  │  AsyncManager (异步任务管理器)                    │   │
│  │  - 单例模式                                       │   │
│  │  - 延迟10ms执行                                   │   │
│  └──────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────┐   │
│  │  AsyncFactory (异步工厂)                          │   │
│  │  - recordOper(): 创建操作日志任务                  │   │
│  │  - recordLogininfor(): 创建登录日志任务            │   │
│  └──────────────────────────────────────────────────┘   │
└───────────────────┬─────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────┐
│                    数据持久层                            │
│  ┌──────────────────────────────────────────────────┐   │
│  │  Service层 → Mapper层 → 数据库                    │   │
│  └──────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-7">2.2 技术栈</h3>
<ul>
<li><code>AOP</code>：AspectJ</li>
</ul>

<ul>
<li><code>异步处理</code>：ScheduledExecutorService</li>
</ul>

<ul>
<li><code>数据持久化</code>：MyBatis</li>
</ul>

<ul>
<li><code>JSON处理</code>：FastJSON2</li>
</ul>

<ul>
<li><code>IP地址解析</code>：AddressUtils</li>
</ul>
<h2 data-id="heading-8">三、核心组件详解</h2>
<h3 data-id="heading-9">3.1 @Log注解</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target({ ElementType.PARAMETER, ElementType.METHOD })</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Log
{
    <span class="hljs-comment">/** 模块 */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">title</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">""</span>;

    <span class="hljs-comment">/** 功能 */</span>
    <span class="hljs-keyword">public</span> BusinessType <span class="hljs-title function_">businessType</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> BusinessType.OTHER;

    <span class="hljs-comment">/** 操作人类别 */</span>
    <span class="hljs-keyword">public</span> OperatorType <span class="hljs-title function_">operatorType</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> OperatorType.MANAGE;

    <span class="hljs-comment">/** 是否保存请求的参数 */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSaveRequestData</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;

    <span class="hljs-comment">/** 是否保存响应的参数 */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSaveResponseData</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;

    <span class="hljs-comment">/** 排除指定的请求参数 */</span>
    <span class="hljs-keyword">public</span> String[] excludeParamNames() <span class="hljs-keyword">default</span> {};
}
</code></pre>
<p>参数说明：</p>
<ul>
<li><code>title</code>：操作模块名称</li>
</ul>

<ul>
<li><code>businessType</code>：业务类型（INSERT/UPDATE/DELETE/QUERY/EXPORT等）</li>
</ul>

<ul>
<li><code>operatorType</code>：操作人类别（MANAGE/MOBILE/OTHER）</li>
</ul>

<ul>
<li><code>isSaveRequestData</code>：是否保存请求参数</li>
</ul>

<ul>
<li><code>isSaveResponseData</code>：是否保存响应参数</li>
</ul>

<ul>
<li><code>excludeParamNames</code>：排除的参数名（如密码字段）</li>
</ul>
<h3 data-id="heading-10">3.2 LogAspect（操作日志切面）</h3>
<p>核心类：<code>com.construct.framework.aspectj.LogAspect</code></p>
<h4 data-id="heading-11">3.2.1 关键属性</h4>
<p><code>LogAspect.java Lines 54-58</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Before(value = "@annotation(controllerLog)")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">boBefore</span><span class="hljs-params">(JoinPoint joinPoint, Log controllerLog)</span>
{
    TIME_THREADLOCAL.set(System.currentTimeMillis());
}
</code></pre>
<ul>
<li><code>EXCLUDE_PROPERTIES</code>：默认排除的敏感字段（password、oldPassword等）</li>
<li><code>TIME_THREADLOCAL</code>：ThreadLocal，记录方法开始时间</li>
</ul>
<h4 data-id="heading-12">3.2.2 核心方法</h4>
<ol>
<li><code>boBefore()</code>：方法执行前</li>
</ol>
<ul>
<li>记录开始时间到<code>ThreadLocal</code></li>
</ul>
<ol start="2">
<li><code>doAfterReturning()</code>：方法正常返回后</li>
</ol>
<ul>
<li>调用<code>handleLog()</code>处理日志</li>
</ul>
<ol start="3">
<li><code>doAfterThrowing()</code>：方法抛出异常后</li>
</ol>
<ul>
<li>调用<code>handleLog()</code>，传入异常信息</li>
</ul>
<ol start="4">
<li><code>handleLog()</code>：统一日志处理</li>
</ol>
<p><code>LogAspect.java Lines 83-130</code></p>
<pre><code class="hljs language-java" lang="java">   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleLog</span><span class="hljs-params">(<span class="hljs-keyword">final</span> JoinPoint joinPoint, Log controllerLog, <span class="hljs-keyword">final</span> Exception e, Object jsonResult)</span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 获取当前的用户</span>
            <span class="hljs-type">LoginUser</span> <span class="hljs-variable">loginUser</span> <span class="hljs-operator">=</span> SecurityUtils.getLoginUser();
            <span class="hljs-comment">// *========数据库日志=========*//</span>
            <span class="hljs-type">SysOperLog</span> <span class="hljs-variable">operLog</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SysOperLog</span>();
            operLog.setStatus(BusinessStatus.SUCCESS.ordinal());
            <span class="hljs-comment">// 请求的地址</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> IpUtils.getIpAddr();
            operLog.setOperIp(ip);
            operLog.setOperUrl(StringUtils.substring(ServletUtils.getRequest().getRequestURI(), <span class="hljs-number">0</span>, <span class="hljs-number">255</span>));
            <span class="hljs-keyword">if</span> (loginUser != <span class="hljs-literal">null</span>)
            {
                operLog.setOperName(loginUser.getUser().getNickName());
            }
            <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>)
            {
                operLog.setStatus(BusinessStatus.FAIL.ordinal());
                operLog.setErrorMsg(StringUtils.substring(e.getMessage(), <span class="hljs-number">0</span>, <span class="hljs-number">2000</span>));
            }
            <span class="hljs-comment">// 设置方法名称</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> joinPoint.getTarget().getClass().getName();
            <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().getName();
            operLog.setMethod(className + <span class="hljs-string">"."</span> + methodName + <span class="hljs-string">"()"</span>);
            <span class="hljs-comment">// 设置请求方式</span>
            operLog.setRequestMethod(ServletUtils.getRequest().getMethod());
            <span class="hljs-comment">// 处理设置注解上的参数</span>
            getControllerMethodDescription(joinPoint, controllerLog, operLog, jsonResult);
            <span class="hljs-comment">// 设置消耗时间</span>
            operLog.setCostTime(System.currentTimeMillis() - TIME_THREADLOCAL.get());
            <span class="hljs-comment">// 保存数据库</span>
            AsyncManager.me().execute(AsyncFactory.recordOper(operLog));
        }
        <span class="hljs-keyword">catch</span> (Exception exp)
        {
            <span class="hljs-comment">// 记录本地异常日志</span>
            log.error(<span class="hljs-string">"异常信息:{}"</span>, exp.getMessage());
            exp.printStackTrace();
        }
        <span class="hljs-keyword">finally</span>
        {
            TIME_THREADLOCAL.remove();
        }
    }
</code></pre>
<p>处理流程：</p>
<p>(1)  获取当前登录用户</p>

<p>(2) 创建SysOperLog对象</p>

<p>(3) 设置IP、URL、操作人</p>

<p>(4) 处理异常信息（如有）</p>

<p>(5) 设置方法名、请求方式</p>

<p>(6) 解析注解参数</p>

<p>(7) 计算耗时</p>

<p>(8) 异步保存日志</p>

<ol start="5">
<li><code>getControllerMethodDescription()</code>：解析注解参数</li>
</ol>
<p><code>LogAspect.java ines 139-158</code></p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getControllerMethodDescription</span><span class="hljs-params">(JoinPoint joinPoint, Log log, SysOperLog operLog, Object jsonResult)</span> <span class="hljs-keyword">throws</span> Exception
    {
        <span class="hljs-comment">// 设置action动作</span>
        operLog.setBusinessType(log.businessType().ordinal());
        <span class="hljs-comment">// 设置标题</span>
        operLog.setTitle(log.title());
        <span class="hljs-comment">// 设置操作人类别</span>
        operLog.setOperatorType(log.operatorType().ordinal());
        <span class="hljs-comment">// 是否需要保存request，参数和值</span>
        <span class="hljs-keyword">if</span> (log.isSaveRequestData())
        {
            <span class="hljs-comment">// 获取参数的信息，传入到数据库中。</span>
            setRequestValue(joinPoint, operLog, log.excludeParamNames());
        }
        <span class="hljs-comment">// 是否需要保存response，参数和值</span>
        <span class="hljs-keyword">if</span> (log.isSaveResponseData() &amp;&amp; StringUtils.isNotNull(jsonResult))
        {
            operLog.setJsonResult(StringUtils.substring(JSON.toJSONString(jsonResult), <span class="hljs-number">0</span>, <span class="hljs-number">2000</span>));
        }
    }
</code></pre>
<ol start="6">
<li><code>setRequestValue()</code>：获取并处理请求参数</li>
</ol>
<p><code>LogAspect.java Lines 166-180</code></p>
<pre><code class="hljs language-java" lang="java">  <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRequestValue</span><span class="hljs-params">(JoinPoint joinPoint, SysOperLog operLog, String[] excludeParamNames)</span> <span class="hljs-keyword">throws</span> Exception
   {
        Map&lt;?, ?&gt; paramsMap = ServletUtils.getParamMap(ServletUtils.getRequest());
        <span class="hljs-type">String</span> <span class="hljs-variable">requestMethod</span> <span class="hljs-operator">=</span> operLog.getRequestMethod();
        <span class="hljs-keyword">if</span> (StringUtils.isEmpty(paramsMap)
                &amp;&amp; (HttpMethod.PUT.name().equals(requestMethod) || HttpMethod.POST.name().equals(requestMethod)))
        {
            <span class="hljs-type">String</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> argsArrayToString(joinPoint.getArgs(), excludeParamNames);
            operLog.setOperParam(StringUtils.substring(params, <span class="hljs-number">0</span>, <span class="hljs-number">2000</span>));
        }
        <span class="hljs-keyword">else</span>
        {
            operLog.setOperParam(StringUtils.substring(JSON.toJSONString(paramsMap, excludePropertyPreFilter(excludeParamNames)), <span class="hljs-number">0</span>, <span class="hljs-number">2000</span>));
        }
    }
</code></pre>
<ol start="7">
<li><code>isFilterObject()</code>：过滤不需要记录的对象</li>
</ol>
<p><code>LogAspect.java Lines 222-249</code></p>
<pre><code class="hljs language-java" lang="java">        <span class="hljs-meta">@SuppressWarnings("rawtypes")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFilterObject</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Object o)</span>
    {
        Class&lt;?&gt; clazz = o.getClass();
        <span class="hljs-keyword">if</span> (clazz.isArray())
        {
            <span class="hljs-keyword">return</span> clazz.getComponentType().isAssignableFrom(MultipartFile.class);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Collection.class.isAssignableFrom(clazz))
        {
            <span class="hljs-type">Collection</span> <span class="hljs-variable">collection</span> <span class="hljs-operator">=</span> (Collection) o;
            <span class="hljs-keyword">for</span> (Object value : collection)
            {
                <span class="hljs-keyword">return</span> value <span class="hljs-keyword">instanceof</span> MultipartFile;
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Map.class.isAssignableFrom(clazz))
        {
            <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> (Map) o;
            <span class="hljs-keyword">for</span> (Object value : map.entrySet())
            {
                Map.<span class="hljs-type">Entry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> (Map.Entry) value;
                <span class="hljs-keyword">return</span> entry.getValue() <span class="hljs-keyword">instanceof</span> MultipartFile;
            }
        }
        <span class="hljs-keyword">return</span> o <span class="hljs-keyword">instanceof</span> MultipartFile || o <span class="hljs-keyword">instanceof</span> HttpServletRequest || o <span class="hljs-keyword">instanceof</span> HttpServletResponse
                || o <span class="hljs-keyword">instanceof</span> BindingResult;
    }
</code></pre>
<p>过滤对象：</p>
<ul>
<li><code>MultipartFile</code>（文件上传）</li>
</ul>

<ul>
<li><code>HttpServletRequest</code>、<code>HttpServletResponse</code></li>
</ul>

<ul>
<li><code>BindingResult</code>（参数校验结果）</li>
</ul>
<h3 data-id="heading-13">3.3 AsyncManager（异步任务管理器）</h3>
<p><code>AsyncManager.java Lines 15-56</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncManager</span>
{
    <span class="hljs-comment">/**
     * 操作延迟10毫秒
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">OPERATE_DELAY_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

    <span class="hljs-comment">/**
     * 异步操作任务调度线程池
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> SpringUtils.getBean(<span class="hljs-string">"scheduledExecutorService"</span>);

    <span class="hljs-comment">/**
     * 单例模式
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">AsyncManager</span><span class="hljs-params">()</span>{}

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AsyncManager</span> <span class="hljs-variable">me</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncManager</span>();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AsyncManager <span class="hljs-title function_">me</span><span class="hljs-params">()</span>
    {
        <span class="hljs-keyword">return</span> me;
    }

    <span class="hljs-comment">/**
     * 执行任务
     * 
     * <span class="hljs-doctag">@param</span> task 任务
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(TimerTask task)</span>
    {
        executor.schedule(task, OPERATE_DELAY_TIME, TimeUnit.MILLISECONDS);
    }

    <span class="hljs-comment">/**
     * 停止任务线程池
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdown</span><span class="hljs-params">()</span>
    {
        Threads.shutdownAndAwaitTermination(executor);
    }
}
</code></pre>
<p>特点：</p>
<ul>
<li>单例模式</li>
</ul>

<ul>
<li>延迟<code>10ms</code>执行，避免影响主流程</li>
</ul>

<ul>
<li>使用<code>ScheduledExecutorService</code>执行任务</li>
</ul>
<h3 data-id="heading-14">3.4 AsyncFactory（异步工厂）</h3>
<p><code>AsyncFactory.java Lines 99-111</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TimerTask <span class="hljs-title function_">recordOper</span><span class="hljs-params">(<span class="hljs-keyword">final</span> SysOperLog operLog)</span>
{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TimerTask</span>()
    {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span>
        {
            <span class="hljs-comment">// 远程查询操作地点</span>
            operLog.setOperLocation(AddressUtils.getRealAddressByIP(operLog.getOperIp()));
            SpringUtils.getBean(ISysOperLogService.class).insertOperlog(operLog);
        }
    };
}
</code></pre>
<p>功能：</p>
<ul>
<li><code>recordOper()</code>：创建操作日志任务
<ul>
<li>根据IP查询操作地点</li>
<li>调用<code>Service</code>保存日志</li>
</ul>
</li>
</ul>

<ul>
<li><code>recordLogininfor()</code>：创建登录日志任务
<ul>
<li>解析<code>User-Agent</code>获取浏览器和操作系统</li>
<li>根据IP查询登录地点</li>
<li>保存登录日志</li>
</ul>
</li>
</ul>
<h3 data-id="heading-15">3.5 线程池配置</h3>
<p><code>ThreadPoolConfig.java Lines 45-62</code></p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">/**
     * 执行周期性或定时任务
     */</span>
    <span class="hljs-meta">@Bean(name = "scheduledExecutorService")</span>
    <span class="hljs-keyword">protected</span> ScheduledExecutorService <span class="hljs-title function_">scheduledExecutorService</span><span class="hljs-params">()</span>
    {
       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScheduledThreadPoolExecutor</span>(corePoolSize,
              <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicThreadFactory</span>.Builder().namingPattern(<span class="hljs-string">"schedule-pool-%d"</span>).daemon(<span class="hljs-literal">true</span>).build(),
              <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy())
        {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterExecute</span><span class="hljs-params">(Runnable r, Throwable t)</span>
            {
                <span class="hljs-built_in">super</span>.afterExecute(r, t);
                Threads.printException(r, t);
            }
        };
    }
</code></pre>
<p>配置参数：</p>
<ul>
<li>核心线程数：50</li>
<li>最大线程数：200</li>
<li>队列容量：1000</li>
<li>线程命名：<code>schedule-pool-%d</code></li>
<li>守护线程：是</li>
<li>拒绝策略：<code>CallerRunsPolicy</code></li>
</ul>
<h3 data-id="heading-16">3.6 实体类</h3>
<h4 data-id="heading-17">3.6.1 SysOperLog（操作日志实体）</h4>
<p>主要字段：</p>
<ul>
<li><code>operId</code>：日志主键</li>
<li><code>title</code>：操作模块</li>
<li><code>businessType</code>：业务类型（0其它 1新增 2修改 3删除等）</li>
<li><code>method</code>：请求方法（类名.方法名）</li>
<li><code>requestMethod</code>：请求方式（GET/POST等）</li>
<li><code>operatorType</code>：操作类别（0其它 1后台用户 2手机端用户）</li>
<li><code>operName</code>：操作人员</li>
<li><code>operUrl</code>：请求URL</li>
<li><code>operIp</code>：操作IP</li>
<li><code>operLocation</code>：操作地点</li>
<li><code>operParam</code>：请求参数（JSON，最大2000字符）</li>
<li><code>jsonResult</code>：返回参数（JSON，最大2000字符）</li>
<li><code>status</code>：操作状态（0正常 1异常）</li>
<li><code>errorMsg</code>：错误消息（最大2000字符）</li>
<li><code>operTime</code>：操作时间</li>
<li><code>costTime</code>：消耗时间（毫秒）</li>
</ul>
<hr/>
<h2 data-id="heading-18">四、实现流程</h2>
<h3 data-id="heading-19">4.1 操作日志记录流程</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">1.</span> Controller方法执行
   ↓
<span class="hljs-number">2.</span> <span class="hljs-meta">@Log</span>注解触发AOP切面
   ↓
<span class="hljs-number">3.</span> LogAspect.boBefore()
   - 记录开始时间到ThreadLocal
   ↓
<span class="hljs-number">4.</span> 业务方法执行
   ↓
<span class="hljs-number">5.</span> LogAspect.doAfterReturning() 或 doAfterThrowing()
   ↓
<span class="hljs-number">6.</span> LogAspect.handleLog()
   - 获取用户信息
   - 创建SysOperLog对象
   - 设置基本信息（IP、URL、方法名等）
   - 解析<span class="hljs-meta">@Log</span>注解参数
   - 处理请求参数和响应结果
   - 计算执行耗时
   ↓
<span class="hljs-number">7.</span> AsyncManager.execute()
   - 延迟10ms执行
   ↓
<span class="hljs-number">8.</span> AsyncFactory.recordOper()
   - 根据IP查询操作地点
   - 调用Service保存日志
   ↓
<span class="hljs-number">9.</span> SysOperLogService.insertOperlog()
   - 保存到数据库
</code></pre>
<h3 data-id="heading-20">4.2 登录日志记录流程</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">1.</span> 用户登录/登出
   ↓
<span class="hljs-number">2.</span> 调用AsyncManager.execute(AsyncFactory.recordLogininfor(...))
   ↓
<span class="hljs-number">3.</span> AsyncFactory.recordLogininfor()
   - 解析User-Agent获取浏览器和操作系统
   - 获取IP地址
   - 根据IP查询登录地点
   - 创建SysLogininfor对象
   ↓
<span class="hljs-number">4.</span> SysLogininforService.insertLogininfor()
   - 保存到数据库
</code></pre>
<h3 data-id="heading-21">4.3 参数处理流程</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">1.</span> 检查是否需要保存请求参数（isSaveRequestData）
   ↓
<span class="hljs-number">2.</span> 获取请求参数
   - GET请求：从request.getParameterMap()获取
   - POST/PUT请求：从方法参数获取
   ↓
<span class="hljs-number">3.</span> 过滤敏感字段
   - 默认过滤：password、oldPassword、newPassword、confirmPassword
   - 注解指定过滤：excludeParamNames
   ↓
<span class="hljs-number">4.</span> 过滤不需要的对象
   - MultipartFile、HttpServletRequest、HttpServletResponse、BindingResult
   ↓
<span class="hljs-number">5.</span> 转换为JSON字符串（最大<span class="hljs-number">2000</span>字符）
   ↓
<span class="hljs-number">6.</span> 保存到operParam字段
</code></pre>
<hr/>
<h2 data-id="heading-22">五、使用指南</h2>
<h3 data-id="heading-23">5.1 基本使用</h3>
<p>在Controller方法上添加<code>@Log</code>注解：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/system/user")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SysUserController</span> {

    <span class="hljs-meta">@Log(title = "用户管理", businessType = BusinessType.INSERT)</span>
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SysUser user)</span> {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">return</span> AjaxResult.success();
    }

    <span class="hljs-meta">@Log(title = "用户管理", businessType = BusinessType.UPDATE)</span>
    <span class="hljs-meta">@PutMapping</span>
    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">edit</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SysUser user)</span> {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">return</span> AjaxResult.success();
    }

    <span class="hljs-meta">@Log(title = "用户管理", businessType = BusinessType.DELETE)</span>
    <span class="hljs-meta">@DeleteMapping("/{userIds}")</span>
    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">remove</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long[] userIds)</span> {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">return</span> AjaxResult.success();
    }

    <span class="hljs-meta">@Log(title = "用户管理", businessType = BusinessType.QUERY)</span>
    <span class="hljs-meta">@GetMapping("/list")</span>
    <span class="hljs-keyword">public</span> TableDataInfo <span class="hljs-title function_">list</span><span class="hljs-params">(SysUser user)</span> {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">return</span> getDataTable(list);
    }
}
</code></pre>
<h3 data-id="heading-24">5.2 高级用法</h3>
<h4 data-id="heading-25">5.2.1 排除敏感参数</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Log(
    title = "用户管理", 
    businessType = BusinessType.UPDATE,
    excludeParamNames = {"password", "secretKey"}
)</span>
<span class="hljs-meta">@PutMapping</span>
<span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">updateUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SysUser user)</span> {
    <span class="hljs-comment">// 业务逻辑</span>
}
</code></pre>
<h4 data-id="heading-26">5.2.2 不保存请求参数</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Log(
    title = "用户管理", 
    businessType = BusinessType.QUERY,
    isSaveRequestData = false
)</span>
<span class="hljs-meta">@GetMapping("/list")</span>
<span class="hljs-keyword">public</span> TableDataInfo <span class="hljs-title function_">list</span><span class="hljs-params">(SysUser user)</span> {
    <span class="hljs-comment">// 业务逻辑</span>
}
</code></pre>
<h4 data-id="heading-27">5.2.3 不保存响应结果</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Log(
    title = "用户管理", 
    businessType = BusinessType.QUERY,
    isSaveResponseData = false
)</span>
<span class="hljs-meta">@GetMapping("/list")</span>
<span class="hljs-keyword">public</span> TableDataInfo <span class="hljs-title function_">list</span><span class="hljs-params">(SysUser user)</span> {
    <span class="hljs-comment">// 业务逻辑</span>
}
</code></pre>
<h4 data-id="heading-28">5.2.4 指定操作人类别</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Log(
    title = "移动端用户管理", 
    businessType = BusinessType.INSERT,
    operatorType = OperatorType.MOBILE
)</span>
<span class="hljs-meta">@PostMapping</span>
<span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SysUser user)</span> {
    <span class="hljs-comment">// 业务逻辑</span>
}
</code></pre>
<h3 data-id="heading-29">5.3 业务类型枚举</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">BusinessType</span> {
    OTHER,      <span class="hljs-comment">// 其它</span>
    INSERT,     <span class="hljs-comment">// 新增</span>
    UPDATE,     <span class="hljs-comment">// 修改</span>
    DELETE,     <span class="hljs-comment">// 删除</span>
    GRANT,      <span class="hljs-comment">// 授权</span>
    EXPORT,     <span class="hljs-comment">// 导出</span>
    IMPORT,     <span class="hljs-comment">// 导入</span>
    FORCE,      <span class="hljs-comment">// 强退</span>
    GENCODE,    <span class="hljs-comment">// 生成代码</span>
    CLEAN,      <span class="hljs-comment">// 清空数据</span>
    QUERY       <span class="hljs-comment">// 查询</span>
}
</code></pre>
<h3 data-id="heading-30">5.4 操作人类别枚举</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">OperatorType</span> {
    OTHER,      <span class="hljs-comment">// 其它</span>
    MANAGE,     <span class="hljs-comment">// 后台用户</span>
    MOBILE      <span class="hljs-comment">// 手机端用户</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-31">六、技术要点</h2>
<h3 data-id="heading-32">6.1 AOP切面技术</h3>
<ul>
<li>使用<code>@Aspect</code>和<code>@Component</code>声明切面</li>
<li>使用<code>@Before</code>、<code>@AfterReturning</code>、<code>@AfterThrowing</code>定义切点</li>
<li>切点表达式：<code>@annotation(controllerLog)</code>，拦截带<code>@Log</code>注解的方法</li>
</ul>
<h3 data-id="heading-33">6.2 ThreadLocal使用</h3>
<ul>
<li>使用<code>NamedThreadLocal</code>记录方法开始时间</li>
<li>线程安全，避免并发问题</li>
<li>在<code>finally</code>中清理，防止内存泄漏</li>
</ul>
<h3 data-id="heading-34">6.3 异步处理</h3>
<ul>
<li>使用<code>ScheduledExecutorService</code>实现异步</li>
<li>延迟<code>10ms</code>执行，不阻塞主流程</li>
<li>单例模式管理异步任务</li>
</ul>
<h3 data-id="heading-35">6.4 敏感信息过滤</h3>
<ul>
<li>默认过滤密码相关字段</li>
<li>支持注解指定过滤字段</li>
<li>使用<code>PropertyPreExcludeFilter</code>实现JSON序列化过滤</li>
</ul>
<h3 data-id="heading-36">6.5 IP地址解析</h3>
<ul>
<li>使用<code>IpUtils.getIpAddr()</code>获取真实IP</li>
<li>使用<code>AddressUtils.getRealAddressByIP()</code>查询地理位置</li>
<li>支持代理服务器场景</li>
</ul>
<h3 data-id="heading-37">6.6 参数长度限制</h3>
<ul>
<li>请求参数：最大2000字符</li>
<li>响应结果：最大2000字符</li>
<li>错误消息：最大2000字符</li>
<li>使用<code>StringUtils.substring()</code>截断</li>
</ul>
<h3 data-id="heading-38">6.7 异常处理</h3>
<ul>
<li>切面捕获异常，不影响业务</li>
<li>记录异常信息到日志</li>
<li>异常时设置<code>status</code>为<code>FAIL</code>，记录<code>errorMsg</code></li>
</ul>
<hr/>
<h2 data-id="heading-39">七、扩展说明</h2>
<h3 data-id="heading-40">7.1 ControllerLogsAspect（调试日志切面）</h3>
<p>除了<code>LogAspect</code>，还有一个<code>ControllerLogsAspect</code>用于开发调试：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Order(1)</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ControllerLogsAspect</span> {

    <span class="hljs-meta">@Pointcut("execution(public * com.construct.*.controller..*.*(..))")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pointCut</span><span class="hljs-params">()</span> {}

    <span class="hljs-meta">@Before("pointCut()")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doBeforeInServiceLayer</span><span class="hljs-params">(JoinPoint joinPoint)</span> {
        <span class="hljs-comment">// 记录开始时间</span>
    }

    <span class="hljs-meta">@AfterReturning(pointcut = "pointCut()", returning = "returnValue")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(JoinPoint joinPoint, Object returnValue)</span> {
        <span class="hljs-comment">// 打印调试日志</span>
    }
}
</code></pre>
<p>功能：</p>
<ul>
<li>拦截所有<code>Controller</code>方法</li>
<li>记录请求URL、参数、响应结果、处理时间</li>
<li>仅非生产环境输出日志</li>
<li>排除静态资源请求</li>
</ul>
<h3 data-id="heading-41">7.2 业务日志扩展</h3>
<p>系统还提供了业务日志扩展（如<code>PubOperateLog</code>、<code>DmsOperateLog</code>），用于记录业务数据变更：特点：</p>
<ul>
<li>记录字段级别的变更（修改前/修改后）</li>
<li>支持业务ID关联</li>
<li>支持操作类型（创建/编辑）</li>
<li>支持操作详情记录</li>
</ul>
<h3 data-id="heading-42">7.3 日志查询和管理</h3>
<p>系统提供了日志查询和管理功能：</p>
<ul>
<li>操作日志查询：<code>/monitor/operlog/list</code></li>
<li>登录日志查询：<code>/monitor/logininfor/list</code></li>
<li>日志导出：支持Excel导出</li>
<li>日志删除：支持批量删除和清空</li>
</ul>
<hr/>
<h2 data-id="heading-43">八、总结</h2>
<h3 data-id="heading-44">8.1 设计优势</h3>
<ol>
<li>非侵入：通过注解实现，不影响业务代码</li>
<li>异步处理：日志写入不阻塞主流程</li>
<li>灵活配置：支持多种配置选项</li>
<li>安全过滤：自动过滤敏感信息</li>
<li>异常处理：完善的异常处理机制</li>
<li>性能优化：延迟执行、线程池管理</li>
</ol>
<h3 data-id="heading-45">8.2 适用场景</h3>
<ul>
<li>操作审计：记录用户操作</li>
<li>问题排查：通过日志定位问题</li>
<li>性能监控：记录方法执行时间</li>
<li>安全审计：记录登录和操作信息</li>
</ul>
<h3 data-id="heading-46">8.3 注意事项</h3>
<ol>
<li>日志表会持续增长，需要定期清理</li>
<li>异步执行可能丢失日志（极端情况）</li>
<li>参数长度限制可能截断重要信息</li>
<li>IP地址解析依赖外部服务，可能影响性能</li>
<li>生产环境建议关闭调试日志切面</li>
</ol>
<hr/>
<h2 data-id="heading-47">附录：相关文件清单</h2>
<h3 data-id="heading-48">核心文件</h3>
<ul>
<li><code>LogAspect.java</code> - 操作日志切面</li>
<li><code>ControllerLogsAspect.java</code> - 控制器日志切面（调试用）</li>
<li><code>Log.java</code> - 日志注解定义</li>
<li><code>AsyncManager.java</code> - 异步任务管理器</li>
<li><code>AsyncFactory.java</code> - 异步工厂</li>
<li><code>ThreadPoolConfig.java</code> - 线程池配置</li>
</ul>
<h3 data-id="heading-49">实体类</h3>
<ul>
<li><code>SysOperLog.java</code> - 操作日志实体</li>
<li><code>SysLogininfor.java</code> - 登录日志实体</li>
</ul>
<h3 data-id="heading-50">服务层</h3>
<ul>
<li><code>ISysOperLogService.java</code> - 操作日志服务接口</li>
<li><code>SysOperLogServiceImpl.java</code> - 操作日志服务实现</li>
<li><code>ISysLogininforService.java</code> - 登录日志服务接口</li>
<li><code>SysLogininforServiceImpl.java</code> - 登录日志服务实现</li>
</ul>
<h3 data-id="heading-51">数据层</h3>
<ul>
<li><code>SysOperLogMapper.java</code> - 操作日志Mapper接口</li>
<li><code>SysOperLogMapper.xml</code> - 操作日志Mapper XML</li>
<li><code>SysLogininforMapper.java</code> - 登录日志Mapper接口</li>
<li><code>SysLogininforMapper.xml</code> - 登录日志Mapper XML</li>
</ul>
<h3 data-id="heading-52">控制器</h3>
<ul>
<li><code>SysOperlogController.java</code> - 操作日志管理控制器</li>
<li><code>SysLogininforController.java</code> - 登录日志管理控制器</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java基础-4：JDK 中基于 AQS 的核心类详解与使用示例]]></title>    <link>https://juejin.cn/post/7598537739516919850</link>    <guid>https://juejin.cn/post/7598537739516919850</guid>    <pubDate>2026-01-25T12:50:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598537739516919850" data-draft-id="7598587406708080681" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java基础-4：JDK 中基于 AQS 的核心类详解与使用示例"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-25T12:50:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="beata"/> <meta itemprop="url" content="https://juejin.cn/user/1839900247461280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java基础-4：JDK 中基于 AQS 的核心类详解与使用示例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1839900247461280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    beata
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:50:40.000Z" title="Sun Jan 25 2026 12:50:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在上一篇中我们详细介绍了AQS的底层代码实现逻辑，这里我们来介绍基于AQS实现的类，在 Java 并发编程中，<code>java.util.concurrent</code>（JUC）包为我们提供了大量高效、可靠的并发工具类。这些工具类的底层实现大多依赖于一个关键的抽象框架——<strong>AbstractQueuedSynchronizer</strong>（AQS）。本文将深入介绍 AQS 的基本原理，并详细讲解 JDK 中几个基于 AQS 实现的核心同步器类，包括 <code>ReentrantLock</code>、<code>Semaphore</code>、<code>CountDownLatch</code>、<code>ReentrantReadWriteLock</code> 和 <code>Condition</code>，并附上实用的代码示例。</p>
<hr/>
<h2 data-id="heading-0">一、什么是 AQS？</h2>
<p><strong>AbstractQueuedSynchronizer</strong>（AQS）是 Doug Lea 设计的一个用于构建锁和同步器的基础框架。它通过一个 <strong>int 类型的 state</strong> 表示同步状态，并维护一个 <strong>FIFO 的等待队列</strong>（CLH 队列变体），用于管理那些未能获取资源而被阻塞的线程。</p>
<p>AQS 的核心思想是：</p>
<ul>
<li>子类通过重写 <code>tryAcquire</code> / <code>tryRelease</code>（独占模式）或 <code>tryAcquireShared</code> / <code>tryReleaseShared</code>（共享模式）等方法来定义如何获取/释放资源。</li>
<li>AQS 负责线程的排队、唤醒、阻塞等复杂逻辑。</li>
</ul>
<p>AQS 支持两种资源共享方式：</p>
<ul>
<li><strong>独占式</strong>（Exclusive）：如 ReentrantLock</li>
<li><strong>共享式</strong>（Shared）：如 Semaphore、CountDownLatch</li>
</ul>
<hr/>
<h2 data-id="heading-1">二、JDK 中基于 AQS 的核心类</h2>
<h3 data-id="heading-2">1. ReentrantLock（可重入锁）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>基于 AQS 独占模式实现</li>
<li>支持公平锁与非公平锁</li>
<li>可重入（同一线程可多次获取）</li>
<li>支持 Condition</li>
</ul>
<h4 data-id="heading-3">示例代码：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReentrantLockExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                lock.lock();
                <span class="hljs-keyword">try</span> {
                    count++;
                } <span class="hljs-keyword">finally</span> {
                    lock.unlock();
                }
            }
        });

        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                lock.lock();
                <span class="hljs-keyword">try</span> {
                    count++;
                } <span class="hljs-keyword">finally</span> {
                    lock.unlock();
                }
            }
        });

        t1.start();
        t2.start();
        t1.join();
        t2.join();

        System.out.println(<span class="hljs-string">"Final count: "</span> + count); <span class="hljs-comment">// 输出 2000</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-4">2. Semaphore（信号量）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>基于 AQS 共享模式实现</li>
<li>控制同时访问特定资源的线程数量</li>
<li>常用于限流、资源池控制</li>
</ul>
<h4 data-id="heading-5">示例代码（模拟数据库连接池）：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.Semaphore;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SemaphoreExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Semaphore</span> <span class="hljs-variable">semaphore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Semaphore</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// 最多3个并发</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    semaphore.acquire(); <span class="hljs-comment">// 获取许可</span>
                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 获取数据库连接"</span>);
                    TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>); <span class="hljs-comment">// 模拟操作</span>
                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 释放数据库连接"</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                } <span class="hljs-keyword">finally</span> {
                    semaphore.release(); <span class="hljs-comment">// 释放许可</span>
                }
            }, <span class="hljs-string">"Thread-"</span> + i).start();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-6">3. CountDownLatch（倒计时门闩）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>基于 AQS 共享模式实现</li>
<li>初始化时指定一个计数，调用 <code>countDown()</code> 减 1，<code>await()</code> 阻塞直到计数为 0</li>
<li>一次性使用，计数不能重置</li>
</ul>
<h4 data-id="heading-7">示例代码（等待多个任务完成）：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CountDownLatchExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">int</span> <span class="hljs-variable">threadCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(threadCount);

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; threadCount; i++) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 模拟任务</span>
                    Thread.sleep((<span class="hljs-type">long</span>) (Math.random() * <span class="hljs-number">2000</span>));
                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 完成任务"</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                } <span class="hljs-keyword">finally</span> {
                    latch.countDown(); <span class="hljs-comment">// 计数减1</span>
                }
            }).start();
        }

        latch.await(); <span class="hljs-comment">// 主线程等待所有任务完成</span>
        System.out.println(<span class="hljs-string">"所有任务已完成，继续执行后续逻辑"</span>);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-8">4. ReentrantReadWriteLock（读写锁）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>内部包含两个锁：ReadLock（共享）和 WriteLock（独占）</li>
<li>多个读线程可同时访问，但写线程必须独占</li>
<li>适用于“读多写少”场景</li>
</ul>
<h4 data-id="heading-9">示例代码（缓存读写）：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadWriteLockCache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, String&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantReadWriteLock</span> <span class="hljs-variable">rwLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> {
        rwLock.readLock().lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> cache.get(key);
        } <span class="hljs-keyword">finally</span> {
            rwLock.readLock().unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String key, String value)</span> {
        rwLock.writeLock().lock();
        <span class="hljs-keyword">try</span> {
            cache.put(key, value);
        } <span class="hljs-keyword">finally</span> {
            rwLock.writeLock().unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ReadWriteLockCache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReadWriteLockCache</span>();
        cache.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"Alice"</span>);

        <span class="hljs-comment">// 多个读线程</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 读取: "</span> + cache.get(<span class="hljs-string">"name"</span>));
            }).start();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-10">5. Condition（条件变量）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>与 Lock 配合使用，替代 Object 的 wait/notify</li>
<li>一个 Lock 可以创建多个 Condition，实现更精细的线程通信</li>
</ul>
<h4 data-id="heading-11">示例代码（生产者-消费者模型）：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.LinkedList;
<span class="hljs-keyword">import</span> java.util.Queue;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.Condition;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProducerConsumerWithCondition</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Queue&lt;Integer&gt; buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">capacity</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">notFull</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">notEmpty</span> <span class="hljs-operator">=</span> lock.newCondition();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">produce</span><span class="hljs-params">(<span class="hljs-type">int</span> item)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (buffer.size() == capacity) {
                System.out.println(<span class="hljs-string">"Buffer full, producer waiting..."</span>);
                notFull.await();
            }
            buffer.offer(item);
            System.out.println(<span class="hljs-string">"Produced: "</span> + item);
            notEmpty.signal(); <span class="hljs-comment">// 唤醒消费者</span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">consume</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (buffer.isEmpty()) {
                System.out.println(<span class="hljs-string">"Buffer empty, consumer waiting..."</span>);
                notEmpty.await();
            }
            <span class="hljs-type">int</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> buffer.poll();
            System.out.println(<span class="hljs-string">"Consumed: "</span> + item);
            notFull.signal(); <span class="hljs-comment">// 唤醒生产者</span>
            <span class="hljs-keyword">return</span> item;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ProducerConsumerWithCondition</span> <span class="hljs-variable">pc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProducerConsumerWithCondition</span>();

        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) {
                    pc.produce(i);
                    Thread.sleep(<span class="hljs-number">500</span>);
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }).start();

        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
                    pc.consume();
                    Thread.sleep(<span class="hljs-number">1000</span>);
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }).start();
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-12">三、总结</h2>



































<table><thead><tr><th>同步器</th><th>AQS 模式</th><th>典型用途</th></tr></thead><tbody><tr><td><code>ReentrantLock</code></td><td>独占</td><td>替代 synchronized，支持超时、中断、公平性</td></tr><tr><td><code>Semaphore</code></td><td>共享</td><td>控制并发线程数，资源池限流</td></tr><tr><td><code>CountDownLatch</code></td><td>共享</td><td>等待 N 个任务完成后再继续</td></tr><tr><td><code>ReentrantReadWriteLock</code></td><td>读（共享）/写（独占）</td><td>读多写少的并发访问控制</td></tr><tr><td><code>Condition</code></td><td>与 Lock 配合</td><td>精细线程通信（替代 wait/notify）</td></tr></tbody></table>
<p>这些类都封装了 AQS 的复杂性，让开发者可以专注于业务逻辑，而无需手动处理线程调度和状态管理。理解 AQS 的工作原理，有助于我们更高效、安全地使用这些并发工具。</p>
<blockquote>
<p><strong>提示</strong>：虽然 AQS 强大，但除非你正在开发新的同步组件（如自定义锁），否则一般不需要直接继承 AQS。日常开发中，优先使用 JUC 提供的标准同步器即可。</p>
</blockquote>
<hr/>
<p>希望本文能帮助你深入理解 AQS 及其在 JDK 中的应用。如果你有任何问题或想了解更底层的源码机制，欢迎留言讨论！</p>
<blockquote>
<p>作者：架构师Beata<br/>
日期：2026年1月25日<br/>
版权声明：本文可自由转载，但请保留出处</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL的锁机制、适用场景以及对应的解决方案]]></title>    <link>https://juejin.cn/post/7598881914203750450</link>    <guid>https://juejin.cn/post/7598881914203750450</guid>    <pubDate>2026-01-25T12:51:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598881914203750450" data-draft-id="7598921649888378907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL的锁机制、适用场景以及对应的解决方案"/> <meta itemprop="keywords" content="后端,MySQL"/> <meta itemprop="datePublished" content="2026-01-25T12:51:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三水不滴"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL的锁机制、适用场景以及对应的解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三水不滴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:51:16.000Z" title="Sun Jan 25 2026 12:51:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读27分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MySQL 锁机制全解析：所有锁类型、适用场景与落地解决方案</h2>
<p>MySQL 锁机制是数据库<strong>并发控制</strong>的核心，用于解决多事务同时操作数据时的<strong>脏读、不可重复读、幻读</strong>以及<strong>数据不一致</strong>问题，是保障数据一致性和高并发处理能力的基础。不同存储引擎的锁机制差异显著，其中 InnoDB 作为 MySQL 默认引擎，实现了<strong>细粒度的行级锁</strong>，并兼容表级锁，是互联网后端开发的核心研究对象；而 MyISAM 仅支持表级锁，现已逐步被淘汰。</p>
<p>本文将从<strong>锁的整体分类</strong>出发，详细讲解 MySQL 中<strong>所有锁类型</strong>的定义、特性、触发条件，结合互联网后端典型业务场景给出<strong>锁的选择策略与可落地的解决方案</strong>（含 SQL/Java 代码），同时分析生产高频的锁阻塞、死锁问题的定位与解决，兼顾面试八股文和生产实战需求。</p>
<h3 data-id="heading-1">一、MySQL 锁的整体分类</h3>
<p>MySQL 锁的分类维度多样，核心按<strong>锁粒度</strong>（最常用）、<strong>锁兼容性</strong>、<strong>实现方式</strong>划分，不同分类维度可交叉，例如 InnoDB 的行级锁包含共享行锁和排他行锁。以下是全维度分类体系，建立对 MySQL 锁的整体认知：</p>

























































































<table><thead><tr><th>分类维度</th><th>锁类型</th><th>核心存储引擎</th><th>锁粒度 / 特性</th><th>核心适用场景</th></tr></thead><tbody><tr><td><strong>锁粒度</strong></td><td>表级锁（Table Lock）</td><td>MyISAM/InnoDB</td><td>整表加锁，粒度粗，开销小，并发低</td><td>整表批量操作、静态数据修改</td></tr><tr><td/><td>行级锁（Row Lock）</td><td>InnoDB</td><td>单行加锁，粒度细，开销大，并发高</td><td>高并发单行 / 多行更新、读写混合场景</td></tr><tr><td/><td>页级锁（Page Lock）</td><td>BDB</td><td>数据页加锁，粒度介于表 / 行之间</td><td>极少使用，已被 InnoDB 替代</td></tr><tr><td><strong>锁兼容性</strong></td><td>共享锁（Shared Lock，S 锁）</td><td>InnoDB/MyISAM</td><td>读锁，多个 S 锁可共存</td><td>数据查询，不允许其他事务修改</td></tr><tr><td/><td>排他锁（Exclusive Lock，X 锁）</td><td>InnoDB/MyISAM</td><td>写锁，与任何锁互斥</td><td>数据插入 / 更新 / 删除</td></tr><tr><td><strong>实现方式</strong></td><td>意向锁（Intention Lock，IS/IX）</td><td>InnoDB</td><td>表级锁，配合行级锁使用</td><td>行级锁的前置锁，避免表锁与行锁冲突</td></tr><tr><td><strong>特殊锁</strong></td><td>记录锁（Record Lock）</td><td>InnoDB</td><td>行级锁的基础，锁定单行记录</td><td>单行精准更新</td></tr><tr><td/><td>间隙锁（Gap Lock）</td><td>InnoDB</td><td>行级锁，锁定索引间隙</td><td>防止幻读，区间查询</td></tr><tr><td/><td>临键锁（Next-Key Lock）</td><td>InnoDB</td><td>记录锁 + 间隙锁，InnoDB 默认行锁</td><td>RR 隔离级别下的行级锁默认形态</td></tr><tr><td/><td>元数据锁（MDL）</td><td>所有引擎</td><td>表级锁，锁定表结构</td><td>表结构修改（ALTER）、表查询</td></tr><tr><td/><td>自增锁（AUTO-INC Lock）</td><td>InnoDB</td><td>表级 / 行级，锁定自增列</td><td>自增主键的插入操作</td></tr></tbody></table>
<p><strong>核心前提</strong>：InnoDB 的锁机制依赖<strong>事务隔离级别</strong>，默认隔离级别为<strong>可重复读（RR）</strong> ，临键锁、间隙锁仅在 RR 级别生效；** 读已提交（RC）** 级别下，InnoDB 会关闭间隙锁，仅保留记录锁，并发更高但无法解决幻读。</p>
<h3 data-id="heading-2">二、各类型锁的详细解析</h3>
<p>本节将逐一讲解 MySQL 中<strong>所有锁类型</strong>的定义、触发条件、特性，重点聚焦 InnoDB 的锁机制（面试 + 生产核心），对 MyISAM/BDB 的锁仅做基础说明。</p>
<h4 data-id="heading-3">2.1 表级锁（Table Lock）：整表管控，简单高效</h4>
<p>表级锁是 MySQL 中<strong>粒度最粗</strong>的锁，对整张表加锁，分为<strong>表共享锁（S 锁）<strong>和</strong>表排他锁（X 锁）</strong> ，MyISAM 的默认锁，InnoDB 也支持手动加表锁。</p>
<h5 data-id="heading-4">核心特性</h5>
<ol>
<li>加锁 / 解锁开销小，无需遍历索引，执行速度快；</li>
<li>并发性能极低：加表 X 锁后，其他事务无法对该表执行<strong>任何读写操作</strong>；加表 S 锁后，其他事务可读但不可写；</li>
<li>InnoDB 中<strong>不建议默认使用</strong>，仅在整表批量操作时手动使用，否则会丧失行级锁的高并发优势。</li>
</ol>
<h5 data-id="heading-5">加锁 / 解锁 SQL（InnoDB/MyISAM 通用）</h5>
<pre><code class="hljs language-sql" lang="sql"># 手动加表共享锁（S锁），加锁后仅能读，不能写
LOCK TABLES `goods_stock` READ;
# 手动加表排他锁（X锁），加锁后禁止其他所有操作
LOCK TABLES `goods_stock` WRITE;
# 解锁（必须手动解锁，否则会话断开前一直持有）
UNLOCK TABLES;
</code></pre>
<h4 data-id="heading-6">2.2 行级锁（Row Lock）：InnoDB 核心，高并发基石</h4>
<p>行级锁是 InnoDB 的<strong>核心锁机制</strong>，粒度最细，仅对操作的<strong>单行 / 多行记录</strong>加锁，分为<strong>行共享锁（S 锁）<strong>和</strong>行排他锁（X 锁）</strong> ，是实现高并发读写的关键。</p>
<p>InnoDB 的行级锁并非直接锁定数据行，而是<strong>基于索引锁定</strong>（索引项加锁），若无索引或未使用索引，行级锁会<strong>退化为表级锁</strong>（生产高频坑点）。</p>
<p>根据锁定范围，InnoDB 的行级锁细分为<strong>记录锁、间隙锁、临键锁</strong>（三者为行级锁的具体实现，非独立分类），以下是详细说明：</p>
<h5 data-id="heading-7">2.2.1 记录锁（Record Lock）：精准锁定单行</h5>
<p><strong>定义</strong>：锁定<strong>索引上的单行记录</strong>，仅对当前存在的行生效，是最基础的行级锁。<strong>触发条件</strong>：<strong>精准匹配索引的等值查询</strong>（主键 / 唯一索引），RR/RC 隔离级别均生效。<strong>示例</strong>：通过商品 ID（主键）更新库存，InnoDB 会对<code>goods_id=1001</code>的索引项加记录锁，仅阻塞该单行的其他写操作，不影响其他商品。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> goods_stock <span class="hljs-keyword">SET</span> stock_num<span class="hljs-operator">=</span><span class="hljs-number">99</span> <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-number">1001</span>; # 主键等值查询，触发记录锁
</code></pre>
<h5 data-id="heading-8">2.2.2 间隙锁（Gap Lock）：锁定索引间隙，防止幻读</h5>
<p><strong>定义</strong>：锁定<strong>两个索引项之间的间隙</strong>（也包括索引首行前、末行后的间隙），不锁定具体行，目的是<strong>防止其他事务在该间隙插入数据</strong>，解决幻读问题。<strong>触发条件</strong>：<strong>RR 隔离级别下</strong>，对<strong>非唯一索引的范围查询 / 等值查询</strong>（未命中行）。<strong>特性</strong>：间隙锁之间<strong>互相兼容</strong>，多个事务可同时对同一间隙加间隙锁，仅阻塞插入操作。<strong>示例</strong>：商品表的非唯一索引<code>idx_category</code>（分类 ID）有值 [1,3,5]，执行范围查询<code>WHERE category_id&gt;2 AND category_id&lt;5</code>，InnoDB 会锁定间隙 (3,5)，其他事务无法在该间隙插入<code>category_id=4</code>的记录。</p>
<h5 data-id="heading-9">2.2.3 临键锁（Next-Key Lock）：InnoDB 默认行锁</h5>
<p><strong>定义</strong>：<strong>记录锁 + 间隙锁</strong>的组合，锁定<strong>当前索引行 + 其后续的索引间隙</strong>，是 InnoDB 在<strong>RR 隔离级别下的默认行级锁形态</strong>。<strong>触发条件</strong>：<strong>RR 隔离级别下</strong>，所有行级锁的默认触发（等值查询命中唯一索引时，临键锁会<strong>降级为记录锁</strong>）。<strong>核心作用</strong>：同时解决<strong>不可重复读</strong>和<strong>幻读</strong>，是 InnoDB RR 级别实现事务隔离的核心。<strong>示例</strong>：索引值 [1,3,5]，执行<code>WHERE category_id&lt;=3</code>，临键锁会锁定 (∞,1]、(1,3] 的记录 + 间隙，其他事务既不能修改 1、3 行，也不能在间隙中插入数据。</p>
<h4 data-id="heading-10">2.3 页级锁（Page Lock）：淘汰的中间方案</h4>
<p>页级锁是 BDB 存储引擎的锁机制，锁定<strong>数据页</strong>（InnoDB 默认 16KB / 页），粒度介于表级锁和行级锁之间。<strong>特性</strong>：加锁开销、并发性能也介于两者之间，无明显优势；<strong>现状</strong>：BDB 引擎已被 MySQL 官方逐步淘汰，实际开发中几乎不使用，无需深入研究。</p>
<h4 data-id="heading-11">2.4 意向锁（Intention Lock）：行级锁的 “前置锁”</h4>
<p>意向锁是 InnoDB 的<strong>表级锁</strong>，分为<strong>意向共享锁（IS）<strong>和</strong>意向排他锁（IX）</strong> ，是行级锁的<strong>前置锁</strong>——<strong>加行级锁前，必须先加对应的意向锁</strong>。</p>
<h5 data-id="heading-12">核心作用</h5>
<p>解决<strong>表级锁与行级锁的冲突检测问题</strong>，避免加表锁时遍历全表检查是否有行锁（大幅提升加锁效率）。</p>
<h5 data-id="heading-13">触发条件</h5>
<ul>
<li>加<strong>行 S 锁</strong>前，自动加<strong>表 IS 锁</strong>；</li>
<li>加<strong>行 X 锁</strong>前，自动加<strong>表 IX 锁</strong>；</li>
<li>意向锁由 InnoDB<strong>自动加锁 / 解锁</strong>，无需手动操作。</li>
</ul>
<h5 data-id="heading-14">特性</h5>
<ol>
<li>意向锁是<strong>表级锁</strong>，仅用于冲突检测，不阻塞任何读写操作；</li>
<li>意向锁之间<strong>互相兼容</strong>，IS 和 IX 可共存；</li>
<li>意向锁与表级锁<strong>互斥</strong>：表 X 锁与 IS/IX 均互斥，表 S 锁仅与 IX 互斥。</li>
</ol>
<h4 data-id="heading-15">2.5 特殊锁：生产高频易踩坑的锁类型</h4>
<p>这类锁并非传统的读写锁，而是 MySQL 为<strong>特殊场景</strong>设计的锁，是生产中<strong>锁阻塞、死锁</strong>的高频诱因，也是面试重点。</p>
<h5 data-id="heading-16">2.5.1 元数据锁（MDL）：表结构的 “隐形锁”</h5>
<p><strong>定义</strong>：MDL（Metadata Lock）是<strong>表级锁</strong>，锁定表的<strong>元数据（表结构）</strong> ，所有 MySQL 引擎均支持，<strong>自动加锁 / 解锁</strong>，无需手动操作。<strong>核心作用</strong>：保证<strong>表结构与数据的一致性</strong>，避免查询过程中表结构被修改（如查询时执行 ALTER TABLE）。</p>
<h5 data-id="heading-17">加锁规则（核心）</h5>
<p>MDL 锁分为 S 锁和 X 锁，加锁逻辑由 MySQL 自动控制，<strong>会话断开前一直持有</strong>：</p>
<ol>
<li>执行<strong>表查询操作</strong>（SELECT/SHOW），自动加<strong>MDL S 锁</strong>，多个 MDL S 锁可共存；</li>
<li>执行<strong>表结构修改操作</strong>（ALTER/DROP/RENAME），自动加<strong>MDL X 锁</strong>，与任何 MDL 锁互斥；</li>
<li>执行<strong>数据修改操作</strong>（INSERT/UPDATE/DELETE），自动加<strong>MDL S 锁</strong>（与查询一致）。</li>
</ol>
<h5 data-id="heading-18">生产高频问题</h5>
<p>高并发查询场景下，执行<code>ALTER TABLE</code>会加 MDL X 锁，而此时表上已有大量 MDL S 锁，导致：</p>
<ul>
<li>MDL X 锁等待所有 MDL S 锁释放；</li>
<li>后续所有查询 / 修改操作会排队等待 MDL X 锁释放，最终导致<strong>整个表的操作阻塞</strong>（生产重大故障）。</li>
</ul>
<h5 data-id="heading-19">2.5.2 自增锁（AUTO-INC Lock）：自增主键的专属锁</h5>
<p><strong>定义</strong>：AUTO-INC Lock 是 InnoDB 为<strong>自增列（AUTO_INCREMENT）<strong>设计的锁，用于保证</strong>自增列值的唯一性和连续性</strong>，避免批量插入时自增 ID 重复。</p>
<h5 data-id="heading-20">加锁模式（innodb_autoinc_lock_mode）</h5>
<p>InnoDB 通过参数<code>innodb_autoinc_lock_mode</code>控制自增锁的加锁粒度，默认值为<strong>1</strong>，可选 0/1/2，不同模式的并发性能不同：</p>

































<table><thead><tr><th>模式值</th><th>锁模式</th><th>特性</th><th>并发性能</th><th>适用场景</th></tr></thead><tbody><tr><td>0</td><td>传统模式</td><td>表级 AUTO-INC 锁，批量插入全程持有</td><td>最低</td><td>需严格连续自增 ID 的场景</td></tr><tr><td>1</td><td>连续模式（默认）</td><td>单行插入行级锁，批量插入表级锁</td><td>中等</td><td>常规业务（大部分场景）</td></tr><tr><td>2</td><td>交错模式</td><td>全程行级锁，自增 ID 可能不连续</td><td>最高</td><td>高并发批量插入（如分库分表）</td></tr></tbody></table>
<h5 data-id="heading-21">核心特性</h5>
<ul>
<li>模式 2 是<strong>并发性能最高</strong>的，但自增 ID 可能不连续（因多事务同时插入）；</li>
<li>主从复制中，若使用<strong>基于语句的复制（SBR）</strong> ，不建议使用模式 2（可能导致从库数据不一致），建议使用<strong>基于行的复制（RBR）</strong> 。</li>
</ul>
<h3 data-id="heading-22">三、MySQL 锁的兼容性矩阵</h3>
<p>锁的<strong>兼容性</strong>指<strong>同一资源上，已持有锁与请求锁是否能共存</strong>，兼容则请求锁成功，不兼容则请求锁的事务<strong>阻塞等待</strong>。</p>
<p>以下是 MySQL<strong>核心锁类型</strong>的兼容性矩阵（√= 兼容，×= 不兼容，—= 无关联），是理解锁阻塞的基础，面试高频考点：</p>








































































































<table><thead><tr><th>已持有锁 \ 请求锁</th><th>表 S 锁</th><th>表 X 锁</th><th>表 IS 锁</th><th>表 IX 锁</th><th>行 S 锁</th><th>行 X 锁</th><th>MDL S 锁</th><th>MDL X 锁</th></tr></thead><tbody><tr><td>表 S 锁</td><td>√</td><td>×</td><td>√</td><td>×</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>表 X 锁</td><td>×</td><td>×</td><td>×</td><td>×</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>表 IS 锁</td><td>√</td><td>×</td><td>√</td><td>√</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>表 IX 锁</td><td>×</td><td>×</td><td>√</td><td>√</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>行 S 锁</td><td>—</td><td>—</td><td>—</td><td>—</td><td>√</td><td>×</td><td>—</td><td>—</td></tr><tr><td>行 X 锁</td><td>—</td><td>—</td><td>—</td><td>—</td><td>×</td><td>×</td><td>—</td><td>—</td></tr><tr><td>MDL S 锁</td><td>—</td><td>—</td><td>—</td><td>—</td><td>—</td><td>—</td><td>√</td><td>×</td></tr><tr><td>MDL X 锁</td><td>—</td><td>—</td><td>—</td><td>—</td><td>—</td><td>—</td><td>×</td><td>×</td></tr></tbody></table>
<p><strong>核心结论</strong>：</p>
<ol>
<li>排他锁（表 X / 行 X/MDL X）与<strong>所有锁</strong>互斥，是锁阻塞的核心原因；</li>
<li>共享锁（表 S / 行 S/MDL S）与<strong>其他共享锁</strong>兼容，与<strong>排他锁</strong>互斥；</li>
<li>意向锁（IS/IX）仅与<strong>表级锁</strong>互斥，彼此之间完全兼容。</li>
</ol>
<h3 data-id="heading-23">四、InnoDB 锁的核心实现前提：基于索引</h3>
<p><strong>InnoDB 的行级锁是基于索引实现的，而非基于数据行本身</strong>，这是 InnoDB 锁机制的<strong>核心原则</strong>，也是生产中最容易踩坑的点。</p>
<h4 data-id="heading-24">核心推论</h4>
<ol>
<li><strong>使用索引加锁</strong>：只有通过<strong>主键 / 唯一索引 / 普通索引</strong>的查询条件操作数据，InnoDB 才会加行级锁；</li>
<li><strong>无索引 / 未使用索引→表级锁</strong>：若查询条件无索引，或有索引但未使用（如隐式类型转换），InnoDB 会对整张表加表级锁，导致并发性能骤降；</li>
<li><strong>锁的是索引项，而非数据行</strong>：即使两行数据的物理存储在一起，只要索引项不同，行级锁也不会冲突。</li>
</ol>
<h4 data-id="heading-25">坑点示例：隐式类型转换导致索引失效，行锁退表锁</h4>
<pre><code class="hljs language-sql" lang="sql"># 表结构：goods_id是<span class="hljs-type">BIGINT</span>类型（主键索引）
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `goods_stock` (
  `goods_id` <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY,
  `stock_num` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB;

# 错误：查询条件传入字符串，触发隐式类型转换，索引失效→行锁退表锁
<span class="hljs-keyword">UPDATE</span> goods_stock <span class="hljs-keyword">SET</span> stock_num<span class="hljs-operator">=</span><span class="hljs-number">99</span> <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-string">'1001'</span>; 
# 正确：查询条件类型与索引一致，使用主键索引→加记录锁
<span class="hljs-keyword">UPDATE</span> goods_stock <span class="hljs-keyword">SET</span> stock_num<span class="hljs-operator">=</span><span class="hljs-number">99</span> <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-number">1001</span>;
</code></pre>
<h3 data-id="heading-26">五、典型业务场景与锁机制解决方案</h3>
<p>结合互联网后端<strong>高并发、高可用</strong>的核心需求，针对 8 大典型业务场景，给出<strong>锁的选择策略、可落地的代码实现（SQL/Java）、生产注意事项</strong>，覆盖从单库到分布式、从常规操作到问题解决的全场景。</p>
<h4 data-id="heading-27">场景 1：整表批量操作（如全表数据更新、数据迁移）</h4>
<h5 data-id="heading-28">场景描述</h5>
<p>需要对整张表执行批量更新 / 删除（如批量修改商品价格、清理历史数据），涉及数据量占表的 80% 以上。</p>
<h5 data-id="heading-29">问题痛点</h5>
<p>若使用 InnoDB 默认的行级锁，会遍历全表加大量行锁，加锁开销大、执行速度慢，且容易引发锁冲突。</p>
<h5 data-id="heading-30">锁选择策略</h5>
<p><strong>手动加表级排他锁（WRITE）</strong> ，放弃行级锁的高并发，提升批量操作效率。</p>
<h5 data-id="heading-31">落地 SQL 实现</h5>
<pre><code class="hljs language-sql" lang="sql"># <span class="hljs-number">1.</span> 手动加表排他锁，阻塞其他所有操作
LOCK TABLES `goods` WRITE;
# <span class="hljs-number">2.</span> 执行批量操作（如批量将分类<span class="hljs-number">1</span>的商品价格打<span class="hljs-number">9</span>折）
<span class="hljs-keyword">UPDATE</span> `goods` <span class="hljs-keyword">SET</span> price<span class="hljs-operator">=</span>price<span class="hljs-operator">*</span><span class="hljs-number">0.9</span> <span class="hljs-keyword">WHERE</span> category_id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;
# <span class="hljs-number">3.</span> 手动解锁，恢复表的正常操作
UNLOCK TABLES;
# <span class="hljs-number">4.</span> 若操作失败，直接解锁即可，无需回滚（表锁无事务特性）
</code></pre>
<h5 data-id="heading-32">生产注意事项</h5>
<ol>
<li>表级锁<strong>无事务特性</strong>，加锁后执行的操作立即生效，无需 COMMIT；</li>
<li>批量操作需在<strong>业务低峰期</strong>执行（如凌晨），避免阻塞正常业务；</li>
<li>操作前必须<strong>备份数据</strong>，防止批量更新错误。</li>
</ol>
<h4 data-id="heading-33">场景 2：高并发单行更新（如电商扣库存、秒杀减库存）</h4>
<h5 data-id="heading-34">场景描述</h5>
<p>高并发下对单行数据执行更新操作（如扣库存、修改用户余额），要求<strong>数据一致性</strong>，绝对避免超卖 / 超扣，冲突率高。</p>
<h5 data-id="heading-35">锁选择策略</h5>
<p><strong>InnoDB 行排他锁（记录锁）+ 显式事务</strong>（悲观锁），通过<code>FOR UPDATE</code>精准加行锁，保证事务原子性。</p>
<h5 data-id="heading-36">落地实现（SQL+Java）</h5>
<h6 data-id="heading-37">步骤 1：表结构设计（主键索引，保证行锁生效）</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `goods_stock` (
  `goods_id` <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY COMMENT <span class="hljs-string">'商品ID（主键）'</span>,
  `stock_num` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'库存数量'</span>,
  `update_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'商品库存表'</span>;
# 初始化库存：商品<span class="hljs-number">1001</span>库存<span class="hljs-number">100</span>件
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> goods_stock (goods_id, stock_num) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1001</span>, <span class="hljs-number">100</span>);
</code></pre>
<h6 data-id="heading-38">步骤 2：SQL 显式事务 + FOR UPDATE 加记录锁</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">BEGIN</span>; # 开启显式事务，关闭自动提交
# 主键等值查询，<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>加行排他锁（记录锁）
<span class="hljs-keyword">SELECT</span> stock_num <span class="hljs-keyword">FROM</span> goods_stock <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-number">1001</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
# 扣减库存，业务层需先判断stock_num<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span>
<span class="hljs-keyword">UPDATE</span> goods_stock <span class="hljs-keyword">SET</span> stock_num<span class="hljs-operator">=</span>stock_num<span class="hljs-number">-1</span> <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-number">1001</span> <span class="hljs-keyword">AND</span> stock_num<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span>;
# 获取受影响行数，业务层判断是否扣减成功（<span class="hljs-number">0</span><span class="hljs-operator">=</span>库存不足）
<span class="hljs-keyword">SELECT</span> ROW_COUNT();
<span class="hljs-keyword">COMMIT</span>; # 提交事务，释放锁
# <span class="hljs-keyword">ROLLBACK</span>; # 若失败，回滚事务，释放锁
</code></pre>
<h6 data-id="heading-39">步骤 3：Java 业务层实现（Spring Boot）</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span> <span class="hljs-comment">// 声明式事务，替代手动BEGIN/COMMIT</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StockService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hljs-comment">/**
     * 扣减库存（悲观锁实现）
     * <span class="hljs-doctag">@param</span> goodsId 商品ID
     * <span class="hljs-doctag">@return</span> true=成功，false=库存不足
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductStock</span><span class="hljs-params">(Long goodsId)</span> {
        <span class="hljs-comment">// 1. 查询库存并加行锁（FOR UPDATE）</span>
        <span class="hljs-type">Integer</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> jdbcTemplate.queryForObject(
                <span class="hljs-string">"SELECT stock_num FROM goods_stock WHERE goods_id=? FOR UPDATE"</span>,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]{goodsId},
                Integer.class
        );
        <span class="hljs-keyword">if</span> (stock == <span class="hljs-literal">null</span> || stock &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 库存不足</span>
        }
        <span class="hljs-comment">// 2. 扣减库存</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">row</span> <span class="hljs-operator">=</span> jdbcTemplate.update(
                <span class="hljs-string">"UPDATE goods_stock SET stock_num=stock_num-1 WHERE goods_id=? AND stock_num&gt;0"</span>,
                goodsId
        );
        <span class="hljs-keyword">return</span> row &gt; <span class="hljs-number">0</span>;
    }
}
</code></pre>
<h5 data-id="heading-40">生产注意事项</h5>
<ol>
<li><code>FOR UPDATE</code>必须在<strong>显式事务</strong>中使用，否则会自动提交，锁立即释放；</li>
<li>务必通过<strong>主键 / 唯一索引</strong>查询，避免行锁退表锁；</li>
<li>事务中仅包含核心操作，<strong>不执行耗时操作</strong>（如 RPC 调用、文件读写），缩短锁持有时间。</li>
</ol>
<h4 data-id="heading-41">场景 3：低冲突数据修改（如用户信息修改、订单状态更新）</h4>
<h5 data-id="heading-42">场景描述</h5>
<p>对数据执行修改操作，但<strong>冲突率极低</strong>（如用户修改昵称、订单状态从 “待支付” 改为 “已取消”），无需严格阻塞其他事务。</p>
<h5 data-id="heading-43">问题痛点</h5>
<p>若使用悲观锁（FOR UPDATE），会导致不必要的锁阻塞，降低并发性能。</p>
<h5 data-id="heading-44">锁选择策略</h5>
<p><strong>乐观锁</strong>（基于版本号 / 时间戳实现），无锁阻塞，通过版本号判断数据是否被修改，提升并发性能。</p>
<h5 data-id="heading-45">落地实现（SQL+Java）</h5>
<h6 data-id="heading-46">步骤 1：表结构新增版本号字段（乐观锁核心）</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> `user_info` <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'乐观锁版本号'</span>;
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> `order_info` <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'乐观锁版本号'</span>;
</code></pre>
<h6 data-id="heading-47">步骤 2：SQL 乐观锁更新逻辑</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">BEGIN</span>;
# <span class="hljs-number">1.</span> 查询用户信息和版本号
<span class="hljs-keyword">SELECT</span> nickname, version <span class="hljs-keyword">FROM</span> user_info <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-number">10086</span>;
# <span class="hljs-number">2.</span> 更新昵称，仅当版本号匹配时执行（保证基于最新版本修改）
<span class="hljs-keyword">UPDATE</span> user_info <span class="hljs-keyword">SET</span> nickname<span class="hljs-operator">=</span><span class="hljs-string">'新昵称'</span>, version<span class="hljs-operator">=</span>version<span class="hljs-operator">+</span><span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-number">10086</span> <span class="hljs-keyword">AND</span> version<span class="hljs-operator">=</span>#{oldVersion};
# <span class="hljs-number">3.</span> 判断受影响行数，<span class="hljs-number">0</span><span class="hljs-operator">=</span>数据已被其他事务修改
<span class="hljs-keyword">SELECT</span> ROW_COUNT();
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h6 data-id="heading-48">步骤 3：Java 业务层实现（带重试机制）</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-variable">@Service</span>
public class UserService {
    <span class="hljs-variable">@Autowired</span>
    private UserMapper userMapper;
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 最大重试次数
    private <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> MAX_RETRY <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

    <span class="hljs-comment">/**
     * 修改用户昵称（乐观锁+重试）
     * @param userId 用户ID
     * @param newNickname 新昵称
     * @return true=成功
     */</span>
    public <span class="hljs-type">boolean</span> updateNickname(Long userId, String newNickname) {
        <span class="hljs-type">int</span> retry <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        while (retry <span class="hljs-operator">&lt;</span> MAX_RETRY) {
            <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-number">1.</span> 查询用户最新信息和版本号
            UserInfo <span class="hljs-keyword">user</span> <span class="hljs-operator">=</span> userMapper.selectById(userId);
            if (<span class="hljs-keyword">user</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-number">2.</span> 执行乐观锁更新
            <span class="hljs-type">int</span> <span class="hljs-type">row</span> <span class="hljs-operator">=</span> userMapper.updateNickname(userId, newNickname, user.getVersion());
            if (<span class="hljs-type">row</span> <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 更新成功
            }
            retry<span class="hljs-operator">+</span><span class="hljs-operator">+</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 更新失败，重试
            try {
                Thread.sleep(<span class="hljs-number">100</span>); <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 短暂休眠，避免瞬时冲突
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 重试多次失败
    }
}

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> Mapper接口
public interface UserMapper {
    <span class="hljs-variable">@Select</span>("SELECT user_id, nickname, version FROM user_info WHERE user_id=#{userId}")
    UserInfo selectById(Long userId);

    <span class="hljs-variable">@Update</span>("UPDATE user_info SET nickname=#{newNickname}, version=version+1 WHERE user_id=#{userId} AND version=#{oldVersion}")
    <span class="hljs-type">int</span> updateNickname(<span class="hljs-variable">@Param</span>("userId") Long userId, <span class="hljs-variable">@Param</span>("newNickname") String newNickname, <span class="hljs-variable">@Param</span>("oldVersion") <span class="hljs-type">Integer</span> oldVersion);
}
</code></pre>
<h5 data-id="heading-49">生产注意事项</h5>
<ol>
<li>乐观锁<strong>无实际加锁</strong>，通过版本号实现冲突检测，适用于<strong>读多写少、冲突率低</strong>的场景；</li>
<li>必须增加<strong>重试机制</strong>，若更新失败，说明数据被其他事务修改，重试即可；</li>
<li>版本号建议使用<strong>INT/BIGINT</strong>，避免使用时间戳（存在并发下时间戳相同的情况）。</li>
</ol>
<h4 data-id="heading-50">场景 4：防幻读业务（如区间查询并更新、批量筛选数据）</h4>
<h5 data-id="heading-51">场景描述</h5>
<p>需要对<strong>索引区间</strong>内的数据执行查询并更新（如查询 “2025-01-01 至 2025-01-10” 的订单并修改状态），要求<strong>解决幻读</strong>（避免更新过程中其他事务在该区间插入新数据）。</p>
<h5 data-id="heading-52">锁选择策略</h5>
<p><strong>InnoDB 临键锁</strong>（RR 隔离级别默认），无需手动加锁，通过<strong>范围查询</strong>触发临键锁，锁定区间内的记录 + 间隙，防止幻读。</p>
<h5 data-id="heading-53">落地 SQL 实现</h5>
<pre><code class="hljs language-sql" lang="sql"># 订单表：create_time为DATETIME类型，有索引idx_create_time
# RR隔离级别下，范围查询自动触发临键锁，防止幻读
<span class="hljs-keyword">BEGIN</span>;
# 范围查询<span class="hljs-number">2025</span><span class="hljs-number">-01</span><span class="hljs-number">-01</span>至<span class="hljs-number">2025</span><span class="hljs-number">-01</span><span class="hljs-number">-10</span>的订单，触发临键锁
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> order_info <span class="hljs-keyword">WHERE</span> create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-01-10'</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
# 修改该区间内的订单状态为“已完成”
<span class="hljs-keyword">UPDATE</span> order_info <span class="hljs-keyword">SET</span> order_status<span class="hljs-operator">=</span><span class="hljs-number">3</span> <span class="hljs-keyword">WHERE</span> create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-01-10'</span>;
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h5 data-id="heading-54">生产注意事项</h5>
<ol>
<li>必须在<strong>RR 隔离级别</strong>下执行，RC 级别会关闭间隙锁，无法解决幻读；</li>
<li>范围查询的字段必须<strong>建立索引</strong>，否则行锁退表锁；</li>
<li>临键锁的锁定范围较大，尽量缩小查询区间，减少锁冲突。</li>
</ol>
<h4 data-id="heading-55">场景 5：高并发批量插入（如分库分表插入、日志批量写入）</h4>
<h5 data-id="heading-56">场景描述</h5>
<p>高并发下对表执行批量插入操作（如分库分表的订单插入、系统日志批量写入），自增主键的插入性能成为瓶颈。</p>
<h5 data-id="heading-57">问题痛点</h5>
<p>InnoDB 默认的自增锁模式（innodb_autoinc_lock_mode=1）在批量插入时会加表级锁，导致插入性能低。</p>
<h5 data-id="heading-58">锁优化策略</h5>
<p>修改自增锁模式为<strong>2（交错模式）</strong> ，全程使用行级锁，提升批量插入的并发性能。</p>
<h5 data-id="heading-59">落地配置 + 实现</h5>
<h6 data-id="heading-60">步骤 1：修改 MySQL 配置（my.cnf/my.ini）</h6>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># 自增锁模式改为2（交错模式），高并发批量插入最优</span>
<span class="hljs-attr">innodb_autoinc_lock_mode</span> = <span class="hljs-number">2</span>
<span class="hljs-comment"># 开启基于行的复制（RBR），配合模式2使用，避免主从数据不一致</span>
<span class="hljs-attr">binlog_format</span> = ROW
</code></pre>
<h6 data-id="heading-61">步骤 2：Java 批量插入实现（MyBatis-Plus）</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;

    <span class="hljs-comment">/**
     * 高并发批量插入订单
     * <span class="hljs-doctag">@param</span> orderList 订单列表
     * <span class="hljs-doctag">@return</span> 插入成功数
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">batchInsert</span><span class="hljs-params">(List&lt;OrderInfo&gt; orderList)</span> {
        <span class="hljs-keyword">return</span> orderMapper.saveBatch(orderList, <span class="hljs-number">100</span>); <span class="hljs-comment">// 每次插入100条，分批提交</span>
    }
}
</code></pre>
<h5 data-id="heading-62">生产注意事项</h5>
<ol>
<li>模式 2 的自增 ID<strong>可能不连续</strong>，但不影响业务（无需严格连续的场景均可使用）；</li>
<li>必须配合<strong>binlog_format=ROW</strong>（基于行的复制）使用，若使用 SBR（基于语句的复制），会导致主从数据不一致；</li>
<li>批量插入建议<strong>分批提交</strong>（如每次 100/500 条），避免单事务插入数据过多，导致事务过大。</li>
</ol>
<h4 data-id="heading-63">场景 6：生产高频问题 ——MDL 锁阻塞（查询时执行 ALTER TABLE）</h4>
<h5 data-id="heading-64">问题描述</h5>
<p>高并发查询场景下，执行<code>ALTER TABLE</code>修改表结构，导致<strong>整个表的所有操作（查询 / 修改）全部阻塞</strong>，数据库连接数暴涨，最终引发生产故障。</p>
<h5 data-id="heading-65">问题根因</h5>
<ul>
<li>高并发查询持有大量<strong>MDL S 锁</strong>；</li>
<li>执行<code>ALTER TABLE</code>需要加<strong>MDL X 锁</strong>，与 MDL S 锁互斥，X 锁等待所有 S 锁释放；</li>
<li>后续所有查询 / 修改操作需要加 MDL S 锁，排队等待 X 锁释放，形成<strong>阻塞链</strong>。</li>
</ul>
<h5 data-id="heading-66">解决方案</h5>
<p>使用<strong>在线 DDL 工具</strong>（如 pt-online-schema-change/gh-ost），避免直接执行<code>ALTER TABLE</code>，工具会通过<strong>分批次复制数据、触发器同步增量</strong>的方式修改表结构，全程不持有 MDL X 锁，不阻塞业务。</p>
<h5 data-id="heading-67">落地实现（pt-online-schema-change）</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装percona-toolkit工具</span>
yum install percona-toolkit -y
<span class="hljs-comment"># 在线修改表结构：为order_info表新增字段remark（VARCHAR(255)）</span>
<span class="hljs-comment"># --alter：要执行的DDL语句</span>
<span class="hljs-comment"># D=数据库名，t=表名</span>
<span class="hljs-comment"># h=数据库IP，u=用户名，p=密码</span>
pt-online-schema-change --alter <span class="hljs-string">"ADD COLUMN remark VARCHAR(255) DEFAULT '' COMMENT '备注'"</span> D=shop,t=order_info h=127.0.0.1,u=root,p=123456 --execute
</code></pre>
<h5 data-id="heading-68">生产注意事项</h5>
<ol>
<li>禁止在<strong>高并发时段</strong>直接执行<code>ALTER TABLE</code>，即使使用在线 DDL 工具，也需在低峰期执行；</li>
<li>在线 DDL 工具会产生<strong>临时表和触发器</strong>，执行前需保证数据库有足够的磁盘空间和权限；</li>
<li>执行前先通过<code>pt-online-schema-change --dry-run</code>模拟执行，检查是否有错误。</li>
</ol>
<h4 data-id="heading-69">场景 7：分布式系统并发控制（微服务 / 分库分表下的扣库存）</h4>
<h5 data-id="heading-70">场景描述</h5>
<p>系统为<strong>分布式部署</strong>（多服务实例 / 多数据库实例），高并发下执行扣库存 / 下单操作，单库的行级锁 / 乐观锁无法解决<strong>跨实例的并发冲突</strong>，导致超卖。</p>
<h5 data-id="heading-71">锁选择策略</h5>
<p><strong>Redis 分布式锁 + InnoDB 行级锁</strong>，双重锁机制：</p>
<ol>
<li><strong>Redis 分布式锁</strong>：解决跨实例的并发冲突，保证同一商品只有一个实例能执行扣库存；</li>
<li><strong>InnoDB 行级锁</strong>：解决单库内的并发冲突，保证单实例内的数据一致性。</li>
</ol>
<h5 data-id="heading-72">落地实现（Java+Redis+MySQL）</h5>
<h6 data-id="heading-73">步骤 1：Redis 分布式锁工具类（基于 Redisson，推荐生产使用）</h6>
<p>Redisson 是 Redis 官方推荐的分布式锁实现，解决了<strong>死锁、锁超时、重入</strong>等问题，比手动实现的 Redis 锁更稳定。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedissonConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RedissonClient <span class="hljs-title function_">redissonClient</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();
        config.useSingleServer().setAddress(<span class="hljs-string">"redis://127.0.0.1:6379"</span>).setPassword(<span class="hljs-string">"123456"</span>);
        <span class="hljs-keyword">return</span> Redisson.create(config);
    }
}
</code></pre>
<h6 data-id="heading-74">步骤 2：分布式扣库存核心实现</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DistributeStockService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedissonClient redissonClient;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StockService stockService; <span class="hljs-comment">// 场景2的悲观锁扣库存服务</span>

    <span class="hljs-comment">/**
     * 分布式扣库存（Redis分布式锁+MySQL行级锁）
     * <span class="hljs-doctag">@param</span> goodsId 商品ID
     * <span class="hljs-doctag">@return</span> true=成功
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductDistributeStock</span><span class="hljs-params">(Long goodsId)</span> {
        <span class="hljs-comment">// 1. 定义Redis分布式锁的key（按商品ID区分，细粒度锁）</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"stock:lock:"</span> + goodsId;
        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(lockKey);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. 获取分布式锁，等待3秒，持有10秒（避免死锁）</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">lockSuccess</span> <span class="hljs-operator">=</span> lock.tryLock(<span class="hljs-number">3</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);
            <span class="hljs-keyword">if</span> (!lockSuccess) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 获取锁失败，直接返回</span>
            }
            <span class="hljs-comment">// 3. 获取锁成功，执行MySQL行级锁扣库存</span>
            <span class="hljs-keyword">return</span> stockService.deductStock(goodsId);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 4. 释放分布式锁（必须在finally中释放，避免锁泄漏）</span>
            <span class="hljs-keyword">if</span> (lock.isHeldByCurrentThread()) {
                lock.unlock();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-75">生产注意事项</h5>
<ol>
<li>分布式锁的<strong>锁粒度要细</strong>（如按商品 ID / 用户 ID），避免使用全局锁（如 stock:lock），导致并发性能低；</li>
<li>必须设置<strong>锁超时时间</strong>，避免服务宕机导致锁无法释放（死锁）；</li>
<li>推荐使用<strong>Redisson</strong>实现分布式锁，避免手动实现的锁存在漏洞（如 SETNX 未加过期时间）。</li>
</ol>
<h4 data-id="heading-76">场景 8：生产高频问题 —— 死锁的定位、解决与预防</h4>
<h5 data-id="heading-77">死锁定义</h5>
<p>两个或多个事务<strong>互相持有对方需要的锁</strong>，且均不释放自己的锁，导致彼此永久阻塞，是 MySQL 锁机制的常见问题。</p>
<h5 data-id="heading-78">死锁示例</h5>
<p>事务 A 持有 goods_id=1001 的行锁，请求 goods_id=1002 的行锁；事务 B 持有 goods_id=1002 的行锁，请求 goods_id=1001 的行锁，形成互相等待。</p>
<h5 data-id="heading-79">步骤 1：死锁的定位（MySQL 内置命令）</h5>
<p>InnoDB 会<strong>自动检测死锁</strong>，并回滚其中一个事务（代价最小的），但需手动定位死锁原因，避免再次发生。</p>
<pre><code class="hljs language-sql" lang="sql"># <span class="hljs-number">1.</span> 开启死锁日志（my.cnf配置，永久生效）
innodb_print_all_deadlocks <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
# <span class="hljs-number">2.</span> 查看最新的死锁详情（核心命令）
<span class="hljs-keyword">SHOW</span> ENGINE INNODB STATUS;
# <span class="hljs-number">3.</span> 查看当前活跃事务、锁等待情况
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.INNODB_TRX; # 活跃事务
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.INNODB_LOCK_WAITS; # 锁等待
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.INNODB_LOCKS; # 持有锁
</code></pre>
<p><strong>核心查看点</strong>：<code>SHOW ENGINE INNODB STATUS</code>的<code>LATEST DEADLOCK</code>部分，包含死锁的事务、持有的锁、请求的锁，是定位根因的关键。</p>
<h5 data-id="heading-80">步骤 2：死锁的解决</h5>
<ol>
<li><strong>立即解决</strong>：InnoDB 会自动回滚代价最小的事务，无需手动干预；若未自动回滚，可通过<code>KILL [事务ID]</code>杀死阻塞的事务；</li>
<li><strong>根本解决</strong>：根据死锁定位结果，优化事务的加锁逻辑，避免互相等待。</li>
</ol>
<h5 data-id="heading-81">步骤 3：死锁的预防（生产最佳实践）</h5>
<p>死锁的核心诱因是<strong>事务加锁顺序不一致、锁持有时间过长、锁定范围过大</strong>，针对性预防即可：</p>
<ol>
<li><strong>统一加锁顺序</strong>：多个事务对多张表 / 多行数据加锁时，必须遵循<strong>相同的加锁顺序</strong>（如先锁 goods_id=1001，再锁 goods_id=1002）；</li>
<li><strong>缩短锁持有时间</strong>：事务中仅包含核心操作，<strong>不执行耗时操作</strong>（如 RPC 调用、文件读写、睡眠），快速提交 / 回滚事务；</li>
<li><strong>缩小锁定范围</strong>：尽量使用<strong>主键 / 唯一索引</strong>的等值查询，触发记录锁，避免临键锁 / 表锁的大范围锁定；</li>
<li><strong>设置锁等待超时</strong>：通过参数<code>innodb_lock_wait_timeout</code>设置行锁等待超时时间（默认 50 秒，建议改为 10 秒），避免永久阻塞；</li>
<li><strong>避免大事务</strong>：将大事务拆分为多个小事务，减少锁的持有时间和锁定范围。</li>
</ol>
<h3 data-id="heading-82">六、MySQL 锁机制优化最佳实践</h3>
<p>MySQL 锁机制的优化核心是<strong>减少锁冲突、缩短锁持有时间、提升并发性能</strong>，结合索引、事务、配置、架构四个维度，给出生产可落地的最佳实践，覆盖 90% 以上的锁优化场景：</p>
<h4 data-id="heading-83">6.1 索引优化：行级锁的基础</h4>
<ol>
<li>所有<strong>写操作（UPDATE/DELETE/FOR UPDATE）<strong>的 WHERE 条件必须</strong>使用主键 / 唯一索引 / 普通索引</strong>，避免行锁退表锁；</li>
<li>避免<strong>隐式类型转换、使用函数操作索引</strong>，导致索引失效；</li>
<li>合理设计索引，遵循<strong>最左匹配、覆盖索引、避免冗余索引</strong>原则，提升查询效率，减少锁的持有时间。</li>
</ol>
<h4 data-id="heading-84">6.2 事务优化：缩短锁持有时间</h4>
<ol>
<li>使用<strong>显式事务</strong>，替代自动提交（autocommit=1），精准控制事务的开始和结束；</li>
<li><strong>事务中仅包含核心业务操作</strong>，不执行耗时操作（RPC 调用、文件读写、睡眠）；</li>
<li>拆分<strong>大事务</strong>为多个小事务，减少锁的持有时间和锁定范围；</li>
<li>根据业务需求选择<strong>合适的隔离级别</strong>：读多写少、无需解决幻读的场景，可将隔离级别改为<strong>RC</strong>，关闭间隙锁，提升并发性能。</li>
</ol>
<h4 data-id="heading-85">6.3 配置优化：适配高并发</h4>
<ol>
<li>高并发批量插入场景，将<code>innodb_autoinc_lock_mode</code>改为 2，<code>binlog_format</code>改为 ROW；</li>
<li>设置合理的<strong>锁等待超时</strong>：<code>innodb_lock_wait_timeout=10</code>（秒），避免永久阻塞；</li>
<li>开启死锁日志：<code>innodb_print_all_deadlocks=1</code>，方便定位死锁问题；</li>
<li>调大 InnoDB 缓冲池：<code>innodb_buffer_pool_size</code>设置为物理内存的 50%-70%，提升查询效率，减少锁冲突。</li>
</ol>
<h4 data-id="heading-86">6.4 架构优化：从单库到分布式</h4>
<ol>
<li><strong>读多写少</strong>的场景，使用<strong>主从复制 + 读写分离</strong>，主库负责写操作（加锁），从库负责读操作，分散数据库压力；</li>
<li><strong>单表数据量过大</strong>（千万 / 亿级），使用<strong>分库分表</strong>，将大表拆分为多个小表，分散锁的冲突；</li>
<li><strong>分布式系统</strong>，使用<strong>Redis 分布式锁 + MySQL 行级锁</strong>，解决跨实例的并发冲突；</li>
<li>避免<strong>跨库联表查询</strong>，尽量在业务层做关联，减少分布式场景下的锁复杂度。</li>
</ol>
<h3 data-id="heading-87">七、总结</h3>
<p>MySQL 锁机制是数据库并发控制的核心，<strong>InnoDB 的行级锁</strong>是互联网后端开发的重点，其设计的核心是<strong>基于索引、细粒度管控、高并发适配</strong>。掌握 MySQL 锁机制的关键，不仅要理解各类锁的定义、特性、兼容性（面试八股文），更要结合<strong>业务场景</strong>选择合适的锁策略 ——<strong>悲观锁适用于高冲突场景，乐观锁适用于低冲突场景，分布式锁适用于跨实例场景</strong>。</p>
<p>生产中绝大多数的锁问题（锁阻塞、死锁、行锁退表锁），根源并非锁机制本身，而是<strong>索引设计不合理、事务编写不规范、锁选择策略不当</strong>。因此，锁机制的优化并非孤立的，而是与<strong>索引优化、事务优化、架构优化</strong>深度结合的系统性工程。</p>
<p>对于 Java 后端开发而言，掌握 MySQL 锁机制是应对大厂面试、解决生产并发问题的必备技能，核心原则可总结为：<strong>索引为基、事务为纲、锁随场景、优化随行</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HashMap 线程不安全怎么办？从 Hashtable 到 ConcurrentHashMap 的完美解答]]></title>    <link>https://juejin.cn/post/7598734303174098996</link>    <guid>https://juejin.cn/post/7598734303174098996</guid>    <pubDate>2026-01-25T13:25:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303174098996" data-draft-id="7597266967139139618" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HashMap 线程不安全怎么办？从 Hashtable 到 ConcurrentHashMap 的完美解答"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-25T13:25:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户49793230963"/> <meta itemprop="url" content="https://juejin.cn/user/4461159469290944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HashMap 线程不安全怎么办？从 Hashtable 到 ConcurrentHashMap 的完美解答
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4461159469290944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户49793230963
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:25:59.000Z" title="Sun Jan 25 2026 13:25:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>“在 Java 集合框架体系中，容器主要根据并发特性划分为<strong>线程安全</strong>与<strong>非线程安全</strong>两大阵营。纵观 JDK 的迭代历程，容器的演进本质上是设计者在**并发安全（Safety）<strong>与</strong>执行性能（Performance）**之间不断权衡与博弈的过程。这一演进脉络，不仅记录了技术的更迭，更为我们深入理解并发编程的设计哲学提供了宝贵的范本。”</p>
<p>那么什么是“线程安全”？
我们来看一下线程安全的定义：
<strong>Brian Goetz 给出的定义是：</strong></p>
<blockquote>
<p>“当多个线程访问一个类时，如果不用考虑这些线程在运行时环境下的调度和交替执行，并且不需要额外的同步，这个类都能表现出<strong>正确的行为</strong>，那么这个类就是线程安全的。”</p>
</blockquote>
<p>为了更好理解，可以将这个定义拆解为三个关键词：</p>
<ul>
<li>
<p><strong>多线程访问</strong>：这是前提条件。如果是单线程，谈论线程安全没有意义。</p>
</li>
<li>
<p><strong>无须额外同步</strong>：使用者（调用方）不需要自己加锁（如 <code>synchronized</code> 或 <code>Lock</code>），这个类内部已经处理好了。</p>
</li>
<li>
<p><strong>正确的行为</strong>：无论线程怎么抢占 CPU，结果永远符合预期。比如计数器不会少算，转账金额不会凭空消失。</p>
</li>
</ul>
<p>其实其实所谓的安全 无非就是解决了这三个问题</p>
<ul>
<li>
<p><strong>原子性 (Atomicity)</strong> ：操作要么全部执行，要么全不执行，不能被中断。（例如：<code>i++</code> 不是原子的）。</p>
</li>
<li>
<p><strong>可见性 (Visibility)</strong> ：一个线程修改了数据，其他线程能立刻看到。（例如：<code>volatile</code> 关键字）。</p>
</li>
<li>
<p><strong>有序性 (Ordering)</strong> ：程序代码按照预期的顺序执行，禁止指令重排。
这三个问题也是并发编程的三大核心 从内在的JMM 到表现在程序里面的volatile synchronized RLock 再到无锁操作CAS本质上都是为了在保证一定性能的同时去解决 原子性 可见性 有序性。</p>
</li>
</ul>
<p>从最早的“全表锁”到现在的“无锁化（CAS）”和“分段思想”，JDK 的每一次迭代都在试图解决一个核心矛盾：<strong>如何在保证数据不乱的前提下，让多线程跑得更快？</strong></p>
<p>我将 Java 容器的发展分为<strong>三个时代</strong>，为你梳理这条演进之路：</p>
<h4 data-id="heading-0">第一时代：上古时代的“绝对安全” (JDK 1.0)</h4>
<p>此时的JDK处于刚刚发展阶段 为了保证安全宁愿这个实现的方式简单粗暴</p>
<p>观看HashTable的源码 发现它涉及到修改操作的方法都是被synchronized 关键字包围的 比如说</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f4270ae57ff41e8849d65c1ee81a864~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDk3OTMyMzA5NjM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769952359&amp;x-signature=uuyMbDqaSkdePTjxBftEPCg0GBQ%3D" alt="image.png" loading="lazy"/></p>
<p>这种操作无疑可以保证多线程下的 可见性 原子性 有序性 因为加锁本质上就是只允许同一时间 只能有一个线程去进行操作 但是这种设计真的够优雅吗 答案是否定的 本质上加锁的操作极大的影响了性能 我们可能很多时候只有一个线程去执行 所以我们需要一种更快速的容器</p>
<h4 data-id="heading-1">第二时代：性能觉醒的“裸奔时代” (JDK 1.2)</h4>
<p>在经历了 JDK 1.0 中 <code>Vector</code> 和 <code>Hashtable</code> 的“笨重”之后，JDK 1.2 迎来了一次彻底的<strong>思想解放</strong>。设计者意识到：在绝大多数实际应用场景中，容器仅仅是在<strong>单线程</strong>环境下作为局部变量使用的。</p>
<p>为了那 1% 的并发场景，让 99% 的单线程场景都背负沉重的锁竞争开销，这是极不划算的。于是， <strong>“性能至上”</strong> 成为了这一时期的绝对信条。</p>
<p>标题所说的HashMap正是这个阶段诞生的 观看源码可以看出 此时的容器发展完全牺牲了并发安全这个要素 它的所有操作都没有锁 这也导致了性能的极致 但也为并发安全性埋下了隐患</p>
<ul>
<li><strong>JDK 1.7</strong>：多线程扩容会导致链表成环，CPU 飙升 100%。</li>
<li><strong>JDK 1.8</strong>：多线程 Put 会导致数据直接覆盖（丢失）。</li>
<li><strong>但这不重要</strong>：在设计者的眼里，这些问题是使用者应该去规避的，容器本身的职责就是<strong>快</strong>。</li>
</ul>
<p>可是我们真的没有办法在并发安全和性能做一个平衡 真的做不到既要又要吗 答案是否定的</p>
<h4 data-id="heading-2">第三时代：并发大师的“黄金时代” (JDK 1.5 - J.U.C)</h4>
<p>在这个充满设计者智慧的版本中 我们可以看到许多设计精妙的容器 就比如我们今天的主角ConcurrentHashMap</p>
<p>我们将 CHM 的演进分为两个时代：<strong>JDK 1.7 的“分段锁时代”</strong> 和 <strong>JDK 1.8 的“CAS + 红黑树时代”</strong> 。</p>
<p><strong>第一部分：JDK 1.7 —— 分段锁 (Segment Locking)</strong>
在 JDK 1.7 中，设计者 Doug Lea 的核心思想是： <strong>“大化小”</strong> 。既然锁整个大数组太慢，那我就把它切成几块（Segments），每一块自己管自己的锁。</p>
<h4 data-id="heading-3">1. 核心结构</h4>
<ul>
<li><strong>Segment 数组 + HashEntry 数组</strong>。</li>
<li>一个 <code>ConcurrentHashMap</code> 内部维护了一个 <code>Segment</code> 数组。</li>
<li><strong>关键点</strong>：<code>Segment</code> 这个类直接继承了 <code>ReentrantLock</code>。这意味着每个 Segment 本身就是一把锁。</li>
<li>默认 <code>concurrencyLevel = 16</code>，也就是说整个 Map 被分成了 16 个小隔间。理论上支持 16 个线程同时并发写入（只要它们 hash 到不同的 Segment）。</li>
</ul>
<h4 data-id="heading-4">2. Put 操作流程</h4>
<ol>
<li>
<p><strong>Hash 计算</strong>：先通过 Hash 算法定位到具体的 <code>Segment</code>。</p>
</li>
<li>
<p><strong>获取锁</strong>：当前线程尝试获取这个 Segment 的锁 (<code>tryLock</code>)。</p>
<ul>
<li>如果获取失败，会使用<strong>自旋机制</strong>（SCANNING），重试一定次数后如果还拿不到，才进入阻塞状态（挂起）。</li>
</ul>
</li>
<li>
<p><strong>写入</strong>：拿到锁后，就像操作一个普通的 HashMap 一样，操作内部的 <code>HashEntry</code> 数组（链表插入）。</p>
</li>
<li>
<p><strong>释放锁</strong>。</p>
</li>
</ol>
<h4 data-id="heading-5">3. Get 操作 (高效的秘诀)</h4>
<ul>
<li>
<p><strong>不加锁</strong></p>
</li>
<li>
<p><strong>原理</strong>：<code>HashEntry</code> 中的 <code>value</code> 属性是被 <code>volatile</code> 修饰的。</p>
<p>Java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HashEntry</span>&lt;K,V&gt; {
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> hash;
    <span class="hljs-keyword">final</span> K key;
    <span class="hljs-keyword">volatile</span> V value; <span class="hljs-comment">// 重点：保证可见性</span>
    <span class="hljs-keyword">volatile</span> HashEntry&lt;K,V&gt; next;
}
</code></pre>
</li>
<li>
<p>由于 volatile 的可见性，写线程修改完，读线程能立刻看到，所以读操作完全无锁，性能极高。</p>
</li>
</ul>
<h4 data-id="heading-6">4. Size 操作 (跨段统计的难题)</h4>
<p>怎么统计总数？数据分散在 16 个桶里，且随时有人在写。</p>
<ul>
<li><strong>机制</strong>：先尝试 <strong>“不加锁”</strong> 统计几次（最多 3 次）。</li>
<li>如果在统计过程中，发现 <code>modCount</code> (修改次数) 没变，说明没人捣乱，直接返回。</li>
<li>如果发现 <code>modCount</code> 变了，说明有人在写，只好<strong>强制锁住所有 Segment</strong> (全局锁)，统计完再解锁。这是一次昂贵的操作。</li>
</ul>
<p>但是这种方法在随着硬件性能提升和 JVM 对 <code>synchronized</code> 的大幅优化，JDK 1.7 的 <code>Segment</code> 显得臃肿了（为了维护 Segment，内存浪费严重）所以就有了 JDK 1.8的优化 也就是现在的 CHM</p>
<h4 data-id="heading-7">第二部分：JDK 1.8 —— CAS + Synchronized + 红黑树</h4>
<p>1.8 的核心思想是： <strong>原子化</strong> 和 <strong>数据结构降维打击</strong> 。它抛弃了 Segment，直接回到了类似 HashMap 的大数组结构，但在细节上做到了极致。</p>
<p>这一设计转变基于一个关键的工程洞察：在大多数实际应用场景中，<strong>Hash 冲突的发生概率极低</strong>。基于此，JDK 1.8 采取了更为激进且高效的加锁策略——<strong>直接锁定 Hash 桶的头节点 (Head Node)</strong> 。这一优化将锁的粒度从原本的段级别（1/16）急剧细化至桶级别（1/N），在保证安全的前提下，最大限度地释放了并发性能。”）</p>
<h4 data-id="heading-8">2. Put 操作流程</h4>
<p>这是面试的重灾区，也是我个人认为CCH设计最为精妙的一点：</p>
<ol>
<li>
<p><strong>判断初始化</strong>：如果 table 为空，调用 <code>initTable()</code> 初始化（利用 CAS 保证只有一个线程初始化成功）。</p>
</li>
<li>
<p><strong>计算 Hash</strong>：定位到数组下标 <code>i</code>。</p>
</li>
<li>
<p><strong>Case 1：桶是空的 (No Collision)</strong></p>
<ul>
<li><strong>CAS 无锁插入</strong>：直接利用 <code>CAS</code> 指令尝试把新节点放入该位置。</li>
<li>如果成功，完事。如果失败（说明瞬间有人抢了），进入下一轮循环。</li>
</ul>
</li>
<li>
<p><strong>Case 2：发现正在扩容 (MOVED)</strong></p>
<ul>
<li>如果发现该位置的节点的 hash 值是 <code>MOVED (-1)</code>，说明当前 Map 正在扩容。</li>
<li><strong>帮忙扩容 (Help Transfer)</strong> ：当前线程不干活了，加入扩容大军，帮忙把数据搬到新数组去（众筹扩容，非常有意思的设计）。</li>
</ul>
</li>
<li>
<p><strong>Case 3：发生哈希冲突 (Collision)</strong></p>
<ul>
<li><strong>Synchronized 锁头节点</strong>：只锁住当前这个桶的第一个节点。</li>
<li>进入锁块后，遍历链表或红黑树进行插入。</li>
</ul>
</li>
<li>
<p><strong>转树</strong>：如果链表长度 &gt; 8 且数组长度 &gt;= 64，将链表转为红黑树。</p>
</li>
</ol>
<h4 data-id="heading-9">3. 为什么 1.8 抛弃 ReentrantLock 改用 Synchronized？</h4>
<ol>
<li><strong>节省内存</strong>：<code>ReentrantLock</code> 需要继承 AQS，每个节点都继承这玩意儿，内存消耗太大。而 <code>synchronized</code> 是 JVM 原生的，锁信息存在对象头（Mark Word）里，几乎零额外开销。</li>
<li><strong>JVM 优化</strong>：JDK 6 以后，JVM 团队对 <code>synchronized</code> 做了惊人的优化（偏向锁、轻量级锁、锁消除、锁粗化）。在低竞争下，它的性能已经优于 ReentrantLock。</li>
</ol>
<h4 data-id="heading-10">4. Size 操作 (LongAdder 思想)</h4>
<p>1.8 甚至优化了计数器。它不再纠结于统计所有桶，而是引入了类似 <code>LongAdder</code> 的机制：</p>
<ul>
<li><strong>baseCount</strong>：基础计数器。</li>
<li><strong>CounterCell 数组</strong>：如果并发太高，CAS 修改 <code>baseCount</code> 失败，就随机找一个 <code>CounterCell</code> 去加。</li>
<li><strong>最终结果</strong> = <code>baseCount</code> + <code>sum(CounterCell[])</code>。</li>
<li>这使得 <code>size()</code> 在高并发下性能飞升。</li>
<li/>
</ul>
<p>JDK 1.7 的 ConcurrentHashMap 像是<strong>包工头制度</strong>（Segment），每个包工头管一片地，虽然比全厂只有一个管理员（Hashtable）强，但管理成本还是高。 而 JDK 1.8 则是<strong>自动化 + 扁平化管理</strong>。平时大家用 CAS（无锁）快速通过，真遇到冲突了，只锁当前那一个工位（Synchronized），而且引入了红黑树解决长队问题，引入了 LongAdder 解决统计问题，是目前的性能天花板。</p>
<p>正因其卓越的并发性能，它成为了众多主流框架底层架构的<strong>基石</strong>。 例如，我们大家都再在用的Spring 框架的核心组件——<strong>Bean 容器</strong>，其底层正是利用 ConcurrentHashMap 来管理单例对象（Singleton Objects），从而在极高的并发访问下保障了容器的线程安全。</p>
<h4 data-id="heading-11">结尾</h4>
<p>总而言之，Java 容器的演进历程，本质上就是一部锁粒度不断细化的变革史。</p>
<p>这一过程始终贯穿着一条主线：<strong>在‘并发安全’的底线之上，向‘单线程效率’发起无限逼近的挑战。</strong> 这不仅是技术指标的提升，更凝聚了开发者在取舍之间的工程智慧。</p>
<p>深入理解这段历史，不仅能让我们掌握底层原理，更能潜移默化地提升我们的<strong>并发设计意识</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[十大排序]]></title>    <link>https://juejin.cn/post/7598947628467912750</link>    <guid>https://juejin.cn/post/7598947628467912750</guid>    <pubDate>2026-01-25T13:42:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598947628467912750" data-draft-id="7598921649888542747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="十大排序"/> <meta itemprop="keywords" content="前端,面试"/> <meta itemprop="datePublished" content="2026-01-25T13:42:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lulaaaa"/> <meta itemprop="url" content="https://juejin.cn/user/3804728203425918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            十大排序
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3804728203425918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lulaaaa
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:42:33.000Z" title="Sun Jan 25 2026 13:42:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">十大排序算法</h2>
<h3 data-id="heading-1">前言</h3>
<p>排序算法是编程的基础核心知识点，根据是否依赖「元素比较」可分为两类：</p>
<ul>
<li><strong>比较类排序</strong>：通过比较元素大小确定顺序，时间复杂度最低为 O(nlogn)，包含冒泡、选择、插入、希尔、归并、快速、堆排序；</li>
<li><strong>非比较类排序</strong>：利用数值特征（如位数、范围）排序，时间复杂度可达 O(n)，包含计数、桶、基数排序。</li>
</ul>
<p><strong>核心概念铺垫</strong>：</p>
<ul>
<li><strong>排序稳定性</strong>：若排序后，两个相等值的元素相对位置与排序前一致，则为「稳定排序」；否则为「不稳定排序」（如 <code>[2,2,1]</code> 排序后，第一个 2 仍在第二个 2 前则稳定）。</li>
<li><strong>时间复杂度</strong>：算法执行时间随数据规模增长的趋势；</li>
<li><strong>空间复杂度</strong>：算法占用额外空间随数据规模增长的趋势。</li>
</ul>
<hr/>
<h3 data-id="heading-2">1. 冒泡排序（Bubble Sort）</h3>
<h4 data-id="heading-3">核心思想</h4>
<p>像水中的气泡上浮：每次遍历数组，相邻元素两两比较，把<strong>最大的元素逐步 “浮” 到数组末尾</strong>，小元素留在前面。可优化：某轮遍历无交换时，说明数组已有序，提前终止。</p>
<h4 data-id="heading-4">算法步骤</h4>
<ol>
<li>遍历数组，相邻元素两两比较，若前 &gt; 后则交换；</li>
<li>每轮遍历结束，当前未排序部分的最大值 “归位” 到末尾；</li>
<li>重复上述步骤，直到数组有序（或提前终止）。</li>
</ol>
<h4 data-id="heading-5">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>






























<table><thead><tr><th>遍历轮次</th><th>数组变化</th><th>归位元素</th></tr></thead><tbody><tr><td>轮 1</td><td>[3,5,8,4,2] → [3,5,4,8,2] → [3,5,4,2,8]</td><td>8</td></tr><tr><td>轮 2</td><td>[3,4,5,2,8] → [3,4,2,5,8]</td><td>5</td></tr><tr><td>轮 3</td><td>[3,2,4,5,8]</td><td>4</td></tr><tr><td>轮 4</td><td>[2,3,4,5,8]</td><td>3</td></tr></tbody></table>
<h4 data-id="heading-6">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BubbleSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bubbleSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-type">boolean</span> swapped; <span class="hljs-comment">// 标记是否发生交换</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n - <span class="hljs-number">1</span>; i++) {
            swapped = <span class="hljs-literal">false</span>;
            <span class="hljs-comment">// 每轮减少i次遍历（末尾i个元素已归位）</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; n - <span class="hljs-number">1</span> - i; j++) {
                <span class="hljs-keyword">if</span> (arr[j] &gt; arr[j + <span class="hljs-number">1</span>]) {
                    <span class="hljs-comment">// 交换相邻元素</span>
                    <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[j];
                    arr[j] = arr[j + <span class="hljs-number">1</span>];
                    arr[j + <span class="hljs-number">1</span>] = temp;
                    swapped = <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-comment">// 无交换则提前终止</span>
            <span class="hljs-keyword">if</span> (!swapped) <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        bubbleSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-7">算法分析</h4>
<ul>
<li>时间复杂度：最好 O(n)（已有序）、最坏 / 平均 O(n2)；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：稳定（相等元素不交换）。</li>
</ul>
<hr/>
<h3 data-id="heading-8">2. 选择排序（Selection Sort）</h3>
<h4 data-id="heading-9">核心思想</h4>
<p>像选 “标兵”：每次从<strong>未排序部分选出最小值</strong>，放到已排序部分的末尾，逐步扩大有序区域。</p>
<h4 data-id="heading-10">算法步骤</h4>
<ol>
<li>划分「已排序区」（初始为空）和「未排序区」（整个数组）；</li>
<li>遍历未排序区，找到最小值的索引；</li>
<li>交换最小值与未排序区的第一个元素，扩大已排序区；</li>
<li>重复直到未排序区为空。</li>
</ol>
<h4 data-id="heading-11">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>



































<table><thead><tr><th>遍历轮次</th><th>未排序区</th><th>最小值（索引）</th><th>数组变化</th></tr></thead><tbody><tr><td>轮 1</td><td>[5,3,8,4,2]</td><td>2（4）</td><td>[2,3,8,4,5]</td></tr><tr><td>轮 2</td><td>[3,8,4,5]</td><td>3（1）</td><td>[2,3,8,4,5]</td></tr><tr><td>轮 3</td><td>[8,4,5]</td><td>4（3）</td><td>[2,3,4,8,5]</td></tr><tr><td>轮 4</td><td>[8,5]</td><td>5（4）</td><td>[2,3,4,5,8]</td></tr></tbody></table>
<h4 data-id="heading-12">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SelectionSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">selectionSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n - <span class="hljs-number">1</span>; i++) {
            <span class="hljs-comment">// 找未排序区（i到n-1）的最小值索引</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">minIndex</span> <span class="hljs-operator">=</span> i;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i + <span class="hljs-number">1</span>; j &lt; n; j++) {
                <span class="hljs-keyword">if</span> (arr[j] &lt; arr[minIndex]) {
                    minIndex = j;
                }
            }
            <span class="hljs-comment">// 交换最小值和未排序区第一个元素</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[i];
            arr[i] = arr[minIndex];
            arr[minIndex] = temp;
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        selectionSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-13">算法分析</h4>
<ul>
<li>时间复杂度：所有情况 O(n2)（无论是否有序，都要遍历找最小值）；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：不稳定（如 <code>[2,2,1]</code>，选 1 交换第一个 2，两个 2 的相对位置改变）。</li>
</ul>
<hr/>
<h3 data-id="heading-14">3. 插入排序（Insertion Sort）</h3>
<h4 data-id="heading-15">核心思想</h4>
<p>像打扑克牌插牌：把当前元素插入到<strong>前面已排序数组的合适位置</strong>，前面始终保持有序。</p>
<h4 data-id="heading-16">算法步骤</h4>
<ol>
<li>划分「已排序区」（初始为第一个元素）和「未排序区」（剩余元素）；</li>
<li>取未排序区的第一个元素，向前遍历已排序区，找到比它小的元素位置；</li>
<li>将该位置后的元素后移，插入当前元素；</li>
<li>重复直到未排序区为空。</li>
</ol>
<h4 data-id="heading-17">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>



































<table><thead><tr><th>遍历轮次</th><th>已排序区</th><th>待插入元素</th><th>数组变化</th></tr></thead><tbody><tr><td>轮 1</td><td>[5]</td><td>3</td><td>[3,5,8,4,2]</td></tr><tr><td>轮 2</td><td>[3,5]</td><td>8</td><td>[3,5,8,4,2]</td></tr><tr><td>轮 3</td><td>[3,5,8]</td><td>4</td><td>[3,5,4,8,2] → [3,4,5,8,2]</td></tr><tr><td>轮 4</td><td>[3,4,5,8]</td><td>2</td><td>[2,3,4,5,8]</td></tr></tbody></table>
<h4 data-id="heading-18">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InsertionSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertionSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; n; i++) {
            <span class="hljs-type">int</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> arr[i]; <span class="hljs-comment">// 待插入元素</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i - <span class="hljs-number">1</span>;
            <span class="hljs-comment">// 向前遍历已排序区，找到插入位置</span>
            <span class="hljs-keyword">while</span> (j &gt;= <span class="hljs-number">0</span> &amp;&amp; arr[j] &gt; current) {
                arr[j + <span class="hljs-number">1</span>] = arr[j]; <span class="hljs-comment">// 元素后移</span>
                j--;
            }
            arr[j + <span class="hljs-number">1</span>] = current; <span class="hljs-comment">// 插入元素</span>
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        insertionSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-19">算法分析</h4>
<ul>
<li>时间复杂度：最好 O(n)（已有序）、最坏 / 平均 O(n2)；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：稳定（相等元素不后移）。</li>
</ul>
<hr/>
<h3 data-id="heading-20">4. 希尔排序（Shell Sort）</h3>
<h4 data-id="heading-21">核心思想</h4>
<p>插入排序的 “升级版”：先按「步长」将数组分组，每组内做插入排序（粗排）；逐步缩小步长到 1，最终做一次整体插入排序（精排）。像先把数组 “梳顺”，再精细排序，减少插入排序的元素移动次数。</p>
<h4 data-id="heading-22">算法步骤</h4>
<ol>
<li>选择初始步长（通常为 n/2，每次减半）；</li>
<li>按步长将数组分成若干子数组（索引 i,i+step,i+2step...）；</li>
<li>对每个子数组执行插入排序；</li>
<li>步长减半，重复步骤 2-3；直到步长 = 1，做最后一次插入排序。</li>
</ol>
<h4 data-id="heading-23">案例演示（数组 <code>[5,3,8,4,2]</code>，n=5）</h4>




















<table><thead><tr><th>步长</th><th>分组情况</th><th>分组排序后数组</th></tr></thead><tbody><tr><td>2</td><td>[5,8,2]、[3,4]</td><td>[2,3,8,4,5]</td></tr><tr><td>1</td><td>整体数组</td><td>[2,3,4,5,8]</td></tr></tbody></table>
<h4 data-id="heading-24">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShellSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shellSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-comment">// 步长逐步减半</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">step</span> <span class="hljs-operator">=</span> n / <span class="hljs-number">2</span>; step &gt; <span class="hljs-number">0</span>; step /= <span class="hljs-number">2</span>) {
            <span class="hljs-comment">// 按步长分组，每组插入排序</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> step; i &lt; n; i++) {
                <span class="hljs-type">int</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> arr[i];
                <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i - step;
                <span class="hljs-keyword">while</span> (j &gt;= <span class="hljs-number">0</span> &amp;&amp; arr[j] &gt; current) {
                    arr[j + step] = arr[j];
                    j -= step;
                }
                arr[j + step] = current;
            }
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        shellSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-25">算法分析</h4>
<ul>
<li>时间复杂度：最好 O(nlogn)、最坏 O(n2)、平均 O(n1.3)（步长影响）；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：不稳定（分组排序会打乱相等元素的相对位置）。</li>
</ul>
<hr/>
<h3 data-id="heading-26">5. 归并排序（Merge Sort）</h3>
<h4 data-id="heading-27">核心思想</h4>
<p>分治思想的典型应用：“分而治之”，先把数组拆成最小单元（单个元素，天然有序），再<strong>两两合并成有序子数组</strong>，最终合并成整体有序数组。像拼拼图，先拆成碎片，再按规则拼合。</p>
<h4 data-id="heading-28">算法步骤</h4>
<ol>
<li><strong>分</strong>：递归将数组分成左右两半，直到每个子数组只有 1 个元素；</li>
<li><strong>治</strong>：合并两个有序子数组为一个有序数组；</li>
<li>递归合并，直到整个数组合并完成。</li>
</ol>
<h4 data-id="heading-29">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>
<p>plaintext</p>
<pre><code class="hljs language-css" lang="css">分：<span class="hljs-selector-attr">[5,3,8,4,2]</span> → <span class="hljs-selector-attr">[5,3]</span> + <span class="hljs-selector-attr">[8,4,2]</span> → <span class="hljs-selector-attr">[5]</span>+<span class="hljs-selector-attr">[3]</span> + <span class="hljs-selector-attr">[8]</span>+<span class="hljs-selector-attr">[4,2]</span> → <span class="hljs-selector-attr">[5]</span>+<span class="hljs-selector-attr">[3]</span> + <span class="hljs-selector-attr">[8]</span>+<span class="hljs-selector-attr">[4]</span>+<span class="hljs-selector-attr">[2]</span>
合：<span class="hljs-selector-attr">[5]</span>+<span class="hljs-selector-attr">[3]</span>→<span class="hljs-selector-attr">[3,5]</span>；<span class="hljs-selector-attr">[4]</span>+<span class="hljs-selector-attr">[2]</span>→<span class="hljs-selector-attr">[2,4]</span>；<span class="hljs-selector-attr">[8]</span>+<span class="hljs-selector-attr">[2,4]</span>→<span class="hljs-selector-attr">[2,4,8]</span>；<span class="hljs-selector-attr">[3,5]</span>+<span class="hljs-selector-attr">[2,4,8]</span>→<span class="hljs-selector-attr">[2,3,4,5,8]</span>
</code></pre>
<h4 data-id="heading-30">代码实现（Java，递归版）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MergeSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mergeSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-type">int</span>[] temp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n]; <span class="hljs-comment">// 临时数组，避免频繁创建</span>
        mergeSort(arr, <span class="hljs-number">0</span>, n - <span class="hljs-number">1</span>, temp);
    }

    <span class="hljs-comment">// 递归拆分</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mergeSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right, <span class="hljs-type">int</span>[] temp)</span> {
        <span class="hljs-keyword">if</span> (left &gt;= right) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> left + (right - left) / <span class="hljs-number">2</span>; <span class="hljs-comment">// 避免溢出</span>
        mergeSort(arr, left, mid, temp); <span class="hljs-comment">// 左半区排序</span>
        mergeSort(arr, mid + <span class="hljs-number">1</span>, right, temp); <span class="hljs-comment">// 右半区排序</span>
        merge(arr, left, mid, right, temp); <span class="hljs-comment">// 合并左右区</span>
    }

    <span class="hljs-comment">// 合并两个有序子数组</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">merge</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> mid, <span class="hljs-type">int</span> right, <span class="hljs-type">int</span>[] temp)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> left; <span class="hljs-comment">// 左区指针</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> mid + <span class="hljs-number">1</span>; <span class="hljs-comment">// 右区指针</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> left; <span class="hljs-comment">// 临时数组指针</span>
        <span class="hljs-comment">// 合并两个有序数组</span>
        <span class="hljs-keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= right) {
            <span class="hljs-keyword">if</span> (arr[i] &lt;= arr[j]) {
                temp[k++] = arr[i++];
            } <span class="hljs-keyword">else</span> {
                temp[k++] = arr[j++];
            }
        }
        <span class="hljs-comment">// 拷贝左区剩余元素</span>
        <span class="hljs-keyword">while</span> (i &lt;= mid) {
            temp[k++] = arr[i++];
        }
        <span class="hljs-comment">// 拷贝右区剩余元素</span>
        <span class="hljs-keyword">while</span> (j &lt;= right) {
            temp[k++] = arr[j++];
        }
        <span class="hljs-comment">// 临时数组拷贝回原数组</span>
        System.arraycopy(temp, left, arr, left, right - left + <span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        mergeSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-31">算法分析</h4>
<ul>
<li>时间复杂度：所有情况 O(nlogn)（拆分 O(logn) 层，每层合并 O(n)）；</li>
<li>空间复杂度：O(n)（需要临时数组存储合并结果）；</li>
<li>稳定性：稳定（合并时相等元素优先取左区，保持相对位置）。</li>
</ul>
<hr/>
<h3 data-id="heading-32">6. 快速排序（Quick Sort）</h3>
<h4 data-id="heading-33">核心思想</h4>
<p>分治 + 分区：选一个「基准值」，把数组分成 “小于基准、等于基准、大于基准” 三部分；递归处理左右两部分。像选裁判，把数组分成 “左队（小）、裁判（基准）、右队（大）”，再细分左右队。</p>
<h4 data-id="heading-34">算法步骤</h4>
<ol>
<li>选基准值（推荐：随机选，避免有序数组退化）；</li>
<li>分区：遍历数组，小于基准的放左，大于的放右，基准放中间；</li>
<li>递归对左、右分区重复步骤 1-2；</li>
<li>递归结束则数组有序。</li>
</ol>
<h4 data-id="heading-35">案例演示（数组 <code>[5,3,8,4,2]</code>，选 5 为基准）</h4>
<p>plaintext</p>
<pre><code class="hljs language-css" lang="css">分区：小于<span class="hljs-number">5</span>→<span class="hljs-selector-attr">[3,4,2]</span>，基准→<span class="hljs-number">5</span>，大于<span class="hljs-number">5</span>→<span class="hljs-selector-attr">[8]</span> → <span class="hljs-selector-attr">[3,4,2,5,8]</span>
左分区<span class="hljs-selector-attr">[3,4,2]</span>选<span class="hljs-number">3</span>为基准：小于<span class="hljs-number">3</span>→<span class="hljs-selector-attr">[2]</span>，基准→<span class="hljs-number">3</span>，大于<span class="hljs-number">3</span>→<span class="hljs-selector-attr">[4]</span> → <span class="hljs-selector-attr">[2,3,4,5,8]</span>
右分区<span class="hljs-selector-attr">[8]</span>有序，最终结果：<span class="hljs-selector-attr">[2,3,4,5,8]</span>
</code></pre>
<h4 data-id="heading-36">代码实现（Java，随机基准优化）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuickSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quickSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        quickSort(arr, <span class="hljs-number">0</span>, arr.length - <span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quickSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right)</span> {
        <span class="hljs-keyword">if</span> (left &gt;= right) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">pivotIndex</span> <span class="hljs-operator">=</span> partition(arr, left, right); <span class="hljs-comment">// 分区，返回基准位置</span>
        quickSort(arr, left, pivotIndex - <span class="hljs-number">1</span>); <span class="hljs-comment">// 左分区</span>
        quickSort(arr, pivotIndex + <span class="hljs-number">1</span>, right); <span class="hljs-comment">// 右分区</span>
    }

    <span class="hljs-comment">// 分区函数（Hoare法）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">partition</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right)</span> {
        <span class="hljs-comment">// 随机选基准，避免有序数组退化</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">randomIndex</span> <span class="hljs-operator">=</span> left + <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(right - left + <span class="hljs-number">1</span>);
        swap(arr, left, randomIndex); <span class="hljs-comment">// 基准移到左边界</span>

        <span class="hljs-type">int</span> <span class="hljs-variable">pivot</span> <span class="hljs-operator">=</span> arr[left]; <span class="hljs-comment">// 基准值</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> left, j = right;
        <span class="hljs-keyword">while</span> (i &lt; j) {
            <span class="hljs-comment">// 从右找小于基准的元素</span>
            <span class="hljs-keyword">while</span> (i &lt; j &amp;&amp; arr[j] &gt;= pivot) j--;
            <span class="hljs-comment">// 从左找大于基准的元素</span>
            <span class="hljs-keyword">while</span> (i &lt; j &amp;&amp; arr[i] &lt;= pivot) i++;
            <span class="hljs-comment">// 交换左右指针元素</span>
            <span class="hljs-keyword">if</span> (i &lt; j) swap(arr, i, j);
        }
        <span class="hljs-comment">// 基准归位（i=j的位置）</span>
        swap(arr, left, i);
        <span class="hljs-keyword">return</span> i;
    }

    <span class="hljs-comment">// 交换元素</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swap</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[i];
        arr[i] = arr[j];
        arr[j] = temp;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        quickSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-37">算法分析</h4>
<ul>
<li>时间复杂度：最好 / 平均 O(nlogn)、最坏 O(n2)（有序数组未优化）；</li>
<li>空间复杂度：O(logn)（递归栈，随机基准可优化到 O(logn)）；</li>
<li>稳定性：不稳定（分区交换会打乱相等元素位置）。</li>
</ul>
<hr/>
<h3 data-id="heading-38">7. 堆排序（Heap Sort）</h3>
<h4 data-id="heading-39">核心思想</h4>
<p>利用「堆」（完全二叉树）的特性：构建<strong>大顶堆</strong>（父节点 &gt; 子节点），每次取堆顶（最大值）放到数组末尾，再调整堆，重复直到堆为空。像从堆里每次挑最大的元素 “拿出来”，最终有序。</p>
<h4 data-id="heading-40">算法步骤</h4>
<ol>
<li>构建大顶堆（从最后一个非叶子节点开始向上调整）；</li>
<li>交换堆顶（最大值）和堆的最后一个元素，堆大小减 1；</li>
<li>调整剩余元素为大顶堆；</li>
<li>重复步骤 2-3，直到堆大小为 1。</li>
</ol>
<h4 data-id="heading-41">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>
<p>plaintext</p>
<pre><code class="hljs language-css" lang="css">构建大顶堆：<span class="hljs-selector-attr">[8,4,5,3,2]</span>
轮<span class="hljs-number">1</span>：交换<span class="hljs-number">8</span>和<span class="hljs-number">2</span>→<span class="hljs-selector-attr">[2,4,5,3,8]</span>，调整堆→<span class="hljs-selector-attr">[5,4,2,3,8]</span>
轮<span class="hljs-number">2</span>：交换<span class="hljs-number">5</span>和<span class="hljs-number">3</span>→<span class="hljs-selector-attr">[3,4,2,5,8]</span>，调整堆→<span class="hljs-selector-attr">[4,3,2,5,8]</span>
轮<span class="hljs-number">3</span>：交换<span class="hljs-number">4</span>和<span class="hljs-number">2</span>→<span class="hljs-selector-attr">[2,3,4,5,8]</span>，调整堆→<span class="hljs-selector-attr">[3,2,4,5,8]</span>
轮<span class="hljs-number">4</span>：交换<span class="hljs-number">3</span>和<span class="hljs-number">2</span>→<span class="hljs-selector-attr">[2,3,4,5,8]</span>，结束
</code></pre>
<h4 data-id="heading-42">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeapSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">heapSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;

        <span class="hljs-comment">// 构建大顶堆（从最后一个非叶子节点开始）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> n / <span class="hljs-number">2</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            heapify(arr, n, i);
        }

        <span class="hljs-comment">// 逐个取出堆顶元素</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> n - <span class="hljs-number">1</span>; i &gt; <span class="hljs-number">0</span>; i--) {
            <span class="hljs-comment">// 交换堆顶和当前堆最后一个元素</span>
            swap(arr, <span class="hljs-number">0</span>, i);
            <span class="hljs-comment">// 调整剩余元素为大顶堆</span>
            heapify(arr, i, <span class="hljs-number">0</span>);
        }
    }

    <span class="hljs-comment">// 调整堆（以i为根的子树）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">heapify</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> heapSize, <span class="hljs-type">int</span> i)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">largest</span> <span class="hljs-operator">=</span> i; <span class="hljs-comment">// 初始化最大值为根</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>; <span class="hljs-comment">// 左子节点</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span> * i + <span class="hljs-number">2</span>; <span class="hljs-comment">// 右子节点</span>

        <span class="hljs-comment">// 左子节点更大</span>
        <span class="hljs-keyword">if</span> (left &lt; heapSize &amp;&amp; arr[left] &gt; arr[largest]) {
            largest = left;
        }
        <span class="hljs-comment">// 右子节点更大</span>
        <span class="hljs-keyword">if</span> (right &lt; heapSize &amp;&amp; arr[right] &gt; arr[largest]) {
            largest = right;
        }

        <span class="hljs-comment">// 最大值不是根，交换并递归调整</span>
        <span class="hljs-keyword">if</span> (largest != i) {
            swap(arr, i, largest);
            heapify(arr, heapSize, largest);
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swap</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[i];
        arr[i] = arr[j];
        arr[j] = temp;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        heapSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-43">算法分析</h4>
<ul>
<li>时间复杂度：所有情况 O(nlogn)（建堆 O(n)，每次调整 O(logn)）；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：不稳定（堆调整会打乱相等元素位置）。</li>
</ul>
<hr/>
<h3 data-id="heading-44">8. 计数排序（Counting Sort）</h3>
<h4 data-id="heading-45">核心思想</h4>
<p>非比较排序：统计每个数值出现的次数，再根据次数 “还原” 有序数组。像数人数：按身高统计每个身高的人数，再按身高顺序输出。</p>
<h4 data-id="heading-46">算法步骤</h4>
<ol>
<li>找到数组的最大值 <code>max</code> 和最小值 <code>min</code>；</li>
<li>创建计数数组 <code>count</code>，长度为 <code>max - min + 1</code>，初始化为 0；</li>
<li>遍历原数组，<code>count[num - min]++</code>（统计每个数的出现次数）；</li>
<li>遍历计数数组，按次数将数值填充回原数组。</li>
</ol>
<h4 data-id="heading-47">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>
<ul>
<li>min=2，max=8，count 数组长度 = 7（索引 0→2，1→3，2→4，3→5，4→6，5→7，6→8）；</li>
<li>统计后：<code>count = [1,1,1,1,0,0,1]</code>；</li>
<li>填充：2 (1 次)→3 (1)→4 (1)→5 (1)→8 (1) → [2,3,4,5,8]。</li>
</ul>
<h4 data-id="heading-48">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CountingSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">countingSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;

        <span class="hljs-comment">// 找最大值和最小值</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">min</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>], max = arr[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-keyword">if</span> (num &lt; min) min = num;
            <span class="hljs-keyword">if</span> (num &gt; max) max = num;
        }

        <span class="hljs-comment">// 计数数组</span>
        <span class="hljs-type">int</span>[] count = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[max - min + <span class="hljs-number">1</span>];
        <span class="hljs-comment">// 统计次数</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            count[num - min]++;
        }

        <span class="hljs-comment">// 填充回原数组</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count.length; i++) {
            <span class="hljs-keyword">while</span> (count[i] &gt; <span class="hljs-number">0</span>) {
                arr[index++] = i + min;
                count[i]--;
            }
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        countingSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-49">算法分析</h4>
<ul>
<li>时间复杂度：O(n+k)（k=max−min，数值范围）；</li>
<li>空间复杂度：O(n+k)（计数数组 + 原数组）；</li>
<li>稳定性：稳定（按顺序填充，保持相等元素的相对位置）。</li>
<li>适用场景：数值范围小的整数排序（如成绩、年龄）。</li>
</ul>
<hr/>
<h3 data-id="heading-50">9. 桶排序（Bucket Sort）</h3>
<h4 data-id="heading-51">核心思想</h4>
<p>非比较排序：把数组按数值范围分到多个「桶」里，每个桶内用其他排序（如插入排序），最后合并所有桶。像分桶整理：先按范围粗分，再精细排序，最后合并。</p>
<h4 data-id="heading-52">算法步骤</h4>
<ol>
<li>确定桶的数量和范围（通常按数值分布划分，如 <code>桶数=数组长度</code>）；</li>
<li>遍历数组，将元素放入对应桶中；</li>
<li>对每个非空桶内的元素排序（推荐插入排序，小规模数据高效）；</li>
<li>按桶的顺序合并所有元素，得到有序数组。</li>
</ol>
<h4 data-id="heading-53">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>
<ul>
<li>桶数 = 3，范围划分：[0-3)、[3-6)、[6-9)；</li>
<li>分桶：桶 1→[2,3]，桶 2→[5,4]，桶 3→[8]；</li>
<li>桶内排序：桶 1→[2,3]，桶 2→[4,5]，桶 3→[8]；</li>
<li>合并：[2,3,4,5,8]。</li>
</ul>
<h4 data-id="heading-54">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BucketSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bucketSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;

        <span class="hljs-comment">// 1. 找最大值和最小值，确定桶范围</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">min</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>], max = arr[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-keyword">if</span> (num &lt; min) min = num;
            <span class="hljs-keyword">if</span> (num &gt; max) max = num;
        }

        <span class="hljs-comment">// 2. 创建桶（桶数=数组长度，均匀划分）</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">bucketNum</span> <span class="hljs-operator">=</span> n;
        List&lt;List&lt;Integer&gt;&gt; buckets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(bucketNum);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; bucketNum; i++) {
            buckets.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;());
        }

        <span class="hljs-comment">// 3. 元素入桶</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-comment">// 计算元素所属桶的索引</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">bucketIndex</span> <span class="hljs-operator">=</span> (num - min) * (bucketNum - <span class="hljs-number">1</span>) / (max - min);
            buckets.get(bucketIndex).add(num);
        }

        <span class="hljs-comment">// 4. 桶内排序 + 合并</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (List&lt;Integer&gt; bucket : buckets) {
            Collections.sort(bucket); <span class="hljs-comment">// 桶内用插入排序（Collections.sort底层是TimSort）</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : bucket) {
                arr[index++] = num;
            }
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        bucketSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-55">算法分析</h4>
<ul>
<li>时间复杂度：最好 O(n+k)（分布均匀）、最坏 O(n2)（所有元素入一个桶）、平均 O(n+k)；</li>
<li>空间复杂度：O(n+k)（桶的数量）；</li>
<li>稳定性：稳定（取决于桶内排序算法，如插入排序稳定）；</li>
<li>适用场景：数值分布均匀的场景（如成绩、薪资）。</li>
</ul>
<hr/>
<h3 data-id="heading-56">10. 基数排序（Radix Sort）</h3>
<h4 data-id="heading-57">核心思想</h4>
<p>非比较排序：按数字的「位」（个位、十位、百位…）依次排序，从低位到高位（LSD）或高位到低位（MSD）。像按位数分级排序：先排个位，再排十位，最终整体有序。</p>
<h4 data-id="heading-58">算法步骤（LSD，低位优先）</h4>
<ol>
<li>找到数组的最大位数（如 <code>748</code> 是 3 位）；</li>
<li>从个位开始，按当前位的数值将元素分到 0-9 的桶中；</li>
<li>按桶的顺序（0→9）合并元素；</li>
<li>位数升级（十位、百位…），重复步骤 2-3；直到最高位。</li>
</ol>
<h4 data-id="heading-59">案例演示（数组 <code>[53, 3, 542, 748, 14, 214]</code>）</h4>
<ul>
<li>补零对齐：<code>003, 014, 053, 214, 542, 748</code>；</li>
<li>个位排序：按个位分桶→合并 <code>[542, 053, 003, 014, 214, 748]</code>；</li>
<li>十位排序：按十位分桶→合并 <code>[003, 014, 214, 542, 053, 748]</code>；</li>
<li>百位排序：按百位分桶→合并 <code>[003, 014, 053, 214, 542, 748]</code> → <code>[3,14,53,214,542,748]</code>。</li>
</ul>
<h4 data-id="heading-60">代码实现（Java，LSD）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RadixSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">radixSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// 1. 找最大值，确定最大位数</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-keyword">if</span> (num &gt; max) max = num;
        }

        <span class="hljs-comment">// 2. 按位排序（个位、十位、百位...）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">exp</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; max / exp &gt; <span class="hljs-number">0</span>; exp *= <span class="hljs-number">10</span>) {
            countSortByDigit(arr, exp);
        }
    }

    <span class="hljs-comment">// 按指定位数排序（exp=1→个位，exp=10→十位...）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">countSortByDigit</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> exp)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-type">int</span>[] output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n]; <span class="hljs-comment">// 输出数组</span>
        <span class="hljs-type">int</span>[] count = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>]; <span class="hljs-comment">// 0-9的桶</span>

        <span class="hljs-comment">// 统计当前位的次数</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-type">int</span> <span class="hljs-variable">digit</span> <span class="hljs-operator">=</span> (num / exp) % <span class="hljs-number">10</span>;
            count[digit]++;
        }

        <span class="hljs-comment">// 计算前缀和，确定元素位置（保证稳定性）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            count[i] += count[i - <span class="hljs-number">1</span>];
        }

        <span class="hljs-comment">// 逆序遍历，保证稳定性</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> n - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            <span class="hljs-type">int</span> <span class="hljs-variable">digit</span> <span class="hljs-operator">=</span> (arr[i] / exp) % <span class="hljs-number">10</span>;
            output[count[digit] - <span class="hljs-number">1</span>] = arr[i];
            count[digit]--;
        }

        <span class="hljs-comment">// 拷贝回原数组</span>
        System.arraycopy(output, <span class="hljs-number">0</span>, arr, <span class="hljs-number">0</span>, n);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">53</span>, <span class="hljs-number">3</span>, <span class="hljs-number">542</span>, <span class="hljs-number">748</span>, <span class="hljs-number">14</span>, <span class="hljs-number">214</span>};
        radixSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [3, 14, 53, 214, 542, 748]</span>
    }
}
</code></pre>
<h4 data-id="heading-61">算法分析</h4>
<ul>
<li>时间复杂度：O(d×(n+k))（d= 最大位数，k= 基数 10）；</li>
<li>空间复杂度：O(n+k)（输出数组 + 计数数组）；</li>
<li>稳定性：稳定（逆序遍历 + 前缀和保证相对位置）；</li>
<li>适用场景：整数、字符串排序（如手机号、身份证号）。</li>
</ul>
<hr/>
<h3 data-id="heading-62">十大排序算法总结表</h3>


















































































<table><thead><tr><th>算法</th><th>时间复杂度（最好 / 平均 / 最坏）</th><th>空间复杂度</th><th>稳定性</th><th>核心特点</th></tr></thead><tbody><tr><td>冒泡排序</td><td>O(n)/O(n2)/O(n2)</td><td>O(1)</td><td>稳定</td><td>相邻交换，简单易实现</td></tr><tr><td>选择排序</td><td>O(n2)/O(n2)/O(n2)</td><td>O(1)</td><td>不稳定</td><td>选最小值交换，效率低</td></tr><tr><td>插入排序</td><td>O(n)/O(n2)/O(n2)</td><td>O(1)</td><td>稳定</td><td>插牌逻辑，小规模数据高效</td></tr><tr><td>希尔排序</td><td>O(nlogn)/O(n1.3)/O(n2)</td><td>O(1)</td><td>不稳定</td><td>分组插入排序，效率优于插入</td></tr><tr><td>归并排序</td><td>O(nlogn)/O(nlogn)/O(nlogn)</td><td>O(n)</td><td>稳定</td><td>分治合并，效率稳定</td></tr><tr><td>快速排序</td><td>O(nlogn)/O(nlogn)/O(n2)</td><td>O(logn)</td><td>不稳定</td><td>分治分区，实际应用最优</td></tr><tr><td>堆排序</td><td>O(nlogn)/O(nlogn)/O(nlogn)</td><td>O(1)</td><td>不稳定</td><td>利用堆结构，原地排序</td></tr><tr><td>计数排序</td><td>O(n+k)/O(n+k)/O(n+k)</td><td>O(n+k)</td><td>稳定</td><td>非比较，数值范围小高效</td></tr><tr><td>桶排序</td><td>O(n+k)/O(n+k)/O(n2)</td><td>O(n+k)</td><td>稳定</td><td>分桶排序，分布均匀时高效</td></tr><tr><td>基数排序</td><td>O(d(n+k))/O(d(n+k))/O(d(n+k))</td><td>O(n+k)</td><td>稳定</td><td>按位排序，适合整数 /</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[踩坑实录！MQ 消费租户菜单更新竟引发并发血案？我是如何把线上 BUG 按在地上摩擦的]]></title>    <link>https://juejin.cn/post/7599268297202008102</link>    <guid>https://juejin.cn/post/7599268297202008102</guid>    <pubDate>2026-01-25T14:07:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297202008102" data-draft-id="7598881914203914290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="踩坑实录！MQ 消费租户菜单更新竟引发并发血案？我是如何把线上 BUG 按在地上摩擦的"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-25T14:07:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱找bug的李寻欢"/> <meta itemprop="url" content="https://juejin.cn/user/3228615868953102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            踩坑实录！MQ 消费租户菜单更新竟引发并发血案？我是如何把线上 BUG 按在地上摩擦的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3228615868953102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱找bug的李寻欢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T14:07:03.000Z" title="Sun Jan 25 2026 14:07:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为一名后端开发，最怕的不是写代码，而是线上突然炸锅 —— 告警群 99+、业务方追着问、老板在群里 @你… 最近我就踩了个巨坑：一段看似平平无奇的 MQ 消费租户菜单更新代码，上线后直接引发并发血案：租户菜单重复创建、部分租户更新完全失效、甚至偶发<strong>租户数据串流</strong>（A 租户能看到 B 租户的菜单）！</p>
<p>今天就带大家复盘整个排坑过程，把这些藏在代码里的 “隐形炸弹” 揪出来，顺便聊聊 MQ 消费并发场景下的避坑指南～</p>
<h2 data-id="heading-0">一、案发现场：MQ 消费的 “诡异现象”</h2>
<p>先交代下背景：这段代码是 MQ 消费者的<code>onMessage</code>方法，核心功能是监听 “租户角色菜单更新” 消息，异步更新租户的菜单权限。上线前测试一切正常，结果一上生产，诡异现象接二连三：</p>
<ol>
<li><strong>重复执行</strong>：同一租户的菜单更新请求被多次消费，菜单数据重复插入，数据库里一堆重复记录；</li>
<li><strong>更新失效</strong>：部分租户反馈菜单改了但不生效，查日志发现消息明明消费了，却卡在 Redis 锁判断直接返回；</li>
<li><strong>数据串流</strong>：最致命的！偶发 A 租户能看到 B 租户的菜单，多租户隔离直接破防，这要是被用户发现，妥妥的生产事故！</li>
</ol>
<p>先贴出那段 “罪魁祸首” 的核心代码（大家先品品，能看出几个问题？）：</p>
<p>java</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8bed23dc95240399d117cac6856eb95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5om-YnVn55qE5p2O5a-75qyi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769954823&amp;x-signature=QGGNZ1SdBJJdrm9dY1r%2Bu3Gu57c%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">二、抽丝剥茧：扒开代码里的 “隐形炸弹”</h2>
<p>看似简单的几十行代码，藏了 4 个能引爆生产的坑，个个都是 “致命级”：</p>
<h3 data-id="heading-2">1. 分布式锁的 “伪实现”—— 没过期时间的 Redis Key 就是定时炸弹</h3>
<p>代码里想通过<code>Redis Key=true</code>实现 “防重复消费”，但这波操作纯纯是 “裸奔”：</p>
<ul>
<li><strong>无过期时间</strong>：如果程序在<code>set(key, true)</code>后、<code>finally</code>前崩溃（比如 JVM 宕机、线程被 Kill），这个 Key 会永远留在 Redis 里，后续该租户的所有更新请求都会因为<code>isSync=true</code>直接返回，菜单更新彻底失效；</li>
<li><strong>非原子性操作</strong>：<code>get(key)</code> + <code>set(key)</code>是两步操作，高并发下多个线程能同时拿到<code>isSync=null</code>，然后都执行<code>set</code>，最终多线程并发处理同一租户的菜单，导致数据重复；</li>
<li><strong>锁归属权混乱</strong>：<code>finally</code>里直接删 Key，不管这把锁是不是当前线程加的，容易误删其他线程的锁，并发问题雪上加霜。</li>
</ul>
<p>👉 生动比喻：这就像你给房门装了把锁，但既没配钥匙，也没设自动开锁时间 —— 一旦锁上，这扇门就永远打不开了；更坑的是，多个人同时来开锁，还能一起把门撞开，屋里的东西被翻得乱七八糟。</p>
<h3 data-id="heading-3">2. 租户上下文的 “漏网之鱼”—— 线程池复用导致的 “串台”</h3>
<p>多租户系统的核心是 “租户上下文隔离”，但代码里只做了<code>setTenantId</code>，却没在<code>finally</code>里清理：</p>
<pre><code class="hljs language-scss" lang="scss">TenantContextHolder<span class="hljs-selector-class">.setTenantId</span>(xxx); <span class="hljs-comment">// 只加不删！</span>
</code></pre>
<p>MQ 消费者一般运行在线程池里，线程执行完任务不会销毁，会复用给下一个任务。如果线程 A 处理完租户 1 的请求，上下文没清，线程 A 再处理租户 2 的请求时，就会带着租户 1 的 ID 跑，直接导致<strong>数据串流</strong>（A 租户看到 B 租户的菜单）。</p>
<p>👉 生动比喻：这就像餐厅服务员用完 A 桌的餐具，没收拾就直接端给 B 桌用 —— 不仅不卫生，还会让 B 桌顾客吃到 A 桌的剩菜，体验直接拉满（负的）。</p>
<h3 data-id="heading-4">3. 异常处理的 “摆烂操作”—— 吞掉所有异常 + 日志缺堆栈</h3>
<p>代码里<code>catch (Exception e)</code>把所有异常都吞了，还只打印了异常消息，没打印堆栈：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-built_in">log</span>.error(<span class="hljs-string">"upd-app-role-menu-topic exception is :{}"</span>,e); <span class="hljs-comment">// 错误示范！</span>
</code></pre>
<p>这会导致两个问题：</p>
<ul>
<li>异常被 “吞”：即使核心业务逻辑（比如菜单插入数据库）失败，程序也不会报错，监控系统感知不到，问题藏在暗处；</li>
<li>日志 “残废”：只有异常消息（比如<code>NullPointerException</code>），没有堆栈，根本定位不到是哪一行代码出问题，排障时只能瞎猜。</li>
</ul>
<p>👉 生动比喻：这就像医生看病只看病人说 “不舒服”，既不问哪里不舒服，也不做检查，还不写病历 —— 等病人病情恶化，连怎么治都不知道。</p>
<h3 data-id="heading-5">4. Redis 操作的 “粗心大意”—— 空 Key + 反序列化隐患</h3>
<p>代码里拼接 Redis Key 时直接用<code>cacheKey</code>，没做非空校验：</p>
<p>java</p>
<p>运行</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"tenant_menu:"</span>+updAppTenantRoleMenuDTO.<span class="hljs-built_in">getCacheKey</span>() <span class="hljs-comment">// cacheKey可能为null</span>
</code></pre>
<p>如果<code>cacheKey</code>是<code>null</code>，最终 Key 会变成<code>tenant_menu:null</code>，不仅不符合 Redis Key 规范，还拿不到任何数据；更坑的是，直接把 Redis 里的 Object 强转成<code>List&lt;AppMenuEntity&gt;</code>，如果<code>redisTemplate</code>没配置 JSON 序列化器，会因为 JDK 序列化问题导致反序列化失败，直接抛异常。</p>
<p>👉 生动比喻：这就像寄快递没写清楚收件地址，还把包裹缠了十几层胶带 —— 快递员找不到人，就算找到人，也打不开包裹。</p>
<h2 data-id="heading-6">三、对症下药：把 BUG 按在地上摩擦的优化方案</h2>
<p>找到问题后，针对性优化，每一步都直击痛点：</p>
<h3 data-id="heading-7">1. 升级分布式锁：用 Redisson 替代手动实现（别自己造轮子！）</h3>
<p>手动实现分布式锁容易踩坑，直接用成熟的 Redisson，原子性 + 过期时间 + 锁归属权校验全搞定：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Resource</span>
<span class="hljs-keyword">private</span> RedissonClient redissonClient;

<span class="hljs-meta">@SneakyThrows</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(UpdAppTenantRoleMenuDTO updAppTenantRoleMenuDTO)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">tenantId</span> <span class="hljs-operator">=</span> updAppTenantRoleMenuDTO.getTenantId();
    <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"upd-app-role-menu-topic:"</span> + tenantId;
    <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(lockKey);
    <span class="hljs-comment">// 5秒内拿不到锁就放弃，锁30秒自动过期（避免死锁）</span>
    <span class="hljs-keyword">if</span> (!lock.tryLock(<span class="hljs-number">5</span>, <span class="hljs-number">30</span>, TimeUnit.SECONDS)) {
        log.info(<span class="hljs-string">"租户{}菜单更新任务正在执行，本次请求放弃"</span>, tenantId);
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 核心业务逻辑（下文继续优化）</span>
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"租户{}菜单更新异常"</span>, tenantId, e); <span class="hljs-comment">// 打印完整堆栈</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"租户菜单更新失败"</span>, e); <span class="hljs-comment">// 抛异常触发告警</span>
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// 只释放当前线程持有的锁，避免误删</span>
        <span class="hljs-keyword">if</span> (lock.isHeldByCurrentThread()) {
            lock.unlock();
        }
    }
}
</code></pre>
<h3 data-id="heading-8">2. 管好租户上下文：try-finally 必清理（用完即清！）</h3>
<p>多租户上下文必须 “加了就清”，哪怕抛异常也要清：</p>
<p>java</p>
<p>运行</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 设置租户上下文</span>
    TenantContextHolder.setTenantId(tenantId);
    <span class="hljs-comment">// 核心业务逻辑...</span>
} <span class="hljs-keyword">finally</span> {
    <span class="hljs-comment">// 无论是否异常，都清理上下文！</span>
    TenantContextHolder.clear();
    <span class="hljs-comment">// 释放锁等其他操作...</span>
}
</code></pre>
<h3 data-id="heading-9">3. 规范异常处理：精准捕获 + 完整日志</h3>
<p>别再无脑<code>catch (Exception e)</code>，精准捕获业务异常 + 打印完整堆栈：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">try</span> {
    // 核心业务逻辑
} <span class="hljs-keyword">catch</span> (RedisException e) {
    log.<span class="hljs-keyword">error</span>(<span class="hljs-string">"租户{}菜单更新-Redis操作异常"</span>, tenantId, e);
    <span class="hljs-keyword">throw</span> <span class="hljs-built_in">new</span> BusinessException(<span class="hljs-string">"Redis操作失败，菜单更新终止"</span>, e);
} <span class="hljs-keyword">catch</span> (ServiceException e) {
    log.<span class="hljs-keyword">error</span>(<span class="hljs-string">"租户{}菜单更新-业务服务异常"</span>, tenantId, e);
    <span class="hljs-keyword">throw</span> <span class="hljs-built_in">new</span> BusinessException(<span class="hljs-string">"业务服务调用失败，菜单更新终止"</span>, e);
} <span class="hljs-keyword">catch</span> (Exception e) {
    log.<span class="hljs-keyword">error</span>(<span class="hljs-string">"租户{}菜单更新-未知异常"</span>, tenantId, e);
    <span class="hljs-keyword">throw</span> <span class="hljs-built_in">new</span> BusinessException(<span class="hljs-string">"未知异常，菜单更新终止"</span>, e);
}
</code></pre>
<h3 data-id="heading-10">4. Redis 操作 “加防护”：空值校验 + 正确序列化</h3>
<p>先校验 Key 的合法性，再配置 Redis 序列化器（避免反序列化失败）：
运行</p>
<pre><code class="hljs language-ini" lang="ini">// 1. 空值校验
String <span class="hljs-attr">cacheKey</span> = updAppTenantRoleMenuDTO.getCacheKey()<span class="hljs-comment">;</span>
if (StringUtils.isBlank(cacheKey)) {
    log.warn("租户{}的cacheKey为空，菜单更新终止", tenantId)<span class="hljs-comment">;</span>
    return<span class="hljs-comment">;</span>
}
String <span class="hljs-attr">menuRedisKey</span> = <span class="hljs-string">"tenant_menu:"</span> + cacheKey<span class="hljs-comment">;</span>

// 2. 安全获取数据（先确保redisTemplate配置了Jackson序列化）
List&lt;AppMenuEntity&gt; <span class="hljs-attr">sysMenus</span> = (List&lt;AppMenuEntity&gt;) redisTemplate.opsForValue().get(menuRedisKey)<span class="hljs-comment">;</span>
if (CollectionUtil.isEmpty(sysMenus)) {
    log.warn("租户{}的菜单列表为空，更新终止", tenantId)<span class="hljs-comment">;</span>
    return<span class="hljs-comment">;</span>
}
</code></pre>
<p>Redis 序列化配置示例（关键！）：</p>
<p>java</p>
<p>运行</p>
<pre><code class="hljs language-arduino" lang="arduino">@<span class="hljs-function">Bean
<span class="hljs-keyword">public</span> RedisTemplate&lt;<span class="hljs-type">String</span>, Object&gt; <span class="hljs-title">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory factory)</span> </span>{
    RedisTemplate&lt;<span class="hljs-type">String</span>, Object&gt; <span class="hljs-keyword">template</span> = <span class="hljs-keyword">new</span> RedisTemplate&lt;&gt;();
    <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setConnectionFactory</span>(factory);
    <span class="hljs-comment">// 使用Jackson2JsonRedisSerializer序列化</span>
    Jackson2JsonRedisSerializer&lt;Object&gt; serializer = <span class="hljs-keyword">new</span> Jackson2JsonRedisSerializer&lt;&gt;(Object.<span class="hljs-keyword">class</span>);
    ObjectMapper mapper = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ObjectMapper</span>();
    mapper.<span class="hljs-built_in">setVisibility</span>(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
    mapper.<span class="hljs-built_in">activateDefaultTyping</span>(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL);
    serializer.<span class="hljs-built_in">setObjectMapper</span>(mapper);
    <span class="hljs-comment">// 设置Key和Value的序列化器</span>
    <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setKeySerializer</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">StringRedisSerializer</span>());
    <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setValueSerializer</span>(serializer);
    <span class="hljs-keyword">template</span>.<span class="hljs-built_in">afterPropertiesSet</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">template</span>;
}
</code></pre>
<h2 data-id="heading-11">四、避坑指南：MQ 消费并发场景的 “保命法则”</h2>
<p>踩完这些坑，我总结了 4 条 “保命法则”，分享给大家：</p>
<ol>
<li><strong>分布式锁别自己造轮子</strong>：Redisson/Redlock 才是 YYDS，手动实现容易漏原子性、过期时间、锁归属权这些关键点；</li>
<li><strong>多租户上下文 =“用完即清”</strong> ：线程池环境下，租户 ID、用户 ID 等上下文信息，必须在 finally 里清理，否则必串流；</li>
<li><strong>异常别 “吞”，日志别 “缺”</strong> ：异常要抛出去（触发监控告警），日志要打印完整堆栈（方便定位问题），别做 “甩手掌柜”；</li>
<li><strong>Redis 操作先校验</strong>：拼接 Key 前先校验非空，序列化配置要到位，避免反序列化失败 / 非法 Key。</li>
</ol>
<h2 data-id="heading-12">五、最后唠两句</h2>
<p>这段代码的问题，其实都不是 “高深的技术难题”，而是基础规范没做好 —— 分布式锁的基础、线程安全的基础、异常处理的基础。但恰恰是这些 “基础坑”，在生产环境下会被放大成致命故障。</p>
<p>踩坑不可怕，可怕的是踩了不总结。希望这篇复盘能帮大家少走弯路，也欢迎评论区聊聊你踩过的 MQ 并发坑～</p>
<h3 data-id="heading-13">关键点回顾</h3>
<ol>
<li>手动实现的 Redis 分布式锁若无过期时间和原子性保障，易引发死锁和重复执行，优先用 Redisson；</li>
<li>多租户系统中，租户上下文必须在 finally 块清理，避免线程池复用导致数据串流；</li>
<li>MQ 消费异常不能 “吞”，日志要打印完整堆栈，关键异常需抛出触发告警；</li>
<li>Redis 操作前要校验 Key 合法性，配置正确的序列化器避免反序列化失败。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的项目实战（六）- Prisma ORM：从数据库设计到高效开发]]></title>    <link>https://juejin.cn/post/7598710324167557135</link>    <guid>https://juejin.cn/post/7598710324167557135</guid>    <pubDate>2026-01-25T14:12:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598710324167557135" data-draft-id="7598710324167507983" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的项目实战（六）- Prisma ORM：从数据库设计到高效开发"/> <meta itemprop="keywords" content="后端,NestJS"/> <meta itemprop="datePublished" content="2026-01-25T14:12:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ETA8"/> <meta itemprop="url" content="https://juejin.cn/user/608445545328347"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的项目实战（六）- Prisma ORM：从数据库设计到高效开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/608445545328347/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ETA8
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T14:12:28.000Z" title="Sun Jan 25 2026 14:12:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在我们的 react + nestjs全栈开发中，如何高效、安全地操作数据库，是开发者都会面临的问题。传统的 SQL 编写方式虽然灵活，但容易出错、难以维护；而过度依赖原始查询又会让代码变得臃肿且缺乏类型安全性。</p>
<p>这次让我们使用<strong>prisma</strong>，这个对象映射关系工具，剖析其数据模型设计背后的思考逻辑，讲解迁移（migrate）机制的实际价值，并探讨 Prisma 在企业级应用中的优势与注意事项。让我们还原一次完整的数据库建模与开发流程。</p>
<hr/>
<h2 data-id="heading-0">一、为什么选择 Prisma？告别手写 SQL 的时代</h2>
<p>我们先来回答一个问题：<strong>为什么要用 ORM？</strong></p>
<p>很多初学者会认为，“SQL 我都会写，还用什么 ORM？” 这个想法没错，但在实际工程中，随着业务增长，你会发现：</p>
<ul>
<li>多人协作时，每个人写的 SQL 风格不同；</li>
<li>表结构变更频繁，手动改 SQL 容易遗漏；</li>
<li>类型不安全，JS/TS 中无法静态检查字段是否存在；</li>
<li>分页、关联查询等重复逻辑不断复制粘贴。</li>
</ul>
<p>而 Prisma 正是为了解决这些问题而生的——它不是简单的 ORM 工具，更像是一套<strong>类型安全 + 自动化迁移 + 可视化调试</strong>的完整解决方案。</p>
<blockquote>
<p>Prisma = Schema 设计 + 数据迁移 + 类型生成 + 查询构建器</p>
</blockquote>
<p>它的核心理念是：<strong>把数据库当作代码一样管理</strong>。</p>
<hr/>
<h2 data-id="heading-1">二、数据模型设计：不只是建表，更是业务逻辑的表达</h2>
<p>让我们来看这样一个场景：我们要做一个内容社区系统，包含用户、文章、评论、标签、点赞等功能。这看似简单，但其中的关系处理非常关键。</p>
<h3 data-id="heading-2">1. 用户表（User）</h3>
<pre><code class="hljs language-prisma" lang="prisma">model User {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  password  String
  posts     Post[]
  comments  Comment[]
  likes     UserLikePost[]
}
</code></pre>
<p>这里有几个重点设计点值得说明：</p>
<h4 data-id="heading-3">✅ 唯一用户名 <code>@unique</code></h4>
<p>用户名作为登录标识，必须唯一。使用 <code>@unique</code> 能自动创建唯一索引，避免程序层漏校验导致脏数据。</p>
<h4 data-id="heading-4">✅ 级联删除 vs 置空策略的选择</h4>
<p>比如用户的头像（Avatar）、文件（File），都设置了 <code>onDelete: Cascade</code> —— 用户删了，相关资源也一并清理，符合直觉。</p>
<p>但文章（Post）却设置为：</p>
<pre><code class="hljs language-prisma" lang="prisma">user Post? @relation(... onDelete: SetNull)
</code></pre>
<p>这意味着：<strong>当作者被删除时，文章仍然保留，只是作者变为空</strong>。这是出于内容保护的考虑——不能因为某个用户注销账号，就让所有他发布的内容消失。类似知乎、微博的做法。</p>
<blockquote>
<p>⚠️ 思考题：什么时候该用 <code>Cascade</code>？什么时候用 <code>SetNull</code>？</p>
<ul>
<li><code>Cascade</code>：附属资源无独立意义（如用户上传的临时图片）</li>
<li><code>SetNull</code>：主资源有价值，需保留历史记录（如文章、评论）</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-5">2. 文章与标签的多对多关系（PostTag）</h3>
<p>标签系统是一个典型的多对多场景。直接在 <code>Post</code> 上加 <code>tagIds</code> 字段看似方便，实则违反范式，后期难扩展。</p>
<p>Prisma 推荐显式定义中间表：</p>
<pre><code class="hljs language-prisma" lang="prisma">model PostTag {
  postId Int
  tagId  Int
  post   Post @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag    Tag  @relation(fields: [tagId], references: [id], onDelete: Cascade)
  @@id([postId, tagId])
}
</code></pre>
<p>这样做有三个好处：</p>
<ol>
<li><strong>清晰表达关系结构</strong>：不再是隐式的数组字符串拼接；</li>
<li><strong>支持额外字段扩展</strong>：未来如果要记录“谁添加的标签”、“添加时间”，可以直接在这个表里加字段；</li>
<li><strong>性能可控</strong>：可以针对 <code>(tagId)</code> 建立索引，实现“查找某标签下的所有文章”这类高频查询。</li>
</ol>
<blockquote>
<p>💡 小技巧：中间表命名建议统一为 <code>&lt;Left&gt;&lt;Right&gt;</code> 形式，如 <code>PostTag</code>，而不是 <code>TagPost</code> 或 <code>post_tags</code> 混用，保持一致性。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">3. 评论的递归关系（Comment → Comment）</h3>
<p>评论可以回复评论，形成树状结构。这种自引用关系在 Prisma 中通过 <code>@relation("Name")</code> 显式命名来实现：</p>
<pre><code class="hljs language-prisma" lang="prisma">model Comment {
  parent   Comment?  @relation("CommentToComment", fields: [parentId], references: [id])
  replies  Comment[] @relation("CommentToComment")
}
</code></pre>
<p>这个设计的关键在于：</p>
<ul>
<li>使用字符串 <code>"CommentToComment"</code> 区分两个方向的关系；</li>
<li><code>parentId</code> 可为空，表示顶层评论；</li>
<li>删除父评论时，子评论也级联删除（<code>onDelete: Cascade</code>），防止孤儿节点。</li>
</ul>
<blockquote>
<p>❗ 注意：递归删除可能引发性能问题。若评论层级很深或数量巨大，应结合软删除或异步任务处理。</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">4. 文件存储的设计（File 表）</h3>
<p>文件表不仅记录路径，还包括元信息：</p>
<pre><code class="hljs language-prisma" lang="prisma">model File {
  originalname String
  mimetype     String
  filename     String
  size         Int
  width        Int @db.SmallInt
  height       Int @db.SmallInt
  metadata     Json?
  postId       Int?
  userId       Int
}
</code></pre>
<p>几点设计考量：</p>
<ul>
<li><code>width</code> / <code>height</code> 使用 <code>@db.SmallInt</code> 显式映射 PostgreSQL 的 smallint 类型，节省空间；</li>
<li><code>metadata</code> 使用 <code>Json?</code> 类型，可用于保存缩略图地址、OCR 结果等非结构化数据；</li>
<li><code>postId</code> 可为空，意味着文件既可以属于文章，也可以属于用户个人上传（如头像）；</li>
<li>关联用户时使用 <code>Cascade</code>，确保用户注销后不会留下垃圾文件。</li>
</ul>
<hr/>
<h2 data-id="heading-8">三、迁移（Migrate）：让数据库变更可追踪、可回滚</h2>
<p>很多人一开始跳过 <code>prisma migrate</code>，直接用 <code>db push</code> 快速同步 schema 到数据库。但这只适合本地开发。</p>
<p>真正的生产环境，必须使用 <strong>迁移脚本（migration script）</strong>。</p>
<p>执行命令：</p>
<pre><code class="hljs language-bash" lang="bash">npx prisma migrate dev --name init_user
</code></pre>
<p>Prisma 会做三件事：</p>
<ol>
<li>对比当前 <code>schema.prisma</code> 和数据库状态；</li>
<li>生成 SQL 迁移文件（放在 <code>prisma/migrations/</code> 目录下）；</li>
<li>执行 SQL 并更新数据库。</li>
</ol>
<h3 data-id="heading-9">为什么需要迁移？</h3>
<p>举个例子：你在本地加了个字段 <code>email</code>，同事 A 也加了 <code>phone</code>，你们都没沟通。如果直接 <code>db push</code>，很可能覆盖对方改动。</p>
<p>但如果有迁移脚本：</p>
<ul>
<li>你的提交包含 <code>add_email_field.sql</code></li>
<li>他的提交包含 <code>add_phone_field.sql</code></li>
<li>CI 流水线会按顺序执行这两个脚本，最终两者都存在</li>
</ul>
<p>这就实现了 <strong>数据库版本控制</strong>，就像 Git 管理代码一样。</p>
<blockquote>
<p>🔔 提示：团队协作中，每次修改 schema 都应提交对应的 migration 文件，不要只提交 <code>.prisma</code> 文件。</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">四、Prisma Studio：可视化调试利器</h2>
<p>运行：</p>
<pre><code class="hljs language-bash" lang="bash">npx prisma studio
</code></pre>
<p>打开浏览器就能看到图形化界面，支持增删改查，特别适合：</p>
<ul>
<li>查看种子数据是否正确；</li>
<li>调试复杂关系的数据展示；</li>
<li>给产品经理演示后台数据结构。</li>
</ul>
<p>虽然是个小工具，但在快速验证阶段极为实用。</p>
<hr/>
<h2 data-id="heading-11">五、实战建议与避坑指南</h2>
<h3 data-id="heading-12">✅ 最佳实践</h3>

























<table><thead><tr><th>实践</th><th>说明</th></tr></thead><tbody><tr><td>使用 <code>migrate dev</code> 而非 <code>db push</code></td><td>保证迁移历史完整</td></tr><tr><td>每次 schema 修改都生成新 migration</td><td>避免线上冲突</td></tr><tr><td>多对多关系显式建中间表</td><td>更灵活、可扩展</td></tr><tr><td>时间字段统一用 <code>DateTime @default(now())</code></td><td>避免时区混乱</td></tr></tbody></table>
<h3 data-id="heading-13">❌ 常见误区</h3>
<ol>
<li>
<p><strong>滥用 <code>any</code> 类型绕过 Prisma 类型检查</strong></p>
<blockquote>
<p>不要用 <code>as any</code> 强转结果，失去类型安全的意义。</p>
</blockquote>
</li>
<li>
<p><strong>忽略索引导致慢查询</strong></p>
<blockquote>
<p>对经常用于查询的外键字段（如 <code>userId</code>, <code>postId</code>）务必加 <code>@@index</code>。</p>
</blockquote>
</li>
<li>
<p><strong>在事务中执行耗时操作</strong></p>
<blockquote>
<p>Prisma 支持事务，但不要在里面做 HTTP 请求或文件处理，容易超时。</p>
</blockquote>
</li>
<li>
<p><strong>忘记设置环境变量</strong></p>
<blockquote>
<p><code>DATABASE_URL</code> 必须配置正确，尤其是生产环境注意加密传输。</p>
</blockquote>
</li>
</ol>
<hr/>
<h2 data-id="heading-14">六、总结：Prisma 是现代 Node.js 开发的基础设施</h2>
<p>经过这次实战，我们可以得出结论：</p>
<blockquote>
<p><strong>Prisma 不只是一个数据库客户端，它是连接代码与数据库之间的桥梁，让后端开发变得更可靠、更高效、更容易协作。</strong></p>
</blockquote>
<p>它带来的改变不仅仅是“少写 SQL”，更重要的是：</p>
<ul>
<li>数据结构设计前置化；</li>
<li>数据变更可追溯；</li>
<li>查询类型安全；</li>
<li>团队协作更顺畅。</li>
</ul>
<p>当你开始在一个项目中使用 Prisma 并建立起规范的 migration 流程后，你会发现：<strong>数据库不再是一个黑盒，而是整个应用中最清晰、最可维护的一部分。</strong></p>
<hr/>
<h2 data-id="heading-15">延伸阅读建议</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.prisma.io%2Fdocs" target="_blank" title="https://www.prisma.io/docs" ref="nofollow noopener noreferrer">Prisma 官方文档</a></li>
<li>如何在 NestJS 中集成 Prisma（推荐封装 Module）</li>
<li>使用 <code>prisma seed</code> 初始化测试数据</li>
<li>生产环境中如何安全执行 migrate（配合 CI/CD）</li>
</ul>
<p>如果你正在启动一个新的 Node.js 项目，不妨试试从 Prisma 开始。也许你会发现，原来操作数据库也可以如此优雅。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL索引结构的演进与设计逻辑]]></title>    <link>https://juejin.cn/post/7598737609494691859</link>    <guid>https://juejin.cn/post/7598737609494691859</guid>    <pubDate>2026-01-25T15:03:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598737609494691859" data-draft-id="7598767580306063414" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL索引结构的演进与设计逻辑"/> <meta itemprop="keywords" content="MySQL,程序员,数据库"/> <meta itemprop="datePublished" content="2026-01-25T15:03:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Olaf_n"/> <meta itemprop="url" content="https://juejin.cn/user/1324234125087575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL索引结构的演进与设计逻辑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1324234125087575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Olaf_n
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T15:03:56.000Z" title="Sun Jan 25 2026 15:03:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、引言</h2>
<p>索引并非与生俱来就是B+树结构，但大多数人与MySQL打交道时，都默认了索引=B+树的认知。我们往往记住了最终的结论，却忽略了背后的迭代历程——它为何会从早期的查找树，一步步演化成如今的B+树？每一次迭代都在解决什么核心痛点，今天我们就来拆解MySQL索引结构的演变。</p>
<h2 data-id="heading-1">二、索引结构的设计核心诉求</h2>
<p>在追溯演进前，我们先明确一个核心前提：所有索引结构的设计，都围绕三大核心诉求平衡展开，这也是判断结构优劣的关键标尺。</p>
<ol>
<li><strong>高效查询</strong>：核心是减少磁盘IO次数，既要支持等值查询，也要适配范围查询、排序等高频业务场景，避免极端慢查询。</li>
<li><strong>低存储成本</strong>：索引本身不存储业务数据，仅作为导航工具，需控制自身存储空间，避免占用过多磁盘资源。</li>
<li><strong>稳定性与适配性</strong>：适配磁盘存储的预读特性，能应对大数据量增长，维持索引结构平衡，确保查询效率稳定。</li>
</ol>
<h2 data-id="heading-2">三、演进脉络</h2>
<h3 data-id="heading-3">第一代结构（二叉查找树）</h3>
<p>二叉查找树的特点如下</p>
<ul>
<li>若左子树不空，则左子树上所有结点的值均小于根节点的值；</li>
<li>若右字树不空，则右子树上所有结点的值均大于跟节点的值；</li>
<li>左、右子树也分别为二叉排序树</li>
</ul>
<p>如图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad160094b7ea446896725c216db7cd3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=HrwvP0gmPr6cvSMOj3gcbREuuJA%3D" alt="image.png" loading="lazy"/></p>
<ol>
<li>
<p><strong>核心结构</strong>：每个节点最多包含两个子节点，左子树的所有节点值小于父节点，右子树的所有节点值大于父节点，通过这种有序性实现快速查找。</p>
</li>
<li>
<p><strong>查找逻辑</strong>：以查询值与父节点比较，小于则进入左子树，大于则进入右子树，依次递归，直到找到目标节点或遍历至空节点。</p>
</li>
<li>
<p><strong>致命局限</strong>：完全无法适配MySQL的大数据量、磁盘存储场景</p>
</li>
</ol>
<p>这种结构有一个致命的缺陷就是会退化成单链表，查找时间复杂度从O(logn)骤变为O(n)，与全表扫描无异；比如这种数据情况【50，40，30，20，10，5】</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f91af01dda84f7f8936ef3f8e5a60a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=G%2FPHyOpb6Uoj%2FxeA8xwPnw0LtMw%3D" alt="image.png" loading="lazy"/></p>
<p>树高过高百万级数据下，树高可达数十层甚至上百层，而磁盘IO是毫秒级操作，过多IO次数会导致查询极慢；</p>
<p>不支持范围查询高效遍历：需额外排序或全量遍历，无法满足MySQL高频范围查询需求。</p>
<h3 data-id="heading-4">优化改进：平衡二叉树（红黑树也是属于平衡树的一种）</h3>
<p>平衡二叉树的特点：在满足二叉搜索树的基础上，左树和右树的高度差绝对值不超过1</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2628b83a7c542f8be9de8fe24b210cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=33GXwcgfsZRV1QndrA%2FFlnPAcAk%3D" alt="" loading="lazy"/></p>
<p>平衡二叉树可以通过左旋转和右旋转调整树的高度，使其维持基本的平衡，但是还有一个核心的问题还没有解决。树的高度问题，如果数据量过大，还是会导致这棵树的高度过高。</p>
<h3 data-id="heading-5">继续优化：B-tree（B树）</h3>
<p>B树的本质上是一种多路查找树结构，B树的特征点是每一层节点存的都是真实数据。B树的结构如下
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3df6275a91dc4f13882ff2f050f63a5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=NJiZBW9mvwQ%2B9sdeVSROX06LnIY%3D" alt="" loading="lazy"/></p>
<p>B树的查找流程</p>
<h4 data-id="heading-6">单条数据查找流程（以查找 key = 45 为例）</h4>
<ol>
<li>
<p><strong>从根节点开始查找</strong><br/>
根节点包含关键字 <code>[30, 60, 90]</code>。<br/>
根据 B 树的查找规则：</p>
<ul>
<li>45 &gt; 30 且 45 &lt; 60<br/>
因此沿着 <strong>30 与 60 之间对应的子指针</strong>，进入第二个子节点。</li>
</ul>
</li>
<li>
<p><strong>在目标子节点中查找数据</strong><br/>
进入子节点 <code>[35, 45, 55]</code> 后，在该节点内部对关键字进行查找（顺序查找或二分查找）。<br/>
此时可以直接定位到 key = 45，对应的数据记录被成功命中，查找流程结束。</p>
</li>
</ol>
<blockquote>
<p>可以看到，B 树的单条数据查找过程是一个<strong>自顶向下的逐层定位过程</strong>，当目标 key 出现在某个节点中时，查找即可结束。</p>
</blockquote>
<h4 data-id="heading-7">范围数据查找流程（以查找 45 ~ 100 为例）</h4>
<p>范围查询是B树相对容易暴露性能问题的场景。</p>
<ol>
<li>
<p><strong>首先定位范围起点</strong><br/>
与单条查询类似，按照 B 树的查找规则，从根节点 <code>[30, 60, 90]</code> 出发，最终定位到包含起始 key = 45 的子节点 <code>[35, 45, 55]</code>。</p>
</li>
<li>
<p><strong>在起始节点中进行扫描</strong><br/>
在节点 <code>[35, 45, 55]</code> 中，从 key = 45 开始向右扫描，命中符合范围条件的数据：</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">45, 55</span>]
</code></pre>
<p>需要注意的是，此时<strong>范围查询不会结束</strong>，因为后续节点中仍然可能存在满足条件的 key。</p>
</li>
<li>
<p><strong>回溯并切换到其他相关节点继续查找</strong><br/>
扫描完当前子节点后，需要回溯到上层节点 <code>[30, 60, 90]</code>，继续判断：</p>
<ul>
<li>key = 60、90 均落在查询范围内，命中对应数据<br/>
随后沿着指针切换到右侧子节点 <code>[95, 100, 110]</code>，在该节点中从左向右扫描，继续命中：</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">95, 100</span>]
</code></pre>
</li>
<li>
<p><strong>遍历结束，范围查询完成</strong><br/>
当所有可能包含目标范围的数据节点都被访问后，查询结束。<br/>
最终命中的数据为：
[45, 55, 60, 90, 95, 100]</p>
</li>
</ol>
<h4 data-id="heading-8">B 树在范围查询中的性能问题</h4>
<p>从上述流程可以明显看出B树的范围查询并非线性顺序扫描，查询过程中需要在子节点、父节点、兄弟节点  之间频繁切换</p>
<p>在数据库场景下，这种<strong>节点切换往往意味着额外的磁盘 IO</strong></p>
<ul>
<li>每一次节点跳转，都可能触发一次新的磁盘页读取</li>
<li>当数据量较大、树层级较深时，IO 成本会被不断放大</li>
</ul>
<p>👉 <strong>这正是 B 树在范围查询场景下的先天劣势，也是 B+ 树设计中重点优化的问题之一。</strong></p>
<h3 data-id="heading-9">最终版 B+Tree</h3>
<p>B+Tree 是针对 B树的改进，先来看看一看B+Tree长什么样子。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ad28f5ba441444e95f7516c047a18ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=L1afVJ6ul9w9MJE8h0O6M7sM4gw%3D" alt="image.png" loading="lazy"/></p>
<p>可以看到B+Tree对B-Tree做了以下改进</p>
<ol>
<li>数据索引分离，所有的数据都是在叶子节点上，非叶子节点上只是存储地址信息，这样的好处是所有的查询都必须走到叶子节点，因此查询的路径长度固定，时间复杂度稳定为O(logN)，B树的话，叶子节点和非叶子节点都会存数据，有时候查的快有时候查的慢，不稳定。</li>
<li>叶子节点使用链表连接，极大的提升了范围查找的效率。</li>
</ol>
<p>B+Tree的数据查找流程</p>
<h4 data-id="heading-10">单条数据查找流程（以查找 key = 45 为例）</h4>
<ol>
<li>
<p><strong>从根节点开始查找</strong><br/>
根节点中包含索引关键字 <code>[30, 60, 90]</code>。<br/>
根据 B+ 树的查找规则：</p>
<ul>
<li>30 &lt; 45 &lt; 60<br/>
因此沿着对应的子指针，进入第二个子节点 <code>[35, 45, 55]</code>。</li>
</ul>
</li>
<li>
<p><strong>在非叶子节点中继续向下定位</strong><br/>
虽然在节点 <code>[35, 45, 55]</code> 中已经可以看到 key = 45，<br/>
但此时<strong>查找不能停止</strong>，因为该节点是非叶子节点，只保存索引 key 与子节点指针，并不存储真实数据。</p>
</li>
<li>
<p><strong>继续向下，直到叶子节点</strong><br/>
沿着指针继续向下访问子节点，最终在某个叶子节点中定位到 key = 45，对应的数据记录。<br/>
至此，单条数据查找流程结束。</p>
</li>
</ol>
<blockquote>
<p>可以看到，B+ 树的单条查询路径是<strong>固定的</strong>：<br/>
<strong>从根节点开始，逐层向下，最终一定到达叶子节点。</strong></p>
</blockquote>
<h4 data-id="heading-11">范围数据查找流程（以查找 45 ~ 100 为例）</h4>
<ol>
<li>
<p><strong>先定位范围起点</strong><br/>
首先查找 key = 45，查找过程与单条查询完全一致，最终定位到包含 45 的叶子节点。</p>
</li>
<li>
<p><strong>从起始叶子节点开始顺序扫描</strong><br/>
在叶子节点中，从 key = 45 开始向右遍历，依次命中满足条件的数据。</p>
</li>
<li>
<p><strong>沿叶子节点链表持续遍历</strong><br/>
B+ 树中的所有叶子节点通过指针形成一个有序链表。<br/>
因此，当当前叶子节点扫描完成后，可以<strong>直接通过指针访问下一个叶子节点</strong>，无需回到父节点或重新查找。</p>
</li>
<li>
<p><strong>直到超出范围为止</strong><br/>
当扫描到 key &gt; 100 时，范围查询结束。<br/>
最终命中的数据为：</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">45, 46, 50, 55, 58, 60, 92, 94, 100</span>]
</code></pre>
</li>
</ol>
<hr/>
<h4 data-id="heading-12">B+树范围查询高效的根本原因</h4>
<p>与 B 树相比，B+ 树在范围查询中的优势非常明显：</p>
<ul>
<li>查询路径固定，只需一次自顶向下的定位</li>
<li>范围扫描发生在<strong>叶子节点层</strong></li>
<li>叶子节点之间通过链表顺序连接</li>
<li>避免了频繁在父子节点之间来回切换</li>
</ul>
<p>👉 <strong>在数据库场景下，这种顺序扫描方式可以显著减少磁盘 IO 次数，这也是 MySQL 等关系型数据库选择 B+ 树作为索引结构的核心原因之一。</strong></p>
<h2 data-id="heading-13">四、扩展补充 Hash索引</h2>
<p>是一张表，里面有对应的key和value
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a48da3ed8fc4712b94b02c1f22601e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=HmuOXxGn45K3yZByrSiXtOKFFR0%3D" alt="" loading="lazy"/></p>
<p>查询操作直接通过 get(key) 进行获取，时间复杂度O(1)，好处是检索速度极快，缺点就是支持不了范围查找，还有一个问题就是但是Hash结构如果产生Hash冲突，会导致整个数据散列的不均匀，查找可能会退化成O(n)</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ff2529b9f624b0f8158fb4fc33a0db3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT2xhZl9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769958236&amp;x-signature=LbJ81QozSL1FkLlVe005dyayUgI%3D" alt="" loading="lazy"/></p>
<p>等值查找可以直接get(key)，但是如果想要完成范围查找就又得遍历整个hash表，效率很慢，hash就不合适了。在MySQL这类需要高效支撑大量范围查询的应用场景中，Hash结构并不适用，这也是为什么它未能成为主流数据库索引结构的重要原因。</p>
<h2 data-id="heading-14">五、总结</h2>
<p>MySQL索引结构的演进，本质上是一场围绕“高效查询、低存储成本、稳定性适配”三大核心诉求的持续优化之旅，每一代结构的迭代都精准解决了前序方案在数据库实际场景中的致命局限，最终沉淀出适配主流业务需求的B+树结构。</p>
<ul>
<li>
<p>早期的二叉查找树凭借有序性实现了基础快速查找，但极易因数据分布失衡退化为单链表，且树高过高导致磁盘IO次数激增，完全无法适配大数据量、磁盘存储的数据库场景。平衡二叉树通过旋转调整机制解决了结构失衡问题，维持了查询时间复杂度的稳定性，但未能突破树高限制，面对海量数据时仍存在IO效率瓶颈。</p>
</li>
<li>
<p>B树作为多路查找树，通过多节点存储特性大幅降低了树高，减少了磁盘IO层级，一定程度上优化了查询效率。但B树的核心缺陷的在于范围查询时需在父子节点、兄弟节点间频繁切换，引发额外磁盘IO，在高频范围查询场景中性能受限，这也为B+树的出现埋下了伏笔。</p>
</li>
<li>
<p>B+树在B树基础上完成了关键性改进，成为MySQL索引的最优解。其一，实现数据与索引分离，非叶子节点仅存储索引指针，叶子节点集中存储所有真实数据，使查询路径固定统一，时间复杂度稳定在O(logN)；其二，叶子节点通过链表有序连接，范围查询只需一次自顶向下定位起点，随后沿链表顺序扫描即可，彻底规避了节点间的频繁切换，大幅降低磁盘IO成本，完美适配数据库等值查询、范围查询、排序等核心业务场景。</p>
</li>
<li>
<p>而Hash索引虽能以O(1)时间复杂度实现等值查询，检索速度极快，但存在天然短板：无法支持范围查询，且Hash冲突可能导致性能退化为O(n)，难以适配MySQL多样化的查询需求，因此仅适用于特定等值查询场景，无法成为主流索引结构。</p>
</li>
</ul>
<p>总而言之MySQL索引结构的演进并非偶然，而是从场景需求出发，不断弥补前序结构缺陷、平衡各项性能指标的过程。B+树之所以成为主流，核心在于其精准契合了磁盘存储特性与数据库高频查询场景，在查询效率、稳定性与适配性上达到了最优平衡，而其他结构或因场景局限、或因性能短板，最终沦为特定场景的补充方案。这一演进逻辑也启示我们，索引结构的选择本质是对业务场景与性能需求的精准匹配。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[# JavaScript 函数核心知识体系：从基础到精]]></title>    <link>https://juejin.cn/post/7598563188112343092</link>    <guid>https://juejin.cn/post/7598563188112343092</guid>    <pubDate>2026-01-25T11:10:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598563188112343092" data-draft-id="7598710324167294991" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="# JavaScript 函数核心知识体系：从基础到精"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-01-25T11:10:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不会敲代码1"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            # JavaScript 函数核心知识体系：从基础到精
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不会敲代码1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T11:10:38.000Z" title="Sun Jan 25 2026 11:10:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 函数核心知识体系：从基础到精通</h2>
<h3 data-id="heading-1">目录</h3>
<ol>
<li>[函数的本质与对象特性]</li>
<li>[this绑定的四种模式]</li>
<li>[arguments对象与参数处理]</li>
<li>[闭包机制深度解析]</li>
<li>[递归算法详解]</li>
<li>[回调函数与异步编程]</li>
</ol>
<hr/>
<h3 data-id="heading-2">1. 函数的本质与对象特性</h3>
<h4 data-id="heading-3">1.1 函数就是对象</h4>
<p>在JavaScript中，<strong>函数是一种特殊的对象</strong>。它不仅包含可执行的代码，还可以拥有属性和方法。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 函数作为对象的证据</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Hello!"</span>);
}

<span class="hljs-comment">// 可以像普通对象一样添加属性</span>
sayHi.<span class="hljs-property">name</span> = <span class="hljs-string">"greeting"</span>;
sayHi.<span class="hljs-property">version</span> = <span class="hljs-string">"1.0"</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sayHi.<span class="hljs-property">name</span>); <span class="hljs-comment">// "greeting"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sayHi.<span class="hljs-property">version</span>); <span class="hljs-comment">// "1.0"</span>
</code></pre>
<h4 data-id="heading-4">1.2 函数的原型链结构</h4>
<p>所有函数都连接到 <code>Function.prototype</code>，而 <code>Function.prototype</code> 又连接到 <code>Object.prototype</code>。</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span><span class="hljs-params">()</span></span> {}
└── <span class="hljs-string">[[Prototype]]</span> → Function.prototype
    └── <span class="hljs-string">[[Prototype]]</span> → Object.prototype
        └── <span class="hljs-string">[[Prototype]]</span> → null
</code></pre>
<p>这意味着函数不仅能调用 <code>call()</code>、<code>apply()</code> 等方法（来自 <code>Function.prototype</code>），还能调用 <code>toString()</code> 等方法（来自 <code>Object.prototype</code>）。</p>
<h4 data-id="heading-5">1.3 函数的两个隐藏属性</h4>
<p>每个函数在创建时都会附带两个隐藏属性：</p>
<ul>
<li><strong>函数的上下文</strong>：决定 <code>this</code> 的绑定规则</li>
<li><strong>实现函数行为的代码</strong>：函数体中的逻辑</li>
</ul>
<h4 data-id="heading-6">1.4 prototype属性详解</h4>
<p>每个函数对象在创建时都会自动获得一个 <code>prototype</code> 属性。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); 
<span class="hljs-comment">// 输出: { constructor: Person }</span>

<span class="hljs-comment">// 默认constructor指向函数本身</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span>
</code></pre>
<h5 data-id="heading-7">关键区分：</h5>




















<table><thead><tr><th>名称</th><th>是什么？</th><th>作用</th></tr></thead><tbody><tr><td><code>fn.__proto__</code></td><td>函数对象的 <code>[[Prototype]]</code></td><td>指向 <code>Function.prototype</code>，用于继承函数方法（如 <code>.call()</code>）</td></tr><tr><td><code>fn.prototype</code></td><td>函数的 <code>prototype</code> 属性</td><td>是一个普通对象，用于作为 <code>new fn()</code> 实例的原型</td></tr></tbody></table>
<blockquote>
<p><strong>一句话总结</strong>：<br/>
<code>__proto__</code> 是"我爸爸是谁"（功能来源）；<br/>
<code>prototype</code> 是"我的孩子将来长什么样"（模板）。</p>
</blockquote>
<hr/>
<h3 data-id="heading-8">2. this绑定的四种模式</h3>
<h4 data-id="heading-9">2.1 方法调用模式</h4>
<p>当一个函数被作为一个对象的方法调用时，<code>this</code> 指向该对象。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> p = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>,
    <span class="hljs-attr">sayName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
    }
};

p.<span class="hljs-title function_">sayName</span>(); <span class="hljs-comment">// 输出: Alice → this === p</span>
</code></pre>
<h4 data-id="heading-10">2.2 函数调用模式</h4>
<p>独立调用函数时，<code>this</code> 的指向取决于是否在严格模式下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">var</span> fn = p.<span class="hljs-property">sayName</span>;
<span class="hljs-title function_">fn</span>(); <span class="hljs-comment">// TypeError: Cannot read property 'name' of undefined</span>
      <span class="hljs-comment">// 因为 this 是 undefined</span>

<span class="hljs-comment">// 非严格模式下，this 指向全局对象（window）</span>
</code></pre>
<h4 data-id="heading-11">2.3 构造器调用模式</h4>
<p>使用 <code>new</code> 关键字调用函数时，会创建一个新的对象，<code>this</code> 指向这个新对象。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; <span class="hljs-comment">// this 指向 new 创建的新对象</span>
}

<span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Bob"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p.<span class="hljs-property">name</span>); <span class="hljs-comment">// Bob</span>
</code></pre>
<h4 data-id="heading-12">2.4 apply/call调用模式</h4>
<p>可以显式地指定 <code>this</code> 的值。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Hello, I'm "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
}

<span class="hljs-keyword">var</span> obj = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Charlie"</span> };
greet.<span class="hljs-title function_">apply</span>(obj); <span class="hljs-comment">// 输出: Hello, I'm Charlie → this === obj</span>
</code></pre>
<h4 data-id="heading-13">2.5 this绑定口诀</h4>
<blockquote>
<p><strong>"this 不是‘我’，而是‘谁调用我’。"</strong></p>
<ul>
<li>方法调用 → this 是调用者</li>
<li>独立调用 → this 是全局/undefined</li>
<li>new 调用 → this 是新对象</li>
<li>apply 调用 → this 是你指定的</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-14">3. arguments对象与参数处理</h3>
<h4 data-id="heading-15">3.1 arguments的本质</h4>
<p>每当函数被调用时，会自动获得一个名为 <code>arguments</code> 的"免费"参数，它包含了所有传入的实际参数。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Name:"</span>, name);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Age:"</span>, age);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Other args:"</span>, <span class="hljs-variable language_">arguments</span>[<span class="hljs-number">2</span>], <span class="hljs-variable language_">arguments</span>[<span class="hljs-number">3</span>]);
}

<span class="hljs-title function_">greet</span>(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"student"</span>, <span class="hljs-string">"developer"</span>);
<span class="hljs-comment">// Other args: student developer</span>
</code></pre>
<h4 data-id="heading-16">3.2 arguments的设计缺陷</h4>
<p>尽管被称为"数组"，但 <code>arguments</code> 并不是真正的数组，而是一个"类数组对象"。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span>); <span class="hljs-comment">// 3</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">arguments</span>[<span class="hljs-number">0</span>]);     <span class="hljs-comment">// 'a'</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">arguments</span>.<span class="hljs-title function_">slice</span>()); <span class="hljs-comment">// ❌ TypeError!</span>
}
<span class="hljs-title function_">test</span>(<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>);
</code></pre>
<h4 data-id="heading-17">3.3 arguments转换为真数组</h4>
<p>有三种常用方法将 <code>arguments</code> 转换为真正的数组：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">convertArgs</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 方法1：Array.from()</span>
    <span class="hljs-keyword">var</span> args1 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">arguments</span>);
    
    <span class="hljs-comment">// 方法2：扩展运算符（ES6）</span>
    <span class="hljs-keyword">var</span> args2 = [...<span class="hljs-variable language_">arguments</span>];
    
    <span class="hljs-comment">// 方法3：call + slice</span>
    <span class="hljs-keyword">var</span> args3 = [].<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>);
    
    <span class="hljs-keyword">return</span> args1;
}
</code></pre>
<h4 data-id="heading-18">3.4 现代替代方案</h4>
<p>推荐使用 ES6 的 rest 参数来替代 <code>arguments</code>：</p>
<pre><code class="hljs language-scss" lang="scss">const sum = (...nums) =&gt; {
    return nums<span class="hljs-selector-class">.reduce</span>((total, num) =&gt; total + num, <span class="hljs-number">0</span>);
};

<span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// 6</span>
<span class="hljs-built_in">sum</span>(<span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">15</span>, <span class="hljs-number">16</span>, <span class="hljs-number">23</span>, <span class="hljs-number">42</span>); <span class="hljs-comment">// 108</span>
</code></pre>
<blockquote>
<p>💡 <strong>金句</strong>："arguments 是 JS 的历史遗产，它让函数变得灵活，但也留下了‘非数组’的遗憾。"</p>
</blockquote>
<hr/>
<h3 data-id="heading-19">4. 闭包机制深度解析</h3>
<h4 data-id="heading-20">4.1 什么是闭包？</h4>
<blockquote>
<p><strong>闭包 = 一个函数 + 它被创建时所处的词法环境的引用</strong></p>
</blockquote>
<p>当一个内部函数即使在其外部函数执行完毕后仍能访问其变量时，就形成了闭包。</p>
<h4 data-id="heading-21">4.2 形成闭包的三个必要条件</h4>

























<table><thead><tr><th>条件</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>① 内部函数</td><td>必须有一个函数定义在另一个函数内部</td><td><code>function outer() { function inner() {} }</code></td></tr><tr><td>② 访问外部变量</td><td>内部函数必须引用外层函数的局部变量</td><td><code>inner() { console.log(x); }</code></td></tr><tr><td>③ 外部函数执行完毕后，内部函数仍可被调用</td><td>内部函数被返回或赋值给全局变量</td><td><code>return inner;</code> 或 <code>window.fn = inner;</code></td></tr></tbody></table>
<h4 data-id="heading-22">4.3 经典示例</h4>
<h5 data-id="heading-23">示例1：最简闭包</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">makeAdder</span>(<span class="hljs-params">x</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">y</span>) {
        <span class="hljs-keyword">return</span> x + y; <span class="hljs-comment">// 访问外部变量 x</span>
    };
}

<span class="hljs-keyword">const</span> add5 = <span class="hljs-title function_">makeAdder</span>(<span class="hljs-number">5</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add5</span>(<span class="hljs-number">3</span>)); <span class="hljs-comment">// 8</span>
</code></pre>
<h5 data-id="heading-24">示例2：私有变量封装</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCounter</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> ++count,
        <span class="hljs-attr">decrement</span>: <span class="hljs-function">() =&gt;</span> --count,
        <span class="hljs-attr">value</span>: <span class="hljs-function">() =&gt;</span> count
    };
}

<span class="hljs-keyword">const</span> counter = <span class="hljs-title function_">createCounter</span>();
counter.<span class="hljs-title function_">increment</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter.<span class="hljs-title function_">value</span>()); <span class="hljs-comment">// 1</span>
<span class="hljs-comment">// count 对外界完全隐藏 → 实现了「数据封装」</span>
</code></pre>
<h5 data-id="heading-25">示例3：事件监听器中的闭包</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">`btn<span class="hljs-subst">${i}</span>`</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Button <span class="hljs-subst">${i}</span> clicked!`</span>);
    });
}
</code></pre>
<h4 data-id="heading-26">4.4 let/const在闭包中的行为</h4>

















<table><thead><tr><th>场景</th><th>var 行为</th><th>let/const 行为</th><th>原因</th></tr></thead><tbody><tr><td>在循环中定义函数</td><td>所有函数共享同一个变量</td><td>每次迭代都有独立的绑定</td><td>let/const 有块级作用域</td></tr></tbody></table>
<pre><code class="hljs language-css" lang="css">// ❌ <span class="hljs-selector-tag">var</span> 陷阱
for (<span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">i</span> = <span class="hljs-number">0</span>; <span class="hljs-selector-tag">i</span> &lt; <span class="hljs-number">3</span>; <span class="hljs-selector-tag">i</span>++) {
    setTimeout(() =&gt; console<span class="hljs-selector-class">.log</span>(<span class="hljs-selector-tag">i</span>), <span class="hljs-number">100</span>); // 输出: <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>
}

// ✅ let 正确
for (let <span class="hljs-selector-tag">i</span> = <span class="hljs-number">0</span>; <span class="hljs-selector-tag">i</span> &lt; <span class="hljs-number">3</span>; <span class="hljs-selector-tag">i</span>++) {
    setTimeout(() =&gt; console<span class="hljs-selector-class">.log</span>(<span class="hljs-selector-tag">i</span>), <span class="hljs-number">100</span>); // 输出: <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>
}
</code></pre>
<h4 data-id="heading-27">4.5 闭包的用途</h4>






























<table><thead><tr><th>用途</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>数据封装</td><td>隐藏实现细节</td><td><code>createCounter()</code> 中的 <code>count</code></td></tr><tr><td>函数工厂</td><td>动态生成函数</td><td><code>makeAdder(5)</code></td></tr><tr><td>模块化开发</td><td>避免全局污染</td><td>IIFE 模块</td></tr><tr><td>异步编程</td><td>保持上下文</td><td><code>setTimeout(() =&gt; console.log(x), 100)</code></td></tr></tbody></table>
<h4 data-id="heading-28">4.6 闭包风险与优化</h4>





















<table><thead><tr><th>风险</th><th>如何避免</th></tr></thead><tbody><tr><td>内存占用增加</td><td>避免引用大型 DOM 对象或数据结构</td></tr><tr><td>意外保留作用域</td><td>不要在循环中无意捕获大对象</td></tr><tr><td>调试困难</td><td>使用 Chrome DevTools 查看 Scope</td></tr></tbody></table>
<blockquote>
<p>🔑 <strong>终极口诀</strong>："一嵌套、二访问、三脱离——三者俱全才是闭包。"</p>
</blockquote>
<hr/>
<h3 data-id="heading-29">5. 递归算法详解</h3>
<h4 data-id="heading-30">5.1 什么是递归？</h4>
<p>递归是指函数直接或间接地调用自身。必须包含：</p>
<ol>
<li><strong>基线条件</strong>（Base Case）：停止递归的条件</li>
<li><strong>递推关系</strong>（Recursive Case）：问题规模变小的自我调用</li>
</ol>
<h4 data-id="heading-31">5.2 汉诺塔问题详解</h4>
<h5 data-id="heading-32">问题描述</h5>
<p>将 n 个圆盘从源柱移动到目标柱，遵循以下规则：</p>
<ol>
<li>每次只能移动一个圆盘</li>
<li>不能将较大的圆盘放在较小的圆盘上面</li>
<li>可以使用辅助柱作为过渡</li>
</ol>
<h5 data-id="heading-33">递归解法</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> hanoi = <span class="hljs-keyword">function</span>(<span class="hljs-params">disc, src, aux, dst</span>) {
    <span class="hljs-keyword">if</span> (disc &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-title function_">hanoi</span>(disc - <span class="hljs-number">1</span>, src, dst, aux); <span class="hljs-comment">// 步骤1：把上面n-1个移到辅助柱</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Move disc '</span> + disc + <span class="hljs-string">' from '</span> + src + <span class="hljs-string">' to '</span> + dst); <span class="hljs-comment">// 步骤2：移动最大盘</span>
        <span class="hljs-title function_">hanoi</span>(disc - <span class="hljs-number">1</span>, aux, src, dst); <span class="hljs-comment">// 步骤3：把n-1个从辅助柱移到目标柱</span>
    }
};

<span class="hljs-title function_">hanoi</span>(<span class="hljs-number">3</span>, <span class="hljs-string">'Src'</span>, <span class="hljs-string">'Aux'</span>, <span class="hljs-string">'Dst'</span>);
</code></pre>
<h5 data-id="heading-34">完整执行流程（n=3）</h5>













































<table><thead><tr><th>步骤</th><th>输出</th><th>物理状态</th></tr></thead><tbody><tr><td>①</td><td>Move disc 1 from Src to Dst</td><td><code>[3,2] / [] / [1]</code></td></tr><tr><td>②</td><td>Move disc 2 from Src to Aux</td><td><code>[3] / [2] / [1]</code></td></tr><tr><td>③</td><td>Move disc 1 from Dst to Aux</td><td><code>[3] / [2,1] / []</code></td></tr><tr><td>④</td><td>Move disc 3 from Src to Dst</td><td><code>[] / [2,1] / [3]</code></td></tr><tr><td>⑤</td><td>Move disc 1 from Aux to Src</td><td><code>[1] / [2] / [3]</code></td></tr><tr><td>⑥</td><td>Move disc 2 from Aux to Dst</td><td><code>[1] / [] / [3,2]</code></td></tr><tr><td>⑦</td><td>Move disc 1 from Src to Dst</td><td><code>[] / [] / [3,2,1]</code></td></tr></tbody></table>
<h5 data-id="heading-35">数学规律</h5>
<p>移动 n 个盘所需的最少步数为：<code>T(n) = 2ⁿ - 1</code></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">T</span>(<span class="hljs-number">1</span>) = <span class="hljs-number">1</span>
<span class="hljs-built_in">T</span>(<span class="hljs-number">2</span>) = <span class="hljs-number">3</span>  
<span class="hljs-built_in">T</span>(<span class="hljs-number">3</span>) = <span class="hljs-number">7</span>
<span class="hljs-built_in">T</span>(<span class="hljs-number">4</span>) = <span class="hljs-number">15</span>
...
</code></pre>
<blockquote>
<p>🧠 <strong>核心思想</strong>："要把 n 个盘从 A→C，必须先搬走上面 n−1 个盘到 B，再把最大的盘移到 C，最后把 n−1 个盘从 B 移到 C。"</p>
</blockquote>
<hr/>
<h3 data-id="heading-36">6. 回调函数与异步编程</h3>
<h4 data-id="heading-37">6.1 同步 vs 异步</h4>
<h5 data-id="heading-38">同步方式（阻塞式）</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">request</span> = prepare_the_request()<span class="hljs-comment">;</span>
<span class="hljs-attr">response</span> = send_request_synchronously(request)<span class="hljs-comment">; // 卡住等待</span>
display(response)<span class="hljs-comment">;</span>
</code></pre>
<p>❌ 问题：网络请求会导致客户端"假死"状态。</p>
<h5 data-id="heading-39">异步方式（非阻塞式）</h5>
<pre><code class="hljs language-scss" lang="scss">request = <span class="hljs-built_in">prepare_the_request</span>();
<span class="hljs-built_in">send_request_asynchronously</span>(request, function(response) {
    <span class="hljs-attribute">display</span>(response);
});
</code></pre>
<p>✅ 优点：立即返回，不阻塞UI，响应到达时自动调用回调函数。</p>
<h4 data-id="heading-40">6.2 回调函数本质</h4>
<ul>
<li><strong>函数作为参数</strong>传递给另一个函数</li>
<li><strong>延迟执行</strong>，在特定事件触发时执行</li>
<li>实现<strong>事件驱动</strong>编程模型</li>
<li>达到代码<strong>解耦</strong>的效果</li>
</ul>
<h4 data-id="heading-41">6.3 实际应用示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">simulateAsyncRequest</span>(<span class="hljs-params">callback</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"开始请求..."</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-string">"Hello from server!"</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"响应到达！"</span>);
        <span class="hljs-title function_">callback</span>(response);
    }, <span class="hljs-number">1000</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">display</span>(<span class="hljs-params">response</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"显示结果："</span> + response);
}

<span class="hljs-title function_">simulateAsyncRequest</span>(display);
</code></pre>
<blockquote>
<p>"回调 = 把‘要做什么’告诉别人，等事情做完后再通知你。"</p>
</blockquote>
<h4 data-id="heading-42">6.4 发展演进</h4>
<p>虽然回调是异步编程的基础，但存在"回调地狱"问题，因此发展出了：</p>
<ul>
<li><strong>Promise</strong>：解决回调嵌套过深的问题</li>
<li><strong>async/await</strong>：让异步代码看起来像同步代码</li>
</ul>
<hr/>
<h3 data-id="heading-43">总结与展望</h3>
<h4 data-id="heading-44">核心知识点回顾</h4>
<ol>
<li><strong>函数是对象</strong>：具有属性和方法，通过原型链继承</li>
<li><strong>this绑定</strong>：由调用方式决定，掌握四种模式</li>
<li><strong>arguments</strong>：类数组对象，现代开发推荐使用 rest 参数</li>
<li><strong>闭包</strong>：记住作用域的能力，是许多高级特性的基础</li>
<li><strong>递归</strong>：分治思想的体现，适用于树形结构等问题</li>
<li><strong>回调</strong>：异步编程的基石，理解事件循环的关键</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 v-model 新写法全解：多绑定+自定义修饰符+(.camel)避坑]]></title>    <link>https://juejin.cn/post/7598574507347853347</link>    <guid>https://juejin.cn/post/7598574507347853347</guid>    <pubDate>2026-01-25T12:07:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598574507347853347" data-draft-id="7598532592456466459" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 v-model 新写法全解：多绑定+自定义修饰符+(.camel)避坑"/> <meta itemprop="keywords" content="JavaScript,面试,Vue.js"/> <meta itemprop="datePublished" content="2026-01-25T12:07:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="boooooooom"/> <meta itemprop="url" content="https://juejin.cn/user/3078273283917399"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 v-model 新写法全解：多绑定+自定义修饰符+(.camel)避坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3078273283917399/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    boooooooom
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:07:21.000Z" title="Sun Jan 25 2026 12:07:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Vue3 中，v-model 进行了大幅重构，摆脱了 Vue2 中基于 value 属性和 input 事件的强耦合限制，变得更灵活、可扩展。新语法支持多 v-model 绑定、自定义修饰符、.camel 命名转换等实用特性，彻底解决了旧版本的诸多痛点。本文将从核心变化入手，结合实战案例拆解所有新特性，助你高效掌握 Vue3 v-model 用法。</p>
<h2 data-id="heading-0">一、Vue3 v-model 核心变化（与 Vue2 对比）</h2>
<p>Vue3 对 v-model 的设计理念进行了革新，核心变更在于“解耦属性与事件”，让开发者可自由定义绑定的属性名和触发事件，同时简化了自定义组件的 v-model 实现。</p>
<h3 data-id="heading-1">1. 默认绑定规则变更</h3>
<p>Vue2 中，自定义组件的 v-model 默认绑定 <code>value</code> 属性和 <code>input</code> 事件；Vue3 则默认绑定 <code>modelValue</code> 属性和 <code>update:modelValue</code> 事件，避免了与原生表单元素的 value 属性冲突。</p>
<pre><code class="hljs language-ts" lang="ts">&lt;!-- <span class="hljs-title class_">Vue2</span> 自定义组件 v-model 写法 --&gt;
&lt;template&gt;
  &lt;input :value="value" @input="$emit('input', $event.target.value)"&gt;
&lt;/template&gt;
&lt;script setup&gt;
export default {
  props: ['value']
}
&lt;script&gt;

&lt;!-- Vue3 自定义组件 v-model 写法（默认） --&gt;
&lt;template&gt;
  &lt;input :value="modelValue" @input="$emit('update:modelValue', $event.target.value)"&gt;
&lt;/template&gt;
&lt;script setup&gt;
defineProps(['modelValue'])
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-2">2. 支持自定义绑定属性与事件</h3>
<p>Vue3 允许通过 <code>v-model:propName</code> 的形式，自定义组件 v-model 绑定的属性名，替代 Vue2 中需要通过 <code>model</code> 选项配置的方式，语法更简洁。</p>
<pre><code class="hljs language-ts" lang="ts">&lt;!-- 父组件：自定义绑定属性为 title --&gt;
&lt;template&gt;
  &lt;CustomInput v-model:title="formTitle" /&amp;gt;
&lt;/template&gt;

&lt;!-- 子组件：对应绑定 title 属性和 update:title 事件 --&gt;
&lt;template&gt;
  &lt;input :value="title" @input="$emit('update:title', $event.target.value)"&gt;
&lt;/template&gt;
&lt;script setup&gt;
defineProps(['title'])
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-3">二、多 v-model 绑定（Vue3 新增）</h2>
<p>Vue2 中一个组件只能绑定一个 v-model，若需多字段双向绑定，需手动定义多个事件；Vue3 借助“自定义绑定属性”特性，支持在一个组件上使用多个 v-model，实现多字段同步更新，大幅简化代码。</p>
<h3 data-id="heading-4">实战案例：多字段表单组件</h3>
<p>实现一个用户信息表单组件，同时绑定姓名（name）和年龄（age）两个字段，通过多 v-model 同步到父组件。</p>
<pre><code class="hljs language-ts" lang="ts">&lt;!-- 父组件：多 v-model 绑定 --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">UserForm</span> 
    <span class="hljs-attr">v-model:name</span>=<span class="hljs-string">"userName"</span> 
    <span class="hljs-attr">v-model:age</span>=<span class="hljs-string">"userAge"</span> 
  /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>姓名：{{ userName }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>年龄：{{ userAge }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UserForm</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./UserForm.vue'</span>

<span class="hljs-keyword">const</span> userName = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> userAge = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

&lt;!-- 子组件：<span class="hljs-title class_">UserForm</span>.<span class="hljs-property">vue</span> --&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;input 
      type="text" 
      :value="name" 
      @input="$emit('update:name', $event.target.value)"
      placeholder="请输入姓名"
    &gt;
    &lt;input 
      type="number" 
      :value="age" 
      @input="$emit('update:age', $event.target.valueAsNumber)"
      placeholder="请输入年龄"
    &gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
// 接收父组件传递的两个绑定属性
defineProps(['name', 'age'])
&lt;/script&gt;
</code></pre>
<p>核心逻辑：每个 v-model 对应“属性名 + update:属性名 事件”的组合，子组件通过触发对应事件，将值同步给父组件，实现多字段双向绑定。</p>
<h2 data-id="heading-5">三、自定义修饰符（Vue3 新增）</h2>
<p>Vue2 中 v-model 仅支持系统内置修饰符（.trim、.number、.lazy），自定义修饰符需通过复杂的事件处理实现；Vue3 允许为 v-model 定义自定义修饰符，轻松实现格式化、验证等逻辑，且支持全局和局部修饰符。</p>
<h3 data-id="heading-6">1. 自定义修饰符基础用法</h3>
<p>实现一个自定义修饰符 <code>.capitalize</code>，将输入的文本首字母大写，步骤如下：</p>
<pre><code class="hljs language-ts" lang="ts">&lt;!-- 父组件：使用自定义修饰符 .<span class="hljs-property">capitalize</span> --&gt;
&lt;template&gt;
  &lt;CustomInput v-model.capitalize="username" /&amp;gt;
&lt;/template&gt;

&lt;!-- 子组件：处理自定义修饰符 --&gt;
&lt;template&gt;
  &lt;input 
    :value="modelValue" 
    @input="handleInput"
  &gt;
&lt;/template&gt;

&lt;script setup&gt;
const props = defineProps({
  modelValue: String,
  // 接收修饰符：格式为“modelModifiers”，类型为对象
  modelModifiers: {
    type: Object,
    default: () =&gt; ({})
  }
})

const emit = defineEmits(['update:modelValue'])

const handleInput = (e) =&gt; {
  let value = e.target.value
  // 判断是否使用了 .capitalize 修饰符
  if (props.modelModifiers.capitalize) {
    value = value.charAt(0).toUpperCase() + value.slice(1)
  }
  emit('update:modelValue', value)
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-7">2. 多 v-model 自定义修饰符</h3>
<p>若为多 v-model 绑定添加修饰符，需在子组件中通过“属性名 + Modifiers”的格式接收，例如为 <code>v-model:name</code> 添加修饰符，子组件接收 <code>nameModifiers</code>。</p>
<pre><code class="hljs language-ts" lang="ts">&lt;!-- 父组件：为 name 绑定添加 .<span class="hljs-property">capitalize</span> 修饰符 --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">UserForm</span> <span class="hljs-attr">v-model:name.capitalize</span>=<span class="hljs-string">"userName"</span> /&amp;<span class="hljs-attr">gt</span>;
&lt;/<span class="hljs-attr">template</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 子组件：接收 nameModifiers 修饰符 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-comment">// 对应 name 绑定的修饰符</span>
  <span class="hljs-attr">nameModifiers</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({})
  }
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:name'</span>])

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleNameInput</span> = (<span class="hljs-params">e</span>) =&gt; {
  <span class="hljs-keyword">let</span> value = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">nameModifiers</span>.<span class="hljs-property">capitalize</span>) {
    value = value.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">toUpperCase</span>() + value.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>)
  }
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:name'</span>, value)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</span></code></pre>
<h2 data-id="heading-8">四、.camel 修饰符（Vue3 保留并优化）</h2>
<p>Vue 中 HTML 属性名是不区分大小写的，默认会将 v-model 绑定的驼峰式属性名转为短横线分隔式（kebab-case）。<code>.camel</code> 修饰符用于强制保留驼峰式属性名，适用于绑定原生组件或第三方组件中需要驼峰命名属性的场景。</p>
<h3 data-id="heading-9">使用场景与实例</h3>
<p>例如，原生 SVG 元素的 <code>viewBox</code> 属性是驼峰命名，若直接通过 v-model 绑定，Vue 会默认转为 <code>view-box</code>，导致属性失效，此时需使用 <code>.camel</code> 修饰符保留驼峰格式。</p>
<pre><code class="hljs language-ts" lang="ts">
&lt;template&gt;
  &lt;!-- 错误：<span class="hljs-title class_">Vue</span> 会将 viewBox 转为 view-box，<span class="hljs-variable constant_">SVG</span> 无法识别 --&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"viewBoxValue"</span>&amp;<span class="hljs-attr">gt</span>;&amp;<span class="hljs-attr">lt</span>;/<span class="hljs-attr">svg</span>&amp;<span class="hljs-attr">gt</span>;

  &lt;!<span class="hljs-attr">--</span> <span class="hljs-attr">正确</span>：<span class="hljs-attr">.camel</span> <span class="hljs-attr">强制保留</span> <span class="hljs-attr">viewBox</span> <span class="hljs-attr">驼峰命名</span> <span class="hljs-attr">--</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">v-model.camel</span>=<span class="hljs-string">"viewBoxValue"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-comment">// viewBoxValue 格式："0 0 100 100"</span>
<span class="hljs-keyword">const</span> viewBoxValue = <span class="hljs-title function_">ref</span>(<span class="hljs-string">"0 0 100 100"</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>注意：在 Vue3 的单文件组件（SFC）中，模板是经过编译优化的，对于自定义组件的驼峰属性，若子组件接收时用驼峰命名，可无需 <code>.camel</code>；但对于原生元素或第三方组件，仍需通过 <code>.camel</code> 处理驼峰属性。</p>
<h2 data-id="heading-10">五、常见问题与避坑指南</h2>
<ol>
<li><strong>修饰符与多 v-model 冲突</strong>：多 v-model 绑定的修饰符需对应“属性名 + Modifiers”接收，不可混用<code>modelModifiers</code>（默认修饰符接收名）。</li>
<li><strong>.camel 修饰符滥用</strong>：自定义组件间的驼峰属性绑定无需 <code>.camel</code>，仅原生元素或第三方组件需要，避免过度使用。</li>
<li><strong>Vue2 迁移兼容</strong>：若需兼容 Vue2 代码，可通过 <code>model</code> 选项配置默认属性和事件，Vue3 仍支持该写法，但推荐使用新语法。</li>
</ol>
<h2 data-id="heading-11">六、总结</h2>
<p>Vue3 对 v-model 的重构，核心是赋予开发者更强的灵活性——多 v-model 绑定解决了多字段双向同步的痛点，自定义修饰符简化了值处理逻辑，.camel 修饰符适配了特殊属性命名场景。这些特性让 v-model 不再局限于基础表单绑定，能轻松应对复杂业务场景。</p>
<p>实际开发中，建议根据业务需求合理选择特性：简单表单用默认 v-model，多字段用多 v-model 绑定，需格式化值用自定义修饰符，原生驼峰属性用 .camel 修饰符，最大化提升开发效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[css实现网格类背景图]]></title>    <link>https://juejin.cn/post/7598699872552812580</link>    <guid>https://juejin.cn/post/7598699872552812580</guid>    <pubDate>2026-01-25T12:26:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598699872552812580" data-draft-id="7598480267218370594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="css实现网格类背景图"/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2026-01-25T12:26:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="its_wild"/> <meta itemprop="url" content="https://juejin.cn/user/651350467947725"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            css实现网格类背景图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/651350467947725/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    its_wild
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:26:16.000Z" title="Sun Jan 25 2026 12:26:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-forest-dark">.hljs-comment,.hljs-quote{color:#9c9491}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#f22c40}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#df5320}.hljs-bullet,.hljs-string,.hljs-symbol{color:#7b9726}.hljs-section,.hljs-title{color:#407ee7}.hljs-keyword,.hljs-selector-tag{color:#6666ea}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1b1918;color:#a8a19f}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">原理</h3>
<p>将网格背景拆解成最小单元，然后通过复制最小单元从而实现网格背景。</p>
<h3 data-id="heading-1">点状网格</h3>
<h4 data-id="heading-2">效果：</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19a3f413f6f94da29795ef738bdac902~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=0ZiDEtxlf2jz6NG1iY9QgAqDdtE%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">最小单元：</h4>
<p>如图所示，红框内为最小单元。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f663a84212a4c3c8fe8b7920d258b01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=vlgF83oc7LaaNQzHVAOc8orCPS8%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">实现步骤：</h4>
<p>先确定最小单的边长为 <strong>20px</strong>，点的边长为 <strong>4px</strong>。</p>
<ol>
<li>先绘制一个从上到下的正方形，把该正方形的上方 <strong>4px</strong> 部分绘制为透明的，下方部分绘制为深色，效果如下(<em>注：灰色边框是为了看效果作为辅助的不算在最小单元内</em>)：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b055c3cb589472fa1d429b71a19d3b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=Gdi2DCYdVoDKioz6OcrTQ1VhakA%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>再绘制一个从左到右的正方形，把该正方形的左边 <strong>4px</strong> 部分绘制为透明的，右边部分绘制为深色，效果如下：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c99dc3cbce844611986f33d95186af84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=bIEcHLRR4Zlk%2FG4rmv3s7FfhZ1I%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>将前两个图形叠加效果如下：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c742305e444845dd924dbe707ee125a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=7ByyD8D3XrQz96souuObb1pT%2B5Q%3D" alt="image.png" loading="lazy"/></p>
<ol start="4">
<li>复制前三步得到的图形，效果如下：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3bb6242497943068f4fc33879ca4535~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=C9sMK5Bp%2BYL%2BwYAPHtWir%2FWZmPs%3D" alt="image.png" loading="lazy"/></p>
<ol start="5">
<li>给背景设置一个颜色，让透明的部分展示背景的颜色，效果如下：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2159fb378c9942a1bf84ccab15fe057e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=UKU%2Bh5STGXaZkSVDOMxjHelJasg%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">代码：</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>网格<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-pseudo">:root</span> {
      <span class="hljs-comment">/* 深色大面积的背景色 */</span>
      <span class="hljs-attr">--clr1</span>: <span class="hljs-number">#1F3A5F</span>;
      <span class="hljs-comment">/* 浅色点的颜色 */</span>
      <span class="hljs-attr">--clr2</span>: <span class="hljs-number">#4d648d</span>;
      <span class="hljs-comment">/* 点的宽度 */</span>
      <span class="hljs-attr">--w1</span>: <span class="hljs-number">4px</span>;
      <span class="hljs-comment">/* 最小单元的宽度 */</span>
      <span class="hljs-attr">--w2</span>: <span class="hljs-number">20px</span>;
    }

    * {
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }

    <span class="hljs-selector-class">.main</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">background-image</span>:
        <span class="hljs-comment">/* 先绘制一个从上到下的正方形，把该正方形的上方 **4px** 部分绘制为透明的，下方部分绘制为深色 */</span>
        <span class="hljs-built_in">linear-gradient</span>(to bottom, transparent, transparent <span class="hljs-built_in">var</span>(--w1), <span class="hljs-built_in">var</span>(--clr1) <span class="hljs-built_in">var</span>(--w1)),
        <span class="hljs-comment">/* 再绘制一个从左到右的正方形，把该正方形的左边 **4px** 部分绘制为透明的，右边部分绘制为深色 */</span>
        <span class="hljs-built_in">linear-gradient</span>(to right, transparent, transparent <span class="hljs-built_in">var</span>(--w1), <span class="hljs-built_in">var</span>(--clr1) <span class="hljs-built_in">var</span>(--w1));
      <span class="hljs-comment">/* 设置最小单元的宽度 */</span>
      <span class="hljs-attribute">background-size</span>: <span class="hljs-built_in">var</span>(--w2) <span class="hljs-built_in">var</span>(--w2);
      <span class="hljs-comment">/* 给背景设置一个颜色，让透明的部分展示背景的颜色 */</span>
      <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--clr2);
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">线状网格</h3>
<h4 data-id="heading-7">效果：</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16467a22e5cb4c3b9af88a11b1876eb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=Fhi0xF1KE6xBZ4WHhQTKsce78%2F8%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">实现原理：</h4>
<p>将上面点状网格的点的边长调大，点大了之后就会出现两条边的效果，如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1f387f83bc449ada5b66ad620589801~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXRzX3dpbGQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949098&amp;x-signature=46SIe5fNGwcP8cx8xG64WpP4MpI%3D" alt="image.png" loading="lazy"/></p>
<p>再将之前的两个颜色调换一下就得到了线状网格。</p>
<h4 data-id="heading-9">代码：</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>网格<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-pseudo">:root</span> {
      <span class="hljs-comment">/* 深色大面积的背景色 */</span>
      <span class="hljs-attr">--clr1</span>: <span class="hljs-number">#4d648d</span>;
      <span class="hljs-comment">/* 浅色点的颜色 */</span>
      <span class="hljs-attr">--clr2</span>: <span class="hljs-number">#1F3A5F</span>;
      <span class="hljs-comment">/* 点的宽度 */</span>
      <span class="hljs-attr">--w1</span>: <span class="hljs-number">18px</span>;
      <span class="hljs-comment">/* 最小单元的宽度 */</span>
      <span class="hljs-attr">--w2</span>: <span class="hljs-number">20px</span>;
    }

    * {
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }

    <span class="hljs-selector-class">.main</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">background-image</span>:
        <span class="hljs-comment">/* 先绘制一个从上到下的正方形，把该正方形的上方 **4px** 部分绘制为透明的，下方部分绘制为深色 */</span>
        <span class="hljs-built_in">linear-gradient</span>(to bottom, transparent, transparent <span class="hljs-built_in">var</span>(--w1), <span class="hljs-built_in">var</span>(--clr1) <span class="hljs-built_in">var</span>(--w1)),
        <span class="hljs-comment">/* 再绘制一个从左到右的正方形，把该正方形的左边 **4px** 部分绘制为透明的，右边部分绘制为深色 */</span>
        <span class="hljs-built_in">linear-gradient</span>(to right, transparent, transparent <span class="hljs-built_in">var</span>(--w1), <span class="hljs-built_in">var</span>(--clr1) <span class="hljs-built_in">var</span>(--w1));
      <span class="hljs-comment">/* 设置最小单元的宽度 */</span>
      <span class="hljs-attribute">background-size</span>: <span class="hljs-built_in">var</span>(--w2) <span class="hljs-built_in">var</span>(--w2);
      <span class="hljs-comment">/* 给背景设置一个颜色，让透明的部分展示背景的颜色 */</span>
      <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--clr2);
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JS-告别页面卡死：深度解析 Web Worker 多线程]]></title>    <link>https://juejin.cn/post/7598807837867753498</link>    <guid>https://juejin.cn/post/7598807837867753498</guid>    <pubDate>2026-01-25T12:30:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598807837867753498" data-draft-id="7598807837867737114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JS-告别页面卡死：深度解析 Web Worker 多线程"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-25T12:30:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JS-告别页面卡死：深度解析 Web Worker 多线程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:30:39.000Z" title="Sun Jan 25 2026 12:30:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>由于 JavaScript 是单线程执行的，在处理大量计算任务（如大文件 Hash 计算、图像处理）时，往往会导致 UI 渲染掉帧甚至页面假死。<strong>Web Worker</strong> 的出现为 JS 带来了多线程能力，让我们可以将耗时任务丢到后台执行。</p>
<h2 data-id="heading-1">一、 什么是 Web Worker？</h2>
<p><strong>Web Worker</strong> 是 HTML5 标准的一部分，它允许在浏览器后台运行 JavaScript。</p>
<ul>
<li><strong>主线程</strong>：负责 UI 渲染、用户交互、执行常规 JS。</li>
<li><strong>Worker 线程</strong>：在后台运行，与主线程并行不悖。</li>
</ul>
<hr/>
<h2 data-id="heading-2">二、 核心用法与 API</h2>
<h3 data-id="heading-3">1. 快速上手</h3>
<p>Web Worker 的通信是基于“消息发布/订阅”模式的。</p>
<ol>
<li>通过 <code>new worker(worker文件)</code>创建worker进程</li>
<li>设置<code>onmessage()</code>事件监听接受到的消息（错误了就会触发<code>onerror</code> 事件）</li>
<li>使用<code>postMessage()</code>向worker线程发送数据</li>
<li>使用<code>terminate()</code>关掉Web Worker、并释放浏览器资源</li>
</ol>
<p><strong>主线程 (Main Thread)：</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 1. 创建 Worker 实例，加载脚本文件</span>
<span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">'./worker.js'</span>);

<span class="hljs-comment">// 2. 向 Worker 发送数据</span>
worker.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'start'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">10000</span> });

<span class="hljs-comment">// 3. 监听 Worker 返回的结果</span>
worker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'收到后台计算结果:'</span>, e.<span class="hljs-property">data</span>);
};

<span class="hljs-comment">// 4. 异常处理</span>
worker.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Worker 报错:'</span>, err.<span class="hljs-property">message</span>);
};

<span class="hljs-comment">// 5. 任务完成，主动关闭（节省内存）</span>
<span class="hljs-comment">// worker.terminate(); </span>
</code></pre>
<p><strong>Worker 线程 (worker.js)：</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// self 代表子线程自身</span>
self.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { type, value } = e.<span class="hljs-property">data</span>;
    
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'start'</span>) {
        <span class="hljs-comment">// 执行高能耗计算</span>
        <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; value; i++) { result += i; }
        
        <span class="hljs-comment">// 将结果发回主线程</span>
        self.<span class="hljs-title function_">postMessage</span>(result);
    }
};

<span class="hljs-comment">// 也可以在子线程内部关闭自己</span>
<span class="hljs-comment">// self.close(); </span>
</code></pre>
<hr/>
<h2 data-id="heading-4">三、 使用 Web Worker 的“五大禁令”</h2>
<p>由于 Worker 运行在独立的环境中，它受到以下严格限制：</p>
<ol>
<li><strong>同源限制</strong>：子线程脚本文件必须与主线程代码<strong>同源</strong>。</li>
<li><strong>DOM 限制</strong>：无法操作 DOM（没有 <code>document</code>, <code>window</code>, <code>parent</code> 对象）。</li>
<li><strong>文件限制</strong>：无法直接读取本地文件（<code>file://</code> 协议），只能加载网络脚本。</li>
<li><strong>通信限制</strong>：主线程与子线程之间不在同一个上下文，必须通过 <code>postMessage</code> 传值，不能共享内存（除非使用 <code>SharedArrayBuffer</code>）。</li>
<li><strong>脚本限制</strong>：无法调用 <code>alert()</code> 或 <code>confirm()</code>，但可以使用 <code>XMLHttpRequest</code> 和 <code>fetch</code>。</li>
</ol>
<hr/>
<h2 data-id="heading-5">四、 进阶：性能优化的利器</h2>
<h3 data-id="heading-6">1. 大文件切片与 Hash 计算</h3>
<p>在上传几 GB 的大文件时，我们需要计算文件 MD5 值来做“秒传”判断。在主线程执行这个计算会直接卡死页面。</p>
<ul>
<li><strong>方案</strong>：将文件 File 对象传给 Worker，在后台使用 <code>FileReaderSync</code>（同步读取，仅限 Worker 使用）进行分片 Hash 计算。</li>
</ul>
<hr/>
<h2 data-id="heading-7">五、 总结：什么时候该用 Web Worker？</h2>
<ul>
<li><strong>数据加密/解密</strong>：如大型字符串的 MD5/SHA 计算。</li>
<li><strong>复杂图像/视频处理</strong>：如 Canvas 的像素级滤镜计算。</li>
<li><strong>解析超大 JSON</strong>：当后端接口返回数十万条数据时。</li>
<li><strong>流媒体处理</strong>：音视频解码。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的2025：TRAE帮我圆梦开发的VibeCoding时光]]></title>    <link>https://juejin.cn/post/7598587406708064297</link>    <guid>https://juejin.cn/post/7598587406708064297</guid>    <pubDate>2026-01-25T12:45:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598587406708064297" data-draft-id="7598744870995427371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的2025：TRAE帮我圆梦开发的VibeCoding时光"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-25T12:45:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鼓掌MVP"/> <meta itemprop="url" content="https://juejin.cn/user/3009786736020724"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的2025：TRAE帮我圆梦开发的VibeCoding时光
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3009786736020724/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鼓掌MVP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:45:30.000Z" title="Sun Jan 25 2026 12:45:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读31分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65e3d64677984768b6983c87bc2fc3a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=GC3RCvLXe%2F5GZj9Uc4qSBubitag%3D" alt="image.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/112c25d09b494a1d9a2a002a37c676ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=1hO7T8fIXtwmC3vl455adaGRYJc%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p>2025年，对我而言是充满技术探索与创意实践的一年。这一年，我与TRAE相遇，它像一把钥匙，为我打开了创意与技术融合的大门。</p>
<p>从旅游札记到游戏开发，从生活助手到社交管理，TRAE与MCP的组合以其强大的AI辅助编程和服务整合能力，让我这个前端开发者能够轻松将创意变为现实。现在，就让我回顾这段与TRAE和MCP相伴的精彩时光。</p>
<h2 data-id="heading-1">一、TRAE赋能的创意项目</h2>
<h3 data-id="heading-2">1. AI驱动的旅游札记生成器：MCP能力的完美展示</h3>
<p>作为一个热爱旅行的人，我一直困扰于旅行后整理照片和撰写游记的繁琐。2025年，我利用TRAE Builder+MCP服务开发了一个AI驱动的旅游札记生成器，彻底解决了这个问题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd7bd65cfb6d46248a8e96d2dab1caf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=uXGl4adc%2FGswzx9UYHQ3c06PIVY%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fa3f24946744cf6b2c7dc349c08300e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=c3i4BMKwg%2B9rN%2BQuVKWXiwkZYps%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>这个应用的神奇之处在于：只需输入旅行的基本信息和照片，它就能自动分析照片内容，结合地理位置信息，生成风格多样、内容丰富的旅行札记。更令人惊喜的是，它还支持Markdown、HTML、PDF等多种格式导出，让我的旅行记忆能够以各种形式保存和分享。</p>
<p>MCP服务在这里发挥了核心作用：</p>
<ul>
<li><strong>图像分析MCP</strong>：像一位专业的视觉解读师，智能识别照片中的场景、物体、人物和氛围，甚至能捕捉到照片中的情感色彩，为游记增添生动的描述。</li>
<li><strong>高德地图MCP</strong>：将普通地址精准转换为经纬度坐标，不仅能在地图上标记旅行足迹，还能智能搜索周边的隐藏景点和特色美食，为旅行故事增添惊喜元素。</li>
<li><strong>文本生成MCP</strong>：结合所有分析结果，生成风格各异的旅行故事，从文艺小清新到深度旅行感悟，满足不同场景的表达需求。</li>
</ul>
<p>通过这些MCP服务的无缝整合，最终生成的旅行故事个性化十足，细节丰富，情感真挚，比我自己写的还要精彩。这让我深刻体会到，MCP不仅是技术工具，更是创意的放大器。</p>
<h3 data-id="heading-3">2. 基于MCP与Trae框架的"人情账本"系统：智能社交管理的新范式</h3>
<p>中国人的社交往来中，"人情"是一个重要的组成部分。但随着时间推移，事务繁杂，很难记得清这些往来账。为此，我利用TRAE的Vibe Coding开发能力，结合MCP技术，开发了一个"人情账本"系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61cbd800f1584a55911082a739261a68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=5ZsNzU5%2FsgybGF5cXrLsx7qZSEs%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7790eafa19114ae2b2e384dc3211e9f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=%2BNA%2FQrET7GDw5WxhyYcgTFbzQ8I%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>这个系统的核心特点是支持自然语言管理人际往来，让用户能够轻松记录和查询社交账目。无论是收到的红包，还是需要随份子的庆典，都能通过简单的语言描述快速记录，从此人际往来不再头疼。</p>
<p>MCP技术在这里的应用让系统更加智能：</p>
<ul>
<li><strong>自然语言处理MCP</strong>：理解用户的自然语言输入，自动提取关键信息（如人物、金额、事件类型、日期等），将非结构化的语言描述转化为结构化的数据记录。</li>
<li><strong>数据存储与分析MCP</strong>：安全存储用户的社交往来数据，并提供智能分析功能，如往来频次统计、金额分析、关系网络图等，帮助用户更好地理解自己的社交网络。</li>
<li><strong>提醒服务MCP</strong>：根据历史数据和时间节点，智能提醒用户重要的社交事件，如朋友的生日、纪念日等，避免因疏忽而错过重要的社交场合。</li>
</ul>
<p>通过这些MCP服务的整合，"人情账本"系统不仅解决了实际问题，还为用户提供了全新的社交管理体验。这让我意识到，MCP的价值在于它能够将复杂的技术能力封装为简单易用的服务，让开发者能够专注于解决用户问题。</p>
<h3 data-id="heading-4">3. 智能睡眠助手Agent：MCP驱动的健康管理</h3>
<p>由于工作压力，我曾经常遭受失眠的困扰，早上醒来总是头疼不已。意识到这个问题后，我想到了用TRAE的AI智能体功能结合MCP服务开发一个睡眠助手。</p>
<p>虽然最初只是抱着尝试的心态，但TRAE与MCP的组合让我惊喜不已。通过与睡眠助手的交流，它能够分析我的睡眠习惯，提供个性化的睡眠建议，甚至通过放松音乐和冥想指导帮助我改善睡眠质量。这个小小的工具，成为了我2025年最贴心的健康伙伴。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7d168f4391f4266b4cc454c16055dbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=IkpsJynwo89yBJnmb3E7B9kPkc8%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>MCP服务在这里的应用让睡眠助手更加智能和实用：</p>
<ul>
<li><strong>语音交互MCP</strong>：提供自然流畅的语音对话能力，让我能够在睡前放松状态下与助手交流，无需动手操作。</li>
<li><strong>数据分析MCP</strong>：记录和分析我的睡眠数据，包括入睡时间、睡眠时长、睡眠质量等，生成详细的睡眠报告，帮助我了解自己的睡眠状况。</li>
<li><strong>内容生成MCP</strong>：根据我的偏好和当前状态，生成个性化的放松音乐和冥想指导，帮助我更快进入睡眠状态。</li>
<li><strong>健康建议MCP</strong>：结合睡眠数据和个人情况，提供科学的睡眠建议，如调整作息时间、改善睡眠环境等，帮助我建立健康的睡眠习惯。</li>
</ul>
<p>通过这些MCP服务的整合，智能睡眠助手不仅是一个简单的应用，更是一个个性化的健康管理专家。这让我认识到，MCP技术在健康领域有着巨大的应用潜力，能够为人们的生活带来实质性的改善。</p>
<h3 data-id="heading-5">4. 碰碰车吃豆大战游戏：MCP增强的游戏体验</h3>
<p>游戏开发一直是我的兴趣所在，但传统的游戏开发流程复杂且耗时。2025年，我利用Trae对话式编程，结合HTML5 Canvas技术和MCP服务，开发了一款碰碰车吃豆大战游戏。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8b9e7aa4bd848b68f8b69fbe9d738df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=PkG1BOkh3jbQDftpcDL4w8gnjg4%3D" alt="pp.gif" loading="lazy"/></p>
<p>这是一款休闲竞技游戏，玩家控制一辆碰碰车与其他AI对手在地图上争夺资源。游戏实现了爽快的物理碰撞体验、智能的AI对手行为、随机生成的奖励系统和实时计分排行榜。整个开发过程中，TRAE的代码生成和优化能力让我能够在短时间内实现复杂的游戏逻辑和AI行为，而MCP服务则为游戏增添了更多精彩特性。</p>
<p>MCP服务在这里的应用让游戏更加丰富和智能：</p>
<ul>
<li><strong>AI行为MCP</strong>：为游戏中的AI对手提供智能决策能力，使它们能够评估地图上的资源价值，选择最优目标，甚至能够学习玩家的游戏风格并调整策略。</li>
<li><strong>音效MCP</strong>：根据游戏场景和玩家操作，生成动态的音效和背景音乐，增强游戏的沉浸感和趣味性。</li>
<li><strong>数据分析MCP</strong>：记录玩家的游戏数据，如游戏时长、得分、常用策略等，生成个人游戏报告，帮助玩家了解自己的游戏风格和改进方向。</li>
<li><strong>社交分享MCP</strong>：提供便捷的游戏成绩分享功能，让玩家能够轻松将自己的精彩表现分享到社交平台，增加游戏的社交属性。</li>
</ul>
<p>通过这些MCP服务的整合，碰碰车吃豆大战游戏不仅具有出色的游戏体验，还具备了智能和社交特性。这让我意识到，MCP技术能够为游戏开发带来全新的可能性，让游戏更加智能、个性化和社交化。</p>
<h3 data-id="heading-6">5. "猫鼠大作战"小游戏：MCP助力的快速开发</h3>
<p>作为一名前端开发者，我一直希望能够快速实现自己的游戏创意。2025年，我尝试了豆包AI+Trae IDE+MCP的组合，仅用一句话就开发了"猫鼠大作战"网页小游戏。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7501824bf044355a77d8a047a5ea960~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=fofUbk7PLiAk6rXrwsC61xcTEf4%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>整个开发过程始于一个简单的需求描述："帮我开发一个猫捉老鼠的网页小游戏"。豆包AI通过智能分析和代码生成，快速实现了游戏的基本框架，而MCP服务则为游戏增添了更多智能特性。最终的游戏包含了键盘和触摸控制、动态难度系统、智能的老鼠AI和响应式设计，能够在不同设备上提供良好的游戏体验。</p>
<p>MCP服务在这里的应用让游戏开发更加高效和智能：</p>
<ul>
<li><strong>游戏逻辑MCP</strong>：提供预设的游戏逻辑模块，如碰撞检测、AI行为、计分系统等，大大减少了手动编写代码的工作量。</li>
<li><strong>多设备适配MCP</strong>：自动生成适配不同设备的代码，确保游戏在PC、平板和手机上都能提供良好的体验，无需手动编写复杂的响应式代码。</li>
<li><strong>性能优化MCP</strong>：根据游戏的具体情况，自动优化代码结构和资源加载策略，确保游戏在各种设备上都能流畅运行。</li>
<li><strong>用户体验MCP</strong>：提供游戏教程、难度调整、成就系统等通用游戏功能模块，让游戏更加完整和专业。</li>
</ul>
<p>通过这些MCP服务的整合，"猫鼠大作战"小游戏的开发时间大大缩短，而游戏质量却得到了保证。这让我深刻体会到，MCP技术是快速原型开发和创意验证的强大工具，能够让开发者在短时间内将创意变为现实。</p>
<h2 data-id="heading-7">二、TRAE的2025年更新变迁</h2>
<p>2025年是TRAE快速发展的一年，在这一年里，TRAE推出了多项重要更新，不断提升开发者体验和能力。这些更新不仅丰富了TRAE的功能，也为VibeCoding的实践提供了更加强大的支持。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/401244d4976848f693805c2cd1d1aada~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=G6zrm7MC6eaS8fS6vXYrxZsPhyg%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>作为一个受益匪浅的开发者，感谢TRAE的陪伴，也感谢无数工作人员背后默默的付出！</p>
<h3 data-id="heading-8">2.1 TRAE插件系统的推出</h3>
<p>年初，TRAE正式推出了插件系统，为开发者提供了扩展TRAE功能的全新方式。插件系统的核心价值在于：</p>
<ul>
<li><strong>功能扩展</strong>：开发者可以通过安装和开发插件，为TRAE添加新的功能和能力，如特定领域的代码生成、自定义MCP服务集成等。</li>
<li><strong>个性化定制</strong>：每个开发者都可以根据自己的工作流程和偏好，定制TRAE的界面和功能，打造专属的开发环境。</li>
<li><strong>社区生态</strong>：插件系统催生了活跃的开发者社区，开发者可以分享自己开发的插件，也可以从社区获取他人开发的优质插件，共同丰富TRAE的功能生态。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adbb33f0b0064e9e8b4005cb9264d3a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=qgtn45wYpqLzXkTFdMMq6JXU%2FLQ%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>作为前端开发者，我还特别喜欢前端相关的插件，如React组件生成插件、Tailwind CSS智能提示插件等，这些插件大大提高了我的开发效率。</p>
<h3 data-id="heading-9">2.2 TRAE Builder的全面升级</h3>
<p>年中，TRAE Builder迎来了重大升级，从一个简单的项目生成工具进化为功能强大的可视化开发平台：</p>
<ul>
<li><strong>可视化界面设计</strong>：新增了拖拽式界面设计器，开发者可以通过可视化操作创建和编辑UI界面，无需手动编写HTML和CSS代码。</li>
<li><strong>流程编排能力</strong>：提供了直观的流程编排工具，开发者可以通过拖拽和连接不同的节点，构建复杂的业务逻辑和工作流程。</li>
<li><strong>MCP服务可视化配置</strong>：支持通过可视化界面配置和管理MCP服务，大大降低了MCP服务的使用门槛。</li>
<li><strong>多平台发布</strong>：内置了多平台发布功能，开发者可以一键将应用发布到Web、移动端、桌面端等多个平台，无需为不同平台单独开发。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32607827bc984b00a36daad4a8161028~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=jJu9%2FKOHU60gVXruo44crp%2Bbeic%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>TRAE Builder的升级，让我能够更加高效地构建完整的应用，从界面设计到功能实现，都可以在一个统一的平台上完成，大大简化了开发流程。</p>
<h3 data-id="heading-10">2.3 SOLO模式的创新</h3>
<p>下半年，TRAE推出了全新的SOLO模式，为个人开发者提供了更加专注和高效的开发环境：</p>
<ul>
<li><strong>沉浸式开发体验</strong>：SOLO模式提供了极简的界面设计，移除了所有不必要的干扰元素，让开发者能够完全专注于代码和创意。</li>
<li><strong>智能上下文感知</strong>：系统能够智能感知开发者的工作上下文，自动提供相关的代码建议、文档和工具，减少了开发者的认知负担。</li>
<li><strong>离线工作能力</strong>：SOLO模式支持完全离线工作，开发者可以在没有网络连接的情况下继续开发，确保了开发工作的连续性。</li>
<li><strong>个人知识管理</strong>：内置了个人知识管理系统，自动记录和组织开发者的代码片段、解决方案和开发经验，形成个人的开发知识库。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f43a0b8fe61846eb8768fd05b0d263b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=uapHWN2PV%2FL81ydmDD1W0QG5Dlg%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>这时我苦苦排队等了很久，心心念念的SOLO模式，终于用上了！还是免费的！</p>
<p>SOLO模式的推出，让我在开发过程中能够更加专注和高效，特别是在处理复杂的问题时，沉浸式的开发环境帮助我更好地集中注意力，找到最佳的解决方案。</p>
<h3 data-id="heading-11">2.4 其他重要更新</h3>
<p>除了上述重大更新外，TRAE在2025年还推出了多项其他重要更新：</p>
<ul>
<li><strong>AI能力增强</strong>：不断提升TRAE的AI理解和生成能力，支持更加复杂和抽象的需求描述，生成更加准确和高质量的代码。</li>
<li><strong>性能优化</strong>：持续优化TRAE的运行性能，减少响应时间，提高代码生成速度，确保流畅的开发体验。</li>
<li><strong>多语言支持</strong>：增加了对更多编程语言和框架的支持，扩大了TRAE的适用范围。</li>
<li><strong>安全性提升</strong>：加强了代码和数据的安全性，确保开发者的知识产权和敏感信息得到充分保护。</li>
</ul>
<p>这些更新，让TRAE在2025年实现了从工具到平台的跨越，成为了一个功能完整、生态丰富的AI辅助开发平台。作为一名前端开发者，我深刻感受到了这些更新带来的便利和效率提升，它们不仅改变了我的开发方式，也让我对编程的未来充满了期待。</p>
<h2 data-id="heading-12">三、TRAE带来的技术体验与收获</h2>
<h3 data-id="heading-13">1. 降低编程门槛，提高开发效率</h3>
<p>在与TRAE相伴的2025年，我深刻体会到了AI辅助编程如何彻底改变传统的软件开发流程。无论是复杂的旅游札记生成器，还是简单的网页小游戏，TRAE都能通过对话式编程和智能代码生成，帮助我快速实现创意。</p>
<p>这种开发方式不仅大大降低了编程门槛，让编程经验有限的我也能开发出专业级别的应用，也极大提高了开发效率，让我能够将更多精力放在创意设计和用户体验上。</p>
<h3 data-id="heading-14">2. 模块化设计与技术整合：MCP的核心价值</h3>
<p>TRAE的开发环境鼓励模块化设计，让我能够将复杂的项目分解为多个独立但相互协作的组件。这种设计方式不仅使代码结构清晰，也便于后续维护和扩展。</p>
<p>而MCP（Module Connect Platform）则是技术整合的最佳实践，它像一个智能的连接器，让不同的技术服务能够无缝协作：</p>
<ul>
<li><strong>服务封装</strong>：MCP将复杂的技术能力封装为简单易用的服务接口，开发者无需了解底层实现细节，只需关注如何使用这些服务来解决问题。</li>
<li><strong>标准化接口</strong>：MCP提供标准化的服务接口，使不同的服务能够按照统一的方式进行调用和集成，大大降低了技术整合的复杂度。</li>
<li><strong>服务编排</strong>：MCP支持服务之间的智能编排，使多个服务能够协同工作，形成更强大的复合功能。例如，在旅游札记生成器中，图像分析MCP、地图MCP和文本生成MCP的协同工作，产生了1+1+1&gt;3的效果。</li>
<li><strong>可扩展性</strong>：MCP的模块化架构使得系统具有高度的可扩展性，开发者可以根据需要轻松添加新的服务或替换现有的服务，而不会影响整个系统的稳定性。</li>
</ul>
<p>通过TRAE与MCP的结合，我能够轻松整合各种第三方服务，如图像分析、地图服务、语音识别等，为应用添加丰富的功能。这种技术整合能力，让我的项目能够站在巨人的肩膀上，实现更多可能性。</p>
<p>作为前端开发者，我尤其欣赏MCP在前端技术整合方面的能力。它不仅能够整合后端服务，还能够整合各种前端库和框架，如React、Vue、Three.js等，让前端开发更加高效和灵活。</p>
<h3 data-id="heading-15">3. 从创意到现实的快速转化：MCP的加速作用</h3>
<p>2025年，我最深的感受是：有了TRAE和MCP，创意到现实的距离变得前所未有的近。无论是突发奇想的小游戏，还是解决实际问题的工具应用，我都能通过TRAE和MCP快速将其变为现实。</p>
<p>MCP在创意转化过程中发挥了关键的加速作用：</p>
<ul>
<li><strong>快速原型</strong>：通过调用现有的MCP服务，我可以在短时间内搭建出功能完整的原型，验证创意的可行性，而不需要从零开始编写所有代码。</li>
<li><strong>功能丰富</strong>：MCP提供了丰富的服务库，涵盖了从图像处理、自然语言处理到数据分析、社交分享等各种功能，让我能够为应用添加更多高级特性，提升用户体验。</li>
<li><strong>技术兜底</strong>：MCP服务由专业团队维护和更新，确保了服务的稳定性和安全性，让我能够专注于创意设计，而不需要担心技术实现的细节和风险。</li>
<li><strong>迭代迅速</strong>：当创意需要调整时，我可以通过修改MCP服务的配置或替换不同的MCP服务，快速实现功能的变更和优化，大大缩短了迭代周期。</li>
</ul>
<p>这种快速转化的能力，让我更加勇于尝试新的创意，也让我的2025年充满了惊喜和成就感。正如那句"人人都是VibeMaker"所说，TRAE和MCP让每个人都有机会成为创意的实现者。</p>
<p>作为前端开发者，我发现MCP在前端创意转化方面尤其有价值。它不仅能够加速前端界面的开发，还能够轻松整合后端服务，让我能够独立完成从前端到后端的完整应用开发，真正实现"一个人就是一个团队"的开发效率。</p>
<h3 data-id="heading-16">4. VibeCoding：重新定义编程体验</h3>
<p>在使用TRAE和MCP的过程中，我逐渐领悟到VibeCoding的真正含义。它不仅仅是一种编程方式，更是一种全新的创意表达形式，而MCP则是VibeCoding的重要技术支撑。</p>
<p>VibeCoding的核心在于"对话式编程"，它打破了传统编程中人与机器之间的壁垒。通过自然语言交流，我可以直接向TRAE表达我的创意和需求，而不需要担心语法错误或复杂的代码结构。这种交流方式更加符合人类的思维习惯，让编程变得更加直观和愉悦。</p>
<p>而MCP则为VibeCoding提供了强大的技术后盾：</p>
<ul>
<li><strong>能力扩展</strong>：MCP为VibeCoding提供了丰富的技术能力，让开发者能够通过对话式编程调用各种高级服务，如图像处理、自然语言处理、数据分析等，大大扩展了VibeCoding的应用范围。</li>
<li><strong>复杂度管理</strong>：MCP将复杂的技术实现封装为简单的服务接口，让开发者能够通过自然语言命令轻松使用这些服务，而不需要了解底层实现的复杂度，进一步降低了编程的门槛。</li>
<li><strong>创意聚焦</strong>：MCP让开发者能够专注于问题的本质和解决方案的创意，而不是陷入繁琐的代码细节中。当我开发旅游札记生成器时，我可以专注于如何让AI更好地理解照片内容和旅行故事，而不是纠结于图像处理的具体算法；当我开发游戏时，我可以专注于游戏机制和用户体验，而不是担心碰撞检测的实现细节。</li>
</ul>
<p>这种思维方式的转变，让我对编程有了全新的认识。编程不再是一种技术门槛，而是一种创意表达的工具。每个人都可以通过VibeCoding和MCP，将自己的创意变为现实，成为数字世界的建设者。</p>
<p>作为前端开发者，我发现VibeCoding和MCP的结合在前端开发中尤其有价值。它不仅能够加速前端界面的开发，还能够轻松整合各种后端服务，让前端开发者能够独立完成更加复杂和功能丰富的应用，真正实现"创意驱动开发"的理念。</p>
<h3 data-id="heading-17">5. TRAE与MCP对前端开发者的特别帮助</h3>
<p>作为一名前端开发者，我发现TRAE与MCP的组合在前端开发领域尤其具有革命性的意义。它们不仅解决了前端开发中的许多痛点，也为前端开发者打开了新的可能性。</p>
<h4 data-id="heading-18">5.1 前端框架与库的智能应用</h4>
<p>TRAE对主流前端框架（如React、Vue、Angular等）和库（如Tailwind CSS、Three.js等）有深入的理解。通过简单的对话，我可以快速生成符合最佳实践的组件代码，而不需要手动编写繁琐的模板和配置。</p>
<p>而MCP则为前端框架提供了强大的扩展能力：</p>
<ul>
<li><strong>组件库MCP</strong>：提供丰富的预设组件库，涵盖了从基础UI组件到复杂交互组件的各种类型，让前端开发更加高效。</li>
<li><strong>框架适配MCP</strong>：自动生成适配不同前端框架的代码，让我能够根据项目需求灵活选择合适的框架，而不需要学习多种框架的语法。</li>
</ul>
<p>例如，当我需要创建一个响应式导航栏时，只需告诉TRAE我的需求，它就能生成包含适当的HTML结构、CSS样式和JavaScript交互的完整代码，甚至会自动处理移动端适配和动画效果。</p>
<h4 data-id="heading-19">5.2 响应式设计与移动适配</h4>
<p>响应式设计是现代前端开发的核心要求之一，但手动编写媒体查询和处理各种设备尺寸的适配往往耗时且容易出错。TRAE能够智能分析设计需求，自动生成适配各种屏幕尺寸的响应式代码，确保应用在不同设备上都能提供良好的用户体验。</p>
<p>MCP在响应式设计中发挥了重要作用：</p>
<ul>
<li><strong>设备检测MCP</strong>：智能检测用户设备的类型和尺寸，提供针对性的界面适配方案。</li>
<li><strong>布局优化MCP</strong>：根据不同设备的屏幕尺寸，自动调整布局结构和元素大小，确保最佳的视觉效果。</li>
<li><strong>交互适配MCP</strong>：根据设备类型（如触摸设备 vs 鼠标设备），自动调整交互方式，提供符合设备特性的用户体验。</li>
</ul>
<h4 data-id="heading-20">5.3 UI组件开发与样式管理</h4>
<p>TRAE可以帮助前端开发者快速创建和管理UI组件库。通过对话式编程，我可以描述组件的外观和行为，TRAE会生成符合设计规范的组件代码，并自动处理样式隔离和主题管理。</p>
<p>MCP在UI组件开发中提供了强大的支持：</p>
<ul>
<li><strong>设计系统MCP</strong>：提供完整的设计系统支持，包括颜色、字体、间距等设计规范，确保整个应用的视觉风格统一。</li>
<li><strong>样式管理MCP</strong>：提供现代化的样式管理方案，如CSS-in-JS、CSS Modules等，解决样式冲突和命名空间问题。</li>
<li><strong>主题切换MCP</strong>：支持动态主题切换，让应用能够根据用户偏好或系统设置自动调整主题，提升用户体验。</li>
</ul>
<h4 data-id="heading-21">5.4 性能优化</h4>
<p>前端性能优化是一个复杂且持续的过程，涉及代码分割、懒加载、缓存策略等多个方面。TRAE能够分析项目结构，识别性能瓶颈，并提供针对性的优化建议和代码实现，帮助前端开发者构建更加高效的应用。</p>
<p>MCP在前端性能优化中发挥了关键作用：</p>
<ul>
<li><strong>代码分析MCP</strong>：智能分析前端代码，识别性能瓶颈和优化机会。</li>
<li><strong>资源优化MCP</strong>：自动优化图片、字体、脚本等资源的加载策略，减少页面加载时间。</li>
<li><strong>渲染优化MCP</strong>：提供虚拟列表、无限滚动等高级渲染技术，提升复杂页面的渲染性能。</li>
<li><strong>缓存策略MCP</strong>：根据应用的具体情况，自动生成最佳的缓存策略，减少重复请求和数据传输。</li>
</ul>
<h4 data-id="heading-22">5.5 API集成与数据处理</h4>
<p>前端开发中经常需要与后端API进行交互，处理数据获取、状态管理和错误处理等问题。TRAE可以帮助开发者快速生成API调用代码，实现数据的高效处理和状态管理，减少了手动编写重复代码的工作量。</p>
<p>MCP在API集成中提供了强大的能力：</p>
<ul>
<li><strong>API客户端MCP</strong>：自动生成符合RESTful或GraphQL规范的API客户端代码，简化API调用过程。</li>
<li><strong>状态管理MCP</strong>：提供现代化的状态管理方案，如Redux、Vuex、MobX等，帮助前端开发者高效管理应用状态。</li>
<li><strong>数据转换MCP</strong>：自动处理前后端数据格式的转换，解决数据结构不匹配的问题。</li>
<li><strong>错误处理MCP</strong>：提供统一的错误处理机制，确保API调用失败时能够优雅地处理错误，提升用户体验。</li>
</ul>
<h4 data-id="heading-23">5.6 前端测试</h4>
<p>测试是确保前端应用质量的重要环节，但编写测试代码往往繁琐且耗时。TRAE能够根据组件和功能自动生成测试代码，覆盖常见的测试场景，帮助前端开发者提高代码质量和可靠性。</p>
<p>MCP在前端测试中提供了全面的支持：</p>
<ul>
<li><strong>测试框架MCP</strong>：支持多种前端测试框架，如Jest、Mocha、Cypress等，满足不同类型的测试需求。</li>
<li><strong>测试用例MCP</strong>：根据组件和功能的特性，自动生成针对性的测试用例，确保测试覆盖全面。</li>
<li><strong>测试报告MCP</strong>：生成详细的测试报告，帮助开发者了解测试结果和代码质量状况。</li>
<li><strong>CI/CD集成MCP</strong>：提供与持续集成/持续部署系统的集成，实现自动化测试和部署，确保代码质量和开发效率。</li>
</ul>
<h2 data-id="heading-24">四、对未来的展望</h2>
<p>回顾2025年与TRAE和MCP相伴的时光，我充满感激。TRAE和MCP不仅是开发工具，更是我实现创意的伙伴。通过它们，我不仅开发了多个有趣实用的项目，也提升了自己的编程能力和创意表达能力。</p>
<h3 data-id="heading-25">VibeCoding与MCP的未来发展</h3>
<p>展望未来，我相信VibeCoding将会成为主流的编程方式，而MCP则会成为技术整合的标准实践，两者的结合将彻底改变软件开发的格局。</p>
<p>我期待TRAE和MCP能够在以下几个方面继续进化：</p>
<ol>
<li><strong>更深入的行业解决方案</strong>：针对不同行业的特定需求，提供更加专业的MCP服务和开发模板，如教育、医疗、金融等领域的专用解决方案。这些解决方案将整合行业特定的技术能力，为开发者提供一站式的行业应用开发工具。</li>
<li><strong>更强的协作能力</strong>：支持多人实时协作开发，让团队成员能够通过对话式编程共同完成项目，提高团队协作效率。MCP将作为团队协作的技术基础，确保不同开发者的代码和服务能够无缝集成。</li>
<li><strong>更丰富的创意表达形式</strong>：除了文字和代码，还能支持语音、图像、视频等多种形式的创意输入，让开发者能够更加自由地表达自己的想法。MCP将提供相应的服务，处理这些不同形式的创意输入，并转化为可执行的代码。</li>
<li><strong>更智能的代码优化</strong>：能够根据项目的具体情况，自动优化代码结构和性能，提供更加专业和高效的解决方案。MCP将整合先进的代码分析和优化技术，为不同类型的应用提供定制化的优化方案。</li>
<li><strong>更广泛的生态系统</strong>：MCP将构建更加开放和丰富的服务生态系统，吸引更多的服务提供商加入，为开发者提供更加多样化的技术选择。同时，MCP将提供标准化的服务接口和开发工具，降低服务集成的门槛，促进生态系统的健康发展。</li>
<li><strong>更强大的前端能力</strong>：针对前端开发的特点，提供更加专业和强大的MCP服务，如WebAssembly优化、PWA增强、WebXR支持等，帮助前端开发者构建更加先进和丰富的Web应用。</li>
</ol>
<h3 data-id="heading-26">个人的未来规划</h3>
<p>作为一名前端开发者和VibeCoder，我计划在未来继续深入探索TRAE和MCP的潜力，开发更多有意义的前端项目：</p>
<ol>
<li><strong>扩展旅游札记生成器</strong>：增加更多的风格选项和导出格式，支持视频游记的生成，让旅行记忆的保存和分享更加丰富多样。作为前端开发者，我将重点优化用户界面和交互体验，采用现代前端框架构建响应式布局，确保在各种设备上都能提供出色的用户体验。同时，我将探索整合更多MCP服务，如视频处理MCP、社交媒体分享MCP等，为应用添加更多高级特性。</li>
<li><strong>开发教育辅助工具</strong>：利用AI技术和MCP服务，开发能够根据学生特点和学习进度，自动生成个性化学习计划和辅导内容的教育工具。在前端实现上，我将采用组件化开发方式，构建可复用的教育组件库，支持多种学习场景和交互模式。同时，我将整合教育内容MCP、学习分析MCP等专业服务，提升工具的教育价值。</li>
<li><strong>探索虚拟现实应用</strong>：结合VR技术和MCP服务，开发沉浸式的游戏和应用，为用户带来更加真实和震撼的体验。作为前端开发者，我将利用Three.js等3D库，实现WebVR/AR应用，探索前端技术在虚拟现实领域的应用潜力。同时，我将整合空间计算MCP、虚拟场景MCP等专业服务，提升VR/AR应用的质量和体验。</li>
<li><strong>构建前端组件库</strong>：基于TRAE的VibeCoding能力和MCP服务，开发一套完整的前端组件库，包含常用的UI组件和交互模式，支持主题定制和响应式设计，为前端开发提供更加高效的工具。我将特别关注组件库与MCP服务的集成，让开发者能够通过简单的配置，为组件添加智能特性，如表单验证、数据可视化等。</li>
<li><strong>参与开源项目</strong>：将自己的VibeCoding和MCP使用经验分享给社区，与其他开发者共同推动VibeCoding和MCP的发展。特别是在前端领域，我希望能够贡献更多基于TRAE和MCP的前端开发工具和最佳实践，帮助其他前端开发者提高开发效率。我计划创建一个开源的MCP前端集成库，简化前端开发者使用MCP服务的流程。</li>
<li><strong>探索前端与AI的结合</strong>：利用TRAE的AI能力和MCP服务，探索前端开发与人工智能的深度结合，开发能够根据用户行为和偏好自动调整界面和功能的智能前端应用，为用户提供更加个性化的体验。我将整合用户行为分析MCP、个性化推荐MCP等服务，构建智能前端应用的技术框架。</li>
<li><strong>MCP服务开发</strong>：尝试开发自己的MCP服务，专注于解决前端开发中的特定问题，如高性能动画、智能表单、实时协作等。通过开发MCP服务，我希望能够更深入地理解MCP的技术架构和工作原理，为前端开发社区贡献更多有价值的工具和服务。</li>
</ol>
<p>同时，我也期待看到更多开发者加入VibeCoding的行列，通过TRAE释放创意，共同创造一个更加丰富多彩的数字世界。</p>
<h2 data-id="heading-27">五、结语</h2>
<p>2025年，是我与TRAE和MCP结缘的一年，也是我创意迸发的一年。从旅游札记生成器到游戏开发，从生活助手到社交管理工具，TRAE与MCP的组合陪伴我走过了一段充满惊喜和成就的技术探索之旅。</p>
<h3 data-id="heading-28">我的VibeCoding与MCP之旅</h3>
<p>对我个人而言，2025年的VibeCoding与MCP之旅是一次自我突破和成长的过程。作为一名前端开发者，我不仅开发了多个有趣实用的项目，也发现了自己在创意设计和问题解决方面的潜力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89ed48e5322846d7a023e8481f8ce421~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=spTtsqVWbQfekWyVGvFgAHNEj0Y%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>技术的魅力在于它能够让生活变得更加美好，而TRAE和MCP正是这样一对能够赋能创意、简化开发的神奇组合。TRAE提供了智能的对话式编程环境，让创意表达更加自然和直观；MCP提供了丰富的技术服务，让创意实现更加高效和强大。</p>
<p>我回顾我这一年TRAE的总结报告，获得了“执剑人”评价。倒也十分贴切！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/061e5c889f0d48b186057300cec12ddd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6byT5o6MTVZQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769949930&amp;x-signature=ZsyYX%2BDqLBuPZUUEDHG3g%2BQ%2BZao%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>2025年，与TRAE和MCP的故事已经成为我人生中一段美好的回忆；而未来，更多与TRAE和MCP的精彩故事正在等待着我去书写。</p>
<h3 data-id="heading-29">未来的展望</h3>
<p>我相信，在未来的日子里，TRAE和MCP将继续进化，为开发者带来更加强大和智能的开发体验。VibeCoding将成为主流的编程方式，而MCP将成为技术整合的标准实践，两者的结合将彻底改变软件开发的格局。</p>
<p>作为一名前端开发者，我期待着在VibeCoding和MCP的道路上继续探索，开发更多有意义的项目，为前端开发社区贡献自己的力量。我也期待着与更多志同道合的伙伴相遇，共同探索技术的无限可能，创造一个更加美好的数字未来。</p>
<p>技术的进步永无止境，创意的表达也永无止境。有了TRAE和MCP，我们每个人都可以成为数字世界的建设者，用创意和技术共同创造一个更加丰富多彩的未来。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LeetCode 28. 找出字符串中第一个匹配项的下标：两种实现与深度解析]]></title>    <link>https://juejin.cn/post/7599268297201811494</link>    <guid>https://juejin.cn/post/7599268297201811494</guid>    <pubDate>2026-01-25T12:52:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297201811494" data-draft-id="7598807837867802650" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LeetCode 28. 找出字符串中第一个匹配项的下标：两种实现与深度解析"/> <meta itemprop="keywords" content="前端,TypeScript,算法"/> <meta itemprop="datePublished" content="2026-01-25T12:52:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Wect"/> <meta itemprop="url" content="https://juejin.cn/user/4185164878720068"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LeetCode 28. 找出字符串中第一个匹配项的下标：两种实现与深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4185164878720068/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Wect
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:52:46.000Z" title="Sun Jan 25 2026 12:52:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>在字符串处理领域，“子串匹配”是经典基础问题，LeetCode 28 题就围绕这一核心展开。题目要求在主串 <code>haystack</code> 中找到子串 <code>needle</code> 第一个匹配项的起始下标，若不存在则返回 -1。这道题不仅考察对字符串遍历的基础理解，更能延伸出高效算法的设计思路。本文将详细解析两种实现方案：优化后的暴力匹配法与经典的 KMP 算法，带你从基础到进阶吃透这道题。</p>
<h2 data-id="heading-0">一、题目核心解读</h2>
<h3 data-id="heading-1">1. 题目边界条件</h3>
<ul>
<li>
<p>若 <code>needle</code> 为空字符串，按行业惯例返回 0（虽题目输入可能不包含此情况，但代码需兼容）；</p>
</li>
<li>
<p>若 <code>haystack</code> 长度小于 <code>needle</code>，直接返回 -1（长度不足无法匹配）；</p>
</li>
<li>
<p>匹配需严格连续，返回第一个完全匹配子串的起始下标。</p>
</li>
</ul>
<h3 data-id="heading-2">2. 示例场景</h3>
<ul>
<li>
<p>输入：<code>haystack = "sadbutsad", needle = "sad"</code>，输出：0（子串从下标 0 开始匹配）；</p>
</li>
<li>
<p>输入：<code>haystack = "leetcode", needle = "leeto"</code>，输出：-1（无匹配子串）；</p>
</li>
<li>
<p>输入：<code>haystack = "abcdabcdabcdef", needle = "abcdabcdabcdef"</code>，输出：4（需跨部分匹配后复用前缀）。</p>
</li>
</ul>
<h2 data-id="heading-3">二、实现方案一：优化后的暴力匹配法（单循环版）</h2>
<h3 data-id="heading-4">1. 代码实现</h3>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-keyword">function</span> <span class="hljs-title function_">strStr_1</span>(<span class="hljs-params">haystack: <span class="hljs-built_in">string</span>, needle: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">const</span> hL = haystack.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> nL = needle.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">if</span> (nL === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (hL &lt; nL) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;

  <span class="hljs-keyword">let</span> resIndex = -<span class="hljs-number">1</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; hL; i++) {
    <span class="hljs-keyword">if</span> (resIndex !== -<span class="hljs-number">1</span>) {
      <span class="hljs-comment">// 当前匹配的位置（相对于needle的下标）</span>
      <span class="hljs-keyword">const</span> matchPos = i - resIndex;
      <span class="hljs-comment">// 若已匹配完needle所有字符，提前终止</span>
      <span class="hljs-keyword">if</span> (matchPos &gt;= nL) <span class="hljs-keyword">break</span>;
      <span class="hljs-comment">// 字符不匹配，回退i并重置匹配状态</span>
      <span class="hljs-keyword">if</span> (haystack[i] !== needle[matchPos]) {
        i = resIndex;
        resIndex = -<span class="hljs-number">1</span>;
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 找到匹配起始字符，记录起始下标</span>
      <span class="hljs-keyword">if</span> (haystack[i] === needle[<span class="hljs-number">0</span>]) {
        resIndex = i;
      }
    }
  }
  <span class="hljs-comment">// 最终校验：确保匹配长度足够</span>
  <span class="hljs-keyword">return</span> (resIndex !== -<span class="hljs-number">1</span> &amp;&amp; (hL - resIndex) &gt;= nL) ? resIndex : -<span class="hljs-number">1</span>;
};
</code></pre>
<h3 data-id="heading-5">2. 核心逻辑解析</h3>
<p>该方法试图用单循环完成匹配，核心思路是“记录起始匹配下标，逐字符验证，失败则回退”：</p>
<ul>
<li>
<p><code>resIndex</code>：存储潜在的匹配起始下标，初始为 -1（无潜在匹配）；</p>
</li>
<li>
<p>当 <code>resIndex !== -1</code> 时，说明正处于匹配验证阶段，通过 <code>matchPos = i - resIndex</code> 计算当前验证的是 <code>needle</code> 的第几个字符；</p>
</li>
<li>
<p>若验证失败，将 <code>i</code> 回退到 <code>resIndex</code>（利用 for 循环的<code>i++</code>，实际下一轮从 <code>resIndex + 1</code> 开始，避免重复遍历），同时重置 <code>resIndex</code>；</p>
</li>
<li>
<p>循环结束后，需校验 <code>resIndex</code>对应的子串长度是否足够（避免末尾部分匹配但长度不足的情况）。</p>
</li>
</ul>
<h3 data-id="heading-6">3. 优劣分析</h3>
<p><strong>优点</strong>：空间复杂度 O(1)，无额外空间开销，实现逻辑直观，适合短字符串场景；</p>
<p><strong>缺点</strong>：时间复杂度仍为 O(n*m)（n 为 <code>haystack</code> 长度，m 为 <code>needle</code> 长度），最坏情况下（如主串和子串均为大量重复字符，如 "aaaaa...a"）会有大量重复比较，效率较低。</p>
<h2 data-id="heading-7">三、实现方案二：KMP 算法（高效子串匹配）</h2>
<p>KMP 算法是解决子串匹配问题的经典高效算法，核心优势是通过预处理子串，让主串指针永不回退，将时间复杂度优化至 O(n+m)，适合长字符串或高频匹配场景。</p>
<h3 data-id="heading-8">1. 核心原理铺垫：最长相等前后缀（LPS 数组）</h3>
<p>KMP 算法的核心是利用子串 <code>needle</code> 自身的前后缀规律，构建 <strong>LPS 数组</strong>（最长相等前后缀数组）：</p>
<ul>
<li>
<p>前缀：子串中不包含最后一个字符的所有开头子串（如 "ABCD" 的前缀为 "A"、"AB"、"ABC"）；</p>
</li>
<li>
<p>后缀：子串中不包含第一个字符的所有结尾子串（如 "ABCD" 的后缀为 "D"、"CD"、"BCD"）；</p>
</li>
<li>
<p>最长相等前后缀长度：对于子串的前 k 个字符，前缀和后缀中长度最长且内容完全相同的子串长度（若无则为 0）。</p>
</li>
</ul>
<p>LPS 数组的作用：当匹配失败时，告诉我们<code>needle</code> 的指针应回退到哪个位置，而非从头开始，从而复用已匹配的前缀部分。</p>
<h3 data-id="heading-9">2. 代码实现</h3>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-keyword">function</span> <span class="hljs-title function_">strStr_2</span>(<span class="hljs-params">haystack: <span class="hljs-built_in">string</span>, needle: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">const</span> hLen = haystack.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> nLen = needle.<span class="hljs-property">length</span>;

  <span class="hljs-keyword">if</span> (nLen === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (hLen &lt; nLen) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;

  <span class="hljs-comment">// 构建LPS数组（最长相等前后缀数组）</span>
  <span class="hljs-keyword">const</span> buildLPS = (<span class="hljs-attr">s</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">number</span>[] =&gt; {
    <span class="hljs-keyword">const</span> len = s.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">const</span> lps = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(len).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">let</span> prevLPS = <span class="hljs-number">0</span>; <span class="hljs-comment">// 前一个位置的最长相等前后缀长度</span>
    <span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; <span class="hljs-comment">// 从第二个字符开始遍历（第一个字符LPS必为0）</span>

    <span class="hljs-keyword">while</span> (i &lt; len) {
      <span class="hljs-keyword">if</span> (s[i] === s[prevLPS]) {
        <span class="hljs-comment">// 字符匹配，延长最长相等前后缀长度</span>
        prevLPS++;
        lps[i] = prevLPS;
        i++;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (prevLPS !== <span class="hljs-number">0</span>) {
          <span class="hljs-comment">// 不匹配且prevLPS&gt;0，回退prevLPS（核心复用逻辑）</span>
          prevLPS = lps[prevLPS - <span class="hljs-number">1</span>];
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// prevLPS=0，无匹配前缀，LPS[i]设为0</span>
          lps[i] = <span class="hljs-number">0</span>;
          i++;
        }
      }
    }
    <span class="hljs-keyword">return</span> lps;
  };

  <span class="hljs-keyword">const</span> lps = <span class="hljs-title function_">buildLPS</span>(needle);
  <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; <span class="hljs-comment">// haystack指针（永不回退）</span>
  <span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; <span class="hljs-comment">// needle指针（按LPS回退）</span>

  <span class="hljs-keyword">while</span> (i &lt; hLen) {
    <span class="hljs-keyword">if</span> (haystack[i] === needle[j]) {
      <span class="hljs-comment">// 字符匹配，双指针前进</span>
      i++;
      j++;
      <span class="hljs-comment">// j到达needle末尾，匹配成功，返回起始下标</span>
      <span class="hljs-keyword">if</span> (j === nLen) {
        <span class="hljs-keyword">return</span> i - j;
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (j !== <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 匹配失败，j按LPS回退（复用前缀）</span>
        j = lps[j - <span class="hljs-number">1</span>];
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// j=0，无匹配前缀，仅前进主串指针</span>
        i++;
      }
    }
  }

  <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
};
</code></pre>
<h3 data-id="heading-10">3. 关键步骤拆解</h3>
<h4 data-id="heading-11">（1）LPS 数组构建过程</h4>
<p>以 <code>needle = "abcdabcdabcdef"</code>为例，构建的 LPS 数组为 <code>[0,0,0,0,1,2,3,4,5,6,7,8,0,0]</code>：</p>
<ul>
<li>
<p>下标 4（字符 'a'）：前 4 个字符 "abcd" 的前缀与当前字符匹配，LPS[4] = 1；</p>
</li>
<li>
<p>下标 11（字符 'd'）：前 11 个字符 "abcdabcdabc" 的最长相等前后缀为 "abcdabcd"（长度 8），LPS[11] = 8；</p>
</li>
<li>
<p>下标 12（字符 'e'）：无相等前后缀，LPS[12] = 0。</p>
</li>
</ul>
<h4 data-id="heading-12">（2）核心匹配逻辑</h4>
<p>以示例 <code>haystack = "abcdabcdabcdabcdef", needle = "abcdabcdabcdef"</code> 为例：</p>
<ol>
<li>
<p>初始匹配：i、j 从 0 开始，连续匹配到 i=12、j=12 时，<code>haystack[12] = 'a'</code> 与 <code>needle[12] = 'e'</code> 不匹配；</p>
</li>
<li>
<p>回退操作：j=12≠0，执行 <code>j = lps[11] = 8</code>（复用前 11 个字符的最长前缀 "abcdabcd"）；</p>
</li>
<li>
<p>继续匹配：i=12 与 j=8 匹配（均为 'a'），后续双指针连续前进，直至 j=14（等于 needle 长度 14），返回 <code>i-j = 18-14 = 4</code>，匹配成功。</p>
</li>
</ol>
<h3 data-id="heading-13">4. 优劣分析</h3>
<p><strong>优点</strong>：时间复杂度 O(n+m)，主串和子串仅需遍历一次；主串指针永不回退，避免重复比较，长字符串场景下效率远超暴力匹配；</p>
<p><strong>缺点</strong>：逻辑较复杂，需额外构建 LPS 数组（空间复杂度 O(m)），适合对性能有要求的场景，简单场景下不如暴力匹配直观。</p>
<h2 data-id="heading-14">四、两种方案对比与选型建议</h2>





























<table><thead><tr><th>方案</th><th>时间复杂度</th><th>空间复杂度</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td>优化暴力匹配</td><td>O(n*m)</td><td>O(1)</td><td>实现简单、无额外空间开销</td><td>最坏情况效率低</td><td>短字符串、日常简单业务场景</td></tr><tr><td>KMP 算法</td><td>O(n+m)</td><td>O(m)</td><td>高效、长字符串表现优异</td><td>逻辑复杂、需理解 LPS 数组</td><td>长字符串、高频匹配、性能敏感场景</td></tr></tbody></table>
<h2 data-id="heading-15">五、常见问题与注意事项</h2>
<h3 data-id="heading-16">1. 暴力匹配的回退陷阱</h3>
<p>原暴力匹配若不回退 <code>i</code>，会导致跳过部分字符（如匹配 "hello" 和 "ll" 时可能漏匹配）。优化后通过 <code>i = resIndex</code> 配合 for 循环的 <code>i++</code>，实现正确回退，避免漏判。</p>
<h3 data-id="heading-17">2. KMP 中 j 回退的核心逻辑</h3>
<p>代码中 <code>j = lps[j - 1]</code> 是关键：当 <code>needle[j]</code> 匹配失败时，<code>lps[j-1]</code> 是 <code>needle[0..j-1]</code> 的最长相等前后缀长度，将 j 设为该值，即可复用已匹配的前缀部分，无需从头开始。</p>
<h3 data-id="heading-18">3. 边界条件不可遗漏</h3>
<p>无论哪种方案，都需优先处理 <code>needle</code> 为空、主串长度小于子串的情况，避免后续无效计算或数组越界。</p>
<h2 data-id="heading-19">六、总结</h2>
<p>LeetCode 28 题看似简单，却能串联起基础遍历与高效算法的设计思路。优化后的暴力匹配法适合快速实现与简单场景，而 KMP 算法则展现了“利用数据自身规律优化性能”的核心思想——通过预处理子串的前后缀信息，将时间复杂度从 O(n*m) 降至线性级别。</p>
<p>在实际开发中，若业务场景以短字符串为主，暴力匹配足够高效；若需处理大量长文本匹配（如日志分析、文本检索），KMP 算法是更优选择。掌握这两种方案，不仅能顺利解决本题，更能为复杂字符串处理问题打下基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 原型链机制深度解析：从构造函数到隐式委托]]></title>    <link>https://juejin.cn/post/7598737609494364179</link>    <guid>https://juejin.cn/post/7598737609494364179</guid>    <pubDate>2026-01-25T13:15:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598737609494364179" data-draft-id="7598744870995443755" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" JavaScript 原型链机制深度解析：从构造函数到隐式委托"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-25T13:15:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             JavaScript 原型链机制深度解析：从构造函数到隐式委托
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:15:51.000Z" title="Sun Jan 25 2026 13:15:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 JavaScript 的设计哲学中，<strong>原型（Prototype）</strong>  是其面向对象系统的基石。与 Java 或 C++ 等基于类（Class）的语言不同，JavaScript 并不通过复制“蓝图”来创建对象，而是通过<strong>委托（Delegation）</strong>  机制将对象连接在一起。</p>
<p>本文将基于一系列实战代码，从内存管理的角度出发，深入剖析构造函数、原型对象与实例之间的三角关系，揭示原型链查找的底层逻辑，并探讨继承机制的演变。</p>
<p>这张图先放在这里，现在不懂没关系，待会儿你会划上来的
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdabdf061a8a48f093c0b66322edcefe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTkVYVDA2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769951751&amp;x-signature=xJq7nHWNRBDT5PTdxkhB%2FuA1RHU%3D" alt="屏幕截图 2026-01-25 174707.png" loading="lazy"/></p>
<h2 data-id="heading-0">第一章：起源——构造函数的内存困境</h2>
<p>在 ES5 时代，我们通过构造函数来模拟“类”的概念。构造函数的核心作用是初始化新对象的属性。</p>
<h3 data-id="heading-1">1.1 私有属性与方法的内存开销</h3>
<p>请看以下代码示例</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">function Car(color) {
    // 实例属性：每个对象独享一份内存
    <span class="hljs-attr">this.color</span> = color<span class="hljs-comment">; </span>
    
    // 假设我们将方法直接写在构造函数内部（不推荐）
    // <span class="hljs-attr">this.drive</span> = function() {
    //     console.log('drive, 下赛道')<span class="hljs-comment">;</span>
    // }
}

const <span class="hljs-attr">car1</span> = new Car(<span class="hljs-string">'霞光紫'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">car2</span> = new Car(<span class="hljs-string">'海湾蓝'</span>)<span class="hljs-comment">;</span>
</code></pre>
<p>如果在构造函数内部定义 drive 方法，每次执行 new Car() 时，JavaScript 引擎都会在内存中创建一个新的函数实例。这意味着 car1.drive 和 car2.drive 虽然功能相同，但在内存中是两个完全不同的地址。对于成千上万个实例而言，这是极大的内存浪费。</p>
<h3 data-id="heading-2">1.2 Prototype：共享内存的解决方案</h3>
<p>为了解决上述问题，JavaScript 引入了 prototype 属性。它是函数对象特有的属性，用于存放所有实例<strong>共享</strong>的方法和属性。</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 资料来源：1.js</span>
<span class="hljs-comment">// 将公共方法挂载到 prototype 上</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">drive</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'drive, 下赛道'</span>);
    },
    <span class="hljs-attr">name</span>: <span class="hljs-string">'su7'</span>,
    <span class="hljs-attr">long</span>: <span class="hljs-number">4800</span>
};

<span class="hljs-keyword">const</span> car1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-string">'霞光紫'</span>);
car1.<span class="hljs-title function_">drive</span>(); <span class="hljs-comment">// 调用的是 Car.prototype 上的方法</span>
</code></pre>
<p>此时，无论创建多少个 Car 实例，drive 方法在内存中只存在一份。实例通过一种隐式的链接访问该方法。这便是原型机制诞生的初衷：<strong>通过共享来优化资源</strong>。</p>
<hr/>
<h2 data-id="heading-3">第二章：三角关系——构造函数、实例与原型对象</h2>
<p>理解 JavaScript 面向对象的关键，在于理清构造函数（Constructor）、原型（Prototype）和实例（Instance）三者之间的关系。</p>
<h3 data-id="heading-4">2.1 核心概念界定</h3>
<ol>
<li>
<p><strong>prototype（显式原型）</strong> ：</p>
<ul>
<li><strong>归属</strong>：只有<strong>函数</strong>（构造函数）才拥有此属性。</li>
<li><strong>作用</strong>：作为新创建实例的公共祖先（基因库）。</li>
</ul>
</li>
<li>
<p><strong><strong>proto</strong>（隐式原型）</strong> ：</p>
<ul>
<li><strong>归属</strong>：所有<strong>对象</strong>（包括实例、函数、原型对象本身）都拥有此属性（现代标准推荐使用 Object.getPrototypeOf，但 <strong>proto</strong> 依然广泛存在于调试与旧代码中）。</li>
<li><strong>作用</strong>：它是连接对象与原型的“链条”，指向创建该对象的构造函数的 prototype。</li>
</ul>
</li>
<li>
<p><strong>constructor</strong>：</p>
<ul>
<li><strong>归属</strong>：原型对象默认拥有的属性。</li>
<li><strong>作用</strong>：记录“我是由谁创造的”，指向构造函数本身。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">2.2 终极公式与关系图</h3>
<p>我们可以得出一个铁律公式：</p>
<p>JavaScript</p>
<pre><code class="hljs language-diff" lang="diff">// 实例的隐式原型 <span class="hljs-comment">=== 构造函数的显式原型</span>
instance.__proto__ <span class="hljs-comment">=== Constructor.prototype</span>
</code></pre>
<p>我们可以通过以下字符图来可视化这种关系：</p>
<p>Text</p>
<pre><code class="hljs language-sql" lang="sql">构造函数 (Person)
              <span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span>
              <span class="hljs-operator">|</span> prototype       <span class="hljs-operator">|</span> <span class="hljs-comment">---------------------&gt; +-----------------------+</span>
              <span class="hljs-operator">|</span>                 <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span> Person.prototype      <span class="hljs-operator">|</span>
              <span class="hljs-operator">+</span><span class="hljs-comment">-----------------+ &lt;--------------------- | constructor           |</span>
                       <span class="hljs-operator">^</span>                                 <span class="hljs-operator">|</span> sayHi() <span class="hljs-operator">/</span> species     <span class="hljs-operator">|</span>
                       <span class="hljs-operator">|</span> (<span class="hljs-keyword">new</span> 操作)                       <span class="hljs-operator">+</span><span class="hljs-comment">-----------------------+</span>
                       <span class="hljs-operator">|</span>                                           <span class="hljs-operator">^</span>
              <span class="hljs-operator">+</span><span class="hljs-comment">-----------------+                                  |</span>
              <span class="hljs-operator">|</span> 实例 (su)        <span class="hljs-operator">|</span>                                  <span class="hljs-operator">|</span>
              <span class="hljs-operator">|</span> __proto__       <span class="hljs-operator">|</span> <span class="hljs-comment">---------------------------------+</span>
              <span class="hljs-operator">+</span><span class="hljs-comment">-----------------+</span>
</code></pre>
<p>代码验证：</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">su</span> = new Person(<span class="hljs-string">'舒老板'</span>, <span class="hljs-number">19</span>)<span class="hljs-comment">;</span>
console.log(<span class="hljs-attr">su.__proto__</span> === Person.prototype)<span class="hljs-comment">; // true</span>
console.log(<span class="hljs-attr">Person.prototype.constructor</span> === Person)<span class="hljs-comment">; // true</span>
</code></pre>
<hr/>
<h2 data-id="heading-6">第三章：链式查找——原型链的本质</h2>
<p>当我们访问一个对象的属性时，JavaScript 引擎会启动一套严格的查找机制（Look-up）。</p>
<h3 data-id="heading-7">3.1 查找规则：向上委托</h3>
<p>查找过程如下：</p>
<ol>
<li><strong>自身查找</strong>：检查对象实例本身（su）是否拥有该属性。</li>
<li><strong>原型委托</strong>：如果没有，顺着 su.<strong>proto</strong> 找到 Person.prototype 继续查找。</li>
<li><strong>层层上溯</strong>：如果 Person.prototype 也没有，继续顺着 Person.prototype.<strong>proto</strong>（即 Object.prototype）查找。</li>
<li><strong>终点</strong>：如果 Object.prototype 也没有，查找 Object.prototype.<strong>proto</strong>，结果为 null，停止查找并返回 undefined。</li>
</ol>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">obj</span> = {}<span class="hljs-comment">; </span>
console.log(obj.__proto__.toString())<span class="hljs-comment">; </span>
// 输出 <span class="hljs-section">[object Object]</span>，该方法来自于 Object.prototype
</code></pre>
<h3 data-id="heading-8">3.2 属性遮蔽（Shadowing）</h3>
<p>一个常见的误区是认为修改实例属性会影响原型。实际上，JavaScript 的<strong>读</strong>与<strong>写</strong>操作在原型链上的行为是不同的。</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Person.prototype.species</span> = <span class="hljs-string">'人类'</span><span class="hljs-comment">;</span>
var <span class="hljs-attr">su</span> = new Person(<span class="hljs-string">'舒老板'</span>, <span class="hljs-number">19</span>)<span class="hljs-comment">;</span>

// "写"操作：直接在实例 su 上创建新属性，不会向上查找
<span class="hljs-attr">su.species</span> = <span class="hljs-string">'LOL达人'</span><span class="hljs-comment">; </span>

console.log(su.species)<span class="hljs-comment">; // 输出 'LOL达人' (来自实例)</span>
console.log(su.__proto__.species)<span class="hljs-comment">; // 输出 '人类' (原型保持不变)</span>
</code></pre>
<p>这种现象称为<strong>属性遮蔽（Shadowing）</strong> 。实例上的同名属性会“挡住”原型上的属性，但不会修改原型本身。这体现了 JS 原型继承的哲学：<strong>它不是基于复制的（像传统类继承那样），而是基于委托的。</strong>  如果我自己有，我就用自己的；如果我没有，我才去问我的原型。</p>
<hr/>
<h2 data-id="heading-9">第四章：进阶陷阱——重写原型与 Constructor 的丢失</h2>
<p>在定义原型方法时，有两种常见的写法。新手往往因为图方便而陷入“重写原型”的陷阱。</p>
<h3 data-id="heading-10">4.1 增量添加（推荐）</h3>
<p>采用了安全的写法：</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Person.prototype.species</span> = <span class="hljs-string">'人类'</span><span class="hljs-comment">;</span>
// 此时 Person.prototype.constructor 依然指向 Person
</code></pre>
<h3 data-id="heading-11">4.2 重写对象（危险）</h3>
<p>采用了覆盖写法：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 危险操作：直接赋值一个新对象</span>
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">species</span>: <span class="hljs-string">'人类'</span>,
    <span class="hljs-attr">sayHi</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}
};
</code></pre>
<p><strong>后果</strong>：<br/>
原始的 Person.prototype 对象被完全丢弃，取而代之的是一个新的对象字面量 {}。<br/>
这个新对象的 constructor 属性不再指向 Person，而是指向根构造函数 Object。</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 资料来源：3.html</span>
<span class="hljs-keyword">var</span> su = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'舒老板'</span>, <span class="hljs-number">19</span>);
<span class="hljs-comment">// 结果为 false，因为 constructor 链条断裂</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span> == <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span>); 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span>); <span class="hljs-comment">// 输出 Object</span>
</code></pre>
<p><strong>修正方案</strong>：<br/>
如果在实际开发中必须使用对象字面量赋值，必须手动修复 constructor：</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Person.prototype</span> = {
    constructor: Person, // 手动指回
    species: '人类'
}<span class="hljs-comment">;</span>
</code></pre>
<hr/>
<h2 data-id="heading-12">第五章：继承的演变——从手动委托到 ES6 语法糖</h2>
<p>原型链最强大的应用在于实现继承。展示了在 ES6 class 出现之前，开发者是如何手动构建继承链的。</p>
<h3 data-id="heading-13">5.1 手动构建原型链</h3>
<p>我们希望 Person 继承 Animal 的属性。</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">obj</span> = new Object()<span class="hljs-comment">;</span>
<span class="hljs-attr">obj.species</span> = <span class="hljs-string">'动物'</span><span class="hljs-comment">;</span>

function Animal() {}
<span class="hljs-attr">Animal.prototype</span> = obj<span class="hljs-comment">; // Animal 继承自 obj</span>

function Person() {}
// 关键步骤：建立连接
// Person.prototype 变成了一个 Animal 的实例
// 因此 <span class="hljs-attr">Person.prototype.__proto__</span> === Animal.prototype
<span class="hljs-attr">Person.prototype</span> = new Animal()<span class="hljs-comment">; </span>

var <span class="hljs-attr">su</span> = new Person()<span class="hljs-comment">;</span>
console.log(su.species)<span class="hljs-comment">; // 输出 '动物'</span>
</code></pre>
<p><strong>原理解析</strong>：<br/>
查找路径为：su (无) -&gt; su.<strong>proto</strong> (即 Person.prototype, 无) -&gt; Person.prototype.<strong>proto</strong> (即 Animal.prototype/obj) -&gt; <strong>找到 '动物'</strong> 。</p>
<h3 data-id="heading-14">5.2 ES6 Class：语法的现代化</h3>
<p>提到了 ES6 的 class 写法。必须明确的是，JavaScript 的 class 只是<strong>语法糖（Syntactic Sugar）</strong> 。</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; }
    <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) { ... }
}
</code></pre>
<p>其底层依然遵循原型链机制：</p>
<ul>
<li>class 声明的本质是构造函数。</li>
<li>类的方法依然被挂载在 prototype 上。</li>
<li>extends 关键字实际上是在执行类似 Person.prototype = Object.create(Animal.prototype) 的操作。</li>
</ul>
<hr/>
<h2 data-id="heading-15">技术总结</h2>
<ol>
<li><strong>构造函数</strong>负责处理对象的<strong>差异性</strong>（私有属性），<strong>原型对象</strong>负责处理对象的<strong>共性</strong>（共享方法）。</li>
<li><strong><strong>proto</strong></strong>  是对象寻找属性的“地图导线”，<strong>prototype</strong> 是函数提供的“公共资源库”。</li>
<li><strong>原型查找遵循就近原则</strong>：读取属性时沿链向上查找，写入属性时只操作实例自身（遮蔽效应）。</li>
<li><strong>慎重重写 Prototype</strong>：直接赋值 {...} 给 prototype 会导致 constructor 指向丢失，需手动修正。</li>
<li><strong>继承的本质是委托</strong>：JavaScript 的对象之间是通过引用链接的，而非传统面向对象语言中的代码复制。su 能访问 species，不是因为它拥有了 species，而是因为它被委托了访问权限。</li>
</ol>
<p>如果这篇文章有助于你理解原型链机制，就请您点个赞吧，谢谢</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[性能暴涨 1200 倍！我用 TypeScript 重构了这个经典项目]]></title>    <link>https://juejin.cn/post/7598574507347918883</link>    <guid>https://juejin.cn/post/7598574507347918883</guid>    <pubDate>2026-01-25T13:33:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598574507347918883" data-draft-id="7598563188112425012" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 性能暴涨 1200 倍！我用 TypeScript 重构了这个经典项目"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-25T13:33:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员Soldier"/> <meta itemprop="url" content="https://juejin.cn/user/935056027688039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             性能暴涨 1200 倍！我用 TypeScript 重构了这个经典项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/935056027688039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员Soldier
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:33:50.000Z" title="Sun Jan 25 2026 13:33:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">中国亲戚关系计算器 TypeScript 重构版：性能暴涨 1200 倍，完美支持 React Native</h2>
<p>一个 LRU 缓存，让性能从 44 QPS 飙升到 54,000 QPS</p>
<blockquote>
<p>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FExploringTheCodeWorld%2Frelationship-ts" target="_blank" title="https://github.com/ExploringTheCodeWorld/relationship-ts" ref="nofollow noopener noreferrer">github.com/ExploringTh…</a></p>
</blockquote>
<p>你是否也有过这样的经历？过年回家面对七大姑八大姨，却叫不上来对方该喊什么称呼？"中国家庭称谓计算器"这个项目就是为了解决这个问题而生的。</p>
<p>最近，我对这个经典项目进行了 <strong>TypeScript 重构优化</strong>，在保持功能完整的同时，实现了显著的性能提升和更好的兼容性。今天就来分享一下这次重构的亮点和收获。</p>
<h3 data-id="heading-1">为什么需要重构？</h3>
<h4 data-id="heading-2">起因：React Native 的"坑"</h4>
<p>在将原版 <code>relationship.js</code> 集成到 React Native 移动端应用时，遇到了一个棘手的报错：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">ERROR</span> [RangeError: <span class="hljs-keyword">Property</span> storage exceeds <span class="hljs-number">196607</span> properties]
</code></pre>
<p>这是因为原版 JS 在初始化时创建了大量的对象属性，超出了 <strong>JavaScriptCore 引擎</strong> 的属性数量限制（约 196607 个）。</p>
<h4 data-id="heading-3">技术选型</h4>
<p>为了彻底解决这个问题，我决定从以下几个方向进行重构：</p>
<ol>
<li><strong>TypeScript 重写</strong> - 提供类型安全和更好的开发体验</li>
<li><strong>Map 替代 Object</strong> - 利用 Map 的特性优化数据存储</li>
<li><strong>LRU 缓存机制</strong> - 提升重复查询性能</li>
<li><strong>模块化架构</strong> - 更好的代码组织和 Tree Shaking 支持</li>
</ol>
<h3 data-id="heading-4">核心优化点</h3>
<h4 data-id="heading-5">1. 数据结构优化：Map vs Object</h4>
<p><strong>原版实现：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 Object 存储称谓映射</span>
<span class="hljs-keyword">const</span> cacheData = {
  <span class="hljs-string">'f'</span>: [<span class="hljs-string">'父亲'</span>, <span class="hljs-string">'老爸'</span>, <span class="hljs-string">'爹地'</span>],
  <span class="hljs-string">'m'</span>: [<span class="hljs-string">'母亲'</span>, <span class="hljs-string">'老妈'</span>, <span class="hljs-string">'妈咪'</span>],
  <span class="hljs-comment">// ... 数千个属性</span>
};
</code></pre>
<p><strong>TS 版本优化：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedCache</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">_titleToChain</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Chain</span>[]&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  <span class="hljs-keyword">private</span> <span class="hljs-attr">_chainToTitle</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>[]&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

  <span class="hljs-title function_">getTitleToChain</span>(<span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Chain</span>[] | <span class="hljs-literal">undefined</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_titleToChain</span>.<span class="hljs-title function_">get</span>(title);  <span class="hljs-comment">// O(1) 查找</span>
  }
}
</code></pre>
<p><strong>优势：</strong></p>
<ul>
<li>Map 提供 O(1) 的查找性能</li>
<li>避免了 Object 的属性数量限制</li>
<li>更好的内存管理</li>
</ul>
<h4 data-id="heading-6">2. LRU 缓存实现</h4>
<p>这是我这次重构最满意的部分之一。针对亲戚关系查询场景，大量查询是重复的（比如"爸爸的爸爸"这种高频查询），非常适合使用缓存。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LRUCache</span>&lt;K, V&gt; {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">capacity</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">cache</span>: <span class="hljs-title class_">Map</span>&lt;K, V&gt;;

  <span class="hljs-title function_">get</span>(<span class="hljs-attr">key</span>: K): V | <span class="hljs-literal">undefined</span> {
    <span class="hljs-keyword">const</span> value = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">get</span>(key);
    <span class="hljs-keyword">if</span> (value !== <span class="hljs-literal">undefined</span>) {
      <span class="hljs-comment">// 更新访问顺序：删除并重新插入 - O(1)</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">delete</span>(key);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">set</span>(key, value);
    }
    <span class="hljs-keyword">return</span> value;
  }
}
</code></pre>
<p><strong>巧妙点：</strong> 利用 Map 的有序性（按插入顺序迭代），通过 <code>delete + set</code> 实现 O(1) 的访问顺序更新，无需额外的双向链表结构。</p>
<h4 data-id="heading-7">3. 分层缓存架构</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryCache</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">selectorCache</span>: <span class="hljs-title class_">LRUCache</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>[]&gt;;   <span class="hljs-comment">// 中文转选择器</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">idCache</span>: <span class="hljs-title class_">LRUCache</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>[]&gt;;         <span class="hljs-comment">// ID转中文</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">chainCache</span>: <span class="hljs-title class_">LRUCache</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;;        <span class="hljs-comment">// 关系链缓存</span>
}
</code></pre>
<p>三个独立的缓存层，针对不同类型的查询结果进行缓存，互不干扰。</p>
<h4 data-id="heading-8">4. 类型安全</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RelationshipOptions</span> {
  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>;           <span class="hljs-comment">// 目标对象的称谓</span>
  target?: <span class="hljs-built_in">string</span>;        <span class="hljs-comment">// 相对对象的称谓</span>
  sex?: -<span class="hljs-number">1</span> | <span class="hljs-number">0</span> | <span class="hljs-number">1</span>;      <span class="hljs-comment">// 本人性别：-1未知，0女性，1男性</span>
  <span class="hljs-keyword">type</span>?: <span class="hljs-string">'default'</span> | <span class="hljs-string">'chain'</span> | <span class="hljs-string">'pair'</span>;
  reverse?: <span class="hljs-built_in">boolean</span>;
  mode?: <span class="hljs-built_in">string</span>;
  optimal?: <span class="hljs-built_in">boolean</span>;
}
</code></pre>
<p>完整的 TypeScript 类型定义，开发时获得智能提示和类型检查。</p>
<h3 data-id="heading-9">性能基准测试</h3>
<h4 data-id="heading-10">测试环境</h4>
<ul>
<li><strong>Node.js</strong>: v22.12.0</li>
<li><strong>平台</strong>: Windows x64</li>
<li><strong>测试方法</strong>: 运行 10,000 次重复查询</li>
</ul>
<h4 data-id="heading-11">测试脚本</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 中国亲戚关系计算器性能测试脚本
 * 对比原版 JS 和 TypeScript 版本的性能
 */</span>

<span class="hljs-keyword">import</span> { performance } <span class="hljs-keyword">from</span> <span class="hljs-string">'perf_hooks'</span>;
<span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;

<span class="hljs-comment">// 测试用例 - 涵盖不同复杂度的查询</span>
<span class="hljs-keyword">const</span> testCases = [
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'父亲'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'简单查询'</span> },
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'爸爸的妈妈'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'两层关系'</span> },
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'妈妈的妈妈的哥哥'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'三层关系'</span> },
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'爸爸的哥哥的妻子的弟弟'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'复杂关系链'</span> },
  { <span class="hljs-attr">text</span>: <span class="hljs-string">'父亲的父亲的父亲的父亲'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">'四层关系(缓存)'</span> },
];

<span class="hljs-comment">// 格式化数字</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatNumber</span>(<span class="hljs-params">num</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">NumberFormat</span>(<span class="hljs-string">'zh-CN'</span>).<span class="hljs-title function_">format</span>(num);
}

<span class="hljs-comment">// 格式化时间</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatTime</span>(<span class="hljs-params">ms</span>) {
  <span class="hljs-keyword">if</span> (ms &lt; <span class="hljs-number">0.001</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${(ms * <span class="hljs-number">1000000</span>).toFixed(<span class="hljs-number">2</span>)}</span> μs`</span>;
  <span class="hljs-keyword">if</span> (ms &lt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${(ms * <span class="hljs-number">1000</span>).toFixed(<span class="hljs-number">2</span>)}</span> ms`</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${ms.toFixed(<span class="hljs-number">2</span>)}</span> ms`</span>;
}

<span class="hljs-comment">// 获取文件大小</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getFileSize</span>(<span class="hljs-params">filePath</span>) {
  <span class="hljs-keyword">const</span> stats = fs.<span class="hljs-title function_">statSync</span>(filePath);
  <span class="hljs-keyword">return</span> stats.<span class="hljs-property">size</span>;
}

<span class="hljs-comment">// 性能测试函数</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">runBenchmark</span>(<span class="hljs-params">name, relationshipFunc</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n<span class="hljs-subst">${<span class="hljs-string">'='</span>.repeat(<span class="hljs-number">60</span>)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`测试: <span class="hljs-subst">${name}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));

  <span class="hljs-keyword">const</span> results = {
    <span class="hljs-attr">coldStart</span>: [],
    <span class="hljs-attr">warmStart</span>: [],
    <span class="hljs-attr">queries</span>: {},
  };

  <span class="hljs-comment">// 预热 - 确保模块初始化</span>
  <span class="hljs-title function_">relationshipFunc</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'父亲'</span> });

  <span class="hljs-comment">// 1. 冷启动测试 - 测试不同查询的首次性能</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n🔵 冷启动测试 (各查询类型的首次性能)...'</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> tc <span class="hljs-keyword">of</span> testCases) {
    <span class="hljs-keyword">const</span> times = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) {
      <span class="hljs-comment">// 使用不同的查询来避免缓存</span>
      <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>();
       <span class="hljs-title function_">relationshipFunc</span>({ <span class="hljs-attr">text</span>: tc.<span class="hljs-property">text</span> + (i &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'的'</span> + <span class="hljs-string">'父亲'</span>.<span class="hljs-title function_">repeat</span>(i % <span class="hljs-number">3</span>) : <span class="hljs-string">''</span>) });
      <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
      times.<span class="hljs-title function_">push</span>(end - start);
    }
    <span class="hljs-keyword">const</span> avg = times.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / times.<span class="hljs-property">length</span>;
    results.<span class="hljs-property">queries</span>[tc.<span class="hljs-property">desc</span> + <span class="hljs-string">'(冷)'</span>] = avg;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   <span class="hljs-subst">${tc.desc.padEnd(<span class="hljs-number">20</span>)}</span>: <span class="hljs-subst">${formatTime(avg)}</span>`</span>);
  }

  <span class="hljs-comment">// 2. 热启动测试 - 重复同一查询（测试缓存效果）</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n🟢 热启动测试 (重复查询，命中缓存)...'</span>);
  <span class="hljs-keyword">const</span> warmQuery = <span class="hljs-string">'父亲的父亲的父亲的父亲'</span>;
  <span class="hljs-keyword">const</span> warmTimes = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
    <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>();
     <span class="hljs-title function_">relationshipFunc</span>({ <span class="hljs-attr">text</span>: warmQuery });
    <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
    warmTimes.<span class="hljs-title function_">push</span>(end - start);
  }
  <span class="hljs-keyword">const</span> avgWarm = warmTimes.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / warmTimes.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> minWarm = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(...warmTimes);
  <span class="hljs-keyword">const</span> maxWarm = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...warmTimes);

  <span class="hljs-comment">// 排除异常值（取中位数附近）</span>
  <span class="hljs-keyword">const</span> sorted = [...warmTimes].<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a - b);
  <span class="hljs-keyword">const</span> medianWarm = sorted[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(sorted.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>)];

  results.<span class="hljs-property">avgWarm</span> = avgWarm;
  results.<span class="hljs-property">minWarm</span> = minWarm;
  results.<span class="hljs-property">maxWarm</span> = maxWarm;
  results.<span class="hljs-property">medianWarm</span> = medianWarm;
  results.<span class="hljs-property">qps</span> = <span class="hljs-number">1000</span> / medianWarm;

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   平均耗时: <span class="hljs-subst">${formatTime(avgWarm)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   中位数耗时: <span class="hljs-subst">${formatTime(medianWarm)}</span> (去除异常值)`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   最小耗时: <span class="hljs-subst">${formatTime(minWarm)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   最大耗时: <span class="hljs-subst">${formatTime(maxWarm)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   QPS: <span class="hljs-subst">${formatNumber(<span class="hljs-number">1000</span> / medianWarm)}</span> req/s`</span>);

  <span class="hljs-keyword">return</span> results;
}

<span class="hljs-comment">// 主测试函数</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-string">'█'</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'█'</span> + <span class="hljs-string">' '</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">20</span>) + <span class="hljs-string">'性能测试基准测试'</span> + <span class="hljs-string">' '</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">20</span>) + <span class="hljs-string">'█'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'█'</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n📊 测试环境:`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   Node.js: <span class="hljs-subst">${process.version}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   平台: <span class="hljs-subst">${process.platform}</span> <span class="hljs-subst">${process.arch}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   热启动迭代: 10000 次`</span>);

  <span class="hljs-comment">// 包体积对比</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n📦 包体积对比:`</span>);
  <span class="hljs-keyword">const</span> jsSize = <span class="hljs-title function_">getFileSize</span>(<span class="hljs-string">'E:/github-project/relationship/dist/relationship.min.js'</span>);
  <span class="hljs-keyword">const</span> tsSize = <span class="hljs-title function_">getFileSize</span>(<span class="hljs-string">'E:/github-project/relationship-ts/dist/relationship.min.js'</span>);
  <span class="hljs-keyword">const</span> jsSizeKb = (jsSize / <span class="hljs-number">1024</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
  <span class="hljs-keyword">const</span> tsSizeKb = (tsSize / <span class="hljs-number">1024</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
  <span class="hljs-keyword">const</span> diff = ((tsSize - jsSize) / jsSize * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   原版 (JS):     <span class="hljs-subst">${jsSizeKb}</span> KB (<span class="hljs-subst">${formatNumber(jsSize)}</span> bytes)`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   优化版 (TS):   <span class="hljs-subst">${tsSizeKb}</span> KB (<span class="hljs-subst">${formatNumber(tsSize)}</span> bytes)`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   差异:         <span class="hljs-subst">${diff &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>}</span><span class="hljs-subst">${diff}</span>%`</span>);

  <span class="hljs-comment">// 导入两个版本</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n📥 加载模块...`</span>);

  <span class="hljs-comment">// 分别导入两个版本</span>
  <span class="hljs-keyword">const</span> relationshipJS = (<span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'file:///E:/github-project/relationship/dist/relationship.min.mjs'</span>)).<span class="hljs-property">default</span>;
  <span class="hljs-keyword">const</span> relationshipTS = (<span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'file:///E:/github-project/relationship-ts/dist/relationship.min.mjs'</span>)).<span class="hljs-property">default</span>;

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   ✅ 原版 (JS) 加载完成`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   ✅ 优化版 (TS) 加载完成`</span>);

  <span class="hljs-comment">// 运行测试</span>
  <span class="hljs-keyword">const</span> jsResults = <span class="hljs-keyword">await</span> <span class="hljs-title function_">runBenchmark</span>(<span class="hljs-string">'原版 (relationship.js)'</span>, relationshipJS);
  <span class="hljs-keyword">const</span> tsResults = <span class="hljs-keyword">await</span> <span class="hljs-title function_">runBenchmark</span>(<span class="hljs-string">'优化版 (relationship-ts)'</span>, relationshipTS);

  <span class="hljs-comment">// 生成对比报告</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'📊 性能对比报告'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));

  <span class="hljs-comment">// 冷启动对比</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n🔵 冷启动对比 (首次查询，无缓存):'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   <span class="hljs-subst">${<span class="hljs-string">'查询类型'</span>.padEnd(<span class="hljs-number">20</span>)}</span> <span class="hljs-subst">${<span class="hljs-string">'原版'</span>.padEnd(<span class="hljs-number">15</span>)}</span> <span class="hljs-subst">${<span class="hljs-string">'优化版'</span>.padEnd(<span class="hljs-number">15</span>)}</span> <span class="hljs-subst">${<span class="hljs-string">'差异'</span>.padEnd(<span class="hljs-number">10</span>)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'   '</span> + <span class="hljs-string">'-'</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));

  <span class="hljs-keyword">let</span> coldImprovements = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [desc, jsTime] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(jsResults.<span class="hljs-property">queries</span>)) {
    <span class="hljs-keyword">if</span> (desc.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'(冷)'</span>)) {
      <span class="hljs-keyword">const</span> tsTime = tsResults.<span class="hljs-property">queries</span>[desc];
      <span class="hljs-keyword">const</span> improvement = ((jsTime - tsTime) / jsTime * <span class="hljs-number">100</span>);
      coldImprovements.<span class="hljs-title function_">push</span>(improvement);
      <span class="hljs-keyword">const</span> arrow = improvement &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'🚀'</span> : (improvement &lt; <span class="hljs-number">0</span> ? <span class="hljs-string">'📈'</span> : <span class="hljs-string">'➡️'</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   <span class="hljs-subst">${desc.replace(<span class="hljs-string">'(冷)'</span>, <span class="hljs-string">''</span>).padEnd(<span class="hljs-number">20</span>)}</span> <span class="hljs-subst">${formatTime(jsTime).padEnd(<span class="hljs-number">15</span>)}</span> <span class="hljs-subst">${formatTime(tsTime).padEnd(<span class="hljs-number">15</span>)}</span> <span class="hljs-subst">${arrow}</span> <span class="hljs-subst">${(improvement &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>) + improvement.toFixed(<span class="hljs-number">1</span>)}</span>%`</span>);
    }
  }

  <span class="hljs-comment">// 热启动对比</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n🟢 热启动对比 (重复查询，命中 LRU 缓存):'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   原版中位数:    <span class="hljs-subst">${formatTime(jsResults.medianWarm)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   优化版中位数:  <span class="hljs-subst">${formatTime(tsResults.medianWarm)}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   原版 QPS:      <span class="hljs-subst">${formatNumber(jsResults.qps)}</span> req/s`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   优化版 QPS:    <span class="hljs-subst">${formatNumber(tsResults.qps)}</span> req/s`</span>);

  <span class="hljs-keyword">const</span> warmImprovement = ((jsResults.<span class="hljs-property">medianWarm</span> - tsResults.<span class="hljs-property">medianWarm</span>) / jsResults.<span class="hljs-property">medianWarm</span> * <span class="hljs-number">100</span>);
  <span class="hljs-keyword">const</span> qpsImprovement = ((tsResults.<span class="hljs-property">qps</span> - jsResults.<span class="hljs-property">qps</span>) / jsResults.<span class="hljs-property">qps</span> * <span class="hljs-number">100</span>);
  <span class="hljs-keyword">const</span> speedup = (jsResults.<span class="hljs-property">medianWarm</span> / tsResults.<span class="hljs-property">medianWarm</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">1</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   耗时减少:     <span class="hljs-subst">${warmImprovement &gt; <span class="hljs-number">0</span> ? warmImprovement.toFixed(<span class="hljs-number">1</span>) : <span class="hljs-string">'0'</span>}</span>%`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   QPS 提升:     <span class="hljs-subst">${qpsImprovement &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>}</span><span class="hljs-subst">${formatNumber(<span class="hljs-built_in">Math</span>.round(qpsImprovement))}</span>%`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   性能倍数:     🚀 <span class="hljs-subst">${speedup}</span>x 更快`</span>);

  <span class="hljs-comment">// 总结</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'📝 总结'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`
✅ 优化版主要改进:
   • 包体积:        <span class="hljs-subst">${diff.startsWith(<span class="hljs-string">'-'</span>) ? <span class="hljs-string">'⬇️ 减少 '</span> + <span class="hljs-built_in">Math</span>.abs(diff) + <span class="hljs-string">'%'</span> : <span class="hljs-string">'⬆️ 增加 '</span> + diff}</span>
   • 热启动性能:    🚀 <span class="hljs-subst">${speedup}</span>x 更快 (得益于 LRU 缓存机制)
   • QPS 提升:      <span class="hljs-subst">${qpsImprovement &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>}</span><span class="hljs-subst">${formatNumber(<span class="hljs-built_in">Math</span>.round(qpsImprovement))}</span>% (从 <span class="hljs-subst">${formatNumber(<span class="hljs-built_in">Math</span>.round(jsResults.qps))}</span> 到 <span class="hljs-subst">${formatNumber(<span class="hljs-built_in">Math</span>.round(tsResults.qps))}</span> req/s)
   • 类型安全:      ✅ 完整的 TypeScript 类型定义
   • 架构优化:      ✅ 模块化设计，更好的 Tree Shaking 支持
   • 兼容性:        ✅ 解决 React Native 属性存储超限问题
  `</span>);

  <span class="hljs-keyword">return</span> {
    jsSizeKb,
    tsSizeKb,
    diff,
    <span class="hljs-attr">jsQps</span>: jsResults.<span class="hljs-property">qps</span>,
    <span class="hljs-attr">tsQps</span>: tsResults.<span class="hljs-property">qps</span>,
    speedup,
    <span class="hljs-attr">jsMedian</span>: jsResults.<span class="hljs-property">medianWarm</span>,
    <span class="hljs-attr">tsMedian</span>: tsResults.<span class="hljs-property">medianWarm</span>,
  };
}

<span class="hljs-title function_">main</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);

</code></pre>
<h4 data-id="heading-12">测试结果</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb8eee4c72554fbc8d5102ce4a2effc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU29sZGllcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769952830&amp;x-signature=XhW5LQqzRqKfQdHX6WYUU%2BnaI1g%3D" alt="image.png" loading="lazy"/></p>









































<table><thead><tr><th>指标</th><th>原版 (JS)</th><th>优化版 (TS)</th><th>提升</th></tr></thead><tbody><tr><td><strong>包体积</strong></td><td>81.60 KB</td><td><strong>77.17 KB</strong></td><td>⬇️ 5.4%</td></tr><tr><td><strong>热启动响应时间</strong></td><td>~23 ms</td><td><strong>~0.02 ms</strong></td><td>🚀 1200x</td></tr><tr><td><strong>热启动 QPS</strong></td><td>~44 req/s</td><td><strong>~54,000 req/s</strong></td><td>🚀 122,000%</td></tr><tr><td><strong>冷启动响应时间</strong></td><td>~23 ms</td><td>~30 ms</td><td>持平</td></tr><tr><td><strong>React Native</strong></td><td>⚠️ 属性溢出风险</td><td>✅ 完美支持</td><td>-</td></tr></tbody></table>
<p><strong>核心发现：</strong></p>
<ul>
<li>冷启动（首次查询）性能基本持平，因为都需要遍历数据</li>
<li>热启动（重复查询）性能提升 <strong>1200 倍</strong>，得益于 LRU 缓存机制</li>
<li>包体积减少 5.4%，虽然加了缓存代码，但 TypeScript 的类型擦除和 Tree Shaking 带来了优化</li>
</ul>
<h3 data-id="heading-13">项目结构对比</h3>
<h4 data-id="heading-14">原版结构</h4>
<pre><code class="hljs language-ruby" lang="ruby">relationship/
├── src/
│   ├── relationship.js       <span class="hljs-comment"># 主入口 (单文件)</span>
│   ├── relationship-mode.js  <span class="hljs-comment"># 模式相关</span>
│   ├── locale/               <span class="hljs-comment"># 语言包</span>
│   └── <span class="hljs-keyword">module</span>/               <span class="hljs-comment"># 模块</span>
└── package.json
</code></pre>
<h4 data-id="heading-15">TS 版本结构</h4>
<pre><code class="hljs language-python" lang="python">relationship-ts/
├── src/
│   ├── core/                 <span class="hljs-comment"># 核心模块</span>
│   │   ├── cache.ts          <span class="hljs-comment"># 缓存系统 (Map优化)</span>
│   │   ├── lru.ts            <span class="hljs-comment"># LRU缓存实现</span>
│   │   ├── <span class="hljs-built_in">id</span>.ts             <span class="hljs-comment"># 关系链转中文</span>
│   │   ├── mode.ts           <span class="hljs-comment"># 模式管理</span>
│   │   └── selector.ts       <span class="hljs-comment"># 中文转关系链</span>
│   ├── data/                 <span class="hljs-comment"># 数据文件</span>
│   ├── rules/                <span class="hljs-comment"># 规则文件</span>
│   ├── utils/                <span class="hljs-comment"># 工具函数</span>
│   ├── locale/               <span class="hljs-comment"># 方言数据</span>
│   ├── types.ts              <span class="hljs-comment"># 类型定义</span>
│   └── index.ts              <span class="hljs-comment"># 主入口</span>
├── docs/                     <span class="hljs-comment"># VitePress 文档</span>
├── benchmark/                <span class="hljs-comment"># 性能测试</span>
└── package.json
</code></pre>
<p><strong>改进点：</strong></p>
<ul>
<li>更清晰的模块划分</li>
<li>独立的类型定义文件</li>
<li>完善的文档系统</li>
<li>性能基准测试</li>
</ul>
<h3 data-id="heading-16">使用示例</h3>
<h4 data-id="heading-17">安装</h4>
<pre><code class="hljs language-bash" lang="bash">npm install relationship-ts
</code></pre>
<h4 data-id="heading-18">基本用法</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> relationship <span class="hljs-keyword">from</span> <span class="hljs-string">'relationship-ts'</span>;

<span class="hljs-comment">// 查询称谓</span>
<span class="hljs-title function_">relationship</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'爸爸的妈妈'</span> });
<span class="hljs-comment">// =&gt; ['奶奶', '祖母']</span>

<span class="hljs-comment">// 多层关系查询</span>
<span class="hljs-title function_">relationship</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'妈妈的妈妈的哥哥'</span> });
<span class="hljs-comment">// =&gt; ['舅外公']</span>

<span class="hljs-comment">// 反向查询：对方称呼我什么？</span>
<span class="hljs-title function_">relationship</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'外婆'</span>, <span class="hljs-attr">reverse</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">sex</span>: <span class="hljs-number">1</span> });
<span class="hljs-comment">// =&gt; ['外孙']</span>

<span class="hljs-comment">// 关系链查询</span>
<span class="hljs-title function_">relationship</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'舅公'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'chain'</span> });
<span class="hljs-comment">// =&gt; ['爸爸的妈妈的兄弟', '妈妈的妈妈的兄弟']</span>
</code></pre>
<h4 data-id="heading-19">自然语言模式</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 支持自然语言表达式</span>
<span class="hljs-title function_">relationship</span>(<span class="hljs-string">'舅妈如何称呼外婆？'</span>);
<span class="hljs-comment">// =&gt; ['婆婆']</span>

<span class="hljs-title function_">relationship</span>(<span class="hljs-string">'外婆和奶奶之间是什么关系？'</span>);
<span class="hljs-comment">// =&gt; ['儿女亲家']</span>
</code></pre>
<h4 data-id="heading-20">自定义方言</h4>
<pre><code class="hljs language-typescript" lang="typescript">relationship.<span class="hljs-title function_">setMode</span>(<span class="hljs-string">'northern'</span>, {
  <span class="hljs-string">'m,f'</span>: [<span class="hljs-string">'姥爷'</span>],
  <span class="hljs-string">'m,m'</span>: [<span class="hljs-string">'姥姥'</span>],
  <span class="hljs-string">'m,xb,s&amp;o'</span>: [<span class="hljs-string">'表哥'</span>],
  <span class="hljs-string">'m,xb,s&amp;l'</span>: [<span class="hljs-string">'表弟'</span>],
});

<span class="hljs-title function_">relationship</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'妈妈的妈妈'</span>, <span class="hljs-attr">mode</span>: <span class="hljs-string">'northern'</span> });
<span class="hljs-comment">// =&gt; ['姥姥']</span>
</code></pre>
<h3 data-id="heading-21">兼容性说明</h3>
<p>TS 版本保持了与原版 <strong>100% 的 API 兼容性</strong>，你可以无缝替换：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 原版引入方式仍然支持</span>
<span class="hljs-keyword">import</span> relationship <span class="hljs-keyword">from</span> <span class="hljs-string">'relationship.js'</span>;

<span class="hljs-comment">// 替换为 TS 版本</span>
<span class="hljs-keyword">import</span> relationship <span class="hljs-keyword">from</span> <span class="hljs-string">'relationship-ts'</span>;

<span class="hljs-comment">// 代码无需任何修改</span>
</code></pre>
<h3 data-id="heading-22">总结</h3>
<p>这次 TypeScript 重构主要带来了以下收益：</p>
<ol>
<li><strong>性能提升</strong> - LRU 缓存让重复查询性能提升 1200 倍</li>
<li><strong>兼容性解决</strong> - 使用 Map 彻底解决 React Native 属性溢出问题</li>
<li><strong>类型安全</strong> - 完整的 TypeScript 类型定义</li>
<li><strong>代码质量</strong> - 模块化架构，更易维护和扩展</li>
<li><strong>包体积优化</strong> - 压缩后体积减少约 5.4%</li>
</ol>
<p>如果你在项目中需要使用亲戚关系计算功能，尤其是在 <strong>React Native</strong> 或 <strong>TypeScript</strong> 项目中，不妨试试这个优化版本。</p>
<h3 data-id="heading-23">致谢</h3>
<p>本项目基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmumuy%2Frelationship" target="_blank" title="https://github.com/mumuy/relationship" ref="nofollow noopener noreferrer">mumuy/relationship</a> 进行重构，感谢原作者 mumuy 的优秀工作！</p>
<hr/>
<blockquote>
<p>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FExploringTheCodeWorld%2Frelationship-ts" target="_blank" title="https://github.com/ExploringTheCodeWorld/relationship-ts" ref="nofollow noopener noreferrer">github.com/ExploringTh…</a>
在线演示: <a href="https://link.juejin.cn?target=https%3A%2F%2Fexample.qinyimo.cn%2F" target="_blank" title="https://example.qinyimo.cn/" ref="nofollow noopener noreferrer">example.qinyimo.cn/</a>
文档地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.qinyimo.cn%2F" target="_blank" title="https://docs.qinyimo.cn/" ref="nofollow noopener noreferrer">docs.qinyimo.cn/</a></p>
</blockquote>
<p>如果这个项目对你有帮助，欢迎给个 Star ⭐️</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 类型断言]]></title>    <link>https://juejin.cn/post/7598563188112490548</link>    <guid>https://juejin.cn/post/7598563188112490548</guid>    <pubDate>2026-01-25T13:37:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598563188112490548" data-draft-id="7598588085597634600" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 类型断言"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-25T13:37:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="如果你好"/> <meta itemprop="url" content="https://juejin.cn/user/2272012281328215"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 类型断言
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2272012281328215/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    如果你好
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:37:22.000Z" title="Sun Jan 25 2026 13:37:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TypeScript 类型断言</h2>
<h3 data-id="heading-1">一、类型断言</h3>
<p>举个简单例子：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义一个只能是 'a'/'b'/'c' 的类型</span>
<span class="hljs-keyword">type</span> T = <span class="hljs-string">'a'</span>|<span class="hljs-string">'b'</span>|<span class="hljs-string">'c'</span>;
<span class="hljs-comment">// TS 推断 foo 的类型是 string（太宽泛了）</span>
<span class="hljs-keyword">let</span> foo = <span class="hljs-string">'a'</span>;
<span class="hljs-comment">// 报错：string 类型不能赋值给 T 类型</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">bar</span>:T = foo;
</code></pre>
<p>这里 foo 明明是 'a'，但 TS 推断成了 string 类型（T 的父类型），父类型不能赋值给子类型，就报错了。</p>
<p>而<strong>类型断言</strong>就是用来“绕开”TS 的自动推断，手动指定值的类型——你比编译器更了解自己的代码，直接告诉它该怎么识别这个值！</p>
<p>改一下上面的例子，加上断言就不报错了：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> T = <span class="hljs-string">'a'</span>|<span class="hljs-string">'b'</span>|<span class="hljs-string">'c'</span>;
<span class="hljs-keyword">let</span> foo = <span class="hljs-string">'a'</span>;
<span class="hljs-comment">// 断言 foo 的类型是 T，TS 直接照做</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">bar</span>:T = foo <span class="hljs-keyword">as</span> T; <span class="hljs-comment">// 正确！</span>
</code></pre>
<p>注意：类型断言<strong>不会真的改变值的类型</strong>，只是给编译器“提个醒”，运行时该是什么类型还是什么类型。</p>
<h3 data-id="heading-2">二、类型断言的两种写法（推荐第二种）</h3>
<p>TS 提供了两种断言语法，功能完全一样，只是写法不同：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 写法1：尖括号形式（和 JSX 语法冲突，不推荐）</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">bar</span>:T = &lt;T&gt;foo;

<span class="hljs-comment">// 写法2：as 形式（推荐！无冲突，更易读）</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">bar</span>:T = foo <span class="hljs-keyword">as</span> T;
</code></pre>
<p>因为 React 的 JSX 语法也用尖括号（比如 <code>&lt;div&gt;</code>），为了避免混淆，现在都用 <code>值 as 类型</code> 的写法。</p>
<h4 data-id="heading-3">例子：操作 DOM 元素</h4>
<p>日常开发中最常用的场景——获取输入框并读取 value 属性：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// TS 推断 username 的类型是 HTMLElement | null</span>
<span class="hljs-keyword">const</span> username = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'username'</span>);

<span class="hljs-keyword">if</span> (username) {
  <span class="hljs-comment">// 断言成输入框类型，才能读取 value 属性</span>
  (username <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>).<span class="hljs-property">value</span>; <span class="hljs-comment">// 正确！</span>
}
</code></pre>
<p>这里的圆括号不能少，否则 TS 会把 <code>username as HTMLInputElement.value</code> 当成整体，直接报错</p>
<h3 data-id="heading-4">三、类型断言不可以随便使用</h3>
<p>你不能把一个值断言成完全无关的类型，TS 会拦着你：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> n = <span class="hljs-number">1</span>;
<span class="hljs-comment">// 报错：数值不能断言成字符串（完全无关）</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">m</span>:<span class="hljs-built_in">string</span> = n <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
</code></pre>
<p><strong>断言的规则</strong>：实际类型和断言类型必须“兼容”——要么是父子类型，要么是子父类型（比如 string 可以断言成 'a'|'b'，反过来也可以）。</p>
<p>如果非要断言成完全无关的类型（不推荐），可以走“弯路”：先断言成 <code>unknown</code>（所有类型的父类型），再断言成目标类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> n = <span class="hljs-number">1</span>;
<span class="hljs-comment">// 先转 unknown，再转 string，不报错了</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">m</span>:<span class="hljs-built_in">string</span> = n <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
</code></pre>
<h3 data-id="heading-5">四、超实用的特殊断言：as const</h3>
<p>日常开发中，我们经常遇到“let 变量被推断成宽泛类型”的问题，比如：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> s = <span class="hljs-string">'JavaScript'</span>;
<span class="hljs-comment">// 定义只能传这三个值的类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Lang</span> = <span class="hljs-string">'JavaScript'</span>|<span class="hljs-string">'TypeScript'</span>|<span class="hljs-string">'Python'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">setLang</span>(<span class="hljs-params">language:Lang</span>) {}

<span class="hljs-comment">// 报错：string 类型不能传给 Lang 类型</span>
<span class="hljs-title function_">setLang</span>(s);
</code></pre>
<p>解决方法有两个：要么把 let 改成 const（TS 会推断成固定值类型），要么用 <code>as const</code> 断言：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 断言后，s 的类型变成 'JavaScript'（不是 string 了）</span>
<span class="hljs-keyword">let</span> s = <span class="hljs-string">'JavaScript'</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;
<span class="hljs-title function_">setLang</span>(s); <span class="hljs-comment">// 正确！</span>
</code></pre>
<p><code>as const</code> 的核心作用：把值断言成“不可变的常量类型”，缩小 TS 的推断范围。</p>
<h4 data-id="heading-6">as const 还能用于对象/数组</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 普通声明：x/y 都是 number 类型</span>
<span class="hljs-keyword">const</span> v1 = { <span class="hljs-attr">x</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">2</span> };

<span class="hljs-comment">// 断言整个对象：x=1、y=2，且只读</span>
<span class="hljs-keyword">const</span> v2 = { <span class="hljs-attr">x</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">2</span> } <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-comment">// 普通数组：number[] 类型</span>
<span class="hljs-keyword">const</span> a1 = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];
<span class="hljs-comment">// 断言后：只读元组 [1,2,3]</span>
<span class="hljs-keyword">const</span> a2 = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;
</code></pre>
<p>比如数组断言成元组后，传给固定参数的函数就不报错了：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x:<span class="hljs-built_in">number</span>, y:<span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">return</span> x + y;
}

<span class="hljs-keyword">const</span> nums = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;
<span class="hljs-title function_">add</span>(...nums); <span class="hljs-comment">// 正确！</span>
</code></pre>
<h3 data-id="heading-7">五、非空断言：!（保证值不是 null/undefined）</h3>
<p>如果一个值可能是 null/undefined，但你确定它一定有值，用 <code>!</code> 做非空断言：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// TS 担心 root 是 null，调用方法会报错</span>
<span class="hljs-keyword">const</span> root = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>);
<span class="hljs-comment">// root.addEventListener('click', () =&gt; {}); // 报错</span>

<span class="hljs-comment">// 加 ! 断言：root 一定不是 null</span>
<span class="hljs-keyword">const</span> root = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>)!;
root.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {}); <span class="hljs-comment">// 正确！</span>
</code></pre>
<p>非空断言别滥用！只有你确定值非空时才用，否则运行时可能报错。更稳妥的方式是手动判断：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> root = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>);
<span class="hljs-keyword">if</span> (root) {
  root.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {});
}
</code></pre>
<h3 data-id="heading-8">六、断言函数：确认参数类型</h3>
<p>有时候我们需要写“校验函数”，确保参数符合类型要求，不符合就抛错——这就是断言函数：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 新版写法：明确告诉 TS，这个函数断言 value 是字符串</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isString</span>(<span class="hljs-params">value:<span class="hljs-built_in">unknown</span></span>):asserts value is <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value !== <span class="hljs-string">'string'</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'不是字符串！'</span>);
  }
}

<span class="hljs-comment">// 使用断言函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toUpper</span>(<span class="hljs-params">x: <span class="hljs-built_in">string</span>|<span class="hljs-built_in">number</span></span>) {
  <span class="hljs-title function_">isString</span>(x); <span class="hljs-comment">// 执行后，TS 就知道 x 是字符串了</span>
  <span class="hljs-keyword">return</span> x.<span class="hljs-title function_">toUpperCase</span>(); <span class="hljs-comment">// 正确！</span>
}


</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拒绝属性冲突！一文吃透 JavaScript 第七种数据类型：Symbol]]></title>    <link>https://juejin.cn/post/7598744870995558443</link>    <guid>https://juejin.cn/post/7598744870995558443</guid>    <pubDate>2026-01-25T13:59:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598744870995558443" data-draft-id="7598767580306096182" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拒绝属性冲突！一文吃透 JavaScript 第七种数据类型：Symbol"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-25T13:59:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拒绝属性冲突！一文吃透 JavaScript 第七种数据类型：Symbol
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:59:39.000Z" title="Sun Jan 25 2026 13:59:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>前言</strong>：<br/>
在 ES6 之前，JavaScript 的对象属性名只有一种类型：字符串。这在单人开发的小项目中看似没问题，但在大型项目或多人协作开发第三方库时，属性名冲突（Collision）简直是噩梦。</p>
<p>于是，ES6 带来了<strong>Symbol</strong>。它不仅仅是一个新类型，更是解决架构设计中“唯一性”问题的银弹。</p>
</blockquote>
<h2 data-id="heading-0">一、 数据类型的“七上八下”</h2>
<p>在深入 Symbol 之前，各位作为未来专业前端工程师，我们需要先理清 JavaScript 目前的数据类型版图。根据最新的 ECMAScript 标准，我们可以用**“七上八下”**这个口诀来记忆：</p>
<ul>
<li>
<p><strong>七上（7 种原始数据类型 Primitive Types）：</strong></p>
<ol>
<li>Number</li>
<li>Boolean</li>
<li>String</li>
<li>Null</li>
<li>Undefined</li>
<li><strong>Symbol</strong> (ES6 新增，符号)</li>
<li><strong>BigInt</strong> (ES2020 新增，大整数)</li>
</ol>
</li>
<li>
<p><strong>八下（1 种引用数据类型 Reference Type）：</strong></p>
<ol>
<li>Object (包含 Array, Function 等)</li>
</ol>
</li>
</ul>
<p>那么问题来了，既然已经有了 String，为什么还需要 Symbol？答案只有一个核心痛点：<strong>唯一性（Uniqueness）</strong> 。</p>
<hr/>
<h2 data-id="heading-1">二、 Symbol 的核心特性：独一无二的指纹</h2>
<h3 data-id="heading-2">1. 它是原始类型，不是对象</h3>
<p>很多新手看到首字母大写的 Symbol，下意识想用 new 去调用。<strong>这是错误的！</strong></p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 正确写法</span>
<span class="hljs-keyword">const</span> id1 = <span class="hljs-title class_">Symbol</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> id1); <span class="hljs-comment">// 'symbol'</span>

<span class="hljs-comment">// 错误写法：会抛出 TypeError</span>
<span class="hljs-comment">// const id2 = new Symbol();</span>
</code></pre>
<p><strong>深度解析</strong>：<br/>
Symbol 是原始数据类型（Primitive），就像 123 或 'abc' 一样。new 关键字是用来调用构造函数生成对象实例的（Wrapper Object）。如果你非要创建一个 Symbol 包装对象（不推荐），需要使用 Object(Symbol())。</p>
<h3 data-id="heading-3">2. 描述只是标签，不是身份</h3>
<p>我们可以给 Symbol 传入一个字符串作为描述（Description），但这仅仅是为了调试方便（当你打印 Log 时知道它是谁），<strong>不影响它的唯一性</strong>。</p>
<p>让我们看一段代码</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">// 即使描述完全一样
const <span class="hljs-attr">s1</span> = Symbol(<span class="hljs-string">'二哈'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">s2</span> = Symbol(<span class="hljs-string">'二哈'</span>)<span class="hljs-comment">;</span>

// 它们依然不相等！
console.log(<span class="hljs-attr">s1</span> === s2)<span class="hljs-comment">; // false</span>
</code></pre>
<p>这就像现实生活中，名字都叫“张三”的人有很多，但他们的身份证号（内存地址/唯一标识）绝对不同。Symbol 就是那个身份证号。</p>
<hr/>
<h2 data-id="heading-4">三、 实战：解决协作中的“属性覆盖”危机</h2>
<p>这是 Symbol 诞生最大的意义。</p>
<p>假设你正在使用一个第三方库提供的 user 对象，或者在一个大型团队中维护一个公共对象。你想给这个对象添加一个“密钥”属性。</p>
<p><strong>传统做法的风险：</strong></p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">// 假如 user 是别人传给你的
<span class="hljs-attr">user.id</span> = <span class="hljs-string">'123456'</span><span class="hljs-comment">; //  危险！如果 user 原本就有 id 属性，你就把它覆盖了！</span>
</code></pre>
<p><strong>Symbol 的做法：</strong></p>
<p>JavaScript</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> secretKey = Symbol(<span class="hljs-string">'secret'</span>); <span class="hljs-comment">// 生成一个独一无二的 Key</span>
<span class="hljs-keyword">const</span> a = <span class="hljs-string">"ecut"</span>; <span class="hljs-comment">// 普通字符串 Key</span>

<span class="hljs-keyword">const</span> user = {
    name: <span class="hljs-string">'曹仁'</span>,
    email: <span class="hljs-string">'123@qq.com'</span>,
    [<span class="hljs-meta">a</span>]: <span class="hljs-number">456</span>,            <span class="hljs-comment">// 普通计算属性名</span>
    [<span class="hljs-meta">secretKey</span>]: <span class="hljs-string">'111222'</span> <span class="hljs-comment">//  Symbol 作为 Key，绝不会冲突</span>
};

<span class="hljs-comment">// 访问方式</span>
console.log(user[secretKey]); <span class="hljs-comment">// '111222'</span>
</code></pre>
<p><strong>场景模拟</strong>：<br/>
哪怕 user 对象里原本就有个属性叫 secret，或者其他同事也定义了一个 Symbol('secret')，你的代码依然安全。因为你的 secretKey 变量持有的那个 Symbol 引用，是宇宙唯一的。</p>
<hr/>
<h2 data-id="heading-5">四、 隐身与反向查找：不可枚举的“魔法”</h2>
<p>Symbol 属性还有一个非常迷人的特性：<strong>它在常规遍历中是“隐身”的。</strong></p>
<p>让我们看一个课堂名单的例子</p>
<p>JavaScript</p>
<pre><code class="hljs language-css" lang="css">const classRoom = {
    "<span class="hljs-selector-tag">dl</span>": [<span class="hljs-string">"张三"</span>, <span class="hljs-string">"李四"</span>], // 普通属性
    [<span class="hljs-built_in">Symbol</span>(<span class="hljs-string">'Mark'</span>)]: { grade: <span class="hljs-number">50</span>, gender: <span class="hljs-string">'male'</span> },
    <span class="hljs-selector-attr">[Symbol(<span class="hljs-string">'oliva'</span>)]</span>: { grade: <span class="hljs-number">80</span>, gender: <span class="hljs-string">'female'</span> },
    // 注意：下面这个 Oliva 和上面那个是两个不同的 Key，不会覆盖！
    <span class="hljs-selector-attr">[Symbol(<span class="hljs-string">'oliva'</span>)]</span>: { grade: <span class="hljs-number">85</span>, gender: <span class="hljs-string">'female'</span> } 
}

// <span class="hljs-number">1</span>. 使用 for..<span class="hljs-selector-class">.in</span> 遍历
for (const key in classRoom) {
    console<span class="hljs-selector-class">.log</span>(key); // 只会输出 "<span class="hljs-selector-tag">dl</span>"
}

// <span class="hljs-number">2</span>. 使用 <span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.keys</span>()
console<span class="hljs-selector-class">.log</span>(<span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.keys</span>(classRoom)); // <span class="hljs-selector-attr">[<span class="hljs-string">"dl"</span>]</span>

// <span class="hljs-number">3</span>.  巨坑预警：JSON 序列化
console<span class="hljs-selector-class">.log</span>(JSON<span class="hljs-selector-class">.stringify</span>(classRoom)); 
// 输出: {"<span class="hljs-selector-tag">dl</span>":[<span class="hljs-string">"张三"</span>,<span class="hljs-string">"李四"</span>]}
// Symbol 属性直接被忽略了！
</code></pre>
<h3 data-id="heading-6">既然隐身了，我怎么拿到它？</h3>
<p>虽然 Symbol 可以模拟“私有属性”，但它不是绝对私有的。ES6 专门提供了一个 API 来获取对象中所有的 Symbol 键：</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">// 获取所有 Symbol 属性
const <span class="hljs-attr">syms</span> = Object.getOwnPropertySymbols(classRoom)<span class="hljs-comment">;</span>
console.log(syms)<span class="hljs-comment">; </span>
// <span class="hljs-section">[Symbol(Mark), Symbol(oliva), Symbol(oliva)]</span>

// 拿到 Key 后就可以访问数据了
const <span class="hljs-attr">data</span> = syms.map(sym =&gt; classRoom[sym])<span class="hljs-comment">;</span>
console.log(data)<span class="hljs-comment">;</span>
</code></pre>
<p>这一特性常用于在对象中存储<strong>元数据（Metadata）</strong> ，这些数据对业务逻辑重要，但在序列化传输给前端或存储到数据库时不需要（或者不能）被带走。</p>
<hr/>
<h2 data-id="heading-7">五、 深度扩展：Symbol 的进阶玩法</h2>
<p>作为一名资深开发者，只掌握基础是不够的，以下两个知识点能体现你的专业度。</p>
<h3 data-id="heading-8">1. 全局注册表：Symbol.for()</h3>
<p>普通的 Symbol() 每次都是新的。但如果你想在不同的文件、甚至不同的 iframe 之间共享同一个 Symbol 怎么办？</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">// 在全局注册表中登记一个名为 'uid' 的 Symbol
const <span class="hljs-attr">globalSym</span> = Symbol.for(<span class="hljs-string">'uid'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">sameSym</span> = Symbol.for(<span class="hljs-string">'uid'</span>)<span class="hljs-comment">;</span>

console.log(<span class="hljs-attr">globalSym</span> === sameSym)<span class="hljs-comment">; // true</span>
</code></pre>
<p>它就像一个全局的储物柜，你拿着凭证（Key）去取，拿到的永远是同一个东西。</p>
<h3 data-id="heading-9">2. 内置 Symbol（Well-known Symbols）</h3>
<p>你是否好奇，为什么 for...of 可以遍历数组，却不能遍历普通对象？为什么 String(obj) 会调用 toString？</p>
<p>这一切都是因为 JS 内部定义了一组<strong>内置 Symbol</strong>。比如 Symbol.iterator 定义了迭代行为，Symbol.toPrimitive 定义了类型转换行为。通过重写这些 Symbol，你可以从底层改变对象的行为模式。</p>
<hr/>
<h2 data-id="heading-10">六、 总结</h2>
<p>Symbol 的出现，标志着 JavaScript 从一门简单的脚本语言向成熟的大型应用语言迈进。</p>
<p>它主要解决了三大痛点：</p>
<ol>
<li><strong>唯一性</strong>：从根本上杜绝了属性名冲突。</li>
<li><strong>数据隐藏</strong>：作为非枚举属性，适合存储对象状态、配置项或元数据。</li>
<li><strong>行为钩子</strong>：通过内置 Symbol 扩展语言的底层能力。</li>
</ol>
<p>下次当你在设计通用组件、SDK 或处理复杂对象数据时，不妨想一想：“这里是不是该用 Symbol 了？”</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Canvas 何尝不是亮点呢？（一）]]></title>    <link>https://juejin.cn/post/7598744870995591211</link>    <guid>https://juejin.cn/post/7598744870995591211</guid>    <pubDate>2026-01-25T14:03:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598744870995591211" data-draft-id="7598744870995574827" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Canvas 何尝不是亮点呢？（一）"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-25T14:03:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="秀秀不只会前端"/> <meta itemprop="url" content="https://juejin.cn/user/1410009035452887"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Canvas 何尝不是亮点呢？（一）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1410009035452887/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    秀秀不只会前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T14:03:34.000Z" title="Sun Jan 25 2026 14:03:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Canvas 是什么？</h2>
<p><strong>Canvas  是高性能渲染引擎。</strong></p>
<ul>
<li><code>&lt;canvas&gt;</code> 是一个<strong>位图渲染容器</strong></li>
<li>所有内容都通过 <strong>JS API 绘制</strong></li>
<li>绘制完成后，浏览器只认识「像素」，<strong>不再关心你画了什么</strong></li>
<li>canvans 支持绘制的图形，总结起来有四种：
<ul>
<li>直线（矩形）</li>
<li>曲线（圆形）</li>
<li>文字</li>
<li>图片</li>
</ul>
</li>
</ul>
<blockquote>
<p>这与 DOM（结构化、可访问）完全不同。</p>
</blockquote>
<p>Canvas 和 DOM / SVG 的区别：</p>
<p>使用场景：</p>
<ul>
<li>动画动效</li>
<li>编辑器（时间轴 / 画布）</li>
<li>数据 / 大屏可视化</li>
<li>大数据量下的表格（性能优化）</li>
<li>游戏</li>
<li>音视频波形、字幕</li>
</ul>
<h2 data-id="heading-1">二、Canvas 基础</h2>
<p>Canvas 是 <strong>命令式 + 无状态渲染</strong></p>
<ul>
<li>每一帧都要<strong>重新画完整画面</strong></li>
<li>Canvas 不会保存任何结构</li>
</ul>
<ol>
<li>
<h3 data-id="heading-2">简单示例</h3>
</li>
</ol>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
      <span class="hljs-comment">// 获取 canvas 元素​</span>
      <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#canvas"</span>);
      <span class="hljs-comment">// 获取 canvas 上下文</span>
      <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>);

      <span class="hljs-comment">// 初始化</span>
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
        canvas.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>;
        canvas.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
      }
      <span class="hljs-title function_">init</span>();

      <span class="hljs-comment">// ==设置初始值==</span>
      <span class="hljs-comment">// 设置路径</span>
      ctx.<span class="hljs-title function_">beginPath</span>();
      <span class="hljs-comment">// 起始路径点：从画布左上角开始移动到某个位置</span>
      ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">200</span>);
      <span class="hljs-comment">// 画线中途连接点</span>
      ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">200</span>, <span class="hljs-number">300</span>);
      <span class="hljs-comment">// 画线下一个点</span>
      <span class="hljs-comment">// ctx.lineTo(300, 350);</span>
      <span class="hljs-comment">// 最后闭合，终点连接起点（可选）</span>
      <span class="hljs-comment">// ctx.closePath();</span>

      <span class="hljs-comment">// ==绘制行为==</span>
      <span class="hljs-comment">// 示例一：画线</span>
      ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">"red"</span>;
      ctx.<span class="hljs-title function_">stroke</span>();
      <span class="hljs-comment">// 示例二：画圆(小的填充圆就是点)</span>
      ctx.<span class="hljs-title function_">beginPath</span>();
      ctx.<span class="hljs-title function_">arc</span>(<span class="hljs-number">200</span>, <span class="hljs-number">300</span>, <span class="hljs-number">15</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 圆心坐标x，圆心坐标y，半径，起始角度，结束角度（默认顺指针），是否逆时针</span>
      ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">"green"</span>;
      ctx.<span class="hljs-title function_">fill</span>();
      <span class="hljs-comment">// 填充</span>
      <span class="hljs-comment">// ctx.fillStyle = "blue";</span>
      <span class="hljs-comment">// ctx.fill();</span>
      <span class="hljs-comment">// 实例三：文字</span>
      <span class="hljs-comment">// ctx.font = "32px sans-serif";</span>
      <span class="hljs-comment">// ctx.fillText("123", 300, 400);</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<ol start="2">
<li>
<h3 data-id="heading-3">坐标系统</h3>
</li>
</ol>
<ul>
<li>左上角 <code>(0,0)</code></li>
<li>向右：x 正方向</li>
<li>向下：y 正方向</li>
</ul>
<ol start="3">
<li>
<h3 data-id="heading-4">常见 API</h3>
</li>
</ol>
<blockquote>
<p>这里如果想要练手 canvas，我推荐两个项目：第一个是 vue3-particles（现在可能不叫这个名字了，总之就是粒子库/星空图的类似效果，第二个是代码雨/文字雨（canvas 版本），完全可以模仿着使用 canvas 复刻一下，能复刻出来，canvas 就算真正入门了。</p>
<p>彩蛋（😜）：如果后续有时间，我还会分享一些我之前做过的“花里胡哨”的动效。</p>
<p>进阶同学可以研究下 gsap 这个动画库，配合 canvas 会非常好用，就可以 <strong>GSAP 管时间，Canvas 管空间。</strong></p>
</blockquote>
<pre><code class="hljs language-Markdown" lang="Markdown">/<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span>** 获取 Canvas &amp; 上下文 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
const canvas = document.getElementById('canvas'); // 获取 canvas DOM
const ctx = canvas.getContext('2d');              // 获取 2D 渲染上下文（核心对象）

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 状态管理 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
ctx.save();       // 保存当前绘图状态（样式、变换、裁剪区）
ctx.restore();    // 恢复到最近一次 save 的状态
ctx.resetTransform(); // 重置 transform（现代浏览器）
ctx.globalAlpha = 1;  // 全局透明度（0~1）
ctx.globalCompositeOperation = 'source-over'; // 图层混合模式

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 路径相关 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
ctx.beginPath();  // 开启新路径
ctx.closePath();  // 闭合路径
ctx.moveTo(x, y);         // 移动到指定点（不画线）
ctx.lineTo(x, y);         // 从当前点画线到指定点
ctx.arc(x, y, r, start, end, ccw); // 画圆/圆弧
ctx.arcTo(x1, y1, x2, y2, r);      // 圆角连接线
ctx.rect(x, y, w, h);     // 画矩形路径
ctx.quadraticCurveTo(cpx, cpy, x, y); // 二次贝塞尔
ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y); // 三次贝塞尔
ctx.stroke(); // 描边
ctx.fill();   // 填充
ctx.clip();   // 将当前路径设为裁剪区域（遮罩核心）

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 样式设置 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
ctx.strokeStyle = '#fff';     // 描边颜色
ctx.fillStyle = '#000';       // 填充颜色
ctx.lineWidth = 2;            // 线宽
ctx.lineCap = 'round';        // 线帽（butt | round | square）
ctx.lineJoin = 'round';       // 连接处样式
ctx.miterLimit = 10;          // 尖角限制
ctx.shadowColor = 'rgba(0,0,0,0.3)'; // 阴影颜色
ctx.shadowBlur = 10;                // 阴影模糊
ctx.shadowOffsetX = 5;              // 阴影偏移
ctx.shadowOffsetY = 5;

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 变换 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
ctx.translate(x, y); // 平移
ctx.rotate(rad);     // 旋转（弧度）
ctx.scale(sx, sy);   // 缩放
ctx.transform(a, b, c, d, e, f);    // 矩阵变换
ctx.setTransform(a, b, c, d, e, f); // 直接设置变换矩阵

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 清屏 &amp; 擦除 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
ctx.clearRect(0, 0, canvas.width, canvas.height); // 每次重新 draw 的时候通常会清空指定区域


/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 文本 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
ctx.font = 'bold 48px sans-serif'; // 字体
ctx.textAlign = 'center';          // 对齐方式
ctx.textBaseline = 'middle';       // 基线
ctx.fillText('Hello', x, y);   // 填充文字
ctx.strokeText('Hello', x, y); // 描边文字
ctx.measureText('Hello');      // 测量文字宽度（字母动画必用）

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 图片 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
const img = new Image();
img.src = 'image.png';
ctx.drawImage(img, x, y);                         // 原尺寸绘制
ctx.drawImage(img, x, y, w, h);                   // 指定尺寸
ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh); // 裁剪绘制（精灵图）

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 渐变 &amp; 图案 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
const linearGradient = ctx.createLinearGradient(x0, y0, x1, y1);
linearGradient.addColorStop(0, '#ff0');
linearGradient.addColorStop(1, '#f00');
ctx.fillStyle = linearGradient;
const radialGradient = ctx.createRadialGradient(x0, y0, r0, x1, y1, r1);
radialGradient.addColorStop(0, '#fff');
radialGradient.addColorStop(1, '#000');
const pattern = ctx.createPattern(img, 'repeat'); // 平铺图案

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 像素操作（性能敏感） <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
const imageData = ctx.getImageData(0, 0, w, h); // 读取像素
const data = imageData.data;                   // RGBA 数组
ctx.putImageData(imageData, x, y);              // 写回像素
// data[i]     -&gt; R
// data[i + 1] -&gt; G
// data[i + 2] -&gt; B
// data[i + 3] -&gt; A

/**</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span> 动画循环 <span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">**/
function render() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  // draw...
  requestAnimationFrame(render);
  // 不能使用 setInterval，因为 1. 不跟随屏幕刷新 2. 掉帧严重 3. 能耗高
}
render();
</span></code></pre>
<h2 data-id="heading-5">三、其他注意事项</h2>
<ol>
<li>
<h3 data-id="heading-6">分层思想</h3>
</li>
</ol>
<ul>
<li>时间层（GSAP / Ticker）</li>
<li>逻辑层（业务逻辑、状态计算）</li>
<li>渲染层（Canvas draw）</li>
</ul>
<ol start="2">
<li>
<h3 data-id="heading-7">canvas / 图片清晰度问题</h3>
</li>
</ol>
<p>样式尺寸：el.style.width</p>
<p>原始尺寸：el.naturalWidth（canvas.width）</p>
<p>页面缩放倍率：devicePixelRatio</p>
<p>☝️ 保证图片(canvas)清晰可以总结为一个等式：原始尺寸 = 样式尺寸 * 缩放倍率</p>
<p>所以在项目中，我们一般为初始化的 canvas 设置宽高为：</p>
<pre><code class="hljs language-Plain" lang="Plain">const dpr = window.devicePixelRatio || 1;
canvas.width = project.width * dpr;
canvas.height = project.height * dpr;
</code></pre>
<ol start="3">
<li>
<h3 data-id="heading-8">必须使用 requestAnimationFrame</h3>
</li>
</ol>
<pre><code class="hljs language-Plain" lang="Plain">function render() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  // draw...
  requestAnimationFrame(render);
  // 
}
render();
</code></pre>
<p>不能使用 setInterval，因为：</p>
<ol>
<li>不跟随屏幕刷新</li>
<li>掉帧严重</li>
<li>能耗高</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里一面：ReentrantLock如何保证线程安全？]]></title>    <link>https://juejin.cn/post/7598734303174967348</link>    <guid>https://juejin.cn/post/7598734303174967348</guid>    <pubDate>2026-01-26T01:59:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303174967348" data-draft-id="7598732691769819187" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里一面：ReentrantLock如何保证线程安全？"/> <meta itemprop="keywords" content="后端,面试,Java"/> <meta itemprop="datePublished" content="2026-01-26T01:59:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员飞鱼"/> <meta itemprop="url" content="https://juejin.cn/user/1665088861772688"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里一面：ReentrantLock如何保证线程安全？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1665088861772688/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员飞鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:59:39.000Z" title="Mon Jan 26 2026 01:59:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><p><strong>文章内容收录到个人网站，方便阅读</strong>：<a href="https://link.juejin.cn?target=http%3A%2F%2Fhardyfish.top%2F" target="_blank" title="http://hardyfish.top/" ref="nofollow noopener noreferrer">hardyfish.top/</a></p>
<p>ReentrantLock 的线程安全，本质由两件事托底：<strong>互斥</strong>与<strong>内存可见性</strong>。</p>
<p>互斥保证同一时刻只有一个线程进入临界区（critical section，受保护的共享资源访问区）；</p>
<p>内存可见性保证临界区内对共享变量的写入，在解锁后对随后获得锁的线程可见。</p>
<p><strong>互斥：基于 AQS 的“独占状态”与 CAS 争用</strong></p>
<p>ReentrantLock 的底层是 <strong>AQS（AbstractQueuedSynchronizer，同步器框架）</strong> 。AQS 用一个 <code>state</code> 整数表示同步状态，对独占锁而言通常含义是“是否被占用/占用次数”。</p>
<ul>
<li>
<p>抢锁：线程通过 CAS（Compare-And-Swap，比较并交换）尝试把<code>state</code>从0改为1（或从当前值递增）。</p>
<ul>
<li>成功：获得锁，成为 owner（持有者）。</li>
<li>失败：进入 AQS 的 CLH 队列（FIFO 等待队列），阻塞/自旋等待后续唤醒。</li>
</ul>
</li>
<li>
<p><strong>锁的排他性</strong>：只有 owner 才能继续执行临界区代码；非 owner 必须等待 <code>state</code> 归零并被唤醒后再竞争。</p>
</li>
</ul>
<p>这种设计的关键点在于：对 <code>state</code> 的修改使用原子操作（CAS），从而在高并发下也能可靠地裁决“谁赢得锁”。</p>
<p><strong>可重入：用“持有者 + 计数”避免自我死锁</strong></p>
<p>“可重入（reentrant）”指同一线程在持有锁时再次 <code>lock()</code> 不会被自己阻塞。</p>
<p>ReentrantLock 通过两类信息实现：</p>
<ul>
<li>
<p><strong>持有者线程记录</strong>：AQS 维护当前独占持有者（owner thread）。</p>
</li>
<li>
<p>重入次数计数：<code>state</code>充当计数器。</p>
<ul>
<li>第一次获取锁：<code>state</code> 从 <code>0</code> 变为 <code>1</code>，owner 设为当前线程。</li>
<li>同一线程再次获取：检测 owner 是自己，直接 <code>state++</code>。</li>
<li>释放锁：<code>state--</code>；直到减到 <code>0</code> 才真正释放所有权并唤醒队列中的后继线程。</li>
</ul>
</li>
</ul>
<p>因此，临界区内调用链较深、方法间层层加锁时，不会发生“自己把自己锁死”的问题。</p>
<p><strong>阻塞与唤醒：队列化等待减少竞争风暴</strong></p>
<p>当抢锁失败，线程不会无休止忙等，而是进入 AQS 队列并在合适时机被唤醒：</p>
<ul>
<li>入队后，线程可能 <code>park</code>（挂起），释放 CPU。</li>
<li>解锁时，持有者把 <code>state</code> 释放到 <code>0</code>，再按策略唤醒队列中的后继节点竞争。</li>
</ul>
<p>队列化的价值在于把竞争从“所有线程同时冲刺”变成“排队接力”，显著降低上下文切换与缓存抖动带来的损耗。</p>
<p><strong>内存可见性：lock/unlock 的 happens-before 语义</strong></p>
<p>线程安全不只需要“同一时刻只有一个线程进来”，还需要“前一个线程写过的数据，后一个线程读得到”。</p>
<p>ReentrantLock 提供与 <code>synchronized</code> 类似的内存语义：</p>
<ul>
<li><strong>unlock 之前的写</strong>，在 <strong>随后某线程成功 lock 之后的读</strong> 中可见（happens-before）。</li>
<li>这依赖于 AQS 内部对 <code>state</code> 等字段的 <strong>volatile 语义</strong> 与 CAS/park-unpark 等操作在 Java 内存模型下形成的屏障效果。</li>
</ul>
<p>直观理解：解锁像“刷盘提交”，加锁像“重新加载最新版本”，保证共享变量不会读到旧值。</p>
<p><strong>公平与非公平：安全性相同，调度策略不同</strong></p>
<p>ReentrantLock 有两种策略：</p>
<ul>
<li><strong>非公平锁（默认）</strong> ：新来的线程可能“插队”直接 CAS 抢到锁，吞吐通常更高。</li>
<li><strong>公平锁</strong>：倾向于按队列先来后到获取锁，减少饥饿（starvation）风险。</li>
</ul>
<p>两者都满足互斥与可见性要求，线程安全语义一致，差别在于获得锁的次序与性能特征。</p>
<p><strong>关键用法约束：释放必须与获取配对</strong></p>
<p>ReentrantLock 的线程安全依赖“锁的协议”被正确遵守：</p>
<ul>
<li>释放次数必须与获取次数匹配（重入多少次就要 unlock 多少次），否则会造成锁长期不释放。</li>
<li>通常在 <code>finally</code> 中释放，避免异常路径遗留锁导致其他线程永久阻塞。</li>
</ul>
<p>这套机制合起来，使 ReentrantLock 在并发访问共享资源时，既能保证互斥，又能保证内存可见性，从而实现可验证的线程安全。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Zustand：轻量、直观、持久化的 React 状态管理新范式]]></title>    <link>https://juejin.cn/post/7598921649888329755</link>    <guid>https://juejin.cn/post/7598921649888329755</guid>    <pubDate>2026-01-25T12:13:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598921649888329755" data-draft-id="7598537377473560614" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Zustand：轻量、直观、持久化的 React 状态管理新范式"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2026-01-25T12:13:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Zyx2007"/> <meta itemprop="url" content="https://juejin.cn/user/3924597867554890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Zustand：轻量、直观、持久化的 React 状态管理新范式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3924597867554890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Zyx2007
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:13:52.000Z" title="Sun Jan 25 2026 12:13:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 React 应用日益复杂的今天，状态管理早已不是“要不要”的问题，而是“用什么更合适”。Redux 曾是主流选择，但其样板代码多、学习曲线陡峭的问题一直为人诟病。而 <strong>Zustand</strong> 的出现，以极简 API、Hooks 友好、零依赖和内置持久化能力，为开发者提供了一种更清爽、更高效的解决方案。它不追求大而全，却在“够用、好用、易维护”上做到了极致。</p>
<h2 data-id="heading-0">为什么需要全局状态？</h2>
<p>React 组件天然具备局部状态（<code>useState</code>），但当多个组件需要共享数据（如用户登录信息、全局主题、未完成任务数）时，状态提升或 Context 会迅速变得笨重。这时，一个<strong>集中式、可预测、可追踪</strong>的状态仓库就显得尤为重要。Zustand 正是为此而生——它像一个中央数据库，所有组件都能从中读取或更新数据，且更新逻辑被严格封装。</p>
<h2 data-id="heading-1">核心理念：一切皆 Hook</h2>
<p>Zustand 完全基于 React Hooks 设计，使用方式极其自然：</p>
<pre><code class="hljs language-scss" lang="scss">const { count, increment } = <span class="hljs-built_in">useCounterStore</span>();
</code></pre>
<p>无需 Provider 包裹根组件，无需 <code>connect</code> 高阶组件，直接在任意函数组件中调用 store Hook 即可。这种“即用即取”的体验，大幅降低了状态管理的心理门槛和代码侵入性。</p>
<h2 data-id="heading-2">定义 Store：类型安全 + 逻辑内聚</h2>
<p>Zustand 鼓励将状态与修改方法定义在一起，并通过 TypeScript 接口明确契约：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">CounterState</span> {
  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = create&lt;<span class="hljs-title class_">CounterState</span>&gt;()(
  <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> })),
    <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> }),
  })
);
</code></pre>
<p>这里，<code>set</code> 是 Zustand 提供的更新函数，支持函数式更新（接收当前状态）或直接赋值。所有状态变更都集中在此，逻辑清晰，便于测试和维护。TypeScript 则确保任何地方使用 <code>useCounterStore()</code> 都能获得准确的类型提示和编译检查。</p>
<h2 data-id="heading-3">复杂状态：Todo 列表实战</h2>
<p>对于包含数组或对象的复杂状态，Zustand 同样游刃有余：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">addTodo</span>: <span class="hljs-function">(<span class="hljs-params">title</span>) =&gt;</span> 
  <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ 
    <span class="hljs-attr">todos</span>: [...state.<span class="hljs-property">todos</span>, { <span class="hljs-attr">id</span>: +<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), title, <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span> }] 
  }))
</code></pre>
<p>通过展开运算符创建新数组，保持状态不可变性，符合 React 最佳实践。每个操作（添加、切换、删除）都是独立的函数，职责单一，组合灵活。</p>
<h2 data-id="heading-4">内置持久化：一行代码实现本地存储</h2>
<p>Zustand 通过中间件（middleware）机制扩展能力，其中 <code>persist</code> 是最常用的一个：</p>
<pre><code class="hljs language-javascript" lang="javascript">create&lt;<span class="hljs-title class_">CounterState</span>&gt;()(
  <span class="hljs-title function_">persist</span>(
    <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({ <span class="hljs-comment">/* ... */</span> }),
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'counter'</span> }
  )
)
</code></pre>
<p>只需将原始 store 包裹在 <code>persist</code> 中，并指定存储键名（如 <code>'counter'</code>），Zustand 就会自动将状态同步到 <code>localStorage</code>，并在页面刷新后恢复。这对 Todo 列表、用户设置等场景至关重要，且无需手动编写序列化/反序列化逻辑。</p>
<h2 data-id="heading-5">多 Store 分治：关注点分离</h2>
<p>Zustand 不强制单一全局 store。我们可以按功能拆分为多个独立 store：</p>
<ul>
<li><code>useUserStore</code>：管理登录状态与用户信息；</li>
<li><code>useTodoStore</code>：管理任务列表；</li>
<li><code>useCounterStore</code>：管理计数器。</li>
</ul>
<p>每个 store 自包含状态和行为，互不干扰。这种“分而治之”的策略，比单一巨型 store 更易于理解和维护，尤其适合中大型项目。</p>
<h2 data-id="heading-6">实际集成：在组件中消费状态</h2>
<p>在组件中使用 Zustand store 如同使用普通 Hook：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { todos, addTodo } = <span class="hljs-title function_">useTodoStore</span>();
  <span class="hljs-keyword">const</span> [input, setInput] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAdd</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (input.<span class="hljs-title function_">trim</span>()) {
      <span class="hljs-title function_">addTodo</span>(input);
      <span class="hljs-title function_">setInput</span>(<span class="hljs-string">''</span>);
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{input}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{e</span> =&gt;</span> setInput(e.target.value)} /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleAdd}</span>&gt;</span>添加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        {todos.map(todo =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{todo.id}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{todo.title}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            {/* ... */}
          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>组件完全不关心状态如何存储或持久化，只专注于 UI 渲染和事件触发。这种解耦让代码更专注、更可测试。</p>
<h2 data-id="heading-7">性能优化：自动选择性订阅</h2>
<p>Zustand 默认会对整个 store 进行浅比较，但若只关心部分状态，可通过 selector 避免不必要的重渲染：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">count</span> = useCounterStore(state =&gt; state.count)<span class="hljs-comment">;</span>
</code></pre>
<p>这样，只有当 <code>count</code> 变化时，组件才会更新，其他字段的变动不会触发重渲染，性能表现优异。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么 Java 的锁锁不住 Kotlin 协程？]]></title>    <link>https://juejin.cn/post/7598921649888985115</link>    <guid>https://juejin.cn/post/7598921649888985115</guid>    <pubDate>2026-01-26T00:11:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598921649888985115" data-draft-id="7596710680896569350" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么 Java 的锁锁不住 Kotlin 协程？"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-26T00:11:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="潜龙勿用之化骨龙"/> <meta itemprop="url" content="https://juejin.cn/user/2313028195058471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么 Java 的锁锁不住 Kotlin 协程？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028195058471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    潜龙勿用之化骨龙
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:11:26.000Z" title="Mon Jan 26 2026 00:11:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、问题起手：一个“看起来完全没问题”的代码</h2>
<p>很多人在协程里第一次写到下面这样的代码时，都会觉得<strong>这没什么问题</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fd4c2121a79495ba57de370ee4077ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=jwsBGfbV7ai5FSOS56KOGNd7K%2Fk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/650ed8fc2bd941509e2de312ee3413c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=GZFqD5zYBae7scwhQVQaBr3pSIU%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>用了 <code>ReentrantLock</code></li>
<li>做了余额判断</li>
<li>甚至切到 <strong>单线程 dispatcher</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79897acfee9942a4a5427381ac77a496~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=uGh7TAMY%2FW%2B8KUYoLWLuVdidaVM%3D" alt="image.png" loading="lazy"/></li>
</ul>
<p>但真实运行结果却可能是：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">currentBalance</span> = -<span class="hljs-number">500</span>
</code></pre>
<p>更诡异的是：</p>
<ul>
<li><strong>多线程</strong>：直接抛异常</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc1b3e45f33f4196bb444972158c1af3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=QsoNdWIMwV3N0A%2Bs9LkLsGGmzyc%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>单线程</strong>：不报错，但结果错</li>
</ul>
<p>这就引出了本文的核心问题：</p>
<blockquote>
<p><strong>为什么 Java 的锁，在协程里看起来“完全不可靠”？</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、<code>synchronized</code> 与协程的根本冲突</h2>
<h3 data-id="heading-2">2.1 <code>synchronized</code> 的语义：线程绑定的 JVM monitor</h3>
<p>在 JVM 层面，<code>synchronized</code> 的语义非常明确：</p>
<ul>
<li>
<p>锁的拥有者是 <strong>Thread</strong></p>
</li>
<li>
<p>进入同步块 → 当前线程获取 monitor</p>
</li>
<li>
<p>退出同步块 → <strong>必须由同一个线程释放</strong></p>
</li>
<li>
<p>JVM 假设：</p>
<blockquote>
<p>持锁期间，线程不会“消失”</p>
</blockquote>
</li>
</ul>
<hr/>
<h3 data-id="heading-3">2.2 协程的语义：可挂起、可恢复、可迁移</h3>
<p>而协程的 <code>suspend</code> 意味着：</p>
<ul>
<li>
<p>当前逻辑执行可以 <strong>挂起</strong></p>
</li>
<li>
<p>线程会被 <strong>释放</strong></p>
</li>
<li>
<p>恢复时：</p>
<ul>
<li>可能是同一个线程</li>
<li>也可能是另一个线程</li>
</ul>
</li>
</ul>
<p>也就是说：</p>
<blockquote>
<p><strong>协程绑定的是“逻辑执行流”，
而不是某个固定线程。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-4">2.3 语义正面冲突</h3>
<p>如果允许下面的代码存在：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">synchronized(lock) {
    delay(<span class="hljs-number">1000</span>)
}
</code></pre>
<p>那么 JVM 将面对一个无法成立的事实：</p>
<ul>
<li>monitor 是线程 A 拿的</li>
<li>delay 后代码可能在线程 B 执行</li>
<li>线程 B 却在“同步块”中运行</li>
</ul>
<p>这会直接破坏 JVM 对 monitor 的基本假设。</p>
<p>👉 因此 Kotlin 的选择是：</p>
<blockquote>
<p><strong>在编译期直接禁止：
synchronized / @Synchronized 中不能出现挂起点</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-5">三、为什么 <code>ReentrantLock</code> 却能“正常编译”？</h2>
<h3 data-id="heading-6">3.1 语言级 vs 库级</h3>
<ul>
<li><code>synchronized</code> 是 <strong>语言级特性</strong></li>
<li><code>ReentrantLock</code> 是 <strong>普通 Java 类</strong></li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin">lock.lock()
delay(<span class="hljs-number">1000</span>)
lock.unlock()
</code></pre>
<p>在 Kotlin 编译器看来，这只是普通方法调用：</p>
<blockquote>
<p>“我不知道你这是锁，
我也不知道你有什么语义。”</p>
</blockquote>
<p>所以：</p>
<ul>
<li>编译期 <strong>不拦</strong></li>
<li>风险 <strong>全部留给运行期</strong></li>
</ul>
<hr/>
<h2 data-id="heading-7">四、同一段代码，<code>ReentrantLock</code> 的两种结局</h2>
<p>我们统一看下面这段代码：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79897acfee9942a4a5427381ac77a496~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=uGh7TAMY%2FW%2B8KUYoLWLuVdidaVM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">4.1 多线程调度：<strong>直接抛异常</strong></h3>
<p>如果在多线程 dispatcher 下运行：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6938110d8be4dc28d1406ba7197b9eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=s5yQyFgNOvmUHO0akxjE23qjn5o%3D" alt="image.png" loading="lazy"/></p>
<p>这个启动协程去线程调度和在方法上线程调度 本质是一样的.
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fd4c2121a79495ba57de370ee4077ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=jwsBGfbV7ai5FSOS56KOGNd7K%2Fk%3D" alt="image.png" loading="lazy"/></p>
<p>你很快会看到：</p>
<pre><code class="hljs">IllegalMonitorStateException
</code></pre>
<p>原因非常直接：</p>
<ul>
<li><code>lock.lock()</code> 在 <strong>线程 A</strong></li>
<li><code>delay()</code> 挂起后释放线程</li>
<li>协程恢复时可能在 <strong>线程 B</strong></li>
<li><code>lock.unlock()</code> 却由线程 B 执行</li>
</ul>
<p>而 JVM 的规则是：</p>
<blockquote>
<p>❌ <strong>只能由拿锁的线程释放锁</strong></p>
</blockquote>
<p>👉 这是 JVM 级非法行为，直接抛异常。</p>
<h3 data-id="heading-9">4.2 单线程调度：<strong>不报错，但结果是 -500</strong></h3>
<p>很多人会尝试“绕过”这个问题：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> dispatcher = newSingleThreadContext(<span class="hljs-string">"single"</span>)
</code></pre>
<p>在这种情况下：</p>
<ul>
<li><code>lock.lock()</code> / <code>unlock()</code>
确实发生在同一个 Thread 实例</li>
<li>不会抛异常</li>
</ul>
<p><strong>但结果却可能是：</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">currentBalance</span> = -<span class="hljs-number">500</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">4.3 为什么单线程下也会算错？</h3>
<p>因为问题已经不是“线程安全”，而是：</p>
<blockquote>
<p><strong>挂起把“时间”引进了临界区</strong></p>
</blockquote>
<p>真实执行时间线（单线程）：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">balance</span> = <span class="hljs-number">1000</span>
启动 3 个协程
</code></pre>
<ul>
<li>协程 A：判断通过 → delay</li>
<li>1 秒后：扣 500 → balance = 500</li>
<li>协程 B：判断通过 → delay</li>
<li>1 秒后：扣 500 → balance = 0</li>
<li>协程 C：判断在 delay 前已成立 → 再扣 500</li>
</ul>
<p>最终结果：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">balance</span> = -<span class="hljs-number">500</span>
</code></pre>
<p>⚠️ 注意：</p>
<ul>
<li>没有线程并发</li>
<li>锁没有失效</li>
<li><strong>只是判断结果在 suspend 后已经过期</strong></li>
</ul>
<hr/>
<h3 data-id="heading-11">4.4 小结：两种死法</h3>

























<table><thead><tr><th>场景</th><th>表现</th><th>根因</th></tr></thead><tbody><tr><td>多线程 + Lock</td><td>抛异常</td><td>锁 owner 是 Thread</td></tr><tr><td>单线程 + Lock</td><td>结果错误</td><td>时间竞态</td></tr><tr><td>任意线程 + Mutex</td><td>语义成立</td><td>锁绑定协程</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">五、为什么 <code>Mutex</code> 在协程里是“语义正确”的</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c151e2b3eacc47a1873f87ff919d5ef4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991086&amp;x-signature=pvkgTuUE39edYhNgW%2FKKGLxNTko%3D" alt="image.png" loading="lazy"/></p>
<p><code>Mutex</code> 的关键区别在于：</p>
<ul>
<li>它锁的不是线程</li>
<li>而是 <strong>协程执行权</strong></li>
</ul>
<p>也就是说：</p>
<pre><code class="hljs language-text" lang="text">ReentrantLock → owner = Thread
Mutex         → owner = Coroutine
</code></pre>
<p>因此：</p>
<ul>
<li>挂起不会破坏锁语义</li>
<li>恢复后仍是同一个逻辑执行者</li>
</ul>
<h2 data-id="heading-13">六、总结</h2>
<p>ReentrantLock 的世界观是：
❌ 锁的 owner 必须是同一个线程</p>
<p>而协程的世界观是：
✅ 只要是“同一个协程”，逻辑就是连续的</p>
<p>当线程锁遇到可迁移执行的协程时，
两套宇宙法则发生了正面冲突。</p>
<ul>
<li><code>synchronized</code>
→ JVM 线程模型
→ <strong>编译期禁止 suspend</strong></li>
<li><code>ReentrantLock</code>
→ 库级 API
→ <strong>运行期风险自负</strong></li>
<li><code>Mutex</code>
→ 协程原生同步
→ <strong>唯一语义正确的选择</strong></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[失业，仲裁，都赶上了（四）]]></title>    <link>https://juejin.cn/post/7599268297202270246</link>    <guid>https://juejin.cn/post/7599268297202270246</guid>    <pubDate>2026-01-26T00:12:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297202270246" data-draft-id="7598464972912984104" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="失业，仲裁，都赶上了（四）"/> <meta itemprop="keywords" content="前端,JavaScript,程序员"/> <meta itemprop="datePublished" content="2026-01-26T00:12:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端切圖仔"/> <meta itemprop="url" content="https://juejin.cn/user/1460596659193351"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            失业，仲裁，都赶上了（四）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1460596659193351/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端切圖仔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:12:26.000Z" title="Mon Jan 26 2026 00:12:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>很久没有写文章了，再次敲下键盘，没想到手居然有点生疏起来。</p>
<p>当这篇文章发出去的时候，我应该是在开庭的路上了（本来想设定时发送，没想到这么久了，这功能还没有）。</p>
<p>回过头看了这个<a href="https://juejin.cn/column/7441405701607079990" target="_blank" title="https://juejin.cn/column/7441405701607079990">系列</a>，真的十分十分谢谢大家对我的鼓励！</p>
<p>那么久没写文章：</p>
<ul>
<li>第一是，真的懒了；</li>
<li>第二是，在我2024年11月失业过后的7个月里，我思考经历了很多。有开心，有自由，有焦虑，有迷茫。但没关系，现在基本都过去了。</li>
</ul>
<p>这篇文章大概讲讲我那会失业后的生活，还有仲裁的结果。希望给到失业了的，或可能即将失业的朋友一些参考。</p>
<h2 data-id="heading-1">自由</h2>
<p>在我失业后，我第一个收获到的是自由。</p>
<p>记得上班的时候，工作日两点一线，平时周末可能还要被占据去加班，因此平常想做的事，基本没有时间去做，只想在工作之余好好的休息。</p>
<p>所以，趁着失业，我回去看望了我很久没见的外婆，整理了我乱糟糟的房间，陪了陪家人；我做了很多平时没有时间去做的事情。</p>
<p>但有点出乎意料的是，在工作日工作时间出去时，发现虽然人比平时少，但也没少多少。我在工作时间去的游泳馆，里面虽然大部分是上了年纪的人在游泳，但是年轻人也很多。后面我乍一想，这些人如果不是家里有矿的话，那估计是都跟我一样失业了，这个时间点才有时间来游泳吧。</p>
<p>平时工作想请假，公司就像没了你运营不了似得，不是卡你流程，就是不会让你请那么多天。</p>
<p>因此趁着失业，我也去旅游了好几个地方，当作是给我工作那么久以来的犒劳：</p>
<ul>
<li>去南京看了枫叶</li>
<li>去济州岛第一次看到雪</li>
<li>第一次一个人旅游，去了趟北京，当做送给自己30岁的礼物</li>
</ul>
<p>没了工作后，本以为每天生活会很无聊，但其实每天都有事情做，虽然大部分是家庭琐事，但是依旧让人觉得是充实的。</p>
<h2 data-id="heading-2">焦虑</h2>
<p>在收获了几个月的自由后，随之而来的是焦虑感。</p>
<p>虽然我还有点存款，但生活是要成本的。我每个月都会有固定的支出，看着自己的钱只出不进，那种焦虑感真的很可怕。你会不断地想着如果这些钱都花完了怎么办。</p>
<p>所以后几个月我几乎：</p>
<ul>
<li>每天都在刷招聘软件，有适合一点的岗位我就投递</li>
<li>加入各种前端兼职群，看能不能碰碰运气拿点单子做</li>
<li>开始想着要不要先去奶茶店或者什么店兼职</li>
</ul>
<p><strong>不出所料的是，基本没有什么回应。</strong></p>
<p>也许是平时我待人真诚，没什么心眼，谢谢上天对我眷顾🙏🏻。后期我十分意外的接到了一个外包，帮一个公司开发一个小程序。</p>
<p>本来我以为毕竟是外包，且又是不认识的人，合作的过程中会十分难熬。但是在合作的过程中，除了工作量大点，其他方面都是很不错的，最重要的是大家沟通的都十分愉快。在一些交付的时间节点上，大家也不是很死板，而是有商有量，他们会说没事，慢慢做。</p>
<p>当然，在这个过程中，我也有很强烈的契约精神。即使交付时间可以商量，但之前说好的交付时间点，我依旧会熬夜完成，因为我觉得信任跟真诚是相互的，这样才会是一个良性循环。</p>
<p>后期小程序顺利上线，我当然也小小的回血了一波。</p>
<p>我十分感激在我十分焦虑的那个时间段里，遇到了这些陌生人。虽然我们是相互合作的关系，但我还是要在这里说声谢谢。我不清楚如果当时我没有这么好的运气接到这个外包，后面的我会怎么样。但是我觉得真诚对人，善良对人，后面也许这些都会在冥冥中以你不知道的方式也回馈给你。</p>
<h2 data-id="heading-3">工作</h2>
<p>再说说工作。</p>
<p>我刚开头投递了一阵子，确实没什么回应。但是后期接到外包后，我也没有时间去想下一份工作的事，因为实在是太忙了。</p>
<p>再后面，我朋友内推我进了一家公司。虽然是薪资没有以前高，但是每天准时下班，基本不加班，而且是相对比较稳定的公司。虽然有些方面我感觉不太合适，但是现在的我更想追求稳定了。</p>
<p>现在的我工作更关注的是好不好请假，稳不稳定。不是我失去了上进心，是我觉得如果去的都是小公司，当下环境，似乎很难再攀升，不如在一个稳定的地方更认真的做，或许也是个不错的选择。至于薪资，只要认真做，有产出，都会有机会的。</p>
<p>我也想对失业没找到工作的朋友说：不要气馁，不是能力不行，是现在的大环境也许就是这样。现在找工作，更多的是靠内推，还有需要些许的运气，所以千万不要内耗。</p>
<h2 data-id="heading-4">仲裁结果</h2>
<p>在2月份仲裁结束以后，大概4月份我终于收到了仲裁结果。<strong>很开心的告诉大家，我仲裁成功了！诉求都得到了支持！再次谢谢大家对我的关注与鼓励！</strong></p>
<p>这不单是我一个人的胜利，是属于打工人的胜利！✌🏻</p>
<p>仲裁结果:</p>
<ul>
<li>支付我<code>N</code>的济补偿金</li>
<li>支付我剩余未休年假金额</li>
<li>支付我的律师费</li>
</ul>
<p>但是好景不长。在拿到仲裁判决书后，我找老板就仲裁结果进行了谈判，结果当然是他不会赔那么多，所以他提起了一审诉讼。</p>
<p>这样的结果，我也早就预料在内，这本身就是一场持久战。</p>
<p>现在的我，无所畏惧，而且也没有什么可以失去的了。欠我的薪资已经追回，工作让我有了底气，仲裁我也赢了。</p>
<p>于是4月份，我也整理相应资料应诉了。并且，在应诉的过程中，我也申请了财产保全，已经成功冻住了公司的钱。所以，不要同情资本家！不是真的没钱，就是不想赔而已。</p>
<p>因此，整个周期时长为：</p>
<ul>
<li>2024年11月底左右提交的仲裁申请</li>
<li>2024年12月中左右收到开庭通知</li>
<li>开庭时间为2025年2月中左右</li>
<li>2025年4月左右出了结果，仲裁胜利</li>
<li>2025年4月应诉准备一审</li>
<li>2026年1月底左右进行一审开庭</li>
</ul>
<p>整个过程到一审，大概一年多的时间。我个人觉得还蛮快的，可能是因为我的案件清晰，基本没有什么争议点。但是，我也做好了继续二审的准备。</p>
<blockquote>
<p><strong>另外，这个系列的文章可能会更新的慢，但是一定不会断！因为我想告诉大家一个完整的过程。在私信里，我也有收到一些朋友的疑问，也很开心能帮助到一些朋友。</strong></p>
</blockquote>
<h2 data-id="heading-5">最后</h2>
<p>失业的那段时间里，我觉得也是收获了我人生很宝贵的一段时间，尤其是刚开头失业那段时间。</p>
<p>那段时间，我觉得我的生活变慢了。我有时间去好好感受我身边发生的事情，真正的体会到原来除了工作，其实每天还有很多别的无聊的、有趣的、意外的事情发生，我感触很多。</p>
<p>于是我也开了一个公众号——<strong>小日记大本子</strong>，我想把我遇到的、或者想到的一些事情记录下来，仅仅只是个人的一些感受，如果大家有兴趣，当然欢迎关注一波.</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8599713a120f4fb48b2174830276a194~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5YiH5ZyW5LuU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991145&amp;x-signature=nbOlXNQeWgBaMwWIN2qUIPE4IWc%3D" alt="qrcode_for_gh_0350ce2077c3_258.jpg" loading="lazy"/></p>
<h2 data-id="heading-6">最后的最后</h2>
<p>再次谢谢所有为我鼓励的人。</p>
<p>下一次更新，应该是在一审判决出来了。但我现在时不时会在公众号更新文章。</p>
<p>今天走在开庭的路上，天气看不出好坏。但是没关系，有阳光照耀过地方，一定会更加美丽！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CopyOnWriteArrayList：写时复制机制与高效并发访问]]></title>    <link>https://juejin.cn/post/7598807837868261402</link>    <guid>https://juejin.cn/post/7598807837868261402</guid>    <pubDate>2026-01-26T00:14:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598807837868261402" data-draft-id="7598401650856738816" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" CopyOnWriteArrayList：写时复制机制与高效并发访问"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-26T00:14:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             CopyOnWriteArrayList：写时复制机制与高效并发访问
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:14:31.000Z" title="Mon Jan 26 2026 00:14:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>Vector无论是add方法还是get方法都加上了<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.seven97.top%2Fjava%2Fconcurrent%2F02-keyword1-synchronized.html" target="_blank" title="https://www.seven97.top/java/concurrent/02-keyword1-synchronized.html" ref="nofollow noopener noreferrer"><strong>synchronized</strong></a>修饰，当多线程读写List必须排队执行，很显然这样效率比较是低下的，CopyOnWriteArrayList是读写分离的，好处是提高线程访问效率。</p>
<p>CopyOnWrite容器即<strong>写时复制</strong>的容器。通俗的理解是当往一个容器添加元素的时候，不直接往当前容器添加，而是先将当前容器里的值Copy到新的容器，然后再往新的容器里添加元素，添加完元素之后，再将原容器的引用指向新的容器。这样做的好处是我们可以对CopyOnWrite容器进行并发的读 要加锁，因为当前容器不会添加任何元素。所以CopyOnWrite容器也是一种读写分离的思想，读和写不同的容器。</p>
<h2 data-id="heading-1">底层原理</h2>
<ol>
<li>CopyOnWriteArrayList的动态数组机制 -- 它内部有个volatile数组(array)来保持数据。在“添加/删除”数据时，都会新建一个数组，并将更新后的数据拷贝到新建的数组中，最后再将该数组赋值给volatile数组。这就是它叫做CopyOnWriteArrayList的原因！</li>
<li>每一个CopyOnWriteArrayList都和一个监视器锁lock绑定，通过lock，实现了对CopyOnWriteArrayList的互斥添加/删除。</li>
</ol>
<h3 data-id="heading-2">类的继承关系</h3>
<p>CopyOnWriteArrayList实现了List接口，List接口定义了对列表的基本操作；同时实现了RandomAccess接口，表示可以随机访问(数组具有随机访问的特性)；同时实现了Cloneable接口，表示可克隆；同时也实现了Serializable接口，表示可被序列化。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;E&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">List</span>&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable {}
</code></pre>
<h3 data-id="heading-3">类的内部类</h3>
<ul>
<li>COWIterator类</li>
</ul>
<p>COWIterator表示迭代器，其也有一个Object类型的数组作为CopyOnWriteArrayList数组的快照，这种快照风格的迭代器方法在创建迭代器时使用了对当时数组状态的引用。此数组在迭代器的生存期内不会更改，因此不可能发生冲突，并且迭代器保证不会抛出 ConcurrentModificationException。创建迭代器以后，迭代器就不会反映列表的添加、移除或者更改。在迭代器上进行的元素更改操作(remove、set 和 add)不受支持。这些方法将抛出 UnsupportedOperationException。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">COWIterator</span>&lt;E&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ListIterator</span>&lt;E&gt; {
    <span class="hljs-comment">/** Snapshot of the array */</span>
    <span class="hljs-comment">// 快照</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object[] snapshot;
    <span class="hljs-comment">/** Index of element to be returned by subsequent call to next.  */</span>
    <span class="hljs-comment">// 游标</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> cursor;
    <span class="hljs-comment">// 构造函数</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">COWIterator</span><span class="hljs-params">(Object[] elements, <span class="hljs-type">int</span> initialCursor)</span> {
        cursor = initialCursor;
        snapshot = elements;
    }
    <span class="hljs-comment">// 是否还有下一项</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> cursor &lt; snapshot.length;
    }
    <span class="hljs-comment">// 是否有上一项</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasPrevious</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> cursor &gt; <span class="hljs-number">0</span>;
    }
    <span class="hljs-comment">// next项</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> E <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (! hasNext()) <span class="hljs-comment">// 不存在下一项，抛出异常</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchElementException</span>();
        <span class="hljs-comment">// 返回下一项</span>
        <span class="hljs-keyword">return</span> (E) snapshot[cursor++];
    }

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> E <span class="hljs-title function_">previous</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (! hasPrevious())
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchElementException</span>();
        <span class="hljs-keyword">return</span> (E) snapshot[--cursor];
    }
    
    <span class="hljs-comment">// 下一项索引</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">nextIndex</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> cursor;
    }
    
    <span class="hljs-comment">// 上一项索引</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">previousIndex</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> cursor-<span class="hljs-number">1</span>;
    }

    <span class="hljs-comment">/**
        * Not supported. Always throws UnsupportedOperationException.
        * <span class="hljs-doctag">@throws</span> UnsupportedOperationException always; {<span class="hljs-doctag">@code</span> remove}
        *         is not supported by this iterator.
        */</span>
    <span class="hljs-comment">// 不支持remove操作</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
    }

    <span class="hljs-comment">/**
        * Not supported. Always throws UnsupportedOperationException.
        * <span class="hljs-doctag">@throws</span> UnsupportedOperationException always; {<span class="hljs-doctag">@code</span> set}
        *         is not supported by this iterator.
        */</span>
    <span class="hljs-comment">// 不支持set操作</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(E e)</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
    }

    <span class="hljs-comment">/**
        * Not supported. Always throws UnsupportedOperationException.
        * <span class="hljs-doctag">@throws</span> UnsupportedOperationException always; {<span class="hljs-doctag">@code</span> add}
        *         is not supported by this iterator.
        */</span>
    <span class="hljs-comment">// 不支持add操作</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">forEachRemaining</span><span class="hljs-params">(Consumer&lt;? <span class="hljs-built_in">super</span> E&gt; action)</span> {
        Objects.requireNonNull(action);
        Object[] elements = snapshot;
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> elements.length;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> cursor; i &lt; size; i++) {
            <span class="hljs-meta">@SuppressWarnings("unchecked")</span> <span class="hljs-type">E</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> (E) elements[i];
            action.accept(e);
        }
        cursor = size;
    }
}
</code></pre>
<h3 data-id="heading-4">类的属性</h3>
<p>属性中有一个可重入锁，用来保证线程安全访问，还有一个Object类型的数组，用来存放具体的元素。当然，也使用到了反射机制和CAS来保证原子性的修改lock域。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;E&gt;
    <span class="hljs-keyword">implements</span> <span class="hljs-title class_">List</span>&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable {
    <span class="hljs-comment">// 版本序列号</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">8673264195747942595L</span>;
    <span class="hljs-comment">// 可重入锁</span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">transient</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-comment">// 对象数组，用于存放元素</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Object[] array;
    <span class="hljs-comment">// 反射机制</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> sun.misc.Unsafe UNSAFE;
    <span class="hljs-comment">// lock域的内存偏移量</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> lockOffset;
    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            UNSAFE = sun.misc.Unsafe.getUnsafe();
            Class&lt;?&gt; k = CopyOnWriteArrayList.class;
            lockOffset = UNSAFE.objectFieldOffset
                (k.getDeclaredField(<span class="hljs-string">"lock"</span>));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(e);
        }
    }
}
</code></pre>
<h3 data-id="heading-5">类的构造函数</h3>
<ul>
<li>默认构造函数</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">CopyOnWriteArrayList</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 设置数组</span>
    setArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>]);
}
</code></pre>
<ul>
<li>CopyOnWriteArrayList(Collection&lt;? extends E&gt;)</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">CopyOnWriteArrayList</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> {
    Object[] elements;
    <span class="hljs-keyword">if</span> (c.getClass() == CopyOnWriteArrayList.class) <span class="hljs-comment">// 类型相同</span>
        <span class="hljs-comment">// 获取c集合的数组</span>
        elements = ((CopyOnWriteArrayList&lt;?&gt;)c).getArray();
    <span class="hljs-keyword">else</span> { <span class="hljs-comment">// 类型不相同</span>
        <span class="hljs-comment">// 将c集合转化为数组并赋值给elements</span>
        elements = c.toArray();
        <span class="hljs-comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span>
        <span class="hljs-keyword">if</span> (elements.getClass() != Object[].class) <span class="hljs-comment">// elements类型不为Object[]类型</span>
            <span class="hljs-comment">// 将elements数组转化为Object[]类型的数组</span>
            elements = Arrays.copyOf(elements, elements.length, Object[].class);
    }
    <span class="hljs-comment">// 设置数组</span>
    setArray(elements);
}

</code></pre>
<p>该构造函数的处理流程如下</p>
<ol>
<li>
<p>判断传入的集合c的类型是否为CopyOnWriteArrayList类型，若是，则获取该集合类型的底层数组(Object[])，并且设置当前CopyOnWriteArrayList的数组(Object[]数组)，进入步骤③；否则，进入步骤②</p>
</li>
<li>
<p>将传入的集合转化为数组elements，判断elements的类型是否为Object[]类型(toArray方法可能不会返回Object类型的数组)，若不是，则将elements转化为Object类型的数组。进入步骤③</p>
</li>
<li>
<p>设置当前CopyOnWriteArrayList的Object[]为elements。</p>
</li>
</ol>
<ul>
<li>CopyOnWriteArrayList(E[])：该构造函数用于创建一个保存给定数组的副本的列表。</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">CopyOnWriteArrayList</span><span class="hljs-params">(E[] toCopyIn)</span> {
    <span class="hljs-comment">// 将toCopyIn转化为Object[]类型数组，然后设置当前数组</span>
    setArray(Arrays.copyOf(toCopyIn, toCopyIn.length, Object[].class));
}
</code></pre>
<h3 data-id="heading-6">核心函数分析</h3>
<p>对于CopyOnWriteArrayList的函数分析，主要明白Arrays.copyOf方法即可理解CopyOnWriteArrayList其他函数的意义。</p>
<h4 data-id="heading-7">copyOf函数</h4>
<p>该函数用于复制指定的数组，截取或用 null 填充(如有必要)，以使副本具有指定的长度。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T,U&gt; T[] copyOf(U[] original, <span class="hljs-type">int</span> newLength, Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">T</span>[]&gt; newType) {
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-comment">// 确定copy的类型(将newType转化为Object类型，将Object[].class转化为Object类型；</span>
    <span class="hljs-comment">// 判断两者是否相等，若相等，则生成指定长度的Object数组</span>
    <span class="hljs-comment">// 否则,生成指定长度的新类型的数组)</span>
    T[] copy = ((Object)newType == (Object)Object[].class)
        ? (T[]) <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[newLength]
        : (T[]) Array.newInstance(newType.getComponentType(), newLength);
    <span class="hljs-comment">// 将original数组从下标0开始，复制长度为(original.length和newLength的较小者),复制到copy数组中(也从下标0开始)</span>
    System.arraycopy(original, <span class="hljs-number">0</span>, copy, <span class="hljs-number">0</span>,
                        Math.min(original.length, newLength));
    <span class="hljs-keyword">return</span> copy;
}
</code></pre>
<h4 data-id="heading-8">add函数</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span> {
    <span class="hljs-comment">// 可重入锁</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.lock;
    <span class="hljs-comment">// 获取锁</span>
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 元素数组</span>
        Object[] elements = getArray();
        <span class="hljs-comment">// 数组长度</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> elements.length;
        <span class="hljs-comment">// 复制数组</span>
        Object[] newElements = Arrays.copyOf(elements, len + <span class="hljs-number">1</span>);
        <span class="hljs-comment">// 存放元素e</span>
        newElements[len] = e;
        <span class="hljs-comment">// 设置数组</span>
        setArray(newElements);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// 释放锁</span>
        lock.unlock();
    }
}
</code></pre>
<p>此函数用于将指定元素添加到此列表的尾部，处理流程如下</p>
<ol>
<li>获取锁(保证多线程的安全访问)，获取当前的Object数组，获取Object数组的长度为length，进入步骤②。</li>
<li>根据Object数组复制一个长度为length+1的Object数组为newElements(此时，newElements[length]为null)，进入下一步骤。</li>
<li>将下标为length的数组元素newElements[length]设置为元素e，再设置当前Object[]为newElements，释放锁，返回。这样就完成了元素的添加。</li>
</ol>
<h4 data-id="heading-9">addIfAbsent方法</h4>
<p>该函数用于添加元素(如果数组中不存在，则添加；否则，不添加，直接返回)，可以保证多线程环境下不会重复添加元素。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addIfAbsent</span><span class="hljs-params">(E e, Object[] snapshot)</span> {
    <span class="hljs-comment">// 重入锁</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.lock;
    <span class="hljs-comment">// 获取锁</span>
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 获取数组</span>
        Object[] current = getArray();
        <span class="hljs-comment">// 数组长度</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> current.length;
        <span class="hljs-keyword">if</span> (snapshot != current) { <span class="hljs-comment">// 快照不等于当前数组，对数组进行了修改</span>
            <span class="hljs-comment">// Optimize for lost race to another addXXX operation</span>
            <span class="hljs-comment">// 取较小者</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">common</span> <span class="hljs-operator">=</span> Math.min(snapshot.length, len);
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; common; i++) <span class="hljs-comment">// 遍历</span>
                <span class="hljs-keyword">if</span> (current[i] != snapshot[i] &amp;&amp; eq(e, current[i])) <span class="hljs-comment">// 当前数组的元素与快照的元素不相等并且e与当前元素相等</span>
                    <span class="hljs-comment">// 表示在snapshot与current之间修改了数组，并且设置了数组某一元素为e，已经存在</span>
                    <span class="hljs-comment">// 返回</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (indexOf(e, current, common, len) &gt;= <span class="hljs-number">0</span>) <span class="hljs-comment">// 在当前数组中找到e元素</span>
                <span class="hljs-comment">// 返回</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-comment">// 复制数组</span>
        Object[] newElements = Arrays.copyOf(current, len + <span class="hljs-number">1</span>);
        <span class="hljs-comment">// 对数组len索引的元素赋值为e</span>
        newElements[len] = e;
        <span class="hljs-comment">// 设置数组</span>
        setArray(newElements);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// 释放锁</span>
        lock.unlock();
    }
}
</code></pre>
<p>该函数的流程如下:</p>
<ol>
<li>
<p>获取锁，获取当前数组为current，current长度为len，判断数组之前的快照snapshot是否等于当前数组current，若不相等，则进入步骤2；否则，进入步骤4</p>
</li>
<li>
<p>不相等，表示在snapshot与current之间，对数组进行了修改(如进行了add、set、remove等操作)，获取长度(snapshot与current之间的较小者)，对current进行遍历操作，若遍历过程发现snapshot与current的元素不相等并且current的元素与指定元素相等(可能进行了set操作)，进入步骤5，否则，进入步骤3</p>
</li>
<li>
<p>在当前数组中索引指定元素，若能够找到，进入步骤5，否则，进入步骤4</p>
</li>
<li>
<p>复制当前数组current为newElements，长度为len+1，此时newElements[len]为null。再设置newElements[len]为指定元素e，再设置数组，进入步骤5</p>
</li>
<li>
<p>释放锁，返回。</p>
</li>
</ol>
<h4 data-id="heading-10">set函数</h4>
<p>此函数用于用指定的元素替代此列表指定位置上的元素，也是基于数组的复制来实现的。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> E <span class="hljs-title function_">set</span><span class="hljs-params">(<span class="hljs-type">int</span> index, E element)</span> {
    <span class="hljs-comment">// 可重入锁</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.lock;
    <span class="hljs-comment">// 获取锁</span>
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 获取数组</span>
        Object[] elements = getArray();
        <span class="hljs-comment">// 获取index索引的元素</span>
        <span class="hljs-type">E</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> get(elements, index);

        <span class="hljs-keyword">if</span> (oldValue != element) { <span class="hljs-comment">// 旧值等于element</span>
            <span class="hljs-comment">// 数组长度</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> elements.length;
            <span class="hljs-comment">// 复制数组</span>
            Object[] newElements = Arrays.copyOf(elements, len);
            <span class="hljs-comment">// 重新赋值index索引的值</span>
            newElements[index] = element;
            <span class="hljs-comment">// 设置数组</span>
            setArray(newElements);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// Not quite a no-op; ensures volatile write semantics</span>
            <span class="hljs-comment">// 设置数组</span>
            setArray(elements);
        }
        <span class="hljs-comment">// 返回旧值</span>
        <span class="hljs-keyword">return</span> oldValue;
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// 释放锁</span>
        lock.unlock();
    }
}
</code></pre>
<h4 data-id="heading-11">remove函数</h4>
<p>此函数用于移除此列表指定位置上的元素。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> E <span class="hljs-title function_">remove</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> {
    <span class="hljs-comment">// 可重入锁</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.lock;
    <span class="hljs-comment">// 获取锁</span>
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 获取数组</span>
        Object[] elements = getArray();
        <span class="hljs-comment">// 数组长度</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> elements.length;
        <span class="hljs-comment">// 获取旧值</span>
        <span class="hljs-type">E</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> get(elements, index);
        <span class="hljs-comment">// 需要移动的元素个数</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">numMoved</span> <span class="hljs-operator">=</span> len - index - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (numMoved == <span class="hljs-number">0</span>) <span class="hljs-comment">// 移动个数为0</span>
            <span class="hljs-comment">// 复制后设置数组</span>
            setArray(Arrays.copyOf(elements, len - <span class="hljs-number">1</span>));
        <span class="hljs-keyword">else</span> { <span class="hljs-comment">// 移动个数不为0</span>
            <span class="hljs-comment">// 新生数组</span>
            Object[] newElements = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[len - <span class="hljs-number">1</span>];
            <span class="hljs-comment">// 复制index索引之前的元素</span>
            System.arraycopy(elements, <span class="hljs-number">0</span>, newElements, <span class="hljs-number">0</span>, index);
            <span class="hljs-comment">// 复制index索引之后的元素</span>
            System.arraycopy(elements, index + <span class="hljs-number">1</span>, newElements, index,
                                numMoved);
            <span class="hljs-comment">// 设置索引</span>
            setArray(newElements);
        }
        <span class="hljs-comment">// 返回旧值</span>
        <span class="hljs-keyword">return</span> oldValue;
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// 释放锁</span>
        lock.unlock();
    }
}
</code></pre>
<p>处理流程如下</p>
<ol>
<li>获取锁，获取数组elements，数组长度为length，获取索引的值elements[index]，计算需要移动的元素个数(length - index - 1),若个数为0，则表示移除的是数组的最后一个元素，复制elements数组，复制长度为length-1，然后设置数组，进入步骤③；否则，进入步骤②</li>
<li>先复制index索引前的元素，再复制index索引后的元素，然后设置数组。</li>
<li>释放锁，返回旧值</li>
<li/>
</ol>
<h2 data-id="heading-12">CopyOnWriteArrayList是Fail Safe的</h2>
<p>采用安全失败机制的集合容器，在遍历时不是直接在集合内容上访问的，而是先复制原有集合内容，在拷贝的集合上进行遍历。java.util.concurrent包下的容器都是安全失败，可以在多线程下并发使用，并发修改。</p>
<p>原理：由于迭代时是对原集合的拷贝进行遍历，所以在遍历过程中对原集合所作的修改并不能被迭代器检测到，所以不会触发Concurrent Modification Exception。</p>
<p>缺点：基于拷贝内容的优点是避免了Concurrent Modification Exception，但同样地，迭代器并不能访问到修改后的内容，即：迭代器遍历的是开始遍历那一刻拿到的集合拷贝，在遍历期间原集合发生的修改迭代器是不知道的。</p>
<p>Vector无论是add方法还是get方法都加上了<strong>synchronized</strong>修饰，当多线程读写List必须排队执行，很显然这样效率比较是低下的，CopyOnWriteArrayList是读写分离的，好处是提高线程访问效率。</p>
<h2 data-id="heading-13">缺陷和使用场景</h2>
<ul>
<li>
<p>CopyOnWriteArrayList的写效率比Vector慢。当CopyOnWriteArrayList写元素时是通过备份数组的方式实现的，当多线程同步激烈，数据量较大时会不停的<strong>复制数组，内存浪费严重</strong>。如果原数组的内容比较多的情况下，可能导致young gc或者full gc</p>
</li>
<li>
<p>弱一致性：不能用于实时读的场景，像拷贝数组、新增元素都需要时间，所以调用一个set操作后，读取到数据可能还是旧的，虽然CopyOnWriteArrayList 能做到最终一致性，但是还是没法满足实时性要求；</p>
</li>
</ul>
<p><strong>小结：</strong> CopyOnWriteArrayList合适读多写少的场景，例如黑名单白名单等</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot自动配置的5个秘密，90%开发者都不知道]]></title>    <link>https://juejin.cn/post/7598588085597978664</link>    <guid>https://juejin.cn/post/7598588085597978664</guid>    <pubDate>2026-01-26T00:19:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598588085597978664" data-draft-id="7598710324167835663" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot自动配置的5个秘密，90%开发者都不知道"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-26T00:19:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot自动配置的5个秘密，90%开发者都不知道
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:19:01.000Z" title="Mon Jan 26 2026 00:19:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot自动配置的5个秘密，90%开发者都不知道</strong></h2>
<h3 data-id="heading-1">引言</h3>
<p>SpringBoot的自动配置（Auto-Configuration）是其核心特性之一，它通过约定优于配置的原则极大地简化了Spring应用的开发。然而，大多数开发者仅仅停留在“开箱即用”的层面，对自动配置背后的机制和隐藏技巧知之甚少。本文将揭示5个关于SpringBoot自动配置的“秘密”，帮助你更深入地理解其工作原理，并在实际开发中游刃有余。</p>
<hr/>
<h3 data-id="heading-2">1. 条件注解的真正威力：<code>@Conditional</code>家族的隐藏用法</h3>
<h4 data-id="heading-3">背景</h4>
<p>SpringBoot的自动配置依赖于一系列<code>@Conditional</code>注解（如<code>@ConditionalOnClass</code>、<code>@ConditionalOnProperty</code>等），但很少有人深入研究它们的组合使用和自定义扩展。</p>
<h4 data-id="heading-4">秘密解析</h4>
<ul>
<li><strong>组合条件</strong>：可以通过<code>AnyNestedCondition</code>或<code>AllNestedConditions</code>实现复杂的逻辑判断。例如：
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OnDatabaseType</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AllNestedConditions</span> {
    OnDatabaseType() {
        <span class="hljs-built_in">super</span>(ConfigurationPhase.PARSE_CONFIGURATION);
    }
    <span class="hljs-meta">@ConditionalOnProperty(name = "db.type", havingValue = "mysql")</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OnMySQL</span> {}
    <span class="hljs-meta">@ConditionalOnProperty(name = "db.type", havingValue = "postgresql")</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OnPostgreSQL</span> {}
}
</code></pre>
</li>
<li><strong>自定义条件</strong>：继承<code>Condition</code>接口可以实现完全自定义的条件逻辑。例如根据环境变量动态加载配置。</li>
</ul>
<h4 data-id="heading-5">实战建议</h4>
<p>在编写Starter时，灵活使用组合条件和自定义条件可以大幅提升自动配置的灵活性。</p>
<hr/>
<h3 data-id="heading-6">2. <code>spring.factories</code>的替代方案：从SPI到现代注解</h3>
<h4 data-id="heading-7">背景</h4>
<p>传统上，SpringBoot通过<code>META-INF/spring.factories</code>文件定义自动配置类，但这种方式缺乏类型安全和IDE支持。</p>
<h4 data-id="heading-8">秘密解析</h4>
<ul>
<li><strong>SPI替代方案</strong>：SpringBoot 2.7+引入了新的方式——直接在类上使用注解：
<ol>
<li><code>@AutoConfiguration</code>标记自动配置类。</li>
<li><code>@ImportAutoConfiguration</code>显式导入其他自动配置类。</li>
<li><code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>文件逐步取代传统的<code>.factories</code>.</li>
</ol>
示例：
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@AutoConfiguration</span>
<span class="hljs-meta">@ConditionalOnClass(DataSource.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSourceAutoConfiguration</span> {}
</code></pre>
</li>
</ul>
<h4 data-id="heading-9">实战建议</h4>
<p>新项目优先使用注解方式，老项目可以逐步迁移以提升可维护性。</p>
<hr/>
<h3 data-id="heading-10">3. Bean加载顺序的控制魔法：<code>@AutoConfigureOrder</code>与依赖关系</h3>
<h4 data-id="heading-11">背景</h4>
<p>当多个自动配置类存在依赖关系时，Bean的加载顺序可能成为难题。大部分开发者仅知道通过`.factories中的数字排序控制顺序。</p>
<h4 data-id="heading-12">秘密解析</h4>
<ul>
<li><strong>精细控制</strong>：
<ol>
<li><code>@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</code>全局生效。</li>
<li><code>@AutoConfigureAfter(OtherConfig.class)</code>或<code>@AutoConfigureBefore(OtherConfig.class)</code>精确控制相对顺序。</li>
<li><strong>隐藏陷阱</strong>：这些注解仅对自动配置类有效！普通Bean需结合标准Spring机制（如方法调用顺序）。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-13">实战建议</h4>
<p>在开发复杂Starter时务必显式声明依赖关系以避免隐式问题。</p>
<hr/>
<h3 data-id="heading-14">4. “负条件”的黑科技：如何优雅禁用默认配置</h3>
<h4 data-id="heading-15">背景</h4>
<p>有时我们需要禁用某些默认的自动配置（比如禁用内嵌Tomcat），常见做法是使用排除属性(<code>exclude</code>)或配置文件(<code>spring.autoconfigure.exclude=</code>)。</p>
<h4 data-id="heading-16">秘密解析</h4>
<p>更优雅的方式是通过“负条件”实现：</p>
<ol>
<li><strong>反向利用条件注解</strong>：
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ConditionalOnMissingClass("com.example.ForbiddenClass")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FallbackConfig</span> {}
</code></pre>
</li>
<li><strong>动态排除</strong>：
通过环境变量动态决定是否排除：
<pre><code class="hljs language-properties" lang="properties">spring.autoconfigure.exclude[0]=org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
</code></pre>
</li>
</ol>
<h4 data-id="heading-17">实战建议</h4>
<p>优先选择基于条件的动态禁用而非硬编码排除。</p>
<hr/>
<h3 data-id="heading-18">5. Profile与分阶段加载的秘密分层策略</h3>
<h4 data-id="heading-19">Background</h4>
<p>大多数开发者认为Profile只是简单的环境隔离工具，但结合自动配置可以实现更强大的功能。</p>
<h4 data-id="heading-20">Secret Details</h4>
<ol>
<li><strong>分阶段激活</strong>：
结合Profile和条件注解可实现多层级激活策略：
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Profile("cloud")</span>
<span class="hljs-meta">@ConditionalOnCloudPlatform(CloudPlatform.KUBERNETES)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KubernetesSpecificConfig</span> {}

<span class="hljs-meta">@Profile("local")</span>
<span class="hljs-meta">@ConditionalOnNotWebApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchProcessingConfig</span> {}
</code></pre>
</li>
</ol>
<p>2.<strong>Meta-Annotation技巧</strong>
创建复合注解简化Profile管理:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target({ElementType.TYPE})</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Profile("prod")</span>
<span class="hljs-keyword">public</span><span class="hljs-meta">@interface</span> ProductionReady{}
</code></pre>
<p>3.<strong>测试场景的特殊处理</strong>
测试环境中可以强制覆盖特定profile:</p>
<pre><code class="hljs language-properties" lang="properties">#test/resources/application-test.properties 
spring.profiles.active=test,mock-services
</code></pre>
<hr/>
<h2 data-id="heading-21">Conclusion</h2>
<p>Spring Boot Auto-configuration hides far more powerful features than most developers realize.From mastering the full potential of conditional annotations to leveraging modern alternatives for spring.factories,these secrets can significantly elevate your configuration game.Remember that great power comes with great responsibility-use these techniques judiciously to keep your configurations maintainable and debuggable.</p>
<p>The next time you work on a Spring Boot project,try applying one of these hidden gems.You might be surprised how much cleaner and more flexible your auto-configuration can become!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 定时任务多实例互斥执行]]></title>    <link>https://juejin.cn/post/7598767580306423862</link>    <guid>https://juejin.cn/post/7598767580306423862</guid>    <pubDate>2026-01-26T00:22:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598767580306423862" data-draft-id="7598921649888444443" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot 定时任务多实例互斥执行"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-26T00:22:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风象南"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot 定时任务多实例互斥执行
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风象南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:22:26.000Z" title="Mon Jan 26 2026 00:22:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Spring Boot 的 <code>@Scheduled</code> 写定时任务很方便，但多实例部署时有个问题：同一个定时任务会在每台机器上都触发执行。</p>
<p>比如部署了两台应用服务器，凌晨 2 点的数据统计任务会同时跑两遍，数据重复、文件重复生成。</p>
<p>解决这个问题通常有几种思路。</p>
<h2 data-id="heading-0">常见方案</h2>
<p><strong>方案一：单机执行</strong></p>
<p>只在一台指定的机器上跑任务：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Scheduled(cron = "0 0 2 * * ?")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduledTask</span><span class="hljs-params">()</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">hostname</span> <span class="hljs-operator">=</span> InetAddress.getLocalHost().getHostName();
    <span class="hljs-keyword">if</span> (!<span class="hljs-string">"app-server-01"</span>.equals(hostname)) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// do something</span>
}
</code></pre>
<p>问题很明显：那台机器挂了，任务就不执行了。</p>
<p><strong>方案二：Redis 分布式锁</strong></p>
<p>用 Redis 的 SETNX 实现互斥（或者Redission）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Scheduled(cron = "0 0 2 * * ?")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduledTask</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Boolean</span> <span class="hljs-variable">locked</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue()
        .setIfAbsent(<span class="hljs-string">"task:data-sync"</span>, <span class="hljs-string">"1"</span>, <span class="hljs-number">10</span>, TimeUnit.MINUTES);
    <span class="hljs-keyword">if</span> (Boolean.FALSE.equals(locked)) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// do something</span>
    } <span class="hljs-keyword">finally</span> {
        stringRedisTemplate.delete(<span class="hljs-string">"task:data-sync"</span>);
    }
}
</code></pre>
<p>能用，但每个任务都要写一遍加锁释放逻辑，而且需要项目里有 Redis。</p>
<h2 data-id="heading-1">ShedLock 方案</h2>
<p>ShedLock 是一个专门解决定时任务重复执行问题的框架，支持多种存储后端（数据库、Redis、MongoDB 等）。</p>
<p>核心思路：在存储层记录每个任务的锁状态，任务执行前先抢锁，抢到了才执行。</p>
<h4 data-id="heading-2">集成步骤</h4>
<p><strong>1. 添加依赖</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.javacrumbs.shedlock<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shedlock-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.42.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.javacrumbs.shedlock<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shedlock-provider-jdbc-template<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.42.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>2. 创建锁表</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> shedlock (
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    lock_until <span class="hljs-type">TIMESTAMP</span>(<span class="hljs-number">3</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    locked_at <span class="hljs-type">TIMESTAMP</span>(<span class="hljs-number">3</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    locked_by <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (name)
);
</code></pre>
<p><strong>3. 配置 LockProvider</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableSchedulerLock(defaultLockAtMostFor = "10m")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShedLockConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> LockProvider <span class="hljs-title function_">lockProvider</span><span class="hljs-params">(DataSource dataSource)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcTemplateLockProvider</span>(
            JdbcTemplateLockProvider.Configuration.builder()
                .withDataSource(dataSource)
                .withTableName(<span class="hljs-string">"shedlock"</span>)
                .build()
        );
    }
}
</code></pre>
<p><strong>4. 给定时任务加注解</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Scheduled(cron = "0 0 2 * * ?")</span>
<span class="hljs-meta">@SchedulerLock(name = "dataSyncTask", lockAtMostFor = "5m")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">syncData</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// do something</span>
}
</code></pre>
<p>完成。多台服务器部署时，只有抢到锁的那台会执行任务。</p>
<h2 data-id="heading-3">注解参数说明</h2>
<p><code>@SchedulerLock</code> 有几个关键参数：</p>
<p><strong>name</strong>：锁名称，相同 name 的任务会互斥执行。建议用任务名来命名，保持唯一。</p>
<p><strong>lockAtMostFor</strong>：锁的最大持有时间。</p>
<p>这是为了防止任务执行过程中机器宕机，导致锁永远不释放。比如设置 <code>5m</code>，即使任务执行超时，锁也会在 5 分钟后自动过期。</p>
<p>一般按任务预期执行时间的 2 倍左右设置，留些余量。</p>
<p><strong>lockAtLeastFor</strong>：锁的最小持有时间。</p>
<p>这是为了防止任务执行太快，锁立即释放被其他机器抢到。</p>
<p>比如定时任务每分钟执行一次，任务 5 秒就跑完了。如果没有这个参数，其他机器可能会在同一分钟内再次抢到锁执行。</p>
<p>这种情况下可以设置 <code>lockAtLeastFor = "1m"</code>，确保锁保持到下一分钟。</p>
<h2 data-id="heading-4">实现原理</h2>
<p>ShedLock 的实现逻辑不复杂。</p>
<p>任务执行前，会向数据库插入或更新锁记录：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> shedlock (name, lock_until, locked_at, locked_by)
<span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'dataSyncTask'</span>, <span class="hljs-string">'2025-01-25 02:05:00'</span>, NOW(), <span class="hljs-string">'192.168.1.10'</span>)
<span class="hljs-keyword">ON</span> DUPLICATE KEY <span class="hljs-keyword">UPDATE</span>
  lock_until <span class="hljs-operator">=</span> <span class="hljs-string">'2025-01-25 02:05:00'</span>,
  locked_at <span class="hljs-operator">=</span> NOW(),
  locked_by <span class="hljs-operator">=</span> <span class="hljs-string">'192.168.1.10'</span>
<span class="hljs-keyword">WHERE</span> lock_until <span class="hljs-operator">&lt;</span> NOW();
</code></pre>
<p>关键是最后的 <code>WHERE lock_until &lt; NOW()</code> 条件：</p>
<ul>
<li>如果当前锁已过期，UPDATE 成功，抢到锁</li>
<li>如果当前锁未过期，UPDATE 影响行数为 0，抢锁失败，任务不执行</li>
</ul>
<p>任务执行完成后不需要主动释放锁，等待 <code>lock_until</code> 时间到期即可。</p>
<h2 data-id="heading-5">适用场景</h2>
<p>ShedLock 的定位很明确：专门为定时任务设计的分布式锁框架。</p>
<p><strong>适合</strong></p>
<ul>
<li>定时任务需要互斥执行，避免重复</li>
<li>希望用注解方式简化锁的代码逻辑</li>
<li>需要自动锁过期机制，防止死锁</li>
</ul>
<p><strong>不适合</strong></p>
<ul>
<li>高并发抢锁的业务场景（比如秒杀、库存扣减），ShedLock 不是为此设计</li>
<li>需要可重入锁、读写锁等复杂特性</li>
<li>需要精确控制锁获取和释放时机的业务逻辑</li>
</ul>
<p>ShedLock 和通用分布式锁是互补关系，不是替代关系。如果你的业务代码里需要手动加锁解锁，用 Redisson 或手动实现 Redis SETNX 更合适。但如果只是为了解决定时任务重复执行的问题，ShedLock 是更简洁的方案。</p>
<h2 data-id="heading-6">几个注意事项</h2>
<p><strong>1. 存储后端选择</strong></p>
<p>本文演示用的是 JDBC 方式（基于数据库表）。ShedLock 还支持 Redis、MongoDB、ZooKeeper、Hazelcast 等多种存储后端，根据项目现有技术栈选择即可。</p>
<p><strong>2. 表名自定义（数据库存储时）</strong></p>
<p>如果用 JDBC 作为存储后端，默认表名是 <code>shedlock</code>，可以按需修改：
<strong>3. 机器标识</strong></p>
<p><code>locked_by</code> 字段记录是哪台机器拿到的锁，默认是主机名。可以自定义成更有意义的标识：</p>
<pre><code class="hljs language-java" lang="java">.withLockedByValue(<span class="hljs-string">"app-"</span> + getServerIp())
</code></pre>
<p><strong>4. 主从/多数据源场景（数据库存储时）</strong></p>
<p>如果项目有多个数据源，确保 ShedLock 用的是主库，避免主从延迟导致的锁问题。</p>
<h2 data-id="heading-7">总结</h2>
<p>ShedLock 是一个专门为定时任务设计的分布式锁框架：</p>
<ul>
<li>优点：注解式使用、集成简单、自动锁过期、支持多种存储后端</li>
<li>局限性：只适用于定时任务场景，不适用于通用业务加锁</li>
</ul>
<p>和手动写 Redis 分布式锁相比，ShedLock 把定时任务锁的逻辑抽象出来了，代码更简洁。但如果你需要的是通用业务锁，还是用 Redisson 或手写 SETNX 更合适。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第6章、函数的艺术——定义、多返回值与闭包]]></title>    <link>https://juejin.cn/post/7598710324167852047</link>    <guid>https://juejin.cn/post/7598710324167852047</guid>    <pubDate>2026-01-26T00:42:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598710324167852047" data-draft-id="7598588085598011432" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 第6章、函数的艺术——定义、多返回值与闭包"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-01-26T00:42:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怕浪猫"/> <meta itemprop="url" content="https://juejin.cn/user/2832784963939438"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             第6章、函数的艺术——定义、多返回值与闭包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2832784963939438/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怕浪猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:42:04.000Z" title="Mon Jan 26 2026 00:42:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好～ 前面我们掌握了Go的基础语法和控制结构，今天进入Go编程的核心模块——函数。函数是代码的“最小复用单元”，也是组织业务逻辑的核心载体。Go的函数设计非常有特色，不仅支持多返回值、命名返回值等实用特性，还将函数视为“一等公民”，支持函数值、匿名函数和闭包，为函数式编程提供了基础。</p>
<p>本文会从“基础定义”到“高级特性”逐步拆解，结合大量实战代码示例，把函数的用法、底层机制和最佳实践讲透。无论你是刚入门的新手，还是需要夯实基础的开发者，这篇文章都能帮你掌握Go函数的“艺术”。</p>
<h2 data-id="heading-0">1. 函数定义与参数传递机制</h2>
<p>函数定义是使用函数的基础，Go的函数定义语法简洁清晰，同时参数传递机制（值传递）是理解后续高级特性的关键，必须先吃透。</p>
<h3 data-id="heading-1">1.1 基础函数定义语法</h3>
<p>Go函数的核心定义语法：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 函数声明：func 函数名(参数列表) (返回值列表) { 函数体 }</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> 函数名<span class="hljs-params">(参数名1 类型1, 参数名2 类型2)</span></span> (返回值类型<span class="hljs-number">1</span>, 返回值类型<span class="hljs-number">2</span>) {
    <span class="hljs-comment">// 函数逻辑</span>
    <span class="hljs-keyword">return</span> 返回值<span class="hljs-number">1</span>, 返回值<span class="hljs-number">2</span>
}

</code></pre>
<p>关键说明：</p>
<ul>
<li>
<p><code>func</code>：关键字，标记函数定义的开始；</p>
</li>
<li>
<p>参数列表：多个参数用逗号分隔，<strong>类型后置</strong>（Go的特色语法，更注重参数名的可读性）；如果多个参数类型相同，可简写（如<code>a, b int</code>）；</p>
</li>
<li>
<p>返回值列表：支持0个、1个或多个返回值；如果只有1个返回值，可省略括号；</p>
</li>
<li>
<p>函数体：必须用大括号<code>{}</code>包裹，即使只有一行代码。</p>
</li>
</ul>
<h3 data-id="heading-2">1.2 基础示例：不同类型的函数定义</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 1. 无参数、无返回值</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sayHello</span><span class="hljs-params">()</span></span> {
    fmt.Println(<span class="hljs-string">"Hello, Go!"</span>)
}

<span class="hljs-comment">// 2. 有参数、无返回值（多个同类型参数简写）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">printSum</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> {
    fmt.Printf(<span class="hljs-string">"%d + %d = %d\n"</span>, a, b, a+b)
}

<span class="hljs-comment">// 3. 有参数、单个返回值（省略返回值括号）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> a + b
}

<span class="hljs-comment">// 4. 有参数、多个返回值</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">divide</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> (<span class="hljs-type">int</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">if</span> b == <span class="hljs-number">0</span> {
        <span class="hljs-comment">// 返回错误信息</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, fmt.Errorf(<span class="hljs-string">"除数不能为0"</span>)
    }
    <span class="hljs-keyword">return</span> a / b, <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    sayHello()                          <span class="hljs-comment">// 输出：Hello, Go!</span>
    printSum(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)                    <span class="hljs-comment">// 输出：10 + 20 = 30</span>
    sum := add(<span class="hljs-number">15</span>, <span class="hljs-number">25</span>)
    fmt.Println(<span class="hljs-string">"sum ="</span>, sum)           <span class="hljs-comment">// 输出：sum = 40</span>
    result, err := divide(<span class="hljs-number">20</span>, <span class="hljs-number">4</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"错误："</span>, err)
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"20 / 4 ="</span>, result) <span class="hljs-comment">// 输出：20 / 4 = 5</span>
    }
    <span class="hljs-comment">// 测试错误场景</span>
    result2, err2 := divide(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">if</span> err2 != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"错误："</span>, err2)      <span class="hljs-comment">// 输出：错误：除数不能为0</span>
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"10 / 0 ="</span>, result2)
    }
}

</code></pre>
<h3 data-id="heading-3">1.3 核心机制：参数传递——值传递</h3>
<p>Go的参数传递只有一种机制：<strong>值传递</strong>。即函数调用时，会将实参的“副本”传递给形参，函数内部对形参的修改，不会影响外部的实参。</p>
<p>很多新手会混淆“值类型参数”和“引用类型参数”的传递，这里要明确：<strong>无论参数是值类型（int、string、struct）还是引用类型（slice、map、chan），Go都是值传递</strong>——区别在于，引用类型的“副本”指向的是同一个底层数据结构，所以修改副本的“内容”会影响外部，而修改副本的“指向”则不会。</p>
<h3 data-id="heading-4">1.4 代码示例：值传递的细节</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 1. 值类型参数（int）：修改形参不影响实参</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">modifyInt</span><span class="hljs-params">(x <span class="hljs-type">int</span>)</span></span> {
    x = <span class="hljs-number">100</span> <span class="hljs-comment">// 修改的是副本</span>
}

<span class="hljs-comment">// 2. 引用类型参数（slice）：修改副本的内容，影响外部实参</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">modifySlice</span><span class="hljs-params">(s []<span class="hljs-type">int</span>)</span></span> {
    s[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span> <span class="hljs-comment">// 副本指向的底层数组不变，修改内容会影响外部</span>
    s = <span class="hljs-built_in">append</span>(s, <span class="hljs-number">40</span>) <span class="hljs-comment">// 修改副本的指向（扩容后指向新数组），不影响外部</span>
}

<span class="hljs-comment">// 3. 结构体参数（值传递）：修改形参不影响实参</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
    Age  <span class="hljs-type">int</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">modifyUser</span><span class="hljs-params">(u User)</span></span> {
    u.Age = <span class="hljs-number">30</span> <span class="hljs-comment">// 修改的是副本</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 测试值类型参数</span>
    x := <span class="hljs-number">10</span>
    modifyInt(x)
    fmt.Println(<span class="hljs-string">"x ="</span>, x) <span class="hljs-comment">// 输出：x = 10（未被修改）</span>

    <span class="hljs-comment">// 测试引用类型参数</span>
    s := []<span class="hljs-type">int</span>{<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>}
    modifySlice(s)
    fmt.Println(<span class="hljs-string">"s ="</span>, s) <span class="hljs-comment">// 输出：s = [100 20 30]（仅第一个元素被修改，append未生效）</span>

    <span class="hljs-comment">// 测试结构体参数</span>
    u := User{Name: <span class="hljs-string">"Alice"</span>, Age: <span class="hljs-number">20</span>}
    modifyUser(u)
    fmt.Println(<span class="hljs-string">"u ="</span>, u) <span class="hljs-comment">// 输出：u = {Alice 20}（未被修改）</span>
}

</code></pre>
<h3 data-id="heading-5">1.5 最佳实践</h3>
<ul>
<li>
<p>参数命名要清晰：避免使用a、b、c等模糊命名，用有语义的名称（如user、score、data）；</p>
</li>
<li>
<p>参数数量不宜过多：如果参数超过5个，建议封装为结构体（如<code>func updateUser(u User) error</code>），提升可读性；</p>
</li>
<li>
<p>修改外部数据的两种方式：① 传递引用类型参数（slice、map等）；② 让函数返回修改后的值，外部重新赋值；</p>
</li>
<li>
<p>避免传递大结构体：大结构体的值传递会拷贝大量数据，影响性能，建议传递结构体指针（<code>*User</code>）。</p>
</li>
</ul>
<h2 data-id="heading-6">2. 多返回值与错误处理惯例</h2>
<p>多返回值是Go的核心特色之一，彻底解决了其他语言（如Java）“单个返回值+异常”的繁琐设计。在Go中，多返回值最经典的应用场景是“返回结果+错误信息”，这也是Go的错误处理惯例。</p>
<h3 data-id="heading-7">2.1 多返回值的核心用法</h3>
<p>Go的多返回值支持两种接收方式：① 接收所有返回值；② 用<code>_</code>忽略不需要的返回值。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 多返回值：返回计算结果、平方、立方</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">calculate</span><span class="hljs-params">(x <span class="hljs-type">int</span>)</span></span> (<span class="hljs-type">int</span>, <span class="hljs-type">int</span>, <span class="hljs-type">int</span>) {
    sum := x + <span class="hljs-number">10</span>
    square := x * x
    cube := x * x * x
    <span class="hljs-keyword">return</span> sum, square, cube
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 接收所有返回值</span>
    sum, square, cube := calculate(<span class="hljs-number">5</span>)
    fmt.Printf(<span class="hljs-string">"sum=%d, square=%d, cube=%d\n"</span>, sum, square, cube) <span class="hljs-comment">// 输出：sum=15, square=25, cube=125</span>

    <span class="hljs-comment">// 2. 忽略不需要的返回值（用_）</span>
    _, sq, _ := calculate(<span class="hljs-number">6</span>)
    fmt.Printf(<span class="hljs-string">"6的平方=%d\n"</span>, sq) <span class="hljs-comment">// 输出：6的平方=36</span>
}

</code></pre>
<h3 data-id="heading-8">2.2 错误处理惯例：返回值末尾放error</h3>
<p>Go没有像Java那样的try-catch异常机制，而是通过“多返回值+error类型”实现错误处理。核心惯例：</p>
<ul>
<li>
<p>函数的最后一个返回值类型是<code>error</code>（内置接口类型）；</p>
</li>
<li>
<p>执行成功时，error返回<code>nil</code>；执行失败时，返回具体的错误信息；</p>
</li>
<li>
<p>调用函数后，<strong>必须先判断error是否为nil</strong>，再使用其他返回值（避免使用错误的结果）。</p>
</li>
</ul>
<h3 data-id="heading-9">2.3 代码示例：标准错误处理流程</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"errors"</span>
    <span class="hljs-string">"fmt"</span>
)

<span class="hljs-comment">// 模拟查询用户信息：返回用户信息和错误</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getUserByID</span><span class="hljs-params">(userID <span class="hljs-type">int</span>)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">int</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 模拟数据库查询</span>
    <span class="hljs-keyword">if</span> userID &lt;= <span class="hljs-number">0</span> {
        <span class="hljs-comment">// 返回错误信息（用errors.New或fmt.Errorf）</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, errors.New(<span class="hljs-string">"用户ID必须大于0"</span>)
    }
    <span class="hljs-keyword">if</span> userID == <span class="hljs-number">1001</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>, <span class="hljs-literal">nil</span> <span class="hljs-comment">// 成功：error为nil</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, fmt.Errorf(<span class="hljs-string">"未找到用户（ID：%d）"</span>, userID) <span class="hljs-comment">// 带参数的错误信息</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 标准错误处理流程：先判断error，再使用结果</span>
    username, age, err := getUserByID(<span class="hljs-number">1001</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// 错误处理：打印日志、返回等</span>
        fmt.Printf(<span class="hljs-string">"查询失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-comment">// 没有错误，使用结果</span>
    fmt.Printf(<span class="hljs-string">"查询成功：姓名=%s，年龄=%d\n"</span>, username, age) <span class="hljs-comment">// 输出：查询成功：姓名=Alice，年龄=25</span>

    <span class="hljs-comment">// 测试错误场景1：用户ID无效</span>
    _, _, err2 := getUserByID(<span class="hljs-number">-1</span>)
    <span class="hljs-keyword">if</span> err2 != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"查询失败：%v\n"</span>, err2) <span class="hljs-comment">// 输出：查询失败：用户ID必须大于0</span>
        <span class="hljs-keyword">return</span>
    }

    <span class="hljs-comment">// 测试错误场景2：用户不存在</span>
    _, _, err3 := getUserByID(<span class="hljs-number">1002</span>)
    <span class="hljs-keyword">if</span> err3 != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"查询失败：%v\n"</span>, err3) <span class="hljs-comment">// 输出：查询失败：未找到用户（ID：1002）</span>
        <span class="hljs-keyword">return</span>
    }
}

</code></pre>
<h3 data-id="heading-10">2.4 错误处理的最佳实践</h3>
<ul>
<li>
<p>错误信息要具体：包含关键上下文（如用户ID、文件名、参数值），方便排查问题；</p>
</li>
<li>
<p>不要忽略错误：即使你觉得“不可能出错”，也不要用<code>_</code>忽略error，否则会隐藏潜在问题；</p>
</li>
<li>
<p>错误传递时添加上下文：如果需要将错误向上传递（如在函数中调用其他函数），用<code>fmt.Errorf("上下文：%w", err)</code>包装错误（<code>%w</code>是Go 1.13+新增，保留原始错误）；</p>
</li>
<li>
<p>区分“预期错误”和“致命错误”：预期错误（如用户不存在、参数无效）返回error；致命错误（如内存溢出）用<code>panic</code>（后续章节讲解）。</p>
</li>
</ul>
<h2 data-id="heading-11">3. 命名返回值的使用技巧</h2>
<p>Go支持“命名返回值”，即定义函数时，给返回值指定名称。命名返回值会在函数开始时被自动初始化（零值），函数体中可以直接赋值，return时无需指定返回值（裸return）。</p>
<h3 data-id="heading-12">3.1 命名返回值的基础用法</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 命名返回值：sum（int类型）、err（error类型）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addWithCheck</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> (sum <span class="hljs-type">int</span>, err <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">if</span> a &lt; <span class="hljs-number">0</span> || b &lt; <span class="hljs-number">0</span> {
        err = fmt.Errorf(<span class="hljs-string">"参数不能为负数（a=%d, b=%d）"</span>, a, b)
        <span class="hljs-keyword">return</span> <span class="hljs-comment">// 裸return：自动返回sum和err</span>
    }
    sum = a + b
    <span class="hljs-keyword">return</span> <span class="hljs-comment">// 裸return：自动返回sum和err</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    sum, err := addWithCheck(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"错误："</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"sum ="</span>, sum) <span class="hljs-comment">// 输出：sum = 30</span>

    <span class="hljs-comment">// 测试错误场景</span>
    sum2, err2 := addWithCheck(<span class="hljs-number">-5</span>, <span class="hljs-number">10</span>)
    <span class="hljs-keyword">if</span> err2 != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"错误："</span>, err2) <span class="hljs-comment">// 输出：错误：参数不能为负数（a=-5, b=10）</span>
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"sum2 ="</span>, sum2)
}

</code></pre>
<h3 data-id="heading-13">3.2 命名返回值的核心优势与注意事项</h3>
<h4 data-id="heading-14">3.2.1 优势</h4>
<ul>
<li>
<p>提升代码可读性：返回值名称能直观说明返回值的含义（如sum、err、username）；</p>
</li>
<li>
<p>简化代码：函数体中无需重新声明返回值变量，直接赋值即可；裸return减少重复代码。</p>
</li>
</ul>
<h4 data-id="heading-15">3.2.2 注意事项</h4>
<ul>
<li>
<p>裸return容易出错：如果函数有多个命名返回值，裸return会自动返回所有命名返回值，若遗漏赋值，会返回零值（如int返回0，string返回""）；</p>
</li>
<li>
<p>不要过度使用：简单函数（如单个返回值）使用命名返回值意义不大，反而增加代码冗余；复杂函数（多个返回值、逻辑繁琐）使用命名返回值更合适；</p>
</li>
<li>
<p>命名要清晰：避免使用模糊的命名（如ret1、ret2），否则会降低可读性。</p>
</li>
</ul>
<h3 data-id="heading-16">3.3 最佳实践：命名返回值的适用场景</h3>
<ul>
<li>
<p>多个返回值的函数：尤其是返回值类型相近时（如<code>func getData() (int, int, error)</code>），命名返回值能明确区分每个返回值；</p>
</li>
<li>
<p>错误处理复杂的函数：函数体中有多个错误分支时，命名返回值的err可以统一赋值，裸return简化代码；</p>
</li>
<li>
<p>递归函数：递归函数的返回值通常固定，命名返回值能减少重复声明。</p>
</li>
</ul>
<h2 data-id="heading-17">4. 函数作为一等公民：函数值</h2>
<p>在Go中，函数是“一等公民”（First-Class Citizen），意味着：</p>
<ul>
<li>
<p>函数可以赋值给变量（即“函数值”）；</p>
</li>
<li>
<p>函数可以作为参数传递给其他函数；</p>
</li>
<li>
<p>函数可以作为其他函数的返回值；</p>
</li>
<li>
<p>函数可以在其他函数内部定义（匿名函数）。</p>
</li>
</ul>
<p>函数值是实现“函数作为一等公民”的基础，本质是“指向函数的指针”。</p>
<h3 data-id="heading-18">4.1 函数值的基础用法</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 定义两个函数，签名相同（参数类型、返回值类型相同）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> a + b
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">subtract</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> a - b
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 函数赋值给变量（函数值）</span>
    <span class="hljs-comment">// 变量f的类型是：func(int, int) int（函数签名）</span>
    <span class="hljs-keyword">var</span> f <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span>
    f = add <span class="hljs-comment">// 赋值add函数</span>
    fmt.Println(<span class="hljs-string">"10 + 20 ="</span>, f(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)) <span class="hljs-comment">// 输出：10 + 20 = 30</span>

    f = subtract <span class="hljs-comment">// 重新赋值subtract函数</span>
    fmt.Println(<span class="hljs-string">"10 - 20 ="</span>, f(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)) <span class="hljs-comment">// 输出：10 - 20 = -10</span>

    <span class="hljs-comment">// 2. 函数值作为参数传递</span>
    funcParam(f, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>) <span class="hljs-comment">// 输出：5 - 3 = -2</span>

    <span class="hljs-comment">// 3. 函数值作为返回值</span>
    multiplyFunc := getOperator(<span class="hljs-string">"multiply"</span>)
    fmt.Println(<span class="hljs-string">"5 * 3 ="</span>, multiplyFunc(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)) <span class="hljs-comment">// 输出：5 * 3 = 15</span>

    divideFunc := getOperator(<span class="hljs-string">"divide"</span>)
    fmt.Println(<span class="hljs-string">"6 / 2 ="</span>, divideFunc(<span class="hljs-number">6</span>, <span class="hljs-number">2</span>)) <span class="hljs-comment">// 输出：6 / 2 = 3</span>
}

<span class="hljs-comment">// 函数值作为参数</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">funcParam</span><span class="hljs-params">(op <span class="hljs-keyword">func</span>(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span>, a, b <span class="hljs-type">int</span>) {
    result := op(a, b)
    fmt.Printf(<span class="hljs-string">"%d op %d = %d\n"</span>, a, b, result)
}

<span class="hljs-comment">// 函数值作为返回值</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getOperator</span><span class="hljs-params">(operator <span class="hljs-type">string</span>)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">switch</span> operator {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"multiply"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> { <span class="hljs-comment">// 匿名函数作为返回值</span>
            <span class="hljs-keyword">return</span> a * b
        }
    <span class="hljs-keyword">case</span> <span class="hljs-string">"divide"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
            <span class="hljs-keyword">return</span> a / b
        }
    <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }
}

</code></pre>
<h3 data-id="heading-19">4.2 核心概念：函数签名</h3>
<p>函数值的类型由“函数签名”决定。函数签名是指：</p>
<ul>
<li>
<p>参数的类型和数量；</p>
</li>
<li>
<p>返回值的类型和数量；</p>
</li>
<li>
<p>参数名和返回值名不影响签名。</p>
</li>
</ul>
<p>只有签名完全相同的函数，才能赋值给同一个函数值变量。例如：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// 签名：func(int, int) int</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> { <span class="hljs-keyword">return</span> a + b }

<span class="hljs-comment">// 签名：func(int, int) int（参数名不同，但签名相同）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add2</span><span class="hljs-params">(x, y <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> { <span class="hljs-keyword">return</span> x + y }

<span class="hljs-comment">// 签名：func(int, int) (int, error)（返回值不同，签名不同）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addWithErr</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> (<span class="hljs-type">int</span>, <span class="hljs-type">error</span>) { <span class="hljs-keyword">return</span> a + b, <span class="hljs-literal">nil</span> }

<span class="hljs-keyword">var</span> f <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span>
f = add    <span class="hljs-comment">// 合法</span>
f = add2   <span class="hljs-comment">// 合法</span>
<span class="hljs-comment">// f = addWithErr // 非法：签名不匹配</span>

</code></pre>
<h3 data-id="heading-20">4.3 函数值的应用场景</h3>
<ul>
<li>
<p>实现“策略模式”：根据不同的场景，动态选择不同的函数逻辑（如上面的getOperator示例）；</p>
</li>
<li>
<p>简化回调函数：将函数作为参数传递，实现回调逻辑（如排序、过滤等）；</p>
</li>
<li>
<p>动态生成函数：根据条件返回不同的函数，实现逻辑复用。</p>
</li>
</ul>
<h2 data-id="heading-21">5. 匿名函数与立即执行函数</h2>
<p>匿名函数是“没有名称的函数”，核心作用是“临时使用”或“作为函数值的载体”。立即执行函数（IIFE）是匿名函数的一种特殊用法：定义后立即调用。</p>
<h3 data-id="heading-22">5.1 匿名函数的基础用法</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 匿名函数赋值给变量</span>
    add := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
        <span class="hljs-keyword">return</span> a + b
    }
    fmt.Println(<span class="hljs-string">"3 + 4 ="</span>, add(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)) <span class="hljs-comment">// 输出：3 + 4 = 7</span>

    <span class="hljs-comment">// 2. 匿名函数作为参数（简化代码）</span>
    numbers := []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>}
    <span class="hljs-comment">// 自定义过滤逻辑：保留偶数</span>
    evenNumbers := filter(numbers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> {
        <span class="hljs-keyword">return</span> n%<span class="hljs-number">2</span> == <span class="hljs-number">0</span>
    })
    fmt.Println(<span class="hljs-string">"偶数："</span>, evenNumbers) <span class="hljs-comment">// 输出：偶数： [2 4]</span>

    <span class="hljs-comment">// 自定义过滤逻辑：保留大于3的数</span>
    greaterThan3 := filter(numbers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> {
        <span class="hljs-keyword">return</span> n &gt; <span class="hljs-number">3</span>
    })
    fmt.Println(<span class="hljs-string">"大于3的数："</span>, greaterThan3) <span class="hljs-comment">// 输出：大于3的数： [4 5]</span>

    <span class="hljs-comment">// 3. 立即执行函数（IIFE）：定义后立即调用</span>
    <span class="hljs-comment">// 语法：(匿名函数)(参数)</span>
    result := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
        <span class="hljs-keyword">return</span> a * b
    }(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
    fmt.Println(<span class="hljs-string">"5 * 6 ="</span>, result) <span class="hljs-comment">// 输出：5 * 6 = 30</span>

    <span class="hljs-comment">// 4. 立即执行函数的常见用途：创建临时作用域</span>
    {
        x := <span class="hljs-number">10</span>
        fmt.Println(<span class="hljs-string">"局部作用域x ="</span>, x) <span class="hljs-comment">// 输出：局部作用域x = 10</span>
    }
    <span class="hljs-comment">// 用立即执行函数模拟</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        y := <span class="hljs-number">20</span>
        fmt.Println(<span class="hljs-string">"立即执行函数作用域y ="</span>, y) <span class="hljs-comment">// 输出：立即执行函数作用域y = 20</span>
    }()
    <span class="hljs-comment">// fmt.Println(x) // 编译报错：undefined: x</span>
    <span class="hljs-comment">// fmt.Println(y) // 编译报错：undefined: y</span>
}

<span class="hljs-comment">// 过滤函数：接收切片和过滤逻辑（匿名函数），返回过滤后的切片</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">filter</span><span class="hljs-params">(numbers []<span class="hljs-type">int</span>, condition <span class="hljs-keyword">func</span>(<span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span>) []<span class="hljs-type">int</span> {
    <span class="hljs-keyword">var</span> result []<span class="hljs-type">int</span>
    <span class="hljs-keyword">for</span> _, n := <span class="hljs-keyword">range</span> numbers {
        <span class="hljs-keyword">if</span> condition(n) {
            result = <span class="hljs-built_in">append</span>(result, n)
        }
    }
    <span class="hljs-keyword">return</span> result
}

</code></pre>
<h3 data-id="heading-23">5.2 立即执行函数的核心作用</h3>
<ul>
<li>
<p>创建临时作用域：避免变量污染全局或外层作用域（如上面的y变量，仅在立即执行函数内部有效）；</p>
</li>
<li>
<p>一次性执行逻辑：某些逻辑只需要执行一次（如初始化配置、加载资源），用立即执行函数封装，代码更整洁；</p>
</li>
<li>
<p>传递参数并立即处理：将参数传递给匿名函数，立即处理并返回结果，简化代码。</p>
</li>
</ul>
<h3 data-id="heading-24">5.3 最佳实践</h3>
<ul>
<li>
<p>匿名函数不宜过长：如果匿名函数逻辑复杂（超过10行），建议提取为命名函数，提升可读性；</p>
</li>
<li>
<p>立即执行函数用于临时逻辑：仅在需要“一次性执行+临时作用域”时使用，避免滥用；</p>
</li>
<li>
<p>匿名函数作为参数时，逻辑要简洁：如过滤、排序等简单逻辑，用匿名函数能简化代码；复杂逻辑建议用命名函数。</p>
</li>
</ul>
<h2 data-id="heading-25">6. 闭包的定义与变量捕获机制</h2>
<p>闭包（Closure）是Go函数的高级特性，也是函数式编程的核心。简单来说，<strong>闭包是“引用了外部变量的匿名函数”</strong>——这个匿名函数不仅包含自身的代码逻辑，还“捕获”了外部作用域的变量，即使外部作用域已经结束，闭包依然能访问和修改这些变量。</p>
<h3 data-id="heading-26">6.1 闭包的基础示例</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 定义一个函数，返回一个闭包</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">counter</span><span class="hljs-params">()</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">int</span> {
    count := <span class="hljs-number">0</span> <span class="hljs-comment">// 外部变量：被闭包捕获</span>
    <span class="hljs-comment">// 匿名函数（闭包）：引用了外部变量count</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">int</span> {
        count++ <span class="hljs-comment">// 修改捕获的变量</span>
        <span class="hljs-keyword">return</span> count
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 创建两个闭包实例</span>
    c1 := counter()
    c2 := counter()

    <span class="hljs-comment">// 调用闭包c1</span>
    fmt.Println(c1()) <span class="hljs-comment">// 输出：1</span>
    fmt.Println(c1()) <span class="hljs-comment">// 输出：2</span>
    fmt.Println(c1()) <span class="hljs-comment">// 输出：3</span>

    <span class="hljs-comment">// 调用闭包c2（独立的count变量）</span>
    fmt.Println(c2()) <span class="hljs-comment">// 输出：1</span>
    fmt.Println(c2()) <span class="hljs-comment">// 输出：2</span>

    <span class="hljs-comment">// 再次调用c1，继续累加</span>
    fmt.Println(c1()) <span class="hljs-comment">// 输出：4</span>
}

</code></pre>
<p>关键说明：</p>
<ul>
<li>
<p>counter函数返回一个闭包，闭包捕获了外部变量count；</p>
</li>
<li>
<p>每次调用counter()，都会创建一个新的count变量和新的闭包实例（c1和c2是两个独立的闭包，各自的count互不影响）；</p>
</li>
<li>
<p>即使counter函数执行结束（外部作用域结束），闭包依然能访问和修改count变量——这就是闭包的核心特性。</p>
</li>
</ul>
<h3 data-id="heading-27">6.2 核心机制：变量捕获</h3>
<p>闭包对外部变量的“捕获”，是按“引用”捕获，而不是按“值”捕获。这意味着：闭包内部修改的是外部变量的原始值，而不是副本。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">modifyExternal</span><span class="hljs-params">()</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    x := <span class="hljs-number">10</span>
    <span class="hljs-comment">// 闭包：捕获x的引用</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        x += <span class="hljs-number">5</span>
        fmt.Println(<span class="hljs-string">"x ="</span>, x)
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    f := modifyExternal()
    f() <span class="hljs-comment">// 输出：x = 15（修改原始x）</span>
    f() <span class="hljs-comment">// 输出：x = 20（继续修改）</span>

    <span class="hljs-comment">// 重新创建闭包，捕获新的x</span>
    f2 := modifyExternal()
    f2() <span class="hljs-comment">// 输出：x = 15（新的x）</span>
}

</code></pre>
<h3 data-id="heading-28">6.3 闭包捕获变量的细节</h3>
<p>闭包捕获的是“变量本身”，而不是变量在某个时刻的值。这个细节容易导致“意想不到的bug”，必须注意：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> funcs []<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>
    <span class="hljs-comment">// 循环创建闭包，捕获变量i</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {
        funcs = <span class="hljs-built_in">append</span>(funcs, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
            fmt.Println(<span class="hljs-string">"i ="</span>, i)
        })
    }
    <span class="hljs-comment">// 执行所有闭包</span>
    <span class="hljs-keyword">for</span> _, f := <span class="hljs-keyword">range</span> funcs {
        f()
    }
    <span class="hljs-comment">// 预期输出：0、1、2</span>
    <span class="hljs-comment">// 实际输出：3、3、3</span>
}

</code></pre>
<p>原因分析：</p>
<ul>
<li>
<p>循环中创建的所有闭包，捕获的是同一个变量i（循环变量i在循环过程中不断变化）；</p>
</li>
<li>
<p>当执行闭包时，循环已经结束，i的值已经变成3，所以所有闭包输出的都是3。</p>
</li>
</ul>
<p>解决方案：在循环内部创建临时变量，将i的值赋值给临时变量，闭包捕获临时变量（临时变量每次循环都会重新创建）：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> funcs []<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {
        temp := i <span class="hljs-comment">// 临时变量，每次循环重新创建</span>
        funcs = <span class="hljs-built_in">append</span>(funcs, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
            fmt.Println(<span class="hljs-string">"i ="</span>, temp)
        })
    }
    <span class="hljs-keyword">for</span> _, f := <span class="hljs-keyword">range</span> funcs {
        f()
    }
    <span class="hljs-comment">// 输出：0、1、2（符合预期）</span>
}

</code></pre>
<h2 data-id="heading-29">7. 闭包中的变量生命周期问题</h2>
<p>在Go中，变量的生命周期由“引用关系”决定：只要有变量被引用，就不会被垃圾回收（GC）。闭包的存在，会延长外部变量的生命周期——即使外部作用域已经结束，只要闭包还被引用，捕获的外部变量就不会被GC回收。</p>
<h3 data-id="heading-30">7.1 示例：闭包延长变量生命周期</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createClosure</span><span class="hljs-params">()</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 局部变量：正常情况下，createClosure执行结束后，x会被GC回收</span>
    x := <span class="hljs-number">100</span>
    fmt.Println(<span class="hljs-string">"createClosure：x被创建，地址="</span>, &amp;x)
    <span class="hljs-comment">// 闭包捕获x</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        fmt.Println(<span class="hljs-string">"闭包：x的值="</span>, x, <span class="hljs-string">"，地址="</span>, &amp;x)
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    f := createClosure() <span class="hljs-comment">// createClosure执行结束，但x被闭包捕获</span>
    f() <span class="hljs-comment">// 闭包依然能访问x，说明x未被GC回收</span>
    f() <span class="hljs-comment">// 再次访问，x依然存在</span>
}

</code></pre>
<p>输出结果：</p>
<pre><code class="hljs language-Plain" lang="Plain">
createClosure：x被创建，地址= 0xc00001a0a8
闭包：x的值= 100 ，地址= 0xc00001a0a8
闭包：x的值= 100 ，地址= 0xc00001a0a8

</code></pre>
<p>结论：闭包捕获的x变量，在createClosure执行结束后依然存在，地址不变，说明生命周期被延长。</p>
<h3 data-id="heading-31">7.2 注意事项：避免内存泄漏</h3>
<p>闭包延长变量生命周期的特性，可能导致“内存泄漏”——如果闭包被长期引用（如存储在全局变量中），且捕获的变量占用大量内存（如大切片、大结构体），这些变量会一直无法被GC回收，导致内存占用过高。</p>
<p>解决方案：</p>
<ul>
<li>
<p>避免捕获大变量：如果需要使用大变量的部分数据，可先提取为小变量，再让闭包捕获；</p>
</li>
<li>
<p>及时释放闭包引用：当闭包不再需要时，将闭包变量设为nil，切断引用，让GC回收捕获的变量；</p>
</li>
<li>
<p>合理设计闭包作用域：避免将闭包存储在全局变量中，尽量限制在局部作用域。</p>
</li>
</ul>
<h2 data-id="heading-32">8. 函数式编程思想在Go中的应用</h2>
<p>函数式编程是一种编程范式，核心思想是“用函数作为核心操作单元”，强调“纯函数”（无副作用）、“不可变数据”和“函数组合”。Go不是严格的函数式编程语言，但通过函数值、匿名函数和闭包，支持部分函数式编程思想，能极大提升代码的简洁性和可维护性。</p>
<h3 data-id="heading-33">8.1 核心应用1：纯函数</h3>
<p>纯函数是指“没有副作用”的函数：</p>
<ul>
<li>
<p>输入相同，输出必然相同；</p>
</li>
<li>
<p>不修改外部变量；</p>
</li>
<li>
<p>不执行IO操作（如打印、读写文件、网络请求）。</p>
</li>
</ul>
<p>纯函数的优势是“可预测性强”“易于测试”“线程安全”。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 纯函数：输入相同，输出相同；无副作用</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">pureAdd</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> a + b
}

<span class="hljs-comment">// 非纯函数：修改外部变量（有副作用）</span>
<span class="hljs-keyword">var</span> global <span class="hljs-type">int</span> = <span class="hljs-number">10</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">impureAdd</span><span class="hljs-params">(a <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    global += a <span class="hljs-comment">// 修改外部变量</span>
    <span class="hljs-keyword">return</span> global
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 纯函数：多次调用，输入相同输出相同</span>
    fmt.Println(pureAdd(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)) <span class="hljs-comment">// 输出：5</span>
    fmt.Println(pureAdd(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)) <span class="hljs-comment">// 输出：5</span>

    <span class="hljs-comment">// 非纯函数：多次调用，输入相同输出不同（受外部变量影响）</span>
    fmt.Println(impureAdd(<span class="hljs-number">2</span>)) <span class="hljs-comment">// 输出：12</span>
    fmt.Println(impureAdd(<span class="hljs-number">2</span>)) <span class="hljs-comment">// 输出：14</span>
}

</code></pre>
<h3 data-id="heading-34">8.2 核心应用2：函数组合</h3>
<p>函数组合是指“将多个简单函数组合成一个复杂函数”，核心是“函数作为参数或返回值”。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 函数1：加1</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add1</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> n + <span class="hljs-number">1</span>
}

<span class="hljs-comment">// 函数2：乘2</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">multiply2</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> n * <span class="hljs-number">2</span>
}

<span class="hljs-comment">// 函数组合：将两个函数f和g组合成一个新函数f(g(n))</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">compose</span><span class="hljs-params">(f, g <span class="hljs-keyword">func</span>(<span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span>) <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
        <span class="hljs-keyword">return</span> f(g(n))
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 组合函数：先乘2，再加1（multiply2 → add1）</span>
    addAfterMultiply := compose(add1, multiply2)
    fmt.Println(addAfterMultiply(<span class="hljs-number">3</span>)) <span class="hljs-comment">// 输出：3*2+1=7</span>

    <span class="hljs-comment">// 组合函数：先加1，再乘2（add1 → multiply2）</span>
    multiplyAfterAdd := compose(multiply2, add1)
    fmt.Println(multiplyAfterAdd(<span class="hljs-number">3</span>)) <span class="hljs-comment">// 输出：(3+1)*2=8</span>
}

</code></pre>
<h3 data-id="heading-35">8.3 核心应用3：高阶函数处理集合</h3>
<p>高阶函数是指“接收函数作为参数”或“返回函数作为结果”的函数。在Go中，高阶函数常用于处理集合（切片、map），实现过滤、映射、折叠等通用逻辑。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 映射（Map）：将切片中的每个元素通过函数f转换，返回新切片</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">mapSlice</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>, <span class="hljs-title">U</span> <span class="hljs-title">any</span>]<span class="hljs-params">(slice []T, f <span class="hljs-keyword">func</span>(T)</span></span> U) []U {
    <span class="hljs-keyword">var</span> result []U
    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> slice {
        result = <span class="hljs-built_in">append</span>(result, f(v))
    }
    <span class="hljs-keyword">return</span> result
}

<span class="hljs-comment">// 过滤（Filter）：保留切片中满足函数f条件的元素，返回新切片</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">filterSlice</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>]<span class="hljs-params">(slice []T, f <span class="hljs-keyword">func</span>(T)</span></span> <span class="hljs-type">bool</span>) []T {
    <span class="hljs-keyword">var</span> result []T
    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> slice {
        <span class="hljs-keyword">if</span> f(v) {
            result = <span class="hljs-built_in">append</span>(result, v)
        }
    }
    <span class="hljs-keyword">return</span> result
}

<span class="hljs-comment">// 折叠（Reduce）：将切片中的元素通过函数f累积为一个值</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">reduceSlice</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>, <span class="hljs-title">U</span> <span class="hljs-title">any</span>]<span class="hljs-params">(slice []T, f <span class="hljs-keyword">func</span>(U, T)</span></span> U, initial U) U {
    result := initial
    <span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> slice {
        result = f(result, v)
    }
    <span class="hljs-keyword">return</span> result
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    numbers := []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>}

    <span class="hljs-comment">// 1. 映射：将每个元素乘2</span>
    doubled := mapSlice(numbers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
        <span class="hljs-keyword">return</span> n * <span class="hljs-number">2</span>
    })
    fmt.Println(<span class="hljs-string">"映射（乘2）："</span>, doubled) <span class="hljs-comment">// 输出：映射（乘2）： [2 4 6 8 10]</span>

    <span class="hljs-comment">// 2. 过滤：保留偶数</span>
    evens := filterSlice(numbers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> {
        <span class="hljs-keyword">return</span> n%<span class="hljs-number">2</span> == <span class="hljs-number">0</span>
    })
    fmt.Println(<span class="hljs-string">"过滤（偶数）："</span>, evens) <span class="hljs-comment">// 输出：过滤（偶数）： [2 4]</span>

    <span class="hljs-comment">// 3. 折叠：计算所有元素的和</span>
    sum := reduceSlice(numbers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(acc, n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
        <span class="hljs-keyword">return</span> acc + n
    }, <span class="hljs-number">0</span>)
    fmt.Println(<span class="hljs-string">"折叠（求和）："</span>, sum) <span class="hljs-comment">// 输出：折叠（求和）： 15</span>

    <span class="hljs-comment">// 4. 组合使用：先过滤偶数，再映射乘3，最后求和</span>
    combined := reduceSlice(
        mapSlice(
            filterSlice(numbers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> { <span class="hljs-keyword">return</span> n%<span class="hljs-number">2</span> == <span class="hljs-number">0</span> }),
            <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> { <span class="hljs-keyword">return</span> n * <span class="hljs-number">3</span> }),
        <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(acc, n <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> { <span class="hljs-keyword">return</span> acc + n },
        <span class="hljs-number">0</span>,
    )
    fmt.Println(<span class="hljs-string">"组合使用结果："</span>, combined) <span class="hljs-comment">// 输出：组合使用结果： (2*3)+(4*3)= 18</span>
}

</code></pre>
<p>说明：上面的代码使用了Go 1.18+新增的<strong>泛型</strong>（T、U是类型参数），让函数能支持任意类型的切片，通用性更强。泛型不是本文重点，后续章节会详细讲解。</p>
<h3 data-id="heading-36">8.4 函数式编程的最佳实践</h3>
<ul>
<li>
<p>优先使用纯函数：纯函数易于测试和维护，尤其是在并发场景中（线程安全）；</p>
</li>
<li>
<p>合理使用高阶函数：处理集合时，用高阶函数（map、filter、reduce）替代重复的循环逻辑，提升代码复用率；</p>
</li>
<li>
<p>避免过度函数组合：复杂的函数组合会降低代码可读性，建议控制组合层数（不超过3层）；</p>
</li>
<li>
<p>结合Go的特性：Go不是纯函数式语言，不必强行追求“纯函数式”，应结合Go的并发、接口等特性，灵活使用函数式编程思想。</p>
</li>
</ul>
<h2 data-id="heading-37">总结</h2>
<p>本章我们全面讲解了Go函数的核心特性，从基础定义到高级的闭包和函数式编程，核心要点总结如下：</p>
<ol>
<li>
<p>函数定义：语法简洁，参数类型后置，支持多返回值；参数传递是值传递，引用类型的副本指向同一底层数据；</p>
</li>
<li>
<p>多返回值与错误处理：Go的错误处理惯例是“返回值末尾放error”，调用后必须先判断error；</p>
</li>
<li>
<p>命名返回值：自动初始化，支持裸return，适合多返回值和复杂错误处理的函数；</p>
</li>
<li>
<p>函数值：函数作为一等公民，可以赋值给变量、作为参数或返回值，核心是函数签名匹配；</p>
</li>
<li>
<p>匿名函数与立即执行函数：匿名函数用于临时逻辑，立即执行函数用于创建临时作用域和一次性执行；</p>
</li>
<li>
<p>闭包：引用外部变量的匿名函数，按引用捕获变量，会延长外部变量的生命周期；注意避免循环中捕获同一变量的坑；</p>
</li>
<li>
<p>函数式编程：Go支持部分函数式编程思想，纯函数、函数组合、高阶函数是核心应用，能提升代码复用率和可读性。</p>
</li>
</ol>
<p>函数是Go编程的核心，掌握这些特性，能让你写出更简洁、高效、可维护的代码。建议多动手实践：用函数封装业务逻辑、用闭包实现状态保存、用高阶函数处理集合，加深对函数特性的理解。如果有任何问题，欢迎在评论区交流～</p>
<p>参考链接：</p>
<ul>
<li>
<p>Go官方文档 - 函数：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fspec%23Function_declarations" target="_blank" title="https://go.dev/ref/spec#Function_declarations" ref="nofollow noopener noreferrer">go.dev/ref/spec#Fu…</a></p>
</li>
<li>
<p>Go官方博客 - 闭包：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fblog%2Fclosures" target="_blank" title="https://go.dev/blog/closures" ref="nofollow noopener noreferrer">go.dev/blog/closur…</a></p>
</li>
<li>
<p>Go标准库 - errors包：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.go.dev%2Ferrors" target="_blank" title="https://pkg.go.dev/errors" ref="nofollow noopener noreferrer">pkg.go.dev/errors</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[老板说拼图游戏太卷了，让我用Cocos做个3d版本的...]]></title>    <link>https://juejin.cn/post/7599094262592143370</link>    <guid>https://juejin.cn/post/7599094262592143370</guid>    <pubDate>2026-01-26T00:42:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599094262592143370" data-draft-id="7599268297202335782" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="老板说拼图游戏太卷了，让我用Cocos做个3d版本的..."/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-26T00:42:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            老板说拼图游戏太卷了，让我用Cocos做个3d版本的...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:42:53.000Z" title="Mon Jan 26 2026 00:42:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1665f88f8fe44cba30baf9a7aaee4de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=%2FBp5I86jPumUmwdkfeBtoElo1XE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p><strong>哈喽大家好</strong>，我是亿元程序员，上次老板让做拼图游戏的那个小伙伴又来了：</p>
<blockquote>
<p><strong>亿哥</strong>，我又来了（捂脸），上次我们老板不是让我们趁热抢个拼图游戏头位吗？</p>
<p><strong>结果</strong>还是慢了一节，投流基本纯亏，现在大家都在拼题材和变种了（哭笑不得）。</p>
<p><strong>老板</strong>却异想天开，让我搞一个<code>3d</code>版本的（捂脸），我这没有经验咋搞啊！</p>
</blockquote>
<p><strong>别慌</strong>，<code>3d</code>版本的拼图游戏？那不就是拼模型！其实很早就有小伙伴咨询笔者关于<code>Cocos</code>游戏开发中的动态切割模型！（之前还不知道意欲何为，现在想起大有乾坤。）</p>
<p><strong>言归正传</strong>，本期带大家一起来看看，如何在<code>Cocos</code>游戏开发中，<strong>实现一个<code>3d</code>版本的拼图（拼模型）游戏</strong>，并加入到我的<strong>亿元Cocos小游戏实战合集</strong>中去。</p>
<p><strong>本文源工程可在文末获取，小伙伴们自行前往。</strong></p>
<h2 data-id="heading-1">简单分析一下</h2>
<p><strong>3d的拼图游戏</strong>其实可以做成拼模型的游戏，就是基本规则沿用拼图游戏的规则：</p>
<blockquote>
<p><strong>将</strong>完整的图片按照难度分割成<code>n*n</code>的碎片，然后打乱，玩家通过交换拼图最终把图片恢复完整，包括一些特殊的规则，例如正确相邻的图片会合并成整体。</p>
</blockquote>
<p><strong>拼模型游戏</strong>就是按照上述规则，将图片替换成模型即可，其关键的第一步就是要把模型动态分割。</p>
<p><strong>那么问题来了，如何将一个模型进行动态分割？</strong></p>
<h2 data-id="heading-2">动态模型分割</h2>
<p><strong>其实</strong>关于动态模型分割，笔者之前的文章就已经做过了介绍，感兴趣的小伙伴可以前往阅读<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3BzzFBzeVAO-a6LPTeFTrA" target="_blank" title="https://mp.weixin.qq.com/s/3BzzFBzeVAO-a6LPTeFTrA" ref="nofollow noopener noreferrer">《如何在CocosCreator3.8中实现动态切割模型？》
</a>。</p>
<p><strong>动态模型分割</strong>，说是分割，其实是创建，就是动态创建被切割平面分割的两部分子模型，然后把原模型销毁。</p>
<p><strong>其中</strong>最关键的<code>API</code>就是<code>utils.MeshUtils.createMesh</code>。这里面涉及的知识点实在是非常多，包括分割、生成、割面填充等等，不要求小伙伴们都会，会用就行，或者会指挥<code>AI</code>用就行。</p>
<p><strong>既然分割起来这么麻烦，有没有更简单的方法？</strong></p>
<h2 data-id="heading-3">美术妹子分割</h2>
<p><strong>美术妹子</strong> ： 我再次谢谢你！（为什么是再次？）</p>
<p><strong>这时候</strong>又有小伙伴提出疑问了：</p>
<blockquote>
<p><strong>不是</strong>说程序能完成的事情，尽量不要麻烦美术妹子吗？</p>
<p><strong>就不怕</strong>妹子追你九条街？</p>
</blockquote>
<p><strong>其实</strong>对于没有<code>3d</code>游戏开发经验的小伙伴来说，美术妹子分割好给到都不一定能完成游戏的开发，更何况通过程序去动态切割！</p>
<p><strong>说到这里</strong>，我相信美术妹子会理解的，模型能切割成的份数，很多情况下是可以确定的，所以试试看，说不定能成。</p>
<p><strong>话又说回来，没有3d游戏开发经验的小伙伴，该怎么着手开发拼模型游戏？</strong></p>
<h2 data-id="heading-4">创建项目</h2>
<p><strong>万事开头难</strong>，首先第一步就要创建项目，这里注意要创建一个<code>3d</code>的项目。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89db1c58d3354a1cad4f09070732098a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=7Qcnfq3mVJPHZ4eXmtlzuvWsHmc%3D" alt="" loading="lazy"/></p>
<p><strong>区别于</strong><code>2d</code>游戏项目，项目创建后，场景中会自带灯光和相机，以及三维的场景编辑器。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3be8b244ef744761ae9be0356702671b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=lK4ucByJTlZhy%2Bes1wIifK7dk%2FU%3D" alt="" loading="lazy"/></p>
<p><strong>下面</strong>列举一些常用的操作：</p>
<ul>
<li>
<p><strong>定位物体</strong> ：可以通过双击或者快捷键<code>F</code>，快速定位物体。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a49943a870d749f1a10bac2411f8e767~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=q9odxG5fGOGjsO93Rx73VlSNUrI%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>场景漫游</strong> ：按下鼠标右键后，可以通过快捷键<code>w</code>、<code>s</code>、<code>a</code>、<code>d</code>、<code>e</code>、<code>q</code>漫游场景。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7a4d1f1c9604d86a73fab50aa236109~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=Mx5IDZHqwsNrIrE0o1lmYKRR%2FZU%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>调整相机视角</strong> ：调整好合适的视角后，选中相机后可以通过菜单栏<code>节点-&gt;将节点对齐到场景视角</code>快速调整相机视角。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/453360b9bbb54a96b9a0f798f9ddad62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=Su3Fi0JVAKwQscLVksg8MUB9VhE%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>快速回到相机视角</strong> ：选中相机后可以通过菜单栏<code>节点-&gt;将场景视角对齐到与节点</code>快速回到相机视角。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac2a188730bb4f97bc4ffe9c0e828b8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=AmSPYXBfjeKrEN2onuSgjZqKvNE%3D" alt="" loading="lazy"/></p>
</li>
</ul>
<p><strong>这太基础了，你上你也行，那如何让界面既能显示3d模型又能显示UI？</strong></p>
<h2 data-id="heading-5">多相机共存</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/811a7c4fbd3f475fbf5a9f28e519abe6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=ntYenKHwBv2vEqeMuPv0tMLc4uw%3D" alt="" loading="lazy"/></p>
<p>**如上图所示，**游戏画面中包含UI和模型，意味着场景中可能包含至少<code>2</code>个相机。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/821a2c453c154894810a36dc37574f1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=sNlkQgVdxVpXaIBEkcVRqhkdY3Y%3D" alt="" loading="lazy"/></p>
<p><strong>控制</strong>相机拍摄哪些物体可以通过<code>Visibility</code>属性去控制。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/705d811aabab41cc87763edb0b89b251~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=ggpfWleVQhQ8ch1omJ2WVLAyEtM%3D" alt="" loading="lazy"/></p>
<p><strong>控制</strong>相机的渲染优先级可以通过<code>Priority</code>属性去控制，如上面拍背景的相机为<code>0</code>、拍模型的相机为<code>1</code>，拍弹框的相机为<code>2</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b67b3fca6cc410e9b39d70cdb318e4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=Nijb%2BTiq1mUGkeAJmQPwTTQK1EU%3D" alt="" loading="lazy"/></p>
<p><strong>说了那么多，可以开始实战写模型游戏，写代码没？</strong></p>
<h2 data-id="heading-6">拼模型游戏实战</h2>
<p><strong>相信小伙伴们通过上面的文章内容，已经学会如何着手开发拼模型游戏了吧！</strong></p>
<p><strong>由于</strong>本期还没有贴熟悉的代码，笔者还是决定补充一些关键代码：</p>
<ul>
<li>
<p><strong>屏幕点击3d物体</strong> ： 首先通过<code>screenPointToRay</code>方法将点击转成射线，然后通过<code>PhysicsSystem.instance.raycast</code>获取到对应的物体。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f811acc0b6df4de8b7302f9676b59be0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=6x1Yda6Gu4mSRc%2BLnJ%2Fxwa9YgWg%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>拖拽3d物体</strong> ：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28620b65dafc430d911a420995dca8a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=bG3kt2yUFlqsG%2FkZTECqfSFzkaU%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>3d物体动画</strong> ： 直接用熟悉的<code>tween</code>动画即可。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c604c19d08c44768b874e6d8e9ac8238~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=Y0uuNIy%2BZwKbMrRDufQ4tVLVlkk%3D" alt="" loading="lazy"/></p>
</li>
</ul>
<h2 data-id="heading-7">效果演示</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7242914c6905423f9ebf4152fe0875d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769992973&amp;x-signature=RHWcjrGpsPRy3k3A4QJKozAibe0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-8">结语</h2>
<p><strong>拼图游戏</strong>现在都玩出花了，要不要做个<code>3d</code>版本的试一试？</p>
<p><strong>小伙伴们</strong>，你们都学会了吗？</p>
<p>本文<strong>实战完整源码</strong>已集成到<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer">亿元Cocos小游戏实战合集</a>，内含体验链接，通过添加模型即可完成关卡的配置。</p>
<hr/>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐文章：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer">亿元Cocos小游戏实战合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FXLCknL3fJDubec2GW6KLFA" target="_blank" title="https://mp.weixin.qq.com/s/XLCknL3fJDubec2GW6KLFA" ref="nofollow noopener noreferrer">Cocos游戏如何接入安卓穿山甲广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3_VrSld4KnDKY_7hxjSoKg" target="_blank" title="https://mp.weixin.qq.com/s/3_VrSld4KnDKY_7hxjSoKg" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Lj24VHJ-pL8z82hHqQLiA" target="_blank" title="https://mp.weixin.qq.com/s/0Lj24VHJ-pL8z82hHqQLiA" ref="nofollow noopener noreferrer">Cocos游戏如何快速接入抖音小游戏广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ7DusUJA2v1IFZDFtBsueg" target="_blank" title="https://mp.weixin.qq.com/s/Z7DusUJA2v1IFZDFtBsueg" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现割绳子游戏效果</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3BzzFBzeVAO-a6LPTeFTrA" target="_blank" title="https://mp.weixin.qq.com/s/3BzzFBzeVAO-a6LPTeFTrA" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现动态切割模型？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZIph332u_r24OTY4r6_jow" target="_blank" title="https://mp.weixin.qq.com/s/ZIph332u_r24OTY4r6_jow" ref="nofollow noopener noreferrer">Cocos游戏开发中的贴花效果</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Code Tasks 来了：从"随用随忘"到跨会话持久化任务管理]]></title>    <link>https://juejin.cn/post/7599094262592176138</link>    <guid>https://juejin.cn/post/7599094262592176138</guid>    <pubDate>2026-01-26T00:51:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599094262592176138" data-draft-id="7598807837868441626" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Code Tasks 来了：从&quot;随用随忘&quot;到跨会话持久化任务管理"/> <meta itemprop="keywords" content="Claude,AIGC,AI编程"/> <meta itemprop="datePublished" content="2026-01-26T00:51:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="黄林晴"/> <meta itemprop="url" content="https://juejin.cn/user/3985057546510423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Code Tasks 来了：从"随用随忘"到跨会话持久化任务管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3985057546510423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    黄林晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:51:59.000Z" title="Mon Jan 26 2026 00:51:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>2026年1月，Anthropic 悄悄上线了 Claude Code 的重大更新——Tasks 系统。这个功能将彻底改变你使用 AI 编程助手处理复杂项目的方式。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">Todos 的痛点：用完就忘</h2>
<p>如果你是 Claude Code 的老用户，可能听说过 Todos 功能。但说实话，大多数人都会忽略它。</p>
<p>为什么？因为 <strong>Todos 存在内存中</strong>。</p>
<p>这意味着：</p>
<ul>
<li>• 关闭会话，任务清单消失</li>
<li>• 启动子代理（sub-agent），它完全不知道主代理在追踪什么</li>
<li>• 多个会话之间无法共享任务状态</li>
</ul>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 旧版 Todos 的尴尬处境</span>
Session 1: 创建了5个 todos → 关闭
Session 2: <span class="hljs-string">"什么 todos？我不知道啊"</span>
</code></pre>
<p>这就像用便利贴管理项目——写完贴墙上，转头就找不到了。</p>
<hr/>
<h2 data-id="heading-1">Tasks：持久化 + 依赖 + 协作</h2>
<p>新的 Tasks 系统解决了所有这些问题。</p>
<h3 data-id="heading-2">持久化存储</h3>
<p>任务现在保存在 <code>~/.claude/tasks</code> 目录中。关闭 Claude Code，明天再打开，任务还在那里等你。</p>
<h3 data-id="heading-3">依赖关系管理</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">Task</span> A: 设计数据库 Schema
<span class="hljs-built_in">Task</span> B: 实现 Repository 层  ← blockedBy: <span class="hljs-built_in">Task</span> A
<span class="hljs-built_in">Task</span> C: 编写单元测试       ← blockedBy: <span class="hljs-built_in">Task</span> B
</code></pre>
<p>Tasks 支持定义任务之间的依赖关系。只有前置任务完成，后续任务才能开始。</p>
<h3 data-id="heading-4">多代理协作</h3>
<p>这是最强大的特性。多个子代理或多个 Claude Code 会话可以：</p>
<ul>
<li>• 访问同一个任务列表</li>
<li>• 实时同步状态更新</li>
<li>• 避免重复工作</li>
</ul>
<p>想象一下：你让一个代理写前端，另一个写后端，它们共享同一份任务清单，互相知道对方的进度。</p>
<hr/>
<h2 data-id="heading-5">核心工具一览</h2>
<p>Tasks 系统提供四个核心工具：</p>






























<table><thead><tr><th>工具</th><th>功能</th><th>使用场景</th></tr></thead><tbody><tr><td><code>TaskCreate</code></td><td>创建新任务</td><td>规划项目、分解需求</td></tr><tr><td><code>TaskList</code></td><td>查看任务列表</td><td>了解整体进度</td></tr><tr><td><code>TaskGet</code></td><td>获取任务详情</td><td>查看具体描述和依赖</td></tr><tr><td><code>TaskUpdate</code></td><td>更新任务状态</td><td>标记进度、设置依赖</td></tr></tbody></table>
<p>任务有三种状态：</p>
<pre><code class="hljs"> pending → in_progress → completed
 待处理      进行中        已完成
</code></pre>
<hr/>
<h2 data-id="heading-6">实战示例</h2>
<p>假设你要给项目添加用户认证功能：</p>
<pre><code class="hljs language-less" lang="less">&gt; 帮我实现用户登录功能，需要 <span class="hljs-selector-tag">JWT</span> 认证

<span class="hljs-selector-tag">Claude</span> <span class="hljs-selector-tag">Code</span> 自动创建任务：
<span class="hljs-selector-attr">[1]</span> 设计用户数据模型        ✓ <span class="hljs-selector-tag">completed</span>
<span class="hljs-selector-attr">[2]</span> 实现 <span class="hljs-selector-tag">JWT</span> 工具类         ● <span class="hljs-selector-tag">in_progress</span>
<span class="hljs-selector-attr">[3]</span> 创建登录 <span class="hljs-selector-tag">API</span> 端点       ○ <span class="hljs-selector-tag">pending</span> (<span class="hljs-attribute">blockedBy</span>: <span class="hljs-number">2</span>)
<span class="hljs-selector-attr">[4]</span> 添加中间件验证          ○ <span class="hljs-selector-tag">pending</span> (<span class="hljs-attribute">blockedBy</span>: <span class="hljs-number">3</span>)
<span class="hljs-selector-attr">[5]</span> 编写集成测试            ○ <span class="hljs-selector-tag">pending</span> (<span class="hljs-attribute">blockedBy</span>: <span class="hljs-number">4</span>)
</code></pre>
<p>即使你中途关闭 Claude Code 去开会，回来后它依然记得：</p>
<ul>
<li>• 哪些任务完成了</li>
<li>• 当前在做什么</li>
<li>• 接下来该做什么</li>
</ul>
<hr/>
<h2 data-id="heading-7">Tasks vs Skills：别搞混了</h2>
<p>很多人会问：Tasks 和 Skills 有什么区别？</p>
<p><strong>Skills（技能）</strong> ：</p>
<ul>
<li>• 教会 Claude 特定领域知识</li>
<li>• 存储在 <code>~/.claude/skills/</code> 目录</li>
<li>• 通过 <code>/skill-name</code> 手动调用</li>
<li>• 适合：代码规范、提交模板、架构指南</li>
</ul>
<p><strong>Tasks（任务）</strong> ：</p>
<ul>
<li>• 管理工作项和进度</li>
<li>• 支持并行处理和子代理调度</li>
<li>• 动态创建，自动追踪</li>
<li>• 适合：复杂项目、多步骤重构、功能开发</li>
</ul>
<p>简单说：</p>
<ul>
<li>• Skills 是"我会什么"</li>
<li>• Tasks 是"我要做什么"</li>
</ul>
<p>两者配合使用效果更佳。比如用 Skills 定义代码规范，用 Tasks 管理重构进度。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a32c2ab7008b41bb884ac6c1dd177bc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769993518&amp;x-signature=pIVwq%2BwDcBotR%2BdPwiVzd6bBzLs%3D" alt="claude_code_tasks_vs_skills.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-8">什么时候该用 Tasks？</h2>
<p><strong>适合用 Tasks 的场景</strong>：</p>
<ul>
<li>• 跨多个文件的功能开发</li>
<li>• 大规模代码重构</li>
<li>• 需要多个步骤的测试套件编写</li>
<li>• 任何需要"记住进度"的复杂工作</li>
</ul>
<p><strong>不需要 Tasks 的场景</strong>：</p>
<ul>
<li>• 修复一个小 bug</li>
<li>• 重构单个函数</li>
<li>• 简单的代码查询</li>
</ul>
<p>正如官方所说：对于小任务，Claude 足够聪明，不需要任务管理系统。但对于大项目，Tasks 是你的得力助手。</p>
<hr/>
<h2 data-id="heading-9">使用技巧</h2>
<ol>
<li><strong>让 Claude 自动创建任务</strong>：描述一个复杂需求，Claude 会自动分解成多个任务</li>
<li><strong>善用依赖关系</strong>：确保任务按正确顺序执行</li>
<li><strong>定期查看任务列表</strong>：使用 <code>/tasks</code> 命令快速查看进度</li>
<li><strong>并行执行</strong>：没有依赖关系的任务可以同时进行，大幅提升效率</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60f27af85eb144eea874ef042ef93f93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769993518&amp;x-signature=d740QPwPAMLw4iBMkpvlpxTAsbY%3D" alt="claude_code_tasks_workflow.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-10">总结</h2>
<p>Claude Code Tasks 的上线，标志着 AI 编程助手从"对话式工具"向"项目管理伙伴"的转变。</p>






























<table><thead><tr><th>特性</th><th>旧版 Todos</th><th>新版 Tasks</th></tr></thead><tbody><tr><td>存储</td><td>内存（会话结束即消失）</td><td>文件系统（持久化）</td></tr><tr><td>依赖</td><td>不支持</td><td>完整支持</td></tr><tr><td>多代理</td><td>各自独立</td><td>共享协作</td></tr><tr><td>跨会话</td><td>不可能</td><td>原生支持</td></tr></tbody></table>
<p>如果你经常用 Claude Code 处理复杂项目，Tasks 功能值得你认真研究。它不仅仅是一个任务清单，而是让 AI 真正理解"项目进度"概念的关键一步。</p>
<hr/>
<p>你觉得 Tasks 功能怎么样？欢迎在评论区分享你的使用体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[栗子前端技术周刊第 114 期 - jQuery 4.0、Chrome 144、Node.js v25.4.0...]]></title>    <link>https://juejin.cn/post/7598537739517460522</link>    <guid>https://juejin.cn/post/7598537739517460522</guid>    <pubDate>2026-01-26T00:51:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598537739517460522" data-draft-id="7598537739516035114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="栗子前端技术周刊第 114 期 - jQuery 4.0、Chrome 144、Node.js v25.4.0..."/> <meta itemprop="keywords" content="前端,JavaScript,jQuery"/> <meta itemprop="datePublished" content="2026-01-26T00:51:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="晓得迷路了"/> <meta itemprop="url" content="https://juejin.cn/user/2172290706715565"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            栗子前端技术周刊第 114 期 - jQuery 4.0、Chrome 144、Node.js v25.4.0...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290706715565/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    晓得迷路了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:51:24.000Z" title="Mon Jan 26 2026 00:51:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>🌰<strong>栗子前端技术周刊第 114 期 (2026.01.19 - 2026.01.25)</strong>：浏览前端一周最新消息，学习国内外优秀文章，让我们保持对前端的好奇心。</p>
<h2 data-id="heading-0">📰 技术资讯</h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.jquery.com%2F2026%2F01%2F17%2Fjquery-4-0-0%2F" target="_blank" title="https://blog.jquery.com/2026/01/17/jquery-4-0-0/" ref="nofollow noopener noreferrer">jQuery 4.0</a></strong>：上周六 jQuery 4.0 正式发布，4.0 版本移除了对 IE 10 及更早期版本的支持，新增 Trusted Types 特性支持，对齐了 W3C 焦点事件规范，而最值得关注的是：jQuery 已全面迁移至 ES 模块体系，这意味着它可完美适配各类现代构建工具！</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fblog%2Fgeolocation-html-element" target="_blank" title="https://developer.chrome.com/blog/geolocation-html-element" ref="nofollow noopener noreferrer">Chrome 144</a></strong>：Chrome 144 正式发布，新增 <code>&lt;geolocation&gt;</code> HTML 元素，该元素改变了网站请求用户位置数据的方式。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fen%2Fblog%2Frelease%2Fv25.4.0" target="_blank" title="https://nodejs.org/en/blog/release/v25.4.0" ref="nofollow noopener noreferrer">Node.js 25.4.0</a></strong>：Node.js v25.4.0（最新版本）已发布，其中 <code>require(esm)</code> 功能现已标记为稳定版，模块编译缓存特性同步完成稳定化，此外还包含多项小幅优化调整。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdenoland%2Fdeno%2Freleases%2Ftag%2Fv2.6.5" target="_blank" title="https://github.com/denoland/deno/releases/tag/v2.6.5" ref="nofollow noopener noreferrer">Deno 2.6.5</a></strong>：Deno 2.6.5 发布，更新内容包括：为 <code>createImageBitmap</code> 接口新增 GIF、WEBP 格式支持；新增 <code>performance.clearResourceTimings()</code> 与 <code>setResourceTimingBufferSize()</code> 接口等等。</p>
</li>
</ol>
<h2 data-id="heading-1">📒 技术文章</h2>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Falmanac.httparchive.org%2Fzh-CN%2F2025%2F" target="_blank" title="https://almanac.httparchive.org/zh-CN/2025/" ref="nofollow noopener noreferrer">The 2025 Web Almanac</a></strong>：2025 年度 Web 年鉴 - 这份向来兼具趣味性与深度的年度报告如期发布。报告基于对超 1700 万个网站的分析、总计约 244TB 数据的处理撰写而成！报告通过无障碍适配、性能优化、安全防护、内容分发、人工智能等多个章节，深度剖析了过去一年间 Web 领域的发展演变脉络。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2a242d6f4cd425195b792acfee1b773~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769993483&amp;x-signature=MKWGGDctP06EDWjQw9OukYm9Uz4%3D" width="100%" alt="image-20260125093321403" loading="lazy"/>
<ol start="2">
<li>
<p><strong><a href="https://juejin.cn/post/7596932640727056419" target="_blank" title="https://juejin.cn/post/7596932640727056419">AI辅助研发的落地实践：工具、效率与成长</a></strong>：本文将从“工具实践”与“个人成长”两个维度，分享作者在 AI 辅助研发方面的落地经验与思考，作者希望能为大家带来一些参考与启发。</p>
</li>
<li>
<p><strong><a href="https://juejin.cn/post/7596970073750552612" target="_blank" title="https://juejin.cn/post/7596970073750552612">前端指纹技术是如何实现的？（Canvas、Audio、硬件API 核心原理解密）</a></strong>：本文围绕前端指纹技术展开，介绍了设备指纹概念并详细阐述三种实现方式，Canvas 指纹、AudioContext 指纹和电池与硬件并发。</p>
</li>
</ol>
<h2 data-id="heading-2">🔧 开发工具</h2>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwooorm%2Fstarry-night" target="_blank" title="https://github.com/wooorm/starry-night" ref="nofollow noopener noreferrer">Starry Night 3.9</a></strong>：类 GitHub 语法高亮工具 —— GitHub 官方语法高亮器并非开源，但这款工具库是一款功能强大的替代方案，力求在效果上无限贴近官方版本，同时支持上百种编程语言。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/509b77b0162d41e982a6271603117f48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769993483&amp;x-signature=4jDNcTnlNq9dlz1CaS6XMfTJUKI%3D" width="100%" alt="image-20260125092657102" loading="lazy"/>
<ol start="2">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fextension.js.org%2F" target="_blank" title="https://extension.js.org/" ref="nofollow noopener noreferrer">Extension.js 3</a></strong>：浏览器扩展开发框架 —— 无需手动配置构建流程，即可创建跨浏览器扩展程序；通过统一的工作流，实现跨浏览器的开发、构建与预览。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b32a75968b2d451b9a25a0b0cddb4322~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769993483&amp;x-signature=fYEtA%2FhpRxRPgfnNtemUC8VCeMc%3D" width="100%" alt="image-20260125092958438" loading="lazy"/>
<ol start="3">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fstylelint.io%2F" target="_blank" title="https://stylelint.io/" ref="nofollow noopener noreferrer">Stylelint 17.0</a></strong>：作为一款成熟的 CSS 代码检查工具，Stylelint 内置超 100 条规则，可帮助开发者“捕获代码错误、设定编码限制并强制执行样式规范”。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91a00539e74f4ef58a573c3498fa2f1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769993483&amp;x-signature=c%2F2YKYD6jggPOJVdnOiPPeMLStg%3D" width="100%" alt="image-20260125094016446" loading="lazy"/>
<p>🚀🚀🚀 <em>以上资讯文章选自常见周刊，如 JavaScript Weekly 等，周刊内容也会不断优化改进，希望你们能够喜欢。</em></p>
<p>💖 <strong>欢迎关注微信公众号：栗子前端</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>