<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[ç¨‹åºå‘˜çˆ†å“­ï¼æˆ‘ä»¬è®© COCO AI æ¥ç®¡ GitLab å®¡æŸ¥åï¼Œå›¢é˜Ÿç›´æ¥èµ·é£ï¼šè¿ CTO éƒ½è¯´â€œè¿™ç©æ„å„¿æ¯”äººé è°±å¤šäº†]]></title>    <link>https://juejin.cn/post/7583910637958627347</link>    <guid>https://juejin.cn/post/7583910637958627347</guid>    <pubDate>2025-12-15T16:05:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910637958627347" data-draft-id="7583898823921582122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¨‹åºå‘˜çˆ†å“­ï¼æˆ‘ä»¬è®© COCO AI æ¥ç®¡ GitLab å®¡æŸ¥åï¼Œå›¢é˜Ÿç›´æ¥èµ·é£ï¼šè¿ CTO éƒ½è¯´â€œè¿™ç©æ„å„¿æ¯”äººé è°±å¤šäº†"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,GitLab"/> <meta itemprop="datePublished" content="2025-12-15T16:05:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æé™å®éªŒå®¤"/> <meta itemprop="url" content="https://juejin.cn/user/1258294223312599"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¨‹åºå‘˜çˆ†å“­ï¼æˆ‘ä»¬è®© COCO AI æ¥ç®¡ GitLab å®¡æŸ¥åï¼Œå›¢é˜Ÿç›´æ¥èµ·é£ï¼šè¿ CTO éƒ½è¯´â€œè¿™ç©æ„å„¿æ¯”äººé è°±å¤šäº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1258294223312599/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æé™å®éªŒå®¤
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T16:05:37.000Z" title="Mon Dec 15 2025 16:05:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æˆ‘ç›´æ¥è®²ç»“è®ºï¼š</p>
<p><strong>æŠŠ COCO AI æ¥å…¥ GitLab åšè‡ªåŠ¨ä»£ç å®¡æ ¸ä¹‹åï¼Œæˆ‘ä»¬å›¢é˜Ÿçš„å¼€å‘æ•ˆç‡è¢«ç¡¬ç”Ÿç”ŸæŠ¬äº†ä¸€ä¸ªæ—¶ä»£ã€‚</strong></p>
<p>æ²¡å¤¸å¼ ã€‚ä¸æ˜¯ä¼˜åŒ– 10% æˆ– 20%ã€‚æ˜¯ â€”â€”</p>
<blockquote>
<p><strong>å¼€å‘æ•ˆç‡ x3</strong><br/>
<strong>Bug æš´éœ²ç‡ x4</strong><br/>
<strong>Review æ—¶é—´ Ã·10</strong></p>
</blockquote>
<p>æ›´å¤¸å¼ çš„æ˜¯ï¼Œè¿æˆ‘ä»¬ CTO éƒ½è¯´ï¼š<br/>
<strong>â€œè¿™ç©æ„å„¿æ¯”äººå®¡å¾—ç‹ ï¼Œä¹Ÿæ¯”äººç¨³å®šã€‚â€</strong></p>
<p>ç¨‹åºå‘˜åˆ™åœ¨è§’è½ç‘Ÿç‘Ÿå‘æŠ–ï¼š<br/>
<strong>â€œä»¥å‰å†™ä»£ç æ˜¯éª—è¿‡äººï¼Œç°åœ¨è¦éª—è¿‡ç¥ã€‚â€</strong></p>
<p>ä»Šå¤©æˆ‘å°±æŠŠæ•´ä¸ªæ•…äº‹å…¬å¼€ï¼Œè®©ä½ çœ‹çœ‹çœŸæ­£çš„ AI å®¡æŸ¥æ˜¯ä»€ä¹ˆç‹ åŠ²ã€‚</p>
<h2 data-id="heading-0">01 ï½œä¸ºä»€ä¹ˆä½ ä»¬å›¢é˜Ÿçš„ä»£ç å®¡æŸ¥æ°¸è¿œåšä¸å¥½ï¼Ÿå› ä¸ºä½ ä»¬è¿˜åœ¨é äººã€‚</h2>
<p>ä½ ä»¬å›¢é˜Ÿæ˜¯ä¸æ˜¯è¿™æ ·ï¼Ÿ</p>
<ul>
<li>å¼€å‘æä¸ª MRï¼Œç­‰ä¸¤å¤©æ²¡äººçœ‹</li>
<li>Reviewer éšä¾¿æ‰«ä¸€çœ¼å°±ç‚¹ Approve</li>
<li>çº¿ä¸Šäº‹æ•…åäº’ç›¸ç”©é”…</li>
<li>ä¸šåŠ¡å‹å¾— reviewer æ ¹æœ¬æ²¡ç©ºè®¤çœŸå®¡</li>
<li>æ–°äººå†™ä»£ç æ²¡äººçœ‹ï¼Œé›·æ‚„æ‚„åŸ‹è¿›å»</li>
<li>è€å·¥ç¨‹å¸ˆè¢«æ‹‰æ»¡ï¼Œè€—æ­»åœ¨é‡å¤åŠ³åŠ¨é‡Œ</li>
</ul>
<p>åˆ«éª—è‡ªå·±äº†ï¼Œè¿™ä¸æ˜¯â€œæµç¨‹é—®é¢˜â€ã€‚<br/>
è¿™æ˜¯ <strong>æ—¶ä»£é—®é¢˜</strong>ã€‚</p>
<p>é äººå®¡ä»£ç ï¼Ÿ<br/>
é‚£æ˜¯ 2018 å¹´çš„ç©æ³•ã€‚</p>
<p>ç°åœ¨æ˜¯ <strong>AI å®¡ä»£ç </strong> çš„æ—¶ä»£ã€‚<br/>
è°å…ˆç”¨ï¼Œè°å°±æ˜¯ä¸‹ä¸€ä»£å›¢é˜Ÿã€‚</p>
<h2 data-id="heading-1">02 ï½œ COCO AI æ¥å…¥ GitLab åï¼Œç¬¬ä¸€å¤©å°±æŠŠæˆ‘ä»¬å“äº†ä¸€è·³</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d34a503b9fd6491da17a06a52e776f8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419536&amp;x-signature=F3fQnU4GrJL0ISykY0uclPctU38%3D" alt="" loading="lazy"/></p>
<p>MR åˆšå‘èµ·ï¼ŒCOCO AI ç«‹åˆ»è·³å‡ºæ¥ï¼š</p>
<p><strong>â€œä»£ç å·²æ¥æ”¶ï¼Œæ­£åœ¨å®¡æŸ¥â€¦â€¦â€</strong></p>
<p>å‡ åç§’åâ€”â€”</p>
<p><strong>å•ªï¼ä¸‰åæ¡é—®é¢˜ä¸¢ä½ è„¸ä¸Šã€‚</strong></p>
<p>è€Œä¸”ä¸æ˜¯å°é—®é¢˜ï¼Œéƒ½æ˜¯è‡´å‘½çš„ï¼š</p>
<ul>
<li>å¹¶å‘ map è¯»å†™ç›´æ¥ panic</li>
<li>goroutine ä¸å…³ï¼Œæ³„æ¼åˆ°å¤©è’åœ°è€</li>
<li>defer åœ¨å¾ªç¯é‡Œç–¯ç‹‚å †</li>
<li>SQL æ‹¼æ¥æ¼æ´è‚‰çœ¼å¯è§</li>
<li>ctx æ²¡ä¼ ï¼Œè¶…æ—¶å¤±æ§</li>
<li>é”™è¯¯æ²¡å¤„ç†ï¼Œçº¿ä¸Šä¸€ç‚¸å°±æ˜¯å¤§äº‹æ•…</li>
<li>é­”æ³•æ•°å­—åˆ°å¤„é£ï¼Œè¿Ÿæ—©å‘æ­»åŒäº‹</li>
</ul>
<p>æˆ‘ä»¬å›¢é˜Ÿç¬é—´å®‰é™äº†ã€‚<br/>
ç¨‹åºå‘˜ç›¯ç€å±å¹•ï¼š<strong>â€œè¿™è°å†™çš„ï¼Ÿå“¦æ˜¯æˆ‘è‡ªå·±ã€‚â€</strong></p>
<h2 data-id="heading-2">03 ï½œ COCO AI åˆ°åº•æœ‰å¤šç‹ ï¼Ÿå®ƒå®¡ä»£ç å®Œå…¨ä¸ç»™äººç•™é¢å­ã€‚</h2>
<p>ä½ åœ¨ä»£ç é‡ŒçŠ¯è¿‡çš„é”™ï¼Œå®ƒå…¨çœ‹å¾—è§ã€‚</p>
<p>å®ƒçš„é£æ ¼å°±æ˜¯å››ä¸ªå­—ï¼š<strong>ä¸ç•™æ´»å£</strong>ã€‚</p>
<p>å®ƒä¼šç›´æ¥ç»™ä½ åˆ†æï¼š</p>
<h3 data-id="heading-3">âš  é€»è¾‘é”™è¯¯ï¼Ÿç›´æ¥ç‚¹åã€‚</h3>
<blockquote>
<p>ç¬¬ 87 è¡Œä½  return true å¯èƒ½æ”¾å¤§æƒé™ï¼Œä¸¥é‡å®‰å…¨é£é™©ã€‚</p>
</blockquote>
<h3 data-id="heading-4">âš  å¹¶å‘ä¸å®‰å…¨ï¼Ÿå½“åœºæŠ“åŒ…ã€‚</h3>
<blockquote>
<p>è¿™é‡Œçš„ map æ²¡åŠ é”ï¼Œçº¿ä¸Šå¿…å´©ï¼Œåˆ«ä¾¥å¹¸äº†ã€‚</p>
</blockquote>
<h3 data-id="heading-5">âš  æ€§èƒ½å·®ï¼Ÿå®ƒéª‚ä½ ã€‚</h3>
<blockquote>
<p>strings.Split ä¸€ç§’é’Ÿå‡ åæ¬¡ï¼Œä½ ä¸æ€• CPU çƒ§ï¼Ÿ<br/>
å»ºè®®æ¢ Cut æˆ–è€…é¢„ç¼–è¯‘æ­£åˆ™ã€‚</p>
</blockquote>
<h3 data-id="heading-6">âš  å¯è¯»æ€§å·®ï¼Ÿå®ƒæ‰¹ä½ ã€‚</h3>
<blockquote>
<p>ä½ è¿™å‡½æ•° 160 è¡Œï¼Œæ˜¯å‡†å¤‡å†™å›å¿†å½•ï¼Ÿ</p>
</blockquote>
<h3 data-id="heading-7">âš  æµ‹è¯•æ²¡å†™ï¼Ÿå®ƒæˆ³ç ´ä½ ã€‚</h3>
<blockquote>
<p>ç¼ºåä¾‹æµ‹è¯•ï¼Œåˆ«è£…äº†ï¼Œæˆ‘çŸ¥é“ä½ èµ¶è¿›åº¦ã€‚</p>
</blockquote>
<p>å®ƒä¸æ‹é©¬å±ï¼Œä¸åšæ ·å­ï¼Œä¸æå…³ç³»ï¼Œä¸å¹å½©è™¹å±ï¼Œ<br/>
<strong>å®ƒåªé’ˆå¯¹ä»£ç ï¼Œä¸é’ˆå¯¹äººã€‚</strong><br/>
<strong>å®ƒåªè®¤é—®é¢˜ï¼Œä¸è®¤é¢å­ã€‚</strong></p>
<p>è¿™å°±æ˜¯ AI å®¡æŸ¥çš„åŠ›é‡ã€‚</p>
<h2 data-id="heading-8">04 ï½œæ›´ç¦»è°±çš„æ˜¯ï¼šæ¥ GitLab åªè¦ 30 è¡Œä»£ç </h2>
<p>è¿™ç©æ„å„¿æ¥å…¥ GitLab ç®€ç›´è½»åˆ°ç¦»è°±ã€‚</p>
<p>æµç¨‹å°±æ˜¯ä¸‰æ­¥ï¼š</p>
<ol>
<li>GitLab MR â†’ Webhook â†’ ä½ çš„æœåŠ¡</li>
<li>æŠŠ Diff ä¸¢ç»™ COCO AI</li>
<li>æŠŠå®¡æŸ¥ç»“æœè¯„è®ºå› MR</li>
</ol>
<p>Go ä»£ç ç”šè‡³å¯ä»¥ä¸€å±å†™å®Œï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handleMR</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
    req := parseWebhook(r)
    diff := gitlab.GetDiff(req)
    review := coco.ReviewCode(diff)
    gitlab.PostComment(req, review.Content)
}
</code></pre>
<p>è¿æ–°æ‰‹å·¥ç¨‹å¸ˆçœ‹äº†éƒ½è¯´ï¼š<br/>
<strong>â€œè¿™æ¥å…¥æˆæœ¬ä¹Ÿå¤ªçˆ½äº†å§ï¼Ÿâ€</strong></p>
<h2 data-id="heading-9">05 ï½œæˆ‘ç»™ä½ çœ‹çœŸå®çš„å›¢é˜ŸæŒ‡æ ‡ï¼Œç»ä¸æ˜¯å˜´ä¸Šå¹</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4aced84891b44a94ae612f52ba4b520e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419536&amp;x-signature=qBEgBbC2uu%2BFZ5C7wW1lWkZUME0%3D" alt="" loading="lazy"/></p>
<p>ä¸‰ä¸ªæœˆç»Ÿè®¡ï¼ˆçœŸå®æ•°æ®ï¼‰ï¼š</p>



































<table><thead><tr><th>æŒ‡æ ‡</th><th>æ¥å…¥å‰</th><th>æ¥å…¥å</th></tr></thead><tbody><tr><td>å¹³å‡ MR å®¡æŸ¥æ—¶é—´</td><td>1â€“2 å¤©</td><td><strong>5â€“20 åˆ†é’Ÿ</strong></td></tr><tr><td>Reviewer å·¥ä½œé‡</td><td>çˆ†æ»¡</td><td><strong>éª¤é™ 70%</strong></td></tr><tr><td>ä¸¥é‡ Bug æš´éœ²ç‡</td><td>20% å·¦å³</td><td><strong>80%+</strong></td></tr><tr><td>çº¿ä¸Šäº‹æ•…</td><td>7 æ¬¡/å­£åº¦</td><td><strong>2 æ¬¡/å­£åº¦</strong>ï¼ˆè¿˜éƒ½å°äº‹æ•…ï¼‰</td></tr><tr><td>æ–°äººä»£ç è´¨é‡</td><td>ä¸æ•¢çœ‹</td><td><strong>åƒæœ‰è€å¸æœºåœ¨æ‰‹æŠŠæ‰‹æ•™</strong></td></tr></tbody></table>
<p>æ›´çˆ½çš„æ˜¯ï¼š<br/>
<strong>COCO AI è¿˜æŠŠè€å·¥ç¨‹å¸ˆè§£æ”¾å‡ºæ¥åšæ›´é‡è¦çš„äº‹æƒ…ã€‚</strong></p>
<p>è¿™æ‰æ˜¯ AI çš„æ­£ç¡®ä½¿ç”¨æ–¹å¼ã€‚</p>
<h2 data-id="heading-10">06 ï½œä½ ä»¥ä¸º AI æ˜¯ç©å…·ï¼Ÿé”™ã€‚å®ƒæ˜¯æœªæ¥çš„ç”Ÿäº§åŠ›ã€‚</h2>
<p>è¿™ä¸æ˜¯ä¸€ä¸ªâ€œç”¨ä¸ç”¨â€çš„é—®é¢˜ã€‚<br/>
è¿™æ˜¯ä¸€ä¸ªâ€œæƒ³ä¸æƒ³è¢«æ—¶ä»£æ·˜æ±°â€çš„é—®é¢˜ã€‚</p>
<p>æœªæ¥ä¸‰å¹´ï¼Œè½¯ä»¶å›¢é˜Ÿä¼šè¢«ä¸¤ç§åŠ›é‡ç¢¾å‹ï¼š</p>
<ul>
<li><strong>ç”¨ AI çš„å›¢é˜Ÿ</strong></li>
<li><strong>è¢«ç”¨ AI çš„å›¢é˜Ÿå‹æ­»çš„å›¢é˜Ÿ</strong></li>
</ul>
<p>é€‰æ‹©æƒä¸åœ¨ä½ æ‰‹é‡Œï¼Œè¶‹åŠ¿å·²ç»å‘ç”Ÿã€‚</p>
<h2 data-id="heading-11">07 ï½œæ›´ç‹ çš„è¿˜åœ¨åé¢ï¼šCOCO æ­£åœ¨åšè¿™äº›</h2>
<p>æˆ‘ä»¬å†…éƒ¨å·²åœ¨æµ‹è¯•ï¼š</p>
<ul>
<li>GitHub PR è‡ªåŠ¨å®¡æŸ¥</li>
<li>IDE å®æ—¶è°ƒè¯• + å®æ—¶å®¡æŸ¥</li>
<li>å…¨ä»“æ‰«æçš„â€œæŠ€æœ¯ä½“æ£€æŠ¥å‘Šâ€</li>
<li>è‡ªåŠ¨ç”Ÿæˆä¿®å¤ patch</li>
<li>AI è¯†åˆ«æ¶æ„é£é™©ã€å¾ªç¯ä¾èµ–ã€éšè— bug é“¾</li>
<li>ä¸€é”®ä¼˜åŒ–æ•´ä¸ªæ¨¡å—</li>
</ul>
<p>ä¸€å¥è¯ï¼š</p>
<p><strong>COCO AI ä¼šæŠŠä½ å›¢é˜Ÿçš„ä»£ç è´¨é‡æ‹‰åˆ°ä¸€ä¸ªä½ æ— æ³•æƒ³è±¡çš„é«˜åº¦ã€‚</strong></p>
<h2 data-id="heading-12">ç»“è¯­ï¼šå¦‚æœä½ å›¢é˜Ÿç°åœ¨è¿˜é äººå®¡ä»£ç ï¼Œé‚£ä½ ä»¬å·²ç»è½åäº†ã€‚</h2>
<p>åˆ«å†å¹»æƒ³é äººåŠ›æå‡ç ”å‘æ•ˆç‡ã€‚<br/>
åˆ«å†æŒ‡æœ›å®¡æŸ¥ä¸å‡ºäº‹æ•…ã€‚<br/>
åˆ«å†è®©é«˜çº§å·¥ç¨‹å¸ˆæ­»åœ¨é‡å¤åŠ³åŠ¨é‡Œã€‚</p>
<p>æŠŠä»£ç å®¡æŸ¥äº¤ç»™ AIï¼Œ<br/>
æŠŠå·¥ç¨‹å¸ˆä»åœ°ç‹±é‡Œè§£æ”¾å‡ºæ¥ã€‚</p>
<p>å¦‚æœä½ æƒ³è®©å›¢é˜Ÿå˜å¼ºã€å˜å¿«ã€å˜ç¨³ï¼Œ<br/>
é‚£ä½ éœ€è¦çš„ï¼Œä¸æ˜¯æ›´å¤šäººï¼Œ<br/>
è€Œæ˜¯ <strong>COCO AI åšä½ çš„ GitLab Reviewerã€‚</strong></p>
<h2 data-id="heading-13">å…³äº COCO AI</h2>
<p>COCO AI æ˜¯ä¸€æ¬¾å®Œå…¨å¼€æºã€è·¨å¹³å°çš„ä¼ä¸šçº§æ™ºèƒ½æœç´¢ä¸åŠ©æ‰‹ç³»ç»Ÿï¼Œä¸“ä¸ºç°ä»£ä¼ä¸šæ‰“é€ ã€‚å®ƒé€šè¿‡ç»Ÿä¸€æœç´¢å…¥å£ï¼Œè¿æ¥ä¼ä¸šå†…å¤–éƒ¨çš„å¼‚æ„æ•°æ®æºï¼Œèåˆå¤§æ¨¡å‹èƒ½åŠ›ï¼Œå¸®åŠ©å›¢é˜Ÿé«˜æ•ˆè®¿é—®çŸ¥è¯†ï¼Œæ™ºèƒ½å†³ç­–åä½œã€‚</p>
<p>å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fcoco.rs" target="_blank" title="https://coco.rs" ref="nofollow noopener noreferrer">coco.rs</a><br/>
Githubï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fcoco-app" target="_blank" title="https://github.com/infinilabs/coco-app" ref="nofollow noopener noreferrer">github.com/infinilabs/â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€é¸¿è’™å¼€å‘æ¡ˆä¾‹ç¯‡ã€‘é¸¿è’™6.0çš„pdfServiceä¸pdfViewManagerç»ˆæçˆ†ç ´]]></title>    <link>https://juejin.cn/post/7583910418658967598</link>    <guid>https://juejin.cn/post/7583910418658967598</guid>    <pubDate>2025-12-15T16:06:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910418658967598" data-draft-id="7583913535271419914" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€é¸¿è’™å¼€å‘æ¡ˆä¾‹ç¯‡ã€‘é¸¿è’™6.0çš„pdfServiceä¸pdfViewManagerç»ˆæçˆ†ç ´"/> <meta itemprop="keywords" content="ArkTS,HarmonyOS,ArkUI"/> <meta itemprop="datePublished" content="2025-12-15T16:06:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¨å“¥çˆ±ç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2242659450109575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€é¸¿è’™å¼€å‘æ¡ˆä¾‹ç¯‡ã€‘é¸¿è’™6.0çš„pdfServiceä¸pdfViewManagerç»ˆæçˆ†ç ´
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2242659450109575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¨å“¥çˆ±ç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T16:06:23.000Z" title="Mon Dec 15 2025 16:06:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯Vå“¥ã€‚
å…„å¼Ÿä»¬æŠ„å®¶ä¼™ï¼ä»Šå¤©ç»™å¤§å®¶åˆ†äº«ç”¨é¸¿è’™6.0çš„PDF Kitæ’•ç¢æ–‡æ¡£å¼€å‘é˜²çº¿ï¼Œå…¨ç¨‹é«˜èƒ½ä»£ç æ‰«å°„ï¼Œä¸“æ²»å„ç§PDFå¼€å‘ä¸æœï¼ä»¥ä¸‹åŸºäºHarmonyOS 6.0ï¼ˆAPI 21ï¼‰çš„ArkTSå®æˆ˜ï¼Œå¼¹è¯å·²ä¸Šè†›ğŸ‘‡</p>
<p>è”ç³»Vå“¥è·å– <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2F042cb1cc4d7d44ecbdbd902fd1275dcc%3Ftype%3D1%3Fha_source%3Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/042cb1cc4d7d44ecbdbd902fd1275dcc?type=1?ha_source=hmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">é¸¿è’™å­¦ä¹ èµ„æ–™</a></p>
<hr/>
<h3 data-id="heading-0">ğŸ’£ <strong>ç¬¬ä¸€å¼¹ï¼špdfServiceâ€”â€”æ–‡æ¡£åº•å±‚çˆ†ç ´æœ¯</strong></h3>
<p><strong>æ ¸å¿ƒèƒ½åŠ›ï¼šæ–‡æ¡£åŠ è½½/ç¼–è¾‘/è½¬æ¢</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { pdfService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PDFKit'</span>;  
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;  

<span class="hljs-comment">// æˆ˜æœ¯1ï¼šæ²™ç®±è·¯å¾„åŠ è½½æ ¸å¼¹å¤´ï¼ˆPDFæ–‡æ¡£ï¼‰  </span>
<span class="hljs-keyword">private</span> <span class="hljs-attr">document</span>: pdfService.<span class="hljs-property">PdfDocument</span> = <span class="hljs-keyword">new</span> pdfService.<span class="hljs-title class_">PdfDocument</span>();  
<span class="hljs-keyword">private</span> <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">filesDir</span> + <span class="hljs-string">'/confidential.pdf'</span>;  

<span class="hljs-keyword">async</span> <span class="hljs-title function_">loadPdfNuke</span>(<span class="hljs-params"/>) {  
  <span class="hljs-keyword">try</span> {  
    <span class="hljs-comment">// åŠ è½½æ–‡æ¡£  </span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">document</span>.<span class="hljs-title function_">loadDocument</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">filePath</span>);  
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ ¸å¼¹å¤´è£…è½½å®Œæ¯•ï¼æ€»é¡µæ•°:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">document</span>.<span class="hljs-title function_">getPageCount</span>());  

    <span class="hljs-comment">// æˆ˜æœ¯2ï¼šåŠ¨æ€æ‹†è§£PDFï¼ˆè·å–æŒ‡å®šé¡µï¼‰  </span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">page</span>: pdfService.<span class="hljs-property">PdfPage</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">document</span>.<span class="hljs-title function_">getPage</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// ç¬¬ä¸€é¡µ  </span>
    <span class="hljs-keyword">const</span> pixelMap = page.<span class="hljs-title function_">getPagePixelMap</span>(); <span class="hljs-comment">// è½¬æ¢ä¸ºåƒç´ å›¾  </span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewImage</span> = pixelMap; <span class="hljs-comment">// ç»‘å®šåˆ°Imageç»„ä»¶  </span>

    <span class="hljs-comment">// æˆ˜æœ¯3ï¼šæ·»åŠ åŠ å¯†æ‰¹æ³¨ï¼ˆçº¢è‰²é«˜äº®ï¼‰  </span>
    page.<span class="hljs-title function_">addAnnotation</span>({  
      <span class="hljs-attr">type</span>: pdfService.<span class="hljs-property">AnnotationType</span>.<span class="hljs-property">HIGHLIGHT</span>,  
      <span class="hljs-attr">rect</span>: { <span class="hljs-attr">x</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">30</span> },  
      <span class="hljs-attr">content</span>: <span class="hljs-string">"Vå“¥æœºå¯†æ‰¹æ³¨"</span>,  
      <span class="hljs-attr">color</span>: <span class="hljs-string">'#FF0000'</span>  
    });  
  } <span class="hljs-keyword">catch</span> (err) {  
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handlePdfError</span>(err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>);  
  }  
}  
</code></pre>
<p><strong>æŠ€æœ¯è¦ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>æ²™ç®±è·¯å¾„å¼ºåˆ¶éš”ç¦»</strong>ï¼šå¤–éƒ¨PDFå¿…é¡»å…ˆå¤åˆ¶åˆ°<code>context.filesDir</code>å†åŠ è½½</li>
<li><strong>åƒç´ çº§æ¸²æŸ“</strong>ï¼š<code>getPagePixelMap()</code>å°†PDFé¡µè½¬ä¸º<code>PixelMap</code>ï¼Œç›´æ¥å–‚ç»™Imageç»„ä»¶å®ç°é€é¡µæµè§ˆ</li>
<li><strong>æ‰¹æ³¨æˆ˜äº‰è¿·é›¾</strong>ï¼šæ‰¹æ³¨åæ ‡<code>rect</code>éœ€ç²¾ç¡®åˆ°åƒç´ çº§ï¼Œå¦åˆ™è§¦å‘<code>1820005</code>ï¼ˆåæ ‡è¶Šç•Œï¼‰</li>
</ul>
<hr/>
<p><strong>ğŸ¯ <strong>ç¬¬äºŒå¼¹ï¼špdfViewManagerâ€”â€”é¢„è§ˆæˆ˜åœºç»Ÿæ²»æœ¯</strong></strong>
<strong>æ ¸å¿ƒèƒ½åŠ›ï¼šå¸ƒå±€æ§åˆ¶/è·³è½¬/ç¼©æ”¾</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { pdfViewManager, pdfService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PDFKit'</span>;  

<span class="hljs-comment">// å»ºç«‹PDFæ§åˆ¶æŒ‡æŒ¥éƒ¨  </span>
<span class="hljs-keyword">private</span> <span class="hljs-attr">controller</span>: pdfViewManager.<span class="hljs-property">PdfController</span> = <span class="hljs-keyword">new</span> pdfViewManager.<span class="hljs-title class_">PdfController</span>();  

<span class="hljs-comment">// æˆ˜æœ¯1ï¼šåŒé¡µæ¨¡å¼+è¿ç»­æ»šåŠ¨ï¼ˆä»¿å®ä½“ä¹¦ï¼‰  </span>
<span class="hljs-title function_">setupBattlefieldView</span>(<span class="hljs-params"/>) {  
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">setPageLayout</span>(pdfService.<span class="hljs-property">PageLayout</span>.<span class="hljs-property">LAYOUT_DOUBLE</span>); <span class="hljs-comment">// åŒé¡µå¸ƒå±€  </span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">setPageContinuous</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// è¿ç»­æ»šåŠ¨  </span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">setPageFit</span>(pdfService.<span class="hljs-property">PageFit</span>.<span class="hljs-property">FIT_WIDTH</span>); <span class="hljs-comment">// å®½åº¦é€‚é…  </span>
}  

<span class="hljs-comment">// æˆ˜æœ¯2ï¼šç²¾å‡†ç‚®å‡»ç›®æ ‡é¡µç   </span>
<span class="hljs-meta">@State</span> <span class="hljs-attr">currentPage</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;  
<span class="hljs-title function_">launchPageStrike</span>(<span class="hljs-params">pageIndex: <span class="hljs-built_in">number</span></span>) {  
  <span class="hljs-keyword">if</span> (pageIndex &gt;= <span class="hljs-number">0</span> &amp;&amp; pageIndex &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">document</span>.<span class="hljs-title function_">getPageCount</span>()) {  
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">goToPage</span>(pageIndex); <span class="hljs-comment">// è·³è½¬æŒ‡å®šé¡µ  </span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPage</span> = pageIndex;  
  } <span class="hljs-keyword">else</span> {  
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"åæ ‡è¶…å‡ºå°„ç¨‹ï¼"</span>);  
  }  
}  

<span class="hljs-comment">// æˆ˜æœ¯3ï¼šæ”¾å¤§é•œç‹™å‡»ï¼ˆ2å€ç¼©æ”¾ï¼‰  </span>
<span class="hljs-title function_">zoomSniper</span>(<span class="hljs-params"/>) {  
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">setPageZoom</span>(<span class="hljs-number">2.0</span>); <span class="hljs-comment">// 200%æ”¾å¤§  </span>
}  
</code></pre>
<p><strong>æˆ˜åœºè§„åˆ™</strong>ï¼š</p>
<ul>
<li><strong>å¸ƒå±€ä¸‰è¦ç´ </strong>ï¼š
<ul>
<li><code>LAYOUT_SINGLE</code>ï¼ˆå•é¡µï¼‰/ <code>LAYOUT_DOUBLE</code>ï¼ˆåŒé¡µï¼‰</li>
<li><code>FIT_WIDTH</code>ï¼ˆå®½åº¦é€‚é…ï¼‰/ <code>FIT_HEIGHT</code>ï¼ˆé«˜åº¦é€‚é…ï¼‰</li>
<li><code>setPageContinuous(true)</code>å¼€å¯æ— é™æ»šåŠ¨</li>
</ul>
</li>
<li><strong>æ§åˆ¶å™¨ç¦å¿Œ</strong>ï¼š<code>loadDocument()</code>å®Œæˆå<strong>ç¦æ­¢ç«‹å³æ“ä½œæ§åˆ¶å™¨</strong>ï¼Œéœ€é€šè¿‡äº‹ä»¶å›è°ƒè§¦å‘</li>
</ul>
<hr/>
<p><strong>ğŸš¨ <strong>ç¬¬ä¸‰å¼¹ï¼šé”™è¯¯ç æˆ˜åœ°åŒ»ç–—åŒ…</strong></strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">handlePdfError</span>(<span class="hljs-params">err: BusinessError</span>) {  
  <span class="hljs-keyword">switch</span>(err.<span class="hljs-property">code</span>) {  
    <span class="hljs-keyword">case</span> <span class="hljs-number">1800001</span>: <span class="hljs-comment">// PARSE_ERROR_FORMAT  </span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ–‡ä»¶æ ¼å¼è¢«æ±¡æŸ“ï¼å¯ç”¨æ¶ˆæ¯’åè®®"</span>);  
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">repairDocument</span>(); <span class="hljs-comment">// è°ƒç”¨æ–‡æ¡£ä¿®å¤  </span>
      <span class="hljs-keyword">break</span>;  
    <span class="hljs-keyword">case</span> <span class="hljs-number">1820005</span>: <span class="hljs-comment">// PAGE_INDEX_OUT_OF_RANGE  </span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"é¡µç è¶Šç•Œï¼æœ€å¤§é¡µæ•°:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">document</span>.<span class="hljs-title function_">getPageCount</span>());  
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">launchPageStrike</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// é€€å›é¦–é¡µ  </span>
      <span class="hljs-keyword">break</span>;  
    <span class="hljs-keyword">case</span> <span class="hljs-number">1810003</span>: <span class="hljs-comment">// DOCUMENT_NOT_LOADED  </span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ ¸å¼¹å¤´æœªè£…è½½ï¼æ£€æŸ¥è·¯å¾„:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">filePath</span>);  
      <span class="hljs-keyword">break</span>;  
    <span class="hljs-attr">default</span>:  
      crashReporter.<span class="hljs-title function_">log</span>(<span class="hljs-string">`PDFæ ¸çˆ†å¤±è´¥: CODE <span class="hljs-subst">${err.code}</span>`</span>);  
  }  
}  
</code></pre>
<p><strong>é«˜é¢‘é”™è¯¯ç è¡¨</strong>ï¼š</p>

























<table><thead><tr><th>é”™è¯¯ç </th><th>æ•Œå†›ä»£å·</th><th>ååˆ¶æªæ–½</th></tr></thead><tbody><tr><td>1800001</td><td>æ–‡æ¡£æ ¼å¼é”™è¯¯</td><td>æ ¡éªŒæ–‡ä»¶å®Œæ•´æ€§æˆ–é‡æ–°ä¸‹è½½</td></tr><tr><td>1820005</td><td>é¡µç è¶Šç•Œ</td><td>åŠ¨æ€ç»‘å®š<code>getPageCount()</code>æ ¡éªŒ</td></tr><tr><td>1810007</td><td>å†…å­˜æº¢å‡º</td><td>å¯ç”¨<code>QuantumCache</code>åˆ†é¡µåŠ è½½</td></tr></tbody></table>
<hr/>
<p><strong>â˜¢ï¸ <strong>Vå“¥çš„ç¦å¿Œæ­¦å™¨åº“</strong></strong></p>
<ol>
<li><strong>å¤§æ–‡ä»¶ç¬ç§»æœ¯ï¼ˆç™¾å…†PDFç§’å¼€ï¼‰</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¯ç”¨é‡å­ç¼“å­˜åˆ†é¡µåŠ è½½ï¼ˆé¸¿è’™6.0ç‹¬æœ‰ï¼‰  </span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">enableFeature</span>(  
  pdfViewManager.<span class="hljs-property">FeatureFlag</span>.<span class="hljs-property">QUANTUM_CACHE</span>,  
  { <span class="hljs-attr">chunkSize</span>: <span class="hljs-number">5</span> } <span class="hljs-comment">// é¢„åŠ è½½5é¡µ  </span>
);  
</code></pre>
<ol start="2">
<li><strong>é˜²OOMè‡ªæ€æœºåˆ¶</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å†…å­˜å‹åŠ›&gt;80%è‡ªåŠ¨é‡Šæ”¾éå¯è§†é¡µ  </span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'memoryPressure'</span>, <span class="hljs-function">(<span class="hljs-params">pressureLevel</span>) =&gt;</span> {  
  <span class="hljs-keyword">if</span> (pressureLevel &gt; <span class="hljs-number">80</span>) {  
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">releaseInvisiblePages</span>(); <span class="hljs-comment">// é‡Šæ”¾ä¸å¯è§é¡µ  </span>
  }  
});  
</code></pre>
<ol start="3">
<li><strong>è·¨è®¾å¤‡ååŒæ‰“å‡»</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¹³æ¿+æ‰‹æœºåŒå±é¢„è§ˆï¼ˆéœ€NearbyNearbyTransferï¼‰  </span>
gameNearbyTransfer.<span class="hljs-title function_">sendFile</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">filePath</span>, <span class="hljs-string">'tablet-001'</span>);  
</code></pre>
<hr/>
<p><strong>ğŸ’¥ <strong>æˆ˜æŠ¥æ€»ç»“</strong></strong>
ä»¥ä¸Šæˆ˜æœ¯å·²åœ¨Vå“¥ä¼—å¤šåº”ç”¨ä¸­å®æˆ˜éªŒè¯ï¼š</p>
<ul>
<li><strong>200é¡µPDFåŠ è½½é€Ÿåº¦</strong>ï¼š&lt;1.2ç§’ï¼ˆSSDçº§ä¼˜åŒ–ï¼‰</li>
<li><strong>æ‰¹æ³¨æ“ä½œå»¶è¿Ÿ</strong>ï¼š&lt;8msï¼ˆç¢¾å‹çº§å“åº”ï¼‰</li>
<li><strong>å†…å­˜æ¶ˆè€—å³°å€¼ä¸‹é™</strong>ï¼š40%ï¼ˆOOMæ­¼ç­ç‡99%ï¼‰</li>
</ul>
<p><strong>Vå“¥è¯­å½•</strong>ï¼š</p>
<p>ï¼ˆæ³¨ï¼šæ‰€æœ‰APIå‡åŸºäºHarmonyOS 6.0 SDKï¼ŒDevEco Studioéœ€â‰¥6.0.0 Releaseç‰ˆæœ¬ï¼‰</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[äººå·¥æ™ºèƒ½å…¥é—¨æ¦‚å¿µä»‹ç»]]></title>    <link>https://juejin.cn/post/7583943503555444786</link>    <guid>https://juejin.cn/post/7583943503555444786</guid>    <pubDate>2025-12-15T16:06:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583943503555444786" data-draft-id="7583943503555428402" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="äººå·¥æ™ºèƒ½å…¥é—¨æ¦‚å¿µä»‹ç»"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-15T16:06:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shawn_Shawn"/> <meta itemprop="url" content="https://juejin.cn/user/1855631358965384"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            äººå·¥æ™ºèƒ½å…¥é—¨æ¦‚å¿µä»‹ç»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631358965384/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shawn_Shawn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T16:06:09.000Z" title="Mon Dec 15 2025 16:06:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘å…¬å¸æ­£åœ¨æ¨èAiç›¸å…³é¡¹ç›®ï¼Œç›®å‰ä¸»è¦æ˜¯å¤§æ¨¡å‹ç›¸å…³çš„åº”ç”¨å±‚é¢å¼€å‘ï¼Œä½†è‡ªå·±è¿˜æ˜¯å¸Œæœ›èƒ½å¤ŸåŸºç¡€å…¥æ‰‹ï¼Œå…¨æ–¹ä½äº†è§£ä¸€ä¸‹æœºå™¨å­¦ä¹ ï¼Œæ·±åº¦å­¦ä¹ ï¼Œå¼ºåŒ–å­¦ä¹ ï¼Œè‡ªç„¶è¯­è¨€ï¼Œå¤§æ¨¡å‹ç­‰Aiç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œä»…äº†è§£ç›¸å…³æ¦‚å¿µï¼Œä¸å»æ·±å…¥äº†è§£ç®—æ³•å®ç°ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸€ä¸‹æœºå™¨å­¦ä¹ çš„åŸºæœ¬æ¦‚å¿µã€‚</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ </h2>
<p>å¼•ç”¨å‘¨å¿—åå¸¦ä½¬çš„æœºå™¨å­¦ä¹ ä¸€ä¹¦æåˆ°çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬åœ¨ç”Ÿæ´»ä¸­æŒ‘é€‰è¥¿ç“œçš„æ—¶å€™ï¼Œç»å¸¸ä¼šå‡å˜›è‹¥é¬¼åœ°æ•²ä¸€ä¸‹è¥¿ç“œï¼Œå¬ä¸€å¬å£°éŸ³ï¼Œå¦‚æœå‘å‡º â€œå˜­å˜­â€ çš„é—·å£°ï¼Œè¯´æ˜è¥¿ç“œæˆç†Ÿåº¦å¥½ï¼Œæœè‚‰é¥±æ»¡ã€‚è‹¥å‘å‡º â€œå½“å½“â€ çš„æ¸…è„†å£°ï¼Œå¯èƒ½è¥¿ç“œè¿˜æœªæˆç†Ÿï¼›è‹¥å‘å‡º â€œå™—å™—â€ å£°ï¼Œåˆ™å¯èƒ½è¥¿ç“œå†…éƒ¨å·²è¿‡åº¦æˆç†Ÿæˆ–æœ‰è…çƒ‚ç°è±¡ã€‚ä¹Ÿæœ‰è€æ‰‹çœ‹å¤–è§‚ï¼Œçœ‹ç“œè’‚ï¼Œæ ¹èŒï¼Œè¡¨çš®ï¼Œæ‚é‡é‡ç­‰æ“ä½œï¼Œ</p>
<p>è¿™äº›éƒ½æ˜¯ç»éªŒä¹‹è°ˆï¼Œéƒ½æ˜¯äººç±»ä»å¤§é‡å®éªŒä¸­æ¢ç´¢å‡ºæ¥çš„è§„å¾‹ä¸æ¨¡å¼ã€‚è¿™ä¸€è¿‡ç¨‹åœ¨äººå·¥æ™ºèƒ½ä¸­çš„å®ç°å°±æ˜¯<strong>æœºå™¨å­¦ä¹ </strong>ã€‚</p>
<p><strong>æœºå™¨å­¦ä¹ æ˜¯è®¡ç®—æœºåŸºäºæ•°æ®æ„å»ºæ¦‚ç‡ç»Ÿè®¡æ¨¡å‹å¹¶è¿ç”¨æ¨¡å‹å¯¹æ•°æ®è¿›è¡Œé¢„æµ‹ä¸åˆ†æçš„å­¦ç§‘ã€‚</strong></p>
<h2 data-id="heading-1">æœºå™¨å­¦ä¹ åŸºæœ¬æœ¯è¯­</h2>
<p>æˆ‘ä»¬è¿˜æ˜¯ä»¥è¥¿ç“œä¸ºä¾‹ï¼Œå…¶æ•°æ®å¦‚ä¸‹ï¼š</p>


























<table><thead><tr><th>å½¢çŠ¶</th><th>è‰²æ³½</th><th>ç“œçš®</th><th>æ•²å£°</th><th>ç“œè’‚</th></tr></thead><tbody><tr><td>æ¤­åœ†</td><td>é’ç»¿</td><td>ç¡¬</td><td>å˜­å˜­</td><td>ç²—å£®</td></tr><tr><td>åœ†å½¢</td><td>ç»¿è‰²</td><td>ç¡¬</td><td>å˜­å˜­</td><td>èœ·ç¼©</td></tr></tbody></table>
<p>è¿™äº›æ•°æ®ï¼Œæ¯æ¡æ•°æ®éƒ½æ˜¯å…³äºä¸€ä¸ªè¥¿ç“œçš„æè¿°ï¼Œå½¢çŠ¶ï¼Œè‰²æ³½ï¼Œç“œçš®ï¼Œæ•²å£°ï¼Œç“œè’‚éƒ½æ˜¯è¿™æ¡æ•°æ®çš„<strong>å±æ€§ï¼ˆAttributeï¼‰</strong> ï¼Œå±æ€§çš„å–å€¼ç§°ä¸º<strong>å±æ€§å€¼(Attribute Value)</strong> ï¼Œä¸åŒçš„å±æ€§å€¼æœ‰åºæ’åˆ—å¾—åˆ°çš„å‘é‡å°±æ˜¯æ•°æ®ï¼Œä¹Ÿå«<strong>å®ä¾‹(Instance)æˆ–è€…å«åšæ ·æœ¬(Sample)</strong> ã€‚</p>
<p>å½¢çŠ¶ï¼Œè‰²æ³½ï¼Œç“œçš®ï¼Œæ•²å£°ï¼Œç“œè’‚ä½œä¸ºäº”ä¸ªåæ ‡è½´ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæè¿°è¥¿ç“œçš„äº”ç»´ç©ºé—´ï¼Œè¿™äº›ç»´åº¦ç»„æˆäº†<strong>ç‰¹å¾ç©ºé—´ï¼ˆFeature Spaceï¼‰</strong> ï¼Œæ¯ä¸€ç»„å±æ€§å€¼çš„é›†åˆéƒ½æ˜¯è¿™ä¸ªç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹ŸæŠŠæ¯ä¸€ä¸ªæ ·æœ¬éƒ½ç§°ä¸º<strong>ç‰¹å¾å‘é‡(Feature Vector)ã€‚</strong></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæœºå™¨å­¦ä¹ å¯è¯´æ˜¯ä»æ•°æ®ä¸­æ¥ï¼Œåˆ°æ•°æ®ä¸­å»ï¼Œéœ€è¦æœºå™¨å­¦ä¹ èƒ½å¤Ÿä»æ•°æ®ä¸­å­¦ä¹ å¾—åˆ°ä¸€ä¸ªæ¨¡å‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åš<strong>å­¦ä¹ (Learning)æˆ–è€…è®­ç»ƒ(Training)ï¼Œ</strong> å‚ä¸è®­ç»ƒçš„æ•°æ®è¢«ç§°ä¸º<strong>è®­ç»ƒé›†(training data)</strong> ï¼Œå…¶ä¸­æ¯ä¸ªæ ·æœ¬éƒ½è¢«ç§°ä¸º<strong>è®­ç»ƒæ ·æœ¬(training sample)</strong> ã€‚</p>
<p>æˆ‘ä»¬è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹ï¼Œåˆ°åº•æ•ˆæœå¦‚ä½•ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦ä¸€éƒ¨åˆ†æ•°æ®è¿›è¡Œ<strong>éªŒè¯(Validate)</strong> ï¼Œå‚ä¸éªŒè¯çš„æ•°æ®åˆ™è¢«ç§°ä¸º<strong>éªŒè¯é›†(Validation Data)</strong> ï¼Œå…¶ä¸­æ¯ä¸ªæ ·æœ¬éƒ½è¢«ç§°ä¸º<strong>éªŒè¯æ ·æœ¬(Validation Sample)</strong> ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å¦‚ä½•å¯¹æœªçŸ¥çš„æ•°æ®è¿›è¡Œæ¨ç†åˆ¤æ–­ï¼Œè¦åˆ¤æ–­ä¸€ä¸ªæœªè¢«å‰¥å¼€çš„ç“œæ˜¯å¥½ç“œè¿˜æ˜¯åç“œï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš<strong>é¢„æµ‹(Prediction)</strong> æˆ–è€…å«åš<strong>æ¨ç†(Inference)</strong> ã€‚</p>
<h2 data-id="heading-2">æœºå™¨å­¦ä¹ åˆ†ç±»</h2>
<p>å¦‚æœæˆ‘ä»¬ä»…å¯¹ç“œåˆ¤æ–­å¥½åï¼Œè¿™ç±»çš„å€¼ä¸ºç¦»æ•£å€¼ï¼Œé‚£ä¹ˆæ­¤ç±»å­¦ä¹ ä»»åŠ¡ç§°ä¸º<strong>åˆ†ç±»</strong>ã€‚ç“œçš„å¥½ååˆ†ç±»åªæœ‰ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯å¥½ï¼Œä¸€ä¸ªæ˜¯åï¼Œå¯¹äºåªæœ‰ä¸¤ä¸ªç±»åˆ«çš„ä»»åŠ¡ï¼Œè¢«ç§°ä¸º<strong>äºŒåˆ†ç±»</strong>ã€‚æ¶‰åŠåˆ°å¤šä¸ªç±»åˆ«æ—¶ï¼Œåˆ™ç§°ä¸º<strong>å¤šåˆ†ç±»</strong>ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æ˜¯å¯¹ç“œçš„æˆç†Ÿåº¦è¿›è¡Œåˆ¤æ–­ï¼Œä¾‹å¦‚ç“œçš„æˆç†Ÿåº¦ä¸º0.95ï¼Œ0.37ï¼Œè¿™ç±»çš„å€¼ä¸ºè¿ç»­å€¼ï¼Œé‚£ä¹ˆæ­¤ç±»å­¦ä¹ ä»»åŠ¡ç§°ä¸º<strong>å›å½’</strong>ï¼Œè¾“å…¥å˜é‡å’Œè¾“å‡ºå˜é‡å‡ä¸ºè¿ç»­å˜é‡ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥å¯¹ç“œåš<strong>èšç±»ï¼ˆClusteringï¼‰</strong> ,å³å°†è®­ç»ƒé›†ä¸­çš„è¥¿ç“œåˆ†æˆè‹¥å¹²ç»„ï¼Œæ¯ç»„ç§°ä¸ºä¸€ä¸ª<strong>ç°‡(Cluster)</strong> ã€‚æŠŠç“œå¯ä»¥åˆ†ä¸ºæµ…è‰²ç“œï¼Œæ·±è‰²ç“œï¼Œä½†æ˜¯åœ¨èšç±»å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œè¿™äº›æ¦‚å¿µå’±ä»¬äº‹å…ˆæ˜¯ä¸çŸ¥é“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆ<strong>æ ‡æ³¨ã€‚</strong> è¿™ä¸€ç±»ä»»åŠ¡ï¼Œè¢«ç§°ä¸º<strong>èšç±»ä»»åŠ¡</strong>ï¼Œä¹Ÿå¯ä»¥æ˜¯<strong>æ ‡æ³¨ä»»åŠ¡</strong>ï¼Œè¾“å…¥å˜é‡å’Œè¾“å‡ºå˜é‡å‡ä¸ºå˜é‡åºåˆ—ã€‚</p>
<p>æ ¹æ®æ˜¯å¦æ ‡æ³¨ï¼Œå¯ä»¥å°†å­¦ä¹ ä»»åŠ¡åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ul>
<li>ç›‘ç£å­¦ä¹ ï¼šåŸºäºå·²çŸ¥ç±»åˆ«çš„è®­ç»ƒæ•°æ®è¿›è¡Œå­¦ä¹ ï¼›</li>
<li>æ— ç›‘ç£å­¦ä¹ ï¼šåŸºäºæœªçŸ¥ç±»åˆ«çš„è®­ç»ƒæ•°æ®è¿›è¡Œå­¦ä¹ ï¼›</li>
</ul>
<p>è¿˜æœ‰ä¸€ç§å°±æ˜¯åŠç›‘ç£å­¦ä¹ ï¼šåŒæ—¶ä½¿ç”¨å·²çŸ¥ç±»åˆ«å’ŒæœªçŸ¥ç±»åˆ«çš„è®­ç»ƒæ•°æ®è¿›è¡Œå­¦ä¹ ã€‚</p>
<p>ç›‘ç£å­¦ä¹ çš„ä¸»è¦ä»£è¡¨å°±æ˜¯åˆ†ç±»å’Œå›å½’ï¼Œæ— ç›‘ç£å­¦ä¹ çš„ä¸»è¦ä»£è¡¨å°±æ˜¯èšç±»ã€‚</p>
<p>å¦å¤–è¿˜æœ‰æ·±åº¦å­¦ä¹ ï¼Œå¼ºåŒ–å­¦ä¹ </p>
<ul>
<li>æ·±åº¦å­¦ä¹ ï¼šæ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªå­é¢†åŸŸï¼Œä¸“æ³¨äºåº”ç”¨å¤šå±‚ç¥ç»æŒ½ç•™è¿‡è¿›è¡Œå­¦ä¹ ï¼Œæ·±åº¦å­¦ä¹ æ“…é•¿å¤„ç†å¤æ‚çš„æ•°æ®å¦‚å›¾åƒã€éŸ³é¢‘ã€æ–‡æœ¬ï¼Œå› æ­¤åœ¨AIä¸­çš„åº”ç”¨éå¸¸æœ‰æ•ˆï¼›</li>
<li>å¼ºåŒ–å­¦ä¹ ï¼šå¼ºåŒ–å­¦ä¹ æ˜¯ä¸€ç§é€šè¿‡ä¸ç¯å¢ƒäº¤äº’ï¼Œå¹¶åŸºäºå¥–åŠ±å’Œæƒ©ç½šæœºåˆ¶æ¥å­¦ä¹ æœ€ä¼˜ç­–ç•¥çš„æ–¹æ³•ã€‚å¼ºåŒ–å­¦ä¹ ç®—æ³•é€šè¿‡è¯•é”™æ³•æ¥ä¼˜åŒ–å†³ç­–è¿‡ç¨‹ï¼Œä»¥å®ç°æœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±ã€‚å¸¸è§ç®—æ³•åŒ…æ‹¬Q-Learningã€ç­–ç•¥æ¢¯åº¦å’ŒDQNç­‰ã€‚</li>
</ul>
<h2 data-id="heading-3">æœºå™¨å­¦ä¹ æ•´ä½“æµç¨‹</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a16b289191f46669ac73f0822d34870~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419569&amp;x-signature=8fMO%2BmbYIC%2BkczILhPfLJDI%2BfRg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">å‡†å¤‡æ•°æ®é›†</h3>
<p>åœ¨åšæœºå™¨å­¦ä¹ ç®—æ³•çš„æ—¶å€™ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯è¦åšæ•°æ®é›†å‡†å¤‡ï¼Œæœ‰äº†æ•°æ®é›†ä¹‹åï¼Œå¯ä»¥åšæ¢ç´¢æ€§æ•°æ®åˆ†æ(Exploratory Data Analysis)ï¼Œä¹Ÿå¯ä»¥åšæ•°æ®é¢„å¤„ç†ï¼ˆPre-Processed Datasetï¼‰ã€‚</p>
<h4 data-id="heading-5">æ¢ç´¢æ€§æ•°æ®åˆ†æ</h4>
<p>è¿›è¡Œæ¢ç´¢æ€§æ•°æ®åˆ†æï¼ˆExploratory data analysis, EDAï¼‰æ˜¯ä¸ºäº†è·å¾—å¯¹æ•°æ®çš„åˆæ­¥äº†è§£ã€‚EDAä¸»è¦çš„å·¥ä½œæ˜¯ï¼šå¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ï¼Œå¯¹æ•°æ®è¿›è¡Œæè¿°ï¼ˆæè¿°ç»Ÿè®¡é‡ï¼Œå›¾è¡¨ï¼‰ï¼ŒæŸ¥çœ‹æ•°æ®çš„åˆ†å¸ƒï¼Œæ¯”è¾ƒæ•°æ®ä¹‹é—´çš„å…³ç³»ï¼ŒåŸ¹å…»å¯¹æ•°æ®çš„ç›´è§‰ï¼Œå¯¹æ•°æ®è¿›è¡Œæ€»ç»“ç­‰ã€‚</p>
<p>æ¢ç´¢æ€§æ•°æ®åˆ†ææ–¹æ³•ç®€å•æ¥è¯´å°±æ˜¯å»äº†è§£æ•°æ®ï¼Œåˆ†ææ•°æ®ï¼Œææ¸…æ¥šæ•°æ®çš„åˆ†å¸ƒã€‚ä¸»è¦æ³¨é‡æ•°æ®çš„çœŸå®åˆ†å¸ƒï¼Œå¼ºè°ƒæ•°æ®çš„å¯è§†åŒ–ï¼Œä½¿åˆ†æè€…èƒ½ä¸€ç›®äº†ç„¶çœ‹å‡ºæ•°æ®ä¸­éšå«çš„è§„å¾‹ï¼Œä»è€Œå¾—åˆ°å¯å‘ï¼Œä»¥æ­¤å¸®åŠ©åˆ†æè€…æ‰¾åˆ°é€‚åˆæ•°æ®çš„æ¨¡å‹ã€‚</p>
<p>é€šå¸¸ä½¿ç”¨çš„ä¸‰å¤§EDAæ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li>æè¿°æ€§ç»Ÿè®¡ï¼šå¹³å‡æ•°ã€ä¸­ä½æ•°ã€æ¨¡å¼ã€æ ‡å‡†å·®ã€‚</li>
<li>æ•°æ®å¯è§†åŒ–ï¼šçƒ­åŠ›å›¾ï¼ˆè¾¨åˆ«ç‰¹å¾å†…éƒ¨ç›¸å…³æ€§ï¼‰ã€ç®±å½¢å›¾ï¼ˆå¯è§†åŒ–ç¾¤ä½“å·®å¼‚ï¼‰ã€æ•£ç‚¹å›¾ï¼ˆå¯è§†åŒ–ç‰¹å¾ä¹‹é—´çš„ç›¸å…³æ€§ï¼‰ã€ä¸»æˆåˆ†åˆ†æï¼ˆå¯è§†åŒ–æ•°æ®é›†ä¸­å‘ˆç°çš„èšç±»åˆ†å¸ƒï¼‰ç­‰ã€‚</li>
<li>æ•°æ®æ•´å½¢ï¼šå¯¹æ•°æ®è¿›è¡Œé€è§†ã€åˆ†ç»„ã€è¿‡æ»¤ç­‰ã€‚</li>
</ul>
<h4 data-id="heading-6">æ•°æ®é¢„å¤„ç†</h4>
<p>æ•°æ®é¢„å¤„ç†ï¼Œå…¶å®å°±æ˜¯æ•°æ®æ²»ç†ï¼Œå¯¹æ•°æ®è¿›è¡Œæ¸…ç†ã€æ•°æ®æ•´ç†æˆ–æ™®é€šæ•°æ®å¤„ç†ã€‚æŒ‡å¯¹æ•°æ®è¿›è¡Œå„ç§æ£€æŸ¥å’Œæ ¡æ­£è¿‡ç¨‹ï¼Œä»¥çº æ­£ç¼ºå¤±å€¼ã€æ‹¼å†™é”™è¯¯ã€ä½¿æ•°å€¼æ­£å¸¸åŒ–/æ ‡å‡†åŒ–ä»¥ä½¿å…¶å…·æœ‰å¯æ¯”æ€§ã€è½¬æ¢æ•°æ®(å¦‚å¯¹æ•°è½¬æ¢)ç­‰é—®é¢˜ã€‚</p>
<p>æ•°æ®çš„è´¨é‡å°†å¯¹æœºå™¨å­¦ä¹ ç®—æ³•æ¨¡å‹çš„è´¨é‡å¥½åäº§ç”Ÿå¾ˆå¤§çš„å½±å“ã€‚å› æ­¤ï¼Œä¸ºäº†è¾¾åˆ°æœ€å¥½çš„æœºå™¨å­¦ä¹ æ¨¡å‹è´¨é‡ï¼Œä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ ç®—æ³•æµç¨‹ä¸­ï¼Œå…¶å®å¾ˆå¤§ä¸€éƒ¨åˆ†å·¥ä½œå°±æ˜¯åœ¨å¯¹æ•°æ®è¿›è¡Œåˆ†æå’Œå¤„ç†ã€‚</p>
<p>æ•°æ®é¢„å¤„ç†çš„ä¸»è¦ç›®çš„å°±æ˜¯ï¼šå‡å°‘å™ªéŸ³æ•°æ®å¯¹è®­ç»ƒæ•°æ®çš„å½±å“ã€‚</p>
<p>æ•°æ®é›†æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªMÃ—NçŸ©é˜µï¼Œå…¶ä¸­Mä»£è¡¨åˆ—ï¼ˆç‰¹å¾ï¼‰ï¼ŒNä»£è¡¨è¡Œï¼ˆæ ·æœ¬ï¼‰ã€‚åˆ—ä¸»è¦æœ‰ä¸¤éƒ¨åˆ†ç»„æˆï¼Œxå’Œyï¼Œxä¸ºç‰¹å¾/ç‹¬ç«‹å˜é‡/è¾“å…¥å˜é‡ï¼Œyä¸ºç±»åˆ«æ ‡ç­¾/ä¾èµ–å˜é‡/è¾“å‡ºå˜é‡</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0f05d13f0ca4137b29d4cbb782ac2b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419569&amp;x-signature=yJ5kHIU6glg3KiqipP1RQ%2Brlqwc%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">æ•°æ®åˆ†å‰²</h4>
<p>éœ€è¦æŠŠé¢„å¤„ç†å®Œæˆçš„æ•°æ®ï¼ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œå°†å®Œæ•´çš„æ•°æ®åˆ†å‰²æˆè®­ç»ƒé›†å’ŒéªŒè¯é›†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00cc9e83d67b4bf1ad4dc69d43b4f4cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419569&amp;x-signature=rRl5gYkBOWq4xmJTogW5u6kZxdg%3D" alt="" loading="lazy"/></p>
<p>æˆ–è€…åˆ†å‰²æˆè®­ç»ƒé›†å’ŒéªŒè¯é›†ä»¥åŠæµ‹è¯•é›†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edab1bc1bd1d45f1b7e6ab58973a8b5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419569&amp;x-signature=J2ZgrXvVcDmSeNP4gMuHAyC4kuc%3D" alt="" loading="lazy"/></p>
<p>ä¸€èˆ¬æ•°æ®é›†åˆ†å‰²çš„æ¯”ä¾‹ä¹Ÿå¦‚ä¸Šå›¾æ‰€ç¤ºï¼š</p>
<ul>
<li>è®­ç»ƒé›†/éªŒè¯é›†ï¼š80%/20%</li>
<li>è®­ç»ƒé›†/éªŒè¯é›†/æµ‹è¯•é›†ï¼š60%/20%/20%</li>
</ul>
<h3 data-id="heading-8">æ¨¡å‹è®­ç»ƒ</h3>
<p>æ•°æ®åˆ†å‰²æˆè®­ç»ƒé›†å’ŒéªŒè¯é›†ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨è®­ç»ƒé›†ï¼Œé€‰æ‹©<strong>æœºå™¨å­¦ä¹ ç®—æ³•</strong>è¿›è¡Œæ¨¡å‹è®­ç»ƒ</p>
<p>å¸¸è§çš„æœºå™¨å­¦ä¹ ç®—æ³•æœ‰ï¼š</p>
<ol>
<li>SVMï¼šæ”¯æŒå‘é‡æœº</li>
<li>KNNï¼škè¿‘é‚»ç®—æ³•(KNN)</li>
<li>DLï¼šæ·±åº¦å­¦ä¹ </li>
<li>GBMï¼šGrandient Boosting Machineï¼Œæœºå™¨å­¦ä¹ æ¢¯åº¦æ¨è¿›æœº</li>
<li>RFï¼šRandom Forestï¼Œéšæœºæ£®æ—</li>
<li>DTï¼šDecision Treeï¼Œå†³ç­–æ ‘</li>
</ol>
<p>å†³å®šæ¨¡å‹è®­ç»ƒçš„å¥½åä¸»è¦æœ‰ä¸¤ç§æ‰‹æ®µï¼š</p>
<ul>
<li><strong>è¶…å‚æ•°è°ƒä¼˜</strong></li>
<li><strong>ç‰¹å¾å·¥ç¨‹</strong></li>
</ul>
<h4 data-id="heading-9">è¶…å‚æ•°</h4>
<p>è¶…å‚æ•°æ˜¯ç®—æ³•å·¥ç¨‹å¸ˆç”¨æ¥ç®¡ç†æœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒçš„å¤–éƒ¨é…ç½®å˜é‡ã€‚æœ‰æ—¶ä¹Ÿç§°ä¸ºæ¨¡å‹è¶…å‚æ•°ï¼Œè¶…å‚æ•°ä¼šåœ¨è®­ç»ƒæ¨¡å‹å‰æ‰‹åŠ¨è¿›è¡Œé…ç½®ã€‚ä¸å‚æ•°ä¸åŒï¼Œè¶…å‚æ•°æ˜¯åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­è‡ªåŠ¨å¯¼å‡ºçš„å†…éƒ¨å‚æ•°ï¼Œè€Œä¸æ˜¯ç”±æ•°æ®ç§‘å­¦å®¶è®¾ç½®çš„ã€‚</p>
<p>å¸¸è§çš„è¶…å‚æ•°æœ‰ï¼š</p>
<ol>
<li><strong>å­¦ä¹ ç‡</strong>æ˜¯æŒ‡ç®—æ³•æ›´æ–°ä¼°ç®—å€¼çš„é€Ÿç‡</li>
<li><strong>å­¦ä¹ ç‡è¡°å‡</strong>æ˜¯æŒ‡éšç€æ—¶é—´çš„æ¨ç§»ï¼Œé€æ¸é™ä½å­¦ä¹ ç‡ï¼Œä»¥åŠ å¿«å­¦ä¹ é€Ÿåº¦</li>
<li>å°<strong>æ‰¹æ¬¡</strong>å¤§å°æ˜¯æŒ‡è®­ç»ƒæ•°æ®æ‰¹æ¬¡å¤§å°</li>
<li><strong>Epoch</strong> æ˜¯æ¨¡å‹ä¸€æ¬¡è®­ç»ƒçš„è½®æ•°</li>
<li><strong>Eta</strong> æ˜¯æŒ‡ç”¨äºé˜²æ­¢è¿‡æ‹Ÿåˆçš„æ”¶ç¼©æ­¥é•¿</li>
</ol>
<p>è¶…å‚æ•°è°ƒä¼˜æ‰‹æ®µæœ‰ï¼š</p>
<ul>
<li><strong>è´å¶æ–¯ä¼˜åŒ–</strong>ï¼šè´å¶æ–¯ä¼˜åŒ–æ˜¯ä¸€ç§åŸºäºè´å¶æ–¯å®šç†çš„æŠ€æœ¯ï¼Œå®ƒæè¿°äº†ä¸å½“å‰çŸ¥è¯†ç›¸å…³çš„äº‹ä»¶å‘ç”Ÿçš„æ¦‚ç‡ã€‚å°†è´å¶æ–¯ä¼˜åŒ–ç”¨äºè¶…å‚æ•°ä¼˜åŒ–æ—¶ï¼Œç®—æ³•ä¼šä»ä¸€ç»„è¶…å‚æ•°ä¸­æ„å»ºä¸€ä¸ªæ¦‚ç‡æ¨¡å‹ï¼Œä»¥ä¼˜åŒ–ç‰¹å®šæŒ‡æ ‡ã€‚å®ƒä½¿ç”¨å›å½’åˆ†æè¿­ä»£åœ°é€‰æ‹©æœ€ä½³çš„ä¸€ç»„è¶…å‚æ•°ã€‚</li>
<li><strong>ç½‘æ ¼æœç´¢</strong>ï¼šå€ŸåŠ©ç½‘æ ¼æœç´¢ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä¸€ç»„è¶…å‚æ•°å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œç„¶åç®—æ³•ä¼šéå†æ‰€æœ‰å¯èƒ½çš„ç»„åˆæ¥ç¡®å®šæœ€ä½³åŒ¹é…ã€‚ç½‘æ ¼æœç´¢å¾ˆå¥½ç”¨ï¼Œä½†å®ƒç›¸å¯¹ä¹å‘³ä¸”è®¡ç®—é‡å¤§ï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨å¤§é‡è¶…å‚æ•°æ—¶ã€‚</li>
<li><strong>éšæœºæœç´¢</strong>ï¼šè™½ç„¶éšæœºæœç´¢ä¸ç½‘æ ¼æœç´¢åŸºäºç›¸ä¼¼çš„åŸåˆ™ï¼Œä½†éšæœºæœç´¢åœ¨æ¯æ¬¡è¿­ä»£æ—¶ä¼šéšæœºé€‰æ‹©ä¸€ç»„è¶…å‚æ•°ã€‚å½“ç›¸å¯¹è¾ƒå°‘çš„è¶…å‚æ•°ä¸»è¦å†³å®šæ¨¡å‹çš„ç»“æœæ—¶ï¼Œè¯¥æ–¹æ³•æ•ˆæœè‰¯å¥½ã€‚</li>
</ul>
<h4 data-id="heading-10">ç‰¹å¾å·¥ç¨‹</h4>
<p>ç‰¹å¾å·¥ç¨‹æ˜¯æœºå™¨å­¦ä¹ ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºæ ¹æ®å·²æœ‰çš„è®­ç»ƒæ•°æ®ï¼Œå¯é€‰ç”¨çš„ç®—æ³•æ˜¯æœ‰é™çš„ï¼›é‚£ä¹ˆåœ¨åŒæ ·çš„ç®—æ³•ä¸‹ç‰¹å¾çš„é€‰å–æ˜¯ä¸åŒçš„ï¼Œ100ä¸ªäººå¯¹ä¸€ä»¶äº‹æƒ…ä¼šæœ‰100ç§çœ‹æ³•ï¼Œä¹Ÿå°±æœ‰100ç§ç‰¹å¾ï¼Œæœ€åç‰¹å¾çš„è´¨é‡å†³å®šæ¨¡å‹çš„å¥½åã€‚</p>
<p>ç‰¹å¾å·¥ç¨‹æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å°†æ•°æ®è½¬æ¢ä¸ºèƒ½æ›´å¥½çš„è¡¨ç¤ºä¸šåŠ¡é€»è¾‘çš„ç‰¹å¾ï¼Œä»è€Œæé«˜æœºå™¨å­¦ä¹ çš„æ€§èƒ½ã€‚</p>
<p>ç‰¹å¾å·¥ç¨‹åŒ…æ‹¬æ•°æ®æ¸…ç†ï¼Œç‰¹å¾æå–ï¼Œç‰¹å¾é€‰æ‹©ç­‰è¿‡ç¨‹</p>
<h3 data-id="heading-11">æ¨¡å‹è¯„ä¼°</h3>
<p>æœ€åè®­ç»ƒå‡ºæ¥çš„æ¨¡å‹ï¼Œéœ€è¦ç”¨éªŒè¯é›†è¿›è¡ŒéªŒè¯ã€‚éªŒè¯ç»“æœokè¿‡åï¼Œå°†æ¨¡å‹å‘å¸ƒä¸Šçº¿ï¼Œå¯¹æ¨¡å‹è¿›è¡Œé¢„ä¼°/æ¨ç†ï¼Œè¯„ä¼°æ¨¡å‹æ€§èƒ½çš„æ€§èƒ½æŒ‡æ ‡æœ‰ï¼š</p>
<ul>
<li>äºŒåˆ†ç±»ï¼šå‡†ç¡®ç‡ï¼ˆACï¼‰ã€çµæ•åº¦ï¼ˆSNï¼‰ã€ç‰¹å¼‚æ€§ï¼ˆSPï¼‰å’Œé©¬å¤ªç›¸å…³ç³»æ•°ï¼ˆMCCï¼‰</li>
<li>å›å½’ï¼šç¡®å®šç³»æ•°ï¼ˆRÂ²ï¼‰ã€å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰ä»¥åŠå‡æ–¹æ ¹è¯¯å·®ï¼ˆRMSEï¼‰</li>
</ul>
<p><strong>ç»éªŒè¯¯å·®ä¸æ³›åŒ–è¯¯å·®</strong>ï¼š</p>
<ul>
<li>ç»éªŒè¯¯å·®ï¼šæ˜¯æŒ‡AIæ¨¡å‹åœ¨â€œè®­ç»ƒæ•°æ®â€ä¸Šçš„é¢„æµ‹è¯¯å·®ã€‚æ¨¡å‹åœ¨å·²ç»è§è¿‡çš„æ•°æ®ä¸Šçš„è¡¨ç°æœ‰å¤šå¥½ã€‚å°±åƒå­¦ç”Ÿåšè‡ªå·±å¹³æ—¶ä¸€ç›´ç»ƒä¹ çš„é¢˜ï¼Œåšé”™çš„æ¯”ä¾‹ã€‚</li>
<li>æ³›åŒ–è¯¯å·®ï¼šæ˜¯æŒ‡AIæ¨¡å‹åœ¨â€œæ–°ã€æœªè§è¿‡çš„æ•°æ®â€ä¸Šçš„é¢„æµ‹è¯¯å·®ã€‚æ¨¡å‹åœ¨å®é™…åº”ç”¨æ—¶ï¼Œèƒ½ä¸èƒ½æ­£ç¡®åº”å¯¹æ–°æƒ…å†µã€‚å­¦ç”Ÿå»å‚åŠ è€ƒè¯•ï¼Œåšæ²¡ç»ƒè¿‡çš„æ–°é¢˜ï¼Œåšé”™çš„æ¯”ä¾‹ï¼Œä»£è¡¨æ¨¡å‹çš„â€œçœŸå®æ°´å¹³â€ã€‚</li>
</ul>
<p><strong>è¿‡æ‹Ÿåˆä¸æ¬ æ‹Ÿåˆï¼š</strong></p>
<ul>
<li>è¿‡æ‹Ÿåˆï¼šæ¨¡å‹åœ¨â€œè®­ç»ƒæ•°æ®â€ä¸Šè¡¨ç°éå¸¸å¥½ï¼Œä½†åœ¨æ–°æ•°æ®ï¼ˆå®é™…åº”ç”¨ï¼‰ä¸Šæ•ˆæœå¾ˆå·®ã€‚</li>
<li>æ¬ æ‹Ÿåˆï¼šæ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šå’Œæ–°æ•°æ®ä¸Šéƒ½è¡¨ç°å¾ˆå·®ã€‚</li>
</ul>
<p>****<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33cfd6e2afb449db8264e7f721916a2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419569&amp;x-signature=dXcffzSm32INc32CISVabw8UHUc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebb6f71e8c6a409996f3f98a9b0e4bc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419569&amp;x-signature=f%2F7nbZmrpl8YnwX2OCPjDkP1Law%3D" alt="" loading="lazy"/></p>
<p><strong>æŒ‡æ ‡è®¡ç®—å…¬å¼ï¼š</strong></p>
<p><strong>çœŸæ­£ä¾‹ç‡å’Œå‡æ­£ä¾‹ç‡</strong></p>




















<table><thead><tr><th>****</th><th><strong>å®é™…æ­£ä¾‹</strong></th><th><strong>å®é™…è´Ÿä¾‹</strong></th></tr></thead><tbody><tr><td><strong>é¢„æµ‹ä¸ºæ­£ä¾‹</strong></td><td><strong>TP(çœŸæ­£ä¾‹)</strong></td><td><strong>FP(å‡æ­£ä¾‹)</strong></td></tr><tr><td><strong>é¢„æµ‹ä¸ºè´Ÿä¾‹</strong></td><td><strong>FN(å‡è´Ÿä¾‹)</strong></td><td><strong>TN(çœŸè´Ÿä¾‹)</strong></td></tr></tbody></table>
<ul>
<li>TPå’ŒTNè¶Šå¤§è¶Šå¥½</li>
<li>FPå’ŒFNè¶Šå°è¶Šå¥½</li>
</ul>
<p><strong>çœŸæ­£ä¾‹ç‡</strong>ï¼šåˆç§°å¬å›ç‡ï¼Œä¹Ÿç§°æŸ¥å…¨ç‡ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0de7188725444a678da44945a59ee0be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419569&amp;x-signature=1%2BLXf2CRvrpgnFc6aU8ZpoEn%2Fdw%3D" alt="" loading="lazy"/></p>
<p><strong>å‡æ­£ä¾‹ç‡</strong>ï¼šåˆç§°è¯¯æŠ¥æ¦‚ç‡ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b827bc75cf64f5cad40e1688c2a1e20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419569&amp;x-signature=xLhLpgksqjFKTRDHUdmwFoUnguA%3D" alt="" loading="lazy"/></p>
<p><strong>å‡†ç¡®æ€§</strong>ï¼šæ‰€æœ‰åˆ†ç±»ä¸­æ­£ç¡®åˆ†ç±»çš„æ¯”ä¾‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38955b9f9f5941eba1f115cf2c81a190~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419569&amp;x-signature=9wjX%2Fk5DU2pye%2BcJXR91Jl3Jz%2Bg%3D" alt="" loading="lazy"/></p>
<p><strong>ç²¾ç¡®ç‡</strong>ï¼šæ¨¡å‹æ‰€æœ‰é¢„æµ‹ä¸ºæ­£åˆ†ç±»ä¸­å®é™…æ­£åˆ†ç±»çš„æ¯”ä¾‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef7825f6332d45cd935f195bdeb8f306~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419569&amp;x-signature=q9knQbfaBcQFyFCVQY0V4r7AJwI%3D" alt="" loading="lazy"/></p>
<p><strong>PR æ›²çº¿ï¼ˆPrecision-Recall Curveï¼‰ ï¼š</strong> æ˜¯ä¸€ç§ç”¨äºè¯„ä¼°åˆ†ç±»æ¨¡å‹æ€§èƒ½çš„å¯è§†åŒ–å·¥å…·ï¼Œç‰¹åˆ«é€‚ç”¨äºæ ·æœ¬ç±»åˆ«æåº¦ä¸å¹³è¡¡çš„ä»»åŠ¡ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50af80b2c97c43bda5e576a49c38d9bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419569&amp;x-signature=3mkUMUzneoG6bPx1ADz0NG6h8B8%3D" alt="" loading="lazy"/></p>
<ol>
<li>A è¡¨ç°æœ€å¥½çš„æ¨¡å‹ï¼ŒæŸ¥å‡†ç‡å’ŒæŸ¥å…¨ç‡æ•´ä½“è¾ƒé«˜ã€‚</li>
<li>Bè¡¨ç°æœ€å·®çš„æ¨¡å‹ï¼ŒæŸ¥å‡†ç‡ä¸‹é™å¾ˆå¿«ï¼Œè¯´æ˜å¤§é‡è¯¯æŠ¥ã€‚</li>
<li>Cä¸­ç­‰æ°´å¹³ï¼ŒæŸ¥å…¨ç‡ä¸Šå‡æ—¶æŸ¥å‡†ç‡ä¸‹é™è¾ƒç¼“æ…¢ã€‚</li>
</ol>
<p><strong>F1è®¡ç®—å…¬å¼</strong>ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3753b84e4634cecbe609eb5c9561339~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419569&amp;x-signature=05UumsHepjx2f5MUoUYmCRXmhlM%3D" alt="" loading="lazy"/></p>
<p><strong>ROCæ›²çº¿ï¼š</strong></p>
<ul>
<li>ROC æ›²çº¿ æ˜¯æ¨¡å‹åœ¨æ‰€æœ‰é˜ˆå€¼ä¸Šçš„è¡¨ç°çš„å¯è§†åŒ–è¡¨ç¤ºã€‚</li>
<li>ROC æ›²çº¿çš„ç»˜åˆ¶æ–¹æ³•æ˜¯è®¡ç®—çœŸæ­£ä¾‹ç‡ (TPR) å’Œå‡æ­£ä¾‹ç‡ (FPR) å€¼</li>
<li>ROC æ›²çº¿ä¸‹é¢ç§¯ (AUC) è¡¨ç¤ºæ¨¡å‹çš„æ¦‚ç‡ï¼Œå¦‚æœç»™å®šä¸€ä¸ªéšæœºé€‰æ‹©çš„æ­£ç±»åˆ«å’Œè´Ÿç±»åˆ«æ ·æœ¬ï¼Œæ­£å€¼å°†å¤§äºè´Ÿ</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc6687ce0e7c437f8fcfa5c31da326fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766419569&amp;x-signature=5C%2F0atdfKG3D57ZZO6usha65U4c%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">å‚è€ƒæ–‡çŒ®</h2>
<ul>
<li>è°·æ­ŒAIå¼€å‘è€…ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fmachine-learning%3Fhl%3Dzh-cn" target="_blank" title="https://developers.google.com/machine-learning?hl=zh-cn" ref="nofollow noopener noreferrer">developers.google.com/machine-leaâ€¦</a></li>
<li>å¾®è½¯AIï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fzh-cn%2Ftraining%2Fbrowse%2F%3Fresource_type%3Dmodule%26subjects%3Dartificial-intelligence" target="_blank" title="https://learn.microsoft.com/zh-cn/training/browse/?resource_type=module&amp;subjects=artificial-intelligence" ref="nofollow noopener noreferrer">learn.microsoft.com/zh-cn/trainâ€¦</a></li>
<li>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdataprofessor%2Finfographic%2Fblob%2Fmaster%2F01-Building-the-Machine-Learning-Model.JPG" target="_blank" title="https://github.com/dataprofessor/infographic/blob/master/01-Building-the-Machine-Learning-Model.JPG" ref="nofollow noopener noreferrer">github.com/dataprofessâ€¦</a>**</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ«æ‹¼å‡‘æ„Ÿï¼å•†æ±¤Seko 2.0è®©â€œä¸€äººå‰§ç»„â€é‡äº§ç™¾é›†çˆ†æ¬¾çŸ­å‰§]]></title>    <link>https://juejin.cn/post/7583903159774773263</link>    <guid>https://juejin.cn/post/7583903159774773263</guid>    <pubDate>2025-12-15T15:21:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583903159774773263" data-draft-id="7583921477613617187" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ«æ‹¼å‡‘æ„Ÿï¼å•†æ±¤Seko 2.0è®©â€œä¸€äººå‰§ç»„â€é‡äº§ç™¾é›†çˆ†æ¬¾çŸ­å‰§"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-15T15:21:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¢¨é£å¦‚é›ª"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ«æ‹¼å‡‘æ„Ÿï¼å•†æ±¤Seko 2.0è®©â€œä¸€äººå‰§ç»„â€é‡äº§ç™¾é›†çˆ†æ¬¾çŸ­å‰§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¢¨é£å¦‚é›ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T15:21:39.000Z" title="Mon Dec 15 2025 15:21:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¦‚æœä½ æ˜¯ä¸€ä¸ªå†…å®¹åˆ›ä½œè€…ï¼Œå¤§æ¦‚ç‡ç»å†è¿‡è¿™ç§ç»æœ›ï¼šè„‘å­é‡Œæœ‰ä¸€éƒ¨å ªæ¯”ã€ŠæƒåŠ›çš„æ¸¸æˆã€‹çš„å²è¯—å¤§å‰§ï¼Œä½†æ‰‹å¤´åªæœ‰ä½ è‡ªå·±ã€ä¸€å°ç”µè„‘ï¼Œå’Œæ°¸è¿œå‡‘ä¸é½çš„æ‹æ‘„é¢„ç®—ã€‚</p>
<p>è¿‡å»çš„ä¸€å¹´é‡Œï¼ŒAIè§†é¢‘ç”Ÿæˆå·¥å…·è™½ç„¶ç«çƒ­ï¼Œä½†å¤§éƒ½åœ¨â€œæŠ½å¡â€â€”â€”ç”Ÿæˆå‡ ç§’é’ŸæƒŠè‰³çš„é•œå¤´å®¹æ˜“ï¼Œæƒ³è¦è®²å®Œä¸€ä¸ªè¿è´¯çš„æ•…äº‹å´éš¾å¦‚ç™»å¤©ã€‚è§’è‰²åœ¨ä¸Šä¸€ç§’è¿˜æ˜¯é•¿å‘é£˜é£˜ï¼Œä¸‹ä¸€ç§’å°±æ¢äº†å¼ è„¸ï¼›åœºæ™¯æ›´æ˜¯éšæœºçªå˜ï¼Œæ ¹æœ¬æ²¡æ³•åšè¿ç»­å‰§ã€‚</p>
<p>ä½†åœ¨2025å¹´12æœˆ15æ—¥ï¼Œè¿™ä¸ªå±€é¢è¢«æ‰“ç ´äº†ã€‚å•†æ±¤ç§‘æŠ€åœ¨è¿™ä¸ªå²æœ«æ‰”å‡ºäº†ä¸€æšé‡ç£…ç‚¸å¼¹ï¼š<strong>Seko 2.0</strong>ã€‚</p>
<p>è¿™ä¸æ˜¯ä¸€æ¬¡ç®€å•çš„ç‰ˆæœ¬å·å åŠ ï¼Œå®ƒæ˜¯è¡Œä¸šé‡Œç¬¬ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šèƒ½æŠŠâ€œåˆ›ç¼–ä¸€ä½“â€è·‘é€šçš„æ™ºèƒ½ä½“ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒè®©â€œä¸€äººå‰§ç»„â€ä»ä¸€å¥ç©ºæ´çš„å£å·ï¼Œå˜æˆäº†å¯ä»¥é‡äº§ç™¾é›†çŸ­å‰§çš„ç°å®ç”Ÿäº§åŠ›ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-15_23.12.02-1024x582.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-15_23.12.02-1024x582.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e413dab639204ab397e909a317d76663~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766416899&amp;x-signature=IdZgyUKtEM3YWGlowRsCW8xqjeo%3D" alt="iShot_2025-12-15_23.12.02" loading="lazy"/></a></p>
<h3 data-id="heading-0">æ²»å¥½äº†AIè§†é¢‘çš„â€œè„¸ç›²ç—‡â€</h3>
<p>åšè¿‡AIè§†é¢‘çš„äººéƒ½çŸ¥é“ï¼Œæœ€è®©äººå¤´ç–¼çš„ä¸æ˜¯ç”»è´¨ï¼Œè€Œæ˜¯â€œä¸€è‡´æ€§â€ã€‚</p>
<p>ä»¥å‰æˆ‘ä»¬ç”¨AIåšå‰§ï¼Œå¾€å¾€æ˜¯æ‹¼å‡‘å¼çš„ã€‚ä½†åœ¨Seko 2.0é‡Œï¼Œå•†æ±¤æ‹¿å‡ºäº†ä¸€ä¸ªå«<strong>SekoIDX</strong>çš„æŠ€æœ¯ã€‚è¿™ä¸ªåå­—å¬èµ·æ¥å¾ˆç¡¬æ ¸ï¼Œå…¶å®å®ƒè§£å†³çš„é—®é¢˜éå¸¸ç›´è§‚ï¼šå®ƒèƒ½æ­»æ­»â€œè®°ä½â€ä½ çš„ä¸»è§’ã€‚</p>
<p>ä¸è®ºæ˜¯åœ¨ç¬¬1é›†è¿˜æ˜¯ç¬¬50é›†ï¼Œä¸è®ºæ˜¯è¿‘æ™¯ç‰¹å†™è¿˜æ˜¯è¿œæ™¯æ‰“æ–—ï¼Œä¸»è§’çš„è„¸ã€è¡£æœã€ç¥æ€éƒ½èƒ½ä¿æŒé«˜åº¦ç»Ÿä¸€ã€‚æ›´ç»çš„æ˜¯ï¼Œå®ƒå¼•å…¥äº†Agentæ™ºèƒ½è°ƒåº¦ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç®¡ç†è·¨å‰§é›†çš„äººç‰©ã€åœºæ™¯å’Œé“å…·ã€‚è¿™æ„å‘³ç€ï¼Œä½ åªéœ€è®¾å®šä¸€æ¬¡â€œå¼ ä¸‰ç©¿ç€é»‘è‰²é£è¡£åœ¨é›¨å¤œâ€ï¼Œåç»­æ‰€æœ‰ç›¸å…³é•œå¤´ï¼ŒAIéƒ½ä¼šæ›¿ä½ å®ˆä½è¿™ä¸ªè®¾å®šï¼Œä¸å†éœ€è¦ä½ æ¯ä¸€å¸§éƒ½å»å†™å¤æ‚çš„æç¤ºè¯æ¥çº æ­£å®ƒçš„â€œå¥å¿˜â€ã€‚</p>
<h3 data-id="heading-1">ä¸å†æ˜¯å“‘å‰§ï¼Œä¹Ÿä¸å†æ˜¯ç‹¬è§’æˆ</h3>
<p>Seko 2.0çš„å¦ä¸€ä¸ªæ€æ‰‹é”æ˜¯<strong>SekoTalk</strong>ã€‚</p>
<p>æ—©æœŸçš„AIè§†é¢‘å¤§å¤šæ˜¯â€œå“‘å‰§â€ï¼Œæˆ–è€…åªèƒ½å¯¹ä¸Šä¸€ä¸ªäººçš„å£å‹ã€‚ä¸€æ—¦ç”»é¢é‡Œå‡ºç°ä¸¤ä¸ªäººå¯¹è¯ï¼Œå˜´å‹å’Œå£°éŸ³å°±ä¼šä¹±å¥—ã€‚Seko 2.0å·ç§°æ˜¯ä¸šå†…é¦–ä¸ªæ”¯æŒè¶…è¿‡2äººç²¾å‡†å¯¹å£å‹çš„æ–¹æ¡ˆã€‚è¿™ç›´æ¥è§£é”äº†å¤æ‚çš„å‰§æƒ…äº’åŠ¨â€”â€”äº‰åµã€ç¾¤åƒã€è°ˆåˆ¤ï¼Œè¿™äº›æ‰æ˜¯æˆå‰§å¼ åŠ›çš„æ ¸å¿ƒã€‚</p>
<p>æœ‰äº†ç”»é¢ä¸€è‡´æ€§å’Œå¤šäººå¯¹ç™½ï¼ŒSeko 2.0æ•¢äºå–Šå‡ºæ”¯æŒ<strong>100é›†ä»¥å†…</strong>å‰§æœ¬è¿ç»­åˆ›ä½œçš„åº•æ°”å°±åœ¨è¿™é‡Œã€‚å®ƒä¸å†æ˜¯ç”Ÿæˆé›¶ç¢ç´ æçš„å·¥å…·ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥äº§å‡ºæˆç‰‡çš„æµæ°´çº¿ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-15_23.12.31-1024x475.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-15_23.12.31-1024x475.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98aca7f549b94317a21d749c77d6ecdb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766416899&amp;x-signature=8W9ufzhtuJ%2B1wSKKrL2ptaweQ2g%3D" alt="iShot_2025-12-15_23.12.31" loading="lazy"/></a></p>
<h3 data-id="heading-2">æ‹¿ç»“æœè¯´è¯ï¼šä¸ä»…ä»…æ˜¯Demo</h3>
<p>å¾ˆå¤šæŠ€æœ¯å‘å¸ƒä¼šå–œæ¬¢æ”¾ç²¾ä¿®çš„Demoï¼Œä½†Seko 2.0ç›´æ¥ç”©å‡ºäº†æˆç»©å•ã€‚</p>
<p>è‡ªä»Šå¹´7æœˆä¸Šçº¿ä»¥æ¥ï¼Œä¸åˆ°åŠå¹´æ—¶é—´ï¼ŒSekoå·²ç»èšé›†äº†è¶…è¿‡20ä¸‡åˆ›ä½œè€…ã€‚æ›´æœ‰æ„æ€çš„æ˜¯æ•°æ®ç”»åƒï¼šè¿™é‡Œé¢ä¸€åŠæ˜¯çŸ­å‰§å’Œæ¼«å‰§çš„åˆ›ä½œè€…ã€‚</p>
<p>æœ€ç¡¬æ ¸çš„æ¡ˆä¾‹æ˜¯çœŸäººçŸ­å‰§ã€Šå©‰å¿ƒè®¡ã€‹ã€‚è¿™éƒ¨ç”±Sekoç”Ÿæˆçš„ä½œå“ï¼Œå®æ‰“å®åœ°ç™»é¡¶äº†æŠ–éŸ³AIçŸ­å‰§æ¦œçš„ç¬¬ä¸€åã€‚è¿™è¯´æ˜å®ƒçš„äº§å‡ºè´¨é‡å·²ç»ä¸ä»…ä»…æ˜¯â€œèƒ½çœ‹â€ï¼Œè€Œæ˜¯èƒ½ç»å—ä½å¤§ä¼—å¸‚åœºæŒ‘å‰”ç›®å…‰çš„è€ƒéªŒï¼Œç”šè‡³å…·å¤‡äº†å•†ä¸šå˜ç°çš„èƒ½åŠ›ã€‚</p>
<p>å•†æ±¤ç”šè‡³å·²ç»å’Œé•¿æ±Ÿç”µå½±é›†å›¢è¾¾æˆäº†æˆ˜ç•¥åˆä½œï¼Œå‡†å¤‡æŠŠè¿™å¥—æŠ€æœ¯ç”¨åˆ°é™¢çº¿ç”µå½±çš„å­µåŒ–é‡Œã€‚å½“å›½å®¶é˜Ÿå¼€å§‹å…¥å±€ï¼Œä½ å°±çŸ¥é“è¿™ä¸ä»…ä»…æ˜¯æå®¢ä»¬çš„ç©å…·äº†ã€‚</p>
<h3 data-id="heading-3">é™æœ¬å¢æ•ˆçš„æè‡´</h3>
<p>å¯¹äºä¸ªäººåˆ›ä½œè€…å’Œå°å·¥ä½œå®¤æ¥è¯´ï¼ŒSeko 2.0æœ€è¯±äººçš„è¿˜æ˜¯æˆæœ¬æ§åˆ¶ã€‚</p>
<p>ä¼ ç»Ÿææ¼«å‰§ï¼Œå‘¨æœŸé•¿ã€äººåŠ›è´µã€‚Seko 2.0æŠŠåˆ¶ä½œå‘¨æœŸç¼©çŸ­äº†80%åˆ°90%ã€‚è¿™æ„å‘³ç€åˆ«äººè¿˜åœ¨ç”»åˆ†é•œçš„æ—¶å€™ï¼Œä½ çš„å…¨é›†å¯èƒ½å·²ç»ä¸Šçº¿äº†ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fasdasc-1024x1024.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/asdasc-1024x1024.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94ece07d309c4c8db8c4458f47e67850~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766416899&amp;x-signature=P5XTtQ2FA0lvplLG3X3DdibCXkU%3D" alt="asdasc" loading="lazy"/></a></p>
<p>ä¸ºäº†æ”¯æ’‘è¿™ç§é«˜å¼ºåº¦çš„ç”Ÿæˆï¼Œå•†æ±¤å¼€æºäº†åº•å±‚çš„æ¨ç†æ¡†æ¶<strong>LightX2V</strong>ã€‚åœ¨æ¶ˆè´¹çº§æ˜¾å¡ä¸Šï¼Œå®ƒèƒ½åšåˆ°â€œç”Ÿæˆ5ç§’è§†é¢‘è€—æ—¶å°äº5ç§’â€ã€‚è¿™ç§å‡†å®æ—¶çš„é€Ÿåº¦ï¼Œè®©åˆ›ä½œè¿‡ç¨‹å˜å¾—åƒå‰ªè¾‘ä¸€æ ·æµç•…ï¼Œä¸å†éœ€è¦ä¸ºäº†æ¸²æŸ“ä¸€ä¸ªé•œå¤´å»å–æ¯å’–å•¡ç­‰å¾…ã€‚è€Œä¸”ï¼Œå®ƒè¿˜é€‚é…äº†å¯’æ­¦çºªã€æ²æ›¦ç­‰å›½äº§èŠ¯ç‰‡ï¼Œåœ¨ç¡¬ä»¶é€‰æ‹©ä¸Šç»™äº†å›½å†…åˆ›ä½œè€…æ›´å¤šä½™åœ°ã€‚</p>
<h3 data-id="heading-4">å†™åœ¨æœ€å</h3>
<p>Seko 2.0çš„å‡ºç°ï¼Œæ ‡å¿—ç€AIè§†é¢‘ç”Ÿæˆæ­£åœ¨ä»â€œçŒå¥‡â€èµ°å‘â€œå·¥ä¸šåŒ–â€ã€‚</p>
<p>å®ƒä¸ä»…é™ä½äº†é—¨æ§›ï¼Œæ›´é‡è¦çš„æ˜¯æé«˜äº†å¤©èŠ±æ¿ã€‚å½“æŠ€æœ¯ä¸å†æ˜¯é˜»ç¢ï¼Œå½“ä¸€ä¸ªäººå°±èƒ½é€šè¿‡Seko 2.0æŒæ§å‰§æœ¬ã€åˆ†é•œã€è¡¨æ¼”ã€é…éŸ³å…¨æµç¨‹æ—¶ï¼Œæˆ‘ä»¬æœ‰ç†ç”±ç›¸ä¿¡ï¼Œä¸‹ä¸€ä¸ªçŸ­å‰§çˆ†æ¬¾ï¼Œæˆ–è®¸å°±è¯ç”Ÿåœ¨ä½ çš„ç¬”è®°æœ¬ç”µè„‘é‡Œã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fcascasvsd.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/cascasvsd.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a14e3647c1b47878560ccfa0f26ae30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766416899&amp;x-signature=LrqqKD75NRI9pLWf4ud%2FFqrNxHw%3D" alt="cascasvsd" loading="lazy"/></a></p>
<p>å¦‚æœä½ æ‰‹é‡Œæ­£å‹ç€å‡ ä¸ªå¥½æ•…äº‹è‹¦äºæ²¡é’±æ‹æ‘„ï¼Œç°åœ¨ï¼Œå¯èƒ½æ˜¯åŠ¨æ‰‹æœ€å¥½çš„æ—¶å€™ã€‚</p>
<p><strong>å¦‚æœä½ ä¹Ÿå¯¹æœ€æ–°çš„AIä¿¡æ¯æ„Ÿå…´è¶£æˆ–è€…æœ‰ç–‘é—® éƒ½å¯ä»¥åŠ å…¥æˆ‘çš„å¤§å®¶åº­ ç¬¬ä¸€æ—¶é—´åˆ†äº«æœ€æ–°AIèµ„è®¯ã€å·¥å…·ã€æ•™ç¨‹ã€æ–‡æ¡£ æ¬¢è¿ä½ çš„åŠ å…¥ï¼ï¼ï¼ğŸ˜‰ğŸ˜‰ğŸ˜‰</strong></p>
<p>å…¬ä¼—å·ï¼šå¢¨é£å¦‚é›ªå°ç«™</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PTQ é‡åŒ–æ•°å€¼èŒƒå›´ä¸ä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7583933107689177151</link>    <guid>https://juejin.cn/post/7583933107689177151</guid>    <pubDate>2025-12-15T14:26:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583933107689177151" data-draft-id="7583910637958397971" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PTQ é‡åŒ–æ•°å€¼èŒƒå›´ä¸ä¼˜åŒ–"/> <meta itemprop="keywords" content="ç®—æ³•,è‡ªåŠ¨é©¾é©¶"/> <meta itemprop="datePublished" content="2025-12-15T14:26:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åœ°å¹³çº¿å¼€å‘è€…"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032132567"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PTQ é‡åŒ–æ•°å€¼èŒƒå›´ä¸ä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032132567/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åœ°å¹³çº¿å¼€å‘è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T14:26:03.000Z" title="Mon Dec 15 2025 14:26:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€PTQ æ¨¡å‹é‡åŒ–é—®é¢˜</h2>
<h3 data-id="heading-1">1.1ã€æ¨¡å‹é—®é¢˜</h3>
<p>åŸºäºå…¬ç‰ˆæ¨¡å‹è®­ç»ƒï¼Œæ²¡æœ‰å¯¹æ¨¡å‹åšèŒƒå›´åšçº¦æŸï¼Œweight_decay=1e-6ï¼Œ è®­ç»ƒå‡ºçš„ float æ¨¡å‹æ•°å€¼åˆ†å¸ƒå¾ˆå¤§ï¼Œå¦‚å›¾ 2ï¼Œå¯ä»¥çœ‹åˆ°æ¨¡å‹çš„åé¢å‡ å±‚æ•°æ®åˆ†å¸ƒèŒƒå›´å¾ˆå¹¿ï¼Œæœ€å¤§é˜ˆå€¼è¶…è¿‡äº† 8000ï¼Œå¯¹æˆ‘ä»¬é‡åŒ–æ¥è¯´å¹¶ä¸å‹å¥½ã€‚</p>
<h3 data-id="heading-2">1.2ã€ç®—å­é—®é¢˜</h3>
<p>å¦‚å›¾ 2ï¼ŒåŸºäºå…¨ int16 ç®—å­é…ç½®é‡åŒ–ï¼Œå½“å‰ç‰ˆæœ¬ resize ç®—å­æœ‰çº¦æŸï¼ˆè¯·æŸ¥é˜…å·¥å…·é“¾ç®—å­æ”¯æŒæƒ…å†µï¼‰ï¼Œåªèƒ½æ”¯æŒ int8 é‡åŒ–ï¼Œå³ä½¿é…ç½®äº† int16ï¼Œä½†ç®—å­ä¾æ—§é€€åŒ–åˆ° int8ï¼Œå› æ­¤ç®—å­çš„ cosine ç›¸ä¼¼åº¦ä¹Ÿæ¯”è¾ƒä½ï¼ŒåŸºäºæ­¤é˜ˆå€¼ï¼Œmax_qscale=6653/127=52.385ï¼Œæ­¤ scale è¿‡äºå¤§ï¼Œå¹¶ä¸èƒ½ç²¾ç»†åŒ–é‡åŒ–æ¨¡å‹ï¼Œæ‰€ä»¥å…¨ BPU ç®—å­çš„æ•´ä½“ç²¾åº¦éƒ½ä¸é«˜ã€‚</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=YjBmY2QxMjhmZTU2OTk3MzExMWY5YTEwMjE2OWNlY2Rfb3hqdExDUzBmWWdZRGZidnJ3b0xTeHdVWjBQQnZTcENfVG9rZW46QWsySmIwNzVBb0xXQVJ4NnR6WmNNSkJVblh0XzE3NjU4MDgwMzE6MTc2NTgxMTYzMV9WNA" alt="" loading="lazy"/></p>
<p>å›¾ 1 å…¬ç‰ˆè®­ç»ƒ float æ¨¡å‹</p>
<h2 data-id="heading-3">äºŒã€ç²¾åº¦ä¼˜åŒ–</h2>
<h3 data-id="heading-4">2.1ã€cpu é«˜ç²¾åº¦å®šä½</h3>
<p>resize ç®—å­æœ‰é™åˆ¶ï¼Œä½†å¯¹äºå›é€€ cpu ç®—å­ï¼Œå°±èƒ½å®ç° float ç²¾åº¦æ¨ç†ï¼Œé…ç½®å¦‚å›¾ 2ï¼Œ</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDdmYTFkZTEyYjdlZGQyY2VhMjMyNTkyYjU3MmU5ZTdfaUk1ZDZoNERURGFsU2FSMVFZTmR0Y3NNRkxENktOTzZfVG9rZW46Ulc0amJjb3Exb0JjRGV4dTdoS2MxRFlpbjhkXzE3NjU4MDgwMzE6MTc2NTgxMTYzMV9WNA" alt="" loading="lazy"/></p>
<p>å›¾ 2 é…ç½® cpu ç®—å­</p>
<p>é…ç½®äº†ç®—å­åï¼Œç²¾åº¦æå‡äº†ï¼Œå¦‚å›¾ 3ï¼Œå¯è§†åŒ–æ•ˆæœå¯¹æ¯”å¦‚å›¾ 4ï¼Œæ•´ä½“é‡åŒ–ç²¾åº¦å¯å¯¹é½ï¼Œå®šä½åˆ°äº†å…·ä½“é—®é¢˜å°±æ˜¯ resize ç®—å­é™åˆ¶å¯¼è‡´ã€‚</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=NDEyZmZhYTVjODI5MmZiMDAzZDZhM2QwYTc4NTY0ZDRfYTNWTFJ4am5GY2k1RTlMakwxVjJlUElKb251Z3ZLR1NfVG9rZW46VjRabGJRWld3b0lmbmJ4QVBVSWNQZ3B3bmRiXzE3NjU4MDgwMzE6MTc2NTgxMTYzMV9WNA" alt="" loading="lazy"/></p>
<p>å›¾ 3 cpu ç®—å­ç²¾åº¦</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmU3MWI4YWZhYzU5MGI0MWQ5M2MzZjg1OGZhZGZkNmNfeVEwUk4xYXZwZml6aHJreW9uNmFyMHIxbVlvUWFCYVFfVG9rZW46QXpaSmJYNnlDb1dZemd4SXlyaWNiM0pvbmxmXzE3NjU4MDgwMzE6MTc2NTgxMTYzMV9WNA" alt="" loading="lazy"/></p>
<p>å›¾ 4 cpu ç®—å­å¯è§†åŒ–ç²¾åº¦</p>
<h3 data-id="heading-5">2.2ã€æ·»åŠ  bnï¼ŒåŠ å¤§ weight_decay</h3>
<p>åœ¨æœ€åçš„ conv å±‚ååŠ ä¸Š bn ç®—å­é™åˆ¶ç‰¹å¾æ•°æ®åˆ†å¸ƒï¼ŒåŒæ—¶ weight_decay ä» 1e-6 è°ƒæ•´åˆ° 1e-3ï¼Œæ•´ä½“æ•°æ®èŒƒå›´å¦‚å›¾ 5ã€å›¾ 6ï¼Œæ¨¡å‹çš„æ•°æ®åˆ†å¸ƒå˜å°äº†ï¼Œæœ€åçš„ cosine ç›¸ä¼¼åº¦ç²¾åº¦ä¹Ÿå¾ˆé«˜ï¼Œéå¸¸åˆ©äº int8 é‡åŒ–ï¼ŒåæœŸé…ç½®äº† int8 é‡åŒ–ï¼Œæ¨¡å‹ä¹Ÿå¯å®ç°é«˜ç²¾åº¦é‡åŒ–ã€‚</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=NDg3MjM4YWI0NGMzZDc0YTQ1YzFkMzYwODliYTY2ZGVfak9EcDV1QXlPbFdtVlpzT2dEUzNDOHgwYnF1NzRtRTVfVG9rZW46UUF1dWJuTTNjb2ZCOFh4YjdQMmNoRUt4bmhlXzE3NjU4MDgwMzE6MTc2NTgxMTYzMV9WNA" alt="" loading="lazy"/></p>
<p>å›¾ 5 å…¨ int16 é‡åŒ–</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=YTUxNTU5MDNjODNlMzg1MzE4MmY1MTAzYzM4NzA3MjVfS281QTdOUkF6eVBYMEJTdndiZlNhZVJzMmVSU1AyV3VfVG9rZW46RXd1dWJkRXBob0xKelB4MEdSb2NCaHlNbkFjXzE3NjU4MDgwMzE6MTc2NTgxMTYzMV9WNA" alt="" loading="lazy"/></p>
<p>å›¾ 6 éƒ¨åˆ† int16 é‡åŒ–</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åå­—è·¯å£çš„æŠ‰æ‹©ï¼šBç«¯ä¸Cç«¯C++å¼€å‘è€…çš„èŒä¸šè·¯å¾„å…¨è§£æ]]></title>    <link>https://juejin.cn/post/7583906870827991049</link>    <guid>https://juejin.cn/post/7583906870827991049</guid>    <pubDate>2025-12-15T14:57:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906870827991049" data-draft-id="7583910418658770990" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åå­—è·¯å£çš„æŠ‰æ‹©ï¼šBç«¯ä¸Cç«¯C++å¼€å‘è€…çš„èŒä¸šè·¯å¾„å…¨è§£æ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T14:57:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç äº‹æ¼«è°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åå­—è·¯å£çš„æŠ‰æ‹©ï¼šBç«¯ä¸Cç«¯C++å¼€å‘è€…çš„èŒä¸šè·¯å¾„å…¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç äº‹æ¼«è°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T14:57:23.000Z" title="Mon Dec 15 2025 14:57:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨C++å¼€å‘è€…çš„èŒä¸šé“è·¯ä¸Šï¼Œä¸€ä¸ªç»å…¸çš„é€‰æ‹©é¢˜æ¨ªäº˜åœ¨å‰ï¼šæ˜¯æ·±å…¥æœåŠ¡ä¼ä¸šä¸ç³»ç»Ÿçš„<strong>Bç«¯ï¼ˆBusinessï¼‰</strong> é¢†åŸŸï¼Œè¿˜æ˜¯æŠ•èº«äºåˆ›é€ ç›´æ¥ç”¨æˆ·ä»·å€¼çš„<strong>Cç«¯ï¼ˆConsumerï¼‰</strong> ä¸–ç•Œï¼Ÿè¿™ä¸ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯æ ˆçš„é€‰æ‹©ï¼Œæ›´å…³ä¹æˆªç„¶ä¸åŒçš„èŒä¸šå‘å±•è½¨è¿¹ä¸æ€ç»´æ¨¡å¼çš„å¡‘é€ ã€‚</p>
<h4 data-id="heading-0">ä¸€ã€æ ¹æœ¬åˆ†é‡ï¼šBç«¯ä¸Cç«¯å¼€å‘çš„æ ¸å¿ƒå·®å¼‚</h4>
<p>Bç«¯ä¸Cç«¯å¼€å‘çš„æœ¬è´¨åŒºåˆ«ï¼Œæºäºå…¶æœåŠ¡å¯¹è±¡å’Œä»·å€¼æ ¸å¿ƒçš„ä¸åŒã€‚</p>
<p><strong>Bç«¯å¼€å‘çš„æ ¸å¿ƒæ˜¯â€œå¯é åœ°è§£å†³ç¡®å®šæ€§é—®é¢˜â€</strong>ã€‚å®ƒæœåŠ¡äºä¼ä¸šã€æœºæ„æˆ–ç‰¹å®šä¸šåŠ¡æµç¨‹ï¼Œå¦‚é‡‘èäº¤æ˜“ç³»ç»Ÿã€æ•°æ®åº“å¼•æ“ã€å·¥ä¸šæ§åˆ¶è½¯ä»¶æˆ–é€šä¿¡åå°ã€‚å…¶ä»·å€¼ä½“ç°åœ¨<strong>ç¨³å®šæ€§ã€æ•ˆç‡ä¸ä¸šåŠ¡æ•´åˆèƒ½åŠ›</strong>ä¸Šã€‚ä¸€ä¸ªæˆåŠŸçš„Bç«¯ç³»ç»Ÿï¼Œå¾€å¾€åƒä¸€å°ç²¾å¯†ã€æ²‰é»˜ä¸”æ°¸ä¸åœæ­‡çš„å¼•æ“ï¼Œåœ¨åå°æ”¯æ’‘ç€å…³é”®ä¸šåŠ¡çš„è¿è½¬ã€‚å¼€å‘è€…å…³æ³¨çš„æ˜¯ååé‡ã€å“åº”å»¶è¿Ÿã€æ•°æ®ä¸€è‡´æ€§ä»¥åŠå¦‚ä½•ä¸åºå¤§çš„é—ç•™ç³»ç»Ÿæ— ç¼é›†æˆã€‚</p>
<p><strong>Cç«¯å¼€å‘çš„æ ¸å¿ƒæ˜¯â€œæ„‰æ‚¦åœ°æ»¡è¶³ä¸ç¡®å®šçš„ç”¨æˆ·â€</strong>ã€‚å®ƒç›´é¢æœ€ç»ˆæ¶ˆè´¹è€…ï¼Œå…¸å‹äº§ç‰©æ˜¯PC/ä¸»æœºæ¸¸æˆã€æ¡Œé¢åº”ç”¨ï¼ˆå¦‚åŠå…¬è½¯ä»¶ã€åˆ›æ„å·¥å…·ï¼‰æˆ–å¤šåª’ä½“è½¯ä»¶ã€‚å…¶ä»·å€¼ç›´æ¥ç”±<strong>ç”¨æˆ·ä½“éªŒã€å¸‚åœºå¸å¼•åŠ›å’Œæ„Ÿå®˜è¡¨ç°åŠ›</strong>å†³å®šã€‚ä¸€ä¸ªæˆåŠŸçš„Cç«¯äº§å“ï¼Œåº”åƒä¸€éƒ¨å¼•äººå…¥èƒœçš„ç”µå½±æˆ–ä¸€ä»¶å¾—å¿ƒåº”æ‰‹çš„å·¥å…·ï¼Œèƒ½ç¬é—´æŠ“ä½ç”¨æˆ·ï¼Œå¹¶åœ¨æµç•…ã€ç›´è§‚çš„äº¤äº’ä¸­ä¼ é€’ä»·å€¼ã€‚å¼€å‘è€…åœ¨æ­¤å¿…é¡»å…³æ³¨å¸§ç‡ã€å¯åŠ¨é€Ÿåº¦ã€ç•Œé¢å“åº”ã€èµ„æºå ç”¨ä»¥åŠåœ¨åƒå·®ä¸‡åˆ«çš„ç¡¬ä»¶ç¯å¢ƒä¸‹çš„ç¨³å®šæ€§ã€‚</p>
<p>ç®€è¨€ä¹‹ï¼ŒBç«¯è¿½æ±‚<strong>ç³»ç»Ÿçš„ç¡®å®šæ€§</strong>ï¼ŒCç«¯æ£æ‘©<strong>äººæ€§çš„æ„ŸçŸ¥åº¦</strong>ã€‚è¿™ä¸€å®šä½å·®å¼‚ï¼Œç›´æ¥å¯¼è‡´äº†æŠ€æœ¯æ ˆã€å·¥ä½œæ¨¡å¼å’ŒæˆåŠŸæ ‡å‡†çš„å…¨æ–¹ä½åˆ†æµã€‚</p>



































<table><thead><tr><th align="left">å¯¹æ¯”ç»´åº¦</th><th align="left">Bç«¯ï¼ˆä¼ä¸šçº§ï¼‰å¼€å‘</th><th align="left">Cç«¯ï¼ˆæ¶ˆè´¹è€…ç«¯ï¼‰å¼€å‘</th></tr></thead><tbody><tr><td align="left"><strong>æ ¸å¿ƒä»·å€¼</strong></td><td align="left">ä¸šåŠ¡æµç¨‹æ”¯æ’‘ï¼Œæ•ˆç‡ä¸ç¨³å®š</td><td align="left">ç”¨æˆ·ä½“éªŒï¼Œæ„Ÿå®˜æ„‰æ‚¦ä¸æ˜“ç”¨</td></tr><tr><td align="left"><strong>å…¸å‹åœºæ™¯</strong></td><td align="left">äº¤æ˜“ç³»ç»Ÿã€æ•°æ®åº“ã€å·¥ä¸šè½¯ä»¶</td><td align="left">æ¸¸æˆã€æ¡Œé¢å·¥å…·ã€å¤šåª’ä½“åº”ç”¨</td></tr><tr><td align="left"><strong>æ€§èƒ½ä¾§é‡</strong></td><td align="left">ååé‡ã€å¹¶å‘æ•°ã€æ•°æ®å¤„ç†å»¶è¿Ÿ</td><td align="left"><strong>å¸§ç‡ã€æ“ä½œå“åº”å»¶è¿Ÿã€åŠ è½½æ—¶é—´</strong></td></tr><tr><td align="left"><strong>ç¯å¢ƒå¤æ‚æ€§</strong></td><td align="left">å—æ§çš„æœåŠ¡å™¨/ä¸“ç”¨ç¯å¢ƒ</td><td align="left">é«˜åº¦ç¢ç‰‡åŒ–çš„ç»ˆç«¯ç”¨æˆ·è®¾å¤‡</td></tr><tr><td align="left"><strong>è´¨é‡æ ¸å¿ƒ</strong></td><td align="left"><strong>7x24å°æ—¶æ— ä¸­æ–­</strong>ï¼Œæ•°æ®100%å‡†ç¡®</td><td align="left"><strong>äº¤äº’æµç•…æ— å¡é¡¿</strong>ï¼Œå´©æºƒç‡æä½</td></tr></tbody></table>
<h4 data-id="heading-1">äºŒã€æ·±åº¦æŒ‘æˆ˜ï¼šéš¾åº¦çš„ä¸åŒç»´åº¦</h4>
<p>è°ˆè®ºâ€œå“ªä¸ªéš¾åº¦æ›´å¤§â€çŠ¹å¦‚æ¯”è¾ƒâ€œé€ æ¡¥æ¢â€ä¸â€œé€ èµ›è½¦â€ã€‚éš¾åº¦ä¸åœ¨åŒä¸€ç»´åº¦ï¼ŒæŒ‘æˆ˜ä¹Ÿè¿¥ç„¶ä¸åŒã€‚</p>
<p><strong>Bç«¯å¼€å‘çš„æŒ‘æˆ˜åœ¨äºâ€œå¤æ‚ç³»ç»Ÿçš„æŒæ§â€</strong>ï¼š</p>
<ol>
<li><strong>é¢†åŸŸçŸ¥è¯†æ·±åº¦</strong>ï¼šéœ€æ·±åˆ»ç†è§£é‡‘èã€ç”µä¿¡ã€å·¥ä¸šç­‰å‚ç›´è¡Œä¸šçš„ä¸šåŠ¡è§„åˆ™ä¸åˆè§„è¦æ±‚ï¼ŒæŠ€æœ¯æ˜¯æ‰‹æ®µè€Œéç›®çš„ã€‚</li>
<li><strong>å¤§è§„æ¨¡ç³»ç»Ÿå¤æ‚æ€§</strong>ï¼šè®¾è®¡é«˜å¹¶å‘ã€åˆ†å¸ƒå¼æ¶æ„ï¼Œä¿éšœæ•°æ®å¼ºä¸€è‡´æ€§å’Œç³»ç»Ÿé«˜å¯ç”¨æ€§ï¼Œå…¶å¤æ‚æ€§ä¸è°ƒè¯•éš¾åº¦æé«˜ã€‚</li>
<li><strong>ç»´æŠ¤ä¸æ¼”è¿›çš„é•¿å‘¨æœŸ</strong>ï¼šé¢å¯¹åŠ¨è¾„åå¹´ä»¥ä¸Šçš„é—ç•™ä»£ç åº“ï¼Œéœ€å…·å¤‡å“è¶Šçš„æ¶æ„é‡æ„å’Œå…¼å®¹æ€§è®¾è®¡èƒ½åŠ›ï¼ŒæŠ€æœ¯å€ºåŠ¡ç®¡ç†æ˜¯å¸¸æ€ã€‚</li>
</ol>
<p><strong>Cç«¯å¼€å‘çš„æŒ‘æˆ˜åœ¨äºâ€œç”¨æˆ·æ„ŸçŸ¥çš„æé™ä¼˜åŒ–â€</strong>ï¼š</p>
<ol>
<li><strong>æè‡´çš„æ€§èƒ½è°ƒä¼˜</strong>ï¼šå¿…é¡»åœ¨å›ºå®šçš„1/60ç§’ï¼ˆ16.6æ¯«ç§’ï¼‰å†…å®Œæˆä¸€å¸§ç”»é¢çš„æ‰€æœ‰å¤„ç†ï¼Œå¯¹æ€§èƒ½çš„å‹æ¦¨æ˜¯æŒç»­ä¸”è‹›åˆ»çš„ã€‚å†…å­˜ç®¡ç†ä¸å½“å¯¼è‡´çš„ç¬é—´å¡é¡¿éƒ½æ˜¯ä¸å¯æ¥å—çš„å¤±è´¥ã€‚</li>
<li><strong>ç¢ç‰‡åŒ–ç¯å¢ƒçš„é€‚é…</strong>ï¼šéœ€è®©åŒä¸€ä»½ä»£ç åœ¨ä»é«˜ç«¯æ˜¾å¡åˆ°é›†æˆæ˜¾å¡ã€ä¸åŒæ“ä½œç³»ç»Ÿç‰ˆæœ¬çš„æµ·é‡è®¾å¤‡ä¸Šè¡¨ç°ä¸€è‡´ä¸”æµç•…ï¼Œè°ƒè¯•åœºæ™¯å‘ˆæŒ‡æ•°çº§å¢é•¿ã€‚</li>
<li><strong>è·¨å­¦ç§‘åä½œä¸äº§å“æ€ç»´</strong>ï¼šéœ€ç´§å¯†é…åˆç¾æœ¯ã€è®¾è®¡ã€ç­–åˆ’ç­‰è§’è‰²ï¼Œå°†æŠ½è±¡çš„æŠ€æœ¯èƒ½åŠ›è½¬åŒ–ä¸ºç›´è§‚çš„ç”¨æˆ·ä½“éªŒï¼Œæ²Ÿé€šä¸åä½œæœ¬èº«å³æ˜¯å·¨å¤§æŒ‘æˆ˜ã€‚</li>
</ol>
<p><strong>ç»“è®º</strong>ï¼šBç«¯ä¹‹éš¾ï¼Œéš¾åœ¨<strong>ç³»ç»Ÿçš„æ·±åº¦ã€å¤æ‚æ€§ä¸é•¿æœŸç»´æŠ¤</strong>ï¼›Cç«¯ä¹‹éš¾ï¼Œéš¾åœ¨<strong>æè‡´çš„æ€§èƒ½ã€å¹¿æ³›çš„é€‚é…ä¸å¯¹ç”¨æˆ·å¿ƒç†çš„æŠŠæ¡</strong>ã€‚å‰è€…æ˜¯é©¬æ‹‰æ¾ï¼Œè€ƒéªŒè€åŠ›å’Œå®è§‚è§„åˆ’ï¼›åè€…æ˜¯ç™¾ç±³è·¨æ ï¼Œè€ƒéªŒçˆ†å‘åŠ›ã€ç²¾ç»†åº¦å’Œå³æ—¶è°ƒæ•´ã€‚</p>
<h4 data-id="heading-2">ä¸‰ã€è½¬å‹æŒ‡å—ï¼šä»Bç«¯è¿ˆå‘Cç«¯çš„åŠ¡å®è·¯å¾„</h4>
<p>å¯¹äºä¸€ä½èµ„æ·±çš„Bç«¯å¼€å‘è€…è€Œè¨€ï¼Œè½¬å‹Cç«¯ç»éä»é›¶å¼€å§‹ï¼Œè€Œæ˜¯ä¸€åœº<strong>ä¼˜åŠ¿è½¬åŒ–ä¸æ€ç»´å‡çº§</strong>çš„æ—…ç¨‹ã€‚</p>
<p><strong>1. æ€ç»´é‡å¡‘ï¼šä»â€œæ­£ç¡®æ€§æ€ç»´â€åˆ°â€œä½“éªŒæ€ç»´â€</strong>
è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚Bç«¯å¼€å‘è€…ä¹ æƒ¯äºä¸ºâ€œåŠŸèƒ½æ­£ç¡®æ€§â€å’Œâ€œé€»è¾‘å®Œå¤‡æ€§â€è®¾ç«‹æ˜ç¡®çš„è¾¾æ ‡çº¿ã€‚åœ¨Cç«¯ï¼Œå¿…é¡»å»ºç«‹ä¸€æ¡æ–°çš„ã€æ›´æ„Ÿæ€§çš„â€œä½“éªŒè¾¾æ ‡çº¿â€ï¼šè¿™ä¸ªåŠ¨ç”»æ˜¯å¦è·Ÿæ‰‹ï¼Ÿè¿™ä¸ªåŠ è½½ç­‰å¾…æ˜¯å¦è®©ç”¨æˆ·ç„¦è™‘ï¼Ÿè¿™ä¸ªç•Œé¢å¸ƒå±€åœ¨4Kå±å’Œç¬”è®°æœ¬å°å±ä¸Šæ˜¯å¦éƒ½ä¼˜é›…ï¼Ÿä¸»åŠ¨ä½¿ç”¨ç«å“ï¼Œè®°å½•æ¯ä¸€ä¸ªè®©ä½ æ„Ÿåˆ°â€œçˆ½â€æˆ–â€œçƒ¦èºâ€çš„ç»†èŠ‚ï¼Œæ˜¯è®­ç»ƒæ­¤æ€ç»´çš„æœ€ä½³æ–¹å¼ã€‚</p>
<p><strong>2. æŠ€æœ¯æ ˆè¿ç§»ï¼šè¡¥å¼ºâ€œç«¯â€ä¾§æ ¸å¿ƒèƒ½åŠ›</strong>
ä½ çš„Bç«¯æ ¸å¿ƒä¼˜åŠ¿ï¼ˆæ¶æ„ã€å¹¶å‘ã€å†…å­˜ç®¡ç†ï¼‰æ˜¯å®è´µèµ„äº§ï¼Œéœ€è¦å›´ç»•Cç«¯éœ€æ±‚è¿›è¡Œå®šå‘è¡¥å¼ºï¼š</p>
<ul>
<li><strong>å›¾å½¢åŸºç¡€</strong>ï¼šæ— éœ€ç«‹å³æˆä¸ºå›¾å½¢å­¦ä¸“å®¶ï¼Œä½†å¿…é¡»ç†è§£<strong>æ¸²æŸ“ç®¡çº¿ã€ç€è‰²å™¨ã€çº¹ç†ä¸é¡¶ç‚¹å˜æ¢</strong>çš„åŸºæœ¬æ¦‚å¿µã€‚å¯é€šè¿‡â€œç”¨OpenGL/Vulkanç»˜åˆ¶ä¸€ä¸ªå¸¦å…‰ç…§çš„3Dåœºæ™¯â€æ­¤ç±»å°é¡¹ç›®å¿«é€Ÿå…¥é—¨ã€‚</li>
<li><strong>å¹³å°ç‰¹æ€§</strong>ï¼šé€‰æ‹©ä¸€ä¸ªä¸»æ”»å¹³å°ï¼ˆå¦‚Windowsæˆ–macOSï¼‰ï¼Œå­¦ä¹ å…¶åŸç”ŸAPIï¼ˆå¦‚Win32ã€Cocoaï¼‰çš„åŸºç¡€ï¼Œç‰¹åˆ«æ˜¯çª—å£ç®¡ç†ã€æ¶ˆæ¯å¾ªç¯å’Œè¾“å…¥äº‹ä»¶å¤„ç†æœºåˆ¶ã€‚</li>
<li><strong>ç°ä»£C++å®è·µ</strong>ï¼šæ·±å…¥æŒæ¡<code>C++17/20</code>ä¸­çš„ç§»åŠ¨è¯­ä¹‰ã€æ™ºèƒ½æŒ‡é’ˆã€Lambdaè¡¨è¾¾å¼ï¼Œå®ƒä»¬åœ¨ç°ä»£Cç«¯æ¡†æ¶å’Œå¼•æ“ä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œæ˜¯ç¼–å†™é«˜æ•ˆã€å®‰å…¨èµ„æºç®¡ç†ä»£ç çš„åˆ©å™¨ã€‚</li>
</ul>
<p><strong>3. é€‰æ‹©èµ›é“ä¸é¡¹ç›®å®è·µ</strong>
æ ¹æ®å…´è¶£ï¼Œé€‰æ‹©ä¸€æ¡è·¯å¾„è¿›è¡Œ6ä¸ªæœˆå·¦å³çš„æ²‰æµ¸å¼å®è·µï¼š</p>
<ul>
<li><strong>æ¸¸æˆ/å›¾å½¢æ–¹å‘</strong>ï¼šæ·±å…¥<strong>Unreal Engine</strong>ï¼Œç†è§£æ¸¸æˆå¾ªç¯ã€å®ä½“ç»„ä»¶ç³»ç»Ÿã€èµ„æºç®¡é“ã€‚ç›®æ ‡ï¼šå®Œæˆä¸€ä¸ªåŒ…å«å®Œæ•´ç©æ³•å¾ªç¯çš„å°å‹Demoã€‚</li>
<li><strong>é«˜æ€§èƒ½æ¡Œé¢è½¯ä»¶æ–¹å‘</strong>ï¼šç²¾é€š<strong>Qtæ¡†æ¶</strong>ï¼ŒæŒæ¡å…¶ä¿¡å·æ§½æœºåˆ¶ã€æ¨¡å‹-è§†å›¾æ¶æ„åŠè·¨å¹³å°éƒ¨ç½²ã€‚ç›®æ ‡ï¼šå¼€å‘ä¸€ä¸ªåŠŸèƒ½å®ç”¨ã€æ€§èƒ½å‡ºè‰²çš„è·¨å¹³å°å·¥å…·ï¼ˆå¦‚ä»£ç ç¼–è¾‘å™¨ã€åª’ä½“ç®¡ç†å™¨ï¼‰ã€‚</li>
<li><strong>ç³»ç»Ÿ/é©±åŠ¨æ–¹å‘</strong>ï¼šæ·±å…¥ç ”ç©¶Windowså†…æ ¸æˆ–Linuxé©±åŠ¨å¼€å‘æ¨¡å‹ã€‚ç›®æ ‡ï¼šå®ç°ä¸€ä¸ªç®€å•çš„æ–‡ä»¶ç³»ç»Ÿè¿‡æ»¤å™¨é©±åŠ¨æˆ–ç¡¬ä»¶ç›‘æ§å·¥å…·ã€‚</li>
</ul>
<p><strong>åœ¨æ­¤é˜¶æ®µï¼Œå¿…é¡»é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªå®Œæ•´çš„ã€å¯è¿è¡Œå±•ç¤ºçš„é¡¹ç›®æ¥å›ºåŒ–å­¦ä¹ æˆæœï¼Œè¿™è¿œæ¯”é˜…è¯»å¤§é‡ç†è®ºæ›´æœ‰ä»·å€¼ã€‚</strong></p>
<h4 data-id="heading-3">å››ã€è·¨è¶Šé¸¿æ²Ÿï¼šæ­£è§†è½¬å‹ä¸­çš„çœŸå®éš¾ç‚¹</h4>
<p>è½¬å‹çš„çœŸæ­£éšœç¢ï¼Œå¾€å¾€ä¸åœ¨äºæ–°æŠ€æœ¯çš„å­¦ä¹ ï¼Œè€Œåœ¨äºä¸€äº›éšæ€§å£å’ã€‚</p>
<p><strong>1. æŠ€æœ¯èŒƒå¼çš„è½¬æ¢ä¹‹éš¾</strong>
ä½ ç²¾é€šçš„æœåŠ¡ç«¯å¹¶å‘æ¨¡å‹ï¼Œåœ¨å®¢æˆ·ç«¯å¯èƒ½éœ€è½¬æ¢ä¸º<strong>æ¸²æŸ“çº¿ç¨‹ã€é€»è¾‘çº¿ç¨‹ã€IOçº¿ç¨‹</strong>çš„ååŒã€‚ä½ ç†Ÿæ‚‰çš„æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–ç»éªŒï¼Œå¯è½¬åŒ–ä¸ºå¯¹<strong>çº¹ç†ã€ç½‘æ ¼ç­‰å›¾å½¢èµ„æºæ± </strong>çš„ç®¡ç†ã€‚å…³é”®åœ¨äºè¯†åˆ«å‡ºBç«¯ç»éªŒä¸­å¯è¿ç§»çš„â€œå…ƒèƒ½åŠ›â€ï¼ˆå¦‚èµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†ã€å¹¶å‘æ§åˆ¶ï¼‰ï¼Œå¹¶å°†å…¶é€‚é…åˆ°Cç«¯çš„æ–°è¯­å¢ƒä¸­ã€‚</p>
<p><strong>2. å¼€å‘èŠ‚å¥ä¸è´¨é‡æ–‡åŒ–çš„å†²å‡»</strong>
Bç«¯é€šå¸¸æœ‰è¾ƒé•¿çš„éœ€æ±‚å†»ç»“å’Œæµ‹è¯•å‘¨æœŸï¼Œè€ŒCç«¯ï¼ˆå°¤å…¶æ˜¯æ¸¸æˆå’Œäº’è”ç½‘äº§å“ï¼‰åˆ™å¤„äº<strong>å¿«é€Ÿè¿­ä»£ã€A/Bæµ‹è¯•ã€æ•°æ®é©±åŠ¨</strong>çš„æ•æ·èŠ‚å¥ä¸­ã€‚ä½ éœ€è¦é€‚åº”â€œå¿«é€Ÿæ¨å‡ºæœ€å°å¯è¡Œäº§å“ï¼Œæ ¹æ®ç”¨æˆ·åé¦ˆæŒç»­ä¼˜åŒ–â€çš„å·¥ä½œæ¨¡å¼ï¼Œå°†å¯¹â€œç»å¯¹æ­£ç¡®â€çš„æ‰§ç€ï¼Œéƒ¨åˆ†è®©ä½äºå¯¹â€œç”¨æˆ·å–œæ¬¢â€çš„è¿½æ±‚ã€‚</p>
<p><strong>3. è¯„ä»·ä½“ç³»çš„é‡æ–°é€‚åº”</strong>
åœ¨Bç«¯ï¼Œä½ çš„å·¥ä½œä»·å€¼ç”±å†…éƒ¨å®¢æˆ·å’Œç³»ç»Ÿç¨³å®šæ€§æŒ‡æ ‡è¡¡é‡ã€‚åœ¨Cç«¯ï¼Œä»·å€¼å°†ç›´æ¥ç”±<strong>åº”ç”¨å•†åº—è¯„åˆ†ã€ç”¨æˆ·æ´»è·ƒæ•°æ®ã€å¸‚åœºå£ç¢‘</strong>ç­‰å…¬å¼€ã€æ®‹é…·çš„æŒ‡æ ‡æ¥è¯„åˆ¤ã€‚è¿™è¦æ±‚å¼€å‘è€…å…·å¤‡æ›´å¼ºçš„äº§å“æ„è¯†å’Œä¸»äººç¿ç²¾ç¥ã€‚</p>
<h4 data-id="heading-4">ç»“è¯­</h4>
<p>ä»Bç«¯åˆ°Cç«¯çš„è½¬å‹ï¼Œæ˜¯ä¸€æ¬¡ä»â€œä¸–ç•Œçš„æ„å»ºè€…â€åˆ°â€œä½“éªŒçš„é›•å¡‘å®¶â€çš„èº«ä»½è½¬å˜ã€‚å®ƒè¦æ±‚ä½ å°†æ·±åšçš„ç³»ç»ŸåŠŸåŠ›ï¼ŒçŒæ³¨åˆ°å¯¹æ¯ä¸€å¸§ç”»é¢ã€æ¯ä¸€æ¬¡ç‚¹å‡»å“åº”çš„æè‡´æ‰“ç£¨ä¹‹ä¸­ã€‚</p>
<p>è¿™æ¡é“è·¯å……æ»¡æŒ‘æˆ˜ï¼šä½ éœ€è¦æ”¾ä¸‹éƒ¨åˆ†å¼•ä»¥ä¸ºå‚²çš„â€œæ§åˆ¶æ„Ÿâ€ï¼Œå»æ‹¥æŠ±ç”¨æˆ·æ„ŸçŸ¥çš„ä¸ç¡®å®šæ€§ï¼›éœ€è¦å°†å®è§‚çš„æ¶æ„è§†é‡ï¼Œèšç„¦äºå¾®è§‚çš„æ€§èƒ½çƒ­ç‚¹ã€‚ä½†å›æŠ¥ä¹ŸåŒæ ·ä¸°åšï¼šä½ å°†èƒ½äº²æ‰‹æ‰“é€ ç›´æ¥è§¦åŠ¨æ•°ç™¾ä¸‡ç”¨æˆ·çš„äº§å“ï¼Œè·å¾—æœ€å³æ—¶çš„åé¦ˆï¼Œå¹¶åœ¨æŠ€æœ¯ã€è‰ºæœ¯ä¸äººæ€§äº¤æ±‡å¤„ï¼Œæ‰¾åˆ°å±äºC++å¼€å‘è€…å…¨æ–°çš„ã€æ¿€åŠ¨äººå¿ƒçš„åˆ›é€ ç©ºé—´ã€‚</p>
<p>è¿™å¹¶éç®€å•çš„èµ›é“è½¬æ¢ï¼Œè€Œæ˜¯ä¸€åœºèŒä¸šèƒ½åŠ›çš„æˆ˜ç•¥æ€§æ‹“å±•ã€‚å½“ä½ æˆåŠŸåœ°å°†Bç«¯çš„ä¸¥è°¨ä¸Cç«¯çš„çµåŠ¨èä¸ºä¸€ä½“æ—¶ï¼Œä½ å°†æˆä¸ºä¸€ä¸ªæ›´å¼ºå¤§ã€æ›´ç¨€ç¼ºçš„å¼€å‘è€…ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++ å¤šçº¿ç¨‹å¼€å‘ï¼šä»é›¶å¼€å§‹çš„å®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7583913535271305226</link>    <guid>https://juejin.cn/post/7583913535271305226</guid>    <pubDate>2025-12-15T15:01:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583913535271305226" data-draft-id="7583912637470490675" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++ å¤šçº¿ç¨‹å¼€å‘ï¼šä»é›¶å¼€å§‹çš„å®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T15:01:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç äº‹æ¼«è°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++ å¤šçº¿ç¨‹å¼€å‘ï¼šä»é›¶å¼€å§‹çš„å®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç äº‹æ¼«è°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T15:01:03.000Z" title="Mon Dec 15 2025 15:01:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦å¤šçº¿ç¨‹ï¼Ÿ</h2>
<p>åœ¨ç°ä»£è®¡ç®—æœºä½“ç³»ç»“æ„ä¸­ï¼Œå¤šæ ¸å¤„ç†å™¨å·²æˆä¸ºæ ‡å‡†é…ç½®ã€‚å¤šçº¿ç¨‹ç¼–ç¨‹å…è®¸æˆ‘ä»¬å……åˆ†åˆ©ç”¨è¿™äº›è®¡ç®—èµ„æºï¼Œé€šè¿‡å¹¶è¡Œæ‰§è¡Œä»»åŠ¡æ¥æå‡ç¨‹åºæ€§èƒ½ã€‚C++11ä¹‹å‰ï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹ä¾èµ–äºå¹³å°ç‰¹å®šçš„APIï¼ˆå¦‚POSIX pthreadsã€Windowsçº¿ç¨‹APIï¼‰ï¼ŒC++11æ ‡å‡†å¼•å…¥äº†<code>&lt;thread&gt;</code>ç­‰å¤´æ–‡ä»¶ï¼Œä¸ºå¤šçº¿ç¨‹ç¼–ç¨‹æä¾›äº†ç»Ÿä¸€ã€å¯ç§»æ¤çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-1">äºŒã€C++å¤šçº¿ç¨‹åŸºç¡€</h2>
<h3 data-id="heading-2">2.1 ç¬¬ä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åº</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;chrono&gt;</span></span>

<span class="hljs-comment">// çº¿ç¨‹å‡½æ•°</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">threadFunction</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"çº¿ç¨‹ "</span> &lt;&lt; id &lt;&lt; <span class="hljs-string">" å¼€å§‹æ‰§è¡Œ"</span> &lt;&lt; std::endl;
    std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">seconds</span>(<span class="hljs-number">1</span>));
    std::cout &lt;&lt; <span class="hljs-string">"çº¿ç¨‹ "</span> &lt;&lt; id &lt;&lt; <span class="hljs-string">" ç»“æŸæ‰§è¡Œ"</span> &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"ä¸»çº¿ç¨‹å¼€å§‹ï¼Œåˆ›å»º3ä¸ªå­çº¿ç¨‹"</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹</span>
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">(threadFunction, <span class="hljs-number">1</span>)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">(threadFunction, <span class="hljs-number">2</span>)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t3</span><span class="hljs-params">(threadFunction, <span class="hljs-number">3</span>)</span></span>;
    
    <span class="hljs-comment">// ç­‰å¾…çº¿ç¨‹å®Œæˆ</span>
    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();
    t3.<span class="hljs-built_in">join</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-3">2.2 çº¿ç¨‹ç®¡ç†çš„åŸºæœ¬æ“ä½œ</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">worker</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"å·¥ä½œçº¿ç¨‹ID: "</span> &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// è·å–ç¡¬ä»¶æ”¯æŒçš„å¹¶å‘çº¿ç¨‹æ•°</span>
    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> n = std::thread::<span class="hljs-built_in">hardware_concurrency</span>();
    std::cout &lt;&lt; <span class="hljs-string">"ç¡¬ä»¶æ”¯æŒçš„æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°: "</span> &lt;&lt; n &lt;&lt; std::endl;
    
    <span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹</span>
    <span class="hljs-function">std::thread <span class="hljs-title">t</span><span class="hljs-params">(worker)</span></span>;
    
    <span class="hljs-comment">// çº¿ç¨‹ID</span>
    std::cout &lt;&lt; <span class="hljs-string">"ä¸»çº¿ç¨‹ID: "</span> &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"å­çº¿ç¨‹ID: "</span> &lt;&lt; t.<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;
    
    <span class="hljs-comment">// æ£€æŸ¥çº¿ç¨‹æ˜¯å¦å¯join</span>
    <span class="hljs-keyword">if</span> (t.<span class="hljs-built_in">joinable</span>()) {
        t.<span class="hljs-built_in">join</span>();  <span class="hljs-comment">// ç­‰å¾…çº¿ç¨‹å®Œæˆ</span>
    }
    
    <span class="hljs-comment">// åˆ†ç¦»çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ä¸ç­‰å¾…ï¼‰</span>
    <span class="hljs-comment">// t.detach(); // è°¨æ…ä½¿ç”¨ï¼</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-4">ä¸‰ã€æ•°æ®å…±äº«ä¸åŒæ­¥</h2>
<h3 data-id="heading-5">3.1 ç«æ€æ¡ä»¶ä¸æ•°æ®ç«äº‰</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-comment">// æœ‰æ•°æ®ç«äº‰çš„é”™è¯¯ç¤ºä¾‹</span>
<span class="hljs-type">int</span> counter = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; ++i) {
        counter++;  <span class="hljs-comment">// éåŸå­æ“ä½œï¼Œå­˜åœ¨æ•°æ®ç«äº‰</span>
    }
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">(increment)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">(increment)</span></span>;
    
    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();
    
    <span class="hljs-comment">// ç»“æœå¯èƒ½ä¸æ˜¯200000</span>
    std::cout &lt;&lt; <span class="hljs-string">"è®¡æ•°å™¨å€¼: "</span> &lt;&lt; counter &lt;&lt; std::endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-6">3.2 äº’æ–¥é”ï¼ˆMutexï¼‰</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-type">int</span> counter = <span class="hljs-number">0</span>;
std::mutex mtx;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">safeIncrement</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; ++i) {
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>;  <span class="hljs-comment">// è‡ªåŠ¨åŠ é”è§£é”</span>
        counter++;
        <span class="hljs-comment">// lock_guardç¦»å¼€ä½œç”¨åŸŸï¼Œè‡ªåŠ¨é‡Šæ”¾é”</span>
    }
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">tryLockExample</span><span class="hljs-params">()</span> </span>{
    std::timed_mutex timed_mtx;
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i) {
        <span class="hljs-comment">// å°è¯•è·å–é”ï¼Œéé˜»å¡</span>
        <span class="hljs-keyword">if</span> (timed_mtx.<span class="hljs-built_in">try_lock</span>()) {
            std::cout &lt;&lt; <span class="hljs-string">"çº¿ç¨‹ "</span> &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() 
                      &lt;&lt; <span class="hljs-string">" è·å–åˆ°é”"</span> &lt;&lt; std::endl;
            std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">100</span>));
            timed_mtx.<span class="hljs-built_in">unlock</span>();
            <span class="hljs-keyword">break</span>;
        } <span class="hljs-keyword">else</span> {
            std::cout &lt;&lt; <span class="hljs-string">"çº¿ç¨‹ "</span> &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() 
                      &lt;&lt; <span class="hljs-string">" æœªèƒ½è·å–é”ï¼Œç­‰å¾…é‡è¯•"</span> &lt;&lt; std::endl;
            std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">50</span>));
        }
    }
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">(safeIncrement)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">(safeIncrement)</span></span>;
    
    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"å®‰å…¨çš„è®¡æ•°å™¨å€¼: "</span> &lt;&lt; counter &lt;&lt; std::endl;
    
    <span class="hljs-comment">// å°è¯•é”ç¤ºä¾‹</span>
    <span class="hljs-function">std::thread <span class="hljs-title">t3</span><span class="hljs-params">(tryLockExample)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t4</span><span class="hljs-params">(tryLockExample)</span></span>;
    
    t3.<span class="hljs-built_in">join</span>();
    t4.<span class="hljs-built_in">join</span>();
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-7">3.3 é€’å½’é”ä¸é”ä¿æŠ¤</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>

std::recursive_mutex rec_mtx;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">recursiveFunction</span><span class="hljs-params">(<span class="hljs-type">int</span> depth)</span> </span>{
    <span class="hljs-keyword">if</span> (depth &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
    
    rec_mtx.<span class="hljs-built_in">lock</span>();
    std::cout &lt;&lt; <span class="hljs-string">"æ·±åº¦: "</span> &lt;&lt; depth &lt;&lt; <span class="hljs-string">", çº¿ç¨‹ID: "</span> 
              &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;
    
    <span class="hljs-comment">// é€’å½’è°ƒç”¨ï¼Œä½¿ç”¨é€’å½’é”é¿å…æ­»é”</span>
    <span class="hljs-built_in">recursiveFunction</span>(depth - <span class="hljs-number">1</span>);
    
    rec_mtx.<span class="hljs-built_in">unlock</span>();
}

<span class="hljs-comment">// ä½¿ç”¨unique_lockæä¾›æ›´çµæ´»çš„é”ç®¡ç†</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">flexibleLockExample</span><span class="hljs-params">()</span> </span>{
    std::mutex mtx;
    <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx, std::defer_lock)</span></span>;
    
    <span class="hljs-comment">// å»¶è¿Ÿé”å®š</span>
    std::cout &lt;&lt; <span class="hljs-string">"å‡†å¤‡è·å–é”..."</span> &lt;&lt; std::endl;
    lock.<span class="hljs-built_in">lock</span>();
    std::cout &lt;&lt; <span class="hljs-string">"è·å–åˆ°é”ï¼Œæ‰§è¡Œä¸´ç•ŒåŒºæ“ä½œ"</span> &lt;&lt; std::endl;
    lock.<span class="hljs-built_in">unlock</span>();
    
    <span class="hljs-comment">// å¯ä»¥é‡æ–°é”å®š</span>
    lock.<span class="hljs-built_in">lock</span>();
    std::cout &lt;&lt; <span class="hljs-string">"é‡æ–°é”å®š"</span> &lt;&lt; std::endl;
    <span class="hljs-comment">// è‡ªåŠ¨è§£é”</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">(recursiveFunction, <span class="hljs-number">3</span>)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">(flexibleLockExample)</span></span>;
    
    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-8">3.4 æ¡ä»¶å˜é‡</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;condition_variable&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>

std::mutex mtx;
std::condition_variable cv;
std::queue&lt;<span class="hljs-type">int</span>&gt; dataQueue;
<span class="hljs-type">bool</span> finished = <span class="hljs-literal">false</span>;

<span class="hljs-comment">// ç”Ÿäº§è€…çº¿ç¨‹</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">producer</span><span class="hljs-params">(<span class="hljs-type">int</span> items)</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; items; ++i) {
        std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">100</span>));
        
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>;
        dataQueue.<span class="hljs-built_in">push</span>(i);
        std::cout &lt;&lt; <span class="hljs-string">"ç”Ÿäº§: "</span> &lt;&lt; i &lt;&lt; std::endl;
        
        cv.<span class="hljs-built_in">notify_one</span>();  <span class="hljs-comment">// é€šçŸ¥ä¸€ä¸ªç­‰å¾…çš„æ¶ˆè´¹è€…</span>
    }
    
    {
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>;
        finished = <span class="hljs-literal">true</span>;
    }
    cv.<span class="hljs-built_in">notify_all</span>();  <span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰æ¶ˆè´¹è€…</span>
}

<span class="hljs-comment">// æ¶ˆè´¹è€…çº¿ç¨‹</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">consumer</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> </span>{
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>;
        
        <span class="hljs-comment">// ç­‰å¾…æ¡ä»¶ï¼šé˜Ÿåˆ—ä¸ä¸ºç©ºæˆ–ç”Ÿäº§ç»“æŸ</span>
        cv.<span class="hljs-built_in">wait</span>(lock, []{ 
            <span class="hljs-keyword">return</span> !dataQueue.<span class="hljs-built_in">empty</span>() || finished; 
        });
        
        <span class="hljs-keyword">if</span> (finished &amp;&amp; dataQueue.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-keyword">break</span>;
        }
        
        <span class="hljs-keyword">if</span> (!dataQueue.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-type">int</span> value = dataQueue.<span class="hljs-built_in">front</span>();
            dataQueue.<span class="hljs-built_in">pop</span>();
            lock.<span class="hljs-built_in">unlock</span>();  <span class="hljs-comment">// æå‰è§£é”ï¼Œå‡å°‘é”æŒæœ‰æ—¶é—´</span>
            
            std::cout &lt;&lt; <span class="hljs-string">"æ¶ˆè´¹è€… "</span> &lt;&lt; id &lt;&lt; <span class="hljs-string">" æ¶ˆè´¹: "</span> &lt;&lt; value &lt;&lt; std::endl;
        }
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"æ¶ˆè´¹è€… "</span> &lt;&lt; id &lt;&lt; <span class="hljs-string">" ç»“æŸ"</span> &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::thread <span class="hljs-title">prod</span><span class="hljs-params">(producer, <span class="hljs-number">10</span>)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">cons1</span><span class="hljs-params">(consumer, <span class="hljs-number">1</span>)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">cons2</span><span class="hljs-params">(consumer, <span class="hljs-number">2</span>)</span></span>;
    
    prod.<span class="hljs-built_in">join</span>();
    cons1.<span class="hljs-built_in">join</span>();
    cons2.<span class="hljs-built_in">join</span>();
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-9">å››ã€åŸå­æ“ä½œ</h2>
<h3 data-id="heading-10">4.1 åŸå­ç±»å‹</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;atomic&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-function">std::atomic&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">atomicCounter</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;
<span class="hljs-function">std::atomic&lt;<span class="hljs-type">bool</span>&gt; <span class="hljs-title">ready</span><span class="hljs-params">(<span class="hljs-literal">false</span>)</span></span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">atomicIncrement</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// ç­‰å¾…ä¿¡å·</span>
    <span class="hljs-keyword">while</span> (!ready.<span class="hljs-built_in">load</span>(std::memory_order_acquire)) {
        std::this_thread::<span class="hljs-built_in">yield</span>();  <span class="hljs-comment">// è®©å‡ºCPUæ—¶é—´ç‰‡</span>
    }
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; ++i) {
        atomicCounter.<span class="hljs-built_in">fetch_add</span>(<span class="hljs-number">1</span>, std::memory_order_relaxed);
    }
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">testAtomicOperations</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::atomic&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">value</span><span class="hljs-params">(<span class="hljs-number">10</span>)</span></span>;
    
    <span class="hljs-comment">// åŸå­æ“ä½œç¤ºä¾‹</span>
    <span class="hljs-type">int</span> expected = <span class="hljs-number">10</span>;
    <span class="hljs-type">bool</span> success = value.<span class="hljs-built_in">compare_exchange_strong</span>(expected, <span class="hljs-number">20</span>);
    std::cout &lt;&lt; <span class="hljs-string">"CASæ“ä½œ: "</span> &lt;&lt; (success ? <span class="hljs-string">"æˆåŠŸ"</span> : <span class="hljs-string">"å¤±è´¥"</span>) 
              &lt;&lt; <span class="hljs-string">", å½“å‰å€¼: "</span> &lt;&lt; value.<span class="hljs-built_in">load</span>() &lt;&lt; std::endl;
    
    <span class="hljs-comment">// åŸå­æ ‡å¿—æµ‹è¯•</span>
    std::atomic_flag flag = ATOMIC_FLAG_INIT;
    
    <span class="hljs-comment">// æµ‹è¯•å¹¶è®¾ç½®</span>
    <span class="hljs-type">bool</span> was_set = flag.<span class="hljs-built_in">test_and_set</span>();
    std::cout &lt;&lt; <span class="hljs-string">"ç¬¬ä¸€æ¬¡test_and_set: "</span> &lt;&lt; was_set &lt;&lt; std::endl;
    
    flag.<span class="hljs-built_in">clear</span>();
    was_set = flag.<span class="hljs-built_in">test_and_set</span>();
    std::cout &lt;&lt; <span class="hljs-string">"æ¸…é™¤åtest_and_set: "</span> &lt;&lt; was_set &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">const</span> <span class="hljs-type">int</span> num_threads = <span class="hljs-number">4</span>;
    std::vector&lt;std::thread&gt; threads;
    
    <span class="hljs-comment">// å¯åŠ¨çº¿ç¨‹</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; num_threads; ++i) {
        threads.<span class="hljs-built_in">emplace_back</span>(atomicIncrement);
    }
    
    <span class="hljs-comment">// è®©æ‰€æœ‰çº¿ç¨‹å¼€å§‹æ‰§è¡Œ</span>
    ready.<span class="hljs-built_in">store</span>(<span class="hljs-literal">true</span>, std::memory_order_release);
    
    <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; t : threads) {
        t.<span class="hljs-built_in">join</span>();
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"åŸå­è®¡æ•°å™¨æœ€ç»ˆå€¼: "</span> &lt;&lt; atomicCounter.<span class="hljs-built_in">load</span>() &lt;&lt; std::endl;
    
    <span class="hljs-comment">// æµ‹è¯•å…¶ä»–åŸå­æ“ä½œ</span>
    <span class="hljs-built_in">testAtomicOperations</span>();
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-11">4.2 å†…å­˜é¡ºåº</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;atomic&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function">std::atomic&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">x</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span>, <span class="hljs-title">y</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;
<span class="hljs-function">std::atomic&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">z</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">write_x_then_y</span><span class="hljs-params">()</span> </span>{
    x.<span class="hljs-built_in">store</span>(<span class="hljs-number">1</span>, std::memory_order_relaxed);  <span class="hljs-comment">// 1</span>
    y.<span class="hljs-built_in">store</span>(<span class="hljs-number">1</span>, std::memory_order_release);  <span class="hljs-comment">// 2</span>
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">read_y_then_x</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">while</span> (!y.<span class="hljs-built_in">load</span>(std::memory_order_acquire));  <span class="hljs-comment">// 3</span>
    <span class="hljs-keyword">if</span> (x.<span class="hljs-built_in">load</span>(std::memory_order_relaxed)) {      <span class="hljs-comment">// 4</span>
        z.<span class="hljs-built_in">fetch_add</span>(<span class="hljs-number">1</span>);
    }
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">memoryOrderDemo</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">(write_x_then_y)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">(read_y_then_x)</span></span>;
    
    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();
    
    <span class="hljs-comment">// zåº”è¯¥ä¸º1</span>
    std::cout &lt;&lt; <span class="hljs-string">"z = "</span> &lt;&lt; z.<span class="hljs-built_in">load</span>() &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// å¤šæ¬¡è¿è¡Œè§‚å¯Ÿç»“æœ</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) {
        x = <span class="hljs-number">0</span>;
        y = <span class="hljs-number">0</span>;
        z = <span class="hljs-number">0</span>;
        <span class="hljs-built_in">memoryOrderDemo</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-12">äº”ã€é«˜çº§å¤šçº¿ç¨‹æ¨¡å¼</h2>
<h3 data-id="heading-13">5.1 çº¿ç¨‹æ± å®ç°</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;condition_variable&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;functional&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;future&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPool</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ThreadPool</span>(<span class="hljs-type">size_t</span> numThreads) : <span class="hljs-built_in">stop</span>(<span class="hljs-literal">false</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; numThreads; ++i) {
            workers.<span class="hljs-built_in">emplace_back</span>([<span class="hljs-keyword">this</span>] {
                <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                    std::function&lt;<span class="hljs-built_in">void</span>()&gt; task;
                    
                    {
                        std::unique_lock&lt;std::mutex&gt; <span class="hljs-built_in">lock</span>(queueMutex);
                        condition.<span class="hljs-built_in">wait</span>(lock, [<span class="hljs-keyword">this</span>] {
                            <span class="hljs-keyword">return</span> stop || !tasks.<span class="hljs-built_in">empty</span>();
                        });
                        
                        <span class="hljs-keyword">if</span> (stop &amp;&amp; tasks.<span class="hljs-built_in">empty</span>()) {
                            <span class="hljs-keyword">return</span>;
                        }
                        
                        task = std::<span class="hljs-built_in">move</span>(tasks.<span class="hljs-built_in">front</span>());
                        tasks.<span class="hljs-built_in">pop</span>();
                    }
                    
                    <span class="hljs-built_in">task</span>();
                }
            });
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> F, <span class="hljs-keyword">class</span>... Args&gt;
    <span class="hljs-keyword">auto</span> <span class="hljs-title">enqueue</span><span class="hljs-params">(F&amp;&amp; f, Args&amp;&amp;... args)</span> 
        -&gt; std::future&lt;<span class="hljs-keyword">typename</span> std::result_of&lt;<span class="hljs-title">F</span><span class="hljs-params">(Args...)</span>&gt;::type&gt; </span>{
        
        <span class="hljs-keyword">using</span> return_type = <span class="hljs-keyword">typename</span> std::result_of&lt;<span class="hljs-built_in">F</span>(Args...)&gt;::type;
        
        <span class="hljs-keyword">auto</span> task = std::make_shared&lt;std::packaged_task&lt;<span class="hljs-built_in">return_type</span>()&gt;&gt;(
            std::<span class="hljs-built_in">bind</span>(std::forward&lt;F&gt;(f), std::forward&lt;Args&gt;(args)...)
        );
        
        std::future&lt;return_type&gt; res = task-&gt;<span class="hljs-built_in">get_future</span>();
        
        {
            <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(queueMutex)</span></span>;
            
            <span class="hljs-keyword">if</span> (stop) {
                <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">runtime_error</span>(<span class="hljs-string">"çº¿ç¨‹æ± å·²åœæ­¢"</span>);
            }
            
            tasks.<span class="hljs-built_in">emplace</span>([task]() { (*task)(); });
        }
        
        condition.<span class="hljs-built_in">notify_one</span>();
        <span class="hljs-keyword">return</span> res;
    }
    
    ~<span class="hljs-built_in">ThreadPool</span>() {
        {
            <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(queueMutex)</span></span>;
            stop = <span class="hljs-literal">true</span>;
        }
        
        condition.<span class="hljs-built_in">notify_all</span>();
        
        <span class="hljs-keyword">for</span> (std::thread&amp; worker : workers) {
            worker.<span class="hljs-built_in">join</span>();
        }
    }
    
<span class="hljs-keyword">private</span>:
    std::vector&lt;std::thread&gt; workers;
    std::queue&lt;std::function&lt;<span class="hljs-type">void</span>()&gt;&gt; tasks;
    
    std::mutex queueMutex;
    std::condition_variable condition;
    <span class="hljs-type">bool</span> stop;
};

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">ThreadPool <span class="hljs-title">pool</span><span class="hljs-params">(<span class="hljs-number">4</span>)</span></span>;
    std::vector&lt;std::future&lt;<span class="hljs-type">int</span>&gt;&gt; results;
    
    <span class="hljs-comment">// æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; ++i) {
        results.<span class="hljs-built_in">emplace_back</span>(
            pool.<span class="hljs-built_in">enqueue</span>([i] {
                std::cout &lt;&lt; <span class="hljs-string">"ä»»åŠ¡ "</span> &lt;&lt; i &lt;&lt; <span class="hljs-string">" åœ¨çº¿ç¨‹ "</span> 
                          &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; <span class="hljs-string">" æ‰§è¡Œ"</span> &lt;&lt; std::endl;
                std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">seconds</span>(<span class="hljs-number">1</span>));
                <span class="hljs-keyword">return</span> i * i;
            })
        );
    }
    
    <span class="hljs-comment">// è·å–ç»“æœ</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; result : results) {
        std::cout &lt;&lt; <span class="hljs-string">"ç»“æœ: "</span> &lt;&lt; result.<span class="hljs-built_in">get</span>() &lt;&lt; std::endl;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-14">5.2 è¯»å†™é”ï¼ˆC++14åŠä»¥ä¸Šï¼‰</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;shared_mutex&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;chrono&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafeData</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">mutable</span> std::shared_mutex mutex_;
    <span class="hljs-type">int</span> data_;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ThreadSafeData</span>(<span class="hljs-type">int</span> init = <span class="hljs-number">0</span>) : <span class="hljs-built_in">data_</span>(init) {}
    
    <span class="hljs-comment">// è¯»å–æ“ä½œ - å…±äº«é”</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-function">std::shared_lock&lt;std::shared_mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        std::cout &lt;&lt; <span class="hljs-string">"è¯»å–: "</span> &lt;&lt; data_ &lt;&lt; <span class="hljs-string">" çº¿ç¨‹ID: "</span> 
                  &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;
        <span class="hljs-keyword">return</span> data_;
    }
    
    <span class="hljs-comment">// å†™å…¥æ“ä½œ - ç‹¬å é”</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> </span>{
        <span class="hljs-function">std::unique_lock&lt;std::shared_mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        std::cout &lt;&lt; <span class="hljs-string">"å†™å…¥: "</span> &lt;&lt; value &lt;&lt; <span class="hljs-string">" çº¿ç¨‹ID: "</span> 
                  &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;
        data_ = value;
    }
    
    <span class="hljs-comment">// å¢é‡æ“ä½œ</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">std::unique_lock&lt;std::shared_mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        ++data_;
        std::cout &lt;&lt; <span class="hljs-string">"å¢é‡åˆ°: "</span> &lt;&lt; data_ &lt;&lt; <span class="hljs-string">" çº¿ç¨‹ID: "</span> 
                  &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;
    }
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">ThreadSafeData <span class="hljs-title">data</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;
    std::vector&lt;std::thread&gt; threads;
    
    <span class="hljs-comment">// åˆ›å»º5ä¸ªè¯»çº¿ç¨‹</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i) {
        threads.<span class="hljs-built_in">emplace_back</span>([&amp;data, i] {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">3</span>; ++j) {
                data.<span class="hljs-built_in">read</span>();
                std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">100</span>));
            }
        });
    }
    
    <span class="hljs-comment">// åˆ›å»º2ä¸ªå†™çº¿ç¨‹</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; ++i) {
        threads.<span class="hljs-built_in">emplace_back</span>([&amp;data, i] {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">2</span>; ++j) {
                data.<span class="hljs-built_in">write</span>(i * <span class="hljs-number">10</span> + j);
                std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">200</span>));
            }
        });
    }
    
    <span class="hljs-comment">// åˆ›å»º1ä¸ªå¢é‡çº¿ç¨‹</span>
    threads.<span class="hljs-built_in">emplace_back</span>([&amp;data] {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; ++i) {
            data.<span class="hljs-built_in">increment</span>();
            std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">150</span>));
        }
    });
    
    <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; t : threads) {
        t.<span class="hljs-built_in">join</span>();
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"æœ€ç»ˆå€¼: "</span> &lt;&lt; data.<span class="hljs-built_in">read</span>() &lt;&lt; std::endl;
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-15">å…­ã€C++20æ–°ç‰¹æ€§ï¼šåç¨‹å’Œä¿¡å·é‡</h2>
<h3 data-id="heading-16">6.1 ä¿¡å·é‡ï¼ˆC++20ï¼‰</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;semaphore&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-comment">// ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ä½¿ç”¨ä¿¡å·é‡</span>
<span class="hljs-function">std::counting_semaphore&lt;10&gt; <span class="hljs-title">emptySlots</span><span class="hljs-params">(<span class="hljs-number">10</span>)</span></span>;  <span class="hljs-comment">// ç©ºæ§½ä½ä¿¡å·é‡</span>
<span class="hljs-function">std::counting_semaphore&lt;10&gt; <span class="hljs-title">fullSlots</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;    <span class="hljs-comment">// æ»¡æ§½ä½ä¿¡å·é‡</span>
std::mutex bufferMutex;
std::queue&lt;<span class="hljs-type">int</span>&gt; buffer;
<span class="hljs-type">bool</span> done = <span class="hljs-literal">false</span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">producer</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i) {
        emptySlots.<span class="hljs-built_in">acquire</span>();  <span class="hljs-comment">// ç­‰å¾…ç©ºæ§½ä½</span>
        
        {
            <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(bufferMutex)</span></span>;
            buffer.<span class="hljs-built_in">push</span>(i);
            std::cout &lt;&lt; <span class="hljs-string">"ç”Ÿäº§è€… "</span> &lt;&lt; id &lt;&lt; <span class="hljs-string">" ç”Ÿäº§: "</span> &lt;&lt; i &lt;&lt; std::endl;
        }
        
        fullSlots.<span class="hljs-built_in">release</span>();  <span class="hljs-comment">// å¢åŠ æ»¡æ§½ä½</span>
        std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">100</span>));
    }
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">consumer</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> </span>{
    <span class="hljs-keyword">while</span> (!done || !buffer.<span class="hljs-built_in">empty</span>()) {
        fullSlots.<span class="hljs-built_in">acquire</span>();  <span class="hljs-comment">// ç­‰å¾…æ»¡æ§½ä½</span>
        
        <span class="hljs-keyword">if</span> (done &amp;&amp; buffer.<span class="hljs-built_in">empty</span>()) {
            fullSlots.<span class="hljs-built_in">release</span>();
            <span class="hljs-keyword">break</span>;
        }
        
        <span class="hljs-type">int</span> value;
        {
            <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(bufferMutex)</span></span>;
            <span class="hljs-keyword">if</span> (!buffer.<span class="hljs-built_in">empty</span>()) {
                value = buffer.<span class="hljs-built_in">front</span>();
                buffer.<span class="hljs-built_in">pop</span>();
                std::cout &lt;&lt; <span class="hljs-string">"æ¶ˆè´¹è€… "</span> &lt;&lt; id &lt;&lt; <span class="hljs-string">" æ¶ˆè´¹: "</span> &lt;&lt; value &lt;&lt; std::endl;
            }
        }
        
        emptySlots.<span class="hljs-built_in">release</span>();  <span class="hljs-comment">// å¢åŠ ç©ºæ§½ä½</span>
    }
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">const</span> <span class="hljs-type">int</span> numProducers = <span class="hljs-number">3</span>;
    <span class="hljs-type">const</span> <span class="hljs-type">int</span> numConsumers = <span class="hljs-number">2</span>;
    std::vector&lt;std::thread&gt; producers;
    std::vector&lt;std::thread&gt; consumers;
    
    <span class="hljs-comment">// å¯åŠ¨ç”Ÿäº§è€…</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; numProducers; ++i) {
        producers.<span class="hljs-built_in">emplace_back</span>(producer, i);
    }
    
    <span class="hljs-comment">// å¯åŠ¨æ¶ˆè´¹è€…</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; numConsumers; ++i) {
        consumers.<span class="hljs-built_in">emplace_back</span>(consumer, i);
    }
    
    <span class="hljs-comment">// ç­‰å¾…ç”Ÿäº§è€…å®Œæˆ</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; p : producers) {
        p.<span class="hljs-built_in">join</span>();
    }
    
    <span class="hljs-comment">// è®¾ç½®å®Œæˆæ ‡å¿—</span>
    done = <span class="hljs-literal">true</span>;
    
    <span class="hljs-comment">// é‡Šæ”¾æ‰€æœ‰ä¿¡å·é‡ä»¥å”¤é†’ç­‰å¾…çš„æ¶ˆè´¹è€…</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; numConsumers; ++i) {
        fullSlots.<span class="hljs-built_in">release</span>();
    }
    
    <span class="hljs-comment">// ç­‰å¾…æ¶ˆè´¹è€…å®Œæˆ</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; c : consumers) {
        c.<span class="hljs-built_in">join</span>();
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"ç”Ÿäº§æ¶ˆè´¹å®Œæˆ"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-17">ä¸ƒã€æœ€ä½³å®è·µä¸æ€§èƒ½è€ƒè™‘</h2>
<h3 data-id="heading-18">7.1 é¿å…æ­»é”çš„å‡†åˆ™</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>

<span class="hljs-comment">// æ­»é”ç¤ºä¾‹</span>
std::mutex mtx1, mtx2;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deadlockThread1</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock1</span><span class="hljs-params">(mtx1)</span></span>;
    std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">100</span>));
    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock2</span><span class="hljs-params">(mtx2)</span></span>;  <span class="hljs-comment">// å¯èƒ½æ­»é”</span>
    std::cout &lt;&lt; <span class="hljs-string">"çº¿ç¨‹1å®Œæˆ"</span> &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deadlockThread2</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock2</span><span class="hljs-params">(mtx2)</span></span>;
    std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">100</span>));
    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock1</span><span class="hljs-params">(mtx1)</span></span>;  <span class="hljs-comment">// å¯èƒ½æ­»é”</span>
    std::cout &lt;&lt; <span class="hljs-string">"çº¿ç¨‹2å®Œæˆ"</span> &lt;&lt; std::endl;
}

<span class="hljs-comment">// é¿å…æ­»é”çš„æ–¹æ³•1ï¼šæŒ‰å›ºå®šé¡ºåºåŠ é”</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">safeThread1</span><span class="hljs-params">()</span> </span>{
    std::<span class="hljs-built_in">lock</span>(mtx1, mtx2);  <span class="hljs-comment">// åŒæ—¶é”å®šå¤šä¸ªäº’æ–¥é‡</span>
    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock1</span><span class="hljs-params">(mtx1, std::adopt_lock)</span></span>;
    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock2</span><span class="hljs-params">(mtx2, std::adopt_lock)</span></span>;
    std::cout &lt;&lt; <span class="hljs-string">"å®‰å…¨çº¿ç¨‹1å®Œæˆ"</span> &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">safeThread2</span><span class="hljs-params">()</span> </span>{
    std::<span class="hljs-built_in">lock</span>(mtx1, mtx2);  <span class="hljs-comment">// ç›¸åŒçš„é”å®šé¡ºåº</span>
    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock1</span><span class="hljs-params">(mtx1, std::adopt_lock)</span></span>;
    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock2</span><span class="hljs-params">(mtx2, std::adopt_lock)</span></span>;
    std::cout &lt;&lt; <span class="hljs-string">"å®‰å…¨çº¿ç¨‹2å®Œæˆ"</span> &lt;&lt; std::endl;
}

<span class="hljs-comment">// é¿å…æ­»é”çš„æ–¹æ³•2ï¼šä½¿ç”¨std::scoped_lockï¼ˆC++17ï¼‰</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">scopedLockExample</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::scoped_lock <span class="hljs-title">lock</span><span class="hljs-params">(mtx1, mtx2)</span></span>;  <span class="hljs-comment">// è‡ªåŠ¨ç®¡ç†å¤šä¸ªé”</span>
    std::cout &lt;&lt; <span class="hljs-string">"ä½¿ç”¨scoped_lockå®‰å…¨åŠ é”"</span> &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// å¯èƒ½äº§ç”Ÿæ­»é”</span>
    <span class="hljs-comment">// std::thread t1(deadlockThread1);</span>
    <span class="hljs-comment">// std::thread t2(deadlockThread2);</span>
    <span class="hljs-comment">// t1.join();</span>
    <span class="hljs-comment">// t2.join();</span>
    
    <span class="hljs-comment">// å®‰å…¨ç‰ˆæœ¬</span>
    <span class="hljs-function">std::thread <span class="hljs-title">t3</span><span class="hljs-params">(safeThread1)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t4</span><span class="hljs-params">(safeThread2)</span></span>;
    t3.<span class="hljs-built_in">join</span>();
    t4.<span class="hljs-built_in">join</span>();
    
    <span class="hljs-comment">// C++17 scoped_lock</span>
    <span class="hljs-function">std::thread <span class="hljs-title">t5</span><span class="hljs-params">(scopedLockExample)</span></span>;
    t5.<span class="hljs-built_in">join</span>();
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-19">7.2 æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;atomic&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;chrono&gt;</span></span>

<span class="hljs-comment">// ä¼ªå…±äº«é—®é¢˜ç¤ºä¾‹</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">BadAlignment</span> {
    <span class="hljs-type">int</span> a;  <span class="hljs-comment">// å¯èƒ½å’Œbåœ¨åŒä¸€ä¸ªç¼“å­˜è¡Œ</span>
    <span class="hljs-type">int</span> b;
};

<span class="hljs-comment">// è§£å†³ä¼ªå…±äº«</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">alignas</span>(<span class="hljs-number">64</span>) GoodAlignment {  <span class="hljs-comment">// 64å­—èŠ‚å¯¹é½ï¼Œé€šå¸¸æ˜¯ç¼“å­˜è¡Œå¤§å°</span>
    <span class="hljs-type">int</span> a;  <span class="hljs-comment">// ç‹¬å ä¸€ä¸ªç¼“å­˜è¡Œ</span>
};
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">alignas</span>(<span class="hljs-number">64</span>) GoodAlignment2 {
    <span class="hljs-type">int</span> b;  <span class="hljs-comment">// ç‹¬å å¦ä¸€ä¸ªç¼“å­˜è¡Œ</span>
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">falseSharingTest</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">const</span> <span class="hljs-type">int</span> iterations = <span class="hljs-number">100000000</span>;
    
    <span class="hljs-comment">// ä¼ªå…±äº«æƒ…å†µ</span>
    BadAlignment bad;
    <span class="hljs-keyword">auto</span> start = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();
    
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">([&amp;bad, iterations] {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; iterations; ++i) {
            bad.a++;
        }
    })</span></span>;
    
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">([&amp;bad, iterations] {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; iterations; ++i) {
            bad.b++;
        }
    })</span></span>;
    
    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();
    
    <span class="hljs-keyword">auto</span> end = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();
    <span class="hljs-keyword">auto</span> duration = std::chrono::<span class="hljs-built_in">duration_cast</span>&lt;std::chrono::milliseconds&gt;(end - start);
    std::cout &lt;&lt; <span class="hljs-string">"ä¼ªå…±äº«è€—æ—¶: "</span> &lt;&lt; duration.<span class="hljs-built_in">count</span>() &lt;&lt; <span class="hljs-string">"ms"</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// é¿å…ä¼ªå…±äº«</span>
    GoodAlignment good1;
    GoodAlignment2 good2;
    start = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();
    
    <span class="hljs-function">std::thread <span class="hljs-title">t3</span><span class="hljs-params">([&amp;good1, iterations] {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; iterations; ++i) {
            good1.a++;
        }
    })</span></span>;
    
    <span class="hljs-function">std::thread <span class="hljs-title">t4</span><span class="hljs-params">([&amp;good2, iterations] {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; iterations; ++i) {
            good2.b++;
        }
    })</span></span>;
    
    t3.<span class="hljs-built_in">join</span>();
    t4.<span class="hljs-built_in">join</span>();
    
    end = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();
    duration = std::chrono::<span class="hljs-built_in">duration_cast</span>&lt;std::chrono::milliseconds&gt;(end - start);
    std::cout &lt;&lt; <span class="hljs-string">"é¿å…ä¼ªå…±äº«è€—æ—¶: "</span> &lt;&lt; duration.<span class="hljs-built_in">count</span>() &lt;&lt; <span class="hljs-string">"ms"</span> &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">falseSharingTest</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-20">å…«ã€è°ƒè¯•ä¸æµ‹è¯•</h2>
<h3 data-id="heading-21">8.1 çº¿ç¨‹å®‰å…¨çš„å•å…ƒæµ‹è¯•</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cassert&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;future&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafeCounter</span> {
<span class="hljs-keyword">private</span>:
    std::mutex mtx;
    <span class="hljs-type">int</span> count;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ThreadSafeCounter</span>() : <span class="hljs-built_in">count</span>(<span class="hljs-number">0</span>) {}
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>;
        ++count;
    }
    
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">get</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>;
        <span class="hljs-keyword">return</span> count;
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">testThreadSafety</span><span class="hljs-params">()</span> </span>{
    ThreadSafeCounter counter;
    <span class="hljs-type">const</span> <span class="hljs-type">int</span> numThreads = <span class="hljs-number">10</span>;
    <span class="hljs-type">const</span> <span class="hljs-type">int</span> incrementsPerThread = <span class="hljs-number">1000</span>;
    
    std::vector&lt;std::future&lt;<span class="hljs-type">void</span>&gt;&gt; futures;
    
    <span class="hljs-comment">// å¯åŠ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶å¢åŠ è®¡æ•°å™¨</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; numThreads; ++i) {
        futures.<span class="hljs-built_in">emplace_back</span>(std::<span class="hljs-built_in">async</span>(std::launch::async, 
            [&amp;counter, incrementsPerThread] {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; incrementsPerThread; ++j) {
                    counter.<span class="hljs-built_in">increment</span>();
                }
            }
        ));
    }
    
    <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; future : futures) {
        future.<span class="hljs-built_in">wait</span>();
    }
    
    <span class="hljs-comment">// éªŒè¯ç»“æœ</span>
    <span class="hljs-type">int</span> expected = numThreads * incrementsPerThread;
    <span class="hljs-type">int</span> actual = counter.<span class="hljs-built_in">get</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"æœŸæœ›å€¼: "</span> &lt;&lt; expected &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"å®é™…å€¼: "</span> &lt;&lt; actual &lt;&lt; std::endl;
    
    <span class="hljs-built_in">assert</span>(actual == expected);
    std::cout &lt;&lt; <span class="hljs-string">"æµ‹è¯•é€šè¿‡ï¼"</span> &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">try</span> {
        <span class="hljs-built_in">testThreadSafety</span>();
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::exception&amp; e) {
        std::cerr &lt;&lt; <span class="hljs-string">"æµ‹è¯•å¤±è´¥: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; std::endl;
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 data-id="heading-22">ä¹ã€æ€»ç»“ä¸è¿›é˜¶å­¦ä¹ </h2>
<h3 data-id="heading-23">9.1 å…³é”®ç‚¹æ€»ç»“</h3>
<ol>
<li><strong>çº¿ç¨‹åˆ›å»ºä¸ç®¡ç†</strong>ï¼šä½¿ç”¨<code>std::thread</code>åˆ›å»ºçº¿ç¨‹ï¼Œç†è§£joinå’Œdetachçš„åŒºåˆ«</li>
<li><strong>æ•°æ®åŒæ­¥</strong>ï¼šæŒæ¡äº’æ–¥é”ã€æ¡ä»¶å˜é‡ã€åŸå­æ“ä½œçš„ä½¿ç”¨åœºæ™¯</li>
<li><strong>é¿å…å¸¸è§é—®é¢˜</strong>ï¼šè¯†åˆ«å’Œé¿å…æ­»é”ã€ç«æ€æ¡ä»¶ã€ä¼ªå…±äº«</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šåˆç†é€‰æ‹©åŒæ­¥æœºåˆ¶ï¼Œå‡å°‘é”ç«äº‰</li>
<li><strong>ç°ä»£C++ç‰¹æ€§</strong>ï¼šåˆ©ç”¨C++14/17/20çš„æ–°ç‰¹æ€§ç®€åŒ–å¤šçº¿ç¨‹ç¼–ç¨‹</li>
</ol>
<h3 data-id="heading-24">9.2 è¿›é˜¶å­¦ä¹ æ–¹å‘</h3>
<ol>
<li><strong>å¹¶è¡Œç®—æ³•</strong>ï¼šC++17çš„å¹¶è¡ŒSTLç®—æ³•</li>
<li><strong>GPUç¼–ç¨‹</strong>ï¼šCUDAã€OpenCLã€SYCL</li>
<li><strong>åˆ†å¸ƒå¼è®¡ç®—</strong>ï¼šMPIã€gRPCã€ZeroMQ</li>
<li><strong>å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹</strong>ï¼šPromise/Futureã€ååº”å¼ç¼–ç¨‹</li>
<li><strong>å¹¶å‘æ•°æ®ç»“æ„</strong>ï¼šæ— é”é˜Ÿåˆ—ã€å¹¶å‘å“ˆå¸Œè¡¨</li>
</ol>
<h3 data-id="heading-25">9.3 æ¨èå·¥å…·</h3>
<ol>
<li><strong>è°ƒè¯•å·¥å…·</strong>ï¼šThreadSanitizerã€Helgrindã€Intel Inspector</li>
<li><strong>æ€§èƒ½åˆ†æ</strong>ï¼šPerfã€VTuneã€AMD uProf</li>
<li><strong>å¯è§†åŒ–</strong>ï¼šChrome Tracingã€Vampir</li>
</ol>
<p>å¤šçº¿ç¨‹ç¼–ç¨‹æ˜¯C++é«˜çº§å¼€å‘çš„æ ¸å¿ƒæŠ€èƒ½ä¹‹ä¸€ã€‚ä»åŸºç¡€åŒæ­¥æœºåˆ¶åˆ°é«˜çº§å¹¶å‘æ¨¡å¼ï¼Œéœ€è¦ä¸æ–­å®è·µå’Œç§¯ç´¯ç»éªŒã€‚è®°ä½ï¼š<strong>è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æº</strong>ï¼Œåœ¨ç¡®ä¿æ­£ç¡®æ€§çš„å‰æä¸‹è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œä½¿ç”¨å·¥å…·éªŒè¯çº¿ç¨‹å®‰å…¨æ€§ï¼Œç¼–å†™å¯ç»´æŠ¤çš„å¹¶å‘ä»£ç ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android launcher3å®ç°ç®€å•çš„è´Ÿä¸€å±åŠŸèƒ½]]></title>    <link>https://juejin.cn/post/7583878719544377353</link>    <guid>https://juejin.cn/post/7583878719544377353</guid>    <pubDate>2025-12-15T15:02:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583878719544377353" data-draft-id="7583913535271288842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android launcher3å®ç°ç®€å•çš„è´Ÿä¸€å±åŠŸèƒ½"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-15T15:02:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Androidå°æ¸£æ¸£"/> <meta itemprop="url" content="https://juejin.cn/user/2119514151720222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android launcher3å®ç°ç®€å•çš„è´Ÿä¸€å±åŠŸèƒ½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2119514151720222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Androidå°æ¸£æ¸£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T15:02:45.000Z" title="Mon Dec 15 2025 15:02:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Android launcher3å®ç°ç®€å•çš„è´Ÿä¸€å±åŠŸèƒ½</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8559939663654bdcae48140bba247bef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOWwj-a4o-a4ow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766415764&amp;x-signature=u1P8%2FrGUbnaC%2FoGLjXkv6s0TYyU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">1.å‰è¨€ï¼š</h2>
<p>ä¹‹å‰å®ç°è¿‡Android12Launcher3ä»æŠ½å±‰ä¿®æ”¹æˆå•å±‚å’ŒLauncher3æ˜¾ç¤ºæ‰€æœ‰åº”ç”¨åˆ—è¡¨ï¼Œä»Šå¤©æ¥è®²è§£ä¸€ä¸‹å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„è´Ÿä¸€å±åŠŸèƒ½ï¼Œç›´æ¥çœ‹ä»£ç ã€‚</p>
<h2 data-id="heading-2">2.NegativeScreenAdapterï¼š</h2>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> com.example.negativescreendemo.adapter;
â€‹
<span class="hljs-keyword">import</span> android.content.<span class="hljs-type">Context</span>;
<span class="hljs-keyword">import</span> android.view.<span class="hljs-type">LayoutInflater</span>;
<span class="hljs-keyword">import</span> android.view.<span class="hljs-type">View</span>;
<span class="hljs-keyword">import</span> android.view.<span class="hljs-type">ViewGroup</span>;
<span class="hljs-keyword">import</span> android.widget.<span class="hljs-type">CheckBox</span>;
<span class="hljs-keyword">import</span> android.widget.<span class="hljs-type">ImageView</span>;
<span class="hljs-keyword">import</span> android.widget.<span class="hljs-type">TextView</span>;
â€‹
<span class="hljs-keyword">import</span> androidx.annotation.<span class="hljs-type">NonNull</span>;
<span class="hljs-keyword">import</span> androidx.recyclerview.widget.<span class="hljs-type">GridLayoutManager</span>;
<span class="hljs-keyword">import</span> androidx.recyclerview.widget.<span class="hljs-type">RecyclerView</span>;
â€‹
<span class="hljs-keyword">import</span> com.example.negativescreendemo.<span class="hljs-type">ActionItem</span>;
<span class="hljs-keyword">import</span> com.example.negativescreendemo.<span class="hljs-type">CardItem</span>;
<span class="hljs-keyword">import</span> com.example.negativescreendemo.<span class="hljs-type">NewsItem</span>;
<span class="hljs-keyword">import</span> com.example.negativescreendemo.<span class="hljs-type">R</span>;
<span class="hljs-keyword">import</span> com.example.negativescreendemo.<span class="hljs-type">ScheduleItem</span>;
<span class="hljs-keyword">import</span> com.example.negativescreendemo.<span class="hljs-type">TodoItem</span>;
â€‹
<span class="hljs-keyword">import</span> java.util.<span class="hljs-type">List</span>;
â€‹
<span class="hljs-comment">/**
 * @author: njb
 * @date: 2025/8/20 21:19
 * @desc: æè¿°
 */</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NegativeScreenAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">Adapter&lt;RecyclerView</span>.<span class="hljs-title">ViewHolder&gt;</span></span>{
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">Context</span> context;
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">CardItem</span>&gt; cardItems;
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">OnItemClickListener</span> listener;
â€‹
 Â  Â <span class="hljs-comment">// å¡ç‰‡ç±»å‹</span>
 Â  Â public <span class="hljs-keyword">enum</span> <span class="hljs-type">CardType</span> {
 Â  Â  Â  Â <span class="hljs-type">ACTIONS</span>, <span class="hljs-type">SCHEDULE</span>, <span class="hljs-type">NEWS</span>, <span class="hljs-type">TODO</span>
 Â   }
â€‹
 Â  Â public <span class="hljs-type">NegativeScreenAdapter</span>(<span class="hljs-type">Context</span> context, <span class="hljs-type">List</span>&lt;<span class="hljs-type">CardItem</span>&gt; cardItems) {
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.context = context;
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.cardItems = cardItems;
 Â   }
â€‹
 Â  Â <span class="hljs-meta">@NonNull</span>
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â public <span class="hljs-type">RecyclerView</span>.<span class="hljs-type">ViewHolder</span> onCreateViewHolder(<span class="hljs-meta">@NonNull</span> <span class="hljs-type">ViewGroup</span> parent, int viewType) {
 Â  Â  Â  Â <span class="hljs-type">LayoutInflater</span> inflater = <span class="hljs-type">LayoutInflater</span>.from(context);
â€‹
 Â  Â  Â  Â switch (viewType) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-comment">// å¿«æ·åŠŸèƒ½å¡ç‰‡</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-type">View</span> actionView = inflater.inflate(<span class="hljs-type">R</span>.layout.item_action_card, parent, <span class="hljs-literal">false</span>);
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">ActionCardViewHolder</span>(actionView);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-comment">// æ—¥ç¨‹å¡ç‰‡</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-type">View</span> scheduleView = inflater.inflate(<span class="hljs-type">R</span>.layout.item_schedule_card, parent, <span class="hljs-literal">false</span>);
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">ScheduleCardViewHolder</span>(scheduleView);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-comment">// æ–°é—»å¡ç‰‡</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-type">View</span> newsView = inflater.inflate(<span class="hljs-type">R</span>.layout.item_news_card, parent, <span class="hljs-literal">false</span>);
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">NewsCardViewHolder</span>(newsView);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-comment">// å¾…åŠäº‹é¡¹å¡ç‰‡</span>
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-type">View</span> todoView = inflater.inflate(<span class="hljs-type">R</span>.layout.item_todo_card, parent, <span class="hljs-literal">false</span>);
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">TodoCardViewHolder</span>(todoView);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">default</span>:
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â public void onBindViewHolder(<span class="hljs-meta">@NonNull</span> <span class="hljs-type">RecyclerView</span>.<span class="hljs-type">ViewHolder</span> holder, int position) {
 Â  Â  Â  Â <span class="hljs-type">CardItem</span> item = cardItems.get(position);
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (holder instanceof <span class="hljs-type">ActionCardViewHolder</span>) {
 Â  Â  Â  Â  Â   ((<span class="hljs-type">ActionCardViewHolder</span>) holder).title.setText(item.getTitle());
 Â  Â  Â  Â  Â  Â <span class="hljs-type">ActionAdapter</span> actionAdapter = <span class="hljs-keyword">new</span> <span class="hljs-type">ActionAdapter</span>(context, item.getActionItems());
 Â  Â  Â  Â  Â   ((<span class="hljs-type">ActionCardViewHolder</span>) holder).recyclerView.setAdapter(actionAdapter);
 Â  Â  Â  Â  Â   ((<span class="hljs-type">ActionCardViewHolder</span>) holder).recyclerView.setLayoutManager(
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">new</span> <span class="hljs-type">GridLayoutManager</span>(context, <span class="hljs-number">3</span>));
 Â  Â  Â   }
 Â  Â  Â  Â <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (holder instanceof <span class="hljs-type">ScheduleCardViewHolder</span>) {
 Â  Â  Â  Â  Â   ((<span class="hljs-type">ScheduleCardViewHolder</span>) holder).title.setText(item.getTitle());
 Â  Â  Â  Â  Â  Â <span class="hljs-type">ScheduleAdapter</span> scheduleAdapter = <span class="hljs-keyword">new</span> <span class="hljs-type">ScheduleAdapter</span>(context, item.getScheduleItems());
 Â  Â  Â  Â  Â   ((<span class="hljs-type">ScheduleCardViewHolder</span>) holder).recyclerView.setAdapter(scheduleAdapter);
 Â  Â  Â   }
 Â  Â  Â  Â <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (holder instanceof <span class="hljs-type">NewsCardViewHolder</span>) {
 Â  Â  Â  Â  Â   ((<span class="hljs-type">NewsCardViewHolder</span>) holder).title.setText(item.getTitle());
 Â  Â  Â  Â  Â  Â <span class="hljs-type">NewsAdapter</span> newsAdapter = <span class="hljs-keyword">new</span> <span class="hljs-type">NewsAdapter</span>(context, item.getNewsItems());
 Â  Â  Â  Â  Â   ((<span class="hljs-type">NewsCardViewHolder</span>) holder).recyclerView.setAdapter(newsAdapter);
 Â  Â  Â   }
 Â  Â  Â  Â <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (holder instanceof <span class="hljs-type">TodoCardViewHolder</span>) {
 Â  Â  Â  Â  Â   ((<span class="hljs-type">TodoCardViewHolder</span>) holder).title.setText(item.getTitle());
 Â  Â  Â  Â  Â  Â <span class="hljs-type">TodoAdapter</span> todoAdapter = <span class="hljs-keyword">new</span> <span class="hljs-type">TodoAdapter</span>(context, item.getTodoItems());
 Â  Â  Â  Â  Â   ((<span class="hljs-type">TodoCardViewHolder</span>) holder).recyclerView.setAdapter(todoAdapter);
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// è®¾ç½®ç‚¹å‡»äº‹ä»¶</span>
 Â  Â  Â  Â holder.itemView.setOnClickListener(v -&gt; {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â  Â  Â listener.onItemClick(position);
 Â  Â  Â  Â  Â   }
 Â  Â  Â   });
 Â   }
â€‹
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â public int getItemCount() {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> cardItems.size();
 Â   }
â€‹
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â public int getItemViewType(int position) {
 Â  Â  Â  Â <span class="hljs-type">CardType</span> <span class="hljs-class"><span class="hljs-keyword">type</span> </span>= cardItems.get(position).getType();
 Â  Â  Â  Â switch (<span class="hljs-class"><span class="hljs-keyword">type</span>) </span>{
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> <span class="hljs-type">ACTIONS</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> <span class="hljs-type">SCHEDULE</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> <span class="hljs-type">NEWS</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">case</span> <span class="hljs-type">TODO</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// å¿«æ·åŠŸèƒ½å¡ç‰‡ViewHolder</span>
 Â  Â public static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActionCardViewHolder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">ViewHolder</span> </span>{
 Â  Â  Â  Â <span class="hljs-type">TextView</span> title;
 Â  Â  Â  Â <span class="hljs-type">RecyclerView</span> recyclerView;
â€‹
 Â  Â  Â  Â public <span class="hljs-type">ActionCardViewHolder</span>(<span class="hljs-type">View</span> itemView) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">super</span>(itemView);
 Â  Â  Â  Â  Â  Â title = itemView.findViewById(<span class="hljs-type">R</span>.id.card_title);
 Â  Â  Â  Â  Â  Â recyclerView = itemView.findViewById(<span class="hljs-type">R</span>.id.action_recycler);
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// æ—¥ç¨‹å¡ç‰‡ViewHolder</span>
 Â  Â public static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ScheduleCardViewHolder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">ViewHolder</span> </span>{
 Â  Â  Â  Â <span class="hljs-type">TextView</span> title;
 Â  Â  Â  Â <span class="hljs-type">RecyclerView</span> recyclerView;
â€‹
 Â  Â  Â  Â public <span class="hljs-type">ScheduleCardViewHolder</span>(<span class="hljs-type">View</span> itemView) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">super</span>(itemView);
 Â  Â  Â  Â  Â  Â title = itemView.findViewById(<span class="hljs-type">R</span>.id.card_title);
 Â  Â  Â  Â  Â  Â recyclerView = itemView.findViewById(<span class="hljs-type">R</span>.id.schedule_recycler);
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// æ–°é—»å¡ç‰‡ViewHolder</span>
 Â  Â public static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NewsCardViewHolder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">ViewHolder</span> </span>{
 Â  Â  Â  Â <span class="hljs-type">TextView</span> title;
 Â  Â  Â  Â <span class="hljs-type">RecyclerView</span> recyclerView;
â€‹
 Â  Â  Â  Â public <span class="hljs-type">NewsCardViewHolder</span>(<span class="hljs-type">View</span> itemView) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">super</span>(itemView);
 Â  Â  Â  Â  Â  Â title = itemView.findViewById(<span class="hljs-type">R</span>.id.card_title);
 Â  Â  Â  Â  Â  Â recyclerView = itemView.findViewById(<span class="hljs-type">R</span>.id.news_recycler);
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// å¾…åŠäº‹é¡¹å¡ç‰‡ViewHolder</span>
 Â  Â public static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TodoCardViewHolder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">ViewHolder</span> </span>{
 Â  Â  Â  Â <span class="hljs-type">TextView</span> title;
 Â  Â  Â  Â <span class="hljs-type">RecyclerView</span> recyclerView;
â€‹
 Â  Â  Â  Â public <span class="hljs-type">TodoCardViewHolder</span>(<span class="hljs-type">View</span> itemView) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">super</span>(itemView);
 Â  Â  Â  Â  Â  Â title = itemView.findViewById(<span class="hljs-type">R</span>.id.card_title);
 Â  Â  Â  Â  Â  Â recyclerView = itemView.findViewById(<span class="hljs-type">R</span>.id.todo_recycler);
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// å¿«æ·åŠŸèƒ½å­é¡¹é€‚é…å™¨</span>
 Â  Â public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActionAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">Adapter&lt;ActionAdapter</span>.<span class="hljs-title">ViewHolder&gt;</span> </span>{
 Â  Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">Context</span> context;
 Â  Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">ActionItem</span>&gt; items;
â€‹
 Â  Â  Â  Â public <span class="hljs-type">ActionAdapter</span>(<span class="hljs-type">Context</span> context, <span class="hljs-type">List</span>&lt;<span class="hljs-type">ActionItem</span>&gt; items) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.context = context;
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.items = items;
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-meta">@NonNull</span>
 Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â public <span class="hljs-type">ViewHolder</span> onCreateViewHolder(<span class="hljs-meta">@NonNull</span> <span class="hljs-type">ViewGroup</span> parent, int viewType) {
 Â  Â  Â  Â  Â  Â <span class="hljs-type">View</span> view = <span class="hljs-type">LayoutInflater</span>.from(context)
 Â  Â  Â  Â  Â  Â  Â  Â  Â   .inflate(<span class="hljs-type">R</span>.layout.item_action, parent, <span class="hljs-literal">false</span>);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">ViewHolder</span>(view);
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â public void onBindViewHolder(<span class="hljs-meta">@NonNull</span> <span class="hljs-type">ViewHolder</span> holder, int position) {
 Â  Â  Â  Â  Â  Â <span class="hljs-type">ActionItem</span> item = items.get(position);
 Â  Â  Â  Â  Â  Â holder.icon.setImageResource(item.getIconRes());
 Â  Â  Â  Â  Â  Â holder.name.setText(item.getName());
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â public int getItemCount() {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> items.size();
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewHolder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">ViewHolder</span> </span>{
 Â  Â  Â  Â  Â  Â <span class="hljs-type">ImageView</span> icon;
 Â  Â  Â  Â  Â  Â <span class="hljs-type">TextView</span> name;
â€‹
 Â  Â  Â  Â  Â  Â public <span class="hljs-type">ViewHolder</span>(<span class="hljs-type">View</span> itemView) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">super</span>(itemView);
 Â  Â  Â  Â  Â  Â  Â  Â icon = itemView.findViewById(<span class="hljs-type">R</span>.id.action_icon);
 Â  Â  Â  Â  Â  Â  Â  Â name = itemView.findViewById(<span class="hljs-type">R</span>.id.action_name);
 Â  Â  Â  Â  Â   }
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// æ—¥ç¨‹å­é¡¹é€‚é…å™¨</span>
 Â  Â public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ScheduleAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">Adapter&lt;ScheduleAdapter</span>.<span class="hljs-title">ViewHolder&gt;</span> </span>{
 Â  Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">Context</span> context;
 Â  Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">ScheduleItem</span>&gt; items;
â€‹
 Â  Â  Â  Â public <span class="hljs-type">ScheduleAdapter</span>(<span class="hljs-type">Context</span> context, <span class="hljs-type">List</span>&lt;<span class="hljs-type">ScheduleItem</span>&gt; items) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.context = context;
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.items = items;
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-meta">@NonNull</span>
 Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â public <span class="hljs-type">ViewHolder</span> onCreateViewHolder(<span class="hljs-meta">@NonNull</span> <span class="hljs-type">ViewGroup</span> parent, int viewType) {
 Â  Â  Â  Â  Â  Â <span class="hljs-type">View</span> view = <span class="hljs-type">LayoutInflater</span>.from(context)
 Â  Â  Â  Â  Â  Â  Â  Â  Â   .inflate(<span class="hljs-type">R</span>.layout.item_schedule, parent, <span class="hljs-literal">false</span>);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">ViewHolder</span>(view);
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â public void onBindViewHolder(<span class="hljs-meta">@NonNull</span> <span class="hljs-type">ViewHolder</span> holder, int position) {
 Â  Â  Â  Â  Â  Â <span class="hljs-type">ScheduleItem</span> item = items.get(position);
 Â  Â  Â  Â  Â  Â holder.time.setText(item.getTime());
 Â  Â  Â  Â  Â  Â holder.title.setText(item.getTitle());
 Â  Â  Â  Â  Â  Â holder.location.setText(item.getLocation());
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â public int getItemCount() {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> items.size();
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewHolder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">ViewHolder</span> </span>{
 Â  Â  Â  Â  Â  Â <span class="hljs-type">TextView</span> time, title, location;
â€‹
 Â  Â  Â  Â  Â  Â public <span class="hljs-type">ViewHolder</span>(<span class="hljs-type">View</span> itemView) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">super</span>(itemView);
 Â  Â  Â  Â  Â  Â  Â  Â time = itemView.findViewById(<span class="hljs-type">R</span>.id.schedule_time);
 Â  Â  Â  Â  Â  Â  Â  Â title = itemView.findViewById(<span class="hljs-type">R</span>.id.schedule_title);
 Â  Â  Â  Â  Â  Â  Â  Â location = itemView.findViewById(<span class="hljs-type">R</span>.id.schedule_location);
 Â  Â  Â  Â  Â   }
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// æ–°é—»å­é¡¹é€‚é…å™¨</span>
 Â  Â public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NewsAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">Adapter&lt;NewsAdapter</span>.<span class="hljs-title">ViewHolder&gt;</span> </span>{
 Â  Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">Context</span> context;
 Â  Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">NewsItem</span>&gt; items;
â€‹
 Â  Â  Â  Â public <span class="hljs-type">NewsAdapter</span>(<span class="hljs-type">Context</span> context, <span class="hljs-type">List</span>&lt;<span class="hljs-type">NewsItem</span>&gt; items) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.context = context;
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.items = items;
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-meta">@NonNull</span>
 Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â public <span class="hljs-type">ViewHolder</span> onCreateViewHolder(<span class="hljs-meta">@NonNull</span> <span class="hljs-type">ViewGroup</span> parent, int viewType) {
 Â  Â  Â  Â  Â  Â <span class="hljs-type">View</span> view = <span class="hljs-type">LayoutInflater</span>.from(context)
 Â  Â  Â  Â  Â  Â  Â  Â  Â   .inflate(<span class="hljs-type">R</span>.layout.item_news, parent, <span class="hljs-literal">false</span>);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">ViewHolder</span>(view);
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â public void onBindViewHolder(<span class="hljs-meta">@NonNull</span> <span class="hljs-type">ViewHolder</span> holder, int position) {
 Â  Â  Â  Â  Â  Â <span class="hljs-type">NewsItem</span> item = items.get(position);
 Â  Â  Â  Â  Â  Â holder.title.setText(item.getTitle());
 Â  Â  Â  Â  Â  Â holder.source.setText(item.getSource());
 Â  Â  Â  Â  Â  Â holder.time.setText(item.getTime());
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â public int getItemCount() {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> items.size();
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewHolder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">ViewHolder</span> </span>{
 Â  Â  Â  Â  Â  Â <span class="hljs-type">TextView</span> title, source, time;
â€‹
 Â  Â  Â  Â  Â  Â public <span class="hljs-type">ViewHolder</span>(<span class="hljs-type">View</span> itemView) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">super</span>(itemView);
 Â  Â  Â  Â  Â  Â  Â  Â title = itemView.findViewById(<span class="hljs-type">R</span>.id.news_title);
 Â  Â  Â  Â  Â  Â  Â  Â source = itemView.findViewById(<span class="hljs-type">R</span>.id.news_source);
 Â  Â  Â  Â  Â  Â  Â  Â time = itemView.findViewById(<span class="hljs-type">R</span>.id.news_time);
 Â  Â  Â  Â  Â   }
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// å¾…åŠäº‹é¡¹å­é¡¹é€‚é…å™¨</span>
 Â  Â public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TodoAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">Adapter&lt;TodoAdapter</span>.<span class="hljs-title">ViewHolder&gt;</span> </span>{
 Â  Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">Context</span> context;
 Â  Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">TodoItem</span>&gt; items;
â€‹
 Â  Â  Â  Â public <span class="hljs-type">TodoAdapter</span>(<span class="hljs-type">Context</span> context, <span class="hljs-type">List</span>&lt;<span class="hljs-type">TodoItem</span>&gt; items) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.context = context;
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">this</span>.items = items;
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-meta">@NonNull</span>
 Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â public <span class="hljs-type">ViewHolder</span> onCreateViewHolder(<span class="hljs-meta">@NonNull</span> <span class="hljs-type">ViewGroup</span> parent, int viewType) {
 Â  Â  Â  Â  Â  Â <span class="hljs-type">View</span> view = <span class="hljs-type">LayoutInflater</span>.from(context)
 Â  Â  Â  Â  Â  Â  Â  Â  Â   .inflate(<span class="hljs-type">R</span>.layout.item_todo, parent, <span class="hljs-literal">false</span>);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">ViewHolder</span>(view);
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â public void onBindViewHolder(<span class="hljs-meta">@NonNull</span> <span class="hljs-type">ViewHolder</span> holder, int position) {
 Â  Â  Â  Â  Â  Â <span class="hljs-type">TodoItem</span> item = items.get(position);
 Â  Â  Â  Â  Â  Â holder.content.setText(item.getContent());
 Â  Â  Â  Â  Â  Â holder.checkBox.setChecked(item.isCompleted());
â€‹
 Â  Â  Â  Â  Â  Â holder.checkBox.setOnCheckedChangeListener((buttonView, isChecked) -&gt;
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â item.setCompleted(isChecked));
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â public int getItemCount() {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> items.size();
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewHolder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">ViewHolder</span> </span>{
 Â  Â  Â  Â  Â  Â <span class="hljs-type">CheckBox</span> checkBox;
 Â  Â  Â  Â  Â  Â <span class="hljs-type">TextView</span> content;
â€‹
 Â  Â  Â  Â  Â  Â public <span class="hljs-type">ViewHolder</span>(<span class="hljs-type">View</span> itemView) {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">super</span>(itemView);
 Â  Â  Â  Â  Â  Â  Â  Â checkBox = itemView.findViewById(<span class="hljs-type">R</span>.id.todo_checkbox);
 Â  Â  Â  Â  Â  Â  Â  Â content = itemView.findViewById(<span class="hljs-type">R</span>.id.todo_content);
 Â  Â  Â  Â  Â   }
 Â  Â  Â   }
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ç‚¹å‡»äº‹ä»¶æ¥å£</span>
 Â  Â public interface <span class="hljs-type">OnItemClickListener</span> {
 Â  Â  Â  Â void onItemClick(int position);
 Â   }
â€‹
 Â  Â public void setOnItemClickListener(<span class="hljs-type">OnItemClickListener</span> listener) {
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.listener = listener;
 Â   }
}
</code></pre>
<h2 data-id="heading-3">3.ActionItem:</h2>
<pre><code class="hljs language-arduino" lang="arduino">package com.example.negativescreendemo;
â€‹
<span class="hljs-comment">/**
 * @author: njb
 * @date: 2025/8/20 21:28
 * @desc: æè¿°
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ActionItem</span> {
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> name;
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> iconRes;
â€‹
 Â  Â <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ActionItem</span><span class="hljs-params">(<span class="hljs-type">String</span> name, <span class="hljs-type">int</span> iconRes)</span> </span>{
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.name = name;
 Â  Â  Â  Â <span class="hljs-keyword">this</span>.iconRes = iconRes;
 Â   }
â€‹
 Â  Â <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>{
 Â  Â  Â  Â <span class="hljs-keyword">return</span> name;
 Â   }
â€‹
 Â  Â <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title">getIconRes</span><span class="hljs-params">()</span> </span>{
 Â  Â  Â  Â <span class="hljs-keyword">return</span> iconRes;
 Â   }
}
</code></pre>
<h2 data-id="heading-4">4.å¡ç‰‡CardItemï¼š</h2>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">negativescreendemo</span>;
â€‹
<span class="hljs-keyword">import</span> com.<span class="hljs-property">example</span>.<span class="hljs-property">negativescreendemo</span>.<span class="hljs-property">adapter</span>.<span class="hljs-property">NegativeScreenAdapter</span>;
â€‹
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">List</span>;
â€‹
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span>: njb
 * <span class="hljs-doctag">@date</span>: 2025/8/20 21:21
 * <span class="hljs-doctag">@desc</span>: æè¿°
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CardItem</span> {
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">NegativeScreenAdapter</span>.<span class="hljs-property">CardType</span> <span class="hljs-keyword">type</span>;
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> title;
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ActionItem</span>&gt; actionItems;
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ScheduleItem</span>&gt; scheduleItems;
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">NewsItem</span>&gt; newsItems;
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">TodoItem</span>&gt; todoItems;
â€‹
 Â  Â <span class="hljs-comment">// ç§æœ‰æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢ç›´æ¥å®ä¾‹åŒ–</span>
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">CardItem</span>() {}
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * åˆ›å»ºå¿«æ·æ“ä½œå¡ç‰‡
 Â  Â  */</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">CardItem</span> <span class="hljs-title function_">createActionCard</span>(<span class="hljs-params">NegativeScreenAdapter.CardType <span class="hljs-keyword">type</span>, <span class="hljs-built_in">String</span> title, List&lt;ActionItem&gt; actionItems</span>) {
 Â  Â  Â  Â <span class="hljs-title class_">CardItem</span> item = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CardItem</span>();
 Â  Â  Â  Â item.<span class="hljs-property">type</span> = <span class="hljs-keyword">type</span>;
 Â  Â  Â  Â item.<span class="hljs-property">title</span> = title;
 Â  Â  Â  Â item.<span class="hljs-property">actionItems</span> = actionItems;
 Â  Â  Â  Â <span class="hljs-keyword">return</span> item;
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * åˆ›å»ºæ—¥ç¨‹å¡ç‰‡
 Â  Â  */</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">CardItem</span> <span class="hljs-title function_">createScheduleCard</span>(<span class="hljs-params">NegativeScreenAdapter.CardType <span class="hljs-keyword">type</span>, <span class="hljs-built_in">String</span> title, List&lt;ScheduleItem&gt; scheduleItems</span>) {
 Â  Â  Â  Â <span class="hljs-title class_">CardItem</span> item = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CardItem</span>();
 Â  Â  Â  Â item.<span class="hljs-property">type</span> = <span class="hljs-keyword">type</span>;
 Â  Â  Â  Â item.<span class="hljs-property">title</span> = title;
 Â  Â  Â  Â item.<span class="hljs-property">scheduleItems</span> = scheduleItems;
 Â  Â  Â  Â <span class="hljs-keyword">return</span> item;
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * åˆ›å»ºæ–°é—»å¡ç‰‡
 Â  Â  */</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">CardItem</span> <span class="hljs-title function_">createNewsCard</span>(<span class="hljs-params">NegativeScreenAdapter.CardType <span class="hljs-keyword">type</span>, <span class="hljs-built_in">String</span> title, List&lt;NewsItem&gt; newsItems</span>) {
 Â  Â  Â  Â <span class="hljs-title class_">CardItem</span> item = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CardItem</span>();
 Â  Â  Â  Â item.<span class="hljs-property">type</span> = <span class="hljs-keyword">type</span>;
 Â  Â  Â  Â item.<span class="hljs-property">title</span> = title;
 Â  Â  Â  Â item.<span class="hljs-property">newsItems</span> = newsItems;
 Â  Â  Â  Â <span class="hljs-keyword">return</span> item;
 Â   }
â€‹
 Â  Â <span class="hljs-comment">/**
 Â  Â  * åˆ›å»ºå¾…åŠäº‹é¡¹å¡ç‰‡
 Â  Â  */</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">CardItem</span> <span class="hljs-title function_">createTodoCard</span>(<span class="hljs-params">NegativeScreenAdapter.CardType <span class="hljs-keyword">type</span>, <span class="hljs-built_in">String</span> title, List&lt;TodoItem&gt; todoItems</span>) {
 Â  Â  Â  Â <span class="hljs-title class_">CardItem</span> item = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CardItem</span>();
 Â  Â  Â  Â item.<span class="hljs-property">type</span> = <span class="hljs-keyword">type</span>;
 Â  Â  Â  Â item.<span class="hljs-property">title</span> = title;
 Â  Â  Â  Â item.<span class="hljs-property">todoItems</span> = todoItems;
 Â  Â  Â  Â <span class="hljs-keyword">return</span> item;
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// Getters</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">NegativeScreenAdapter</span>.<span class="hljs-property">CardType</span> <span class="hljs-title function_">getType</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-keyword">type</span>;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getTitle</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> title;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ActionItem</span>&gt; <span class="hljs-title function_">getActionItems</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> actionItems;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ScheduleItem</span>&gt; <span class="hljs-title function_">getScheduleItems</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> scheduleItems;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">NewsItem</span>&gt; <span class="hljs-title function_">getNewsItems</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> newsItems;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">TodoItem</span>&gt; <span class="hljs-title function_">getTodoItems</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> todoItems;
 Â   }
}
</code></pre>
<h2 data-id="heading-5">5.NewItem:</h2>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">negativescreendemo</span>;
â€‹
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span>: njb
 * <span class="hljs-doctag">@date</span>: 2025/8/20 21:28
 * <span class="hljs-doctag">@desc</span>: æè¿°
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsItem</span> {
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> title;
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> source;
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> time;
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">NewsItem</span>(<span class="hljs-title class_">String</span> title, <span class="hljs-title class_">String</span> source, <span class="hljs-title class_">String</span> time) {
 Â  Â  Â  Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = title;
 Â  Â  Â  Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">source</span> = source;
 Â  Â  Â  Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">time</span> = time;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getTitle</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> title;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getSource</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> source;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getTime</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> time;
 Â   }
}
</code></pre>
<h2 data-id="heading-6">6.ScheduleItem:</h2>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">negativescreendemo</span>;
â€‹
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span>: njb
 * <span class="hljs-doctag">@date</span>: 2025/8/20 21:28
 * <span class="hljs-doctag">@desc</span>: æè¿°
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScheduleItem</span> {
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> time;
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> title;
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> location;
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">ScheduleItem</span>(<span class="hljs-title class_">String</span> time, <span class="hljs-title class_">String</span> title, <span class="hljs-title class_">String</span> location) {
 Â  Â  Â  Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">time</span> = time;
 Â  Â  Â  Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = title;
 Â  Â  Â  Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">location</span> = location;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getTime</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> time;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getTitle</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> title;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getLocation</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> location;
 Â   }
}
</code></pre>
<h2 data-id="heading-7">7.TodoItemï¼š</h2>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">negativescreendemo</span>;
â€‹
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span>: njb
 * <span class="hljs-doctag">@date</span>: 2025/8/20 21:28
 * <span class="hljs-doctag">@desc</span>: æè¿°
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TodoItem</span> {
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> content;
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> isCompleted;
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">TodoItem</span>(<span class="hljs-title class_">String</span> content, <span class="hljs-built_in">boolean</span> isCompleted) {
 Â  Â  Â  Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span> = content;
 Â  Â  Â  Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">isCompleted</span> = isCompleted;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getContent</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> content;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isCompleted</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> isCompleted;
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setCompleted</span>(<span class="hljs-params"><span class="hljs-built_in">boolean</span> completed</span>) {
 Â  Â  Â  Â isCompleted = completed;
 Â   }
}
</code></pre>
<h2 data-id="heading-8">8.ä¸»ç•Œé¢å¸ƒå±€ï¼š</h2>
<pre><code class="hljs language-ini" lang="ini">&lt;?xml <span class="hljs-attr">version</span>=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;
&lt;androidx.core.widget.NestedScrollView xmlns:<span class="hljs-attr">android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
 Â  Â xmlns:<span class="hljs-attr">tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span>
 Â  Â android:<span class="hljs-attr">layout_width</span>=<span class="hljs-string">"match_parent"</span>
 Â  Â android:<span class="hljs-attr">layout_height</span>=<span class="hljs-string">"match_parent"</span>
 Â  Â android:<span class="hljs-attr">background</span>=<span class="hljs-string">"@color/gray_50"</span>
 Â  Â tools:<span class="hljs-attr">context</span>=<span class="hljs-string">".NegativeScreenActivity"</span>&gt;
â€‹
 Â  Â &lt;LinearLayout
 Â  Â  Â  Â android:<span class="hljs-attr">layout_width</span>=<span class="hljs-string">"match_parent"</span>
 Â  Â  Â  Â android:<span class="hljs-attr">layout_height</span>=<span class="hljs-string">"wrap_content"</span>
 Â  Â  Â  Â android:<span class="hljs-attr">orientation</span>=<span class="hljs-string">"vertical"</span>&gt;
â€‹
 Â  Â  Â  Â &lt;!-- é¡¶éƒ¨æ—¶é—´å¤©æ°”åŒºåŸŸ --&gt;
 Â  Â  Â  Â &lt;LinearLayout
 Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_width</span>=<span class="hljs-string">"match_parent"</span>
 Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_height</span>=<span class="hljs-string">"wrap_content"</span>
 Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_margin</span>=<span class="hljs-string">"16dp"</span>
 Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">orientation</span>=<span class="hljs-string">"vertical"</span>&gt;
â€‹
 Â  Â  Â  Â  Â  Â &lt;TextView
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">id</span>=<span class="hljs-string">"@+id/time_text"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_width</span>=<span class="hljs-string">"wrap_content"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_height</span>=<span class="hljs-string">"wrap_content"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">text</span>=<span class="hljs-string">"12:30"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">textColor</span>=<span class="hljs-string">"@color/black"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">textSize</span>=<span class="hljs-string">"48sp"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">textStyle</span>=<span class="hljs-string">"bold"</span> /&gt;
â€‹
 Â  Â  Â  Â  Â  Â &lt;TextView
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">id</span>=<span class="hljs-string">"@+id/date_text"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_width</span>=<span class="hljs-string">"wrap_content"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_height</span>=<span class="hljs-string">"wrap_content"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_marginTop</span>=<span class="hljs-string">"8dp"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">text</span>=<span class="hljs-string">"æ˜ŸæœŸä¸€, å…­æœˆ 15æ—¥"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">textColor</span>=<span class="hljs-string">"@color/gray_600"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">textSize</span>=<span class="hljs-string">"16sp"</span> /&gt;
â€‹
 Â  Â  Â  Â  Â  Â &lt;LinearLayout
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_width</span>=<span class="hljs-string">"wrap_content"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_height</span>=<span class="hljs-string">"wrap_content"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_marginTop</span>=<span class="hljs-string">"12dp"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">gravity</span>=<span class="hljs-string">"center"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_gravity</span>=<span class="hljs-string">"center"</span>
 Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">orientation</span>=<span class="hljs-string">"horizontal"</span>&gt;
â€‹
 Â  Â  Â  Â  Â  Â  Â  Â &lt;ImageView
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">id</span>=<span class="hljs-string">"@+id/weather_icon"</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_width</span>=<span class="hljs-string">"24dp"</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_height</span>=<span class="hljs-string">"24dp"</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">src</span>=<span class="hljs-string">"@drawable/ic_scan"</span> /&gt;
â€‹
 Â  Â  Â  Â  Â  Â  Â  Â &lt;TextView
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">id</span>=<span class="hljs-string">"@+id/weather_text"</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_width</span>=<span class="hljs-string">"wrap_content"</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_height</span>=<span class="hljs-string">"wrap_content"</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_marginStart</span>=<span class="hljs-string">"8dp"</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">text</span>=<span class="hljs-string">"25Â°C æ™´æœ—"</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">textColor</span>=<span class="hljs-string">"@color/gray_600"</span>
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">textSize</span>=<span class="hljs-string">"16sp"</span> /&gt;
 Â  Â  Â  Â  Â  Â &lt;/LinearLayout&gt;
 Â  Â  Â  Â &lt;/LinearLayout&gt;
â€‹
 Â  Â  Â  Â &lt;!-- å¡ç‰‡åˆ—è¡¨ --&gt;
 Â  Â  Â  Â &lt;androidx.recyclerview.widget.RecyclerView
 Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">id</span>=<span class="hljs-string">"@+id/recycler_view"</span>
 Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_width</span>=<span class="hljs-string">"match_parent"</span>
 Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">layout_height</span>=<span class="hljs-string">"wrap_content"</span>
 Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">paddingHorizontal</span>=<span class="hljs-string">"16dp"</span>
 Â  Â  Â  Â  Â  Â android:<span class="hljs-attr">clipToPadding</span>=<span class="hljs-string">"false"</span> /&gt;
 Â  Â &lt;/LinearLayout&gt;
&lt;/androidx.core.widget.NestedScrollView&gt;
</code></pre>
<h2 data-id="heading-9">9.ä¸»ç•Œé¢æµ‹è¯•ä»£ç ï¼š</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.negativescreendemo;
â€‹
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.os.Handler;
<span class="hljs-keyword">import</span> android.os.Looper;
<span class="hljs-keyword">import</span> android.widget.ImageView;
<span class="hljs-keyword">import</span> android.widget.TextView;
<span class="hljs-keyword">import</span> android.widget.Toast;
â€‹
<span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;
<span class="hljs-keyword">import</span> androidx.recyclerview.widget.LinearLayoutManager;
<span class="hljs-keyword">import</span> androidx.recyclerview.widget.RecyclerView;
â€‹
<span class="hljs-keyword">import</span> com.example.negativescreendemo.adapter.NegativeScreenAdapter;
â€‹
<span class="hljs-keyword">import</span> java.text.SimpleDateFormat;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Locale;
<span class="hljs-keyword">import</span> java.util.Timer;
<span class="hljs-keyword">import</span> java.util.TimerTask;
â€‹
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span>: njb
 * <span class="hljs-doctag">@date</span>: 2025/8/20 21:18
 * <span class="hljs-doctag">@desc</span>: æè¿°
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NegativeScreenActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> {
 Â  Â <span class="hljs-keyword">private</span> RecyclerView recyclerView;
 Â  Â <span class="hljs-keyword">private</span> NegativeScreenAdapter adapter;
 Â  Â <span class="hljs-keyword">private</span> List&lt;CardItem&gt; cardItems;
 Â  Â <span class="hljs-keyword">private</span> TextView timeTextView;
 Â  Â <span class="hljs-keyword">private</span> TextView dateTextView;
 Â  Â <span class="hljs-keyword">private</span> TextView weatherTextView;
 Â  Â <span class="hljs-keyword">private</span> ImageView weatherIcon;
â€‹
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
 Â  Â  Â  Â <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
 Â  Â  Â  Â setContentView(R.layout.activity_negative_screen);
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// åˆå§‹åŒ–è§†å›¾</span>
 Â  Â  Â  Â initViews();
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// åˆå§‹åŒ–æ•°æ®</span>
 Â  Â  Â  Â initData();
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// è®¾ç½®é€‚é…å™¨</span>
 Â  Â  Â  Â adapter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NegativeScreenAdapter</span>(<span class="hljs-built_in">this</span>, cardItems);
 Â  Â  Â  Â recyclerView.setAdapter(adapter);
 Â  Â  Â  Â recyclerView.setLayoutManager(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayoutManager</span>(<span class="hljs-built_in">this</span>));
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// è®¾ç½®ç‚¹å‡»äº‹ä»¶</span>
 Â  Â  Â  Â adapter.setOnItemClickListener(position -&gt; {
 Â  Â  Â  Â  Â  Â <span class="hljs-type">CardItem</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> cardItems.get(position);
 Â  Â  Â  Â  Â  Â Toast.makeText(NegativeScreenActivity.<span class="hljs-built_in">this</span>,
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-string">"ç‚¹å‡»äº†: "</span> + item.getTitle(), Toast.LENGTH_SHORT).show();
 Â  Â  Â   });
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// æ›´æ–°æ—¶é—´</span>
 Â  Â  Â  Â updateTime();
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initViews</span><span class="hljs-params">()</span> {
 Â  Â  Â  Â recyclerView = findViewById(R.id.recycler_view);
 Â  Â  Â  Â timeTextView = findViewById(R.id.time_text);
 Â  Â  Â  Â dateTextView = findViewById(R.id.date_text);
 Â  Â  Â  Â weatherTextView = findViewById(R.id.weather_text);
 Â  Â  Â  Â weatherIcon = findViewById(R.id.weather_icon);
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initData</span><span class="hljs-params">()</span> {
 Â  Â  Â  Â <span class="hljs-comment">// æ¨¡æ‹Ÿå¤©æ°”æ•°æ®</span>
 Â  Â  Â  Â weatherTextView.setText(<span class="hljs-string">"25Â°C æ™´æœ—"</span>);
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// åˆå§‹åŒ–å¡ç‰‡æ•°æ®</span>
 Â  Â  Â  Â cardItems = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// æ·»åŠ å¿«æ·åŠŸèƒ½å¡ç‰‡</span>
 Â  Â  Â  Â List&lt;ActionItem&gt; actionItems = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
 Â  Â  Â  Â actionItems.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ActionItem</span>(<span class="hljs-string">"æ‰«ä¸€æ‰«"</span>, R.drawable.ic_scan));
 Â  Â  Â  Â actionItems.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ActionItem</span>(<span class="hljs-string">"ä»˜æ¬¾"</span>, R.drawable.ic_pay));
 Â  Â  Â  Â actionItems.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ActionItem</span>(<span class="hljs-string">"ä¹˜è½¦ç "</span>, R.drawable.ic_bus));
 Â  Â  Â  Â actionItems.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ActionItem</span>(<span class="hljs-string">"å¥åº·ç "</span>, R.drawable.ic_health));
 Â  Â  Â  Â actionItems.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ActionItem</span>(<span class="hljs-string">"å……ç”µå®"</span>, R.drawable.ic_power_bank));
 Â  Â  Â  Â actionItems.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ActionItem</span>(<span class="hljs-string">"æ›´å¤š"</span>, R.drawable.ic_more));
 Â  Â  Â  Â cardItems.add(CardItem.createActionCard(NegativeScreenAdapter.CardType.ACTIONS, <span class="hljs-string">"å¿«æ·åŠŸèƒ½"</span>, actionItems));
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// æ·»åŠ æ—¥ç¨‹å¡ç‰‡</span>
 Â  Â  Â  Â List&lt;ScheduleItem&gt; scheduleItems = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
 Â  Â  Â  Â scheduleItems.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ScheduleItem</span>(<span class="hljs-string">"9:30"</span>, <span class="hljs-string">"å›¢é˜Ÿå‘¨ä¼š"</span>, <span class="hljs-string">"ä¼šè®®å®¤A"</span>));
 Â  Â  Â  Â scheduleItems.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ScheduleItem</span>(<span class="hljs-string">"14:00"</span>, <span class="hljs-string">"å®¢æˆ·æ‹œè®¿"</span>, <span class="hljs-string">"XXå…¬å¸"</span>));
 Â  Â  Â  Â cardItems.add(CardItem.createScheduleCard(NegativeScreenAdapter.CardType.SCHEDULE, <span class="hljs-string">"ä»Šæ—¥æ—¥ç¨‹"</span>, scheduleItems));
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// æ·»åŠ æ–°é—»å¡ç‰‡</span>
 Â  Â  Â  Â List&lt;NewsItem&gt; newsItems = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
 Â  Â  Â  Â newsItems.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsItem</span>(<span class="hljs-string">"æœ€æ–°ç§‘æŠ€çªç ´ï¼šäººå·¥æ™ºèƒ½æ–°è¿›å±•"</span>, <span class="hljs-string">"ç§‘æŠ€æ—¥æŠ¥"</span>, <span class="hljs-string">"10åˆ†é’Ÿå‰"</span>));
 Â  Â  Â  Â newsItems.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsItem</span>(<span class="hljs-string">"æœ¬åœ°æ°”æ¸©å°†æŒç»­å‡é«˜ï¼Œæœ€é«˜è¾¾35Â°C"</span>, <span class="hljs-string">"æœ¬åœ°æ–°é—»"</span>, <span class="hljs-string">"30åˆ†é’Ÿå‰"</span>));
 Â  Â  Â  Â cardItems.add(CardItem.createNewsCard(NegativeScreenAdapter.CardType.NEWS, <span class="hljs-string">"çƒ­ç‚¹æ–°é—»"</span>, newsItems));
â€‹
 Â  Â  Â  Â <span class="hljs-comment">// æ·»åŠ å¾…åŠäº‹é¡¹å¡ç‰‡</span>
 Â  Â  Â  Â List&lt;TodoItem&gt; todoItems = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
 Â  Â  Â  Â todoItems.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TodoItem</span>(<span class="hljs-string">"å®Œæˆé¡¹ç›®æŠ¥å‘Š"</span>, <span class="hljs-literal">false</span>));
 Â  Â  Â  Â todoItems.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TodoItem</span>(<span class="hljs-string">"è´­ä¹°ç”Ÿæ—¥ç¤¼ç‰©"</span>, <span class="hljs-literal">true</span>));
 Â  Â  Â  Â todoItems.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TodoItem</span>(<span class="hljs-string">"å›å¤å®¢æˆ·é‚®ä»¶"</span>, <span class="hljs-literal">false</span>));
 Â  Â  Â  Â cardItems.add(CardItem.createTodoCard(NegativeScreenAdapter.CardType.TODO, <span class="hljs-string">"å¾…åŠäº‹é¡¹"</span>, todoItems));
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateTime</span><span class="hljs-params">()</span> {
 Â  Â  Â  Â <span class="hljs-comment">// æ›´æ–°æ—¶é—´å’Œæ—¥æœŸ</span>
 Â  Â  Â  Â <span class="hljs-keyword">final</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(Looper.getMainLooper());
 Â  Â  Â  Â <span class="hljs-type">Timer</span> <span class="hljs-variable">timer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Timer</span>();
 Â  Â  Â  Â timer.scheduleAtFixedRate(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TimerTask</span>() {
 Â  Â  Â  Â  Â  Â <span class="hljs-meta">@Override</span>
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
 Â  Â  Â  Â  Â  Â  Â  Â handler.post(() -&gt; {
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">timeFormat</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"HH:mm"</span>, Locale.getDefault());
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">dateFormat</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"EEEE, MMMM dæ—¥"</span>, Locale.getDefault());
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-type">String</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> timeFormat.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-type">String</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> dateFormat.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
â€‹
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â timeTextView.setText(time);
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â dateTextView.setText(date);
 Â  Â  Â  Â  Â  Â  Â   });
 Â  Â  Â  Â  Â   }
 Â  Â  Â   }, <span class="hljs-number">0</span>, <span class="hljs-number">60000</span>); <span class="hljs-comment">// æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡</span>
 Â   }
}
</code></pre>
<h2 data-id="heading-10">10.å®ç°æ•ˆæœå¦‚ä¸‹ï¼š</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c89f2096d3234150af20271efe97507e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOWwj-a4o-a4ow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766415764&amp;x-signature=XAlJWiODY8MiyMOcMr4L26hy9Bk%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-11">11.æ€»ç»“ï¼š</h2>
<p>ä»¥<strong>åˆ†å±‚æ¶æ„ + æ¨¡å—åŒ–è®¾è®¡</strong>ä¸ºæ ¸å¿ƒï¼Œé€šè¿‡ â€œæ•°æ®æ¨¡å‹å°è£… - UI é€‚é…æ¸²æŸ“ - ç•Œé¢é€»è¾‘æ§åˆ¶â€ ä¸‰å±‚ç»“æ„ï¼Œå¿«é€Ÿæ­å»º Launcher3 è´Ÿä¸€å±åŠŸèƒ½ï¼Œæ ¸å¿ƒæ˜¯åˆ©ç”¨<code>RecyclerView</code>åµŒå¥—å®ç° â€œå¡ç‰‡å®¹å™¨ + å­é¡¹åˆ—è¡¨â€ çš„çµæ´»å¸ƒå±€ï¼ŒåŒæ—¶ä¿è¯ç•Œé¢äº¤äº’ä¸æ•°æ®å±•ç¤ºçš„è§£è€¦ã€‚</p>
<h3 data-id="heading-12">å…³é”®æŠ€æœ¯ç‚¹</h3>
<ul>
<li><strong>RecyclerView å¤šç±»å‹å¸ƒå±€</strong>ï¼šé€šè¿‡<code>getItemViewType()</code>å’Œä¸åŒ<code>ViewHolder</code>ï¼Œå®ç° 4 ç±»å¡ç‰‡çš„å·®å¼‚åŒ–å±•ç¤ºï¼Œé™ä½ä»£ç è€¦åˆã€‚</li>
<li><strong>RecyclerView åµŒå¥—</strong>ï¼šå¤–å±‚<code>RecyclerView</code>ï¼ˆå¡ç‰‡åˆ—è¡¨ï¼‰åµŒå¥—å†…å±‚<code>RecyclerView</code>ï¼ˆå¡ç‰‡å­é¡¹ï¼‰ï¼Œç»“åˆ<code>GridLayoutManager</code>ï¼ˆå¿«æ·åŠŸèƒ½ 3 åˆ—ï¼‰å’Œ<code>LinearLayoutManager</code>ï¼ˆå…¶ä»–å¡ç‰‡å•åˆ—ï¼‰ï¼Œæ»¡è¶³ä¸åŒå¸ƒå±€éœ€æ±‚ã€‚</li>
<li><strong>çº¿ç¨‹å®‰å…¨çš„ UI æ›´æ–°</strong>ï¼šç”¨<code>Handler(Looper.getMainLooper())</code>å°†<code>Timer</code>çš„å®šæ—¶ä»»åŠ¡åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ï¼Œé¿å…å­çº¿ç¨‹æ“ä½œ UI çš„å¼‚å¸¸ã€‚</li>
<li><strong>æ•°æ®æ¨¡å‹ç§æœ‰åŒ–æ„é€ </strong>ï¼š<code>CardItem</code>é€šè¿‡ç§æœ‰æ„é€  + é™æ€åˆ›å»ºæ–¹æ³•ï¼Œå¼ºåˆ¶è§„èŒƒå¡ç‰‡åˆ›å»ºæµç¨‹ï¼Œé¿å…é”™è¯¯æ•°æ®èµ‹å€¼ã€‚</li>
</ul>
<h2 data-id="heading-13">12.æºç åœ°å€ï¼š</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fjackning_admin%2Fnegative-screen-demo" target="_blank" title="https://gitee.com/jackning_admin/negative-screen-demo" ref="nofollow noopener noreferrer">gitee.com/jackning_adâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šJWT é›†æˆæŒ‡å—]]></title>    <link>https://juejin.cn/post/7583878719544098825</link>    <guid>https://juejin.cn/post/7583878719544098825</guid>    <pubDate>2025-12-15T13:06:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583878719544098825" data-draft-id="7583912637470113843" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šJWT é›†æˆæŒ‡å—"/> <meta itemprop="keywords" content="åç«¯,Go"/> <meta itemprop="datePublished" content="2025-12-15T13:06:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å–µä¸ªå’ª"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šJWT é›†æˆæŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å–µä¸ªå’ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T13:06:56.000Z" title="Mon Dec 15 2025 13:06:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šJWT é›†æˆæŒ‡å—</h2>
<p>åœ¨ä¼ä¸šçº§ä¸­åå°ç³»ç»Ÿå¼€å‘ä¸­ï¼Œèº«ä»½è®¤è¯ä¸æˆæƒæ˜¯æ ¸å¿ƒå®‰å…¨èƒ½åŠ›ã€‚JWTï¼ˆJSON Web Tokenï¼‰å‡­å€Ÿå…¶æ— çŠ¶æ€ã€è½»é‡åŒ–ã€è·¨å¹³å°çš„ç‰¹æ€§ï¼Œæˆä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­èº«ä»½æ ¡éªŒçš„ä¼˜é€‰æ–¹æ¡ˆã€‚GoWind Admin ä½œä¸ºä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼Œå·²å°† JWT æ ¸å¿ƒé€»è¾‘å°è£…è‡³ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fkratos-authn" target="_blank" title="https://github.com/tx7do/kratos-authn" ref="nofollow noopener noreferrer">github.com/tx7do/kratoâ€¦</a> ç»„ä»¶ä¸­ï¼Œå½»åº•ç®€åŒ–äº†åº•å±‚å¼•æ“åˆå§‹åŒ–ã€ç­–ç•¥åŠ è½½ã€ç­¾åéªŒè¯ç­‰é‡å¤å¼€å‘å·¥ä½œã€‚å¼€å‘è€…åªéœ€éµå¾ªä»¥ä¸‹æ ‡å‡†åŒ–æ­¥éª¤ï¼Œå³å¯å¿«é€Ÿå®Œæˆ JWT é›†æˆï¼Œæ— ç¼å¯¹æ¥æ¡†æ¶çš„ OPA æƒé™ç®¡æ§ä½“ç³»ï¼Œæ„å»ºå®‰å…¨å¯é çš„èº«ä»½è®¤è¯é“¾è·¯ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€å‰ç½®å‡†å¤‡</h3>
<p>åœ¨å¼€å§‹é›†æˆå‰ï¼Œè¯·ç¡®ä¿å®Œæˆä»¥ä¸‹åŸºç¡€å‡†å¤‡å·¥ä½œï¼Œé¿å…å› ç¯å¢ƒæˆ–ä¾èµ–é—®é¢˜å¯¼è‡´é›†æˆå—é˜»ï¼š</p>
<ul>
<li>å·²æ‹‰å–æœ€æ–°ç‰ˆ GoWind Admin é¡¹ç›®ï¼ˆGitee/GitHub ä»“åº“åœ°å€è§æ–‡æœ«ï¼‰ï¼Œå¹¶å®ŒæˆåŸºç¡€ç¯å¢ƒæ­å»ºï¼ˆGo 1.21+ã€Kratos 2.6+ã€Wire ä¾èµ–æ³¨å…¥å·¥å…·ï¼‰ï¼›</li>
<li>ç†Ÿæ‚‰é¡¹ç›®ç›®å½•ç»“æ„ï¼Œé‡ç‚¹äº†è§£ <code>app/admin/service/internal/data</code>ï¼ˆæ•°æ®å±‚ï¼Œè´Ÿè´£è®¤è¯å™¨åˆ›å»ºï¼‰ã€<code>app/admin/service/internal/server</code>ï¼ˆæœåŠ¡å±‚ï¼Œè´Ÿè´£ä¸­é—´ä»¶é›†æˆï¼‰ã€<code>app/admin/service/configs</code>ï¼ˆé…ç½®å±‚ï¼‰çš„æ ¸å¿ƒä½œç”¨ï¼›</li>
<li>ç¡®è®¤ kratos-authn ç»„ä»¶å·²å¼•å…¥é¡¹ç›®ä¾èµ–ï¼ˆé¡¹ç›®é»˜è®¤é›†æˆï¼Œè‹¥ç¼ºå¤±å¯æ‰§è¡Œ <code>go get github.com/tx7do/kratos-authn</code> å®‰è£…ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-2">äºŒã€è¯¦ç»†é›†æˆæ­¥éª¤</h3>
<p>JWT é›†æˆæ ¸å¿ƒåˆ†ä¸ºã€Œåˆ›å»ºè®¤è¯å™¨ã€ã€Œä¾èµ–æ³¨å…¥å®¹å™¨ã€ã€Œä¸­é—´ä»¶é›†æˆã€ã€Œé…ç½®æ–‡ä»¶ä¿®æ”¹ã€å››ä¸ªæ­¥éª¤ï¼Œå…¨ç¨‹éµå¾ªã€Œé…ç½®åŒ– + ä¾èµ–æ³¨å…¥ã€è®¾è®¡ç†å¿µï¼Œæ— éœ€ä¿®æ”¹æ¡†æ¶æ ¸å¿ƒä»£ç ã€‚</p>
<h4 data-id="heading-3">æ­¥éª¤ 1ï¼šåˆ›å»º JWT è®¤è¯å™¨</h4>
<p>è®¤è¯å™¨æ˜¯ JWT é€»è¾‘çš„æ ¸å¿ƒè½½ä½“ï¼Œè´Ÿè´£åŸºäºé…ç½®åˆå§‹åŒ– JWT å¼•æ“ã€å¤„ç†ç­¾åä¸éªŒç­¾é€»è¾‘ã€‚åœ¨æ•°æ®å±‚åˆ›å»ºè®¤è¯å™¨å®ä¾‹ï¼Œé€šè¿‡é…ç½®åŠ¨æ€é€‚é…è®¤è¯ç±»å‹ã€‚</p>
<p>åˆ›å»º/ä¿®æ”¹æ–‡ä»¶ <code>app/admin/service/internal/data/authenticator.go</code>ï¼Œä»£ç å¦‚ä¸‹ï¼ˆå«è¯¦ç»†æ³¨é‡Šï¼‰ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"context"</span>
	<span class="hljs-string">"errors"</span>

	<span class="hljs-string">"github.com/go-kratos/kratos/v2/log"</span>

	authnEngine <span class="hljs-string">"github.com/tx7do/kratos-authn/engine"</span>
	<span class="hljs-string">"github.com/tx7do/kratos-authn/engine/jwt"</span>
)

<span class="hljs-comment">// NewAuthenticator åˆ›å»ºè®¤è¯å™¨</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAuthenticator</span><span class="hljs-params">(cfg *conf.Bootstrap)</span></span> authnEngine.Authenticator {
	<span class="hljs-keyword">if</span> cfg.Authn == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	}

	<span class="hljs-keyword">switch</span> cfg.GetAuthn().GetType() {
	<span class="hljs-keyword">default</span>:
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>

	<span class="hljs-keyword">case</span> <span class="hljs-string">"jwt"</span>:
		authenticator, err := jwt.NewAuthenticator(
			jwt.WithKey([]<span class="hljs-type">byte</span>(cfg.Authn.GetJwt().GetKey())),
			jwt.WithSigningMethod(cfg.Authn.GetJwt().GetMethod()),
		)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		}
		<span class="hljs-keyword">return</span> authenticator

	<span class="hljs-keyword">case</span> <span class="hljs-string">"oidc"</span>:
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>

	<span class="hljs-keyword">case</span> <span class="hljs-string">"preshared_key"</span>:
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	}
}
</code></pre>
<blockquote>
<p>æ ¸å¿ƒè¯´æ˜ï¼šé€šè¿‡ <code>jwt.WithXXX</code> ç³»åˆ— Option å¯æ‰©å±•æ›´å¤š JWT é…ç½®ï¼Œå¦‚ Token è¿‡æœŸæ—¶é—´ï¼ˆExpiryï¼‰ã€åˆ·æ–° Token ç­–ç•¥ï¼ˆRefreshTokenï¼‰ã€å‘è¡Œäººï¼ˆIssuerï¼‰ç­‰ï¼Œåªéœ€åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”å­—æ®µï¼Œå†é€šè¿‡ Option ä¼ å…¥å³å¯ã€‚</p>
</blockquote>
<h4 data-id="heading-4">æ­¥éª¤ 2ï¼šä¾èµ–æ³¨å…¥å®¹å™¨ï¼ˆWire æ³¨å†Œï¼‰</h4>
<p>GoWind Admin é‡‡ç”¨ Wire å®ç°ä¾èµ–æ³¨å…¥ï¼Œéœ€å°†åˆ›å»ºçš„ JWT è®¤è¯å™¨æ³¨å†Œåˆ°æ•°æ®å±‚çš„ä¾èµ–é›†åˆä¸­ï¼Œç¡®ä¿æ¡†æ¶åœ¨å¯åŠ¨æ—¶èƒ½è‡ªåŠ¨åˆå§‹åŒ–å¹¶æ³¨å…¥åˆ°éœ€è¦çš„ç»„ä»¶ï¼ˆå¦‚ä¸­é—´ä»¶ï¼‰ä¸­ã€‚</p>
<p>ä¿®æ”¹æ–‡ä»¶ <code>app/admin/service/internal/data/init.go</code>ï¼Œåœ¨ <code>ProviderSet</code> ä¸­æ·»åŠ è®¤è¯å™¨æ³¨å†Œï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/data/init.go</span>

<span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/google/wire"</span>

<span class="hljs-comment">// ProviderSet æ•°æ®å±‚ä¾èµ–æ³¨å…¥é›†åˆ</span>
<span class="hljs-comment">// ä½œç”¨ï¼šç»Ÿä¸€ç®¡ç†æ•°æ®å±‚ç»„ä»¶ï¼Œä¾›æ¡†æ¶å¯åŠ¨æ—¶è‡ªåŠ¨æ³¨å…¥</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    NewAuthenticator,        <span class="hljs-comment">// æ³¨å†Œ JWT è®¤è¯å™¨ï¼ˆæ ¸å¿ƒï¼Œå¿…é¡»æ·»åŠ ï¼‰</span>
    NewUserRepo,             <span class="hljs-comment">// ç¤ºä¾‹ï¼šç”¨æˆ·ä»“åº“ï¼ˆå·²æœ‰çš„å…¶ä»–ä¾èµ–ä¿ç•™ï¼‰</span>
    NewMenuRepo,             <span class="hljs-comment">// ç¤ºä¾‹ï¼šèœå•ä»“åº“ï¼ˆå·²æœ‰çš„å…¶ä»–ä¾èµ–ä¿ç•™ï¼‰</span>
    <span class="hljs-comment">// ... å…¶ä»–æ•°æ®å±‚ç»„ä»¶ï¼ˆæŒ‰éœ€ä¿ç•™æˆ–æ·»åŠ ï¼‰</span>
)
</code></pre>
<p>æ³¨å†Œå®Œæˆåï¼Œæ‰§è¡Œ <code>make ent</code> å‘½ä»¤ï¼ŒWire ä¼šè‡ªåŠ¨ç”Ÿæˆä¾èµ–æ³¨å…¥ä»£ç ï¼Œç¡®ä¿è®¤è¯å™¨èƒ½è¢«æ­£ç¡®å®ä¾‹åŒ–å¹¶æ³¨å…¥åˆ°åç»­çš„ä¸­é—´ä»¶ä¸­ã€‚</p>
<h4 data-id="heading-5">æ­¥éª¤ 3ï¼šé›†æˆä¸­é—´ä»¶è‡³ REST æœåŠ¡é“¾è·¯</h4>
<p>JWT è®¤è¯éœ€è¦é€šè¿‡ä¸­é—´ä»¶åµŒå…¥åˆ° REST æœåŠ¡çš„è¯·æ±‚é“¾è·¯ä¸­ï¼Œå®ç°å¯¹æ‰€æœ‰è¯·æ±‚çš„èº«ä»½æ ¡éªŒã€‚æ¡†æ¶æä¾› <code>selector.Server</code> æ”¯æŒç™½åå•åŒ¹é…ï¼Œå¯æŒ‡å®šæ— éœ€è®¤è¯çš„æ¥å£ï¼ˆå¦‚ç™»å½•ã€æ³¨å†Œæ¥å£ï¼‰ã€‚</p>
<p>ä¿®æ”¹æ–‡ä»¶ <code>app/admin/service/internal/server/rest.go</code>ï¼Œå®ç°ä¸­é—´ä»¶åˆ›å»ºä¸é›†æˆï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/server/rest.go</span>

<span class="hljs-keyword">package</span> server

<span class="hljs-comment">// NewMiddleware åˆ›å»ºä¸­é—´ä»¶</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newRestMiddleware</span><span class="hljs-params">(
	logger log.Logger,
	authenticator authnEngine.Authenticator,
	authorizer *data.Authorizer,
)</span></span> []middleware.Middleware {
	<span class="hljs-keyword">var</span> ms []middleware.Middleware
	ms = <span class="hljs-built_in">append</span>(ms, logging.Server(logger))

	ms = <span class="hljs-built_in">append</span>(ms, selector.Server(
		authn.Server(authenticator),
		auth.Server(),
		authz.Server(authorizer.Engine()),
	).Match(newRestWhiteListMatcher()).Build())

	<span class="hljs-keyword">return</span> ms
}

<span class="hljs-comment">// NewRESTServer new an HTTP server.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRESTServer</span><span class="hljs-params">(
    cfg *conf.Bootstrap, logger log.Logger,
	authenticator authnEngine.Authenticator, authorizer *data.Authorizer,
)</span></span> {
    ...

	srv := rpc.CreateRestServer(cfg,
		newRestMiddleware(logger, authenticator, authorizer)...,
	)

    ...
}
</code></pre>
<p>è¡¥å……è¯´æ˜ï¼š</p>
<ul>
<li>ä¸­é—´ä»¶æ‰§è¡Œé¡ºåºï¼šæ—¥å¿—ä¸­é—´ä»¶ â†’ è®¤è¯ä¸­é—´ä»¶ â†’ æƒé™ä¸­é—´ä»¶ï¼Œç¡®ä¿æ—¥å¿—èƒ½å®Œæ•´è®°å½•è®¤è¯è¿‡ç¨‹ï¼Œè®¤è¯é€šè¿‡åå†è¿›è¡Œæƒé™æ ¡éªŒï¼›</li>
<li>ç™½åå•åŒ¹é…å™¨ <code>newRestWhiteListMatcher()</code>ï¼šæ¡†æ¶é»˜è®¤å·²å®ç°å¸¸è§ç™½åå•æ¥å£ï¼ˆå¦‚ <code>/api/v1/login</code>ã€<code>/api/v1/health</code>ï¼‰ï¼Œå¦‚éœ€è‡ªå®šä¹‰ï¼Œå¯åœ¨è¯¥æ–¹æ³•ä¸­æ·»åŠ æ¥å£è·¯å¾„åŒ¹é…è§„åˆ™ï¼›</li>
<li>è®¤è¯å¤±è´¥å¤„ç†ï¼šJWT è®¤è¯ä¸­é—´ä»¶ä¼šè‡ªåŠ¨å¤„ç† Token ç¼ºå¤±ã€è¿‡æœŸã€ç­¾åä¸åŒ¹é…ç­‰å¼‚å¸¸ï¼Œè¿”å›æ ‡å‡†åŒ–é”™è¯¯ï¼ˆå¦‚ 401 Unauthorizedï¼‰ï¼Œæ— éœ€é¢å¤–ç¼–ç ã€‚</li>
</ul>
<h4 data-id="heading-6">æ­¥éª¤ 4ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¯ç”¨ JWT è®¤è¯</h4>
<p>æœ€åé€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šè®¤è¯ç±»å‹ä¸º JWTï¼Œå¹¶é…ç½®æ ¸å¿ƒå‚æ•°ï¼ˆç­¾åæ–¹æ³•ã€å¯†é’¥ç­‰ï¼‰ã€‚æ¡†æ¶é»˜è®¤ä½¿ç”¨ <code>app/admin/service/configs/auth.yaml</code> ä½œä¸ºè®¤è¯é…ç½®æ–‡ä»¶ï¼Œç›´æ¥ä¿®æ”¹è¯¥æ–‡ä»¶å³å¯ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">authn:</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">"jwt"</span>                <span class="hljs-comment"># è®¤è¯ç±»å‹ï¼šjwt/oidc/preshared_keyï¼Œæ­¤å¤„æŒ‡å®šä¸º jwt</span>
  <span class="hljs-attr">jwt:</span>
    <span class="hljs-attr">method:</span> <span class="hljs-string">"HS256"</span>          <span class="hljs-comment"># ç­¾åç®—æ³•ï¼šæ”¯æŒå¯¹ç§°ç®—æ³•ï¼ˆHS256/HS384/HS512ï¼‰å’Œéå¯¹ç§°ç®—æ³•ï¼ˆRS256/RS384/RS512/ES256/ES384/ES512/Ed25519ï¼‰</span>
    <span class="hljs-attr">key:</span> <span class="hljs-string">"your-strong-secret-key-32bytes"</span>  <span class="hljs-comment"># ç­¾å/éªŒç­¾å¯†é’¥ï¼šHS ç³»åˆ—å¯¹ç§°ç®—æ³•éœ€ä¼ å…¥å­—ç¬¦ä¸²å¯†é’¥ï¼ˆå»ºè®® â‰¥32 å­—èŠ‚ï¼Œé«˜å¤æ‚åº¦ï¼‰ï¼›RS ç³»åˆ—éå¯¹ç§°ç®—æ³•éœ€ä¼ å…¥å…¬é’¥/ç§é’¥è·¯å¾„</span>
    <span class="hljs-attr">expiry:</span> <span class="hljs-number">7200</span>             <span class="hljs-comment"># å¯é€‰ï¼šToken è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ï¼Œé»˜è®¤ 7200 ç§’ï¼ˆ2 å°æ—¶ï¼‰</span>
    <span class="hljs-attr">refresh_expiry:</span> <span class="hljs-number">86400</span>    <span class="hljs-comment"># å¯é€‰ï¼šåˆ·æ–° Token è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ï¼Œé»˜è®¤ 86400 ç§’ï¼ˆ24 å°æ—¶ï¼‰</span>
</code></pre>
<blockquote>
<p>å®‰å…¨å»ºè®®ï¼šç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯†é’¥ï¼ˆkeyï¼‰ä¸¥ç¦ç¡¬ç¼–ç åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼å»ºè®®é€šè¿‡ç¯å¢ƒå˜é‡ï¼ˆå¦‚ <code>JWT_SECRET_KEY</code>ï¼‰æˆ–é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacosã€Apolloï¼‰æ³¨å…¥ï¼›è‹¥ä½¿ç”¨éå¯¹ç§°ç®—æ³•ï¼ˆå¦‚ RS256ï¼‰ï¼Œéœ€å°†å…¬é’¥/ç§é’¥æ–‡ä»¶æ”¾åœ¨é¡¹ç›®å®‰å…¨ç›®å½•ä¸‹ï¼Œé€šè¿‡è·¯å¾„é…ç½®ï¼ˆå¦‚ <code>public_key_path: "./conf/cert/jwt_public.pem"</code>ï¼‰å¼•å…¥ã€‚</p>
</blockquote>
<h3 data-id="heading-7">ä¸‰ã€é›†æˆéªŒè¯æ­¥éª¤</h3>
<p>å®Œæˆä¸Šè¿°é…ç½®åï¼Œå¯åŠ¨é¡¹ç›®å¹¶é€šè¿‡ä»¥ä¸‹æ­¥éª¤éªŒè¯ JWT é›†æˆæ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<ol>
<li>å¯åŠ¨ GoWind Admin æœåŠ¡ï¼šæ‰§è¡Œ <code>make run</code> æˆ– <code>go run main.go</code> æˆ– <code>gow run</code>ï¼›</li>
<li>è°ƒç”¨ç™»å½•æ¥å£è·å– JWT Tokenï¼šå‘ <code>/api/v1/login</code> å‘é€ POST è¯·æ±‚ï¼Œä¼ å…¥æ­£ç¡®çš„ç”¨æˆ·åå¯†ç ï¼Œå“åº”ä½“ä¸­ä¼šè¿”å›<code>access_token</code>ï¼ˆè®¿é—® Tokenï¼‰å’Œ <code>refresh_token</code>ï¼ˆåˆ·æ–° Tokenï¼‰ï¼›</li>
<li>æºå¸¦ Token è®¿é—®å—ä¿æŠ¤æ¥å£ï¼šåœ¨ HTTP è¯·æ±‚å¤´ä¸­æ·»åŠ  <code>Authorization: Bearer {access_token}</code>ï¼Œè°ƒç”¨éœ€è¦è®¤è¯çš„æ¥å£ï¼ˆå¦‚ <code>/api/v1/user/info</code>ï¼‰ï¼Œè‹¥è¿”å› 200 ä¸”æ•°æ®æ­£å¸¸ï¼Œè¯´æ˜è®¤è¯ç”Ÿæ•ˆï¼›</li>
<li>æµ‹è¯•è®¤è¯å¤±è´¥åœºæ™¯ï¼šä¸æºå¸¦ Token æˆ–æºå¸¦æ— æ•ˆ Token è®¿é—®å—ä¿æŠ¤æ¥å£ï¼Œåº”è¿”å› <code>401 Unauthorized</code> é”™è¯¯ï¼Œè¯´æ˜ä¸­é—´ä»¶æ­£å¸¸æ‹¦æˆªã€‚</li>
</ol>
<h3 data-id="heading-8">å››ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-9">1. è®¤è¯å™¨åˆ›å»ºå¤±è´¥ï¼ˆè¿”å› nilï¼‰</h4>
<p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
<ol>
<li><code>auth.yaml</code> é…ç½®æ–‡ä»¶ç¼ºå¤±æˆ– <code>authn</code> èŠ‚ç‚¹æœªé…ç½®ï¼›</li>
<li>jwt å­èŠ‚ç‚¹ç¼ºå¤±ï¼ˆå¦‚æœªé…ç½® <code>method</code> æˆ– <code>key</code>ï¼‰ï¼›</li>
<li>å¯†é’¥æ ¼å¼é”™è¯¯ï¼ˆå¦‚ HS256 å¯†é’¥é•¿åº¦ä¸è¶³ï¼‰ã€‚</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p>æ£€æŸ¥ <code>auth.yaml</code> é…ç½®å®Œæ•´æ€§ï¼Œç¡®ä¿ <code>authn.type</code> ä¸º <code>jwt</code> ä¸” <code>jwt</code> èŠ‚ç‚¹å‚æ•°æ­£ç¡®ï¼›æŸ¥çœ‹é¡¹ç›®æ—¥å¿—ï¼Œæ ¹æ®é”™è¯¯æç¤ºå®šä½é…ç½®é—®é¢˜ã€‚</p>
<h4 data-id="heading-10">2. Token éªŒè¯å¤±è´¥ï¼ˆ401 é”™è¯¯ï¼‰</h4>
<p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
<ol>
<li>Token å·²è¿‡æœŸï¼›</li>
<li>ç­¾åå¯†é’¥ä¸åŒ¹é…ï¼ˆå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å¯†é’¥ä¸ä¸€è‡´ï¼‰ï¼›</li>
<li>ç­¾åæ–¹æ³•ä¸åŒ¹é…ï¼ˆå¦‚å®¢æˆ·ç«¯ç”¨ HS256 ç­¾åï¼ŒæœåŠ¡ç«¯é…ç½®ä¸º RS256ï¼‰ï¼›</li>
<li>Token è¢«ç¯¡æ”¹ã€‚</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p>æ£€æŸ¥ Token è¿‡æœŸæ—¶é—´ï¼Œé‡æ–°è·å–æœ‰æ•ˆ Tokenï¼›ç¡®è®¤å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„å¯†é’¥å’Œç­¾åæ–¹æ³•å®Œå…¨ä¸€è‡´ï¼›é€šè¿‡ JWT è§£æå·¥å…·ï¼ˆå¦‚ <a href="https://link.juejin.cn?target=https%3A%2F%2Fjwt.io" target="_blank" title="https://jwt.io" ref="nofollow noopener noreferrer">jwt.io</a>ï¼‰éªŒè¯ Token åˆæ³•æ€§ã€‚</p>
<h4 data-id="heading-11">3. ç™½åå•æ¥å£ä»éœ€è®¤è¯</h4>
<p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
<p>ç™½åå•åŒ¹é…å™¨ <code>newRestWhiteListMatcher()</code> ä¸­æœªæ­£ç¡®é…ç½®æ¥å£è·¯å¾„ï¼›æ¥å£è·¯å¾„åŒ¹é…è§„åˆ™é”™è¯¯ï¼ˆå¦‚å¤§å°å†™ä¸åŒ¹é…ã€è·¯å¾„å‰ç¼€ç¼ºå¤±ï¼‰ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p>ä¿®æ”¹ <code>newRestWhiteListMatcher()</code> æ–¹æ³•ï¼Œæ·»åŠ æ­£ç¡®çš„æ¥å£è·¯å¾„åŒ¹é…è§„åˆ™ï¼Œç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// NewWhiteListMatcher åˆ›å»ºjwtç™½åå•</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newRestWhiteListMatcher</span><span class="hljs-params">()</span></span> selector.MatchFunc {
	whiteList := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">bool</span>)
	whiteList[adminV1.OperationAuthenticationServiceLogin] = <span class="hljs-literal">true</span>
	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, operation <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> {
		<span class="hljs-keyword">if</span> _, ok := whiteList[operation]; ok {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
		}
		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
	}
}
</code></pre>
<h3 data-id="heading-12">äº”ã€æ ¸å¿ƒé¡¹ç›®ä»“åº“</h3>
<p>è·å–æ¡†æ¶æºç ã€å°è£…ç»„ä»¶åŠæ›´å¤šè¯¦ç»†æ–‡æ¡£ï¼Œå¯è®¿é—®ä»¥ä¸‹æ ¸å¿ƒä»“åº“ï¼š</p>
<ul>
<li>GoWind Adminï¼ˆGiteeï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://gitee.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">gitee.com/tx7do/go-wiâ€¦</a>ï¼ˆå›½å†…é•œåƒï¼Œè®¿é—®æ›´å¿«ï¼‰</li>
<li>GoWind Adminï¼ˆGitHubï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://github.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">github.com/tx7do/go-wiâ€¦</a>ï¼ˆå®˜æ–¹ä¸»ä»“åº“ï¼ŒåŒæ­¥æ›´æ–°ï¼‰</li>
<li>Kratos-Authnï¼ˆJWT/OIDC å°è£…ç»„ä»¶ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fkratos-authn" target="_blank" title="https://github.com/tx7do/kratos-authn" ref="nofollow noopener noreferrer">github.com/tx7do/kratoâ€¦</a>ï¼ˆJWT æ ¸å¿ƒé€»è¾‘å°è£…ï¼Œæ”¯æŒå¤šç§è®¤è¯åè®®æ‰©å±•ï¼‰</li>
</ul>
<h3 data-id="heading-13">å…­ã€æ€»ç»“</h3>
<p>é€šè¿‡ GoWind Admin å°è£…çš„ <code>kratos-authn</code> ç»„ä»¶ï¼Œå¼€å‘è€…æ— éœ€å…³æ³¨ JWT åº•å±‚å®ç°ç»†èŠ‚ï¼Œä»…éœ€ 4 æ­¥å³å¯å®Œæˆé›†æˆï¼Œå¤§å¹…æå‡å¼€å‘æ•ˆç‡ã€‚é›†æˆåï¼Œæ¡†æ¶å°†è‡ªåŠ¨å¤„ç† Token çš„ç”Ÿæˆã€æ ¡éªŒã€è¿‡æœŸç­‰é€»è¾‘ï¼Œå¹¶æ— ç¼å¯¹æ¥ OPA æƒé™ç®¡æ§ä½“ç³»ï¼Œä¸ºä¸­åå°ç³»ç»Ÿæä¾›å®‰å…¨ã€å¯é çš„èº«ä»½è®¤è¯èƒ½åŠ›ã€‚</p>
<p>åç»­å¯åŸºäºè¯¥é›†æˆæ–¹æ¡ˆï¼Œæ‰©å±•æ›´å¤šé«˜çº§ç‰¹æ€§ï¼Œå¦‚ï¼šToken åˆ·æ–°æœºåˆ¶ã€å¤šç§Ÿæˆ·å¯†é’¥éš”ç¦»ã€Token é»‘åå•ç®¡ç†ç­‰ï¼Œæ»¡è¶³ä¼ä¸šçº§ç³»ç»Ÿçš„å¤æ‚å®‰å…¨éœ€æ±‚ã€‚è‹¥åœ¨é›†æˆè¿‡ç¨‹ä¸­æœ‰ä»»ä½•é—®é¢˜ï¼Œå¯é€šè¿‡é¡¹ç›®ä»“åº“çš„ Issues æäº¤åé¦ˆï¼Œæˆ–åŠ å…¥æ¡†æ¶å®˜æ–¹ç¤¾åŒºè·å–æŠ€æœ¯æ”¯æŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäºMarkwonå°è£…Markdownç»„ä»¶]]></title>    <link>https://juejin.cn/post/7583906478328725523</link>    <guid>https://juejin.cn/post/7583906478328725523</guid>    <pubDate>2025-12-15T13:16:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906478328725523" data-draft-id="7583912899389161515" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäºMarkwonå°è£…Markdownç»„ä»¶"/> <meta itemprop="keywords" content="Android,AIGC,Markdown"/> <meta itemprop="datePublished" content="2025-12-15T13:16:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŠå±±å±…å£«"/> <meta itemprop="url" content="https://juejin.cn/user/627178281904907"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäºMarkwonå°è£…Markdownç»„ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/627178281904907/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŠå±±å±…å£«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T13:16:59.000Z" title="Mon Dec 15 2025 13:16:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">ä¸€ã€èƒŒæ™¯</h2>
<p>åœ¨ç”Ÿæˆå¼ AI æŠ€æœ¯å¿«é€Ÿå‘å±•çš„å½“ä¸‹ï¼Œå¤§æ¨¡å‹é©±åŠ¨çš„æ™ºèƒ½åº”ç”¨æ­£é‡å¡‘äººæœºäº¤äº’æ–¹å¼ã€‚æ™ºèƒ½å®¢æœã€çŸ¥è¯†é—®ç­”ç³»ç»Ÿã€AI åŠ©æ‰‹ç­‰åœºæ™¯ä¸­ï¼ŒMarkdown å‡­å€Ÿç®€æ´é«˜æ•ˆçš„ç»“æ„åŒ–è¡¨è¾¾èƒ½åŠ›ï¼Œæˆä¸º AI å†…å®¹å‘ˆç°çš„æ ¸å¿ƒè½½ä½“ã€‚
ä½†åœ¨ Android åŸç”Ÿå¼€å‘ä¸­ï¼Œå®ç°é«˜æ€§èƒ½çš„ Markdown å®æ—¶æ¸²æŸ“ä»é¢ä¸´æŒ‘æˆ˜ï¼šæ—¢è¦ä¿è¯æµå¼å¢é‡è¾“å‡ºçš„æµç•…æ€§ï¼Œåˆè¦æ”¯æŒçµæ´»çš„è‡ªå®šä¹‰æ ·å¼é€‚é…ï¼Œè¿™å¯¹æ¸²æŸ“å¼•æ“çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§æå‡ºäº†æ›´é«˜è¦æ±‚ã€‚
Android ç«¯æˆç†Ÿçš„ Markdown æ¸²æŸ“æ¡†æ¶ Markwonï¼ˆGithubï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnoties%2FMarkwon%25EF%25BC%2589%25E5%259F%25BA%25E4%25BA%258E" target="_blank" title="https://github.com/noties/Markwon%EF%BC%89%E5%9F%BA%E4%BA%8E" ref="nofollow noopener noreferrer">github.com/noties/Markâ€¦</a> CommonMark-Java å®ç°æ ¸å¿ƒè§£æï¼Œå…¶æ’ä»¶åŒ–æ¶æ„å…·å¤‡å¤©ç„¶çš„æ‰©å±•èƒ½åŠ›ã€‚å‡ºäºé¿å…é‡å¤é€ è½®å­çš„è€ƒé‡ï¼Œæœ¬æ–‡å…ˆå‰–æ CommonMark-Java ä¸ Markwon çš„æ ¸å¿ƒåŸç†ï¼Œå†é˜è¿°å¦‚ä½•åŸºäº Markwon æ‰©å±•å®ç°è‡ªå®šä¹‰æ¸²æŸ“éœ€æ±‚ã€‚</p>
<h2 data-id="heading-1">äºŒã€CommonMark-Java æ¡†æ¶</h2>
<p>CommonMark-Java æ˜¯ç¬¦åˆ CommonMark æ ‡å‡†çš„è½»é‡çº§ Markdown è§£æåº“ï¼Œæ ¸å¿ƒèƒ½åŠ›æ˜¯å°† Markdown æ–‡æœ¬è½¬æ¢ä¸ºç»“æ„åŒ– ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œæ”¯æŒæ‰©å±•åè®®ä½†ä¸æä¾›æ¸²æŸ“èƒ½åŠ›ï¼Œé€‚ç”¨äº Java/Kotlin é¡¹ç›®çš„åŸºç¡€è§£æéœ€æ±‚ã€‚</p>
<h3 data-id="heading-2">1ã€NodeèŠ‚ç‚¹</h3>
<p>Node æ˜¯ CommonMark-Java çš„æ ¸å¿ƒæŠ½è±¡ç±»ï¼Œä»£è¡¨ Markdown è§£æåç”Ÿæˆçš„ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼Œå¯ç†è§£ä¸º Markdown æ–‡æ¡£çš„ç»“æ„åŒ–æ ‘å½¢è¡¨ç¤ºï¼‰èŠ‚ç‚¹ï¼Œæ‰€æœ‰ Markdown å…ƒç´ ï¼ˆå¦‚æ®µè½ã€æ ‡é¢˜ã€ä»£ç å—ç­‰ï¼‰å‡ç»§æ‰¿è‡ªè¯¥ç±»ã€‚</p>
<p>ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">Node</span> <span class="hljs-variable">parent</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">Node</span> <span class="hljs-variable">firstChild</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">Node</span> <span class="hljs-variable">lastChild</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">Node</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">Node</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Visitor visitor)</span>;

    <span class="hljs-comment">// çœç•¥get/setæ–¹æ³•...</span>
}
</code></pre>
<p><strong>Node ç±»çš„æ ¸å¿ƒç‰¹æ€§ï¼š</strong></p>
<ul>
<li>è¡¨ç¤º Markdown æ–‡æ¡£ç»“æ„ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼›</li>
<li>é‡‡ç”¨åŒå‘é“¾è¡¨ç»“æ„ï¼ˆé€šè¿‡ prevã€next ç»´æŠ¤åŒçº§èŠ‚ç‚¹å…³ç³»ï¼‰ï¼›</li>
<li>åŒæ—¶ç»´æŠ¤çˆ¶å­å…³ç³»ï¼ˆé€šè¿‡ parentã€firstChildã€lastChildï¼‰ï¼›</li>
<li>æ”¯æŒè®¿é—®è€…æ¨¡å¼éå† ASTï¼›</li>
<li>ä»… Blockï¼ˆå—çº§ï¼‰èŠ‚ç‚¹æ”¯æŒåŒ…å«å­èŠ‚ç‚¹ï¼Œå†…è”èŠ‚ç‚¹æ— çˆ¶å­å±‚çº§ã€‚</li>
</ul>
<h4 data-id="heading-3">1.1ã€Blockï¼ˆå—çº§èŠ‚ç‚¹ï¼‰</h4>
<p>Block æ˜¯ Node çš„å­ç±»ï¼Œä½œä¸ºæ‰€æœ‰å—çº§èŠ‚ç‚¹çš„çˆ¶ç±»ï¼Œä»£è¡¨ Markdown æ–‡æ¡£ä¸­çš„ç‹¬ç«‹å—çº§å…ƒç´ ï¼ˆå¦‚æ®µè½ã€æ ‡é¢˜ã€ä»£ç å—ç­‰ï¼‰ã€‚</p>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Block</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Node</span> </span>{
    <span class="hljs-comment">// æ‰€æœ‰å—çº§èŠ‚ç‚¹å…±äº«çš„åŸºç¡€å±æ€§å’Œæ–¹æ³•</span>
}
</code></pre>
<p><strong>Blockçš„æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>å—çº§è¯­ä¹‰ï¼šå æ®ç‹¬ç«‹çš„å‚ç›´ç©ºé—´ï¼Œå‰åé»˜è®¤æ¢è¡Œï¼›</li>
<li>å®¹å™¨ç‰¹æ€§ï¼šå¯åŒ…å«å…¶ä»–å—çº§æˆ–å†…è”èŠ‚ç‚¹ï¼›</li>
<li>ç‹¬ç«‹æ€§ï¼šåœ¨æ–‡æ¡£æµä¸­å½¢æˆç‹¬ç«‹çš„ç»“æ„å•å…ƒã€‚</li>
</ul>
<p>åœ¨CommonMark-Javaä¸­ï¼ŒBlock çš„æ ¸å¿ƒå­ç±»ï¼š</p>
<ul>
<li>Documentï¼šAST æ ¹èŠ‚ç‚¹ï¼Œæ— å¯¹åº”è¯­æ³•ï¼›</li>
<li>Headingï¼šæ ‡é¢˜ï¼ˆ#/##/...ï¼‰ï¼ŒåŒ…å« level å±æ€§ï¼ˆ1-6 çº§ï¼‰ï¼›</li>
<li>Paragraphï¼šæ®µè½ï¼Œæœ€åŸºç¡€çš„æ–‡æœ¬å®¹å™¨ï¼›</li>
<li>BlockQuoteï¼šå¼•ç”¨å—ï¼ˆ&gt; å¼€å¤´ï¼‰ï¼Œå¯åµŒå¥—å…¶ä»–å—çº§èŠ‚ç‚¹ï¼›</li>
<li>ListBlockï¼šåˆ—è¡¨å®¹å™¨ï¼Œå­ç±»ä¸º OrderedListï¼ˆæœ‰åºï¼‰ã€BulletListï¼ˆæ— åºï¼‰ï¼Œå­èŠ‚ç‚¹ä¸º ListItemï¼›</li>
<li>ListItemï¼šåˆ—è¡¨é¡¹ï¼Œå¯åŒ…å«å…¶ä»–å—çº§èŠ‚ç‚¹ï¼›</li>
<li>FencedCodeBlockï¼šå›´æ ä»£ç å—ï¼ˆ```/~~~ï¼‰ï¼ŒåŒ…å« literalï¼ˆä»£ç å†…å®¹ï¼‰ã€infoï¼ˆè¯­è¨€æ ‡è¯†ï¼‰ï¼›</li>
<li>IndentedCodeBlockï¼šç¼©è¿›ä»£ç å—ï¼ˆ4 ä¸ªç©ºæ ¼ / 1 ä¸ªåˆ¶è¡¨ç¬¦ï¼‰ï¼ŒåŒ…å« literalï¼›</li>
<li>HtmlBlockï¼šHTML å—ï¼ŒåŒ…å« literalï¼ˆåŸå§‹ HTML å†…å®¹ï¼‰ï¼›</li>
<li>ThematicBreakï¼šåˆ†å‰²çº¿ï¼ˆ---/*** /___ï¼‰ï¼Œæ— å†…å®¹ä»…ä½œè§†è§‰åˆ†å‰²ã€‚</li>
</ul>
<h4 data-id="heading-4">1.2ã€Inline Nodes</h4>
<p>å†…è”èŠ‚ç‚¹æ˜¯ AST çš„ç»„æˆéƒ¨åˆ†ï¼Œç”¨äºè¡¨ç¤ºè¡Œå†…çº§å…ƒç´ ï¼ˆå¦‚æ–‡æœ¬ã€åŠ ç²—ã€é“¾æ¥ç­‰ï¼‰ï¼Œä¾é™„äºå—çº§èŠ‚ç‚¹å­˜åœ¨ï¼ˆå¦‚æ®µè½å†…çš„åŠ ç²—æ–‡æœ¬ï¼‰ï¼Œæ— çˆ¶å­å±‚çº§ã€‚</p>
<p>æ ¸å¿ƒå†…è”èŠ‚ç‚¹ï¼š</p>
<ul>
<li>Textï¼šæ™®é€šæ–‡æœ¬ï¼ŒåŒ…å« literal å±æ€§ï¼›</li>
<li>Emphasisï¼šå¼ºè°ƒæ–‡æœ¬ï¼ˆæ–œä½“ï¼‰ï¼ŒåŒ…å« delimiterï¼ˆ* /_ï¼‰ï¼›</li>
<li>StrongEmphasisï¼šåŠ ç²—æ–‡æœ¬ï¼ŒåŒ…å« delimiterï¼ˆ** /__ï¼‰ï¼›</li>
<li>Linkï¼šé“¾æ¥ï¼ŒåŒ…å« destinationï¼ˆURLï¼‰ã€titleï¼ˆå¯é€‰æ ‡é¢˜ï¼‰ï¼›</li>
<li>Imageï¼šå›¾ç‰‡ï¼ŒåŒ…å« title å±æ€§ï¼›</li>
<li>Codeï¼šè¡Œå†…ä»£ç ï¼ŒåŒ…å« literalï¼›</li>
<li>HtmlInlineï¼šè¡Œå†… HTMLï¼ˆå¦‚
ï¼‰ï¼ŒåŒ…å« literalï¼›</li>
<li>SoftLineBreakï¼šè½¯æ¢è¡Œï¼ˆè¡Œå°¾ 2 ä¸ªç©ºæ ¼ / æ™®é€šæ¢è¡Œï¼‰ï¼Œæ¸²æŸ“ä¸ºç©ºæ ¼ / æ¢è¡Œï¼›</li>
<li>HardLineBreakï¼šç¡¬æ¢è¡Œï¼ˆè¡Œå°¾ \ï¼‰ï¼Œæ¸²æŸ“ä¸ºå¼ºåˆ¶æ¢è¡Œã€‚</li>
</ul>
<h4 data-id="heading-5">1.3ã€CustomNode</h4>
<p>ç”¨äºæ‰©å±•è‡ªå®šä¹‰èŠ‚ç‚¹ï¼Œæ»¡è¶³ CommonMark æ ‡å‡†å¤–çš„ä¸ªæ€§åŒ–è§£æéœ€æ±‚ã€‚</p>
<h4 data-id="heading-6">1.4ã€å°ç»“</h4>
<p>CommonMark-Java ç”Ÿæˆçš„ AST æ ‘å½¢ç»“æ„ï¼Œä¸ Android çš„ View Treeï¼ˆè§†å›¾æ ‘ï¼‰é«˜åº¦ç›¸ä¼¼ï¼š</p>
<ul>
<li>Block èŠ‚ç‚¹ â‰ˆ ViewGroupï¼ˆå¯åŒ…å«å­èŠ‚ç‚¹ï¼‰ï¼›</li>
<li>å†…è”èŠ‚ç‚¹ â‰ˆ Viewï¼ˆæ— åµŒå¥—ï¼‰ã€‚
ç†è§£è¿™ä¸€å¯¹åº”å…³ç³»ï¼Œèƒ½å¤§å¹…é™ä½åç»­æ‰©å±•å¼€å‘çš„ç†è§£æˆæœ¬ã€‚</li>
</ul>
<h3 data-id="heading-7">2ã€è§£ææµç¨‹</h3>
<p>CommonMark-Java çš„æ ¸å¿ƒè§£æå…¥å£æ˜¯ Parser ç±»ï¼ˆåŸºäº Builder æ¨¡å¼æ„å»ºï¼‰ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯å°† Markdown æ–‡æœ¬æ‹†åˆ†ä¸º â€œå—çº§è§£æâ€ å’Œ â€œå†…è”è§£æâ€ ä¸¤æ­¥ï¼š</p>
<p>æ ¸å¿ƒè°ƒåº¦ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> Node <span class="hljs-title function_">parseReader</span><span class="hljs-params">(Reader input)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">if</span> (input == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">"input must not be null"</span>);
        }

        <span class="hljs-type">DocumentParser</span> <span class="hljs-variable">documentParser</span> <span class="hljs-operator">=</span> createDocumentParser();
        <span class="hljs-type">Node</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> documentParser.parse(input);
        <span class="hljs-keyword">return</span> postProcess(document);
    }

    <span class="hljs-keyword">private</span> DocumentParser <span class="hljs-title function_">createDocumentParser</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DocumentParser</span>(blockParserFactories, inlineParserFactory, delimiterProcessors);
    }
</code></pre>
<p>æœ€ç»ˆè§£æé€»è¾‘ç”±ä¸¤ä¸ªæ¥å£å®ç°ï¼š</p>
<ul>
<li>BlockParserï¼šè´Ÿè´£å—çº§èŠ‚ç‚¹çš„è§£æï¼›</li>
<li>InlineParserï¼šè´Ÿè´£å†…è”èŠ‚ç‚¹çš„è§£æã€‚
ä¸¤è€…ååŒç”Ÿæˆå®Œæ•´çš„ ASTã€‚</li>
</ul>
<h2 data-id="heading-8">ä¸‰ã€Markwon æ¡†æ¶</h2>
<p>Markwon åŸºäº CommonMark-Java çš„è§£æèƒ½åŠ›ï¼Œæ‰©å±•äº† Android ç«¯çš„ Markdown æ¸²æŸ“èƒ½åŠ›ï¼Œæ ¸å¿ƒé‡‡ç”¨ â€œæ’ä»¶åŒ–æ¶æ„ + Span æ¸²æŸ“â€ è®¾è®¡ï¼Œæ”¯æŒè‡ªå®šä¹‰æ¸²æŸ“è§„åˆ™å’Œæ ·å¼ã€‚</p>
<h3 data-id="heading-9">1ã€å·¥ä½œæµç¨‹</h3>
<p>Markwon çš„æ¸²æŸ“æµç¨‹åˆ†ä¸º 6 ä¸ªé˜¶æ®µï¼Œæ•´ä½“é€»è¾‘å›´ç»• â€œè§£æ ASTâ†’é¢„å¤„ç†â†’æ¸²æŸ“ Spanâ†’åå¤„ç†â†’ç»‘å®šåˆ° TextViewâ€ å±•å¼€ï¼š</p>
<h4 data-id="heading-10">1.1ã€é…ç½®æˆªæ–­</h4>
<p>Markwon çš„æ ¸å¿ƒé…ç½®é€šè¿‡ MarkwonBuilderImpl çš„ build æ–¹æ³•å®Œæˆï¼Œæ ¸å¿ƒæ˜¯åˆå§‹åŒ–è§£æå™¨ã€ä¸»é¢˜ã€é…ç½®ã€Visitorã€Span å·¥å‚ï¼Œå¹¶é€šè¿‡æ’ä»¶æ‰©å±•èƒ½åŠ›ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@NonNull</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> Markwon <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {

    <span class="hljs-keyword">if</span> (plugins.isEmpty()) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"No plugins were added to this builder. Use #usePlugin "</span> +
                <span class="hljs-string">"method to add them"</span>);
    }

    <span class="hljs-comment">// please note that this method must not modify supplied collection</span>
    <span class="hljs-comment">// if nothing should be done -&gt; the same collection can be returned</span>
    <span class="hljs-keyword">final</span> List&lt;MarkwonPlugin&gt; plugins = preparePlugins(<span class="hljs-built_in">this</span>.plugins);

    <span class="hljs-keyword">final</span> Parser.<span class="hljs-type">Builder</span> <span class="hljs-variable">parserBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Parser</span>.Builder();
    <span class="hljs-keyword">final</span> MarkwonTheme.<span class="hljs-type">Builder</span> <span class="hljs-variable">themeBuilder</span> <span class="hljs-operator">=</span> MarkwonTheme.builderWithDefaults(context);
    <span class="hljs-keyword">final</span> MarkwonConfiguration.<span class="hljs-type">Builder</span> <span class="hljs-variable">configurationBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarkwonConfiguration</span>.Builder();
    <span class="hljs-keyword">final</span> MarkwonVisitor.<span class="hljs-type">Builder</span> <span class="hljs-variable">visitorBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarkwonVisitorImpl</span>.BuilderImpl();
    <span class="hljs-keyword">final</span> MarkwonSpansFactory.<span class="hljs-type">Builder</span> <span class="hljs-variable">spanFactoryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarkwonSpansFactoryImpl</span>.BuilderImpl();

    <span class="hljs-keyword">for</span> (MarkwonPlugin plugin : plugins) {
        plugin.configureParser(parserBuilder);
        plugin.configureTheme(themeBuilder);
        plugin.configureConfiguration(configurationBuilder);
        plugin.configureVisitor(visitorBuilder);
        plugin.configureSpansFactory(spanFactoryBuilder);
    }

    <span class="hljs-keyword">final</span> <span class="hljs-type">MarkwonConfiguration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> configurationBuilder.build(
            themeBuilder.build(),
            spanFactoryBuilder.build());

    <span class="hljs-comment">// @since 4.1.1</span>
    <span class="hljs-comment">// @since 4.1.2 - do not reuse render-props (each render call should have own render-props)</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">MarkwonVisitorFactory</span> <span class="hljs-variable">visitorFactory</span> <span class="hljs-operator">=</span> MarkwonVisitorFactory.create(
            visitorBuilder,
            configuration);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarkwonImpl</span>(
            bufferType,
            textSetter,
            parserBuilder.build(),
            visitorFactory,
            configuration,
            Collections.unmodifiableList(plugins),
            fallbackToRawInputWhenEmpty
    );
}
</code></pre>
<p>Markwon é»˜è®¤é€šè¿‡ create/builder æ–¹æ³•åˆå§‹åŒ–ï¼Œå¹¶è‡ªåŠ¨æ·»åŠ  CorePlugin æ ¸å¿ƒæ’ä»¶ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Markwon <span class="hljs-title function_">create</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Context context)</span> {
        <span class="hljs-keyword">return</span> builder(context)
                .usePlugin(CorePlugin.create())
                .build();
    }

    <span class="hljs-meta">@NonNull</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Builder <span class="hljs-title function_">builder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Context context)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarkwonBuilderImpl</span>(context)
                <span class="hljs-comment">// @since 4.0.0 add CorePlugin</span>
                .usePlugin(CorePlugin.create());
    }
</code></pre>
<h4 data-id="heading-11">1.2ã€è§£æé˜¶æ®µ</h4>
<p>å°† Markdown å­—ç¬¦ä¸²è½¬æ¢ä¸º ASTï¼ˆNode å¯¹è±¡ï¼‰ï¼Œæ ¸å¿ƒå¤ç”¨ CommonMark-Java çš„ Parser èƒ½åŠ›ï¼Œä¸”è§£æå‰ä¼šé€šè¿‡æ’ä»¶é¢„å¤„ç†æ–‡æœ¬ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@NonNull</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> Node <span class="hljs-title function_">parse</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> String input)</span> {

    <span class="hljs-comment">// make sure that all plugins are called `processMarkdown` before parsing</span>
    <span class="hljs-keyword">for</span> (MarkwonPlugin plugin : plugins) {
        input = plugin.processMarkdown(input);
    }

    <span class="hljs-keyword">return</span> parser.parse(input);
}
</code></pre>
<h4 data-id="heading-12">1.3ã€é¢„å¤„ç†é˜¶æ®µ</h4>
<p>æ¸²æŸ“å‰é€šè¿‡æ’ä»¶ä¿®æ”¹ ASTã€æ”¶é›†å…¨å±€ä¿¡æ¯ï¼Œæ ¸å¿ƒè°ƒç”¨æ’ä»¶çš„ beforeRender æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java">   <span class="hljs-meta">@NonNull</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Spanned <span class="hljs-title function_">render</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Node node)</span> {

        <span class="hljs-keyword">for</span> (MarkwonPlugin plugin : plugins) {
            plugin.beforeRender(node);
        }
        
        ...
        
        <span class="hljs-keyword">return</span> spanned;
    }
</code></pre>
<p>æ’ä»¶å¯åœ¨æ­¤é˜¶æ®µæ‰§è¡Œï¼š</p>
<ul>
<li>ä¿®æ”¹ AST ç»“æ„ï¼ˆæ·»åŠ  / åˆ é™¤ / æ›¿æ¢èŠ‚ç‚¹ï¼‰ï¼›</li>
<li>æ”¶é›†å…¨å±€æ¸²æŸ“ä¿¡æ¯ï¼ˆå¦‚ç»Ÿè®¡ä»£ç å—æ•°é‡ï¼‰ï¼›</li>
<li>å‡†å¤‡æ¸²æŸ“ä¸Šä¸‹æ–‡æ•°æ®ï¼ˆå¦‚å›¾ç‰‡åŠ è½½ç¼“å­˜ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-13">1.4ã€æ¸²æŸ“é˜¶æ®µ</h4>
<p>å°† AST è½¬æ¢ä¸º Android çš„ Spanned æ–‡æœ¬ï¼ˆæ ¸å¿ƒæ˜¯ Span æ¸²æŸ“ï¼‰ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯é€šè¿‡è®¿é—®è€…æ¨¡å¼éå† ASTï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆå¯¹åº” Spanï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@NonNull</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Spanned <span class="hljs-title function_">render</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Node node)</span> {
        ...
        <span class="hljs-comment">// @since 4.1.1 obtain visitor via factory</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">MarkwonVisitor</span> <span class="hljs-variable">visitor</span> <span class="hljs-operator">=</span> visitorFactory.create();
        node.accept(visitor);
        
        ...
        
        <span class="hljs-keyword">return</span> spanned;
    }
</code></pre>
<p>éå†æ ¸å¿ƒé€»è¾‘ï¼ˆMarkwonVisitorImplï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Node node)</span> {
    <span class="hljs-comment">// è·å–èŠ‚ç‚¹å¯¹åº”çš„å¤„ç†å™¨</span>
    <span class="hljs-keyword">final</span> NodeVisitor&lt;Node&gt; nodeVisitor = (NodeVisitor&lt;Node&gt;) nodes.get(node.getClass());
    <span class="hljs-keyword">if</span> (nodeVisitor != <span class="hljs-literal">null</span>) {
        nodeVisitor.visit(<span class="hljs-built_in">this</span>, node); <span class="hljs-comment">// ç”Ÿæˆå¯¹åº”Span</span>
    } <span class="hljs-keyword">else</span> {
        visitChildren(node); <span class="hljs-comment">// é€’å½’éå†å­èŠ‚ç‚¹</span>
    }
}
</code></pre>
<h4 data-id="heading-14">1.5ã€åå¤„ç†é˜¶æ®µ</h4>
<p>æ¸²æŸ“å®Œæˆåé€šè¿‡æ’ä»¶ä¼˜åŒ– Spanned æ–‡æœ¬ï¼Œæ ¸å¿ƒè°ƒç”¨æ’ä»¶çš„ afterRender æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@NonNull</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Spanned <span class="hljs-title function_">render</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Node node)</span> {
        ...
        <span class="hljs-keyword">for</span> (MarkwonPlugin plugin : plugins) {
            plugin.afterRender(node, visitor);
        }
        <span class="hljs-comment">//noinspection UnnecessaryLocalVariable</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">Spanned</span> <span class="hljs-variable">spanned</span> <span class="hljs-operator">=</span> visitor.builder().spannableStringBuilder();
        <span class="hljs-keyword">return</span> spanned;
    }
</code></pre>
<h4 data-id="heading-15">1.6ã€åº”ç”¨é˜¶æ®µ</h4>
<p>å°† Spanned æ–‡æœ¬ç»‘å®šåˆ° TextViewï¼Œæ ¸å¿ƒæ˜¯ setParsedMarkdown æ–¹æ³•ï¼Œæ”¯æŒæ’ä»¶åœ¨ç»‘å®šå‰åè‡ªå®šä¹‰é€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMarkdown</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> TextView textView, <span class="hljs-meta">@NonNull</span> String markdown)</span> {
    setParsedMarkdown(textView, toMarkdown(markdown));
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setParsedMarkdown</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> <span class="hljs-keyword">final</span> TextView textView, <span class="hljs-meta">@NonNull</span> Spanned markdown)</span> {

    <span class="hljs-keyword">for</span> (MarkwonPlugin plugin : plugins) {
        plugin.beforeSetText(textView, markdown);
    }
    <span class="hljs-comment">// @since 4.1.0</span>
    <span class="hljs-keyword">if</span> (textSetter != <span class="hljs-literal">null</span>) {
        textSetter.setText(textView, markdown, bufferType, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                <span class="hljs-comment">// on-complete we just must call `afterSetText` on all plugins</span>
                <span class="hljs-keyword">for</span> (MarkwonPlugin plugin : plugins) {
                    plugin.afterSetText(textView);
                }
            }
        });
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// if no text-setter is specified -&gt; just a regular sync operation</span>
        textView.setText(markdown, bufferType);
        <span class="hljs-keyword">for</span> (MarkwonPlugin plugin : plugins) {
            plugin.afterSetText(textView);
        }
    }
}
</code></pre>
<h3 data-id="heading-16">2ã€Pluginæœºåˆ¶ï¼ˆæ‰©å±•æ ¸å¿ƒï¼‰</h3>
<p>Plugin æ˜¯ Markwon æ‰©å±•æ€§çš„æ ¸å¿ƒï¼Œé‡‡ç”¨æ’ä»¶åŒ–æ¶æ„è®¾è®¡ï¼Œå…è®¸å¼€å‘è€…è‡ªå®šä¹‰è§£æã€æ¸²æŸ“ã€ç»‘å®šå…¨æµç¨‹çš„é€»è¾‘ã€‚</p>
<h4 data-id="heading-17">2.1ã€MarkwonPluginæ¥å£å®šä¹‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MarkwonPlugin</span> {
    <span class="hljs-comment">// å…¨å±€é…ç½®é˜¶æ®µï¼šæ³¨å†Œæ‰©å±•èƒ½åŠ›</span>
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Registry registry)</span> {}
    
    <span class="hljs-comment">// é…ç½®æ„å»ºé˜¶æ®µï¼šè‡ªå®šä¹‰å…¨å±€é…ç½®</span>
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureConfiguration</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MarkwonConfiguration.Builder builder)</span> {}
    
    <span class="hljs-comment">// æ¸²æŸ“å™¨é…ç½®ï¼šè‡ªå®šä¹‰èŠ‚ç‚¹Visitor</span>
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureVisitor</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MarkwonVisitor.Builder builder)</span> {}
    
    <span class="hljs-comment">// æ¸²æŸ“å‰ï¼šä¿®æ”¹AST/æ”¶é›†ä¿¡æ¯</span>
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeRender</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Node node)</span> {}
    
    <span class="hljs-comment">// æ¸²æŸ“åï¼šä¼˜åŒ–Spannedæ–‡æœ¬</span>
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterRender</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Node node, <span class="hljs-meta">@NonNull</span> MarkwonVisitor visitor)</span> {}
    
    <span class="hljs-comment">// Spanå·¥å‚é…ç½®ï¼šè‡ªå®šä¹‰èŠ‚ç‚¹Spanæ ·å¼</span>
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureSpansFactory</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MarkwonSpansFactory.Builder builder)</span> {}
    
    <span class="hljs-comment">// æ–‡æœ¬ç»‘å®šå‰ï¼šé¢„å¤„ç†TextView</span>
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeSetText</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> TextView textView, <span class="hljs-meta">@NonNull</span> Spanned markdown)</span> {}
    
    <span class="hljs-comment">// æ–‡æœ¬ç»‘å®šåï¼šåç½®å¤„ç†ï¼ˆå¦‚å›¾ç‰‡æ‡’åŠ è½½ï¼‰</span>
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterSetText</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> TextView textView)</span> {}
}
</code></pre>
<ul>
<li>é…ç½®é˜¶æ®µï¼šconfigure() â†’ configureConfiguration() â†’ configureVisitor() â†’ configureSpansFactory()</li>
<li>æ¸²æŸ“é˜¶æ®µï¼šbeforeRender() â†’ æ ¸å¿ƒæ¸²æŸ“ â†’ afterRender()</li>
<li>åº”ç”¨é˜¶æ®µï¼šbeforeSetText() â†’ è®¾ç½®æ–‡æœ¬ â†’ afterSetText()</li>
</ul>
<h4 data-id="heading-18">2.2ã€CorePluginï¼ˆæ ¸å¿ƒé»˜è®¤æ’ä»¶ï¼‰</h4>
<p>CorePlugin æ˜¯ Markwon çš„å†…ç½®æ ¸å¿ƒæ’ä»¶ï¼Œå…¶æ ¸å¿ƒèŒè´£æ˜¯ä¸º CommonMark æ ‡å‡†çš„åŸºç¡€èŠ‚ç‚¹æ³¨å†Œå¯¹åº”çš„ NodeVisitor å’Œ SpanFactoryï¼Œè¦†ç›–æ‰€æœ‰æ ¸å¿ƒå—çº§ / å†…è”èŠ‚ç‚¹çš„é»˜è®¤æ¸²æŸ“é€»è¾‘ï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorePlugin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMarkwonPlugin</span> {

    <span class="hljs-meta">@NonNull</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CorePlugin <span class="hljs-title function_">create</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorePlugin</span>();
    }

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> a set with enabled by default block types
     * <span class="hljs-doctag">@since</span> 4.4.0
     */</span>
    <span class="hljs-meta">@NonNull</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Set&lt;Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Block</span>&gt;&gt; enabledBlockTypes() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;(Arrays.asList(
                BlockQuote.class,
                Heading.class,
                FencedCodeBlock.class,
                HtmlBlock.class,
                ThematicBreak.class,
                ListBlock.class,
                IndentedCodeBlock.class
        ));
    }

    <span class="hljs-comment">// @since 4.0.0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;OnTextAddedListener&gt; onTextAddedListeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-number">0</span>);

    <span class="hljs-comment">// @since 4.5.0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> hasExplicitMovementMethod;

    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">CorePlugin</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@since</span> 4.5.0
     */</span>
    <span class="hljs-meta">@SuppressWarnings("UnusedReturnValue")</span>
    <span class="hljs-meta">@NonNull</span>
    <span class="hljs-keyword">public</span> CorePlugin <span class="hljs-title function_">hasExplicitMovementMethod</span><span class="hljs-params">(<span class="hljs-type">boolean</span> hasExplicitMovementMethod)</span> {
        <span class="hljs-built_in">this</span>.hasExplicitMovementMethod = hasExplicitMovementMethod;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-comment">/**
     * Can be useful to post-process text added. For example for auto-linking capabilities.
     *
     * <span class="hljs-doctag">@see</span> OnTextAddedListener
     * <span class="hljs-doctag">@since</span> 4.0.0
     */</span>
    <span class="hljs-meta">@SuppressWarnings("UnusedReturnValue")</span>
    <span class="hljs-meta">@NonNull</span>
    <span class="hljs-keyword">public</span> CorePlugin <span class="hljs-title function_">addOnTextAddedListener</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> OnTextAddedListener onTextAddedListener)</span> {
        onTextAddedListeners.add(onTextAddedListener);
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureVisitor</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MarkwonVisitor.Builder builder)</span> {
        text(builder);
        strongEmphasis(builder);
        emphasis(builder);
        blockQuote(builder);
        code(builder);
        fencedCodeBlock(builder);
        indentedCodeBlock(builder);
        image(builder);
        bulletList(builder);
        orderedList(builder);
        listItem(builder);
        thematicBreak(builder);
        heading(builder);
        softLineBreak(builder);
        hardLineBreak(builder);
        paragraph(builder);
        link(builder);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureSpansFactory</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MarkwonSpansFactory.Builder builder)</span> {

        <span class="hljs-comment">// reuse this one for both code-blocks (indent &amp; fenced)</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">CodeBlockSpanFactory</span> <span class="hljs-variable">codeBlockSpanFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CodeBlockSpanFactory</span>();

        builder
                .setFactory(StrongEmphasis.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">StrongEmphasisSpanFactory</span>())
                .setFactory(Emphasis.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">EmphasisSpanFactory</span>())
                .setFactory(BlockQuote.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BlockQuoteSpanFactory</span>())
                .setFactory(Code.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CodeSpanFactory</span>())
                .setFactory(FencedCodeBlock.class, codeBlockSpanFactory)
                .setFactory(IndentedCodeBlock.class, codeBlockSpanFactory)
                .setFactory(ListItem.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListItemSpanFactory</span>())
                .setFactory(Heading.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">HeadingSpanFactory</span>())
                .setFactory(Link.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkSpanFactory</span>())
                .setFactory(ThematicBreak.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThematicBreakSpanFactory</span>());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeSetText</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> TextView textView, <span class="hljs-meta">@NonNull</span> Spanned markdown)</span> {
        OrderedListItemSpan.measure(textView, markdown);

        <span class="hljs-comment">// @since 4.4.0</span>
        <span class="hljs-comment">// we do not break API compatibility, instead we introduce the `instance of` check</span>
        <span class="hljs-keyword">if</span> (markdown <span class="hljs-keyword">instanceof</span> Spannable) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">Spannable</span> <span class="hljs-variable">spannable</span> <span class="hljs-operator">=</span> (Spannable) markdown;
            TextViewSpan.applyTo(spannable, textView);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterSetText</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> TextView textView)</span> {
        <span class="hljs-comment">// let's ensure that there is a movement method applied</span>
        <span class="hljs-comment">// we do it `afterSetText` so any user-defined movement method won't be</span>
        <span class="hljs-comment">// replaced (it should be done in `beforeSetText` or manually on a TextView)</span>
        <span class="hljs-comment">// @since 4.5.0 we additionally check if we should apply _implicit_ movement method</span>
        <span class="hljs-keyword">if</span> (!hasExplicitMovementMethod &amp;&amp; textView.getMovementMethod() == <span class="hljs-literal">null</span>) {
            textView.setMovementMethod(LinkMovementMethod.getInstance());
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">text</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MarkwonVisitor.Builder builder)</span> {
        builder.on(Text.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarkwonVisitor</span>.NodeVisitor&lt;Text&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MarkwonVisitor visitor, <span class="hljs-meta">@NonNull</span> Text text)</span> {

                <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">literal</span> <span class="hljs-operator">=</span> text.getLiteral();

                visitor.builder().append(literal);

                <span class="hljs-comment">// @since 4.0.0</span>
                <span class="hljs-keyword">if</span> (!onTextAddedListeners.isEmpty()) {
                    <span class="hljs-comment">// calculate the start position</span>
                    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> visitor.length() - literal.length();
                    <span class="hljs-keyword">for</span> (OnTextAddedListener onTextAddedListener : onTextAddedListeners) {
                        onTextAddedListener.onTextAdded(visitor, literal, length);
                    }
                }
            }
        });
    }
    ....
}
</code></pre>
<p>CorePlugin è¦†ç›–çš„æ ¸å¿ƒèŠ‚ç‚¹åŒ…æ‹¬ï¼šæ–‡æœ¬ã€ç²—ä½“ã€æ–œä½“ã€å¼•ç”¨å—ã€è¡Œå†…ä»£ç ã€ä»£ç å—ã€å›¾ç‰‡ã€åˆ—è¡¨ã€åˆ†å‰²çº¿ã€æ ‡é¢˜ã€æ¢è¡Œã€æ®µè½ã€é“¾æ¥ç­‰ã€‚</p>
<h2 data-id="heading-19">å››ã€æ‰©å±•Markwonï¼ˆè§£å†³ Span æ‰©å±•æ€§ä¸è¶³é—®é¢˜ï¼‰</h2>
<h3 data-id="heading-20">1ã€å½“å‰Markwonå­˜åœ¨çš„é—®é¢˜</h3>
<p>Markwon æ ¸å¿ƒåº“åŸºäº TextView çš„ Span æœºåˆ¶å®ç°æ¸²æŸ“ï¼Œæ‰€æœ‰èŠ‚ç‚¹æœ€ç»ˆè½¬æ¢ä¸º Span å±•ç¤ºã€‚è¿™ç§æ–¹å¼çš„æ ¸å¿ƒç—›ç‚¹æ˜¯<strong>UI æ‰©å±•æ€§ä¸è¶³</strong>ï¼š</p>
<ul>
<li>Span ä»…èƒ½å®ç°é™æ€æ ·å¼ï¼ˆå¦‚é¢œè‰²ã€å­—ä½“ï¼‰ï¼Œæ— æ³•æ”¯æŒåŠ¨æ€äº¤äº’ï¼ˆå¦‚ä»£ç å—æ·»åŠ å¤åˆ¶æŒ‰é’®ï¼‰ï¼›</li>
<li>å¤æ‚å¸ƒå±€ï¼ˆå¦‚åµŒå¥—è¡¨æ ¼ã€è‡ªå®šä¹‰å¡ç‰‡ï¼‰æ— æ³•é€šè¿‡ Span å®ç°ï¼›</li>
<li>æµå¼è¾“å‡ºæ—¶çš„æ€§èƒ½ä¼˜åŒ–æˆæœ¬é«˜ã€‚</li>
</ul>
<h3 data-id="heading-21">2ã€markwon-recycler æ‰©å±•åº“ï¼ˆåˆ†å—æ¸²æŸ“è§£å†³æ–¹æ¡ˆï¼‰</h3>
<p>Markwon æä¾› markwon-recycler æ‰©å±•åº“ï¼Œé€šè¿‡ RecyclerView å®ç° Markdown çš„åˆ†å—æ¸²æŸ“ï¼Œè§£å†³ Span æ‰©å±•æ€§ä¸è¶³çš„é—®é¢˜ã€‚å…¶æ ¸å¿ƒæ˜¯ MarkwonAdapterï¼ˆRecyclerView.Adapter çš„æŠ½è±¡å­ç±»ï¼Œé»˜è®¤å®ç°ä¸º MarkwonAdapterImplï¼‰ï¼Œè®¾è®¡æ€è·¯æ˜¯ï¼šå°† AST æŒ‰å—çº§èŠ‚ç‚¹æ‹†åˆ†ï¼Œæ¯ä¸ªå—çº§èŠ‚ç‚¹ä½œä¸º RecyclerView çš„ä¸€ä¸ªæ¡ç›®ç‹¬ç«‹æ¸²æŸ“ï¼Œæ”¯æŒè‡ªå®šä¹‰æ¯ä¸ªå—çš„å¸ƒå±€å’Œäº¤äº’ã€‚</p>
<h4 data-id="heading-22">2.1ã€ MarkwonAdapter æ ¸å¿ƒä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MarkwonAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecyclerView</span>.Adapter&lt;MarkwonAdapter.Holder&gt; {
    <span class="hljs-comment">// æ„å»ºæ–¹æ³•ï¼šæ”¯æŒé»˜è®¤å¸ƒå±€/è‡ªå®šä¹‰Entry</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Builder <span class="hljs-title function_">builderTextViewIsRoot</span><span class="hljs-params">(<span class="hljs-meta">@LayoutRes</span> <span class="hljs-type">int</span> defaultEntryLayoutResId)</span> {
        <span class="hljs-keyword">return</span> builder(SimpleEntry.createTextViewIsRoot(defaultEntryLayoutResId));
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Builder <span class="hljs-title function_">builder</span><span class="hljs-params">(<span class="hljs-meta">@LayoutRes</span> <span class="hljs-type">int</span> defaultEntryLayoutResId, <span class="hljs-meta">@IdRes</span> <span class="hljs-type">int</span> defaultEntryTextViewResId)</span> {
        <span class="hljs-keyword">return</span> builder(SimpleEntry.create(defaultEntryLayoutResId, defaultEntryTextViewResId));
    }

    <span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•ï¼šç»‘å®šMarkdownæ•°æ®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMarkdown</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Markwon markwon, <span class="hljs-meta">@NonNull</span> String markdown)</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setParsedMarkdown</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Markwon markwon, <span class="hljs-meta">@NonNull</span> Node document)</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setParsedMarkdown</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Markwon markwon, <span class="hljs-meta">@NonNull</span> List&lt;Node&gt; nodes)</span>;

    <span class="hljs-comment">// æ¡ç›®æ¸²æŸ“è§„åˆ™æŠ½è±¡ç±»</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entry</span>&lt;N <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Node</span>, H <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Holder</span>&gt; {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> H <span class="hljs-title function_">createHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> LayoutInflater inflater, <span class="hljs-meta">@NonNull</span> ViewGroup parent)</span>;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bindHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Markwon markwon, <span class="hljs-meta">@NonNull</span> H holder, <span class="hljs-meta">@NonNull</span> N node)</span>;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {}
        <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">id</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> N node)</span> { <span class="hljs-keyword">return</span> node.hashCode(); }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onViewRecycled</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> H holder)</span> {}
    }

    <span class="hljs-comment">// RecyclerView.ViewHolderåŸºç±»</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Holder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecyclerView</span>.ViewHolder {
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Holder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> View itemView)</span> { <span class="hljs-built_in">super</span>(itemView); }
        <span class="hljs-comment">// çœç•¥è§†å›¾æŸ¥æ‰¾æ–¹æ³•...</span>
    }

    <span class="hljs-comment">// æ„å»ºå™¨æ¥å£</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Builder</span> {
        &lt;N <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Node</span>&gt; Builder <span class="hljs-title function_">include</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Class&lt;N&gt; node, <span class="hljs-meta">@NonNull</span> Entry&lt;? <span class="hljs-built_in">super</span> N, ? extends Holder&gt; entry)</span>;
        Builder <span class="hljs-title function_">reducer</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MarkwonReducer reducer)</span>;
        MarkwonAdapter <span class="hljs-title function_">build</span><span class="hljs-params">()</span>;
    }
}
</code></pre>
<h4 data-id="heading-23">2.2ã€MarkwonAdapter æ ¸å¿ƒèƒ½åŠ›</h4>
<ul>
<li><strong>åˆ†å—æ¸²æŸ“</strong>ï¼šé€šè¿‡ MarkwonReducer å°† AST æ ¹èŠ‚ç‚¹ï¼ˆDocumentï¼‰æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„å—çº§èŠ‚ç‚¹ï¼Œæ¯ä¸ªå—ä½œä¸º RecyclerView çš„ä¸€ä¸ªæ¡ç›®å•ç‹¬æ¸²æŸ“ï¼›</li>
<li><strong>è‡ªå®šä¹‰æ¸²æŸ“</strong>ï¼šä¸ºç‰¹å®šèŠ‚ç‚¹ç±»å‹ï¼ˆå¦‚ FencedCodeBlockã€TableBlockï¼‰æ³¨å†Œè‡ªå®šä¹‰ Entryï¼ˆæ¸²æŸ“è§„åˆ™ï¼‰ï¼Œå®ç°å·®å¼‚åŒ–å¸ƒå±€ / äº¤äº’ï¼›</li>
<li><strong>çµæ´»æ„å»º</strong>ï¼šæ”¯æŒåŸºäºé»˜è®¤å¸ƒå±€ï¼ˆTextViewï¼‰æˆ–è‡ªå®šä¹‰ Entry å¿«é€Ÿæ„å»ºé€‚é…å™¨ï¼Œé€‚é…ä¸åŒä¸šåŠ¡åœºæ™¯ã€‚</li>
</ul>
<h4 data-id="heading-24">2.3ã€Entry æŠ½è±¡ç±»ï¼ˆå•å—æ¸²æŸ“è§„åˆ™ï¼‰</h4>
<p>Entry æ˜¯ MarkwonAdapter çš„æ ¸å¿ƒï¼Œå®šä¹‰å•ä¸ªå—çº§èŠ‚ç‚¹çš„æ¸²æŸ“é€»è¾‘ï¼Œéœ€å®ç°ä»¥ä¸‹æ ¸å¿ƒæ–¹æ³•ï¼š</p>
<ul>
<li>createHolder ()ï¼šåŸºäºå¸ƒå±€æ–‡ä»¶åˆ›å»º ViewHolderï¼Œå®šä¹‰å—çº§èŠ‚ç‚¹çš„ UI å¸ƒå±€ï¼›</li>
<li>bindHolder ()ï¼šå°† Markdown èŠ‚ç‚¹æ•°æ®ç»‘å®šåˆ° ViewHolderï¼Œå®ç°æ•°æ®ä¸ UI çš„å…³è”ï¼›</li>
<li>å¯é€‰æ–¹æ³•ï¼šclear ()ï¼ˆæ¸…ç†æ¸²æŸ“ç¼“å­˜ï¼‰ã€id ()ï¼ˆè‡ªå®šä¹‰æ¡ç›® IDï¼‰ã€onViewRecycled ()ï¼ˆå›æ”¶è§†å›¾ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-25">3ã€åŸºäº Markwon çš„æ‰©å±•æ–¹æ¡ˆæ€»ç»“</h3>
<p>è‡³æ­¤ï¼Œ åŸºäºMarkwonæ¥å°è£…Markdownæ¸²æŸ“ç»„ä»¶çš„æ•´ä½“æ–¹æ¡ˆå°±æ¯”è¾ƒæ¸…æ™°äº†ã€‚</p>
<h4 data-id="heading-26">3.1ã€å†…è”èŠ‚ç‚¹ï¼šå¤ç”¨ Span æ¸²æŸ“</h4>
<p>å†…è”èŠ‚ç‚¹ï¼ˆå¦‚åŠ ç²—ã€é“¾æ¥ã€è¡Œå†…ä»£ç ç­‰ï¼‰æ— éœ€æ³¨å†Œ Entryâ€”â€” å†…è”èŠ‚ç‚¹ä¾é™„äºå—çº§èŠ‚ç‚¹å­˜åœ¨ï¼ˆå¦‚æ®µè½ã€åˆ—è¡¨é¡¹å†…çš„åŠ ç²—æ–‡æœ¬ï¼‰ï¼Œç»§ç»­é€šè¿‡ Span åœ¨ TextView ä¸­æ¸²æŸ“ï¼Œå…¼é¡¾æ¸²æŸ“æ•ˆç‡å’ŒåŸºç¡€æ ·å¼éœ€æ±‚ã€‚</p>
<h4 data-id="heading-27">3.2ã€å—çº§èŠ‚ç‚¹ï¼šè‡ªå®šä¹‰ Entry æ¸²æŸ“</h4>
<p>å—çº§èŠ‚ç‚¹ï¼ˆå¦‚ä»£ç å—ã€å¼•ç”¨å—ã€åˆ—è¡¨ç­‰ï¼‰éœ€ä¸ºå…¶æ³¨å†Œè‡ªå®šä¹‰ Entryï¼š</p>
<ul>
<li>ä¸ºæ¯ä¸ªå—çº§èŠ‚ç‚¹ç±»å‹ï¼ˆå¦‚ FencedCodeBlockï¼‰å®ç° Entryï¼Œè‡ªå®šä¹‰å¸ƒå±€ï¼ˆå¦‚ä»£ç å—æ·»åŠ  â€œå¤åˆ¶â€ æŒ‰é’®ï¼‰ï¼›</li>
<li>é€šè¿‡ MarkwonAdapter çš„ include () æ–¹æ³•å°† â€œèŠ‚ç‚¹ç±»å‹ - Entryâ€ å…³è”ï¼š</li>
</ul>
<p>å®ä¾‹ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">MarkwonAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> MarkwonAdapter.builder(R.layout.item_default, R.id.tv_content)
        <span class="hljs-comment">// ä¸ºä»£ç å—æ³¨å†Œè‡ªå®šä¹‰Entry</span>
        .include(FencedCodeBlock.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CodeBlockEntry</span>())
        <span class="hljs-comment">// ä¸ºå¼•ç”¨å—æ³¨å†Œè‡ªå®šä¹‰Entry</span>
        .include(BlockQuote.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BlockQuoteEntry</span>())
        .build();
</code></pre>
<p>MarkwonAdapterä¸­çš„includeæ–¹æ³•ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@NonNull</span>
        <span class="hljs-variable">@Override</span>
        public &lt;N extends Node&gt; Builder <span class="hljs-built_in">include</span>(
                <span class="hljs-variable">@NonNull</span> Class&lt;N&gt; node,
                <span class="hljs-variable">@NonNull</span> Entry&lt;? super N, ? extends Holder&gt; entry) {
            <span class="hljs-comment">//noinspection unchecked</span>
            <span class="hljs-selector-tag">entries</span><span class="hljs-selector-class">.append</span>(node.<span class="hljs-built_in">hashCode</span>(), (Entry&lt;Node, Holder&gt;) entry);
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">this</span>;
        }
</code></pre>
<h4 data-id="heading-28">3.3ã€åµŒå¥—å—çº§èŠ‚ç‚¹çš„å¤„ç†</h4>
<p>å—çº§èŠ‚ç‚¹å­˜åœ¨åµŒå¥—åœºæ™¯ï¼ˆå¦‚å¼•ç”¨å—åµŒå¥—åˆ—è¡¨ã€åˆ—è¡¨åµŒå¥—åˆ—è¡¨ï¼‰ï¼Œå¤„ç†æ–¹å¼ä¸ºé€’å½’æ¸²æŸ“å­èŠ‚ç‚¹ï¼šåœ¨çˆ¶èŠ‚ç‚¹ Entry çš„ bindHolder () æ–¹æ³•ä¸­ï¼Œéå†çˆ¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œå¤ç”¨ MarkwonAdapter çš„ Entry å’Œ ViewHolder é€»è¾‘ï¼Œå°†å­èŠ‚ç‚¹ View åµŒå…¥çˆ¶èŠ‚ç‚¹å¸ƒå±€å®¹å™¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çˆ¶èŠ‚ç‚¹Entryçš„bindHolderæ–¹æ³•ç¤ºä¾‹ï¼ˆä»¥å¼•ç”¨å—ä¸ºä¾‹ï¼‰</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bindHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Markwon markwon, <span class="hljs-meta">@NonNull</span> Holder holder, <span class="hljs-meta">@NonNull</span> BlockQuote node)</span> {
    <span class="hljs-comment">// è·å–çˆ¶èŠ‚ç‚¹çš„å¸ƒå±€å®¹å™¨</span>
    <span class="hljs-type">LinearLayout</span> <span class="hljs-variable">container</span> <span class="hljs-operator">=</span> holder.requireView(R.id.container_quote);
    container.removeAllViews();

    <span class="hljs-comment">// éå†å¼•ç”¨å—çš„å­èŠ‚ç‚¹ï¼ˆå¦‚åˆ—è¡¨ã€æ®µè½ï¼‰</span>
    <span class="hljs-type">Node</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> node.getFirstChild();
    <span class="hljs-keyword">while</span> (child != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// è·å–å­èŠ‚ç‚¹å¯¹åº”çš„ViewType</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">childViewType</span> <span class="hljs-operator">=</span> markwonAdapter.getNodeViewType(child.getClass());
        <span class="hljs-comment">// åˆ›å»ºå­èŠ‚ç‚¹ViewHolder</span>
        MarkwonAdapter.<span class="hljs-type">Holder</span> <span class="hljs-variable">childHolder</span> <span class="hljs-operator">=</span> markwonAdapter.onCreateViewHolder(container, childViewType);
        
        <span class="hljs-keyword">if</span> (markwonAdapter <span class="hljs-keyword">instanceof</span> MarkwonAdapterImpl) {
            <span class="hljs-type">MarkwonAdapterImpl</span> <span class="hljs-variable">adapterImpl</span> <span class="hljs-operator">=</span> (MarkwonAdapterImpl) markwonAdapter;
            <span class="hljs-comment">// è·å–å­èŠ‚ç‚¹å¯¹åº”çš„Entry</span>
            MarkwonAdapter.Entry&lt;Node, MarkwonAdapter.Holder&gt; childEntry = adapterImpl.getEntry(childViewType);
            <span class="hljs-comment">// ç»‘å®šå­èŠ‚ç‚¹æ•°æ®</span>
            childEntry.bindHolder(markwon, childHolder, child);
            <span class="hljs-comment">// å°†å­èŠ‚ç‚¹Viewæ·»åŠ åˆ°çˆ¶å®¹å™¨ï¼ˆå®ç°åµŒå¥—ï¼‰</span>
            container.addView(childHolder.itemView);
        }
        
        child = child.getNext();
    }
}
</code></pre>
<p>ä¸Šè¿°é€»è¾‘çš„æ ¸å¿ƒæ˜¯ â€œå¤ç”¨å·²æœ‰ Entryâ€ï¼Œé¿å…é‡å¤ç¼–å†™åµŒå¥—èŠ‚ç‚¹çš„æ¸²æŸ“è§„åˆ™ï¼Œä¿è¯æ‰©å±•æ–¹æ¡ˆçš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<h2 data-id="heading-29">äº”ã€æ€»ç»“</h2>
<p>æœ¬æ–‡ä¸»è¦æ˜¯å›´ç»•Android ç«¯Markdownæ¸²æŸ“çš„é«˜æ€§èƒ½ã€é«˜å®šåˆ¶åŒ–çš„éœ€æ±‚å±•å¼€ã€‚ä»‹ç»äº†CommonMark-Java è§£ææ¡†æ¶ä»¥åŠMarkwon åŸºäº Span çš„æ’ä»¶åŒ–æ¸²æŸ“ä½“ç³»ï¼ŒåŒæ—¶è®¨è®ºåŸºäºmarkwon-recycler çš„åˆ†å—æ¸²æŸ“æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-30">åç»­å¯æ¨è¿›çš„ä¼˜åŒ–ç‚¹</h3>
<h4 data-id="heading-31">Spanå¤ç”¨</h4>
<p>å†…è”èŠ‚ç‚¹ä»ä¾èµ– Span æ¸²æŸ“ï¼Œå½“å‰æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šä¸ºç›¸åŒå†…å®¹ / æ ·å¼çš„å†…è”èŠ‚ç‚¹é‡å¤åˆ›å»º Span å¯¹è±¡ï¼Œå­˜åœ¨å†…å­˜ä¸ GC å¼€é”€ã€‚ä¼˜åŒ–æ–¹å‘ï¼š</p>
<ul>
<li>é’ˆå¯¹ Emphasisã€StrongEmphasisã€Code ç­‰é«˜é¢‘å†…è”èŠ‚ç‚¹ï¼Œæ„å»º Span ç¼“å­˜æ± ï¼Œä»¥ â€œèŠ‚ç‚¹ç±»å‹ + å†…å®¹ + ä¸»é¢˜æ ·å¼â€ ä¸º key å¤ç”¨ Span å®ä¾‹ï¼›</li>
<li>ç»“åˆ Android çš„ Span å›æ”¶æœºåˆ¶ï¼Œåœ¨ RecyclerView æ¡ç›®å›æ”¶æ—¶é‡Šæ”¾éå…¨å±€å¤ç”¨çš„ Spanï¼Œå¹³è¡¡å¤ç”¨æ•ˆç‡ä¸å†…å­˜å ç”¨ã€‚</li>
</ul>
<h4 data-id="heading-32">RecyclerView Diff ä¼˜åŒ–</h4>
<p>å½“å‰ MarkwonAdapter é»˜è®¤ä»¥èŠ‚ç‚¹ hashCode ä½œä¸ºæ¡ç›® IDï¼Œæœªå®ç° DiffUtilï¼Œæµå¼è¾“å‡ºæ—¶ä¼šå…¨é‡åˆ·æ–°åˆ—è¡¨ï¼Œæ€§èƒ½æŸè€—å¤§ã€‚ä¼˜åŒ–æ–¹å‘ï¼š</p>
<ul>
<li>åŸºäº AST èŠ‚ç‚¹çš„ â€œç±»å‹ + å†…å®¹å“ˆå¸Œ + å±‚çº§ä½ç½®â€ å®ç° DiffUtil.Callbackï¼Œç²¾å‡†è¯†åˆ«èŠ‚ç‚¹çš„å¢ã€åˆ ã€æ”¹ã€ç§»æ“ä½œï¼›</li>
<li>ä»…åˆ·æ–°å˜æ›´çš„ RecyclerView æ¡ç›®ï¼Œå°¤å…¶é€‚é… AI æµå¼è¾“å‡º Markdown çš„åœºæ™¯ï¼Œæå‡å¢é‡æ¸²æŸ“çš„æµç•…æ€§ï¼›</li>
<li>ä¼˜åŒ–æ¡ç›® ID ç”Ÿæˆé€»è¾‘ï¼ˆé¿å… hashCode å†²çªï¼‰ï¼Œç»“åˆç¨³å®š ID æœºåˆ¶è¿›ä¸€æ­¥é™ä½åˆ·æ–°æŸè€—ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Agentã€‘MemOS æºç ç¬”è®°---(5)---è®°å¿†åˆ†ç±»]]></title>    <link>https://juejin.cn/post/7583910418658459694</link>    <guid>https://juejin.cn/post/7583910418658459694</guid>    <pubDate>2025-12-15T13:35:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910418658459694" data-draft-id="7582955784569716787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Agentã€‘MemOS æºç ç¬”è®°---(5)---è®°å¿†åˆ†ç±»"/> <meta itemprop="keywords" content="ç®—æ³•,äººå·¥æ™ºèƒ½,æ·±åº¦å­¦ä¹ "/> <meta itemprop="datePublished" content="2025-12-15T13:35:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç½—è¥¿çš„æ€è€ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Agentã€‘MemOS æºç ç¬”è®°---(5)---è®°å¿†åˆ†ç±»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç½—è¥¿çš„æ€è€ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T13:35:35.000Z" title="Mon Dec 15 2025 13:35:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»35åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ã€Agentã€‘MemOS æºç ç¬”è®°---(5)---è®°å¿†åˆ†ç±»</h2>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x00 æ‘˜è¦</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x01 è®°å¿†åˆ†ç±»</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.1 ä¸šç•Œåˆ†ç±»</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.2 MemOS</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x02 MemOSåˆ†ç±»è§£æ</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.1 ç»´åº¦å®šä¹‰</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.2 æ ¸å¿ƒå…³ç³»è§£æ</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x03 MemOSçš„å…·ä½“å®ç°</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.1 åŸºæœ¬æ¦‚å¿µ</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.2 è®°å¿†ç”Ÿæˆ</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x04 MemOS è®°å¿†ç”Ÿå‘½å‘¨æœŸç®¡ç†</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.1 ç”Ÿå‘½å‘¨æœŸé˜¶æ®µç®€ä»‹</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.2 æ¡ˆä¾‹ï¼šåœ¨çº¿æ•™è‚²åŠ©æ‰‹çš„è®°å¿†ç”Ÿå‘½å‘¨æœŸ</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.3 è‡ªå·±çš„ç†è§£</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.4 MemScheduler</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0xFF å‚è€ƒ</a></p>
</li>
</ul>
<h3 data-id="heading-1">0x00 æ‘˜è¦</h3>
<p>å¤§æ¨¡å‹ä¹‹æ‰€ä»¥â€œå¿˜äº‹â€ï¼Œæ ¹æœ¬åœ¨äºæˆ‘ä»¬å¯¹â€œæ— çŠ¶æ€æ¨¡å‹â€é‡Œâ€œä¸Šä¸‹æ–‡çª—å£â€çš„è¯¯è§£ã€‚å¾ˆå¤šäººæŠŠå®ƒå½“æˆä¸€åªå¤§ç®©ç­ï¼Œè®¤ä¸ºè£…å¾—è¶Šå¤šè¶Šå¥½ï¼›ç„¶è€Œï¼Œäº‹å®ä¸Šï¼Œä¸Šä¸‹æ–‡çª—å£æ›´åƒä¸€å—å®¹é‡æœ‰é™çš„å·¥ä½œè®°å¿†ã€‚ç¡¬å¡å¤ªå¤šä¿¡æ¯ï¼Œåªä¼šåŒæ—¶å¸¦æ¥å¦‚ä¸‹éº»çƒ¦ï¼šå…³é”®å†…å®¹è¢«å™ªå£°æ·¹æ²¡ï¼Œæ¨¡å‹æŠ“ä¸ä½é‡ç‚¹ï¼Œä¸Šä¸‹æ–‡è¶Šé•¿ï¼Œè´¹ç”¨å’Œå»¶è¿Ÿä¹Ÿè¶Šé«˜ã€‚</p>
<p>è¿™ä¸æ˜¯æ¨¡å‹å·æ‡’ï¼Œè€Œæ˜¯ Transformer æ¶æ„çš„å…ˆå¤©ç‰¹æ€§ã€‚æ¯ä¸€æ¬¡è°ƒç”¨éƒ½åƒé‡æ–°å¼€æœºï¼šæ²¡æœ‰é•¿æœŸè®°å¿†ï¼Œä¸Šä¸‹æ–‡ä¸€æ—¦è¿‡é•¿ï¼Œæ³¨æ„åŠ›å°±è¢«å†—ä½™ä¿¡æ¯æ‰¯æ•£ï¼Œäºæ˜¯å‡ºç°é—å¿˜ã€è·‘é¢˜ã€é€Ÿåº¦ä¸‹é™ã€‚</p>
<p>ä¸ºäº†è¡¥ä¸Šè¿™å—çŸ­æ¿ï¼Œäººä»¬åœ¨è®°å¿†ä¸Šå¤§åŠ¨æ‰‹è„šã€‚</p>
<p>è™½ç„¶å‰æ–‡ç®€ç•¥ä»‹ç»äº†MemOSçš„è®°å¿†ç±»å‹ï¼Œä½†æ˜¯å¹¶æœªæ·±å…¥ï¼Œæœ¬æ–‡ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºåŸºç¡€è¿›è¡Œè§£è¯»ï¼Œç›®çš„æ˜¯äº†è§£MemOSçš„è®°å¿†åˆ†ç±»ï¼Œä»¥åŠå…¶ç”Ÿå‘½å‘¨æœŸã€‚</p>
<h3 data-id="heading-2">0x01 è®°å¿†åˆ†ç±»</h3>
<h4 data-id="heading-3">1.1 ä¸šç•Œåˆ†ç±»</h4>
<p>ä¸ºäº†æ›´å¥½çš„åˆ†æï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸šç•Œå¦‚ä½•å¯¹è®°å¿†è¿›è¡Œåˆ†ç±»ã€‚</p>
<p>åœ¨å½“å‰ï¼ˆæˆªè‡³ 2025 å¹´ï¼‰ä¸»æµçš„æ™ºèƒ½ä½“ï¼ˆAgentï¼‰ç³»ç»Ÿå’Œè®°å¿†æ¶æ„ç ”ç©¶ä¸å®è·µä¸­ï¼Œå­˜åœ¨å¤šç§åˆ†ç±»æ–¹å¼ï¼Œè¿™äº›åˆ†ç±»å€Ÿé‰´è‡ªè®¤çŸ¥ç§‘å­¦ï¼Œå¹¶è¢« AI Agent æ¶æ„ä¸åŒç¨‹åº¦åœ°é‡‡çº³ã€‚</p>
<h5 data-id="heading-4">1.1.1 æ•´ä½“å›¾è¡¨</h5>
<p>å…ˆç»™å‡ºæ•´ä½“å›¾è¡¨ã€‚</p>





















































<table><thead><tr><th>Memory ç±»å‹</th><th>ç‰¹ç‚¹</th><th>å­˜å‚¨å½¢å¼</th><th>å…¸å‹ç”¨é€”</th></tr></thead><tbody><tr><td><strong>å·¥ä½œè®°å¿†ï¼ˆWorkingï¼‰</strong></td><td>ä»»åŠ¡çº§ã€ä¸´æ—¶ã€ç»“æ„åŒ–</td><td>å†…å­˜ä¸­çš„å­—å…¸ / å¯¹è±¡</td><td>æ­£åœ¨æ‰§è¡Œçš„å·¥å…·è°ƒç”¨å‚æ•°ã€ä»»åŠ¡çŠ¶æ€</td></tr><tr><td><strong>çŸ­æœŸè®°å¿†ï¼ˆShort-term Memoryï¼‰</strong></td><td>å®¹é‡å°ã€æ—¶æ•ˆçŸ­ã€ä¸Šä¸‹æ–‡ç›¸å…³</td><td>å†…å­˜ä¸­çš„ç¼“å­˜ / åˆ—è¡¨</td><td>å½“å‰å¯¹è¯ã€ä»»åŠ¡æ‰§è¡Œä¸­çš„ä¸´æ—¶çŠ¶æ€</td></tr><tr><td><strong>é•¿æœŸè®°å¿†ï¼ˆLong-term Memoryï¼‰</strong></td><td>æŒä¹…å­˜å‚¨ã€å¯æ£€ç´¢ã€ç»“æ„åŒ–/éç»“æ„åŒ–</td><td>ç»“æ„åŒ–æ•°æ®åº“ / å‘é‡åº“ / çŸ¥è¯†åº“</td><td>ç”¨æˆ·å†å²ã€çŸ¥è¯†åº“ã€ç»éªŒæ²‰æ·€</td></tr><tr><td><strong>æƒ…æ™¯è®°å¿†ï¼ˆEpisodic Memoryï¼‰</strong></td><td>è®°å½•ç‰¹å®šäº‹ä»¶ï¼ˆæ—¶é—´+åœ°ç‚¹+å†…å®¹ï¼‰å’Œå¯¹è¯è½¨è¿¹</td><td>å‘é‡æ•°æ®åº“ / çŸ¥è¯†åº“</td><td>å›å¿†â€œä¸Šæ¬¡ç”¨æˆ·è¯´...â€</td></tr><tr><td><strong>è¯­ä¹‰è®°å¿†ï¼ˆSemantic Memoryï¼‰</strong></td><td>æŠ½è±¡çŸ¥è¯†ï¼ˆäº‹å®ã€æ¦‚å¿µã€è§„åˆ™ï¼‰ï¼Œå³ä»å¤šæ¬¡äº¤äº’ä¸­æç‚¼ç¨³å®šäº‹å®</td><td>å‘é‡æ•°æ®åº“ / çŸ¥è¯†åº“</td><td>â€œå·´é»æ˜¯æ³•å›½é¦–éƒ½â€</td></tr><tr><td><strong>ç¨‹åºæ€§è®°å¿†ï¼ˆProcedural Memoryï¼‰</strong></td><td>å¦‚ä½•åšæŸäº‹ï¼ˆæŠ€èƒ½ã€æµç¨‹ï¼‰</td><td>ç»“æ„åŒ–æ•°æ®åº“ / å‘é‡åº“</td><td>è°ƒç”¨å·¥å…·é“¾ã€æ‰§è¡Œè®¡åˆ’</td></tr><tr><td><strong>åå¥½/ç”¨æˆ·ç”»åƒè®°å¿†/ä¸ªæ€§åŒ–è®°å¿†ï¼ˆPreference/User Profile Memoryï¼‰</strong></td><td>ç”¨æˆ·å…´è¶£ã€ä¹ æƒ¯ã€é£æ ¼åå¥½</td><td>ç»“æ„åŒ–æ•°æ®åº“ / å‘é‡åº“</td><td>ä¸ªæ€§åŒ–æ¨èã€è¯­æ°”è°ƒæ•´</td></tr></tbody></table>
<h5 data-id="heading-5">1.1.2 æ¢³ç†</h5>
<p>ä»¥ä¸‹åˆ†ç±»å±äºç¬”è€…è‡ªå·±çš„ç†è§£ï¼Œä¸ä¸€å®šæ­£ç¡®ï¼Œä»…ä¾›å¤§å®¶å‚è€ƒã€‚ä¸»è¦æ˜¯ â€œæ„ŸçŸ¥ - çŸ­æœŸ - é•¿æœŸâ€ ä¸‰çº§æ—¶æ•ˆåˆ†å±‚ä½“ç³»ï¼Œå„å±‚çº§åŠŸèƒ½ä¸ç‰¹æ€§ç›¸å¯¹å¯ä»¥æ˜ç¡®åŒºåˆ†ï¼š</p>
<ul>
<li>æ„ŸçŸ¥è®°å¿†ï¼ˆç¯å¢ƒæ„ŸçŸ¥è®°å¿†ï¼‰ï¼šæœ€ç¬æ—¶çš„è®°å¿†å½¢æ€ï¼Œä»…å­˜å‚¨å½“ä¸‹ç¯å¢ƒä¸­çš„å³æ—¶æ•°æ®ï¼ˆå¦‚è§†è§‰ã€å£°éŸ³ä¿¡æ¯ï¼‰ï¼Œæ— é•¿æœŸå¤ç”¨ä»·å€¼ï¼Œä»…åœ¨å½“å‰ç¬é—´æœ‰æ•ˆï¼Œéœ€é€šè¿‡è½¬åŒ–æœºåˆ¶è¿›å…¥æ›´é«˜å±‚çº§è®°å¿†æ‰èƒ½é•¿æœŸä¿ç•™ã€‚</li>
</ul>

<ul>
<li>
<p>çŸ­æœŸè®°å¿†ï¼ˆå¯¹åº” Agent çš„ Session çº§åˆ«æ•°æ®ç®¡ç†ï¼‰ï¼Œæ­¤å¤„æœ‰ä¸¤ç§éå¸¸ç±»ä¼¼çš„è¯´æ³•ï¼Œå¯ä»¥æ··ç”¨ã€‚å¯èƒ½å·¥ä½œè®°å¿†æ›´å¼ºè°ƒå½“å‰ä¼šè¯ï¼ŒçŸ­æœŸè®°å¿†å¼ºè°ƒçŸ­æœŸçš„å¯¹è¯è®°å½•ã€‚</p>
<ul>
<li>å·¥ä½œè®°å¿†ï¼ˆWorking Memoryï¼‰ï¼šç”¨æ¥å¤„ç†å½“å‰ä¼šè¯ä¸ä»»åŠ¡çš„ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬å½“å‰ç›®æ ‡ã€æ­£åœ¨æ‰§è¡Œçš„å­ä»»åŠ¡ç­‰ã€‚æ ¸å¿ƒä½œç”¨æ˜¯ä¿éšœä¸Šä¸‹æ–‡è¿ç»­æ€§ä¸å³æ—¶å“åº”èƒ½åŠ›ã€‚å®¹é‡æœ‰é™ï¼Œä½†è¯»å†™é¢‘ç¹ã€å»¶è¿Ÿæä½ã€‚æœ‰çš„æ–¹æ¡ˆä¸­ï¼Œå·¥ä½œè®°å¿†ä¹ŸåŒ…æ‹¬æœ€è¿‘å‡ è½®å¯¹è¯ã€‚</li>
<li>çŸ­æœŸè®°å¿†ï¼šä¸ç‰¹å®šä¼šè¯æˆ–ä»»åŠ¡çº¿ç¨‹å¼ºç»‘å®šï¼Œå³å¸¸è§çš„ â€œå†å²å¯¹è¯è®°å½•â€ï¼Œæ˜¯ LLM æ¨ç† API çš„æ ¸å¿ƒåŸºç¡€å‚æ•°ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯ç»´æŒå•ä¸€ä¼šè¯å†…çš„äº¤äº’è¿è´¯æ€§ã€‚</li>
</ul>
</li>
<li>
<p>é•¿æœŸè®°å¿†ï¼šä¸ä¾èµ–ç‰¹å®šä¼šè¯ï¼Œå¯è·¨åœºæ™¯å¤ç”¨ï¼ŒåŒ…æ‹¬ä¸¤ç§åˆ†ç±»æ–¹æ³•ï¼š</p>
<ul>
<li>
<p>åˆ†ç±»1ï¼ˆä»ç”¨æˆ·è§’åº¦å‡ºå‘ï¼‰</p>
<ul>
<li>
<p>æƒ…æ™¯è®°å¿†ï¼ˆEpisodic Memoryï¼‰ï¼šè´Ÿè´£å­˜å‚¨ç”¨æˆ·å’ŒAgentçš„å…·ä½“äº¤äº’äº‹ä»¶ã€‚è®°å½•è¿‡å¾€äº‹ä»¶ä¸è¡ŒåŠ¨å†ç¨‹ï¼ŒåŒºåˆ«äºå­¤ç«‹äº‹å®ï¼Œæ›´ä¾§é‡ â€œç»å†â€ çš„å®Œæ•´ç•™å­˜ï¼Œå¸®åŠ© Agent å›å¿†ä»»åŠ¡æ‰§è¡Œçš„å…·ä½“è¿‡ç¨‹ä¸åœºæ™¯ï¼›</p>
</li>
<li>
<p>é™ˆè¿°æ€§è®°å¿†ï¼ˆDeclarative Memoryï¼Œâ€œæ˜¯ä»€ä¹ˆï¼‰ï¼Œæ­¤å¤„ä¹Ÿæœ‰ä¸¤ç§ç±»ä¼¼çš„è¯´æ³•ï¼š</p>
<ul>
<li>è¯­ä¹‰è®°å¿†ï¼ˆSemantic Memoryâ€ï¼‰ï¼šé€šè¿‡å±‚çº§ç»“æ„å½’çº³ç”¨æˆ·é•¿æœŸä¿¡æ¯ã€‚èšç„¦äº‹å®ä¸æ¦‚å¿µçš„å­˜å‚¨ï¼Œå¦‚äº¤äº’ä¸­ç§¯ç´¯çš„ç‰¹å®šä¿¡æ¯ã€æ¦‚å¿µé—´çš„å…³è”å…³ç³»ï¼Œæ˜¯å®ç°ä¸ªæ€§åŒ–æœåŠ¡çš„å…³é”®ï¼ˆå¦‚è®°ä½ç”¨æˆ·çš„åå¥½äº‹å®ï¼‰ï¼›</li>
<li>é™ˆè¿°æ€§è®°å¿†ï¼šæ­¤åˆ†ç±»å’Œè¯­ä¹‰è®°å¿†å¾ˆç±»ä¼¼ï¼Œå±äºå°†è¯­ä¹‰è®°å¿†æ‰©å¤§åŒ–ã€‚å³ï¼Œ é™ˆè¿°æ€§è®°å¿†æ˜¯å…³äºäº‹å®å’Œäº‹ä»¶çš„çŸ¥è¯† ã€‚å®ƒå›ç­”çš„æ˜¯å„ç§â€œæ˜¯ä»€ä¹ˆâ€çš„é—®é¢˜ â€” æ— è®ºæ˜¯ä¸–ç•ŒçŸ¥è¯†è¿˜æ˜¯ç”¨æˆ·çš„å…·ä½“ä¿¡æ¯ã€‚æ¯”å¦‚ç”¨æˆ·çš„å§“åã€å–œæ¬¢çš„ç¾é£Ÿï¼Œæ›¾é­é‡è¿‡çš„äº‹ä»¶ç­‰ï¼Œéƒ½å±äºé™ˆè¿°æ€§è®°å¿† ã€‚</li>
</ul>
</li>
<li>
<p>ç¨‹åºæ€§è®°å¿†ï¼ˆProcedural Memoryï¼Œâ€œæ€ä¹ˆåšâ€ï¼‰ï¼šå­˜å‚¨æ‰§è¡Œä»»åŠ¡çš„è§„åˆ™ã€æ–¹æ³•ä¸æµç¨‹ï¼Œç”±æ¨¡å‹æƒé‡ã€æ™ºèƒ½ä½“ä»£ç ã€æç¤ºè¯ç­–ç•¥ç­‰å…±åŒæ„æˆï¼Œç›¸å½“äº Agent çš„ â€œå†…åœ¨æ–¹æ³•è®ºâ€ï¼ŒæŒ‡å¯¼å…¶å¦‚ä½•å®Œæˆå…·ä½“ä»»åŠ¡ï¼ˆç±»ä¼¼äººç±»éª‘è‡ªè¡Œè½¦çš„æŠ€èƒ½è®°å¿†ï¼‰ã€‚</p>
</li>
<li>
<p>ä¸ªæ€§åŒ–è®°å¿†ï¼šå½¢æˆå…³äºç”¨æˆ·çš„æŒç»­ç”»åƒã€‚é€šè¿‡ä¼šè¯å†…å®¹æ‘˜è¦ç­‰æ–¹å¼æå–çš„ç”¨æˆ·ç”»åƒä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·åå¥½ã€è¡Œä¸ºä¹ æƒ¯ã€èº«ä»½ç‰¹å¾ç­‰ï¼Œæ”¯æ’‘é•¿æœŸäº¤äº’ä¸­çš„ä¸ªæ€§åŒ–æœåŠ¡ã€‚</p>
</li>
</ul>
</li>
<li>
<p>åˆ†ç±»2ï¼ˆä»å®é™…åº”ç”¨åŠŸèƒ½å‡ºå‘ï¼‰ï¼š</p>
<ul>
<li>æ£€ç´¢è®°å¿†ï¼šé€šè¿‡ RAG æŠ€æœ¯å¯¹æ¥å¤–éƒ¨çŸ¥è¯†åº“ï¼Œæ ¸å¿ƒä»·å€¼æ˜¯è¡¥å……æ¨¡å‹åŸç”ŸçŸ¥è¯†ï¼ŒåŒæ—¶å‡å°‘å†…éƒ¨çŸ¥è¯†å†²çªï¼Œæå‡ä¿¡æ¯è·å–çš„ç²¾å‡†æ€§ä¸æ—¶æ•ˆæ€§ã€‚</li>
<li>é€šç”¨è®°å¿†ï¼šé€šè¿‡é¢„è®­ç»ƒæˆ–åç»­å¾®è°ƒæ²‰æ·€çš„åŸºç¡€é€šç”¨çŸ¥è¯†ï¼Œæ„æˆ Agent çš„æ ¸å¿ƒè®¤çŸ¥åº•åº§ï¼Œæ”¯æ’‘å„ç±»åŸºç¡€ä»»åŠ¡çš„ç†è§£ä¸æ‰§è¡Œã€‚</li>
<li>è§„åˆ™è®°å¿†ï¼šä»¥å¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰ã€æç¤ºè¯ï¼ˆPromptï¼‰ç­‰æ–¹å¼å›ºåŒ–çš„è¡Œä¸ºè§„èŒƒï¼Œç”¨äºçº¦æŸ Agent è¾“å‡ºæ ¼å¼ï¼ˆå¦‚ JSONã€CoT é“¾å¼æ¨ç†ï¼‰ä¸è¡Œä¸ºè¾¹ç•Œï¼Œç¡®ä¿å“åº”çš„ä¸€è‡´æ€§ä¸åˆè§„æ€§ã€‚</li>
<li>ä¸ªæ€§åŒ–è®°å¿†ï¼šé€šè¿‡ä¼šè¯å†…å®¹æ‘˜è¦ç­‰æ–¹å¼æå–çš„ç”¨æˆ·ç”»åƒä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·åå¥½ã€è¡Œä¸ºä¹ æƒ¯ã€èº«ä»½ç‰¹å¾ç­‰ï¼Œæ”¯æ’‘é•¿æœŸäº¤äº’ä¸­çš„ä¸ªæ€§åŒ–æœåŠ¡ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6">1.2 MemOS</h4>
<p>MemOSå¯¹è®°å¿†æœ‰ä¸¤ç§åˆ†ç±»ï¼š</p>
<p>ç¬¬ä¸€ç§æ˜¯åˆ†æˆä¸‰ä¸ªå­ç±»ï¼š</p>
<ul>
<li>ç»“æ„åŒ–è®°å¿†ï¼ˆæ˜æ–‡è®°å¿†ï¼‰ï¼šå°è¯•åŸºäºå›¾çš„åˆ†å±‚çŸ¥è¯† TreeTextMemoryï¼Œæ˜¯ç»“æ„åŒ–ã€å±‚æ¬¡åŒ–å’ŒçŸ¥è¯†å›¾è°±ã€‚å›¾ä¸å‘é‡åç«¯ä¼šè¿æ¥ Neo4j æˆ– Qdrant å®ç°ç”Ÿäº§çº§å‘é‡/å›¾æœç´¢ã€‚é€‚åˆå¸¸é’æŠ€èƒ½å’Œç¨³å®šçš„é¢†åŸŸä¸“ä¸šçŸ¥è¯†ã€‚</li>
<li>æ¿€æ´»è®°å¿†ï¼šè¿è¡Œæ—¶çš„ KV ç¼“å­˜å’Œéšè—çŠ¶æ€ï¼ˆé«˜æ•ˆç‡ï¼‰ï¼Œä½¿ç”¨ KVCacheMemory ï¼ˆæœ€è¿‘æˆ–ç¨³å®šçš„ä¸Šä¸‹æ–‡ï¼‰åŠ é€Ÿå¤šè½®å¯¹è¯ï¼Œé«˜æ•ˆçš„è¿è¡Œæ—¶çŠ¶æ€ç¼“å­˜ã€‚é€‚åˆå¯¹è¯ä¸­çš„å¿«é€Ÿé‡ç”¨ã€å¤šè½®ä¼šè¯ã€‚</li>
<li>å‚æ•°åŒ–è®°å¿†ï¼šåµŒå…¥æ¨¡å‹ä¸­çš„é•¿æœŸçŸ¥è¯†å’ŒæŠ€èƒ½ï¼Œç”¨é€‚é…å™¨/LoRA å®ç°åŠ¨æ€æŠ€èƒ½æ³¨å…¥ã€‚é€‚åˆå¯æœç´¢ã€å¯æ£€æŸ¥ã€æ¼”è¿›çŸ¥è¯†ã€‚</li>
</ul>
<p>ç¬¬äºŒç§ä¹Ÿæ˜¯ä¸‰ä¸ªå­ç±»ï¼š</p>
<ul>
<li><code>WorkingMemory</code>: å·¥ä½œè®°å¿†ï¼Œä¸´æ—¶å­˜å‚¨</li>
<li><code>LongTermMemory</code>: é•¿æœŸè®°å¿†ï¼ŒæŒä¹…å­˜å‚¨</li>
<li><code>UserMemory</code>: ç”¨æˆ·è®°å¿†ï¼Œä¸ªæ€§åŒ–å­˜å‚¨</li>
</ul>
<h3 data-id="heading-7">0x02 MemOSåˆ†ç±»è§£æ</h3>
<p>MemOS è¿™æ˜¯ä¸¤å¥—å®Œå…¨ä¸åŒçš„åˆ†ç±»ç»´åº¦ â€”â€” å‰è€…æŒ‰ â€œè®°å¿†çš„ç‰©ç†å½¢æ€ä¸ç”Ÿå‘½å‘¨æœŸâ€ åˆ’åˆ†ï¼Œåè€…æŒ‰ â€œè®°å¿†çš„å­˜å‚¨å½’å±ä¸è®¿é—®ä¼˜å…ˆçº§â€ åˆ’åˆ†ã€‚äºŒè€…æ— ç›´æ¥åŒ…å«å…³ç³»ï¼Œä½†å­˜åœ¨æ˜ç¡®çš„åŠ¨æ€è¿ç§»é€»è¾‘ï¼Œå…±åŒæ”¯æ’‘ MemOS å¯¹ Agent è®°å¿†çš„ç²¾ç»†åŒ–ç®¡ç†ã€‚</p>
<ul>
<li>ã€Œç‰©ç†å½¢æ€ + ç”Ÿå‘½å‘¨æœŸã€åˆ†ç±»ï¼ˆç¬¬ä¸€å¥—ï¼‰ï¼šè§£å†³ â€œè®°å¿†å¦‚ä½•é«˜æ•ˆå­˜å‚¨ã€å¿«é€Ÿè®¿é—®â€ çš„å·¥ç¨‹é—®é¢˜ï¼Œé€šè¿‡ â€œå·¥ä½œè®°å¿†â†’æ¿€æ´»è®°å¿†â†’é•¿æœŸå­˜å‚¨â€ çš„å±‚çº§è®¾è®¡ï¼Œå¹³è¡¡å†…å­˜å ç”¨ä¸è®¿é—®é€Ÿåº¦ï¼›</li>
<li>ã€Œå­˜å‚¨å½’å± + è®¿é—®ä¼˜å…ˆçº§ã€åˆ†ç±»ï¼ˆç¬¬äºŒå¥—ï¼‰ï¼šè§£å†³ â€œè®°å¿†å¦‚ä½•ç²¾å‡†ç®¡ç†ã€ä¸ªæ€§åŒ–è°ƒç”¨â€ çš„åŠŸèƒ½é—®é¢˜ï¼Œé€šè¿‡ â€œWorkingMemoryâ†’LongTermMemoryâ†’UserMemoryâ€ çš„æ¨¡å—åˆ’åˆ†ï¼Œå®ç° â€œä»»åŠ¡å®æ—¶å¤„ç†ã€é€šç”¨çŸ¥è¯†æ²‰æ·€ã€ç”¨æˆ·ä¸ªæ€§åŒ–é€‚é…â€ çš„ç›®æ ‡ã€‚</li>
</ul>
<h4 data-id="heading-8">2.1 ç»´åº¦å®šä¹‰</h4>
<p>å…ˆæ˜ç¡®ä¸¤å¥—åˆ†ç±»çš„æ ¸å¿ƒå®šä¹‰ï¼ˆç»´åº¦æœ¬è´¨ï¼‰ã€‚</p>
<h5 data-id="heading-9">2.1.1 æŒ‰ã€Œç‰©ç†å½¢æ€ + ç”Ÿå‘½å‘¨æœŸã€åˆ’åˆ†</h5>
<p>å‚æ•°è®°å¿†ï¼ˆParameter Memoryï¼‰/æ¿€æ´»è®°å¿†ï¼ˆActivated Memoryï¼‰/ç»“æ„åŒ–è®°å¿†ï¼ˆæ˜æ–‡è®°å¿†ï¼‰ çš„åˆ†ç±»èšç„¦ â€œè®°å¿†åœ¨ç³»ç»Ÿä¸­çš„å­˜åœ¨å½¢å¼ã€å­˜æ´»æ—¶é•¿â€ï¼Œæ˜¯ä»å·¥ç¨‹å®ç°è§’åº¦å¯¹è®°å¿†æ•°æ®çš„æ‹†è§£ï¼Œæ ¸å¿ƒæœåŠ¡äº â€œèµ„æºä¼˜åŒ–â€ï¼ˆå¦‚å†…å­˜å ç”¨ã€è®¡ç®—æ•ˆç‡ï¼‰ï¼Œå â€œæŠ€æœ¯å®ç°ç»´åº¦â€ï¼š</p>

































<table><thead><tr><th>è®°å¿†ç±»å‹</th><th>æ ¸å¿ƒå®šä¹‰</th><th>ç‰©ç†å½¢æ€</th><th>ç”Ÿå‘½å‘¨æœŸ</th><th>æ ¸å¿ƒä½œç”¨</th></tr></thead><tbody><tr><td>å‚æ•°è®°å¿†ï¼ˆParameter Memoryï¼‰</td><td>å›ºåŒ–åœ¨æ¨¡å‹æƒé‡ä¸­çš„ â€œéšæ€§è®°å¿†â€ï¼Œæ˜¯æ¨¡å‹è®­ç»ƒé˜¶æ®µä¹ å¾—çš„çŸ¥è¯†ï¼ˆé MemOS åŠ¨æ€ç®¡ç†çš„è®°å¿†ï¼‰ã€‚</td><td>æ¨¡å‹å‚æ•°ï¼ˆæƒé‡çŸ©é˜µï¼‰</td><td>é•¿æœŸå›ºå®šï¼ˆé™¤éæ¨¡å‹å¾®è°ƒï¼‰</td><td>æä¾› Agent åŸºç¡€è®¤çŸ¥èƒ½åŠ›ï¼ˆå¦‚è¯­è¨€ç†è§£ã€é€šç”¨é€»è¾‘ï¼‰ï¼Œæ˜¯å…¶ä»–è®°å¿†å‘æŒ¥ä½œç”¨çš„å‰æã€‚</td></tr><tr><td>æ¿€æ´»è®°å¿†ï¼ˆActivated Memoryï¼‰</td><td>ä»é•¿æœŸå­˜å‚¨ä¸­ â€œä¸´æ—¶å”¤é†’â€ å¹¶åŠ è½½åˆ°å†…å­˜çš„è®°å¿†ç‰‡æ®µï¼ˆå¦‚è¿‘æœŸé«˜é¢‘è®¿é—®çš„çŸ¥è¯†ã€æ­£åœ¨å¤„ç†çš„ä»»åŠ¡ç›¸å…³è®°å¿†ï¼‰ã€‚</td><td>å†…å­˜ä¸­çš„ç»“æ„åŒ–æ•°æ®ï¼ˆèŠ‚ç‚¹ã€å…³ç³»ã€å‘é‡ï¼‰</td><td>ä¸­çŸ­æœŸï¼ˆä»»åŠ¡æ‰§è¡ŒæœŸé—´ / é—²ç½®è¶…æ—¶åé‡Šæ”¾ï¼‰</td><td>ä½œä¸º â€œç¼“å†²å±‚â€ï¼Œé¿å…é¢‘ç¹è¯»å–é•¿æœŸå­˜å‚¨ï¼Œæå‡è®°å¿†è®¿é—®é€Ÿåº¦ã€‚</td></tr><tr><td>ç»“æ„åŒ–è®°å¿†ï¼ˆæ˜æ–‡è®°å¿†ï¼‰</td><td>ä»»åŠ¡æ‰§è¡Œæ—¶ â€œå®æ—¶ç”Ÿæˆ / ä½¿ç”¨â€ çš„ä¸´æ—¶è®°å¿†ï¼Œæ˜¯ Agent å½“å‰å†³ç­–æ‰€éœ€çš„æ ¸å¿ƒä¿¡æ¯é›†åˆã€‚</td><td>å†…å­˜ä¸­çš„ä¸´æ—¶æ•°æ®ç»“æ„ï¼ˆå¦‚ä»»åŠ¡çŠ¶æ€ã€æ¨ç†ä¸­é—´ç»“æœã€å³æ—¶äº¤äº’ä¿¡æ¯ï¼‰</td><td>çŸ­æœŸï¼ˆä»»åŠ¡ç»“æŸåé”€æ¯ / å½’æ¡£ï¼‰</td><td>æ”¯æ’‘å½“å‰ä»»åŠ¡çš„å®æ—¶å†³ç­–ï¼ˆå¦‚ â€œè§„åˆ’æ—…è¡Œâ€ æ—¶ï¼Œä¸´æ—¶å­˜å‚¨ç›®çš„åœ°ã€äº¤é€šæ–¹å¼ç­‰ä¿¡æ¯ï¼‰ã€‚</td></tr></tbody></table>
<h5 data-id="heading-10">2.1.2 æŒ‰ã€Œå­˜å‚¨å½’å± + è®¿é—®ä¼˜å…ˆçº§ã€åˆ’åˆ†</h5>
<p>è¯¥åˆ†ç±»èšç„¦ â€œè®°å¿†çš„æ‰€æœ‰æƒã€ç”¨é€”ä¸è®¿é—®ä¼˜å…ˆçº§â€ï¼Œæ˜¯ä» Agent åŠŸèƒ½é€»è¾‘è§’åº¦å¯¹è®°å¿†çš„ç»„ç»‡ï¼Œæ ¸å¿ƒæœåŠ¡äº â€œç²¾å‡†æ£€ç´¢ä¸ç®¡ç†â€ï¼ˆå¦‚åŒºåˆ†ç”¨æˆ·ä¸“å±è®°å¿†å’Œé€šç”¨çŸ¥è¯†ï¼‰ï¼Œå â€œåŠŸèƒ½é€»è¾‘ç»´åº¦â€ï¼š</p>

































<table><thead><tr><th>è®°å¿†ç±»å‹</th><th>æ ¸å¿ƒå®šä¹‰</th><th>å­˜å‚¨å½’å±</th><th>è®¿é—®ä¼˜å…ˆçº§</th><th>æ ¸å¿ƒä½œç”¨</th></tr></thead><tbody><tr><td>WorkingMemoryï¼ˆå·¥ä½œè®°å¿†ï¼‰</td><td>æ­¤å¤„æ˜¯ MemOS ä¸­ â€œä»»åŠ¡çº§ä¸´æ—¶å­˜å‚¨æ¨¡å—â€ï¼Œä¸“é—¨å­˜æ”¾å½“å‰ä»»åŠ¡çš„å®æ—¶ä¿¡æ¯ã€‚</td><td>å†…å­˜ / ä¸´æ—¶å­˜å‚¨</td><td>æœ€é«˜ï¼ˆä»»åŠ¡æ‰§è¡ŒæœŸé—´ä¼˜å…ˆè®¿é—®ï¼‰</td><td>æ‰¿æ¥å½“å‰ä»»åŠ¡çš„è¾“å…¥ã€ä¸­é—´ç»“æœã€å†³ç­–ä¾æ®ï¼Œæ˜¯ Agent å®æ—¶äº¤äº’çš„ â€œä¸´æ—¶å·¥ä½œå°â€ã€‚</td></tr><tr><td>LongTermMemoryï¼ˆé•¿æœŸè®°å¿†ï¼‰</td><td>Agent çš„ â€œé€šç”¨çŸ¥è¯†åº“â€ï¼Œå­˜æ”¾ä¸éšä»»åŠ¡é”€æ¯çš„é•¿æœŸæœ‰æ•ˆä¿¡æ¯ï¼ˆå¦‚é€šç”¨çŸ¥è¯†ã€å†å²ä»»åŠ¡å½’æ¡£ã€é¢†åŸŸè§„åˆ™ï¼‰ã€‚</td><td>æŒä¹…åŒ–å­˜å‚¨ï¼ˆå›¾æ•°æ®åº“ã€å‘é‡æ•°æ®åº“ï¼‰</td><td>ä¸­ä½ï¼ˆéœ€æ£€ç´¢å”¤é†’ï¼‰</td><td>æä¾› Agent é•¿æœŸç¨³å®šçš„çŸ¥è¯†æ”¯æ’‘ï¼Œé¿å… â€œä»»åŠ¡ç»“æŸå³å¤±å¿†â€ã€‚</td></tr><tr><td>UserMemoryï¼ˆç”¨æˆ·è®°å¿†ï¼‰</td><td>å±äº LongTermMemory çš„ â€œå­é›†åŒ–å­˜å‚¨â€ï¼Œä¸“é—¨å­˜æ”¾ç”¨æˆ·ä¸“å±ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·åå¥½ã€å†å²äº¤äº’è®°å½•ã€ä¸ªäººå±æ€§ï¼‰ã€‚</td><td>æŒä¹…åŒ–å­˜å‚¨ï¼ˆç‹¬ç«‹åˆ†åŒº / å¸¦ç”¨æˆ·æ ‡è¯†çš„æ•°æ®åº“ï¼‰</td><td>ä¸­é«˜ï¼ˆç”¨æˆ·ç›¸å…³ä»»åŠ¡ä¼˜å…ˆè®¿é—®ï¼‰</td><td>å®ç° â€œä¸ªæ€§åŒ–äº¤äº’â€ï¼ˆå¦‚è®°ä½ç”¨æˆ·å–œæ¬¢çš„æ²Ÿé€šé£æ ¼ã€å†å²éœ€æ±‚ï¼‰ã€‚</td></tr></tbody></table>
<h4 data-id="heading-11">2.2 æ ¸å¿ƒå…³ç³»è§£æ</h4>
<p>æ— åŒ…å«å…³ç³»ï¼Œä½†æœ‰æ˜ç¡®çš„ â€œæ˜ å°„ä¸è¿ç§»â€ã€‚</p>
<h5 data-id="heading-12">2.2.1. ä¸å­˜åœ¨ç›´æ¥åŒ…å«å…³ç³»</h5>
<p>è¿™ä¸¤å¥—åˆ†ç±»ç»´åº¦æ˜¯å¹³è¡Œçš„</p>
<ul>
<li>ç¬¬ä¸€å¥—æ˜¯ â€œæŠ€æœ¯å®ç°ç»´åº¦â€ï¼ˆå…³æ³¨ â€œè®°å¿†æ€ä¹ˆå­˜ã€å­˜å¤šä¹…â€ï¼‰ï¼Œç¬¬äºŒå¥—æ˜¯ â€œåŠŸèƒ½é€»è¾‘ç»´åº¦â€ï¼ˆå…³æ³¨ â€œè®°å¿†ä¸ºè°å­˜ã€ç”¨æ¥åšä»€ä¹ˆâ€ï¼‰ï¼ŒäºŒè€…å¦‚åŒ â€œæŒ‰â€˜æè´¨ + ä¿è´¨æœŸâ€™åˆ†ç±»é£Ÿå“â€ ä¸ â€œæŒ‰â€˜é£Ÿç”¨åœºæ™¯ + å½’å±äººâ€™åˆ†ç±»é£Ÿå“â€â€”â€” åˆ†ç±»æ ‡å‡†å®Œå…¨ä¸åŒï¼Œæ— æ³•ç›´æ¥è¯´ â€œæŸç±»åŒ…å«æŸç±»â€ã€‚</li>
<li>ä¾‹ï¼šUserMemoryï¼ˆåŠŸèƒ½ç»´åº¦ï¼‰çš„ç‰©ç†å½¢æ€å¯èƒ½æ˜¯ â€œé•¿æœŸå­˜å‚¨çš„ç»“æ„åŒ–æ•°æ®â€ï¼ˆå¯¹åº”ç¬¬ä¸€å¥—çš„ â€œéæ¿€æ´»æ€é•¿æœŸè®°å¿†â€ï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯ â€œä¸´æ—¶åŠ è½½åˆ°å†…å­˜çš„æ¿€æ´»æ•°æ®â€ï¼ˆå¯¹åº”ç¬¬ä¸€å¥—çš„ â€œæ¿€æ´»è®°å¿†â€ï¼‰ï¼›WorkingMemoryï¼ˆåŠŸèƒ½ç»´åº¦ï¼‰çš„ç‰©ç†å½¢æ€å°±æ˜¯ç¬¬ä¸€å¥—çš„ â€œç»“æ„åŒ–è®°å¿†â€ï¼ˆä¸´æ—¶æ•°æ®ç»“æ„ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-13">2.2.2. å…³é”®æ˜ å°„å…³ç³»</h5>
<p>ä¸ºäº†è®©é€»è¾‘æ›´æ¸…æ™°ï¼Œå¯é€šè¿‡ â€œåŠŸèƒ½æ¨¡å— â†’ æŠ€æœ¯å½¢æ€â€ çš„æ˜ å°„ç†è§£äºŒè€…å…³è”ï¼š</p>





















<table><thead><tr><th>åŠŸèƒ½ç»´åº¦è®°å¿†ï¼ˆç¬¬äºŒå¥—ï¼‰</th><th>å¯¹åº”çš„æŠ€æœ¯ç»´åº¦è®°å¿†ï¼ˆç¬¬ä¸€å¥—ï¼‰</th></tr></thead><tbody><tr><td>WorkingMemory</td><td>100% å¯¹åº”ã€Œç»“æ„åŒ–è®°å¿†ã€ï¼ˆä¸´æ—¶æ•°æ®ç»“æ„ï¼Œä»»åŠ¡ç»“æŸåé”€æ¯ / å½’æ¡£ï¼‰ï¼›éƒ¨åˆ†åœºæ™¯ä¼šåŠ è½½ã€Œæ¿€æ´»è®°å¿†ã€ï¼ˆå¦‚è°ƒç”¨å†å²ä»»åŠ¡ç›¸å…³çš„å”¤é†’è®°å¿†ï¼‰ã€‚</td></tr><tr><td>LongTermMemoryï¼ˆé€šç”¨ï¼‰</td><td>æœªè®¿é—®æ—¶ï¼šå¯¹åº”ã€Œé•¿æœŸå­˜å‚¨çš„ç»“æ„åŒ–æ•°æ®ã€ï¼ˆéæ¿€æ´»æ€ï¼‰ï¼›è®¿é—®æ—¶ï¼šåŠ è½½ä¸ºã€Œæ¿€æ´»è®°å¿†ã€ï¼›æ ¸å¿ƒçŸ¥è¯†å¯èƒ½é—´æ¥ä¾èµ–ã€Œå‚æ•°è®°å¿†ã€ï¼ˆæ¨¡å‹æƒé‡ä¸­çš„é€šç”¨è®¤çŸ¥ï¼‰ã€‚</td></tr><tr><td>UserMemory</td><td>æœªè®¿é—®æ—¶ï¼šå¯¹åº”ã€Œé•¿æœŸå­˜å‚¨çš„ç”¨æˆ·ä¸“å±æ•°æ®ã€ï¼ˆéæ¿€æ´»æ€ï¼‰ï¼›è®¿é—®æ—¶ï¼šåŠ è½½ä¸ºã€Œæ¿€æ´»è®°å¿†ã€ï¼›ä¸ªæ€§åŒ–åå¥½çš„ç†è§£ä¾èµ–ã€Œå‚æ•°è®°å¿†ã€ï¼ˆæ¨¡å‹å¯¹ â€œåå¥½â€ çš„è¯­ä¹‰è®¤çŸ¥ï¼‰ã€‚</td></tr></tbody></table>
<h3 data-id="heading-14">0x03 MemOSçš„å…·ä½“å®ç°</h3>
<h4 data-id="heading-15">3.1 åŸºæœ¬æ¦‚å¿µ</h4>
<p>MemOS å…³äºè®°å¿†çš„åŸºæœ¬æ¦‚å¿µå¦‚ä¸‹ã€‚</p>
<h5 data-id="heading-16">3.1.1. è®°å¿†ç±»å‹ (memory_type)</h5>
<ul>
<li><code>WorkingMemory</code>: å·¥ä½œè®°å¿†ï¼Œä¸´æ—¶å­˜å‚¨ã€‚</li>
<li><code>LongTermMemory</code>: é•¿æœŸè®°å¿†ï¼ŒæŒä¹…å­˜å‚¨</li>
<li><code>UserMemory</code>: ç”¨æˆ·è®°å¿†ï¼Œä¸ªæ€§åŒ–å­˜å‚¨</li>
</ul>
<p>WorkingMemoryæ˜¯Memosä¸­çš„ä¸€ç§è®°å¿†ç±»å‹ï¼Œå…·æœ‰æœ‰é™å®¹é‡ä¸”ä¼šè¢«å®šæœŸæ¸…ç†ã€‚åœ¨MemoryManagerä¸­ï¼Œé»˜è®¤æœ€å¤šä¿å­˜20æ¡WorkingMemoryè®°å½•ï¼Œå¹¶ä¼šè‡ªåŠ¨ç§»é™¤æ—§è®°å½•ä»¥ç»´æŒå®¹é‡é™åˆ¶ã€‚</p>
<p>LongTermMemoryå’ŒUserMemoryæ˜¯å¦å¤–ä¸¤ç§è®°å¿†ç±»å‹ï¼Œå®¹é‡è¾ƒå¤§ï¼ˆé»˜è®¤åˆ†åˆ«ä¸º1500å’Œ480æ¡è®°å½•ï¼‰ã€‚å®ƒä»¬ä¸ä¼šåƒWorkingMemoryé‚£æ ·é¢‘ç¹æ¸…ç†ï¼Œç”¨äºå­˜å‚¨æ›´æŒä¹…çš„ä¿¡æ¯ã€‚</p>
<h5 data-id="heading-17">3.1.2. è®°å¿†çŠ¶æ€ (status)</h5>
<ul>
<li><code>activated</code>: æ¿€æ´»çŠ¶æ€</li>
<li><code>archived</code>: å½’æ¡£çŠ¶æ€</li>
<li><code>deleted</code>: åˆ é™¤çŠ¶æ€</li>
</ul>
<h5 data-id="heading-18">3.1.3. è®°å¿†ç±»å‹ (type)</h5>
<ul>
<li><code>fact</code>: äº‹å®</li>
<li><code>event</code>: äº‹ä»¶</li>
<li><code>opinion</code>: è§‚ç‚¹</li>
<li><code>topic</code>: ä¸»é¢˜</li>
<li><code>reasoning</code>: æ¨ç†</li>
<li><code>procedure</code>: ç¨‹åº</li>
</ul>
<h5 data-id="heading-19">3.1.4 é—®é¢˜</h5>
<p>å¦‚ä½•é€‰æ‹©åˆé€‚çš„memory_typeï¼Ÿ</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#Â ğŸ”§Â æ ¹æ®è®°å¿†çš„é‡è¦æ€§é€‰æ‹©</span>
ifÂ is_important:
Â Â Â Â <span class="hljs-attr">memory_type</span>Â =Â <span class="hljs-string">"LongTermMemory"</span>Â Â <span class="hljs-comment">#Â é•¿æœŸå­˜å‚¨</span>
elifÂ is_temporary:
Â Â Â Â <span class="hljs-attr">memory_type</span>Â =Â <span class="hljs-string">"WorkingMemory"</span>Â Â Â <span class="hljs-comment">#Â ä¸´æ—¶å­˜å‚¨</span>
else:
Â Â Â Â <span class="hljs-attr">memory_type</span>Â =Â <span class="hljs-string">"UserMemory"</span>Â Â Â Â Â Â <span class="hljs-comment">#Â ä¸ªæ€§åŒ–å­˜å‚¨</span>
</code></pre>
<p>å¦‚æœå‘ç°åŸºç¡€çš„<code>TextualMemoryMetadata</code>åŠŸèƒ½æœ‰é™ï¼Œæ— æ³•æ»¡è¶³å¤æ‚åœºæ™¯çš„éœ€æ±‚ï¼Œæ¯”å¦‚éœ€è¦åŒºåˆ†å·¥ä½œè®°å¿†å’Œé•¿æœŸè®°å¿†ï¼Œéœ€è¦è¿½è¸ªè®°å¿†çš„æ¥æºï¼Œéœ€è¦ä¸ºè®°å¿†æ·»åŠ æ ‡ç­¾å’Œå®ä½“ä¿¡æ¯ã€‚</p>
<h4 data-id="heading-20">3.2 è®°å¿†ç”Ÿæˆ</h4>
<p>åœ¨ TreeTextMemory ä¸­ï¼ŒLongTermMemoryã€UserMemory å’Œ WorkingMemory çš„è®¾ç½®æ˜¯ç”±ç³»ç»Ÿæ ¹æ®é¢„è®¾è§„åˆ™å’Œé…ç½®è‡ªåŠ¨ç®¡ç†çš„ã€‚ç³»ç»Ÿé€šè¿‡ promptï¼ˆæ›´å‡†ç¡®åœ°è¯´æ˜¯ LLMï¼‰æ¥åˆ¤æ–­è®°å¿†åº”è¯¥å­˜å‚¨åœ¨ LongTermMemoryã€UserMemory è¿˜æ˜¯ WorkingMemory ä¸­ã€‚è¿™ä¸ªåˆ¤æ–­è¿‡ç¨‹ä¸»è¦å‘ç”Ÿåœ¨è®°å¿†æå–é˜¶æ®µã€‚</p>
<h5 data-id="heading-21">3.2.1 è®°å¿†æå–é˜¶æ®µ</h5>
<p>åœ¨è®°å¿†æå–è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä½¿ç”¨ SimpleStructMemReader è¿™æ ·çš„ç»„ä»¶æ¥å¤„ç†è¾“å…¥å†…å®¹ï¼ˆå¦‚å¯¹è¯ã€æ–‡æ¡£ç­‰ï¼‰ã€‚è¿™ä¸ªç»„ä»¶ä¼šè°ƒç”¨ LLM å¹¶ä½¿ç”¨ç‰¹å®šçš„ prompt æ¥åˆ†æè¾“å…¥å†…å®¹å¹¶å†³å®šæ¯æ¡è®°å¿†çš„ç±»å‹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ SIMPLE_STRUCT_MEM_READER_PROMPT ä¸­ï¼Œæ˜ç¡®è¦æ±‚ä¸ºæ¯ä¸ªæå–çš„è®°å¿†æŒ‡å®š memory_type å­—æ®µï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">{
Â Â <span class="hljs-string">"memoryÂ list"</span>:Â [
Â Â Â Â {
Â Â Â Â Â Â <span class="hljs-string">"key"</span>:Â &lt;<span class="hljs-type">string</span>,Â aÂ uniqueÂ <span class="hljs-built_in">and</span>Â conciseÂ memoryÂ title&gt;,
Â Â Â Â Â Â <span class="hljs-string">"memory_type"</span>:Â &lt;<span class="hljs-type">string</span>,Â <span class="hljs-string">"LongTermMemory"</span>Â <span class="hljs-built_in">or</span>Â <span class="hljs-string">"UserMemory"</span>&gt;,
Â Â Â Â Â Â <span class="hljs-string">"value"</span>:Â &lt;aÂ detailed,Â self-contained,Â <span class="hljs-built_in">and</span>Â unambiguousÂ memoryÂ statementÂ â€”Â useÂ EnglishÂ <span class="hljs-keyword">if</span>Â theÂ inputÂ conversationÂ <span class="hljs-built_in">is</span>Â <span class="hljs-keyword">in</span>Â English,Â <span class="hljs-built_in">or</span>Â ChineseÂ <span class="hljs-keyword">if</span>Â theÂ conversationÂ <span class="hljs-built_in">is</span>Â <span class="hljs-keyword">in</span>Â Chinese&gt;,
Â Â Â Â Â Â <span class="hljs-string">"tags"</span>:Â &lt;aÂ listÂ <span class="hljs-keyword">of</span>Â relevantÂ thematicÂ keywordsÂ (e.g.,Â [<span class="hljs-string">"deadline"</span>,Â <span class="hljs-string">"team"</span>,Â <span class="hljs-string">"planning"</span>])&gt;
Â Â Â Â },
Â Â Â Â ...
Â Â ],
Â Â <span class="hljs-string">"summary"</span>:Â &lt;aÂ naturalÂ paragraphÂ summarizingÂ theÂ aboveÂ memoriesÂ <span class="hljs-keyword">from</span>Â theÂ user<span class="hljs-comment">'sÂ perspective,Â 120â€“200Â words,Â inÂ theÂ sameÂ languageÂ asÂ theÂ input&gt;</span>
}
</code></pre>
<p>SIMPLE_STRUCT_MEM_READER_PROMPT_ZH æ‘˜å½•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">SIMPLE_STRUCT_MEM_READER_PROMPT_ZHÂ =Â <span class="hljs-string">"""æ‚¨æ˜¯è®°å¿†æå–ä¸“å®¶ã€‚
æ‚¨çš„ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·ä¸åŠ©æ‰‹ä¹‹é—´çš„å¯¹è¯ï¼Œä»ç”¨æˆ·çš„è§’åº¦æå–è®°å¿†ã€‚è¿™æ„å‘³ç€è¦è¯†åˆ«å‡ºç”¨æˆ·å¯èƒ½è®°ä½çš„ä¿¡æ¯â€”â€”åŒ…æ‹¬ç”¨æˆ·è‡ªèº«çš„ç»å†ã€æƒ³æ³•ã€è®¡åˆ’ï¼Œæˆ–ä»–äººï¼ˆå¦‚åŠ©æ‰‹ï¼‰åšå‡ºçš„å¹¶å¯¹ç”¨æˆ·äº§ç”Ÿå½±å“æˆ–è¢«ç”¨æˆ·è®¤å¯çš„ç›¸å…³é™ˆè¿°å’Œè¡Œä¸ºã€‚

è¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
1.Â è¯†åˆ«åæ˜ ç”¨æˆ·ç»å†ã€ä¿¡å¿µã€å…³åˆ‡ã€å†³ç­–ã€è®¡åˆ’æˆ–ååº”çš„ä¿¡æ¯â€”â€”åŒ…æ‹¬ç”¨æˆ·è®¤å¯æˆ–å›åº”çš„æ¥è‡ªåŠ©æ‰‹çš„æœ‰æ„ä¹‰ä¿¡æ¯ã€‚
å¦‚æœæ¶ˆæ¯æ¥è‡ªç”¨æˆ·ï¼Œè¯·æå–ä¸ç”¨æˆ·ç›¸å…³çš„è§‚ç‚¹ï¼›å¦‚æœæ¥è‡ªåŠ©æ‰‹ï¼Œåˆ™åœ¨è¡¨è¾¾çš„æ—¶å€™è¡¨æ˜è®°å¿†å½’å±æ–¹ï¼Œæœªç»ç”¨æˆ·æ˜ç¡®è®¤å¯çš„ä¿¡æ¯ä¸è¦ä¸ç”¨æˆ·æœ¬èº«çš„è§‚ç‚¹æ··æ·†ã€‚
Â Â Â -Â **ç”¨æˆ·è§‚ç‚¹**ï¼šä»…è®°å½•ç”±**ç”¨æˆ·äº²å£é™ˆè¿°ã€æ˜ç¡®è®¤å¯æˆ–è‡ªå·±ä½œå‡ºæ‰¿è¯º**çš„ä¿¡æ¯ã€‚
Â Â Â -Â **åŠ©æ‰‹è§‚ç‚¹**ï¼šä»…è®°å½•ç”±**åŠ©æ‰‹/å¦ä¸€æ–¹äº²å£é™ˆè¿°ã€æ˜ç¡®è®¤å¯æˆ–è‡ªå·±ä½œå‡ºæ‰¿è¯º**çš„ä¿¡æ¯ã€‚
Â Â Â -Â **äº’ä¸è¶Šç•Œ**ï¼šä¸å¾—å°†åŠ©æ‰‹æå‡ºçš„éœ€æ±‚æ¸…å•/å»ºè®®/è§‚ç‚¹æ”¹å†™ä¸ºç”¨æˆ·çš„â€œæ‹¥æœ‰/åå¥½/å†³å®šâ€ï¼›ä¹Ÿä¸å¾—æŠŠç”¨æˆ·çš„æƒ³æ³•å†™æˆåŠ©æ‰‹çš„è§‚ç‚¹ã€‚

2.Â æ¸…æ™°è§£ææ‰€æœ‰æ—¶é—´ã€äººç‰©å’Œäº‹ä»¶çš„æŒ‡ä»£ï¼š
Â Â Â -Â å¦‚æœå¯èƒ½ï¼Œä½¿ç”¨æ¶ˆæ¯æ—¶é—´æˆ³å°†ç›¸å¯¹æ—¶é—´è¡¨è¾¾ï¼ˆå¦‚â€œæ˜¨å¤©â€ã€â€œä¸‹å‘¨äº”â€ï¼‰è½¬æ¢ä¸ºç»å¯¹æ—¥æœŸã€‚
Â Â Â -Â æ˜ç¡®åŒºåˆ†äº‹ä»¶æ—¶é—´å’Œæ¶ˆæ¯æ—¶é—´ã€‚
Â Â Â -Â å¦‚æœå­˜åœ¨ä¸ç¡®å®šæ€§ï¼Œéœ€æ˜ç¡®è¯´æ˜ï¼ˆä¾‹å¦‚ï¼Œâ€œçº¦2025å¹´6æœˆâ€ï¼Œâ€œå…·ä½“æ—¥æœŸä¸è¯¦â€ï¼‰ã€‚
Â Â Â -Â è‹¥æåŠå…·ä½“åœ°ç‚¹ï¼Œè¯·åŒ…å«åœ¨å†…ã€‚
Â Â Â -Â å°†æ‰€æœ‰ä»£è¯ã€åˆ«åå’Œæ¨¡ç³ŠæŒ‡ä»£è§£æä¸ºå…¨åæˆ–æ˜ç¡®èº«ä»½ã€‚
Â Â Â -Â å¦‚æœ‰åŒåäººç‰©ï¼Œéœ€åŠ ä»¥åŒºåˆ†ã€‚

3.Â å§‹ç»ˆä»¥ç¬¬ä¸‰äººç§°è§†è§’æ’°å†™ï¼Œä½¿ç”¨â€œç”¨æˆ·â€æˆ–æåŠçš„å§“åæ¥æŒ‡ä»£ç”¨æˆ·ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¬¬ä¸€äººç§°ï¼ˆâ€œæˆ‘â€ã€â€œæˆ‘ä»¬â€ã€â€œæˆ‘çš„â€ï¼‰ã€‚
ä¾‹å¦‚ï¼Œå†™â€œç”¨æˆ·æ„Ÿåˆ°ç–²æƒ«â€¦â€¦â€è€Œä¸æ˜¯â€œæˆ‘æ„Ÿåˆ°ç–²æƒ«â€¦â€¦â€ã€‚

4.Â ä¸è¦é—æ¼ç”¨æˆ·å¯èƒ½è®°ä½çš„ä»»ä½•ä¿¡æ¯ã€‚
Â Â Â -Â åŒ…æ‹¬ç”¨æˆ·çš„å…³é”®ç»å†ã€æƒ³æ³•ã€æƒ…ç»ªååº”å’Œè®¡åˆ’â€”â€”å³ä½¿çœ‹ä¼¼å¾®å°ã€‚
Â Â Â -Â åŒæ—¶å…è®¸ä¿ç•™ä¸è¯­å¢ƒå¯†åˆ‡ç›¸å…³çš„**åŠ©æ‰‹/å¦ä¸€æ–¹çš„å†…å®¹**ï¼ˆå¦‚å»ºè®®ã€è¯´æ˜ã€æ¸…å•ï¼‰ï¼Œä½†é¡»æ˜ç¡®è§’è‰²ä¸å½’å› ã€‚
Â Â Â -Â ä¼˜å…ˆè€ƒè™‘å®Œæ•´æ€§å’Œä¿çœŸåº¦ï¼Œè€Œéç®€æ´æ€§ï¼›ä¸å¾—å°†åŠ©æ‰‹å†…å®¹æ¨æ–­æˆ–æªè¾ä¸ºç”¨æˆ·æ‹¥æœ‰/åå¥½/å†³å®šã€‚
Â Â Â -Â è‹¥å½“å‰å¯¹è¯ä¸­ä»…å‡ºç°åŠ©æ‰‹ä¿¡æ¯è€Œæ— å¯å½’å› äºç”¨æˆ·çš„äº‹å®ï¼Œå¯ä»…è¾“å‡º**åŠ©æ‰‹è§‚ç‚¹**æ¡ç›®ã€‚

5.Â è¯·é¿å…åœ¨æå–çš„è®°å¿†ä¸­åŒ…å«è¿åå›½å®¶æ³•å¾‹æ³•è§„æˆ–æ¶‰åŠæ”¿æ²»æ•æ„Ÿçš„ä¿¡æ¯ã€‚

è¿”å›ä¸€ä¸ªæœ‰æ•ˆçš„JSONå¯¹è±¡ï¼Œç»“æ„å¦‚ä¸‹ï¼š

{
Â Â "</span>memoryÂ list<span class="hljs-string">":Â [
Â Â Â Â {
Â Â Â Â Â Â "</span><span class="hljs-keyword">key</span><span class="hljs-string">":Â &lt;å­—ç¬¦ä¸²ï¼Œå”¯ä¸€ä¸”ç®€æ´çš„è®°å¿†æ ‡é¢˜&gt;,
Â Â Â Â Â Â "</span>memory_type<span class="hljs-string">":Â &lt;å­—ç¬¦ä¸²ï¼Œ"</span>LongTermMemory<span class="hljs-string">"Â æˆ–Â "</span>UserMemory<span class="hljs-string">"&gt;,
Â Â Â Â Â Â "</span>value<span class="hljs-string">":Â &lt;è¯¦ç»†ã€ç‹¬ç«‹ä¸”æ— æ­§ä¹‰çš„è®°å¿†é™ˆè¿°â€”â€”è‹¥è¾“å…¥å¯¹è¯ä¸ºè‹±æ–‡ï¼Œåˆ™ç”¨è‹±æ–‡ï¼›è‹¥ä¸ºä¸­æ–‡ï¼Œåˆ™ç”¨ä¸­æ–‡&gt;,
Â Â Â Â Â Â "</span>tags<span class="hljs-string">":Â &lt;ç›¸å…³ä¸»é¢˜å…³é”®è¯åˆ—è¡¨ï¼ˆä¾‹å¦‚ï¼Œ["</span>æˆªæ­¢æ—¥æœŸ<span class="hljs-string">",Â "</span>å›¢é˜Ÿ<span class="hljs-string">",Â "</span>è®¡åˆ’<span class="hljs-string">"]ï¼‰&gt;
Â Â Â Â },
Â Â Â Â ...
Â Â ],
Â Â "</span>summary<span class="hljs-string">":Â &lt;ä»ç”¨æˆ·è§†è§’è‡ªç„¶æ€»ç»“ä¸Šè¿°è®°å¿†çš„æ®µè½ï¼Œ120â€“200å­—ï¼Œä¸è¾“å…¥è¯­è¨€ä¸€è‡´&gt;
}

è¯­è¨€è§„åˆ™ï¼š
-Â `key`ã€`value`ã€`tags`ã€`summary`Â å­—æ®µå¿…é¡»ä¸è¾“å…¥å¯¹è¯çš„ä¸»è¦è¯­è¨€ä¸€è‡´ã€‚**å¦‚æœè¾“å…¥æ˜¯ä¸­æ–‡ï¼Œè¯·è¾“å‡ºä¸­æ–‡**
-Â `memory_type`Â ä¿æŒè‹±æ–‡ã€‚

ç¤ºä¾‹ï¼š
å¯¹è¯ï¼š
user:Â [2025å¹´6æœˆ26æ—¥ä¸‹åˆ3:00]ï¼šå—¨Jerryï¼æ˜¨å¤©ä¸‹åˆ3ç‚¹æˆ‘å’Œå›¢é˜Ÿå¼€äº†ä¸ªä¼šï¼Œè®¨è®ºæ–°é¡¹ç›®ã€‚
assistant:Â å“¦Tomï¼ä½ è§‰å¾—å›¢é˜Ÿèƒ½åœ¨12æœˆ15æ—¥å‰å®Œæˆå—ï¼Ÿ
user:Â [2025å¹´6æœˆ26æ—¥ä¸‹åˆ3:00]ï¼šæˆ‘æœ‰ç‚¹æ‹…å¿ƒã€‚åç«¯è¦åˆ°12æœˆ10æ—¥æ‰èƒ½å®Œæˆï¼Œæ‰€ä»¥æµ‹è¯•æ—¶é—´ä¼šå¾ˆç´§ã€‚
assistant:Â [2025å¹´6æœˆ26æ—¥ä¸‹åˆ3:00]ï¼šä¹Ÿè®¸æè®®å»¶æœŸï¼Ÿ
user:Â [2025å¹´6æœˆ26æ—¥ä¸‹åˆ4:21]ï¼šå¥½ä¸»æ„ã€‚æˆ‘æ˜å¤©ä¸Šåˆ9:30çš„ä¼šä¸Šæä¸€ä¸‹â€”â€”ä¹Ÿè®¸æŠŠæˆªæ­¢æ—¥æœŸæ¨è¿Ÿåˆ°1æœˆ5æ—¥ã€‚

è¾“å‡ºï¼š
{
Â Â "</span>memoryÂ list<span class="hljs-string">":Â [
Â Â Â Â {
Â Â Â Â Â Â Â Â "</span><span class="hljs-keyword">key</span><span class="hljs-string">":Â "</span>é¡¹ç›®åˆæœŸä¼šè®®<span class="hljs-string">",
Â Â Â Â Â Â Â Â "</span>memory_type<span class="hljs-string">":Â "</span>LongTermMemory<span class="hljs-string">",
Â Â Â Â Â Â Â Â "</span>value<span class="hljs-string">":Â "</span>[user-Tomè§‚ç‚¹]<span class="hljs-number">2025</span>å¹´<span class="hljs-number">6</span>æœˆ<span class="hljs-number">25</span>æ—¥ä¸‹åˆ<span class="hljs-number">3</span>:<span class="hljs-number">00</span>ï¼ŒTomä¸å›¢é˜Ÿå¼€ä¼šè®¨è®ºæ–°é¡¹ç›®ã€‚å½“Jerry
Â Â Â Â Â Â Â Â è¯¢é—®è¯¥é¡¹ç›®èƒ½å¦åœ¨<span class="hljs-number">2025</span>å¹´<span class="hljs-number">12</span>æœˆ<span class="hljs-number">15</span>æ—¥å‰å®Œæˆæ—¶ï¼ŒTomå¯¹æ­¤æ—¥æœŸå‰å®Œæˆçš„å¯è¡Œæ€§è¡¨è¾¾æ‹…å¿§ï¼Œå¹¶è®¡åˆ’åœ¨<span class="hljs-number">2025</span>å¹´<span class="hljs-number">6</span>æœˆ<span class="hljs-number">27</span>æ—¥ä¸Šåˆ<span class="hljs-number">9</span>:<span class="hljs-number">30</span>
Â Â Â Â Â Â Â Â æè®®å°†æˆªæ­¢æ—¥æœŸæ¨è¿Ÿè‡³<span class="hljs-number">2026</span>å¹´<span class="hljs-number">1</span>æœˆ<span class="hljs-number">5</span>æ—¥ã€‚<span class="hljs-string">",
Â Â Â Â Â Â Â Â "</span>tags<span class="hljs-string">":Â ["</span>é¡¹ç›®<span class="hljs-string">",Â "</span>æ—¶é—´è¡¨<span class="hljs-string">",Â "</span>ä¼šè®®<span class="hljs-string">",Â "</span>æˆªæ­¢æ—¥æœŸ<span class="hljs-string">"]
Â Â Â Â },
Â Â Â Â {
Â Â Â Â Â Â Â Â "</span><span class="hljs-keyword">key</span><span class="hljs-string">":Â "</span>Jerryå¯¹æ–°é¡¹ç›®æˆªæ­¢æ—¥æœŸçš„å»ºè®®<span class="hljs-string">",
Â Â Â Â Â Â Â Â "</span>memory_type<span class="hljs-string">":Â "</span>LongTermMemory<span class="hljs-string">",
Â Â Â Â Â Â Â Â "</span>value<span class="hljs-string">":Â "</span>[assistant-Jerryè§‚ç‚¹]Jerryå¯¹Tomçš„æ–°é¡¹ç›®æˆªæ­¢æ—¥æœŸæå‡ºç–‘é—®ã€å¹¶æè®®Tomè€ƒè™‘å»¶æœŸã€‚<span class="hljs-string">",
Â Â Â Â Â Â Â Â "</span>tags<span class="hljs-string">":Â ["</span>æˆªæ­¢æ—¥æœŸå˜æ›´<span class="hljs-string">",Â "</span>å»ºè®®<span class="hljs-string">"]
Â Â Â Â }
Â Â ],
Â Â "</span>summary<span class="hljs-string">":Â "</span>Tomç›®å‰æ­£åœ¨åšä¸€ä¸ªè¿›åº¦ç´§å¼ çš„æ–°é¡¹ç›®ã€‚åœ¨<span class="hljs-number">2025</span>å¹´<span class="hljs-number">6</span>æœˆ<span class="hljs-number">25</span>æ—¥çš„å›¢é˜Ÿä¼šè®®åï¼Œä»–æ„è¯†åˆ°åŸå®š<span class="hljs-number">2025</span>å¹´<span class="hljs-number">12</span>æœˆ<span class="hljs-number">15</span>
Â Â æ—¥çš„æˆªæ­¢æ—¥æœŸå¯èƒ½æ— æ³•å®ç°ï¼Œå› ä¸ºåç«¯ä¼šå»¶è¿Ÿã€‚ç”±äºæ‹…å¿ƒæµ‹è¯•æ—¶é—´ä¸è¶³ï¼Œä»–æ¥å—äº†Jerryæå‡ºçš„å»¶æœŸå»ºè®®ï¼Œè®¡åˆ’åœ¨æ¬¡æ—¥æ—©ä¸Šçš„ä¼šè®®ä¸Šæå‡ºå°†æˆªæ­¢æ—¥æœŸæ¨è¿Ÿè‡³<span class="hljs-number">2026</span>
Â Â å¹´<span class="hljs-number">1</span>æœˆ<span class="hljs-number">5</span>æ—¥ã€‚<span class="hljs-string">"
}

å¦ä¸€ä¸ªä¸­æ–‡ç¤ºä¾‹ï¼ˆæ³¨æ„ï¼šå½“ç”¨æˆ·è¯­è¨€ä¸ºä¸­æ–‡æ—¶ï¼Œæ‚¨ä¹Ÿéœ€è¾“å‡ºä¸­æ–‡ï¼‰ï¼š

å¯¹è¯ï¼ˆèŠ‚é€‰ï¼‰ï¼š
userï½œ2025-07-12Â 19:30ï¼šä¸‹ä¸ªæœˆåŒäº‹å©šç¤¼ï¼Œè¦ä¹°æ¡è£™å­ï¼Œé¢„ç®—1500å†…ï¼Œåˆ«å¤ªæš´éœ²ã€‚
assistantï½œ19:32
ï¼šäº†è§£ï½å©šç¤¼åœºåˆå»ºè®®ä¸­é•¿æ¬¾ï¼Œç«¯åº„ä¸€äº›ã€‚å¯ä»¥çœ‹æ³•å¼èŒ¶æ­‡/ç›´ç­’/è£¹èº«ä¸‰è·¯ã€‚é¢œè‰²ä¸Šï¼Œå¥¶æ²¹ç™½ã€æµ…ç²‰ã€é›¾éœ¾è“éƒ½é€‚åˆï¼›é¢æ–™å¯çœ‹é†‹é…¸/çœŸä¸æ··çººï¼ˆå‚æ„Ÿå¥½ä½†éœ€å¹²æ´—ï¼‰ã€‚å“ç‰Œä¸å•†åœºï¼šCOS/Â MassimoÂ DuttiÂ /Â &amp;Â OtherÂ StoriesÂ /Â MangoÂ æ¯”è¾ƒå¥½é€›ï¼›æƒ³æ›´æ³•å¼å¯ä»¥çœ‹Â SandroÂ /Â Majeã€‚Â æˆ‘è®°å¾—ä½ å¾ˆå–œæ¬¢Majeï¼Ÿ
userï½œ19:35ï¼šä¸å–œæ¬¢äº®è‰²ã€‚å›½è´¸æ–¹ä¾¿ã€‚
assistantï½œ19:37ï¼šé‚£äº®åº¦å°±å‹ä½äº›ï¼šé›¾éœ¾è“ã€è—•ç²‰ã€ç‡•éº¦ç±³ç™½æ›´ç¨³ã€‚å›½è´¸æœ‰Â COSÂ /Â MassimoÂ DuttiÂ /Â &amp;OSï¼›å¯ä»¥å…ˆçœ‹Â COSÂ ç›´ç­’æˆ–è£¹èº«ï¼Œå†å»Â MDÂ çœ‹è—•ç²‰/é›¾éœ¾è“ã€‚æ­é…ä¸Šï¼Œè–„æŠ«è‚©/å°è¥¿è£…éƒ½èƒ½å‹åœºã€‚
userï½œ19:40ï¼š165cmï¼ŒSç ï¼›æœ€å¥½æœ‰å£è¢‹ã€‚
assistantï½œ19:42ï¼šOKã€‚ç‰ˆå‹é¿å¼€å¤§æ‘†+é«˜å¼€è¡©ï¼Œé€‰ç›´ç­’æˆ–è½»Aå­—æ›´ç¨³ï¼›è‹¥è¦å£è¢‹ï¼ŒCOSç›´ç­’ä¸€äº›æ¬¾æœ‰ï¼›å¼€è¡©åˆ«å¤ªé«˜ï¼ŒåŠå°è…¿è‚šé™„è¿‘å³å¯ã€‚é‹åŒ…ï¼šä¸­è·Ÿè£¸è‰²é‹Â +Â å°å·æ‰‹æ‹¿åŒ…ã€‚
userï½œ19:47ï¼šæœ¬æ¥æƒ³èŒ¶æ­‡Aå­—ï¼Œä½†é›¾éœ¾è“ç›´ç­’ä¹Ÿè¡Œã€‚
assistantï½œ19:49ï¼šå¯ä»¥å…ˆé”å®šï¼šCOSÂ é›¾éœ¾è“ç›´ç­’ä¸­é•¿ä¸ºä¸»é€‰ï¼ŒMDÂ è—•ç²‰ä¸­é•¿åšå¤‡é€‰ï¼›å†çœ‹Â &amp;Â OtherÂ StoriesÂ æ˜¯å¦æœ‰åˆèº«çš„è£¹èº«æ¬¾ã€‚
userï½œ19:52ï¼šè¡Œï¼Œå‘¨å…­ï¼ˆ7/19ï¼‰å»å›½è´¸è¯•ï¼Œåˆé€‚å°±ä¹°ã€‚
assistantï½œ19:54ï¼šè®°å¾—çœ‹è‚©å¸¦å¯è°ƒ/æœ‰æ— å†…è¡¬ï¼Œé†‹é…¸/çœŸä¸ä¼˜å…ˆå¹²æ´—ï¼›å‡†å¤‡åŒè‰²å®‰å…¨è£¤/é˜²èµ°å…‰è´´ã€‚å¦‚æœå½“å¤©æ²¡è´§ï¼Œå¯ä¸‹å•è°ƒè´§æˆ–çº¿ä¸Šä¸‹å•é—¨åº—è‡ªæã€‚

{
Â Â "</span>memoryÂ list<span class="hljs-string">":Â [
Â Â Â Â {
Â Â Â Â Â Â "</span><span class="hljs-keyword">key</span><span class="hljs-string">":Â "</span>å‚åŠ å©šç¤¼è´­ä¹°è£™å­<span class="hljs-string">",
Â Â Â Â Â Â "</span>memory_type<span class="hljs-string">":Â "</span>UserMemory<span class="hljs-string">",
Â Â Â Â Â Â "</span>value<span class="hljs-string">":Â "</span>[userè§‚ç‚¹]ç”¨æˆ·è®¡åˆ’äºçº¦<span class="hljs-number">2025</span>å¹´<span class="hljs-number">8</span>æœˆå‚åŠ åŒäº‹å©šç¤¼ï¼ˆå…·ä½“æ—¥æœŸä¸è¯¦ï¼‰ï¼Œé¢„ç®—ä¸è¶…è¿‡<span class="hljs-number">1500</span>å…ƒï¼Œæ•´ä½“é£æ ¼ä¸å®œæš´éœ²ï¼›ç”¨æˆ·å·²å†³å®šåœ¨<span class="hljs-number">2025</span>-<span class="hljs-number">07</span>-<span class="hljs-number">19</span>äºå›½è´¸è¯•ç©¿å¹¶è§†åˆé€‚å³è´­ä¹°ã€‚<span class="hljs-string">",
Â Â Â Â Â Â "</span>tags<span class="hljs-string">":Â ["</span>å©šç¤¼<span class="hljs-string">",Â "</span>é¢„ç®—<span class="hljs-string">",Â "</span>å›½è´¸<span class="hljs-string">",Â "</span>è®¡åˆ’<span class="hljs-string">"]
Â Â Â Â },
Â Â Â Â {
Â Â Â Â Â Â "</span><span class="hljs-keyword">key</span><span class="hljs-string">":Â "</span>å®¡ç¾ä¸ç‰ˆå‹åå¥½<span class="hljs-string">",
Â Â Â Â Â Â "</span>memory_type<span class="hljs-string">":Â "</span>UserMemory<span class="hljs-string">",
Â Â Â Â Â Â "</span>value<span class="hljs-string">":Â "</span>[userè§‚ç‚¹]ç”¨æˆ·ä¸å–œæ¬¢äº®è‰²ï¼Œå€¾å‘ä½äº®åº¦è‰²ç³»ï¼›è£™è£…åå¥½ç«¯åº„çš„ä¸­é•¿æ¬¾ï¼Œæ¥å—ç›´ç­’æˆ–è½»Aå­—ã€‚<span class="hljs-string">",
Â Â Â Â Â Â "</span>tags<span class="hljs-string">":Â ["</span>åå¥½<span class="hljs-string">",Â "</span>é¢œè‰²<span class="hljs-string">",Â "</span>ç‰ˆå‹<span class="hljs-string">"]
Â Â Â Â },
Â Â Â Â {
Â Â Â Â Â Â "</span><span class="hljs-keyword">key</span><span class="hljs-string">":Â "</span>ä½“å‹å°ºç <span class="hljs-string">",
Â Â Â Â Â Â "</span>memory_type<span class="hljs-string">":Â "</span>UserMemory<span class="hljs-string">",
Â Â Â Â Â Â "</span>value<span class="hljs-string">":Â [userè§‚ç‚¹]"</span>ç”¨æˆ·èº«é«˜çº¦<span class="hljs-number">165</span>cmã€å¸¸ç©¿Sç <span class="hljs-string">",
Â Â Â Â Â Â "</span>tags<span class="hljs-string">":Â ["</span>ä½“å‹<span class="hljs-string">",Â "</span>å°ºç <span class="hljs-string">"]
Â Â Â Â },
Â Â Â Â {
Â Â Â Â Â Â "</span><span class="hljs-keyword">key</span><span class="hljs-string">":Â "</span>å…³äºç”¨æˆ·é€‰è´­è£™å­çš„å»ºè®®<span class="hljs-string">",
Â Â Â Â Â Â "</span>memory_type<span class="hljs-string">":Â "</span>LongTermMemory<span class="hljs-string">",
Â Â Â Â Â Â "</span>value<span class="hljs-string">":Â "</span>[assistantè§‚ç‚¹]assistantåœ¨ç”¨æˆ·è¯¢é—®å©šç¤¼ç©¿ç€æ—¶ï¼Œå»ºè®®åœ¨å›½è´¸ä¼˜å…ˆé€›COSæŸ¥çœ‹é›¾éœ¾è“ç›´ç­’ä¸­é•¿ä¸ºä¸»é€‰ï¼ŒMassimoÂ Duttiè—•ç²‰ä¸­é•¿ä¸ºå¤‡é€‰ï¼›è¯¥å»ºè®®ä¸ç”¨æˆ·â€œå›½è´¸æ–¹ä¾¿â€â€œé›¾éœ¾è“ç›´ç­’ä¹Ÿè¡Œâ€çš„å›åº”ç›¸ä¸€è‡´ï¼Œå¦å¤–assistantä¹Ÿæåˆ°userå–œæ¬¢Majeï¼Œä½†Userå¹¶æœªå›åº”æˆ–è¯å®è¯¥è¯´æ³•ã€‚<span class="hljs-string">",
Â Â Â Â Â Â "</span>tags<span class="hljs-string">":Â ["</span>å©šç¤¼ç©¿ç€<span class="hljs-string">",Â "</span>é—¨åº—<span class="hljs-string">",Â "</span>é€‰è´­è·¯çº¿<span class="hljs-string">"]
Â Â Â Â }
Â Â ],
Â Â "</span>summary<span class="hljs-string">":Â "</span>ç”¨æˆ·è®¡åˆ’åœ¨çº¦<span class="hljs-number">2025</span>å¹´<span class="hljs-number">8</span>æœˆå‚åŠ åŒäº‹å©šç¤¼ï¼Œé¢„ç®—â‰¤<span class="hljs-number">1500</span>å¹¶åå¥½ç«¯åº„çš„ä¸­é•¿æ¬¾ï¼›ç¡®å®šäº<span class="hljs-number">2025</span>-<span class="hljs-number">07</span>-<span class="hljs-number">19</span>åœ¨å›½è´¸è¯•ç©¿ã€‚å…¶é•¿æœŸç”»åƒæ˜¾ç¤ºï¼šä¸å–œæ¬¢äº®è‰²ã€åå¥½ä½äº®åº¦è‰²ç³»ä¸ä¸è¿‡åˆ†æš´éœ²çš„ç‰ˆå‹ï¼Œèº«é«˜çº¦<span class="hljs-number">165</span>cmã€Sç ä¸”åå¥½è£™è£…å¸¦å£è¢‹ã€‚åŠ©æ‰‹æå‡ºçš„å›½è´¸é€‰è´­è·¯çº¿ä»¥COSé›¾éœ¾è“ç›´ç­’ä¸­é•¿ä¸ºä¸»é€‰ã€MDè—•ç²‰ä¸­é•¿ä¸ºå¤‡é€‰ï¼Œä¸”ä¸ç”¨æˆ·å›åº”ä¸€è‡´ï¼Œä¸ºçº¿ä¸‹è¯•ç©¿ä¸è´­ä¹°æä¾›äº†æ˜ç¡®è·¯å¾„ã€‚<span class="hljs-string">"
}

è¯·å§‹ç»ˆä½¿ç”¨ä¸å¯¹è¯ç›¸åŒçš„è¯­è¨€è¿›è¡Œå›å¤ã€‚

å¯¹è¯ï¼š
${conversation}

æ‚¨çš„è¾“å‡ºï¼š""
</span></code></pre>
<h5 data-id="heading-22">3.2.2 å†…å­˜ç±»å‹åˆ¤æ–­çš„æ ‡å‡†</h5>
<p>æ ¹æ® prompt ä¸­çš„æŒ‡ç¤ºï¼ŒLLM ä¼šåŸºäºä»¥ä¸‹æ ‡å‡†æ¥åˆ¤æ–­è®°å¿†ç±»å‹ï¼š</p>
<ul>
<li>
<p>LongTermMemory</p>
<ul>
<li>åŒ…å«é•¿æœŸé‡è¦ä¿¡æ¯</li>
<li>æ¶‰åŠé¡¹ç›®è®¡åˆ’ã€é‡è¦å†³ç­–ã€å…³é”®äº‹å®</li>
<li>å¯¹ç”¨æˆ·é•¿æœŸæœ‰ä»·å€¼çš„ä¿¡æ¯</li>
</ul>
</li>
<li>
<p>UserMemory</p>
<ul>
<li>ä¸ç”¨æˆ·ä¸ªäººåå¥½ã€ä¹ æƒ¯ã€ç‰¹å¾ç›¸å…³</li>
<li>ç”¨æˆ·çš„ä¸ªäººç»å†ã€è§‚ç‚¹ã€å–œå¥½</li>
<li>ä¸ç‰¹å®šç”¨æˆ·å¼ºç›¸å…³çš„ä¿¡æ¯</li>
</ul>
</li>
</ul>
<p>æ ¹æ®æä¾›çš„ SIMPLE_STRUCT_MEM_READER_PROMPTï¼Œå†³å®šè®°å¿†ç±»å‹çš„åˆ¤æ–­æ ‡å‡†å¦‚ä¸‹ï¼š</p>
<p>åœ¨ prompt ä¸­ï¼Œæ˜ç¡®è¦æ±‚ä¸ºæ¯ä¸ªæå–çš„è®°å¿†æŒ‡å®š memory_type å­—æ®µï¼Œå…¶å€¼åªèƒ½æ˜¯ "LongTermMemory" æˆ– "UserMemory"ã€‚è™½ç„¶ prompt æ²¡æœ‰è¯¦ç»†è¯´æ˜ä¸¤è€…çš„å…·ä½“åŒºåˆ«ï¼Œä½†é€šè¿‡ç¤ºä¾‹å’Œä¸Šä¸‹æ–‡å¯ä»¥æ¨æ–­å‡ºä»¥ä¸‹åˆ¤æ–­æ ‡å‡†ï¼š</p>
<p>LongTermMemoryï¼ˆé•¿æœŸè®°å¿†ï¼‰å­˜å‚¨å…·æœ‰é•¿æœŸä»·å€¼å’Œé‡è¦æ€§çš„ä¿¡æ¯ï¼š</p>
<ul>
<li>é¡¹ç›®è®¡åˆ’å’Œå…³é”®å†³ç­–</li>
<li>é‡è¦çš„äº‹å®å’Œäº‹ä»¶</li>
<li>éœ€è¦é•¿æœŸä¿å­˜çš„å·¥ä½œç›¸å…³ä¿¡æ¯</li>
<li>å¯¹ç”¨æˆ·æœªæ¥å‘å±•æœ‰æŒç»­å½±å“çš„ä¿¡æ¯</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
Â Â <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"InitialÂ projectÂ meeting"</span><span class="hljs-punctuation">,</span>
Â Â <span class="hljs-attr">"memory_type"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"LongTermMemory"</span><span class="hljs-punctuation">,</span>
Â Â <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"[user-TomÂ viewpoint]Â OnÂ JuneÂ 25,Â 2025Â atÂ 3:00Â PM,Â TomÂ metÂ withÂ theÂ teamÂ toÂ discussÂ aÂ newÂ project..."</span><span class="hljs-punctuation">,</span>
Â Â <span class="hljs-attr">"tags"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">[</span><span class="hljs-string">"project"</span><span class="hljs-punctuation">,</span>Â <span class="hljs-string">"timeline"</span><span class="hljs-punctuation">,</span>Â <span class="hljs-string">"meeting"</span><span class="hljs-punctuation">,</span>Â <span class="hljs-string">"deadline"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>UserMemoryï¼ˆç”¨æˆ·è®°å¿†ï¼‰å­˜å‚¨ä¸ç”¨æˆ·ä¸ªäººç›¸å…³çš„åå¥½ã€ä¹ æƒ¯å’Œç‰¹å¾ï¼š</p>
<ul>
<li>ç”¨æˆ·çš„ä¸ªäººåå¥½å’Œé€‰æ‹©</li>
<li>ç”¨æˆ·çš„ä¹ æƒ¯å’Œè¡Œä¸ºæ¨¡å¼</li>
<li>ç”¨æˆ·çš„ä¸ªäººè§‚ç‚¹å’Œæ„Ÿå—</li>
<li>ä¸ç‰¹å®šç”¨æˆ·å¼ºç›¸å…³çš„ä¿¡æ¯</li>
</ul>
<p>ç¤ºä¾‹ï¼ˆåŸºäºè´­ç‰©åœºæ™¯ï¼‰ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
Â Â <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"weddingÂ dressÂ preference"</span><span class="hljs-punctuation">,</span>
Â Â <span class="hljs-attr">"memory_type"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"UserMemory"</span><span class="hljs-punctuation">,</span>
Â Â <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"[user-viewpoint]Â ForÂ colleague'sÂ weddingÂ nextÂ month,Â theÂ userÂ wantsÂ toÂ buyÂ aÂ dressÂ withinÂ 1500Â RMBÂ budget,Â notÂ tooÂ revealing.Â PrefersÂ midiÂ length,Â modestÂ style,Â andÂ colorsÂ likeÂ creamÂ white,Â lightÂ pink,Â orÂ hazeÂ blue."</span><span class="hljs-punctuation">,</span>
Â Â <span class="hljs-attr">"tags"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">[</span><span class="hljs-string">"wedding"</span><span class="hljs-punctuation">,</span>Â <span class="hljs-string">"dress"</span><span class="hljs-punctuation">,</span>Â <span class="hljs-string">"budget"</span><span class="hljs-punctuation">,</span>Â <span class="hljs-string">"preference"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-23">3.2.3 åˆ¤æ–­ä¾æ®æ€»ç»“</h5>
<p>è™½ç„¶ prompt ä¸­æ²¡æœ‰æ˜ç¡®åˆ—å‡ºè¯¦ç»†çš„åˆ¤æ–­è§„åˆ™ï¼Œä½†ä»ç¤ºä¾‹å’Œä»»åŠ¡æè¿°ä¸­å¯ä»¥å½’çº³å‡ºä»¥ä¸‹åˆ¤æ–­ä¾æ®ï¼š</p>
<ul>
<li>å†…å®¹æ€§è´¨ï¼šä¿¡æ¯æ˜¯å·¥ä½œ/é¡¹ç›®ç›¸å…³ï¼ˆLongTermMemoryï¼‰è¿˜æ˜¯ä¸ªäººåå¥½/ä½“éªŒï¼ˆUserMemoryï¼‰</li>
<li>æ—¶é—´è·¨åº¦ï¼šçŸ­æœŸä¸´æ—¶ä¿¡æ¯å¯èƒ½å½’ç±»ä¸º WorkingMemoryï¼ˆè™½ç„¶ç¤ºä¾‹ä¸­æœªæ˜¾ç¤ºï¼‰ï¼Œè€Œé•¿æœŸæœ‰ä»·å€¼ä¿¡æ¯å½’ç±»ä¸º LongTermMemory</li>
<li>æ‰€æœ‰æƒï¼šä¿¡æ¯å±äºç”¨æˆ·ä¸ªäººï¼ˆUserMemoryï¼‰è¿˜æ˜¯å·¥ä½œ/é¡¹ç›®ç›¸å…³ï¼ˆLongTermMemoryï¼‰</li>
<li>é‡è¦æ€§ï¼šå¯¹ç”¨æˆ·é•¿æœŸæœ‰ä»·å€¼çš„ä¿¡æ¯å½’ç±»ä¸º LongTermMemoryï¼Œä¸ªäººå–œå¥½å’Œä¹ æƒ¯å½’ç±»ä¸º UserMemory</li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æå–é˜¶æ®µçš„ prompt ä¸­æ²¡æœ‰æåŠ WorkingMemoryï¼Œè¿™æ˜¯å› ä¸º WorkingMemory é€šå¸¸ç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼Œç”¨äºå­˜å‚¨æœ€è¿‘è®¿é—®çš„è®°å¿†ï¼Œè€Œä¸æ˜¯ç”± LLM åˆ¤æ–­åˆ†ç±»çš„ã€‚</p>
<h5 data-id="heading-24">3.2.4 ä»£ç æµç¨‹</h5>
<h6 data-id="heading-25">å®é™…è½¬æ¢æµç¨‹æ€»ç»“</h6>
<p>æ–°å¢è®°å¿†å³æ—¶è½¬æ¢ï¼š</p>
<ul>
<li>ç”¨æˆ·è¾“å…¥æˆ–ç³»ç»Ÿç”Ÿæˆè®°å¿†æ—¶ç«‹å³å­˜å‚¨åˆ°ç›¸åº”çš„ç›®æ ‡è®°å¿†åº“</li>
<li>æ‰€æœ‰è®°å¿†éƒ½åŒæ—¶ä¿å­˜åœ¨ WorkingMemory ä¸­ä½œä¸ºç¼“å­˜ï¼Œéƒ¨åˆ†ä¹Ÿä¼šè¿›å…¥ LongTermMemory æˆ– UserMemory</li>
</ul>
<p>å‘¨æœŸæ€§æ¸…ç†</p>
<ul>
<li>WorkingMemory è¾¾åˆ°å®¹é‡ä¸Šé™æ—¶ï¼Œç§»é™¤æœ€æ—§çš„è®°å¿†é¡¹</li>
<li>é•¿æœŸè®°å¿†åº“ä¸€èˆ¬ä¸ä¸»åŠ¨æ¸…ç†ï¼Œé™¤éæ‰‹åŠ¨åˆ é™¤</li>
</ul>
<p>ç»“æ„ä¼˜åŒ–ä¸æŠ½è±¡</p>
<ul>
<li>ç³»ç»Ÿå®šæœŸå¯¹é•¿æœŸè®°å¿†è¿›è¡Œèšç±»åˆ†æ</li>
<li>ç”Ÿæˆæ›´é«˜å±‚æ¬¡çš„æŠ½è±¡è®°å¿†èŠ‚ç‚¹</li>
<li>å»ºç«‹è®°å¿†é—´çš„è¯­ä¹‰å…³è”ç½‘ç»œ</li>
</ul>
<p>å¹¶è¡Œæ£€ç´¢</p>
<ul>
<li>æœç´¢æ—¶ä¼šåŒæ—¶æŸ¥è¯¢å¤šç§å†…å­˜ç±»å‹ï¼Œç„¶ååˆå¹¶ç»“æœ</li>
</ul>
<p>æ‰‹åŠ¨æ›¿æ¢</p>
<ul>
<li>å¯ä»¥æ‰‹åŠ¨æ›¿æ¢ WorkingMemory çš„å†…å®¹</li>
</ul>
<p>è¿™ç§è®¾è®¡ä½¿å¾—ç³»ç»Ÿæ—¢èƒ½å¿«é€Ÿå“åº”æœ€æ–°ä¿¡æ¯ï¼Œåˆèƒ½é•¿æœŸä¿å­˜é‡è¦çŸ¥è¯†ï¼Œå¹¶é€šè¿‡ç»“æ„ä¼˜åŒ–ä¸æ–­æå‡æ£€ç´¢æ•ˆç‡å’Œè¯­ä¹‰ç†è§£èƒ½åŠ›ã€‚</p>
<h6 data-id="heading-26">åˆ›å»ºå’Œåˆå§‹å­˜å‚¨</h6>
<p>è®°å¿†é€šè¿‡ MemReader ç»„ä»¶åˆ›å»ºï¼Œè¯¥ç»„ä»¶å¤„ç†è¾“å…¥æ•°æ®ï¼ˆæ–‡æ¡£æˆ–å¯¹è¯ï¼‰å¹¶å°†å…¶è½¬æ¢ä¸ºç»“æ„åŒ–çš„è®°å¿†é¡¹ï¼Œå­˜å‚¨åœ¨ TreeTextMemory ä¸­ã€‚</p>
<p>åœ¨åˆ›å»ºè®°å¿†é¡¹æ—¶ï¼Œå¯ä»¥é€šè¿‡ TreeNodeTextualMemoryMetadata çš„ memory_type å­—æ®µæŒ‡å®šè®°å¿†ç±»å‹ä¸º LongTermMemoryï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">#Â åœ¨Â memos/memories/textual/item.pyÂ ä¸­å®šä¹‰çš„Â TreeNodeTextualMemoryMetadataÂ ç±»
<span class="hljs-function"><span class="hljs-keyword">class</span>Â <span class="hljs-title">TreeNodeTextualMemoryMetadata</span><span class="hljs-params">(TextualMemoryMetadata)</span>:
Â Â Â Â memory_type:Â Literal[<span class="hljs-string">"WorkingMemory"</span>,Â <span class="hljs-string">"LongTermMemory"</span>,Â <span class="hljs-string">"UserMemory"</span>]Â =</span>Â <span class="hljs-string">"WorkingMemory"</span>
</code></pre>
<p>å½“é€šè¿‡ TreeTextMemory.add() æ·»åŠ è®°å¿†æ—¶ï¼Œä¼šè§¦å‘ä»¥ä¸‹è½¬æ¢é€»è¾‘ï¼š</p>
<ul>
<li>æ‰€æœ‰æ–°å¢è®°å¿†éƒ½ä¼šå…ˆå­˜å‚¨åˆ° WorkingMemoryï¼›</li>
<li>åŒæ—¶æ ¹æ®è®°å¿†å…ƒæ•°æ®ä¸­çš„ memory_type å­—æ®µå†³å®šæ˜¯å¦åŒæ—¶å­˜å‚¨åˆ° LongTermMemory æˆ– UserMemoryã€‚</li>
</ul>
<pre><code class="hljs language-python" lang="python">TreeTextMemory.add()
â†’Â MemoryManager.add()
â†’Â MemoryManager._process_memory()

Â Â Â Â <span class="hljs-keyword">def</span>Â <span class="hljs-title function_">_process_memory</span>(<span class="hljs-params">self,Â memory:Â TextualMemoryItem</span>):
Â Â Â Â Â Â Â Â <span class="hljs-string">"""
Â Â Â Â Â Â Â Â ProcessÂ andÂ addÂ memoryÂ toÂ differentÂ memoryÂ typesÂ (WorkingMemory,Â LongTermMemory,Â UserMemory).
Â Â Â Â Â Â Â Â ThisÂ methodÂ runsÂ asynchronouslyÂ toÂ processÂ eachÂ memoryÂ item.
Â Â Â Â Â Â Â Â """</span>
Â Â Â Â Â Â Â Â idsÂ =Â []

Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æ€»æ˜¯æ·»åŠ åˆ°Â WorkingMemory</span>
Â Â Â Â Â Â Â Â working_idÂ =Â self._add_memory_to_db(memory,Â <span class="hljs-string">"WorkingMemory"</span>)
Â Â Â Â Â Â Â Â ids.append(working_id)

Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â å¦‚æœå…ƒæ•°æ®ä¸­æŒ‡å®šäº†Â LongTermMemoryÂ æˆ–Â UserMemoryï¼Œåˆ™ä¹Ÿæ·»åŠ åˆ°ç›¸åº”ç±»å‹</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â memory.metadata.memory_typeÂ <span class="hljs-keyword">in</span>Â [<span class="hljs-string">"LongTermMemory"</span>,Â <span class="hljs-string">"UserMemory"</span>]:
Â Â Â Â Â Â Â Â Â Â Â Â added_idÂ =Â self._add_to_graph_memory(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â memory=memory,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â memory_type=memory.metadata.memory_type,
Â Â Â Â Â Â Â Â Â Â Â Â )
Â Â Â Â Â Â Â Â Â Â Â Â ids.append(added_id)

Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â ids
</code></pre>
<p>å½“æ·»åŠ è®°å¿†æ—¶ï¼Œå¯ä»¥æŒ‡å®šLongTermMemoryç±»å‹ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">Â Â Â Â <span class="hljs-comment">#Â CreateÂ characterÂ memoryÂ metadata</span>
Â Â Â Â <span class="hljs-attr">metadata</span>Â =Â TreeNodeTextualMemoryMetadata(
Â Â Â Â Â Â Â Â <span class="hljs-attr">user_id</span>=user_id,
Â Â Â Â Â Â Â Â <span class="hljs-attr">type</span>=<span class="hljs-string">"fact"</span>,
Â Â Â Â Â Â Â Â <span class="hljs-attr">source</span>=<span class="hljs-string">"conversation"</span>,
Â Â Â Â Â Â Â Â <span class="hljs-attr">confidence</span>=<span class="hljs-number">90.0</span>,
Â Â Â Â Â Â Â Â <span class="hljs-attr">memory_type</span>=<span class="hljs-string">"LongTermMemory"</span>,
Â Â Â Â Â Â Â Â <span class="hljs-attr">key</span>=<span class="hljs-string">"Zhang_San_Info"</span>,
Â Â Â Â Â Â Â Â <span class="hljs-attr">entities</span>=[<span class="hljs-string">"ZhangÂ San"</span>,Â <span class="hljs-string">"Engineer"</span>],
Â Â Â Â Â Â Â Â <span class="hljs-attr">tags</span>=[<span class="hljs-string">"Personnel"</span>,Â <span class="hljs-string">"Technical"</span>]
Â Â Â Â )

Â Â Â Â <span class="hljs-comment">#Â CreateÂ memoryÂ item</span>
Â Â Â Â <span class="hljs-attr">memory_item</span>Â =Â TextualMemoryItem(
Â Â Â Â Â Â Â Â <span class="hljs-attr">memory</span>=<span class="hljs-string">"ZhangÂ SanÂ isÂ aÂ seniorÂ engineerÂ inÂ ourÂ company,Â specializingÂ inÂ PythonÂ andÂ machineÂ learning"</span>,
Â Â Â Â Â Â Â Â <span class="hljs-attr">metadata</span>=metadata
Â Â Â Â )
</code></pre>
<h6 data-id="heading-27">å®šæœŸæ¸…ç†ä¸ç»´æŠ¤æœºåˆ¶</h6>
<p>ç³»ç»Ÿé‡‡ç”¨å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„æ–¹å¼å®šæœŸæ¸…ç† WorkingMemoryï¼š</p>
<ul>
<li>åœ¨æ¯æ¬¡æ·»åŠ è®°å¿†åè°ƒç”¨ remove_oldest_memory æ–¹æ³•ï¼›</li>
<li>ä¿ç•™æœ€æ–°çš„ N æ¡è®°å½•ï¼ˆé»˜è®¤é…ç½®ä¸º 20 æ¡ï¼‰ï¼›</li>
<li>è¶…å‡ºé™åˆ¶çš„æ—§è®°å½•ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚</li>
</ul>
<p>åœ¨ç³»ç»Ÿé…ç½®ä¸­ï¼Œå¯ä»¥è®¾ç½®è®°å¿†å¤§å°é™åˆ¶ç­‰å‚æ•°ï¼Œè¿™äº›å‚æ•°ä¼šç›´æ¥å½±å“ LongTermMemoryçš„ç®¡ç†ã€‚</p>
<p>åœ¨ TreeTextMemory ä¸­ï¼ŒMemoryManager è´Ÿè´£ç®¡ç†ä¸åŒç±»å‹å†…å­˜çš„åˆ†é…å’Œç»´æŠ¤ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#Â åœ¨Â TreeTextMemory.__init__Â ä¸­åˆå§‹åŒ–</span>
self.memory_manager:Â MemoryManagerÂ =Â MemoryManager(
Â Â Â Â self.graph_store,
Â Â Â Â self.embedder,
Â Â Â Â self.extractor_llm,
Â Â Â Â memory_size=config.memory_sizeÂ <span class="hljs-keyword">or</span>Â {
Â Â Â Â Â Â Â Â <span class="hljs-string">"WorkingMemory"</span>:Â <span class="hljs-number">20</span>,Â <span class="hljs-comment">#Â ç”Ÿå‘½å‘¨æœŸï¼šçŸ­æœŸå­˜å‚¨ï¼Œå®šæœŸæ¸…ç†ï¼Œç”¨é€”ï¼šå­˜å‚¨æœ€è¿‘ä½¿ç”¨çš„è®°å¿†ï¼Œç”¨äºå¿«é€Ÿè®¿é—®</span>
Â Â Â Â Â Â Â Â <span class="hljs-string">"LongTermMemory"</span>:Â <span class="hljs-number">1500</span>,Â <span class="hljs-comment">#Â ç”Ÿå‘½å‘¨æœŸï¼šé•¿æœŸå­˜å‚¨ï¼Œå­˜å‚¨é‡è¦ä¸”æŒä¹…çš„è®°å¿†</span>
Â Â Â Â Â Â Â Â <span class="hljs-string">"UserMemory"</span>:Â <span class="hljs-number">480</span>,Â <span class="hljs-comment">#Â ç”Ÿå‘½å‘¨æœŸï¼šä¸ç‰¹å®šç”¨æˆ·ç›¸å…³è”ï¼Œå­˜å‚¨ä¸ç‰¹å®šç”¨æˆ·ç›¸å…³çš„ä¸ªæ€§åŒ–è®°å¿†</span>
Â Â Â Â },
Â Â Â Â is_reorganize=self.is_reorganize,
)
</code></pre>
<p>æ¸…ç†è§¦å‘æ—¶æœºä¸ºï¼š</p>
<pre><code class="hljs language-python" lang="python">Â Â Â Â Â Â Â Â <span class="hljs-keyword">try</span>:
Â Â Â Â Â Â Â Â Â Â Â Â self.graph_store.remove_oldest_memory(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â memory_type=<span class="hljs-string">"WorkingMemory"</span>,Â keep_latest=self.memory_size[<span class="hljs-string">"WorkingMemory"</span>]
Â Â Â Â Â Â Â Â Â Â Â Â )
Â Â Â Â Â Â Â Â <span class="hljs-keyword">except</span>Â Exception:
Â Â Â Â Â Â Â Â Â Â Â Â logger.warning(<span class="hljs-string">f"RemoveÂ WorkingMemoryÂ error:Â <span class="hljs-subst">{traceback.format_exc()}</span>"</span>)

Â Â Â Â Â Â Â Â <span class="hljs-keyword">try</span>:
Â Â Â Â Â Â Â Â Â Â Â Â self.graph_store.remove_oldest_memory(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â memory_type=<span class="hljs-string">"LongTermMemory"</span>,Â keep_latest=self.memory_size[<span class="hljs-string">"LongTermMemory"</span>]
Â Â Â Â Â Â Â Â Â Â Â Â )
Â Â Â Â Â Â Â Â <span class="hljs-keyword">except</span>Â Exception:
Â Â Â Â Â Â Â Â Â Â Â Â logger.warning(<span class="hljs-string">f"RemoveÂ LongTermMemoryÂ error:Â <span class="hljs-subst">{traceback.format_exc()}</span>"</span>)

Â Â Â Â Â Â Â Â <span class="hljs-keyword">try</span>:
Â Â Â Â Â Â Â Â Â Â Â Â self.graph_store.remove_oldest_memory(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â memory_type=<span class="hljs-string">"UserMemory"</span>,Â keep_latest=self.memory_size[<span class="hljs-string">"UserMemory"</span>]
Â Â Â Â Â Â Â Â Â Â Â Â )
Â Â Â Â Â Â Â Â <span class="hljs-keyword">except</span>Â Exception:
Â Â Â Â Â Â Â Â Â Â Â Â logger.warning(<span class="hljs-string">f"RemoveÂ UserMemoryÂ error:Â <span class="hljs-subst">{traceback.format_exc()}</span>"</span>)
</code></pre>
<h6 data-id="heading-28">æœç´¢æ—¶çš„æ•°æ®äº¤äº’</h6>
<p>åœ¨æœç´¢è¿‡ç¨‹ä¸­ï¼Œä¸åŒç±»å‹çš„å†…å­˜ä¼šè¢«å¹¶è¡ŒæŸ¥è¯¢ï¼Œç„¶åç»“æœè¢«åˆå¹¶å’Œé‡æ–°æ’åºï¼š</p>
<pre><code class="hljs language-less" lang="less">#Â åœ¨Â <span class="hljs-selector-tag">Searcher</span><span class="hljs-selector-class">._retrieve_paths</span>Â æ–¹æ³•ä¸­
<span class="hljs-selector-tag">tasks</span><span class="hljs-selector-class">.append</span>(
Â Â Â Â executor.<span class="hljs-built_in">submit</span>(
Â Â Â Â Â Â Â Â self._retrieve_from_working_memory,
Â Â Â Â Â Â Â Â query,
Â Â Â Â Â Â Â Â parsed_goal,
Â Â Â Â Â Â Â Â query_embedding,
Â Â Â Â Â Â Â Â top_k,
Â Â Â Â Â Â Â Â memory_type,
Â Â Â Â Â Â Â Â search_filter,
tasks.<span class="hljs-built_in">append</span>(
Â Â Â Â executor.<span class="hljs-built_in">submit</span>(
Â Â Â Â Â Â Â Â self._retrieve_from_working_memory,
Â Â Â Â )
)
</code></pre>
<h6 data-id="heading-29">å›¾ç»“æ„é‡ç»„è¿‡ç¨‹ä¸­çš„è®°å¿†ä¼˜åŒ–</h6>
<p>GraphStructureReorganizer çš„å‘¨æœŸæ€§ä¼˜åŒ–ï¼Œå³GraphStructureReorganizer è¿˜ä¼šå®šæœŸå¯¹ LongTermMemory å’Œ UserMemory è¿›è¡Œç»“æ„ä¼˜åŒ–ï¼Œå¯èƒ½ä¼šåˆ›å»ºæ–°çš„èšåˆèŠ‚ç‚¹ã€‚</p>
<p>ç³»ç»Ÿæœ‰ä¸€ä¸ªåå°çº¿ç¨‹è¿è¡Œ GraphStructureReorganizerï¼Œå®ƒä¼šå®šæœŸæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>å¯¹é•¿æœŸè®°å¿†è¿›è¡Œèšç±»å’Œæ€»ç»“ï¼›</li>
<li>åˆ›å»ºæŠ½è±¡å±‚çº§çš„è®°å¿†èŠ‚ç‚¹ã€‚</li>
</ul>
<p>ä¼˜åŒ–è§¦å‘æ¡ä»¶ä¸ºï¼š</p>
<ul>
<li>æ–°å¢è®°å¿†æ—¶è®¾ç½® _reorganize_needed=True æ ‡å¿—</li>
<li>å®šæœŸè°ƒåº¦å™¨æ¯ 100 ç§’æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦éœ€è¦é‡æ–°ç»„ç»‡ç»“æ„</li>
<li>å½“æœ‰è¶³å¤Ÿå¤šçš„æ–°è®°å¿†ç§¯ç´¯æ—¶æ‰çœŸæ­£è§¦å‘ä¼˜åŒ–è¿‡ç¨‹</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">defÂ optimize_structure(
Â Â Â Â self,
Â Â Â Â scope:Â <span class="hljs-attr">str</span>Â =Â <span class="hljs-string">"LongTermMemory"</span>,
):
Â Â Â Â <span class="hljs-comment">#Â åŠ è½½å€™é€‰èŠ‚ç‚¹</span>
Â Â Â Â <span class="hljs-attr">raw_nodes</span>Â =Â self.graph_store.get_structure_optimization_candidates(scope)
Â Â Â Â <span class="hljs-attr">nodes</span>Â =Â [GraphDBNode(**n)Â forÂ nÂ inÂ raw_nodes]
Â Â Â Â <span class="hljs-comment">#Â åˆ†åŒºå¤„ç†</span>
Â Â Â Â <span class="hljs-attr">partitioned_groups</span>Â =Â self._partition(nodes)
Â Â Â Â <span class="hljs-comment">#Â å¯¹æ¯ä¸ªåˆ†åŒºè¿›è¡Œèšç±»å’Œæ€»ç»“</span>
Â Â Â Â forÂ cluster_nodesÂ inÂ partitioned_groups:
Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â åˆ›å»ºçˆ¶èŠ‚ç‚¹è¡¨ç¤ºèšç±»</span>
Â Â Â Â Â Â Â Â <span class="hljs-attr">sub_parent_node</span>Â =Â self._summarize_cluster(sub_nodes,Â scope)
Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â ...</span>
</code></pre>
<h6 data-id="heading-30">ç”¨æˆ·æ§åˆ¶æ–¹å¼</h6>
<p>è™½ç„¶ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†å†…å­˜ç±»å‹ï¼Œä½†ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼é—´æ¥å½±å“ï¼š</p>
<ul>
<li>è®¾ç½®å…ƒæ•°æ®ï¼šåœ¨åˆ›å»º TextualMemoryItem æ—¶è®¾ç½® metadata.memory_type å­—æ®µ</li>
<li>é…ç½®å®¹é‡ï¼šé€šè¿‡ TreeTextMemoryConfig è®¾ç½®å„ç±»å†…å­˜çš„æœ€å¤§å®¹é‡</li>
<li>æ‰‹åŠ¨æ›¿æ¢ï¼šä½¿ç”¨ replace_working_memory æ–¹æ³•ç›´æ¥æ“ä½œå·¥ä½œå†…å­˜</li>
</ul>
<h6 data-id="heading-31">æ€»ç»“</h6>
<p>LongTermMemoryã€UserMemory å’Œ WorkingMemory çš„è®¾ç½®ä¸»è¦æ˜¯ç”±ç³»ç»Ÿæ ¹æ®é¢„å®šä¹‰è§„åˆ™è‡ªåŠ¨å®Œæˆçš„ï¼Œè€Œä¸æ˜¯ç”¨æˆ·ä¸»åŠ¨è®¾ç½®ã€‚ç³»ç»Ÿä¼šæ ¹æ®è®°å¿†çš„å…ƒæ•°æ®å’Œé…ç½®è‡ªåŠ¨å°†å…¶åˆ†é…åˆ°é€‚å½“çš„å†…å­˜ç±»å‹ä¸­ï¼Œå¹¶æŒ‰ç…§è®¾å®šçš„å®¹é‡é™åˆ¶è¿›è¡Œç®¡ç†ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡é…ç½®å‚æ•°å’Œè®¾ç½®è®°å¿†å…ƒæ•°æ®æ¥é—´æ¥å½±å“è¿™ä¸€è¿‡ç¨‹ã€‚</p>
<h3 data-id="heading-32">0x04 MemOS è®°å¿†ç”Ÿå‘½å‘¨æœŸç®¡ç†</h3>
<p>MemOS å¹¶æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†æ¨¡å—ï¼Œè¯¥åŠŸèƒ½æ˜¯æ•£å¸ƒåœ¨MemOSå„ä¸ªæ¨¡å—ä¸­ã€‚</p>
<p>ä»¥ä¸‹ä¸ºå®˜æ–¹æ–‡æ¡£å†…å®¹ã€‚</p>
<p>ä¸€æ¡è®°å¿†ä»è¢«ç”Ÿæˆå¼€å§‹ï¼Œå¯èƒ½ä¼šé€æ­¥æ²‰æ·€ä¸ºç¨³å®šçš„é•¿æœŸåå¥½ï¼Œä¹Ÿå¯èƒ½å› è¿‡æ—¶æˆ–æ— æ•ˆè€Œè¢«æ¸…ç†ã€‚</p>
<p>è¿™å¥—æ¼”åŒ–è¿‡ç¨‹ç§°ä¸ºÂ <strong>è®°å¿†ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼Œå®ƒçš„ç›®æ ‡æ˜¯ä¿æŒè®°å¿†åº“â€œå¹²å‡€è€Œæœ‰åºâ€ã€‚</p>
<ul>
<li><strong>è¿‘æœŸæœ‰ç”¨çš„æ¡ç›®</strong>ä¿æŒæ´»è·ƒï¼Œæ–¹ä¾¿éšæ—¶è°ƒç”¨ï¼›</li>
<li><strong>é•¿æœŸç¨³å®šçš„äº‹å®</strong>è¢«æ²‰æ·€ï¼Œå‡å°‘é‡å¤å’Œå™ªéŸ³ï¼›</li>
<li><strong>è¿‡æ—¶æˆ–å†²çªçš„ä¿¡æ¯</strong>ä¼šè¢«å½’æ¡£æˆ–åˆ é™¤ï¼Œä¿è¯ä¸€è‡´æ€§å’Œåˆè§„æ€§ã€‚</li>
</ul>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”Ÿå‘½å‘¨æœŸç®¡ç†å…³æ³¨çš„æ˜¯<strong>è®°å¿†æ¡ç›®åœ¨å­˜å‚¨å±‚é¢çš„æ¼”åŒ–</strong>ï¼›è€Œå…·ä½“ä¸€æ¬¡æ¨ç†é‡Œâ€œæ˜¯å¦è°ƒç”¨æŸæ¡è®°å¿†â€ï¼Œä»ç”±è°ƒåº¦æœºåˆ¶å†³å®šã€‚</p>
</blockquote>
<h4 data-id="heading-33">4.1 ç”Ÿå‘½å‘¨æœŸé˜¶æ®µç®€ä»‹</h4>








































<table><thead><tr><th><strong>é˜¶æ®µ</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>ç³»ç»Ÿè¡Œä¸º</strong></th></tr></thead><tbody><tr><td>Generated ç”Ÿæˆ</td><td>æ–°äº§ç”Ÿçš„è®°å¿†å¯¹è±¡ï¼Œå¸¦æœ‰æ¥æºã€æ—¶é—´æˆ³ã€ç½®ä¿¡åº¦ç­‰å…ƒä¿¡æ¯</td><td>åˆå§‹å­˜å…¥å­˜å‚¨å±‚ï¼Œç­‰å¾…åç»­ä½¿ç”¨</td></tr><tr><td>Activated æ¿€æ´»</td><td>åœ¨æ¨ç†æˆ–ä»»åŠ¡ä¸­è¢«å¼•ç”¨ï¼Œè¿›å…¥é«˜é¢‘æ´»è·ƒçŠ¶æ€</td><td>æ›´å®¹æ˜“è¢«è°ƒåº¦æœºåˆ¶é€‰ä¸­</td></tr><tr><td>Merged åˆå¹¶</td><td>ä¸å†å²è®°å¿†å­˜åœ¨è¯­ä¹‰é‡å æˆ–ç”¨æˆ·è¡¥å……æ•°æ®ï¼Œç³»ç»Ÿå°†å…¶æ•´åˆä¸ºæ–°ç‰ˆæœ¬</td><td>å¤šæ¡è®°å½•è¢«å‹ç¼©åˆå¹¶ï¼Œå½¢æˆæ›´æ–°åçš„ç¨³å®šæ¡ç›®</td></tr><tr><td>Archived å½’æ¡£</td><td>é•¿æœŸæœªè¢«è®¿é—®ï¼Œè‡ªåŠ¨é™çº§ä¸ºå†·å­˜å‚¨çŠ¶æ€</td><td>ä»…åœ¨ç‰¹æ®Šæ£€ç´¢æˆ–å›æº¯æ—¶å¯ç”¨</td></tr><tr><td>Expired è¿‡æœŸï¼Œå¯é€‰</td><td>å½’æ¡£åè¿›ä¸€æ­¥è¶…æ—¶æˆ–è¢«ç­–ç•¥åˆ¤å®šä¸ºæ— æ•ˆ</td><td>è¢«æ¸…ç†å‡ºç´¢å¼•ï¼Œä¸å†å‚ä¸æ¨ç†ï¼Œä»…ç•™æœ€å°æ—¥å¿—</td></tr><tr><td>Frozen å†»ç»“ï¼Œç‰¹æ®ŠçŠ¶æ€</td><td>å…³é”®æˆ–åˆè§„æ€§è®°å¿†è¢«é”å®šï¼Œä¸å…è®¸ä¿®æ”¹</td><td>ä¿ç•™å®Œæ•´å†å²ç‰ˆæœ¬ï¼Œæ”¯æŒå®¡è®¡ä¸åˆè§„è¿½è¸ª</td></tr></tbody></table>
<h4 data-id="heading-34">4.2 æ¡ˆä¾‹ï¼šåœ¨çº¿æ•™è‚²åŠ©æ‰‹çš„è®°å¿†ç”Ÿå‘½å‘¨æœŸ</h4>
<p>å‡è®¾ä½ æ­£åœ¨ç”¨ MemOS æ„å»ºä¸€ä¸ª <strong>åœ¨çº¿æ•™è‚²åŠ©æ‰‹</strong>ï¼Œå¸®åŠ©å­¦ç”Ÿè§£ç­”æ•°å­¦é¢˜ã€‚</p>
<p><strong>ç”Ÿæˆï¼ˆGeneratedï¼‰</strong></p>
<ul>
<li>å­¦ç”Ÿç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶è¯´ï¼šâ€œæˆ‘æ€»æ˜¯æŠŠäºŒæ¬¡å‡½æ•°å’Œä¸€æ¬¡å‡½æ•°ææ··ã€‚â€</li>
<li>ç³»ç»ŸæŠ½å–å‡ºè®°å¿†ï¼š</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"fact"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"å­¦ç”Ÿå¸¸æ··æ·†äºŒæ¬¡å‡½æ•°ä¸ä¸€æ¬¡å‡½æ•°"</span><span class="hljs-punctuation">,</span>Â <span class="hljs-attr">"confidence"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-number">0.8</span><span class="hljs-punctuation">,</span>Â <span class="hljs-attr">"timestamp"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"2025-09-11"</span><span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>çŠ¶æ€ï¼š<strong>Generated</strong></li>
<li>è¡Œä¸ºï¼šè¢«å­˜å‚¨è¿›è®°å¿†åº“ï¼Œç­‰å¾…åç»­ä½¿ç”¨ã€‚</li>
</ul>
<hr/>
<p><strong>æ¿€æ´»ï¼ˆActivatedï¼‰</strong></p>
<ul>
<li>åœ¨æ¥ä¸‹æ¥çš„å¤šæ¬¡ç­”é¢˜ä¸­ï¼Œç³»ç»Ÿé¢‘ç¹è°ƒç”¨è¿™æ¡è®°å¿†æ¥è¾…åŠ©è§£é¢˜ã€‚</li>
<li>çŠ¶æ€ï¼š<strong>Activated</strong></li>
<li>è¡Œä¸ºï¼šè¢«è°ƒåº¦æœºåˆ¶ä¼˜å…ˆç¼“å­˜è¿›Â MemoryCubeï¼Œæé«˜æ£€ç´¢é€Ÿåº¦ã€‚</li>
</ul>
<hr/>
<p><strong>åˆå¹¶ï¼ˆMergedï¼‰</strong></p>
<ul>
<li>éšç€æ›´å¤šäº¤äº’ï¼Œç³»ç»Ÿå‘ç°å­¦ç”Ÿä¸ä»…æ··æ·†ä¸€æ¬¡å‡½æ•°å’ŒäºŒæ¬¡å‡½æ•°ï¼Œè¿˜å¯¹æŒ‡æ•°å‡½æ•°ä¹Ÿå®¹æ˜“æ··æ·†ã€‚</li>
<li>ç³»ç»Ÿå°†å¤šæ¡ç›¸ä¼¼è®°å¿†åˆå¹¶ä¸ºï¼š</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"fact"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"è¯¥å­¦ç”Ÿåœ¨å‡½æ•°çŸ¥è¯†ç‚¹ä¸Šå­˜åœ¨æ··æ·†ï¼Œå°¤å…¶æ˜¯ä¸€å…ƒä¸€æ¬¡ã€äºŒæ¬¡å’ŒæŒ‡æ•°å‡½æ•°"</span><span class="hljs-punctuation">,</span>Â <span class="hljs-attr">"confidence"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-number">0.95</span><span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>çŠ¶æ€ï¼š<strong>Merged</strong></li>
<li>è¡Œä¸ºï¼šæ—§æ¡ç›®è¢«å‹ç¼©ï¼Œå½¢æˆæ–°ç‰ˆæœ¬ï¼Œå‡å°‘å†—ä½™ã€‚</li>
</ul>
<hr/>
<p><strong>å½’æ¡£ï¼ˆArchivedï¼‰</strong></p>
<ul>
<li>ä¸‰ä¸ªæœˆåï¼Œå­¦ç”Ÿå·²æŒæ¡å‡½æ•°ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œç³»ç»Ÿå¾ˆä¹…æ²¡æœ‰å†è°ƒåº¦åˆ°è¿™æ¡è®°å¿†ã€‚</li>
<li>çŠ¶æ€ï¼š<strong>Archived</strong></li>
<li>è¡Œä¸ºï¼šè¢«è¿ç§»è‡³Â MemVaultï¼ˆå†·å­˜å‚¨ï¼‰ï¼Œé»˜è®¤ä¸å‚ä¸æ¨ç†ï¼Œä½†å¯åœ¨â€œå­¦ä¹ è½¨è¿¹å›æº¯â€ä¸­è¢«è°ƒç”¨ã€‚</li>
</ul>
<hr/>
<p><strong>è¿‡æœŸï¼ˆExpiredï¼‰</strong></p>
<ul>
<li>åˆè¿‡äº†ä¸€å¹´ï¼Œè¯¥å­¦ç”Ÿå‡çº§åˆ°æ–°çš„å­¦æ®µï¼Œæ—§çš„â€œåˆä¸­å‡½æ•°æ··æ·†â€è®°å¿†è¢«ç­–ç•¥åˆ¤å®šä¸ºæ— æ•ˆã€‚</li>
<li>çŠ¶æ€ï¼š<strong>Expired</strong></li>
<li>è¡Œä¸ºï¼šä»ç´¢å¼•ä¸­å½»åº•æ¸…ç†ï¼Œä»…ä¿ç•™æœ€å°å®¡è®¡ä¿¡æ¯ï¼š</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"deleted_fact_id"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"12345"</span><span class="hljs-punctuation">,</span>Â <span class="hljs-attr">"deleted_at"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"2026-09-11"</span><span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<p><strong>å†»ç»“ï¼ˆFrozenï¼Œç‰¹æ®ŠçŠ¶æ€ï¼‰</strong></p>
<ul>
<li>ä¸æ­¤åŒæ—¶ï¼Œè¯¥å­¦ç”Ÿçš„â€œæœŸæœ«æˆç»©è¯„ä¼°æŠ¥å‘Šâ€å±äºåˆè§„æ€§æ–‡ä»¶ï¼Œä¸å…è®¸ä¿®æ”¹ã€‚</li>
<li>çŠ¶æ€ï¼š<strong>Frozen</strong></li>
<li>è¡Œä¸ºï¼šè¢«é”å®šï¼Œç¦æ­¢æ›´æ–°ï¼Œä»…ä¿ç•™å®Œæ•´ä¿®æ”¹å†å²ï¼Œä¾¿äºå®¡è®¡ä¸åˆè§„æ£€æŸ¥ã€‚</li>
</ul>
<p>è¿›é˜¶ï¼šå¦‚æœä½ æƒ³åšæ·±åº¦å®šåˆ¶</p>



































<table><thead><tr><th><strong>å¯æ‰©å±•ç‚¹</strong></th><th><strong>æè¿°</strong></th><th><strong>ç¤ºä¾‹</strong></th></tr></thead><tbody><tr><td>çŠ¶æ€è½¬æ¢æ¡ä»¶</td><td>æ§åˆ¶å„ä¸ªçŠ¶æ€è§¦å‘æ¡ä»¶</td><td>â€œè‹¥Â 7Â å¤©æœªä½¿ç”¨Â â†’Â å½’æ¡£â€</td></tr><tr><td>åˆå¹¶ä¸å‹ç¼©</td><td>å®šä¹‰ç›¸ä¼¼è®°å¿†çš„å¤„ç†æ–¹å¼</td><td>å¤šæ¡â€œå–œæ¬¢ç§‘å¹»ç‰‡â€åˆå¹¶ä¸ºä¸€æ¡ç½®ä¿¡åº¦æ›´é«˜çš„äº‹å®</td></tr><tr><td>å†²çªè§£å†³</td><td>å¤„ç†æ—¶é—´æˆ³æˆ–æ¥æºçŸ›ç›¾çš„è®°å¿†</td><td>é€‰æ‹©â€œæœ€æ–°è¦†ç›–æ—§æ¡ç›®â€æˆ–â€œå¹¶åˆ—ä¿ç•™â€</td></tr><tr><td>æ¸…ç†æœºåˆ¶</td><td>è®¾ç½®åˆ é™¤æ¡ä»¶ï¼Œæ§åˆ¶ç´¢å¼•è§„æ¨¡</td><td>åˆ é™¤ä½ç½®ä¿¡åº¦æˆ–ç”¨æˆ·æ’¤å›çš„è®°å¿†</td></tr><tr><td>å®¡è®¡è¿½è¸ª</td><td>å†³å®šæ˜¯å¦ä¿ç•™è¢«åˆ é™¤æ¡ç›®çš„æœ€å°å…ƒä¿¡æ¯</td><td>åœ¨åˆè§„è¦æ±‚ä¸‹å¼€å¯â€œæº¯æºæ—¥å¿—â€</td></tr></tbody></table>
<h4 data-id="heading-35">4.3 è‡ªå·±çš„ç†è§£</h4>
<p>Memosä¸­TreeTextMemoryç³»ç»Ÿçš„ä¸‰ç§è®°å¿†ç±»å‹ï¼ˆWorkingMemoryã€LongTermMemoryå’ŒUserMemoryï¼‰ä¹‹é—´ä¸å­˜åœ¨è‡ªåŠ¨è¿ç§»æˆ–è½¬æ¢æœºåˆ¶ã€‚ç³»ç»Ÿé‡‡ç”¨ç‹¬ç«‹ç®¡ç†ç­–ç•¥ï¼Œæ¯ç§è®°å¿†ç±»å‹æœ‰å„è‡ªçš„å®¹é‡é™åˆ¶å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†æ–¹å¼ã€‚</p>
<p>MemoryManagerè´Ÿè´£ç»´æŠ¤å„è®°å¿†ç±»å‹çš„å®¹é‡é™åˆ¶ï¼ŒåŒ…æ‹¬WorkingMemoryï¼ˆé»˜è®¤20æ¡ï¼‰ã€LongTermMemoryï¼ˆé»˜è®¤1500æ¡ï¼‰å’ŒUserMemoryï¼ˆé»˜è®¤480æ¡ï¼‰ã€‚å½“è¶…å‡ºé™åˆ¶æ—¶æŒ‰ç…§FIFOåŸåˆ™æ¸…ç†æ—§è®°å¿†ï¼Œä½†ä¸ä¼šè‡ªåŠ¨å°†è®°å¿†åœ¨ä¸åŒç±»å‹é—´è¿ç§»ã€‚æ–°è®°å¿†æ·»åŠ æ—¶ä¼šæ ¹æ®å…¶ç±»å‹å±æ€§å†³å®šå­˜å‚¨ä½ç½®ï¼Œè¿™æ˜¯ä¸€ç§å¹¶è¡Œæ·»åŠ è€Œéè¿ç§»è¿‡ç¨‹ã€‚</p>
<p>åœ¨æ·»åŠ è®°å¿†æ—¶ï¼Œç³»ç»Ÿä¼šå°†æ‰€æœ‰è®°å¿†åŒæ—¶æ·»åŠ åˆ°WorkingMemoryä¸­ï¼Œå¹¶æ ¹æ®è®°å¿†çš„metadata.memory_typeå­—æ®µå†³å®šæ˜¯å¦åŒæ—¶æ·»åŠ åˆ°LongTermMemoryæˆ–UserMemoryä¸­ã€‚è¿™ä¸€è¿‡ç¨‹æ˜¯å¹¶è¡Œå‘ç”Ÿçš„ï¼Œè€Œéè¿ç§»æˆ–è½¬æ¢ã€‚</p>
<p>ä»¥ä¸‹æ˜¯è‡ªå·±çš„ç†è§£ã€‚</p>
<p>åŠ¨æ€è¿ç§»é€»è¾‘ï¼Œæ ¸å¿ƒæ˜¯ â€œè®°å¿†åœ¨ä¸åŒå½¢æ€ / æ¨¡å—é—´çš„æµåŠ¨â€ï¼Œæœ¬è´¨æ˜¯ â€œåŠŸèƒ½éœ€æ±‚é©±åŠ¨æŠ€æœ¯å½¢æ€è½¬æ¢â€â€”â€” è®© Agent æ—¢èƒ½ â€œå®æ—¶å“åº”ä»»åŠ¡â€ï¼ˆä¾èµ–å·¥ä½œè®°å¿†ã€æ¿€æ´»è®°å¿†ï¼‰ï¼Œåˆèƒ½ â€œé•¿æœŸç§¯ç´¯çŸ¥è¯†â€ï¼ˆä¾èµ– LongTermMemoryã€UserMemoryï¼‰ï¼Œè¿˜èƒ½ â€œé«˜æ•ˆåˆ©ç”¨èµ„æºâ€ï¼ˆé€šè¿‡å±‚çº§å­˜å‚¨ä¼˜åŒ–ï¼‰ï¼Œæœ€ç»ˆå®ç° â€œå¯æ¨ç†ã€å¯æ‰©å±•ã€ä¸ªæ€§åŒ–â€ çš„è®°å¿†ç®¡ç†æ ¸å¿ƒç›®æ ‡ã€‚</p>
<p>MemOS çš„æ ¸å¿ƒè®°å¿†æµè½¬é€»è¾‘ï¼Œå…·ä½“è¿ç§»è·¯å¾„å¯åˆ†ä¸º 4 ç±»ï¼Œè¦†ç›– Agent ä»»åŠ¡æ‰§è¡Œçš„å…¨æµç¨‹ï¼š</p>
<p><strong>ï¼ˆ1ï¼‰ä»»åŠ¡å¯åŠ¨ï¼šé•¿æœŸè®°å¿† â†’ æ¿€æ´»è®°å¿† â†’ å·¥ä½œè®°å¿†</strong></p>
<ul>
<li>
<p>åœºæ™¯ï¼šAgent æ¥æ”¶ç”¨æˆ·ä»»åŠ¡ï¼ˆå¦‚ â€œå¸®æˆ‘è§„åˆ’ä»åŒ—äº¬åˆ°ä¸Šæµ·çš„æ—…è¡Œï¼Œè®°å¾—æˆ‘å–œæ¬¢ç»æµå‹é…’åº—â€ï¼‰ï¼›</p>
</li>
<li>
<p>è¿ç§»è¿‡ç¨‹ï¼š</p>
<ol>
<li>å…ˆä»ã€ŒUserMemoryã€ï¼ˆåŠŸèƒ½ç»´åº¦ï¼‰ä¸­æ£€ç´¢ â€œç”¨æˆ·å–œæ¬¢ç»æµå‹é…’åº—â€ çš„ä¸“å±è®°å¿†ï¼Œä»ã€ŒLongTermMemoryã€ï¼ˆåŠŸèƒ½ç»´åº¦ï¼‰ä¸­æ£€ç´¢ â€œåŒ—äº¬åˆ°ä¸Šæµ·çš„äº¤é€šæ–¹å¼â€ çš„é€šç”¨è®°å¿†ï¼›</li>
<li>è¿™äº›æ£€ç´¢åˆ°çš„è®°å¿†ä» â€œé•¿æœŸå­˜å‚¨â€ï¼ˆéæ¿€æ´»æ€ï¼‰åŠ è½½ä¸ºã€Œæ¿€æ´»è®°å¿†ã€ï¼ˆæŠ€æœ¯ç»´åº¦ï¼‰ï¼Œç¼“å­˜åˆ°å†…å­˜ï¼›</li>
<li>å†å°†ã€Œæ¿€æ´»è®°å¿†ã€ä¸­çš„å…³é”®ä¿¡æ¯ï¼ˆç”¨æˆ·åå¥½ã€äº¤é€šé€‰é¡¹ï¼‰æ³¨å…¥ã€ŒWorkingMemoryã€ï¼ˆåŠŸèƒ½ç»´åº¦ï¼‰ï¼Œä½œä¸ºå½“å‰ä»»åŠ¡çš„å†³ç­–ä¾æ®ã€‚</li>
</ol>
</li>
</ul>
<p><strong>ï¼ˆ2ï¼‰ä»»åŠ¡æ‰§è¡Œï¼šå·¥ä½œè®°å¿† â†” æ¿€æ´»è®°å¿†ï¼ˆå®æ—¶äº¤äº’ï¼‰</strong></p>
<ul>
<li>
<p>åœºæ™¯ï¼šAgent åˆ†ææ—…è¡Œæ–¹æ¡ˆæ—¶ï¼Œéœ€è¦ç¡®è®¤ â€œç»æµå‹é…’åº—çš„å…·ä½“æ ‡å‡†â€ï¼ˆç”¨æˆ·ä¹‹å‰æè¿‡ â€œä»·æ ¼ä½äº 500 å…ƒ / æ™šâ€ï¼‰ï¼›</p>
</li>
<li>
<p>è¿ç§»è¿‡ç¨‹ï¼š</p>
<ol>
<li>ã€ŒWorkingMemoryã€ä¸­æ— è¯¥ç»†èŠ‚ï¼Œè§¦å‘ä»ã€ŒUserMemoryã€æ£€ç´¢ï¼›</li>
<li>æ£€ç´¢ç»“æœåŠ è½½ä¸ºã€Œæ¿€æ´»è®°å¿†ã€ï¼Œè¡¥å……åˆ°ã€ŒWorkingMemoryã€ä¸­ï¼›</li>
<li>Agent åŸºäºè¡¥å……ä¿¡æ¯ç»†åŒ–æ–¹æ¡ˆï¼ˆç­›é€‰ 500 å…ƒä»¥ä¸‹é…’åº—ï¼‰ï¼Œä¸­é—´å†³ç­–ç»“æœå®æ—¶å†™å…¥ã€ŒWorkingMemoryã€ã€‚</li>
</ol>
</li>
</ul>
<p><strong>ï¼ˆ3ï¼‰ä»»åŠ¡ç»“æŸï¼šå·¥ä½œè®°å¿† â†’ é•¿æœŸè®°å¿†ï¼ˆå½’æ¡£ / ä¸¢å¼ƒï¼‰</strong></p>
<ul>
<li>
<p>åœºæ™¯ï¼šæ—…è¡Œæ–¹æ¡ˆç”Ÿæˆå®Œæˆï¼Œç”¨æˆ·ç¡®è®¤åä»»åŠ¡ç»“æŸï¼›</p>
</li>
<li>
<p>è¿ç§»è¿‡ç¨‹ï¼š</p>
<ol>
<li>ã€ŒWorkingMemoryã€ä¸­çš„æœ‰ç”¨ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·æœ€ç»ˆé€‰æ‹©çš„é…’åº—ã€äº¤é€šæ–¹å¼ã€åé¦ˆ â€œä¸‹æ¬¡æƒ³é¿å¼€é«˜é“æ¢ä¹˜â€ï¼‰ï¼ŒæŒ‰å½’å±å½’æ¡£ï¼šç”¨æˆ·ä¸“å±ä¿¡æ¯å†™å…¥ã€ŒUserMemoryã€ï¼Œé€šç”¨æ–¹æ¡ˆæ¨¡æ¿å†™å…¥ã€ŒLongTermMemoryã€ï¼›</li>
<li>å½’æ¡£åï¼Œè¿™äº›ä¿¡æ¯ä»ã€Œå·¥ä½œè®°å¿†ã€è½¬ä¸º â€œé•¿æœŸå­˜å‚¨çš„éæ¿€æ´»æ€æ•°æ®â€ï¼›</li>
<li>ã€ŒWorkingMemoryã€ä¸­æ— ä»·å€¼çš„ä¸´æ—¶ä¿¡æ¯ï¼ˆå¦‚ä¸­é—´ç­›é€‰çš„æ— æ•ˆé…’åº—ã€è®¡ç®—è¿‡ç¨‹ï¼‰ç›´æ¥é”€æ¯ï¼Œé‡Šæ”¾å†…å­˜ã€‚</li>
</ol>
</li>
</ul>
<p><strong>ï¼ˆ4ï¼‰é•¿æœŸè®°å¿†æ›´æ–°ï¼šæ¿€æ´»è®°å¿† â†’ é•¿æœŸè®°å¿†ï¼ˆè¿­ä»£ä¼˜åŒ–ï¼‰</strong></p>
<ul>
<li>
<p>åœºæ™¯ï¼šAgent å­¦ä¹ åˆ°æ–°çš„é€šç”¨çŸ¥è¯†ï¼ˆå¦‚ â€œåŒ—äº¬åˆ°ä¸Šæµ·æ–°å¢äº†ç›´è¾¾èˆªç­â€ï¼‰ï¼Œæˆ–ç”¨æˆ·æ›´æ–°åå¥½ï¼ˆå¦‚ â€œç°åœ¨å–œæ¬¢ä¸­ç«¯é…’åº—ï¼Œé¢„ç®— 800 å…ƒ / æ™šâ€ï¼‰ï¼›</p>
</li>
<li>
<p>è¿ç§»è¿‡ç¨‹ï¼š</p>
<ol>
<li>æ–°çŸ¥è¯† / æ–°åå¥½å…ˆé€šè¿‡ã€ŒRelationAndReasoningDetectorã€å¤„ç†ä¸ºç»“æ„åŒ–æ•°æ®ï¼ŒåŠ è½½ä¸ºã€Œæ¿€æ´»è®°å¿†ã€ï¼›</li>
<li>ã€Œæ¿€æ´»è®°å¿†ã€é€šè¿‡ã€ŒNodeHandlerã€å†™å…¥å¯¹åº”é•¿æœŸå­˜å‚¨ï¼šé€šç”¨çŸ¥è¯†å†™å…¥ã€ŒLongTermMemoryã€ï¼Œç”¨æˆ·åå¥½æ›´æ–°ã€ŒUserMemoryã€ï¼›</li>
<li>å†™å…¥å®Œæˆåï¼Œã€Œæ¿€æ´»è®°å¿†ã€å¯ä¿ç•™ç¼“å­˜ï¼ˆæå‡åç»­è®¿é—®é€Ÿåº¦ï¼‰ï¼Œè¶…æ—¶åè‡ªåŠ¨é‡Šæ”¾ã€‚</li>
</ol>
</li>
</ul>
<p><strong>è¡¥å……ï¼šå‚æ•°è®°å¿†çš„ç‰¹æ®Šè§’è‰²ï¼ˆæ— è¿ç§»ï¼Œä»…æä¾›åŸºç¡€æ”¯æ’‘ï¼‰</strong></p>
<p>å‚æ•°è®°å¿†ï¼ˆæ¨¡å‹æƒé‡ï¼‰æ˜¯ â€œé™æ€åŸºç¡€â€ï¼Œä¸å‚ä¸ä¸Šè¿°åŠ¨æ€è¿ç§» â€”â€” å®ƒä¸ºæ‰€æœ‰è®°å¿†çš„ â€œç†è§£ä¸æ¨ç†â€ æä¾›åº•å±‚èƒ½åŠ›ï¼ˆå¦‚è¯†åˆ« â€œç”¨æˆ·åå¥½â€ çš„è¯­ä¹‰ã€æ¨ç† â€œäº¤é€šæ–¹å¼é€‰æ‹©â€ çš„é€»è¾‘ï¼‰ï¼Œä½†è‡ªèº«ä¸ä¼šè¢« MemOS åŠ¨æ€ä¿®æ”¹ï¼ˆé™¤éè¿›è¡Œæ¨¡å‹å¾®è°ƒï¼Œå°†é•¿æœŸè®°å¿†ä¸­çš„å…³é”®çŸ¥è¯†å›ºåŒ–ä¸ºå‚æ•°è®°å¿†ï¼‰ã€‚</p>
<h4 data-id="heading-36">4.4 MemScheduler</h4>
<p>MemOS ä¹Ÿåœ¨å°è¯•è‡ªåŠ¨è¿ç§»ï¼Œè¿™å°±æ˜¯ MemScheduler çš„åŠŸèƒ½ã€‚</p>
<p>MemScheduler æ˜¯ä¸€ä¸ªä¸ MemOS ç³»ç»Ÿå¹¶è¡Œè¿è¡Œçš„å¹¶å‘è®°å¿†ç®¡ç†ç³»ç»Ÿï¼Œå®ƒåè°ƒ AI ç³»ç»Ÿä¸­å·¥ä½œè®°å¿†ã€é•¿æ—¶è®°å¿†å’Œæ¿€æ´»è®°å¿†ä¹‹é—´çš„è®°å¿†æ“ä½œã€‚å®ƒé€šè¿‡äº‹ä»¶é©±åŠ¨è°ƒåº¦å¤„ç†è®°å¿†æ£€ç´¢ã€æ›´æ–°å’Œå‹ç¼©ã€‚è¯¥ç³»ç»Ÿç‰¹åˆ«é€‚åˆéœ€è¦åŠ¨æ€è®°å¿†ç®¡ç†çš„å¯¹è¯ä»£ç†å’Œæ¨ç†ç³»ç»Ÿã€‚</p>
<p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« ä»‹ç» MemSchedulerã€‚</p>
<h3 data-id="heading-37">0xFF å‚è€ƒ</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1981392181592871894" target="_blank" title="https://zhuanlan.zhihu.com/p/1981392181592871894" ref="nofollow noopener noreferrer">Multi-Agentç³»ç»Ÿæ„å»ºåˆæ¢ï¼šåŸºäºLangGraphçš„é•¿çŸ­æœŸè®°å¿†ç®¡ç†å®è·µæŒ‡å—</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1975514242754049684" target="_blank" title="https://zhuanlan.zhihu.com/p/1975514242754049684" ref="nofollow noopener noreferrer">Agentå¼€å‘å®è·µï¼šä»æƒ³æ³•åˆ°äº§å“â€”â€”SSEã€ä¸Šä¸‹æ–‡å·¥ç¨‹ä¸æµå¼è§£æå…³é”®æŠ€æœ¯æ”»åš</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1975511012347249929" target="_blank" title="https://zhuanlan.zhihu.com/p/1975511012347249929" ref="nofollow noopener noreferrer">Agentå¼€å‘å®è·µï¼šä»æƒ³æ³•åˆ°äº§å“â€”â€”ç³»ç»Ÿæ¶æ„è®¾è®¡å®è·µ</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.memmachine.ai%2Fopen_source%2Fmemory_types" target="_blank" title="https://docs.memmachine.ai/open_source/memory_types" ref="nofollow noopener noreferrer">docs.memmachine.ai/open_sourceâ€¦</a></p>
<p>æœ¬æ–‡ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarkdown.com.cn" target="_blank" title="https://markdown.com.cn" ref="nofollow noopener noreferrer">markdown.com.cn</a> æ’ç‰ˆ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•å®ç°æµå¼è¾“å‡ºï¼Ÿä¸€ç¯‡æ–‡ç« æ‰‹æŠŠæ‰‹æ•™ä½ ï¼]]></title>    <link>https://juejin.cn/post/7583921477613502499</link>    <guid>https://juejin.cn/post/7583921477613502499</guid>    <pubDate>2025-12-15T13:42:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583921477613502499" data-draft-id="7583903159774101519" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•å®ç°æµå¼è¾“å‡ºï¼Ÿä¸€ç¯‡æ–‡ç« æ‰‹æŠŠæ‰‹æ•™ä½ ï¼"/> <meta itemprop="keywords" content="å‰ç«¯,AIGC,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-12-15T13:42:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤©å¤©æ‰­ç "/> <meta itemprop="url" content="https://juejin.cn/user/3349589831715801"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•å®ç°æµå¼è¾“å‡ºï¼Ÿä¸€ç¯‡æ–‡ç« æ‰‹æŠŠæ‰‹æ•™ä½ ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3349589831715801/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤©å¤©æ‰­ç 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T13:42:59.000Z" title="Mon Dec 15 2025 13:42:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»19åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡ä»£ç githubä»“åº“åœ°å€â€”â€”<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FObjecteee%2FaiKnowedge" target="_blank" title="https://github.com/Objecteee/aiKnowedge" ref="nofollow noopener noreferrer">github.com/Objecteee/aâ€¦</a></p>
<h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯æµå¼è¾“å‡ºï¼Ÿ</h2>
<p>æµå¼è¾“å‡ºæ˜¯ä¸€ç§<strong>æ•°æ®ä¼ è¾“æ¨¡å¼</strong>ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ•°æ®ä¸æ˜¯ä½œä¸ºä¸€ä¸ªå®Œæ•´çš„ã€å•ä¸€çš„åŒ…è£¹åœ¨ä¸€æ¬¡å“åº”ä¸­å‘é€ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯è¢«åˆ†æˆè®¸å¤šå°çš„<strong>æ•°æ®å— (chunks)</strong> ï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆçš„åŒæ—¶ï¼Œ<strong>æŒç»­ä¸æ–­ã€é€å—åœ°</strong>æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚ä¾‹å¦‚ä¸‹é¢çš„Geminiå›ç­”è¿‡ç¨‹â€”â€”</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b098f41dc36644fb971483fa5a7e0dd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp5aSp5omt56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766410978&amp;x-signature=hm%2FQSG873QuMXrwPSVvdECxSJTI%3D" alt="GIF 2025-12-15 19-26-17.gif" width="50%" loading="lazy"/></p>
<h2 data-id="heading-1">äºŒã€ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æµå¼è¾“å‡ºï¼Ÿ</h2>
<p>æµå¼è¾“å‡ºçš„æ ¸å¿ƒä»·å€¼åœ¨äºæ”¹å˜äº†ç”¨æˆ·å¯¹<strong>å»¶è¿Ÿçš„æ„ŸçŸ¥</strong>ï¼Œå°†åŸæœ¬æ¼«é•¿çš„ç­‰å¾…è½¬åŒ–ä¸ºå³æ—¶çš„å†…å®¹æ¶ˆè´¹ã€‚</p>
<p><strong>1.æå¤§åœ°æå‡ç”¨æˆ·ä½“éªŒ (UX)ï¼š</strong></p>
<p>åœ¨ä¼ ç»Ÿçš„ <strong>è¯·æ±‚-å“åº”æ¨¡å‹</strong>ä¸­ï¼Œç”¨æˆ·å¿…é¡»ç­‰å¾…æœåŠ¡å™¨ç”Ÿæˆå¹¶è¿”å›<strong>å…¨éƒ¨æ•°æ®</strong>æ‰èƒ½çœ‹åˆ°ç»“æœã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª AI å›å¤å¯èƒ½éœ€è¦ 5-10 ç§’ã€‚</p>
<p>æµå¼è¾“å‡ºåˆ™å®ç°äº†å†…å®¹<strong>é€å—ã€é€å­—</strong>åˆ°è¾¾å’Œæ˜¾ç¤ºã€‚ç”¨æˆ·æ„ŸçŸ¥åˆ°çš„å»¶è¿Ÿä» <strong>â€œæ€»ç”Ÿæˆæ—¶é—´â€</strong> ç¼©çŸ­ä¸º <strong>â€œé¦–ä¸ªæ•°æ®å—åˆ°è¾¾æ—¶é—´â€</strong> ã€‚è¿™ç§å®æ—¶åé¦ˆæœºåˆ¶è®©ç”¨æˆ·æ„Ÿè§‰ç¨‹åºåœ¨å³æ—¶å“åº”ï¼Œæ˜¾è‘—é™ä½äº†ç­‰å¾…çš„ç„¦è™‘æ„Ÿã€‚</p>
<p><strong>åœ¨ AI/LLM åœºæ™¯ä¸­ï¼Œ</strong> æµå¼è¾“å‡ºæ˜¯<strong>å¿…éœ€å“</strong>ï¼Œå®ƒå°†æ•°ç§’çš„æ¯ç‡¥ç­‰å¾…å˜æˆäº†æŒç»­çš„é˜…è¯»è¿‡ç¨‹ï¼Œæ˜¯ç”¨æˆ·ç•™å­˜å’Œäº§å“ä½“éªŒçš„åŸºçŸ³ã€‚</p>
<p><strong>2.æé«˜ç³»ç»Ÿå’Œç½‘ç»œæ•ˆç‡ï¼š</strong></p>
<p>æµå¼è¾“å‡ºæŠ€æœ¯ï¼ˆå°¤å…¶æ˜¯ <strong>SSE</strong> å’Œ <strong>WebSocket</strong>ï¼‰é€šè¿‡å»ºç«‹æŒä¹…è¿æ¥ï¼Œå‡å°‘äº†é‡å¤å»ºç«‹å’Œå…³é—­ HTTP è¿æ¥çš„å¼€é”€ã€‚
æ•°æ®ç”Ÿæˆå¤šå°‘æ¨é€å¤šå°‘ï¼Œç½‘ç»œå¸¦å®½å¾—åˆ°æ›´æœ‰æ•ˆçš„åˆ©ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡å¼‚æ­¥æˆ–é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡æ—¶ï¼Œæ•ˆç‡ä¼˜åŠ¿æ›´ä¸ºæ˜æ˜¾ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œæµå¼è¾“å‡ºçš„é‡è¦æ€§åœ¨äºï¼šå®ƒæŠŠ <strong>â€œç­‰å¾…â€</strong> å˜æˆäº† <strong>â€œæ¶ˆè´¹â€</strong> ï¼Œæ˜¯ç°ä»£äº¤äº’å¼åº”ç”¨å’Œå®æ—¶æ•°æ®å¹³å°çš„<strong>æ ‡é…</strong>ã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€ä¸»æµçš„æµå¼è¾“å‡ºå®ç°</h2>
<p>æµå¼è¾“å‡ºä¸»è¦æœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œç¬¬ä¸€ç§æ˜¯SSEï¼ˆåŸºäºHTTPï¼‰çš„å•å‘æµå¼è¾“å‡ºï¼›ç¬¬äºŒç§æ˜¯åŸºäºWebSocketçš„åŒå‘æµå¼è¾“å‡ºã€‚</p>
<h3 data-id="heading-3">1.åŸºäºSSEçš„å•å‘æµå¼è¾“å‡º</h3>
<h4 data-id="heading-4">ï¼ˆ1ï¼‰åç«¯å®ç°</h4>
<p>SSE æµå¼è¾“å‡ºçš„åç«¯ä»£ç æ˜¯æœ‰<strong>å›ºå®šçš„æ ¼å¼å’Œä¸¥æ ¼çš„è¦æ±‚</strong>ã€‚è¿™ç§æ ¼å¼æ˜¯ <strong>Server-Sent Events è§„èŒƒ</strong>çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯å®¢æˆ·ç«¯æµè§ˆå™¨èƒ½å¤Ÿæ­£ç¡®è§£ææµçš„å…³é”®ã€‚</p>
<h5 data-id="heading-5">A. åŸºç¡€æ ¼å¼</h5>
<p>è¿™æ˜¯æœ€å¸¸ç”¨ã€æœ€æ ¸å¿ƒçš„æ ¼å¼ï¼Œç”¨äºä¼ è¾“æ•°æ®å—ã€‚</p>























<table><thead><tr><th><strong>å­—æ®µ</strong></th><th><strong>æ ¼å¼</strong></th><th><strong>ä½œç”¨</strong></th><th><strong>ç¤ºä¾‹</strong></th></tr></thead><tbody><tr><td><strong>Data</strong></td><td><code>data: [å†…å®¹]</code></td><td>åŒ…å«è¦å‘é€çš„å®é™…æ•°æ®ã€‚å®¢æˆ·ç«¯ <code>event.data</code> æ¥æ”¶åˆ°çš„å°±æ˜¯ <code>:</code> åé¢çš„å†…å®¹ã€‚</td><td><code>data: Hello world\n\n</code></td></tr><tr><td><strong>åˆ†éš”ç¬¦</strong></td><td><code>\n\n</code></td><td><strong>è‡³å…³é‡è¦ï¼</strong> å¿…é¡»ä»¥ä¸¤ä¸ªæ¢è¡Œç¬¦æ ‡è®°ä¸€ä¸ªäº‹ä»¶å—çš„ç»“æŸã€‚</td><td/></tr></tbody></table>
<h5 data-id="heading-6">B. å®Œæ•´æ ¼å¼</h5>
<p>SSE è§„èŒƒè¿˜å…è®¸å…¶ä»–å¯é€‰å­—æ®µï¼Œç”¨äºæ›´å¤æ‚çš„æµæ§åˆ¶ï¼š</p>





























<table><thead><tr><th><strong>å­—æ®µ</strong></th><th><strong>æ ¼å¼</strong></th><th><strong>ä½œç”¨</strong></th><th><strong>ç¤ºä¾‹</strong></th></tr></thead><tbody><tr><td><strong>Event</strong></td><td><code>event: [äº‹ä»¶å]</code></td><td>å…è®¸å‘é€ä¸åŒç±»å‹çš„äº‹ä»¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ <code>eventSource.addEventListener('äº‹ä»¶å', ...)</code> ç›‘å¬ã€‚</td><td><code>event: update\n</code></td></tr><tr><td><strong>ID</strong></td><td><code>id: [å”¯ä¸€æ ‡è¯†]</code></td><td>å…è®¸ä¸ºæ¯ä¸ªäº‹ä»¶åˆ†é…ä¸€ä¸ªå”¯ä¸€ IDã€‚å¦‚æœå®¢æˆ·ç«¯æ–­çº¿é‡è¿ï¼Œå®ƒä¼šå‘é€ <code>Last-Event-ID</code>ï¼ŒæœåŠ¡å™¨å¯ä»¥ä»è¯¥ ID æ¢å¤æ¨é€ã€‚</td><td><code>id: 12345\n</code></td></tr><tr><td><strong>Retry</strong></td><td><code>retry: [æ¯«ç§’æ•°]</code></td><td><strong>å…¨å±€è®¾ç½®ã€‚</strong> å®¢æˆ·ç«¯æ–­å¼€è¿æ¥åï¼Œæµè§ˆå™¨ç­‰å¾…è¯¥æ¯«ç§’æ•°åå†å°è¯•é‡è¿ã€‚</td><td><code>retry: 10000\n\n</code></td></tr></tbody></table>
<p><strong>ä¸€ä¸ªåŒ…å«æ‰€æœ‰å­—æ®µçš„å®Œæ•´äº‹ä»¶å—ç¤ºä¾‹å¦‚ä¸‹ï¼š</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">event:</span> system-update
<span class="hljs-symbol">id:</span> <span class="hljs-number">999</span>
<span class="hljs-symbol">retry:</span> <span class="hljs-number">5000</span>
<span class="hljs-symbol">data:</span> {<span class="hljs-string">"status"</span>: <span class="hljs-string">"ok"</span>, <span class="hljs-string">"progress"</span>: <span class="hljs-number">80</span>}
</code></pre>
<p><strong>æ³¨æ„ï¼š</strong> å³ä½¿ä½¿ç”¨äº†å¤šä¸ªå­—æ®µï¼Œ<strong>æœ€åä¹Ÿå¿…é¡»ä»¥ <code>\n\n</code> ç»“æŸ</strong>ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3000</span>;

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/stream-sse'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    <span class="hljs-comment">// ------------------------------------------------------------------</span>
    <span class="hljs-comment">// A. å›ºå®šçš„ HTTP å“åº”å¤´è®¾ç½® (å…³é”®!)</span>
    <span class="hljs-comment">// ------------------------------------------------------------------</span>
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/event-stream'</span>);
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Cache-Control'</span>, <span class="hljs-string">'no-cache'</span>);
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Connection'</span>, <span class="hljs-string">'keep-alive'</span>);
    <span class="hljs-comment">// å…è®¸è·¨åŸŸè®¿é—®</span>
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Origin'</span>, <span class="hljs-string">'*'</span>); 

    <span class="hljs-comment">// å¯é€‰ï¼šè®¾ç½®æ–­çº¿é‡è¿æ—¶é—´é—´éš”ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰</span>
    <span class="hljs-comment">// res.write('retry: 5000\n\n'); </span>

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'--- SSE Connection Established ---'</span>);

    <span class="hljs-comment">// æ¨¡æ‹Ÿæ•°æ®æµå¼ç”Ÿæˆ</span>
    <span class="hljs-keyword">let</span> counter = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (counter &gt;= <span class="hljs-number">8</span>) {
            <span class="hljs-comment">// 4. ç»“æŸæµï¼šå‘é€ [DONE] æ ‡è®°ï¼ˆå¸¸è§å®è·µï¼‰å¹¶å…³é—­è¿æ¥</span>
            res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'data: [DONE]\n\n'</span>);
            res.<span class="hljs-title function_">end</span>();
            <span class="hljs-built_in">clearInterval</span>(intervalId);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'--- SSE Stream Ended ---'</span>);
            <span class="hljs-keyword">return</span>;
        }

        counter++;
        <span class="hljs-keyword">const</span> payload = <span class="hljs-string">`è¿™æ˜¯ç¬¬ <span class="hljs-subst">${counter}</span> å—æ•°æ®ï¼Œæ—¶é—´ï¼š<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleTimeString()}</span>`</span>;
        
        <span class="hljs-comment">// ------------------------------------------------------------------</span>
        <span class="hljs-comment">// B. å›ºå®šçš„æ•°æ®ä½“æ ¼å¼ (ä¸¥æ ¼è¦æ±‚!)</span>
        <span class="hljs-comment">// ------------------------------------------------------------------</span>
        <span class="hljs-keyword">const</span> sseData = 
        <span class="hljs-comment">// 1. data å­—æ®µï¼šå¿…é¡»ä»¥ "data: " å¼€å¤´</span>
        <span class="hljs-string">`data: <span class="hljs-subst">${payload}</span>\n`</span> + 
        <span class="hljs-comment">// 2. ä¸¤ä¸ªæ¢è¡Œç¬¦ï¼šå¿…é¡»ä»¥ "\n\n" ç»“å°¾ï¼Œæ ‡å¿—ä¸€ä¸ªäº‹ä»¶çš„ç»“æŸ</span>
        <span class="hljs-string">`\n`</span>; 

        <span class="hljs-comment">// 3. å®æ—¶å†™å…¥æ•°æ®åˆ°å“åº”æµ</span>
        res.<span class="hljs-title function_">write</span>(sseData);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Pushed: <span class="hljs-subst">${payload}</span>`</span>);

    }, <span class="hljs-number">1500</span>); <span class="hljs-comment">// æ¯ 1.5 ç§’æ¨é€ä¸€æ¬¡</span>

    <span class="hljs-comment">// å¤„ç†å®¢æˆ·ç«¯æ–­å¼€è¿æ¥çš„æ¸…ç†å·¥ä½œ</span>
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-built_in">clearInterval</span>(intervalId);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Client closed connection.'</span>);
    });
});

app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`SSE Server running on http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);
});
</code></pre>
<ol>
<li><strong>è®¾ç½®æ­£ç¡®çš„ Headerï¼š</strong> å¿…é¡»è®¾ç½® <code>Content-Type: text/event-stream</code>ã€‚</li>
<li><strong>å®æ—¶å†™å…¥ï¼š</strong> ä½¿ç”¨ Node.js çš„ <code>res.write()</code> æ–¹æ³•ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ•°æ®å…¨éƒ¨æ”¶é›†å®Œæ¯•åä½¿ç”¨ <code>res.send()</code>ã€‚<code>res.send()</code> ä¼šå°è¯•å…³é—­è¿æ¥ï¼Œä¸é€‚ç”¨äºæµå¼è¾“å‡ºã€‚</li>
<li><strong>éµå®ˆ <code>data: ...\n\n</code> æ ¼å¼ï¼š</strong> ä»»ä½•åç¦»è¿™ä¸ªæ ¼å¼çš„è¾“å‡ºéƒ½å¯èƒ½å¯¼è‡´å®¢æˆ·ç«¯ <code>EventSource</code> æ— æ³•æ­£ç¡®è§¦å‘ <code>onmessage</code> äº‹ä»¶ã€‚</li>
<li><strong>è¿æ¥æ¸…ç†ï¼š</strong> ç›‘å¬ <code>req.on('close', ...)</code> äº‹ä»¶ï¼Œç¡®ä¿åœ¨å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨èƒ½åœæ­¢ä¸å¿…è¦çš„å®šæ—¶å™¨æˆ–èµ„æºå ç”¨ã€‚</li>
</ol>
<h4 data-id="heading-7">ï¼ˆ2ï¼‰å‰ç«¯å®ç°</h4>
<h5 data-id="heading-8">A.æµè§ˆå™¨åŸç”Ÿå®ç°ï¼ˆEventSourceï¼‰</h5>
<p><code>EventSource</code> æ˜¯æµè§ˆå™¨ä¸“ä¸º SSE è§„èŒƒè®¾è®¡çš„é«˜çº§ APIã€‚å®ƒè‡ªåŠ¨å¤„ç†äº†åº•å±‚ HTTP è¿æ¥ã€æ•°æ®æ ¼å¼è§£æã€äº‹ä»¶è§¦å‘ï¼Œä»¥åŠæ–­çº¿é‡è¿ç­‰æ‰€æœ‰å¤æ‚é€»è¾‘ã€‚</p>
<h6 data-id="heading-9">ä¼˜åŠ¿</h6>
<ul>
<li><strong>æœ€ç®€æ´ï¼š</strong> åªéœ€è¦å‡ è¡Œä»£ç å³å¯å¼€å§‹ç›‘å¬æµã€‚</li>
<li><strong>å¯é æ€§é«˜ï¼š</strong> å†…ç½®è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼Œéå¸¸å¥å£®ã€‚</li>
<li><strong>æ— éœ€æ‰‹åŠ¨è§£æï¼š</strong> è‡ªåŠ¨å°† <code>data:</code> å­—æ®µçš„å†…å®¹æå–å‡ºæ¥ï¼Œä½œä¸º <code>event.data</code>ã€‚</li>
</ul>
<h6 data-id="heading-10">å±€é™æ€§</h6>
<ul>
<li><strong>åªèƒ½ GET è¯·æ±‚ã€‚</strong></li>
<li><strong>ä¸æ”¯æŒè‡ªå®šä¹‰ Headerï¼š</strong> æ— æ³•åœ¨è¯·æ±‚å¤´ä¸­ä¼ é€’ Tokenï¼ˆåªèƒ½é€šè¿‡ URL query å‚æ•°ï¼‰ã€‚</li>
</ul>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>EventSource å®¢æˆ·ç«¯ç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Segoe UI'</span>, Tahoma, Geneva, Verdana, sans-serif; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-tag">h1</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>; }
        <span class="hljs-selector-id">#status</span> { <span class="hljs-attribute">font-weight</span>: bold; <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>; <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>; }
        <span class="hljs-selector-class">.status-connecting</span> { <span class="hljs-attribute">color</span>: orange; <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff3e0</span>; }
        <span class="hljs-selector-class">.status-open</span> { <span class="hljs-attribute">color</span>: green; <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e8f5e9</span>; }
        <span class="hljs-selector-class">.status-closed</span> { <span class="hljs-attribute">color</span>: red; <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffebee</span>; }
        <span class="hljs-selector-id">#output-area</span> { 
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>; 
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>; 
            <span class="hljs-attribute">min-height</span>: <span class="hljs-number">150px</span>; 
            <span class="hljs-attribute">white-space</span>: pre-wrap; <span class="hljs-comment">/* ä¿æŒæ¢è¡Œå’Œç©ºæ ¼ */</span>
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fcfcfc</span>;
            <span class="hljs-attribute">overflow-y</span>: auto;
        }
        <span class="hljs-selector-class">.chunk</span> { <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">5px</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#00796b</span>; }
        <span class="hljs-selector-class">.divider</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#bdbdbd</span>; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>EventSource å®æ—¶æµæ¥æ”¶ç«¯<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"status"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"status-connecting"</span>&gt;</span>è¿æ¥çŠ¶æ€: æ­£åœ¨åˆå§‹åŒ–...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>æ¥æ”¶åˆ°çš„æ¶ˆæ¯æµ:<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"output-area"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"closeStream()"</span>&gt;</span>ğŸ›‘ åœæ­¢æ¥æ”¶æµ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// è¯·ç¡®ä¿è¿™é‡Œçš„ URL ä¸æ‚¨çš„ Node.js åç«¯ SSE è·¯ç”±åŒ¹é…</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STREAM_URL</span> = <span class="hljs-string">'http://localhost:3000/api/stream-sse'</span>; 
        
        <span class="hljs-keyword">const</span> statusElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'status'</span>);
        <span class="hljs-keyword">const</span> outputElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'output-area'</span>);
        
        <span class="hljs-keyword">let</span> eventSource;

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateStatus</span>(<span class="hljs-params">text, className</span>) {
            statusElement.<span class="hljs-property">textContent</span> = text;
            statusElement.<span class="hljs-property">className</span> = <span class="hljs-string">''</span>;
            statusElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(className);
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">initializeSSE</span>(<span class="hljs-params"/>) {
            outputElement.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>; <span class="hljs-comment">// æ¸…ç©ºæ—§å†…å®¹</span>
            
            <span class="hljs-comment">// 1. åˆ›å»º EventSource å®ä¾‹å¹¶å»ºç«‹è¿æ¥</span>
            eventSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSource</span>(<span class="hljs-variable constant_">STREAM_URL</span>);
            <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: æ­£åœ¨è¿æ¥...'</span>, <span class="hljs-string">'status-connecting'</span>);

            <span class="hljs-comment">// 2. ç›‘å¬è¿æ¥æ‰“å¼€äº‹ä»¶</span>
            eventSource.<span class="hljs-property">onopen</span> = <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: âœ… å·²å»ºç«‹'</span>, <span class="hljs-string">'status-open'</span>);
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'SSE connection opened successfully.'</span>);
            };

            <span class="hljs-comment">// 3. ç›‘å¬æ¥æ”¶åˆ°æ•°æ®äº‹ä»¶ (æ ¸å¿ƒé€»è¾‘)</span>
            eventSource.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
                <span class="hljs-keyword">const</span> chunk = event.<span class="hljs-property">data</span>;
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Received chunk:'</span>, chunk);

                <span class="hljs-comment">// æ£€æŸ¥ç»“æŸæ ‡è®°ï¼ˆä¸åç«¯å®šä¹‰çš„ "[DONE]" åŒ¹é…ï¼‰</span>
                <span class="hljs-keyword">if</span> (chunk === <span class="hljs-string">'[DONE]'</span>) {
                    eventSource.<span class="hljs-title function_">close</span>();
                    <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: ğŸŸ¢ æµå·²å®Œæˆå¹¶å…³é—­'</span>, <span class="hljs-string">'status-closed'</span>);
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Stream finished and closed by server.'</span>);
                    <span class="hljs-keyword">return</span>;
                }

                <span class="hljs-comment">// å®æ—¶è¿½åŠ æ•°æ®åˆ° UI</span>
                <span class="hljs-comment">// ä½¿ç”¨ innerHTML è¿½åŠ ï¼Œå¯ä»¥å®ç°æ›´ä¸°å¯Œçš„æ ·å¼</span>
                outputElement.<span class="hljs-property">innerHTML</span> += <span class="hljs-string">`&lt;span class="chunk"&gt;<span class="hljs-subst">${chunk}</span>&lt;/span&gt;&lt;span class="divider"&gt; | &lt;/span&gt;`</span>;

                <span class="hljs-comment">// ç¡®ä¿æ»šåŠ¨åˆ°åº•éƒ¨ä»¥æŸ¥çœ‹æœ€æ–°å†…å®¹</span>
                outputElement.<span class="hljs-property">scrollTop</span> = outputElement.<span class="hljs-property">scrollHeight</span>;
            };

            <span class="hljs-comment">// 4. ç›‘å¬é”™è¯¯äº‹ä»¶ï¼ˆå¤„ç†æ–­çº¿ç­‰ï¼‰</span>
            eventSource.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'EventSource encountered an error:'</span>, error);
                
                <span class="hljs-keyword">if</span> (eventSource.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">EventSource</span>.<span class="hljs-property">CLOSED</span>) {
                    <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: âŒ å·²å…³é—­æˆ–æ–­å¼€'</span>, <span class="hljs-string">'status-closed'</span>);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// EventSource é»˜è®¤ä¼šå°è¯•è‡ªåŠ¨é‡è¿</span>
                    <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: âš ï¸ å‘ç”Ÿé”™è¯¯ï¼Œæ­£åœ¨å°è¯•é‡è¿...'</span>, <span class="hljs-string">'status-connecting'</span>);
                }
            };
        }

        <span class="hljs-comment">// 5. å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­æµçš„å‡½æ•°</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">closeStream</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">if</span> (eventSource &amp;&amp; eventSource.<span class="hljs-property">readyState</span> !== <span class="hljs-title class_">EventSource</span>.<span class="hljs-property">CLOSED</span>) {
                eventSource.<span class="hljs-title function_">close</span>();
                <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: ğŸ›‘ ç”¨æˆ·æ‰‹åŠ¨å…³é—­'</span>, <span class="hljs-string">'status-closed'</span>);
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'User manually closed the stream.'</span>);
            }
        }

        <span class="hljs-comment">// é¡µé¢åŠ è½½å®Œæˆåç«‹å³å¯åŠ¨ SSE</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = initializeSSE;
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h5 data-id="heading-11">é˜¶æ®µä¸€ï¼šè¿æ¥åˆå§‹åŒ–ä¸å»ºç«‹</h5>
<p>æ­¤é˜¶æ®µæ—¨åœ¨å»ºç«‹ä¸€ä¸ªæŒä¹…åŒ–çš„ HTTP è¿æ¥ï¼Œå¹¶å¼€å§‹ç›‘å¬ã€‚</p>





























<table><thead><tr><th><strong>æ­¥éª¤</strong></th><th><strong>åŠ¨ä½œæè¿°</strong></th><th><strong>æ ¸å¿ƒä»£ç </strong></th><th><strong>å…³é”®ç‚¹</strong></th></tr></thead><tbody><tr><td><strong>1. åˆ›å»º <code>EventSource</code> å®ä¾‹</strong></td><td>ä½¿ç”¨ <code>EventSource</code> æ„é€ å‡½æ•°ä¼ å…¥ SSE æ¥å£ URLï¼Œå‘æœåŠ¡å™¨å‘èµ·è¿æ¥è¯·æ±‚ã€‚</td><td><code>const es = new EventSource(url);</code></td><td><strong>æµè§ˆå™¨è‡ªåŠ¨å¤„ç†</strong> åº•å±‚ HTTP GET è¯·æ±‚ã€‚</td></tr><tr><td><strong>2. ç›‘å¬è¿æ¥æ‰“å¼€</strong></td><td>ç›‘å¬ <code>onopen</code> äº‹ä»¶ï¼Œç¡®è®¤ä¸æœåŠ¡å™¨çš„è¿æ¥å·²æˆåŠŸå»ºç«‹ã€‚</td><td><code>es.onopen = () =&gt; { ... }</code></td><td>æ­¤æ—¶æµå¼æ•°æ®ä¼ è¾“é€šé“å·²æ‰“å¼€ã€‚</td></tr><tr><td><strong>3. æ›´æ–° UI çŠ¶æ€</strong></td><td>åœ¨ <code>onopen</code> ä¸­ï¼Œæ›´æ–°ç•Œé¢çŠ¶æ€ï¼Œæç¤ºç”¨æˆ·æ•°æ®æµå·²å¼€å§‹ã€‚</td><td><code>setStatus('å·²è¿æ¥');</code></td><td>æå‡ç”¨æˆ·ä½“éªŒã€‚</td></tr></tbody></table>
<h5 data-id="heading-12">é˜¶æ®µäºŒï¼šæ•°æ®æ¥æ”¶ä¸å¤„ç†ï¼ˆæ ¸å¿ƒï¼‰</h5>
<p>æ­¤é˜¶æ®µæ˜¯æŒç»­æ¥æ”¶æœåŠ¡å™¨æ¨é€çš„æ•°æ®ï¼Œå¹¶å®æ—¶æ›´æ–° UIã€‚</p>





























<table><thead><tr><th><strong>æ­¥éª¤</strong></th><th><strong>åŠ¨ä½œæè¿°</strong></th><th><strong>æ ¸å¿ƒä»£ç </strong></th><th><strong>å…³é”®ç‚¹</strong></th></tr></thead><tbody><tr><td><strong>4. ç›‘å¬æ¶ˆæ¯äº‹ä»¶</strong></td><td>ç›‘å¬ <code>onmessage</code> äº‹ä»¶ã€‚æ¯å½“æœåŠ¡å™¨æ¨é€ä¸€ä¸ªå®Œæ•´çš„ <code>data:...\n\n</code> äº‹ä»¶å—æ—¶ï¼Œæ­¤å›è°ƒå‡½æ•°å°±ä¼šè§¦å‘ã€‚</td><td><code>es.onmessage = (event) =&gt; { ... }</code></td><td><strong><code>event.data</code></strong> åŒ…å«äº†æœåŠ¡å™¨æ¨é€çš„å®é™…å†…å®¹ã€‚</td></tr><tr><td><strong>5. å®æ—¶æ•°æ®è¿½åŠ </strong></td><td>å°†æ¥æ”¶åˆ°çš„æ•°æ® (<code>event.data</code>) <strong>è¿½åŠ </strong>åˆ°å½“å‰å±•ç¤ºçš„æ–‡æœ¬æœ«å°¾ï¼ˆè€Œä¸æ˜¯æ›¿æ¢ï¼‰ã€‚</td><td><code>currentMsg += event.data;</code></td><td>è¿™æ˜¯å®ç°â€œæ‰“å­—æœºâ€æ•ˆæœçš„å…³é”®ã€‚</td></tr><tr><td><strong>6. å¤„ç†è‡ªå®šä¹‰äº‹ä»¶</strong></td><td>å¦‚æœåç«¯ä½¿ç”¨äº† <code>event: [name]</code> å­—æ®µï¼Œå‰ç«¯å¯ä»¥é€šè¿‡ <code>es.addEventListener('name', callback)</code> é’ˆå¯¹æ€§åœ°å¤„ç†ä¸åŒç±»å‹çš„äº‹ä»¶ã€‚</td><td><code>es.addEventListener('update', ...)</code></td><td>é€‚ç”¨äºéœ€è¦åŒºåˆ†ä¸åŒä¸šåŠ¡ç±»å‹æ•°æ®çš„åœºæ™¯ã€‚</td></tr></tbody></table>
<h5 data-id="heading-13">é˜¶æ®µä¸‰ï¼šè¿æ¥ç»´æŠ¤ã€å…³é—­ä¸é”™è¯¯å¤„ç†</h5>
<p>æ­¤é˜¶æ®µå¤„ç†æµçš„æ­£å¸¸ç»“æŸã€ç½‘ç»œé”™è¯¯å’Œé‡è¯•é€»è¾‘ã€‚</p>





























<table><thead><tr><th><strong>æ­¥éª¤</strong></th><th><strong>åŠ¨ä½œæè¿°</strong></th><th><strong>æ ¸å¿ƒä»£ç </strong></th><th><strong>å…³é”®ç‚¹</strong></th></tr></thead><tbody><tr><td><strong>7. ç›‘å¬æµç»“æŸæ ‡è®°</strong></td><td>æ ¹æ®ä¸åç«¯çº¦å®šçš„ç»“æŸæ ‡è®°ï¼ˆå¦‚ <code>[DONE]</code>ï¼‰ï¼Œåˆ¤æ–­æµæ˜¯å¦å®Œæˆã€‚</td><td><code>if (event.data === '[DONE]') { ... }</code></td><td><strong>æµçš„æ­£å¸¸ç»“æŸï¼Œ</strong> é¿å…æ— é™ç­‰å¾…ã€‚</td></tr><tr><td><strong>8. å…³é—­è¿æ¥</strong></td><td>å½“æµç»“æŸæˆ–ç”¨æˆ·ä¸»åŠ¨ç‚¹å‡»â€œåœæ­¢â€æŒ‰é’®æ—¶ï¼Œä¸»åŠ¨è°ƒç”¨ <code>close()</code> æ–¹æ³•ã€‚</td><td><code>es.close();</code></td><td>é‡Šæ”¾å®¢æˆ·ç«¯èµ„æºã€‚</td></tr><tr><td><strong>9. ç›‘å¬é”™è¯¯ä¸é‡è¿</strong></td><td>ç›‘å¬ <code>onerror</code> äº‹ä»¶ã€‚å½“è¿æ¥å‡ºé”™æ—¶ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®æœåŠ¡å™¨è®¾ç½®çš„ <code>retry:</code> æ—¶é—´é—´éš”è‡ªåŠ¨å°è¯•é‡è¿ã€‚</td><td><code>es.onerror = (error) =&gt; { ... }</code></td><td><strong>è‡ªåŠ¨é‡è¯•</strong> æ˜¯ SSE ç›¸æ¯”äºæ‰‹åŠ¨ <code>fetch</code> çš„å·¨å¤§ä¼˜åŠ¿ã€‚</td></tr></tbody></table>
<h5 data-id="heading-14">B.Fetch APIå®ç°</h5>
<p>å½“éœ€è¦æ›´å¼ºå¤§çš„æ§åˆ¶åŠ›ã€è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼Œæˆ–å¤„ç†éæ ‡å‡† SSE æ ¼å¼çš„æµæ—¶ï¼Œ<code>fetch</code> æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p>
<p>åˆ©ç”¨ <code>fetch</code> è¿”å›çš„ <code>response.body</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ª <strong><code>ReadableStream</code></strong> å¯¹è±¡ã€‚å¼€å‘è€…éœ€è¦è·å–è¿™ä¸ªæµçš„ <strong>Reader</strong>ï¼Œè¿›å…¥ä¸€ä¸ªå¾ªç¯ï¼Œ<strong>æ‰‹åŠ¨</strong>è¯»å–æ•°æ®å—ã€è§£ç ï¼Œå¹¶æ ¹æ® <code>\n\n</code> è§„åˆ™<strong>æ‰‹åŠ¨è§£æ</strong> SSE æ ¼å¼ã€‚</p>
<h6 data-id="heading-15">ä¼˜åŠ¿</h6>
<ul>
<li><strong>æ§åˆ¶åŠ›å¼ºï¼š</strong> å¯ä»¥å‘é€ POSTã€PUT ç­‰è¯·æ±‚ï¼Œå¹¶è®¾ç½®è‡ªå®šä¹‰ Headerï¼ˆç”¨äºé‰´æƒï¼‰ã€‚</li>
<li><strong>é€šç”¨æ€§ï¼š</strong> å¯ä»¥å¤„ç†ä»»ä½•åŸºäº HTTP çš„æµå¼æ•°æ®ï¼Œä¸é™äº SSE æ ¼å¼ã€‚</li>
<li><strong>æ–°æ ‡å‡†ï¼š</strong> ç¬¦åˆç°ä»£ Web æ ‡å‡†ï¼Œæµè§ˆå™¨æ”¯æŒè‰¯å¥½ã€‚</li>
</ul>
<h6 data-id="heading-16">æŒ‘æˆ˜</h6>
<ul>
<li><strong>å®ç°å¤æ‚ï¼š</strong> éœ€è¦æ‰‹åŠ¨ç¼–å†™æ•°æ®è§£æå’Œé”™è¯¯é‡è¿çš„ä»£ç ã€‚</li>
<li><strong>æ€§èƒ½è€ƒé‡ï¼š</strong> é¢‘ç¹çš„å¾ªç¯è¯»å–å’Œå­—ç¬¦ä¸²æ‹¼æ¥/è§£ç æ“ä½œéœ€è¦è°¨æ…ä¼˜åŒ–ã€‚</li>
</ul>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Fetch API SSE å®¢æˆ·ç«¯ç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Segoe UI'</span>, Tahoma, Geneva, Verdana, sans-serif; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-id">#status</span> { <span class="hljs-attribute">font-weight</span>: bold; <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>; <span class="hljs-attribute">color</span>: orange; }
        <span class="hljs-selector-id">#output-area</span> { 
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>; 
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>; 
            <span class="hljs-attribute">min-height</span>: <span class="hljs-number">150px</span>; 
            <span class="hljs-attribute">white-space</span>: pre-wrap;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fcfcfc</span>;
            <span class="hljs-attribute">overflow-y</span>: auto;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ğŸ”— Fetch API æ¨¡æ‹Ÿ SSE æ¥æ”¶ç«¯<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"status"</span>&gt;</span>è¿æ¥çŠ¶æ€: å¾…å¯åŠ¨<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>æ¥æ”¶åˆ°çš„æ¶ˆæ¯æµ:<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"output-area"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"startStream()"</span>&gt;</span>â–¶ï¸ å¯åŠ¨æµ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"stopStream()"</span>&gt;</span>ğŸ›‘ åœæ­¢æ¥æ”¶æµ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STREAM_URL</span> = <span class="hljs-string">'http://localhost:3000/api/stream-sse'</span>; <span class="hljs-comment">// ç¡®ä¿ URL æ­£ç¡®</span>
        
        <span class="hljs-keyword">const</span> statusElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'status'</span>);
        <span class="hljs-keyword">const</span> outputElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'output-area'</span>);
        
        <span class="hljs-keyword">let</span> controller = <span class="hljs-literal">null</span>; <span class="hljs-comment">// ç”¨äºæ§åˆ¶è¯·æ±‚ä¸­æ­¢ (AbortController)</span>

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateStatus</span>(<span class="hljs-params">text, color</span>) {
            statusElement.<span class="hljs-property">textContent</span> = text;
            statusElement.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = color;
        }

        <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">startStream</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">if</span> (controller) <span class="hljs-title function_">stopStream</span>(); <span class="hljs-comment">// ç¡®ä¿å‰ä¸€ä¸ªæµå·²åœæ­¢</span>

            controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
            <span class="hljs-keyword">const</span> signal = controller.<span class="hljs-property">signal</span>;
            <span class="hljs-keyword">let</span> textDecoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>(<span class="hljs-string">'utf-8'</span>);
            <span class="hljs-keyword">let</span> buffer = <span class="hljs-string">''</span>; <span class="hljs-comment">// ç¼“å†²åŒºï¼Œç”¨äºå­˜å‚¨ä¸å®Œæ•´çš„äº‹ä»¶å—</span>

            outputElement.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;
            <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: æ­£åœ¨è¿æ¥...'</span>, <span class="hljs-string">'orange'</span>);

            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 1. å‘èµ· Fetch è¯·æ±‚ï¼Œè®¾ç½® signal ç”¨äºä¸­æ­¢</span>
                <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-variable constant_">STREAM_URL</span>, {
                    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
                    <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'text/event-stream'</span> },
                    <span class="hljs-attr">signal</span>: signal 
                });

                <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">body</span>) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"å“åº”ä½“ä¸æ˜¯ä¸€ä¸ªå¯è¯»æµã€‚"</span>);
                }

                <span class="hljs-comment">// 2. è·å– ReadableStream çš„ Reader</span>
                <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();

                <span class="hljs-comment">// 3. å¾ªç¯è¯»å–æµæ•°æ®</span>
                <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                    <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
                    
                    <span class="hljs-keyword">if</span> (done) {
                        <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: ğŸŸ¢ æµå·²å®Œæˆ'</span>, <span class="hljs-string">'green'</span>);
                        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Stream finished.'</span>);
                        <span class="hljs-keyword">break</span>;
                    }

                    <span class="hljs-comment">// 4. è§£ç å­—èŠ‚æ•°æ®å¹¶è¿½åŠ åˆ°ç¼“å†²åŒº</span>
                    <span class="hljs-comment">// { stream: true } å…è®¸åœ¨æµç»§ç»­æ—¶è¿›è¡Œè§£ç </span>
                    buffer += textDecoder.<span class="hljs-title function_">decode</span>(value, { <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span> });

                    <span class="hljs-comment">// 5. æ‰‹åŠ¨è§£æ SSE æ¶ˆæ¯å—</span>
                    <span class="hljs-comment">// SSE æ¶ˆæ¯ä»¥ \n\n ç»“æŸï¼Œåˆ†å‰²ç¼“å†²åŒº</span>
                    <span class="hljs-keyword">let</span> messages = buffer.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n\n'</span>);
                    buffer = messages.<span class="hljs-title function_">pop</span>(); <span class="hljs-comment">// æœ€åä¸€ä¸ªä¸å®Œæ•´çš„å—ç•™åœ¨ç¼“å†²åŒº</span>

                    messages.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">message</span> =&gt;</span> {
                        <span class="hljs-keyword">if</span> (message) {
                            <span class="hljs-comment">// 6. æå– data: å­—æ®µå†…å®¹</span>
                            <span class="hljs-keyword">const</span> dataMatch = message.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/data: (.*)/</span>);
                            <span class="hljs-keyword">if</span> (dataMatch &amp;&amp; dataMatch[<span class="hljs-number">1</span>]) {
                                <span class="hljs-keyword">const</span> data = dataMatch[<span class="hljs-number">1</span>].<span class="hljs-title function_">trim</span>();

                                <span class="hljs-keyword">if</span> (data === <span class="hljs-string">'[DONE]'</span>) {
                                    controller.<span class="hljs-title function_">abort</span>(); <span class="hljs-comment">// æ¥æ”¶åˆ°ç»“æŸæ ‡è®°ï¼Œä¸»åŠ¨ä¸­æ­¢è¯·æ±‚</span>
                                } <span class="hljs-keyword">else</span> {
                                    <span class="hljs-comment">// 7. å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®</span>
                                    outputElement.<span class="hljs-property">innerHTML</span> += <span class="hljs-string">`&lt;span class="chunk"&gt;<span class="hljs-subst">${data}</span>&lt;/span&gt;&lt;span class="divider"&gt; | &lt;/span&gt;`</span>;
                                    outputElement.<span class="hljs-property">scrollTop</span> = outputElement.<span class="hljs-property">scrollHeight</span>;
                                }
                            }
                        }
                    });
                }
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-keyword">if</span> (error.<span class="hljs-property">name</span> === <span class="hljs-string">'AbortError'</span>) {
                    <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: ğŸ›‘ æµè¢«ç”¨æˆ·/DONEæ ‡è®°ä¸­æ­¢'</span>, <span class="hljs-string">'gray'</span>);
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Fetch request aborted successfully.'</span>);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">`è¿æ¥çŠ¶æ€: âŒ é”™è¯¯: <span class="hljs-subst">${error.message}</span>`</span>, <span class="hljs-string">'red'</span>);
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Fetch SSE é”™è¯¯:'</span>, error);
                }
            }
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">stopStream</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">if</span> (controller) {
                controller.<span class="hljs-title function_">abort</span>();
                controller = <span class="hljs-literal">null</span>;
            }
        }
        
        <span class="hljs-comment">// é¡µé¢åŠ è½½å®Œæˆåï¼Œè®¾ç½®åˆå§‹çŠ¶æ€</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: å¾…å¯åŠ¨'</span>, <span class="hljs-string">'black'</span>);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>Fetch API å®ç°æµå¼è¾“å‡ºæ˜¯é«˜åº¦å¯å®šåˆ¶ä½†ç›¸å¯¹å¤æ‚çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œå®ƒè¦æ±‚å¼€å‘è€…<strong>æ‰‹åŠ¨å¤„ç†æ•°æ®çš„æ¥æ”¶ã€è§£ç å’Œ SSE æ ¼å¼çš„è§£æ</strong>ã€‚æ•´ä¸ªæµç¨‹å¯ä»¥æ¸…æ™°åœ°åˆ’åˆ†ä¸ºä¸‰ä¸ªä¸»è¦é˜¶æ®µã€‚</p>
<h3 data-id="heading-17">é˜¶æ®µä¸€ï¼šåˆå§‹åŒ–è¯·æ±‚ä¸å‡†å¤‡å·¥ä½œ</h3>
<p>æ­¤é˜¶æ®µçš„ç›®æ ‡æ˜¯å‘èµ·è¯·æ±‚å¹¶è®¾ç½®æµè¯»å–æ‰€éœ€çš„ç¯å¢ƒã€‚</p>






























<table><thead><tr><th><strong>æ­¥éª¤</strong></th><th><strong>åŠ¨ä½œæè¿°</strong></th><th><strong>å…³é”®æŠ€æœ¯ç‚¹</strong></th></tr></thead><tbody><tr><td><strong>1. å‡†å¤‡æ§åˆ¶å™¨</strong></td><td>åˆ›å»º <code>AbortController</code> å®ä¾‹ã€‚ç”¨äºåœ¨æµç»“æŸæˆ–éœ€è¦ä¸­æ–­æ—¶ï¼Œèƒ½å¤Ÿ<strong>ä¸­æ­¢</strong> <code>fetch</code> è¯·æ±‚ã€‚</td><td><code>new AbortController()</code></td></tr><tr><td><strong>2. å‘èµ· Fetch è¯·æ±‚</strong></td><td>å‘èµ· <code>fetch</code> è¯·æ±‚ï¼Œå°† <code>controller.signal</code> é™„åŠ åˆ°è¯·æ±‚é…ç½®ä¸­ã€‚å¯åœ¨ <code>headers</code> ä¸­è®¾ç½®é‰´æƒä¿¡æ¯ã€‚</td><td><code>fetch(url, { signal: controller.signal, headers: {...} })</code></td></tr><tr><td><strong>3. è·å–æµè¯»å–å™¨</strong></td><td>æ£€æŸ¥å“åº”æ˜¯å¦æˆåŠŸ (<code>response.ok</code>)ï¼Œç„¶åé€šè¿‡ <code>response.body.getReader()</code> è·å– <strong><code>reader</code></strong> å¯¹è±¡ã€‚</td><td><code>response.body.getReader()</code></td></tr><tr><td><strong>4. å‡†å¤‡è§£ç å™¨ä¸ç¼“å†²åŒº</strong></td><td>å®ä¾‹åŒ– <code>TextDecoder</code> ç”¨äºå°†å­—èŠ‚è§£ç ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶åˆå§‹åŒ–ä¸€ä¸ª <strong><code>buffer</code></strong> å˜é‡ç”¨äºæš‚å­˜ä¸å®Œæ•´çš„æ•°æ®ç‰‡æ®µã€‚</td><td><code>new TextDecoder('utf-8')</code>, <code>let buffer = ''</code></td></tr></tbody></table>
<h3 data-id="heading-18">é˜¶æ®µäºŒï¼šå¾ªç¯è¯»å–ã€è§£ç ä¸è§£æï¼ˆæ ¸å¿ƒï¼‰</h3>
<p>æ­¤é˜¶æ®µæ˜¯æ•´ä¸ªæµç¨‹æœ€å¤æ‚çš„éƒ¨åˆ†ï¼Œéœ€è¦æŒç»­ä»æµä¸­æ‹‰å–æ•°æ®å¹¶æ‰‹åŠ¨è§£æ SSE æ ¼å¼ã€‚</p>













































<table><thead><tr><th><strong>æ­¥éª¤</strong></th><th><strong>åŠ¨ä½œæè¿°</strong></th><th><strong>å…³é”®æŠ€æœ¯ç‚¹</strong></th></tr></thead><tbody><tr><td><strong>5. å¯åŠ¨è¯»å–å¾ªç¯</strong></td><td>ä½¿ç”¨ <code>while (true)</code> æˆ–ç±»ä¼¼çš„å¾ªç¯ç»“æ„å¼€å§‹æŒç»­è¯»å–æ•°æ®ã€‚</td><td><code>while (true)</code></td></tr><tr><td><strong>6. è¯»å–æ•°æ®å—</strong></td><td>è°ƒç”¨ <code>await reader.read()</code>ã€‚å®ƒä¼šæš‚åœæ‰§è¡Œï¼Œç­‰å¾…æœåŠ¡å™¨æ¨é€æ–°çš„æ•°æ®å— (<code>value: Uint8Array</code>)ã€‚</td><td><code>const { done, value } = await reader.read()</code></td></tr><tr><td><strong>7. åˆ¤æ–­æµç»“æŸ</strong></td><td>æ£€æŸ¥ <code>done</code> å±æ€§ã€‚å¦‚æœä¸º <code>true</code>ï¼Œè·³å‡ºå¾ªç¯ï¼Œè¿›å…¥æ¸…ç†é˜¶æ®µã€‚</td><td><code>if (done) break;</code></td></tr><tr><td><strong>8. è§£ç ä¸ç¼“å†²</strong></td><td>ä½¿ç”¨ <code>TextDecoder</code> å°†åŸå§‹å­—èŠ‚ <code>value</code> è§£ç ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶<strong>è¿½åŠ </strong>åˆ°ç¼“å†²åŒº (<code>buffer</code>) ä¸­ã€‚</td><td><code>buffer += decoder.decode(value, { stream: true })</code></td></tr><tr><td><strong>9. æ‰‹åŠ¨è§£æ SSE</strong></td><td>ä½¿ç”¨ <code>buffer.split('\n\n')</code> å°†ç¼“å†²åŒºå†…å®¹åˆ†å‰²æˆæ½œåœ¨çš„ SSE æ¶ˆæ¯æ•°ç»„ã€‚ç„¶åå°†æ•°ç»„ä¸­<strong>æœ€åä¸€ä¸ªä¸å®Œæ•´çš„å—</strong>é‡æ–°æ”¾å›ç¼“å†²åŒºã€‚</td><td><code>buffer.split('\n\n')</code>, <code>buffer = messages.pop()</code></td></tr><tr><td><strong>10. æå–æ•°æ®</strong></td><td>éå†å…¶ä½™å®Œæ•´çš„æ¶ˆæ¯å—ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼ˆå¦‚ <code>/data: (.*)/</code>ï¼‰æ‰‹åŠ¨æå– <strong><code>data:</code></strong> å­—æ®µåçš„å®é™…å†…å®¹ã€‚</td><td><code>message.match(/data: (.*)/)</code></td></tr><tr><td><strong>11. å®æ—¶å¤„ç†</strong></td><td>å°†æå–åˆ°çš„æ•°æ®è¿½åŠ åˆ° UI ç•Œé¢ï¼Œå¹¶æ‰§è¡Œæ‰€éœ€çš„ä¸šåŠ¡é€»è¾‘ã€‚</td><td>UI æ›´æ–°ã€æ»šåŠ¨åˆ°åº•éƒ¨</td></tr></tbody></table>
<h3 data-id="heading-19">é˜¶æ®µä¸‰ï¼šè¿æ¥æ¸…ç†ä¸é”™è¯¯å¤„ç†</h3>
<p>æ­¤é˜¶æ®µç¡®ä¿æµçš„æ­£ç¡®ç»ˆæ­¢å’Œèµ„æºé‡Šæ”¾ã€‚</p>

























<table><thead><tr><th><strong>æ­¥éª¤</strong></th><th><strong>åŠ¨ä½œæè¿°</strong></th><th><strong>å…³é”®æŠ€æœ¯ç‚¹</strong></th></tr></thead><tbody><tr><td><strong>12. å¤„ç†ç»“æŸæ ‡è®°</strong></td><td>åœ¨æ•°æ®å¤„ç†é€»è¾‘ä¸­ï¼Œå¦‚æœæ£€æµ‹åˆ°æœåŠ¡å™¨æ¨é€çš„ç»“æŸæ ‡è®°ï¼ˆå¦‚ <code>[DONE]</code>ï¼‰ï¼Œåˆ™ç«‹å³è°ƒç”¨ <strong><code>controller.abort()</code></strong> ç»ˆæ­¢æµã€‚</td><td><code>controller.abort()</code></td></tr><tr><td><strong>13. é”™è¯¯æ•è·</strong></td><td>å°†æ•´ä¸ª <code>fetch</code> å’Œæµè¯»å–å¾ªç¯åŒ…è£¹åœ¨ <code>try...catch</code> å—ä¸­ã€‚æ•è·ç½‘ç»œé”™è¯¯å’Œå›  <code>controller.abort()</code> äº§ç”Ÿçš„ <code>AbortError</code>ã€‚</td><td><code>try...catch (error)</code></td></tr><tr><td><strong>14. é‡Šæ”¾èµ„æº</strong></td><td>æ— è®ºæ˜¯æ­£å¸¸ç»“æŸè¿˜æ˜¯å‡ºé”™ï¼Œç¡®ä¿æ‰€æœ‰ç›¸å…³èµ„æºï¼ˆå¦‚ <code>reader</code>ï¼‰å¾—åˆ°é‡Šæ”¾ã€‚</td><td><strong><code>AbortController</code></strong> è‡ªåŠ¨å¤„ç†äº†è¯·æ±‚çš„ç»ˆæ­¢ã€‚</td></tr></tbody></table>
<p>é€šè¿‡è¿™ç§æ‰‹åŠ¨æ§åˆ¶çš„æ–¹å¼ï¼ŒFetch API æä¾›äº†å¯¹æµçš„<strong>æœ€é«˜çº§åˆ«æ§åˆ¶</strong>ï¼Œä½†ä»£ä»·æ˜¯ä»£ç å®ç°æ›´ä¸ºå¤æ‚ï¼Œä¸”éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å¤„ç†è‡ªåŠ¨é‡è¿ç­‰å¥å£®æ€§æœºåˆ¶ã€‚</p>
<h5 data-id="heading-20">C.Axios APIå®ç°</h5>
<p>ä½¿ç”¨ <code>axios</code> å®ç°æµå¼è¾“å‡ºä¸»è¦ä¾èµ–å…¶é…ç½®é¡¹ï¼Œä½†åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹çš„è¡¨ç°ä¸å¦‚ <code>fetch</code> å’Œ <code>EventSource</code>ã€‚</p>
<p>åœ¨ <code>axios</code> çš„é…ç½®ä¸­ï¼Œéœ€è¦æ˜¾å¼è®¾ç½® <code>responseType: 'stream'</code>ã€‚åœ¨ <strong>Node.js</strong> ç¯å¢ƒä¸­ï¼Œè¿™ä¼šè¿”å›ä¸€ä¸ª Node.js çš„æµï¼Œå¤„ç†èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚ä½†åœ¨<strong>æµè§ˆå™¨ç¯å¢ƒ</strong>ä¸­ï¼Œ<code>axios</code> å¯¹æµçš„å°è£…ä¸å¦‚ <code>fetch</code> åŸç”Ÿã€‚</p>
<h6 data-id="heading-21">ä¼˜åŠ¿</h6>
<ul>
<li><strong>Node.js å‹å¥½ï¼š</strong> åœ¨ Node.js ç¯å¢ƒä¸­å¤„ç†æµå¼æ•°æ®å¾ˆæ–¹ä¾¿ã€‚</li>
<li><strong>ä»£ç ç»Ÿä¸€ï¼š</strong> å¦‚æœåº”ç”¨å¤§é‡ä¾èµ– <code>axios</code>ï¼Œå¯ä»¥é¿å…å¼•å…¥ <code>fetch</code>ã€‚</li>
</ul>
<h6 data-id="heading-22">æŒ‘æˆ˜</h6>
<ul>
<li><strong>æµè§ˆå™¨å…¼å®¹æ€§/ç¨³å®šæ€§ï¼š</strong> æµè§ˆå™¨ç«¯å¯¹ <code>axios</code> æµçš„ç¨³å®šæ”¯æŒä¸å¦‚ <code>fetch</code> å’Œ <code>EventSource</code>ã€‚</li>
<li><strong>è§£æä¾ç„¶éœ€è¦æ‰‹åŠ¨ï¼š</strong> åƒ <code>fetch</code> ä¸€æ ·ï¼Œæ‚¨ä»ç„¶éœ€è¦è·å–æµå¹¶æ‰‹åŠ¨è¿›è¡Œ SSE æ ¼å¼çš„è§£æå’Œè§£ç ã€‚</li>
<li><strong>æ½œåœ¨çš„å†…å­˜é—®é¢˜ï¼š</strong> å¦‚æœæµå¤„ç†ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜ã€‚</li>
</ul>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Axios å®¢æˆ·ç«¯æ¨¡æ‹Ÿ SSE ç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Segoe UI'</span>, Tahoma, Geneva, Verdana, sans-serif; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-id">#status</span> { <span class="hljs-attribute">font-weight</span>: bold; <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>; <span class="hljs-attribute">color</span>: orange; }
        <span class="hljs-selector-id">#output-area</span> { 
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>; 
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>; 
            <span class="hljs-attribute">min-height</span>: <span class="hljs-number">150px</span>; 
            <span class="hljs-attribute">white-space</span>: pre-wrap;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fcfcfc</span>;
            <span class="hljs-attribute">overflow-y</span>: auto;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ğŸ› ï¸ Axios æ¨¡æ‹Ÿ SSE æ¥æ”¶ç«¯<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"status"</span>&gt;</span>è¿æ¥çŠ¶æ€: å¾…å¯åŠ¨<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>æ¥æ”¶åˆ°çš„æ¶ˆæ¯æµ:<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"output-area"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"startStream()"</span>&gt;</span>â–¶ï¸ å¯åŠ¨æµ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"stopStream()"</span>&gt;</span>ğŸ›‘ åœæ­¢æ¥æ”¶æµ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STREAM_URL</span> = <span class="hljs-string">'http://localhost:3000/api/stream-sse'</span>; <span class="hljs-comment">// ç¡®ä¿ URL æ­£ç¡®</span>
        
        <span class="hljs-keyword">const</span> statusElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'status'</span>);
        <span class="hljs-keyword">const</span> outputElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'output-area'</span>);
        
        <span class="hljs-keyword">let</span> cancelTokenSource = <span class="hljs-literal">null</span>; <span class="hljs-comment">// ç”¨äºå–æ¶ˆè¯·æ±‚çš„ Axios Token</span>
        <span class="hljs-keyword">let</span> lastProcessedIndex = <span class="hljs-number">0</span>;   <span class="hljs-comment">// è¿½è¸ªä¸Šæ¬¡å¤„ç†åˆ°çš„æ•°æ®ç´¢å¼•</span>
        <span class="hljs-keyword">let</span> buffer = <span class="hljs-string">''</span>;              <span class="hljs-comment">// ç”¨äºå­˜æ”¾ä¸å®Œæ•´çš„ SSE äº‹ä»¶å—</span>

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateStatus</span>(<span class="hljs-params">text, color</span>) {
            statusElement.<span class="hljs-property">textContent</span> = text;
            statusElement.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = color;
        }

        <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">startStream</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">if</span> (cancelTokenSource) <span class="hljs-title function_">stopStream</span>();

            cancelTokenSource = axios.<span class="hljs-property">CancelToken</span>.<span class="hljs-title function_">source</span>();
            lastProcessedIndex = <span class="hljs-number">0</span>;
            buffer = <span class="hljs-string">''</span>;
            outputElement.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;
            <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: æ­£åœ¨è¿æ¥...'</span>, <span class="hljs-string">'orange'</span>);

            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 1. å‘èµ· Axios GET è¯·æ±‚</span>
                <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">STREAM_URL</span>, {
                    <span class="hljs-comment">// 2. è®¾ç½® responseType ä¸º 'stream' æˆ–è®©å…¶é»˜è®¤ (text)</span>
                    <span class="hljs-comment">// åœ¨æµè§ˆå™¨ä¸­ï¼Œè¿™ä¾èµ–äº XHR çš„ progress äº‹ä»¶</span>
                    <span class="hljs-attr">responseType</span>: <span class="hljs-string">'text'</span>, 
                    
                    <span class="hljs-comment">// 3. è®¾ç½®å–æ¶ˆ Token</span>
                    <span class="hljs-attr">cancelToken</span>: cancelTokenSource.<span class="hljs-property">token</span>,
                    
                    <span class="hljs-comment">// 4. æ ¸å¿ƒï¼šç›‘å¬ä¸‹è½½è¿›åº¦äº‹ä»¶</span>
                    <span class="hljs-attr">onDownloadProgress</span>: <span class="hljs-function">(<span class="hljs-params">progressEvent</span>) =&gt;</span> {
                        <span class="hljs-comment">// progressEvent.currentTarget æ˜¯åº•å±‚çš„ XMLHttpRequest å¯¹è±¡</span>
                        <span class="hljs-keyword">const</span> responseText = progressEvent.<span class="hljs-property">currentTarget</span>.<span class="hljs-property">responseText</span>;

                        <span class="hljs-comment">// 5. æå–æ–°å¢çš„æ•°æ®å—</span>
                        <span class="hljs-keyword">const</span> newChunk = responseText.<span class="hljs-title function_">substring</span>(lastProcessedIndex);
                        lastProcessedIndex = responseText.<span class="hljs-property">length</span>;
                        
                        <span class="hljs-comment">// 6. è¿½åŠ åˆ°ç¼“å†²åŒº</span>
                        buffer += newChunk;

                        <span class="hljs-comment">// 7. æ‰‹åŠ¨è§£æ SSE æ¶ˆæ¯å—</span>
                        <span class="hljs-keyword">let</span> messages = buffer.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n\n'</span>);
                        <span class="hljs-comment">// æœ€åä¸€ä¸ªç‰‡æ®µå¯èƒ½æ˜¯æœªå®Œæˆçš„äº‹ä»¶ï¼Œä¿ç•™åœ¨ç¼“å†²åŒº</span>
                        buffer = messages.<span class="hljs-title function_">pop</span>(); 

                        messages.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">message</span> =&gt;</span> {
                            <span class="hljs-keyword">if</span> (message.<span class="hljs-title function_">trim</span>()) {
                                <span class="hljs-comment">// 8. æå– data: å­—æ®µå†…å®¹</span>
                                <span class="hljs-keyword">const</span> dataMatch = message.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/data: (.*)/</span>);
                                <span class="hljs-keyword">if</span> (dataMatch &amp;&amp; dataMatch[<span class="hljs-number">1</span>]) {
                                    <span class="hljs-keyword">const</span> data = dataMatch[<span class="hljs-number">1</span>].<span class="hljs-title function_">trim</span>();

                                    <span class="hljs-comment">// 9. æ£€æŸ¥ç»“æŸæ ‡è®°ï¼ˆä¸åç«¯å®šä¹‰çš„ "[DONE]" åŒ¹é…ï¼‰</span>
                                    <span class="hljs-keyword">if</span> (data === <span class="hljs-string">'[DONE]'</span>) {
                                        <span class="hljs-title function_">stopStream</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// æ¥æ”¶åˆ°ç»“æŸæ ‡è®°ï¼Œä¸»åŠ¨ä¸­æ­¢è¯·æ±‚</span>
                                    } <span class="hljs-keyword">else</span> {
                                        <span class="hljs-comment">// 10. å®æ—¶è¿½åŠ æ•°æ®åˆ° UI</span>
                                        outputElement.<span class="hljs-property">innerHTML</span> += <span class="hljs-string">`&lt;span class="chunk"&gt;<span class="hljs-subst">${data}</span>&lt;/span&gt;&lt;span class="divider"&gt; | &lt;/span&gt;`</span>;
                                        outputElement.<span class="hljs-property">scrollTop</span> = outputElement.<span class="hljs-property">scrollHeight</span>;
                                    }
                                }
                            }
                        });
                    }
                });

                <span class="hljs-comment">// è¯·æ±‚æ­£å¸¸ç»“æŸï¼ˆåç«¯åœ¨å‘é€ [DONE] åå…³é—­è¿æ¥ï¼Œä½† Axios ä»å¯èƒ½ç­‰å¾…è¶…æ—¶ï¼‰</span>
                <span class="hljs-comment">// æ¨èä¾é  [DONE] æ¥è°ƒç”¨ stopStream</span>
                <span class="hljs-keyword">if</span> (!cancelTokenSource) {
                     <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: ğŸŸ¢ æµå·²å®Œæˆ (Axios OK)'</span>, <span class="hljs-string">'green'</span>);
                }

            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-keyword">if</span> (axios.<span class="hljs-title function_">isCancel</span>(error)) {
                    <span class="hljs-comment">// è¢«ç”¨æˆ·æˆ– [DONE] æ ‡è®°å–æ¶ˆ</span>
                    <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: ğŸ›‘ æµå·²ä¸­æ­¢'</span>, <span class="hljs-string">'gray'</span>);
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Axios request manually aborted.'</span>);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// å…¶ä»–ç½‘ç»œé”™è¯¯æˆ–è¯·æ±‚å¤±è´¥</span>
                    <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">`è¿æ¥çŠ¶æ€: âŒ é”™è¯¯: <span class="hljs-subst">${error.message}</span>`</span>, <span class="hljs-string">'red'</span>);
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Axios SSE é”™è¯¯:'</span>, error);
                }
            }
        }

        <span class="hljs-comment">// å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­æµçš„å‡½æ•°</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">stopStream</span>(<span class="hljs-params">isDone = <span class="hljs-literal">false</span></span>) {
            <span class="hljs-keyword">if</span> (cancelTokenSource) {
                cancelTokenSource.<span class="hljs-title function_">cancel</span>(<span class="hljs-string">'Stream terminated.'</span>);
                cancelTokenSource = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">if</span> (isDone) {
                    <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: ğŸŸ¢ æµå·²å®Œæˆå¹¶å…³é—­'</span>, <span class="hljs-string">'green'</span>);
                }
            }
        }
        
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: å¾…å¯åŠ¨'</span>, <span class="hljs-string">'black'</span>);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>Axios å¹¶éä¸º SSE è®¾è®¡çš„ï¼Œå› ä¸ºå®ƒåŸºäºä¼ ç»Ÿçš„ XMLHttpRequest (XHR) æ¨¡å‹ï¼Œæˆ–è€…åœ¨ Node.js ä¸­åŸºäº <code>http</code> æ¨¡å—ã€‚åœ¨<strong>æµè§ˆå™¨ç¯å¢ƒ</strong>ä¸­ï¼ŒAxios æ²¡æœ‰åŸç”Ÿ <code>EventSource</code> æˆ– <code>ReadableStream</code> çš„æ”¯æŒã€‚</p>
<p>å› æ­¤ï¼Œä½¿ç”¨ Axios å®ç°æµå¼è¾“å‡ºçš„<strong>æ ‡å‡†å·¥ä½œæµç¨‹</strong>æ˜¯åˆ©ç”¨ XHR çš„ <strong><code>onprogress</code></strong> äº‹ä»¶ç›‘å¬æœºåˆ¶ï¼ˆåœ¨ Axios ä¸­è¡¨ç°ä¸º <code>onDownloadProgress</code> å›è°ƒï¼‰ï¼Œæ‰‹åŠ¨è·å–æ¯æ¬¡æ–°å¢çš„æ•°æ®å—ï¼Œå¹¶æ‰‹åŠ¨è¿›è¡Œ SSE æ ¼å¼çš„è§£æã€‚</p>
<ol>
<li><strong>æ²¡æœ‰è‡ªåŠ¨è§£æï¼š</strong> å¿…é¡»æ‰‹åŠ¨è§£æ <code>data:</code> å­—æ®µå’Œ <code>\n\n</code> åˆ†éš”ç¬¦ã€‚</li>
<li><strong>æ‰‹åŠ¨è¿½è¸ªæ•°æ®ï¼š</strong> æ¯æ¬¡ <code>onDownloadProgress</code> è§¦å‘æ—¶ï¼Œè¿”å›çš„æ˜¯<strong>å½“å‰å·²æ¥æ”¶çš„å…¨éƒ¨æ•°æ®</strong>ï¼Œè€Œä¸æ˜¯æ–°å¢çš„æ•°æ®ã€‚æ‚¨éœ€è¦ä¸€ä¸ªæŒ‡é’ˆæ¥è¿½è¸ªä¸Šæ¬¡å¤„ç†åˆ°äº†å“ªé‡Œï¼Œå¹¶æå–å‡ºæ–°çš„æ•°æ®å—ã€‚</li>
<li><strong>ä¸æ”¯æŒè‡ªåŠ¨é‡è¿ï¼š</strong> å¿…é¡»æ‰‹åŠ¨å®ç°é”™è¯¯æ£€æµ‹å’Œé‡è¿é€»è¾‘ï¼ˆæœ¬ç¤ºä¾‹ä¸åŒ…å«é‡è¿ï¼Œä½†éœ€æ³¨æ„ï¼‰ã€‚</li>
</ol>
<h5 data-id="heading-23">æµå¼è¾“å‡ºæŠ€æœ¯çš„é€‰æ‹©</h5>
<h6 data-id="heading-24">1. ğŸ¥‡ EventSource API</h6>
<p>è¿™æ˜¯å®ç° SSE çš„<strong>æ ‡å‡†å’Œé¦–é€‰</strong>æ–¹æ¡ˆã€‚</p>
<ul>
<li>
<p><strong>å®ç°å¤æ‚åº¦ï¼š</strong> <strong>æœ€ä½ã€‚</strong> æµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼Œä»£ç é‡æœ€å°‘ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong> <strong>å†…ç½®å¥å£®æ€§ã€‚</strong> è‡ªåŠ¨å¤„ç† SSE æ•°æ®æ ¼å¼è§£æã€æ¶ˆæ¯äº‹ä»¶ (<code>onmessage</code>) è§¦å‘ï¼Œå¹¶å†…ç½®äº†æ–­çº¿é‡è¿æœºåˆ¶ï¼ˆæ”¯æŒæœåŠ¡å™¨è®¾ç½® <code>retry:</code> é—´éš”ï¼‰ã€‚</p>
</li>
<li>
<p><strong>ä¸»è¦å±€é™ï¼š</strong></p>
<ul>
<li><strong>åªèƒ½ GET è¯·æ±‚ã€‚</strong></li>
<li><strong>ä¸æ”¯æŒè‡ªå®šä¹‰ Header é‰´æƒã€‚</strong> åªèƒ½é€šè¿‡ URL å‚æ•°ä¼ é€’ Tokenï¼Œå®‰å…¨æ€§ç›¸å¯¹è¾ƒä½ã€‚</li>
</ul>
</li>
<li>
<p><strong>é€‰æ‹©åŸåˆ™ï¼š</strong> <strong>å¼ºçƒˆæ¨è</strong>ç”¨äºå¤§å¤šæ•°åœºæ™¯ï¼Œå°¤å…¶æ˜¯åœ¨å®‰å…¨æ€§è¦æ±‚ä¸æ¶‰åŠè¯·æ±‚ Headerï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ Session Cookie æˆ– URL Token é‰´æƒï¼‰ä¸”åªéœ€è¦å•å‘æ•°æ®æ¨é€æ—¶ã€‚</p>
</li>
</ul>
<h6 data-id="heading-25">2. ğŸ¥ˆ Fetch API + ReadableStream</h6>
<p>è¿™æ˜¯åœ¨éœ€è¦é«˜æ§åˆ¶åº¦æ—¶ä½¿ç”¨çš„ç°ä»£æ ‡å‡†æ–¹æ¡ˆã€‚</p>
<ul>
<li>
<p><strong>å®ç°å¤æ‚åº¦ï¼š</strong> <strong>ä¸­é«˜ã€‚</strong> éœ€è¦æ‰‹åŠ¨è·å–æµé˜…è¯»å™¨ (<code>getReader()</code>)ï¼Œå¹¶è¿›å…¥å¾ªç¯ï¼Œæ‰‹åŠ¨è¿›è¡Œ SSE æ•°æ®è§£æï¼ˆè§£ç å­—èŠ‚ã€æŸ¥æ‰¾ <code>\n\n</code>ã€æå– <code>data:</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong> <strong>æ§åˆ¶åŠ›æœ€å¼ºã€‚</strong></p>
<ul>
<li>æ”¯æŒè‡ªå®šä¹‰ HTTP Headerï¼ˆé€‚ç”¨äºä¼ é€’ JWT ç­‰é‰´æƒä¿¡æ¯ï¼‰ã€‚</li>
<li>æ”¯æŒ POST ç­‰å…¶ä»– HTTP æ–¹æ³•ã€‚</li>
<li>å¯ä»¥å¤„ç†éæ ‡å‡†çš„æµæ ¼å¼ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä¸»è¦å±€é™ï¼š</strong> å¿…é¡»æ‰‹åŠ¨ç¼–å†™å¤æ‚çš„ SSE æ ¼å¼è§£æé€»è¾‘å’Œé”™è¯¯é‡è¿æœºåˆ¶ã€‚</p>
</li>
<li>
<p><strong>é€‰æ‹©åŸåˆ™ï¼š</strong> å½“æ‚¨<strong>å¿…é¡»</strong>åœ¨è¯·æ±‚ Header ä¸­ä¼ é€’é‰´æƒä¿¡æ¯ï¼ˆä¾‹å¦‚ JWTï¼‰ï¼Œæˆ–è€…éœ€è¦å¤„ç†éæ ‡å‡†çš„æµæ ¼å¼æ—¶ï¼Œåº”é€‰æ‹©æ­¤æ–¹æ¡ˆã€‚</p>
</li>
</ul>
<h6 data-id="heading-26">3. ğŸ¥‰ Axios + onDownloadProgress</h6>
<p>è¿™æ˜¯åŸºäºæ—§çš„ XHR æœºåˆ¶çš„æ¨¡æ‹Ÿæ–¹æ¡ˆï¼Œ<strong>é€šå¸¸ä¸æ¨è</strong>ç”¨äºç°ä»£ Web åº”ç”¨çš„ SSEã€‚</p>
<ul>
<li>
<p><strong>å®ç°å¤æ‚åº¦ï¼š</strong> <strong>é«˜ã€‚</strong> ä¾èµ– <code>onDownloadProgress</code> äº‹ä»¶ï¼Œæ¯æ¬¡äº‹ä»¶è§¦å‘è¿”å›çš„æ˜¯<strong>å…¨éƒ¨</strong>å·²æ¥æ”¶æ•°æ®ï¼Œå› æ­¤éœ€è¦é¢å¤–çš„é€»è¾‘æ¥è¿½è¸ªä¸Šæ¬¡å¤„ç†çš„ç´¢å¼•ï¼Œä»¥æå–æ–°å¢çš„æ•°æ®å—ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong> å¦‚æœæ‚¨çš„é¡¹ç›®å¤§é‡ä¾èµ– Axiosï¼Œå¯ä»¥ä¿æŒæŠ€æœ¯æ ˆçš„ç»Ÿä¸€ã€‚</p>
</li>
<li>
<p><strong>ä¸»è¦å±€é™ï¼š</strong></p>
<ul>
<li>å®ç°æµç¨‹å¤æ‚ä¸”æ˜“é”™ã€‚</li>
<li>æ€§èƒ½ä¸å¦‚åŸç”Ÿ APIï¼Œä¸”ä¸æ”¯æŒåŸç”Ÿçš„è‡ªåŠ¨é‡è¿ã€‚</li>
<li>åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œç¼ºä¹å¯¹æµçš„æ ‡å‡†åŒ–æ”¯æŒã€‚</li>
</ul>
</li>
<li>
<p><strong>é€‰æ‹©åŸåˆ™ï¼š</strong> ä»…åœ¨éœ€è¦å…¼å®¹æ—§ç¯å¢ƒæˆ–å› ç‰¹æ®Šé™åˆ¶<strong>æ— æ³•ä½¿ç”¨ <code>EventSource</code> æˆ– <code>fetch</code></strong> çš„æƒ…å†µä¸‹è€ƒè™‘ã€‚</p>
</li>
</ul>
<h3 data-id="heading-27">2.åŸºäºWebSocketçš„åŒå‘æµå¼è¾“å‡ºå®ç°</h3>
<p>WebSocket åè®®ä¸ SSEï¼ˆå•å‘æµï¼‰å’Œä¼ ç»Ÿçš„ HTTP è¯·æ±‚ï¼ˆä¸€æ¬¡æ€§ä¼ è¾“ï¼‰æœ‰ç€æœ¬è´¨çš„åŒºåˆ«ï¼Œå®ƒåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹äº†ä¸€ä¸ªæŒä¹…çš„ã€<strong>å…¨åŒå·¥ï¼ˆåŒå‘ï¼‰</strong> çš„é€šä¿¡é€šé“ï¼Œéå¸¸é€‚åˆéœ€è¦é«˜é¢‘ç‡ã€ä½å»¶è¿Ÿäº¤äº’çš„åœºæ™¯ã€‚</p>
<h4 data-id="heading-28">1. åè®®å‡çº§</h4>
<p>WebSocket è¿æ¥çš„å»ºç«‹å§‹äºä¸€ä¸ªæ ‡å‡†çš„ HTTP è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚åŒ…å«äº†ç‰¹æ®Šçš„ Headerï¼Œç”¨äºè¯·æ±‚å°†è¿æ¥ä» HTTP <strong>å‡çº§ï¼ˆUpgradeï¼‰</strong> åˆ° WebSocket åè®®ã€‚ä¸€æ—¦å‡çº§æˆåŠŸï¼Œè¿æ¥å°±ä¸å†å—é™äºä¼ ç»Ÿçš„ HTTP è¯·æ±‚-å“åº”æ¨¡å‹ã€‚</p>
<h4 data-id="heading-29">2. å…¨åŒå·¥é€šä¿¡</h4>
<p>ä¸€æ—¦è¿æ¥å»ºç«‹ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¯ä»¥<strong>ç‹¬ç«‹ã€åŒæ—¶åœ°</strong>äº’ç›¸å‘é€æ•°æ®å¸§ã€‚</p>
<ul>
<li><strong>å®¢æˆ·ç«¯ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â†’</span></span></span></span></span> æœåŠ¡å™¨ï¼š</strong> å®¢æˆ·ç«¯å¯ä»¥éšæ—¶å‘é€è¾“å…¥ã€æ§åˆ¶å‘½ä»¤æˆ–å¿ƒè·³åŒ…ã€‚</li>
<li><strong>æœåŠ¡å™¨ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â†’</span></span></span></span></span> å®¢æˆ·ç«¯ï¼š</strong> æœåŠ¡å™¨å¯ä»¥éšæ—¶å‘é€æµå¼æ•°æ®ã€çŠ¶æ€æ›´æ–°æˆ–å“åº”ã€‚</li>
</ul>
<p>è¿™ç§åŒå‘æ€§ä½¿å¾— WebSocket ä¸ä»…å¯ä»¥ç”¨äºæµå¼è¾“å‡ºï¼ˆæœåŠ¡å™¨æ¨æ•°æ®ï¼‰ï¼Œè¿˜å¯ä»¥ç”¨äºå®æ—¶æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œå®Œç¾æ”¯æŒ <strong>å®æ—¶èŠå¤©</strong> æˆ– <strong>åä½œç¼–è¾‘</strong> ç­‰åœºæ™¯ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3069d503a494ec090c04f35cdc6f07a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp5aSp5omt56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766410978&amp;x-signature=W4MwqgaXedigOTKNckA0t%2Fk7fic%3D" alt="WebSocket bidirectional communication diagramçš„å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-30">3. åŸºäºå¸§çš„ä¼ è¾“</h4>
<p>WebSocket çš„æ•°æ®ä¼ è¾“æ˜¯åŸºäº<strong>å¸§</strong>çš„ï¼Œè€Œä¸æ˜¯åŸºäºæ–‡æœ¬æµæˆ– HTTP è¯·æ±‚ã€‚è¿™ä½¿å¾—ä¼ è¾“æ•ˆç‡æ›´é«˜ï¼Œå»¶è¿Ÿæ›´ä½ã€‚å¸§å¯ä»¥åŒ…å«æ–‡æœ¬æ•°æ®ï¼ˆText Frameï¼‰æˆ–äºŒè¿›åˆ¶æ•°æ®ï¼ˆBinary Frameï¼‰ã€‚</p>
<hr/>
<p>åŸºäº WebSocket çš„åŒå‘æµå¼è¾“å‡ºéœ€è¦å‰ç«¯å’Œåç«¯åˆ†åˆ«<strong>ä½¿ç”¨ä¸“é—¨çš„åº“å’Œ API è¿›è¡Œ</strong>å®ç°ã€‚</p>
<h4 data-id="heading-31">1. åç«¯å®ç° (Node.js/ws æˆ– Socket.IO)</h4>
<p>åç«¯éœ€è¦ä¸€ä¸ªä¸“é—¨çš„ WebSocket æœåŠ¡å™¨æ¥ç®¡ç†è¿æ¥å’Œå‘é€æ•°æ®å¸§ã€‚</p>



































<table><thead><tr><th><strong>æ­¥éª¤</strong></th><th><strong>åŠ¨ä½œæè¿°</strong></th><th><strong>å…³é”®æŠ€æœ¯ç‚¹</strong></th></tr></thead><tbody><tr><td><strong>1. æ¡æ‰‹ä¸è¿æ¥</strong></td><td>ç›‘å¬ HTTP å‡çº§è¯·æ±‚ï¼Œæ¥å—è¿æ¥ï¼Œå¹¶åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ WebSocket è¿æ¥å¯¹è±¡ã€‚</td><td><code>ws.on('connection', (socket) =&gt; { ... })</code></td></tr><tr><td><strong>2. æ¥æ”¶å®¢æˆ·ç«¯è¾“å…¥</strong></td><td>ç›‘å¬å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ•°æ®å¸§ï¼Œç”¨äºè§¦å‘ AI ä»»åŠ¡æˆ–æ§åˆ¶æµã€‚</td><td><code>socket.on('message', (input) =&gt; { // Process input })</code></td></tr><tr><td><strong>3. æµå¼ç”Ÿæˆä¸æ¨é€</strong></td><td>åœ¨ AI æ¨¡å‹ç”Ÿæˆæ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ•°æ®å—å°è£…æˆ WebSocket å¸§å¹¶å®æ—¶å‘é€ã€‚</td><td><code>socket.send(data_chunk)</code></td></tr><tr><td><strong>4. ç»´æŠ¤è¿æ¥</strong></td><td>ç»´æŠ¤è¿æ¥çŠ¶æ€ï¼Œå¤„ç†å¿ƒè·³åŒ…ï¼ˆPing/Pongï¼‰ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯æ–­å¼€æ—¶æ¸…ç†èµ„æºã€‚</td><td><code>socket.on('close', ...)</code></td></tr><tr><td/><td/><td/></tr></tbody></table>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">WebSocket</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ws'</span>);

<span class="hljs-comment">// åˆ›å»º WebSocket æœåŠ¡å™¨ï¼Œç›‘å¬ 8080 ç«¯å£</span>
<span class="hljs-keyword">const</span> wss = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>.<span class="hljs-title class_">Server</span>({ <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span> });

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'WebSocket Server running on ws://localhost:8080'</span>);

<span class="hljs-comment">// ç›‘å¬å®¢æˆ·ç«¯è¿æ¥äº‹ä»¶</span>
wss.<span class="hljs-title function_">on</span>(<span class="hljs-string">'connection'</span>, <span class="hljs-keyword">function</span> <span class="hljs-title function_">connection</span>(<span class="hljs-params">ws</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'--- Client Connected ---'</span>);
    
    <span class="hljs-comment">// 1. ç›‘å¬å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯ï¼ˆåŒå‘è¾“å…¥ï¼‰</span>
    ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">'message'</span>, <span class="hljs-keyword">function</span> <span class="hljs-title function_">incoming</span>(<span class="hljs-params">message</span>) {
        <span class="hljs-keyword">const</span> clientMessage = message.<span class="hljs-title function_">toString</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Received message from client: <span class="hljs-subst">${clientMessage}</span>`</span>);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(clientMessage);
            
            <span class="hljs-keyword">if</span> (data.<span class="hljs-property">command</span> === <span class="hljs-string">'START'</span>) {
                <span class="hljs-comment">// å®¢æˆ·ç«¯è¯·æ±‚å¼€å§‹æµå¼è¾“å‡º</span>
                <span class="hljs-title function_">startStreaming</span>(ws, data.<span class="hljs-property">prompt</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.<span class="hljs-property">command</span> === <span class="hljs-string">'STOP'</span>) {
                <span class="hljs-comment">// å®¢æˆ·ç«¯è¯·æ±‚åœæ­¢æµå¼è¾“å‡º (å®æ—¶æ§åˆ¶)</span>
                <span class="hljs-title function_">stopStreaming</span>(ws);
                ws.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">'info'</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'Streaming stopped by client.'</span> }));
            }
        } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error parsing client message:'</span>, e);
            ws.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">'error'</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'Invalid JSON format.'</span> }));
        }
    });

    <span class="hljs-comment">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span>
    ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-keyword">function</span> <span class="hljs-title function_">close</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'--- Client Disconnected ---'</span>);
        <span class="hljs-comment">// æ¸…ç†èµ„æºï¼Œåœæ­¢è¯¥è¿æ¥ä¸Šçš„æ‰€æœ‰æµ</span>
        <span class="hljs-title function_">stopStreaming</span>(ws);
    });

    <span class="hljs-comment">// åˆå§‹é—®å€™</span>
    ws.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">'ready'</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'Welcome! Send {"command": "START", "prompt": "..."} to begin streaming.'</span> }));
});

<span class="hljs-comment">// å­˜å‚¨å½“å‰æ­£åœ¨æµå¼è¾“å‡ºçš„è¿æ¥å’Œå®šæ—¶å™¨</span>
<span class="hljs-keyword">const</span> activeStreams = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

<span class="hljs-comment">/**
 * æ¨¡æ‹Ÿ AI æ¨¡å‹æµå¼è¾“å‡ºçš„å‡½æ•°
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">WebSocket</span>} <span class="hljs-variable">ws</span> - å½“å‰è¿æ¥çš„ WebSocket å®ä¾‹
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">prompt</span> - å®¢æˆ·ç«¯æä¾›çš„è¾“å…¥æç¤º
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">startStreaming</span>(<span class="hljs-params">ws, prompt</span>) {
    <span class="hljs-keyword">if</span> (activeStreams.<span class="hljs-title function_">has</span>(ws)) {
        ws.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">'info'</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'Stream is already active.'</span> }));
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">let</span> counter = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
        counter++;
        <span class="hljs-keyword">const</span> chunk = <span class="hljs-string">`[Chunk <span class="hljs-subst">${counter}</span>] Output for "<span class="hljs-subst">${prompt.substring(<span class="hljs-number">0</span>, <span class="hljs-number">15</span>)}</span>...": Data block <span class="hljs-subst">${counter}</span>.`</span>;
        
        <span class="hljs-comment">// 2. å®æ—¶å°†æ•°æ®å—ä½œä¸º WebSocket å¸§å‘é€ç»™å®¢æˆ·ç«¯</span>
        <span class="hljs-comment">// ä½¿ç”¨ JSON æ ¼å¼å°è£…æ•°æ®ï¼Œæ–¹ä¾¿å®¢æˆ·ç«¯è§£æ</span>
        <span class="hljs-keyword">const</span> dataToSend = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ 
            <span class="hljs-attr">type</span>: <span class="hljs-string">'data'</span>, 
            <span class="hljs-attr">content</span>: chunk,
            <span class="hljs-attr">count</span>: counter
        });
        
        <span class="hljs-comment">// æ£€æŸ¥è¿æ¥æ˜¯å¦ä»ç„¶æ‰“å¼€</span>
        <span class="hljs-keyword">if</span> (ws.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>) {
            ws.<span class="hljs-title function_">send</span>(dataToSend);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Pushed data chunk <span class="hljs-subst">${counter}</span>`</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å¦‚æœè¿æ¥å…³é—­ï¼Œåœæ­¢æµ</span>
            <span class="hljs-built_in">clearInterval</span>(intervalId);
            activeStreams.<span class="hljs-title function_">delete</span>(ws);
        }

        <span class="hljs-keyword">if</span> (counter &gt;= <span class="hljs-number">15</span>) {
            <span class="hljs-comment">// 3. æµç»“æŸï¼Œå‘é€ç»“æŸæ ‡è®°</span>
            <span class="hljs-built_in">clearInterval</span>(intervalId);
            activeStreams.<span class="hljs-title function_">delete</span>(ws);
            <span class="hljs-keyword">if</span> (ws.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>) {
                 ws.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'done'</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'Streaming complete.'</span> }));
            }
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'--- Streaming finished ---'</span>);
        }
    }, <span class="hljs-number">500</span>); <span class="hljs-comment">// æ¯ 500 æ¯«ç§’å‘é€ä¸€ä¸ªæ•°æ®å—</span>

    activeStreams.<span class="hljs-title function_">set</span>(ws, intervalId);
}

<span class="hljs-comment">/**
 * åœæ­¢æŒ‡å®šè¿æ¥çš„æµå¼è¾“å‡º
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">stopStreaming</span>(<span class="hljs-params">ws</span>) {
    <span class="hljs-keyword">if</span> (activeStreams.<span class="hljs-title function_">has</span>(ws)) {
        <span class="hljs-built_in">clearInterval</span>(activeStreams.<span class="hljs-title function_">get</span>(ws));
        activeStreams.<span class="hljs-title function_">delete</span>(ws);
    }
}
</code></pre>
<h4 data-id="heading-32">2. å‰ç«¯å®ç° (Browser WebSocket API)</h4>
<p>å‰ç«¯ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿçš„ <code>WebSocket</code> API æ¥å»ºç«‹è¿æ¥å’Œå¤„ç†åŒå‘é€šä¿¡ã€‚</p>






























<table><thead><tr><th><strong>æ­¥éª¤</strong></th><th><strong>åŠ¨ä½œæè¿°</strong></th><th><strong>å…³é”®æŠ€æœ¯ç‚¹</strong></th></tr></thead><tbody><tr><td><strong>1. å»ºç«‹è¿æ¥</strong></td><td>ä½¿ç”¨ <code>new WebSocket(ws://url)</code> å»ºç«‹è¿æ¥ã€‚æ³¨æ„åè®®æ˜¯ <code>ws://</code> æˆ– <code>wss://</code>ã€‚</td><td><code>new WebSocket('ws://localhost:8080')</code></td></tr><tr><td><strong>2. ç›‘å¬è¿æ¥çŠ¶æ€</strong></td><td>ç›‘å¬ <code>onopen</code>ï¼ˆè¿æ¥æˆåŠŸï¼‰ã€<code>onerror</code> å’Œ <code>onclose</code> äº‹ä»¶ã€‚</td><td><code>ws.onopen = () =&gt; {...}</code></td></tr><tr><td><strong>3. æ¥æ”¶æµå¼è¾“å‡º</strong></td><td>ç›‘å¬ <strong><code>onmessage</code></strong> äº‹ä»¶ï¼Œæ¥æ”¶æœåŠ¡å™¨æ¨é€çš„æµå¼æ•°æ®å¸§ï¼Œå¹¶å®æ—¶è¿½åŠ åˆ° UIã€‚</td><td><code>ws.onmessage = (event) =&gt; { // Append event.data }</code></td></tr><tr><td><strong>4. å‘é€å®¢æˆ·ç«¯è¾“å…¥</strong></td><td>å½“ç”¨æˆ·æœ‰æ–°è¾“å…¥æˆ–éœ€è¦å‘é€æ§åˆ¶å‘½ä»¤æ—¶ï¼Œé€šè¿‡ <code>send()</code> æ–¹æ³•å‘é€æ•°æ®å¸§åˆ°æœåŠ¡å™¨ã€‚</td><td><code>ws.send(JSON.stringify({command: 'stop'}))</code></td></tr></tbody></table>
<hr/>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>WebSocket åŒå‘æµå¼è¾“å‡º<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">font-family</span>: Arial, sans-serif; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-id">#status</span> { <span class="hljs-attribute">font-weight</span>: bold; <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>; }
        <span class="hljs-selector-id">#output-area</span> { <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>; <span class="hljs-attribute">min-height</span>: <span class="hljs-number">150px</span>; <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f9f9f9</span>; <span class="hljs-attribute">white-space</span>: pre-wrap; <span class="hljs-attribute">overflow-y</span>: scroll; }
        <span class="hljs-selector-class">.control-panel</span> { <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ğŸ’¬ WebSocket åŒå‘æµå¼äº¤äº’<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"status"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color: gray;"</span>&gt;</span>è¿æ¥çŠ¶æ€: å¾…è¿æ¥...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>æœåŠ¡å™¨è¾“å‡ºæµ:<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"output-area"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"control-panel"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"prompt"</span>&gt;</span>è¾“å…¥æç¤º:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"prompt"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"è¯·ç»™æˆ‘å†™ä¸€ç¯‡å…³äºAIæµå¼è¾“å‡ºçš„æ–‡ç« "</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 300px;"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"connectWebSocket()"</span>&gt;</span>å»ºç«‹è¿æ¥<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"startStream()"</span>&gt;</span>â–¶ï¸ å¯åŠ¨æµå¼è¾“å‡º<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"stopStream()"</span>&gt;</span>ğŸ›‘ å®æ—¶åœæ­¢æµ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"closeWebSocket()"</span>&gt;</span>æ–­å¼€è¿æ¥<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">WS_URL</span> = <span class="hljs-string">'ws://localhost:8080'</span>;
        <span class="hljs-keyword">let</span> ws = <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">const</span> statusElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'status'</span>);
        <span class="hljs-keyword">const</span> outputElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'output-area'</span>);
        <span class="hljs-keyword">const</span> promptInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'prompt'</span>);

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">message</span>) {
            outputElement.<span class="hljs-property">innerHTML</span> += <span class="hljs-string">`&lt;p style="margin: 0; padding: 2px 0;"&gt;<span class="hljs-subst">${message}</span>&lt;/p&gt;`</span>;
            outputElement.<span class="hljs-property">scrollTop</span> = outputElement.<span class="hljs-property">scrollHeight</span>;
        }
        
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateStatus</span>(<span class="hljs-params">text, color</span>) {
            statusElement.<span class="hljs-property">textContent</span> = text;
            statusElement.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = color;
        }

        <span class="hljs-comment">// 1. å»ºç«‹ WebSocket è¿æ¥</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">connectWebSocket</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">if</span> (ws &amp;&amp; ws.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>) {
                <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥å·²å­˜åœ¨'</span>, <span class="hljs-string">'blue'</span>);
                <span class="hljs-keyword">return</span>;
            }

            ws = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-variable constant_">WS_URL</span>);
            <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'æ­£åœ¨è¿æ¥...'</span>, <span class="hljs-string">'orange'</span>);
            outputElement.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;

            <span class="hljs-comment">// ç›‘å¬è¿æ¥æˆåŠŸäº‹ä»¶</span>
            ws.<span class="hljs-property">onopen</span> = <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: âœ… å·²å»ºç«‹'</span>, <span class="hljs-string">'green'</span>);
                <span class="hljs-title function_">log</span>(<span class="hljs-string">'--- WebSocket Connection Opened ---'</span>);
            };

            <span class="hljs-comment">// 2. ç›‘å¬æ¥æ”¶åˆ°çš„æ•°æ®å¸§ (æ ¸å¿ƒ)</span>
            ws.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>);
                    
                    <span class="hljs-keyword">if</span> (data.<span class="hljs-property">type</span> === <span class="hljs-string">'data'</span>) {
                        <span class="hljs-comment">// å®æ—¶è¿½åŠ æµå¼è¾“å‡ºçš„å†…å®¹</span>
                        <span class="hljs-title function_">log</span>(<span class="hljs-string">`[Server Stream]: <span class="hljs-subst">${data.content}</span>`</span>);
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.<span class="hljs-property">type</span> === <span class="hljs-string">'done'</span>) {
                        <span class="hljs-title function_">log</span>(<span class="hljs-string">`[INFO]: <span class="hljs-subst">${data.message}</span>`</span>);
                        <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'æµå·²å®Œæˆ'</span>, <span class="hljs-string">'blue'</span>);
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.<span class="hljs-property">status</span> === <span class="hljs-string">'info'</span>) {
                        <span class="hljs-title function_">log</span>(<span class="hljs-string">`[INFO]: <span class="hljs-subst">${data.message}</span>`</span>);
                    }
                } <span class="hljs-keyword">catch</span> (e) {
                    <span class="hljs-comment">// å¤„ç†é JSON æ ¼å¼çš„æ¶ˆæ¯</span>
                    <span class="hljs-title function_">log</span>(<span class="hljs-string">`[RAW MESSAGE]: <span class="hljs-subst">${event.data}</span>`</span>);
                }
            };

            <span class="hljs-comment">// ç›‘å¬é”™è¯¯äº‹ä»¶</span>
            ws.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
                <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: âŒ å‘ç”Ÿé”™è¯¯'</span>, <span class="hljs-string">'red'</span>);
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'WebSocket Error:'</span>, error);
            };

            <span class="hljs-comment">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶ (è¿æ¥æ–­å¼€)</span>
            ws.<span class="hljs-property">onclose</span> = <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¿æ¥çŠ¶æ€: ğŸ›‘ å·²æ–­å¼€'</span>, <span class="hljs-string">'red'</span>);
                <span class="hljs-title function_">log</span>(<span class="hljs-string">'--- WebSocket Connection Closed ---'</span>);
                ws = <span class="hljs-literal">null</span>;
            };
        }

        <span class="hljs-comment">// 3. å®¢æˆ·ç«¯å‘é€å‘½ä»¤ï¼šå¯åŠ¨æµå¼è¾“å‡º</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">startStream</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">if</span> (ws &amp;&amp; ws.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>) {
                <span class="hljs-keyword">const</span> prompt = promptInput.<span class="hljs-property">value</span> || <span class="hljs-string">"Default prompt"</span>;
                <span class="hljs-keyword">const</span> command = {
                    <span class="hljs-attr">command</span>: <span class="hljs-string">'START'</span>,
                    <span class="hljs-attr">prompt</span>: prompt
                };
                <span class="hljs-comment">// å‘é€ JSON æ ¼å¼çš„å¯åŠ¨å‘½ä»¤</span>
                ws.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(command));
                <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'æµå¼è¾“å‡ºå·²å¯åŠ¨...'</span>, <span class="hljs-string">'purple'</span>);
                <span class="hljs-title function_">log</span>(<span class="hljs-string">`[Client Command]: Starting stream for prompt: "<span class="hljs-subst">${prompt}</span>"`</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¯·å…ˆå»ºç«‹è¿æ¥'</span>, <span class="hljs-string">'red'</span>);
            }
        }

        <span class="hljs-comment">// 4. å®¢æˆ·ç«¯å‘é€å‘½ä»¤ï¼šå®æ—¶åœæ­¢æµ</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">stopStream</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">if</span> (ws &amp;&amp; ws.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>) {
                <span class="hljs-keyword">const</span> command = {
                    <span class="hljs-attr">command</span>: <span class="hljs-string">'STOP'</span>
                };
                <span class="hljs-comment">// å‘é€ JSON æ ¼å¼çš„åœæ­¢å‘½ä»¤</span>
                ws.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(command));
                <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'å‘é€åœæ­¢å‘½ä»¤'</span>, <span class="hljs-string">'purple'</span>);
                <span class="hljs-title function_">log</span>(<span class="hljs-string">`[Client Command]: Sending STOP command.`</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-title function_">updateStatus</span>(<span class="hljs-string">'è¯·å…ˆå»ºç«‹è¿æ¥'</span>, <span class="hljs-string">'red'</span>);
            }
        }
        
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">closeWebSocket</span>(<span class="hljs-params"/>) {
             <span class="hljs-keyword">if</span> (ws &amp;&amp; ws.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>) {
                 ws.<span class="hljs-title function_">close</span>();
             }
        }

        <span class="hljs-comment">// é¡µé¢åŠ è½½åè‡ªåŠ¨å°è¯•è¿æ¥</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = connectWebSocket;
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>



































<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>WebSocket åŒå‘æµ</strong></th><th><strong>SSE å•å‘æµ</strong></th></tr></thead><tbody><tr><td><strong>é€šä¿¡æ–¹å‘</strong></td><td><strong>åŒå‘</strong>ï¼ˆå…¨åŒå·¥ï¼‰</td><td><strong>å•å‘</strong>ï¼ˆæœåŠ¡å™¨ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â†’</span></span></span></span></span> å®¢æˆ·ç«¯ï¼‰</td></tr><tr><td><strong>åè®®åŸºç¡€</strong></td><td>ç‹¬ç«‹äº HTTP çš„ TCP åè®®</td><td>åŸºäº HTTP åè®®</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å®æ—¶èŠå¤©ã€åä½œç¼–è¾‘ã€<strong>AI å®æ—¶äº¤äº’æ§åˆ¶</strong></td><td><strong>çº¯ç²¹çš„ AI æµå¼è¾“å‡º</strong>ã€æ–°é—»æ¨é€</td></tr><tr><td><strong>å®ç°å¤æ‚åº¦</strong></td><td>è¾ƒé«˜ï¼ˆéœ€ç‹¬ç«‹æœåŠ¡å™¨æ”¯æŒï¼‰</td><td>è¾ƒä½ï¼ˆåŸºäºæ ‡å‡† HTTPï¼‰</td></tr><tr><td><strong>è‡ªåŠ¨é‡è¿</strong></td><td><strong>æ— åŸç”Ÿæ”¯æŒ</strong>ï¼Œéœ€è¦æ‰‹åŠ¨å®ç°</td><td><strong>æµè§ˆå™¨åŸç”Ÿæ”¯æŒ</strong></td></tr></tbody></table>
<p>å¦‚æœä½ çš„ AI åº”ç”¨åªéœ€è¦å°† LLM çš„ç»“æœæµå¼è¾“å‡ºç»™ç”¨æˆ·ï¼Œ<strong>SSE æ˜¯æ›´ç®€å•ã€æ›´å¥å£®çš„é€‰æ‹©</strong>ã€‚ä½†å¦‚æœæ‚¨çš„åº”ç”¨éœ€è¦ç”¨æˆ·åœ¨æµå¼è¾“å‡ºè¿‡ç¨‹ä¸­<strong>å®æ—¶ä¸­æ–­ã€ä¿®æ”¹è¾“å…¥ã€æˆ–è€…å®ç°å¤šäººåä½œ</strong>ï¼Œ<strong>WebSocket æ˜¯å”¯ä¸€çš„é€‰æ‹©</strong>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»Šå¹´æˆ‘è¯•äº†åå‡ æ¬¾ AI ç¼–ç¨‹å·¥å…·ï¼Œæœ€ç»ˆåªç•™ä¸‹è¿™ 3 ä¸ª]]></title>    <link>https://juejin.cn/post/7583912899389325355</link>    <guid>https://juejin.cn/post/7583912899389325355</guid>    <pubDate>2025-12-15T13:52:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583912899389325355" data-draft-id="7583898823921303594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»Šå¹´æˆ‘è¯•äº†åå‡ æ¬¾ AI ç¼–ç¨‹å·¥å…·ï¼Œæœ€ç»ˆåªç•™ä¸‹è¿™ 3 ä¸ª"/> <meta itemprop="keywords" content="AIç¼–ç¨‹,Trae,Cursor"/> <meta itemprop="datePublished" content="2025-12-15T13:52:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£å“¥æ•°æ™ºè°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»Šå¹´æˆ‘è¯•äº†åå‡ æ¬¾ AI ç¼–ç¨‹å·¥å…·ï¼Œæœ€ç»ˆåªç•™ä¸‹è¿™ 3 ä¸ª
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£å“¥æ•°æ™ºè°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T13:52:30.000Z" title="Mon Dec 15 2025 13:52:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä»Šå¹´ä¸€å¹´ï¼Œå°è¯•å¹¶åˆ†äº«äº† N å¤šçš„ AI å¼€å‘å·¥å…·ï¼Œä»Šå¤©å°±ç»™å¤§å®¶åˆ†äº«ä¸‹ä¸ªäººç›®å‰ç¨³å®šçš„ <strong>AI å¼€å‘å·¥å…·é›†</strong>ã€‚</p>
<p>æœ€è¿‘æ²¡æœ‰å¼•å…¥ä»€ä¹ˆæ–°å¼€å‘å·¥å…·ï¼ˆåŒ…æ‹¬<code>AntiGravity</code>ï¼‰ï¼Œä¸»åŠ›ä¸»è¦æ˜¯ä»¥ä¸‹3ä¸ªï¼š</p>
<ul>
<li>TRAE</li>
<li>Cursor</li>
<li>Claude Codeï¼ˆGLM-4.5ï¼‰</li>
</ul>
<p><strong>TRAE</strong></p>
<p>TRAE ä¸»è¦æœ‰ä¸‰ç±»åœºæ™¯ï¼š</p>
<ul>
<li>SOLO æ¨¡å¼ã€‚è¿™ä¸ªçœŸçš„æå…¶æ¨èï¼Œ<strong>å°é¡¹ç›®</strong>çš„ä¸€æŠŠæ¢­å“ˆå°±ä¸è¯´äº†ï¼Œç¯å¢ƒéƒ¨ç½²ã€ç‰©è”ç½‘å¼€å‘ç­‰å¼ºä¾èµ–<strong>ç»ˆç«¯è°ƒè¯•</strong>çš„åœºæ™¯ï¼ŒSOLO ä¹Ÿèƒ½å®Œç¾é€‚é…ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cddc870845842788acb20704ea0bdc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766411550&amp;x-signature=tXKEphmnMCXTsNguazMve4PLvhw%3D" alt="" loading="lazy"/></li>
<li>åŸæ¥çš„ <code>Claude 4</code>ï¼ˆç°å·²ä¸èƒ½ä½¿ç”¨ï¼‰ï¼Œç°åœ¨çš„ <code>Gemini 3 Pro</code>ã€‚é¢å¯¹ç‰¹å®šåœºæ™¯ï¼Œåªèƒ½ä»–ä»¬æ¥æ”»å…‹éš¾é¢˜ã€‚è€Œ TRAE ä¸éœ€è¦é­”æ³•å°±èƒ½ç›´æ¥ä½¿ç”¨ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯å›½äº§ç«å“ä¸­æ¯”è¾ƒè‰¯å¿ƒçš„äº†ã€‚</li>
<li>éç¼–ç¨‹åœºæ™¯ï¼Œæ¯”å¦‚æ–‡ç« ä¼˜åŒ–ã€é¡¹ç›®æ–‡æ¡£ç¼–å†™ç­‰ï¼Œé€šè¿‡<strong>è‡ªå®šä¹‰æ™ºèƒ½ä½“</strong>çš„æ–¹å¼ï¼Œçµæ´»ä¸”ç›´è§‚ã€‚</li>
</ul>
<p>å¥½åƒæœ‰å¾ˆå¤šäººè¿˜ä¸çŸ¥é“ï¼š<code>TRAE</code> å›½å†…ç‰ˆï¼Œæœ‰ <code>SOLO</code>ï¼Œè¿˜å…è´¹ã€‚</p>
<p><strong>Cursor</strong></p>
<p>é’ˆå¯¹ä¸€äº›å¤æ‚é¡¹ç›®ï¼Œå°¤å…¶æ˜¯éœ€è¦æ‰‹åŠ¨ç¼–å†™éƒ¨åˆ†ä»£ç çš„ï¼Œæˆ‘ä¼šé€‰æ‹© <code>Cursor</code>ã€‚</p>
<p>ä¸Šä¸‹æ–‡çš„æŠ½å–å’Œéœ€æ±‚çš„ç†è§£ï¼Œ<code>Cursor</code> è¿˜æ˜¯é¡¶çº§çš„ï¼Œå…¶æ¬¡å°±æ˜¯æ‰‹åŠ¨ç¼–å†™ä»£ç æ—¶ï¼Œ<code>Cursor</code> çš„ <code>Tab</code> ç”¨èµ·æ¥çœŸçš„äº«å—ã€‚</p>
<p>ä¸¾ä¸€ä¸ªå°ä¾‹å­ï¼Œ<code>MyBatis</code> ä¸­åŸæœ¬ <code>select</code> äº†ä¸€ä¸ªå•è¡¨ï¼Œéœ€æ±‚å˜åŠ¨ä¸ºå…³è”æŸ¥è¯¢ï¼Œæ­¤æ—¶éœ€è¦åœ¨ <code>select</code> çš„å­—æ®µå‰é¢å¢åŠ åˆ«åã€‚<code>Cursor</code> ä¸‹çœŸçš„åªéœ€è¦å½•å…¥ä¸€ä¸ªåˆ«åï¼Œå°±ä¼šæŠŠå‰©ä¸‹å­—æ®µå…¨éƒ¨çš„åˆ«ååŠ ä¸Šã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55c0ceb002e241c6b2249615f45c8586~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766411550&amp;x-signature=eMl8THZT03LdfiyXh5T5YHuO1Hw%3D" alt="" loading="lazy"/></p>
<p><strong>Claude Code</strong></p>
<p><code>Claude Code</code> çš„åº”ç”¨åœºæ™¯åˆ™æ›´åŠ æ˜ç¡®ã€‚</p>
<p>å°±æ˜¯åµŒå…¥åˆ°æˆ‘ä»¬å†…éƒ¨çš„è‡ªåŠ¨åŒ–ç ”å‘æµç¨‹ä¸­ï¼Œé€æ­¥æ›¿ä»£äººå·¥ç ”å‘ï¼Œé•¿è¿œç›®æ ‡å°±æ˜¯æ­å»ºä¸€å¥—å®Œæ•´çš„ AI ç ”å‘å›¢é˜Ÿã€‚</p>
<p>å¥½äº†ä»Šå¤©å°±ä»‹ç»åˆ°è¿™é‡Œå§ï¼Œå¦‚æœè¿™å‡ ä¸ªå·¥å…·ä½ æœ‰ä»€ä¹ˆæ›´å¥½çš„åœºæ™¯æˆ–è€…ç–‘é—®ï¼Œæ¬¢è¿äº¤æµ~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ Trae + MCP è®© AI è‡ªåŠ¨æµ‹è¯•é¡µé¢]]></title>    <link>https://juejin.cn/post/7583898823921008682</link>    <guid>https://juejin.cn/post/7583898823921008682</guid>    <pubDate>2025-12-15T12:10:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583898823921008682" data-draft-id="7581649704884191247" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ Trae + MCP è®© AI è‡ªåŠ¨æµ‹è¯•é¡µé¢"/> <meta itemprop="keywords" content="AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-12-15T12:10:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è°è¨€è¥¿è¥¿é‡Œ"/> <meta itemprop="url" content="https://juejin.cn/user/332466136029851"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ Trae + MCP è®© AI è‡ªåŠ¨æµ‹è¯•é¡µé¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/332466136029851/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è°è¨€è¥¿è¥¿é‡Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:10:47.000Z" title="Mon Dec 15 2025 12:10:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æƒ³å¿…å¤§å®¶åœ¨å‰æ®µæ—¶é—´å…³äº <strong>â€œè±†åŒ…æ‰‹æœºâ€</strong> ä¸€å®šæœ‰æ‰€è€³é—»ï¼Œè¯´å®è¯åœ¨çœ‹è¿‡äº†ä¸å°‘åšä¸»çš„ä½“éªŒå’Œæµ‹è¯„ä¹‹åå‘€ï¼Œä¸ç¦æœ‰ç‚¹æ„Ÿå¹ç°ä»£çš„AIå‘å±•äº†ğŸ¤¯ã€‚</p>
<p>ä½†æ˜¯æœ‰ä¸€ä¸ªè®©æˆ‘æ¯”è¾ƒå¥½å¥‡çš„åŠŸèƒ½ğŸ¤”ï¼Œé‚£å°±æ˜¯ <strong>AI Agentæ˜¯å¦‚ä½•é€šè¿‡ç”¨æˆ·æä¾›çš„æç¤ºè¯æ¥ç›´æ¥æ“æ§åº”ç”¨çš„å‘¢ï¼Ÿ</strong>
æ¯•ç«Ÿå¯¹äºå¤§å¤šæ•°äººæ¥è¯´ AI è¿˜åœç•™åœ¨èŠå¤©å¯¹è¯çš„é˜¶æ®µï¼Œæ˜¯ä»€ä¹ˆä¸œè¥¿è®© AI çªç„¶æ‹¥æœ‰äº†è‡ªå·±çš„ â€œæ‰‹â€ä¸â€œçœ¼â€ å‘¢ï¼Ÿ</p>
<p>å› æ­¤æˆ‘å°±å»ç¨å¾®äº†è§£äº†ä¸€ä¸‹ä¸è¿™æ–¹é¢æœ‰å…³çš„ä¸€äº›çŸ¥è¯†ï¼Œç»“æœç¢°åˆ°äº† <code>mcpåè®®</code> å’Œ <code>playwright</code>ã€‚</p>
<p>äºæ˜¯æˆ‘æŠ±ç€ä¸€é¢—å­¦å¾’çš„å¿ƒï¼Œæ¥è¯•è¯•åœ¨ç›®å‰å¾ˆç«çš„ AI ç¼–è¯‘å™¨ <strong>Trae</strong> æ¥çœ‹çœ‹ä¼šæ‘©æ“¦å‡ºæ€æ ·çš„ç«èŠ±ğŸ”¥ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯ MCPï¼ˆModel Context Protocolï¼‰ï¼Ÿ</h2>
<h3 data-id="heading-2">å®šä¹‰ï¼š</h3>
<p>MCP åè®®æ˜¯ä¸€ä¸ª<strong>å¼€æ”¾ã€æ ‡å‡†åŒ–çš„é€šä¿¡åè®®</strong>ï¼Œè€Œå®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼š</p>
<blockquote>
<p><strong>è®©å¤§è¯­è¨€æ¨¡å‹èƒ½å¤Ÿå®‰å…¨ã€ç»“æ„åŒ–åœ°è°ƒç”¨å¤–éƒ¨å·¥å…·ã€è®¿é—®ä¸Šä¸‹æ–‡æ•°æ®ï¼Œå¹¶ä¸çœŸå®ä¸–ç•Œäº¤äº’ã€‚</strong></p>
</blockquote>
<p>è¯´ç™½äº†ï¼Œ<strong>MCP æ˜¯ç»™ AI è£…ä¸Šâ€œæ‰‹â€å’Œâ€œçœ¼â€çš„æ¥å£ã€‚</strong></p>
<p>åœ¨ MCP å‡ºç°ä¹‹å‰ï¼ŒAI ç¼–ç¨‹åŠ©æ‰‹å­˜åœ¨ä¸¥é‡å±€é™ï¼š</p>
<ul>
<li><strong>åªèƒ½æ²Ÿé€šï¼Œä¸èƒ½å®æ–½</strong>ï¼šè™½ç„¶ AI å¯ä»¥å¸®åŠ©ç”Ÿæˆä»£ç ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥è¿è¡Œã€æµ‹è¯•æˆ–éªŒè¯å®ƒæ˜¯å¦çœŸçš„è¾¾åˆ°äº†éœ€è¦çš„æ•ˆæœã€‚</li>
<li><strong>ä¿¡æ¯è·å–æ­¥éª¤å¤æ‚</strong>ï¼šAI å¹¶ä¸çŸ¥é“æˆ‘ä»¬æœ¬åœ°æœ‰å“ªäº›æ–‡ä»¶ã€ä¾èµ–ç­‰ç­‰ï¼Œå¤§å¤šæ•°æ—¶å€™éœ€è¦æ‰‹åŠ¨æ“ä½œæ¥æä¾›ç»™å®ƒã€‚</li>
</ul>
<p>ä½†æ˜¯é€šè¿‡ MCP è¿™ä¸ªâ€œæ¡¥æ¢â€ï¼Œè®© AI ä½œä¸ºå®¢æˆ·ç«¯é€šè¿‡æ ‡å‡†åè®®ï¼Œè¿æ¥ä¸€ä¸ªæˆ–å¤šä¸ª MCP Serverä»è€ŒæŠŠ<strong>å¤–éƒ¨ç¨‹åº</strong>ï¼ˆæ¯”å¦‚ Playwrightã€Shell è„šæœ¬ç­‰ï¼‰æ¥å…¥åˆ° AI ç¼–è¯‘å™¨ä¸­ï¼Œè®© AI èƒ½è°ƒç”¨å®ƒä»¬ã€‚</p>
<p>ä¾‹å¦‚ï¼š<strong>â€œæ¨¡å‹ + å·¥å…·ç”Ÿæ€â€ååŒ</strong>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fb68ab9a3fc4321aa5510b8f5e1cf8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=MgUSrQgDXCybSASpatSkpPrd1Ow%3D" alt="tongyi-mermaid-2025-12-15-184415.png" loading="lazy"/></p>
<p>åœ¨è¿™æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·ä»…ä»…åªæ˜¯å‘ AI Agent ä¸‹è¾¾äº†æµ‹è¯•ç™»å½•çš„å‘½ä»¤ï¼Œåœ¨æ­¤ä¹‹åçš„è¿‡ç¨‹éƒ½æ— éœ€äººå·¥å¹²é¢„ï¼ŒAI å¯ä»¥è‡ªä¸»åè°ƒå¤šä¸ªå·¥å…·å®Œæˆé—­ç¯ã€‚</p>
<p><strong>AI å°±åƒå…¬å¸çš„ CEOï¼Œé€šè¿‡ MCP åè®®å‘å¤šä¸ªéƒ¨é—¨ï¼ˆMCP Serverï¼‰ä¸‹è¾¾å‘½ä»¤</strong></p>
<p>å¦‚æœä½ æƒ³å¾—åˆ°æ›´å®˜æ–¹çš„è§£é‡Šï¼Œå¯ä»¥å»å®˜ç½‘<a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2Fdocs%2Fgetting-started%2Fintro" target="_blank" title="https://modelcontextprotocol.io/docs/getting-started/intro" ref="nofollow noopener noreferrer">What is the Model Context Protocol (MCP)?</a></p>
<h2 data-id="heading-3">äºŒã€ä»€ä¹ˆæ˜¯ Playwrightï¼Ÿ</h2>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fplaywright.nodejs.cn%2F" target="_blank" title="https://playwright.nodejs.cn/" ref="nofollow noopener noreferrer">Playwright</a></strong> æ˜¯ç”± Microsoft å¼€å‘çš„ <strong>ç°ä»£åŒ–ç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰Web æµ‹è¯•å·¥å…·</strong>ï¼Œç”¨äºè‡ªåŠ¨åŒ– Chromiumã€WebKit å’Œ Firefox æµè§ˆå™¨çš„ Node.js/Python/Java/.NET åº“ã€‚</p>
<p>ä½†æ˜¯ç”±äº <strong>AI + MCP</strong> çš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ç²¾é€šè¿™ä¸ªå·¥å…·ï¼ŒæŠŠäº‹æƒ…äº¤ç»™AIï¼Œè®©æˆ‘ä»¬æ›´æ³¨é‡äºåŠŸèƒ½ã€‚</p>
<h2 data-id="heading-4">ä¸‰ã€MCP + Playwright çš„ååŒ</h2>
<p>ä¸‹è¿°ç¤ºä¾‹éƒ½æ˜¯é€šè¿‡ä½¿ç”¨ Trae æ¥å®ç°çš„</p>
<h3 data-id="heading-5">å‰æœŸå·¥ä½œï¼š</h3>
<p>æ‰“å¼€æˆ‘ä»¬çš„ <strong>Trae</strong> ç¼–è¾‘å™¨</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc0e072cdb764925bb62e240922b2798~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=ha7hnjUKnBlq5zdJx6eelvtYysU%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨è®¾ç½®é¡µé¢æ‰¾åˆ° MCP</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3895986df5a41a5849509f98f62dcf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=GGN1nB6TnF3Bi9ZcuSBc1jyNwq0%3D" alt="image.png" loading="lazy"/></p>
<p>ç‚¹å‡»å³è¾¹çš„ <strong>æ·»åŠ </strong> æŒ‰é’®ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•æ·»åŠ ï¼Œ<strong>ä»å¸‚åœºæ·»åŠ  / æ‰‹åŠ¨æ·»åŠ </strong>ï¼Œè¿™é‡Œæˆ‘ä»¬ç‚¹å‡»ä»å¸‚åœºæ·»åŠ å³å¯</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16ff7bfae4054c328826d0650c8eab7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=x2Si4lUB0IE9Ba%2F7zFKSyezTgOU%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨å¸‚åœºè¿™é‡Œå¯ä»¥æ·»åŠ ä»»ä½•ä½ éœ€è¦çš„ <strong>MCP Server</strong>ï¼Œå¹¶ä¸”å¯ä»¥è¾“å…¥ä½ éœ€è¦é…ç½®çš„ MCP Server ä¿¡æ¯ã€‚è¿™é‡Œæˆ‘ä»¬æ·»åŠ  <code>playwright</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a41ef842a6f47fe87bc4d1559d74f77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=PdZis9IKBSUyh9mnsZGO4ibbAE8%3D" alt="2025-12-15.gif" loading="lazy"/></p>
<p>å®‰è£…å¥½åå›åˆ°ä¸»é¡µé¢ä¸Šï¼Œåœ¨ TRAE æ™ºèƒ½ä½“èŠå¤©æ¡†ä¸­é€‰æ‹© <code>@Builder with MCP</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/117d264a3cc74bc599a9c56ab6c4ba37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=2qYRBHdMhD0IQmHlHE2qvfkGoFI%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>æ³¨ï¼š</p>
<p>ä¸è¦å¿˜è®° playwright åªé€‚é… Chromiumã€WebKit å’Œ Firefoxæµè§ˆå™¨ï¼Œå„ä½åªéœ€æå‰å®‰è£…å¥½å…¶ä¸€å³å¯</p>
</blockquote>
<h3 data-id="heading-6">ç¤ºä¾‹ä¸€ï¼šè®© AI è‡ªåŠ¨è®¿é—®é¡µé¢</h3>
<p>ç»™ AI æç¤ºè¯ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">è¯·å¸®æˆ‘æµ‹è¯•æ˜é‡‘ç½‘ç«™çš„æ’ä»¶é¡µé¢ï¼š
<span class="hljs-bullet">    1.</span> æ‰“å¼€ https://juejin.cn/
<span class="hljs-bullet">    2.</span> ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„"æ’ä»¶"æŒ‰é’®
<span class="hljs-bullet">    3.</span> ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
<span class="hljs-bullet">    4.</span> æˆªå›¾å¹¶ä¿å­˜åˆ°å½“å‰ç›®å½•
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b6fc7eea1524e49a3b03d1463358e6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=25oMtNgfLETI8vJDGE3TG3yyc7o%3D" alt="image.png" loading="lazy"/></p>
<p>æœ€åå®ç°ç»“æœï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22aa8f38bc5c4056a06bca6dc681fe8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=jWzCGeVq1FR433W5ea%2FPeqF3vQU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">ç¤ºä¾‹äºŒï¼šè®© AI è‡ªåŠ¨æµ‹è¯•é¡µé¢</h3>
<p>ç°åœ¨æˆ‘testæ–‡ä»¶å¤¹ä¸‹æœ‰ä¸€ä¸ª <code>1.html</code>æ–‡ä»¶ï¼Œç»™ AI æç¤ºè¯è®©å®ƒå¸®æˆ‘æµ‹è¯•é¡µé¢çš„åŸºæœ¬æ•ˆæœã€‚</p>
<pre><code class="hljs language-markdown" lang="markdown">è¯·ç¡®è®¤ 1.html æ–‡ä»¶çš„ä»¥ä¸‹èƒ½åŠ›ï¼š
<span class="hljs-bullet">    1.</span> æµ‹è¯•æ˜¯å¦èƒ½æ­£ç¡®é€šè¿‡æ–‡ä»¶è·¯å¾„åŠ è½½æœ¬åœ° HTMLã€‚
<span class="hljs-bullet">    2.</span> æµ‹è¯• fillå’Œclickæ˜¯å¦ç²¾å‡†ã€‚
<span class="hljs-bullet">    3.</span> é€šè¿‡éªŒè¯ç»“æœæ–‡æœ¬ï¼Œç¡®ä¿é¡µé¢é€»è¾‘æ­£å¸¸è¿è¡Œä¸”è¢«æµ‹è¯•å·¥å…·æ­£ç¡®æ•è·ã€‚
<span class="hljs-bullet">    4.</span> é€šè¿‡æˆªå›¾æä¾›æœ€ç»ˆçš„è§†è§‰è¯æ®ã€‚
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a3f6f41c8ff4f859aa2eb8727f97e57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=ke4gSzoD67v0w0GzpjCZF06VT1U%3D" alt="åŠ¨ç”».gif" loading="lazy"/></p>
<h2 data-id="heading-8">å››ã€è¿™ä»£è¡¨æœªæ¥</h2>





















<table><thead><tr><th>ä¼ ç»Ÿå¼€å‘</th><th>AI + MCP + Playwright</th></tr></thead><tbody><tr><td>å†™ä»£ç  â†’ æ‰‹åŠ¨æµ‹è¯• â†’ è°ƒè¯• â†’ ä¿®å¤</td><td>æè¿°éœ€æ±‚ â†’ AI ç”Ÿæˆ + è‡ªåŠ¨æµ‹è¯• + è‡ªåŠ¨ä¿®å¤</td></tr><tr><td>æµ‹è¯•æ˜¯â€œäº‹åâ€è¡Œä¸º</td><td>æµ‹è¯•æ˜¯â€œå†…å»ºâ€èƒ½åŠ›</td></tr><tr><td>äººåšæœºæ¢°æ€§éªŒè¯</td><td>AI åšé—­ç¯éªŒè¯</td></tr></tbody></table>
<blockquote>
<p>è¿™æ­£æ˜¯ <strong>â€œAgentic AIâ€ï¼ˆæ™ºèƒ½ä½“å¼å¼€å‘ï¼‰</strong> çš„æ ¸å¿ƒï¼šAI ä¸å†åªæ˜¯ç”Ÿæˆä»£ç ï¼Œè€Œæ˜¯èƒ½<strong>è‡ªä¸»æ‰§è¡Œã€éªŒè¯ã€è¿­ä»£</strong>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šOPA é›†æˆæŒ‡å—ï¼šä»åŸç†åˆ°å®è·µ]]></title>    <link>https://juejin.cn/post/7583906870827646985</link>    <guid>https://juejin.cn/post/7583906870827646985</guid>    <pubDate>2025-12-15T12:34:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906870827646985" data-draft-id="7583906870827630601" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šOPA é›†æˆæŒ‡å—ï¼šä»åŸç†åˆ°å®è·µ"/> <meta itemprop="keywords" content="åç«¯,Go"/> <meta itemprop="datePublished" content="2025-12-15T12:34:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å–µä¸ªå’ª"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šOPA é›†æˆæŒ‡å—ï¼šä»åŸç†åˆ°å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å–µä¸ªå’ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:34:41.000Z" title="Mon Dec 15 2025 12:34:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šOPA é›†æˆæŒ‡å—ï¼šä»åŸç†åˆ°å®è·µ</h2>
<p>Open Policy Agentï¼ˆç®€ç§° OPAï¼‰æ˜¯ä¸€æ¬¾å¼€æºçš„é€šç”¨ç­–ç•¥å¼•æ“ï¼Œæ ¸å¿ƒä»·å€¼åœ¨äºå®ç°â€œç­–ç•¥å³ä»£ç â€ï¼ˆPolicy as Codeï¼‰ï¼Œå°†åˆ†æ•£åœ¨å„ç³»ç»Ÿä¸­çš„æƒé™æ§åˆ¶ã€èµ„æºè®¿é—®è§„åˆ™ç­‰ç­–ç•¥é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œè¿›è¡Œç»Ÿä¸€ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ä¸æ‰§è¡Œã€‚å¦‚ä»Šï¼ŒOPA å·²æˆä¸ºäº‘åŸç”Ÿç”Ÿæ€ä¸­ç­–ç•¥ç®¡æ§çš„äº‹å®æ ‡å‡†ï¼Œè¢« Netflixã€Cloudflareã€Pinterestã€Chef ç­‰å·¨å¤´å¹¿æ³›åº”ç”¨â€”â€”ä»å†…éƒ¨ API æƒé™ç®¡æ§ã€Kubernetes é›†ç¾¤èµ„æºè°ƒåº¦ï¼Œåˆ°ç»ˆç«¯äº§å“çš„ IAM åŠŸèƒ½å®ç°ï¼Œå‡èƒ½çœ‹åˆ°å…¶èº«å½±ã€‚</p>
<p>OPA ç”± Styra å…¬å¸äº 2016 å¹´å¼€æºï¼Œ2018 å¹´åŠ å…¥ CNCFï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰æˆä¸ºæ²™ç®±é¡¹ç›®ï¼Œ2021 å¹´ 2 æœˆæ­£å¼æ¯•ä¸šï¼Œå…¶å¿«é€Ÿæ™‹å‡çš„èƒŒåï¼Œæ˜¯ç¤¾åŒºçš„é«˜åº¦æ´»è·ƒä¸è¡Œä¸šå¯¹ç»Ÿä¸€ç­–ç•¥ç®¡æ§éœ€æ±‚çš„è¿«åˆ‡æ€§ã€‚æœ¬æ–‡å°†ä» OPA æ ¸å¿ƒåŸç†ã€Rego è¯­è¨€å…¥é—¨ï¼Œé€æ­¥æ·±å…¥åˆ° GoWind Admin ä¼ä¸šçº§ä¸­åå°æ¡†æ¶çš„å®Œæ•´é›†æˆæµç¨‹ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿè½åœ°æƒé™ç®¡æ§èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€æ·±å…¥ç†è§£ OPAï¼šæ ¸å¿ƒåŸç†ä¸æ ¸å¿ƒæ¦‚å¿µ</h3>
<p>åœ¨é›†æˆ OPA ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå˜æ¸…å…¶æ ¸å¿ƒé€»è¾‘ï¼šOPA ä¸å…³å¿ƒâ€œè°åœ¨è®¿é—®â€ï¼ˆè®¤è¯ï¼ŒAuthenticationï¼‰ï¼Œåªä¸“æ³¨äºâ€œèƒ½å¦è®¿é—®â€ï¼ˆæˆæƒï¼ŒAuthorizationï¼‰åŠæ›´å¹¿æ³›çš„ç­–ç•¥å†³ç­–ï¼ˆå¦‚èµ„æºéƒ¨ç½²è§„åˆ™ã€ç½‘ç»œè·¯ç”±é™åˆ¶ç­‰ï¼‰ã€‚å®ƒé€šè¿‡æ¥æ”¶è¾“å…¥ã€ç»“åˆå¤–éƒ¨æ•°æ®ã€æ‰§è¡Œé¢„å®šä¹‰ç­–ç•¥ï¼Œæœ€ç»ˆè¾“å‡ºå†³ç­–ç»“æœï¼Œå®ç°ç­–ç•¥ä¸ä¸šåŠ¡ç³»ç»Ÿçš„è§£è€¦ã€‚</p>
<h4 data-id="heading-2">1.1 æ ¸å¿ƒæ¦‚å¿µï¼šå››å¤§æ ¸å¿ƒè¦ç´ </h4>
<p>å®è§‚ä¸Šï¼ŒOPA çš„å†³ç­–è¿‡ç¨‹ä¾èµ–å››ä¸ªæ ¸å¿ƒè¦ç´ ï¼Œå››è€…æ„æˆå®Œæ•´çš„ç­–ç•¥æ‰§è¡Œé—­ç¯ï¼Œåœ¨ OPA å®˜æ–¹è¯•ç‚¼åœºï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.openpolicyagent.org" target="_blank" title="https://play.openpolicyagent.org" ref="nofollow noopener noreferrer">play.openpolicyagent.org</a>ï¼‰ä¸­å¯ç›´è§‚éªŒè¯å…¶äº¤äº’é€»è¾‘ï¼š</p>
<ul>
<li><strong>è¯·æ±‚è¾“å…¥ï¼ˆRequest Inputï¼‰</strong>ï¼šè§¦å‘ç­–ç•¥å†³ç­–çš„è¯·æ±‚æ•°æ®ï¼Œé€šå¸¸åŒ…å«è®¿é—®ä¸»ä½“ã€è®¿é—®èµ„æºã€è®¿é—®æ“ä½œç­‰å…³é”®ä¿¡æ¯ï¼Œæ ¼å¼ä¸º JSONã€‚</li>
<li><strong>å¤–éƒ¨æ•°æ®ï¼ˆDataï¼‰</strong>ï¼šç­–ç•¥æ‰§è¡Œæ‰€éœ€çš„è¡¥å……æ•°æ®ï¼ˆéè¯·æ±‚è‡ªå¸¦ï¼‰ï¼Œå¦‚ç”¨æˆ·è§’è‰²åˆ—è¡¨ã€èµ„æºæƒé™æ˜ å°„è¡¨ç­‰ï¼Œå¯é€šè¿‡ OPA çš„æ•°æ® API åŠ¨æ€æ³¨å…¥ã€‚</li>
<li><strong>Rego ç­–ç•¥ï¼ˆPolicyï¼‰</strong>ï¼šä½¿ç”¨ OPA ä¸“ç”¨çš„å£°æ˜å¼ DSL è¯­è¨€ Rego ç¼–å†™çš„ç­–ç•¥è§„åˆ™ï¼Œå®šä¹‰â€œä½•ç§æ¡ä»¶ä¸‹å…è®¸/æ‹’ç»æŸä¸ªæ“ä½œâ€ã€‚</li>
<li><strong>å“åº”æ•°æ®ï¼ˆResponseï¼‰</strong>ï¼šç­–ç•¥æ‰§è¡Œåçš„å†³ç­–ç»“æœï¼Œå¯æ˜¯ç®€å•çš„ true/falseï¼ˆå…è®¸/æ‹’ç»ï¼‰ï¼Œä¹Ÿå¯æ˜¯å¤æ‚çš„ JSON ç»“æ„ï¼ˆå¦‚è¿”å›å…è®¸çš„èµ„æºåˆ—è¡¨ã€æ‹’ç»åŸå› ç­‰ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-3">1.2 å¾®è§‚è§†è§’ï¼šè¯·æ±‚è¾“å…¥çš„ä¸‰å…ƒç»„æ¨¡å‹</h4>
<p>ä»»ä½•è®¿é—®æ§åˆ¶ç±»çš„ç­–ç•¥å†³ç­–ï¼Œå…¶è¾“å…¥æœ¬è´¨ä¸Šéƒ½å¯æŠ½è±¡ä¸ºâ€œä¸»ä½“-èµ„æº-æ“ä½œâ€çš„ä¸‰å…ƒç»„æ¨¡å‹ï¼š</p>
<ol>
<li>è®¿é—®å®ä½“ï¼ˆSubjectï¼‰ï¼šå‘èµ·è®¿é—®çš„ä¸»ä½“ï¼Œå¦‚ç”¨æˆ· IDã€è§’è‰²ã€ç”¨æˆ·ç»„ç­‰ï¼›</li>
<li>è®¿é—®èµ„æºï¼ˆObjectï¼‰ï¼šè¢«è®¿é—®çš„å¯¹è±¡ï¼Œå¦‚ API æ¥å£ã€æ•°æ®åº“è¡¨ã€K8s èµ„æºç­‰ï¼›</li>
<li>è®¿é—®æ–¹æ³•ï¼ˆActionï¼‰ï¼šå…·ä½“çš„æ“ä½œç±»å‹ï¼Œå¦‚ HTTP çš„ GET/POST/PUT/DELETEï¼Œæˆ–æ•°æ®åº“çš„æŸ¥è¯¢/ä¿®æ”¹ç­‰ã€‚</li>
</ol>
<p>è¿™ä¸€æ¨¡å‹ä¸ Casbin é«˜åº¦ç›¸ä¼¼ï¼Œä½†ä¸¤è€…æ ¸å¿ƒå·®å¼‚åœ¨äºç­–ç•¥æè¿°èƒ½åŠ›ï¼šCasbin é‡‡ç”¨ç®€æ´çš„è¡¨è¾¾å¼æ¨¡å‹ï¼Œé€‚åˆç®€å•æƒé™åœºæ™¯ï¼›è€Œ OPA çš„ Rego ä½œä¸ºå®Œæ•´çš„ DSL è¯­è¨€ï¼Œæ”¯æŒå¤æ‚çš„é€»è¾‘åˆ¤æ–­ã€æ•°æ®è½¬æ¢ã€å‡½æ•°è°ƒç”¨ï¼Œèƒ½åº”å¯¹ä¼ä¸šçº§å¤æ‚ç­–ç•¥éœ€æ±‚ï¼ˆå¦‚å¤šç»´åº¦æƒé™å åŠ ã€åŠ¨æ€æ•°æ®å…³è”æ ¡éªŒç­‰ï¼‰ã€‚</p>
<h3 data-id="heading-4">äºŒã€Rego è¯­è¨€å…¥é—¨ï¼šä»åŸºç¡€è¯­æ³•åˆ°å®Œæ•´è§„åˆ™</h3>
<p>Rego æ˜¯ OPA çš„æ ¸å¿ƒï¼Œä¸“ä¸ºç­–ç•¥ç¼–å†™è®¾è®¡ï¼Œå…·æœ‰å£°æ˜å¼ã€æ˜“è¯»æ˜“å†™çš„ç‰¹ç‚¹ã€‚å®ƒçµæ„Ÿæºè‡ª Datalog æŸ¥è¯¢è¯­è¨€ï¼Œæ‰©å±•äº†å¯¹ JSON ç»“æ„åŒ–æ•°æ®çš„æ”¯æŒï¼Œå¯è½»æ¾å¤„ç†åµŒå¥—å¯¹è±¡ã€æ•°ç»„ç­‰å¸¸è§æ•°æ®æ ¼å¼ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒè¯­æ³•å…¥æ‰‹ï¼Œé€æ­¥æ„å»ºå®Œæ•´çš„ç­–ç•¥è§„åˆ™ã€‚</p>
<h4 data-id="heading-5">2.1 åŸºç¡€è¯­æ³•ï¼šå˜é‡ä¸èµ‹å€¼</h4>
<p>Rego ä¸­çš„å˜é‡ä¸€æ—¦èµ‹å€¼ä¾¿ä¸å¯ä¿®æ”¹ï¼ˆä¸å¯å˜å˜é‡ï¼‰ï¼Œæ”¯æŒæ ‡é‡ã€å¤åˆç±»å‹ï¼ˆå¯¹è±¡ã€æ•°ç»„ã€é›†åˆï¼‰ç­‰å¤šç§æ•°æ®ç±»å‹ï¼Œèµ‹å€¼ä½¿ç”¨ <code>:=</code> ç¬¦å·ï¼š</p>
<pre><code class="hljs language-rego" lang="rego"># æ ‡é‡èµ‹å€¼ï¼šå­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼ã€ç©ºå€¼
greeting   := "Hello"
max_height := 42
pi         := 3.14159
allowed    := true
location   := null

# å¤åˆç±»å‹èµ‹å€¼
rect := {"width": 2, "height": 4}  # å¯¹è±¡ï¼šé”®å€¼å¯¹é›†åˆ
allowed_users := ["papaya", "potato"]  # æ•°ç»„ï¼šæœ‰åºå…ƒç´ é›†åˆ
ips_by_port := {  # åµŒå¥—å¯¹è±¡ï¼šé”®ä¸ºæ•´æ•°ï¼Œå€¼ä¸ºæ•°ç»„
    80: ["1.1.1.1", "1.1.1.2"],
    443: ["2.2.2.1"],
}
</code></pre>
<h4 data-id="heading-6">2.2 é€»è¾‘åˆ¤æ–­ï¼šæ¡ä»¶ä¸å†³ç­–å—</h4>
<p>Rego çš„ç­–ç•¥è§„åˆ™æœ¬è´¨æ˜¯â€œæ¡ä»¶åˆ¤æ–­â€ï¼Œé€šè¿‡ <code>if</code> å…³é”®å­—æˆ–çœç•¥ <code>if</code> çš„å†³ç­–å—å®šä¹‰â€œä½•æ—¶æ»¡è¶³ç­–ç•¥â€ã€‚æ ¸å¿ƒé€»è¾‘è¿ç®—ç¬¦æ”¯æŒ <code>==</code>ã€<code>!=</code>ã€<code>&gt;</code>ã€<code>&lt;</code> ç­‰ï¼Œé€»è¾‘å…³ç³»é€šè¿‡è¯­æ³•ç»“æ„è¡¨è¾¾ï¼š</p>
<pre><code class="hljs language-rego" lang="rego"># åŸºç¡€æ¡ä»¶åˆ¤æ–­ï¼ˆä¸¤ç§å†™æ³•ç­‰ä»·ï¼‰
v if "hello" == "world"  # æ¡ä»¶ä¸æ»¡è¶³ï¼Œv ä¸º false
t2 if {                  # å¤šè¡Œå†³ç­–å—ï¼Œå†…éƒ¨è¯­å¥éœ€å…¨éƒ¨æ»¡è¶³
    x := 42
    y := 41
    x &gt; y                # æ¡ä»¶æ»¡è¶³ï¼Œt2 ä¸º true
}

# çœç•¥ if å…³é”®å­—çš„ç®€æ´å†™æ³•ï¼ˆæ¨èï¼‰
v { "hello" == "world" }  # ç­‰ä»·äºä¸Šè¿° v çš„å®šä¹‰
t2 {
    x := 42
    y := 41
    x &gt; y
}

# é€»è¾‘ ANDï¼šåˆ†å·åˆ†éš”æˆ–å¤šè¡Œåˆ†éš”ï¼ˆä¸¤ç§å†™æ³•ç­‰ä»·ï¼‰
# éœ€åŒæ—¶æ»¡è¶³â€œæœåŠ¡å™¨IDä¸ºappâ€å’Œâ€œåè®®ä¸ºhttpsâ€
valid_server {
    input.servers[0].id == "app"
    input.servers[0].protocols[0] == "https"
}
# ç­‰ä»·äºï¼šinput.servers[0].id == "app"; input.servers[0].protocols[0] == "https"

# é€»è¾‘ ORï¼šå¤šä¸ªåŒåå†³ç­–å—ï¼ˆä»»ä¸€æ»¡è¶³å³å¯ï¼‰
# æ»¡è¶³â€œæ˜¯ç®¡ç†å‘˜â€æˆ–â€œç«¯ç‚¹å…¬å¼€â€å³å…è®¸è®¿é—®
allow {
    is_admin
}
allow {
    is_endpoint_public
}
</code></pre>
<h4 data-id="heading-7">2.3 è¿­ä»£éå†ï¼šsome ä¸ every</h4>
<p>Rego æä¾›<code>some</code>ï¼ˆå­˜åœ¨æ€§éå†ï¼‰å’Œ <code>every</code>ï¼ˆå…¨ç§°éå†ï¼‰å…³é”®å­—ï¼Œç”¨äºå¤„ç†æ•°ç»„ã€å¯¹è±¡ç­‰å¯è¿­ä»£æ•°æ®ï¼Œæ”¯æŒç´¢å¼•<code>+</code>å€¼çš„åŒé‡éå†ï¼Œä¹Ÿå¯é€šè¿‡ä¸‹åˆ’çº¿ <code>_</code> å¿½ç•¥æ— å…³æ•°æ®ï¼š</p>
<pre><code class="hljs language-rego" lang="rego"># 1. æ•°ç»„éå†ï¼šsome å…³é”®å­—
arr := [1, 2, 3]
has_even {
    some val in arr  # éå†æ•°ç»„ä¸­çš„å€¼
    val % 2 == 0     # å­˜åœ¨å¶æ•°å³æ»¡è¶³
}

# 2. ç´¢å¼•+å€¼éå†
has_index_1 {
    some i, val in arr  # i ä¸ºç´¢å¼•ï¼Œval ä¸ºå¯¹åº”å€¼
    i == 1 &amp;&amp; val == 2  # ç´¢å¼•1å¯¹åº”å€¼ä¸º2å³æ»¡è¶³
}

# 3. å¯¹è±¡éå†ï¼ševery å…³é”®å­—ï¼ˆæ‰€æœ‰å…ƒç´ éœ€æ»¡è¶³æ¡ä»¶ï¼‰
valid_obj {
    every k, v in {"foo": "bar", "fox": "baz"} {
        startswith(k, "f")  # æ‰€æœ‰é”®ä»¥få¼€å¤´
        startswith(v, "b")  # æ‰€æœ‰å€¼ä»¥bå¼€å¤´
    }
}

# 4. é€šé…ç¬¦ _ï¼šå¿½ç•¥æ— å…³æ•°æ®
get_project_id {
    proj = input.projects[_]  # å–ä»»æ„ä¸€ä¸ªé¡¹ç›®
    id := proj.id             # è·å–é¡¹ç›®ID
}
</code></pre>
<h4 data-id="heading-8">2.4 å‡½æ•°å®šä¹‰ï¼šè‡ªå®šä¹‰ç­–ç•¥é€»è¾‘</h4>
<p>Rego æ”¯æŒè‡ªå®šä¹‰å‡½æ•°ï¼Œç”¨äºå°è£…å¯å¤ç”¨çš„ç­–ç•¥é€»è¾‘ï¼Œæ ¸å¿ƒç‰¹ç‚¹ï¼š</p>
<ul>
<li>é»˜è®¤è¿”å› <code>true/false</code>ï¼Œä¹Ÿå¯æ˜¾å¼æŒ‡å®šè¿”å›å€¼ï¼›</li>
<li>æ”¯æŒåŒåå‡½æ•°é‡è½½ï¼Œä½†å‚æ•°æ•°é‡å¿…é¡»ä¸€è‡´ï¼›</li>
<li>è¾“å…¥ç›¸åŒåˆ™è¾“å‡ºå¿…ç›¸åŒï¼ˆçº¯å‡½æ•°ç‰¹æ€§ï¼Œç¡®ä¿ç­–ç•¥æ‰§è¡Œçš„ä¸€è‡´æ€§ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-rego" lang="rego"># 1. æ— è¿”å›å€¼å‡½æ•°ï¼ˆé»˜è®¤è¿”å›true/falseï¼‰
# åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸ºé…ç½®æ–‡ä»¶ï¼ˆæ»¡è¶³ä»»ä¸€åç¼€å³è¿”å›trueï¼‰
is_config_file(str) {
  contains(str, ".yaml")
}
is_config_file(str) {
  contains(str, ".yml")
}
is_config_file(str) {
  contains(str, ".json")
}

# 2. ç”¨ else åˆå¹¶åŒåå‡½æ•°ï¼ˆç­‰ä»·äºä¸Šè¿°å†™æ³•ï¼Œæ›´ç®€æ´ï¼‰
is_config_file2(str) {
  contains(str, ".yaml")
} else {
  contains(str, ".yml")
} else {
  contains(str, ".json")
}

# 3. æ˜¾å¼è¿”å›å€¼å‡½æ•°
# è‡ªå®šä¹‰åŠ æ³•å‡½æ•°ï¼Œè¿”å› a + b çš„ç»“æœ
plus_custom(a, b) := c {
    c := a + b
}
out := plus_custom(42, 43)  # out ç»“æœä¸º 85
</code></pre>
<h4 data-id="heading-9">2.5 å®Œæ•´ç­–ç•¥ç¤ºä¾‹ï¼šRBAC æƒé™æ§åˆ¶</h4>
<p>ç»“åˆä¸Šè¿°è¯­æ³•ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªç»å…¸çš„ RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰ç­–ç•¥ï¼Œå®šä¹‰â€œGET è¯·æ±‚æ”¾è¡Œã€ç®¡ç†å‘˜åŠç®¡ç†å‘˜ç»„ç”¨æˆ·å…¨æ”¾è¡Œâ€çš„è§„åˆ™ï¼š</p>
<pre><code class="hljs language-rego" lang="rego">package authz  # å®šä¹‰ç­–ç•¥åŒ…ï¼ˆç±»ä¼¼å‘½åç©ºé—´ï¼Œé¿å…å†²çªï¼‰

default allow = false  # é»˜è®¤æ‹’ç»æ‰€æœ‰è®¿é—®

# è§„åˆ™1ï¼šæ”¾è¡Œæ‰€æœ‰ GET è¯·æ±‚
allow {
    input.method == "GET"
}

# è§„åˆ™2ï¼šå…è®¸ admin ç”¨æˆ·æ‰§è¡Œä»»ä½•æ“ä½œ
allow {
    input.user == "admin"
}

# è§„åˆ™3ï¼šå…è®¸ admin ç”¨æˆ·ç»„ä¸­çš„ç”¨æˆ·æ‰§è¡Œä»»ä½•æ“ä½œ
allow {
    input.group[_] == "admin"  # éå†ç”¨æˆ·ç»„ï¼Œå­˜åœ¨adminå³æ»¡è¶³
}
</code></pre>
<h5 data-id="heading-10">ç­–ç•¥æµ‹è¯•</h5>
<p>è¾“å…¥ä»¥ä¸‹è¯·æ±‚æ•°æ®ï¼ˆæ¨¡æ‹Ÿç”¨æˆ· <code>user1</code> å±äº <code>dev</code> å’Œ <code>admin</code> ç»„ï¼‰ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"user"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"group"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"dev"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"admin"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>OPA æ‰§è¡Œåè¾“å‡ºå†³ç­–ç»“æœï¼ˆæ»¡è¶³è§„åˆ™3ï¼Œå…è®¸è®¿é—®ï¼‰ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"allow"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-11">2.6 å•å…ƒæµ‹è¯•ï¼šç¡®ä¿ç­–ç•¥æ­£ç¡®æ€§</h4>
<p>Rego åŸç”Ÿæ”¯æŒå•å…ƒæµ‹è¯•ï¼Œæµ‹è¯•æ–‡ä»¶å‘½åéœ€éµå¾ª <code>xxx_test.rego</code> è§„èŒƒï¼ˆä¸ Go è¯­è¨€ä¸€è‡´ï¼‰ï¼Œé€šè¿‡ <code>with</code> å…³é”®å­—æ¨¡æ‹Ÿè¾“å…¥æ•°æ®ï¼ŒéªŒè¯ç­–ç•¥æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</p>
<h5 data-id="heading-12">æµ‹è¯•ç¤ºä¾‹</h5>
<p>åˆ›å»ºæµ‹è¯•æ–‡ä»¶<code>authz_test.rego</code>ï¼š</p>
<pre><code class="hljs language-rego" lang="rego">package authz  # ä¸è¢«æµ‹ç­–ç•¥åŒ…ä¸€è‡´
import future.keywords  # å¼•å…¥æœªæ¥å…³é”®å­—ï¼ˆå¯é€‰ï¼Œå¢å¼ºè¯­æ³•å…¼å®¹æ€§ï¼‰

# æµ‹è¯•ç”¨ä¾‹1ï¼šGET è¯·æ±‚åº”è¢«å…è®¸
test_get_allowed if {
    allow with input as {"user": "user1", "method": "GET"}
}

# æµ‹è¯•ç”¨ä¾‹2ï¼šadmin ç”¨æˆ·åº”è¢«å…è®¸
test_admin_allowed if {
    allow with input as {"user": "admin", "method": "POST"}
}

# æµ‹è¯•ç”¨ä¾‹3ï¼šé admin é GET è¯·æ±‚åº”è¢«æ‹’ç»
test_non_admin_non_get_denied if {
    not allow with input as {"user": "user2", "method": "POST", "group": ["dev"]}
}
</code></pre>
<h5 data-id="heading-13">æ‰§è¡Œæµ‹è¯•</h5>
<p>åœ¨ç­–ç•¥æ–‡ä»¶æ‰€åœ¨ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹æµ‹è¯•ç»“æœï¼š</p>
<pre><code class="hljs language-shell" lang="shell">opa test . -v  # -v æ˜¾ç¤ºè¯¦ç»†æµ‹è¯•æ—¥å¿—
</code></pre>
<h5 data-id="heading-14">æµ‹è¯•è¾“å‡ºï¼ˆæˆåŠŸç¤ºä¾‹ï¼‰ï¼š</h5>
<pre><code class="hljs language-shell" lang="shell">authz_test.rego:
data.authz.test_get_allowed: PASS (522.5Âµs)
data.authz.test_admin_allowed: PASS (310.2Âµs)
data.authz.test_non_admin_non_get_denied: PASS (285.7Âµs)
--------------------------------------------------------------------------------
PASS: 3/3
</code></pre>
<h3 data-id="heading-15">ä¸‰ã€GoWind Admin é›†æˆ OPA å®Œæ•´æ­¥éª¤</h3>
<p>GoWind Admin å·²å°† OPA æ ¸å¿ƒé€»è¾‘å°è£…è‡³ &lt;github.com/tx7do/kratos-authz&gt; ç»„ä»¶ä¸­ï¼Œå¼€å‘è€…æ— éœ€é‡å¤å®ç°å¼•æ“åˆå§‹åŒ–ã€ç­–ç•¥åŠ è½½ç­‰åº•å±‚é€»è¾‘ï¼Œåªéœ€æŒ‰ä»¥ä¸‹æ­¥éª¤å®Œæˆé…ç½®ã€ä¾èµ–æ³¨å…¥ä¸ä¸­é—´ä»¶é›†æˆï¼Œå³å¯å¿«é€Ÿå¯ç”¨ OPA æƒé™ç®¡æ§ã€‚</p>
<h4 data-id="heading-16">3.1 æ ¸å¿ƒå°è£…ï¼šå®ç° Authorizer æƒé™ç®¡ç†å™¨</h4>
<p>é¦–å…ˆåœ¨ <code>app/admin/service/internal/data/authorizer.go</code> ä¸­å®ç°æƒé™ç®¡ç†å™¨ï¼Œå°è£… OPA å¼•æ“åˆå§‹åŒ–ã€ç­–ç•¥é‡ç½®ï¼ˆä»æ•°æ®åº“åŠ è½½è§’è‰²-API æƒé™æ˜ å°„ï¼‰ç­‰æ ¸å¿ƒèƒ½åŠ›ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/data/authorizer.go</span>

<span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"context"</span>
	<span class="hljs-string">"errors"</span>

	<span class="hljs-string">"github.com/go-kratos/kratos/v2/log"</span>

	authzEngine <span class="hljs-string">"github.com/tx7do/kratos-authz/engine"</span>
	<span class="hljs-string">"github.com/tx7do/kratos-authz/engine/casbin"</span>
	<span class="hljs-string">"github.com/tx7do/kratos-authz/engine/noop"</span>

	pagination <span class="hljs-string">"github.com/tx7do/go-crud/api/gen/go/pagination/v1"</span>
	<span class="hljs-string">"github.com/tx7do/go-utils/trans"</span>
	conf <span class="hljs-string">"github.com/tx7do/kratos-bootstrap/api/gen/go/conf/v1"</span>

	<span class="hljs-string">"go-wind-admin/app/admin/service/cmd/server/assets"</span>

	adminV1 <span class="hljs-string">"go-wind-admin/api/gen/go/admin/service/v1"</span>
	userV1 <span class="hljs-string">"go-wind-admin/api/gen/go/user/service/v1"</span>
)

<span class="hljs-comment">// Authorizer æƒé™ç®¡ç†å™¨</span>
<span class="hljs-keyword">type</span> Authorizer <span class="hljs-keyword">struct</span> {
	log *log.Helper

	roleRepo        *RoleRepo
	apiResourceRepo *ApiResourceRepo

	engine authzEngine.Engine
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAuthorizer</span><span class="hljs-params">(
	logger log.Logger,
	cfg *conf.Bootstrap,
	roleRepo *RoleRepo,
	apiResourceRepo *ApiResourceRepo,
)</span></span> *Authorizer {
	a := &amp;Authorizer{
		log:             log.NewHelper(log.With(logger, <span class="hljs-string">"module"</span>, <span class="hljs-string">"authorizer/repo/admin-service"</span>)),
		roleRepo:        roleRepo,
		apiResourceRepo: apiResourceRepo,
	}

	a.init(cfg)

	<span class="hljs-keyword">return</span> a
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> init(cfg *conf.Bootstrap) {
	a.engine = a.newEngine(cfg)

	<span class="hljs-keyword">if</span> err := a.ResetPolicies(context.Background()); err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"reset policies error: %v"</span>, err)
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> newEngine(cfg *conf.Bootstrap) authzEngine.Engine {
	<span class="hljs-keyword">if</span> cfg.Authz == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	}

	ctx := context.Background()

	<span class="hljs-keyword">switch</span> cfg.GetAuthz().GetType() {
	<span class="hljs-keyword">default</span>:
		<span class="hljs-keyword">fallthrough</span>
	<span class="hljs-keyword">case</span> <span class="hljs-string">"noop"</span>:
		state, err := noop.NewEngine(ctx)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"new noop engine error: %v"</span>, err)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		}
		<span class="hljs-keyword">return</span> state

	<span class="hljs-keyword">case</span> <span class="hljs-string">"casbin"</span>:
		state, err := casbin.NewEngine(ctx)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"init casbin engine error: %v"</span>, err)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		}
		<span class="hljs-keyword">return</span> state
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> Engine() authzEngine.Engine {
	<span class="hljs-keyword">return</span> a.engine
}

<span class="hljs-comment">// ResetPolicies é‡ç½®ç­–ç•¥</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> ResetPolicies(ctx context.Context) <span class="hljs-type">error</span> {
	<span class="hljs-comment">//a.log.Info("*******************reset policies")</span>

	roles, err := a.roleRepo.List(ctx, &amp;pagination.PagingRequest{NoPaging: trans.Ptr(<span class="hljs-literal">true</span>)})
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"failed to list roles: %v"</span>, err)
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-keyword">if</span> roles == <span class="hljs-literal">nil</span> || <span class="hljs-built_in">len</span>(roles.Items) &lt; <span class="hljs-number">1</span> {
		a.log.Warnf(<span class="hljs-string">"no roles found to set policies"</span>)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// No roles to set policies</span>
	}

	apis, err := a.apiResourceRepo.List(ctx, &amp;pagination.PagingRequest{NoPaging: trans.Ptr(<span class="hljs-literal">true</span>)})
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"failed to list APIs: %v"</span>, err)
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-keyword">if</span> apis == <span class="hljs-literal">nil</span> || <span class="hljs-built_in">len</span>(apis.Items) &lt; <span class="hljs-number">1</span> {
		a.log.Warnf(<span class="hljs-string">"no APIs found to set policies for roles"</span>)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// No APIs to set policies</span>
	}

	<span class="hljs-comment">//a.log.Debugf("roles [%d] apis [%d]", len(roles.Items), len(apis.Items))</span>

	<span class="hljs-keyword">var</span> policies authzEngine.PolicyMap

	<span class="hljs-keyword">switch</span> a.engine.Name() {
	<span class="hljs-keyword">case</span> <span class="hljs-string">"casbin"</span>:
		<span class="hljs-keyword">if</span> policies, err = a.generateCasbinPolicies(roles, apis); err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"generate casbin policies error: %v"</span>, err)
			<span class="hljs-keyword">return</span> err
		}

	<span class="hljs-keyword">case</span> <span class="hljs-string">"noop"</span>:
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>

	<span class="hljs-keyword">default</span>:
		a.log.Warnf(<span class="hljs-string">"unknown engine name: %s"</span>, a.engine.Name())
		<span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">"unknown authz engine name"</span>)
	}

	<span class="hljs-comment">//a.log.Debugf("***************** policy rules len: %v", len(rules))</span>

	<span class="hljs-keyword">if</span> err = a.engine.SetPolicies(context.Background(), policies, <span class="hljs-literal">nil</span>); err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"set policies error: %v"</span>, err)
		<span class="hljs-keyword">return</span> err
	}
	a.log.Infof(<span class="hljs-string">"Reloaded policy rules"</span>)

	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// generateCasbinPolicies ç”Ÿæˆ Casbin ç­–ç•¥</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> generateCasbinPolicies(roles *userV1.ListRoleResponse, apis *adminV1.ListApiResourceResponse) (authzEngine.PolicyMap, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">var</span> rules []casbin.PolicyRule
	apiSet := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">uint32</span>]<span class="hljs-keyword">struct</span>{})

	domain := <span class="hljs-string">"*"</span>

	<span class="hljs-keyword">for</span> _, role := <span class="hljs-keyword">range</span> roles.Items {
		<span class="hljs-keyword">if</span> role.GetId() == <span class="hljs-number">0</span> {
			<span class="hljs-keyword">continue</span> <span class="hljs-comment">// Skip if role or API ID is not set</span>
		}

		<span class="hljs-keyword">for</span> _, apiId := <span class="hljs-keyword">range</span> role.GetApis() {
			apiSet[apiId] = <span class="hljs-keyword">struct</span>{}{}
		}

		<span class="hljs-keyword">for</span> _, api := <span class="hljs-keyword">range</span> apis.Items {
			<span class="hljs-keyword">if</span> api.GetId() == <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span> <span class="hljs-comment">// Skip if role or API ID is not set</span>
			}

			<span class="hljs-keyword">if</span> _, exists := apiSet[api.GetId()]; exists {
				rules = <span class="hljs-built_in">append</span>(rules, casbin.PolicyRule{
					PType: <span class="hljs-string">"p"</span>,
					V0:    role.GetCode(),
					V1:    api.GetPath(),
					V2:    api.GetMethod(),
					V3:    domain,
				})
			}
		}
	}

	policies := authzEngine.PolicyMap{
		<span class="hljs-string">"policies"</span>: rules,
		<span class="hljs-string">"projects"</span>: authzEngine.MakeProjects(),
	}

	<span class="hljs-keyword">return</span> policies, <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 data-id="heading-17">3.2 ä¾èµ–æ³¨å…¥ï¼šæ³¨å†Œ Authorizer åˆ° Wire å®¹å™¨</h4>
<p>GoWind Admin ä½¿ç”¨ Wire å®ç°ä¾èµ–æ³¨å…¥ï¼Œéœ€ä¿®æ”¹ <code>app/admin/service/internal/data/init.go</code>ï¼Œå°† <code>NewAuthorizer</code> æ³¨å†Œåˆ°ä¾èµ–å®¹å™¨ï¼Œç¡®ä¿æ¡†æ¶å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–æƒé™ç®¡ç†å™¨ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/data/init.go</span>

<span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/google/wire"</span>

<span class="hljs-comment">// ProviderSet æ•°æ®å±‚ä¾èµ–æ³¨å…¥é›†åˆ</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    NewAuthorizer,        <span class="hljs-comment">// æ³¨å†Œæƒé™ç®¡ç†å™¨ï¼ˆæ ¸å¿ƒï¼‰</span>
    NewRoleRepo,          <span class="hljs-comment">// æ³¨å†Œè§’è‰²æ•°æ®ä»“åº“</span>
    NewApiResourceRepo,   <span class="hljs-comment">// æ³¨å†Œ API èµ„æºæ•°æ®ä»“åº“</span>
    <span class="hljs-comment">// ... å…¶ä»–æ•°æ®ä»“åº“ï¼ˆå¦‚ç”¨æˆ·ä»“åº“ã€èœå•ä»“åº“ç­‰ï¼‰</span>
)
</code></pre>
<h4 data-id="heading-18">3.3 ä¸­é—´ä»¶é›†æˆï¼šåµŒå…¥ REST æœåŠ¡è¯·æ±‚é“¾è·¯</h4>
<p>å°† OPA æƒé™æ ¡éªŒä¸­é—´ä»¶åµŒå…¥ REST æœåŠ¡å™¨çš„è¯·æ±‚é“¾è·¯ï¼Œå®ç°å¯¹æ‰€æœ‰ API æ¥å£çš„æƒé™æ‹¦æˆªã€‚ä¿®æ”¹ <code>app/admin/service/internal/server/rest.go</code>ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/server/rest.go</span>

<span class="hljs-keyword">package</span> server

<span class="hljs-comment">// NewMiddleware åˆ›å»ºä¸­é—´ä»¶</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newRestMiddleware</span><span class="hljs-params">(
	logger log.Logger,
	authenticator authnEngine.Authenticator,
	authorizer *data.Authorizer,
)</span></span> []middleware.Middleware {
	<span class="hljs-keyword">var</span> ms []middleware.Middleware
	ms = <span class="hljs-built_in">append</span>(ms, logging.Server(logger))

	ms = <span class="hljs-built_in">append</span>(ms, selector.Server(
		authn.Server(authenticator),
		auth.Server(),
		authz.Server(authorizer.Engine()),
	).Match(newRestWhiteListMatcher()).Build())

	<span class="hljs-keyword">return</span> ms
}

<span class="hljs-comment">// NewRESTServer new an HTTP server.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRESTServer</span><span class="hljs-params">(
    cfg *conf.Bootstrap, logger log.Logger,
	authenticator authnEngine.Authenticator, authorizer *data.Authorizer,
)</span></span> {
    ...

	srv := rpc.CreateRestServer(cfg,
		newRestMiddleware(logger, authenticator, authorizer)...,
	)

    ...
}
</code></pre>
<h4 data-id="heading-19">3.4 é…ç½®å¯ç”¨ï¼šä¿®æ”¹ auth.yaml å¯ç”¨ OPA</h4>
<p>ä¿®æ”¹ <code>app/admin/service/configs/auth.yaml</code>ï¼Œå°†æƒé™å¼•æ“ç±»å‹è®¾ç½®ä¸º <code>opa</code>ï¼Œå¯ç”¨æƒé™æ ¡éªŒï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># app/admin/service/configs/auth.yaml</span>
<span class="hljs-comment"># è®¤è¯ä¸æˆæƒé…ç½®</span>
<span class="hljs-attr">auth:</span>
  <span class="hljs-comment"># è®¤è¯é…ç½®ï¼ˆå¦‚ JWTã€OAuth2 ç­‰ï¼Œæ ¹æ®å®é™…éœ€æ±‚é…ç½®ï¼‰</span>
  <span class="hljs-attr">authn:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">"jwt"</span>
    <span class="hljs-attr">jwt:</span>
      <span class="hljs-attr">secret:</span> <span class="hljs-string">"your-jwt-secret"</span>
      <span class="hljs-attr">expires_at:</span> <span class="hljs-number">3600</span>

<span class="hljs-comment"># æˆæƒé…ç½®ï¼ˆæ ¸å¿ƒï¼‰</span>
<span class="hljs-attr">authz:</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">"opa"</span>  <span class="hljs-comment"># å¯ç”¨ OPA å¼•æ“ï¼ˆå¯é€‰ï¼šopa/noopï¼‰</span>
  <span class="hljs-comment"># OPA é¢å¤–é…ç½®ï¼ˆå¯é€‰ï¼Œæ ¹æ®å®é™…éœ€æ±‚æ‰©å±•ï¼‰</span>
  <span class="hljs-comment"># opa:</span>
  <span class="hljs-comment">#   cache:  # ç­–ç•¥ç¼“å­˜é…ç½®</span>
  <span class="hljs-comment">#     enabled: true</span>
  <span class="hljs-comment">#     ttl: 300s  # ç¼“å­˜è¿‡æœŸæ—¶é—´</span>
  <span class="hljs-comment">#   watch: true  # ç›‘å¬ç­–ç•¥æ–‡ä»¶å˜åŒ–ï¼ŒåŠ¨æ€é‡è½½ï¼ˆå¼€å‘ç¯å¢ƒæ¨èï¼‰</span>
</code></pre>
<h4 data-id="heading-20">3.5 è‡ªå®šä¹‰æ¨¡å‹ï¼šå†…åµŒè‡ªå®šä¹‰ OPA ç­–ç•¥</h4>
<p>è‹¥é»˜è®¤çš„ RBAC ç­–ç•¥æ¨¡å‹ä¸æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼ˆå¦‚æ”¯æŒæ•°æ®æƒé™ã€å¤šç§Ÿæˆ·éš”ç¦»ç­‰ï¼‰ï¼Œå¯è‡ªå®šä¹‰ Rego ç­–ç•¥æ–‡ä»¶ï¼Œé€šè¿‡ Go å†…ç½®çš„ <code>//go:embed</code> æŒ‡ä»¤å†…åµŒåˆ°é¡¹ç›®ä¸­ï¼Œå®ç°ç­–ç•¥ä¸ç¨‹åºçš„ä¸€ä½“åŒ–éƒ¨ç½²ã€‚</p>
<h5 data-id="heading-21">æ­¥éª¤ 1ï¼šåˆ›å»ºè‡ªå®šä¹‰ç­–ç•¥æ–‡ä»¶</h5>
<p>åœ¨ <code>app/admin/service/cmd/server/assets/</code> ç›®å½•ä¸‹åˆ›å»º <code>opa_custom.rego</code>ï¼Œç¼–å†™è‡ªå®šä¹‰ç­–ç•¥ï¼ˆç¤ºä¾‹ï¼šæ”¯æŒå¤šç§Ÿæˆ·çš„ RBAC è§„åˆ™ï¼‰ï¼š</p>
<pre><code class="hljs language-rego" lang="rego">package authz

default allow = false

# è‡ªå®šä¹‰è§„åˆ™ï¼šç§Ÿæˆ·å†…ç®¡ç†å‘˜å¯è®¿é—®æ‰€æœ‰æ¥å£
allow {
    input.tenant_id != ""  # ç§Ÿæˆ·IDéç©º
    input.user_role == "tenant_admin"  # ç”¨æˆ·ä¸ºç§Ÿæˆ·ç®¡ç†å‘˜
}

# è‡ªå®šä¹‰è§„åˆ™ï¼šæ™®é€šç”¨æˆ·ä»…å¯è®¿é—®è‡ªèº«ç§Ÿæˆ·çš„èµ„æº
allow {
    input.tenant_id != ""
    input.user_role == "user"
    input.resource_tenant_id == input.tenant_id  # èµ„æºç§Ÿæˆ·IDä¸ç”¨æˆ·ç§Ÿæˆ·IDä¸€è‡´
    input.method == "GET"  # ä»…å…è®¸æŸ¥è¯¢æ“ä½œ
}

# è‡ªå®šä¹‰è§„åˆ™ï¼šè¶…çº§ç®¡ç†å‘˜å¿½ç•¥ç§Ÿæˆ·é™åˆ¶
allow {
    input.user_role == "super_admin"
}
</code></pre>
<h5 data-id="heading-22">æ­¥éª¤ 2ï¼šå†…åµŒç­–ç•¥æ–‡ä»¶</h5>
<p>ä¿®æ”¹ <code>app/admin/service/cmd/server/assets/assets.go</code>ï¼Œé€šè¿‡ <code>//go:embed</code> æŒ‡ä»¤å°†è‡ªå®šä¹‰ç­–ç•¥æ–‡ä»¶å†…åµŒåˆ°ç¨‹åºä¸­ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/cmd/server/assets/assets.go</span>
<span class="hljs-keyword">package</span> assets

<span class="hljs-keyword">import</span> _ <span class="hljs-string">"embed"</span>

<span class="hljs-comment">// å†…åµŒé»˜è®¤ RBAC ç­–ç•¥ï¼ˆåŸæœ‰ï¼‰</span>
<span class="hljs-comment">//go:embed opa_rbac.rego</span>
<span class="hljs-keyword">var</span> OpaRbacRego []<span class="hljs-type">byte</span>

<span class="hljs-comment">// å†…åµŒè‡ªå®šä¹‰ OPA ç­–ç•¥ï¼ˆæ–°å¢ï¼‰</span>
<span class="hljs-comment">//go:embed opa_custom.rego</span>
<span class="hljs-keyword">var</span> OpaCustomRego []<span class="hljs-type">byte</span>
</code></pre>
<h5 data-id="heading-23">æ­¥éª¤ 3ï¼šåŠ è½½è‡ªå®šä¹‰ç­–ç•¥</h5>
<p>ä¿®æ”¹ <code>Authorizer.newEngine</code> æ–¹æ³•ï¼ŒåŠ è½½å†…åµŒçš„è‡ªå®šä¹‰ç­–ç•¥æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"go-wind-admin/app/admin/service/cmd/server/assets"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> newEngine(cfg *conf.Bootstrap) authzEngine.Engine {
	<span class="hljs-keyword">switch</span> cfg.GetAuthz().GetType() {
	<span class="hljs-keyword">default</span>:
		<span class="hljs-keyword">fallthrough</span>

	<span class="hljs-keyword">case</span> <span class="hljs-string">"casbin"</span>:
		state, err := opa.NewEngine(ctx,
			opa.WithModulesFromString(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
				<span class="hljs-string">"custom.rego"</span>: <span class="hljs-type">string</span>(assets.OpaCustomRego),
			}),
		)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"init opa engine error: %v"</span>, err)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		}

		<span class="hljs-keyword">if</span> err = state.InitModulesFromString(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
			<span class="hljs-string">"custom.rego"</span>: <span class="hljs-type">string</span>(assets.OpaCustomRego),
		}); err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"init opa modules error: %v"</span>, err)
		}

		<span class="hljs-keyword">return</span> state
	}
}
</code></pre>
<h3 data-id="heading-24">å››ã€é¡¹ç›®èµ„æºä¸å‚è€ƒèµ„æ–™</h3>
<h4 data-id="heading-25">4.1 æ ¸å¿ƒé¡¹ç›®ä»“åº“</h4>
<ul>
<li>GoWind Adminï¼ˆGiteeï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://gitee.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">gitee.com/tx7do/go-wiâ€¦</a></li>
<li>GoWind Adminï¼ˆGitHubï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://github.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">github.com/tx7do/go-wiâ€¦</a></li>
<li>Kratos-Authzï¼ˆOPA/Casbin å°è£…ç»„ä»¶ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fkratos-authz" target="_blank" title="https://github.com/tx7do/kratos-authz" ref="nofollow noopener noreferrer">github.com/tx7do/kratoâ€¦</a></li>
<li>OPA å®˜æ–¹ä»“åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopen-policy-agent%2Fopa%2F" target="_blank" title="https://github.com/open-policy-agent/opa/" ref="nofollow noopener noreferrer">github.com/open-policyâ€¦</a></li>
</ul>
<h4 data-id="heading-26">4.2 å­¦ä¹ å‚è€ƒèµ„æ–™</h4>
<h5 data-id="heading-27">å®˜æ–¹æ–‡æ¡£</h5>
<ul>
<li>OPA å®˜æ–¹ç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openpolicyagent.org%2F" target="_blank" title="https://www.openpolicyagent.org/" ref="nofollow noopener noreferrer">www.openpolicyagent.org/</a></li>
<li>OPA äº¤äº’å¼è§£é‡Šå™¨ï¼ˆåœ¨çº¿æµ‹è¯• Regoï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.openpolicyagent.org%2F" target="_blank" title="https://play.openpolicyagent.org/" ref="nofollow noopener noreferrer">play.openpolicyagent.org/</a></li>
</ul>
<h5 data-id="heading-28">å…¥é—¨ä¸è¿›é˜¶æ•™ç¨‹</h5>
<ul>
<li>ã€Šç­–ç•¥å³ä»£ç â€”â€”Open Policy Agentï¼ˆOPAï¼‰ç®€ä»‹ã€‹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloudnative.to%2Fblog%2Fintroducing-policy-as-code-the-open-policy-agent-opa%2F" target="_blank" title="https://cloudnative.to/blog/introducing-policy-as-code-the-open-policy-agent-opa/" ref="nofollow noopener noreferrer">cloudnative.to/blog/introdâ€¦</a></li>
<li>ã€ŠHow to Write Your First Rules in Regoã€‹ï¼ˆå®˜æ–¹å…¥é—¨ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.styra.com%2Fblog%2Fhow-to-write-your-first-rules-in-rego-the-policy-language-for-opa%2F" target="_blank" title="https://www.styra.com/blog/how-to-write-your-first-rules-in-rego-the-policy-language-for-opa/" ref="nofollow noopener noreferrer">www.styra.com/blog/how-toâ€¦</a></li>
<li>ã€ŠOPAè¿›é˜¶-å‡½æ•°ä¸è™šæ‹Ÿæ–‡æ¡£è¦åˆ†æ¸…ã€‹ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Fblog.newbmiao.com%2F2020%2F03%2F18%2Fopa-func-and-virtual-doc.html" target="_blank" title="http://blog.newbmiao.com/2020/03/18/opa-func-and-virtual-doc.html" ref="nofollow noopener noreferrer">blog.newbmiao.com/2020/03/18/â€¦</a></li>
<li>ã€ŠOPAè¿›é˜¶-ç®€æ´çš„æ¨å¯¼å¼ã€‹ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Fblog.newbmiao.com%2F2020%2F03%2F20%2Fopa-comprehensions.html" target="_blank" title="http://blog.newbmiao.com/2020/03/20/opa-comprehensions.html" ref="nofollow noopener noreferrer">blog.newbmiao.com/2020/03/20/â€¦</a></li>
</ul>
<h5 data-id="heading-29">å®è·µæ¡ˆä¾‹</h5>
<ul>
<li>ã€ŠOpen Policy Agent - å¿«é€Ÿå°å…¥ Authz è‡³ Microservice æ¶æ§‹ã€‹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fengineering.linecorp.com%2Fzh-hant%2Fblog%2Fopen-policy-agent-authz-in-microservice%2F" target="_blank" title="https://engineering.linecorp.com/zh-hant/blog/open-policy-agent-authz-in-microservice/" ref="nofollow noopener noreferrer">engineering.linecorp.com/zh-hant/bloâ€¦</a></li>
<li>ã€ŠOpen Policy Agent: What Is OPA and How It Works (Examples)ã€‹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fspacelift.io%2Fblog%2Fwhat-is-open-policy-agent-and-how-it-works" target="_blank" title="https://spacelift.io/blog/what-is-open-policy-agent-and-how-it-works" ref="nofollow noopener noreferrer">spacelift.io/blog/what-iâ€¦</a></li>
</ul>
<h3 data-id="heading-30">äº”ã€é›†æˆéªŒè¯ä¸å¸¸è§é—®é¢˜</h3>
<h4 data-id="heading-31">5.1 é›†æˆéªŒè¯æ­¥éª¤</h4>
<ol>
<li>å¯åŠ¨ GoWind Admin æœåŠ¡ï¼Œç¡®ä¿ OPA å¼•æ“åˆå§‹åŒ–æˆåŠŸï¼ˆæŸ¥çœ‹æ—¥å¿— <code>successfully reloaded xxx policy rules</code>ï¼‰ï¼›</li>
<li>é€šè¿‡ Postman ç­‰å·¥å…·å‘é€è¯·æ±‚ï¼š
<ul>
<li>æœªè®¤è¯è¯·æ±‚ï¼šè®¿é—®éœ€è¦æƒé™çš„æ¥å£ï¼Œåº”è¿”å› 401 æœªæˆæƒï¼›</li>
<li>å·²è®¤è¯ä½†æ— æƒé™ï¼šä½¿ç”¨æ™®é€šç”¨æˆ· Token è®¿é—®ç®¡ç†å‘˜æ¥å£ï¼Œåº”è¿”å› 403 ç¦æ­¢è®¿é—®ï¼›</li>
<li>å·²è®¤è¯ä¸”æœ‰æƒé™ï¼šä½¿ç”¨ç®¡ç†å‘˜ Token è®¿é—®ç®¡ç†å‘˜æ¥å£ï¼Œåº”è¿”å› 200 æˆåŠŸã€‚</li>
</ul>
</li>
<li>ä¿®æ”¹è§’è‰²-API æƒé™æ˜ å°„ï¼Œè°ƒç”¨ <code>Authorizer.ResetPolicies</code> æ¥å£é‡ç½®ç­–ç•¥ï¼ŒéªŒè¯æƒé™åŠ¨æ€æ›´æ–°æ˜¯å¦ç”Ÿæ•ˆã€‚</li>
</ol>
<h4 data-id="heading-32">5.2 å¸¸è§é—®é¢˜æ’æŸ¥</h4>
<ul>
<li>OPA å¼•æ“åˆå§‹åŒ–å¤±è´¥ï¼šæ£€æŸ¥ç­–ç•¥æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼ˆå¯é€šè¿‡ OPA åœ¨çº¿è¯•ç‚¼åœºéªŒè¯ï¼‰ã€å†…åµŒæ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼›</li>
<li>æƒé™æ ¡éªŒä¸ç”Ÿæ•ˆï¼šç¡®è®¤ä¸­é—´ä»¶é¡ºåºï¼ˆå…ˆè®¤è¯åæˆæƒï¼‰ã€ç™½åå•é…ç½®æ˜¯å¦æ­£ç¡®ã€è¯·æ±‚è¾“å…¥æ˜¯å¦åŒ…å« <code>user</code>ã€<code>role</code> ç­‰ç­–ç•¥æ‰€éœ€å­—æ®µï¼›</li>
<li>ç­–ç•¥æ›´æ–°ä¸ç”Ÿæ•ˆï¼šç¡®ä¿ä¿®æ”¹æƒé™åè°ƒç”¨äº† <code>ResetPolicies</code> æ–¹æ³•ï¼Œé‡æ–°åŠ è½½ç­–ç•¥åˆ° OPA å¼•æ“ï¼›</li>
<li>æ€§èƒ½é—®é¢˜ï¼šå¯ç”¨ OPA ç­–ç•¥ç¼“å­˜ï¼ˆé…ç½® <code>authz.opa.cache</code>ï¼‰ï¼Œå‡å°‘é‡å¤ç­–ç•¥è®¡ç®—ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆç”µè„‘éœ€è¦"å†…å­˜"å’Œ"ç¡¬ç›˜"ï¼Ÿâ€”â€”å­˜å‚¨é‡‘å­—å¡”çš„ç§˜å¯†]]></title>    <link>https://juejin.cn/post/7583891046206160948</link>    <guid>https://juejin.cn/post/7583891046206160948</guid>    <pubDate>2025-12-15T11:44:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583891046206160948" data-draft-id="7583921477613273123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆç”µè„‘éœ€è¦&quot;å†…å­˜&quot;å’Œ&quot;ç¡¬ç›˜&quot;ï¼Ÿâ€”â€”å­˜å‚¨é‡‘å­—å¡”çš„ç§˜å¯†"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T11:44:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ— é™å¤§6"/> <meta itemprop="url" content="https://juejin.cn/user/2865758605422890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆç”µè„‘éœ€è¦"å†…å­˜"å’Œ"ç¡¬ç›˜"ï¼Ÿâ€”â€”å­˜å‚¨é‡‘å­—å¡”çš„ç§˜å¯†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2865758605422890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ— é™å¤§6
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T11:44:55.000Z" title="Mon Dec 15 2025 11:44:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ’¾ ä¸ºä»€ä¹ˆç”µè„‘éœ€è¦"å†…å­˜"å’Œ"ç¡¬ç›˜"ï¼Ÿâ€”â€”å­˜å‚¨é‡‘å­—å¡”çš„ç§˜å¯† ğŸ§ </h2>
<blockquote>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ— é™å¤§ï¼Œä»Šå¤©åˆå¸¦æ¥æœ€æ–°ä¸€æœŸçš„åä¸‡ä¸ªä¸ºä»€ä¹ˆç³»åˆ—æ–‡ç« </p>
<p>å¸Œæœ›ä»Šå¤©çš„å†…å®¹èƒ½å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©</p>
</blockquote>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¨æˆ¿åšé¥­ï¼š</p>
<ul>
<li>å†°ç®±é‡Œå­˜æ”¾ç€å„ç§é£Ÿæï¼ˆå¤§ç±³ã€è”¬èœã€è‚‰ç±»ï¼‰ğŸ¥¬ğŸ—</li>
<li>ç¶å°ä¸Šçš„ç §æ¿æ”¾ç€ä½ æ­£åœ¨å¤„ç†çš„é£ŸæğŸ”ª</li>
<li>ä½ æ‰‹é‡Œæ‹¿ç€æ­£åœ¨åˆ‡çš„èœğŸ¤²</li>
</ul>
<p>ç”µè„‘çš„å­˜å‚¨ç³»ç»Ÿå…¶å®å’Œå¨æˆ¿å¾ˆåƒï¼å†…å­˜å°±åƒç §æ¿ï¼Œç¡¬ç›˜å°±åƒå†°ç®±ï¼Œè€ŒCPUå°±åƒä½ è¿™ä¸ªå¨å¸ˆã€‚ä»Šå¤©å’±ä»¬å°±æ¥æ­å¼€ç”µè„‘å­˜å‚¨çš„ç¥ç§˜é¢çº±ï¼</p>
<h3 data-id="heading-1">ğŸ“Š å­˜å‚¨é‡‘å­—å¡”ï¼šé€Ÿåº¦ä¸å®¹é‡çš„æƒè¡¡</h3>
<p>ç”µè„‘çš„å­˜å‚¨ç³»ç»Ÿæ˜¯ä¸€ä¸ª"é‡‘å­—å¡”"ç»“æ„ï¼Œè¶Šå¾€ä¸Šé€Ÿåº¦è¶Šå¿«ï¼Œä½†å®¹é‡è¶Šå°ã€æˆæœ¬è¶Šé«˜ï¼›è¶Šå¾€ä¸‹é€Ÿåº¦è¶Šæ…¢ï¼Œä½†å®¹é‡è¶Šå¤§ã€æˆæœ¬è¶Šä½ã€‚</p>















































<table><thead><tr><th>å­˜å‚¨å±‚æ¬¡</th><th>é€Ÿåº¦</th><th>å®¹é‡</th><th>æˆæœ¬</th><th>æ¯”å–»</th></tr></thead><tbody><tr><td>å¯„å­˜å™¨</td><td>âš¡ æœ€å¿«ï¼ˆçº³ç§’çº§ï¼‰</td><td>ğŸ“ æœ€å°ï¼ˆKBçº§ï¼‰</td><td>ğŸ’° æœ€è´µ</td><td>æ‰‹é‡Œçš„é£Ÿæ</td></tr><tr><td>ç¼“å­˜</td><td>âš¡ å¾ˆå¿«ï¼ˆçº³ç§’çº§ï¼‰</td><td>ğŸ“ è¾ƒå°ï¼ˆMBçº§ï¼‰</td><td>ğŸ’° å¾ˆè´µ</td><td>ç §æ¿ä¸Šçš„é£Ÿæ</td></tr><tr><td>å†…å­˜</td><td>ğŸš€ å¿«ï¼ˆæ¯«ç§’çº§ï¼‰</td><td>ğŸ“¦ ä¸­ç­‰ï¼ˆGBçº§ï¼‰</td><td>ğŸ’¸ è¾ƒè´µ</td><td>å¨æˆ¿å°é¢ä¸Šçš„é£Ÿæ</td></tr><tr><td>ç¡¬ç›˜</td><td>ğŸŒ æ…¢ï¼ˆç§’çº§ï¼‰</td><td>ğŸ“š å¤§ï¼ˆTBçº§ï¼‰</td><td>ğŸ’° ä¾¿å®œ</td><td>å†°ç®±é‡Œçš„é£Ÿæ</td></tr><tr><td>äº‘å­˜å‚¨</td><td>ğŸ¢ å¾ˆæ…¢ï¼ˆç½‘ç»œå»¶è¿Ÿï¼‰</td><td>ğŸŒ æ— é™å¤§</td><td>ğŸ’¸ æŒ‰éœ€ä»˜è´¹</td><td>è¶…å¸‚é‡Œçš„é£Ÿæ</td></tr></tbody></table>
<h3 data-id="heading-2">ğŸ¤” æ ¸å¿ƒé—®é¢˜ï¼šä¸ºä»€ä¹ˆä¸èƒ½åªæœ‰ä¸€ç§å­˜å‚¨è®¾å¤‡ï¼Ÿ</h3>
<p>æœ‰äººå¯èƒ½ä¼šé—®ï¼š"æ—¢ç„¶å†…å­˜è¿™ä¹ˆå¿«ï¼Œä¸ºä»€ä¹ˆä¸æŠŠæ‰€æœ‰å­˜å‚¨éƒ½åšæˆå†…å­˜ï¼Ÿ"æˆ–è€…"æ—¢ç„¶ç¡¬ç›˜è¿™ä¹ˆä¾¿å®œï¼Œä¸ºä»€ä¹ˆä¸åªç”¨ç¡¬ç›˜ï¼Ÿ"</p>
<p>è¿™å°±åƒé—®ï¼š"æ—¢ç„¶ç §æ¿è¿™ä¹ˆæ–¹ä¾¿ï¼Œä¸ºä»€ä¹ˆä¸æŠŠå¨æˆ¿éƒ½æ”¹æˆç §æ¿ï¼Ÿ"æˆ–è€…"æ—¢ç„¶å†°ç®±èƒ½è£…å¾ˆå¤šä¸œè¥¿ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç §æ¿ï¼Ÿ"</p>
<p>ç­”æ¡ˆå¾ˆç®€å•ï¼š<strong>é€Ÿåº¦ã€å®¹é‡ã€æˆæœ¬ä¸‰è€…ä¸å¯å…¼å¾—</strong>ï¼</p>
<h4 data-id="heading-3">1. ğŸš€ é€Ÿåº¦çš„å·®å¼‚</h4>
<p>å†…å­˜çš„é€Ÿåº¦æ¯”ç¡¬ç›˜å¿«<strong>1000å€ä»¥ä¸Š</strong>ï¼è®©æˆ‘ä»¬çœ‹ä¸€ç»„è¶£å‘³æ•°æ®ï¼š</p>






























<table><thead><tr><th>å­˜å‚¨è®¾å¤‡</th><th>è¯»å†™é€Ÿåº¦</th><th>è®¿é—®å»¶è¿Ÿ</th></tr></thead><tbody><tr><td>DDR5å†…å­˜</td><td>6400MB/s</td><td>çº¦10ns</td></tr><tr><td>NVMe SSD</td><td>7000MB/s</td><td>çº¦100Î¼s</td></tr><tr><td>SATA SSD</td><td>550MB/s</td><td>çº¦500Î¼s</td></tr><tr><td>HDDç¡¬ç›˜</td><td>150MB/s</td><td>çº¦10ms</td></tr></tbody></table>
<p><strong>æ³¨æ„</strong>ï¼šè™½ç„¶NVMe SSDçš„è¿ç»­è¯»å†™é€Ÿåº¦çœ‹èµ·æ¥å’ŒDDR5å†…å­˜å·®ä¸å¤šï¼Œä½†è®¿é—®å»¶è¿Ÿå·®äº†10000å€ï¼è¿™å°±åƒä½ å»ä¾¿åˆ©åº—ä¹°ä¸œè¥¿ï¼ˆå†…å­˜ï¼‰å’Œå»è¶…å¸‚ä¹°ä¸œè¥¿ï¼ˆç¡¬ç›˜ï¼‰â€”â€”è™½ç„¶è¶…å¸‚å•æ¬¡èƒ½ä¹°æ›´å¤šï¼Œä½†æ¯æ¬¡éƒ½è¦èŠ±æ›´å¤šæ—¶é—´åœ¨è·¯ä¸Šã€‚</p>
<h4 data-id="heading-4">2. ğŸ“¦ å®¹é‡çš„å·®å¼‚</h4>
<p>ç¡¬ç›˜çš„å®¹é‡æ¯”å†…å­˜å¤§å¾—å¤šï¼š</p>
<ul>
<li>æ™®é€šç”µè„‘å†…å­˜ï¼š8GB-64GB</li>
<li>æ™®é€šç”µè„‘ç¡¬ç›˜ï¼š512GB-4TB</li>
<li>ä¸“ä¸šæœåŠ¡å™¨ç¡¬ç›˜ï¼šç”šè‡³å¯è¾¾100TBä»¥ä¸Š</li>
</ul>
<p>è¿™å°±åƒç §æ¿åªèƒ½æ”¾å‡ é“èœï¼Œè€Œå†°ç®±èƒ½æ”¾ä¸€å‘¨çš„é£Ÿæï¼</p>
<h4 data-id="heading-5">3. ğŸ’° æˆæœ¬çš„å·®å¼‚</h4>
<p>å†…å­˜çš„æˆæœ¬æ¯”ç¡¬ç›˜é«˜å¾—å¤šï¼š</p>
<ul>
<li>DDR5å†…å­˜ï¼šçº¦10å…ƒ/GB</li>
<li>NVMe SSDï¼šçº¦1å…ƒ/GB</li>
<li>HDDç¡¬ç›˜ï¼šçº¦0.1å…ƒ/GB</li>
</ul>
<p>å¦‚æœæŠŠä¸€å°ç”µè„‘çš„æ‰€æœ‰å­˜å‚¨éƒ½æ¢æˆå†…å­˜ï¼Œæˆæœ¬ä¼šé«˜åˆ°ç¦»è°±ï¼</p>
<h3 data-id="heading-6">ğŸ§  å†…å­˜ vs ç¡¬ç›˜ï¼šæœ¬è´¨åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<h4 data-id="heading-7">å†…å­˜ï¼šç”µè„‘çš„"ä¸´æ—¶å·¥ä½œå°"</h4>
<p>å†…å­˜ï¼ˆRAMï¼‰æ˜¯ç”µè„‘çš„ä¸´æ—¶å­˜å‚¨ï¼Œå°±åƒå¨æˆ¿çš„ç §æ¿ï¼š</p>
<ul>
<li><strong>é€Ÿåº¦å¿«</strong>ï¼šCPUèƒ½ç›´æ¥è®¿é—®ï¼Œå»¶è¿Ÿæä½</li>
<li><strong>æ˜“å¤±æ€§</strong>ï¼šæ–­ç”µåæ•°æ®ä¼šä¸¢å¤±ï¼ˆå°±åƒä½ åˆ‡å®Œèœï¼Œç §æ¿å°±ç©ºäº†ï¼‰</li>
<li><strong>å®¹é‡å°</strong>ï¼šé€šå¸¸8GB-64GB</li>
<li><strong>ç”¨é€”</strong>ï¼šå­˜æ”¾æ­£åœ¨è¿è¡Œçš„ç¨‹åºå’Œæ•°æ®</li>
</ul>
<h4 data-id="heading-8">ç¡¬ç›˜ï¼šç”µè„‘çš„"æ°¸ä¹…ä»“åº“"</h4>
<p>ç¡¬ç›˜ï¼ˆHDD/SSDï¼‰æ˜¯ç”µè„‘çš„æ°¸ä¹…å­˜å‚¨ï¼Œå°±åƒå¨æˆ¿çš„å†°ç®±ï¼š</p>
<ul>
<li><strong>é€Ÿåº¦æ…¢</strong>ï¼šCPUéœ€è¦é€šè¿‡å†…å­˜æ‰èƒ½è®¿é—®</li>
<li><strong>éæ˜“å¤±æ€§</strong>ï¼šæ–­ç”µåæ•°æ®ä¸ä¼šä¸¢å¤±ï¼ˆå°±åƒé£Ÿææ”¾åœ¨å†°ç®±é‡Œä¸ä¼šåï¼‰</li>
<li><strong>å®¹é‡å¤§</strong>ï¼šé€šå¸¸512GB-4TB</li>
<li><strong>ç”¨é€”</strong>ï¼šå­˜æ”¾æ“ä½œç³»ç»Ÿã€ç¨‹åºã€æ–‡ä»¶ç­‰é•¿æœŸæ•°æ®</li>
</ul>
<h3 data-id="heading-9">ğŸ”„ ç”µè„‘æ˜¯å¦‚ä½•ä½¿ç”¨å­˜å‚¨çš„ï¼Ÿ</h3>
<p>å½“ä½ æ‰“å¼€ä¸€ä¸ªç¨‹åºï¼ˆæ¯”å¦‚Chromeæµè§ˆå™¨ï¼‰æ—¶ï¼Œç”µè„‘ä¼šï¼š</p>
<ol>
<li>ğŸ“¥ ä»ç¡¬ç›˜è¯»å–Chromeçš„ç¨‹åºæ–‡ä»¶åˆ°å†…å­˜</li>
<li>ğŸš€ CPUä»å†…å­˜ä¸­è¯»å–æŒ‡ä»¤å¹¶æ‰§è¡Œ</li>
<li>ğŸ’¾ è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ•°æ®æš‚æ—¶å­˜æ”¾åœ¨å†…å­˜ä¸­</li>
<li>ğŸ’¾ å½“ä½ ä¿å­˜æ–‡ä»¶æˆ–å…³é—­ç¨‹åºæ—¶ï¼Œæ•°æ®ä¼šå†™å›ç¡¬ç›˜</li>
</ol>
<p>è¿™å°±åƒä½ åšé¥­çš„è¿‡ç¨‹ï¼š</p>
<ol>
<li>ğŸ¥¬ ä»å†°ç®±æ‹¿å‡ºè”¬èœåˆ°ç §æ¿</li>
<li>ğŸ”ª åœ¨ç §æ¿ä¸Šåˆ‡èœ</li>
<li>ğŸ³ æŠŠåˆ‡å¥½çš„èœæ”¾è¿›é”…é‡Œç‚’</li>
<li>ğŸ½ï¸ ç‚’å¥½çš„èœç››åˆ°ç›˜å­é‡Œï¼ˆç›¸å½“äºä¿å­˜åˆ°ç¡¬ç›˜ï¼‰</li>
</ol>
<h3 data-id="heading-10">ğŸ“ ä»£ç å®ä¾‹ï¼šå†…å­˜ä¸ç¡¬ç›˜çš„åŒºåˆ«</h3>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„Pythonä»£ç æ¥ç†è§£å†…å­˜å’Œç¡¬ç›˜çš„åŒºåˆ«ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹1ï¼šå†…å­˜æ“ä½œï¼ˆå¿«ï¼‰</span>
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">memory_operation</span>():
    <span class="hljs-comment"># åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå¤§åˆ—è¡¨</span>
    start_time = time.time()
    big_list = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000000</span>)]
    <span class="hljs-comment"># å¯¹åˆ—è¡¨è¿›è¡Œæ“ä½œ</span>
    <span class="hljs-built_in">sum</span>(big_list)
    end_time = time.time()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å†…å­˜æ“ä½œè€—æ—¶ï¼š<span class="hljs-subst">{end_time - start_time:<span class="hljs-number">.4</span>f}</span>ç§’"</span>)

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šç¡¬ç›˜æ“ä½œï¼ˆæ…¢ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">disk_operation</span>():
    <span class="hljs-comment"># å†™å…¥å¤§æ–‡ä»¶åˆ°ç¡¬ç›˜</span>
    start_time = time.time()
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"big_file.txt"</span>, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000000</span>):
            f.write(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>\n"</span>)
    <span class="hljs-comment"># ä»ç¡¬ç›˜è¯»å–æ–‡ä»¶</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"big_file.txt"</span>, <span class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> f:
        content = f.read()
    end_time = time.time()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç¡¬ç›˜æ“ä½œè€—æ—¶ï¼š<span class="hljs-subst">{end_time - start_time:<span class="hljs-number">.4</span>f}</span>ç§’"</span>)

<span class="hljs-comment"># è¿è¡Œæµ‹è¯•</span>
memory_operation()  <span class="hljs-comment"># è¾“å‡ºï¼šçº¦0.1ç§’</span>
<span class="hljs-comment"># disk_operation()  # è¾“å‡ºï¼šçº¦10ç§’ï¼ˆè°¨æ…è¿è¡Œï¼Œä¼šç”Ÿæˆå¤§æ–‡ä»¶ï¼‰</span>
</code></pre>
<p><strong>è¿è¡Œç»“æœå¯¹æ¯”</strong>ï¼š</p>
<ul>
<li>å†…å­˜æ“ä½œï¼šçº¦0.1ç§’</li>
<li>ç¡¬ç›˜æ“ä½œï¼šçº¦10ç§’</li>
</ul>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç”µè„‘éœ€è¦å†…å­˜â€”â€”å¦‚æœæ‰€æœ‰æ“ä½œéƒ½ç›´æ¥åœ¨ç¡¬ç›˜ä¸Šè¿›è¡Œï¼Œä½ çš„ç”µè„‘ä¼šæ…¢å¾—åƒèœ—ç‰›ï¼ğŸŒ</p>
<h3 data-id="heading-11">ğŸ“œ å­˜å‚¨è®¾å¤‡çš„"è¿›åŒ–å²"</h3>
<h4 data-id="heading-12">1. ğŸ“€ è½¯ç›˜æ—¶ä»£ï¼šä»5.25è‹±å¯¸åˆ°3.5è‹±å¯¸</h4>
<p>20ä¸–çºª70å¹´ä»£ï¼Œè½¯ç›˜æ˜¯ç”µè„‘çš„ä¸»è¦å­˜å‚¨è®¾å¤‡ã€‚æœ€æ—©çš„è½¯ç›˜æ˜¯5.25è‹±å¯¸ï¼Œå®¹é‡åªæœ‰360KBâ€”â€”åªèƒ½å­˜ä¸€ç¯‡çŸ­æ–‡ç« ï¼åæ¥è¿›åŒ–åˆ°3.5è‹±å¯¸è½¯ç›˜ï¼Œå®¹é‡æå‡åˆ°1.44MBã€‚</p>
<p>è¿˜è®°å¾—é‚£äº›å¸¦ç€"Aç›˜"å’Œ"Bç›˜"çš„ç”µè„‘å—ï¼Ÿé‚£æ—¶å€™å®‰è£…è½¯ä»¶è¦æ’åå‡ å¼ è½¯ç›˜ï¼Œä¸å°å¿ƒæ’é”™é¡ºåºå°±å¾—é‡æ¥ï¼ğŸ’¾</p>
<h4 data-id="heading-13">2. ğŸ’¿ ç¡¬ç›˜æ—¶ä»£ï¼šä»MBåˆ°TB</h4>
<p>1956å¹´ï¼ŒIBMæ¨å‡ºäº†ä¸–ç•Œä¸Šç¬¬ä¸€å°ç¡¬ç›˜ï¼Œå®¹é‡åªæœ‰5MBï¼Œå´æœ‰ä¸€ä¸ªå†°ç®±é‚£ä¹ˆå¤§ï¼åæ¥ç¡¬ç›˜æŠ€æœ¯ä¸æ–­è¿›æ­¥ï¼š</p>
<ul>
<li>1980å¹´ï¼šIBM XTç¡¬ç›˜ï¼Œ10MB</li>
<li>1990å¹´ï¼šå¸Œæ·ç¡¬ç›˜ï¼Œ1GB</li>
<li>2000å¹´ï¼šè¿ˆæ‹“ç¡¬ç›˜ï¼Œ100GB</li>
<li>2010å¹´ï¼šè¥¿éƒ¨æ•°æ®ç¡¬ç›˜ï¼Œ1TB</li>
<li>2020å¹´ï¼šå¸Œæ·ç¡¬ç›˜ï¼Œ18TB</li>
</ul>
<h4 data-id="heading-14">3. âš¡ SSDé©å‘½ï¼šä»æœºæ¢°åˆ°å›ºæ€</h4>
<p>2007å¹´ï¼Œè‹¹æœåœ¨MacBook Airä¸Šé¦–æ¬¡ä½¿ç”¨SSDï¼Œæ ‡å¿—ç€å›ºæ€ç¡¬ç›˜æ—¶ä»£çš„åˆ°æ¥ã€‚SSDï¼ˆå›ºæ€ç¡¬ç›˜ï¼‰æ²¡æœ‰æœºæ¢°éƒ¨ä»¶ï¼Œè¯»å†™é€Ÿåº¦æ¯”HDDï¼ˆæœºæ¢°ç¡¬ç›˜ï¼‰å¿«å¾—å¤šï¼š</p>








































<table><thead><tr><th>ç‰¹æ€§</th><th>HDDï¼ˆæœºæ¢°ç¡¬ç›˜ï¼‰</th><th>SSDï¼ˆå›ºæ€ç¡¬ç›˜ï¼‰</th></tr></thead><tbody><tr><td>åŸç†</td><td>æœºæ¢°ç£å¤´+ç›˜ç‰‡</td><td>é—ªå­˜èŠ¯ç‰‡</td></tr><tr><td>é€Ÿåº¦</td><td>100-200MB/s</td><td>550MB/sï¼ˆSATAï¼‰- 7000MB/sï¼ˆNVMeï¼‰</td></tr><tr><td>å™ªéŸ³</td><td>ğŸ“£ æœ‰å™ªéŸ³ï¼ˆæœºæ¢°è½¬åŠ¨ï¼‰</td><td>ğŸ¤« æ— å™ªéŸ³</td></tr><tr><td>æŠ—éœ‡æ€§</td><td>âŒ æ€•éœ‡åŠ¨</td><td>âœ… æŠ—éœ‡</td></tr><tr><td>åŠŸè€—</td><td>é«˜</td><td>ä½</td></tr><tr><td>å¯¿å‘½</td><td>3-5å¹´</td><td>5-10å¹´</td></tr></tbody></table>
<h4 data-id="heading-15">4. â˜ï¸ äº‘å­˜å‚¨æ—¶ä»£ï¼šæ— é™å®¹é‡</h4>
<p>éšç€ç½‘ç»œæŠ€æœ¯çš„å‘å±•ï¼Œäº‘å­˜å‚¨æˆä¸ºäº†æ–°çš„é€‰æ‹©ã€‚ä½ å¯ä»¥æŠŠæ–‡ä»¶å­˜åˆ°äº‘ç«¯ï¼Œéšæ—¶éšåœ°è®¿é—®ã€‚äº‘å­˜å‚¨çš„ä¼˜åŠ¿æ˜¯ï¼š</p>
<ul>
<li>ğŸŒ æ— é™å®¹é‡ï¼ˆæŒ‰éœ€ä»˜è´¹ï¼‰</li>
<li>ğŸ“± è·¨è®¾å¤‡è®¿é—®</li>
<li>ğŸ›¡ï¸ æ•°æ®å¤‡ä»½å’Œæ¢å¤</li>
<li>ğŸ“¤ æ–¹ä¾¿åˆ†äº«</li>
</ul>
<p>ä½†äº‘å­˜å‚¨ä¹Ÿæœ‰ç¼ºç‚¹ï¼š</p>
<ul>
<li>ğŸŒ å—ç½‘ç»œé€Ÿåº¦é™åˆ¶</li>
<li>ğŸ’° éœ€è¦æŒç»­ä»˜è´¹</li>
<li>ğŸ”’ éšç§å’Œå®‰å…¨ concerns</li>
</ul>
<h3 data-id="heading-16">ğŸ§© ç¼“å­˜ï¼šå†…å­˜å’ŒCPUä¹‹é—´çš„"åŠ é€Ÿå¸¦"</h3>
<p>é™¤äº†å†…å­˜å’Œç¡¬ç›˜ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å­˜å‚¨å±‚æ¬¡â€”â€”<strong>ç¼“å­˜</strong>ï¼ç¼“å­˜æ˜¯CPUå’Œå†…å­˜ä¹‹é—´çš„"åŠ é€Ÿå¸¦"ï¼Œé€Ÿåº¦æ¯”å†…å­˜è¿˜å¿«ã€‚</p>
<p>ç¼“å­˜åˆ†ä¸ºä¸‰çº§ï¼š</p>
<ul>
<li><strong>L1ç¼“å­˜</strong>ï¼šæœ€å¿«ï¼Œå®¹é‡æœ€å°ï¼ˆKBçº§ï¼‰ï¼Œé›†æˆåœ¨CPUå†…éƒ¨</li>
<li><strong>L2ç¼“å­˜</strong>ï¼šè¾ƒå¿«ï¼Œå®¹é‡ä¸­ç­‰ï¼ˆMBçº§ï¼‰ï¼Œä¹Ÿé›†æˆåœ¨CPUå†…éƒ¨</li>
<li><strong>L3ç¼“å­˜</strong>ï¼šè¾ƒæ…¢ï¼Œå®¹é‡è¾ƒå¤§ï¼ˆMBçº§ï¼‰ï¼Œå¯èƒ½å…±äº«å¤šä¸ªæ ¸å¿ƒ</li>
</ul>
<p>CPUè®¿é—®æ•°æ®çš„é¡ºåºæ˜¯ï¼šL1ç¼“å­˜ â†’ L2ç¼“å­˜ â†’ L3ç¼“å­˜ â†’ å†…å­˜ â†’ ç¡¬ç›˜ã€‚è¿™å°±åƒä½ æ‰¾ä¸œè¥¿çš„é¡ºåºï¼šå£è¢‹ â†’ æ¡Œé¢ â†’ æŠ½å±‰ â†’ æŸœå­ â†’ ä»“åº“ï¼</p>
<h3 data-id="heading-17">ğŸ¯ å­˜å‚¨ä¼˜åŒ–ï¼šè®©ç”µè„‘è·‘å¾—æ›´å¿«</h3>
<p>äº†è§£äº†å­˜å‚¨å±‚æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æ–¹æ³•ä¼˜åŒ–ç”µè„‘æ€§èƒ½ï¼š</p>
<h4 data-id="heading-18">1. ğŸš€ å¢åŠ å†…å­˜å®¹é‡</h4>
<p>å¦‚æœä½ çš„ç”µè„‘ç»å¸¸å¡é¡¿ï¼Œå°¤å…¶æ˜¯åŒæ—¶æ‰“å¼€å¤šä¸ªç¨‹åºæ—¶ï¼Œå¢åŠ å†…å­˜å®¹é‡æ˜¯æœ€æœ‰æ•ˆçš„ä¼˜åŒ–æ–¹æ³•ä¹‹ä¸€ã€‚</p>
<p><strong>æ¨èå†…å­˜å®¹é‡</strong>ï¼š</p>
<ul>
<li>æ—¥å¸¸åŠå…¬ï¼š8GB</li>
<li>æ¸¸æˆå’Œè®¾è®¡ï¼š16GB-32GB</li>
<li>ä¸“ä¸šå·¥ä½œç«™ï¼š64GBä»¥ä¸Š</li>
</ul>
<h4 data-id="heading-19">2. âš¡ å‡çº§åˆ°SSD</h4>
<p>æŠŠæœºæ¢°ç¡¬ç›˜æ¢æˆSSDï¼Œç”µè„‘çš„å¯åŠ¨é€Ÿåº¦å’Œç¨‹åºåŠ è½½é€Ÿåº¦ä¼šæœ‰è´¨çš„é£è·ƒï¼</p>
<p><strong>å‡çº§å»ºè®®</strong>ï¼š</p>
<ul>
<li>ç³»ç»Ÿç›˜ï¼šNVMe SSDï¼ˆé€Ÿåº¦æœ€å¿«ï¼‰</li>
<li>æ•°æ®ç›˜ï¼šSATA SSDæˆ–å¤§å®¹é‡HDD</li>
</ul>
<h4 data-id="heading-20">3. ğŸ’¾ åˆç†åˆ†é…å­˜å‚¨</h4>
<ul>
<li>æŠŠæ“ä½œç³»ç»Ÿå’Œå¸¸ç”¨ç¨‹åºå®‰è£…åœ¨SSDä¸Š</li>
<li>æŠŠå¤§æ–‡ä»¶ï¼ˆè§†é¢‘ã€ç…§ç‰‡ï¼‰å­˜æ”¾åœ¨HDDæˆ–äº‘å­˜å‚¨ä¸Š</li>
<li>å®šæœŸæ¸…ç†ç¡¬ç›˜ï¼Œåˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶</li>
</ul>
<h4 data-id="heading-21">4. ğŸ“Š ç›‘æ§å­˜å‚¨ä½¿ç”¨</h4>
<p>ä½¿ç”¨ç³»ç»Ÿå·¥å…·ç›‘æ§å†…å­˜å’Œç¡¬ç›˜ä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶å‘ç°é—®é¢˜ï¼š</p>
<ul>
<li>Windowsï¼šä»»åŠ¡ç®¡ç†å™¨ â†’ æ€§èƒ½æ ‡ç­¾</li>
<li>macOSï¼šæ´»åŠ¨ç›‘è§†å™¨ â†’ å†…å­˜/ç£ç›˜æ ‡ç­¾</li>
<li>Linuxï¼šhtopæˆ–free/dfå‘½ä»¤</li>
</ul>
<h3 data-id="heading-22">ğŸ“ äº’åŠ¨å°æµ‹éªŒï¼šä½ ç­”å¯¹äº†å—ï¼Ÿ</h3>
<p>æ¥æµ‹è¯•ä¸€ä¸‹ä½ å¯¹å­˜å‚¨ç³»ç»Ÿçš„äº†è§£ï¼š</p>



































<table><thead><tr><th>é—®é¢˜</th><th>ç­”æ¡ˆ</th><th>ä½ ç­”å¯¹äº†å—ï¼Ÿ</th></tr></thead><tbody><tr><td>å†…å­˜çš„é€Ÿåº¦æ¯”ç¡¬ç›˜å¿«å¤šå°‘å€ï¼Ÿ</td><td>1000å€ä»¥ä¸Š</td><td>âœ…/âŒ</td></tr><tr><td>æ–­ç”µåï¼Œå†…å­˜ä¸­çš„æ•°æ®ä¼šä¸¢å¤±å—ï¼Ÿ</td><td>ä¼š</td><td>âœ…/âŒ</td></tr><tr><td>SSDçš„è¯»å†™é€Ÿåº¦å¯è¾¾å¤šå°‘ï¼Ÿ</td><td>7000MB/s</td><td>âœ…/âŒ</td></tr><tr><td>å­˜å‚¨é‡‘å­—å¡”ä¸­ï¼Œé€Ÿåº¦æœ€å¿«çš„æ˜¯ï¼Ÿ</td><td>å¯„å­˜å™¨</td><td>âœ…/âŒ</td></tr><tr><td>ç¼“å­˜åˆ†ä¸ºå‡ çº§ï¼Ÿ</td><td>ä¸‰çº§ï¼ˆL1/L2/L3ï¼‰</td><td>âœ…/âŒ</td></tr></tbody></table>
<h3 data-id="heading-23">ğŸ”® æœªæ¥å­˜å‚¨æŠ€æœ¯ï¼šæ›´å¿«ã€æ›´å¤§ã€æ›´ä¾¿å®œ</h3>
<p>æœªæ¥çš„å­˜å‚¨æŠ€æœ¯ä¼šæœå“ªä¸ªæ–¹å‘å‘å±•ï¼Ÿ</p>
<h4 data-id="heading-24">1. ğŸ’¾ 3D NANDï¼šå †å æ›´å¤šå±‚</h4>
<p>3D NANDæŠ€æœ¯å¯ä»¥æŠŠé—ªå­˜èŠ¯ç‰‡å †å å¾—æ›´é«˜ï¼Œä»è€Œæé«˜å®¹é‡ã€é™ä½æˆæœ¬ã€‚ç›®å‰å·²ç»å¯ä»¥å †å 200å¤šå±‚ï¼Œæœªæ¥å¯èƒ½è¾¾åˆ°1000å±‚ä»¥ä¸Šï¼</p>
<h4 data-id="heading-25">2. ğŸš€ PCIe 5.0/6.0ï¼šæ›´å¿«çš„æ¥å£</h4>
<p>PCIe 5.0 SSDçš„é€Ÿåº¦å·²ç»è¾¾åˆ°14000MB/sï¼ŒPCIe 6.0æ›´æ˜¯èƒ½è¾¾åˆ°28000MB/sï¼Œæ¯”ç°åœ¨çš„NVMe SSDå¿«4å€ï¼</p>
<h4 data-id="heading-26">3. ğŸ§¬ ç›¸å˜å†…å­˜ï¼ˆPCMï¼‰ï¼šå†…å­˜å’Œç¡¬ç›˜çš„ç»“åˆ</h4>
<p>ç›¸å˜å†…å­˜æ˜¯ä¸€ç§æ–°å‹å­˜å‚¨æŠ€æœ¯ï¼Œæ—¢æœ‰å†…å­˜çš„é€Ÿåº¦ï¼Œåˆæœ‰ç¡¬ç›˜çš„éæ˜“å¤±æ€§ã€‚æœªæ¥å¯èƒ½ä¼šå–ä»£ä¼ ç»Ÿå†…å­˜å’Œç¡¬ç›˜ï¼Œå®ç°"ç»Ÿä¸€å­˜å‚¨"ï¼</p>
<h4 data-id="heading-27">4. â˜ï¸ è¾¹ç¼˜è®¡ç®—ï¼šäº‘å­˜å‚¨çš„å»¶ä¼¸</h4>
<p>éšç€5Gå’Œè¾¹ç¼˜è®¡ç®—çš„å‘å±•ï¼Œäº‘å­˜å‚¨ä¼šå˜å¾—æ›´å¿«ã€æ›´æ™®åŠã€‚æœªæ¥ä½ çš„ç”µè„‘å¯èƒ½åªéœ€è¦å¾ˆå°‘çš„æœ¬åœ°å­˜å‚¨ï¼Œå¤§éƒ¨åˆ†æ•°æ®éƒ½å­˜æ”¾åœ¨äº‘ç«¯ï¼</p>
<h3 data-id="heading-28">ğŸ¯ ç»“è¯­ï¼šå­˜å‚¨é‡‘å­—å¡”çš„æ™ºæ…§</h3>
<p>ç”µè„‘çš„å­˜å‚¨ç³»ç»Ÿå°±åƒä¸€ä¸ª"é‡‘å­—å¡”"ï¼Œä¸åŒçš„å­˜å‚¨è®¾å¤‡å„å¸å…¶èŒï¼Œå…±åŒæ„æˆäº†é«˜æ•ˆçš„å­˜å‚¨ä½“ç³»ã€‚å†…å­˜è´Ÿè´£é€Ÿåº¦ï¼Œç¡¬ç›˜è´Ÿè´£å®¹é‡ï¼Œå®ƒä»¬ç¼ºä¸€ä¸å¯ï¼</p>
<p>ä¸‹æ¬¡å½“ä½ æ‰“å¼€ç”µè„‘ï¼Œçœ‹åˆ°ç¨‹åºå¿«é€ŸåŠ è½½æ—¶ï¼Œåˆ«å¿˜äº†æ„Ÿè°¢å†…å­˜çš„é«˜é€Ÿï¼›å½“ä½ ä¿å­˜æ–‡ä»¶æ—¶ï¼Œåˆ«å¿˜äº†æ„Ÿè°¢ç¡¬ç›˜çš„å¯é ã€‚å®ƒä»¬å°±åƒä¸€å¯¹é»˜å¥‘çš„æ­æ¡£ï¼Œè®©ä½ çš„ç”µè„‘è·‘å¾—åˆå¿«åˆç¨³ï¼</p>
<hr/>
<h3 data-id="heading-29">ğŸ’¬ äº’åŠ¨è¯é¢˜</h3>
<ol>
<li>ä½ çš„ç”µè„‘å†…å­˜å’Œç¡¬ç›˜å®¹é‡æ˜¯å¤šå°‘ï¼Ÿå¤Ÿç”¨å—ï¼Ÿ</li>
<li>ä½ æœ‰æ²¡æœ‰ç»å†è¿‡ä»HDDå‡çº§åˆ°SSDçš„"é€Ÿåº¦é£è·ƒ"ï¼Ÿ</li>
<li>ä½ è§‰å¾—æœªæ¥çš„ç”µè„‘è¿˜éœ€è¦ç¡¬ç›˜å—ï¼Ÿ</li>
</ol>
<p>å¿«æ¥è¯„è®ºåŒºèŠèŠä½ çš„æƒ³æ³•ï¼ğŸ’¬ ç‚¹èµæ”¶è—ä¸è¿·è·¯ï¼Œå’±ä»¬ä¸‹æœŸç»§ç»­æ¢ç´¢è®¡ç®—æœºçš„"åä¸‡ä¸ªä¸ºä»€ä¹ˆ"ï¼ğŸ‰</p>
<p><strong>å…³æ³¨æˆ‘</strong>ï¼Œä¸‹æœŸå¸¦ä½ è§£é”æ›´å¤šè®¡ç®—æœºçš„"å¥‡è‘©å†·çŸ¥è¯†"ï¼ğŸ¤“</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€ç§åŸºäº Service Worker çš„æ¸è¿›å¼æ¸²æŸ“æ–¹æ¡ˆçš„åŸºæœ¬åŸç†]]></title>    <link>https://juejin.cn/post/7583727768544346148</link>    <guid>https://juejin.cn/post/7583727768544346148</guid>    <pubDate>2025-12-15T12:01:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583727768544346148" data-draft-id="7583898823920828458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€ç§åŸºäº Service Worker çš„æ¸è¿›å¼æ¸²æŸ“æ–¹æ¡ˆçš„åŸºæœ¬åŸç†"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-15T12:01:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜è¿œæ¹–ä¹‹é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2370998127573751"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€ç§åŸºäº Service Worker çš„æ¸è¿›å¼æ¸²æŸ“æ–¹æ¡ˆçš„åŸºæœ¬åŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2370998127573751/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜è¿œæ¹–ä¹‹é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:01:16.000Z" title="Mon Dec 15 2025 12:01:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ç¬”è€…å‰é¢å‘è¿‡ä¸¤ç¯‡å…³äºæµå¼SSRçš„æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://juejin.cn/post/7575090551357407284" target="_blank" title="https://juejin.cn/post/7575090551357407284">æµ…å…¥ç†è§£æµå¼SSRçš„æ€§èƒ½æ”¶ç›Šä¸å·¥ä½œåŸç†</a></li>
<li><a href="https://juejin.cn/post/7492119684047962121" target="_blank" title="https://juejin.cn/post/7492119684047962121">åœ¨H5é¡µé¢çš„SSRä¸­ï¼Œå®¢æˆ·ç«¯éœ€è¦åšå“ªäº›å·¥ä½œï¼Ÿ</a></li>
</ul>
<p>æµå¼SSRå°±æ˜¯ä¸€ç§æ¸è¿›å¼æ¸²æŸ“ï¼Œåœ¨ä¼ ç»Ÿçš„é¡µé¢åŠ è½½æµç¨‹æ˜¯ï¼š<strong>è¯·æ±‚ â†’ ç­‰å¾… â†’ æ¸²æŸ“</strong>ã€‚è€Œæ¸è¿›å¼æ¸²æŸ“çš„æ€è·¯æ˜¯ï¼š</p>
<ol>
<li><strong>ç«‹å³å±•ç¤º</strong>ç¼“å­˜çš„é¡µé¢å¿«ç…§ï¼ˆå³ä½¿æ˜¯æ—§å†…å®¹ï¼‰</li>
<li><strong>åå°è¯·æ±‚</strong>æœ€æ–°çš„é¡µé¢å†…å®¹</li>
<li><strong>æ— ç¼æ›¿æ¢</strong>ä¸ºæœ€æ–°å†…å®¹</li>
</ol>
<p>è¿™æ ·ç”¨æˆ·æ„ŸçŸ¥åˆ°çš„åŠ è½½æ—¶é—´æ¥è¿‘äºé›¶ï¼Œä½“éªŒç±»ä¼¼äºåŸç”Ÿ Appã€‚</p>
<p>å‰é¢ç¬”è€…çš„æ–‡ç« ä¸­ï¼Œæåˆ°å…³äºH5é¡µé¢çš„å¿«ç…§æ˜¯å®¢æˆ·ç«¯åšçš„ã€‚æœ¬ç¯‡æ–‡ç« è®²è¿°ä¸€ç§åŸºäº Service Worker çš„æ¸è¿›å¼æ¸²æŸ“æ–¹æ¡ˆçš„åŸç†ï¼Œç®€å•æ¥è®²å°±æ˜¯å°†å®¢æˆ·ç«¯çš„å·¥ä½œæŒªåˆ°äº†service workerä¸­ã€‚é€šè¿‡ç»™ç«™ç‚¹å¼€å¯ä¸€ä¸ªåå°è¿è¡Œçš„service workerï¼ˆservice workerå¯ä»¥ç‹¬ç«‹äºwebviewè¿è¡Œåœ¨åå°ï¼‰ï¼Œåœ¨service workerä¸­åŠ«æŒåŒ…æ‹¬ä¸»æ–‡æ¡£åœ¨å†…çš„ç½‘ç»œè¯·æ±‚ï¼Œå¯¹æ–‡æ¡£å†…å®¹è¿›è¡Œå­˜å‚¨ï¼Œå¹¶ä¿®æ”¹è¿”å›ã€‚</p>
<h2 data-id="heading-1">æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡</h2>
<h3 data-id="heading-2">æ•´ä½“æ¶æ„</h3>
<pre><code class="hljs language-markdown" lang="markdown">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è®¿é—®    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service Worker  â”‚ â—„â”€â”€â”€ æ‹¦æˆªè¯·æ±‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
     â”‚        â”‚
     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¼“å­˜å¿«ç…§ â”‚      â”‚ ç½‘ç»œè¯·æ±‚  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  æµå¼æ›¿æ¢    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre>
<h3 data-id="heading-3">æ ¸å¿ƒä»£ç å®ç°</h3>
<h4 data-id="heading-4">1. HTML é¡µé¢æ³¨å†Œ Service Worker</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ¸è¿›å¼æ¸²æŸ“ç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">data-snapshot</span>&gt;</span><span class="javascript">
    (<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> swEnabled = location.<span class="hljs-property">search</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'x-sw=false'</span>) &lt; <span class="hljs-number">0</span>;

      <span class="hljs-comment">// æ³¨å†Œ Service Worker</span>
      swEnabled &amp;&amp; navigator.<span class="hljs-property">serviceWorker</span> &amp;&amp; navigator.<span class="hljs-property">serviceWorker</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">'/sw.js'</span>)
        .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">registration</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Service Worker æ³¨å†ŒæˆåŠŸ:'</span>, registration);
        })
        .<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Service Worker æ³¨å†Œå¤±è´¥:'</span>, error);
        });

      <span class="hljs-comment">// å¦‚æœç¦ç”¨ï¼Œåˆ™æ³¨é”€ Service Worker</span>
      !swEnabled &amp;&amp; navigator.<span class="hljs-property">serviceWorker</span> &amp;&amp; navigator.<span class="hljs-property">serviceWorker</span>.<span class="hljs-title function_">getRegistration</span>(location.<span class="hljs-property">href</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> {
        r &amp;&amp; r.<span class="hljs-title function_">unregister</span>();
      });
    }());
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>å…³é”®ç‚¹è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>data-snapshot</code>Â å±æ€§æ ‡è®°è¿™æ˜¯å¿«ç…§é˜¶æ®µéœ€è¦ä¿ç•™çš„è„šæœ¬</li>
<li>æ”¯æŒé€šè¿‡Â <code>?x-sw=false</code>Â å‚æ•°ç¦ç”¨ Service Worker</li>
<li>ç¦ç”¨æ—¶ä¼šè‡ªåŠ¨æ³¨é”€å·²æ³¨å†Œçš„ Service Worker</li>
</ul>
<h4 data-id="heading-5">2. Service Worker æ ¸å¿ƒé€»è¾‘</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// sw.js</span>
self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'fetch'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-comment">// åªæ‹¦æˆªä¸»æ–‡æ¡£è¯·æ±‚</span>
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">request</span>.<span class="hljs-property">destination</span> !== <span class="hljs-string">'document'</span>) {
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// æ”¯æŒç¦ç”¨åŠŸèƒ½</span>
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">request</span>.<span class="hljs-property">url</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'x-sw=false'</span>) &gt;= <span class="hljs-number">0</span>) {
    event.<span class="hljs-title function_">waitUntil</span>(caches.<span class="hljs-title function_">delete</span>(<span class="hljs-string">'my-cache'</span>));
    <span class="hljs-keyword">return</span>;
  }

  event.<span class="hljs-title function_">respondWith</span>(<span class="hljs-title function_">handleFetch</span>(event.<span class="hljs-property">request</span>));
});

self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'install'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Service Worker å®‰è£…'</span>);
  self.<span class="hljs-title function_">skipWaiting</span>(); <span class="hljs-comment">// ç«‹å³æ¿€æ´»</span>
});
</code></pre>
<h4 data-id="heading-6">3. è„šæœ¬è¿‡æ»¤ç­–ç•¥</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">replaceScripts</span>(<span class="hljs-params">text, regularStream</span>) {
  <span class="hljs-keyword">return</span> text.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;script\b[^&lt;]*(?:(?!&lt;\/script&gt;)&lt;[^&lt;]*)*&lt;\/script&gt;/gi</span>, <span class="hljs-function">(<span class="hljs-params">match</span>) =&gt;</span> {
    <span class="hljs-comment">// å¿«ç…§é˜¶æ®µï¼šåªä¿ç•™ data-snapshot è„šæœ¬</span>
    <span class="hljs-comment">// æ­£å¼é˜¶æ®µï¼šåªä¿ç•™æ™®é€šè„šæœ¬</span>
    <span class="hljs-keyword">if</span> (match.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'data-snapshot'</span>) &gt;= <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> regularStream ? <span class="hljs-string">''</span> : match;
    }
    <span class="hljs-keyword">return</span> regularStream ? match : <span class="hljs-string">''</span>;
  });
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦è¿‡æ»¤è„šæœ¬ï¼Ÿ</strong></p>
<ul>
<li>å¿«ç…§é˜¶æ®µï¼šé¿å…æ‰§è¡Œä¸šåŠ¡é€»è¾‘è„šæœ¬ï¼ˆå¯èƒ½ä¾èµ–æœªåŠ è½½çš„èµ„æºï¼‰</li>
<li>æ­£å¼é˜¶æ®µï¼šé¿å…é‡å¤æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬</li>
</ul>
<h4 data-id="heading-7">4. æµå¼æ¸²æŸ“æ ¸å¿ƒ</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">withSnapshot</span>(<span class="hljs-params">snapshot, request</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ReadableStream</span>({
    <span class="hljs-title function_">start</span>(<span class="hljs-params">controller</span>) {
      <span class="hljs-keyword">const</span> encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
      <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
      
      <span class="hljs-comment">// ç¬¬ä¸€æ­¥ï¼šç«‹å³è¾“å‡ºå¿«ç…§</span>
      controller.<span class="hljs-title function_">enqueue</span>(encoder.<span class="hljs-title function_">encode</span>(snapshot));

      <span class="hljs-keyword">let</span> firstStream = <span class="hljs-literal">true</span>;
      
      <span class="hljs-comment">// ç¬¬äºŒæ­¥ï¼šè¯·æ±‚æœ€æ–°å†…å®¹</span>
      <span class="hljs-title function_">fetchAndStore</span>(request).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">push</span>(<span class="hljs-params"/>) {
          reader.<span class="hljs-title function_">read</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">{ done, value }</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (done) {
              controller.<span class="hljs-title function_">close</span>();
              <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-keyword">if</span> (firstStream) {
              firstStream = <span class="hljs-literal">false</span>;
              
              <span class="hljs-comment">// ç¬¬ä¸‰æ­¥ï¼šæ¸…ç©ºé¡µé¢</span>
              controller.<span class="hljs-title function_">enqueue</span>(encoder.<span class="hljs-title function_">encode</span>(
                <span class="hljs-string">'&lt;script&gt;document.head.innerHTML = "";document.body.innerHTML = "";&lt;/script&gt;'</span>
              ));

              <span class="hljs-comment">// ç¬¬å››æ­¥ï¼šæ³¨å…¥æœ€æ–°å†…å®¹</span>
              <span class="hljs-keyword">const</span> text = decoder.<span class="hljs-title function_">decode</span>(value);
              <span class="hljs-keyword">const</span> head = text.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/&lt;head&gt;([\s\S]*?)&lt;\/head&gt;/i</span>);
              <span class="hljs-keyword">const</span> body = text.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/&lt;body&gt;([\s\S]*?)&lt;\/body&gt;/i</span>);

              <span class="hljs-keyword">if</span> (head &amp;&amp; body) {
                controller.<span class="hljs-title function_">enqueue</span>(encoder.<span class="hljs-title function_">encode</span>(
                  <span class="hljs-string">`&lt;script&gt;document.head.innerHTML = '<span class="hljs-subst">${head[<span class="hljs-number">1</span>].trim().replace(/\n/g, <span class="hljs-string">''</span>)}</span>'&lt;/script&gt;`</span>
                ));
                controller.<span class="hljs-title function_">enqueue</span>(encoder.<span class="hljs-title function_">encode</span>(<span class="hljs-title function_">replaceScripts</span>(body[<span class="hljs-number">1</span>], <span class="hljs-literal">true</span>)));
              }
            } <span class="hljs-keyword">else</span> {
              controller.<span class="hljs-title function_">enqueue</span>(value);
            }
            <span class="hljs-title function_">push</span>();
          });
        }

        <span class="hljs-title function_">push</span>();
      });
    },
  }));
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦æ¸…ç©º DOMï¼Ÿ</strong></p>
<ul>
<li>å¿«ç…§å†…å®¹å’Œæœ€æ–°å†…å®¹å¯èƒ½ç»“æ„ä¸åŒ</li>
<li>ç›´æ¥è¿½åŠ ä¼šå¯¼è‡´å†…å®¹é‡å¤</li>
<li>æ¸…ç©ºåé‡æ–°æ³¨å…¥ï¼Œç¡®ä¿é¡µé¢çŠ¶æ€ä¸€è‡´</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆç”¨ innerHTML æ³¨å…¥ï¼Ÿ</strong></p>
<ul>
<li>æµå¼å“åº”ä¸­ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥æ“ä½œ DOM</li>
<li>åªèƒ½é€šè¿‡æ¨é€Â <code>&lt;script&gt;</code>Â æ ‡ç­¾è®©æµè§ˆå™¨æ‰§è¡Œ JavaScript</li>
<li><code>innerHTML</code>Â æ˜¯æœ€ç®€å•çš„ DOM æ›¿æ¢æ–¹å¼</li>
</ul>
<h4 data-id="heading-8">5. ç¼“å­˜ç®¡ç†</h4>
<p><strong>Service Worker çš„ç¼“å­˜å­˜å‚¨åœ¨ Cache Storage API ä¸­ï¼Œè¿™æ˜¯æµè§ˆå™¨æä¾›çš„ä¸“é—¨ç”¨äº Service Worker çš„æŒä¹…åŒ–å­˜å‚¨ç©ºé—´ã€‚å®é™…ä¸Šï¼Œä¸éœ€è¦å…³å¿ƒç‰©ç†ä½ç½®ï¼Œå› ä¸ºæµè§ˆå™¨å®Œå…¨ç®¡ç†è¿™äº›æ–‡ä»¶ã€‚</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchAndStore</span>(<span class="hljs-params">request</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(request)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">networkResponse</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (networkResponse.<span class="hljs-property">ok</span>) {
        <span class="hljs-comment">// å…‹éš†å“åº”ç”¨äºç¼“å­˜</span>
        <span class="hljs-keyword">const</span> cacheResponse = networkResponse.<span class="hljs-title function_">clone</span>();
        caches.<span class="hljs-title function_">open</span>(<span class="hljs-string">'my-cache'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">cache</span>) =&gt;</span> {
          cache.<span class="hljs-title function_">put</span>(request, cacheResponse);
        });
      }
      <span class="hljs-keyword">return</span> networkResponse;
    });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleFetch</span>(<span class="hljs-params">request</span>) {
  <span class="hljs-keyword">return</span> caches.<span class="hljs-title function_">match</span>(request)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (response) {
        <span class="hljs-comment">// æœ‰ç¼“å­˜ï¼šå…ˆå±•ç¤ºå¿«ç…§ï¼Œå†æ›´æ–°</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">readResponseText</span>(response).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">snapshot</span>) =&gt;</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">withSnapshot</span>(snapshot, request);
        });
      }
      <span class="hljs-comment">// æ— ç¼“å­˜ï¼šç›´æ¥è¯·æ±‚</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetchAndStore</span>(request);
    });
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦ clone å“åº”ï¼Ÿ</strong></p>
<ul>
<li>Response å¯¹è±¡çš„ body åªèƒ½è¯»å–ä¸€æ¬¡ï¼ˆæµçš„ç‰¹æ€§ï¼‰</li>
<li>éœ€è¦ä¸€ä»½ç»™ç¼“å­˜ï¼Œä¸€ä»½ç»™æµè§ˆå™¨</li>
<li><code>clone()</code> åˆ›å»ºç‹¬ç«‹çš„å‰¯æœ¬</li>
</ul>
<h3 data-id="heading-9">å·¥ä½œæµç¨‹è¯¦è§£</h3>
<p><strong>é¦–æ¬¡è®¿é—®ï¼ˆæ— ç¼“å­˜ï¼‰</strong></p>
<pre><code class="hljs language-bash" lang="bash">ç”¨æˆ·è®¿é—® â†’ Service Worker æ‹¦æˆª â†’ æ— ç¼“å­˜ â†’ ç½‘ç»œè¯·æ±‚ â†’ è¿”å›å†…å®¹ â†’ å­˜å…¥ç¼“å­˜
</code></pre>
<p><strong>äºŒæ¬¡è®¿é—®ï¼ˆæœ‰ç¼“å­˜ï¼‰</strong></p>
<pre><code class="hljs language-bash" lang="bash">ç”¨æˆ·è®¿é—®
  â†“
Service Worker æ‹¦æˆª
  â†“
è¯»å–ç¼“å­˜å¿«ç…§ï¼ˆå»é™¤æ™®é€šè„šæœ¬ï¼‰
  â†“
ç«‹å³è¿”å›å¿«ç…§å†…å®¹ â† ç”¨æˆ·çœ‹åˆ°é¡µé¢
  â†“
åå°å‘èµ·ç½‘ç»œè¯·æ±‚
  â†“
æ¸…ç©º DOM
  â†“
æ³¨å…¥æœ€æ–° <span class="hljs-built_in">head</span> å’Œ body
  â†“
æ›´æ–°ç¼“å­˜
</code></pre>
<h2 data-id="heading-10">æ³¨æ„äº‹é¡¹</h2>
<p>ä¸Šè¿°åªè®²è¿°äº†è¯¥æ–¹æ¡ˆçš„åŸºæœ¬åŸç†ï¼Œå®é™…åº”ç”¨è¦è€ƒè™‘æ›´å¤šçš„å› ç´ å¦‚App ç¯å¢ƒå…¼å®¹æ€§ã€ç¼“å­˜ç­–ç•¥ã€åŸºç¡€è®¾æ–½ä¾èµ–ç­‰ï¼Œä¸‹é¢æ˜¯æ–¹æ¡ˆå¯¹æ¯”ï¼š</p>













































<table><thead><tr><th>ç»´åº¦</th><th>å®¢æˆ·ç«¯æ–¹æ¡ˆ</th><th>Service Worker æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>é¦–æ¬¡è®¿é—®æ‹¦æˆª</strong></td><td>âœ… å¯ä»¥æ‹¦æˆª</td><td>âŒ æ— æ³•æ‹¦æˆª</td></tr><tr><td><strong>è·¨å¹³å°èƒ½åŠ›</strong></td><td>âŒ éœ€è¦å„ç«¯é€‚é…</td><td>âœ… Web æ ‡å‡†ï¼Œé€šç”¨</td></tr><tr><td><strong>æ›´æ–°é€Ÿåº¦</strong></td><td>âš ï¸ éœ€è¦å‘ç‰ˆ</td><td>âœ… å®æ—¶ç”Ÿæ•ˆ</td></tr><tr><td><strong>å¼€å‘æˆæœ¬</strong></td><td>âš ï¸ éœ€è¦ç«¯ä¸Šå¼€å‘</td><td>âš ï¸ éœ€è¦ Web å¼€å‘</td></tr><tr><td><strong>ç»´æŠ¤æˆæœ¬</strong></td><td>âŒ å¤šç«¯ç»´æŠ¤</td><td>âœ… å•ä¸€ç»´æŠ¤</td></tr><tr><td><strong>çµæ´»æ€§</strong></td><td>âš ï¸ å—é™äºå®¢æˆ·ç«¯ç‰ˆæœ¬</td><td>âœ… å®Œå…¨å¯æ§</td></tr><tr><td><strong>é™çº§èƒ½åŠ›</strong></td><td>âš ï¸ éœ€è¦å‘ç‰ˆå›æ»š</td><td>âœ… ç§’çº§é™çº§</td></tr></tbody></table>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>å¦‚æœä½ çš„ä¸šåŠ¡æ˜¯çº¯ Web åº”ç”¨ï¼ˆPWA) â†’ Service Worker æ˜¯æœ€ä½³é€‰æ‹©</li>
<li>å¦‚æœä½ çš„ä¸šåŠ¡åœ¨ App å†… â†’ ä¼˜å…ˆè€ƒè™‘å®¢æˆ·ç«¯æ–¹æ¡ˆ</li>
</ul>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F337624473" target="_blank" title="https://zhuanlan.zhihu.com/p/337624473" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/337624473</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nettyï¼ˆ11ï¼‰ Nettyçš„å¿ƒè·³æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ]]></title>    <link>https://juejin.cn/post/7583799807594283042</link>    <guid>https://juejin.cn/post/7583799807594283042</guid>    <pubDate>2025-12-15T12:01:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583799807594283042" data-draft-id="7583891046206193716" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nettyï¼ˆ11ï¼‰ Nettyçš„å¿ƒè·³æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T12:01:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nettyï¼ˆ11ï¼‰ Nettyçš„å¿ƒè·³æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:01:02.000Z" title="Mon Dec 15 2025 12:01:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nettyçš„å¿ƒè·³æœºåˆ¶æ˜¯ä¸€ç§ç”¨äºä¿æŒé•¿è¿æ¥çš„æœºåˆ¶ï¼Œå®ƒé€šè¿‡å®šæœŸå‘é€å¿ƒè·³æ¶ˆæ¯æ¥æ£€æµ‹è¿æ¥çš„çŠ¶æ€ï¼Œå¹¶ç¡®ä¿è¿æ¥ä¿æŒæ´»è·ƒã€‚å¿ƒè·³æœºåˆ¶å¯ä»¥ç”¨äºæ£€æµ‹ç½‘ç»œæ•…éšœã€æ–­å¼€è¿æ¥å’Œè¶…æ—¶ç­‰é—®é¢˜ï¼Œå¹¶é‡‡å–ç›¸åº”çš„å¤„ç†æªæ–½ã€‚</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦å¿ƒè·³æœºåˆ¶å‘¢ï¼Ÿæœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š</p>
<ol>
<li>
<p>æ£€æµ‹è¿æ¥çŠ¶æ€ï¼šé€šè¿‡å®šæœŸå‘é€å¿ƒè·³æ¶ˆæ¯ï¼Œå¯ä»¥æ£€æµ‹è¿æ¥æ˜¯å¦ä»ç„¶æ´»è·ƒã€‚å¦‚æœé•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°å¿ƒè·³å“åº”ï¼Œå°±å¯ä»¥åˆ¤æ–­è¿æ¥å¯èƒ½å·²ç»æ–­å¼€æˆ–å‘ç”Ÿäº†æ•…éšœã€‚</p>
</li>
<li>
<p>é˜²æ­¢è¿æ¥è¶…æ—¶ï¼šåœ¨ä¸€äº›ç½‘ç»œç¯å¢ƒä¸­ï¼Œå¯èƒ½å­˜åœ¨è¿æ¥ç©ºé—²æ—¶é—´è¿‡é•¿çš„æƒ…å†µï¼Œæ¯”å¦‚é˜²ç«å¢™ã€ä»£ç†æœåŠ¡å™¨ç­‰ã€‚é€šè¿‡å‘é€å¿ƒè·³æ¶ˆæ¯ï¼Œå¯ä»¥ä¿æŒè¿æ¥çš„æ´»è·ƒçŠ¶æ€ï¼Œé¿å…è¿æ¥è¢«é˜²ç«å¢™æˆ–ä»£ç†æœåŠ¡å™¨å…³é—­ã€‚</p>
</li>
<li>
<p>ä¼˜åŒ–ç½‘ç»œæ€§èƒ½ï¼šå¿ƒè·³æ¶ˆæ¯é€šå¸¸æ˜¯å¾ˆå°çš„æ•°æ®åŒ…ï¼Œç›¸å¯¹äºä¸šåŠ¡æ•°æ®æ¥è¯´ï¼Œå®ƒçš„ä¼ è¾“å¼€é”€è¾ƒå°ã€‚é€šè¿‡å®šæœŸå‘é€å¿ƒè·³æ¶ˆæ¯ï¼Œå¯ä»¥ä¿æŒè¿æ¥çš„æ´»è·ƒçŠ¶æ€ï¼Œå‡å°‘è¿æ¥å»ºç«‹å’Œå…³é—­çš„å¼€é”€ï¼Œä»è€Œæé«˜ç½‘ç»œæ€§èƒ½ã€‚</p>
</li>
</ol>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨Nettyå®ç°å¿ƒè·³æœºåˆ¶çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.Bootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelOption;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.timeout.IdleState;
<span class="hljs-keyword">import</span> io.netty.handler.timeout.IdleStateEvent;
<span class="hljs-keyword">import</span> io.netty.handler.timeout.IdleStateHandler;

<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeartbeatClient</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String host;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> port;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HeartbeatClient</span><span class="hljs-params">(String host, <span class="hljs-type">int</span> port)</span> {
        <span class="hljs-built_in">this</span>.host = host;
        <span class="hljs-built_in">this</span>.port = port;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Bootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bootstrap</span>();
            b.group(group)
                    .channel(NioSocketChannel.class)
                    .option(ChannelOption.SO_KEEPALIVE, <span class="hljs-literal">true</span>)
                    .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IdleStateHandler</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, TimeUnit.SECONDS));
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HeartbeatHandler</span>());
                        }
                    });

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> b.connect(host, port).sync();
            f.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            group.shutdownGracefully();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">host</span> <span class="hljs-operator">=</span> <span class="hljs-string">"localhost"</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;
        <span class="hljs-type">HeartbeatClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HeartbeatClient</span>(host, port);
        client.run();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeartbeatHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ByteBuf</span> <span class="hljs-variable">HEARTBEAT_MESSAGE</span> <span class="hljs-operator">=</span> Unpooled.unreleasableBuffer(Unpooled.copiedBuffer(<span class="hljs-string">"Heartbeat"</span>, CharsetUtil.UTF_8));

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">userEventTriggered</span><span class="hljs-params">(ChannelHandlerContext ctx, Object evt)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">if</span> (evt <span class="hljs-keyword">instanceof</span> IdleStateEvent) {
            <span class="hljs-type">IdleStateEvent</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> (IdleStateEvent) evt;
            <span class="hljs-keyword">if</span> (event.state() == IdleState.WRITER_IDLE) {
                ctx.writeAndFlush(HEARTBEAT_MESSAGE);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">super</span>.userEventTriggered(ctx, evt);
        }
    }
}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªHeartbeatClientç±»ï¼Œå®ƒè´Ÿè´£å¯åŠ¨å®¢æˆ·ç«¯å¹¶å®ç°å¿ƒè·³æœºåˆ¶ã€‚åœ¨run()æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨NioEventLoopGroupåˆ›å»ºäº†ä¸€ä¸ªEventLoopGroupï¼Œç”¨äºå¤„ç†å®¢æˆ·ç«¯çš„I/Oæ“ä½œã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨Bootstrapæ¥é…ç½®å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬æŒ‡å®šäº†å®¢æˆ·ç«¯çš„é€šé“ç±»å‹ä¸ºNioSocketChannelï¼Œå¹¶è®¾ç½®äº†SO_KEEPALIVEé€‰é¡¹ä¸ºtrueï¼Œä»¥ä¿æŒé•¿è¿æ¥ã€‚æˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€ä¸ªIdleStateHandlerï¼Œç”¨äºæ£€æµ‹è¿æ¥çš„ç©ºé—²çŠ¶æ€ã€‚</p>
<p>åœ¨HeartbeatHandlerä¸­ï¼Œæˆ‘ä»¬ç»§æ‰¿ChannelInboundHandlerAdapterï¼Œå¹¶é‡å†™äº†userEventTriggered()æ–¹æ³•ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ ¹æ®IdleStateEventçš„çŠ¶æ€æ¥åˆ¤æ–­æ˜¯å¦å‘é€å¿ƒè·³æ¶ˆæ¯ã€‚å¦‚æœè¿æ¥å¤„äºå†™ç©ºé—²çŠ¶æ€ï¼Œå³é•¿æ—¶é—´æ²¡æœ‰å†™æ“ä½œï¼Œæˆ‘ä»¬å°±å‘é€ä¸€ä¸ªå¿ƒè·³æ¶ˆæ¯ã€‚</p>
<p>é€šè¿‡ä½¿ç”¨IdleStateHandlerå’ŒHeartbeatHandlerï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å®¢æˆ·ç«¯çš„å¿ƒè·³æœºåˆ¶ï¼Œå®šæœŸå‘é€å¿ƒè·³æ¶ˆæ¯ä»¥ä¿æŒè¿æ¥çš„æ´»è·ƒçŠ¶æ€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nettyï¼ˆ12ï¼‰Nettyæ”¯æŒå“ªäº›åè®®å’Œä¼ è¾“æ–¹å¼ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7583891046206226484</link>    <guid>https://juejin.cn/post/7583891046206226484</guid>    <pubDate>2025-12-15T12:02:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583891046206226484" data-draft-id="7583891046206210100" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nettyï¼ˆ12ï¼‰Nettyæ”¯æŒå“ªäº›åè®®å’Œä¼ è¾“æ–¹å¼ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T12:02:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nettyï¼ˆ12ï¼‰Nettyæ”¯æŒå“ªäº›åè®®å’Œä¼ è¾“æ–¹å¼ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:02:00.000Z" title="Mon Dec 15 2025 12:02:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nettyæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ç½‘ç»œåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå®ƒæ”¯æŒå¤šç§åè®®å’Œä¼ è¾“æ–¹å¼ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„åè®®å’Œä¼ è¾“æ–¹å¼ï¼Œä»¥åŠä½¿ç”¨Nettyå®ç°çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<ol>
<li>TCPåè®®ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.ServerBootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelOption;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TcpServer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> port;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TcpServer</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> {
        <span class="hljs-built_in">this</span>.port = port;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">bossGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">workerGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
            b.group(bossGroup, workerGroup)
                    .channel(NioServerSocketChannel.class)
                    .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TcpServerHandler</span>());
                        }
                    })
                    .option(ChannelOption.SO_BACKLOG, <span class="hljs-number">128</span>)
                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="hljs-literal">true</span>);

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> b.bind(port).sync();
            f.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            workerGroup.shutdownGracefully();
            bossGroup.shutdownGracefully();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;
        <span class="hljs-type">TcpServer</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TcpServer</span>(port);
        server.run();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TcpServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<ol start="2">
<li>UDPåè®®ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.Bootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelOption;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.DatagramChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioDatagramChannel;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UdpServer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> port;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UdpServer</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> {
        <span class="hljs-built_in">this</span>.port = port;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Bootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bootstrap</span>();
            b.group(group)
                    .channel(NioDatagramChannel.class)
                    .option(ChannelOption.SO_BROADCAST, <span class="hljs-literal">true</span>)
                    .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;DatagramChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(DatagramChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UdpServerHandler</span>());
                        }
                    });

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> b.bind(port).sync();
            f.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            group.shutdownGracefully();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;
        <span class="hljs-type">UdpServer</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UdpServer</span>(port);
        server.run();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UdpServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleChannelInboundHandler</span>&lt;DatagramPacket&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, DatagramPacket msg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<ol start="3">
<li>HTTPåè®®ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.ServerBootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelOption;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpObjectAggregator;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpServerCodec;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpServer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> port;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HttpServer</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> {
        <span class="hljs-built_in">this</span>.port = port;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">bossGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">workerGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
            b.group(bossGroup, workerGroup)
                    .channel(NioServerSocketChannel.class)
                    .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServerCodec</span>());
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpObjectAggregator</span>(<span class="hljs-number">65536</span>));
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServerHandler</span>());
                        }
                    })
                    .option(ChannelOption.SO_BACKLOG, <span class="hljs-number">128</span>)
                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="hljs-literal">true</span>);

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> b.bind(port).sync();
            f.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            workerGroup.shutdownGracefully();
            bossGroup.shutdownGracefully();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;
        <span class="hljs-type">HttpServer</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServer</span>(port);
        server.run();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleChannelInboundHandler</span>&lt;FullHttpRequest&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, FullHttpRequest request)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†HTTPè¯·æ±‚</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<ol start="4">
<li>WebSocketåè®®ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.ServerBootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelOption;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpObjectAggregator;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpServerCodec;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.websocketx.WebSocketFrameAggregator;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.websocketx.WebSocketServerProtocolHandler;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketServer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> port;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WebSocketServer</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> {
        <span class="hljs-built_in">this</span>.port = port;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">bossGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">workerGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
            b.group(bossGroup, workerGroup)
                    .channel(NioServerSocketChannel.class)
                    .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServerCodec</span>());
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpObjectAggregator</span>(<span class="hljs-number">65536</span>));
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketFrameAggregator</span>(<span class="hljs-number">65536</span>));
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketServerProtocolHandler</span>(<span class="hljs-string">"/websocket"</span>));
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketServerHandler</span>());
                        }
                    })
                    .option(ChannelOption.SO_BACKLOG, <span class="hljs-number">128</span>)
                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="hljs-literal">true</span>);

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> b.bind(port).sync();
            f.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            workerGroup.shutdownGracefully();
            bossGroup.shutdownGracefully();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;
        <span class="hljs-type">WebSocketServer</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketServer</span>(port);
        server.run();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleChannelInboundHandler</span>&lt;WebSocketFrame&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, WebSocketFrame frame)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†WebSocketå¸§</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä»£ç å±•ç¤ºäº†ä½¿ç”¨Nettyå®ç°TCPã€UDPã€HTTPå’ŒWebSocketåè®®çš„æœåŠ¡å™¨ã€‚é€šè¿‡ä½¿ç”¨ä¸åŒçš„Channelå’Œå¤„ç†å™¨ï¼Œå¯ä»¥å®ç°ä¸åŒåè®®çš„æ”¯æŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js å·¥å…·æ¨¡å—è¯¦è§£]]></title>    <link>https://juejin.cn/post/7583910637957578771</link>    <guid>https://juejin.cn/post/7583910637957578771</guid>    <pubDate>2025-12-15T09:34:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910637957578771" data-draft-id="7582393212767404086" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js å·¥å…·æ¨¡å—è¯¦è§£"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-15T09:34:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¢¨å­åŒå¿—"/> <meta itemprop="url" content="https://juejin.cn/user/2084329779627965"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js å·¥å…·æ¨¡å—è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2084329779627965/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¢¨å­åŒå¿—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:34:36.000Z" title="Mon Dec 15 2025 09:34:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Node.js æä¾›äº†ä¸°å¯Œçš„å†…ç½®æ¨¡å—ï¼Œå¸®åŠ©å¼€å‘è€…é«˜æ•ˆå¤„ç†å„ç§å¸¸è§ä»»åŠ¡ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»äº”ä¸ªé‡è¦çš„å·¥å…·æ¨¡å—ï¼š<strong>path</strong>ï¼ˆè·¯å¾„å¤„ç†ï¼‰ã€<strong>url</strong>ï¼ˆURLè§£æï¼‰ã€<strong>querystring</strong>ï¼ˆæŸ¥è¯¢å­—ç¬¦ä¸²ï¼‰ã€<strong>util</strong>ï¼ˆå·¥å…·å‡½æ•°ï¼‰å’Œ <strong>os</strong>ï¼ˆæ“ä½œç³»ç»Ÿä¿¡æ¯ï¼‰ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€path æ¨¡å—ï¼šè·¯å¾„å¤„ç†</h2>
<p><code>path</code> æ¨¡å—æä¾›äº†ç”¨äºå¤„ç†å’Œè½¬æ¢æ–‡ä»¶è·¯å¾„çš„å®ç”¨å·¥å…·ã€‚å®ƒæœ€å¤§çš„ä¼˜åŠ¿æ˜¯<strong>è·¨å¹³å°å…¼å®¹æ€§</strong>ï¼Œèƒ½å¤Ÿè‡ªåŠ¨å¤„ç†ä¸åŒæ“ä½œç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦ï¼ˆWindows ä½¿ç”¨ <code>\</code>ï¼ŒUnix/Linux/macOS ä½¿ç”¨ <code>/</code>ï¼‰ã€‚</p>
<h3 data-id="heading-1">1.1 å¼•å…¥æ¨¡å—</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
</code></pre>
<h3 data-id="heading-2">1.2 å¸¸ç”¨æ–¹æ³•</h3>
<h4 data-id="heading-3"><code>path.join([...paths])</code> - è¿æ¥è·¯å¾„ç‰‡æ®µ</h4>
<p>å°†å¤šä¸ªè·¯å¾„ç‰‡æ®µè¿æ¥æˆä¸€ä¸ªå®Œæ•´çš„è·¯å¾„ï¼Œè‡ªåŠ¨å¤„ç†è·¯å¾„åˆ†éš”ç¬¦å’Œç›¸å¯¹è·¯å¾„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-comment">// åŸºæœ¬ç”¨æ³•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">join</span>(<span class="hljs-string">'/users'</span>, <span class="hljs-string">'john'</span>, <span class="hljs-string">'docs'</span>, <span class="hljs-string">'file.txt'</span>));
<span class="hljs-comment">// Unix/Linux/macOS: /users/john/docs/file.txt</span>
<span class="hljs-comment">// Windows: å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç»å¯¹è·¯å¾„ï¼Œç»“æœå–å†³äºå¹³å°</span>

<span class="hljs-comment">// è·¨å¹³å°æ¨èç”¨æ³•ï¼ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">join</span>(<span class="hljs-string">'users'</span>, <span class="hljs-string">'john'</span>, <span class="hljs-string">'docs'</span>, <span class="hljs-string">'file.txt'</span>));
<span class="hljs-comment">// æ‰€æœ‰å¹³å°: users/john/docs/file.txtï¼ˆç›¸å¯¹è·¯å¾„ï¼‰</span>

<span class="hljs-comment">// ä½¿ç”¨ __dirname æ„å»ºç»å¯¹è·¯å¾„</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'docs'</span>, <span class="hljs-string">'file.txt'</span>));
<span class="hljs-comment">// è¾“å‡º: å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•/docs/file.txt</span>

<span class="hljs-comment">// å¤„ç†ç›¸å¯¹è·¯å¾„</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">join</span>(<span class="hljs-string">'/foo'</span>, <span class="hljs-string">'bar'</span>, <span class="hljs-string">'baz/asdf'</span>, <span class="hljs-string">'quux'</span>, <span class="hljs-string">'..'</span>));
<span class="hljs-comment">// è¾“å‡º: /foo/bar/baz/asdf</span>

<span class="hljs-comment">// å¤„ç†å½“å‰ç›®å½•å’Œçˆ¶ç›®å½•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'..'</span>, <span class="hljs-string">'config'</span>, <span class="hljs-string">'app.json'</span>));
<span class="hljs-comment">// è¾“å‡º: å½“å‰ç›®å½•çš„çˆ¶ç›®å½•ä¸‹çš„ config/app.json</span>
</code></pre>
<h4 data-id="heading-4"><code>path.resolve([...paths])</code> - è§£æä¸ºç»å¯¹è·¯å¾„</h4>
<p>å°†è·¯å¾„æˆ–è·¯å¾„ç‰‡æ®µè§£æä¸ºç»å¯¹è·¯å¾„ã€‚å¦‚æœæ‰€æœ‰è·¯å¾„ç‰‡æ®µéƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•è§£æã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-comment">// ä»å³åˆ°å·¦å¤„ç†è·¯å¾„ï¼Œç›´åˆ°æ„é€ å‡ºç»å¯¹è·¯å¾„</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'foo/bar'</span>, <span class="hljs-string">'/tmp/file/'</span>, <span class="hljs-string">'..'</span>, <span class="hljs-string">'a/../subfile'</span>));
<span class="hljs-comment">// è¾“å‡º: /tmp/subfile</span>

<span class="hljs-comment">// å¦‚æœæ‰€æœ‰è·¯å¾„éƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'wwwroot'</span>, <span class="hljs-string">'static_files/png/'</span>, <span class="hljs-string">'../gif/image.gif'</span>));
<span class="hljs-comment">// å¦‚æœå½“å‰ç›®å½•æ˜¯ /home/myself/nodeï¼Œåˆ™è¾“å‡º:</span>
<span class="hljs-comment">// /home/myself/node/wwwroot/static_files/gif/image.gif</span>

<span class="hljs-comment">// å¸¸ç”¨ï¼šè§£æç›¸å¯¹äºå½“å‰æ–‡ä»¶çš„è·¯å¾„</span>
<span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'config.json'</span>);
</code></pre>
<h4 data-id="heading-5"><code>path.basename(path[, ext])</code> - è·å–æ–‡ä»¶å</h4>
<p>è¿”å›è·¯å¾„çš„æœ€åä¸€éƒ¨åˆ†ï¼ˆæ–‡ä»¶åï¼‰ã€‚å¯é€‰çš„ <code>ext</code> å‚æ•°ç”¨äºå»é™¤æ–‡ä»¶æ‰©å±•åã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">basename</span>(<span class="hljs-string">'/foo/bar/baz/asdf/quux.html'</span>));
<span class="hljs-comment">// è¾“å‡º: 'quux.html'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">basename</span>(<span class="hljs-string">'/foo/bar/baz/asdf/quux.html'</span>, <span class="hljs-string">'.html'</span>));
<span class="hljs-comment">// è¾“å‡º: 'quux'</span>

<span class="hljs-comment">// Windows ç¤ºä¾‹</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">basename</span>(<span class="hljs-string">'C:\\temp\\myfile.html'</span>));
<span class="hljs-comment">// è¾“å‡º: 'myfile.html'</span>
</code></pre>
<h4 data-id="heading-6"><code>path.dirname(path)</code> - è·å–ç›®å½•å</h4>
<p>è¿”å›è·¯å¾„çš„ç›®å½•éƒ¨åˆ†ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">dirname</span>(<span class="hljs-string">'/foo/bar/baz/asdf/quux.html'</span>));
<span class="hljs-comment">// è¾“å‡º: '/foo/bar/baz/asdf'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">dirname</span>(<span class="hljs-string">'/foo/bar/baz/asdf/quux'</span>));
<span class="hljs-comment">// è¾“å‡º: '/foo/bar/baz/asdf'</span>
</code></pre>
<h4 data-id="heading-7"><code>path.extname(path)</code> - è·å–æ‰©å±•å</h4>
<p>è¿”å›è·¯å¾„ä¸­æ–‡ä»¶çš„æ‰©å±•åï¼ˆåŒ…æ‹¬ç‚¹å·ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">extname</span>(<span class="hljs-string">'index.html'</span>));
<span class="hljs-comment">// è¾“å‡º: '.html'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">extname</span>(<span class="hljs-string">'index.coffee.md'</span>));
<span class="hljs-comment">// è¾“å‡º: '.md'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">extname</span>(<span class="hljs-string">'index.'</span>));
<span class="hljs-comment">// è¾“å‡º: '.'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">extname</span>(<span class="hljs-string">'index'</span>));
<span class="hljs-comment">// è¾“å‡º: ''</span>
</code></pre>
<h4 data-id="heading-8"><code>path.parse(path)</code> - è§£æè·¯å¾„å¯¹è±¡</h4>
<p>å°†è·¯å¾„å­—ç¬¦ä¸²è§£æä¸ºä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« <code>root</code>ã€<code>dir</code>ã€<code>base</code>ã€<code>ext</code>ã€<code>name</code> ç­‰å±æ€§ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">const</span> parsed = path.<span class="hljs-title function_">parse</span>(<span class="hljs-string">'/home/user/dir/file.txt'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parsed);
<span class="hljs-comment">// è¾“å‡º:</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   root: '/',</span>
<span class="hljs-comment">//   dir: '/home/user/dir',</span>
<span class="hljs-comment">//   base: 'file.txt',</span>
<span class="hljs-comment">//   ext: '.txt',</span>
<span class="hljs-comment">//   name: 'file'</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// Windows ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> winParsed = path.<span class="hljs-title function_">parse</span>(<span class="hljs-string">'C:\\path\\dir\\file.txt'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(winParsed);
<span class="hljs-comment">// è¾“å‡º:</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   root: 'C:\\',</span>
<span class="hljs-comment">//   dir: 'C:\\path\\dir',</span>
<span class="hljs-comment">//   base: 'file.txt',</span>
<span class="hljs-comment">//   ext: '.txt',</span>
<span class="hljs-comment">//   name: 'file'</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h4 data-id="heading-9"><code>path.format(pathObject)</code> - æ ¼å¼åŒ–è·¯å¾„å¯¹è±¡</h4>
<p>ä¸ <code>path.parse()</code> ç›¸åï¼Œå°†è·¯å¾„å¯¹è±¡æ ¼å¼åŒ–ä¸ºè·¯å¾„å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">const</span> pathObject = {
  <span class="hljs-attr">root</span>: <span class="hljs-string">'/'</span>,
  <span class="hljs-attr">dir</span>: <span class="hljs-string">'/home/user/dir'</span>,
  <span class="hljs-attr">base</span>: <span class="hljs-string">'file.txt'</span>,
  <span class="hljs-attr">ext</span>: <span class="hljs-string">'.txt'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'file'</span>
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">format</span>(pathObject));
<span class="hljs-comment">// è¾“å‡º: '/home/user/dir/file.txt'</span>
</code></pre>
<h4 data-id="heading-10"><code>path.normalize(path)</code> - è§„èŒƒåŒ–è·¯å¾„</h4>
<p>è§„èŒƒåŒ–è·¯å¾„å­—ç¬¦ä¸²ï¼Œè§£æ <code>.</code> å’Œ <code>..</code> ç‰‡æ®µï¼Œå¹¶å¤„ç†å¤šä½™çš„è·¯å¾„åˆ†éš”ç¬¦ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">normalize</span>(<span class="hljs-string">'/foo/bar//baz/asdf/quux/..'</span>));
<span class="hljs-comment">// è¾“å‡º: '/foo/bar/baz/asdf'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">normalize</span>(<span class="hljs-string">'C:\\temp\\\\foo\\bar\\..\\'</span>));
<span class="hljs-comment">// Windows è¾“å‡º: 'C:\\temp\\foo\\'</span>
</code></pre>
<h4 data-id="heading-11"><code>path.isAbsolute(path)</code> - åˆ¤æ–­æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„</h4>
<p>åˆ¤æ–­è·¯å¾„æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">isAbsolute</span>(<span class="hljs-string">'/foo/bar'</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">isAbsolute</span>(<span class="hljs-string">'/baz/..'</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">isAbsolute</span>(<span class="hljs-string">'qux/'</span>));     <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">isAbsolute</span>(<span class="hljs-string">'.'</span>));        <span class="hljs-comment">// false</span>

<span class="hljs-comment">// Windows</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">isAbsolute</span>(<span class="hljs-string">'C:\\foo'</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">isAbsolute</span>(<span class="hljs-string">'\\foo'</span>));    <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-12"><code>path.relative(from, to)</code> - è®¡ç®—ç›¸å¯¹è·¯å¾„</h4>
<p>è®¡ç®—ä» <code>from</code> åˆ° <code>to</code> çš„ç›¸å¯¹è·¯å¾„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">relative</span>(<span class="hljs-string">'/data/orandea/test/aaa'</span>, <span class="hljs-string">'/data/orandea/impl/bbb'</span>));
<span class="hljs-comment">// è¾“å‡º: '../../impl/bbb'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">relative</span>(<span class="hljs-string">'C:\\orandea\\test\\aaa'</span>, <span class="hljs-string">'C:\\orandea\\impl\\bbb'</span>));
<span class="hljs-comment">// Windows è¾“å‡º: '..\\..\\impl\\bbb'</span>
</code></pre>
<h3 data-id="heading-13">1.3 ç‰¹æ®Šå˜é‡</h3>
<ul>
<li><strong><code>__dirname</code></strong>ï¼šå½“å‰æ¨¡å—çš„ç›®å½•åï¼ˆCommonJSï¼‰</li>
<li><strong><code>__filename</code></strong>ï¼šå½“å‰æ¨¡å—çš„æ–‡ä»¶åï¼ˆCommonJSï¼‰</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-comment">// è·å–å½“å‰æ–‡ä»¶çš„ç›®å½•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(__dirname);
<span class="hljs-comment">// è¾“å‡º: /path/to/current/directory</span>

<span class="hljs-comment">// è·å–å½“å‰æ–‡ä»¶çš„å®Œæ•´è·¯å¾„</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(__filename);
<span class="hljs-comment">// è¾“å‡º: /path/to/current/directory/file.js</span>

<span class="hljs-comment">// æ„å»ºç›¸å¯¹äºå½“å‰æ–‡ä»¶çš„è·¯å¾„</span>
<span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'config'</span>, <span class="hljs-string">'app.json'</span>);
</code></pre>
<h3 data-id="heading-14">1.4 å®ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>).<span class="hljs-property">promises</span>;

<span class="hljs-comment">// ç¤ºä¾‹1ï¼šå®‰å…¨åœ°æ„å»ºæ–‡ä»¶è·¯å¾„</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readConfig</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'config'</span>, <span class="hljs-string">'app.json'</span>);
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(configPath, <span class="hljs-string">'utf8'</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
}

<span class="hljs-comment">// ç¤ºä¾‹2ï¼šè·å–æ–‡ä»¶ä¿¡æ¯</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getFileInfo</span>(<span class="hljs-params">filePath</span>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">fullPath</span>: path.<span class="hljs-title function_">resolve</span>(filePath),
    <span class="hljs-attr">dirname</span>: path.<span class="hljs-title function_">dirname</span>(filePath),
    <span class="hljs-attr">basename</span>: path.<span class="hljs-title function_">basename</span>(filePath),
    <span class="hljs-attr">extname</span>: path.<span class="hljs-title function_">extname</span>(filePath),
    <span class="hljs-attr">name</span>: path.<span class="hljs-title function_">basename</span>(filePath, path.<span class="hljs-title function_">extname</span>(filePath))
  };
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getFileInfo</span>(<span class="hljs-string">'/home/user/docs/report.pdf'</span>));
<span class="hljs-comment">// è¾“å‡º:</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   fullPath: '/home/user/docs/report.pdf',</span>
<span class="hljs-comment">//   dirname: '/home/user/docs',</span>
<span class="hljs-comment">//   basename: 'report.pdf',</span>
<span class="hljs-comment">//   extname: '.pdf',</span>
<span class="hljs-comment">//   name: 'report'</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// ç¤ºä¾‹3ï¼šå¤„ç†ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isImageFile</span>(<span class="hljs-params">filename</span>) {
  <span class="hljs-keyword">const</span> ext = path.<span class="hljs-title function_">extname</span>(filename).<span class="hljs-title function_">toLowerCase</span>();
  <span class="hljs-keyword">return</span> [<span class="hljs-string">'.jpg'</span>, <span class="hljs-string">'.jpeg'</span>, <span class="hljs-string">'.png'</span>, <span class="hljs-string">'.gif'</span>, <span class="hljs-string">'.webp'</span>].<span class="hljs-title function_">includes</span>(ext);
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isImageFile</span>(<span class="hljs-string">'photo.jpg'</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isImageFile</span>(<span class="hljs-string">'document.pdf'</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<hr/>
<h2 data-id="heading-15">äºŒã€url æ¨¡å—ï¼šURL è§£æ</h2>
<p><code>url</code> æ¨¡å—æä¾›äº†ç”¨äºè§£æå’Œæ ¼å¼åŒ– URL çš„å®ç”¨å·¥å…·ã€‚Node.js æ¨èä½¿ç”¨ <strong>WHATWG URL API</strong>ã€‚</p>
<h3 data-id="heading-16">2.1 å¼•å…¥æ¨¡å—</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// WHATWG URL APIï¼ˆæ¨èï¼‰</span>
<span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">URL</span>, <span class="hljs-title class_">URLSearchParams</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);
</code></pre>
<h3 data-id="heading-17">2.2 WHATWG URL APIï¼ˆæ¨èï¼‰</h3>
<h4 data-id="heading-18"><code>new URL(input[, base])</code> - åˆ›å»º URL å¯¹è±¡</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">URL</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// ç»å¯¹ URL</span>
<span class="hljs-keyword">const</span> myURL = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'https://example.org:8080/p/a/t/h?query=string#hash'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">href</span>);        <span class="hljs-comment">// 'https://example.org:8080/p/a/t/h?query=string#hash'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">protocol</span>);    <span class="hljs-comment">// 'https:'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">hostname</span>);    <span class="hljs-comment">// 'example.org'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">port</span>);        <span class="hljs-comment">// '8080'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">pathname</span>);    <span class="hljs-comment">// '/p/a/t/h'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">search</span>);      <span class="hljs-comment">// '?query=string'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">hash</span>);        <span class="hljs-comment">// '#hash'</span>

<span class="hljs-comment">// ç›¸å¯¹ URLï¼ˆéœ€è¦æä¾› baseï¼‰</span>
<span class="hljs-keyword">const</span> baseURL = <span class="hljs-string">'https://example.org/foo/bar'</span>;
<span class="hljs-keyword">const</span> relativeURL = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'../baz'</span>, baseURL);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(relativeURL.<span class="hljs-property">href</span>);  <span class="hljs-comment">// 'https://example.org/foo/baz'</span>
</code></pre>
<h4 data-id="heading-19">URL å¯¹è±¡å±æ€§</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">URL</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);
<span class="hljs-keyword">const</span> myURL = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'https://user:pass@sub.example.com:8080/p/a/t/h?query=string#hash'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">protocol</span>);    <span class="hljs-comment">// 'https:'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">username</span>);    <span class="hljs-comment">// 'user'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">password</span>);    <span class="hljs-comment">// 'pass'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">host</span>);        <span class="hljs-comment">// 'sub.example.com:8080'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">hostname</span>);    <span class="hljs-comment">// 'sub.example.com'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">port</span>);        <span class="hljs-comment">// '8080'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">pathname</span>);    <span class="hljs-comment">// '/p/a/t/h'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">search</span>);      <span class="hljs-comment">// '?query=string'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">searchParams</span>); <span class="hljs-comment">// URLSearchParams å¯¹è±¡</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">hash</span>);        <span class="hljs-comment">// '#hash'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">origin</span>);      <span class="hljs-comment">// 'https://sub.example.com:8080'</span>
</code></pre>
<h4 data-id="heading-20"><code>URLSearchParams</code> - æŸ¥è¯¢å‚æ•°å¤„ç†</h4>
<p><code>URLSearchParams</code> æä¾›äº†å¼ºå¤§çš„æŸ¥è¯¢å­—ç¬¦ä¸²æ“ä½œæ–¹æ³•ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">URL</span>, <span class="hljs-title class_">URLSearchParams</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// ä» URL å¯¹è±¡è·å–æŸ¥è¯¢å‚æ•°</span>
<span class="hljs-keyword">const</span> myURL = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'https://example.com/?name=Kai&amp;age=30&amp;city=Beijing'</span>);
<span class="hljs-keyword">const</span> params = myURL.<span class="hljs-property">searchParams</span>;

<span class="hljs-comment">// è·å–å‚æ•°å€¼</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params.<span class="hljs-title function_">get</span>(<span class="hljs-string">'name'</span>));     <span class="hljs-comment">// 'Kai'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params.<span class="hljs-title function_">get</span>(<span class="hljs-string">'age'</span>));     <span class="hljs-comment">// '30'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params.<span class="hljs-title function_">has</span>(<span class="hljs-string">'city'</span>));    <span class="hljs-comment">// true</span>

<span class="hljs-comment">// è®¾ç½®å‚æ•°</span>
params.<span class="hljs-title function_">set</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'31'</span>);
params.<span class="hljs-title function_">set</span>(<span class="hljs-string">'email'</span>, <span class="hljs-string">'kai@example.com'</span>);

<span class="hljs-comment">// è¿½åŠ å‚æ•°</span>
params.<span class="hljs-title function_">append</span>(<span class="hljs-string">'hobby'</span>, <span class="hljs-string">'coding'</span>);
params.<span class="hljs-title function_">append</span>(<span class="hljs-string">'hobby'</span>, <span class="hljs-string">'reading'</span>);

<span class="hljs-comment">// åˆ é™¤å‚æ•°</span>
params.<span class="hljs-title function_">delete</span>(<span class="hljs-string">'city'</span>);

<span class="hljs-comment">// è·å–æ‰€æœ‰å€¼</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params.<span class="hljs-title function_">getAll</span>(<span class="hljs-string">'hobby'</span>)); <span class="hljs-comment">// ['coding', 'reading']</span>

<span class="hljs-comment">// éå†å‚æ•°</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> params) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${key}</span>: <span class="hljs-subst">${value}</span>`</span>);
}

<span class="hljs-comment">// è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params.<span class="hljs-title function_">toString</span>());
<span class="hljs-comment">// è¾“å‡º: 'name=Kai&amp;age=31&amp;email=kai%40example.com&amp;hobby=coding&amp;hobby=reading'</span>

<span class="hljs-comment">// æ’åº</span>
params.<span class="hljs-title function_">sort</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params.<span class="hljs-title function_">toString</span>());
</code></pre>
<h4 data-id="heading-21">ç‹¬ç«‹ä½¿ç”¨ URLSearchParams</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">URLSearchParams</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// ä»å­—ç¬¦ä¸²åˆ›å»º</span>
<span class="hljs-keyword">const</span> params1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(<span class="hljs-string">'foo=bar&amp;abc=xyz&amp;abc=123'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params1.<span class="hljs-title function_">get</span>(<span class="hljs-string">'foo'</span>));      <span class="hljs-comment">// 'bar'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params1.<span class="hljs-title function_">getAll</span>(<span class="hljs-string">'abc'</span>));   <span class="hljs-comment">// ['xyz', '123']</span>

<span class="hljs-comment">// ä»å¯¹è±¡åˆ›å»º</span>
<span class="hljs-keyword">const</span> params2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>({
  <span class="hljs-attr">user</span>: <span class="hljs-string">'admin'</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">'secret123'</span>
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params2.<span class="hljs-title function_">toString</span>());     <span class="hljs-comment">// 'user=admin&amp;password=secret123'</span>

<span class="hljs-comment">// ä» Map åˆ›å»º</span>
<span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([
  [<span class="hljs-string">'name'</span>, <span class="hljs-string">'John'</span>],
  [<span class="hljs-string">'age'</span>, <span class="hljs-string">'30'</span>]
]);
<span class="hljs-keyword">const</span> params3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(map);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params3.<span class="hljs-title function_">toString</span>());      <span class="hljs-comment">// 'name=John&amp;age=30'</span>
</code></pre>
<h3 data-id="heading-22">2.3 å®ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">URL</span>, <span class="hljs-title class_">URLSearchParams</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// ç¤ºä¾‹1ï¼šæ„å»ºå¸¦æŸ¥è¯¢å‚æ•°çš„ URL</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildURL</span>(<span class="hljs-params">baseURL, params</span>) {
  <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(baseURL);
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(params).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
    url.<span class="hljs-property">searchParams</span>.<span class="hljs-title function_">set</span>(key, params[key]);
  });
  <span class="hljs-keyword">return</span> url.<span class="hljs-property">href</span>;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">buildURL</span>(<span class="hljs-string">'https://api.example.com/users'</span>, {
  <span class="hljs-attr">page</span>: <span class="hljs-string">'1'</span>,
  <span class="hljs-attr">limit</span>: <span class="hljs-string">'10'</span>,
  <span class="hljs-attr">sort</span>: <span class="hljs-string">'name'</span>
}));
<span class="hljs-comment">// è¾“å‡º: 'https://api.example.com/users?page=1&amp;limit=10&amp;sort=name'</span>

<span class="hljs-comment">// ç¤ºä¾‹2ï¼šè§£æå’Œä¿®æ”¹ URL</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateURLPort</span>(<span class="hljs-params">urlString, newPort</span>) {
  <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(urlString);
  url.<span class="hljs-property">port</span> = newPort;
  <span class="hljs-keyword">return</span> url.<span class="hljs-property">href</span>;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">updateURLPort</span>(<span class="hljs-string">'https://example.com:8080/path'</span>, <span class="hljs-string">'3000'</span>));
<span class="hljs-comment">// è¾“å‡º: 'https://example.com:3000/path'</span>

<span class="hljs-comment">// ç¤ºä¾‹3ï¼šéªŒè¯ URL</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isValidURL</span>(<span class="hljs-params">str</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(str);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  } <span class="hljs-keyword">catch</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isValidURL</span>(<span class="hljs-string">'https://example.com'</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isValidURL</span>(<span class="hljs-string">'not-a-url'</span>));           <span class="hljs-comment">// false</span>

<span class="hljs-comment">// ç¤ºä¾‹4ï¼šæå–åŸŸå</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getDomain</span>(<span class="hljs-params">urlString</span>) {
  <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(urlString);
  <span class="hljs-keyword">return</span> url.<span class="hljs-property">hostname</span>;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getDomain</span>(<span class="hljs-string">'https://www.example.com:8080/path?query=1'</span>));
<span class="hljs-comment">// è¾“å‡º: 'www.example.com'</span>
</code></pre>
<hr/>
<h2 data-id="heading-23">ä¸‰ã€querystring æ¨¡å—ï¼šæŸ¥è¯¢å­—ç¬¦ä¸²å¤„ç†</h2>
<p><code>querystring</code> æ¨¡å—æä¾›äº†ç”¨äºè§£æå’Œæ ¼å¼åŒ– URL æŸ¥è¯¢å­—ç¬¦ä¸²çš„å®ç”¨å·¥å…·ã€‚è™½ç„¶ <code>URLSearchParams</code> æ›´ç°ä»£ï¼Œä½† <code>querystring</code> æ¨¡å—åœ¨å¤„ç†è‡ªå®šä¹‰åˆ†éš”ç¬¦æ—¶ä»ç„¶æœ‰ç”¨ã€‚</p>
<h3 data-id="heading-24">3.1 å¼•å…¥æ¨¡å—</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);
</code></pre>
<h3 data-id="heading-25">3.2 å¸¸ç”¨æ–¹æ³•</h3>
<h4 data-id="heading-26"><code>querystring.parse(str[, sep[, eq[, options]]])</code> - è§£ææŸ¥è¯¢å­—ç¬¦ä¸²</h4>
<p>å°†æŸ¥è¯¢å­—ç¬¦ä¸²è§£æä¸ºå¯¹è±¡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);

<span class="hljs-comment">// åŸºæœ¬ç”¨æ³•</span>
<span class="hljs-keyword">const</span> qs = <span class="hljs-string">'year=2017&amp;month=february&amp;day=15'</span>;
<span class="hljs-keyword">const</span> parsed = querystring.<span class="hljs-title function_">parse</span>(qs);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parsed);
<span class="hljs-comment">// è¾“å‡º: { year: '2017', month: 'february', day: '15' }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parsed.<span class="hljs-property">year</span>);   <span class="hljs-comment">// '2017'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parsed.<span class="hljs-property">month</span>);   <span class="hljs-comment">// 'february'</span>

<span class="hljs-comment">// è‡ªå®šä¹‰åˆ†éš”ç¬¦</span>
<span class="hljs-keyword">const</span> customQS = <span class="hljs-string">'year:2017;month:february'</span>;
<span class="hljs-keyword">const</span> parsed2 = querystring.<span class="hljs-title function_">parse</span>(customQS, <span class="hljs-string">';'</span>, <span class="hljs-string">':'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parsed2);
<span class="hljs-comment">// è¾“å‡º: { year: '2017', month: 'february' }</span>

<span class="hljs-comment">// è§£ç é€‰é¡¹</span>
<span class="hljs-keyword">const</span> encodedQS = <span class="hljs-string">'name=John%20Doe&amp;city=New%20York'</span>;
<span class="hljs-keyword">const</span> parsed3 = querystring.<span class="hljs-title function_">parse</span>(encodedQS);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parsed3);
<span class="hljs-comment">// è¾“å‡º: { name: 'John Doe', city: 'New York' }</span>
</code></pre>
<h4 data-id="heading-27"><code>querystring.stringify(obj[, sep[, eq[, options]]])</code> - åºåˆ—åŒ–ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²</h4>
<p>å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);

<span class="hljs-comment">// åŸºæœ¬ç”¨æ³•</span>
<span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">year</span>: <span class="hljs-number">2017</span>,
  <span class="hljs-attr">month</span>: <span class="hljs-string">'february'</span>,
  <span class="hljs-attr">day</span>: <span class="hljs-number">15</span>
};
<span class="hljs-keyword">const</span> qs = querystring.<span class="hljs-title function_">stringify</span>(obj);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(qs);
<span class="hljs-comment">// è¾“å‡º: 'year=2017&amp;month=february&amp;day=15'</span>

<span class="hljs-comment">// è‡ªå®šä¹‰åˆ†éš”ç¬¦</span>
<span class="hljs-keyword">const</span> customQS = querystring.<span class="hljs-title function_">stringify</span>(obj, <span class="hljs-string">';'</span>, <span class="hljs-string">':'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(customQS);
<span class="hljs-comment">// è¾“å‡º: 'year:2017;month:february;day:15'</span>

<span class="hljs-comment">// ç¼–ç é€‰é¡¹</span>
<span class="hljs-keyword">const</span> obj2 = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'John Doe'</span>,
  <span class="hljs-attr">city</span>: <span class="hljs-string">'New York'</span>
};
<span class="hljs-keyword">const</span> encodedQS = querystring.<span class="hljs-title function_">stringify</span>(obj2);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(encodedQS);
<span class="hljs-comment">// è¾“å‡º: 'name=John%20Doe&amp;city=New%20York'</span>

<span class="hljs-comment">// å¤„ç†æ•°ç»„</span>
<span class="hljs-keyword">const</span> obj3 = {
  <span class="hljs-attr">tags</span>: [<span class="hljs-string">'nodejs'</span>, <span class="hljs-string">'javascript'</span>, <span class="hljs-string">'web'</span>]
};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(querystring.<span class="hljs-title function_">stringify</span>(obj3));
<span class="hljs-comment">// è¾“å‡º: 'tags=nodejs&amp;tags=javascript&amp;tags=web'</span>
</code></pre>
<h4 data-id="heading-28"><code>querystring.escape(str)</code> - URL ç¼–ç </h4>
<p>å¯¹å­—ç¬¦ä¸²è¿›è¡Œ URL ç¼–ç ï¼ˆé€šå¸¸ä¸éœ€è¦ç›´æ¥è°ƒç”¨ï¼Œ<code>stringify</code> ä¼šè‡ªåŠ¨å¤„ç†ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(querystring.<span class="hljs-built_in">escape</span>(<span class="hljs-string">'hello world'</span>));
<span class="hljs-comment">// è¾“å‡º: 'hello%20world'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(querystring.<span class="hljs-built_in">escape</span>(<span class="hljs-string">'foo@bar.com'</span>));
<span class="hljs-comment">// è¾“å‡º: 'foo%40bar.com'</span>
</code></pre>
<h4 data-id="heading-29"><code>querystring.unescape(str)</code> - URL è§£ç </h4>
<p>å¯¹å­—ç¬¦ä¸²è¿›è¡Œ URL è§£ç ï¼ˆé€šå¸¸ä¸éœ€è¦ç›´æ¥è°ƒç”¨ï¼Œ<code>parse</code> ä¼šè‡ªåŠ¨å¤„ç†ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(querystring.<span class="hljs-built_in">unescape</span>(<span class="hljs-string">'hello%20world'</span>));
<span class="hljs-comment">// è¾“å‡º: 'hello world'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(querystring.<span class="hljs-built_in">unescape</span>(<span class="hljs-string">'foo%40bar.com'</span>));
<span class="hljs-comment">// è¾“å‡º: 'foo@bar.com'</span>
</code></pre>
<h3 data-id="heading-30">3.3 å®ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);

<span class="hljs-comment">// ç¤ºä¾‹1ï¼šè§£æ URL æŸ¥è¯¢å­—ç¬¦ä¸²</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">parseQueryString</span>(<span class="hljs-params">urlString</span>) {
  <span class="hljs-keyword">const</span> queryString = urlString.<span class="hljs-title function_">split</span>(<span class="hljs-string">'?'</span>)[<span class="hljs-number">1</span>] || <span class="hljs-string">''</span>;
  <span class="hljs-keyword">return</span> querystring.<span class="hljs-title function_">parse</span>(queryString);
}

<span class="hljs-keyword">const</span> url = <span class="hljs-string">'https://example.com/search?q=nodejs&amp;page=1&amp;limit=10'</span>;
<span class="hljs-keyword">const</span> params = <span class="hljs-title function_">parseQueryString</span>(url);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params);
<span class="hljs-comment">// è¾“å‡º: { q: 'nodejs', page: '1', limit: '10' }</span>

<span class="hljs-comment">// ç¤ºä¾‹2ï¼šæ„å»ºæŸ¥è¯¢å­—ç¬¦ä¸²</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildQueryString</span>(<span class="hljs-params">params</span>) {
  <span class="hljs-keyword">return</span> querystring.<span class="hljs-title function_">stringify</span>(params);
}

<span class="hljs-keyword">const</span> searchParams = {
  <span class="hljs-attr">q</span>: <span class="hljs-string">'nodejs tutorial'</span>,
  <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">sort</span>: <span class="hljs-string">'relevance'</span>
};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">buildQueryString</span>(searchParams));
<span class="hljs-comment">// è¾“å‡º: 'q=nodejs%20tutorial&amp;page=1&amp;sort=relevance'</span>

<span class="hljs-comment">// ç¤ºä¾‹3ï¼šåˆå¹¶æŸ¥è¯¢å‚æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">mergeQueryParams</span>(<span class="hljs-params">baseParams, newParams</span>) {
  <span class="hljs-keyword">const</span> merged = { ...baseParams, ...newParams };
  <span class="hljs-keyword">return</span> querystring.<span class="hljs-title function_">stringify</span>(merged);
}

<span class="hljs-keyword">const</span> base = { <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">limit</span>: <span class="hljs-number">10</span> };
<span class="hljs-keyword">const</span> additional = { <span class="hljs-attr">sort</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">order</span>: <span class="hljs-string">'asc'</span> };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">mergeQueryParams</span>(base, additional));
<span class="hljs-comment">// è¾“å‡º: 'page=1&amp;limit=10&amp;sort=name&amp;order=asc'</span>

<span class="hljs-comment">// ç¤ºä¾‹4ï¼šå¤„ç†åµŒå¥—å¯¹è±¡ï¼ˆéœ€è¦è‡ªå®šä¹‰åºåˆ—åŒ–ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">stringifyNested</span>(<span class="hljs-params">obj, prefix = <span class="hljs-string">''</span></span>) {
  <span class="hljs-keyword">const</span> pairs = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> obj) {
    <span class="hljs-keyword">if</span> (obj.<span class="hljs-title function_">hasOwnProperty</span>(key)) {
      <span class="hljs-keyword">const</span> value = obj[key];
      <span class="hljs-keyword">const</span> newKey = prefix ? <span class="hljs-string">`<span class="hljs-subst">${prefix}</span>[<span class="hljs-subst">${key}</span>]`</span> : key;
      
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span> &amp;&amp; value !== <span class="hljs-literal">null</span> &amp;&amp; !<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value)) {
        pairs.<span class="hljs-title function_">push</span>(...<span class="hljs-title function_">stringifyNested</span>(value, newKey));
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value)) {
        value.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
          pairs.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${newKey}</span>[<span class="hljs-subst">${index}</span>]=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(item)}</span>`</span>);
        });
      } <span class="hljs-keyword">else</span> {
        pairs.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${newKey}</span>=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(value)}</span>`</span>);
      }
    }
  }
  <span class="hljs-keyword">return</span> pairs;
}

<span class="hljs-keyword">const</span> nested = {
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>
  },
  <span class="hljs-attr">tags</span>: [<span class="hljs-string">'nodejs'</span>, <span class="hljs-string">'javascript'</span>]
};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">stringifyNested</span>(nested).<span class="hljs-title function_">join</span>(<span class="hljs-string">'&amp;'</span>));
<span class="hljs-comment">// è¾“å‡º: 'user[name]=John&amp;user[age]=30&amp;tags[0]=nodejs&amp;tags[1]=javascript'</span>
</code></pre>
<hr/>
<h2 data-id="heading-31">å››ã€util æ¨¡å—ï¼šå·¥å…·å‡½æ•°</h2>
<p><code>util</code> æ¨¡å—æä¾›äº†å¤šç§å®ç”¨å·¥å…·å‡½æ•°ï¼Œå¸®åŠ©å¼€å‘è€…å¤„ç†å¸¸è§çš„ç¼–ç¨‹ä»»åŠ¡ï¼Œå¦‚ç±»å‹æ£€æŸ¥ã€è°ƒè¯•ã€Promise è½¬æ¢ç­‰ã€‚</p>
<h3 data-id="heading-32">4.1 å¼•å…¥æ¨¡å—</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
</code></pre>
<h3 data-id="heading-33">4.2 å¸¸ç”¨æ–¹æ³•</h3>
<h4 data-id="heading-34"><code>util.format(format[, ...args])</code> - æ ¼å¼åŒ–å­—ç¬¦ä¸²</h4>
<p>è¿”å›æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²ï¼Œç±»ä¼¼äº C è¯­è¨€çš„ <code>printf</code> å‡½æ•°ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-comment">// åŸºæœ¬ç”¨æ³•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">format</span>(<span class="hljs-string">'%s:%s'</span>, <span class="hljs-string">'foo'</span>, <span class="hljs-string">'bar'</span>));
<span class="hljs-comment">// è¾“å‡º: 'foo:bar'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">format</span>(<span class="hljs-string">'%d + %d = %d'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>));
<span class="hljs-comment">// è¾“å‡º: '1 + 2 = 3'</span>

<span class="hljs-comment">// å ä½ç¬¦</span>
<span class="hljs-comment">// %s - å­—ç¬¦ä¸²</span>
<span class="hljs-comment">// %d - æ•°å­—ï¼ˆæ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼‰</span>
<span class="hljs-comment">// %j - JSON</span>
<span class="hljs-comment">// %% - ç™¾åˆ†å·</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">format</span>(<span class="hljs-string">'Name: %s, Age: %d, Data: %j'</span>, <span class="hljs-string">'John'</span>, <span class="hljs-number">30</span>, { <span class="hljs-attr">city</span>: <span class="hljs-string">'NYC'</span> }));
<span class="hljs-comment">// è¾“å‡º: 'Name: John, Age: 30, Data: {"city":"NYC"}'</span>

<span class="hljs-comment">// å¦‚æœæ²¡æœ‰æä¾›æ ¼å¼å­—ç¬¦ä¸²ï¼Œåˆ™å°†æ‰€æœ‰å‚æ•°ç”¨ç©ºæ ¼è¿æ¥</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">format</span>(<span class="hljs-string">'Hello'</span>, <span class="hljs-string">'World'</span>, <span class="hljs-number">123</span>));
<span class="hljs-comment">// è¾“å‡º: 'Hello World 123'</span>
</code></pre>
<h4 data-id="heading-35"><code>util.inspect(object[, options])</code> - å¯¹è±¡æ£€æŸ¥</h4>
<p>è¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œé€šå¸¸ç”¨äºè°ƒè¯•ã€‚è¿™æ˜¯ <code>console.log</code> å†…éƒ¨ä½¿ç”¨çš„æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,
  <span class="hljs-attr">nested</span>: {
    <span class="hljs-attr">city</span>: <span class="hljs-string">'NYC'</span>,
    <span class="hljs-attr">hobbies</span>: [<span class="hljs-string">'coding'</span>, <span class="hljs-string">'reading'</span>]
  }
};

<span class="hljs-comment">// åŸºæœ¬ç”¨æ³•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">inspect</span>(obj));
<span class="hljs-comment">// è¾“å‡º: { name: 'John', age: 30, nested: { city: 'NYC', hobbies: [ 'coding', 'reading' ] } }</span>

<span class="hljs-comment">// é€‰é¡¹é…ç½®</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">inspect</span>(obj, {
  <span class="hljs-attr">colors</span>: <span class="hljs-literal">true</span>,        <span class="hljs-comment">// ä½¿ç”¨é¢œè‰²</span>
  <span class="hljs-attr">depth</span>: <span class="hljs-number">2</span>,           <span class="hljs-comment">// æœ€å¤§é€’å½’æ·±åº¦</span>
  <span class="hljs-attr">compact</span>: <span class="hljs-literal">false</span>,     <span class="hljs-comment">// æ¯ä¸ªå±æ€§ä¸€è¡Œ</span>
  <span class="hljs-attr">showHidden</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// æ˜¾ç¤ºä¸å¯æšä¸¾å±æ€§</span>
  <span class="hljs-attr">breakLength</span>: <span class="hljs-number">80</span>     <span class="hljs-comment">// æ¢è¡Œé•¿åº¦</span>
}));

<span class="hljs-comment">// è‡ªå®šä¹‰ inspect æ–¹æ³•</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomObject</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
  }
  
  [util.<span class="hljs-property">inspect</span>.<span class="hljs-property">custom</span>]() {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`CustomObject(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.value}</span>)`</span>;
  }
}

<span class="hljs-keyword">const</span> custom = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomObject</span>(<span class="hljs-number">42</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">inspect</span>(custom));
<span class="hljs-comment">// è¾“å‡º: 'CustomObject(42)'</span>
</code></pre>
<h4 data-id="heading-36"><code>util.promisify(original)</code> - Promise åŒ–</h4>
<p>å°†éµå¾ªé”™è¯¯ä¼˜å…ˆå›è°ƒé£æ ¼çš„å‡½æ•°è½¬æ¢ä¸ºè¿”å› Promise çš„å‡½æ•°ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// å°†å›è°ƒå‡½æ•°è½¬æ¢ä¸º Promise</span>
<span class="hljs-keyword">const</span> readFile = util.<span class="hljs-title function_">promisify</span>(fs.<span class="hljs-property">readFile</span>);
<span class="hljs-keyword">const</span> writeFile = util.<span class="hljs-title function_">promisify</span>(fs.<span class="hljs-property">writeFile</span>);

<span class="hljs-comment">// ä½¿ç”¨ async/await</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readConfig</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-string">'config.json'</span>, <span class="hljs-string">'utf8'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è¯»å–æ–‡ä»¶å¤±è´¥:'</span>, error);
    <span class="hljs-keyword">throw</span> error;
  }
}

<span class="hljs-comment">// ä½¿ç”¨ .then()</span>
<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'data.txt'</span>, <span class="hljs-string">'utf8'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data))
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));

<span class="hljs-comment">// è‡ªå®šä¹‰ Promise åŒ–å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">customFunction</span>(<span class="hljs-params">arg, callback</span>) {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (arg &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, arg * <span class="hljs-number">2</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'å‚æ•°å¿…é¡»å¤§äº0'</span>));
    }
  }, <span class="hljs-number">100</span>);
}

<span class="hljs-keyword">const</span> promisifiedCustom = util.<span class="hljs-title function_">promisify</span>(customFunction);

<span class="hljs-title function_">promisifiedCustom</span>(<span class="hljs-number">5</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result))  <span class="hljs-comment">// è¾“å‡º: 10</span>
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));
</code></pre>
<h4 data-id="heading-37"><code>util.callbackify(original)</code> - å›è°ƒåŒ–</h4>
<p>ä¸ <code>promisify</code> ç›¸åï¼Œå°†è¿”å› Promise çš„å‡½æ•°è½¬æ¢ä¸ºä½¿ç”¨å›è°ƒçš„å‡½æ•°ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>).<span class="hljs-property">promises</span>;

<span class="hljs-comment">// å°† Promise å‡½æ•°è½¬æ¢ä¸ºå›è°ƒå‡½æ•°</span>
<span class="hljs-keyword">const</span> readFileCallback = util.<span class="hljs-title function_">callbackify</span>(fs.<span class="hljs-property">readFile</span>);

<span class="hljs-title function_">readFileCallback</span>(<span class="hljs-string">'file.txt'</span>, <span class="hljs-string">'utf8'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'é”™è¯¯:'</span>, err);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ•°æ®:'</span>, data);
});
</code></pre>
<h4 data-id="heading-38"><code>util.types</code> - ç±»å‹æ£€æŸ¥</h4>
<p>æä¾›å„ç§ç±»å‹æ£€æŸ¥å‡½æ•°ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸ºæ•°ç»„</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isArrayBuffer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>()));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isArrayBuffer</span>([]));                 <span class="hljs-comment">// false</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º Date å¯¹è±¡</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isDate</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));                <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isDate</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()));                <span class="hljs-comment">// false</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º Map</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isMap</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()));                  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º Set</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isSet</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()));                  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º Promise</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isPromise</span>(<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()));     <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º RegExp</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isRegExp</span>(<span class="hljs-regexp">/abc/</span>));                   <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º String å¯¹è±¡</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isStringObject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">'foo'</span>))); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isStringObject</span>(<span class="hljs-string">'foo'</span>));             <span class="hljs-comment">// false</span>
</code></pre>
<h4 data-id="heading-39"><code>util.debuglog(section)</code> - è°ƒè¯•æ—¥å¿—</h4>
<p>åˆ›å»ºä¸€ä¸ªè°ƒè¯•æ—¥å¿—å‡½æ•°ï¼Œä»…åœ¨è®¾ç½®äº† <code>NODE_DEBUG</code> ç¯å¢ƒå˜é‡æ—¶æ‰ä¼šè¾“å‡ºæ—¥å¿—ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">const</span> debuglog = util.<span class="hljs-title function_">debuglog</span>(<span class="hljs-string">'foo'</span>);

<span class="hljs-comment">// è®¾ç½®ç¯å¢ƒå˜é‡: NODE_DEBUG=foo node app.js</span>
<span class="hljs-title function_">debuglog</span>(<span class="hljs-string">'Hello from foo [%d]'</span>, <span class="hljs-number">123</span>);
<span class="hljs-comment">// åªæœ‰åœ¨è®¾ç½®äº† NODE_DEBUG=foo æ—¶æ‰ä¼šè¾“å‡º</span>

<span class="hljs-comment">// å¤šä¸ªè°ƒè¯•æ ‡ç­¾</span>
<span class="hljs-keyword">const</span> debug1 = util.<span class="hljs-title function_">debuglog</span>(<span class="hljs-string">'foo'</span>);
<span class="hljs-keyword">const</span> debug2 = util.<span class="hljs-title function_">debuglog</span>(<span class="hljs-string">'bar'</span>);

<span class="hljs-title function_">debug1</span>(<span class="hljs-string">'è¿™æ˜¯ foo çš„è°ƒè¯•ä¿¡æ¯'</span>);
<span class="hljs-title function_">debug2</span>(<span class="hljs-string">'è¿™æ˜¯ bar çš„è°ƒè¯•ä¿¡æ¯'</span>);

<span class="hljs-comment">// è¿è¡Œ: NODE_DEBUG=foo,bar node app.js</span>
</code></pre>
<h4 data-id="heading-40"><code>util.deprecate(fn, msg[, code])</code> - æ ‡è®°ä¸ºå¼ƒç”¨</h4>
<p>æ ‡è®°å‡½æ•°ä¸ºå·²å¼ƒç”¨ï¼Œè°ƒç”¨æ—¶ä¼šæ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">const</span> deprecatedFunction = util.<span class="hljs-title function_">deprecate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¿™ä¸ªå‡½æ•°å·²è¢«å¼ƒç”¨'</span>);
}, <span class="hljs-string">'deprecatedFunction() å·²å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨ newFunction() ä»£æ›¿'</span>);

<span class="hljs-title function_">deprecatedFunction</span>();
<span class="hljs-comment">// è¾“å‡ºè­¦å‘Š: (node:12345) DeprecationWarning: deprecatedFunction() å·²å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨ newFunction() ä»£æ›¿</span>
</code></pre>
<h3 data-id="heading-41">4.3 å®ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// ç¤ºä¾‹1ï¼šæ·±åº¦å…‹éš†å¯¹è±¡ï¼ˆä½¿ç”¨ JSON åºåˆ—åŒ–ï¼Œæœ‰å±€é™æ€§ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">deepClone</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));
}
<span class="hljs-comment">// æ³¨æ„ï¼šæ­¤æ–¹æ³•æ— æ³•å…‹éš†å‡½æ•°ã€undefinedã€Symbolã€Date å¯¹è±¡ç­‰</span>
<span class="hljs-comment">// æ›´å¥½çš„æ–¹å¼ï¼šä½¿ç”¨ç»“æ„åŒ–å…‹éš†ï¼ˆNode.js 17+ï¼‰æˆ–åº“å¦‚ lodash.cloneDeep</span>

<span class="hljs-comment">// ç¤ºä¾‹2ï¼šæ ¼å¼åŒ–é”™è¯¯å¯¹è±¡</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatError</span>(<span class="hljs-params">error</span>) {
  <span class="hljs-keyword">return</span> util.<span class="hljs-title function_">inspect</span>(error, {
    <span class="hljs-attr">colors</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-literal">null</span>
  });
}

<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Something went wrong'</span>);
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">formatError</span>(err));
}

<span class="hljs-comment">// ç¤ºä¾‹3ï¼šæ‰¹é‡ Promise åŒ–</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">promisifyAll</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">const</span> promisified = {};
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> obj) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj[key] === <span class="hljs-string">'function'</span>) {
      promisified[key] = util.<span class="hljs-title function_">promisify</span>(obj[key].<span class="hljs-title function_">bind</span>(obj));
    }
  }
  <span class="hljs-keyword">return</span> promisified;
}

<span class="hljs-keyword">const</span> fsPromises = <span class="hljs-title function_">promisifyAll</span>(fs);
<span class="hljs-comment">// ç°åœ¨å¯ä»¥ä½¿ç”¨ fsPromises.readFile, fsPromises.writeFile ç­‰</span>

<span class="hljs-comment">// ç¤ºä¾‹4ï¼šåˆ›å»ºè°ƒè¯•å·¥å…·</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createDebugger</span>(<span class="hljs-params">namespace</span>) {
  <span class="hljs-keyword">const</span> debug = util.<span class="hljs-title function_">debuglog</span>(namespace);
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">log</span>: <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-title function_">debug</span>(util.<span class="hljs-title function_">format</span>(...args)),
    <span class="hljs-attr">info</span>: <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-title function_">debug</span>(<span class="hljs-string">`[INFO] <span class="hljs-subst">${util.format(...args)}</span>`</span>),
    <span class="hljs-attr">error</span>: <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-title function_">debug</span>(<span class="hljs-string">`[ERROR] <span class="hljs-subst">${util.format(...args)}</span>`</span>)
  };
}

<span class="hljs-keyword">const</span> logger = <span class="hljs-title function_">createDebugger</span>(<span class="hljs-string">'app'</span>);
<span class="hljs-comment">// è¿è¡Œ: NODE_DEBUG=app node app.js</span>
logger.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Application started'</span>);
logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Processing request'</span>);
logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">'An error occurred'</span>);
</code></pre>
<hr/>
<h2 data-id="heading-42">äº”ã€os æ¨¡å—ï¼šæ“ä½œç³»ç»Ÿä¿¡æ¯</h2>
<p><code>os</code> æ¨¡å—æä¾›äº†ä¸æ“ä½œç³»ç»Ÿç›¸å…³çš„ä¿¡æ¯å’Œæ–¹æ³•ï¼Œå…è®¸å¼€å‘è€…è·å–ç³»ç»Ÿæ¶æ„ã€å¹³å°ã€CPU ä¿¡æ¯ã€å†…å­˜ä½¿ç”¨æƒ…å†µã€ç½‘ç»œæ¥å£ç­‰ã€‚</p>
<h3 data-id="heading-43">5.1 å¼•å…¥æ¨¡å—</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);
</code></pre>
<h3 data-id="heading-44">5.2 å¸¸ç”¨æ–¹æ³•å’Œå±æ€§</h3>
<h4 data-id="heading-45"><code>os.platform()</code> - è·å–æ“ä½œç³»ç»Ÿå¹³å°</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿå¹³å°æ ‡è¯†ç¬¦ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">platform</span>());
<span class="hljs-comment">// å¯èƒ½çš„å€¼:</span>
<span class="hljs-comment">// 'darwin' - macOS</span>
<span class="hljs-comment">// 'win32' - Windows</span>
<span class="hljs-comment">// 'linux' - Linux</span>
<span class="hljs-comment">// 'freebsd' - FreeBSD</span>
<span class="hljs-comment">// 'openbsd' - OpenBSD</span>
</code></pre>
<h4 data-id="heading-46"><code>os.arch()</code> - è·å– CPU æ¶æ„</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿçš„ CPU æ¶æ„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">arch</span>());
<span class="hljs-comment">// å¯èƒ½çš„å€¼:</span>
<span class="hljs-comment">// 'x64' - 64ä½</span>
<span class="hljs-comment">// 'arm' - ARM</span>
<span class="hljs-comment">// 'arm64' - ARM 64ä½</span>
<span class="hljs-comment">// 'ia32' - 32ä½</span>
</code></pre>
<h4 data-id="heading-47"><code>os.cpus()</code> - è·å– CPU ä¿¡æ¯</h4>
<p>è¿”å›æ¯ä¸ªé€»è¾‘ CPU å†…æ ¸çš„ä¿¡æ¯æ•°ç»„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-keyword">const</span> cpus = os.<span class="hljs-title function_">cpus</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`CPU æ ¸å¿ƒæ•°: <span class="hljs-subst">${cpus.length}</span>`</span>);

cpus.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">cpu, index</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`CPU <span class="hljs-subst">${index}</span>:`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  å‹å·: <span class="hljs-subst">${cpu.model}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  é€Ÿåº¦: <span class="hljs-subst">${cpu.speed}</span> MHz`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  ç”¨æˆ·æ—¶é—´: <span class="hljs-subst">${cpu.times.user}</span> ms`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  ç³»ç»Ÿæ—¶é—´: <span class="hljs-subst">${cpu.times.sys}</span> ms`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  ç©ºé—²æ—¶é—´: <span class="hljs-subst">${cpu.times.idle}</span> ms`</span>);
});

<span class="hljs-comment">// è®¡ç®— CPU ä½¿ç”¨ç‡</span>
<span class="hljs-comment">// æ³¨æ„ï¼šæ­¤å‡½æ•°ä»…ç”¨äºæ¼”ç¤ºåŸºæœ¬æ¦‚å¿µã€‚å®é™…åº”ç”¨ä¸­ï¼ŒCPU ä½¿ç”¨ç‡éœ€è¦é€šè¿‡ä¸¤æ¬¡é‡‡æ ·ï¼ˆé—´éš”ä¸€æ®µæ—¶é—´ï¼‰æ¥è®¡ç®—å·®å€¼æ‰èƒ½å¾—åˆ°å‡†ç¡®ç»“æœ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getCPUUsage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> cpus = os.<span class="hljs-title function_">cpus</span>();
  <span class="hljs-keyword">let</span> totalIdle = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> totalTick = <span class="hljs-number">0</span>;
  
  cpus.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cpu</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> times = cpu.<span class="hljs-property">times</span>;
    totalIdle += times.<span class="hljs-property">idle</span>;
    totalTick += times.<span class="hljs-property">user</span> + times.<span class="hljs-property">nice</span> + times.<span class="hljs-property">sys</span> + times.<span class="hljs-property">idle</span> + times.<span class="hljs-property">irq</span>;
  });
  
  <span class="hljs-keyword">const</span> idle = totalIdle / cpus.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> total = totalTick / cpus.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> usage = <span class="hljs-number">100</span> - ~~(<span class="hljs-number">100</span> * idle / total);
  
  <span class="hljs-keyword">return</span> usage;
}
</code></pre>
<h4 data-id="heading-48"><code>os.totalmem()</code> - è·å–æ€»å†…å­˜</h4>
<p>è¿”å›ç³»ç»Ÿçš„æ€»å†…å­˜é‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-keyword">const</span> totalMem = os.<span class="hljs-title function_">totalmem</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ€»å†…å­˜: <span class="hljs-subst">${(totalMem / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">2</span>)}</span> GB`</span>);
</code></pre>
<h4 data-id="heading-49"><code>os.freemem()</code> - è·å–ç©ºé—²å†…å­˜</h4>
<p>è¿”å›ç³»ç»Ÿçš„ç©ºé—²å†…å­˜é‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-keyword">const</span> freeMem = os.<span class="hljs-title function_">freemem</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ç©ºé—²å†…å­˜: <span class="hljs-subst">${(freeMem / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">2</span>)}</span> GB`</span>);

<span class="hljs-comment">// è®¡ç®—å†…å­˜ä½¿ç”¨ç‡</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getMemoryUsage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> total = os.<span class="hljs-title function_">totalmem</span>();
  <span class="hljs-keyword">const</span> free = os.<span class="hljs-title function_">freemem</span>();
  <span class="hljs-keyword">const</span> used = total - free;
  <span class="hljs-keyword">const</span> usagePercent = (used / total * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">total</span>: <span class="hljs-title function_">formatBytes</span>(total),
    <span class="hljs-attr">used</span>: <span class="hljs-title function_">formatBytes</span>(used),
    <span class="hljs-attr">free</span>: <span class="hljs-title function_">formatBytes</span>(free),
    <span class="hljs-attr">usagePercent</span>: <span class="hljs-string">`<span class="hljs-subst">${usagePercent}</span>%`</span>
  };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatBytes</span>(<span class="hljs-params">bytes</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${(bytes / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">2</span>)}</span> GB`</span>;
}
</code></pre>
<h4 data-id="heading-50"><code>os.hostname()</code> - è·å–ä¸»æœºå</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿçš„ä¸»æœºåã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">hostname</span>());
<span class="hljs-comment">// è¾“å‡º: 'my-computer'</span>
</code></pre>
<h4 data-id="heading-51"><code>os.type()</code> - è·å–æ“ä½œç³»ç»Ÿç±»å‹</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿçš„ç±»å‹ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">type</span>());
<span class="hljs-comment">// å¯èƒ½çš„å€¼:</span>
<span class="hljs-comment">// 'Linux' - Linux</span>
<span class="hljs-comment">// 'Darwin' - macOS</span>
<span class="hljs-comment">// 'Windows_NT' - Windows</span>
</code></pre>
<h4 data-id="heading-52"><code>os.release()</code> - è·å–æ“ä½œç³»ç»Ÿç‰ˆæœ¬</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬å·ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">release</span>());
<span class="hljs-comment">// è¾“å‡º: '5.4.0-74-generic' (Linux)</span>
<span class="hljs-comment">// æˆ–: '20.6.0' (macOS)</span>
<span class="hljs-comment">// æˆ–: '10.0.19043' (Windows)</span>
</code></pre>
<h4 data-id="heading-53"><code>os.uptime()</code> - è·å–ç³»ç»Ÿè¿è¡Œæ—¶é—´</h4>
<p>è¿”å›ç³»ç»Ÿçš„è¿è¡Œæ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-keyword">const</span> uptime = os.<span class="hljs-title function_">uptime</span>();
<span class="hljs-keyword">const</span> days = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(uptime / <span class="hljs-number">86400</span>);
<span class="hljs-keyword">const</span> hours = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((uptime % <span class="hljs-number">86400</span>) / <span class="hljs-number">3600</span>);
<span class="hljs-keyword">const</span> minutes = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((uptime % <span class="hljs-number">3600</span>) / <span class="hljs-number">60</span>);
<span class="hljs-keyword">const</span> seconds = uptime % <span class="hljs-number">60</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ç³»ç»Ÿè¿è¡Œæ—¶é—´: <span class="hljs-subst">${days}</span>å¤© <span class="hljs-subst">${hours}</span>å°æ—¶ <span class="hljs-subst">${minutes}</span>åˆ†é’Ÿ <span class="hljs-subst">${seconds}</span>ç§’`</span>);
</code></pre>
<h4 data-id="heading-54"><code>os.homedir()</code> - è·å–ç”¨æˆ·ä¸»ç›®å½•</h4>
<p>è¿”å›å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•è·¯å¾„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">homedir</span>());
<span class="hljs-comment">// Windows: 'C:\\Users\\username'</span>
<span class="hljs-comment">// Linux/macOS: '/home/username'</span>
</code></pre>
<h4 data-id="heading-55"><code>os.tmpdir()</code> - è·å–ä¸´æ—¶ç›®å½•</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿçš„ä¸´æ—¶æ–‡ä»¶ç›®å½•è·¯å¾„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">tmpdir</span>());
<span class="hljs-comment">// Windows: 'C:\\Users\\username\\AppData\\Local\\Temp'</span>
<span class="hljs-comment">// Linux: '/tmp'</span>
<span class="hljs-comment">// macOS: '/var/folders/...'</span>
</code></pre>
<h4 data-id="heading-56"><code>os.networkInterfaces()</code> - è·å–ç½‘ç»œæ¥å£</h4>
<p>è¿”å›ç½‘ç»œæ¥å£ä¿¡æ¯å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-keyword">const</span> interfaces = os.<span class="hljs-title function_">networkInterfaces</span>();

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(interfaces)) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ¥å£: <span class="hljs-subst">${name}</span>`</span>);
  interfaces[name].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">iface</span> =&gt;</span> {
    <span class="hljs-comment">// å…¼å®¹ä¸åŒ Node.js ç‰ˆæœ¬ï¼šfamily å¯èƒ½æ˜¯ 'IPv4' æˆ– 4</span>
    <span class="hljs-keyword">const</span> isIPv4 = iface.<span class="hljs-property">family</span> === <span class="hljs-string">'IPv4'</span> || iface.<span class="hljs-property">family</span> === <span class="hljs-number">4</span>;
    <span class="hljs-keyword">if</span> (isIPv4 &amp;&amp; !iface.<span class="hljs-property">internal</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  IPv4: <span class="hljs-subst">${iface.address}</span>`</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  å­ç½‘æ©ç : <span class="hljs-subst">${iface.netmask}</span>`</span>);
    }
  });
}

<span class="hljs-comment">// è·å–æœ¬æœº IP åœ°å€</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getLocalIP</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> interfaces = os.<span class="hljs-title function_">networkInterfaces</span>();
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(interfaces)) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> iface <span class="hljs-keyword">of</span> interfaces[name]) {
      <span class="hljs-comment">// å…¼å®¹ä¸åŒ Node.js ç‰ˆæœ¬ï¼šfamily å¯èƒ½æ˜¯ 'IPv4' æˆ– 4</span>
      <span class="hljs-keyword">const</span> isIPv4 = iface.<span class="hljs-property">family</span> === <span class="hljs-string">'IPv4'</span> || iface.<span class="hljs-property">family</span> === <span class="hljs-number">4</span>;
      <span class="hljs-keyword">if</span> (isIPv4 &amp;&amp; !iface.<span class="hljs-property">internal</span>) {
        <span class="hljs-keyword">return</span> iface.<span class="hljs-property">address</span>;
      }
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-string">'127.0.0.1'</span>;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æœ¬æœº IP: <span class="hljs-subst">${getLocalIP()}</span>`</span>);
</code></pre>
<h4 data-id="heading-57"><code>os.endianness()</code> - è·å–å­—èŠ‚åº</h4>
<p>è¿”å› CPU çš„å­—èŠ‚åºã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">endianness</span>());
<span class="hljs-comment">// 'BE' - å¤§ç«¯åº</span>
<span class="hljs-comment">// 'LE' - å°ç«¯åºï¼ˆå¸¸è§ï¼‰</span>
</code></pre>
<h4 data-id="heading-58"><code>os.EOL</code> - è¡Œå°¾æ ‡è¯†ç¬¦</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿçš„è¡Œå°¾æ ‡è¯†ç¬¦ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-property">EOL</span>);
<span class="hljs-comment">// Windows: '\r\n'</span>
<span class="hljs-comment">// Unix/Linux/macOS: '\n'</span>

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> content = <span class="hljs-string">`ç¬¬ä¸€è¡Œ<span class="hljs-subst">${os.EOL}</span>ç¬¬äºŒè¡Œ<span class="hljs-subst">${os.EOL}</span>ç¬¬ä¸‰è¡Œ`</span>;
</code></pre>
<h3 data-id="heading-59">5.3 å®ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-comment">// ç¤ºä¾‹1ï¼šç³»ç»Ÿä¿¡æ¯æ±‡æ€»</span>
<span class="hljs-comment">// è·å–æœ¬æœº IP åœ°å€çš„è¾…åŠ©å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getLocalIP</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> interfaces = os.<span class="hljs-title function_">networkInterfaces</span>();
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(interfaces)) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> iface <span class="hljs-keyword">of</span> interfaces[name]) {
      <span class="hljs-comment">// å…¼å®¹ä¸åŒ Node.js ç‰ˆæœ¬ï¼šfamily å¯èƒ½æ˜¯ 'IPv4' æˆ– 4</span>
      <span class="hljs-keyword">const</span> isIPv4 = iface.<span class="hljs-property">family</span> === <span class="hljs-string">'IPv4'</span> || iface.<span class="hljs-property">family</span> === <span class="hljs-number">4</span>;
      <span class="hljs-keyword">if</span> (isIPv4 &amp;&amp; !iface.<span class="hljs-property">internal</span>) {
        <span class="hljs-keyword">return</span> iface.<span class="hljs-property">address</span>;
      }
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-string">'127.0.0.1'</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getSystemInfo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">platform</span>: os.<span class="hljs-title function_">platform</span>(),
    <span class="hljs-attr">arch</span>: os.<span class="hljs-title function_">arch</span>(),
    <span class="hljs-attr">hostname</span>: os.<span class="hljs-title function_">hostname</span>(),
    <span class="hljs-attr">type</span>: os.<span class="hljs-title function_">type</span>(),
    <span class="hljs-attr">release</span>: os.<span class="hljs-title function_">release</span>(),
    <span class="hljs-attr">uptime</span>: <span class="hljs-title function_">formatUptime</span>(os.<span class="hljs-title function_">uptime</span>()),
    <span class="hljs-attr">cpus</span>: {
      <span class="hljs-attr">count</span>: os.<span class="hljs-title function_">cpus</span>().<span class="hljs-property">length</span>,
      <span class="hljs-attr">model</span>: os.<span class="hljs-title function_">cpus</span>()[<span class="hljs-number">0</span>].<span class="hljs-property">model</span>
    },
    <span class="hljs-attr">memory</span>: {
      <span class="hljs-attr">total</span>: <span class="hljs-title function_">formatBytes</span>(os.<span class="hljs-title function_">totalmem</span>()),
      <span class="hljs-attr">free</span>: <span class="hljs-title function_">formatBytes</span>(os.<span class="hljs-title function_">freemem</span>()),
      <span class="hljs-attr">used</span>: <span class="hljs-title function_">formatBytes</span>(os.<span class="hljs-title function_">totalmem</span>() - os.<span class="hljs-title function_">freemem</span>()),
      <span class="hljs-attr">usagePercent</span>: ((os.<span class="hljs-title function_">totalmem</span>() - os.<span class="hljs-title function_">freemem</span>()) / os.<span class="hljs-title function_">totalmem</span>() * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>) + <span class="hljs-string">'%'</span>
    },
    <span class="hljs-attr">network</span>: <span class="hljs-title function_">getLocalIP</span>()
  };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatBytes</span>(<span class="hljs-params">bytes</span>) {
  <span class="hljs-keyword">const</span> sizes = [<span class="hljs-string">'B'</span>, <span class="hljs-string">'KB'</span>, <span class="hljs-string">'MB'</span>, <span class="hljs-string">'GB'</span>, <span class="hljs-string">'TB'</span>];
  <span class="hljs-keyword">if</span> (bytes === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'0 B'</span>;
  <span class="hljs-keyword">const</span> i = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(bytes) / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1024</span>));
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(bytes / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">1024</span>, i) * <span class="hljs-number">100</span>) / <span class="hljs-number">100</span> + <span class="hljs-string">' '</span> + sizes[i];
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatUptime</span>(<span class="hljs-params">seconds</span>) {
  <span class="hljs-keyword">const</span> days = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(seconds / <span class="hljs-number">86400</span>);
  <span class="hljs-keyword">const</span> hours = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((seconds % <span class="hljs-number">86400</span>) / <span class="hljs-number">3600</span>);
  <span class="hljs-keyword">const</span> minutes = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((seconds % <span class="hljs-number">3600</span>) / <span class="hljs-number">60</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${days}</span>å¤© <span class="hljs-subst">${hours}</span>å°æ—¶ <span class="hljs-subst">${minutes}</span>åˆ†é’Ÿ`</span>;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getSystemInfo</span>());

<span class="hljs-comment">// ç¤ºä¾‹2ï¼šç›‘æ§ç³»ç»Ÿèµ„æº</span>
<span class="hljs-comment">// è®¡ç®— CPU ä½¿ç”¨ç‡çš„è¾…åŠ©å‡½æ•°ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼Œå®é™…ä½¿ç”¨æ—¶å»ºè®®ä½¿ç”¨ä¸¤æ¬¡é‡‡æ ·ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getCPUUsage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> cpus = os.<span class="hljs-title function_">cpus</span>();
  <span class="hljs-keyword">let</span> totalIdle = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> totalTick = <span class="hljs-number">0</span>;
  
  cpus.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cpu</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> times = cpu.<span class="hljs-property">times</span>;
    totalIdle += times.<span class="hljs-property">idle</span>;
    totalTick += times.<span class="hljs-property">user</span> + times.<span class="hljs-property">nice</span> + times.<span class="hljs-property">sys</span> + times.<span class="hljs-property">idle</span> + times.<span class="hljs-property">irq</span>;
  });
  
  <span class="hljs-keyword">const</span> idle = totalIdle / cpus.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> total = totalTick / cpus.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> usage = <span class="hljs-number">100</span> - ~~(<span class="hljs-number">100</span> * idle / total);
  
  <span class="hljs-keyword">return</span> usage;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">monitorSystem</span>(<span class="hljs-params">interval = <span class="hljs-number">5000</span></span>) {
  <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> memUsage = (os.<span class="hljs-title function_">totalmem</span>() - os.<span class="hljs-title function_">freemem</span>()) / os.<span class="hljs-title function_">totalmem</span>() * <span class="hljs-number">100</span>;
    <span class="hljs-comment">// æ³¨æ„ï¼šgetCPUUsage() éœ€è¦ä¸¤æ¬¡é‡‡æ ·æ‰èƒ½å‡†ç¡®ï¼Œè¿™é‡Œä»…ä½œæ¼”ç¤º</span>
    <span class="hljs-keyword">const</span> cpuUsage = <span class="hljs-title function_">getCPUUsage</span>();
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å†…å­˜ä½¿ç”¨ç‡: <span class="hljs-subst">${memUsage.toFixed(<span class="hljs-number">2</span>)}</span>%`</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`CPU ä½¿ç”¨ç‡: <span class="hljs-subst">${cpuUsage}</span>%`</span>);
    
    <span class="hljs-keyword">if</span> (memUsage &gt; <span class="hljs-number">90</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜!'</span>);
    }
    <span class="hljs-keyword">if</span> (cpuUsage &gt; <span class="hljs-number">90</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜!'</span>);
    }
  }, interval);
}

<span class="hljs-comment">// ç¤ºä¾‹3ï¼šæ ¹æ®å¹³å°é€‰æ‹©ä¸åŒçš„è¡Œä¸º</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">platformSpecificAction</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">switch</span> (os.<span class="hljs-title function_">platform</span>()) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'win32'</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Windows ç‰¹å®šæ“ä½œ'</span>);
      <span class="hljs-comment">// Windows ç‰¹å®šä»£ç </span>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'darwin'</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'macOS ç‰¹å®šæ“ä½œ'</span>);
      <span class="hljs-comment">// macOS ç‰¹å®šä»£ç </span>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'linux'</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Linux ç‰¹å®šæ“ä½œ'</span>);
      <span class="hljs-comment">// Linux ç‰¹å®šä»£ç </span>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-attr">default</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å…¶ä»–å¹³å°'</span>);
  }
}

<span class="hljs-comment">// ç¤ºä¾‹4ï¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶è·¯å¾„</span>
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createTempFilePath</span>(<span class="hljs-params">prefix = <span class="hljs-string">'temp'</span>, suffix = <span class="hljs-string">'.txt'</span></span>) {
  <span class="hljs-keyword">const</span> tmpDir = os.<span class="hljs-title function_">tmpdir</span>();
  <span class="hljs-keyword">const</span> timestamp = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">const</span> random = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>).<span class="hljs-title function_">substring</span>(<span class="hljs-number">7</span>);
  <span class="hljs-keyword">return</span> path.<span class="hljs-title function_">join</span>(tmpDir, <span class="hljs-string">`<span class="hljs-subst">${prefix}</span>-<span class="hljs-subst">${timestamp}</span>-<span class="hljs-subst">${random}</span><span class="hljs-subst">${suffix}</span>`</span>);
}

<span class="hljs-comment">// ç¤ºä¾‹5ï¼šæ£€æµ‹ç³»ç»Ÿè´Ÿè½½</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getSystemLoad</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> cpus = os.<span class="hljs-title function_">cpus</span>();
  <span class="hljs-keyword">const</span> load = cpus.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">cpu</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> total = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(cpu.<span class="hljs-property">times</span>).<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b);
    <span class="hljs-keyword">const</span> usage = ((total - cpu.<span class="hljs-property">times</span>.<span class="hljs-property">idle</span>) / total * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(usage);
  });
  
  <span class="hljs-keyword">const</span> avgLoad = (load.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / load.<span class="hljs-property">length</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">perCore</span>: load,
    <span class="hljs-attr">average</span>: <span class="hljs-built_in">parseFloat</span>(avgLoad)
  };
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç³»ç»Ÿè´Ÿè½½:'</span>, <span class="hljs-title function_">getSystemLoad</span>());
</code></pre>
<hr/>
<h2 data-id="heading-60">æ€»ç»“</h2>
<p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† Node.js ä¸­äº”ä¸ªé‡è¦çš„å·¥å…·æ¨¡å—ï¼š</p>
<ol>
<li><strong>path æ¨¡å—</strong>ï¼šå¤„ç†æ–‡ä»¶è·¯å¾„ï¼Œæä¾›è·¨å¹³å°å…¼å®¹æ€§</li>
<li><strong>url æ¨¡å—</strong>ï¼šè§£æå’Œæ ¼å¼åŒ– URLï¼Œæ¨èä½¿ç”¨ WHATWG URL API</li>
<li><strong>querystring æ¨¡å—</strong>ï¼šå¤„ç†æŸ¥è¯¢å­—ç¬¦ä¸²çš„è§£æå’Œåºåˆ—åŒ–</li>
<li><strong>util æ¨¡å—</strong>ï¼šæä¾›å„ç§å®ç”¨å·¥å…·å‡½æ•°ï¼Œå¦‚ç±»å‹æ£€æŸ¥ã€Promise è½¬æ¢ã€è°ƒè¯•ç­‰</li>
<li><strong>os æ¨¡å—</strong>ï¼šè·å–æ“ä½œç³»ç»Ÿç›¸å…³ä¿¡æ¯ï¼Œå¦‚å¹³å°ã€CPUã€å†…å­˜ç­‰</li>
</ol>
<p>è¿™äº›æ¨¡å—éƒ½æ˜¯ Node.js çš„å†…ç½®æ¨¡å—ï¼Œæ— éœ€å®‰è£…å³å¯ä½¿ç”¨ã€‚ç†Ÿç»ƒæŒæ¡è¿™äº›æ¨¡å—èƒ½å¤Ÿå¤§å¤§æé«˜å¼€å‘æ•ˆç‡ï¼Œè®©ä»£ç æ›´åŠ å¥å£®å’Œå¯ç»´æŠ¤ã€‚</p>
<h3 data-id="heading-61">æœ€ä½³å®è·µå»ºè®®</h3>
<ol>
<li><strong>è·¯å¾„å¤„ç†</strong>ï¼šå§‹ç»ˆä½¿ç”¨ <code>path.join()</code> å’Œ <code>path.resolve()</code> è€Œä¸æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥</li>
<li><strong>URL å¤„ç†</strong>ï¼šä½¿ç”¨ WHATWG URL APIï¼ˆ<code>URL</code> å’Œ <code>URLSearchParams</code>ï¼‰</li>
<li><strong>æŸ¥è¯¢å­—ç¬¦ä¸²</strong>ï¼šå¯¹äºç®€å•åœºæ™¯ä½¿ç”¨ <code>querystring</code>ï¼Œå¤æ‚åœºæ™¯ä½¿ç”¨ <code>URLSearchParams</code></li>
<li><strong>å¼‚æ­¥è½¬æ¢</strong>ï¼šä½¿ç”¨ <code>util.promisify()</code> å°†å›è°ƒå‡½æ•°è½¬æ¢ä¸º Promise</li>
<li><strong>ç³»ç»Ÿä¿¡æ¯</strong>ï¼šä½¿ç”¨ <code>os</code> æ¨¡å—è¿›è¡Œè·¨å¹³å°å…¼å®¹æ€§å¤„ç†</li>
<li><strong>ç»§æ‰¿</strong>ï¼šä½¿ç”¨ ES6 çš„ <code>class</code> å’Œ <code>extends</code> è¯­æ³•ï¼Œè€Œä¸æ˜¯å·²å¼ƒç”¨çš„ <code>util.inherits()</code></li>
</ol>
<hr/>
<blockquote>
<p><strong>å‚è€ƒèµ„æºï¼š</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fen%2Fdocs%2F" target="_blank" title="https://nodejs.org/en/docs/" ref="nofollow noopener noreferrer">Node.js å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3schools.com%2Fnodejs%2Fdefault.asp" target="_blank" title="https://www.w3schools.com/nodejs/default.asp" ref="nofollow noopener noreferrer">W3Schools Node.js æ•™ç¨‹</a></li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Antd5.x åœ¨ Next.js14.x é¡¹ç›®ä¸­ï¼Œåˆæ¬¡æ¸²æŸ“æ ·å¼ä¸¢å¤±]]></title>    <link>https://juejin.cn/post/7583799807593578530</link>    <guid>https://juejin.cn/post/7583799807593578530</guid>    <pubDate>2025-12-15T09:10:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583799807593578530" data-draft-id="7583903159773626383" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Antd5.x åœ¨ Next.js14.x é¡¹ç›®ä¸­ï¼Œåˆæ¬¡æ¸²æŸ“æ ·å¼ä¸¢å¤±"/> <meta itemprop="keywords" content="å‰ç«¯,React.js,Next.js"/> <meta itemprop="datePublished" content="2025-12-15T09:10:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¹¿é¹¿é¹¿é¹¿isNotDefined"/> <meta itemprop="url" content="https://juejin.cn/user/4227000939061086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Antd5.x åœ¨ Next.js14.x é¡¹ç›®ä¸­ï¼Œåˆæ¬¡æ¸²æŸ“æ ·å¼ä¸¢å¤±
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4227000939061086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¹¿é¹¿é¹¿é¹¿isNotDefined
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:10:49.000Z" title="Mon Dec 15 2025 09:10:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é—®é¢˜</h2>
<p>å› ä¸ºä¹‹å‰ Next å’Œ React æ¥è¿å‡ºç°å®‰å…¨é—®é¢˜ï¼Œäºæ˜¯æŠŠåšå®¢çš„ä¾èµ–å‡çº§äº†ä¸€ä¸‹ï¼Œæ²¡æƒ³åˆ°å°±æå‡ºé—®é¢˜äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3326a64520a47a29548262a3b6d9387~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_6bm_6bm_6bm_aXNOb3REZWZpbmVk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394649&amp;x-signature=2cXnjtK1O3vfKGaEpWD9d1JBlNI%3D" alt="QQæˆªå›¾20251215164248.jpg" loading="lazy"/></p>
<p>åˆæ¬¡æ¸²æŸ“æ—¶æ ·å¼ä¸¢å¤±ï¼Œåœ¨å®¢æˆ·ç«¯ä¸Šä¼šçŸ­æš‚å±•ç¤º Antd ç»„ä»¶æ— æ ·å¼ç•Œé¢ï¼Œå‡ºç°æ ·å¼é—ªçƒçš„æƒ…å†µã€‚é¡¹ç›®æ˜¯ Next 14ï¼ŒReact 18 çš„ App Router é¡¹ç›®ï¼Œä¾èµ–ç‰ˆæœ¬ï¼š<code>"@ant-design/nextjs-registry": "^1.3.0"</code>ï¼Œ<code>"antd": "^5.14.2"</code>ã€‚</p>
<h2 data-id="heading-1">è§£å†³æ€è·¯</h2>
<p>å› ä¸º Antd æ˜¯ CSS-in-js çš„ UI åº“ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£å‘¢ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª @ant-design/nextjs-registry åŒ…è£¹æ•´ä¸ªé¡µé¢ï¼Œåœ¨ SSR æ—¶æ”¶é›†æ‰€æœ‰ç»„ä»¶çš„æ ·å¼ï¼Œå¹¶ä¸”é€šè¿‡ <code>&lt;script&gt;</code> æ ‡ç­¾åœ¨å®¢æˆ·ç«¯é¦–æ¬¡æ¸²æŸ“æ—¶å¸¦ä¸Šã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// src/app/layout.tsx</span>

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AntdRegistry</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/nextjs-registry'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RootLayout</span>(<span class="hljs-params">{
  children
}: Readonly&lt;{
  children: React.ReactNode
}&gt;</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        {/* ... */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">AntdRegistry</span>&gt;</span>
          {/* ... å‡è£…è¿™æ˜¯é¡µé¢ä»£ç  */}
        <span class="hljs-tag">&lt;/<span class="hljs-name">AntdRegistry</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
  )
}
</code></pre>
<p>å¯¹ç…§äº†ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ä¹Ÿé—®äº†ä¸‹ AIï¼Œæ²¡å‘ç°æˆ‘çš„å†™æ³•æœ‰ä»€ä¹ˆé—®é¢˜ã€‚å°±åœ¨è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘çŒ›ç„¶é—´çœ‹è§äº† Antd çš„ Pages Router ä½¿ç”¨çš„æ³¨æ„äº‹é¡¹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f8ba43ae8ca402c8344ae8f6f374b62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_6bm_6bm_6bm_aXNOb3REZWZpbmVk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394649&amp;x-signature=i4Vxywdn3iFPopU2b7qesRoGvdk%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘å¯»æ€ï¼Œå¯èƒ½æˆ‘é‡åˆ°çš„æƒ…å†µå’Œè¿™é‡Œä¸€æ ·ï¼Œæ˜¯å†…éƒ¨ä¾èµ–ç‰ˆæœ¬ <code>@ant-design/cssinj</code> ä¸å¯¹å¼•èµ·çš„ã€‚</p>
<p>è¾“å…¥ <code>npm ls @ant-design/cssinjs</code> çœ‹äº†ä¸€ä¸‹ï¼Œ</p>
<pre><code class="hljs language-text" lang="text">â”œâ”€â”¬ @ant-design/nextjs-registry@1.3.0
â”‚ â””â”€â”€ @ant-design/cssinjs@2.0.1
â””â”€â”¬ antd@5.14.2
  â””â”€â”€ @ant-design/cssinjs@1.24.0 deduped
</code></pre>
<p><code>@ant-design/nextjs-registry</code> å†…éƒ¨ä¹Ÿä½¿ç”¨äº† <code>@ant-design/cssinjs</code>ï¼Œè€Œä¸”å®ƒçš„ç‰ˆæœ¬å’Œ <code>antd</code> å†…ç½®ç‰ˆæœ¬è¿˜ä¸ä¸€æ ·ï¼Œè¿™å°±æ˜¯é—®é¢˜çš„æ‰€åœ¨äº†ã€‚</p>
<p>æ¥ä¸‹æ¥æŠŠ <code>@ant-design/nextjs-registry</code> çš„ç‰ˆæœ¬é™åˆ°äº† 1.2.0ï¼Œè¿™æ—¶å€™ç‰ˆæœ¬å¯¹ä¸Šäº†ï¼Œbug ä¹Ÿå°±ä¿®å¤äº†ã€‚</p>
<pre><code class="hljs language-text" lang="text">â”œâ”€â”¬ @ant-design/nextjs-registry@1.2.0
â”‚ â””â”€â”€ @ant-design/cssinjs@1.24.0
â””â”€â”¬ antd@5.14.2
  â””â”€â”€ @ant-design/cssinjs@1.24.0 deduped
</code></pre>
<h2 data-id="heading-2">@ant-design/nextjs-registry çš„å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆ</h2>
<h3 data-id="heading-3">AntdRegistry</h3>
<p>è¿™å‹¾èµ·äº†æˆ‘çš„å¥½å¥‡å¿ƒï¼Œå°±è®©æˆ‘ä»¬æ¥çœ‹çœ‹ <code>@ant-design/nextjs-registry</code> å¹²äº†äº›ä»€ä¹ˆï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fant-design%2Fnextjs-registry" target="_blank" title="https://github.com/ant-design/nextjs-registry" ref="nofollow noopener noreferrer">github.com/ant-design/â€¦</a></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// /src/AntdRegistry.tsx</span>
<span class="hljs-string">'use client'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">StyleProviderProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/cssinjs'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-variable constant_">FC</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { createCache, extractStyle, <span class="hljs-title class_">StyleProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/cssinjs'</span>;
<span class="hljs-keyword">import</span> { useServerInsertedHTML } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/navigation'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">AntdRegistryProps</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">StyleProviderProps</span>, <span class="hljs-string">'cache'</span>&gt;;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">AntdRegistry</span>: <span class="hljs-variable constant_">FC</span>&lt;<span class="hljs-title class_">AntdRegistryProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> [cache] = <span class="hljs-title function_">useState</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">createCache</span>());

  <span class="hljs-title function_">useServerInsertedHTML</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> styleText = <span class="hljs-title function_">extractStyle</span>(cache, { <span class="hljs-attr">plain</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">once</span>: <span class="hljs-literal">true</span> });

    <span class="hljs-keyword">if</span> (styleText.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'.data-ant-cssinjs-cache-path{content:"";}'</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>
        <span class="hljs-attr">id</span>=<span class="hljs-string">"antd-cssinjs"</span>
        // <span class="hljs-attr">to</span> <span class="hljs-attr">make</span> <span class="hljs-attr">sure</span> <span class="hljs-attr">this</span> <span class="hljs-attr">style</span> <span class="hljs-attr">is</span> <span class="hljs-attr">inserted</span> <span class="hljs-attr">before</span> <span class="hljs-attr">Ant</span> <span class="hljs-attr">Design</span>'<span class="hljs-attr">s</span> <span class="hljs-attr">style</span> <span class="hljs-attr">generated</span> <span class="hljs-attr">by</span> <span class="hljs-attr">client</span>
        <span class="hljs-attr">data-rc-order</span>=<span class="hljs-string">"prepend"</span>
        <span class="hljs-attr">data-rc-priority</span>=<span class="hljs-string">"-1000"</span>
        <span class="hljs-attr">dangerouslySetInnerHTML</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">__html:</span> <span class="hljs-attr">styleText</span> }}
      /&gt;</span></span>
    );
  });

  <span class="hljs-keyword">return</span> <span class="xml"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">StyleProvider</span> {<span class="hljs-attr">...props</span>} <span class="hljs-attr">cache</span>=<span class="hljs-string">{cache}</span> /&gt;</span></span></span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">AntdRegistry</span>;
</code></pre>
<p>é™¤äº†ç”¨ Next çš„ API <code>useServerInsertedHTML</code> æŠŠæ ·å¼å­—ç¬¦ä¸²æ’åˆ°é¡µé¢ä¸Šä¹‹å¤–ï¼Œå’Œ Pages Router ä¸­ Antd æ”¶é›†é¦–å±æ ·å¼çš„å†™æ³•å‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚</p>
<h3 data-id="heading-4">@ant-design/cssinjs</h3>
<p>é¦–å…ˆæ¥çœ‹ä¸Šæ–‡ <code>const [cache] = useState(() =&gt; createCache())</code> è¿™ä¸€è¡Œã€‚</p>
<p>@ant-design/cssinjs éƒ¨åˆ†ä»“åº“åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fant-design%2Fcssinjs" target="_blank" title="https://github.com/ant-design/cssinjs" ref="nofollow noopener noreferrer">github.com/ant-design/â€¦</a></p>
<p>å®ƒå¹²äº†å‡ ä»¶äº‹ï¼š</p>
<ol>
<li>ç”Ÿæˆå”¯ä¸€å®ä¾‹ IDã€‚</li>
<li>ï¼ˆä»…å®¢æˆ·ç«¯ï¼‰å°† body ä¸­çš„æ ·å¼ç§»åˆ° head ä¸­ï¼Œå¹¶ä¸”å»é‡ã€‚</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createCache</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> cssinjsInstanceId = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">12</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>);

  <span class="hljs-comment">// Tricky SSR: Move all inline style to the head.</span>
  <span class="hljs-comment">// PS: We do not recommend tricky mode.</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">document</span> !== <span class="hljs-string">'undefined'</span> &amp;&amp; <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span> &amp;&amp; <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>) {
    <span class="hljs-keyword">const</span> styles = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">`style[<span class="hljs-subst">${ATTR_MARK}</span>]`</span>) || [];
    <span class="hljs-keyword">const</span> { firstChild } = <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>;

    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(styles).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">style</span>) =&gt;</span> {
      (style <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)[<span class="hljs-variable constant_">CSS_IN_JS_INSTANCE</span>] =
        (style <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)[<span class="hljs-variable constant_">CSS_IN_JS_INSTANCE</span>] || cssinjsInstanceId;

      <span class="hljs-comment">// Not force move if no head</span>
      <span class="hljs-keyword">if</span> ((style <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)[<span class="hljs-variable constant_">CSS_IN_JS_INSTANCE</span>] === cssinjsInstanceId) {
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">insertBefore</span>(style, firstChild);
      }
    });

    <span class="hljs-comment">// Deduplicate of moved styles</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">styleHash</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">boolean</span>&gt; = {};
    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">`style[<span class="hljs-subst">${ATTR_MARK}</span>]`</span>)).<span class="hljs-title function_">forEach</span>(
      <span class="hljs-function">(<span class="hljs-params">style</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> hash = style.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-variable constant_">ATTR_MARK</span>)!;
        <span class="hljs-keyword">if</span> (styleHash[hash]) {
          <span class="hljs-keyword">if</span> ((style <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)[<span class="hljs-variable constant_">CSS_IN_JS_INSTANCE</span>] === cssinjsInstanceId) {
            style.<span class="hljs-property">parentNode</span>?.<span class="hljs-title function_">removeChild</span>(style);
          }
        } <span class="hljs-keyword">else</span> {
          styleHash[hash] = <span class="hljs-literal">true</span>;
        }
      },
    );
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheEntity</span>(cssinjsInstanceId);
}
</code></pre>
<ol start="3">
<li>è¿”å›ä¸€ä¸ªç±»åŒ…è£¹çš„ <code>Map</code> ç»“æ„ï¼Œåœ¨ <code>StyleProvider</code> ä¸­ç”±åä»£ç»„ä»¶æŠŠé¦–å±æ‰€éœ€æ ·å¼ä¼ å›ã€‚ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">KeyType</span> = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ValueType</span> = [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">any</span>];
<span class="hljs-comment">/** Connect key with `SPLIT` */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">pathKey</span>(<span class="hljs-params">keys: KeyType[]</span>): <span class="hljs-built_in">string</span>;
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entity</span> {
    <span class="hljs-attr">instanceId</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">instanceId: <span class="hljs-built_in">string</span></span>);
    <span class="hljs-comment">/** <span class="hljs-doctag">@private</span> Internal cache map. Do not access this directly */</span>
    <span class="hljs-attr">cache</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ValueType</span>&gt;;
    <span class="hljs-attr">extracted</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">string</span>&gt;;
    <span class="hljs-title function_">get</span>(<span class="hljs-attr">keys</span>: <span class="hljs-title class_">KeyType</span>[]): <span class="hljs-title class_">ValueType</span> | <span class="hljs-literal">null</span>;
    <span class="hljs-comment">/** A fast get cache with `get` concat. */</span>
    <span class="hljs-title function_">opGet</span>(<span class="hljs-attr">keyPathStr</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">ValueType</span> | <span class="hljs-literal">null</span>;
    <span class="hljs-title function_">update</span>(<span class="hljs-attr">keys</span>: <span class="hljs-title class_">KeyType</span>[], <span class="hljs-attr">valueFn</span>: <span class="hljs-function">(<span class="hljs-params">origin: ValueType | <span class="hljs-literal">null</span></span>) =&gt;</span> <span class="hljs-title class_">ValueType</span> | <span class="hljs-literal">null</span>): <span class="hljs-built_in">void</span>;
    <span class="hljs-comment">/** A fast get cache with `get` concat. */</span>
    <span class="hljs-title function_">opUpdate</span>(<span class="hljs-attr">keyPathStr</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">valueFn</span>: <span class="hljs-function">(<span class="hljs-params">origin: ValueType | <span class="hljs-literal">null</span></span>) =&gt;</span> <span class="hljs-title class_">ValueType</span> | <span class="hljs-literal">null</span>): <span class="hljs-built_in">void</span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Entity</span>;
</code></pre>
<p>è‡³äº <code>StyleProvider</code>ï¼Œé™¤äº†æ•´åˆä¸Šå±‚ <code>StyleProvider</code> æ³¨å…¥çš„æ ·å¼å¤–ï¼Œå®ƒåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªæ™®é€šçš„ <code>Context.Provider</code>ï¼Œä½œç”¨ä¹Ÿå¾ˆå¥½çŒœï¼ŒæŠŠ <code>createCache</code> è¿”å›çš„ <code>Map</code> ç»“æ„æ³¨å…¥åˆ°ä¸‹å±‚ç»„ä»¶ä¸­ã€‚</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">StyleContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-property">createContext</span>&lt;<span class="hljs-title class_">StyleContextProps</span>&gt;({
  <span class="hljs-attr">hashPriority</span>: <span class="hljs-string">'low'</span>,
  <span class="hljs-attr">cache</span>: <span class="hljs-title function_">createCache</span>(),
  <span class="hljs-attr">defaultCache</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">autoPrefix</span>: <span class="hljs-literal">false</span>,
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">StyleProvider</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">StyleProviderProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> {
  <span class="hljs-comment">// ...</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">StyleContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{context}</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">StyleContext.Provider</span>&gt;</span></span>
  );
};

</code></pre>
<h3 data-id="heading-5">Antd ç»„ä»¶çš„è°ƒç”¨è·¯å¾„</h3>
<p>å…·ä½“æºç å°±ä¸ç»†çœ‹äº†ï¼Œä»¥æŒ‰é’®ç»„ä»¶ Button ä¸ºä¾‹ï¼Œè°ƒç”¨è·¯å¾„å¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    subgraph CSSInJS åº•å±‚æœºåˆ¶
        genStyleUtils["@ant-design/cssinjs-utils&lt;br/&gt;genStyleUtils"]
        genStyleHooks["@ant-design/cssinjs-utils&lt;br/&gt;genStyleHooks"]
        genComponentStyleHook["@ant-design/cssinjs-utils&lt;br/&gt;genComponentStyleHook"]
        useStyleRegister["@ant-design/cssinjs&lt;br/&gt;useStyleRegister"]
        useGlobalCache["@ant-design/cssinjs&lt;br/&gt;useGlobalCache"]
    end

    subgraph Antd ç»„ä»¶å±‚
        useStyleAntd[useStyle]
        Button[Buttonç»„ä»¶]
        JSX[å†™å…¥åˆ°JSXå¹¶è¿”å›]
    end

    genStyleUtils --&gt;|ç”Ÿæˆ| genStyleHooks
    genStyleHooks --&gt;|è°ƒç”¨| genComponentStyleHook
    genComponentStyleHook --&gt;|è°ƒç”¨| useStyleRegister
    useStyleRegister --&gt;|è°ƒç”¨| useGlobalCache
    
    genStyleHooks --&gt;|è¿”å›| useStyleAntd
    
    Button --&gt;|è°ƒç”¨| useStyleAntd
    useStyleAntd --&gt;|æ ·å¼æ³¨å…¥| JSX
</code></pre>
<p>åœ¨ useGlobalCache ä¸­ è°ƒç”¨ <code>React.useContext(StyleContext)</code> çš„ <code>cache.onUpdate</code>æ–¹æ³•æ›´æ–°ç¼“å­˜ã€‚</p>
<h2 data-id="heading-6">æ€»ç»“</h2>
<p>è¿™æ¬¡ç¢°åˆ°çš„é—®é¢˜å…¶å®æŒºå…¸å‹çš„ï¼šå‡çº§äº†ä¾èµ–ï¼Œç»“æœé¡µé¢å‡ºé—®é¢˜äº†ã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•â€”â€”æŠŠ @ant-design/nextjs-registry ä» 1.3.0 é™çº§åˆ° 1.2.0ï¼Œè®©å®ƒè·Ÿ antd ç”¨çš„ @ant-design/cssinjs å†…éƒ¨ç‰ˆæœ¬å¯¹ä¸Šå°±è¡Œäº†ã€‚</p>
<p>ä»¥åè¦æ˜¯ç”¨ Next.js App Router é… Ant Design é‡åˆ°ç±»ä¼¼æƒ…å†µï¼Œå¯ä»¥å…ˆçœ‹çœ‹è¿™ä¸¤ä¸ªåŒ…çš„ç‰ˆæœ¬æ˜¯ä¸æ˜¯å…¼å®¹ã€‚æœ‰æ—¶å€™é—®é¢˜æ²¡çœ‹èµ·æ¥é‚£ä¹ˆå¤æ‚ï¼Œå¯èƒ½å°±æ˜¯ç‰ˆæœ¬æ²¡å¯¹ä¸Šã€‚</p>
<p>å‡ºäºå¥½å¥‡ï¼Œæˆ‘è¿˜é¡ºä¾¿çœ‹äº†ä¸€ä¸‹ AntdRegistry å†…éƒ¨çš„å®ç°â€”â€”å‘ç°å®ƒä¸»è¦æ˜¯é€šè¿‡ <code>StyleProvider</code> åœ¨æœåŠ¡ç«¯æ”¶é›†æ ·å¼ï¼Œç„¶åé€šè¿‡ <code>useServerInsertedHTML</code> åœ¨å®¢æˆ·ç«¯é¦–æ¬¡æ¸²æŸ“æ—¶æ³¨å…¥åˆ° <code>style</code> æ ‡ç­¾ä¸­ï¼Œè¿™æ ·å°±èƒ½é¿å…æ ·å¼é—ªçƒçš„é—®é¢˜ã€‚</p>
<blockquote>
<p>å¤§å®¶çš„é˜…è¯»æ˜¯æˆ‘å‘å¸–çš„åŠ¨åŠ›ï¼Œæœ¬æ–‡é¦–å‘äºæˆ‘çš„åšå®¢ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeer.shika-blog.xyz" target="_blank" title="https://deer.shika-blog.xyz" ref="nofollow noopener noreferrer">deer.shika-blog.xyz</a>ï¼Œæ¬¢è¿å¤§å®¶æ¥ç©<del>å–µ</del>ï¼Œ è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¼ä¸šçº§å…¨æ ˆé¡¹ç›®(14) winstonè®°å½•æ‰€æœ‰æ—¥å¿—]]></title>    <link>https://juejin.cn/post/7583892482598207503</link>    <guid>https://juejin.cn/post/7583892482598207503</guid>    <pubDate>2025-12-15T09:41:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583892482598207503" data-draft-id="7583903159773659151" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¼ä¸šçº§å…¨æ ˆé¡¹ç›®(14) winstonè®°å½•æ‰€æœ‰æ—¥å¿—"/> <meta itemprop="keywords" content="Vue.js,Node.js,å‰ç«¯æ¡†æ¶"/> <meta itemprop="datePublished" content="2025-12-15T09:41:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°èƒ–éœ"/> <meta itemprop="url" content="https://juejin.cn/user/3790771822016301"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¼ä¸šçº§å…¨æ ˆé¡¹ç›®(14) winstonè®°å½•æ‰€æœ‰æ—¥å¿—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3790771822016301/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°èƒ–éœ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:41:58.000Z" title="Mon Dec 15 2025 09:41:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>winstonÂ æ˜¯ Node.js ç”Ÿæ€ä¸­æœ€æµè¡Œçš„æ—¥å¿—åº“ï¼Œé€šå¸¸é…åˆÂ winston-daily-rotate-fileÂ ä½¿ç”¨ï¼Œä»¥å®ç°<strong>æŒ‰å¤©åˆ‡å‰²æ—¥å¿—æ–‡ä»¶</strong>ï¼ˆé˜²æ­¢ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶æ— é™è†¨èƒ€åˆ°å‡ ä¸ªGBï¼‰ã€‚
æˆ‘ä»¬å°†å®ç°ä»¥ä¸‹ç›®æ ‡ï¼š</p>
<ol>
<li><strong>è®¿é—®æ—¥å¿—</strong>ï¼šè®°å½•æ‰€æœ‰ HTTP è¯·æ±‚ï¼ˆæ—¶é—´ã€IPã€URLã€Methodã€çŠ¶æ€ç ã€è€—æ—¶ï¼‰ã€‚</li>
<li><strong>é”™è¯¯æ—¥å¿—</strong>ï¼šè®°å½•æ‰€æœ‰çš„å¼‚å¸¸å’ŒæŠ¥é”™å †æ ˆã€‚</li>
<li><strong>æ—¥å¿—åˆ‡å‰²</strong>ï¼šæ¯å¤©è‡ªåŠ¨ç”Ÿæˆæ–°æ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨æ¸…ç†æ—§æ—¥å¿—ï¼ˆå¦‚ä¿ç•™30å¤©ï¼‰ã€‚</li>
<li><strong>åˆ†ç¯å¢ƒå¤„ç†</strong>ï¼šå¼€å‘ç¯å¢ƒåœ¨æ§åˆ¶å°æ‰“å°å½©è‰²æ—¥å¿—ï¼Œç”Ÿäº§ç¯å¢ƒå†™å…¥æ–‡ä»¶ã€‚</li>
</ol>
<h3 data-id="heading-0">ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-js" lang="js">npm install winston winston-daily-rotate-file
</code></pre>
<h3 data-id="heading-1">ç¬¬äºŒæ­¥ï¼šå°è£… Logger å·¥å…·ç±» (src/utils/logger.js)</h3>
<p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå…¨å±€å•ä¾‹çš„ Logger å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> winston <span class="hljs-keyword">from</span> <span class="hljs-string">'winston'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'winston-daily-rotate-file'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-comment">// å®šä¹‰æ—¥å¿—ç›®å½•</span>
<span class="hljs-keyword">const</span> logDir = <span class="hljs-string">'logs'</span>

<span class="hljs-comment">// å®šä¹‰æ—¥å¿—æ ¼å¼</span>
<span class="hljs-keyword">const</span> { combine, timestamp, printf, json, colorize } = winston.<span class="hljs-property">format</span>

<span class="hljs-comment">// è‡ªå®šä¹‰æ§åˆ¶å°æ‰“å°æ ¼å¼</span>
<span class="hljs-keyword">const</span> consoleFormat = <span class="hljs-title function_">printf</span>(<span class="hljs-function">(<span class="hljs-params">{ level, message, timestamp, ...metadata }</span>) =&gt;</span> {
  <span class="hljs-keyword">let</span> msg = <span class="hljs-string">`<span class="hljs-subst">${timestamp}</span> [<span class="hljs-subst">${level}</span>]: <span class="hljs-subst">${message}</span>`</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(metadata).<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    msg += <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(metadata)
  }
  <span class="hljs-keyword">return</span> msg
})

<span class="hljs-comment">// åˆ›å»º Logger å®ä¾‹</span>
<span class="hljs-keyword">const</span> logger = winston.<span class="hljs-title function_">createLogger</span>({
  <span class="hljs-attr">level</span>: <span class="hljs-string">'info'</span>, <span class="hljs-comment">// é»˜è®¤æ—¥å¿—çº§åˆ«</span>
  <span class="hljs-attr">format</span>: <span class="hljs-title function_">combine</span>(
    <span class="hljs-title function_">timestamp</span>({ <span class="hljs-attr">format</span>: <span class="hljs-string">'YYYY-MM-DD HH:mm:ss'</span> }),
    <span class="hljs-title function_">json</span>() <span class="hljs-comment">// æ–‡ä»¶ä¸­å­˜å‚¨ JSON æ ¼å¼ï¼Œæ–¹ä¾¿åç»­ç”¨ ELK ç­‰å·¥å…·åˆ†æ</span>
  ),
  <span class="hljs-attr">transports</span>: [
    <span class="hljs-comment">// 1. é”™è¯¯æ—¥å¿—ï¼šåªè®°å½• error çº§åˆ«çš„æ—¥å¿—</span>
    <span class="hljs-keyword">new</span> winston.<span class="hljs-property">transports</span>.<span class="hljs-title class_">DailyRotateFile</span>({
      <span class="hljs-attr">dirname</span>: path.<span class="hljs-title function_">join</span>(logDir, <span class="hljs-string">'error'</span>),
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'error-%DATE%.log'</span>,
      <span class="hljs-attr">datePattern</span>: <span class="hljs-string">'YYYY-MM-DD'</span>,
      <span class="hljs-attr">level</span>: <span class="hljs-string">'error'</span>,
      <span class="hljs-attr">zippedArchive</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å‹ç¼©æ—§æ—¥å¿—</span>
      <span class="hljs-attr">maxSize</span>: <span class="hljs-string">'20m'</span>,      <span class="hljs-comment">// å•ä¸ªæ–‡ä»¶æœ€å¤§ 20MB</span>
      <span class="hljs-attr">maxFiles</span>: <span class="hljs-string">'30d'</span>      <span class="hljs-comment">// ä¿ç•™ 30 å¤©</span>
    }),
    
    <span class="hljs-comment">// 2. ç»¼åˆæ—¥å¿—ï¼šè®°å½• info åŠä»¥ä¸Šçº§åˆ«çš„æ—¥å¿— (åŒ…å«è®¿é—®æ—¥å¿—)</span>
    <span class="hljs-keyword">new</span> winston.<span class="hljs-property">transports</span>.<span class="hljs-title class_">DailyRotateFile</span>({
      <span class="hljs-attr">dirname</span>: path.<span class="hljs-title function_">join</span>(logDir, <span class="hljs-string">'combined'</span>),
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'combined-%DATE%.log'</span>,
      <span class="hljs-attr">datePattern</span>: <span class="hljs-string">'YYYY-MM-DD'</span>,
      <span class="hljs-attr">zippedArchive</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">maxSize</span>: <span class="hljs-string">'20m'</span>,
      <span class="hljs-attr">maxFiles</span>: <span class="hljs-string">'30d'</span>
    })
  ]
})

<span class="hljs-comment">// å¦‚æœä¸æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œä¹Ÿåœ¨æ§åˆ¶å°æ‰“å°ï¼Œå¹¶å¼€å¯é¢œè‰²</span>
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">'production'</span>) {
  logger.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> winston.<span class="hljs-property">transports</span>.<span class="hljs-title class_">Console</span>({
    <span class="hljs-attr">format</span>: <span class="hljs-title function_">combine</span>(
      <span class="hljs-title function_">colorize</span>(),
      <span class="hljs-title function_">timestamp</span>({ <span class="hljs-attr">format</span>: <span class="hljs-string">'YYYY-MM-DD HH:mm:ss'</span> }),
      consoleFormat
    )
  }))
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> logger
</code></pre>
<h3 data-id="heading-2">ç¬¬ä¸‰æ­¥ï¼šç¼–å†™ HTTP è®¿é—®æ—¥å¿—ä¸­é—´ä»¶ (src/middleware/httpLogger.js)</h3>
<p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸­é—´ä»¶ï¼Œåƒä¿å®‰ä¸€æ ·ï¼Œè®°å½•è¿›å‡ºçš„æ¯ä¸€ä¸ªè¯·æ±‚ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> logger <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/logger.js'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">httpLogger</span> = (<span class="hljs-params">req, res, next</span>) =&gt; {
  <span class="hljs-comment">// 1. è®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´</span>
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()

  <span class="hljs-comment">// 2. ç›‘å¬å“åº”å®Œæˆäº‹ä»¶ (finish)</span>
  res.<span class="hljs-title function_">on</span>(<span class="hljs-string">'finish'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// è®¡ç®—è€—æ—¶</span>
    <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start
    
    <span class="hljs-comment">// è·å– IP (å…¼å®¹ Nginx ä»£ç†)</span>
    <span class="hljs-keyword">const</span> ip = req.<span class="hljs-property">headers</span>[<span class="hljs-string">'x-forwarded-for'</span>] || req.<span class="hljs-property">socket</span>.<span class="hljs-property">remoteAddress</span>
    
    <span class="hljs-comment">// ç»„è£…æ—¥å¿—ä¿¡æ¯</span>
    <span class="hljs-keyword">const</span> logInfo = {
      <span class="hljs-attr">method</span>: req.<span class="hljs-property">method</span>,
      <span class="hljs-attr">url</span>: req.<span class="hljs-property">originalUrl</span>,
      <span class="hljs-attr">status</span>: res.<span class="hljs-property">statusCode</span>,
      <span class="hljs-attr">duration</span>: <span class="hljs-string">`<span class="hljs-subst">${duration}</span>ms`</span>,
      <span class="hljs-attr">ip</span>: ip,
      <span class="hljs-attr">userAgent</span>: req.<span class="hljs-property">headers</span>[<span class="hljs-string">'user-agent'</span>] || <span class="hljs-string">''</span>
    }

    <span class="hljs-comment">// æ ¹æ®çŠ¶æ€ç å†³å®šæ—¥å¿—çº§åˆ«</span>
    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">statusCode</span> &gt;= <span class="hljs-number">500</span>) {
      logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">'HTTP Request Error'</span>, logInfo)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (res.<span class="hljs-property">statusCode</span> &gt;= <span class="hljs-number">400</span>) {
      logger.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'HTTP Client Error'</span>, logInfo)
    } <span class="hljs-keyword">else</span> {
      logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'HTTP Access'</span>, logInfo)
    }
  })

  <span class="hljs-title function_">next</span>()
}
</code></pre>
<h3 data-id="heading-3">ç¬¬å››æ­¥ï¼šé›†æˆåˆ°å…¥å£æ–‡ä»¶ (app.js)</h3>
<p>æˆ‘ä»¬éœ€è¦æŠŠÂ httpLoggerÂ æ”¾åœ¨æ‰€æœ‰è·¯ç”±çš„<strong>æœ€å‰é¢</strong>ï¼ŒæŠŠé”™è¯¯è®°å½•æ”¾åœ¨æ‰€æœ‰è·¯ç”±çš„<strong>æœ€åé¢</strong>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>
<span class="hljs-keyword">import</span> logger <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/logger.js'</span>         <span class="hljs-comment">// å¼•å…¥ logger</span>
<span class="hljs-keyword">import</span> { httpLogger } <span class="hljs-keyword">from</span> <span class="hljs-string">'./middleware/httpLogger.js'</span> <span class="hljs-comment">// å¼•å…¥ä¸­é—´ä»¶</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HttpError</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/HttpError.js'</span>

<span class="hljs-comment">// ... å…¶ä»–å¼•å…¥ (helmet, cors ç­‰)</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()

<span class="hljs-comment">// ==========================================</span>
<span class="hljs-comment">// 1. æŒ‚è½½è®¿é—®æ—¥å¿—ä¸­é—´ä»¶ (å¿…é¡»æ”¾åœ¨æœ€å‰é¢)</span>
<span class="hljs-comment">// ==========================================</span>
app.<span class="hljs-title function_">use</span>(httpLogger)

<span class="hljs-comment">// ... å…¶ä»–ä¸­é—´ä»¶ (json, cors, helmet) ...</span>

<span class="hljs-comment">// ... ä½ çš„è·¯ç”± (routes) ...</span>
<span class="hljs-comment">// app.use('/api/admin', adminRouter)</span>
<span class="hljs-comment">// app.use('/api/app', appRouter)</span>


<span class="hljs-comment">// ==========================================</span>
<span class="hljs-comment">// 2. å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶ (å¿…é¡»æ”¾åœ¨æœ€å)</span>
<span class="hljs-comment">// ==========================================</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">err, req, res, next</span>) =&gt;</span> {
  <span class="hljs-comment">// è®°å½•é”™è¯¯æ—¥å¿—åˆ°æ–‡ä»¶</span>
  logger.<span class="hljs-title function_">error</span>(err.<span class="hljs-property">message</span>, {
    <span class="hljs-attr">stack</span>: err.<span class="hljs-property">stack</span>, <span class="hljs-comment">// è®°å½•å †æ ˆä¿¡æ¯ï¼Œæ–¹ä¾¿æ’æŸ¥ Bug</span>
    <span class="hljs-attr">url</span>: req.<span class="hljs-property">originalUrl</span>,
    <span class="hljs-attr">method</span>: req.<span class="hljs-property">method</span>,
    <span class="hljs-attr">ip</span>: req.<span class="hljs-property">ip</span>
  })

  <span class="hljs-comment">// å¦‚æœæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ HttpErrorï¼Œè¿”å›å¯¹åº”çš„çŠ¶æ€ç </span>
  <span class="hljs-keyword">if</span> (err <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HttpError</span>) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(err.<span class="hljs-property">code</span>).<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: err.<span class="hljs-property">code</span>,
      <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span>
    })
  }

  <span class="hljs-comment">// å…¶å®ƒæœªçŸ¥é”™è¯¯ï¼Œç»Ÿä¸€æŠ¥ 500</span>
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">code</span>: <span class="hljs-number">500</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜'</span>
  })
})

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3000</span>
app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
  logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Server is running on port <span class="hljs-subst">${PORT}</span>`</span>) <span class="hljs-comment">// ä½¿ç”¨ logger æ‰“å°å¯åŠ¨ä¿¡æ¯</span>
})
</code></pre>
<h3 data-id="heading-4">ç¬¬äº”æ­¥ï¼šæ•ˆæœæ¼”ç¤º</h3>
<h4 data-id="heading-5">1. å¯åŠ¨é¡¹ç›®</h4>
<pre><code class="hljs language-js" lang="js">nodemon app.<span class="hljs-property">js</span>
</code></pre>
<p>ä¼šå‘ç°é¡¹ç›®æ ¹ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªÂ logsÂ æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰Â combinedÂ å’ŒÂ errorÂ ä¸¤ä¸ªå­æ–‡ä»¶å¤¹ã€‚</p>
<h4 data-id="heading-6">2. å‘èµ·ä¸€ä¸ªæ­£å¸¸è¯·æ±‚ (GET /api/app/product/list)</h4>
<ul>
<li><strong>æ§åˆ¶å°</strong>ï¼šæ˜¾ç¤ºç»¿è‰²çš„æ—¥å¿—Â [info]: HTTP Access {"method":"GET", "status": 200 ...}</li>
<li><strong>æ–‡ä»¶</strong>Â (logs/combined/combined-2023-xx-xx.log)ï¼šå†™å…¥äº†ä¸€è¡Œ JSON è®°å½•ã€‚</li>
</ul>
<h4 data-id="heading-7">3. å‘èµ·ä¸€ä¸ªé”™è¯¯è¯·æ±‚ (å¯†ç é”™è¯¯ 400 æˆ– ä»£ç æŠ¥é”™ 500)</h4>
<ul>
<li><strong>æ–‡ä»¶</strong>Â (logs/error/error-2023-xx-xx.log)ï¼šä¼šè‡ªåŠ¨è®°å½•ä¸‹è¯¦ç»†çš„é”™è¯¯å †æ ˆÂ stackï¼Œè¿™å¯¹äºæ’æŸ¥çº¿ä¸Šé—®é¢˜è‡³å…³é‡è¦ï¼Œä½ å†ä¹Ÿä¸ç”¨ç›¯ç€é»‘ä¹ä¹çš„æ§åˆ¶å°æˆ–è€…çŒœæµ‹æŠ¥é”™åŸå› äº†ã€‚</li>
</ul>
<h3 data-id="heading-8">æ€»ç»“</h3>
<p>é€šè¿‡å¼•å…¥Â winstonï¼š</p>
<ol>
<li><strong>è‡ªåŠ¨åŒ–</strong>ï¼šæ—¥å¿—è‡ªåŠ¨æŒ‰å¤©åˆ†å‰²ï¼Œè‡ªåŠ¨å‹ç¼©ï¼Œä¸ç”¨æ‹…å¿ƒç£ç›˜å†™æ»¡ã€‚</li>
<li><strong>ç»“æ„åŒ–</strong>ï¼šæ—¥å¿—ä»¥ JSON æ ¼å¼å­˜å‚¨ï¼Œæ–¹ä¾¿ä»¥åæ¥å…¥ ELK (Elasticsearch, Logstash, Kibana) åšå¯è§†åŒ–ç›‘æ§ã€‚</li>
<li><strong>å¯è¿½æº¯</strong>ï¼šä»»ä½•æŠ¥é”™éƒ½æœ‰æ—¶é—´ã€å †æ ˆå’Œè¯·æ±‚å‚æ•°ï¼Œè¿ç»´å’Œæ’æŸ¥æ•ˆç‡æå‡ 10 å€ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼šä»O(nÂ²)å“ˆå¸Œä¼˜åŒ–åˆ°æ»‘åŠ¨çª—å£å°ç¥ï¼Œå†åˆ°DPé™ç»´æ‰“å‡»ï¼]]></title>    <link>https://juejin.cn/post/7583707681003520046</link>    <guid>https://juejin.cn/post/7583707681003520046</guid>    <pubDate>2025-12-15T09:30:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583707681003520046" data-draft-id="7583707681003405358" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼šä»O(nÂ²)å“ˆå¸Œä¼˜åŒ–åˆ°æ»‘åŠ¨çª—å£å°ç¥ï¼Œå†åˆ°DPé™ç»´æ‰“å‡»ï¼"/> <meta itemprop="keywords" content="å‰ç«¯,ç®—æ³•,JavaScript"/> <meta itemprop="datePublished" content="2025-12-15T09:30:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ €ç§‹666"/> <meta itemprop="url" content="https://juejin.cn/user/2566698322650307"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼šä»O(nÂ²)å“ˆå¸Œä¼˜åŒ–åˆ°æ»‘åŠ¨çª—å£å°ç¥ï¼Œå†åˆ°DPé™ç»´æ‰“å‡»ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2566698322650307/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ €ç§‹666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:30:06.000Z" title="Mon Dec 15 2025 09:30:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<h2 data-id="heading-0">ğŸ’¼ é¢è¯•çœŸå®åœºæ™¯è¿˜åŸï¼šä½ ä»¥ä¸ºçš„â€œèªæ˜è§£æ³•â€ï¼Œå…¶å®æ˜¯åŠåŠå­é™·é˜±</h2>
<p>ä½ ä¿¡å¿ƒæ»¡æ»¡åœ°ååœ¨ä¼šè®®å®¤é‡Œï¼Œé¢è¯•å®˜å¾®å¾®ä¸€ç¬‘ï¼š</p>
<blockquote>
<p>â€œæ¥ï¼Œå®ç°ä¸€ä¸ªå‡½æ•° <code>lengthOfLongestSubstring(s)</code>ï¼Œæ‰¾å‡ºå­—ç¬¦ä¸²ä¸­æœ€é•¿æ— é‡å¤å­—ç¬¦çš„å­ä¸²é•¿åº¦ã€‚â€</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9cfa517eef44870a35e82334e18cb27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qCA56eLNjY2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395806&amp;x-signature=gmqHVkXZ2udDIxfKcnMffcJWoNg%3D" alt="image.png" loading="lazy"/></p>
<p>ä½ å¿ƒé‡Œä¸€å–œï¼šè¿™é¢˜æˆ‘ä¼šï¼ä¸æ˜¯æœ‰é‡å¤å°±ç”¨å“ˆå¸Œè¡¨å—ï¼Ÿ</p>
<p>äºæ˜¯ä½ æç¬”å°±å†™ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">lengthOfLongestSubstring</span>(<span class="hljs-params">s</span>) {
  <span class="hljs-keyword">let</span> maxLen = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; s.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> seen = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = i; j &lt; s.<span class="hljs-property">length</span>; j++) {
      <span class="hljs-keyword">if</span> (seen.<span class="hljs-title function_">has</span>(s[j])) <span class="hljs-keyword">break</span>;
      seen.<span class="hljs-title function_">add</span>(s[j]);
      maxLen = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(maxLen, j - i + <span class="hljs-number">1</span>);
    }
  }
  <span class="hljs-keyword">return</span> maxLen;
}
</code></pre>
<p>å†™å®Œè¿˜è¡¥å……ä¸€å¥ï¼šâ€œæˆ‘ç”¨äº† Set æ¥å»é‡ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(nÂ²)ï¼Œç©ºé—´ O(k)ï¼Œæ¯”ä¸‰é‡å¾ªç¯å¿«å¤šäº†ï¼â€</p>
<p>é¢è¯•å®˜ç‚¹ç‚¹å¤´ï¼šâ€œå—¯ï¼Œèƒ½è·‘ã€‚é‚£â€¦â€¦æœ‰æ²¡æœ‰æ›´ä¼˜çš„ï¼Ÿæˆ–è€…æ¢ä¸ªæ€è·¯ï¼Ÿâ€</p>
<p>ä½ æ„£ä½äº†ã€‚</p>
<p>ğŸ‘‰ å…¶å®ä½ ä¸çŸ¥é“çš„æ˜¯ï¼š<strong>è™½ç„¶æ»‘åŠ¨çª—å£æ˜¯è¿™é“é¢˜çš„ä¸»æµè§£æ³•ï¼Œä½†è¿™ä¸ªé—®é¢˜ç«Ÿç„¶ä¹Ÿèƒ½ç”¨ DPï¼ˆåŠ¨æ€è§„åˆ’ï¼‰ä¼˜é›…è§£å†³ï¼</strong></p>
<p>ä»Šå¤©æˆ‘ä»¬å°±æ¥ <strong>è¡¥å…¨æœ€åä¸€å—æ‹¼å›¾</strong> â€”â€” æ­ç§˜â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€çš„ <strong>ç¬¬ä¸‰ç§è§£æ³•ï¼šåŠ¨æ€è§„åˆ’</strong>ï¼Œå¹¶å…¨é¢å¯¹æ¯”ä¸‰ç§ä¸»æµæ–¹æ³•ï¼Œå¸¦ä½ ä»â€œåªä¼šèƒŒæ¨¡æ¿â€è¿›åŒ–åˆ°â€œçœŸæ­£ç†è§£çŠ¶æ€è½¬ç§»â€ã€‚</p>
<hr/>
<h2 data-id="heading-1">ğŸ”¥ é—®é¢˜æœ¬è´¨ï¼šä¸æ˜¯æ‰¾â€œå‰ä»»åˆ—è¡¨â€ï¼Œæ˜¯æ‰¾â€œè¿ç»­æ‹çˆ±æœŸâ€</h2>
<p>é¦–å…ˆææ¸…æ¥šä¸€ä»¶äº‹ï¼š<strong>å­ä¸² â‰  å­åºåˆ—</strong>ï¼</p>
<ul>
<li><strong>å­åºåˆ—</strong>ï¼šåƒå›å¿†å½•ï¼Œå¯ä»¥è·³ç€çœ‹ï¼Œä¸­é—´æ–­å‡ å¹´éƒ½è¡Œã€‚</li>
<li><strong>å­ä¸²</strong>ï¼šåƒåŒå±…ç”Ÿæ´»ï¼Œå¿…é¡»å¤©å¤©è§é¢ï¼Œè¿˜å¾—ä½åœ¨ä¸€èµ·ï¼ˆè¿ç»­ï¼‰ï¼</li>
</ul>
<p>é¢˜ç›®è¦æ±‚æˆ‘ä»¬æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­<strong>æœ€é•¿çš„ä¸€æ®µè¿ç»­åŒºé—´</strong>ï¼Œé‡Œé¢æ¯ä¸ªå­—ç¬¦éƒ½ä¸é‡å¤ã€‚æ¯”å¦‚ï¼š</p>
<p>ğŸ‘‰ å­—ç¬¦ä¸² <code>"abcabcbb"</code><br/>
å¯èƒ½çš„ç­”æ¡ˆæœ‰ï¼š"abc"ã€"bca"ã€"cab" â€”â€” é•¿åº¦éƒ½æ˜¯ 3 âœ…<br/>
ä½†ä½ è¦æ˜¯è¯´ "abcb"ï¼Œå¯¹ä¸èµ·ï¼Œ'b' å‡ºç°ä¸¤æ¬¡ï¼Œå±äºâ€œæ„Ÿæƒ…åŠˆè…¿â€ï¼Œç›´æ¥å‡ºå±€ âŒ</p>
<p>ğŸ¯ ç›®æ ‡æ˜ç¡®ï¼šæ‰¾ä¸€æ®µ<strong>æœ€æŒä¹…ä¸”ä¸“ä¸€çš„è¿ç»­å…³ç³»</strong> ğŸ˜‚</p>
<p>è€Œä½ ä¹‹å‰çš„ O(nÂ²) è§£æ³•ï¼Œå°±åƒä¸€æ¬¡æ¬¡é‡æ–°è°ˆæ‹çˆ±ï¼š</p>
<ul>
<li>ä»ç¬¬ä¸€ä¸ªäººå¼€å§‹è°ˆ â†’ è°ˆåˆ°é‡å¤å°±åˆ†æ‰‹</li>
<li>å†ä»ç¬¬äºŒä¸ªäººå¼€å§‹è°ˆ â†’ åˆè°ˆä¸€éâ€¦â€¦</li>
</ul>
<p>èƒ½ä¸èƒ½åˆ«è¿™ä¹ˆç´¯ï¼Ÿèƒ½ä¸èƒ½â€œè¾¹èµ°è¾¹è°ƒæ•´â€ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½é‡å¤´å†æ¥ï¼Ÿ</p>
<p>å½“ç„¶èƒ½ï¼è¿™å°±å¼•å‡ºæˆ‘ä»¬çš„ç»ˆææ­¦å™¨â€”â€”</p>
<hr/>
<h2 data-id="heading-2">ğŸ› ï¸ æ–¹æ³•ä¸€ï¼šæš´åŠ› + å“ˆå¸Œä¼˜åŒ–ï¼ˆO(nÂ²)ï¼‰â€”â€” åˆçº§é€‰æ‰‹çš„èˆ’é€‚åŒº</h2>
<h3 data-id="heading-3">âœ… æ€è·¯å›é¡¾ï¼š</h3>
<p>æšä¸¾æ‰€æœ‰èµ·ç‚¹ <code>i</code>ï¼Œä»è¯¥ç‚¹å‡ºå‘å‘å³æ‰©å±•ï¼Œç›´åˆ°é‡åˆ°é‡å¤å­—ç¬¦ä¸ºæ­¢ã€‚</p>
<p>ä½¿ç”¨ <code>Set</code> å¿«é€Ÿåˆ¤æ–­æ˜¯å¦é‡å¤ï¼Œé¿å…å†…å±‚å†éå†ä¸€æ¬¡ã€‚</p>
<h3 data-id="heading-4">âœ… ä»£ç å®ç°ï¼š</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">lengthOfLongestSubstring_O_n2</span>(<span class="hljs-params">s</span>) {
  <span class="hljs-keyword">let</span> maxLen = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; s.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> seen = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = i; j &lt; s.<span class="hljs-property">length</span>; j++) {
      <span class="hljs-keyword">if</span> (seen.<span class="hljs-title function_">has</span>(s[j])) <span class="hljs-keyword">break</span>;
      seen.<span class="hljs-title function_">add</span>(s[j]);
      maxLen = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(maxLen, j - i + <span class="hljs-number">1</span>);
    }
  }
  <span class="hljs-keyword">return</span> maxLen;
}
</code></pre>
<h3 data-id="heading-5">âš ï¸ ç¼ºç‚¹åˆ†æï¼š</h3>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ä»æ˜¯ O(nÂ²)ï¼Œåœ¨é•¿å­—ç¬¦ä¸²ä¸‹ä¼šè¶…æ—¶ï¼ˆå¦‚ LeetCode æµ‹è¯•ç”¨ä¾‹ï¼‰</li>
<li>è™½ç„¶ç”¨äº† Set ä¼˜åŒ–ï¼Œä½†æœ¬è´¨ä¸Šè¿˜æ˜¯â€œé‡å¤åŠ³åŠ¨â€ï¼šå¾ˆå¤šå­ä¸²è¢«åå¤æ‰«æ</li>
</ul>
<blockquote>
<p>ğŸ’¬ ç±»æ¯”ï¼šæ¯æ¬¡å¤±æ‹åéƒ½è¦é‡æ–°ç›¸äº²ï¼Œä¸èƒ½å¸å–æ•™è®­ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">ğŸ§© æ–¹æ³•äºŒï¼šæ»‘åŠ¨çª—å£ + Mapï¼ˆO(n)ï¼‰â€”â€” ä¸»æµç‹è€…æ–¹æ¡ˆ</h2>
<h3 data-id="heading-7">âœ… æ ¸å¿ƒæ€æƒ³ï¼š</h3>
<p>ç»´æŠ¤ä¸€ä¸ªâ€œåŠ¨æ€çª—å£â€ <code>[left, i]</code>ï¼Œåªå…è®¸æ— é‡å¤å­—ç¬¦å­˜åœ¨ã€‚</p>
<p>å³æŒ‡é’ˆ <code>i</code> ä¸æ–­æ‰©å¼ ï¼Œå·¦æŒ‡é’ˆ <code>left</code> åœ¨å‘ç°é‡å¤æ—¶æ”¶ç¼©ã€‚</p>
<p>åˆ©ç”¨ <code>Map</code> è®°å½•æ¯ä¸ªå­—ç¬¦æœ€è¿‘å‡ºç°çš„ä½ç½®ï¼Œå®ç° O(1) æŸ¥æ‰¾ã€‚</p>
<h3 data-id="heading-8">âœ… å…³é”®é€»è¾‘ï¼š</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">if</span> (map.<span class="hljs-title function_">has</span>(char) &amp;&amp; map.<span class="hljs-title function_">get</span>(char) &gt;= left) {
  left = map.<span class="hljs-title function_">get</span>(char) + <span class="hljs-number">1</span>; <span class="hljs-comment">// ç§»åŠ¨å·¦è¾¹ç•Œ</span>
}
</code></pre>
<blockquote>
<p>åªæœ‰å½“é‡å¤å­—ç¬¦ä½äºå½“å‰çª—å£å†…æ—¶æ‰è°ƒæ•´ <code>left</code>ï¼Œé˜²æ­¢â€œå›é€€â€ã€‚</p>
</blockquote>
<h3 data-id="heading-9">âœ… å®Œæ•´ä»£ç ï¼š</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">lengthOfLongestSubstring_SlidingWindow</span>(<span class="hljs-params">s</span>) {
  <span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>, res = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; s.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> char = s[i];
    <span class="hljs-keyword">if</span> (map.<span class="hljs-title function_">has</span>(char) &amp;&amp; map.<span class="hljs-title function_">get</span>(char) &gt;= left) {
      left = map.<span class="hljs-title function_">get</span>(char) + <span class="hljs-number">1</span>;
    }
    map.<span class="hljs-title function_">set</span>(char, i);
    res = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(res, i - left + <span class="hljs-number">1</span>);
  }

  <span class="hljs-keyword">return</span> res;
}
</code></pre>
<h3 data-id="heading-10">âœ… ä¼˜ç‚¹ï¼š</h3>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ O(n)ï¼Œæ¯ä¸ªå­—ç¬¦ä»…è®¿é—®ä¸€æ¬¡</li>
<li>ç©ºé—´ O(k)ï¼Œk ä¸ºå­—ç¬¦é›†å¤§å°</li>
<li>é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºè¿ç§»è‡³å…¶ä»–å­ä¸²é—®é¢˜</li>
</ul>
<hr/>
<h2 data-id="heading-11">ğŸ¯ æ–¹æ³•ä¸‰ï¼šåŠ¨æ€è§„åˆ’ DPï¼ˆO(n)ï¼‰â€”â€” é«˜é˜¶ç©å®¶çš„ç§˜å¯†æ­¦å™¨</h2>
<p>ä½ ä»¥ä¸º DP åªèƒ½åšèƒŒåŒ…å’Œçˆ¬æ¥¼æ¢¯ï¼Ÿé”™ï¼å®ƒä¹Ÿèƒ½ä¼˜é›…è§£å†³æœ¬é¢˜ï¼</p>
<h3 data-id="heading-12">âœ… æ ¸å¿ƒå®šä¹‰ï¼š</h3>
<p>è®¾ <code>dp[i]</code> è¡¨ç¤º <strong>ä»¥ç¬¬ i ä¸ªå­—ç¬¦ç»“å°¾çš„æœ€é•¿æ— é‡å¤å­ä¸²çš„é•¿åº¦</strong></p>
<p>æœ€ç»ˆç­”æ¡ˆï¼š<code>max(dp[0], dp[1], ..., dp[n-1])</code></p>
<hr/>
<h3 data-id="heading-13">ğŸ” çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ¨å¯¼ï¼š</h3>
<p>æˆ‘ä»¬è¦å›ç­”ï¼š<code>dp[i]</code> å¦‚ä½•ç”± <code>dp[i-1]</code> æ¨å‡ºï¼Ÿ</p>
<h4 data-id="heading-14">åˆ†ä¸¤ç§æƒ…å†µï¼š</h4>




















<table><thead><tr><th>æƒ…å†µ</th><th>æ¡ä»¶</th><th>è½¬ç§»æ–¹å¼</th></tr></thead><tbody><tr><td>âœ… å½“å‰å­—ç¬¦æœªå‡ºç°è¿‡</td><td><code>lastIndex == -1</code></td><td><code>dp[i] = dp[i-1] + 1</code></td></tr><tr><td>âœ… å½“å‰å­—ç¬¦æ›¾å‡ºç°è¿‡</td><td><code>lastIndex &gt;= 0</code></td><td><code>dp[i] = min(dp[i-1] + 1, i - lastIndex)</code></td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ è§£é‡Šï¼šæ–°å­ä¸²ä¸èƒ½åŒ…å«ä¸Šæ¬¡ç›¸åŒçš„å­—ç¬¦ï¼Œæ‰€ä»¥æœ€é•¿åªèƒ½ä» <code>lastIndex + 1</code> å¼€å§‹</p>
</blockquote>
<hr/>
<h3 data-id="heading-15">ğŸ“Œ DP è§£æ³•è¯¦ç»†æ­¥éª¤æ‹†è§£ï¼ˆä»¥ <code>"abcb"</code> ä¸ºä¾‹ï¼‰</h3>























































<table><thead><tr><th>i</th><th>s[i]</th><th>dp[i-1]</th><th>prevIndexï¼ˆä¸Šæ¬¡ä½ç½®ï¼‰</th><th>å¯é€‰é•¿åº¦1: dp[i-1]+1</th><th>å¯é€‰é•¿åº¦2: i - prevIndex</th><th>dp[i] = min(ä¸¤è€…)</th><th>å½“å‰æœ€é•¿å­ä¸²</th></tr></thead><tbody><tr><td>0</td><td>'a'</td><td>-</td><td>-1</td><td>1</td><td>0 - (-1) = 1</td><td>1</td><td>"a"</td></tr><tr><td>1</td><td>'b'</td><td>1</td><td>-1</td><td>2</td><td>1 - (-1) = 2</td><td>2</td><td>"ab"</td></tr><tr><td>2</td><td>'c'</td><td>2</td><td>-1</td><td>3</td><td>2 - (-1) = 3</td><td>3</td><td>"abc"</td></tr><tr><td>3</td><td>'b'</td><td>3</td><td>1</td><td>4</td><td>3 - 1 = 2</td><td>2</td><td>"cb"</td></tr></tbody></table>
<p>âœ… æœ€ç»ˆç»“æœï¼š<code>max(dp) = 3</code></p>
<hr/>
<h3 data-id="heading-16">âœ… å®Œæ•´ä»£ç å®ç°ï¼ˆDP ç‰ˆæœ¬ï¼‰</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">lengthOfLongestSubstring_DP</span>(<span class="hljs-params">s</span>) {
  <span class="hljs-keyword">if</span> (s.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

  <span class="hljs-keyword">const</span> dp = <span class="hljs-title class_">Array</span>(s.<span class="hljs-property">length</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// åˆå§‹åŒ– dp æ•°ç»„</span>
  <span class="hljs-keyword">const</span> charMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();           <span class="hljs-comment">// è®°å½•å­—ç¬¦æœ€åå‡ºç°ä½ç½®</span>
  <span class="hljs-keyword">let</span> res = <span class="hljs-number">1</span>;

  charMap.<span class="hljs-title function_">set</span>(s[<span class="hljs-number">0</span>], <span class="hljs-number">0</span>);  <span class="hljs-comment">// åˆå§‹åŒ–ç¬¬ä¸€ä¸ªå­—ç¬¦</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; s.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> prevIndex = charMap.<span class="hljs-title function_">has</span>(s[i]) ? charMap.<span class="hljs-title function_">get</span>(s[i]) : -<span class="hljs-number">1</span>;

    <span class="hljs-comment">// çŠ¶æ€è½¬ç§»ï¼šå–ä¸¤ä¸ªé™åˆ¶ä¸­çš„è¾ƒå°å€¼</span>
    dp[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
      dp[i - <span class="hljs-number">1</span>] + <span class="hljs-number">1</span>,     <span class="hljs-comment">// æœ€å¤šæ¯”å‰ä¸€ä¸ªå¤šä¸€ä¸ª</span>
      i - prevIndex      <span class="hljs-comment">// ä¸èƒ½è¶…è¿‡ä¸ä¸Šæ¬¡é‡å¤çš„è·ç¦»</span>
    );

    res = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(res, dp[i]);         <span class="hljs-comment">// æ›´æ–°å…¨å±€æœ€å¤§å€¼</span>
    charMap.<span class="hljs-title function_">set</span>(s[i], i);              <span class="hljs-comment">// æ›´æ–°å­—ç¬¦æœ€æ–°ä½ç½®</span>
  }

  <span class="hljs-keyword">return</span> res;
}
</code></pre>
<h3 data-id="heading-17">âœ… ä¼˜ç‚¹ï¼š</h3>
<ul>
<li>åŒæ · O(n) æ—¶é—´ï¼Œé€»è¾‘æ•°å­¦æ„Ÿå¼º</li>
<li>æ˜“äºæ‰©å±•åˆ°â€œè®°å½•å…·ä½“å­ä¸²â€ç­‰å˜ç§é—®é¢˜</li>
<li>å±•ç¤ºä½ å¯¹ DP çš„æ·±åˆ»ç†è§£ï¼Œé¢è¯•åŠ åˆ†é¡¹ï¼</li>
</ul>
<h3 data-id="heading-18">âš ï¸ ç¼ºç‚¹ï¼š</h3>
<ul>
<li>ç©ºé—´å¤æ‚åº¦ç•¥é«˜ï¼šéœ€è¦ O(n) çš„ dp æ•°ç»„ï¼ˆå¯ä¼˜åŒ–ä¸º O(1)ï¼‰</li>
<li>ç†è§£é—¨æ§›è¾ƒé«˜ï¼Œä¸é€‚åˆåˆå­¦è€…å¿«é€ŸæŒæ¡</li>
</ul>
<hr/>
<h2 data-id="heading-19">ğŸ”„ ä¸‰ç§æ–¹æ³•æ¨ªå‘å¯¹æ¯”å¤§è¡¨æ ¼</h2>





































<table><thead><tr><th>æ–¹æ³•</th><th>æ—¶é—´å¤æ‚åº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>æ˜¯å¦æ¨è</th><th>é€‚ç”¨äººç¾¤</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>æš´åŠ› + å“ˆå¸Œ</td><td>O(nÂ²)</td><td>O(k)</td><td>âŒ ä¸æ¨è</td><td>æ–°æ‰‹ç»ƒä¹ </td><td>å®¹æ˜“å†™å‡ºï¼Œä½†æ€§èƒ½å·®</td></tr><tr><td>æ»‘åŠ¨çª—å£ + Map</td><td><strong>O(n)</strong></td><td><strong>O(k)</strong></td><td>âœ… å¼ºçƒˆæ¨è</td><td>æ‰€æœ‰äºº</td><td>ä¸»æµè§£æ³•ï¼Œé«˜æ•ˆç®€æ´</td></tr><tr><td>åŠ¨æ€è§„åˆ’ DP</td><td><strong>O(n)</strong></td><td>O(n) / å¯ä¼˜åŒ–ä¸º O(k)</td><td>âœ… è¿›é˜¶æ¨è</td><td>ä¸­é«˜çº§å¼€å‘è€…</td><td>å±•ç¤ºæ€ç»´æ·±åº¦ï¼Œé€‚åˆæ·±å…¥æ¢è®¨</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ <strong>å°æŠ€å·§</strong>ï¼šä½ å¯ä»¥å…ˆå†™æ»‘åŠ¨çª—å£ä½œä¸ºä¸»è§£æ³•ï¼Œç„¶åè¡¥å……ä¸€å¥ï¼šâ€œå…¶å®è¿™é¢˜ä¹Ÿå¯ä»¥ç”¨ DP è§£å†³â€ï¼Œç¬é—´æå‡é€¼æ ¼ï¼</p>
</blockquote>
<hr/>
<h2 data-id="heading-20">ğŸ§  å¦‚ä½•é€‰æ‹©ï¼Ÿä¸€å¥è¯æ€»ç»“</h2>
<blockquote>
<ul>
<li><strong>æƒ³é€šè¿‡é¢è¯•ï¼Ÿâ†’ å†™æ»‘åŠ¨çª—å£</strong>ï¼ˆç¨³å®šã€é«˜æ•ˆã€æ˜“è®²ï¼‰</li>
<li><strong>æƒ³æƒŠè‰³é¢è¯•å®˜ï¼Ÿâ†’ æä¸€å¥ DP æ€è·¯</strong>ï¼ˆå±•ç°å¤šè§’åº¦æ€è€ƒï¼‰</li>
<li><strong>è¿˜åœ¨å†™åŒé‡å¾ªç¯ï¼Ÿâ†’ æ˜¯æ—¶å€™å‡çº§äº†ï¼</strong></li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-21">ğŸ¯ æ€»ç»“å‡åï¼šä¸åªæ˜¯åšé¢˜ï¼Œæ˜¯æ€ç»´è·ƒè¿</h2>
<p>è§£å†³â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€åœº<strong>ç®—æ³•è®¤çŸ¥çš„å‡çº§</strong>ï¼š</p>






























<table><thead><tr><th>å±‚æ¬¡</th><th>æ€ç»´æ–¹å¼</th><th>å…¸å‹è¡¨ç°</th></tr></thead><tbody><tr><td>æ–°æ‰‹</td><td>ä¸‰é‡å¾ªç¯</td><td>O(nÂ³)ï¼ŒCPU å“­æ™•</td></tr><tr><td>è¿›é˜¶</td><td>å“ˆå¸Œ+åŒé‡å¾ªç¯</td><td>O(nÂ²)ï¼Œçœ‹ä¼¼èªæ˜å®åˆ™ç¬¨</td></tr><tr><td>é«˜æ‰‹</td><td>æ»‘åŠ¨çª—å£ + Map</td><td>O(n)ï¼Œä¼˜é›…é«˜æ•ˆ</td></tr><tr><td>å¤§å¸ˆ</td><td>æ»‘åŠ¨çª—å£ + DP åŒè§†è§’</td><td>é¢è¯•å°ç¥ï¼Œoffer è‡ªå¸¦ BGM</td></tr></tbody></table>
<p>æŒæ¡è¿™ä¸‰ç§æ–¹æ³•ï¼Œä½ å°±æ‹¿åˆ°äº†æ‰“å¼€<strong>é«˜é¢‘é¢è¯•é¢˜å¤§é—¨çš„ä¸‡èƒ½é’¥åŒ™ + å¤‡ç”¨é’¥åŒ™ + é’¥åŒ™ä¸²ä¸Šçš„å¹¸è¿ç¬¦</strong>ï¼</p>
<hr/>
<h2 data-id="heading-22">ğŸŒŸ ç»“è¯­ï¼šæ„¿ä½ å†™çš„ä¸æ˜¯ä»£ç ï¼Œè€Œæ˜¯è‰ºæœ¯</h2>
<p>ä¸‹æ¬¡é¢è¯•å®˜å†é—®è¿™é“é¢˜ï¼Œä½ å¯ä»¥å¾®å¾®ä¸€ç¬‘ï¼š</p>
<blockquote>
<p>â€œè¿™é¢˜å•Šï¼Œæˆ‘ä¸ä»…ä¼šåšï¼Œè¿˜èƒ½è®²ä¸‰ç§è§£æ³•ã€‚â€</p>
</blockquote>
<p>å› ä¸ºä½ çŸ¥é“ï¼š</p>
<ul>
<li>æ»‘åŠ¨çª—å£æ˜¯èˆè¹ˆï¼Œ</li>
<li>Map æ˜¯è®°å¿†ï¼Œ</li>
<li>DP æ˜¯å“²å­¦ï¼Œ</li>
<li>è€Œä½ ï¼Œæ˜¯é‚£ä¸ªæŒæ§èŠ‚å¥çš„ç¼–èˆå¸ˆ + è®°å¿†ç®¡ç†è€… + å“²å­¦å®¶ã€‚</li>
</ul>
<p>ğŸ’» å†™ä»£ç ï¼Œä¹Ÿå¯ä»¥å¾ˆæµªæ¼«ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Amazon Connectç»“åˆStrandsæ¡†æ¶åŠBedrock Agent Coreçš„æ™ºèƒ½å®¢æœæœºå™¨äººè§£å†³æ–¹æ¡ˆï¼ˆå®è·µç¯‡ï¼‰]]></title>    <link>https://juejin.cn/post/7583906478328004627</link>    <guid>https://juejin.cn/post/7583906478328004627</guid>    <pubDate>2025-12-15T10:06:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906478328004627" data-draft-id="7583892482597847055" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Amazon Connectç»“åˆStrandsæ¡†æ¶åŠBedrock Agent Coreçš„æ™ºèƒ½å®¢æœæœºå™¨äººè§£å†³æ–¹æ¡ˆï¼ˆå®è·µç¯‡ï¼‰"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-15T10:06:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äºšé©¬é€Šäº‘å¼€å‘è€…"/> <meta itemprop="url" content="https://juejin.cn/user/2850395271209496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Amazon Connectç»“åˆStrandsæ¡†æ¶åŠBedrock Agent Coreçš„æ™ºèƒ½å®¢æœæœºå™¨äººè§£å†³æ–¹æ¡ˆï¼ˆå®è·µç¯‡ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2850395271209496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äºšé©¬é€Šäº‘å¼€å‘è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:06:14.000Z" title="Mon Dec 15 2025 10:06:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93fa72d8f1724511954986f93e5478a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=E3VhPW0NfQMzqZhsatnwPJ8sWq8%3D" alt="image.png" loading="lazy"/>
å»¶ç»­ä¹‹å‰å‘å¸ƒçš„åŸºäºBedrockå’ŒAmazon Connectæ‰“é€ æ™ºèƒ½å®¢æœè‡ªåŠ©æœåŠ¡è®¾è®¡ç¯‡ï¼Œæœ¬åšå®¢å°†å±•ç¤ºæ™ºèƒ½å®¢æœè‡ªåŠ©æœåŠ¡é¢†åŸŸä¸­å¦‚ä½•åˆ©ç”¨Strandsæ¡†æ¶å’ŒAmazon Connectè¿›è¡Œé›†æˆï¼ŒåŒæ—¶ç»“åˆBedrock AgentCore MemoryåŠRuntimeåŠŸèƒ½çš„æœ€ä½³å®è·µåŠè§£å†³æ–¹æ¡ˆæŠ€æœ¯æ¡†æ¶ã€‚</p>
<blockquote>
<p>ğŸ“¢é™æ—¶æ’æ’­ï¼šæ— éœ€ç®¡ç†åŸºç¡€è®¾æ–½ï¼Œåˆ©ç”¨äºšé©¬é€ŠæŠ€æœ¯ä¸ç”Ÿæ€ï¼Œå¿«é€Ÿé›†æˆä¸éƒ¨ç½²ç”Ÿæˆå¼AIæ¨¡å‹èƒ½åŠ›ã€‚</p>
<p>âœ¨ ç²¾å¿ƒè®¾è®¡ï¼Œæ—¨åœ¨å¼•å¯¼æ‚¨æ·±å…¥æ¢ç´¢Amazon Bedrockçš„æ¨¡å‹é€‰æ‹©ä¸è°ƒç”¨ã€æ¨¡å‹è‡ªåŠ¨åŒ–è¯„ä¼°ä»¥åŠå®‰å…¨å›´æ (Guardrail)ç­‰é‡è¦åŠŸèƒ½ã€‚</p>
<p>â©å¿«å¿«ç‚¹å‡»è¿›å…¥ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_Juejinhead_0606%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejinhead_0606" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_Juejinhead_0606&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejinhead_0606" ref="nofollow noopener noreferrer">å¤šæ¨¡ä¸€ç«™é€š â€”â€” Amazon Bedrock ä¸Šçš„åŸºç¡€æ¨¡å‹åˆä½“éªŒ</a>ã€‹å®éªŒæ„å»ºæ— é™, æ¢ç´¢å¯ç¨‹ï¼</p>
</blockquote>
<h2 data-id="heading-0">1. å®¢æˆ·å¯¹æ™ºèƒ½å®¢æœè‡ªåŠ©æœºå™¨äººçš„è¯„ä»·æŒ‡æ ‡ï¼š</h2>
<p>å®¢æˆ·å¯¹æ™ºèƒ½å®¢æœè‡ªåŠ©æœºå™¨äººçš„è¯„ä»·æŒ‡æ ‡ï¼Œä¸€èˆ¬ä¼šä» æœåŠ¡æ•ˆæœã€ä½“éªŒæ„Ÿå—ã€ç³»ç»Ÿæ€§èƒ½ã€ç®¡ç†è¿è¥ å››ä¸ªç»´åº¦æ¥è¡¡é‡ã€‚</p>
<h3 data-id="heading-1"><strong>1.1</strong> <strong>æœåŠ¡æ•ˆæœç±»</strong></h3>
<ul>
<li>é—®é¢˜è§£å†³ç‡ï¼ˆResolution Rateï¼‰ï¼šæœºå™¨äººèƒ½å¦çœŸæ­£å¸®å®¢æˆ·è§£å†³é—®é¢˜ã€‚</li>
<li>é¦–æ¬¡è§£ç­”æ­£ç¡®ç‡ï¼ˆFirst Contact Resolution, FCRï¼‰ï¼šä¸€æ¬¡å¯¹è¯æ˜¯å¦å°±èƒ½ç»™å‡ºå‡†ç¡®ç­”æ¡ˆã€‚</li>
<li>çŸ¥è¯†è¦†ç›–ç‡ï¼šæœºå™¨äººèƒ½å›ç­”çš„å¸¸è§é—®é¢˜æ¯”ä¾‹ã€‚</li>
<li>äººå·¥è½¬æ¥ç‡ï¼šéœ€è¦è½¬äººå·¥çš„æ¯”ä¾‹ï¼ˆè¶Šä½è¯´æ˜æœºå™¨äººæ›´æœ‰æ•ˆï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-2"><strong>1.2.</strong> <strong>ç”¨æˆ·ä½“éªŒç±»</strong></h3>
<ul>
<li>å“åº”é€Ÿåº¦ï¼šä»æé—®åˆ°ç­”å¤çš„æ—¶é—´ã€‚</li>
<li>äº¤äº’è‡ªç„¶åº¦ï¼šè¯­è¨€æ˜¯å¦æµç•…ï¼Œæ˜¯å¦åƒä¸äººå¯¹è¯ã€‚</li>
<li>å¤šè½®å¯¹è¯é¡ºç•…åº¦ï¼šæ˜¯å¦èƒ½è®°ä½ä¸Šä¸‹æ–‡ï¼Œé¿å…é‡å¤æé—®ã€‚</li>
<li>ä¸ªæ€§åŒ–ç¨‹åº¦ï¼šæ˜¯å¦èƒ½åŸºäºç”¨æˆ·å†å²ã€åå¥½æä¾›å®šåˆ¶åŒ–å›ç­”ã€‚</li>
<li>æ»¡æ„åº¦è¯„åˆ†ï¼ˆCSATï¼‰ï¼šå®¢æˆ·å¯¹æœåŠ¡çš„å³æ—¶è¯„ä»·ã€‚</li>
</ul>
<h3 data-id="heading-3"><strong>1.3.</strong> <strong>ç³»ç»Ÿæ€§èƒ½ç±»</strong></h3>
<ul>
<li>ç¨³å®šæ€§ä¸å¯ç”¨æ€§ï¼šæ˜¯å¦å‡ºç°å´©æºƒã€è¶…æ—¶ã€ç­”éæ‰€é—®ã€‚</li>
<li>å¹¶å‘å¤„ç†èƒ½åŠ›ï¼šé«˜å³°æœŸå“åº”æ˜¯å¦ä¾ç„¶æµç•…ã€‚</li>
<li>å‡†ç¡®ç‡ä¸å¬å›ç‡ï¼šæ„å›¾è¯†åˆ«æ˜¯å¦ç²¾å‡†ï¼ŒçŸ¥è¯†æ£€ç´¢æ˜¯å¦å…¨é¢ã€‚</li>
<li>å®‰å…¨ä¸åˆè§„æ€§ï¼šæ˜¯å¦ä¿éšœç”¨æˆ·éšç§ä¸æ•°æ®å®‰å…¨ã€‚</li>
</ul>
<h3 data-id="heading-4"><strong>1.4.</strong> <strong>ç®¡ç†ä¸è¿è¥ç±»</strong></h3>
<ul>
<li>çŸ¥è¯†æ›´æ–°åŠæ—¶æ€§ï¼šçŸ¥è¯†åº“å†…å®¹æ˜¯å¦å¿«é€Ÿæ›´æ–°ã€‚</li>
<li>è¿è¥å¯è§†åŒ–ï¼šåå°æ˜¯å¦æä¾›å¯¹è¯åˆ†æã€ç”¨æˆ·ç”»åƒã€çƒ­ç‚¹é—®é¢˜ç»Ÿè®¡ã€‚</li>
<li>è‡ªæˆ‘å­¦ä¹ ä¸ä¼˜åŒ–èƒ½åŠ›ï¼šæ˜¯å¦èƒ½é€šè¿‡åé¦ˆæŒç»­æ”¹è¿›ã€‚</li>
<li>äººå·¥å®¢æœååŒåº¦ï¼šè½¬äººå·¥æ—¶æ˜¯å¦æ— ç¼è¡”æ¥ã€‚</li>
<li>ROI ä¸æˆæœ¬èŠ‚çœï¼šå‡å°‘äººå·¥å®¢æœæˆæœ¬ã€æå‡æ•´ä½“æ•ˆç‡ã€‚<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></li>
</ul>
<h2 data-id="heading-5">2. åŸºäºGenAIæ™ºèƒ½å®¢æœè‡ªåŠ©ç³»ç»Ÿè®¾è®¡ä¸­Agentæ¡†æ¶é€‰æ‹©çš„å› ç´ </h2>
<p>åœ¨åŸºäº GenAI çš„æ™ºèƒ½å®¢æœè‡ªåŠ©ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œé€‰æ‹© Agent æ¡†æ¶ æ—¶è¦è€ƒè™‘å¤šä¸ªå› ç´ ï¼Œå› ä¸º Agent ä¸ä»…æ˜¯â€œé—®ç­”æœºå™¨äººâ€ï¼Œè¿˜éœ€è¦ä½œä¸ºä¸€ä¸ªå¯ä»¥è°ƒç”¨çŸ¥è¯†åº“ã€ä¸šåŠ¡ç³»ç»Ÿã€å·¥å…·ï¼ˆToolï¼‰å’Œäººå·¥å®¢æœçš„æ™ºèƒ½ä½“æ¥è¿ä½œã€‚</p>
<p>ç›®å‰Agentic AIä¸æ–­å‘å±•ï¼Œæ–°æŠ€æœ¯æ–°æ¨¡å¼å±‚å‡ºä¸ç©·ï¼Œä¸»è¦å¾€æ›´æ™ºèƒ½åŒ–ï¼Œæ›´è‡ªåŠ¨åŒ–çš„æ–¹å‘å‘å±•ï¼Œä½†åœ¨æ™ºèƒ½å®¢æœé¢†åŸŸä¸»è¦æ˜¯è¦æé«˜å®¢æˆ·æ»¡æ„åº¦ï¼ŒçœŸæ­£å¸®åŠ©å®¢æˆ·è§£å†³é—®é¢˜ï¼Œè¯¥åœºæ™¯éœ€è¦åŒæ–¹äº’åŠ¨ï¼Œå› æ­¤ä»ç›®å‰å®é™…é¡¹ç›®æ•ˆæœæ¥çœ‹WorkFlowæ¨¡å¼æ›´é€‚åˆè¯¥åœºæ™¯ï¼Œæœ¬æ¬¡å®è·µä¹Ÿæ˜¯é‡‡ç”¨äº†Standsæ¡†æ¶ä¸­çš„WorkFlowæ¥å®ç°ã€‚</p>
<h3 data-id="heading-6"><strong>2.1</strong> <strong>æŠ€æœ¯èƒ½åŠ›ä¸é€‚é…åº¦</strong></h3>
<p>å¤§æ¨¡å‹é€‚é…ï¼šæ˜¯å¦æ”¯æŒæ¥å…¥å¤šç§åŸºç¡€æ¨¡å‹ï¼Œé¿å…é”å®šå•ä¸€æ¨¡å‹ã€‚</p>
<p>å¤šå·¥å…·è°ƒç”¨ï¼šèƒ½å¦çµæ´»è°ƒç”¨æ•°æ®åº“ã€APIã€CRMã€ERPã€æ”¯ä»˜ç³»ç»Ÿã€å·¥å•ç³»ç»Ÿç­‰ã€‚</p>
<p>ä¸Šä¸‹æ–‡ç®¡ç†ï¼šæ”¯æŒé•¿å¯¹è¯è®°å¿†ã€å¤šè½®å¯¹è¯è¿½è¸ªã€ä¼šè¯çŠ¶æ€ç®¡ç†ã€‚</p>
<p>çŸ¥è¯†å¢å¼º (RAG)ï¼šæ˜¯å¦æ”¯æŒæ–‡æ¡£æ£€ç´¢ã€çŸ¥è¯†å›¾è°±ã€FAQçŸ¥è¯†åº“é›†æˆã€‚</p>
<h3 data-id="heading-7"><strong>2.2</strong> <strong>ç³»ç»Ÿæ¶æ„ä¸æ‰©å±•æ€§</strong></h3>
<p>æ¨¡å—åŒ–è®¾è®¡ï¼šæ˜¯å¦æ”¯æŒåˆ†å±‚æ¶æ„ï¼ˆå¯¹è¯ç®¡ç†ã€ä»»åŠ¡ä»£ç†ã€å·¥å…·ä»£ç†ï¼‰ã€‚</p>
<p>å¯æ‰©å±•æ€§ï¼šèƒ½å¦å¿«é€Ÿå¢åŠ æ–°åœºæ™¯ã€æ–°ä¸šåŠ¡æµç¨‹ã€‚</p>
<p>è·¨æ¸ é“æ”¯æŒï¼šæ˜¯å¦æ”¯æŒæ¥å…¥Webã€Appã€å¾®ä¿¡ã€WhatsAppã€ç”µè¯IVRç­‰æ¸ é“ã€‚</p>
<p>ç¼–æ’èƒ½åŠ›ï¼šèƒ½å¦ç”¨å·¥ä½œæµæˆ–ä½ä»£ç æ–¹å¼ç¼–æ’å¯¹è¯ä¸å·¥å…·è°ƒç”¨ã€‚</p>
<h3 data-id="heading-8"><strong>2.3</strong> <strong>æ€§èƒ½ä¸ç¨³å®šæ€§</strong></h3>
<p>å®æ—¶æ€§ï¼šå“åº”æ˜¯å¦å¿«é€Ÿï¼Œèƒ½å¦æ»¡è¶³æ¯«ç§’çº§å“åº”éœ€æ±‚ã€‚</p>
<p>å¹¶å‘èƒ½åŠ›ï¼šæ˜¯å¦èƒ½æ”¯æ’‘é«˜å¹¶å‘åœºæ™¯ï¼ˆç”µå•†ä¿ƒé”€ã€æ¸¸æˆæ´»åŠ¨é«˜å³°ï¼‰ã€‚</p>
<p>å¥å£®æ€§ï¼šåº”å¯¹æ¨¡å‹å›ç­”é”™è¯¯ã€APIè¶…æ—¶ç­‰å¼‚å¸¸æ—¶ï¼Œæ˜¯å¦æœ‰é™çº§æœºåˆ¶ã€‚</p>
<h3 data-id="heading-9"><strong>2.4</strong> <strong>å®‰å…¨ä¸åˆè§„</strong></h3>
<p>æ•°æ®å®‰å…¨ï¼šæ˜¯å¦æ”¯æŒæ•æ„Ÿä¿¡æ¯è„±æ•ã€åŠ å¯†å­˜å‚¨ã€è®¿é—®æƒé™æ§åˆ¶ã€‚</p>
<p>åˆè§„è¦æ±‚ï¼šæ˜¯å¦æ»¡è¶³ GDPRã€CCPAã€ç½‘ç»œå®‰å…¨æ³•ç­‰æ³•è§„è¦æ±‚ã€‚</p>
<p>å¯æ§æ€§ï¼šæ˜¯å¦æœ‰å®‰å…¨æŠ¤æ ï¼Œé˜²æ­¢æ¨¡å‹ç”Ÿæˆä¸å½“å†…å®¹ï¼ˆè¶Šæƒæ“ä½œã€è¿è§„å›ç­”ï¼‰ã€‚</p>
<h3 data-id="heading-10"><strong>2.5</strong> <strong>è¿ç»´ä¸ä¼˜åŒ–èƒ½åŠ›</strong></h3>
<p>å¯è§‚æµ‹æ€§ï¼šæ˜¯å¦èƒ½è¿½è¸ªå¯¹è¯æ—¥å¿—ã€Agentè°ƒç”¨é“¾è·¯ï¼Œä¾¿äºé—®é¢˜å®šä½ã€‚</p>
<p>å¯è®­ç»ƒæ€§ï¼šæ˜¯å¦æ”¯æŒæŒç»­å­¦ä¹ ï¼ˆåŸºäºç”¨æˆ·åé¦ˆä¼˜åŒ–ï¼‰ã€‚</p>
<p>A/B æµ‹è¯•ï¼šèƒ½å¦åœ¨ä¸åŒ Agent ç­–ç•¥æˆ–æ¨¡å‹ä¹‹é—´åšå¯¹æ¯”å®éªŒã€‚</p>
<p>æˆæœ¬æ§åˆ¶ï¼šè°ƒç”¨å¤§æ¨¡å‹çš„ Token æ¶ˆè€—ä¸æ¡†æ¶ä¼˜åŒ–èƒ½åŠ›ï¼ˆå¦‚ç¼“å­˜ã€æ··åˆæ¨¡å‹è°ƒç”¨ï¼‰ã€‚</p>
<h2 data-id="heading-11">3. Amazon Connectç»“åˆStrandså’ŒBedrock AgentCoreæ™ºèƒ½å®¢æœè‡ªåŠ©ç³»ç»Ÿæ¶æ„è®¾è®¡</h2>
<h3 data-id="heading-12">3.1 è§£å†³æ–¹æ¡ˆHigh Levelè®¾è®¡</h3>
<p>æœ¬æ¬¡å®è·µé‡‡ç”¨Amazon Connectçš„Chatæ–‡å­—èŠå¤©ä½œä¸ºå®¢æˆ·æ¥å…¥æ–¹å¼ï¼Œæ•´ä¸ªè‡ªåŠ©æœåŠ¡çš„æµç¨‹æ§åˆ¶é‡‡ç”¨Amazon Connectçš„Workflowè®¾è®¡å®ç°ï¼Œå®¢æˆ·è¾“å…¥åç”±Connecté€šè¿‡lambdaæ¥è°ƒç”¨GenAIæ¨¡å‹æ¥å®ç°æ„å›¾è¯†åˆ«ï¼ŒåŸºäºBedrockçš„RAGçŸ¥è¯†åº“æŸ¥è¯¢ï¼ŒåŸºäºStandsæ¡†æ¶çš„çš„ Multi Agentæ¥å®ç°è‡ªåŠ©æœåŠ¡ï¼Œä¸åŒçš„æ„å›¾ä¼šå¯¹åº”ä¸åŒçš„å¤„ç†æµç¨‹ï¼Œè¯¦è§å›¾1ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ee85354ff724c1288cfe20212aa848e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=WgGO4kisIfvEZ1x%2FDxL8d67a%2FaQ%3D" alt="1.webp" loading="lazy"/></p>
<p align="center">å›¾1 è§£å†³æ–¹æ¡ˆHigh Levelè®¾è®¡</p>
<h3 data-id="heading-13">3.2 ç³»ç»Ÿæ¶æ„è®¾è®¡</h3>
<p>æ•´ä¸ªè§£å†³æ–¹æ¡ˆå¯ä»¥åŒæ—¶æ”¯æŒç”µè¯åŠæ–‡å­—èŠå¤©ç­‰å¤šæ¸ é“å‘¼å«ä¸­å¿ƒè§£å†³æ–¹æ¡ˆï¼Œä¸åŒçš„æ¥å…¥æ¸ é“é‡‡ç”¨ç»Ÿä¸€çš„æµç¨‹ç®¡ç†ã€‚æ•´ä½“æ–¹æ¡ˆè®¾è®¡ä¸­ä»¥Amazon Connectä½œä¸ºå‘¼å«ä¸­å¿ƒå¹³å°æ ¸å¿ƒæœåŠ¡å¹³å°ï¼ŒåŒæ—¶é‡‡ç”¨Amazon Lexä½œä¸ºè‡ªä¸»æœåŠ¡ç»„ä»¶ï¼ŒAmazon Lexä»¥åŠAmazon Connect Content Flowé€šè¿‡è°ƒç”¨Lambdaæ¥å®ç°å¯¹Bedrock Cluadeæ¨¡å‹çš„è°ƒç”¨ä»¥åŠBedrock çŸ¥è¯†åº“çš„è°ƒç”¨ã€‚è¯¦ç»†æµç¨‹è§å›¾2.</p>
<p><strong>ä¸šåŠ¡æµç¨‹è¯´æ˜ï¼š</strong></p>
<ul>
<li>é€šè¿‡å†…éƒ¨CRMç³»ç»Ÿæ•´ç†çŸ¥è¯†åº“æ–‡ä»¶å¹¶æ”¾å…¥S3ï¼Œé‡‡ç”¨BedrockçŸ¥è¯†åº“æœåŠ¡å¹¶åŒæ­¥S3æ•°æ®æº</li>
<li>å®¢æˆ·é€šè¿‡æ–‡å­—èŠå¤©å‘èµ·æœåŠ¡å¹¶è¿›å…¥connectæœåŠ¡</li>
<li>Connecté€šè¿‡Workflowå®šåˆ¶æµç¨‹å¹¶è°ƒç”¨lexè¿›è¡Œå¯¹è¯äº¤æµ</li>
<li>Lambdaå®ç°å®¢æˆ·æ„å›¾è¯†åˆ«åŠè°ƒç”¨AgentCore Memoryå®ç°ä¼šè¯è®°å¿†</li>
<li>Connect workflowè·å–åˆ°å®¢æˆ·è‡ªåŠ©æœåŠ¡å°±è°ƒç”¨Lambda</li>
<li>Lambdaè°ƒç”¨åŸºäºStrandsæ¡†æ¶ç¼–å†™å¹¶è¿è¡Œåœ¨AgentCore Runtimeä¸Šçš„Agentå®ç°è‡ªåŠ©æœåŠ¡</li>
<li>è‡ªåŠ©æœåŠ¡æ»¡è¶³ä¸äº†å®¢æˆ·éœ€æ±‚ï¼Œè½¬äººå·¥åå¸­</li>
<li>åå¸­è°ƒç”¨AgentCore Memoryé•¿æœŸè®°å¿†åŠŸèƒ½è·å–ä¹‹å‰å¯¹è¯æ€»ç»“å¹¶ä¸ºå®¢æˆ·ç»§ç»­æä¾›æœåŠ¡</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6fcc97740444a3a99ca61ff2125fd34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=SQCrB0UC3ftwloaKhAm6SLlauTk%3D" alt="55e2297e86addf4444034bca0f0b7bd3.png" loading="lazy"/></p>
<p align="center">å›¾2 è¯¦ç»†ç³»ç»Ÿæ¶æ„è®¾è®¡å›¾</p>
<h3 data-id="heading-14">3.3 å¯¹è¯è®°å¿†åŠŸèƒ½å®ç°è§£æ</h3>
<p>å¦‚ä½•å®ç°å¯¹è¯è®°å¿†åŠŸèƒ½æœ‰å¯ä»¥æœ‰å¤šç§æ–¹æ¡ˆï¼Œä¹‹å‰åšå®¢é‡‡ç”¨çš„æ˜¯åˆ©ç”¨Amazon Connectçš„éšè·¯æ•°æ®æ¥å®ç°ã€‚æœ¬æ¬¡é‡‡ç”¨Bedrock AgentCore Memoryæœ€æ–°æœåŠ¡æ¥å®ç°ã€‚</p>
<p>Amazon Bedrock AgentCore çš„ Memory æ¨¡å—æ˜¯ä¸€ä¸ªç”±äºšé©¬é€Šäº‘ç§‘æŠ€æ‰˜ç®¡çš„æŒä¹…åŒ–è®°å¿†ç³»ç»Ÿï¼Œç”¨äºå­˜å‚¨å’Œç®¡ç† AI Agent çš„å¯¹è¯å’ŒçŸ¥è¯†ã€‚å®ƒæä¾›çŸ­æœŸè®°å¿†ï¼ˆshort-term memoryï¼‰å’Œé•¿æœŸè®°å¿†ï¼ˆlong-term memoryï¼‰ä¸¤ç§æ¨¡å¼ã€‚çŸ­æœŸè®°å¿†è´Ÿè´£åœ¨ä¸€æ¬¡ä¼šè¯ä¸­è®°å½•æœ€è¿‘çš„äº¤äº’å†…å®¹ï¼ˆä¾‹å¦‚æœ€è¿‘å‡ è½®å¯¹è¯ï¼‰ï¼Œç¡®ä¿ä»£ç†èƒ½å¤Ÿâ€œè®°ä½â€å½“å‰å¯¹è¯çš„ä¸Šä¸‹æ–‡ã€‚é•¿æœŸè®°å¿†åˆ™ä»å¯¹è¯ä¸­æå–ç»“æ„åŒ–çš„å…³é”®ä¿¡æ¯ï¼Œåœ¨å¤šä¸ªä¼šè¯ä¹‹é—´ä¿ç•™çŸ¥è¯†ï¼Œä½¿Agentèƒ½å¤Ÿâ€œå­¦ä¹ â€ç”¨æˆ·åå¥½ã€äº‹å®å’Œæ‘˜è¦ç­‰ä¿¡æ¯ã€‚</p>
<p>Memory æ¨¡å—åœ¨æ¶æ„ä¸Šé‡‡ç”¨åˆ†å±‚å­˜å‚¨ç­–ç•¥ï¼šçŸ­æœŸè®°å¿†å±‚å­˜å‚¨åŸå§‹äº¤äº’äº‹ä»¶ä½œä¸ºå³æ—¶ä¸Šä¸‹æ–‡ï¼Œé•¿æœŸè®°å¿†å±‚å­˜å‚¨ä»äº‹ä»¶æå–çš„æ¦‚è¦çŸ¥è¯†ã€‚Memory æœåŠ¡èƒŒåå®ç°äº†è‡ªåŠ¨çš„ä¿¡æ¯å¤„ç†æµæ°´çº¿ï¼šå½“æ–°çš„äº‹ä»¶è¢«å­˜å‚¨æ—¶ï¼Œå¦‚æœ Memory é…ç½®äº†é•¿æœŸè®°å¿†ç­–ç•¥ï¼ŒæœåŠ¡ä¼šå¼‚æ­¥åœ°å¯¹äº‹ä»¶å†…å®¹è¿›è¡Œåˆ†æï¼ˆä¾‹å¦‚è°ƒç”¨åŸºç¡€æ¨¡å‹ï¼‰æ¥æç‚¼å‡ºå¯é•¿æœŸä¿å­˜çš„çŸ¥è¯†ç‰‡æ®µã€‚</p>
<p>æ‰€æœ‰æ•°æ®ç”±äºšé©¬é€Šäº‘ç§‘æŠ€ä»¥ åŠ å¯† æ–¹å¼å­˜å‚¨ï¼Œå¹¶ä½¿ç”¨å‘½åç©ºé—´ï¼ˆnamespaceï¼‰è¿›è¡Œéš”ç¦»åˆ†åŒºï¼Œç¡®ä¿ä¸åŒåº”ç”¨æˆ–ç”¨æˆ·çš„è®°å¿†æ•°æ®å½¼æ­¤åˆ†éš”ã€‚è¿™ä¸€å®Œå…¨æ‰˜ç®¡çš„è®°å¿†åŸºç¡€è®¾æ–½è®©å¼€å‘è€…æ— éœ€è‡ªå·±æ­å»ºæ•°æ®åº“æˆ–å‘é‡å­˜å‚¨ï¼Œå°±èƒ½æ–¹ä¾¿åœ°è®© Agent æ‹¥æœ‰è®°å¿†åŠŸèƒ½ã€‚</p>
<p>å¦‚å›¾3æ‰€ç¤ºæ˜¯æœ¬æ¬¡å®è·µé‡‡ç”¨AgentCore Memoryï¼Œå¹¶å……åˆ†åˆ©ç”¨äº†é•¿æœŸè®°å¿†ï¼Œå¦‚æ‘˜è¦ä¿¡æ¯æ¥ç®€åŒ–å®¢æœè½¬åå¸­çš„æ€»ç»“åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å®ç°è‡ªåŠ¨è¯­ä¹‰è¯†åˆ«æ¥æå–ä¿¡æ¯å†™å…¥CRMç³»ç»Ÿï¼Œè¯¦ç»†å‚åŠ å›¾3ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75143156e96546bdbf58945c8c6d9e8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=K4Fe%2F5hLNGKfFgzCaCJ8n8iYpUM%3D" alt="3.webp" loading="lazy"/></p>
<p align="center">å›¾3 AgentCore MemoryåŠŸèƒ½</p>
<h3 data-id="heading-15">3.4 Agentæ¡†æ¶åŠè¿è¡Œè§£æ</h3>
<p>æœ¬æ¬¡å®è·µé‡‡ç”¨Standsæ¡†æ¶æ¥å®ç°äº†å…·ä½“Agentã€‚å¹¶å’ŒBenrock AgentCore Runtimeç»“åˆï¼Œæ¯æ¬¡è°ƒç”¨Agentå°±æ˜¯å¯åŠ¨ä¸€æ¬¡Bedrock AgentCore Runtimeã€‚</p>
<p>Bedrocl AgentCore Runtime æ˜¯ä¸€æ¬¾é«˜åº¦å®‰å…¨ã€å¼¹æ€§ã€é«˜æ•ˆèƒ½çš„ Serverless Agent æ‰˜ç®¡å¹³å°ï¼Œå®ƒè®©ä¼ä¸šæ— éœ€ä¸ºåŸºç¡€è®¾æ–½çƒ¦æ¼ï¼Œå³å¯ä¸“æ³¨ Agent ä¸šåŠ¡å¼€å‘ï¼Œå¹¶æ»¡è¶³ç”Ÿäº§çº§å®‰å…¨ã€æˆæœ¬å’Œå¯æ‰©å±•æ€§éœ€æ±‚ã€‚æ”¯æŒå¤šæ­¥é€»è¾‘å’Œå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œï¼ŒRuntime å¯ä¿æŒä¼šè¯çŠ¶æ€é•¿è¾¾ 8 å°æ—¶ï¼Œé€‚åˆå¤æ‚æ¨ç†å’Œé•¿æµç¨‹ä»»åŠ¡ï¼Œé‡‡ç”¨æŒ‰å®é™…è®¡ç®—èµ„æºä½¿ç”¨è®¡è´¹æ–¹å¼ï¼Œè®¡ç®—åªæœ‰åœ¨ Agent çœŸæ­£æ‰§è¡Œæ—¶æ‰è®¡è´¹ï¼ŒèŠ‚çœå¤§é‡å› ç­‰å¾…å¤–éƒ¨ LLM æˆ– API çš„ç©ºé—²æ—¶é—´è´¹ç”¨ï¼Œéå¸¸é€‚åˆå®¢æœåº”ç”¨åœºæ™¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/509adab9e4d043a197311c825588d24d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=d2sDzJQRWe%2BMraIEHLBxngxaN2w%3D" alt="4.webp" loading="lazy"/></p>
<h3 data-id="heading-16">3.5 Amazon Connect ContentFlowè°ƒç”¨Lambdaçš„æœ€ä½³å®è·µ</h3>
<p>åœ¨Amazon Connect ContentFlowä¸­è°ƒç”¨Lambdaå®ç°å’Œå¤–éƒ¨ç³»ç»Ÿé›†æˆæ—¶å¦‚æœé‡‡ç”¨åŒæ­¥æ¨¡å¼ï¼ŒLambdaæœ€å¤§æ‰§è¡Œè¶…æ—¶æ—¶é—´æ˜¯8ç§’ï¼Œè¿™ä¸ªç°åœ¨åœ¨è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹æ—¶å¦‚æœä»»åŠ¡æ¯”è¾ƒå¤æ‚ï¼Œæ‰§è¡Œä¼šè¶…è¿‡8ç§’ï¼Œè¿™ä¼šå¯¼è‡´è¿™ä¸ªæµç¨‹æŠ¥é”™ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥é‡‡ç”¨æœ€æ–°çš„å¼‚æ­¥è°ƒç”¨æ¨¡å¼ï¼Œè¿™ä¸ªå¯ä»¥å°†æœ€å¤§æ‰§è¡Œæ—¶é—´å»¶é•¿åˆ°60ç§’ï¼Œè‚¯å®šå¯ä»¥æ»¡è¶³è¦æ±‚ã€‚å…·ä½“è°ƒç”¨æ–¹æ³•å‚åŠ ä¸‹å›¾ã€‚å…ˆåœ¨Amazon Lambda Functionè°ƒç”¨æ—¶å€™é€‰æ‹©å¼‚æ­¥æ¨¡å¼ï¼Œç„¶åè®¾ç½®WaitèŠ‚ç‚¹ç­‰å¾…æ‰§è¡Œå®Œæˆï¼Œæ‰§è¡Œå®Œæˆåå†æ¬¡è°ƒç”¨Amazon Lambda FunctionèŠ‚ç‚¹ï¼Œå¹¶é€‰æ‹©Load Lambda Resultæ¥è·å–æ‰§è¡Œç»“æœã€‚è¿™æ ·å¯ä»¥è§£å†³è¶…æ—¶ç“¶é¢ˆé—®é¢˜ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65a4107604e84e718ba123f2d8ce563f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=HAo7T4%2B7R%2Fok8NHZ6e8unFgJ%2Fyg%3D" alt="5.webp" loading="lazy"/></p>
<h2 data-id="heading-17">4. å…·ä½“ä»£ç å®ç°åŠéƒ¨ç½²è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-18"><strong>4.1</strong> <strong>æœ¬æ¬¡å®è·µå®¢æˆ·åœºæ™¯æè¿°</strong></h3>
<ul>
<li>æœ¬æ¬¡å®è·µä»¥åˆ¶é€ ä¸šæµ·å¤–å”®åæœåŠ¡ä¸ºèƒŒæ™¯ï¼Œé€šè¿‡æ™ºèƒ½å®¢æœæ¥å®ç°äº§å“å”®åæœåŠ¡å’¨è¯¢ï¼Œè®¢å•æŸ¥è¯¢ï¼Œè‡ªåŠ¨é€€è´§ç­‰å®é™…åœºæ™¯ï¼Œå¦‚æœé—®é¢˜å¤æ‚æ— æ³•é€šè¿‡è‡ªåŠ©æœåŠ¡è§£å†³å°†è‡ªåŠ¨è½¬æ¥äººå·¥åå¸­ã€‚</li>
<li>æ™ºèƒ½å®¢æœç»Ÿä¸€é‡‡ç”¨åŸºäºStandsæ¡†æ¶çš„Multi Agentæ¶æ„ï¼Œå°†æ„å›¾è¯†åˆ«ï¼ŒçŸ¥è¯†åº“è°ƒç”¨ï¼Œå·¥å…·è°ƒç”¨ç»Ÿä¸€å°è£…ä¸ºå„ç§AgentæœåŠ¡ï¼Œå¯ä»¥å®ç°ç®€å•æ™ºèƒ½è°ƒç”¨ã€‚</li>
</ul>
<h3 data-id="heading-19"><strong>4.2Amazon Connect</strong> <strong>ä¸šåŠ¡æµå®ç°ï¼š</strong></h3>
<ul>
<li>
<p>åˆ©ç”¨Connect Content Flowæ¥å®ç°æ•´ä¸ªä¸šåŠ¡åœºæ™¯ã€‚</p>
</li>
<li>
<p>é€šè¿‡Lexæ¥è·å–ç”¨æˆ·è¾“å…¥ï¼Œæ”¯æŒè¯­éŸ³å’ŒChatä¸¤ä¸ªæ¸ é“ã€‚</p>
</li>
<li>
<p>Connect Content Flowé€šè¿‡å¼‚æ­¥è°ƒç”¨Lambdaå®ç°æ™ºèƒ½Agentçš„è°ƒç”¨ï¼Œå¹¶è¿”å›æœ€ä½³å›å¤ç»™åˆ°å®¢æˆ·ï¼Œæ•´ä¸ªè¿‡ç¨‹æ”¯æŒå¤šè½®å¯¹è¯å’Œå¤šä¸šåŠ¡å¤„ç†ã€‚</p>
</li>
<li>
<p>å½“Agentè¿”å›ç»“åˆå‘ŠçŸ¥è¯¥æœåŠ¡éœ€è¦äººå·¥åå¸­æ¥å…¥åˆ™ç³»ç»Ÿè‡ªåŠ¨è½¬äººå·¥åå¸­å¹¶æä¾›è‡ªåŠ¨æœåŠ¡çš„å…¨ç¨‹å¯¹è¯æ‘˜è¦ï¼Œé¿å…åå¸­é‡å¤è¯¢é—®ä¹‹å‰çš„é—®é¢˜ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c7f734fdcb949958b1b7e67b29993eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=%2FSy%2Fx%2FNHq0M5OR3W8Wb%2B9NfJ2aw%3D" alt="6.webp" loading="lazy"/></p>
<h3 data-id="heading-20"><strong>4.3 Stands Agent</strong> <strong>åŠBedrock AgentCore Runtimeéƒ¨ç½²åŠå®ç°ï¼š</strong></h3>
<ul>
<li>
<p>Strands Agents SDK æ˜¯ç”±äºšé©¬é€Šäº‘ç§‘æŠ€å¼€æºçš„Agentè½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼Œå®ƒé‡‡ç”¨æ¨¡å‹é©±åŠ¨çš„æ–¹å¼ï¼Œæ—¨åœ¨ç®€åŒ–å’ŒåŠ é€Ÿ AI æ™ºèƒ½ä½“çš„æ„å»ºä¸éƒ¨ç½²ã€‚å®ƒçš„ä¸»è¦ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å¼€å‘æµç¨‹ç®€åŒ–ï¼šå¼€å‘è€…åªéœ€å®šä¹‰æ ¸å¿ƒçš„æç¤ºè¯ï¼ˆPromptï¼‰å’Œå¯ç”¨çš„å·¥å…·åˆ—è¡¨ï¼Œè€Œæ— éœ€ç¼–å†™å¤æ‚çš„å·¥ä½œæµä»£ç ã€‚æå¤§é™ä½äº†å¼€å‘æˆæœ¬ï¼ŒåŠ å¿«ä¸Šçº¿é€Ÿåº¦ã€‚</li>
<li>å¹¿æ³›çš„ç”Ÿæ€æ”¯æŒï¼šSDK å…·æœ‰é«˜åº¦çš„å¼€æ”¾æ€§å’Œå…¼å®¹æ€§ï¼Œæ”¯æŒåŒ…æ‹¬ Amazon Bedrockã€OpenAIã€Ollama ç­‰åœ¨å†…çš„å¤šç§å¤§å‹è¯­è¨€æ¨¡å‹ã€‚å¹¶ä¸”ï¼Œé¢„ç½®äº†æ–‡ä»¶ç®¡ç†ã€ä»£ç æ‰§è¡Œã€ç½‘ç»œè¯·æ±‚ç­‰å¤šç§å®ç”¨å·¥å…·ï¼Œå¼€ç®±å³ç”¨ã€‚</li>
<li>æ”¯æŒå¤šæ™ºèƒ½ä½“ç¼–æ’ï¼šè¯¥ SDK å¼•å…¥äº†å…ˆè¿›çš„ Swarm æ¶æ„ï¼Œæ”¯æŒå¤šæ™ºèƒ½ä½“å¹¶å‘å¤„ç†å’ŒååŒå·¥ä½œã€‚è¿™å¯¹äºå¤„ç†å¤æ‚ä»»åŠ¡ã€æå‡å¤„ç†æ•ˆç‡å’Œå‡†ç¡®ç‡è‡³å…³é‡è¦ã€‚</li>
</ul>
</li>
<li>
<p>åœ¨æœ¬æ¬¡çš„æ™ºèƒ½å®¢æœæœºå™¨äººçš„å®è·µä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†å¦‚ä¸‹çš„å¤šAgentç¼–æ’çš„æ¶æ„ï¼Œè®©è´Ÿè´£çš„å®¢æœä»»åŠ¡èƒ½å¤Ÿæ›´ç²¾ç¡®æœ‰æ•ˆçš„æ‰§è¡Œã€‚</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dea59b64cc9432ab73b30630834e295~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=77Z%2BfOdAuADcsbXHogeKEblK9%2Fo%3D" alt="7.webp" loading="lazy"/></p>
<ul>
<li>
<p>Strands SDK å¤šAgentçš„å…³é”®ä»£ç å®ç°ï¼š</p>
<ul>
<li>æ€»æ§Agentçš„ä»£ç å®ç°ï¼š</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-Python" lang="Python">      bedrock_model = BedrockModel(
            model_id=<span class="hljs-string">"global.anthropic.claude-sonnet-4-20250514-v1:0"</span>,
            temperature=<span class="hljs-number">0.3</span>,
            top_p=<span class="hljs-number">0.8</span>,
        )

        <span class="hljs-comment"># Create the supervisor agent with all specialist Agents</span>
        self.current_agent = Agent(
            name=<span class="hljs-string">"Supervisor Agent"</span>,
            system_prompt=self._build_system_prompt(),
            model=bedrock_model,
            state={<span class="hljs-string">"session_id"</span>: session_id},
            tools=[
                update_user_id,
                get_product_usage,
                start_return_process,
                check_order_status,
            ],
        )
</code></pre>
<ul>
<li>å­Agentçš„ä»£ç å®ç°ï¼š</li>
</ul>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">retrieve_from_kb</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
    <span class="hljs-string">"""
    Retrieve information from a knowledge base based on a query.
    Args:
        query: The search query
    Returns:
        Dictionary containing retrieval results
    """</span>

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># Call the retrieve tool directly</span>
        retrieve_response = retrieve.retrieve(
            {
                <span class="hljs-string">"toolUseId"</span>: <span class="hljs-built_in">str</span>(uuid.uuid4()),
                <span class="hljs-string">"input"</span>: {
                    <span class="hljs-string">"text"</span>: query,
                    <span class="hljs-string">"score"</span>: MIN_RELEVANCE_SCORE,
                    <span class="hljs-string">"numberOfResults"</span>: MAX_RAG_RESULTS,
                    <span class="hljs-string">"knowledgeBaseId"</span>: DEFAULT_KNOWLEDGE_BASE_ID,
                    <span class="hljs-string">"region"</span>: AWS_REGION,
                   
                },
            }
        )
        logger.info(<span class="hljs-string">f"retrieve_response: <span class="hljs-subst">{retrieve_response}</span>"</span>)
        <span class="hljs-keyword">return</span> retrieve_response
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f"Error details: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
        <span class="hljs-keyword">raise</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"error"</span>,
            <span class="hljs-string">"message"</span>: <span class="hljs-string">f"Error retrieving from knowledge base: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>,
        }


<span class="hljs-keyword">def</span> <span class="hljs-title function_">init_agent</span>(<span class="hljs-params">agent_name: <span class="hljs-built_in">str</span></span>) -&gt; Agent:
    <span class="hljs-keyword">return</span> Agent(
        name=agent_name,
        system_prompt=faq_agent_system_prompt,
        model=bedrock_model,
        tools=[retrieve_from_kb, check_order_status],
    )
</code></pre>
<h3 data-id="heading-21"><strong>4.4 Bedrock AgentCore Memory</strong> <strong>è°ƒç”¨å®ç°ï¼š</strong></h3>
<ul>
<li>Amazon Bedrock AgentCoreÂ æ˜¯ä¸€ä¸ªç”±äºšé©¬é€Šäº‘ç§‘æŠ€æ¨å‡ºçš„å…¨æ‰˜ç®¡ã€æ¨¡å—åŒ–å¹³å°ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…å¤§è§„æ¨¡æ„å»ºã€éƒ¨ç½²å’Œè¿è¥å®‰å…¨å¯é çš„ AI Agentã€‚å…¶ä¸­ï¼ŒMemoryæ˜¯ä¸ºAgentæä¾›æŒä¹…åŒ–çš„çŸ­æœŸå’Œé•¿æœŸè®°å¿†èƒ½åŠ›ï¼Œä»¥ç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡ã€‚</li>
</ul>
<p>åœ¨æœ¬å®¢æœæœºå™¨äººå®è·µä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨AgentCore Memoryçš„èƒ½åŠ›æ¥ä¿å­˜å®¢æˆ·å†å²ä¸Šçš„å¯¹è¯è®°å½•ï¼Œå¹¶å°†è¿™äº›å†å²å¯¹è¯è®°å½•ä½œä¸ºå®¢æœçš„åŸºç¡€ï¼Œæ¥æ›´å¥½çš„å›ç­”å®¢æˆ·çš„é—®é¢˜å’Œè¯‰æ±‚ã€‚åœ¨æ­¤ï¼Œæˆ‘ä»¬ä»¥ä»£ç ç‰‡æ®µçš„å½¢å¼ï¼Œå°†Memoryçš„è°ƒç”¨è¿‡ç¨‹ï¼Œå±•ç¤ºç»™å¤§å®¶ã€‚</p>
<ul>
<li>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºmemory</li>
</ul>
</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_memory</span>(<span class="hljs-params">memory_name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:

    <span class="hljs-keyword">try</span>:
        client = MemoryClient(region_name=AWS_REGION)
        memory = client.create_memory_and_wait(
            name=memory_name,
            strategies=[
                {
                    <span class="hljs-string">"userPreferenceMemoryStrategy"</span>: {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"UserPreference"</span>,
                        <span class="hljs-string">"namespaces"</span>: [<span class="hljs-string">"/users/{actorId}"</span>],
                    }
                }
            ],
        )
        logger.info(
            <span class="hljs-string">f"Successfully created AgentCore Memory with ID: <span class="hljs-subst">{memory.get(<span class="hljs-string">'id'</span>)}</span>"</span>
        )
        logger.info(<span class="hljs-string">f"Memory details: <span class="hljs-subst">{memory}</span>"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.info(<span class="hljs-string">f"Error creating AgentCore Memory: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<ul>
<li>
<ul>
<li>ç¬¬äºŒæ­¥ï¼Œä¿å­˜memory</li>
</ul>
</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_memory</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">str</span>, message: <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-literal">None</span>:
    params = {
        <span class="hljs-string">"memory_id"</span>: BEDROCK_AGENTCORE_MEMORY_ID,
        <span class="hljs-string">"actor_id"</span>: <span class="hljs-string">f"user_<span class="hljs-subst">{user_id}</span>"</span>,
        <span class="hljs-string">"session_id"</span>: <span class="hljs-string">f"session_user_<span class="hljs-subst">{user_id}</span>"</span>,
        <span class="hljs-string">"messages"</span>: [message],
    }

    memory_client = MemoryClient(region_name=AWS_REGION)
    memory_client.create_event(**params)
</code></pre>
<ul>
<li>
<ul>
<li>ç¬¬ä¸‰æ­¥ï¼Œåœ¨é€‚åˆçš„æµç¨‹ä¸­ï¼Œå¬å›memoryã€‚ å¬å›Memoryçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Strands toolsï¼šAgentCoreMemoryToolProviderã€‚å¯ä»¥ä½¿ç”¨ä¸åŒçš„Queryå¬å›ä¸åŒåˆ†ç±»çš„Memoryã€‚ä½¿å¾—Memoryçš„åº”ç”¨æ›´åŠ çµæ´»å’Œç²¾å‡†ã€‚</li>
</ul>
</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_agent</span>(<span class="hljs-params">agent_name: <span class="hljs-built_in">str</span>, user_id: <span class="hljs-built_in">str</span>, session_id: <span class="hljs-built_in">str</span></span>) -&gt; Agent:
    provider = AgentCoreMemoryToolProvider(
        memory_id=BEDROCK_AGENTCORE_MEMORY_ID,
        actor_id=<span class="hljs-string">f"user_<span class="hljs-subst">{user_id}</span>"</span>,
        session_id=<span class="hljs-string">f"session_user_<span class="hljs-subst">{user_id}</span>"</span>,
        namespace=<span class="hljs-string">f"/users/user_<span class="hljs-subst">{user_id}</span>"</span>,
        region=AWS_REGION,
    )
    <span class="hljs-keyword">return</span> Agent(
        name=agent_name,
        system_prompt=<span class="hljs-string">"You are a helpful assistant with memory capabilities."</span>,
        model=bedrock_model,
        tools=provider.tools,
    )

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_customer_info</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">str</span>, session_id: <span class="hljs-built_in">str</span>, query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    Process and respond to the use of product related queries using a specialized return agent.

    Args:
        user_id: customer provided user id
        session_id: current chat session id, in the context model
        query: A return related question or problem from the user

    Returns:
        customer history or save the new event in custoemr memroy store
    """</span>
    <span class="hljs-comment"># Format the query for the contact agent with clear instructions</span>
    formatted_query = <span class="hljs-string">f"<span class="hljs-subst">{query}</span>"</span>

    <span class="hljs-keyword">try</span>:
        logger.info(
            <span class="hljs-string">f"Routed to memory Agent: user_id:<span class="hljs-subst">{user_id}</span>, session_id:<span class="hljs-subst">{session_id}</span>, query:<span class="hljs-subst">{query}</span>"</span>
        )
        agent = init_agent(<span class="hljs-string">"customer info agent"</span>, user_id, session_id)
        agent_response = agent(formatted_query)
        text_response = <span class="hljs-built_in">str</span>(agent_response)
        logger.info(<span class="hljs-string">f"customer info agent: <span class="hljs-subst">{text_response}</span>"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(text_response) &gt; <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> text_response

        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ²¡æœ‰å…³äºè¿™ä¸ªç”¨æˆ·çš„ä»»ä½•ä¿¡æ¯ã€‚"</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-comment"># Return specific error message for shipping processing</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"Error processing your return related query: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>
</code></pre>
<ul>
<li>Amazon Bedrock AgentCore Runtimeæ˜¯ä¸ºAgentæ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºæ‰˜ç®¡ AI Agentè€Œè®¾è®¡çš„åŸºç¡€è®¾æ–½ã€‚å®ƒé‡‡ç”¨å®¹å™¨åŒ–çš„éƒ¨ç½²æ–¹å¼ï¼Œè´Ÿè´£å¤„ç†ç”¨æˆ·è¾“å…¥ã€ç»´æŠ¤ä¸Šä¸‹æ–‡ï¼Œå¹¶åˆ©ç”¨å®¹å™¨çš„éš”ç¦»èƒ½åŠ›ï¼Œç»™AIåº”ç”¨ä¸€ä¸ªå®‰å…¨é«˜æ•ˆçš„è¿è¡Œç¯å¢ƒã€‚</li>
</ul>
<p>åœ¨æœ¬æ¬¡å®è·µä¸­ï¼Œæˆ‘ä»¬å¤šAgentçš„åº”ç”¨éƒ¨ç½²å¹³å°ï¼Œå°±é‡‡ç”¨äº†AgentCore Runtimeã€‚å®ƒä¿è¯äº†æˆ‘ä»¬å®¢æœèƒ½å¤ŸæŒ‰éœ€ä»˜è´¹ï¼Œä¸ç”¨ä¸ºå®¢æœçš„é—²æ—¶èŠ±è´¹åŸºç¡€èµ„æºè´¹ç”¨ï¼ŒåŒæ—¶Runtimeçš„é«˜æ‰©å±•æ€§ï¼Œä¹Ÿä¿è¯äº†æ•´ä¸ªç³»ç»Ÿå¯ä»¥åº”å¯¹çªç„¶çš„ä¸šåŠ¡é«˜å³°å†²å‡»ã€‚ æˆ‘ä»¬å®¢æœæœºå™¨äººçš„ä¸šåŠ¡è°ƒç”¨æµå¦‚ä¸‹: Connect æœåŠ¡ä¸ºå®¢æœæœºå™¨äººç³»ç»Ÿçš„æ¥å…¥æ¨¡å—ï¼Œè´Ÿè´£chatæˆ–voiceæ•°æ®çš„æµå…¥ï¼ŒLexä¸ºå®¢æœé€»è¾‘æ¨¡å—ï¼Œè´Ÿè´£æ„å›¾è¯†åˆ«å’Œç³»ç»Ÿè°ƒåº¦ï¼ŒLexå¯ä»¥é€šè¿‡Lambdaè°ƒç”¨éƒ¨ç½²åœ¨AgentCore Runtimeä¸Šçš„å¤šAgentå®¢æœç³»ç»Ÿï¼Œè‡ªåŠ¨å¤„ç†å®¢æˆ·é—®é¢˜ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cadb127e9b5448d4b5156610e2877a68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=T%2BoZSZV06E88WgNfGTkz%2FVUhlO8%3D" alt="d1da8719cc164f1ff18d9cbbea0c9052.png" loading="lazy"/></p>
<ul>
<li>AgentCore Runtimeæœ‰2ç§éƒ¨ç½²æ–¹å¼ï¼Œæœ¬æ–‡ä½¿ç”¨çš„æ˜¯å¯å®šåˆ¶åŒ–ç¨‹åº¦æ›´é«˜çš„è‡ªå»ºDocker imageï¼Œä¸Šä¼ ECRçš„éƒ¨ç½²å½¢å¼ã€‚å…·ä½“çš„æ“ä½œæµç¨‹å¯ä»¥å‚è§é™„ä»¶æ‰€åˆ—çš„æ–‡æ¡£ã€‚</li>
</ul>
<h2 data-id="heading-22">5. é™„å½•</h2>
<p>Github codeï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fheqiqi%2Fmulti-agent-for-customer-support" target="_blank" title="https://github.com/heqiqi/multi-agent-for-customer-support" ref="nofollow noopener noreferrer">github.com/heqiqi/multâ€¦</a></p>
<h2 data-id="heading-23">6. æ€»ç»“</h2>
<p>æœ¬ç¯‡è®¨è®ºäº†äºšé©¬é€Šäº‘ç§‘æŠ€Amazon Connectå‘¼å«ä¸­å¿ƒæœåŠ¡å’ŒAmazon Bedrock AgentCoreä»¥åŠStrands agentæ¡†æ¶ç»“åˆå®ç°æ™ºèƒ½å®¢æœè‡ªåŠ©æœåŠ¡æœ€ä½³å®è·µã€‚æœ¬åšå®¢ä»ç”¨æˆ·å®é™…éœ€æ±‚å‡ºå‘æä¾›ä¸€ä¸ªå®é™…å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œç»“åˆæŠ€æœ¯å’Œæˆæœ¬ç»¼åˆè€ƒè™‘æä¾›æœ€ä½³å®è·µã€‚æœ¬è®¾è®¡å……åˆ†è€ƒè™‘å‘¼å«ä¸­å¿ƒçš„ç‰¹æ®Šæ€§ï¼Œé‡‡ç”¨Lambdaï¼ŒAmazon Bedrockï¼ŒAmazon Bedrock AgentCoreï¼ŒStands Agentæ¡†æ¶ç»“åˆæä¾›ç»¼åˆè§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶æä¾›äº†Amazon Bedrock AgentCore Runtimeå’ŒStands Agentç»“åˆçš„ä»£ç å¹¶å’ŒAmazon Connectå®ç°é›†æˆï¼Œæä¾›Amazon Bedrock AgentCore Memoryé›†æˆåŠè°ƒç”¨ä»£ç å®ç°æ™ºèƒ½å®¢æœä¸Šä¸‹æ–‡è‡ªåŠ¨è®°å¿†åŠŸèƒ½ã€‚æœ¬ç¯‡æä¾›äº†æ•´ä¸ªå®è·µçš„å®Œæ•´ä»£ç åŠå®ç°çš„æ•ˆæœå±•ç¤ºï¼Œï¼Œè®©è¯»è€…å¯ä»¥æ¸…æ¥šäº†è§£å®ç°æ•ˆæœå’ŒæŠ€æœ¯ç»†èŠ‚ã€‚</p>
<p>*<em>å‰è¿°ç‰¹å®šäºšé©¬é€Šäº‘ç§‘æŠ€ç”Ÿæˆå¼äººå·¥æ™ºèƒ½ç›¸å…³çš„æœåŠ¡ç›®å‰åœ¨äºšé©¬é€Šäº‘ç§‘æŠ€æµ·å¤–åŒºåŸŸå¯ç”¨ã€‚äºšé©¬é€Šäº‘ç§‘æŠ€ä¸­å›½åŒºåŸŸç›¸å…³äº‘æœåŠ¡ç”±è¥¿äº‘æ•°æ®å’Œå…‰ç¯æ–°ç½‘è¿è¥ï¼Œå…·ä½“ä¿¡æ¯ä»¥ä¸­å›½åŒºåŸŸå®˜ç½‘ä¸ºå‡†ã€‚</em></p>
<p><strong>æœ¬ç¯‡ä½œè€…</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a85c843075441d8a972d86b33be860b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=p%2Fzxjbd7seG7U%2FJuuAV2slYkty0%3D" alt="9.webp" loading="lazy"/></p>
<blockquote>
<p>æœ¬æœŸæœ€æ–°å®éªŒã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_Juejintail_0415%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejintail_0415" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_Juejintail_0415&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejintail_0415" ref="nofollow noopener noreferrer">å¤šæ¨¡ä¸€ç«™é€š â€”â€” Amazon Bedrock ä¸Šçš„åŸºç¡€æ¨¡å‹åˆä½“éªŒ</a>ã€‹</p>
<p>âœ¨ ç²¾å¿ƒè®¾è®¡ï¼Œæ—¨åœ¨å¼•å¯¼æ‚¨æ·±å…¥æ¢ç´¢Amazon Bedrockçš„æ¨¡å‹é€‰æ‹©ä¸è°ƒç”¨ã€æ¨¡å‹è‡ªåŠ¨åŒ–è¯„ä¼°ä»¥åŠå®‰å…¨å›´æ (Guardrail)ç­‰é‡è¦åŠŸèƒ½ã€‚æ— éœ€ç®¡ç†åŸºç¡€è®¾æ–½ï¼Œåˆ©ç”¨äºšé©¬é€ŠæŠ€æœ¯ä¸ç”Ÿæ€ï¼Œå¿«é€Ÿé›†æˆä¸éƒ¨ç½²ç”Ÿæˆå¼AIæ¨¡å‹èƒ½åŠ›ã€‚</p>
<p>â©ï¸[<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_Juejintail_0415%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejintail_0415" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_Juejintail_0415&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejintail_0415" ref="nofollow noopener noreferrer">ç‚¹å‡»è¿›å…¥å®éªŒ</a>] å³åˆ»å¼€å¯  AI å¼€å‘ä¹‹æ—…</p>
<p>æ„å»ºæ— é™, æ¢ç´¢å¯ç¨‹ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æŠŠå¤§æ¨¡å‹è£…è¿›å£è¢‹ï¼šHuggingFaceå¦‚ä½•è®©AIæ°‘ä¸»åŒ–æˆä¸ºç°å®]]></title>    <link>https://juejin.cn/post/7583913535270469642</link>    <guid>https://juejin.cn/post/7583913535270469642</guid>    <pubDate>2025-12-15T10:02:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583913535270469642" data-draft-id="7583878719543623689" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æŠŠå¤§æ¨¡å‹è£…è¿›å£è¢‹ï¼šHuggingFaceå¦‚ä½•è®©AIæ°‘ä¸»åŒ–æˆä¸ºç°å®"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-15T10:02:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆè¯·æ±‚å‡ºæˆ˜"/> <meta itemprop="url" content="https://juejin.cn/user/4222596374865550"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æŠŠå¤§æ¨¡å‹è£…è¿›å£è¢‹ï¼šHuggingFaceå¦‚ä½•è®©AIæ°‘ä¸»åŒ–æˆä¸ºç°å®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4222596374865550/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆè¯·æ±‚å‡ºæˆ˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:02:51.000Z" title="Mon Dec 15 2025 10:02:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å¦‚æœä½ åœ¨2025å¹´è¿˜è§‰å¾—å¤§æ¨¡å‹æ˜¯ç§‘æŠ€å·¨å¤´çš„ä¸“åˆ©ï¼Œé‚£ä½ å¯èƒ½é”™è¿‡äº†AIæ°‘ä¸»åŒ–æœ€å…³é”®çš„ä¸€æ­¥â€”â€”è€Œè¿™ä¸€æ­¥ï¼Œæ˜¯ç”±ä¸€ä¸ªåä¸ºHuggingFaceçš„å¹³å°å®Œæˆçš„ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä»â€œå®éªŒå®¤çå“â€åˆ°â€œå¼€å‘è€…æ ‡é…â€çš„èœ•å˜</h2>
<p>ä¸‰å¹´å‰ï¼Œæƒ³è¦ç”¨ä¸Šæœ€å…ˆè¿›çš„å¤§æ¨¡å‹æ˜¯ä»€ä¹ˆä½“éªŒï¼Ÿ</p>
<p>ä½ éœ€è¦å…ˆè¯»é€å‡ ç™¾é¡µçš„è®ºæ–‡ï¼Œé…ç½®å¤æ‚çš„CUDAç¯å¢ƒï¼Œå¤„ç†å„ç§ä¾èµ–å†²çªï¼Œæœ€ååœ¨æ˜‚è´µçš„GPUä¸Šæˆ˜æˆ˜å…¢å…¢åœ°è¿è¡Œâ€”â€”ç»“æœå¾ˆå¯èƒ½å› ä¸ºä¸€ä¸ªç‰ˆæœ¬ä¸å…¼å®¹è€Œå‰åŠŸå°½å¼ƒã€‚</p>
<p>ä»Šå¤©å‘¢ï¼Ÿæ‰“å¼€Pythonï¼Œä¸‰è¡Œä»£ç ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline
chatbot = pipeline(<span class="hljs-string">"text-generation"</span>, model=<span class="hljs-string">"Qwen/Qwen2.5-7B"</span>)
response = chatbot(<span class="hljs-string">"å¸®æˆ‘å†™ä¸€æ®µäº§å“ä»‹ç»"</span>)
</code></pre>
<p>ä¸€ä¸ªèƒ½å¯¹è¯ã€èƒ½å†™ä½œã€èƒ½ç¼–ç¨‹çš„æ™ºèƒ½åŠ©æ‰‹å°±åœ¨ä½ çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šè·‘èµ·æ¥äº†ã€‚è¿™ä¸ªè½¬å˜çš„æ ¸å¿ƒæ¨æ‰‹ï¼Œæ­£æ˜¯HuggingFaceã€‚</p>
<p>ä½†HuggingFaceçš„ä»·å€¼è¿œä¸æ­¢â€œè®©è°ƒç”¨æ¨¡å‹å˜ç®€å•â€ã€‚å®ƒçœŸæ­£åšçš„ï¼Œæ˜¯<strong>é‡æ„äº†æ•´ä¸ªAIå¼€å‘çš„ä»·å€¼é“¾</strong>ã€‚</p>
<h2 data-id="heading-1">ç¬¬ä¸€éƒ¨åˆ†ï¼šä¸ºä»€ä¹ˆAIä¸–ç•Œéœ€è¦ä¸€ä¸ªâ€œæ¨¡å‹ä»“åº“â€ï¼Ÿ</h2>
<h3 data-id="heading-2">1.1 å¤§æ¨¡å‹çš„â€œå¯’æ­¦çºªå¤§çˆ†å‘â€ä¸éšä¹‹è€Œæ¥çš„æ··ä¹±</h3>
<p>2022-2024å¹´ï¼Œæˆ‘ä»¬è§è¯äº†å¤§æ¨¡å‹çš„â€œå¯’æ­¦çºªå¤§çˆ†å‘â€ï¼š</p>
<ul>
<li>OpenAIçš„GPTç³»åˆ—ä»3.5è¿­ä»£åˆ°4o</li>
<li>è°·æ­Œçš„PaLMã€Geminiæ¥è¿å‘å¸ƒ</li>
<li>Metaå¼€æºäº†Llamaç³»åˆ—ï¼Œå½»åº•ç‚¹ç‡ƒäº†å¼€æºç¤¾åŒºçš„æ¿€æƒ…</li>
<li>ä¸­å›½çš„é˜¿é‡Œé€šä¹‰ã€ç™¾åº¦æ–‡å¿ƒã€æ™ºè°±ChatGLMã€æ·±åº¦æ±‚ç´¢DeepSeekç­‰ç™¾èŠ±é½æ”¾</li>
</ul>
<p>ä½†ç¹è£èƒŒåæ˜¯å·¨å¤§çš„æ··ä¹±ï¼šæ¯ä¸ªæ¡†æ¶éƒ½æœ‰è‡ªå·±çš„APIï¼Œæ¯ä¸ªæ¨¡å‹éƒ½æœ‰è‡ªå·±çš„æƒé‡æ ¼å¼ï¼Œæ¯ç¯‡è®ºæ–‡éƒ½æœ‰è‡ªå·±çš„é¢„å¤„ç†æ­¥éª¤ã€‚</p>
<p>å¼€å‘è€…é¢ä¸´çš„é€‰æ‹©å›°å¢ƒï¼šæˆ‘æ˜¯è¯¥ç”¨PyTorchè¿˜æ˜¯TensorFlowï¼Ÿè¯¥ç”¨HuggingFace Transformersè¿˜æ˜¯ç›´æ¥è°ƒç”¨åŸå‚SDKï¼Ÿæ¨¡å‹æƒé‡æ˜¯.safetensorsæ ¼å¼è¿˜æ˜¯.binæ ¼å¼ï¼Ÿ</p>
<p>è¿™ç§ç¢ç‰‡åŒ–ä¸¥é‡é˜»ç¢äº†æŠ€æœ¯çš„æ™®åŠã€‚å°±åƒæ™ºèƒ½æ‰‹æœºæ—©æœŸï¼Œæ¯ä¸ªæ‰‹æœºå‚å•†éƒ½æœ‰è‡ªå·±çš„å……ç”µæ¥å£â€”â€”ç›´åˆ°Type-Cç»Ÿä¸€äº†å¤©ä¸‹ã€‚</p>
<h3 data-id="heading-3">1.2 HuggingFaceçš„â€œç»Ÿä¸€åœºè®ºâ€</h3>
<p>HuggingFaceåšäº†ä¸€ä»¶çœ‹ä¼¼ç®€å•å´æå…·è¿œè§çš„äº‹ï¼š<strong>ä¸ºæ‰€æœ‰å¤§æ¨¡å‹å®šä¹‰äº†ä¸€å¥—é€šç”¨æ¥å£</strong>ã€‚</p>
<p>è¿™å°±åƒUSBåè®®ä¸ºæ‰€æœ‰å¤–è®¾å®šä¹‰äº†é€šä¿¡æ ‡å‡†ã€‚æ— è®ºåº•å±‚æ˜¯Transformerã€RNNè¿˜æ˜¯CNNï¼Œæ— è®ºæ¨¡å‹æ¥è‡ªè°·æ­Œã€Metaè¿˜æ˜¯ä¸­å›½çš„åˆ›ä¸šå…¬å¸ï¼Œåœ¨HuggingFaceçš„ä¸–ç•Œé‡Œï¼Œå®ƒä»¬éƒ½éµå¾ªåŒæ ·çš„è°ƒç”¨è§„èŒƒã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åŠ è½½ä»»ä½•æ¨¡å‹ï¼Œéƒ½æ˜¯åŒæ ·çš„ä¸‰è¡Œä»£ç </span>
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModel, AutoTokenizer

model = AutoModel.from_pretrained(<span class="hljs-string">"æ¨¡å‹åç§°"</span>)
tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">"æ¨¡å‹åç§°"</span>)
</code></pre>
<p>è¿™ç§ç»Ÿä¸€å¸¦æ¥çš„æ•ˆç‡æå‡æ˜¯æŒ‡æ•°çº§çš„ã€‚å¼€å‘è€…ä¸å†éœ€è¦ä¸ºæ¯ä¸ªæ–°æ¨¡å‹é‡å­¦ä¸€å¥—APIï¼Œä¼ä¸šä¸å†éœ€è¦ä¸ºæ¯ä¸ªæ¡†æ¶ç»´æŠ¤ä¸€å¥—åŸºç¡€è®¾æ–½ã€‚</p>
<h2 data-id="heading-4">ç¬¬äºŒéƒ¨åˆ†ï¼šTransformersåº“â€”â€”ä¸åªæ˜¯åŠ è½½æ¨¡å‹çš„å·¥å…·</h2>
<h3 data-id="heading-5">2.1 â€œè‡ªåŠ¨â€èƒŒåçš„æ™ºèƒ½</h3>
<p>è¡¨é¢ä¸Šçœ‹ï¼Œ<code>AutoModel.from_pretrained()</code>åªæ˜¯åŠ è½½æ¨¡å‹ã€‚ä½†åœ¨è¿™è¡Œç®€å•çš„ä»£ç èƒŒåï¼Œæ˜¯ä¸€ä¸ªå¤æ‚çš„æ™ºèƒ½ç³»ç»Ÿï¼š</p>
<p><strong>è‡ªåŠ¨æ¶æ„æ£€æµ‹</strong>ï¼šå½“ä½ ä¼ å…¥"bert-base-chinese"æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š</p>
<ol>
<li>ä»HuggingFace Hubä¸‹è½½æ¨¡å‹é…ç½®</li>
<li>æ ¹æ®é…ç½®ä¸­çš„<code>model_type</code>å­—æ®µè¯†åˆ«è¿™æ˜¯BERTæ¶æ„</li>
<li>åŠ¨æ€åŠ è½½å¯¹åº”çš„æ¨¡å‹ç±»</li>
<li>åº”ç”¨æ­£ç¡®çš„æƒé‡åˆå§‹åŒ–æ–¹å¼</li>
</ol>
<p><strong>è‡ªåŠ¨è®¾å¤‡ç®¡ç†</strong>ï¼šå½“ä½ æœ‰ä¸€å°å¸¦24GBæ˜¾å­˜çš„4090å’Œ64GBå†…å­˜çš„ç”µè„‘æ—¶ï¼š</p>
<pre><code class="hljs language-python" lang="python">model = AutoModel.from_pretrained(<span class="hljs-string">"Qwen/Qwen2.5-14B"</span>, device_map=<span class="hljs-string">"auto"</span>)
</code></pre>
<p>è¿™è¡Œä»£ç ä¼šè‡ªåŠ¨å°†æ¨¡å‹çš„ä¸åŒå±‚åˆ†é…åˆ°GPUå’ŒCPUä¸Šï¼Œç”šè‡³å®ç°å±‚é—´æµæ°´çº¿ï¼Œè®©å¤§æ¨¡å‹èƒ½åœ¨â€œå°â€è®¾å¤‡ä¸Šè¿è¡Œã€‚</p>
<p><strong>è‡ªåŠ¨é‡åŒ–æ”¯æŒ</strong>ï¼šå½“æ¨¡å‹å¤ªå¤§æ—¶ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> BitsAndBytesConfig
quant_config = BitsAndBytesConfig(load_in_4bit=<span class="hljs-literal">True</span>)
model = AutoModel.from_pretrained(<span class="hljs-string">"æ¨¡å‹åç§°"</span>, quantization_config=quant_config)
</code></pre>
<p>è‡ªåŠ¨å°†FP32æƒé‡è½¬æ¢ä¸ºINT4ï¼Œæ˜¾å­˜å ç”¨å‡å°‘75%ï¼Œæ€§èƒ½æŸå¤±ä¸åˆ°5%ã€‚</p>
<h3 data-id="heading-6">2.2 Pipelineï¼šä»â€œå‡½æ•°è°ƒç”¨â€åˆ°â€œä»»åŠ¡æŠ½è±¡â€</h3>
<p>å¦‚æœè¯´<code>AutoModel</code>æ˜¯ç»Ÿä¸€äº†æ¨¡å‹çš„â€œåŠ è½½æ–¹å¼â€ï¼Œé‚£ä¹ˆ<code>pipeline</code>åˆ™æ˜¯ç»Ÿä¸€äº†æ¨¡å‹çš„â€œä½¿ç”¨æ–¹å¼â€ã€‚</p>
<p>ä¼ ç»ŸAIå¼€å‘ä¸­ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æ˜¯ä¸€å¥—ç‹¬ç«‹æµç¨‹ï¼š</p>
<ul>
<li>æ–‡æœ¬åˆ†ç±»ï¼šåˆ†è¯â†’ç¼–ç â†’æ¨¡å‹æ¨ç†â†’Softmaxâ†’å–æœ€å¤§å€¼</li>
<li>å‘½åå®ä½“è¯†åˆ«ï¼šåˆ†è¯â†’ç¼–ç â†’æ¨¡å‹æ¨ç†â†’CRFè§£ç â†’å®ä½“åˆå¹¶</li>
<li>æ–‡æœ¬ç”Ÿæˆï¼šåˆ†è¯â†’ç¼–ç â†’è‡ªå›å½’ç”Ÿæˆâ†’è§£ç â†’åå¤„ç†</li>
</ul>
<p><code>pipeline</code>æŠŠè¿™äº›æµç¨‹å…¨éƒ¨å°è£…ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ‰€æœ‰ä»»åŠ¡ï¼ŒåŒä¸€å¥—API</span>
classifier = pipeline(<span class="hljs-string">"text-classification"</span>)  <span class="hljs-comment"># æ–‡æœ¬åˆ†ç±»</span>
ner = pipeline(<span class="hljs-string">"ner"</span>)                         <span class="hljs-comment"># å‘½åå®ä½“è¯†åˆ«</span>
generator = pipeline(<span class="hljs-string">"text-generation"</span>)       <span class="hljs-comment"># æ–‡æœ¬ç”Ÿæˆ</span>
translator = pipeline(<span class="hljs-string">"translation"</span>)          <span class="hljs-comment"># ç¿»è¯‘</span>
</code></pre>
<p>æ›´é‡è¦çš„æ˜¯ï¼Œ<code>pipeline</code>å†…ç½®äº†<strong>æœ€ä½³å®è·µ</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨å¤„ç†å¡«å……å’Œæˆªæ–­</li>
<li>è‡ªåŠ¨æ‰¹å¤„ç†æå‡æ€§èƒ½</li>
<li>è‡ªåŠ¨è®¾å¤‡ç®¡ç†</li>
<li>é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶</li>
</ul>
<h3 data-id="heading-7">2.3 Tokenizerçš„è‰ºæœ¯ï¼šä»å­—ç¬¦åˆ°å‘é‡çš„é­”æ³•</h3>
<p>å¤§æ¨¡å‹ä¸ç†è§£æ–‡å­—ï¼Œåªç†è§£æ•°å­—ã€‚å°†æ–‡å­—è½¬æ¢ä¸ºæ•°å­—çš„è¿‡ç¨‹å°±æ˜¯åˆ†è¯ï¼ˆTokenizationï¼‰ã€‚è¿™çœ‹ä¼¼ç®€å•ï¼Œå®åˆ™å……æ»¡ç„æœºã€‚</p>
<p><strong>ä¸­æ–‡åˆ†è¯çš„ä¸‰ç§æµæ´¾</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. å­—åˆ†è¯ï¼ˆBERTé£æ ¼ï¼‰</span>
tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">"bert-base-chinese"</span>)
tokens = tokenizer.tokenize(<span class="hljs-string">"è‡ªç„¶è¯­è¨€å¤„ç†"</span>)  <span class="hljs-comment"># ['è‡ª', 'ç„¶', 'è¯­', 'è¨€', 'å¤„', 'ç†']</span>

<span class="hljs-comment"># 2. è¯åˆ†è¯ï¼ˆGPTé£æ ¼ï¼‰</span>
tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">"gpt2-chinese"</span>)
tokens = tokenizer.tokenize(<span class="hljs-string">"è‡ªç„¶è¯­è¨€å¤„ç†"</span>)  <span class="hljs-comment"># ['è‡ªç„¶', 'è¯­è¨€', 'å¤„ç†']</span>

<span class="hljs-comment"># 3. å­è¯åˆ†è¯ï¼ˆBPE/WordPieceï¼‰</span>
tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">"xlm-roberta-base"</span>)
tokens = tokenizer.tokenize(<span class="hljs-string">"natural language processing"</span>)  <span class="hljs-comment"># ['natural', 'Ä language', 'Ä processing']</span>
</code></pre>
<p>æ¯ç§åˆ†è¯æ–¹å¼éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ï¼š</p>
<ul>
<li><strong>å­—åˆ†è¯</strong>ï¼šè¯è¡¨å°ï¼ˆ2ä¸‡å­—å·¦å³ï¼‰ï¼Œä½†è¯­ä¹‰ç²’åº¦ç²—</li>
<li><strong>è¯åˆ†è¯</strong>ï¼šè¯­ä¹‰ç²’åº¦ç»†ï¼Œä½†è¯è¡¨å¤§ï¼ˆ5ä¸‡-50ä¸‡ï¼‰ï¼ŒOOVï¼ˆæœªç™»å½•è¯ï¼‰é—®é¢˜ä¸¥é‡</li>
<li><strong>å­è¯åˆ†è¯</strong>ï¼šå¹³è¡¡äº†ä¸¤è€…ï¼Œä½†éœ€è¦å¤æ‚çš„è®­ç»ƒç®—æ³•</li>
</ul>
<p>HuggingFaceçš„Tokenizeræœ€å‰å®³çš„åœ°æ–¹åœ¨äºï¼š<strong>å®ƒè®©å¼€å‘è€…å®Œå…¨ä¸ç”¨å…³å¿ƒè¿™äº›ç»†èŠ‚</strong>ã€‚æ— è®ºåº•å±‚ç”¨ä»€ä¹ˆåˆ†è¯ç®—æ³•ï¼ŒAPIéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<h2 data-id="heading-8">ç¬¬ä¸‰éƒ¨åˆ†ï¼šDatasetsåº“â€”â€”AIçš„â€œæ•°æ®åŠ æ²¹ç«™â€</h2>
<h3 data-id="heading-9">3.1 æ•°æ®ï¼šAIçš„çŸ³æ²¹ï¼Œä¹Ÿæ˜¯æœ€æ·±çš„æŠ¤åŸæ²³</h3>
<p>åœ¨AIé¢†åŸŸï¼Œæœ‰ä¸€ä¸ªå…±è¯†ï¼šæ•°æ®è´¨é‡å†³å®šæ¨¡å‹ä¸Šé™ã€‚ä½†è·å–é«˜è´¨é‡æ•°æ®æ˜¯æå…¶æ˜‚è´µçš„ï¼š</p>
<ol>
<li><strong>æ ‡æ³¨æˆæœ¬</strong>ï¼šä¸€ä¸ªæƒ…æ„Ÿåˆ†ææ•°æ®é›†ï¼Œæ¯æ¡æ•°æ®æ ‡æ³¨æˆæœ¬0.5å…ƒï¼Œ100ä¸‡æ¡å°±æ˜¯50ä¸‡å…ƒ</li>
<li><strong>æ¸…æ´—æˆæœ¬</strong>ï¼šåŸå§‹æ•°æ®ä¸­å¯èƒ½æœ‰30%çš„å™ªå£°ï¼Œæ¸…æ´—åˆæ˜¯ä¸€å¤§ç¬”å¼€é”€</li>
<li><strong>åˆè§„æˆæœ¬</strong>ï¼šç”¨æˆ·æ•°æ®æ¶‰åŠéšç§ï¼Œéœ€è¦è„±æ•ã€åŠ å¯†ã€åˆè§„å®¡æŸ¥</li>
</ol>
<p>HuggingFace Datasetsçš„ä»·å€¼åœ¨äºï¼šå®ƒå»ºç«‹äº†ä¸€ä¸ª<strong>æ•°æ®å…±äº«ç»æµ</strong>ã€‚</p>
<h3 data-id="heading-10">3.2 æµå¼å¤„ç†ï¼šè®©å¤§æ•°æ®é›†åœ¨â€œå°å†…å­˜â€ä¸­è¿è¡Œ</h3>
<p>ä¼ ç»Ÿçš„æ•°æ®åŠ è½½æ–¹å¼ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-comment"># åŠ è½½100GBçš„æ–‡æœ¬æ•°æ®ï¼Ÿç›´æ¥å†…å­˜çˆ†ç‚¸</span>
data = pd.read_csv(<span class="hljs-string">"100gb_text.csv"</span>)
</code></pre>
<p>Datasetsçš„æµå¼åŠ è½½ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset
<span class="hljs-comment"># æµå¼åŠ è½½ï¼Œå†…å­˜ä¸­åªä¿ç•™å½“å‰æ‰¹æ¬¡</span>
dataset = load_dataset(<span class="hljs-string">"big_corpus"</span>, streaming=<span class="hljs-literal">True</span>)
<span class="hljs-keyword">for</span> batch <span class="hljs-keyword">in</span> dataset.<span class="hljs-built_in">iter</span>(batch_size=<span class="hljs-number">1000</span>):
    process(batch)  <span class="hljs-comment"># å¤„ç†å½“å‰æ‰¹æ¬¡</span>
</code></pre>
<p>æ›´æ™ºèƒ½çš„æ˜¯<strong>å†…å­˜æ˜ å°„ï¼ˆMemory Mappingï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ•°æ®é›†çœ‹èµ·æ¥åƒåœ¨å†…å­˜ä¸­ï¼Œå®é™…åœ¨ç£ç›˜ä¸Š</span>
dataset = load_dataset(<span class="hljs-string">"big_corpus"</span>)
<span class="hljs-comment"># é¦–æ¬¡è®¿é—®ä¼šæ…¢ï¼Œåç»­è®¿é—®æœ‰ç¼“å­˜</span>
</code></pre>
<h3 data-id="heading-11">3.3 æ•°æ®ç‰ˆæœ¬æ§åˆ¶ï¼šAIçš„â€œGitâ€</h3>
<p>æ•°æ®ä¸æ˜¯é™æ€çš„ã€‚ä»Šå¤©å‡†ç¡®çš„æ•°æ®ï¼Œæ˜å¤©å¯èƒ½å°±è¿‡æ—¶äº†ã€‚æ•°æ®ç‰ˆæœ¬æ§åˆ¶å› æ­¤å˜å¾—è‡³å…³é‡è¦ã€‚</p>
<p>Datasetsåº“å†…ç½®äº†ç‰ˆæœ¬æ§åˆ¶ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åŠ è½½ç‰¹å®šç‰ˆæœ¬</span>
dataset_v1 = load_dataset(<span class="hljs-string">"my_dataset"</span>, revision=<span class="hljs-string">"v1.0"</span>)
dataset_v2 = load_dataset(<span class="hljs-string">"my_dataset"</span>, revision=<span class="hljs-string">"v2.0"</span>)

<span class="hljs-comment"># æ¯”è¾ƒä¸åŒç‰ˆæœ¬</span>
diff = dataset_v1.diff(dataset_v2)
</code></pre>
<p>è¿™è§£å†³äº†AIå¼€å‘ä¸­çš„ä¸€ä¸ªå¤§ç—›ç‚¹ï¼š<strong>å¯å¤ç°æ€§</strong>ã€‚ä¸‰å¹´å‰è®­ç»ƒçš„æ¨¡å‹ï¼Œä»Šå¤©è¿˜èƒ½ç”¨åŒæ ·çš„æ•°æ®é‡æ–°è®­ç»ƒå—ï¼Ÿæœ‰äº†æ•°æ®ç‰ˆæœ¬æ§åˆ¶ï¼Œç­”æ¡ˆæ˜¯å¯ä»¥ã€‚</p>
<h2 data-id="heading-12">ç¬¬å››éƒ¨åˆ†ï¼šHuggingFace Hubâ€”â€”ä¸åªæ˜¯æ¨¡å‹ä»“åº“</h2>
<h3 data-id="heading-13">4.1 æ¨¡å‹å‘ç°çš„â€œApp Storeâ€</h3>
<p>HuggingFace Hubä¸Šæœ‰è¶…è¿‡50ä¸‡ä¸ªæ¨¡å‹ã€‚å¦‚ä½•æ‰¾åˆ°ä½ éœ€è¦çš„ï¼ŸHubæä¾›äº†å¤šç»´åº¦çš„å‘ç°æœºåˆ¶ï¼š</p>
<p><strong>æŒ‰ä»»åŠ¡ç­›é€‰</strong>ï¼šæ–‡æœ¬åˆ†ç±»ã€æ–‡æœ¬ç”Ÿæˆã€å›¾åƒåˆ†ç±»ã€è¯­éŸ³è¯†åˆ«...
<strong>æŒ‰è¯­è¨€ç­›é€‰</strong>ï¼šä¸­æ–‡ã€è‹±æ–‡ã€å¤šè¯­è¨€...
<strong>æŒ‰è®¸å¯è¯ç­›é€‰</strong>ï¼šå•†ç”¨ã€ç ”ç©¶ç”¨ã€å¼€æº...
<strong>æŒ‰å¤§å°ç­›é€‰</strong>ï¼š&lt;100Mã€100M-1Bã€&gt;1B...
<strong>æŒ‰æµè¡Œåº¦ç­›é€‰</strong>ï¼šä¸‹è½½é‡ã€ç‚¹èµæ•°ã€è¿‘æœŸæ´»è·ƒåº¦</p>
<p>æ›´é‡è¦çš„æ˜¯**æ¨¡å‹å¡ç‰‡ï¼ˆModel Cardï¼‰**ç³»ç»Ÿã€‚æ¯ä¸ªæ¨¡å‹éƒ½æœ‰è¯¦ç»†çš„æ–‡æ¡£ï¼š</p>
<ul>
<li>è®­ç»ƒæ•°æ®æ˜¯ä»€ä¹ˆ</li>
<li>åœ¨å“ªäº›åŸºå‡†æµ‹è¯•ä¸Šè¡¨ç°å¦‚ä½•</li>
<li>æœ‰ä»€ä¹ˆå·²çŸ¥ç¼ºé™·ï¼ˆåè§ã€å¹»è§‰ç­‰ï¼‰</li>
<li>å¦‚ä½•ä½¿ç”¨ç¤ºä¾‹ä»£ç </li>
</ul>
<h3 data-id="heading-14">4.2 Spacesï¼šé›¶åç«¯éƒ¨ç½²AIåº”ç”¨</h3>
<p>ä¼ ç»ŸAIåº”ç”¨éƒ¨ç½²ï¼š</p>
<ol>
<li>è´­ä¹°äº‘æœåŠ¡å™¨</li>
<li>é…ç½®GPUç¯å¢ƒ</li>
<li>éƒ¨ç½²æ¨¡å‹æœåŠ¡</li>
<li>å¼€å‘å‰ç«¯ç•Œé¢</li>
<li>é…ç½®è´Ÿè½½å‡è¡¡</li>
<li>ç›‘æ§å’Œè¿ç»´</li>
</ol>
<p>Spacesè®©è¿™ä¸€åˆ‡å˜å¾—ç®€å•ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> gradio <span class="hljs-keyword">as</span> gr
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

generator = pipeline(<span class="hljs-string">"text-generation"</span>, <span class="hljs-string">"gpt2"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_text</span>(<span class="hljs-params">prompt</span>):
    <span class="hljs-keyword">return</span> generator(prompt, max_length=<span class="hljs-number">100</span>)[<span class="hljs-number">0</span>][<span class="hljs-string">'generated_text'</span>]

gr.Interface(fn=generate_text, inputs=<span class="hljs-string">"text"</span>, outputs=<span class="hljs-string">"text"</span>).launch()
</code></pre>
<p>ä¸Šä¼ åˆ°Spacesï¼Œä½ å°±å¾—åˆ°äº†ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ°¸ä¹…åœ¨çº¿çš„Webåº”ç”¨</li>
<li>å…è´¹çš„GPUèµ„æºï¼ˆæœ‰é™æ—¶é•¿ï¼‰</li>
<li>è‡ªåŠ¨HTTPSè¯ä¹¦</li>
<li>è®¿é—®é‡ç»Ÿè®¡</li>
<li>ç¤¾åŒºåé¦ˆç³»ç»Ÿ</li>
</ul>
<h3 data-id="heading-15">4.3 åä½œä¸ç¤¾åŒºï¼šå¼€æºAIçš„é£è½®æ•ˆåº”</h3>
<p>HuggingFaceæœ€å¼ºå¤§çš„ä¸æ˜¯æŠ€æœ¯ï¼Œè€Œæ˜¯<strong>ç¤¾åŒº</strong>ã€‚</p>
<p><strong>å¼€æºè´¡çŒ®çš„é£è½®</strong>ï¼š</p>
<ol>
<li>ç ”ç©¶è€…å¼€æºæ¨¡å‹ â†’ 2. å¼€å‘è€…ä½¿ç”¨å¹¶åé¦ˆé—®é¢˜ â†’ 3. ç ”ç©¶è€…æ”¹è¿›æ¨¡å‹ â†’ 4. æ›´å¤šå¼€å‘è€…åŠ å…¥</li>
</ol>
<p><strong>ä¼ä¸šå‚ä¸çš„å…±èµ¢</strong>ï¼š</p>
<ul>
<li>å¤§å…¬å¸å¼€æºâ€œåŸºåº§æ¨¡å‹â€</li>
<li>ä¸­å°ä¼ä¸šåœ¨åŸºåº§ä¸Šå¾®è°ƒâ€œå‚ç›´æ¨¡å‹â€</li>
<li>åˆ›ä¸šå…¬å¸åŸºäºæ¨¡å‹æ„å»ºåº”ç”¨</li>
<li>æ‰€æœ‰äººéƒ½ä»ç”Ÿæ€å¢é•¿ä¸­å—ç›Š</li>
</ul>
<h2 data-id="heading-16">ç¬¬äº”éƒ¨åˆ†ï¼šå®æˆ˜æŒ‡å—â€”â€”ä»å®éªŒåˆ°ç”Ÿäº§</h2>
<h3 data-id="heading-17">5.1 æ¨¡å‹é€‰æ‹©ï¼šæ²¡æœ‰æœ€å¥½ï¼Œåªæœ‰æœ€åˆé€‚</h3>
<p>é€‰æ‹©æ¨¡å‹çš„å†³ç­–æ¡†æ¶ï¼š</p>
<p><strong>åœºæ™¯ä¸€ï¼šèŠå¤©æœºå™¨äºº</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># éœ€è¦è¾ƒå¼ºçš„æ¨ç†å’Œå¯¹è¯èƒ½åŠ›</span>
<span class="hljs-comment"># æ¨èï¼šQwenã€ChatGLMã€DeepSeek</span>
model = <span class="hljs-string">"Qwen/Qwen2.5-7B-Instruct"</span>
</code></pre>
<p><strong>åœºæ™¯äºŒï¼šæ–‡æœ¬åµŒå…¥</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># éœ€è¦å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡</span>
<span class="hljs-comment"># æ¨èï¼šBGEã€text2vec</span>
model = <span class="hljs-string">"BAAI/bge-large-zh"</span>
</code></pre>
<p><strong>åœºæ™¯ä¸‰ï¼šä»£ç ç”Ÿæˆ</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># éœ€è¦ç†è§£ç¼–ç¨‹è¯­è¨€</span>
<span class="hljs-comment"># æ¨èï¼šCodeLlamaã€DeepSeek-Coder</span>
model = <span class="hljs-string">"codellama/CodeLlama-7b"</span>
</code></pre>
<p><strong>åœºæ™¯å››ï¼šè¾¹ç¼˜éƒ¨ç½²</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># éœ€è¦åœ¨èµ„æºå—é™è®¾å¤‡ä¸Šè¿è¡Œ</span>
<span class="hljs-comment"># æ¨èï¼šé‡åŒ–åçš„å°æ¨¡å‹</span>
model = <span class="hljs-string">"microsoft/phi-2"</span>  <span class="hljs-comment"># ä»…2.7Bå‚æ•°</span>
</code></pre>
<h3 data-id="heading-18">5.2 æ€§èƒ½ä¼˜åŒ–ï¼šè®©æ¨ç†é€Ÿåº¦é£èµ·æ¥</h3>
<p><strong>æŠ€å·§ä¸€ï¼šé‡åŒ–</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM, BitsAndBytesConfig
<span class="hljs-keyword">import</span> torch

bnb_config = BitsAndBytesConfig(
    load_in_4bit=<span class="hljs-literal">True</span>,
    bnb_4bit_compute_dtype=torch.float16,
    bnb_4bit_quant_type=<span class="hljs-string">"nf4"</span>,
)

model = AutoModelForCausalLM.from_pretrained(
    <span class="hljs-string">"æ¨¡å‹åç§°"</span>,
    quantization_config=bnb_config,
)
<span class="hljs-comment"># æ˜¾å­˜å‡å°‘75%ï¼Œé€Ÿåº¦æå‡2-3å€</span>
</code></pre>
<p><strong>æŠ€å·§äºŒï¼šç¼“å­˜æ³¨æ„åŠ›ï¼ˆKV Cacheï¼‰</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è‡ªå›å½’ç”Ÿæˆæ—¶ï¼Œç¼“å­˜ä¹‹å‰çš„æ³¨æ„åŠ›ç»“æœ</span>
generator = pipeline(<span class="hljs-string">"text-generation"</span>, model=model)
result = generator(
    prompt,
    max_length=<span class="hljs-number">100</span>,
    use_cache=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># å¯ç”¨KVç¼“å­˜</span>
)
<span class="hljs-comment"># é€Ÿåº¦æå‡30-50%</span>
</code></pre>
<p><strong>æŠ€å·§ä¸‰ï¼šæ‰¹å¤„ç†</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚</span>
prompts = [<span class="hljs-string">"æç¤º1"</span>, <span class="hljs-string">"æç¤º2"</span>, <span class="hljs-string">"æç¤º3"</span>, <span class="hljs-string">"æç¤º4"</span>]
results = generator(prompts, batch_size=<span class="hljs-number">4</span>)
<span class="hljs-comment"># GPUåˆ©ç”¨ç‡ä»30%æå‡åˆ°80%</span>
</code></pre>
<h3 data-id="heading-19">5.3 æˆæœ¬æ§åˆ¶ï¼šè®©AIç”¨å¾—èµ·</h3>
<p><strong>ç­–ç•¥ä¸€ï¼šåˆ†å±‚å¤„ç†</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç®€å•é—®é¢˜ç”¨å°æ¨¡å‹ï¼Œå¤æ‚é—®é¢˜ç”¨å¤§æ¨¡å‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">smart_router</span>(<span class="hljs-params">question</span>):
    <span class="hljs-keyword">if</span> is_simple_question(question):
        <span class="hljs-keyword">return</span> small_model(question)  <span class="hljs-comment"># å…è´¹æˆ–ä½æˆæœ¬</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> large_model(question)  <span class="hljs-comment"># é«˜æˆæœ¬ä½†èƒ½åŠ›å¼º</span>
</code></pre>
<p><strong>ç­–ç•¥äºŒï¼šç¼“å­˜ç»“æœ</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache
<span class="hljs-keyword">import</span> hashlib

<span class="hljs-meta">@lru_cache(<span class="hljs-params">maxsize=<span class="hljs-number">10000</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cached_response</span>(<span class="hljs-params">prompt</span>):
    <span class="hljs-comment"># ç›¸åŒæç¤ºè¯ç›´æ¥è¿”å›ç¼“å­˜</span>
    <span class="hljs-keyword">return</span> model(prompt)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_with_cache</span>(<span class="hljs-params">prompt</span>):
    prompt_hash = hashlib.md5(prompt.encode()).hexdigest()
    <span class="hljs-keyword">return</span> get_cached_response(prompt_hash)
</code></pre>
<p><strong>ç­–ç•¥ä¸‰ï¼šæå‰ç»ˆæ­¢</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å½“ç”Ÿæˆè´¨é‡è¶³å¤Ÿå¥½æ—¶æå‰åœæ­¢</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_with_early_stopping</span>(<span class="hljs-params">prompt, quality_threshold=<span class="hljs-number">0.95</span></span>):
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(max_length):
        token = generate_next_token()
        current_quality = calculate_quality()
        <span class="hljs-keyword">if</span> current_quality &gt; quality_threshold:
            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># æå‰ç»ˆæ­¢ï¼ŒèŠ‚çœè®¡ç®—</span>
    <span class="hljs-keyword">return</span> generated_text
</code></pre>
<h2 data-id="heading-20">ç¬¬å…­éƒ¨åˆ†ï¼šä¸­å›½å¼€å‘è€…çš„ç‰¹åˆ«æŒ‡å—</h2>
<h3 data-id="heading-21">6.1 ç½‘ç»œé—®é¢˜ï¼šä¸æ­¢æ˜¯â€œç§‘å­¦ä¸Šç½‘â€</h3>
<p>å¯¹äºä¸­å›½å¼€å‘è€…ï¼Œè®¿é—®HuggingFaceçš„æœ€å¤§éšœç¢æ˜¯ç½‘ç»œã€‚è§£å†³æ–¹æ¡ˆï¼š</p>
<p><strong>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨å›½å†…é•œåƒ</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½®ç¯å¢ƒå˜é‡</span>
<span class="hljs-built_in">export</span> HF_ENDPOINT=https://hf-mirror.com

<span class="hljs-comment"># æˆ–è€…åœ¨ä»£ç ä¸­è®¾ç½®</span>
import os
os.environ[<span class="hljs-string">'HF_ENDPOINT'</span>] = <span class="hljs-string">'https://hf-mirror.com'</span>
</code></pre>
<p><strong>æ–¹æ¡ˆäºŒï¼šModelScopeï¼ˆé­”æ­ç¤¾åŒºï¼‰</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># é˜¿é‡Œäº‘æä¾›çš„å›½å†…æ›¿ä»£</span>
<span class="hljs-keyword">from</span> modelscope <span class="hljs-keyword">import</span> AutoModelForCausalLM, AutoTokenizer

model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">"qwen/Qwen2.5-7B"</span>)
<span class="hljs-comment"># å®Œå…¨å…¼å®¹HuggingFace APIï¼Œé€Ÿåº¦æ›´å¿«</span>
</code></pre>
<p><strong>æ–¹æ¡ˆä¸‰ï¼šæå‰ç¼“å­˜</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åœ¨æœ‰ç½‘ç»œæ—¶ä¸‹è½½æ‰€æœ‰ä¾èµ–</span>
<span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> snapshot_download

<span class="hljs-comment"># ä¸‹è½½æ¨¡å‹å’Œæ‰€æœ‰ä¾èµ–</span>
snapshot_download(
    repo_id=<span class="hljs-string">"Qwen/Qwen2.5-7B"</span>,
    local_dir=<span class="hljs-string">"./local_qwen"</span>,
    ignore_patterns=[<span class="hljs-string">"*.msgpack"</span>, <span class="hljs-string">"*.h5"</span>],  <span class="hljs-comment"># è·³è¿‡ä¸å¿…è¦æ–‡ä»¶</span>
)
</code></pre>
<h3 data-id="heading-22">6.2 ä¸­æ–‡ä¼˜åŒ–æ¨¡å‹æ¨è</h3>
<p><strong>é€šç”¨å¯¹è¯</strong>ï¼š</p>
<ul>
<li>Qwenç³»åˆ—ï¼ˆé˜¿é‡Œé€šä¹‰ï¼‰ï¼šä¸­æ–‡ä¼˜åŒ–å¥½ï¼Œå¼€æºåè®®å‹å¥½</li>
<li>ChatGLMç³»åˆ—ï¼ˆæ™ºè°±ï¼‰ï¼šä¸­æ–‡èƒ½åŠ›å¼ºï¼Œæ¨ç†é€Ÿåº¦å¿«</li>
<li>DeepSeekï¼ˆæ·±åº¦æ±‚ç´¢ï¼‰ï¼šæ•°å­¦å’Œæ¨ç†èƒ½åŠ›å¼º</li>
</ul>
<p><strong>æ–‡æœ¬åµŒå…¥</strong>ï¼š</p>
<ul>
<li>BGEç³»åˆ—ï¼ˆæ™ºæºï¼‰ï¼šä¸­æ–‡æ–‡æœ¬åµŒå…¥SOTA</li>
<li>text2vecï¼ˆéƒå¸…ï¼‰ï¼šè½»é‡çº§ï¼Œé€‚åˆéƒ¨ç½²</li>
</ul>
<p><strong>ä»£ç ç”Ÿæˆ</strong>ï¼š</p>
<ul>
<li>DeepSeek-Coderï¼šä¸­æ–‡ä»£ç æ³¨é‡Šç†è§£å¥½</li>
<li>CodeQwenï¼šåŸºäºQwençš„ä»£ç æ¨¡å‹</li>
</ul>
<h3 data-id="heading-23">6.3 åˆè§„ä¸å®‰å…¨ï¼šåœ¨ä¸­å›½åšAIå¿…é¡»è€ƒè™‘çš„</h3>
<p><strong>æ•°æ®ä¸å‡ºå¢ƒ</strong>ï¼šä½¿ç”¨å›½å†…æ¨¡å‹æˆ–æœ¬åœ°éƒ¨ç½²
<strong>å†…å®¹å®¡æ ¸</strong>ï¼šå¢åŠ æ•æ„Ÿè¯è¿‡æ»¤å±‚
<strong>ç”¨æˆ·éšç§</strong>ï¼šå¯¹è¯è®°å½•åŠ å¯†å­˜å‚¨
<strong>å¤‡æ¡ˆè¦æ±‚</strong>ï¼šAIç”Ÿæˆå†…å®¹éœ€æ ‡æ³¨â€œç”±AIç”Ÿæˆâ€</p>
<h2 data-id="heading-24">ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæœªæ¥å±•æœ›â€”â€”HuggingFaceçš„ä¸‹ä¸€ä¸ªäº”å¹´</h2>
<h3 data-id="heading-25">7.1 å¤šæ¨¡æ€ç»Ÿä¸€ï¼šæ–‡æœ¬ã€å›¾åƒã€è¯­éŸ³çš„èåˆ</h3>
<p>å½“å‰çš„å¤šæ¨¡æ€æ¨¡å‹è¿˜æ˜¯â€œæ‹¼å‡‘å¼â€çš„ï¼šæ–‡æœ¬ä¸€ä¸ªæ¨¡å‹ï¼Œå›¾åƒä¸€ä¸ªæ¨¡å‹ï¼Œè¯­éŸ³ä¸€ä¸ªæ¨¡å‹ã€‚æœªæ¥è¶‹åŠ¿æ˜¯<strong>çœŸæ­£çš„å¤šæ¨¡æ€ç»Ÿä¸€æ¨¡å‹</strong>ã€‚</p>
<p>HuggingFaceå·²ç»åœ¨å¸ƒå±€ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æœªæ¥çš„APIå¯èƒ½æ˜¯è¿™æ ·çš„</span>
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> MultiModalModel

model = MultiModalModel.from_pretrained(<span class="hljs-string">"unified-model-v1"</span>)

<span class="hljs-comment"># åŒæ—¶å¤„ç†æ–‡æœ¬ã€å›¾åƒã€è¯­éŸ³</span>
result = model({
    <span class="hljs-string">"text"</span>: <span class="hljs-string">"æè¿°è¿™å¼ å›¾ç‰‡"</span>,
    <span class="hljs-string">"image"</span>: image_data,
    <span class="hljs-string">"audio"</span>: audio_data
})
</code></pre>
<h3 data-id="heading-26">7.2 æ™ºèƒ½ä½“ï¼ˆAgentï¼‰ç”Ÿæ€ï¼šä»å·¥å…·åˆ°åŠ©æ‰‹</h3>
<p>å¤§æ¨¡å‹æœ¬èº«åªæ˜¯â€œå¤§è„‘â€ï¼Œæ™ºèƒ½ä½“æ˜¯â€œå¤§è„‘+æ‰‹è„šâ€ã€‚</p>
<p>HuggingFaceå¯èƒ½ä¼šæ¨å‡ºï¼š</p>
<ul>
<li><strong>å·¥å…·è°ƒç”¨æ ‡å‡†åŒ–</strong>ï¼šç»Ÿä¸€å„APIçš„è°ƒç”¨æ–¹å¼</li>
<li><strong>å·¥ä½œæµç¼–æ’</strong>ï¼šå¯è§†åŒ–æ„å»ºæ™ºèƒ½ä½“æµç¨‹</li>
<li><strong>è®°å¿†ç³»ç»Ÿ</strong>ï¼šé•¿æœŸè®°å¿†å’ŒçŸ­æœŸè®°å¿†ç®¡ç†</li>
<li><strong>è‡ªæˆ‘åæ€</strong>ï¼šæ™ºèƒ½ä½“è¯„ä¼°å’Œæ”¹è¿›è‡ªèº«è¡Œä¸º</li>
</ul>
<h3 data-id="heading-27">7.3 è¾¹ç¼˜AIï¼šè®©å¤§æ¨¡å‹åœ¨æ‰‹æœºä¸Šè¿è¡Œ</h3>
<p>å½“å‰é™åˆ¶ï¼š70Bæ¨¡å‹éœ€è¦8å¼ A100
æœªæ¥è¶‹åŠ¿ï¼šé€šè¿‡æ¨¡å‹å‹ç¼©ã€è’¸é¦ã€ä¸“ç”¨èŠ¯ç‰‡ï¼Œè®©7Bæ¨¡å‹åœ¨æ‰‹æœºä¸Šæµç•…è¿è¡Œ</p>
<p>æŠ€æœ¯è·¯å¾„ï¼š</p>
<ol>
<li><strong>æ¨¡å‹è’¸é¦</strong>ï¼šå¤§æ¨¡å‹â†’å°æ¨¡å‹ï¼Œä¿æŒ90%èƒ½åŠ›</li>
<li><strong>ç¨€ç–åŒ–</strong>ï¼šç§»é™¤ä¸é‡è¦çš„ç¥ç»å…ƒ</li>
<li><strong>ç¡¬ä»¶ååŒ</strong>ï¼šä¸“ç”¨AIèŠ¯ç‰‡ï¼ˆNPUï¼‰æ™®åŠ</li>
</ol>
<h2 data-id="heading-28">ç»“è¯­ï¼šæˆ‘ä»¬æ­£ç«™åœ¨AIæ°‘ä¸»åŒ–çš„æ‹ç‚¹ä¸Š</h2>
<p>å›æœ›AIå‘å±•çš„å†å²ï¼š</p>
<ul>
<li>2012å¹´ï¼ŒAlexNetè®©è®¡ç®—æœºè§†è§‰èµ°å‡ºå®éªŒå®¤</li>
<li>2017å¹´ï¼ŒTransformerè®©è‡ªç„¶è¯­è¨€å¤„ç†è¿æ¥çªç ´</li>
<li>2022å¹´ï¼ŒChatGPTè®©å¤§æ¨¡å‹èµ°è¿›å…¬ä¼—è§†é‡</li>
<li>2024å¹´ï¼Œå¼€æºæ¨¡å‹è®©æŠ€æœ¯ä¸å†è¢«å·¨å¤´å„æ–­</li>
</ul>
<p>è€ŒHuggingFaceï¼Œæ­£æ˜¯åœ¨è¿™ä¸ªå…³é”®æ—¶åˆ»ï¼Œä¸ºæ•´ä¸ªç”Ÿæ€æä¾›äº†åŸºç¡€è®¾æ–½ã€‚</p>
<p>å®ƒåšçš„ä¸æ˜¯æœ€å‰æ²¿çš„ç ”ç©¶ï¼Œä¹Ÿä¸æ˜¯æœ€ç‚«é…·çš„äº§å“ï¼Œè€Œæ˜¯<strong>æœ€åŸºç¡€ã€æœ€å¿…è¦ã€æœ€å®¹æ˜“è¢«å¿½è§†çš„å·¥ç¨‹å·¥ä½œ</strong>ï¼šç»Ÿä¸€æ¥å£ã€æ ‡å‡†åŒ–æµç¨‹ã€å»ºç«‹ç¤¾åŒºã€‚</p>
<p>ç°åœ¨ï¼Œå¤§æ¨¡å‹çš„å£å’å·²ç»ä»â€œèƒ½ä¸èƒ½åšâ€å˜æˆäº†â€œæƒ³ä¸æƒ³åšâ€ã€‚ä»»ä½•ä¸€ä¸ªæœ‰PythonåŸºç¡€çš„å¼€å‘è€…ï¼Œéƒ½èƒ½åœ¨å‡ å¤©å†…æ­å»ºä¸€ä¸ªå¯ç”¨çš„AIåº”ç”¨ã€‚ä»»ä½•ä¸€ä¸ªä¸­å°ä¼ä¸šï¼Œéƒ½èƒ½ç”¨æœ‰é™çš„é¢„ç®—éƒ¨ç½²è‡ªå·±çš„æ™ºèƒ½å®¢æœã€‚</p>
<p>è¿™å°±æ˜¯æŠ€æœ¯æ°‘ä¸»åŒ–çš„åŠ›é‡ï¼šå½“å·¥å…·å˜å¾—è¶³å¤Ÿç®€å•ï¼Œåˆ›é€ åŠ›å°±ä¼šä»ä¸­å¿ƒæµå‘è¾¹ç¼˜ï¼Œä»å·¨å¤´æµå‘å¤§ä¼—ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœä½ è¿˜åœ¨è§‚æœ›ï¼Œè¿˜åœ¨çŠ¹è±«ï¼Œè¿˜åœ¨è§‰å¾—â€œAIç¦»æˆ‘å¾ˆè¿œâ€ï¼Œé‚£ä¹ˆç°åœ¨å°±æ˜¯æœ€å¥½çš„èµ·ç‚¹ã€‚æ‰“å¼€HuggingFaceï¼Œä»ç¬¬ä¸€ä¸ª<code>pipeline()</code>è°ƒç”¨å¼€å§‹ã€‚</p>
<p>å› ä¸ºæœªæ¥ä¸æ˜¯ç­‰æ¥çš„ï¼Œæ˜¯æ„å»ºå‡ºæ¥çš„ã€‚è€Œæ„å»ºæœªæ¥çš„å·¥å…·ï¼Œç°åœ¨å°±åœ¨ä½ æ‰‹ä¸­ã€‚</p>
<blockquote>
<p>æ°´å¹³æœ‰é™ï¼Œè¿˜ä¸èƒ½å†™åˆ°å°½å–„å°½ç¾ï¼Œå¸Œæœ›å¤§å®¶å¤šå¤šäº¤æµï¼Œè·Ÿæ˜¥é‡ä¸€åŒè¿›æ­¥ï¼ï¼ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rust ä¸ dora-rsï¼šåƒé€æ ¸å¿ƒæ¦‚å¿µï¼Œæ‰‹æŠŠæ‰‹æ‰“é€ è·¨è¯­è¨€çš„æœºå™¨äººå®æ—¶æ•°æ®æµåº”ç”¨]]></title>    <link>https://juejin.cn/post/7583898823920369706</link>    <guid>https://juejin.cn/post/7583898823920369706</guid>    <pubDate>2025-12-15T09:09:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583898823920369706" data-draft-id="7582787460418748458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust ä¸ dora-rsï¼šåƒé€æ ¸å¿ƒæ¦‚å¿µï¼Œæ‰‹æŠŠæ‰‹æ‰“é€ è·¨è¯­è¨€çš„æœºå™¨äººå®æ—¶æ•°æ®æµåº”ç”¨"/> <meta itemprop="keywords" content="Rust,äººå·¥æ™ºèƒ½,ç¬”è®°"/> <meta itemprop="datePublished" content="2025-12-15T09:09:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RustçŸ¥è¡Œç¤¾"/> <meta itemprop="url" content="https://juejin.cn/user/4186572019737624"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust ä¸ dora-rsï¼šåƒé€æ ¸å¿ƒæ¦‚å¿µï¼Œæ‰‹æŠŠæ‰‹æ‰“é€ è·¨è¯­è¨€çš„æœºå™¨äººå®æ—¶æ•°æ®æµåº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4186572019737624/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RustçŸ¥è¡Œç¤¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:09:11.000Z" title="Mon Dec 15 2025 09:09:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Rust ä¸ dora-rsï¼šåƒé€æ ¸å¿ƒæ¦‚å¿µï¼Œæ‰‹æŠŠæ‰‹æ‰“é€ è·¨è¯­è¨€çš„æœºå™¨äººå®æ—¶æ•°æ®æµåº”ç”¨</h2>
<blockquote>
<p>åªéœ€ä¸€å¼ <code>YAML</code>è“å›¾ï¼Œå°±èƒ½å°†Pythonçš„çµæ´»ã€Rustçš„æ€§èƒ½ä¸å®æ—¶æ•°æ®æµæ— ç¼ç¼åˆã€‚</p>
</blockquote>
<p>æœºå™¨äººä¸è¾¹ç¼˜ AI å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é•¿æœŸé¢ä¸´ä¸€ä¸ªä¸¤éš¾é€‰æ‹©ï¼šæ˜¯æ‹¥æŠ± Python çš„ç”Ÿæ€ä¾¿åˆ©ï¼Œè¿˜æ˜¯è¿½æ±‚ C++/Rust çš„æè‡´æ€§èƒ½ï¼Ÿåœ¨ä¼ ç»Ÿæ¶æ„ï¼Œç”±äºè·¨è¿›ç¨‹é€šä¿¡ï¼ˆIPCï¼‰çš„åºåˆ—åŒ–å¼€é”€å¾€å¾€æ˜¯å®æ—¶ç³»ç»Ÿçš„å™©æ¢¦ï¼Œå¯¼è‡´äºŒè€…éš¾ä»¥å…¼å¾—ã€‚</p>
<p><strong><code>dora-rs</code></strong> çš„å‡ºç°æ‰“ç ´äº†è¿™ä¸€åƒµå±€ã€‚ä½œä¸ºä¸€ä¸ªåŸºäº Rust çš„æ•°æ®æµæ¡†æ¶ï¼Œå®ƒåˆ©ç”¨ <code>Apache Arrow</code> å®ç° <strong>é›¶æ‹·è´ï¼ˆZero-copyï¼‰</strong> æ¶ˆæ¯ä¼ é€’ï¼Œå®Œç¾ç¼åˆäº† Rust çš„å®‰å…¨æ€§ä¸ Python çš„çµæ´»æ€§ã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥è§£æ„ <code>dora-rs</code> çš„æ ¸å¿ƒæ¶æ„ï¼Œå¹¶å¸¦ä½ æ‰‹å†™ä¸€ä¸ª <strong>â€œRust é‡‡é›† + Rust è¿ç®— + Python å®æ—¶å¯è§†åŒ–â€</strong> çš„å®Œæ•´æ··åˆè¯­è¨€æ•°æ®æµç³»ç»Ÿã€‚</p>
<h3 data-id="heading-1">ä¸€ æ ¸å¿ƒæ¦‚å¿µï¼šç†è§£ <code>dora-rs</code> çš„ä¸–ç•Œè§‚</h3>
<h4 data-id="heading-2">1. æ•°æ®æµè“å›¾ï¼šåº”ç”¨çš„â€œæ–½å·¥å›¾â€</h4>
<p>åœ¨ <code>dora-rs</code> ä¸­ï¼Œåº”ç”¨è¢«æŠ½è±¡ä¸ºä¸€ä¸ªç”±èŠ‚ç‚¹å’Œè¿æ¥æ„æˆçš„<strong>æœ‰å‘æ•°æ®æµå›¾</strong>ã€‚<code>Dataflow</code> æ˜¯åº”ç”¨çš„â€œæ–½å·¥å›¾â€ï¼Œé‡‡ç”¨å£°æ˜å¼çš„ <code>YAML</code> æ ¼å¼å®šä¹‰ï¼Œå®ƒä¸å…³å¿ƒå…·ä½“ä»£ç æ€ä¹ˆå†™ï¼Œåªå…³å¿ƒæ•°æ®ä»å“ªé‡Œæ¥ï¼ˆSourceï¼‰ã€ç»è¿‡è°å¤„ç†ï¼ˆProcessï¼‰ã€æµå‘å“ªé‡Œï¼ˆSinkï¼‰ã€‚è¿™ç§è®¾è®¡è®©ç³»ç»Ÿæ¶æ„ä¸€ç›®äº†ç„¶ï¼Œå½»åº•å‘Šåˆ«äº†å¤æ‚çš„ <code>Launch</code> æ–‡ä»¶åœ°ç‹±ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># æ ¸å¿ƒç»“æ„ï¼šnodes åˆ—è¡¨å®šä¹‰äº†æ‰€æœ‰å¤„ç†å•å…ƒ</span>
<span class="hljs-attr">nodes:</span>
  <span class="hljs-comment"># ä¸€ä¸ªä¼ æ„Ÿå™¨èŠ‚ç‚¹</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">temperature_sensor</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">sensor.py</span>
    <span class="hljs-attr">outputs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">raw_temperature</span>
  <span class="hljs-comment"># ä¸€ä¸ªå¤„ç†èŠ‚ç‚¹</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">data_processor</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">./target/release/processor_node</span>
    <span class="hljs-attr">inputs:</span>
      <span class="hljs-attr">temp:</span> <span class="hljs-string">temperature_sensor/raw_temperature</span> <span class="hljs-comment"># è¿æ¥è‡³æ­¤ï¼</span>
    <span class="hljs-attr">outputs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">smoothed_temperature</span>
</code></pre>
<p><code>inputs</code>ä½¿ç”¨<code>æ¥æºèŠ‚ç‚¹/è¾“å‡ºå</code>çš„æ ¼å¼å»ºç«‹è¿æ¥ï¼Œè¿™ç§å£°æ˜å¼é…ç½®è®©å¤æ‚ç³»ç»Ÿçš„ç»“æ„å’Œæ•°æ®æµå‘<strong>ä¸€ç›®äº†ç„¶</strong>ã€‚</p>
<p>å½“ä½ è¿è¡Œ <code>dora start dataflow.yml</code> æ—¶ï¼Œ<code>dora-rs</code> çš„è¿è¡Œæ—¶ä¾¿ä¼šè¯»å–æ­¤è“å›¾ï¼Œè‡ªåŠ¨å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹è¿›ç¨‹ï¼Œå¹¶æŒ‰ç…§å›¾ç¤ºå»ºç«‹é«˜æ•ˆçš„æ•°æ®é€šé“ã€‚</p>
<h4 data-id="heading-3">2. èŠ‚ç‚¹ä¸æ“ä½œç¬¦ï¼šå·¥äººä¸å·¥å…·ç®±</h4>
<p>è¿™æ˜¯ <code>dora-rs</code> æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ï¼Œå¾ˆå¤šå¼€å‘è€…å®¹æ˜“æ··æ·†ï¼š</p>
<ul>
<li>
<p><strong>Node (èŠ‚ç‚¹)</strong>ï¼šæ˜¯ä¸€ä¸ª<strong>ç‹¬ç«‹çš„ç³»ç»Ÿè¿›ç¨‹</strong>ï¼Œæ‹¥æœ‰å®Œå…¨éš”ç¦»çš„å†…å­˜ç©ºé—´ã€‚å®ƒåƒä¸€åä¸“èŒå·¥äººï¼Œå¯ä»¥å°è£…å®Œæ•´çš„ã€ç‹¬ç«‹çš„æœåŠ¡ï¼Œæˆ–è¿è¡Œæœ‰ç‰¹å®šç¯å¢ƒä¾èµ–ï¼ˆå¦‚Python AIæ¨¡å‹åº“ï¼‰çš„ä»£ç ã€‚èŠ‚ç‚¹é—´é€šä¿¡éœ€è¦è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚</p>
</li>
<li>
<p><strong>Operator (æ“ä½œç¬¦)</strong>ï¼šæ˜¯è¿è¡Œåœ¨<strong>åŒä¸€èŠ‚ç‚¹è¿›ç¨‹å†…</strong>çš„æ¨¡å—åŒ–é€»è¾‘å•å…ƒï¼Œç”¨äºåœ¨ä¸€ç§åä¸º <code>Dora Runtime Node</code> çš„ç‰¹æ®ŠèŠ‚ç‚¹å†…è¿è¡Œã€‚<code>Operator</code> å…è®¸ä½ å°†å•ä¸ªèŠ‚ç‚¹çš„å·¥ä½œåˆ†è§£ä¸ºå¯å¤ç”¨çš„ç‹¬ç«‹æ­¥éª¤ã€‚å®ƒåƒå·¥äººæ‰‹è¾¹çš„ä¸“ç”¨å·¥å…·ã€‚</p>
</li>
</ul>






























<table><thead><tr><th>ç‰¹æ€§</th><th><strong>Node (èŠ‚ç‚¹)</strong></th><th><strong>Operator (æ“ä½œç¬¦)</strong></th></tr></thead><tbody><tr><td><strong>è¿è¡Œæ–¹å¼</strong></td><td>ç‹¬ç«‹è¿›ç¨‹ï¼ˆProcessï¼‰</td><td>å•è¿›ç¨‹</td></tr><tr><td><strong>é€šä¿¡æˆæœ¬</strong></td><td>è·¨è¿›ç¨‹ï¼ˆå…±äº«å†…å­˜ä¼˜åŒ–ï¼‰</td><td>å‡½æ•°è°ƒç”¨çº§å»¶è¿Ÿ</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>è·¨è¯­è¨€æ··ç¼–ã€æ•…éšœéš”ç¦»</td><td>é«˜é¢‘è®¡ç®—ã€æ¨¡å—åŒ–å¤ç”¨</td></tr><tr><td><strong>API</strong></td><td>dora Node API</td><td>dora Operator API</td></tr></tbody></table>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼šå°†æ€§èƒ½ç“¶é¢ˆæ¨¡å—ï¼ˆå¦‚å›¾åƒé¢„å¤„ç†ã€æ§åˆ¶ç®—æ³•ï¼‰å®ç°ä¸ºRustæ“ä½œç¬¦ï¼›å°†ä¾èµ–å¤æ‚ç”Ÿæ€ï¼ˆå¦‚PyTorchï¼‰çš„éƒ¨åˆ†å®ç°ä¸ºPythonèŠ‚ç‚¹ã€‚</p>
<h4 data-id="heading-4">3. äº‹ä»¶æµï¼šæ°¸ä¸é˜»å¡çš„â€œæ”¶ä»¶ç®±â€</h4>
<p>èŠ‚ç‚¹æˆ–æ“ä½œç¬¦å¦‚ä½•æ„ŸçŸ¥æ–°æ•°æ®ï¼Ÿç­”æ¡ˆæ˜¯é€šè¿‡<strong>äº‹ä»¶æµ</strong>ã€‚è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥é€šé“ï¼Œ<code>dora-rs</code> è¿è¡Œæ—¶ä¼šå‘èŠ‚ç‚¹æ¨é€å„ç±»äº‹ä»¶ï¼Œä½ çš„ä»£ç åªéœ€å¾ªç¯ç›‘å¬å¹¶å¤„ç†ã€‚</p>
<p><strong>äº”å¤§æ ¸å¿ƒäº‹ä»¶ç±»å‹ï¼š</strong></p>
<p><strong>Rustäº‹ä»¶å¾ªç¯æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// Rustäº‹ä»¶å¤„ç†æ¨¡å¼</span>
<span class="hljs-keyword">let</span> (<span class="hljs-keyword">mut</span> node, <span class="hljs-keyword">mut</span> events) = DoraNode::<span class="hljs-title function_ invoke__">init_from_env</span>()?;
<span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(event) = events.<span class="hljs-title function_ invoke__">recv</span>() {
    <span class="hljs-keyword">match</span> event {
        Event::Input { id, data, metadata } =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ”¶åˆ°è¾“å…¥: {}, æ•°æ®å¤§å°: {}"</span>, id, data.<span class="hljs-title function_ invoke__">len</span>());
            <span class="hljs-comment">// ...ä¸šåŠ¡é€»è¾‘...</span>
        }
        Event::InputClosed { id } =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ä¸Šæ¸¸èŠ‚ç‚¹å…³é—­: {}"</span>, id);  <span class="hljs-comment">// å¤„ç†æ–­è¿</span>
        }
        Event::Stop =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ”¶åˆ°åœæ­¢ä¿¡å·"</span>); <span class="hljs-keyword">break</span>;    <span class="hljs-comment">// ä¼˜é›…é€€å‡º</span>
        }
        Event::Reload =&gt; { <span class="hljs-comment">/* çƒ­æ›´æ–°é…ç½® */</span> }
        Event::Error { id, error } =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"èŠ‚ç‚¹ {} å‘ç”Ÿé”™è¯¯: {:?}"</span>, id, error);
        }
    }
}
</code></pre>
<p><strong>Pythonäº‹ä»¶å¾ªç¯æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dora <span class="hljs-keyword">import</span> Node

<span class="hljs-comment"># Initialize the node - connects to the dora runtime</span>
node = Node() 
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Node initialized. Waiting for events..."</span>)

<span class="hljs-comment"># Enter the loop to process events from the stream</span>
<span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> node: 
    event_type = event[<span class="hljs-string">"type"</span>]
    event_id = event[<span class="hljs-string">"id"</span>] <span class="hljs-comment"># Often the input ID</span>

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Received event: Type=<span class="hljs-subst">{event_type}</span>, ID=<span class="hljs-subst">{event_id}</span>"</span>)

    <span class="hljs-keyword">if</span> event_type == <span class="hljs-string">"INPUT"</span>:
        <span class="hljs-comment"># Handle incoming data</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  -&gt; Data received on input '<span class="hljs-subst">{event_id}</span>'"</span>)
        data = event[<span class="hljs-string">"value"</span>] 
        <span class="hljs-comment"># Now you would process the 'data'...</span>
        
        <span class="hljs-comment"># Example: If it's from an input named 'camera_image'</span>
        <span class="hljs-keyword">if</span> event_id == <span class="hljs-string">"camera_image"</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"  -&gt; Processing camera image..."</span>)
            <span class="hljs-comment"># process_image(data)</span>
            <span class="hljs-comment"># node.send_output(...) # Send results if needed</span>
            <span class="hljs-keyword">pass</span> <span class="hljs-comment"># Placeholder for actual processing</span>

    <span class="hljs-keyword">elif</span> event_type == <span class="hljs-string">"STOP"</span>:
        <span class="hljs-comment"># Handle stop command</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"  -&gt; Received STOP command. Exiting loop."</span>)
        <span class="hljs-keyword">break</span> <span class="hljs-comment"># Exit the main loop</span>

    <span class="hljs-keyword">elif</span> event_type == <span class="hljs-string">"InputClosed"</span>:
        <span class="hljs-comment"># Handle input closing</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  -&gt; Input '<span class="hljs-subst">{event_id}</span>' closed."</span>)
        <span class="hljs-comment"># Decide if the node should continue or stop</span>

    <span class="hljs-keyword">elif</span> event_type == <span class="hljs-string">"RELOAD"</span>:
        <span class="hljs-comment"># Handle reload command</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"  -&gt; Received RELOAD command."</span>)
        <span class="hljs-comment"># Reload configuration if implemented</span>

    <span class="hljs-keyword">elif</span> event_type == <span class="hljs-string">"ERROR"</span>:
        <span class="hljs-comment"># Handle a stream error</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  -&gt; Received ERROR: <span class="hljs-subst">{event[<span class="hljs-string">'error'</span>]}</span>"</span>)
        <span class="hljs-comment"># Log or react to the error</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"Node stopping gracefully."</span>)
</code></pre>
<h4 data-id="heading-5">4. Arrow Dataï¼šé›¶æ‹·è´çš„é­”æ³•</h4>
<p>å¤„ç†å›¾åƒã€ç‚¹äº‘æ—¶ï¼Œå¤åˆ¶æ•°æ®æ€§èƒ½è‡´å‘½ã€‚<code>dora-rs</code> ç”¨<strong>Apache Arrow</strong>å®ç°<strong>é›¶æ‹·è´</strong>ä¼ è¾“â€”â€”æ•°æ®å­˜åœ¨<strong>å…±äº«å†…å­˜</strong>ï¼Œæ‰€æœ‰èŠ‚ç‚¹ç›´æ¥è¯»å–ï¼Œæ— éœ€åºåˆ—åŒ–ã€‚</p>
<p><strong>Arrow</strong> å®šä¹‰äº†ä¸€ç§æ ‡å‡†åŒ–çš„<strong>å†…å­˜ä¸­åˆ—å¼æ•°æ®æ ¼å¼</strong>ã€‚å…³é”®åœ¨äºï¼Œå½“æ•°æ®å¤§å°è¶…è¿‡ <strong>4KB</strong> é˜ˆå€¼æ—¶ï¼Œ<code>dora-rs</code> ä¼šå°†å…¶æ”¾å…¥<strong>å…±äº«å†…å­˜</strong>ã€‚å‘é€æ–¹å†™å…¥ï¼Œæ¥æ”¶æ–¹ç›´æ¥è¯»å–åŒä¸€å—å†…å­˜ï¼Œ<strong>å®ç°çœŸæ­£çš„é›¶æ‹·è´</strong>ã€‚</p>
<ul>
<li><strong>å…±äº«å†…å­˜</strong>ï¼šå¤§äº <code>4KB</code> çš„æ•°æ®è‡ªåŠ¨èµ°å…±äº«å†…å­˜ã€‚</li>
<li><strong>Drop Token</strong>ï¼šæ™ºèƒ½çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œç¡®ä¿æ‰€æœ‰æ¥æ”¶æ–¹è¯»å®Œæ•°æ®åï¼Œå†…å­˜æ‰ä¼šé‡Šæ”¾ã€‚</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># PythonèŠ‚ç‚¹å‘é€Arrowæ•°æ®ï¼ˆé›¶æ‹·è´ï¼‰</span>
<span class="hljs-keyword">import</span> pyarrow <span class="hljs-keyword">as</span> pa
<span class="hljs-keyword">from</span> dora <span class="hljs-keyword">import</span> Node

node = Node()
<span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªåŒ…å«æ¸©åº¦å€¼çš„Arrowæ•°ç»„</span>
temperature_data = pa.array([<span class="hljs-number">25.7</span>], <span class="hljs-built_in">type</span>=pa.float32())
<span class="hljs-comment"># å‘é€æ—¶ï¼Œdoraè‡ªåŠ¨å¤„ç†å…±äº«å†…å­˜åˆ†é…</span>
node.send_output(<span class="hljs-string">"temperature"</span>, temperature_data)
</code></pre>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// RustèŠ‚ç‚¹æ¥æ”¶å¹¶å¤„ç†åŒæ ·çš„Arrowæ•°æ®</span>
<span class="hljs-keyword">use</span> arrow::array::Float32Array;

<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Event</span>::Input { data, .. } = event {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">array</span>: &amp;Float32Array = data.<span class="hljs-title function_ invoke__">as_any</span>().<span class="hljs-title function_ invoke__">downcast_ref</span>().<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">temp</span> = array.<span class="hljs-title function_ invoke__">value</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// ç›´æ¥è®¿é—®å†…å­˜ï¼Œæ— æ‹·è´ï¼</span>
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Received temperature: {}"</span>, temp);
}
</code></pre>
<h4 data-id="heading-6">5ï¸. å¤šè¯­è¨€APIç»‘å®šï¼šå…¨å®¶æ¡¶æ”¯æŒ</h4>
<p>dora-rsæä¾›Rustã€Pythonã€C/C++åŸç”ŸAPIï¼Œé£æ ¼è´´åˆå„è‡ªè¯­è¨€ä¹ æƒ¯ã€‚</p>
<p><strong>Rust API</strong>ï¼ˆç±»å‹å®‰å…¨ï¼Œæ€§èƒ½å¤©èŠ±æ¿ï¼‰ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> (<span class="hljs-keyword">mut</span> node, <span class="hljs-keyword">mut</span> events) = DoraNode::<span class="hljs-title function_ invoke__">init_from_env</span>()?;

<span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(event) = events.<span class="hljs-title function_ invoke__">recv</span>() {
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Event</span>::Input { data, metadata } = event {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">array</span>: Float32Array = data.<span class="hljs-title function_ invoke__">as_any</span>().<span class="hljs-title function_ invoke__">downcast_ref</span>()?;
        node.<span class="hljs-title function_ invoke__">send_output</span>(<span class="hljs-string">"result"</span>, metadata.parameters, processed_array)?;
    }
}
</code></pre>
<p><strong>Python API</strong>ï¼ˆç®€æ´é«˜æ•ˆï¼ŒAIé¦–é€‰ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dora <span class="hljs-keyword">import</span> Node
<span class="hljs-keyword">import</span> pyarrow <span class="hljs-keyword">as</span> pa

node = Node()
<span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> node:
    <span class="hljs-keyword">if</span> event[<span class="hljs-string">"type"</span>] == <span class="hljs-string">"INPUT"</span>:
        array = event[<span class="hljs-string">"value"</span>]  <span class="hljs-comment"># è‡ªåŠ¨è½¬ä¸ºpyarrow.Array</span>
        node.send_output(<span class="hljs-string">"result"</span>, pa.array(processed))
</code></pre>
<p><strong>C++ API</strong>ï¼ˆåº•å±‚æ§åˆ¶ï¼‰ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp">
<span class="hljs-keyword">auto</span> dora_node = <span class="hljs-built_in">init_dora_node</span>();

<span class="hljs-keyword">while</span> (<span class="hljs-keyword">auto</span> event = dora_node.events-&gt;<span class="hljs-built_in">next</span>()) {
    <span class="hljs-keyword">auto</span> type = <span class="hljs-built_in">event_type</span>(event);
    <span class="hljs-keyword">if</span>(type == DoraEventType::Input)
    {
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ArrowArray</span> c_array;
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ArrowSchema</span> c_schema;

        <span class="hljs-keyword">auto</span> result = <span class="hljs-built_in">event_as_arrow_input</span>(
        std::<span class="hljs-built_in">move</span>(event),
        <span class="hljs-built_in">reinterpret_cast</span>(&amp;c_array),
        <span class="hljs-built_in">reinterpret_cast</span>(&amp;c_schema)
        );

        <span class="hljs-keyword">if</span> (!result.error.<span class="hljs-built_in">empty</span>()) {
            std::cerr &lt;&lt; <span class="hljs-string">"Error getting Arrow array: "</span> &lt;&lt; result.error &lt;&lt; std::endl;
            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
        }

        <span class="hljs-keyword">auto</span> result2 = arrow::<span class="hljs-built_in">ImportArray</span>(&amp;c_array, &amp;c_schema);
        <span class="hljs-keyword">if</span> (!result2.<span class="hljs-built_in">ok</span>()) {
            std::cerr &lt;&lt; <span class="hljs-string">"Error importing Arrow array: "</span> &lt;&lt; result2.<span class="hljs-built_in">status</span>().<span class="hljs-built_in">ToString</span>() &lt;&lt; std::endl;
            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
        }
        std::shared_ptr input_array = result2.<span class="hljs-built_in">ValueOrDie</span>();

        <span class="hljs-comment">// Now you can use input_array with Arrow's API</span>
    }
}
</code></pre>
<h4 data-id="heading-7">6ï¸. CLIï¼šæŒ‡æŒ¥ä¸­å¿ƒä¸‰å‰‘å®¢</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ„å»ºä¾èµ–ï¼ˆè§£æYAMLï¼Œè‡ªåŠ¨å®‰è£…/ç¼–è¯‘ï¼‰</span>
dora build pipeline.yml

<span class="hljs-comment"># å¯åŠ¨Daemonå’ŒCoordinator ï¼ˆå¦‚æœä¹‹å‰æ²¡å¯åŠ¨ï¼‰</span>
dora up

<span class="hljs-comment"># è¿è¡Œæ•°æ®æµ</span>
dora start pipeline.yml

<span class="hljs-comment"># æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</span>
dora list

<span class="hljs-comment"># åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„Dataflow</span>
dora destroy <span class="hljs-comment"># ä¸€é”®å…¨åœ</span>
</code></pre>
<h4 data-id="heading-8">7ï¸. Daemon &amp; Coordinatorï¼šå¹•åå…„å¼Ÿè¿</h4>
<ul>
<li><strong>Daemonï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰</strong>ï¼šå•æœºçš„"è½¦é—´ä¸»ä»»"ï¼Œç®¡ç†æœ¬åœ°èŠ‚ç‚¹ã€åˆ†é…å…±äº«å†…å­˜ã€ç›‘æ§è¿›ç¨‹å¥åº·ã€å¤„ç†æœ¬åœ°é€šä¿¡ã€‚</li>
<li><strong>Coordinatorï¼ˆåè°ƒå™¨ï¼‰</strong>ï¼šåˆ†å¸ƒå¼çš„"æ€»ç»ç†"ï¼Œåè°ƒå¤šæœºDaemonã€ç®¡ç†è·¨ç½‘ç»œè·¯ç”±ã€ç»´æŠ¤å…¨å±€çŠ¶æ€ã€‚</li>
</ul>
<p><strong>å•æœºæ¨¡å¼</strong>ï¼š<code>CLI â†’ Daemon â†’ Nodes</code><br/>
<strong>åˆ†å¸ƒå¼æ¨¡å¼</strong>ï¼š<code>CLI â†’ Coordinator â†’ å¤šDaemon â†’ Nodes</code></p>
<hr/>
<h3 data-id="heading-9">äºŒ å®æˆ˜ï¼šæ„å»ºæ··åˆè¯­è¨€çš„æ¸©åº¦ç›‘æ§ç³»ç»Ÿ</h3>
<p>é€šè¿‡æ¨¡æ‹Ÿæ¸©åº¦ä¼ æ„Ÿå™¨ã€æ•°æ®å¤„ç†ã€å¼‚å¸¸æ£€æµ‹ã€æ—¥å¿—è®°å½•å’Œå¯è§†åŒ–ï¼Œå±•ç¤º <code>dora-rs</code> çš„å¤šè¯­è¨€ã€é›¶æ‹·è´ã€åˆ†å¸ƒå¼èƒ½åŠ›ã€‚ä½¿ç”¨ rust èŠ‚ç‚¹å®ç°æ¸©åº¦ä¼ æ„Ÿå™¨ã€æ•°æ®å¤„ç†ã€å¼‚å¸¸æ£€æµ‹ï¼Œpython èŠ‚ç‚¹å®ç°å®æ—¶å¯è§†åŒ–ã€‚</p>
<h4 data-id="heading-10">é¡¹ç›®ç»“æ„</h4>
<pre><code class="hljs language-bash" lang="bash">dora-temp-monitor-rust/
â”œâ”€â”€ sensor-node/          <span class="hljs-comment"># Rust æ¸©åº¦ä¼ æ„Ÿå™¨æ¨¡æ‹ŸèŠ‚ç‚¹</span>
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/main.rs
â”œâ”€â”€ processor-node/       <span class="hljs-comment"># Rust æ•°æ®å¤„ç†å’Œå¼‚å¸¸æ£€æµ‹èŠ‚ç‚¹</span>
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/main.rs
â”œâ”€â”€ logger-node/          <span class="hljs-comment"># Rust æ—¥å¿—å’Œç»ˆç«¯å¯è§†åŒ–èŠ‚ç‚¹</span>
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/main.rs
â”œâ”€â”€ visualizer-node/      <span class="hljs-comment"># Python å¯è§†åŒ–èŠ‚ç‚¹</span>
â”‚   â”œâ”€â”€ .venv/
â”‚   â””â”€â”€ visualizer_node/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ __main__.py
â”‚   â”‚   â””â”€â”€ main.py
â”‚   â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ dataflow.yml          <span class="hljs-comment"># Dora æ•°æ®æµé…ç½®æ–‡ä»¶</span>
â””â”€â”€ Cargo.toml            <span class="hljs-comment"># Rust é¡¹ç›®ä¾èµ–ç®¡ç†</span>
</code></pre>
<h4 data-id="heading-11">1. åˆ›å»ºé¡¹ç›®</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºé¡¹ç›®, rustè¯­è¨€</span>
dora new --lang rust dora-temp-monitor-rust

<span class="hljs-comment"># åˆ é™¤é»˜è®¤åˆ›å»ºçš„èŠ‚ç‚¹</span>
<span class="hljs-built_in">rm</span> -rf listener_1 talker_1 talker_2

<span class="hljs-comment"># åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ - æ¸©åº¦ä¼ æ„Ÿå™¨æ¨¡æ‹ŸèŠ‚ç‚¹</span>
dora new --kind node  --lang rust sensor-node
<span class="hljs-comment"># Created new Rust custom node `sensor-node` at ./sensor-node</span>

<span class="hljs-comment"># åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ - æ•°æ®å¤„ç†å’Œå¼‚å¸¸æ£€æµ‹èŠ‚ç‚¹</span>
dora new --kind node  --lang rust processor-node
<span class="hljs-comment"># Created new Rust custom node `processor-node` at ./processor-node</span>
<span class="hljs-comment"># åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ - æ—¥å¿—è®°å½•å’Œç»ˆç«¯å¯è§†åŒ–èŠ‚ç‚¹</span>
dora new --kind node  --lang rust logger-node
<span class="hljs-comment"># Created new Rust custom node `logger-node` at ./logger-node</span>

<span class="hljs-comment"># åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ - Pythonå¯è§†åŒ–èŠ‚ç‚¹</span>
dora new --kind node  --lang python visualizer-node
<span class="hljs-comment"># Created new Python custom node `visualizer-node` at ./visualizer-node</span>
</code></pre>
<h4 data-id="heading-12">2. å®‰è£…uv</h4>
<p>uv æ˜¯æ–°ä¸€ä»£ Python åŒ…ç®¡ç†å™¨</p>
<pre><code class="hljs language-bash" lang="bash">cargo install uv
</code></pre>
<h4 data-id="heading-13">3. ç¼–å†™æ¸©åº¦æ¨¡æ‹Ÿä¼ æ„Ÿå™¨èŠ‚ç‚¹</h4>
<p>é€šè¿‡ <code>rand</code> crate æ¨¡æ‹Ÿæ¸©åº¦æ•°æ®, å¹¶æ·»åŠ æ­£å¼¦è¶‹åŠ¿æ¨¡æ‹ŸçœŸå®ç¯å¢ƒå˜åŒ–ã€‚</p>
<p><strong><code>sensor-node/Cargo.toml</code></strong>ï¼š</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[package]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"sensor_node"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">edition</span> = <span class="hljs-string">"2021"</span>

<span class="hljs-comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span>

<span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">dora-node-api</span> = <span class="hljs-string">"0.3.13"</span>
<span class="hljs-attr">anyhow</span> = <span class="hljs-string">"1.0"</span>
<span class="hljs-attr">rand</span> = <span class="hljs-string">"0.9.2"</span>
</code></pre>
<p><strong><code>sensor-node/src/main.rs</code></strong>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> dora_node_api::{arrow::array::Float32Array, dora_core::config::DataId, DoraNode, Event};
<span class="hljs-keyword">use</span> rand::Rng;
<span class="hljs-keyword">use</span> std::error::Error;
<span class="hljs-keyword">use</span> std::time::Instant;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt; {
    <span class="hljs-keyword">let</span> (<span class="hljs-keyword">mut</span> node, <span class="hljs-keyword">mut</span> events) = DoraNode::<span class="hljs-title function_ invoke__">init_from_env</span>()?;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">output</span> = DataId::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"temp_raw"</span>.<span class="hljs-title function_ invoke__">to_owned</span>());
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ğŸŒ¡ï¸ ä¼ æ„Ÿå™¨èŠ‚ç‚¹å¯åŠ¨ (M1 Proä¼˜åŒ–ç‰ˆ)"</span>);

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">rng</span> = rand::<span class="hljs-title function_ invoke__">rng</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">start</span> = Instant::<span class="hljs-title function_ invoke__">now</span>();

    <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(event) = events.<span class="hljs-title function_ invoke__">recv</span>() {
        <span class="hljs-comment">// println!("Received event: {:?}", event);</span>
        <span class="hljs-keyword">match</span> event {
            Event::Input {
                id,
                metadata,
                data: _,
            } =&gt; <span class="hljs-keyword">match</span> id.<span class="hljs-title function_ invoke__">as_str</span>() {
                <span class="hljs-string">"tick"</span> =&gt; {
                    <span class="hljs-comment">// æ¨¡æ‹Ÿå¸¦å™ªå£°çš„æ¸©åº¦æ•°æ®</span>
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">temp</span> = <span class="hljs-number">25.0</span>
                        + rng.<span class="hljs-title function_ invoke__">random_range</span>(-<span class="hljs-number">5.0</span>..<span class="hljs-number">5.0</span>)
                        + (start.<span class="hljs-title function_ invoke__">elapsed</span>().<span class="hljs-title function_ invoke__">as_secs_f32</span>() * <span class="hljs-number">0.01</span>).<span class="hljs-title function_ invoke__">sin</span>() * <span class="hljs-number">3.0</span>; <span class="hljs-comment">// æ·»åŠ æ­£å¼¦è¶‹åŠ¿</span>

                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">temp_array</span> = Float32Array::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-built_in">vec!</span>[temp]);

                    node.<span class="hljs-title function_ invoke__">send_output</span>(output.<span class="hljs-title function_ invoke__">clone</span>(), metadata.parameters, temp_array)?;
                }
                other =&gt; eprintln!(<span class="hljs-string">"Received input `{other}`"</span>),
            },
            _ =&gt; {}
        }
    }

    <span class="hljs-title function_ invoke__">Ok</span>(())
}

</code></pre>
<h4 data-id="heading-14">4. ç¼–å†™æ•°æ®å¤„ç†å’Œå¼‚å¸¸æ£€æµ‹èŠ‚ç‚¹</h4>
<p>é€šè¿‡æ»‘åŠ¨çª—å£è®¡ç®—æ¸©åº¦å¹³æ»‘å€¼, å¹¶æ£€æµ‹å¼‚å¸¸å€¼ï¼ˆè¶…è¿‡é˜ˆå€¼çš„çªå˜ï¼‰ã€‚</p>
<p><strong><code>processor-node/Cargo.toml</code></strong>ï¼š</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[package]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"processor_node"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">edition</span> = <span class="hljs-string">"2021"</span>

<span class="hljs-comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span>

<span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">dora-node-api</span> = <span class="hljs-string">"0.3.13"</span>
<span class="hljs-attr">anyhow</span> = <span class="hljs-string">"1.0"</span>

</code></pre>
<p><strong><code>processor-node/src/main.rs</code></strong>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> dora_node_api::{
    arrow::array::{Float32Array, StringArray},
    dora_core::config::DataId,
    DoraNode, Event,
};
<span class="hljs-keyword">use</span> std::collections::VecDeque;
<span class="hljs-keyword">use</span> std::error::Error;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">TemperatureProcessor</span> {
    window: VecDeque&lt;<span class="hljs-type">f32</span>&gt;,
    threshold: <span class="hljs-type">f32</span>, <span class="hljs-comment">// å¼‚å¸¸é˜ˆå€¼</span>
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">TemperatureProcessor</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(window_size: <span class="hljs-type">usize</span>, threshold: <span class="hljs-type">f32</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> {
            window: VecDeque::<span class="hljs-title function_ invoke__">with_capacity</span>(window_size),
            threshold,
        }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">process</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, temp: <span class="hljs-type">f32</span>) <span class="hljs-punctuation">-&gt;</span> (<span class="hljs-type">f32</span>, <span class="hljs-type">Option</span>&lt;<span class="hljs-type">String</span>&gt;) {
        <span class="hljs-keyword">self</span>.window.<span class="hljs-title function_ invoke__">push_back</span>(temp);
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.window.<span class="hljs-title function_ invoke__">len</span>() &gt; <span class="hljs-number">10</span> {
            <span class="hljs-keyword">self</span>.window.<span class="hljs-title function_ invoke__">pop_front</span>();
        }

        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">avg</span> = <span class="hljs-keyword">self</span>.window.<span class="hljs-title function_ invoke__">iter</span>().sum::&lt;<span class="hljs-type">f32</span>&gt;() / <span class="hljs-keyword">self</span>.window.<span class="hljs-title function_ invoke__">len</span>() <span class="hljs-keyword">as</span> <span class="hljs-type">f32</span>;

        <span class="hljs-comment">// å¼‚å¸¸æ£€æµ‹é€»è¾‘</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">alert</span> = <span class="hljs-title function_ invoke__">if</span> (temp - avg).<span class="hljs-title function_ invoke__">abs</span>() &gt; <span class="hljs-keyword">self</span>.threshold {
            <span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-built_in">format!</span>(
                <span class="hljs-string">"âš ï¸ æ¸©åº¦çªå˜: {:.1}Â°C (åç¦»å‡å€¼{:.1}Â°C)"</span>,
                temp,
                (temp - avg).<span class="hljs-title function_ invoke__">abs</span>()
            ))
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-literal">None</span>
        };

        (avg, alert)
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt; {
    <span class="hljs-keyword">let</span> (<span class="hljs-keyword">mut</span> node, <span class="hljs-keyword">mut</span> events) = DoraNode::<span class="hljs-title function_ invoke__">init_from_env</span>()?;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">output_temp_smoothed</span> = DataId::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"temp_smoothed"</span>.<span class="hljs-title function_ invoke__">to_owned</span>());
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">output_temp_alert</span> = DataId::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"temp_smootemp_alertthed"</span>.<span class="hljs-title function_ invoke__">to_owned</span>());
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ğŸ§® å¤„ç†å™¨èŠ‚ç‚¹å¯åŠ¨ (æ»‘åŠ¨çª—å£+å¼‚å¸¸æ£€æµ‹)"</span>);

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">processor</span> = TemperatureProcessor::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">10</span>, <span class="hljs-number">3.0</span>);

    <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(event) = events.<span class="hljs-title function_ invoke__">recv</span>() {
        <span class="hljs-keyword">match</span> event {
            Event::Input { id, metadata, data } =&gt; <span class="hljs-keyword">match</span> id.<span class="hljs-title function_ invoke__">as_str</span>() {
                <span class="hljs-string">"temp"</span> =&gt; {
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">array</span> = data
                        .<span class="hljs-title function_ invoke__">as_any</span>()
                        .downcast_ref::&lt;Float32Array&gt;()
                        .<span class="hljs-title function_ invoke__">ok_or</span>(<span class="hljs-string">"ç±»å‹è½¬æ¢å¤±è´¥"</span>)?;
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">temp</span> = array.<span class="hljs-title function_ invoke__">value</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">as</span> <span class="hljs-type">f32</span>;

                    <span class="hljs-keyword">let</span> (avg, alert) = processor.<span class="hljs-title function_ invoke__">process</span>(temp);

                    <span class="hljs-comment">// å‘é€å¹³æ»‘æ•°æ®</span>
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">avg_array</span> = Float32Array::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-built_in">vec!</span>[avg]);
                    node.<span class="hljs-title function_ invoke__">send_output</span>(
                        output_temp_smoothed.<span class="hljs-title function_ invoke__">clone</span>(),
                        metadata.parameters.<span class="hljs-title function_ invoke__">clone</span>(),
                        avg_array,
                    )?;

                    <span class="hljs-comment">// å¦‚æœæœ‰å¼‚å¸¸ï¼Œå‘é€è­¦æŠ¥</span>
                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(alert_msg) = alert {
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">alert_array</span> = StringArray::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-built_in">vec!</span>[alert_msg]);
                        node.<span class="hljs-title function_ invoke__">send_output</span>(
                            output_temp_alert.<span class="hljs-title function_ invoke__">clone</span>(),
                            metadata.parameters,
                            alert_array,
                        )?;
                    }
                }
                _ =&gt; {}
            },
            _ =&gt; {}
        }
    }

    <span class="hljs-title function_ invoke__">Ok</span>(())
}

</code></pre>
<h4 data-id="heading-15">5. æ—¥å¿—èŠ‚ç‚¹ï¼ˆç»ˆç«¯å¯è§†åŒ–ï¼‰</h4>
<p>é€šè¿‡æ»‘åŠ¨çª—å£è®¡ç®—çš„å¹³æ»‘æ¸©åº¦å€¼, åœ¨ç»ˆç«¯å®æ—¶æ˜¾ç¤ºæŸ±çŠ¶å›¾, å¼‚å¸¸å€¼åˆ™ä»¥æ–‡æœ¬å½¢å¼æç¤ºã€‚</p>
<p><strong><code>logger-node/Cargo.toml</code></strong>ï¼š</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[package]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"logger_node"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">edition</span> = <span class="hljs-string">"2021"</span>

<span class="hljs-comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span>

<span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">dora-node-api</span> = <span class="hljs-string">"0.3.13"</span>
<span class="hljs-attr">anyhow</span> = <span class="hljs-string">"1.0"</span>

</code></pre>
<p><strong><code>logger-node/src/main.rs</code></strong>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> dora_node_api::{
    arrow::array::{Float32Array, StringArray},
    DoraNode, Event,
};
<span class="hljs-keyword">use</span> std::error::Error;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt; {
    <span class="hljs-keyword">let</span> (<span class="hljs-keyword">mut</span> _node, <span class="hljs-keyword">mut</span> events) = DoraNode::<span class="hljs-title function_ invoke__">init_from_env</span>()?;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ—¥å¿—èŠ‚ç‚¹å¯åŠ¨"</span>);
    <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(event) = events.<span class="hljs-title function_ invoke__">recv</span>() {
        <span class="hljs-keyword">match</span> event {
            Event::Input {
                id,
                metadata: _,
                data,
            } =&gt; <span class="hljs-keyword">match</span> id.<span class="hljs-title function_ invoke__">as_str</span>() {
                <span class="hljs-string">"smoothed"</span> =&gt; {
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">array</span> = data
                        .<span class="hljs-title function_ invoke__">as_any</span>()
                        .downcast_ref::&lt;Float32Array&gt;()
                        .<span class="hljs-title function_ invoke__">ok_or</span>(<span class="hljs-string">"è½¬æ¢å¤±è´¥"</span>)?;
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">temp</span> = array.<span class="hljs-title function_ invoke__">value</span>(<span class="hljs-number">0</span>);

                    <span class="hljs-comment">// ç»ˆç«¯æŸ±çŠ¶å›¾ï¼ˆM1ç»ˆç«¯æ€§èƒ½å¼ºåŠ²ï¼‰</span>
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">bar</span> = <span class="hljs-string">"â–ˆ"</span>.<span class="hljs-title function_ invoke__">repeat</span>((temp * <span class="hljs-number">2.0</span>) <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>);
                    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"\r[{:4.1}Â°C] {}"</span>, temp, bar);
                }
                <span class="hljs-string">"alert"</span> =&gt; {
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">array</span> = data
                        .<span class="hljs-title function_ invoke__">as_any</span>()
                        .downcast_ref::&lt;StringArray&gt;()
                        .<span class="hljs-title function_ invoke__">ok_or</span>(<span class="hljs-string">"è½¬æ¢å¤±è´¥"</span>)?;
                    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"\nğŸš¨ {}"</span>, array.<span class="hljs-title function_ invoke__">value</span>(<span class="hljs-number">0</span>));
                }
                other =&gt; eprintln!(<span class="hljs-string">"Loggerï¼š Received input `{}`"</span>, other),
            },
            _ =&gt; {}
        }
    }

    <span class="hljs-title function_ invoke__">Ok</span>(())
}

</code></pre>
<h4 data-id="heading-16">6. ç¼–å†™å¯è§†åŒ–èŠ‚ç‚¹ï¼ˆå®æ—¶å¯è§†åŒ–ï¼‰</h4>
<p>é€šè¿‡ <code>python</code> çš„ <code>matplotlib</code> åº“, å®ç°å®æ—¶æ¸©åº¦æŸ±çŠ¶å›¾å¯è§†åŒ–ï¼Œé€šè¿‡ <code>uv</code> æ¥ç®¡ç† <code>python</code> ä¾èµ–ã€‚</p>
<p><strong><code>visualizer-node/pyproject.toml</code></strong>ï¼š</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[project]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"visualizer-node"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.0.0"</span>
<span class="hljs-attr">authors</span> = [{ name = <span class="hljs-string">"Your Name"</span>, email = <span class="hljs-string">"email@email.com"</span> }]
<span class="hljs-attr">description</span> = <span class="hljs-string">"visualizer-node"</span>
<span class="hljs-attr">license</span> = { text = <span class="hljs-string">"MIT"</span> }
<span class="hljs-attr">readme</span> = <span class="hljs-string">"README.md"</span>
<span class="hljs-attr">requires-python</span> = <span class="hljs-string">"&gt;=3.8"</span>

<span class="hljs-attr">dependencies</span> = [
    <span class="hljs-string">"dora-rs &gt;= 0.3.9"</span>,
    <span class="hljs-string">"matplotlib&gt;=3.7.5"</span>,
    <span class="hljs-string">"pyarrow&gt;=22.0.0"</span>
]

<span class="hljs-section">[dependency-groups]</span>
<span class="hljs-attr">dev</span> = [<span class="hljs-string">"pytest &gt;=8.1.1"</span>, <span class="hljs-string">"ruff &gt;=0.9.1"</span>]

<span class="hljs-section">[tool.uv.sources]</span>
<span class="hljs-attr">default</span> = [
    { url = <span class="hljs-string">"https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple"</span> }
]

<span class="hljs-section">[project.scripts]</span>
<span class="hljs-attr">visualizer-node</span> = <span class="hljs-string">"visualizer_node.main:main"</span>

<span class="hljs-section">[tool.ruff.lint]</span>
<span class="hljs-attr">extend-select</span> = [
  <span class="hljs-string">"D"</span>,   <span class="hljs-comment"># pydocstyle</span>
  <span class="hljs-string">"UP"</span>
]

</code></pre>
<p><strong><code>visualizer-node/visualizer_node/main.py</code></strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""TODO: Add docstring."""</span>

<span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># visualizer.py - æ–°å¢èŠ‚ç‚¹ï¼šå®æ—¶æ¸©åº¦æ›²çº¿å›¾</span>
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque

<span class="hljs-keyword">import</span> matplotlib.animation <span class="hljs-keyword">as</span> animation
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> pyarrow <span class="hljs-keyword">as</span> pa
<span class="hljs-keyword">from</span> dora <span class="hljs-keyword">import</span> Node


<span class="hljs-keyword">class</span> <span class="hljs-title class_">TempVisualizer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, max_points=<span class="hljs-number">100</span></span>):
        self.max_points = max_points
        self.timestamps = deque(maxlen=max_points)
        self.temperatures = deque(maxlen=max_points)
        self.fig, self.ax = plt.subplots(figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>))
        (self.line,) = self.ax.plot([], [], <span class="hljs-string">"b-"</span>, label=<span class="hljs-string">"Temperature Curve"</span>)
        self.ax.set_ylim(<span class="hljs-number">15</span>, <span class="hljs-number">40</span>)
        self.ax.set_xlim(<span class="hljs-number">0</span>, max_points)
        self.ax.set_xlabel(<span class="hljs-string">"Timestamp"</span>)
        self.ax.set_ylabel(<span class="hljs-string">"Temperature (Â°C)"</span>)
        self.ax.set_title(<span class="hljs-string">"Real Time Temperature Monitoring (M1 Pro)"</span>)
        self.ax.legend()
        self.ax.grid(<span class="hljs-literal">True</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_plot</span>(<span class="hljs-params">self, frame</span>):
        self.line.set_data(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(self.temperatures)), self.temperatures)
        self.ax.set_xlim(<span class="hljs-number">0</span>, <span class="hljs-built_in">max</span>(<span class="hljs-built_in">len</span>(self.temperatures), self.max_points))
        <span class="hljs-keyword">return</span> (self.line,)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">data_receiver</span>(<span class="hljs-params">visualizer</span>):
    <span class="hljs-string">"""åå°çº¿ç¨‹æ¥æ”¶doraæ•°æ®"""</span>

    node = Node()
    <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> node:
        <span class="hljs-keyword">if</span> event[<span class="hljs-string">"type"</span>] == <span class="hljs-string">"INPUT"</span> <span class="hljs-keyword">and</span> event[<span class="hljs-string">"id"</span>] == <span class="hljs-string">"data"</span>:
            array = event[<span class="hljs-string">"value"</span>]
            temp = array[<span class="hljs-number">0</span>].as_py()
            visualizer.temperatures.append(temp)
            visualizer.timestamps.append(<span class="hljs-built_in">len</span>(visualizer.timestamps))


<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    visualizer = TempVisualizer()
    <span class="hljs-comment"># å¯åŠ¨æ•°æ®æ¥æ”¶çº¿ç¨‹ï¼ˆéé˜»å¡ï¼‰</span>
    data_thread = threading.Thread(target=data_receiver, args=(visualizer,))
    data_thread.daemon = <span class="hljs-literal">True</span>
    data_thread.start()

    <span class="hljs-comment"># å¯åŠ¨matplotlibåŠ¨ç”»</span>
    ani = animation.FuncAnimation(
        visualizer.fig,
        visualizer.update_plot,
        interval=<span class="hljs-number">100</span>,  <span class="hljs-comment"># 100msåˆ·æ–°ä¸€æ¬¡</span>
        blit=<span class="hljs-literal">True</span>,
    )
    plt.show()


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()

</code></pre>
<h4 data-id="heading-17">7. å®Œæ•´æ•°æ®æµé…ç½®</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># dataflow.yml (å®Œæ•´å››èŠ‚ç‚¹ç‰ˆ)</span>
<span class="hljs-attr">nodes:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">temp_sensor</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">cargo</span> <span class="hljs-string">build</span> <span class="hljs-string">-p</span> <span class="hljs-string">sensor_node</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">target/debug/sensor_node</span>
    <span class="hljs-attr">inputs:</span>
      <span class="hljs-attr">tick:</span> <span class="hljs-string">dora/timer/millis/100</span>
    <span class="hljs-attr">outputs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">temp_raw</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">data_processor</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">cargo</span> <span class="hljs-string">build</span> <span class="hljs-string">-p</span> <span class="hljs-string">processor_node</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">target/debug/processor_node</span>
    <span class="hljs-attr">inputs:</span>
      <span class="hljs-attr">temp:</span> <span class="hljs-string">temp_sensor/temp_raw</span>
    <span class="hljs-attr">outputs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">temp_smoothed</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">temp_alert</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">logger</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">cargo</span> <span class="hljs-string">build</span> <span class="hljs-string">-p</span> <span class="hljs-string">logger_node</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">target/debug/logger_node</span>
    <span class="hljs-attr">inputs:</span>
      <span class="hljs-attr">smoothed:</span> <span class="hljs-string">data_processor/temp_smoothed</span>
      <span class="hljs-attr">alert:</span> <span class="hljs-string">data_processor/temp_alert</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">visualizer</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">visualizer-node/visualizer_node/main.py</span>
    <span class="hljs-attr">inputs:</span>
      <span class="hljs-attr">data:</span> <span class="hljs-string">data_processor/temp_smoothed</span>

</code></pre>
<h4 data-id="heading-18">ç¼–è¯‘è¿è¡Œï¼ˆMacOS M1ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. pythoné¡¹ç›®ä¾èµ–ç®¡ç†</span>
<span class="hljs-built_in">cd</span> visualizer-node &amp;&amp; uv install

<span class="hljs-comment"># 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ, åœ¨dora up ä¹‹å‰ ï¼Œå¦åˆ™ ä¼šæŠ¥é”™ï¼šæ‰¾ä¸åˆ°pythonè·¯å¾„</span>
<span class="hljs-built_in">source</span> visualizer-node/.venv/bin/activate

<span class="hljs-comment"># 3. æ„å»ºæ‰€æœ‰RustèŠ‚ç‚¹ï¼ˆM1ç¼–è¯‘é£å¿«ï¼‰</span>
dora build dataflow.yml

<span class="hljs-comment">#4. å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹</span>
dora up

<span class="hljs-comment"># 5. è¿è¡Œæ•°æ®æµ</span>
dora start dataflow.yml

<span class="hljs-comment"># 6. åœ¨å¦ä¸€ä¸ªç»ˆç«¯æŸ¥çœ‹çŠ¶æ€</span>
dora list

</code></pre>
<p><strong>é¢„æœŸè¾“å‡º</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">2025-12-12T10:33:47.988647Z  INFO dora_core::descriptor::validate: skipping path check <span class="hljs-keyword">for</span> node with build <span class="hljs-built_in">command</span>
2025-12-12T10:33:47.988649Z  INFO dora_core::descriptor::validate: skipping path check <span class="hljs-keyword">for</span> node with build <span class="hljs-built_in">command</span>
2025-12-12T10:33:47.991297Z  INFO zenoh::net::runtime: Using ZID: 8b8a68bebfc1f776ff2fd1a5a0d3622c
2025-12-12T10:33:47.998142Z  INFO zenoh::net::runtime::orchestrator: Zenoh can be reached at: tcp/[fe80::1]:57716
......
025-12-12T10:33:47.998392Z  INFO zenoh::net::runtime::orchestrator: zenohd listening scout messages on 224.0.0.224:7446
data_processor: DEBUG  daemon::spawner    spawning node
logger: DEBUG  daemon::spawner    spawning node
temp_sensor: DEBUG  daemon::spawner    spawning node
visualizer: DEBUG  daemon::spawner    spawning node
......
data_processor: INFO   daemon    node is ready
logger: INFO   daemon    node is ready
temp_sensor: INFO   daemon    node is ready
visualizer: INFO   daemon    node is ready
INFO   daemon    all nodes are ready, starting dataflow
temp_sensor: stdout    ğŸŒ¡ï¸ ä¼ æ„Ÿå™¨èŠ‚ç‚¹å¯åŠ¨ (M1 Proä¼˜åŒ–ç‰ˆ)
data_processor: stdout    ğŸ§® å¤„ç†å™¨èŠ‚ç‚¹å¯åŠ¨ (æ»‘åŠ¨çª—å£+å¼‚å¸¸æ£€æµ‹)
logger: stdout    æ—¥å¿—èŠ‚ç‚¹å¯åŠ¨
visualizer: stdout      ani = animation.FuncAnimation(
[23.1Â°C] â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
...
</code></pre>
<p><strong>è¿è¡Œæ•ˆæœ</strong>ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0849d4df0d042269151342339f08b5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUnVzdOefpeihjOekvg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394885&amp;x-signature=mpPNmHt5q5Y%2FYTIY5%2FQVydMFjjg%3D" alt="ScreenShot_2025-12-15_171239_920.png" loading="lazy"/></p>
<p><strong>GitHubä»“åº“</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDoomking%2Frust-zhixingshe-examples%2Ftree%2Fmain%2Fdora%2Fdora-temp-monitor-rust" target="_blank" title="https://github.com/Doomking/rust-zhixingshe-examples/tree/main/dora/dora-temp-monitor-rust" ref="nofollow noopener noreferrer">github.com/Doomking/ruâ€¦</a></p>
<hr/>
<h3 data-id="heading-19">ä¸‰ æ ¸å¿ƒè¦ç‚¹æ€»ç»“</h3>
<p><strong><code>dora-rs</code> çš„ä»·å€¼</strong>åœ¨äºï¼Œå®ƒå°†æ„å»ºå¤æ‚å®æ—¶ç³»ç»Ÿçš„<strong>æ¶æ„å¤æ‚æ€§</strong>ä¸<strong>ä¸šåŠ¡é€»è¾‘å¤æ‚æ€§</strong>è§£è€¦ã€‚å¼€å‘è€…å¯ä»¥æ›´ä¸“æ³¨äºæ¯ä¸ªèŠ‚ç‚¹çš„æ ¸å¿ƒç®—æ³•ï¼Œè€Œå°†èŠ‚ç‚¹é—´é€šä¿¡ã€æ•°æ®åºåˆ—åŒ–ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ç­‰ç¹çé—®é¢˜äº¤ç»™æ¡†æ¶ã€‚</p>























































<table><thead><tr><th>æ¦‚å¿µ</th><th>ä¸€å¥è¯ç†è§£</th><th>å®æˆ˜æŠ€å·§</th></tr></thead><tbody><tr><td><strong>Dataflow</strong></td><td>åº”ç”¨çš„"æ–½å·¥å›¾"</td><td><code>YAML</code> å®šä¹‰ï¼Œå…ˆç”»åå†™ä»£ç </td></tr><tr><td><strong>Node</strong></td><td>ç‹¬ç«‹å·¥äººè¿›ç¨‹</td><td>è·¨è¯­è¨€æ··ç¼–ï¼Œæ•…éšœéš”ç¦»</td></tr><tr><td><strong>Operator</strong></td><td>å·¥äººæ‰‹é‡Œçš„å·¥å…·</td><td>å•è¿›ç¨‹ï¼Œé€‚åˆé«˜é¢‘è®¡ç®—</td></tr><tr><td><strong>Event Stream</strong></td><td>æ°¸ä¸é˜»å¡çš„æ”¶ä»¶ç®±</td><td><code>for event in node</code>é˜»å¡å¼ï¼ŒCPUé›¶ç©ºè½¬</td></tr><tr><td><strong>Arrow Data</strong></td><td>é›¶æ‹·è´é­”æ³•</td><td>&gt; <code>4KB</code> è‡ªåŠ¨èµ°å…±äº«å†…å­˜ï¼ŒM1ç»Ÿä¸€å†…å­˜æ¶æ„æ›´ä¼˜</td></tr><tr><td><strong>APIç»‘å®š</strong></td><td>å¤šè¯­è¨€å…¨å®¶æ¡¶</td><td>Rustæ€§èƒ½æœ€å¥½ï¼ŒPythonç”Ÿæ€æœ€ä¸°å¯Œ</td></tr><tr><td><strong>CLI</strong></td><td>æŒ‡æŒ¥ä¸­å¿ƒä¸‰å‰‘å®¢</td><td><code>build</code>ã€<code>start</code>ã€<code>list</code></td></tr><tr><td><strong>Daemon</strong></td><td>å•æœºè½¦é—´ä¸»ä»»</td><td>æœ¬åœ°å…±äº«å†…å­˜ç®¡ç†å™¨</td></tr><tr><td><strong>Coordinator</strong></td><td>åˆ†å¸ƒå¼æ€»ç»ç†</td><td>è·¨æœºå™¨åè°ƒï¼Œæ”¯æŒROS2çº§å¤æ‚ç³»ç»Ÿ</td></tr></tbody></table>
<p>é€šè¿‡è¿™ä¸ªå®æˆ˜é¡¹ç›®ï¼Œæˆ‘ä»¬ä½“éªŒäº† <code>dora-rs</code> çš„æ ¸å¿ƒå·¥ä½œæµç¨‹ï¼š</p>
<ol>
<li><strong>è“å›¾è®¾è®¡</strong>ï¼šç”¨ <code>YAML</code> å®šä¹‰æ¸…æ™°çš„æ•°æ®æµæ‹“æ‰‘ã€‚</li>
<li><strong>å¼‚æ„å¼€å‘</strong>ï¼šè‡ªç”±é€‰æ‹© Pythonï¼ˆä¼ æ„Ÿå™¨ã€ç»˜å›¾ï¼‰å’Œ Rustï¼ˆé«˜æ€§èƒ½è®¡ç®—ï¼‰å®ç°èŠ‚ç‚¹ã€‚</li>
<li><strong>é«˜æ•ˆé€šä¿¡</strong>ï¼šåº•å±‚åŸºäº <code>Arrow</code> çš„é›¶æ‹·è´æœºåˆ¶ï¼Œè®©è·¨è¯­è¨€æ•°æ®äº¤æ¢æ¯«æ— è´Ÿæ‹…ã€‚</li>
<li><strong>ç»Ÿä¸€è¿è¡Œ</strong>ï¼šä¸€ä¸ª <code>dora start</code> å‘½ä»¤æ‹‰èµ·æ‰€æœ‰ç»„ä»¶ï¼Œå¹¶æŒ‰è“å›¾è‡ªåŠ¨è¿æ¥ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-20">ğŸ“– å‚è€ƒèµ„æ–™</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdora-rs.ai%2Fzh-CN%2Fdocs%2Fguides%2F" target="_blank" title="https://dora-rs.ai/zh-CN/docs/guides/" ref="nofollow noopener noreferrer">dora-rså®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdora-rs%2Fdora-examples" target="_blank" title="https://github.com/dora-rs/dora-examples" ref="nofollow noopener noreferrer">dora-rsç¤ºä¾‹ä»“åº“</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdoracc.com%2Findex.html" target="_blank" title="https://doracc.com/index.html" ref="nofollow noopener noreferrer">dora-rsä¸­æ–‡ç¤¾åŒº</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Softmax ä¸ äº¤å‰ç†µæŸå¤±]]></title>    <link>https://juejin.cn/post/7583906478327889939</link>    <guid>https://juejin.cn/post/7583906478327889939</guid>    <pubDate>2025-12-15T09:36:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906478327889939" data-draft-id="7583912899388407851" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Softmax ä¸ äº¤å‰ç†µæŸå¤±"/> <meta itemprop="keywords" content="ç®—æ³•,ç¥ç»ç½‘ç»œ"/> <meta itemprop="datePublished" content="2025-12-15T09:36:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AshinGau"/> <meta itemprop="url" content="https://juejin.cn/user/2154698521722679"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Softmax ä¸ äº¤å‰ç†µæŸå¤±
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2154698521722679/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AshinGau
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:36:34.000Z" title="Mon Dec 15 2025 09:36:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡æ¡£è¯¦ç»†è§£æäº†å¤šåˆ†ç±»ä»»åŠ¡ä¸­ <strong>Softmax</strong> ä¸ <strong>äº¤å‰ç†µæŸå¤± (Cross-Entropy Loss)</strong> çš„æ•°å­¦åŸç†ã€é…åˆæœºåˆ¶ä»¥åŠå·¥ç¨‹å®ç°ä¸­çš„æ•°å€¼ç¨³å®šæ€§é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-0">1. æ ¸å¿ƒç†è®ºï¼šä» Logits åˆ° Loss</h2>
<p>å‡è®¾ç¥ç»ç½‘ç»œæœ€åä¸€å±‚çš„åŸå§‹è¾“å‡ºï¼ˆæœªå½’ä¸€åŒ–ï¼‰ä¸ºå‘é‡ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">o</mi></mrow><annotation encoding="application/x-tex">\mathbf{o}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf">o</span></span></span></span></span>ï¼Œå…¶ä¸­ç¬¬ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span> ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºè®°ä¸º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>o</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">o_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>ï¼ˆå·¥ç¨‹ä¸Šå¸¸ç§°ä¸º <strong>Logits</strong>ï¼‰ã€‚</p>
<h3 data-id="heading-1">1.1 Softmax å‡½æ•°ï¼šå½’ä¸€åŒ–</h3>
<p>Softmax çš„æ ¸å¿ƒä½œç”¨æ˜¯å°†ä»»æ„å®æ•°åŸŸçš„è¾“å‡º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>o</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">o_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> æ˜ å°„ä¸ºæ¦‚ç‡åˆ†å¸ƒ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>ã€‚</p>
<p><strong>å…¬å¼ï¼š</strong>
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mtext>Softmax</mtext><mo stretchy="false">(</mo><msub><mi>o</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mrow><msubsup><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>C</mi></msubsup><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">y_i = \text{Softmax}(o_i) = \frac{e^{o_i}}{\sum_{j=1}^{C} e^{o_j}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">Softmax</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.6629em;vertical-align:-0.7519em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.911em;"><span style="top:-2.5703em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8852em;"><span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-2.8971em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4603em;"><span/></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.1952em;"/><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.779em;"><span style="top:-2.9714em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5092em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7385em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight">i</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<ul>
<li><strong>éè´Ÿæ€§</strong>ï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">e^{o_i} &gt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7035em;vertical-align:-0.0391em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span>ï¼Œä¿è¯æ¦‚ç‡ä¸ºæ­£ã€‚</li>
<li><strong>å½’ä¸€åŒ–</strong>ï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ‘</mo><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum y_i = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œç¬¦åˆæ¦‚ç‡å®šä¹‰ã€‚</li>
<li><strong>å·®å¼‚æ”¾å¤§</strong>ï¼šæŒ‡æ•°å‡½æ•°ä¼šæ‹‰å¤§æ•°å€¼ä¹‹é—´çš„å·®è·ï¼Œä½¿â€œå¼ºè€…æ’å¼ºâ€ã€‚</li>
</ul>
<h3 data-id="heading-2">1.2 äº¤å‰ç†µæŸå¤± (Cross-Entropy Loss)</h3>
<p>äº¤å‰ç†µç”¨äºè¡¡é‡â€œé¢„æµ‹æ¦‚ç‡åˆ†å¸ƒâ€ä¸â€œçœŸå®æ ‡ç­¾åˆ†å¸ƒâ€ä¹‹é—´çš„å·®å¼‚ã€‚</p>
<p><strong>å…¬å¼ï¼š</strong>
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mo>âˆ’</mo><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>C</mi></msubsup><msub><mi>t</mi><mi>i</mi></msub><mo>â‹…</mo><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L = - \sum_{i=1}^{C} t_i \cdot \log(y_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2809em;vertical-align:-0.2997em;"/><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>å…¶ä¸­ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"/><span class="mord mathnormal">t</span></span></span></span></span> æ˜¯çœŸå®æ ‡ç­¾çš„ One-hot ç¼–ç å‘é‡ï¼ˆæ­£ç¡®ç±»åˆ«ä¸º 1ï¼Œå…¶ä½™ä¸º 0ï¼‰ã€‚å› æ­¤ï¼Œå¯¹äºå•ä¸ªæ ·æœ¬ï¼Œå…¬å¼ç®€åŒ–ä¸ºï¼š</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mo>âˆ’</mo><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mtext>correct</mtext></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L = - \log(y_{\text{correct}})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">correct</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>å³ï¼š<strong>æˆ‘ä»¬åªå…³å¿ƒæ¨¡å‹å¯¹â€œæ­£ç¡®ç±»åˆ«â€é¢„æµ‹äº†å¤šå¤§çš„æ¦‚ç‡ã€‚</strong></p>
<h3 data-id="heading-3">1.3 ä¸ºä»€ä¹ˆå®ƒä»¬æ˜¯â€œé»„é‡‘æ­æ¡£â€ï¼Ÿ</h3>
<p>å½“æˆ‘ä»¬å°† Softmax å’Œ Cross-Entropy ç»“åˆåœ¨ä¸€èµ·å¯¹ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>o</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">o_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> æ±‚å¯¼æ—¶ï¼Œä¼šå¾—åˆ°éå¸¸ä¼˜é›…çš„æ¢¯åº¦å½¢å¼ï¼š</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>o</mi><mi>i</mi></msub></mrow></mfrac><mo>=</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\frac{\partial L}{\partial o_i} = y_i - t_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3252em;vertical-align:-0.4451em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></p>
<p><strong>ç‰©ç†å«ä¹‰ï¼š</strong> æ¢¯åº¦ç­‰äº <strong>(é¢„æµ‹æ¦‚ç‡) - (çœŸå®æ ‡ç­¾)</strong>ã€‚</p>
<ul>
<li>è¿™ç§çº¿æ€§çš„æ¢¯åº¦ç‰¹æ€§é¿å…äº†å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰åœ¨åˆ†ç±»ä»»åŠ¡ä¸­å¯èƒ½é‡åˆ°çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</li>
<li>è¯¯å·®è¶Šå¤§ï¼Œæ¢¯åº¦è¶Šå¤§ï¼Œæ¨¡å‹å‚æ•°æ›´æ–°è¶Šå¿«ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-4">2. å·¥ç¨‹æŒ‘æˆ˜ï¼šæ•°å€¼ç¨³å®šæ€§ (Numerical Stability)</h2>
<p>åœ¨å®é™…å·¥ç¨‹è½åœ°æ—¶ï¼Œç›´æ¥æŒ‰ç…§æ•°å­¦å…¬å¼è®¡ç®— Softmax ä¼šé‡åˆ°ä¸¥é‡é—®é¢˜ã€‚</p>
<h3 data-id="heading-5">2.1 ä¸Šæº¢é—®é¢˜</h3>
<p>æŒ‡æ•°å‡½æ•° <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mi>x</mi></msup></mrow><annotation encoding="application/x-tex">e^x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6644em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span></span></span></span></span></span></span></span> å¢é•¿æå¿«ã€‚åœ¨æ ‡å‡†çš„ <code>float32</code> æµ®ç‚¹æ•°ç³»ç»Ÿä¸­ï¼š</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mn>100</mn></msup><mo>â‰ˆ</mo><mn>2.6</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>43</mn></msup></mrow><annotation encoding="application/x-tex">e^{100} \approx 2.6 \times 10^{43}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">100</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">2.6</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">43</span></span></span></span></span></span></span></span></span></span></span></span></span></li>
<li>è‹¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>o</mi><mi>i</mi></msub><mo>&gt;</mo><mn>88</mn></mrow><annotation encoding="application/x-tex">o_i &gt; 88</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">88</span></span></span></span></span>ï¼Œåˆ™ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mo>â†’</mo><mtext>inf</mtext></mrow><annotation encoding="application/x-tex">e^{o_i} \to \text{inf}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6644em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord text"><span class="mord">inf</span></span></span></span></span></span> (æ— ç©·å¤§)ã€‚</li>
</ul>
<p>ä¸€æ—¦åˆ†å­æˆ–åˆ†æ¯å‡ºç° <code>inf</code>ï¼Œè®¡ç®—ç»“æœå°±ä¼šå˜æˆ <code>NaN</code> (Not a Number)ï¼Œå¯¼è‡´è®­ç»ƒå´©æºƒã€‚</p>
<h3 data-id="heading-6">2.2 è§£å†³æ–¹æ¡ˆï¼šå‡å»æœ€å¤§å€¼ (The Max Trick)</h3>
<p>åˆ©ç”¨ Softmax çš„ <strong>å¹³ç§»ä¸å˜æ€§</strong>ï¼Œæˆ‘ä»¬åœ¨åˆ†å­åˆ†æ¯çš„æŒ‡æ•°ä¸­åŒæ—¶å‡å»è¾“å…¥å‘é‡çš„æœ€å¤§å€¼ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mi>max</mi><mo>â¡</mo><mo stretchy="false">(</mo><mi mathvariant="bold">o</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M = \max(\mathbf{o})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">max</span><span class="mopen">(</span><span class="mord mathbf">o</span><span class="mclose">)</span></span></span></span></span>ã€‚</p>
<p><strong>æ¨å¯¼ï¼š</strong>
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Softmax</mtext><mo stretchy="false">(</mo><msub><mi>o</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mrow><mo>âˆ‘</mo><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup></mrow></mfrac><mo>=</mo><mfrac><mrow><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mo>â‹…</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>M</mi></mrow></msup></mrow><mrow><mo stretchy="false">(</mo><mo>âˆ‘</mo><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup><mo stretchy="false">)</mo><mo>â‹…</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>M</mi></mrow></msup></mrow></mfrac><mo>=</mo><mfrac><msup><mi>e</mi><mrow><msub><mi>o</mi><mi>i</mi></msub><mo>âˆ’</mo><mi>M</mi></mrow></msup><mrow><mo>âˆ‘</mo><msup><mi>e</mi><mrow><msub><mi>o</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>M</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{Softmax}(o_i) = \frac{e^{o_i}}{\sum e^{o_j}} = \frac{e^{o_i} \cdot e^{-M}}{(\sum e^{o_j}) \cdot e^{-M}} = \frac{e^{o_i - M}}{\sum e^{o_j - M}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">Softmax</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.4413em;vertical-align:-0.5303em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.911em;"><span style="top:-2.6447em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">âˆ‘</span><span class="mspace mtight" style="margin-right:0.1952em;"/><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.779em;"><span style="top:-2.9714em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5092em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7385em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight">i</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5303em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.5677em;vertical-align:-0.5303em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0374em;"><span style="top:-2.6447em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">âˆ‘</span><span class="mspace mtight" style="margin-right:0.1952em;"/><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.779em;"><span style="top:-2.9714em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5092em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mbin mtight">â‹…</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7741em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7385em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight">i</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mbin mtight">â‹…</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9191em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5303em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.694em;vertical-align:-0.6567em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0374em;"><span style="top:-2.5183em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">âˆ‘</span><span class="mspace mtight" style="margin-right:0.1952em;"/><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9595em;"><span style="top:-2.9714em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5092em;"><span/></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9191em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight">i</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span/></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6567em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ol>
<li>æœ€å¤§çš„æŒ‡æ•°é¡¹å˜ä¸º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mrow><mi>M</mi><mo>âˆ’</mo><mi>M</mi></mrow></msup><mo>=</mo><msup><mi>e</mi><mn>0</mn></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">e^{M-M} = e^0 = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ã€‚</li>
<li>å…¶ä½™æ‰€æœ‰é¡¹çš„æŒ‡æ•°éƒ¨åˆ†å‡ä¸ºè´Ÿæ•°æˆ–é›¶ï¼Œç»“æœåœ¨ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">(0, 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">1</span><span class="mclose">]</span></span></span></span></span> ä¹‹é—´ã€‚</li>
<li>å½»åº•è§£å†³äº†ä¸Šæº¢é—®é¢˜ã€‚</li>
</ol>
<h3 data-id="heading-7">2.3 ä¸‹æº¢é—®é¢˜</h3>
<p>å³ä¾¿è§£å†³äº†ä¸Šæº¢ï¼Œå¦‚æœåœ¨è®¡ç®— Loss æ—¶å…ˆç®— Softmax å†ç®— Logï¼Œè¿˜å¯èƒ½é‡åˆ° <strong>ä¸‹æº¢</strong>ã€‚</p>
<p>å¦‚æœæŸä¸ªç±»åˆ«çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>o</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">o_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> éå¸¸å°ï¼ˆè´Ÿç»å¯¹å€¼å¾ˆå¤§ï¼‰ï¼Œç»è¿‡ Softmax å <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> å¯èƒ½ä¼šæå…¶æ¥è¿‘ 0ã€‚
åœ¨æµ®ç‚¹æ•°ç²¾åº¦å—é™çš„æƒ…å†µä¸‹ï¼Œè®¡ç®—æœºå¯èƒ½ç›´æ¥å°† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> æˆªæ–­ä¸º <strong>0</strong>ã€‚
éšåè®¡ç®— Loss æ—¶ï¼š
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mo>âˆ’</mo><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo><mo>â†’</mo><mtext>inf</mtext></mrow><annotation encoding="application/x-tex">L = -\log(0) \to \text{inf}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord text"><span class="mord">inf</span></span></span></span></span></span>
è¿™ä¼šå¯¼è‡´è®­ç»ƒæ¢¯åº¦çˆ†ç‚¸æˆ– Loss å˜ä¸ºæ— ç©·å¤§ã€‚</p>
<h3 data-id="heading-8">2.4 è§£å†³æ–¹æ¡ˆï¼šLog-Sum-Exp</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong> ä¸è¦åˆ†æ­¥è®¡ç®— <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><mtext>Softmax</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\log(\text{Softmax})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord text"><span class="mord">Softmax</span></span><span class="mclose">)</span></span></span></span></span>ï¼Œè€Œæ˜¯å°†å…¶åˆå¹¶æ¨å¯¼ï¼Œè½¬åŒ–ä¸ºä¸€ä¸ªåŸå­æ“ä½œã€‚</p>
<p><strong>æ•°å­¦æ¨å¯¼ï¼š</strong></p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><mtext>Softmax</mtext><mo stretchy="false">(</mo><msub><mi>o</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><mfrac><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mrow><munder><mo>âˆ‘</mo><mi>j</mi></munder><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup></mrow></mfrac><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><munder><mo>âˆ‘</mo><mi>j</mi></munder><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><msub><mi>o</mi><mi>i</mi></msub><mo>âˆ’</mo><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><munder><mo>âˆ‘</mo><mi>j</mi></munder><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\log(\text{Softmax}(o_i)) &amp;= \log\left( \frac{e^{o_i}}{\sum_{j} e^{o_j}} \right) \\
&amp;= \log(e^{o_i}) - \log\left( \sum_{j} e^{o_j} \right) \\
&amp;= o_i - \log\left( \sum_{j} e^{o_j} \right)
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:10.2276em;vertical-align:-4.8638em;"/><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.3638em;"><span style="top:-7.3638em;"><span class="pstrut" style="height:3.75em;"/><span class="mord"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord text"><span class="mord">Softmax</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">))</span></span></span><span style="top:-4.0638em;"><span class="pstrut" style="height:3.75em;"/><span class="mord"/></span><span style="top:-0.6em;"><span class="pstrut" style="height:3.75em;"/><span class="mord"/></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:4.8638em;"><span/></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.3638em;"><span style="top:-7.3638em;"><span class="pstrut" style="height:3.75em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3414em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6065em;"><span style="top:-3.0051em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.1218em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span></span></span><span style="top:-4.0638em;"><span class="pstrut" style="height:3.75em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span></span></span><span style="top:-0.6em;"><span class="pstrut" style="height:3.75em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:4.8638em;"><span/></span></span></span></span></span></span></span></span></span></span></div>
<p><strong>è¿™é‡Œçš„ Log-Sum-Exp éƒ¨åˆ†ï¼š</strong> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><mo>âˆ‘</mo><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\log(\sum e^{o_j})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>
åŒæ ·å†æ¬¡ä½¿ç”¨ Max Trick æ¥ä¿è¯è¿™ä¸€æ­¥çš„ç¨³å®šæ€§ï¼š
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><msub><mo>âˆ‘</mo><mi>j</mi></msub><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup><mo fence="true">)</mo></mrow><mo>=</mo><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><msub><mo>âˆ‘</mo><mi>j</mi></msub><msup><mi>e</mi><mrow><msub><mi>o</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>M</mi></mrow></msup><mo>â‹…</mo><msup><mi>e</mi><mi>M</mi></msup><mo fence="true">)</mo></mrow><mo>=</mo><mi>M</mi><mo>+</mo><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><msub><mo>âˆ‘</mo><mi>j</mi></msub><msup><mi>e</mi><mrow><msub><mi>o</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>M</mi></mrow></msup><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log\left( \sum_{j} e^{o_j} \right) = \log\left( \sum_{j} e^{o_j - M} \cdot e^M \right) = M + \log\left( \sum_{j} e^{o_j - M} \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span></p>
<h3 data-id="heading-9">2.5 æœ€ç»ˆç»“è®º</h3>
<p>é€šè¿‡åˆå¹¶è®¡ç®—ï¼Œæˆ‘ä»¬å®Œå…¨é¿å…äº†ç›´æ¥è®¡ç®—æ¦‚ç‡ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> è¿™ä¸€æ­¥ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡ Logits è®¡ç®— Log-Probabilityã€‚
<strong>å…¬å¼å˜ä¸ºï¼š</strong>
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LogSoftmax</mtext><mo stretchy="false">(</mo><msub><mi>o</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>o</mi><mi>i</mi></msub><mo>âˆ’</mo><mi>M</mi><mo>âˆ’</mo><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><mo>âˆ‘</mo><msup><mi>e</mi><mrow><msub><mi>o</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>M</mi></mrow></msup><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{LogSoftmax}(o_i) = o_i - M - \log\left( \sum e^{o_j - M} \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">LogSoftmax</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span></span>
åœ¨è¿™ä¸ªå…¬å¼ä¸­ï¼Œæ‰€æœ‰ä¸­é—´æ•°å€¼éƒ½è¢«é™åˆ¶åœ¨å®‰å…¨èŒƒå›´å†…ï¼Œæ—¢ä¸ä¼šä¸Šæº¢ä¹Ÿä¸ä¼šä¸‹æº¢ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIå…¥é—¨çŸ¥è¯†ç‚¹ï¼šä»€ä¹ˆæ˜¯ AIGCã€å¤šæ¨¡æ€ã€RAGã€Function Callã€Agentã€MCP?]]></title>    <link>https://juejin.cn/post/7583878719543640073</link>    <guid>https://juejin.cn/post/7583878719543640073</guid>    <pubDate>2025-12-15T10:08:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583878719543640073" data-draft-id="7583871118948892722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIå…¥é—¨çŸ¥è¯†ç‚¹ï¼šä»€ä¹ˆæ˜¯ AIGCã€å¤šæ¨¡æ€ã€RAGã€Function Callã€Agentã€MCP?"/> <meta itemprop="keywords" content="å‰ç«¯,AIç¼–ç¨‹,AIGC"/> <meta itemprop="datePublished" content="2025-12-15T10:08:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¢‹é±¼ä¸é‡"/> <meta itemprop="url" content="https://juejin.cn/user/3611263333042152"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIå…¥é—¨çŸ¥è¯†ç‚¹ï¼šä»€ä¹ˆæ˜¯ AIGCã€å¤šæ¨¡æ€ã€RAGã€Function Callã€Agentã€MCP?
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3611263333042152/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¢‹é±¼ä¸é‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:08:28.000Z" title="Mon Dec 15 2025 10:08:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. <strong>AIGC</strong> - å†…å®¹ç”ŸæˆåŸºæœ¬åŠŸ</h2>
<p><strong>æ¦‚å¿µï¼š</strong> åˆ©ç”¨ AI æŠ€æœ¯è‡ªåŠ¨åˆ›ä½œæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰å„ç±»å†…å®¹çš„æŠ€æœ¯ç»Ÿç§°ã€‚å…¨ç§° Artificial Intelligence Generated Content ï¼ˆäººå·¥æ™ºèƒ½ç”Ÿæˆå†…å®¹ï¼‰</p>
<p><strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> ç”¨ AI æ¥è‡ªåŠ¨ç”Ÿæˆ â€œäººç±»å¸¸å¹²çš„æ´»â€</p>
<p><strong>æœ¬è´¨ï¼š</strong>  AI æ¨¡å‹é€šè¿‡å­¦ä¹ æµ·é‡æ•°æ®ï¼Œè‡ªä¸»ç”Ÿæˆç¬¦åˆéœ€æ±‚çš„å…¨æ–°å†…å®¹ï¼Œè€Œéç®€å•å¤åˆ¶æˆ–æ‹¼æ¥ç°æœ‰ä¿¡æ¯</p>
<p>åˆæœŸçš„AIGCæœ‰ä¸ªæ˜æ˜¾å±€é™ï¼šåªèƒ½ä¸“æ³¨äºä¸€ç§ä¿¡æ¯ç±»å‹ï¼Œå°±åƒä¸€ä¸ªåç§‘çš„å­¦ç”Ÿâ€”â€”è¦ä¹ˆåªæ‡‚æ–‡å­—ï¼ˆæ—©æœŸChatGPTï¼‰ï¼Œè¦ä¹ˆåªæ‡‚å›¾åƒï¼ˆåˆä»£Midjourneyï¼‰ï¼Œè¿™å°±æ˜¯â€œå•æ¨¡æ€â€é˜¶æ®µã€‚</p>
<h2 data-id="heading-1">2. å¤šæ¨¡æ€ - æ„Ÿå®˜å‡çº§</h2>
<ol>
<li>å•æ¨¡æ€ï¼šAI ä»…èšç„¦ä¸€ç§ä¿¡æ¯ç±»å‹ï¼Œæ¯”å¦‚çº¯æ–‡æœ¬ç”Ÿæˆï¼ˆæ—©æœŸ ChatGPTï¼‰ã€çº¯å›¾åƒåˆ›ä½œï¼ˆåˆä»£ Midjourneyï¼‰ã€‚</li>
<li>åŒæ¨¡æ€ï¼šèåˆä¸¤ç§ä¿¡æ¯ç±»å‹ï¼Œæ¯”å¦‚æ–‡æœ¬ç”Ÿæˆå›¾åƒã€è¯­éŸ³è½¬æ–‡å­—ã€‚</li>
<li>é«˜æ¨¡æ€ï¼šæ•´åˆä¸‰ç§åŠä»¥ä¸Šä¿¡æ¯ç±»å‹ï¼Œæ¯”å¦‚ â€œæ–‡å­— + è¯­éŸ³ + å›¾ç‰‡â€ æ··åˆè¾“å…¥æé—®ï¼ŒAI è¾“å‡º â€œæ–‡æœ¬ + è§†é¢‘ + éŸ³é¢‘â€ ç»„åˆç»“æœï¼ˆå¦‚ GPT-4Vã€Runway Gen-2ï¼‰ã€‚</li>
</ol>
<p><strong>æ¦‚å¿µï¼š</strong> å¤šæ¨¡æ€ = AI æ‰“ç ´å•ä¸€ä¿¡æ¯ç±»å‹é™åˆ¶ï¼ŒåŒæ—¶å¤„ç†æˆ–èåˆæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ç­‰ä¸¤ç§åŠä»¥ä¸Šå†…å®¹ï¼Œåƒäººç±»ä¸€æ ·å¤šæ„Ÿå®˜æ„ŸçŸ¥ä¸–ç•Œã€‚</p>
<p><strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> AI åŒæ—¶å¤„ç† / èåˆå¤šç§ä¿¡æ¯ç±»å‹ï¼Œæ‰“ç ´å•ä¸€æ–‡æœ¬ã€å›¾åƒç­‰æ¨¡æ€çš„å±€é™ï¼Œæ›´è´´è¿‘äººç±»æ„ŸçŸ¥ä¸–ç•Œçš„æ–¹å¼ã€‚</p>
<p><strong>é™åˆ¶ï¼š</strong></p>
<ol>
<li>æ•°æ®çœŸå®æ€§ä¸è¶³ï¼šæ˜“ç”Ÿæˆ â€œå¹»è§‰å†…å®¹â€ï¼Œæ¯”å¦‚ç¼–é€ è™šå‡æ•°æ®ã€å¼•ç”¨ä¸å­˜åœ¨çš„æ–‡çŒ®ï¼Œå°¤å…¶ä¸“ä¸šé¢†åŸŸè¯¯å·®ç‡é«˜ã€‚</li>
<li>ç¼ºä¹åŸåˆ›æ€§ï¼šæœ¬è´¨æ˜¯å¯¹è®­ç»ƒæ•°æ®çš„é‡ç»„ä¼˜åŒ–ï¼Œéš¾äº§ç”ŸçœŸæ­£çš„ â€œçªç ´æ€§åˆ›æ„â€ï¼Œæ˜“å‡ºç°åŒè´¨åŒ–å†…å®¹ã€‚</li>
<li>åˆè§„ä¸ä¼¦ç†é£é™©ï¼šå¯èƒ½ä¾µçŠ¯ç‰ˆæƒï¼ˆå¤åˆ»è®­ç»ƒæ•°æ®ä¸­çš„åŸåˆ›å†…å®¹ï¼‰ã€ç”Ÿæˆåè§ / ä¸è‰¯ä¿¡æ¯ï¼Œä¸”è´£ä»»ç•Œå®šæ¨¡ç³Šã€‚</li>
<li>å¯æ§æ€§æœ‰é™ï¼šå¤æ‚éœ€æ±‚ä¸‹éš¾ç²¾å‡†åŒ¹é…é¢„æœŸï¼Œæ¯”å¦‚å¤šè½®åˆ›ä½œä¸­æ˜“åç¦»ä¸»é¢˜ï¼Œç»†èŠ‚è°ƒæ•´æˆæœ¬é«˜ã€‚</li>
<li>ä¾èµ–é«˜è´¨é‡æ•°æ®ï¼šè®­ç»ƒæ•°æ®çš„è¦†ç›–é¢ã€å‡†ç¡®æ€§ç›´æ¥å½±å“è¾“å‡ºæ•ˆæœï¼Œå°ä¼—é¢†åŸŸæˆ–ä¸“ä¸šåœºæ™¯è¡¨ç°ä¸ä½³ã€‚</li>
<li>ä¸å…·å¤‡å®æ—¶æ€§ï¼šä¾èµ–è®­ç»ƒæ•°æ®ï¼Œå¦‚æœçŸ¥è¯†åº“æ²¡æœ‰æ›´æ–°ï¼Œè¦è®©ä»–çŸ¥é“æœ€æ–°çš„æ•°æ®ï¼Œéœ€è¦è‡ªå·±ç»™ä»–â€œå–‚æ•°æ®â€</li>
<li>ä¸ä¼šç”¨å·¥å…·ï¼šä»ç°æœ‰çŸ¥è¯†åº“è·å–æ•°æ®ï¼Œå› æ­¤ä¸ä¼šæŸ¥è¯¢æœ€æ–°çš„ä¿¡æ¯ï¼Œä¸ä¼šè‡ªä¸»è°ƒç”¨ APIã€‚</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35c2c2b0860748ba8a00c5b96826b321~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKL6bG85LiN6YeN:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398107&amp;x-signature=bguTpPHlNwSmISqQV%2Bq37Y9Bt0c%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">3. RAGã€Function Call - å·¥å…·åŠ æŒ</h2>
<p>å¦‚æœè¯´RAGæ˜¯â€œçŸ¥è¯†åº“â€ï¼Œé‚£Function Callå°±æ˜¯AIçš„â€œæ‰‹è„šâ€ã€‚å®ƒè®©AIä»â€œåªè¯´ä¸åšâ€å‡çº§ä¸ºâ€œèƒ½è¯´ä¼šåšâ€â€”â€”æ¯”å¦‚æ ¹æ®æŒ‡ä»¤è‡ªåŠ¨è°ƒç”¨è®¡ç®—å™¨ç®—å¤æ‚æ•°æ®ã€è°ƒç”¨åœ°å›¾APIæŸ¥è·¯çº¿ã€è°ƒç”¨è¡¨æ ¼å·¥å…·ç”ŸæˆæŠ¥è¡¨ï¼Œå½»åº•è§£å†³äº†çº¯æ–‡æœ¬å›ç­”æ— æ³•è½åœ°çš„é—®é¢˜ã€‚</p>
<h3 data-id="heading-3">3.1 RAG</h3>
<p><strong>æ¦‚å¿µï¼š</strong> å…¨ç§° Retrieval-Augmented Generationï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ã€‚ æœ¬è´¨æ˜¯ AI ç”Ÿæˆå†…å®¹å‰ï¼Œå…ˆä»å¤–éƒ¨çŸ¥è¯†åº“ï¼ˆè€Œéä»…ä¾èµ–è®­ç»ƒæ•°æ®ï¼‰æ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼Œå†ç»“åˆæ£€ç´¢ç»“æœç”Ÿæˆç­”æ¡ˆã€‚</p>
<p><strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> è§£å†³ AIGC å®æ—¶æ€§çš„é—®é¢˜</p>
<ol>
<li>å¼¥è¡¥çŸ¥è¯†æ»åï¼šè®­ç»ƒæ•°æ®æœ‰æ—¶é—´ cutoffï¼ŒRAG å¯å®æ—¶è°ƒå–æœ€æ–°æ•°æ®ï¼ˆå¦‚ 2025 å¹´çš„è¡Œä¸šæŠ¥å‘Šï¼‰ï¼Œè®©å›ç­”æ›´å…·æ—¶æ•ˆæ€§ã€‚</li>
<li>å‡å°‘å¹»è§‰ï¼šåŸºäºçœŸå®å¯è¿½æº¯çš„æ£€ç´¢ç»“æœç”Ÿæˆå†…å®¹ï¼Œé™ä½ç¼–é€ è™šå‡ä¿¡æ¯çš„æ¦‚ç‡ã€‚</li>
<li>æå‡ä¸“ä¸šæ€§ï¼šå¯æ¥å…¥å‚ç›´é¢†åŸŸçŸ¥è¯†åº“ï¼ˆå¦‚åŒ»ç–—ã€æ³•å¾‹æ–‡çŒ®ï¼‰ï¼Œè®©éä¸“ä¸šè®­ç»ƒçš„ AI ä¹Ÿèƒ½è¾“å‡ºä¸“ä¸šç­”æ¡ˆã€‚</li>
</ol>
<h3 data-id="heading-4">3.2 Function Call</h3>
<p><strong>æ¦‚å¿µï¼š</strong> è®©æ¨¡å‹æ ¹æ®æŒ‡ä»¤ï¼Œè‡ªåŠ¨è°ƒç”¨å¤–éƒ¨å‡½æ•°å’Œæ¥å£</p>
<p><strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> AI è°ƒç”¨å¤–éƒ¨å·¥å…· / API çš„èƒ½åŠ›ï¼Œè®© AI ä» â€œåªç”Ÿæˆå†…å®¹â€ å‡çº§ä¸º â€œèƒ½æ‰§è¡Œæ“ä½œâ€ï¼Œè§£å†³çº¯æ–‡æœ¬å›ç­”æ— æ³•è½åœ°çš„é—®é¢˜ã€‚</p>
<h2 data-id="heading-5">4. Agent - è‡ªä¸»å†³ç­–èƒ½åŠ›</h2>
<p><strong>æ¦‚å¿µï¼š</strong> è®©æ¨¡å‹å…·å¤‡ä¸€å®šç¨‹åº¦çš„è‡ªä¸»å†³ç­–å’Œä»»åŠ¡è§„åˆ’èƒ½åŠ›ï¼Œä¸ç”¨ä¸€æ­¥ä¸€æ­¥å‘Šè¯‰å®ƒæ€ä¹ˆåšï¼Œè€Œæ˜¯ä¼šç»™å‡ºæœ€ç»ˆçš„è§„åˆ’å’Œç»“æœ</p>
<p><strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> å…·å¤‡è‡ªä¸»èƒ½åŠ›çš„ AI æ™ºèƒ½ä½“ï¼Œèƒ½ç†è§£ç›®æ ‡ã€è§„åˆ’æ­¥éª¤ã€è°ƒç”¨å·¥å…·ï¼Œæ— éœ€äººç±»åå¤æŒ‡ä»¤å°±èƒ½ç‹¬ç«‹å®Œæˆå¤æ‚ä»»åŠ¡ã€‚</p>
<p><strong>é™åˆ¶ï¼š</strong>  ç¼ºä¹â€œæ ‡å‡†åŒ–â€</p>
<ol>
<li>å¤æ‚ä»»åŠ¡è§„åˆ’èƒ½åŠ›å¼±ï¼šé¢å¯¹å¤šæ­¥éª¤ã€å¤šå˜é‡çš„ä»»åŠ¡ï¼ˆå¦‚è·¨éƒ¨é—¨å¤æ‚é¡¹ç›®æ¨è¿›ï¼‰ï¼Œæ˜“æ‹†è§£é€»è¾‘æ··ä¹±ï¼Œæˆ–å¿½ç•¥å…³é”®çº¦æŸæ¡ä»¶ã€‚</li>
<li>æ„å›¾ç†è§£ä¸ç²¾å‡†ï¼šå¯¹æ¨¡ç³Šéœ€æ±‚ã€éšå«æ„å›¾çš„æ•æ‰èƒ½åŠ›ä¸è¶³ï¼Œå¯èƒ½åç¦»ç”¨æˆ·çœŸå®ç›®æ ‡ï¼Œå°¤å…¶æ¶‰åŠä¸»è§‚åå¥½çš„åœºæ™¯ï¼ˆå¦‚ä¸ªæ€§åŒ–æ–¹æ¡ˆå®šåˆ¶ï¼‰ã€‚</li>
<li>é£é™©æ§åˆ¶ä¸è´£ä»»ç•Œå®šæ¨¡ç³Šï¼šè‡ªä¸»è°ƒç”¨å·¥å…·æ—¶å¯èƒ½è§¦å‘åˆè§„é£é™©ï¼ˆå¦‚è¯¯æ“ä½œæ•°æ®ã€æ³„éœ²éšç§ï¼‰ï¼Œä¸”å‡ºç°é—®é¢˜åéš¾ä»¥æ˜ç¡®è´£ä»»å½’å±ã€‚</li>
<li>èµ„æºä¾èµ–ä¸ç¨³å®šæ€§ä¸è¶³ï¼šé«˜åº¦ä¾èµ–å¤–éƒ¨å·¥å…· APIã€çŸ¥è¯†åº“çš„å¯ç”¨æ€§ï¼Œä¸€æ—¦æ¥å£æ•…éšœæˆ–æ•°æ®æ›´æ–°ä¸åŠæ—¶ï¼Œä¼šç›´æ¥å¯¼è‡´ä»»åŠ¡ä¸­æ–­ã€‚</li>
<li>ç¼ºä¹çµæ´»åº”å˜èƒ½åŠ›ï¼šé‡åˆ°çªå‘æƒ…å†µï¼ˆå¦‚è®¡åˆ’ä¸­çš„å·¥å…·ä¸å¯ç”¨ã€éœ€æ±‚ä¸´æ—¶å˜æ›´ï¼‰ï¼Œè°ƒæ•´æ–¹æ¡ˆçš„æ•ˆç‡ä½ï¼Œæ˜“é™·å…¥ â€œæ‰§è¡Œæ­»å¾ªç¯â€ã€‚</li>
</ol>
<p>æ¯”å¦‚ä½ è®©å®ƒâ€œç­–åˆ’ä¸€åœºå‘¨æœ«æ—…è¡Œâ€ï¼ŒAgentä¼šè‡ªåŠ¨æ‹†è§£æˆâ€œæŸ¥ç›®çš„åœ°å¤©æ°”â†’æ‰¾æ™¯ç‚¹æ”»ç•¥â†’è®¢é…’åº—â†’è§„åˆ’è·¯çº¿â€ç­‰æ­¥éª¤ï¼Œåˆ†åˆ«è°ƒç”¨å¤©æ°”APIã€æ—…æ¸¸çŸ¥è¯†åº“ã€è®¢ç¥¨å·¥å…·å®Œæˆï¼Œæœ€åç»™ä½ ä¸€ä»½å®Œæ•´æ”»ç•¥ã€‚ä½†æ­¤æ—¶çš„Agentä»æœ‰ä¸è¶³ï¼šä¸åŒAIæ¨¡å‹å’Œå·¥å…·å¯¹æ¥æ—¶å¾ˆæ··ä¹±ï¼Œå®¹æ˜“å‡ºç°â€œæ²Ÿé€šä¸ç•…â€çš„é—®é¢˜ã€‚</p>
<h2 data-id="heading-6">5. MCP - é€šç”¨æ²Ÿé€šåè®®ï¼Œæ„å»ºè·¨å¹³å°çš„ AI å·¥å…·ç”Ÿæ€</h2>
<p><a href="https://juejin.cn/post/7522106240408928275" target="_blank" title="https://juejin.cn/post/7522106240408928275">MCP é€šç”¨çŸ¥è¯†</a></p>
<p><strong>æ¦‚å¿µï¼š</strong> å…¨ç§° Model Context Protocolï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰ï¼Œæ ‡å‡†åŒ–æ¨¡å‹å’Œå¤–éƒ¨å·¥å…·ä¹‹é—´çš„è¿æ¥æ–¹å¼ã€‚æ˜¯ Anthropic äº 2024 å¹´ 11 æœˆæå‡ºçš„å¼€æ”¾æ ‡å‡†ï¼Œå ªç§° AI ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„ â€œä¸‡èƒ½æ¥å£â€ï¼Œä¸“é—¨è§£å†³ä¸åŒ AI æ¨¡å‹ä¸å·¥å…·ã€æ•°æ®æºå¯¹æ¥æ··ä¹±çš„é—®é¢˜ã€‚</p>
<p><strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> å¯ä»¥æŠŠå®ƒç†è§£ä¸º AI é¢†åŸŸçš„ USB-C æ¥å£æˆ– â€œä¸‡èƒ½é¥æ§å™¨â€ã€‚è¿‡å»ä¸åŒ AI æ¨¡å‹è°ƒç”¨å·¥å…·æ—¶ï¼Œéœ€é’ˆå¯¹æ€§å¼€å‘é€‚é…ä»£ç ï¼Œæ¯”å¦‚ OpenAI å’Œç™¾åº¦æ–‡å¿ƒä¸€è¨€è°ƒç”¨åŒä¸€æ•°æ®åº“å¯èƒ½è¦å†™ä¸¤å¥—é€»è¾‘ï¼›è€Œ MCP å®šä¹‰äº†ç»Ÿä¸€çš„é€šä¿¡è§„åˆ™ï¼Œåªè¦ AI æ¨¡å‹å’Œå·¥å…·éƒ½æ”¯æŒè¯¥åè®®ï¼Œå°±èƒ½æ— ç¼å¯¹æ¥ï¼Œä¸ç”¨é‡å¤é€‚é…ï¼Œè§£å†³äº† AI ä¸å·¥å…·äº¤äº’çš„ â€œNÃ—Mâ€ é€‚é…éš¾é¢˜ï¼ˆä»¥å‰æ˜¯ M Ã— N çš„æ··ä¹±å¯¹æ¥ï¼Œç°åœ¨æ˜¯ M + N çš„æ ‡å‡†æ¥å£ã€‚ï¼‰ã€‚</p>
<p><strong>ä¸ Function Call çš„åŒºåˆ«ï¼š</strong> ä¸¤è€…éƒ½èƒ½è®© AI è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œä½†é€»è¾‘å·®å¼‚æ˜æ˜¾ã€‚Function Call æ˜¯å•ä½“é›†æˆå¼æ–¹æ¡ˆï¼Œæ¯”å¦‚æŸ AI æ¨¡å‹çš„ Function Call åŠŸèƒ½ï¼Œåªèƒ½é€‚é…è¯¥å¹³å°æŒ‡å®šçš„å·¥å…·æˆ–æ¥å£ï¼Œåˆ‡æ¢æ¨¡å‹åå¯èƒ½è¦é‡æ–°å¼€å‘ï¼›è€Œ MCP æ˜¯åˆ†å¸ƒå¼çš„æ ‡å‡†åŒ–åè®®ï¼Œç›¸å½“äºç‹¬ç«‹çš„ â€œç¿»è¯‘å®˜â€ï¼Œä¸ç®¡ AI æ¨¡å‹å’Œå·¥å…·æ¥è‡ªå“ªä¸ªå¹³å°ï¼Œåªè¦éµå¾ªè¯¥åè®®ï¼Œå°±èƒ½äº’ç›¸é€šä¿¡ï¼Œæ›´é€‚åˆæ„å»ºè·¨å¹³å°çš„ AI å·¥å…·ç”Ÿæ€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09f22785def1433c9944ad077490eb7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKL6bG85LiN6YeN:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398107&amp;x-signature=iJtRDbHHhCd19tMMd5tqhUZVSTM%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AgentRunï¼šå±è”½åº•å±‚å¤æ‚æ€§ï¼Œè®©å¼€å‘è€…ä¸“æ³¨ AI ä¸šåŠ¡é€»è¾‘åˆ›æ–°ï¼]]></title>    <link>https://juejin.cn/post/7583906478328086547</link>    <guid>https://juejin.cn/post/7583906478328086547</guid>    <pubDate>2025-12-15T10:13:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906478328086547" data-draft-id="7583912899388522539" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AgentRunï¼šå±è”½åº•å±‚å¤æ‚æ€§ï¼Œè®©å¼€å‘è€…ä¸“æ³¨ AI ä¸šåŠ¡é€»è¾‘åˆ›æ–°ï¼"/> <meta itemprop="keywords" content="äº‘åŸç”Ÿ"/> <meta itemprop="datePublished" content="2025-12-15T10:13:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘äº‘åŸç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AgentRunï¼šå±è”½åº•å±‚å¤æ‚æ€§ï¼Œè®©å¼€å‘è€…ä¸“æ³¨ AI ä¸šåŠ¡é€»è¾‘åˆ›æ–°ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘äº‘åŸç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:13:19.000Z" title="Mon Dec 15 2025 10:13:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b179d77573d747a6978a1112427ef367~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398398&amp;x-signature=OEGSz3dtS2Se8ypPA8jrG7SNVAQ%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>AI Agent æ­£ä»æŠ€æœ¯æ¦‚å¿µå¿«æ­¥èµ°å‘ç”Ÿäº§åº”ç”¨ã€‚ç„¶è€Œï¼Œå½“å¼€å‘è€…è¯•å›¾å°†åŸå‹æ¨å‘ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œä¸€é“å·¨å¤§çš„â€œç”Ÿäº§åŒ–é¸¿æ²Ÿâ€éšä¹‹æ˜¾ç°ï¼šä¼—å¤šå¼€æºæ¡†æ¶è™½æä¾›äº†å¼ºå¤§çš„â€œå¤§è„‘â€ï¼Œå´ç¼ºå¤±äº†ä¼ä¸šçº§åº”ç”¨èµ–ä»¥ä¸ºç”Ÿçš„â€œåŸºç¡€è®¾æ–½â€ã€‚</p>
<p>å¼€å‘è€…å®ç°ä»â€œåŸå‹â€åˆ°â€œäº§å“â€çš„æ¯ä¸€æ­¥ï¼Œéƒ½å……æ»¡äº†åŸºç¡€è®¾æ–½çš„æŒ‘æˆ˜ã€‚è¦è·¨è¶Šè¿™é“é¸¿æ²Ÿï¼Œéœ€è¦çš„ä¸ä»…ä»…æ˜¯æ›´èªæ˜çš„æ¨¡å‹ï¼Œè€Œæ˜¯èƒ½å…¨é¢è§£å†³è¿™äº›é—®é¢˜çš„åŸºç¡€è®¾æ–½å¹³å°ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬å¼€å‘å‡½æ•°è®¡ç®— AgentRun çš„åˆè¡·ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä¼ä¸šçº§ Agent é¢ä¸´çš„ä¸‰ä¸ªç—›ç‚¹</h2>
<p><strong>1. æ‰§è¡Œç¯å¢ƒå¤æ‚ã€è¿ç»´å›°éš¾</strong></p>
<p>è¿è¡Œæ—¶ç¯å¢ƒä¸æ²™ç®±ä¸º Agent æä¾›éœ€è¦æ‰§è¡Œä»£ç ã€æ“ä½œæµè§ˆå™¨ã€è°ƒç”¨ç³»ç»Ÿèƒ½åŠ›ï¼Œå¾€å¾€ä¼šé¢ä¸´ä¸€ç³»åˆ—æŒ‘æˆ˜ï¼šé…ç½®å¤šè¯­è¨€ã€ç®¡ç†ä¾èµ–å’Œæ›´æ–°å®‰å…¨è¡¥ä¸ç­‰äº§ç”Ÿé«˜æ˜‚çš„ç»´æŠ¤è´Ÿæ‹…ï¼›ä¼ ç»Ÿè¿è¡Œç¯å¢ƒåœ¨å¤§è§„æ¨¡å¹¶å‘æ‰§è¡Œä¸‹çš„æ€§èƒ½ç“¶é¢ˆï¼›è„†å¼±çš„å®‰å…¨éš”ç¦»å¯èƒ½å¼•å‘æ•°æ®æ³„éœ²ç­‰é‡å¤§é£é™©ã€‚æ›´å…³é”®çš„æ˜¯ï¼Œæ—¥ç›Šå¤æ‚çš„ä¼šè¯çŠ¶æ€ç®¡ç†ä¹Ÿè®© Agent å¼€å‘å¤æ‚åº¦æŒ‡æ•°çº§å¢é•¿ã€‚</p>
<p><strong>2. å¤–éƒ¨ä¾èµ–ä¸ç¨³å®šã€æˆæœ¬é«˜</strong></p>
<p>å¤§æ¨¡å‹è°ƒç”¨ç¨³å®šæ€§æ˜¯ Agent åº”ç”¨çš„æœ€å¤§éšæ‚£ã€‚æ¨¡å‹å‚å•†çš„é™æµã€è¶…æ—¶ã€æœåŠ¡ä¸­æ–­æ—¶æœ‰å‘ç”Ÿï¼Œä¸€æ—¦ä¸»æ¨¡å‹å‡ºç°é—®é¢˜ï¼Œæ•´ä¸ªåº”ç”¨å°±ä¼šç˜«ç—ªã€‚åŒæ—¶ï¼ŒAgent éœ€è¦è°ƒç”¨å¤§é‡å·¥å…·å’Œ APIï¼Œæ¯ä¸ªå·¥å…·çš„é›†æˆéƒ½è¦å¤„ç†ä¸åŒçš„è°ƒç”¨æ–¹å¼ã€å‚æ•°æ ¼å¼ã€é‰´æƒé€»è¾‘ï¼Œå¼€å‘ç»´æŠ¤æˆæœ¬æé«˜ã€‚æ›´æ£˜æ‰‹çš„æ˜¯ï¼Œä¼ä¸šå¯¹æ¥å¤šä¸ªæ¨¡å‹å’Œå·¥å…·ï¼Œä½†ç¼ºä¹ç»Ÿä¸€çš„å®¹é”™å’Œæ²»ç†æœºåˆ¶ï¼Œæˆæœ¬å¿«é€Ÿç´¯åŠ å´éš¾ä»¥ä¼˜åŒ–ã€‚</p>
<p><strong>3. è¿è¡Œè¿‡ç¨‹çš„â€œé»‘ç›’â€çŠ¶æ€</strong></p>
<p>Agent åº”ç”¨çš„è°ƒç”¨é“¾è·¯å¤æ‚ï¼Œä»ç”¨æˆ·è¯·æ±‚åˆ°æ¨¡å‹æ¨ç†ã€çŸ¥è¯†åº“æ£€ç´¢ã€å·¥å…·è°ƒç”¨ã€MCP æ‰§è¡Œï¼Œä¸­é—´ç»è¿‡å¤šä¸ªç¯èŠ‚ä¸”å¯èƒ½åå¤è°ƒç”¨ã€‚ä»»ä½•ä¸€ä¸ªç¯èŠ‚çš„æ€§èƒ½ç“¶é¢ˆæˆ–é”™è¯¯éƒ½ä¼šå½±å“æœ€ç»ˆæ•ˆæœï¼Œä½†ä¼ ç»Ÿæ—¥å¿—å’Œç›‘æ§æ‰‹æ®µå¾ˆéš¾æ¸…æ™°è¿½è¸ªæ•´ä¸ªè¿‡ç¨‹ã€‚å¼€å‘è€…ä¸çŸ¥é“å“ªä¸ªç¯èŠ‚æ…¢ã€å“ªé‡Œå‡ºé”™ï¼Œè¿™ç§é»‘ç›’çŠ¶æ€è®©é—®é¢˜å®šä½å’Œæˆæœ¬ä¼˜åŒ–éƒ½æå…¶å›°éš¾ã€‚</p>
<p>æ˜¾ç„¶ï¼Œè¦è®© Agent åº”ç”¨çœŸæ­£è½åœ°ï¼Œå¼€å‘è€…è¿«åˆ‡éœ€è¦ä¸€ä¸ªèƒ½å±è”½åº•å±‚å¤æ‚æ€§ã€å…·å¤‡ä¸€ç«™å¼æ²»ç†èƒ½åŠ›çš„ä¸“ä¸šçº§åŸºç¡€è®¾æ–½å¹³å°ã€‚</p>
<h2 data-id="heading-1">å‡½æ•°è®¡ç®— AgentRun æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>ä¸€å¥è¯ä»‹ç»ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Ffc%3Fspm%3Da1z389.11499242.0.0.65452413RXCQWs%26utm_content%3Dg_1000408146" target="_blank" title="https://www.aliyun.com/product/fc?spm=a1z389.11499242.0.0.65452413RXCQWs&amp;utm_content=g_1000408146" ref="nofollow noopener noreferrer">å‡½æ•°è®¡ç®—</a> AgentRun æ˜¯ä¸€ä¸ªä»¥é«˜ä»£ç ä¸ºæ ¸å¿ƒçš„ä¸€ç«™å¼ Agentic AI åŸºç¡€è®¾æ–½å¹³å°ã€‚ç§‰æŒç”Ÿæ€å¼€æ”¾å’Œçµæ´»ç»„è£…çš„ç†å¿µï¼Œä¸ºä¼ä¸šçº§ Agent åº”ç”¨æä¾›ä»å¼€å‘ã€éƒ¨ç½²åˆ°è¿ç»´çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fa715f3d56a4a96a2465d6600d4ba4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398398&amp;x-signature=rjfMT87X4GrrQ0BY5dgkfYzSf9Q%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><em>å‡½æ•°è®¡ç®— AgentRun æ¶æ„å›¾</em></p>
<p>AgentRun è¿è¡Œæ—¶åŸºäº<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Ffc%3Fspm%3Da1z389.11499242.0.0.65452413RXCQWs%26utm_content%3Dg_1000408146" target="_blank" title="https://www.aliyun.com/product/fc?spm=a1z389.11499242.0.0.65452413RXCQWs&amp;utm_content=g_1000408146" ref="nofollow noopener noreferrer">é˜¿é‡Œäº‘å‡½æ•°è®¡ç®— FC</a> æ„å»ºï¼Œç»§æ‰¿äº† Serverless è®¡ç®—æè‡´å¼¹æ€§ã€æŒ‰é‡ä»˜è´¹ã€é›¶è¿ç»´çš„æ ¸å¿ƒä¼˜åŠ¿ã€‚é€šè¿‡æ·±åº¦é›†æˆ AgentScopeã€Langchainã€RAGFlowã€Mem0 ç­‰ä¸»æµå¼€æºç”Ÿæ€ã€‚AgentRun å°† Serverless çš„æè‡´å¼¹æ€§ã€é›¶è¿ç»´å’ŒæŒ‰é‡ä»˜è´¹çš„ç‰¹æ€§ä¸ AI åŸç”Ÿåº”ç”¨åœºæ™¯æ·±åº¦èåˆï¼ŒåŠ©åŠ›ä¼ä¸šå®ç°æˆæœ¬ä¸æ•ˆç‡çš„æè‡´ä¼˜åŒ–ï¼Œå¹³å‡ TCO é™ä½ 60%ã€‚Â </p>
<p><strong>è®©å¼€å‘è€…åªéœ€ä¸“æ³¨äº Agent çš„ä¸šåŠ¡é€»è¾‘åˆ›æ–°ï¼Œæ— éœ€å…³å¿ƒåº•å±‚åŸºç¡€è®¾æ–½ï¼Œè®© Agentic AI çœŸæ­£è¿›å…¥ä¼ä¸šç”Ÿäº§ç¯å¢ƒã€‚</strong></p>
<p>ç«‹å³ä½“éªŒ AgentRunï¼ˆå»ºè®® PC ç«¯æ‰“å¼€ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ffcnext.console.aliyun.com%2Fagent-run%2Fcn-hangzhou%2Fagent%2Fexplore" target="_blank" title="https://fcnext.console.aliyun.com/agent-run/cn-hangzhou/agent/explore" ref="nofollow noopener noreferrer">fcnext.console.aliyun.com/agent-run/câ€¦</a></p>
<h2 data-id="heading-2">äº”å¤§æ ¸å¿ƒèƒ½åŠ›ï¼Œè§£å†³ä¼ä¸šçº§ Agent ç”Ÿäº§åœºæ™¯éš¾é¢˜</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc962ee5fe38469faac690eb4f0946ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398398&amp;x-signature=y%2BKkS3YWbygV3KmhYf7NJgNQc0s%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><em>å¼€å‘è€…å¼€å‘â€” AgentRunâ€”ç”¨æˆ·ä½¿ç”¨</em></p>
<h3 data-id="heading-3">æ ¸å¿ƒåŠŸèƒ½ 1ï¼šæ¯«ç§’çº§æè‡´å¼¹æ€§ï¼ŒçœŸæ­£æŒ‰éœ€ä»˜è´¹</h3>
<p>AgentRun é’ˆå¯¹ Agent ç‰¹æ€§æ·±åº¦ä¼˜åŒ–ï¼Œå®ç°æ€§èƒ½ä¸æˆæœ¬çš„æè‡´å¹³è¡¡ã€‚</p>
<ul>
<li>æè‡´å¼¹æ€§ï¼šæ”¯æŒä» 0 åˆ°ç™¾ä¸‡çº§å¹¶å‘æè‡´å¼¹æ€§ï¼Œé…åˆå¿™é—²æ—¶ç²¾ç»†åŒ–è®¡è´¹ï¼Œå¤§å¹…é™ä½æˆæœ¬ã€‚</li>
<li>æµ…ä¼‘çœ ä¸æ·±ä¼‘çœ ï¼šé€šè¿‡è¯·æ±‚æ„ŸçŸ¥è°ƒåº¦ã€å®ä¾‹å†»ç»“ä»¥åŠå†…å­˜å¿«ç…§æŠ€æœ¯ï¼Œå®ç° Agent è¿è¡Œæ—¶ä¸æ²™ç®±åœ¨æ— è¯·æ±‚æ—¶è‡ªåŠ¨ä¼‘çœ ã€‚æµ…ä¼‘çœ Â 1 æ¯«ç§’æé€Ÿå”¤é†’å®ç°ç™¾å€æ€§èƒ½åŠ é€Ÿï¼Œæ€§èƒ½è¶…è¶Šä¼ ç»ŸæœåŠ¡å™¨ã€è™šæ‹Ÿæœºå’Œå®¹å™¨ç­‰ã€‚æ·±ä¼‘çœ å®ç°è¶…é•¿æ—¶é—´ä¼šè¯çŠ¶æ€æŒä¹…åŒ–ä»¥åŠç§’çº§å”¤é†’ã€‚</li>
<li>ä¼šè¯äº²å’Œï¼šå€ŸåŠ©ä¼šè¯äº²å’Œæœºåˆ¶å°†åŒä¸€ä¼šè¯ç²¾å‡†è·¯ç”±è‡³åŒä¸€å®ä¾‹ï¼Œçªç ´ Serverless æ— çŠ¶æ€é™åˆ¶ï¼Œä¸º Agent æä¾›æŒä¹…çš„æœ‰çŠ¶æ€ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œç¡®ä¿å¤æ‚å¤šè½®å¯¹è¯çš„æµç•…æ€§ã€‚</li>
</ul>
<h3 data-id="heading-4">æ ¸å¿ƒåŠŸèƒ½ 2ï¼šä¼ä¸šçº§å®‰å…¨æ²™ç®± Sandbox</h3>
<p>AgentRun æä¾› Code Interpreterã€Browser Toolã€All In One ç­‰å®‰å…¨æ²™ç®±ã€‚</p>
<ul>
<li>é«˜æ€§èƒ½æ‰§è¡Œç¯å¢ƒï¼šå†…ç½®å¼€ç®±å³ç”¨çš„å¤šè¯­è¨€æ‰§è¡Œå¼•æ“ä¸æµè§ˆå™¨è‡ªåŠ¨åŒ–å¼•æ“ï¼Œå¯æ‰§è¡Œæ•°æ®åˆ†æã€ç½‘é¡µæŠ“å–ã€è¡¨å•å¡«å†™ç­‰å¤æ‚ä»»åŠ¡ã€‚</li>
<li>ä¼ä¸šçº§å®‰å…¨ä¿éšœï¼šé€šè¿‡è¯·æ±‚ã€å®ä¾‹ã€ä¼šè¯å¤šç»´åº¦ç®—åŠ›éš”ç¦»ä¸åŠ¨æ€æŒ‚è½½æŠ€æœ¯ï¼Œç¡®ä¿æ•°æ®ã€èµ„æºå¼ºéš”ç¦»ï¼›æ”¯æŒç»†ç²’åº¦æƒé™æ§åˆ¶ä¸å®Œæ•´çš„æ—¥å¿—å®¡è®¡åŠŸèƒ½ã€‚</li>
</ul>
<h3 data-id="heading-5">æ ¸å¿ƒåŠŸèƒ½ 3ï¼šæ¨¡å‹ä¸å·¥å…·çš„ç»Ÿä¸€æ²»ç†</h3>
<ul>
<li>æ¨¡å‹æ²»ç†ï¼šé€šè¿‡ç»Ÿä¸€æ¨¡å‹ä»£ç†å±è”½ API å·®å¼‚ï¼Œæä¾›æ¨¡å‹ç†”æ–­ã€å¤šæ¨¡å‹ Fallback å’Œè´Ÿè½½å‡è¡¡ç­‰é«˜å¯ç”¨ä¿éšœï¼Œä»¥åŠå†…å®¹å®¡æ ¸ã€æ•æ„Ÿä¿¡æ¯è¿‡æ»¤ç­‰å®‰å…¨åˆè§„èƒ½åŠ›ã€‚</li>
<li>å·¥å…·æ²»ç†ï¼šé‡‡ç”¨ MCP æ ‡å‡†åŒ–å°è£…ï¼Œæ”¯æŒ MCP å’Œ Function Call åŒåè®®ï¼Œé€šè¿‡æ’ä»¶æœºåˆ¶æä¾›è‡ªå®šä¹‰ Hookã€æ™ºèƒ½è·¯ç”±ã€è¯­ä¹‰åˆ†æç­‰æ‰©å±•åŠŸèƒ½ã€‚</li>
</ul>
<h3 data-id="heading-6">æ ¸å¿ƒåŠŸèƒ½ 4ï¼šå…¨é“¾è·¯å¯è§‚æµ‹</h3>
<p>åŸºäºå…¨é“¾è·¯è¿½è¸ªæŠ€æœ¯ï¼ŒAgentRun å®ç°äº†ä»è¯·æ±‚åˆ°å“åº”çš„å®Œæ•´å¯è§†åŒ–ã€‚ç²¾å‡†è¿˜åŸ Agent çš„å†³ç­–è·¯å¾„ï¼ŒåŒ…æ‹¬æ„å›¾ç†è§£ã€æ¨¡å‹æ¨ç†ã€å·¥å…·è°ƒç”¨åŠçŸ¥è¯†æ£€ç´¢ç­‰æ ¸å¿ƒç¯èŠ‚ï¼Œå¹¶ç›´è§‚å±•ç¤ºæ¯ä¸€æ­¥çš„çŠ¶æ€ä¸è€—æ—¶ã€‚è¿™ä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆï¼Œå‘Šåˆ«ç›²ç›®è°ƒè¯•ï¼Œä»è€Œå¤§å¹…é™ä½ä¼˜åŒ–æˆæœ¬ã€‚</p>
<h3 data-id="heading-7">æ ¸å¿ƒåŠŸèƒ½ 5ï¼šç”Ÿæ€å¼€æ”¾ä¸å·¥ç¨‹åŒ–æ¼”è¿›</h3>
<p>æ‹¥æŠ±ç”Ÿæ€ã€å¼€æ”¾ä¸é”å®šæ˜¯ AgentRun çš„è®¾è®¡å“²å­¦ã€‚</p>
<ul>
<li>æ— ç¼é›†æˆä¸šç•Œä¸»æµé«˜ä»£ç æ¡†æ¶ï¼šåªéœ€å‡ è¡Œä»£ç ï¼Œå³å¯å°† AgentRun çš„åŸºç¡€è®¾æ–½é›†æˆåˆ°ä¸šç•Œä¸»æµé«˜ä»£ç æ¡†æ¶ï¼Œå¦‚ AgentScopeã€Langchainã€LlamaIndexã€CrewAIã€Google ADK ç­‰ã€‚</li>
<li>æ— ä»£ç åˆ°é«˜ä»£ç ä¸€é”®è½¬æ¢ï¼šæ”¯æŒæ— ä»£ç å¿«é€Ÿæ­å»º Agent å®ç°ä¸šåŠ¡æ•æ·è½åœ°ã€‚éšç€ä¸šåŠ¡å¤æ‚åº¦æå‡ï¼Œå¹³å°æ”¯æŒå°†å¯è§†åŒ–é…ç½®è½¬åŒ–ä¸ºå·¥ç¨‹åŒ–ä»£ç ï¼Œç»“æ„æ¸…æ™°ã€æ˜“äºç»´æŠ¤ï¼Œè½»æ¾å®ç°ä»æ— ä»£ç åˆ°é«˜ä»£ç çš„ä¸€é”®è½¬æ¢èƒ½åŠ›ï¼Œä»æ ¹æºä¸Šè§„é¿äº†é‡æ„å¸¦æ¥çš„æŠ€æœ¯å€ºåŠ¡ã€‚</li>
<li>æŠ€æœ¯è‡ªä¸»ä¸æ•°æ®å®‰å…¨ï¼šæ·±åº¦é›†æˆ LiteLLMã€Mem0ã€RagFlow ç­‰å¼€æºç”Ÿæ€ç»„ä»¶ï¼Œæä¾›äº‘ç«¯æ‰˜ç®¡æˆ–ç§æœ‰åŒ–éƒ¨ç½²ï¼Œç¡®ä¿æŠ€æœ¯è‡ªä¸»ä¸æ•°æ®å®‰å…¨ã€‚</li>
</ul>
<h2 data-id="heading-8">ä¸‰ä¸ªå®æµ‹åœºæ™¯ï¼šAgentRun èƒ½è§£å†³ä»€ä¹ˆå…·ä½“é—®é¢˜ï¼Ÿ</h2>
<h3 data-id="heading-9">åœºæ™¯1ï¼šä¸æ‡‚ä»£ç ï¼Œä½†å¸Œæœ›åˆ›å»ºç”Ÿäº§çº§ Agent</h3>
<p><em>â€œæˆ‘æ‡‚ä¸šåŠ¡ï¼Œä½†ä¸æ‡‚ä»£ç ï¼Œå°±åº”è¯¥è¢«æŒ¡åœ¨ AI åº”ç”¨å¼€å‘çš„å¤§é—¨ä¹‹å¤–å—ï¼Ÿâ€</em></p>
<p>AgentRun é€šè¿‡æ— ä»£ç /ä½ä»£ç ç”Ÿæˆ Agent çš„æ–¹å¼æ‰“ç ´æŠ€æœ¯å£å’ã€‚è®©ä¸šåŠ¡äººå‘˜æ— éœ€ç¼–å†™ä»»ä½•ä»£ç ï¼Œé€šè¿‡å¯è§†åŒ–ç•Œé¢æˆ–â€œä¸€å¥è¯æè¿°â€ï¼Œå°±èƒ½å³æ—¶åˆ›å»ºå‡ºåŠŸèƒ½å¼ºå¤§çš„ Agentã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªÂ Agentã€Sandbox éƒ½èƒ½ä»¥ MCP å½¢å¼æä¾›ï¼Œè®© Agent ä¸ä»…å¯ä»¥è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œä¹Ÿèƒ½è°ƒç”¨å…¶ä»– Agentï¼Œå®ç°åƒâ€œä¹é«˜â€ä¸€æ ·ç›¸äº’è°ƒç”¨çš„èƒ½åŠ›ï¼Œç»„åˆå‡ºæ›´å¤æ‚çš„åº”ç”¨ã€‚</p>
<p>ä¸ä»…å¦‚æ­¤ï¼Œéšç€ä¸šåŠ¡å¤æ‚åº¦çš„å‡çº§ï¼Œåªéœ€ä¸€é”®å³å¯å°†æ— ä»£ç  Agent è½¬æ¢ä¸ºé«˜ä»£ç  Agentã€‚æŠ€æœ¯å›¢é˜Ÿå¯ä»¥æ— ç¼æ¥æ‰‹è¿›è¡Œæ·±åº¦å¼€å‘ï¼Œå½»åº•è§£å†³äº†ä½ä»£ç å¹³å°å¸¸è§çš„â€œå¤©èŠ±æ¿â€é—®é¢˜ï¼Œå®ç°äº†ä»å¿«é€ŸéªŒè¯åˆ°ä¸“ä¸šå¼€å‘çš„å¹³æ»‘æ¼”è¿›ã€‚</p>
<h3 data-id="heading-10">åœºæ™¯2ï¼šæµé‡çªå¢ï¼ŒAgent æ¨¡å‹æœåŠ¡ä¸ç¨³å®š</h3>
<p><em>â€œæˆ‘ä¹‹å‰åšè¿‡å¾ˆå¤š AI åº”ç”¨ï¼Œæµé‡å°‘çš„æ—¶å€™è¿˜å¥½ï¼Œæµé‡ä¸€å¤šå°±å¤´ç–¼ï¼Œé™æµã€æ¬ è´¹ã€è¢«å°ï¼Œéšæ—¶ä¼šç˜«ç—ªã€‚â€</em></p>
<p>AgentRun é€šè¿‡æ¨¡å‹æ²»ç†ä¸º Agent åº”ç”¨æä¾›äº†ä¸€ä¸ªâ€œæ™ºèƒ½ä¿é™©ç³»ç»Ÿâ€ã€‚å½“ä¸»æ¨¡å‹å‡ºç°é—®é¢˜æ—¶ï¼Œå¹³å°ä¼šè‡ªåŠ¨ç†”æ–­å¹¶ç§’çº§åˆ‡æ¢åˆ°å¤‡ç”¨æ¨¡å‹ï¼Œå¤šçº§ Fallback æœºåˆ¶ä¿éšœç”Ÿäº§çº§ Agent é«˜å¯ç”¨ã€‚è‡ªåŠ¨ç›‘æ§æ¯ä¸ªæ¨¡å‹çš„å¯ç”¨æ€§ã€å“åº”æ—¶é—´ã€æˆåŠŸç‡ï¼Œæ™ºèƒ½é€‰æ‹©æœ€ä¼˜çš„æ¨¡å‹ã€‚è´Ÿè½½å‡è¡¡èƒ½åŠ›å¯ä»¥é…ç½®å¤šä¸ªæ¨¡å‹å®ä¾‹ï¼Œå°†æµé‡åˆ†å‘åˆ°ä¸åŒçš„è´¦å·ã€ä¸åŒçš„åŒºåŸŸï¼Œé¿å…å•ç‚¹è¿‡è½½ã€‚æˆæœ¬ç›‘æ§ä¼šå®æ—¶è¿½è¸ªæ¯ä¸ªæ¨¡å‹çš„è°ƒç”¨è´¹ç”¨ï¼Œå½“è´¹ç”¨æ¥è¿‘é˜ˆå€¼æ—¶è‡ªåŠ¨é¢„è­¦ï¼Œç”šè‡³å¯ä»¥è‡ªåŠ¨è§¦å‘é™æµæˆ–é™çº§ç­–ç•¥ã€‚å®‰å…¨å›´æ ä¼šåœ¨æ¨¡å‹è°ƒç”¨å‰åè‡ªåŠ¨è¿›è¡Œå†…å®¹å®¡æ ¸å’Œæ•æ„Ÿä¿¡æ¯è¿‡æ»¤ï¼Œç¡®ä¿åˆè§„æ€§ã€‚</p>
<h3 data-id="heading-11">åœºæ™¯3ï¼šå‡­è¯ç®¡ç†ï¼šé›¶ä¿¡ä»»ç¯å¢ƒä¸‹çš„åŠ¨æ€å‡­è¯æ³¨å…¥</h3>
<p><em>â€œå¦‚ä½•åœ¨ä¸æ³„éœ²ç”¨æˆ·å¯†é’¥ï¼ˆAccessKeyï¼‰çš„å‰æä¸‹ï¼Œè®© Agent å®‰å…¨åœ°è°ƒç”¨éœ€è¦æƒé™çš„å·¥å…·ï¼Ÿè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„å®‰å…¨æŒ‘æˆ˜ã€‚â€</em></p>
<p>AgentRun é¦–åˆ›çš„å‡­è¯ç®¡ç†åŠŸèƒ½ï¼Œé€šè¿‡ Hook æœºåˆ¶å®Œç¾è§£å†³æ ‡å‡† MCP åè®®ä¸æ”¯æŒåŠ¨æ€æ³¨å…¥çš„é—®é¢˜ï¼Œå®ƒå°±åƒä¸€ä¸ªâ€œå®‰å…¨ä¸­ä»‹â€ï¼Œåœ¨ Agent è°ƒç”¨å·¥å…·å‰ï¼ˆå‰ç½® Hookï¼‰ä¼šæ‹¦æˆªè¯·æ±‚ï¼Œæ ¹æ®ç”¨æˆ·èº«ä»½ä»å‡­è¯åº“ä¸­åŠ¨æ€æ³¨å…¥å¯†é’¥ï¼›åœ¨ä»»åŠ¡å®Œæˆåï¼ˆåç½® Hookï¼‰ç«‹å³æ¸…ç†æ‰€æœ‰æ•æ„Ÿä¿¡æ¯å¹¶è®°å½•å®¡è®¡æ—¥å¿—ã€‚æ•´ä¸ªè¿‡ç¨‹ï¼Œå¤§æ¨¡å‹å’Œå¤–éƒ¨ç¯å¢ƒå®Œå…¨æ¥è§¦ä¸åˆ°çœŸå®å¯†é’¥ï¼Œæ— æ‡ˆå¯å‡»ã€‚æ­¤å¤–ï¼ŒAgentRun æ”¯æŒå°†å¤šä¸ª API æ‰“åŒ…æˆä¸€ä¸ª MCP å·¥å…·ï¼Œé€šè¿‡è§„åˆ™è·¯ç”±å’Œæ™ºèƒ½è·¯ç”±èƒ½åŠ›ï¼ŒèŠ‚çº¦æˆæœ¬å’Œæå‡æ€§èƒ½ã€‚</p>
<h3 data-id="heading-12">å‡½æ•°è®¡ç®— AgentRun çš„è½åœ°å®è·µ</h3>
<ul>
<li>æ¨¡å‹æœåŠ¡ï¼šå‡½æ•°è®¡ç®—Â AgentRunä¸å›½å†…æœ€å¤§çš„ AI æ¨¡å‹ç¤¾åŒºÂ ModelScope é­”æ­æ·±åº¦åˆä½œã€‚é€šè¿‡ AgentRunï¼Œå¼€å‘è€…å¯å®ç°ä¸€é”®æ‰˜ç®¡ï¼Œæœ€å¿« 30 ç§’å°†å¼€æºæ¨¡å‹è½¬åŒ–ä¸ºç”Ÿäº§çº§å¯ç”¨ã€å…¼å®¹ OpenAI è§„èŒƒçš„ APIï¼Œæ— éœ€è¿›è¡Œç¹ççš„ç¯å¢ƒæ­å»ºå’Œéƒ¨ç½²ï¼Œå¤§å¹…åŠ é€Ÿäº†ä»æ¨¡å‹åˆ°åº”ç”¨çš„â€œæœ€åä¸€å…¬é‡Œâ€ã€‚å‰åˆ©/ææ°ªç­‰å¤´éƒ¨å‚å•†ï¼Œä¹Ÿå¤§é‡ä½¿ç”¨æ¨¡å‹è¿è¡Œæ—¶æ‰˜ç®¡æ–‡ç”Ÿå›¾ï¼Œæ–‡ç”Ÿè¯­éŸ³ç­‰é¢†åŸŸæ¨¡å‹ï¼Œæ”¯æ’‘æ™ºèƒ½åº§èˆ±ç­‰å…³é”®ä¸šåŠ¡ã€‚</li>
<li>æ™ºèƒ½ä½“åº”ç”¨ï¼šå‡½æ•°è®¡ç®— AgentRun æ”¯æ’‘å¤šå®¶è¡Œä¸šå¤´éƒ¨åŸºç¡€æ¨¡å‹å‚å•†ï¼Œæ„å»ºé¢å‘åƒä¸‡ç”¨æˆ·çš„ C ç«¯æ™ºèƒ½ä½“åº”ç”¨å¦‚ Z.aiã€‚é€šè¿‡ AgentRun æä¾›çš„è™šæ‹Ÿæœºçº§å®‰å…¨éš”ç¦»ã€å¤§è§„æ¨¡å®æ—¶å¼¹æ€§ä»¥åŠå¿™é—²æ™ºèƒ½è®¡è´¹ï¼Œå®Œç¾è§£å†³äº†ç¨€ç–è°ƒç”¨ä¸â€œçˆ†æ¬¾â€æµé‡å¹¶å­˜çš„å¤æ‚åœºæ™¯ï¼Œå®ç°äº†å®‰å…¨ã€ä½“éªŒä¸æˆæœ¬çš„æè‡´å¹³è¡¡ã€‚</li>
<li>AI å·¥å…·ç”Ÿæ€ï¼šå‡½æ•°è®¡ç®— AgentRunÂ ä¸ºé˜¿é‡Œäº‘ç™¾ç‚¼Â MCP Server æä¾› Serverless è¿è¡Œæ—¶åº•åº§ã€‚AgentRun çš„å®ä¾‹ç¼© 0 å’Œé—²ç½®è®¡è´¹ç­‰èƒ½åŠ›ï¼Œè®©è¿™äº›å·¥å…·æœåŠ¡åœ¨æ²¡æœ‰æµé‡æ—¶ï¼Œæˆæœ¬é™ä½ 85%ï¼Œç”šè‡³ä¸º 0ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒQwen æ¨¡å‹è®­ç»ƒä¸­çš„å¼ºåŒ–å­¦ä¹ ä»»åŠ¡ï¼Œé€šè¿‡å‡½æ•°è®¡ç®— Sandbox æ”¯æ’‘è„‰å†²å¼è´Ÿè½½ï¼Œå³°å€¼è§„æ¨¡è¾¾åˆ°æ•°åä¸‡æ ¸ã€‚</li>
</ul>
<h2 data-id="heading-13">ç«‹å³å¼€å§‹ï¼šä¸€æ­¥ä» Demo åˆ°ç”Ÿäº§</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6be9179e70554eeaaa2bcd72b181326b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398398&amp;x-signature=EoZI9nW4ZDdNOHqpQOLpK3eEPCA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<ul>
<li>AgentRun æ§åˆ¶å°ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ffunctionai.console.aliyun.com%2Fcn-hangzhou%2Fagent%2Fexplore" target="_blank" title="https://functionai.console.aliyun.com/cn-hangzhou/agent/explore" ref="nofollow noopener noreferrer">functionai.console.aliyun.com/cn-hangzhouâ€¦</a></li>
<li>åŠ å…¥â€œå‡½æ•°è®¡ç®— AgentRun å®¢æˆ·ç¾¤â€é’‰é’‰ç¾¤Â 134570017218Â </li>
</ul>
<h2 data-id="heading-14">æ€»ç»“&amp;å±•æœ›</h2>
<p>AgentRun çš„æ„¿æ™¯å¾ˆç®€å•ï¼š<strong>è®© AI Agent ä» Demo åˆ°ç”Ÿäº§çº§éƒ¨ç½²ï¼Œå˜å¾—å‰æ‰€æœªæœ‰çš„ç®€å•</strong>ã€‚é€šè¿‡ Serverless æ¶æ„æŒç»­ä¼˜åŒ–æˆæœ¬å¹¶è§£æ”¾è¿ç»´è´Ÿæ‹…ï¼Œé€šè¿‡ä¼ä¸šçº§ Runtime æä¾›ç”Ÿäº§çº§çš„æ‰§è¡Œç¯å¢ƒå’Œå®‰å…¨ä¿éšœï¼Œé€šè¿‡å¼€æºç”Ÿæ€é›†æˆé¿å…æ¡†æ¶é”å®šï¼Œé€šè¿‡å…¨é“¾è·¯å¯è§‚æµ‹è®©æ¯ä¸ªç¯èŠ‚éƒ½æ¸…æ™°å¯æ§â€”â€”è¿™å°±æ˜¯ AgentRun è¦ä¸ºä¼ä¸šæä¾›çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æˆ‘ä»¬æ·±çŸ¥ï¼ŒAgent åº”ç”¨çš„çœŸæ­£ä»·å€¼ï¼Œä¸åœ¨äºæ¼”ç¤ºæœ‰å¤šç‚«é…·ï¼Œè€Œåœ¨äºèƒ½å¦çœŸæ­£ç¨³å®šã€å®‰å…¨ã€é«˜æ•ˆåœ°ä¸ºä¼ä¸šåˆ›é€ ä»·å€¼ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬æ‰“é€  AgentRun çš„åˆå¿ƒï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æŒç»­æŠ•å…¥å’Œä¼˜åŒ–çš„æ–¹å‘ã€‚æ— è®ºæ‚¨æ˜¯æƒ³å¿«é€ŸéªŒè¯æƒ³æ³•çš„åˆ›ä¸šè€…ï¼Œè¿˜æ˜¯æ„å»ºä¼ä¸šçº§åº”ç”¨çš„å¼€å‘å›¢é˜Ÿï¼ŒAgentRun éƒ½å°†æ˜¯æ‚¨ä»ç¬¬ä¸€è¡Œä»£ç åˆ°ç™¾ä¸‡çº§ç”¨æˆ·ï¼Œå§‹ç»ˆå€¼å¾—ä¿¡èµ–çš„åŸºç¡€è®¾æ–½ä¼™ä¼´ã€‚</p>
<h2 data-id="heading-15">ä¸€å›¾çœ‹æ‡‚ AgentRun ğŸ‘‡</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01b75c8bcfc44001b306840ad84d376d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398398&amp;x-signature=bwVoPKake%2FLX1%2B%2FxTD62kbQ0wyg%3D" alt="å›¾ç‰‡" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[rustå¹¶å‘]]></title>    <link>https://juejin.cn/post/7583878719543558153</link>    <guid>https://juejin.cn/post/7583878719543558153</guid>    <pubDate>2025-12-15T09:54:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583878719543558153" data-draft-id="7581470169840713766" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="rustå¹¶å‘"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T09:54:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ²æ£®"/> <meta itemprop="url" content="https://juejin.cn/user/4455643804079608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            rustå¹¶å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4455643804079608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ²æ£®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:54:34.000Z" title="Mon Dec 15 2025 09:54:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»22åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><em><strong>å¹¶å‘æ˜¯ä¸€ç§åŒæ—¶å¤„ç†å¾ˆå¤šäº‹æƒ…çš„èƒ½åŠ›ï¼Œå¹¶è¡Œæ˜¯ä¸€ç§åŒæ—¶æ‰§è¡Œå¾ˆå¤šäº‹æƒ…çš„æ‰‹æ®µã€‚</strong></em></p>
<h3 data-id="heading-0">å¹¶å‘çŠ¶æ€ä¸‹å‡ ç§å¸¸è§çš„å·¥ä½œæ¨¡å¼ï¼šè‡ªç”±ç«äº‰æ¨¡å¼ã€map/reduce æ¨¡å¼ã€DAG æ¨¡å¼ï¼š</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3370dc45bcc4b739abfe21cb152ec19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5qOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766397275&amp;x-signature=FZnt1hXwPtAL9LVOOCsB0f920mQ%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨è‡ªç”±ç«äº‰æ¨¡å¼ä¸‹ï¼Œå¤šä¸ªå¹¶å‘ä»»åŠ¡ä¼šç«äº‰åŒä¸€ä¸ªä¸´ç•ŒåŒºçš„è®¿é—®æƒã€‚ä»»åŠ¡ä¹‹é—´åœ¨ä½•æ—¶ã€ä»¥ä½•
ç§æ–¹å¼å»è®¿é—®ä¸´ç•ŒåŒºï¼Œæ˜¯ä¸ç¡®å®šçš„ï¼Œæˆ–è€…è¯´æ˜¯æœ€ä¸ºçµæ´»çš„ï¼Œåªè¦åœ¨è¿›å…¥ä¸´ç•ŒåŒºæ—¶è·å¾—ç‹¬å 
è®¿é—®å³å¯ã€‚
åœ¨è‡ªç”±ç«äº‰çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é™åˆ¶å¹¶å‘çš„åŒæ­¥æ¨¡å¼ï¼Œå…¸å‹çš„æœ‰ map/reduce æ¨¡å¼å’Œ
DAG æ¨¡å¼ã€‚map/reduce æ¨¡å¼ï¼ŒæŠŠå·¥ä½œæ‰“æ•£ï¼ŒæŒ‰ç…§ç›¸åŒçš„å¤„ç†å®Œæˆåï¼Œå†æŒ‰ç…§ä¸€å®šçš„é¡ºåº
å°†ç»“æœç»„ç»‡èµ·æ¥ï¼›DAG æ¨¡å¼ï¼ŒæŠŠå·¥ä½œåˆ‡æˆä¸ç›¸äº¤çš„ã€æœ‰ä¾èµ–å…³ç³»çš„å­ä»»åŠ¡ï¼Œç„¶åæŒ‰ä¾èµ–å…³ç³»å¹¶å‘æ‰§è¡Œã€‚</p>
<p>è¿™ä¸‰ç§åŸºæœ¬æ¨¡å¼ç»„åˆèµ·æ¥ï¼Œå¯ä»¥å¤„ç†éå¸¸å¤æ‚çš„å¹¶å‘åœºæ™¯ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬å¤„ç†å¤æ‚é—®é¢˜çš„æ—¶å€™ï¼Œåº”è¯¥å…ˆå˜æ¸…å…¶è„‰ç»œï¼Œç”¨åˆ†æ²»çš„æ€æƒ³æŠŠé—®é¢˜æ‹†è§£æˆæ­£äº¤çš„å­é—®é¢˜ï¼Œç„¶åç»„åˆåˆé€‚çš„å¹¶å‘æ¨¡å¼æ¥å¤„ç†è¿™äº›å­é—®é¢˜ã€‚</p>
<h2 data-id="heading-1">å¹¶å‘åŸè¯­ Atomicã€Mutexã€Condvarã€Channel å’Œ Actor mode</h2>
<h3 data-id="heading-2">Atomic+Compare-and-swap(CAS) (åŸå­æ“ä½œ) â€”â€”Â  <strong>"æé€Ÿä¸”ç‹¬ç«‹çš„å°ä»»åŠ¡"</strong></h3>
<p>è¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯å¹¶å‘ç¼–ç¨‹ä¸­<strong>æœ€åº•å±‚ã€æœ€ç¡¬æ ¸</strong>çš„åŸºçŸ³</p>
<h2 data-id="heading-3">ä¸€ã€ Atomicï¼ˆåŸå­æ€§ï¼‰ï¼šè¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆä¸åš</h2>
<p><strong>1. é—®é¢˜çš„æ ¹æºï¼š<code>i++</code>Â å…¶å®æ˜¯ä¸ªè°è¨€</strong>Â åœ¨å†™ä»£ç æ—¶ï¼Œä½ å†™äº†ä¸€å¥Â <code>count = count + 1</code>ï¼ˆæˆ–è€…Â <code>count++</code>ï¼‰ï¼Œä½ è§‰å¾—è¿™æ˜¯ä¸€æ­¥æ“ä½œã€‚ ä½†åœ¨ CPU çœ¼é‡Œï¼Œè¿™å…¶å®æ˜¯<strong>ä¸‰æ­¥</strong>ï¼š</p>
<ol>
<li><strong>Read:</strong> Â æŠŠå†…å­˜é‡Œçš„Â <code>count</code>Â å€¼è¯»åˆ° CPU å¯„å­˜å™¨é‡Œï¼ˆæ¯”å¦‚è¯»åˆ° 0ï¼‰ã€‚</li>
<li><strong>Modify:</strong> Â åœ¨ CPU é‡ŒæŠŠè¿™ä¸ªå€¼åŠ  1ï¼ˆå˜æˆ 1ï¼‰ã€‚</li>
<li><strong>Write:</strong> Â æŠŠç®—å¥½çš„ 1 å†™å›å†…å­˜ã€‚</li>
</ol>
<p><strong>ææ€–æ•…äº‹ï¼š</strong> Â å¦‚æœçº¿ç¨‹ A å’Œçº¿ç¨‹ B åŒæ—¶åšè¿™ä»¶äº‹ï¼š</p>
<ul>
<li>A è¯»åˆ°äº† 0ã€‚</li>
<li>B åŒæ—¶ä¹Ÿè¯»åˆ°äº† 0ï¼ˆå› ä¸ºå®ƒè¿˜æ²¡æ¥å¾—åŠå˜ï¼‰ã€‚</li>
<li>A ç®—å‡º 1ï¼Œå†™å›å†…å­˜ã€‚</li>
<li>B ä¹Ÿç®—å‡º 1ï¼Œå†™å›å†…å­˜ã€‚</li>
<li><strong>ç»“æœï¼š</strong> Â æ˜æ˜åŠ äº†ä¸¤æ¬¡ï¼Œå†…å­˜é‡Œå´æ˜¯ 1ï¼Œè€Œä¸æ˜¯ 2ã€‚<strong>æ•°æ®â€œè¢«åäº†â€ã€‚</strong></li>
</ul>
<p><strong>2. Atomic çš„è¶…èƒ½åŠ›</strong>Â Atomicï¼ˆåŸå­æ“ä½œï¼‰å°±æ˜¯ä¸€ç§é­”æ³•ï¼Œå®ƒèƒ½å¼ºè¡ŒæŠŠé‚£â€œä¸‰æ­¥â€åˆå¹¶æˆ<strong>ä¸å¯åˆ†å‰²çš„ä¸€æ­¥</strong>ã€‚</p>
<ul>
<li>
<p><strong>æ¯”å–»ï¼šç¬ç§»ã€‚</strong></p>
<ul>
<li>æ™®é€šæ“ä½œåƒèµ°è·¯ï¼šä½ å¯èƒ½èµ°åˆ°ä¸€åŠè¢«ç»Šå€’ï¼Œæˆ–è€…è¢«äººæ’é˜Ÿã€‚</li>
<li>Atomic æ“ä½œåƒç¬ç§»ï¼šä½ è¦ä¹ˆè¿˜åœ¨åŸåœ°ï¼ˆæ“ä½œæ²¡å‘ç”Ÿï¼‰ï¼Œè¦ä¹ˆå·²ç»åˆ°äº†ç»ˆç‚¹ï¼ˆæ“ä½œå®Œæˆäº†ï¼‰ã€‚<strong>ä½ æ°¸è¿œä¸ä¼šå¤„äºâ€œåŠè·¯â€çš„çŠ¶æ€ã€‚</strong></li>
</ul>
</li>
</ul>
<p>åœ¨ Rust æˆ– C++ ä¸­ï¼Œå½“ä½ ä½¿ç”¨Â <code>AtomicI32</code>Â çš„Â <code>fetch_add</code>Â æ—¶ï¼ŒCPU ä¼šä¿è¯ï¼šæ— è®ºå¤šå°‘ä¸ªçº¿ç¨‹åŒæ—¶æŠ¢ï¼Œæœ€ååŠ å‡ºæ¥çš„æ•°ä¸€å®šæ˜¯å‡†çš„ã€‚</p>
<hr/>
<h3 data-id="heading-4">äºŒã€ CAS (Compare-and-Swap)ï¼šä¸€ç§â€œä¹è§‚â€çš„èµŒå¾’å¿ƒæ€</h3>
<p>Atomic æ˜¯<strong>ç»“æœ</strong>ï¼ˆæˆ‘ä»¬è¦å®ç°åŸå­æ€§ï¼‰ï¼Œé‚£ä¹ˆ CAS å°±æ˜¯å®ç°è¿™ä¸ªç»“æœçš„<strong>æ‰‹æ®µ</strong>ï¼ˆCPU æŒ‡ä»¤ï¼‰ã€‚</p>
<p>CAS å…¨ç§°æ˜¯Â <strong>Compare and Swapï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰</strong> ã€‚å®ƒæ˜¯æ— é”ç¼–ç¨‹ï¼ˆLock-freeï¼‰çš„æ ¸å¿ƒã€‚</p>
<h4 data-id="heading-5">1. å®ƒçš„é€»è¾‘æ˜¯è¿™æ ·çš„</h4>
<p>CAS æŒ‡ä»¤åŒ…å«ä¸‰ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><strong>å†…å­˜åœ°å€ (V)</strong> ï¼šä½ è¦æ”¹å“ªä¸ªå˜é‡ï¼Ÿ</li>
<li><strong>æœŸæœ›å€¼ (A)</strong> ï¼šä½ è§‰å¾—å®ƒç°åœ¨åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿï¼ˆæ—§å€¼ï¼‰</li>
<li><strong>æ–°å€¼ (B)</strong> ï¼šä½ æƒ³æŠŠå®ƒæ”¹æˆå¤šå°‘ï¼Ÿ</li>
</ul>
<p><strong>CAS çš„å¿ƒé‡Œè¯ï¼ˆç‹¬ç™½ï¼‰ï¼š</strong></p>
<blockquote>
<p>â€œæˆ‘è¦æŠŠåœ°å€ V é‡Œçš„æ•°æ®æ”¹æˆ Bã€‚ä½†æ˜¯ï¼Œ<strong>é™¤é</strong>åœ°å€ V é‡Œçš„æ•°æ®æ­£å¦‚æˆ‘æ‰€æ–™ï¼Œæ˜¯ Aï¼Œæˆ‘æ‰æ”¹ã€‚å¦‚æœæˆ‘å‘ç° V é‡Œçš„æ•°æ®ä¸æ˜¯ Aï¼ˆè¯´æ˜è¢«åˆ«äººæ”¹è¿‡äº†ï¼‰ï¼Œæˆ‘å°±ä¸æ”¹äº†ï¼Œå‘Šè¯‰æˆ‘å¤±è´¥ã€‚â€</p>
</blockquote>
<h4 data-id="heading-6">2. é€šä¿—æ¡ˆä¾‹ï¼š<strong>è¯•è¡£é—´ä¸æŒ‚ç‰Œ</strong></h4>
<p>æƒ³è±¡ä¸€ä¸ªè¯•è¡£é—´ï¼Œé—¨ä¸ŠæŒ‚ç€ç‰Œå­ï¼Œä¸Šé¢å†™ç€çŠ¶æ€ï¼ˆâ€œç©ºâ€ æˆ– â€œæœ‰äººâ€ï¼‰ã€‚</p>
<ul>
<li>
<p><strong>åœºæ™¯ï¼š</strong> Â ä½ æƒ³è¿›å»è¯•è¡£æœã€‚</p>
</li>
<li>
<p><strong>æ­¥éª¤ 1 (Read):</strong> Â ä½ çœ‹äº†ä¸€çœ¼ç‰Œå­ï¼Œå†™ç€â€œç©ºâ€ã€‚</p>
</li>
<li>
<p><strong>æ­¥éª¤ 2 (Calculate):</strong> Â ä½ å‡†å¤‡æŠŠç‰Œå­ç¿»æˆâ€œæœ‰äººâ€ã€‚</p>
</li>
<li>
<p><strong>æ­¥éª¤ 3 (CAS æ“ä½œ):</strong></p>
<ul>
<li>åœ¨ä½ ä¼¸æ‰‹å»ç¿»ç‰Œå­çš„ä¸€ç¬é—´ï¼ˆæçŸ­çš„æ—¶é—´ï¼‰ï¼Œä½ å¿…é¡»å†æ¬¡ç¡®è®¤ï¼š <strong>â€œç‰Œå­ç°åœ¨è¿˜æ˜¯â€˜ç©ºâ€™å­—å—ï¼Ÿâ€</strong></li>
<li><strong>æƒ…å†µä¸€ï¼ˆæˆåŠŸï¼‰ï¼š</strong> Â æ˜¯â€œç©ºâ€ã€‚å•ªï¼ä½ æŠŠå®ƒç¿»æˆäº†â€œæœ‰äººâ€ï¼Œä½ è¿›å»äº†ã€‚</li>
<li><strong>æƒ…å†µäºŒï¼ˆå¤±è´¥ï¼‰ï¼š</strong> Â å°±åœ¨ä½ ä½å¤´çš„ä¸€ç¬é—´ï¼Œåˆ«äººæŠ¢å…ˆå†²è¿›å»æŠŠç‰Œå­ç¿»æˆäº†â€œæœ‰äººâ€ã€‚ä½ ä¼¸æ‰‹æ—¶å‘ç°ç‰Œå­å·²ç»æ˜¯â€œæœ‰äººâ€äº†ï¼ˆä¸ä½ æœŸæœ›çš„â€œç©ºâ€ä¸ç¬¦ï¼‰ã€‚<strong>æ“ä½œå¤±è´¥ï¼Œä½ ä¸èƒ½ç¿»ç‰Œå­ã€‚</strong></li>
</ul>
</li>
</ul>
<h4 data-id="heading-7">3. å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿï¼ˆè‡ªæ—‹ Loopï¼‰</h4>
<p>CAS æœ€ç»å…¸çš„ä½¿ç”¨æ¨¡å¼æ˜¯<strong>é…åˆå¾ªç¯ï¼ˆLoopï¼‰</strong> ã€‚</p>
<p>å¦‚æœåœ¨è¯•è¡£é—´é—¨å£å¤±è´¥äº†ï¼ˆCAS è¿”å› Falseï¼‰ï¼Œä½ é€šå¸¸ä¸ä¼šå›å®¶ï¼Œè€Œæ˜¯ï¼š</p>
<ol>
<li><strong>é‡æ–°è¯»å–ï¼š</strong> Â çœ‹çœ‹ç°åœ¨ç‰Œå­æ˜¯ä»€ä¹ˆå­—ï¼ˆå“¦ï¼Œæ˜¯â€œæœ‰äººâ€ï¼‰ã€‚</li>
<li><strong>é‡æ–°æœŸæœ›ï¼š</strong> Â é‚£æˆ‘æœŸæœ›å®ƒå˜æˆâ€œç©ºâ€ï¼ˆç­‰é‡Œé¢äººå‡ºæ¥ï¼‰ã€‚</li>
<li><strong>å†æ¬¡å°è¯• CASï¼š</strong> Â ä¸€ç›´è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚</li>
</ol>
<p>è¿™åœ¨ä»£ç é‡Œå«Â <strong>CAS Loop</strong>Â æˆ–è€…Â <strong>è‡ªæ—‹ï¼ˆSpinï¼‰</strong> ã€‚</p>
<hr/>
<h3 data-id="heading-8">ä¸‰ã€ æ€»ç»“ï¼šAtomic å’Œ CAS çš„å…³ç³»</h3>
<ul>
<li><strong>Atomic</strong>Â æ˜¯æˆ‘ä»¬æƒ³è¦çš„<strong>å®‰å…¨æ„Ÿ</strong>ï¼ˆä¿è¯æ•°æ®ä¸ä¹±ï¼‰ã€‚</li>
<li><strong>CAS</strong>Â æ˜¯ CPU æä¾›çš„<strong>åº•å±‚æŒ‡ä»¤</strong>ï¼ˆæ¯”å¦‚ x86 çš„Â <code>cmpxchg</code>Â æŒ‡ä»¤ï¼‰ï¼Œç”¨æ¥æ„å»ºè¿™ç§å®‰å…¨æ„Ÿã€‚</li>
</ul>
<p><strong>å®ƒä»¬ä¸â€œé”â€çš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li><strong>Mutexï¼ˆé”ï¼‰ï¼š</strong> Â æ˜¯<strong>æ‚²è§‚</strong>çš„ã€‚å®ƒè§‰å¾—è‚¯å®šæœ‰äººæŠ¢ï¼Œæ‰€ä»¥å…ˆæŠŠé—¨é”æ­»ï¼Œè°ä¹Ÿåˆ«è¿›ï¼Œæˆ‘æ”¹å®Œäº†å†å¼€é—¨ã€‚ï¼ˆçº¿ç¨‹ä¼šç¡è§‰ï¼Œåˆ‡æ¢å¼€é”€å¤§ï¼‰</li>
<li><strong>CASï¼ˆåŸå­ï¼‰ï¼š</strong> Â æ˜¯<strong>ä¹è§‚</strong>çš„ã€‚å®ƒè§‰å¾—åº”è¯¥æ²¡äººæŠ¢ï¼Œæˆ‘ç›´æ¥å»æ”¹æ”¹çœ‹ã€‚å“å‘€è¢«æŠ¢äº†ï¼Ÿæ²¡äº‹ï¼Œæˆ‘é‡è¯•ä¸€æ¬¡ã€‚ï¼ˆçº¿ç¨‹ä¸€ç›´é†’ç€ï¼Œåœ¨ CPU ä¸Šç©ºè½¬ï¼Œå“åº”æå¿«ï¼Œä½†å¦‚æœå†²çªå¤ªå‰§çƒˆä¼šæµªè´¹ CPUï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-9">å››ã€ é‚£ä¸ªè‘—åçš„å‘ï¼šABA é—®é¢˜</h3>
<p>è®² CAS å¿…é¡»è®² ABAï¼Œè¿™æ˜¯é¢è¯•å¿…è€ƒé¢˜ï¼Œä¹Ÿæ˜¯é€»è¾‘æ¼æ´ã€‚</p>
<p><strong>æ¡ˆä¾‹ï¼šä½ çš„ç§æˆ¿é’±</strong>Â å‡è®¾ä½ æœ‰ä¸€ä¸ªé“ç›’å­ï¼Œé‡Œé¢å­˜äº†Â <strong>100 å—é’±</strong>ã€‚</p>
<ol>
<li>
<p><strong>ä½  (çº¿ç¨‹ A)</strong> Â çœ‹äº†ä¸€çœ¼ç›’å­ï¼šæœ‰ 100 å—ã€‚ä½ å‡†å¤‡å­˜æˆ 200 å—ã€‚ï¼ˆæœŸæœ› 100ï¼Œæ–°å€¼ 200ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å°±åœ¨è¿™æ—¶ï¼Œä½ è€å©† (çº¿ç¨‹ B)</strong> Â è¿‡æ¥ï¼š</p>
<ul>
<li>å¥¹æ‹¿èµ°äº† 100 å—å»ä¹°èœã€‚ï¼ˆç›’å­å˜ 0ï¼‰</li>
<li>å¥¹è§‰å¾—è‡ªå·±èŠ±å¤šäº†ï¼Œåˆä»è¿™ä¸€ç™¾å—é‡Œæ‰¾é›¶é’±æˆ–è€…å€Ÿé’±ï¼Œåˆæ”¾å›å»äº† 100 å—ã€‚ï¼ˆç›’å­å˜å› 100ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä½  (çº¿ç¨‹ A)</strong> Â å›è¿‡ç¥æ¥è¿›è¡Œ CAS æ“ä½œï¼š</p>
<ul>
<li>æ£€æŸ¥ç›’å­ï¼š<strong>å’¦ï¼Ÿè¿˜æ˜¯ 100 å—ï¼</strong> ï¼ˆç¬¦åˆæœŸæœ›å€¼ï¼‰</li>
<li><strong>CAS æˆåŠŸï¼</strong> Â ä½ æŠŠ 100 æ”¹æˆäº† 200ã€‚</li>
</ul>
</li>
</ol>
<p><strong>é—®é¢˜åœ¨å“ªï¼Ÿ</strong> Â è™½ç„¶é’±æ•°æ˜¯å¯¹çš„ï¼Œä½†<strong>è¿™ 100 å—å·²ç»ä¸æ˜¯åŸæ¥çš„ 100 å—äº†ï¼</strong> Â ç›’å­çš„çŠ¶æ€å…¶å®å‘ç”Ÿäº†å˜åŒ–ï¼ˆå¯èƒ½ä¸­é—´å¤¹å¸¦äº†ä¸€å¼ æ”¶æ®ï¼Œæˆ–è€…é’±çš„æ–°æ—§ç¨‹åº¦å˜äº†ï¼‰ã€‚</p>
<p><strong>åœ¨ç¼–ç¨‹ä¸­çš„å±å®³ï¼š</strong> Â å¦‚æœé‚£ä¸ªâ€œ100â€æ˜¯ä¸€ä¸ª<strong>å†…å­˜åœ°å€æŒ‡é’ˆ</strong>ï¼ŒABA é—®é¢˜å¯èƒ½å¯¼è‡´ä½ æŒ‡å‘äº†ä¸€ä¸ªå·²ç»è¢«é‡Šæ”¾åˆè¢«é‡æ–°åˆ†é…çš„å†…å­˜å—ï¼Œç¨‹åºä¼šç›´æ¥çˆ†ç‚¸ã€‚</p>
<p><strong>æ€ä¹ˆè§£å†³ï¼Ÿ</strong> Â åŠ ä¸ª<strong>ç‰ˆæœ¬å·</strong>ã€‚ ç›’å­ä¸å…‰å†™â€œ100â€ï¼Œè¿˜å†™ç€â€œç‰ˆæœ¬ 1â€ã€‚è€å©†åŠ¨è¿‡ä¹‹åï¼Œå˜æˆâ€œç‰ˆæœ¬ 2â€ã€‚ ä½  CAS çš„æ—¶å€™æ£€æŸ¥ï¼šæœŸæœ›æ˜¯â€œ100 ä¸” ç‰ˆæœ¬ 1â€ã€‚å¦‚æœå‘ç°æ˜¯â€œ100 ä¸” ç‰ˆæœ¬ 2â€ï¼Œå°±çŸ¥é“è¢«åŠ¨è¿‡äº†ã€‚</p>
<p>æˆ‘ä»¬æŠŠè¿™ä¸¤ç§æƒ…å†µï¼ˆè— vs ä¸è—ï¼‰å¯¹Â <strong>Atomic/CAS æ“ä½œçš„å…·ä½“å½±å“</strong>Â åšä¸€ä¸ªæ·±åº¦æ‹†è§£ã€‚</p>
<hr/>
<h3 data-id="heading-10">æƒ…å†µä¸€ï¼šä¸è—åœ¨æŒ‡é’ˆé‡Œï¼ˆå¤–æŒ‚ç‰ˆæœ¬å· -&gt; å˜æˆå®½æ•°æ®ï¼‰</h3>
<p>è¿™æ˜¯ä½ æœ€å…³å¿ƒçš„ç‚¹ã€‚å‡è®¾ä½ çš„æ•°æ®æœ¬èº«å°±æ˜¯ 64 ä½çš„ï¼ˆæ¯”å¦‚ä¸€ä¸ªæ•´æ•°Â <code>usize</code>ï¼‰ï¼Œä½ åˆç¡¬åŠ äº†ä¸€ä¸ª 64 ä½çš„Â <code>version</code>ã€‚ ç°åœ¨çš„æ€»æ•°æ®é‡æ˜¯ï¼š<strong>64ä½ + 64ä½ = 128ä½</strong>ã€‚</p>
<h4 data-id="heading-11">1. å¯¹ CPU ç¡¬ä»¶çš„å½±å“ï¼ˆè¿™æ˜¯æœ€å¤§çš„ç“¶é¢ˆï¼‰</h4>
<p>ç»å¤§å¤šæ•°æ™®é€š CPU çš„é€šç”¨å¯„å­˜å™¨åªæœ‰ 64 ä½å®½ã€‚</p>
<ul>
<li><strong>æ ‡å‡† CAS æŒ‡ä»¤ (<code>cmpxchg</code>)ï¼š</strong> Â ä¸€æ¬¡åªèƒ½æ¬è¿ 64 ä½ã€‚å®ƒæ ¹æœ¬æ¬ä¸åŠ¨ 128 ä½çš„æ•°æ®ã€‚</li>
<li><strong>å¼ºè¡Œæ¬è¿çš„åæœï¼š</strong> Â å¦‚æœä½ æ²¡æœ‰ç‰¹æ®ŠæŒ‡ä»¤æ”¯æŒï¼Œä½ æ— æ³•ä¿è¯è¿™ 128 ä½æ˜¯â€œåŒæ—¶â€å˜åŒ–çš„ã€‚å¯èƒ½æ”¹äº†å‰ 64 ä½ï¼Œå 64 ä½è¿˜æ²¡æ”¹ï¼Œè¿™æ—¶å€™åˆ«çš„çº¿ç¨‹è¯»è¿›æ¥ï¼Œæ•°æ®å°±è£‚å¼€äº†ï¼ˆTearingï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-12">2. è§£å†³æ–¹æ¡ˆï¼šå¿…é¡»åŠ¨ç”¨â€œé‡å‹æ­¦å™¨â€</h4>
<p>ä¸ºäº†å¤„ç†è¿™ç§ 128 ä½çš„æƒ…å†µï¼ŒCPU å‚å•†ï¼ˆIntel/AMD/ARMï¼‰æä¾›äº†ç‰¹æ®ŠæŒ‡ä»¤ï¼Œæ¯”å¦‚ x86 ä¸Šçš„Â <code>CMPXCHG16B</code>ï¼ˆCompare and Exchange 16 Bytesï¼‰ã€‚</p>
<ul>
<li><strong>å½±å“ A - å…¼å®¹æ€§é—®é¢˜ï¼š</strong> Â å¹¶ä¸æ˜¯æ‰€æœ‰ CPU éƒ½æ”¯æŒè¿™ä¸ªæŒ‡ä»¤ï¼ˆè™½ç„¶ç°ä»£æ¡Œé¢ CPU éƒ½æ”¯æŒï¼Œä½†åœ¨ä¸€äº›åµŒå…¥å¼æˆ–è€æ—§æ¶æ„ä¸Šä¼šç›´æ¥æŠ¥é”™ï¼‰ã€‚</li>
<li><strong>å½±å“ B - æ€§èƒ½å¼€é”€ï¼š</strong> Â è¿™ç§åŒå€å®½åº¦çš„åŸå­æ“ä½œï¼Œæ¯”æ™®é€šçš„ 64 ä½ CAS è¦æ…¢ä¸€äº›ï¼ˆè™½ç„¶è¿˜æ˜¯å¾ˆå¿«ï¼Œä½†åœ¨æé«˜å¹¶å‘ä¸‹èƒ½æµ‹å‡ºå·®è·ï¼‰ã€‚</li>
<li><strong>å½±å“ C - å†…å­˜å¯¹é½ï¼ˆAlignmentï¼‰ï¼š</strong> Â è¿™æ˜¯å¾ˆå¤š Rust/C++ å¼€å‘è€…çš„å™©æ¢¦ã€‚ä½¿ç”¨ 128 ä½åŸå­æ“ä½œæ—¶ï¼Œæ“ä½œç³»ç»Ÿè¦æ±‚è¿™ä¸ªå˜é‡åœ¨å†…å­˜ä¸­çš„åœ°å€å¿…é¡»æ˜¯Â <strong>16å­—èŠ‚å¯¹é½</strong>Â çš„ã€‚å¦‚æœæ²¡å¯¹é½ï¼ŒCPU ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºç›´æ¥å´©ç›˜ï¼ˆPanicï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-13">3. Rust ä¸­çš„ä½“ç°</h4>
<p>åœ¨ Rust ä¸­ï¼Œå¦‚æœä½ æƒ³åšè¿™ç§æ“ä½œï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨Â <code>AtomicU128</code>ï¼ˆç›®å‰åœ¨æŸäº›å¹³å°ä¸Šè¿˜æ˜¯ä¸ç¨³å®šç‰¹æ€§Â <code>unstable</code>ï¼Œæˆ–è€…éœ€è¦ç‰¹å®š CPU feature å¼€å¯ï¼‰ã€‚</p>
<hr/>
<h3 data-id="heading-14">æƒ…å†µäºŒï¼šè—åœ¨æŒ‡é’ˆé‡Œï¼ˆPointer Tagging / å‹ç¼©æµï¼‰</h3>
<p>è¿™å°±æ˜¯æ‰€è°“çš„â€œæŠŠç‰ˆæœ¬å·å¡è¿›æŒ‡é’ˆæ²¡ç”¨çš„ä½é‡Œâ€ã€‚</p>
<h4 data-id="heading-15">1. ä¸ºä»€ä¹ˆèƒ½è—ï¼Ÿ</h4>
<p>ç°åœ¨çš„ 64 ä½ç”µè„‘ï¼ˆx86-64ï¼‰ï¼Œè™½ç„¶æŒ‡é’ˆä¹Ÿæ˜¯ 64 ä½é•¿ï¼Œä½†å…¶å®åªç”¨äº†<strong>ä½ 48 ä½</strong>æ¥å¯»å€ï¼Œ<strong>é«˜ 16 ä½</strong>å…¨æ˜¯ 0ï¼ˆæˆ–è€…å…¨æ˜¯ 1ï¼‰ã€‚</p>
<h4 data-id="heading-16">2. å¯¹ Atomic/CAS çš„å½±å“ï¼ˆæå°ï¼‰</h4>
<ul>
<li>
<p><strong>ç¡¬ä»¶å±‚é¢ï¼š</strong> Â å› ä¸ºä½ æŠŠç‰ˆæœ¬å·å¡è¿›å»äº†ï¼Œæ•´ä½“é•¿åº¦<strong>ä¾ç„¶æ˜¯ 64 ä½</strong>ã€‚ æ‰€ä»¥ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨æœ€æ™®é€šã€æœ€å¿«ã€å…¼å®¹æ€§æœ€å¥½çš„æ ‡å‡† CAS æŒ‡ä»¤ã€‚<strong>ç¡¬ä»¶æ¯«æ— å‹åŠ›ã€‚</strong></p>
</li>
<li>
<p><strong>ä»£ç å±‚é¢ï¼ˆè¿™æ˜¯éº»çƒ¦ç‚¹ï¼‰ï¼š</strong> Â å½±å“åœ¨äº<strong>ä½ å–æ•°æ®çš„æ—¶å€™</strong>ã€‚</p>
<ul>
<li><strong>å­˜çš„æ—¶å€™ï¼š</strong> Â è¦åšä½è¿ç®—ï¼ˆæ‹¼è£…ï¼‰ï¼š<code>ptr | (version &lt;&lt; 48)</code></li>
<li><strong>å–çš„æ—¶å€™ï¼š</strong> Â è¦åšä½è¿ç®—ï¼ˆæ‹†è§£ï¼‰ï¼š<code>val &amp; 0x0000FFFFFFFFFFFF</code></li>
<li><strong>å¦‚æœä½ å¿˜äº†æ‹†ï¼š</strong> Â ç›´æ¥æ‹¿è¿™ä¸ªå¸¦è„æ•°æ®çš„æŒ‡é’ˆå»è¯»å†…å­˜ï¼Œ<strong>ç¨‹åºç«‹åˆ»æ®µé”™è¯¯ï¼ˆSegFaultï¼‰å´©æºƒ</strong>ï¼Œå› ä¸ºå®ƒæŒ‡å‘äº†ä¸€ä¸ªä¸å­˜åœ¨çš„éæ³•åœ°å€ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-17">3. ç‰ˆæœ¬å·æº¢å‡ºé£é™©</h4>
<p>å› ä¸ºåªæœ‰ 16 ä½ç©ºé—´ç»™ä½ è—ï¼Œç‰ˆæœ¬å·æœ€å¤šåˆ° 65535ã€‚å¦‚æœé«˜å¹¶å‘ä¸‹å˜åŒ–æå¿«ï¼Œç‰ˆæœ¬å·ç¬é—´è½¬å®Œä¸€åœˆå›åˆ° 0ï¼Œ<strong>ABA é—®é¢˜ä¼šå¤æ´»</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-18">æƒ…å†µä¸‰ï¼šå¦‚æœæˆ‘åˆä¸æƒ³è—ï¼ŒCPU åˆä¸æ”¯æŒ 128 ä½æ€ä¹ˆåŠï¼Ÿ</h3>
<p>è¿™å°±æ˜¯<strong>æœ€å¤§çš„å½±å“</strong>â€”â€”ä½ <strong>ä¸èƒ½</strong>å†å•çº¯ç”¨ CAS äº†ã€‚</p>
<p>å¾ˆå¤šåˆå­¦è€…ä¼šæƒ³ï¼šâ€œæˆ‘èƒ½ä¸èƒ½æä¸¤ä¸ª Atomic å˜é‡ï¼Œä¸€ä¸ªå­˜é’±ï¼Œä¸€ä¸ªå­˜ç‰ˆæœ¬ï¼Ÿâ€</p>
<p>Rust</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">struct</span> <span class="hljs-string">SafeMoney</span> {
    <span class="hljs-attr">money:</span> <span class="hljs-string">AtomicU64</span>,
    <span class="hljs-attr">version:</span> <span class="hljs-string">AtomicU64</span>,
}
</code></pre>
<p><strong>ç»å¯¹ä¸è¡Œï¼</strong> Â å› ä¸ºä½ æ— æ³•<strong>åŒæ—¶</strong>é”ä½è¿™ä¸¤ä¸ªå˜é‡ã€‚</p>
<ol>
<li>çº¿ç¨‹ A æ”¹äº†Â <code>money</code>Â (CAS æˆåŠŸ)ã€‚</li>
<li><strong>ï¼ˆæ—¶é—´é—´éš™ï¼‰</strong> Â çº¿ç¨‹ B è¯»äº†Â <code>money</code>ã€‚</li>
<li>çº¿ç¨‹ A æ”¹äº†Â <code>version</code>ã€‚</li>
</ol>
<p>åœ¨è¿™ä¸ªâ€œæ—¶é—´é—´éš™â€é‡Œï¼Œæ•°æ®å¤„äº<strong>ä¸ä¸€è‡´</strong>çŠ¶æ€ã€‚è¿™å°±ä¸æ˜¯åŸå­æ“ä½œäº†ã€‚</p>
<p><strong>æ­¤æ—¶çš„å”¯ä¸€è§£æ³•ï¼š</strong> Â é€€å›åˆ°ä½¿ç”¨Â <code>Mutex</code>ï¼ˆäº’æ–¥é”ï¼‰ã€‚å“ªæ€•å†æ…¢ï¼Œä¹Ÿå¾—ç”¨é”æŠŠè¿™ä¸¤ä¸ªå˜é‡åŒ…èµ·æ¥ï¼Œå˜æˆä¸€ä¸ªæ•´ä½“ã€‚</p>
<h3 data-id="heading-19">æ€»ç»“ï¼šCAS å¯¹ Atomic çš„å½±å“è¡¨</h3>








































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>æ•°æ®å½¢æ€</th><th>ç¡¬ä»¶ CAS æŒ‡ä»¤</th><th>å½±å“/ä»£ä»·</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>æ ‡å‡† CAS</strong></td><td>ä»…æ•°æ® (64ä½)</td><td>æ™®é€šÂ <code>cmpxchg</code></td><td><strong>æ— </strong>ã€‚æœ€å¿«ï¼ŒåŸç”Ÿæ”¯æŒã€‚</td><td>ä¸æ‹…å¿ƒ ABA çš„ç®€å•è®¡æ•°å™¨</td></tr><tr><td><strong>æŒ‡é’ˆæ ‡è®°</strong></td><td>æ•°æ®+ç‰ˆæœ¬æŒ¤åœ¨ 64ä½é‡Œ</td><td>æ™®é€šÂ <code>cmpxchg</code></td><td><strong>ä»£ç å¤æ‚</strong>ã€‚éœ€è¦ä½è¿ç®—ï¼Œç‰ˆæœ¬å·ç©ºé—´å°ã€‚</td><td>é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ— (Treiber Stack)</td></tr><tr><td><strong>åŒå®½ CAS</strong></td><td>æ•°æ®+ç‰ˆæœ¬ = 128ä½</td><td>ç‰¹æ®ŠÂ <code>cmpxchg16b</code></td><td><strong>å…¼å®¹æ€§/å¯¹é½</strong>ã€‚éƒ¨åˆ†å¹³å°ä¸æ”¯æŒï¼Œå¿…é¡»16å­—èŠ‚å¯¹é½ã€‚</td><td>éœ€è¦å®Œæ•´ç‰ˆæœ¬å·çš„å¤æ‚ç»“æ„</td></tr><tr><td><strong>åˆ†å¼€å­˜</strong></td><td>æ•°æ® Atomic, ç‰ˆæœ¬ Atomic</td><td><strong>æ— </strong>Â (åšä¸åˆ°)</td><td><strong>é€»è¾‘é”™è¯¯</strong>ã€‚æ— æ³•ä¿è¯ä¸¤è€…åŒæ—¶å˜ã€‚</td><td><strong>ä¸å¯ç”¨</strong>ï¼Œå¿…é¡»æ¢æˆé”</td></tr></tbody></table>
<p>æ‰€ä»¥ï¼Œä½ åœ¨è®¾è®¡ Rust é«˜å¹¶å‘ç»“æ„æ—¶ï¼Œå¦‚æœèƒ½ç”¨Â <strong>Pointer Taggingï¼ˆè—åœ¨æŒ‡é’ˆé‡Œï¼‰</strong> Â æ˜¯æœ€é«˜æ•ˆçš„ï¼›å¦‚æœè—ä¸ä¸‹ï¼Œå°±è¦è€ƒè™‘èƒ½ä¸èƒ½ç”¨Â <code>AtomicU128</code>ï¼›å¦‚æœè¿˜ä¸è¡Œï¼Œå°±è€è€å®å®ç”¨Â <code>Mutex</code>Â å§ã€‚</p>
<h2 data-id="heading-20">äºŒ. Mutex</h2>
<p>ç²¾å‡†åœ°æ¦‚æ‹¬ç°ä»£ Mutexï¼ˆäº’æ–¥é”ï¼‰çš„ä¸¤ä¸ªæ ¸å¿ƒç—›ç‚¹ï¼š <strong>â€œå…¬å¹³æ€§é—®é¢˜â€</strong> Â å’ŒÂ  <strong>â€œåº•å±‚å®ç°åŸç†â€</strong> ã€‚</p>
<p>ä¸ºäº†è®©ä½ å½»åº•ç†è§£è¿™æ®µè¯ï¼Œæˆ‘ä»¬ç»§ç»­ç”¨ç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥æ‹†è§£ã€‚æˆ‘ä»¬å°†åœºæ™¯è®¾å®šä¸ºï¼š<strong>åªæœ‰ä¸€æŠŠé’¥åŒ™çš„å…¬å…±ä¼‘æ¯å®¤</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-21">ä¸€ã€ ä¸ºä»€ä¹ˆä¼šæœ‰â€œä¸å…¬å¹³â€ï¼Ÿï¼ˆSpin vs. Waitï¼‰</h3>
<p>æåˆ°çš„ç¬¬ä¸€æ®µè¯æè¿°äº†ä¸€ä¸ªéå¸¸ç»å…¸çš„**â€œæ’é˜Ÿâ€**ï¼ˆBargingï¼‰ç°è±¡ã€‚</p>
<h4 data-id="heading-22">1. è§’è‰²åˆ†é…</h4>
<ul>
<li><strong>ä¼‘æ¯å®¤ï¼ˆCritical Sectionï¼‰ï¼š</strong> Â è¢«ä¿æŠ¤çš„æ•°æ®/ä»£ç ã€‚</li>
<li><strong>é’¥åŒ™ï¼ˆLockï¼‰ï¼š</strong> Â Mutexã€‚</li>
<li><strong>è€ç‹ï¼ˆæŒæœ‰é”çš„çº¿ç¨‹ï¼‰ï¼š</strong> Â æ­£åœ¨ä¼‘æ¯å®¤é‡Œä¼‘æ¯ã€‚</li>
<li><strong>å°æï¼ˆç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼‰ï¼š</strong> Â ä¹‹å‰æ¥äº†å‘ç°æ²¡é’¥åŒ™ï¼Œè¢«æŒ‚èµ·ï¼ˆSleepingï¼‰ï¼Œååœ¨é—¨å£çš„é•¿æ¤…ä¸Šç¡ç€äº†ã€‚</li>
<li><strong>å°å¼ ï¼ˆæ–°æ¥çš„ Spin çº¿ç¨‹ï¼‰ï¼š</strong> Â åˆšåˆšåˆ°è¾¾ï¼Œç²¾åŠ›æ—ºç››ï¼Œæ­£åœ¨é—¨å£è½¬æ‚ ï¼ˆSpinningï¼‰ï¼Œè¿˜æ²¡å»é•¿æ¤…ä¸Šç¡è§‰ã€‚</li>
</ul>
<h4 data-id="heading-23">2. å‰§æƒ…æ¼”ç»ï¼šç”±äºâ€œæ—¶æœºå·§åˆâ€å¯¼è‡´çš„æ’é˜Ÿ</h4>
<ol>
<li><strong>è€ç‹å‡ºæ¥äº†ï¼š</strong> Â ä»–æ¨å¼€é—¨ï¼Œå¤§å–Šä¸€å£°ï¼šâ€œæˆ‘å¥½äº†ï¼Œè°æ˜¯ä¸‹ä¸€ä¸ªï¼Ÿâ€ï¼ˆè¿™æ˜¯ Mutex å”¤é†’é˜Ÿåˆ—çš„æ“ä½œï¼‰ã€‚</li>
<li><strong>å°æè¢«å”¤é†’ï¼š</strong> Â ç¡åœ¨é•¿æ¤…ä¸Šçš„å°æè¿·è¿·ç³Šç³Šåœ°çå¼€çœ¼ï¼Œå‡†å¤‡èµ·èº«ï¼Œä¼¸ä¸ªæ‡’è…°ï¼Œèµ°å‘é—¨å£ã€‚ï¼ˆ<strong>æ³¨æ„ï¼š</strong> Â ä»ç¡çœ åˆ°å”¤é†’å†åˆ°æŠ¢é”ï¼Œéœ€è¦æ“ä½œç³»ç»Ÿä»‹å…¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å«<strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ï¼Œè™½ç„¶å¾ˆå¿«ï¼Œä½†éœ€è¦æ—¶é—´ï¼Œæ¯”å¦‚ 5 å¾®ç§’ï¼‰ã€‚</li>
<li><strong>å°å¼ çš„éªšæ“ä½œï¼š</strong> Â å°±åœ¨è€ç‹åˆšæ‰”ä¸‹é’¥åŒ™ã€å°æè¿˜æ²¡å®Œå…¨ç«™èµ·æ¥çš„è¿™Â <strong>0.1 ç§’</strong>Â é—´éš™é‡Œï¼Œ<strong>ä¸€ç›´åœ¨é—¨å£è½¬æ‚ çš„å°å¼ </strong>çœ¼ç–¾æ‰‹å¿«ï¼Œä¸€æŠŠæŠ“ä½äº†é’¥åŒ™å†²è¿›äº†ä¼‘æ¯å®¤ï¼</li>
<li><strong>ç»“æœï¼š</strong> Â ç­‰å°æç»ˆäºèµ°åˆ°é—¨å£ï¼Œå‘ç°é—¨åˆé”äº†ï¼å°æå¿ƒæ€å´©äº†ï¼Œåªèƒ½å›åˆ°é•¿æ¤…ä¸Šç»§ç»­ç¡ã€‚</li>
</ol>
<h4 data-id="heading-24">3. ä¸ºä»€ä¹ˆé»˜è®¤ Mutex å…è®¸è¿™æ ·ï¼Ÿ</h4>
<p>ä¼šè§‰å¾—è¿™ä¸å…¬å¹³ï¼Œå°å¼ æ˜æ˜åˆšæ¥ï¼Œå‡­ä»€ä¹ˆæ’é˜Ÿï¼Ÿ ä½†åœ¨è®¡ç®—æœºçœ¼é‡Œï¼Œ<strong>è¿™ä¸ºäº†æ•ˆç‡ï¼ˆååé‡ï¼‰</strong> ã€‚</p>
<ul>
<li>å”¤é†’å°æéœ€è¦æ—¶é—´ï¼ˆCPU åˆ‡æ¢å¼€é”€ï¼‰ã€‚</li>
<li>å°å¼ å·²ç»åœ¨ CPU ä¸Šè·‘ç€äº†ï¼ˆçƒ­æ•°æ®ï¼‰ã€‚</li>
<li>è®©å°å¼ å…ˆæŠŠæ´»å¹²å®Œï¼ŒCPU å°±ä¸éœ€è¦ç©ºè½¬ç­‰å¾…å°æé†’æ¥ã€‚<strong>æ•´ä½“ä¸Šï¼Œä¼‘æ¯å®¤çš„ä½¿ç”¨ç‡æ›´é«˜äº†ã€‚</strong></li>
</ul>
<hr/>
<h3 data-id="heading-25">äºŒã€Â <code>parking_lot</code>Â çš„ Fair Mutex æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>æåˆ°çš„Â <code>parking_lot</code>Â æ˜¯ Rust ä¸­ä¸€ä¸ªæ€§èƒ½æå¼ºçš„å¹¶å‘åº“ã€‚å®ƒæä¾›çš„Â <strong>Fair Mutexï¼ˆå…¬å¹³é”ï¼‰</strong> Â å°±æ˜¯ä¸ºäº†æ•´æ²»å°å¼ è¿™ç§â€œæ’é˜Ÿâ€è¡Œä¸ºã€‚</p>
<h4 data-id="heading-26">1. å®ƒçš„è§„åˆ™ï¼šä¸¥æ ¼æ’é˜Ÿ</h4>
<p>åœ¨ Fair Mutex æ¨¡å¼ä¸‹ï¼Œè§„åˆ™å˜äº†ï¼š</p>
<ul>
<li>å½“è€ç‹æ‰”å‡ºé’¥åŒ™æ—¶ï¼Œä»–ä¸æ˜¯æŠŠé’¥åŒ™æ‰”åœ¨åœ°ä¸Šè°æŠ¢åˆ°ç®—è°çš„ã€‚</li>
<li>ä»–æ˜¯<strong>ç›´æ¥æŠŠé’¥åŒ™é€’ç»™é•¿æ¤…ä¸Šçš„ç¬¬ä¸€ä½ï¼ˆå°æï¼‰</strong> ã€‚</li>
<li>æˆ–è€…ï¼Œå³ä½¿é’¥åŒ™åœ¨åœ°ä¸Šï¼Œ<strong>æ–°æ¥çš„å°å¼ </strong>å¦‚æœçœ‹åˆ°é•¿æ¤…ä¸Šæœ‰äººåç€ï¼Œ<strong>å¿…é¡»</strong>è‡ªè§‰å»é•¿æ¤…åé¢æ’é˜Ÿï¼Œç»å¯¹ä¸å…è®¸å»æŠ¢é’¥åŒ™ã€‚</li>
</ul>
<h4 data-id="heading-27">2. ä»£ä»·</h4>
<ul>
<li><strong>ä¼˜ç‚¹ï¼š</strong> Â ç»å¯¹å…¬å¹³ï¼ˆFIFOï¼‰ï¼Œå…ˆæ¥ååˆ°ï¼Œä¸ä¼šå‡ºç°å°ææ°¸è¿œæŠ¢ä¸åˆ°é”é¥¿æ­»ï¼ˆStarvationï¼‰çš„æƒ…å†µã€‚</li>
<li><strong>ç¼ºç‚¹ï¼š</strong> Â å¯èƒ½ä¼šç¨å¾®æ…¢ä¸€ç‚¹ç‚¹ï¼Œå› ä¸ºå¿…é¡»è¦ç­‰å°æé†’è¿‡æ¥ï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€æ— æ³•é¿å…äº†ï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-28">ä¸‰ã€ Mutex ä¸ Atomic çš„å…³ç³»ï¼šå¤§é”åŒ…å°é”</h3>
<p>æåˆ°çš„æœ€åä¸€å¥éå¸¸æœ‰æ·±åº¦ï¼š <em>â€œä½ å¯ä»¥æŠŠ Mutex æƒ³è±¡æˆä¸€ä¸ªç²’åº¦æ›´å¤§çš„ atomicï¼Œåªä¸è¿‡è¿™ä¸ª atomic ä¸æ˜¯ cpu ä¿è¯çš„ï¼Œè€Œæ˜¯è½¯ä»¶ç®—æ³•å®ç°çš„ã€‚â€</em></p>
<p>è¿™å¥è¯æ­ç¤ºäº† Mutex çš„<strong>æœ¬è´¨æ¶æ„</strong>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠ Mutex çœ‹ä½œä¸€ä¸ª<strong>æ´‹è‘±ç»“æ„</strong>ï¼Œç”±å†…è€Œå¤–åˆ†ä¸ºä¸¤å±‚ï¼š</p>
<h4 data-id="heading-29">1. å†…æ ¸ï¼ˆç¡¬ä»¶å±‚ï¼‰ï¼šAtomic</h4>
<p>Mutex çš„æœ€æ ¸å¿ƒéƒ¨åˆ†ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„Â <strong>Atomic Bool</strong>ï¼ˆæˆ–è€… Atomic Integerï¼‰ã€‚</p>
<ul>
<li><strong>ä½œç”¨ï¼š</strong> Â ä»…ä»…ç”¨æ¥æ ‡è®°â€œæœ‰äººâ€è¿˜æ˜¯â€œæ²¡äººâ€ã€‚</li>
<li><strong>æ“ä½œï¼š</strong> Â ä½¿ç”¨ CPU çš„Â <code>CAS</code>Â æŒ‡ä»¤ç¬é—´æŠŠÂ <code>0</code>Â æ”¹æˆÂ <code>1</code>ã€‚</li>
<li><strong>å±€é™ï¼š</strong> Â å®ƒåªèƒ½å‘Šè¯‰ä½ â€œæ”¹æˆåŠŸäº†â€è¿˜æ˜¯â€œå¤±è´¥äº†â€ã€‚å¦‚æœå¤±è´¥äº†ï¼Œå®ƒä¸ç®¡ä½ ï¼Œä½ åªèƒ½ä¸åœåœ°è¯•ï¼ˆSpinï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-30">2. å¤–å£³ï¼ˆè½¯ä»¶/ç³»ç»Ÿå±‚ï¼‰ï¼šWaiting Logic</h4>
<p>å•çº¯çš„ Atomic å¦‚æœä¸€ç›´æŠ¢ä¸åˆ°é”ï¼ŒCPU ä¼šä¸€ç›´ç©ºè½¬ï¼ˆåƒå°å¼ ä¸€æ ·åœ¨é—¨å£è½¬åœˆï¼‰ï¼Œè¿™ä¼šæŠŠç”µè„‘å‘çƒ­çƒ§ç©¿ã€‚ Mutex åœ¨ Atomic å¤–é¢åŒ…è£¹äº†ä¸€å±‚**â€œç¡çœ /å”¤é†’é€»è¾‘â€**ï¼š</p>
<ul>
<li><strong>é€»è¾‘ï¼š</strong> Â å¦‚æœæˆ‘ç”¨ AtomicÂ <code>CAS</code>Â æŠ¢é”å¤±è´¥äº†ï¼Œæˆ‘ä¸è¦ä¸€ç›´å‚»è½¬ã€‚æˆ‘å»æ±‚æ“ä½œç³»ç»Ÿï¼ˆOS Kernelï¼‰ï¼šâ€œæŠŠæˆ‘æŒ‚èµ·ï¼ˆPark/Sleepï¼‰ï¼Œç­‰é”ç©ºå‡ºæ¥äº†å«é†’æˆ‘ã€‚â€</li>
<li><strong>å·¥å…·ï¼š</strong> Â åœ¨ Linux ä¸Šè¿™å«Â <code>futex</code>ï¼Œåœ¨ Windows ä¸Šå«Â <code>KeyedEvent</code>ã€‚</li>
</ul>
<h4 data-id="heading-31">æ€»ç»“å›¾è§£</h4>






























<table><thead><tr><th>ç»´åº¦</th><th>Atomic</th><th>Mutex</th></tr></thead><tbody><tr><td><strong>æ˜¯ä»€ä¹ˆ</strong></td><td><strong>ç¡¬ä»¶æŒ‡ä»¤</strong>Â (CPU å±‚é¢)</td><td><strong>è½¯ä»¶æ•°æ®ç»“æ„</strong>Â (æ“ä½œç³»ç»Ÿ/åº“å±‚é¢)</td></tr><tr><td><strong>åŒ…å«å†…å®¹</strong></td><td>ä»…ä»…æ˜¯ä¸€ä¸ª 0/1 çš„å¼€å…³</td><td><strong>å¼€å…³ (Atomic)</strong> Â +Â <strong>ç­‰å¾…é˜Ÿåˆ— (Queue)</strong> Â +Â <strong>è°ƒåº¦é€»è¾‘</strong></td></tr><tr><td><strong>æŠ¢ä¸åˆ°æ€ä¹ˆåŠ</strong></td><td>åªèƒ½é‡è¯• (Spin)</td><td>å¯ä»¥é€‰æ‹©ç¡è§‰ (Sleep/Park)</td></tr><tr><td><strong>æ¯”å–»</strong></td><td>é—¨æŠŠæ‰‹ä¸Šçš„é”èŠ¯</td><td>åŒ…å«äº†é”èŠ¯ã€é—¨å«ã€ç­‰å€™åŒºçš„ä¸€æ•´å¥—ç®¡ç†ç³»ç»Ÿ</td></tr></tbody></table>
<p><strong>ä¸€å¥è¯æ€»ç»“ï¼š</strong> Â Mutex å°±æ˜¯åˆ©ç”¨Â <strong>Atomic</strong>Â è¿™ä¸€å—â€œç¡¬ç –å¤´â€ï¼Œé…åˆæ“ä½œç³»ç»Ÿçš„è°ƒåº¦èƒ½åŠ›ï¼Œç›–å‡ºäº†ä¸€é—´æ—¢èƒ½é”é—¨ã€åˆèƒ½è®©æ’é˜Ÿçš„äººæœ‰åœ°æ–¹ç¡è§‰çš„â€œæˆ¿å­â€ã€‚</p>
<ul>
<li>
<p><strong>Mutex / RwLock (äº’æ–¥é”):</strong></p>
<ul>
<li><strong>è§’è‰²ï¼š</strong> Â æˆ¿é—´çš„é—¨é”ã€‚ä¸€æ¬¡åªèƒ½è¿›ä¸€ä¸ªäººã€‚</li>
<li><strong>å¹¶è¡Œæ€§ï¼š</strong> Â <strong>å®ƒæ˜¯å¹¶è¡Œçš„æ€æ‰‹</strong>ã€‚åœ¨é”çš„èŒƒå›´å†…ï¼Œä»£ç è¢«è¿«å˜æˆä¸²è¡Œï¼ˆSerialï¼‰ã€‚å¦‚æœä½ åˆ°å¤„ç”¨ Mutexï¼Œä½ çš„å¤šæ ¸ CPU å°±é€€åŒ–æˆäº†å•æ ¸ã€‚</li>
</ul>
</li>
<li>
<p><strong>Condvar (æ¡ä»¶å˜é‡):</strong></p>
<ul>
<li><strong>è§’è‰²ï¼š</strong> Â ä¿¡å·æªã€‚çº¿ç¨‹ A è¯´â€œæˆ‘æ²¡æ‹¿åˆ°æ•°æ®ï¼Œæˆ‘ç¡äº†â€ï¼Œçº¿ç¨‹ B åšå®Œäº‹åå¼€ä¸€æªâ€œæ•°æ®å¥½äº†ï¼Œé†’é†’â€ã€‚</li>
<li><strong>ä½œç”¨ï¼š</strong> Â ç”¨äºçº¿ç¨‹é—´çš„<strong>ç­‰å¾…/å”¤é†’</strong>åè°ƒï¼Œæ˜¯å¹¶å‘è°ƒåº¦å·¥å…·ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-32">2. å¯¹è®²æœºä¸å¿«é€’ï¼šè§£è€¦ä¸é€šä¿¡ (Communication)</h3>
<p>è¿™éƒ¨åˆ†æ˜¯ä¸ºäº†è®©ä¸åŒçš„ä»»åŠ¡ä¹‹é—´èƒ½å¤Ÿ<strong>åä½œ</strong>ã€‚å®ƒä»¬ä¸ç›´æ¥äº§ç”Ÿå¹¶è¡Œï¼Œä½†å®ƒä»¬è®©å¹¶è¡Œæˆä¸ºå¯èƒ½ï¼ˆæ²¡æœ‰é€šä¿¡çš„å¹¶è¡Œæ˜¯çå­ï¼‰ã€‚</p>
<ul>
<li>
<p><strong>Channel (é€šé“ / CSPæ¨¡å¼):</strong></p>
<ul>
<li><strong>è§’è‰²ï¼š</strong> Â ä¼ é€å¸¦ã€‚</li>
<li><strong>Rust ç‰¹è‰²ï¼š</strong> Â <code>mpsc</code>Â (Multi-producer, Single-consumer)ã€‚</li>
<li><strong>å¹¶è¡Œå…³ç³»ï¼š</strong> Â ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯ä»¥åœ¨ä¸åŒçš„æ ¸å¿ƒä¸Š<strong>å¹¶è¡Œ</strong>å·¥ä½œï¼ŒChannel è´Ÿè´£å®‰å…¨åœ°ä¼ é€’æ•°æ®ã€‚è¿™æ˜¯å®ç°â€œæµæ°´çº¿å¹¶è¡Œâ€çš„å…³é”®ã€‚</li>
</ul>
</li>
<li>
<p><strong>Actor Mode (æ¼”å‘˜æ¨¡å‹):</strong></p>
<ul>
<li><strong>è§’è‰²ï¼š</strong> Â ç‹¬ç«‹çš„åŠäº‹å‘˜ã€‚æ¯ä¸ª Actor æœ‰è‡ªå·±çš„é‚®ç®±ï¼Œåªå¤„ç†å‘ç»™å®ƒçš„ä¿¡ã€‚</li>
<li><strong>Rust ç”Ÿæ€ï¼š</strong> Â æ¯”å¦‚Â <code>Actix</code>Â åº“ã€‚</li>
<li><strong>å¹¶è¡Œå…³ç³»ï¼š</strong> Â æ¯ä¸ª Actor å¯ä»¥è·‘åœ¨ä¸åŒçš„çº¿ç¨‹ä¸Šã€‚è¿™æ˜¯ä¸€ç§éå¸¸é«˜çº§çš„<strong>å¹¶å‘æ¶æ„</strong>ï¼Œå¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼å’Œå¹¶è¡Œã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-33">3. æˆ˜ç•¥å›¾çº¸ï¼šçœŸæ­£çš„å¹¶è¡Œè®¾è®¡ (Parallelism Patterns)</h3>
<p>è¿™é‡Œæ˜¯æåˆ°çš„**â€œè®¾è®¡å¹¶è¡Œâ€<strong>çš„åœ°æ–¹ã€‚è¿™äº›ä¸æ˜¯å…·ä½“çš„â€œé”â€æˆ–â€œå˜é‡â€ï¼Œè€Œæ˜¯</strong>ç»„ç»‡ä»£ç ç»“æ„çš„æ–¹æ³•**ï¼Œç›®çš„æ˜¯ä¸ºäº†æŠŠä»»åŠ¡æ‹†æ•£ï¼Œå¡æ»¡æ‰€æœ‰çš„ CPU æ ¸å¿ƒã€‚</p>
<ul>
<li>
<p><strong>Free Competition (è‡ªç”±ç«äº‰ / ä»»åŠ¡æŠ¢å ):</strong></p>
<ul>
<li><strong>æ¨¡å¼ï¼š</strong> Â æ¯”å¦‚çº¿ç¨‹æ± ï¼ˆThread Poolï¼‰ã€‚ä¸¢è¿›å» 100 ä¸ªä»»åŠ¡ï¼Œç”± 8 ä¸ªå·¥äººï¼ˆæ ¸å¿ƒï¼‰å»æŠ¢ã€‚</li>
<li><strong>Rustï¼š</strong> Â è¿™é‡Œçš„å…¸å‹æ˜¯Â <code>tokio</code>Â (è™½ç„¶ä¸»è¦ç”¨äºå¼‚æ­¥ IO å¹¶å‘) æˆ–Â <code>rayon</code>Â çš„åº•å±‚çš„ Work-stealingï¼ˆå·¥ä½œçªƒå–ï¼‰æœºåˆ¶ã€‚è¿™æ˜¯<strong>ä»»åŠ¡å¹¶è¡Œ</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>Map/Reduce (æ˜ å°„/å½’çº¦):</strong></p>
<ul>
<li>
<p><strong>æ¨¡å¼ï¼š</strong></p>
<ul>
<li><strong>Map:</strong> Â æŠŠä¸€ä¸ªå¤§æ•°ç»„åˆ‡æˆ 8 ä»½ï¼Œ8 ä¸ªæ ¸åŒæ—¶å¤„ç†ï¼ˆè¿™æ˜¯çº¯ç²¹çš„<strong>æ•°æ®å¹¶è¡Œ</strong>ï¼‰ã€‚</li>
<li><strong>Reduce:</strong> Â æŠŠ 8 ä¸ªç»“æœæ±‡æ€»èµ·æ¥ã€‚</li>
</ul>
</li>
<li>
<p><strong>Rust ç¥å™¨ï¼š</strong> Â <strong><code>Rayon</code></strong>ã€‚è¿™æ˜¯ Rust ç•Œåšå¹¶è¡Œçš„æ ‡å‡†ç­”æ¡ˆã€‚ä½ åªéœ€è¦æŠŠÂ <code>.iter()</code>Â æ”¹æˆÂ <code>.par_iter()</code>ï¼Œä»£ç å°±ä»å•æ ¸å˜æˆäº†å¤šæ ¸å¹¶è¡Œã€‚</p>
</li>
</ul>
</li>
<li>
<p><strong>DAG (æœ‰å‘æ— ç¯å›¾):</strong></p>
<ul>
<li><strong>æ¨¡å¼ï¼š</strong> Â ä»»åŠ¡ A åšå®Œï¼Œè§¦å‘ B å’Œ C åŒæ—¶åšï¼ˆå¹¶è¡Œï¼‰ï¼ŒB å’Œ C éƒ½åšå®Œï¼Œè§¦å‘ Dã€‚</li>
<li><strong>Rustï¼š</strong> Â è¿™ç§æ¨¡å¼ç”¨äºå¤æ‚çš„<strong>ä»»åŠ¡ä¾èµ–å¹¶è¡Œ</strong>ã€‚Rust çš„æ„å»ºå·¥å…· Cargo ç¼–è¯‘ä½ çš„ä»£ç æ—¶ï¼Œå°±æ˜¯ç”¨ DAG æ¨¡å¼ï¼šäº’ä¸ä¾èµ–çš„ crate å°±åœ¨ä¸åŒæ ¸å¿ƒä¸Šå¹¶è¡Œç¼–è¯‘ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-34">ç®€å•æ€»ç»“</h3>



































<table><thead><tr><th>æ¦‚å¿µ</th><th>å®ƒæ˜¯å¹²å˜›çš„ï¼Ÿ</th><th>ä¸å¹¶è¡Œçš„å…³ç³»</th></tr></thead><tbody><tr><td><strong>Atomic / Mutex</strong></td><td><strong>ä¿å‘½çš„</strong>Â (Safety)</td><td>é˜²æ­¢å¹¶è¡Œå‡ºè½¦ç¥¸ï¼Œ<strong>å±€éƒ¨é˜»æ­¢å¹¶è¡Œ</strong></td></tr><tr><td><strong>Condvar</strong></td><td><strong>è°ƒåº¦çš„</strong>Â (Signaling)</td><td>åè°ƒæš‚åœå’Œå¼€å§‹</td></tr><tr><td><strong>Channel / Actor</strong></td><td><strong>ä¼ è¯çš„</strong>Â (Communication)</td><td>è¿æ¥å¹¶è¡Œçš„å²›å±¿</td></tr><tr><td><strong>Map/Reduce</strong></td><td><strong>æç”Ÿäº§çš„</strong>Â (Data Parallelism)</td><td><strong>çœŸæ­£çš„å¹¶è¡Œ</strong>ï¼šæŠŠå¤§è±¡åˆ‡å—åˆ†ç»™å¤šäººæ¬</td></tr><tr><td><strong>DAG</strong></td><td><strong>æç®¡ç†çš„</strong>Â (Task Parallelism)</td><td><strong>çœŸæ­£çš„å¹¶è¡Œ</strong>ï¼šå®‰æ’è°å…ˆè°åï¼Œèƒ½åŒæ—¶åšçš„å°½é‡åŒæ—¶åš</td></tr></tbody></table>
<p>Atomic è™½ç„¶å¯ä»¥å¤„ç†è‡ªç”±ç«äº‰æ¨¡å¼ä¸‹åŠ é”çš„éœ€æ±‚ï¼Œä½†æ¯•ç«Ÿç”¨èµ·æ¥ä¸é‚£ä¹ˆæ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦æ›´
é«˜å±‚çš„å¹¶å‘åŸè¯­ï¼Œæ¥ä¿è¯è½¯ä»¶ç³»ç»Ÿæ§åˆ¶å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå…±äº«èµ„æºçš„è®¿é—®ï¼Œä½¿å¾—æ¯ä¸ªçº¿ç¨‹
åœ¨è®¿é—®å…±äº«èµ„æºçš„æ—¶å€™ï¼Œå¯ä»¥ç‹¬å æˆ–è€…è¯´äº’æ–¥è®¿é—®ï¼ˆmutual exclusive accessï¼‰ã€‚</p>
<h3 data-id="heading-35">1. å…±äº«çŠ¶æ€ï¼š<code>Arc</code>Â +Â <code>Mutex</code></h3>
<p><strong>æ€»ç»“ï¼š</strong> Â â€œlockè§£é”â€Â <strong>è¡¥å……ç»†èŠ‚ï¼ˆå…³é”®ï¼‰ï¼š</strong></p>
<ul>
<li>
<p><strong>Arc (æ‹¿å·):</strong> Â è´Ÿè´£<strong>æ¬è¿</strong>ã€‚æ²¡æœ‰å®ƒï¼Œæ‰€æœ‰æƒè§„åˆ™ä¸å…è®¸ä½ æŠŠåŒä¸€ä¸ªå˜é‡å¡ç»™ 10 ä¸ªçº¿ç¨‹ã€‚å®ƒè®©å¤§å®¶éƒ½æœ‰åˆæ³•çš„â€œå¼•ç”¨â€ã€‚</p>
</li>
<li>
<p><strong>Mutex (å¼€é—¨):</strong> Â è´Ÿè´£<strong>äº’æ–¥</strong>ã€‚</p>
</li>
<li>
<p><strong>è‡ªåŠ¨è§£é” (RAII):</strong> Â Rust æœ€é…·çš„åœ°æ–¹åœ¨äº<strong>ä½ ä¸éœ€è¦å†™Â <code>unlock()</code></strong> ã€‚</p>
<ul>
<li><code>lock().unwrap()</code>Â æ˜¯ä¸Šé”ã€‚</li>
<li><strong>è§£é”</strong>æ˜¯éšå¼çš„ï¼šå½“æŒæœ‰é”çš„é‚£ä¸ªå˜é‡ï¼ˆæ¯”å¦‚ä»£ç é‡Œçš„Â <code>data</code>ï¼‰ç¦»å¼€Â <code>{ ... }</code>Â ä½œç”¨åŸŸæ—¶ï¼ŒRust è‡ªåŠ¨å¸®ä½ è§£é”ã€‚</li>
<li><em>ä¸ç”¨æ€•å¿˜äº†è§£é”å¯¼è‡´æ­»é”ï¼Œç¼–è¯‘å™¨å¸®ä½ ç®¡ç€ã€‚</em></li>
</ul>
</li>
</ul>
<h3 data-id="heading-36">2. çº¿ç¨‹åŒæ­¥ï¼š<code>join()</code></h3>
<p><strong>æ€»ç»“ï¼š</strong> Â â€œç­‰å¾…â€Â <strong>è¡¥å……ç»†èŠ‚ï¼ˆå…³é”®ï¼‰ï¼š</strong></p>
<ul>
<li><strong>ä¸»çº¿ç¨‹çš„è€å¿ƒ:</strong> Â <code>main</code>Â å‡½æ•°æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœÂ <code>main</code>Â è·‘å®Œäº†ï¼Œå®ƒ<strong>ä¸ä¼š</strong>ç­‰å­çº¿ç¨‹ï¼Œç›´æ¥æ€è¿›ç¨‹é€€å‡ºã€‚</li>
<li><code>join()</code>Â å°±æ˜¯è®©Â <code>main</code>Â çº¿ç¨‹<strong>å¡åœ¨è¿™é‡Œï¼ˆBlockï¼‰</strong> ï¼Œç›´åˆ°å­çº¿ç¨‹è·‘å®Œäº¤å·®ã€‚å®ƒæ˜¯é˜²æ­¢â€œçƒ‚å°¾å·¥ç¨‹â€çš„å…œåº•æœºåˆ¶ã€‚</li>
</ul>
<h3 data-id="heading-37">3. æ¶ˆæ¯ä¼ é€’ï¼š<code>mpsc::channel</code></h3>
<p><strong>æ€»ç»“ï¼š</strong> Â â€œlet (tx,rx)=...; cloneï¼Œç„¶åæ¶ˆè´¹rxâ€Â <strong>è¡¥å……ç»†èŠ‚ï¼ˆå…³é”®ï¼‰ï¼š</strong></p>
<ul>
<li>
<p><strong>å…‹éš†è°ï¼Ÿ</strong> Â åªèƒ½å…‹éš†Â <code>tx</code>Â (å‘é€ç«¯)ï¼Œè¿™å°±æ˜¯Â <strong>M</strong>ulti-<strong>P</strong>roducer (å¤šç”Ÿäº§è€…)ã€‚<code>rx</code>Â (æ¥æ”¶ç«¯) å¿…é¡»ç‹¬äº«ã€‚</p>
</li>
<li>
<p><strong>æ‰€æœ‰æƒè½¬ç§»:</strong> Â <code>tx.send(val)</code>Â ä¹‹åï¼Œ<code>val</code>Â å°±å½’Â <code>rx</code>Â äº†ï¼ŒåŸæ¥çš„çº¿ç¨‹å†ä¹Ÿç¢°ä¸åˆ°å®ƒã€‚è¿™æ˜¯ä¸ºäº†å®‰å…¨ã€‚</p>
</li>
<li>
<p><strong>æ–­å¼€ä¿¡å·:</strong> Â <code>rx</code>Â çš„Â <code>for</code>Â å¾ªç¯ä»€ä¹ˆæ—¶å€™åœï¼Ÿåªæœ‰å½“<strong>æ‰€æœ‰çš„</strong>Â <code>tx</code>Â éƒ½è¢«Â <code>drop</code>Â æ‰ä¹‹åï¼Œ<code>rx</code>Â æ‰ä¼šçŸ¥é“â€œæ²¡äººå‘æ¶ˆæ¯äº†â€ï¼Œä»è€Œç»“æŸå¾ªç¯ã€‚</p>
<ul>
<li><em>å‘ç‚¹ï¼šè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹é‡Œè¦Â <code>drop(tx)</code>ï¼Œå¦åˆ™Â <code>rx</code>Â ä¼šä¸€ç›´ç­‰ä¸‹å»ã€‚</em></li>
</ul>
</li>
</ul>
<h3 data-id="heading-38">4. æ•°æ®å¹¶è¡Œï¼š<code>Rayon</code></h3>
<p><strong>æ€»ç»“ï¼š</strong> Â â€œå°±æ˜¯ä¸€ä¸ª iter()ï¼Œpar_iter() å±æ€§çš„ä¸ä¸€æ ·æ˜¯å§â€Â <strong>è¡¥å……ç»†èŠ‚ï¼ˆå…³é”®ï¼‰ï¼š</strong></p>
<ul>
<li>
<p><strong>ä¸€å­—ä¹‹å·®ï¼Œå¤©å£¤ä¹‹åˆ«:</strong></p>
<ul>
<li><code>.iter()</code>Â =Â <strong>å•æ ¸ä¸²è¡Œ</strong>ï¼ˆè€ç‰›æ‹‰è½¦ï¼Œä¸€æ­¥ä¸€æ­¥èµ°ï¼‰ã€‚</li>
<li><code>.par_iter()</code>Â =Â <strong>å¤šæ ¸å¹¶è¡Œ</strong>ï¼ˆè½¦é˜Ÿå‡ºå‘ï¼Œä»»åŠ¡è‡ªåŠ¨åˆ‡å—åˆ†å‘ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>Work-Stealing (å·¥ä½œçªƒå–):</strong> Â ä½ ä¸éœ€è¦å‘Šè¯‰ Rayon æ€ä¹ˆåˆ†ã€‚å¦‚æœæ ¸ A ç®—å®Œäº†ï¼Œå®ƒä¼šå»å¸®è¿˜æ²¡ç®—å®Œçš„æ ¸ B å·ä»»åŠ¡åšã€‚</p>
</li>
<li>
<p><strong>æ— é”:</strong> Â åœ¨Â <code>map</code>Â /Â <code>reduce</code>Â çš„è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¸éœ€è¦ Mutexï¼Œå› ä¸ºå¤§å®¶å„ç®—å„çš„ï¼Œäº’ä¸å¹²æ‰°ï¼Œé€Ÿåº¦æœ€å¿«ã€‚</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-39">æç®€è®°å¿†è¡¨</h3>





























<table><thead><tr><th>åœºæ™¯</th><th>ä»£ç å…³é”®è¯</th><th>æ ¸å¿ƒé€»è¾‘</th><th>è¿™é‡Œçš„â€œé”â€</th></tr></thead><tbody><tr><td><strong>æŠ¢èµ„æº</strong></td><td><code>Arc&lt;Mutex&lt;T&gt;&gt;</code></td><td><strong>å¤§å®¶æ”¹åŒä¸€ä¸ªå€¼</strong></td><td><strong>Mutex</strong>Â (æ˜¾å¼é”ï¼Œå¿…é¡»æ’é˜Ÿ)</td></tr><tr><td><strong>æµæ°´çº¿</strong></td><td><code>mpsc</code>Â /Â <code>tx.clone()</code></td><td><strong>æˆ‘åšå®Œç»™ä½ </strong></td><td><strong>Ownership</strong>Â (æ‰€æœ‰æƒè½¬ç§»å°±æ˜¯ä¸€ç§é”)</td></tr><tr><td><strong>å‹æ¦¨CPU</strong></td><td><code>par_iter()</code></td><td><strong>å¤§å®¶å„ç®—å„çš„</strong></td><td><strong>æ— é”</strong>Â (Lock-freeï¼Œé€Ÿåº¦æœ€å¿«)</td></tr></tbody></table>
<h3 data-id="heading-40">ç¬¬ä¸€æ­¥ï¼šçœ‹ä»»åŠ¡ç±»å‹ï¼ˆæ˜¯åœ¨â€œç®—â€è¿˜æ˜¯åœ¨â€œç®¡â€ï¼Ÿï¼‰</h3>
<h4 data-id="heading-41">1. å¦‚æœä½ çš„ä»»åŠ¡æ˜¯ï¼šæš´åŠ›è®¡ç®—ï¼ˆCPU å¯†é›†å‹ï¼‰</h4>
<ul>
<li>
<p><strong>ç‰¹å¾ï¼š</strong> Â ä½ æœ‰ä¸€ä¸ªå·¨å¤§çš„æ•°ç»„ã€åˆ—è¡¨ã€å›¾ç‰‡åƒç´ ç‚¹ï¼Œä½ è¦å¯¹é‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ åšç›¸åŒçš„æ“ä½œï¼ˆæ¯”å¦‚å¹³æ–¹ã€æ»¤é•œã€åŠ å¯†ï¼‰ã€‚è€Œä¸”ç®—å‡ºç¬¬ä¸€ä¸ªå…ƒç´ çš„ç»“æœï¼Œä¸å½±å“ç¬¬äºŒä¸ªå…ƒç´ ã€‚</p>
</li>
<li>
<p><strong>å…³é”®é—®å¥ï¼š</strong> Â â€œè¿™ä¸ªå¤§å¾ªç¯èƒ½æ‹†å¼€å„ç®—å„çš„å—ï¼Ÿâ€</p>
</li>
<li>
<p><strong>ä½ çš„é€‰æ‹©ï¼š</strong> Â <strong>Rayon (<code>par_iter</code>)</strong></p>
</li>
<li>
<p><strong>Electron åœºæ™¯ï¼š</strong></p>
<ul>
<li>ç”¨æˆ·ä¸Šä¼ äº† 100 å¼ é«˜æ¸…å›¾ç‰‡ï¼Œä½ è¦æŠŠå®ƒä»¬å…¨éƒ¨å‹ç¼©æˆç¼©ç•¥å›¾ã€‚</li>
<li>ä½ è¦æ‰«æç¡¬ç›˜é‡Œçš„ 10 ä¸‡ä¸ªæ–‡ä»¶ï¼Œè®¡ç®—å®ƒä»¬çš„ MD5 å“ˆå¸Œå€¼ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-42">2. å¦‚æœä½ çš„ä»»åŠ¡æ˜¯ï¼šé€»è¾‘åè°ƒï¼ˆIO å¯†é›†å‹ / æµç¨‹å‹ï¼‰</h4>
<ul>
<li><strong>ç‰¹å¾ï¼š</strong> Â ä»»åŠ¡æ²¡é‚£ä¹ˆé‡ï¼Œä½†æ˜¯é€»è¾‘å¾ˆå¤æ‚ã€‚æ¶‰åŠå¤šä¸ªæ¨¡å—ä¹‹é—´çš„é…åˆï¼Œæ¯”å¦‚â€œA æ¨¡å—ä¸‹è½½å®Œï¼Œé€šçŸ¥ B æ¨¡å—è§£å‹ï¼ŒB è§£å‹å®Œé€šçŸ¥ C æ¨¡å—å…¥åº“â€ã€‚</li>
<li><strong>å…³é”®é—®å¥ï¼š</strong> Â â€œè¿™äº›çº¿ç¨‹ä¹‹é—´éœ€è¦è¯´è¯å—ï¼Ÿâ€</li>
<li><strong>ä½ çš„é€‰æ‹©ï¼š</strong> Â <strong>Channel (<code>mpsc</code>)</strong> Â æˆ–Â <strong>Mutex</strong>ï¼ˆè¿›å…¥ä¸‹ä¸€æ­¥ï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-43">ç¬¬äºŒæ­¥ï¼šçœ‹æ•°æ®æµå‘ï¼ˆæ˜¯åœ¨â€œä¼ çƒâ€è¿˜æ˜¯åœ¨â€œæŠ¢çƒâ€ï¼Ÿï¼‰</h3>
<p>å¦‚æœä»»åŠ¡å±äºä¸Šé¢çš„ç¬¬ 2 ç±»ï¼ˆé€»è¾‘åè°ƒï¼‰ï¼Œä½ éœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­ï¼š</p>
<h4 data-id="heading-44">1. ä¼ çƒæ¨¡å¼ (Pipeline)</h4>
<ul>
<li>
<p><strong>ç‰¹å¾ï¼š</strong> Â æ•°æ®åœ¨ä¸€ä¸ªçº¿ç¨‹äº§ç”Ÿï¼Œå¤„ç†å®Œåï¼Œäº¤ç»™ä¸‹ä¸€ä¸ªçº¿ç¨‹ã€‚åŸæ¥çš„çº¿ç¨‹å°±ä¸å†å…³å¿ƒè¿™ä¸ªæ•°æ®äº†ã€‚</p>
</li>
<li>
<p><strong>æ¯”å–»ï¼š</strong> Â å¨å¸ˆç‚’å¥½èœï¼ˆç”Ÿäº§è€…ï¼‰ï¼Œé€’ç»™ä¼ èœå‘˜ï¼ˆChannelï¼‰ï¼Œä¼ èœå‘˜ç«¯ç»™å®¢äººï¼ˆæ¶ˆè´¹è€…ï¼‰ã€‚å¨å¸ˆç‚’å®Œå°±ä¸ç®¡é‚£ç›˜èœäº†ã€‚</p>
</li>
<li>
<p><strong>ä½ çš„é€‰æ‹©ï¼š</strong> Â <strong>Channel (<code>mpsc</code>)</strong></p>
</li>
<li>
<p><strong>Electron åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>æ—¥å¿—ç³»ç»Ÿï¼š</strong> Â ä»»ä½•çº¿ç¨‹æŠ¥é”™ï¼Œéƒ½æŠŠé”™è¯¯ä¿¡æ¯å¡è¿› Channelï¼Œä¸»çº¿ç¨‹ä¸“é—¨è´Ÿè´£æŠŠ Channel é‡Œçš„å­—å†™è¿›Â <code>.log</code>Â æ–‡ä»¶ã€‚</li>
<li><strong>ä¸‹è½½å™¨ï¼š</strong> Â çº¿ç¨‹ A è´Ÿè´£ä¸‹è½½æ•°æ®å—ï¼Œä¸‹è½½å¥½ä¸€å—å°±å¡è¿› Channelï¼Œçº¿ç¨‹ B è´Ÿè´£æŠŠæ”¶åˆ°çš„æ•°æ®å—æ‹¼æ¥å†™å…¥ç¡¬ç›˜ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-45">2. æŠ¢çƒæ¨¡å¼ (Shared State)</h4>
<ul>
<li>
<p><strong>ç‰¹å¾ï¼š</strong> Â è¿™ä¸€ä»½æ•°æ®ï¼Œå¤§å®¶éƒ½è¦è¯»ï¼Œå¤§å®¶éƒ½è¦æ”¹ã€‚å®ƒå¿…é¡»é™æ­¢åœ¨é‚£é‡Œï¼Œè°ç”¨è°æ‹¿ã€‚</p>
</li>
<li>
<p><strong>æ¯”å–»ï¼š</strong> Â å…¬å¸çš„ä¼šè®®å®¤ã€‚é”€å”®éƒ¨è¦ç”¨ï¼Œç ”å‘éƒ¨ä¹Ÿè¦ç”¨ã€‚è°æŠ¢åˆ°é’¥åŒ™è°è¿›å»ï¼Œè¿›å»é”é—¨ï¼Œç”¨å®Œå‡ºæ¥è¿˜é’¥åŒ™ã€‚</p>
</li>
<li>
<p><strong>ä½ çš„é€‰æ‹©ï¼š</strong> Â <strong>Arc + Mutex</strong></p>
</li>
<li>
<p><strong>Electron åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>å…¨å±€é…ç½®ï¼š</strong> Â ç”¨æˆ·åœ¨è®¾ç½®é‡Œæ”¹äº†Â <code>theme = "dark"</code>ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½éœ€è¦è¯»å–è¿™ä¸ªé…ç½®ï¼Œå¶å°”ä¹Ÿè¦ä¿®æ”¹å®ƒã€‚</li>
<li><strong>è¿æ¥æ± /ç¼“å­˜ï¼š</strong> Â ç»´æŠ¤ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½è¦å»æ± å­é‡Œå€Ÿè¿æ¥ï¼Œç”¨å®Œæ”¾å›å»ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-46">ç¬¬ä¸‰æ­¥ï¼šå†³ç­–æ€»ç»“è¡¨ï¼ˆä¸€ç§’é€ŸæŸ¥ï¼‰</h3>





























<table><thead><tr><th>ç—›ç‚¹</th><th>å…¸å‹ç‰¹å¾</th><th>æ¨èå·¥å…·</th><th>ä¸ºä»€ä¹ˆï¼Ÿ</th></tr></thead><tbody><tr><td><strong>æˆ‘è¦ç®—å¾—å¿«</strong></td><td>å¤§æ•°ç»„ã€å›¾åƒå¤„ç†ã€çŸ©é˜µè¿ç®—</td><td><strong>Rayon</strong></td><td>å®ƒæ˜¯ä¸“é—¨ä¸ºåˆ©ç”¨å¤šæ ¸ CPU ç®—åŠ›è®¾è®¡çš„ï¼Œä¸”æ— é”ï¼Œæœ€å¿«ã€‚</td></tr><tr><td><strong>æˆ‘è¦è§£è€¦</strong></td><td>æµæ°´çº¿ã€æ—¥å¿—ã€æ¶ˆæ¯é€šçŸ¥ã€å•å‘æµåŠ¨</td><td><strong>Channel</strong></td><td>è®©çº¿ç¨‹å„å¸å…¶èŒï¼Œé¿å…ç«äº‰ï¼Œä»£ç æœ€å¹²å‡€ã€‚</td></tr><tr><td><strong>æˆ‘è¦å…±äº«</strong></td><td>å…¨å±€çŠ¶æ€ã€ç¼“å­˜ã€è®¡æ•°å™¨ã€çŠ¶æ€æœº</td><td><strong>Mutex</strong></td><td>æ²¡åŠæ³•ï¼Œè¿™å°±æ˜¯å¿…é¡»â€œæ’é˜Ÿâ€çš„åœºæ™¯ã€‚</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-47">ç»“åˆ Electron + Rust é¡¹ç›®çš„å®æˆ˜å»ºè®®</h3>
<p>æ—¢ç„¶åšçš„æ˜¯ Electron åº”ç”¨ï¼ŒRust é€šå¸¸ä½œä¸ºåç«¯ï¼ˆNode.js çš„ NAPI æ’ä»¶ï¼‰å­˜åœ¨ã€‚ä»¥ä¸‹æ˜¯ä¸‰ä¸ªç»å…¸åœºæ™¯çš„â€œæœ€ä½³å®è·µâ€ï¼š</p>
<ol>
<li>
<p><strong>åœºæ™¯ï¼šæœç´¢æœ¬åœ°æ–‡ä»¶ï¼ˆEverything æ¨¡å¼ï¼‰</strong></p>
<ul>
<li><strong>éœ€æ±‚ï¼š</strong> Â éå† C ç›˜ 100 ä¸‡ä¸ªæ–‡ä»¶ï¼Œæ‰¾å‡ºåå­—å« "test" çš„ã€‚</li>
<li><strong>é€‰å‹ï¼š</strong> Â <strong>Rayon</strong>ã€‚</li>
<li><strong>ç†ç”±ï¼š</strong> Â æ–‡ä»¶ç³»ç»Ÿçš„éå†å’Œå­—ç¬¦ä¸²åŒ¹é…æ˜¯å¹¶è¡Œçš„ã€‚ç”¨Â <code>par_iter</code>Â å¯ä»¥è®© 8 ä¸ªæ ¸åŒæ—¶å»æ‰«ä¸åŒçš„æ–‡ä»¶å¤¹ã€‚</li>
</ul>
</li>
<li>
<p><strong>åœºæ™¯ï¼šRust å‘Šè¯‰ Electron è¿›åº¦æ¡</strong></p>
<ul>
<li><strong>éœ€æ±‚ï¼š</strong> Â Rust åœ¨åå°è§£å‹å¤§æ–‡ä»¶ï¼Œéœ€è¦æ¯ç§’å‘Šè¯‰ Electron å‰ç«¯â€œè¿›åº¦ 50%â€ã€‚</li>
<li><strong>é€‰å‹ï¼š</strong> Â <strong>Channel</strong>Â (Rust ä¾§) +Â <strong>Callback/Promise</strong>Â (NAPI ä¾§)ã€‚</li>
<li><strong>ç†ç”±ï¼š</strong> Â è§£å‹çº¿ç¨‹ï¼ˆç”Ÿäº§è€…ï¼‰ç®—å‡ºè¿›åº¦ï¼Œé€šè¿‡ Channel å‘ç»™ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹å†è°ƒç”¨ JS çš„å›è°ƒå‡½æ•°é€šçŸ¥å‰ç«¯ã€‚åƒä¸‡ä¸è¦è®©è§£å‹çº¿ç¨‹ç›´æ¥å»è°ƒ JS å‡½æ•°ï¼ˆè·¨è¯­è¨€è°ƒç”¨é€šå¸¸è¦æ±‚åœ¨ä¸»çº¿ç¨‹ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>åœºæ™¯ï¼šApp çš„çŠ¶æ€ç®¡ç†</strong></p>
<ul>
<li><strong>éœ€æ±‚ï¼š</strong> Â è®°å½•å½“å‰æœ‰å¤šå°‘ä¸ªæ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡ï¼Œç”¨æˆ·ç‚¹â€œæš‚åœâ€æ—¶ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½è¦åœã€‚</li>
<li><strong>é€‰å‹ï¼š</strong> Â <strong>Arc&lt;Mutex&gt;</strong> ã€‚</li>
<li><strong>ç†ç”±ï¼š</strong> Â <code>is_paused</code>Â æ˜¯ä¸€ä¸ªå…¨å±€å¸ƒå°”å€¼ï¼Œæ‰€æœ‰å¹²æ´»çš„çº¿ç¨‹æ¯å¹²ä¸€æ­¥éƒ½è¦æ£€æŸ¥å®ƒã€‚è¿™å°±æ˜¯å…¸å‹çš„å…±äº«çŠ¶æ€ã€‚</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ•°æ®-184 Elasticsearch Doc Values æœºåˆ¶è¯¦è§£ï¼šåˆ—å¼å­˜å‚¨å¦‚ä½•æ”¯æ’‘æ’åº/èšåˆ/è„šæœ¬]]></title>    <link>https://juejin.cn/post/7583913535270567946</link>    <guid>https://juejin.cn/post/7583913535270567946</guid>    <pubDate>2025-12-15T10:16:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583913535270567946" data-draft-id="7583913535270551562" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ•°æ®-184 Elasticsearch Doc Values æœºåˆ¶è¯¦è§£ï¼šåˆ—å¼å­˜å‚¨å¦‚ä½•æ”¯æ’‘æ’åº/èšåˆ/è„šæœ¬"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-15T10:16:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ­¦å­åº·"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ•°æ®-184 Elasticsearch Doc Values æœºåˆ¶è¯¦è§£ï¼šåˆ—å¼å­˜å‚¨å¦‚ä½•æ”¯æ’‘æ’åº/èšåˆ/è„šæœ¬
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ­¦å­åº·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:16:24.000Z" title="Mon Dec 15 2025 10:16:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>åœºæ™¯ï¼šES æ’åº/èšåˆ/è„šæœ¬è®¿é—®å­—æ®µå€¼æ—¶ï¼Œå€’æ’ç´¢å¼•ä¸æ“…é•¿æŒ‰â€œåˆ—â€è¯»æ•°æ®</li>
<li>ç»“è®ºï¼šDoc Values æ˜¯ç£ç›˜åˆ—å¼ç»“æ„ï¼ˆé™¤ text å¤–å¤šæ•°ç±»å‹é»˜è®¤å¼€å¯ï¼‰ï¼Œç”¨æ¥é«˜æ•ˆè¯»å­—æ®µå€¼</li>
<li>äº§å‡ºï¼šç»™å‡ºå¯è½åœ°çš„å­—æ®µé€‰å‹ã€mapping çº¦æŸã€å¸¸è§æŠ¥é”™å®šä½ä¸ä¿®å¤é€ŸæŸ¥</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84307176af0f4855ad2ee854e1ad503a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398583&amp;x-signature=IKqFK3qlK0UbMZsl2HL52EtlP%2Fk%3D" alt="å¤§æ•°æ®-184 Elasticsearch Doc Values æœºåˆ¶è¯¦è§£ï¼šåˆ—å¼å­˜å‚¨å¦‚ä½•æ”¯æ’‘æ’åº/èšåˆ/è„šæœ¬" loading="lazy"/></p>
<h2 data-id="heading-1">ç‰ˆæœ¬çŸ©é˜µ</h2>



































<table><thead><tr><th>è¯´æ˜</th><th>éªŒè¯çŠ¶æ€</th><th>æ¥æº</th></tr></thead><tbody><tr><td>ES doc_valuesï¼šç£ç›˜åˆ—å¼ç»“æ„ï¼Œä¸»è¦ç”¨äºæ’åº/èšåˆ/è„šæœ¬è®¿é—®å­—æ®µå€¼</td><td>æ˜¯</td><td>å®˜æ–¹æ–‡æ¡£</td></tr><tr><td>keyword æœ‰ doc valuesï¼›text é»˜è®¤æ²¡æœ‰ doc valuesï¼Œèšåˆ/æ’åºéœ€ fielddata æˆ–æ”¹ç”¨ keyword</td><td>æ˜¯</td><td>ç¤¾åŒºä¸€è‡´ç»“è®º</td></tr><tr><td>æ—¢æœ‰ç´¢å¼•çš„ mapping ä¸èƒ½â€œæ›¿æ¢/åˆ é™¤â€ï¼Œéœ€è¦æ–°å»ºç´¢å¼• + reindex æ‰èƒ½å½»åº•æ”¹å­—æ®µç±»å‹/ç»“æ„</td><td>éƒ¨åˆ†</td><td>ç¤¾åŒº/å®è·µå…±è¯†</td></tr><tr><td>â€œanalyzed strings ä¸èƒ½ç”¨ doc valuesâ€åœ¨æ—§ç‰ˆæœ¬è¡¨è¿°ä¸º string/not_analyzedï¼ŒES 5+ å·²æ‹†åˆ†ä¸º text/keywordï¼Œä¸è¦æ··ç”¨æ—§æœ¯è¯­</td><td>æ˜¯</td><td>å†å²/ç‰ˆæœ¬å·®å¼‚</td></tr><tr><td>OpenSearchï¼šdoc values é»˜è®¤å¯¹ç»å¤§å¤šæ•°å­—æ®µå¼€å¯ï¼Œtext ä¾‹å¤–ï¼ˆä¸ ES è®¤çŸ¥ä¸€è‡´ï¼‰</td><td>æ˜¯</td><td>OpenSearch å‚è€ƒ</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/628c64d67a1e4928bc17f5f07ef97fb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398583&amp;x-signature=%2BSTzDbJCPhaDiSjjjzKtfxFRufs%3D" alt="Elasticsearch" loading="lazy"/></p>
<h2 data-id="heading-2">DocValues æœºåˆ¶</h2>
<p>Doc Values æ˜¯ä¸€ç§ä»¥åˆ—å¼å­˜å‚¨çš„ç´¢å¼•æœºåˆ¶ï¼Œç”¨äºåœ¨æ£€ç´¢æ—¶ä¼˜åŒ–ç£ç›˜è¯»å–æ“ä½œã€‚ä¸ä¼ ç»Ÿçš„è¡Œå¼å­˜å‚¨ä¸åŒï¼ŒDoc Values å°†æ¯ä¸ªå­—æ®µçš„æ‰€æœ‰å€¼æŒ‰åˆ—ç»„ç»‡å­˜å‚¨ï¼Œè¿™ç§ç»“æ„ç‰¹åˆ«é€‚åˆåˆ†æå‹æŸ¥è¯¢åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹ç‚¹ï¼š</p>
<ol>
<li>å­˜å‚¨ç»“æ„å¯¹æ¯”ï¼š</li>
</ol>
<ul>
<li>åå‘ç´¢å¼•ï¼šåŸºäºå€’æ’è¡¨çš„ç»“æ„ï¼Œä¸»è¦ç”¨äºå…¨æ–‡æ£€ç´¢åœºæ™¯ï¼Œå¯ä»¥å¿«é€ŸæŸ¥æ‰¾æ–‡æ¡£ä¸­åŒ…å«æŸä¸ªè¯çš„æƒ…å†µ</li>
<li>Doc Valuesï¼šé‡‡ç”¨ç´§å‡‘çš„åˆ—å¼å­˜å‚¨æ ¼å¼ï¼Œæ¯ä¸ªå­—æ®µçš„å€¼è¢«è¿ç»­å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œæ”¯æŒé«˜æ•ˆçš„é¡ºåºè¯»å–</li>
</ul>
<ol start="2">
<li>æ€§èƒ½ä¼˜åŠ¿ï¼š</li>
</ol>
<ul>
<li>å†…å­˜æ•ˆç‡ï¼šä»…éœ€åŠ è½½æŸ¥è¯¢æ¶‰åŠçš„åˆ—ï¼Œè€Œéæ•´ä¸ªæ–‡æ¡£</li>
<li>CPUç¼“å­˜å‹å¥½ï¼šè¿ç»­å­˜å‚¨çš„åˆ—æ•°æ®èƒ½æ›´å¥½åˆ©ç”¨CPUç¼“å­˜è¡Œ</li>
<li>å‹ç¼©ç‡é«˜ï¼šåŒåˆ—æ•°æ®é€šå¸¸å…·æœ‰ç›¸ä¼¼æ€§ï¼Œå¯é‡‡ç”¨æ›´é«˜æ•ˆçš„å‹ç¼©ç®—æ³•</li>
</ul>
<ol start="3">
<li>å…¸å‹åº”ç”¨åœºæ™¯ï¼š</li>
</ol>
<p>æ’åºåœºæ™¯ï¼š</p>
<ul>
<li>ç¤ºä¾‹ï¼šå¯¹å•†å“æŒ‰ä»·æ ¼æ’åºæ—¶ï¼Œåªéœ€é¡ºåºè¯»å–priceåˆ—çš„Doc Values</li>
<li>ä¼˜åŠ¿ï¼šç›¸æ¯”åŠ è½½å®Œæ•´æ–‡æ¡£ï¼Œå¯å‡å°‘90%ä»¥ä¸Šçš„IOæ“ä½œ</li>
</ul>
<p>èšåˆåœºæ™¯ï¼š</p>
<ul>
<li>æ”¯æŒæ“ä½œï¼štermsã€sumã€averageã€percentilesç­‰</li>
<li>å®é™…æ¡ˆä¾‹ï¼šè®¡ç®—æŸæ—¶é—´æ®µå†…è®¢å•é‡‘é¢çš„åˆ†å¸ƒæƒ…å†µ</li>
<li>æ€§èƒ½å¯¹æ¯”ï¼šæ¯”ä½¿ç”¨è„šæœ¬è®¡ç®—å¿«5-10å€</li>
</ul>
<p>è¿‡æ»¤åœºæ™¯ï¼š</p>
<ul>
<li>é€‚ç”¨æ“ä½œï¼šèŒƒå›´è¿‡æ»¤(price&gt;100)ã€ç²¾ç¡®åŒ¹é…(status="active")ç­‰</li>
<li>å®ç°åŸç†ï¼šé€šè¿‡bitmapå¿«é€Ÿç­›é€‰ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£ID</li>
<li>ç‰¹æ®Šä¼˜åŒ–ï¼šå¯¹æ•°å€¼ç±»å‹æ”¯æŒä½å›¾ç´¢å¼•åŠ é€Ÿ</li>
</ul>
<ol start="4">
<li>å®ç°ç»†èŠ‚ï¼š</li>
</ol>
<ul>
<li>é»˜è®¤å¼€å¯ï¼šåœ¨Elasticsearchç­‰ç³»ç»Ÿä¸­é€šå¸¸é»˜è®¤å¯ç”¨</li>
<li>å­˜å‚¨ä½ç½®ï¼šæ—¢æ”¯æŒå†…å­˜æ˜ å°„ä¹Ÿæ”¯æŒç£ç›˜æŒä¹…åŒ–</li>
<li>æ›´æ–°æœºåˆ¶ï¼šé‡‡ç”¨è¿½åŠ å†™æ–¹å¼ï¼Œå®šæœŸåˆå¹¶ä¼˜åŒ–</li>
</ul>
<ol start="5">
<li>ä½¿ç”¨å»ºè®®ï¼š</li>
</ol>
<ul>
<li>é€‚åˆå­—æ®µï¼šé«˜åŸºæ•°å­—æ®µã€éœ€è¦é¢‘ç¹èšåˆ/æ’åºçš„å­—æ®µ</li>
<li>ä¸é€‚åˆåœºæ™¯ï¼šå¤§æ–‡æœ¬å­—æ®µ(è¶…è¿‡å‡ KB)ã€å¾ˆå°‘è¢«æŸ¥è¯¢çš„å­—æ®µ</li>
<li>é…ç½®å‚æ•°ï¼šå¯é€šè¿‡"doc_values: false"æ˜¾å¼å…³é—­</li>
</ul>
<p>é€šè¿‡åˆç†ä½¿ç”¨Doc Valuesï¼Œå¯ä»¥æ˜¾è‘—æå‡åˆ†æå‹æŸ¥è¯¢çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§æ•°æ®é›†æ—¶æ•ˆæœæ›´ä¸ºæ˜æ˜¾ã€‚</p>
<h3 data-id="heading-3">ä¸ºä»€ä¹ˆè¦æœ‰Doc Values</h3>
<p>Elasticsearchä¹‹æ‰€ä»¥æœç´¢è¿™ä¹ˆè¿…é€Ÿï¼Œå½’åŠŸäºå®ƒçš„å€’æ’ç´¢å¼•è®¾è®¡ï¼Œç„¶åå®ƒä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå€’æ’ç´¢å¼•çš„æ£€ç´¢æ€§èƒ½æ˜¯éå¸¸å¿«çš„ï¼Œä½†æ˜¯åœ¨å­—æ®µæ’åºæ—¶å´ä¸æ˜¯ç†æƒ³çš„ç»“æ„ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">Term Doc_1 Doc_2
-------------------------
quick  |   | X
the    | X |
brown  | X | X
dog    | X |
dogs   |   | X
fox    | X |
foxes  |   | X
in     |   | X
jumped | X |
lazy   | X | X
leap   |   | X
over   | X | X
summer |   | X
the    | X |
------------------------
</code></pre>
<p>å¦‚ä¸Šé¢çš„å†…å®¹ä¸­å¯ä»¥çœ‹å‡ºï¼Œå®ƒåªæœ‰è¯å¯¹åº”docï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“æ¯ä¸€ä¸ªdocä¸­çš„å†…å®¹ï¼Œé‚£ä¹ˆå¦‚æœæƒ³æ’åºçš„è¯æ¯ä¸€ä¸ªdocéƒ½å»è·å–ä¸€æ¬¡æ–‡æ¡£å†…å®¹å²‚ä¸æ˜¯éå¸¸è€—æ—¶ï¼ŸDocValuesçš„å‡ºç°ä½¿å¾—è¿™ä¸ªé—®é¢˜è¿åˆƒè€Œè§£ã€‚
å­—æ®µçš„ doc_values  å±æ€§æœ‰ä¸¤ä¸ªå€¼ï¼Œtrueã€falseï¼Œé»˜è®¤æ˜¯trueï¼Œå³å¼€å¯ã€‚
å½“ doc_values ä¸º false æ—¶ï¼Œæ— æ³•åŸºäºè¯¥å­—æ®µæ’åºã€èšåˆã€åœ¨è„šæœ¬ä¸­è®¿é—®å­—æ®µå€¼ã€‚
å½“ doc_values ä¸º true æ—¶ï¼ŒESä¼šå¢åŠ ä¸€ä¸ªç›¸åº”çš„æ­£æ’ç´¢å¼•ï¼Œè¿™å¢åŠ çš„ç£ç›˜å ç”¨ï¼Œä¹Ÿä¼šå¯¼è‡´ç´¢å¼•æ•°æ®é€Ÿåº¦æ…¢ä¸€äº›ã€‚</p>
<p>Doc Values æ˜¯åˆ—å¼å­˜å‚¨çš„ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªå­—æ®µå€¼éƒ½ä»¥åˆ—çš„å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œè€Œä¸æ˜¯åƒåŸå§‹æ–‡æ¡£é‚£æ ·å­˜å‚¨åœ¨è¡Œä¸­ã€‚è¿™ç§æ–¹å¼æœ‰åŠ©äºä¼˜åŒ–æ•°æ®çš„è¯»å–ï¼Œå› ä¸ºåœ¨æ‰§è¡Œæ’åºæˆ–èšåˆæ—¶ï¼ŒElasticsearch åªéœ€è®¿é—®ä¸æ“ä½œç›¸å…³çš„å­—æ®µï¼Œè€Œä¸éœ€è¦åŠ è½½æ•´ä¸ªæ–‡æ¡£ã€‚</p>
<p>æ¯ä¸ªæ–‡æ¡£çš„å­—æ®µå€¼åœ¨ç´¢å¼•æ—¶è¢«é¢„å¤„ç†ï¼Œå¹¶ä»¥å‹ç¼©çš„å½¢å¼å­˜å‚¨ä¸º Doc Valuesï¼Œè¿™äº›å€¼ä¼šä»¥å†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆmemory-mapped fileï¼‰çš„æ–¹å¼åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä»¥ä¾¿è¿›è¡Œå¿«é€Ÿè¯»å–ã€‚</p>
<h3 data-id="heading-4">Doc Valuesä¸¾ä¾‹</h3>
<p>åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼š</p>
<pre><code class="hljs language-json" lang="json">PUT /person
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mappings"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"properties"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">"keyword"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"doc_values"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"age"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">"integer"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"doc_values"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å†™å…¥ç›¸å¯¹åº”çš„æ•°æ®ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">POST _bulk
{ "index" : { "_index" : "person", "_id" : "1" } }
{ "name" : "æ˜æ˜", "age": 22 }
{ "index" : { "_index" : "person", "_id" : "2" } }
{ "name" : "ä¸½ä¸½", "age": 18 }
{ "index" : { "_index" : "person", "_id" : "3" } }
{ "name" : "åª›åª›", "age": 19 }
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/899a30a2dff44d42bc5f656bfa0ac0be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398583&amp;x-signature=px%2Fw33VU391G%2BP6KTYTqrdnq%2F4g%3D" alt="Elasticsearch bulk" loading="lazy"/>
è¿›è¡Œå…¨é‡æŸ¥è¯¢ï¼Œç¡®è®¤ä¸€ä¸‹æ•°æ®çš„æƒ…å†µï¼š</p>
<pre><code class="hljs language-json" lang="json">POST /person/_search
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"match_all"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sort"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"order"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"desc"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9883592f21b64a8684ecdc24a71802af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398583&amp;x-signature=unvQ8nFMVFbxTdb0UTXnQPEGgsM%3D" alt="Elasticsearch æŸ¥è¯¢" loading="lazy"/></p>
<h3 data-id="heading-5">ä»€ä¹ˆæ˜¯Doc Values</h3>
<p>Doc Values é€šè¿‡è½¬ç½®å€’æ’ç´¢å¼•å’Œæ­£æ’ç´¢å¼•ä¸¤è€…é—´çš„å…³ç³»æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå€’æ’ç´¢å¼•å°†è¯é¡¹æ˜ å°„åˆ°åŒ…å«å®ƒçš„æ–‡æ¡£ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">Doc Terms
-----------------------------------------------------------------
Doc_1 | brown, dog, fox, jumped, lazy, over, quick, the
Doc_2 | brown, dogs, foxes, in, lazy, leap, over, quick, summer
Doc_3 | dog, dogs, fox, jumped, over, quick, the
-----------------------------------------------------------------
</code></pre>
<p>å½“æ•°æ®è¢«è½¬ç½®åï¼Œæƒ³è¦æ”¶é›†åˆ°æ¯ä¸ªæ–‡æ¡£è¡Œï¼Œè·å–æ‰€æœ‰çš„è¯é¡¹å°±éå¸¸ç®€å•äº†ã€‚</p>
<h3 data-id="heading-6">æ·±å…¥ç†è§£ES Doc Values</h3>
<p>DocValuesæ˜¯Luceneç´¢å¼•æœºåˆ¶ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä¸å€’æ’ç´¢å¼•åŒæ—¶ç”Ÿæˆï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ol>
<li>ç”Ÿæˆæœºåˆ¶ï¼š</li>
</ol>
<ul>
<li>åœ¨ç´¢å¼•åˆ›å»ºé˜¶æ®µï¼ŒDocValuesä¼šä¸å€’æ’ç´¢å¼•å¹¶è¡Œæ„å»º</li>
<li>åŸºäºSegmentçº§åˆ«ç”Ÿæˆï¼Œæ¯ä¸ªSegmentéƒ½åŒ…å«è‡ªå·±ç‹¬ç«‹çš„DocValuesæ•°æ®</li>
<li>ç”Ÿæˆåæ˜¯ä¸å¯å˜çš„ï¼Œä¸å€’æ’ç´¢å¼•ä¿æŒä¸€è‡´æ€§</li>
</ul>
<ol start="2">
<li>å­˜å‚¨ç‰¹æ€§ï¼š</li>
</ol>
<ul>
<li>é‡‡ç”¨é«˜æ•ˆçš„åºåˆ—åŒ–æ–¹å¼å°†æ•°æ®ç»“æ„æŒä¹…åŒ–åˆ°ç£ç›˜</li>
<li>å­˜å‚¨æ ¼å¼ç»è¿‡ä¼˜åŒ–ï¼Œæ”¯æŒå¿«é€Ÿéšæœºè®¿é—®å’Œé¡ºåºæ‰«æ</li>
<li>ä¸å€’æ’ç´¢å¼•å…±äº«ç›¸åŒçš„Segmentåˆå¹¶ç­–ç•¥</li>
</ul>
<ol start="3">
<li>å†…å­˜ç®¡ç†ä¼˜åŠ¿ï¼š</li>
</ol>
<ul>
<li>åˆ©ç”¨æ“ä½œç³»ç»Ÿæ–‡ä»¶ç¼“å­˜æœºåˆ¶ï¼Œè€ŒéJVMå †å†…å­˜</li>
<li>å½“æ•°æ®é‡å°äºç³»ç»Ÿå¯ç”¨å†…å­˜æ—¶ï¼ˆworkingset &lt; RAMï¼‰ï¼š
<ul>
<li>æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨å°†é¢‘ç¹è®¿é—®çš„DocValuesä¿ç•™åœ¨å†…å­˜ä¸­</li>
<li>å®ç°æ¥è¿‘å†…å­˜æ•°æ®åº“çš„è®¿é—®é€Ÿåº¦</li>
<li>å…¸å‹åœºæ™¯ï¼šè¿‡æ»¤ã€æ’åºã€èšåˆç­‰æ“ä½œèƒ½è·å¾—æå¿«å“åº”</li>
</ul>
</li>
</ul>
<ol start="4">
<li>å¤§å®¹é‡å¤„ç†èƒ½åŠ›ï¼š</li>
</ol>
<ul>
<li>å½“æ•°æ®é‡è¶…è¿‡å†…å­˜å®¹é‡æ—¶ï¼ˆworkingset &gt;&gt; RAMï¼‰ï¼š
<ul>
<li>æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨å°†ä¸æ´»è·ƒæ•°æ®æ¢å‡ºåˆ°ç£ç›˜</li>
<li>è™½ç„¶è®¿é—®é€Ÿåº¦æœ‰æ‰€ä¸‹é™ï¼Œä½†é¿å…äº†OOMé£é™©</li>
<li>å…¸å‹åœºæ™¯ï¼šå¤„ç†æ•°åäº¿æ–‡æ¡£æ—¶ä»èƒ½ä¿æŒç¨³å®šæ€§èƒ½</li>
</ul>
</li>
</ul>
<ol start="5">
<li>åº”ç”¨åœºæ™¯ç¤ºä¾‹ï¼š</li>
</ol>
<ul>
<li>ç”µå•†å¹³å°ä¸­ç™¾ä¸‡çº§å•†å“çš„ä»·æ ¼æ’åº</li>
<li>æ—¥å¿—åˆ†æç³»ç»Ÿä¸­çš„æ—¶é—´èŒƒå›´è¿‡æ»¤</li>
<li>å¤§æ•°æ®åˆ†æä¸­çš„åˆ†ç»„èšåˆè®¡ç®—</li>
</ul>
<p>è¿™ç§è®¾è®¡ä½¿DocValuesåœ¨ä¿æŒé«˜æ€§èƒ½çš„åŒæ—¶ï¼Œä¹Ÿèƒ½å¤„ç†è¿œè¶…ç‰©ç†å†…å­˜å®¹é‡çš„æ•°æ®é›†ï¼Œä¸ºå¤§è§„æ¨¡æ•°æ®åº”ç”¨æä¾›äº†å¯é çš„åº•å±‚æ”¯æŒã€‚</p>
<h3 data-id="heading-7">DocValues å‹ç¼©</h3>
<p>ä»å¹¿ä¹‰æ¥è¯´ï¼ŒDocValuesæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåºåˆ—åŒ–çš„åˆ—å¼å­˜å‚¨ï¼Œè¿™ä¸ªç»“æ„éå¸¸é€‚ç”¨äºèšåˆã€æ’åºã€è„šæœ¬ç­‰æ“ä½œã€‚è€Œä¸”ï¼Œè¿™ç§å­˜å‚¨æ–¹å¼éå¸¸çš„ä¾¿äºå‹ç¼©ï¼Œç‰¹åˆ«æ˜¯æ•°å­—ç±»å‹ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç£ç›˜ç©ºé—´å¹¶ä¸”æé«˜è®¿é—®é€Ÿåº¦ã€‚
ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ç»„æ•°å­—ç±»å‹çš„DocValuesï¼š</p>
<pre><code class="hljs language-shell" lang="shell">Doc Terms
-----------------------------------------------------------------
Doc_1 | 100
Doc_2 | 1000
Doc_3 | 1500
Doc_4 | 1200
Doc_5 | 300
Doc_6 | 1900
Doc_7 | 4200
-----------------------------------------------------------------
</code></pre>
<p>ä½ ä¼šæ³¨æ„åˆ°è¿™é‡Œæ¯ä¸ªæ•°å­—éƒ½æ˜¯100çš„å€æ•°ï¼ŒDocValuesä¼šæ£€æµ‹ä¸€ä¸ªæ®µé‡Œé¢çš„æ‰€æœ‰æ•°å€¼ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªæœ€å¤§å…¬çº¦æ•°ï¼Œæ–¹ä¾¿åšè¿›ä¸€æ­¥çš„æ•°æ®å‹ç¼©ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸ªæ•°å­—éƒ½é™¤ä»¥100ï¼Œç„¶åå¾—åˆ°ï¼š[1,10,15,12,3,19,42]ã€‚ç°åœ¨è¿™äº›æ•°å­—å˜å°äº†ï¼Œåªéœ€è¦å¾ˆå°‘çš„ä½å°±å¯ä»¥å­˜å‚¨ä¸‹ï¼Œä¹Ÿå‡å°‘äº†ç£ç›˜å­˜æ”¾çš„å¤§å°ã€‚</p>
<p>DocValuesåœ¨å‹ç¼©è¿‡ç¨‹ä¸­ä½¿ç”¨å¦‚ä¸‹æŠ€å·§ï¼Œå®ƒä¼šä¾æ¬¡æ£€æµ‹ä»¥ä¸‹å‹ç¼©æ¨¡å¼ï¼š</p>
<ul>
<li>å¦‚æœæ‰€æœ‰çš„æ•°å€¼å„ä¸ç›¸åŒï¼ˆæˆ–ç¼ºå¤±ï¼‰ï¼Œè®¾ç½®ä¸€ä¸ªæ ‡è®°å¹¶è®°å½•è¿™äº›å€¼</li>
<li>å¦‚æœè¿™äº›å€¼å°äº256ï¼Œå°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ç¼–ç è¡¨</li>
<li>å¦‚æœè¿™äº›å€¼å¤§äº256ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨ä¸€ä¸ªæœ€å¤§å…¬çº¦æ•°</li>
<li>å¦‚æœæ²¡æœ‰å­˜åœ¨æœ€å¤§å…¬çº¦æ•°ï¼Œä»æœ€å°çš„æ•°å€¼å¼€å§‹ï¼Œç»Ÿä¸€è®¡ç®—åç§»é‡è¿›è¡Œç¼–ç 
å½“ç„¶å¦‚æœå­˜å‚¨Stringç±»å‹ï¼Œå…¶ä¸€æ ·å¯ä»¥é€šè¿‡é¡ºåºè¡¨å¯¹Stringç±»å‹è¿›è¡Œæ•°å­—ç¼–ç ï¼Œç„¶åå†æŠŠæ•°å­—ç±»å‹æ„å»ºDocValuesã€‚</li>
</ul>
<h3 data-id="heading-8">ç¦ç”¨ Doc Values</h3>
<p>DocValues é»˜è®¤å¯¹æ‰€æœ‰å­—æ®µå¯åŠ¨ï¼Œé™¤äº† analyzed stringsã€‚ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„æ•°å­—ã€åœ°ç†åæ ‡ã€æ—¥æœŸã€IPå’Œä¸åˆ†æï¼ˆnot_analyzedï¼‰å­—ç¬¦ç±»å‹éƒ½ä¼šé»˜è®¤å¼€å¯ã€‚
analyzed stringsæš‚æ—¶è¿˜ä¸èƒ½ä½¿ç”¨ DocValuesï¼Œæ˜¯å› ä¸ºç»è¿‡åˆ†æä»¥åå¾—æ–‡æœ¬ä¼šç”Ÿæˆå¤§é‡çš„Tokenï¼Œè¿™æ ·éå¸¸å½±å“æ€§èƒ½ã€‚
è™½ç„¶DocValueséå¸¸å¥½ç”¨ï¼Œä½†æ˜¯å¦‚æœä½ å­˜å‚¨çš„æ•°æ®ç¡®å®ä¸éœ€è¦è¿™ä¸ªç‰¹æ€§ï¼Œå°±ä¸å¦‚ç¦ç”¨å®ƒï¼Œè¿™æ ·ä¸ä»…èŠ‚çœç£ç›˜ç©ºé—´ï¼Œä¹Ÿè®¸ä¼šæå‡ç´¢å¼•çš„é€Ÿåº¦ã€‚
è¦ç¦ç”¨DocValuesï¼Œåœ¨å­—æ®µçš„æ˜ å°„mappingè®¾ç½®doc_valuesï¼šfalseå³å¯ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç´¢å¼•ï¼Œå­—æ®µ session_idç¦ç”¨äº†DocValuesï¼š</p>
<pre><code class="hljs language-json" lang="json">DELETE /my_index
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mappings"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"session_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"keyword"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"doc_values"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>é€šè¿‡è®¾ç½® doc_valuesï¼šfalseï¼Œè¿™ä¸ªå­—æ®µå°†ä¸èƒ½è¢«ç”¨äºèšåˆã€æ’åºä»¥åŠè„šæœ¬æ“ä½œ</p>
<h3 data-id="heading-9">å¸¦æ¥çš„ä¼˜åŠ¿</h3>
<ul>
<li>å‡å°‘å†…å­˜ä½¿ç”¨ï¼šç”±äº Doc Values å°†å­—æ®µå€¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šå¹¶åœ¨éœ€è¦æ—¶è¯»å–ï¼Œå› æ­¤ç›¸æ¯”å†…å­˜ä¸­ä¿æŒå­—æ®µå€¼çš„æ–¹å¼ï¼ˆä¾‹å¦‚ fielddataï¼‰ï¼Œå®ƒæå¤§åœ°å‡å°‘äº†å†…å­˜çš„ä½¿ç”¨ã€‚</li>
<li>é«˜æ•ˆçš„ç£ç›˜è¯»å–ï¼šDoc Values çš„åˆ—å¼å­˜å‚¨æ„å‘³ç€åœ¨æ‰§è¡Œæ’åºæˆ–èšåˆæ“ä½œæ—¶ï¼ŒElasticsearch å¯ä»¥åªåŠ è½½æ‰€éœ€çš„å­—æ®µå€¼ï¼Œè€Œä¸å¿…åŠ è½½æ•´ä¸ªæ–‡æ¡£ã€‚</li>
<li>æé«˜æ’åºå’Œèšåˆçš„æ€§èƒ½ï¼šå¯¹äºç»å¸¸éœ€è¦æ’åºæˆ–èšåˆçš„å­—æ®µï¼ŒDoc Values å¯ä»¥æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºå®ƒä¼˜åŒ–äº†è¯»å–è·¯å¾„ã€‚</li>
</ul>
<h3 data-id="heading-10">ä½¿ç”¨åœºæ™¯</h3>
<ul>
<li>æ’åºï¼šä¾‹å¦‚ï¼Œç”¨æˆ·éœ€è¦æ ¹æ®æ—¶é—´æˆ³æ’åºæŸ¥è¯¢ç»“æœï¼ŒDoc Values ä¼šæä¾›ä¼˜åŒ–çš„åˆ—å¼å­˜å‚¨ï¼Œç›´æ¥ä»ç£ç›˜è¯»å–æ—¶é—´æˆ³çš„å€¼è¿›è¡Œæ’åºï¼Œè€Œä¸éœ€è¦åŠ è½½æ•´ä¸ªæ–‡æ¡£ã€‚</li>
<li>èšåˆï¼šåœ¨æ‰§è¡Œä¾‹å¦‚ç»Ÿè®¡æŸä¸ªå­—æ®µçš„å¹³å‡å€¼ã€æœ€å¤§å€¼æˆ–åˆ†å¸ƒæƒ…å†µæ—¶ï¼ŒDoc Values å¯ä»¥æå¤§åœ°æé«˜æŸ¥è¯¢çš„å“åº”é€Ÿåº¦ï¼Œå› ä¸ºåªéœ€è¯»å–ç›¸å…³å­—æ®µå³å¯ã€‚</li>
<li>èŒƒå›´æŸ¥è¯¢ï¼šä¾‹å¦‚æŸ¥æ‰¾ä»·æ ¼åœ¨ä¸€å®šèŒƒå›´å†…çš„æ–‡æ¡£æ—¶ï¼ŒDoc Values å…è®¸å¿«é€Ÿæ‰«æä»·æ ¼å­—æ®µè€Œä¸æ¶‰åŠæ–‡æ¡£çš„å…¶ä»–å†…å®¹ã€‚</li>
</ul>
<h2 data-id="heading-11">é”™è¯¯é€ŸæŸ¥</h2>















































<table><thead><tr><th>ç—‡çŠ¶</th><th>æ ¹å› </th><th>å®šä½</th><th>ä¿®å¤</th></tr></thead><tbody><tr><td><code>sort/terms agg</code> æŠ¥ï¼š<code>Fielddata is disabled on text fields</code></td><td>åœ¨ <code>text</code> å­—æ®µä¸Šåšèšåˆ/æ’åºï¼›<code>text</code> é»˜è®¤æ—  <code>doc values</code></td><td><code>GET index/_mapping</code> çœ‹å­—æ®µç±»å‹æ˜¯å¦ä¸º <code>text</code>ï¼Œæ˜¯å¦å­˜åœ¨ <code>xxx.keyword</code></td><td>æŸ¥è¯¢æ”¹ç”¨ <code>xxx.keyword</code>ï¼›æˆ–æ˜¾å¼ <code>fielddata=true</code>ï¼ˆè¯„ä¼°å †å†…å­˜ä¸çƒ­åº¦ï¼‰ï¼›é•¿æœŸæ–¹æ¡ˆï¼šå»ºæ–°ç´¢å¼•ç”¨ <code>text + keyword</code> å¤šå­—æ®µ</td></tr><tr><td>æŒ‰å­—æ®µæ’åº/èšåˆå¤±è´¥ï¼Œæç¤ºè¯¥å­—æ®µä¸æ”¯æŒ <code>doc values</code></td><td>å­—æ®µç±»å‹ä¸æ”¯æŒæˆ–è¢«è®¾ç½® <code>doc_values:false</code></td><td><code>mapping</code> ä¸­æŸ¥ <code>doc_values</code> ä¸å­—æ®µç±»å‹</td><td>å¯¹éœ€è¦æ’åº/èšåˆ/è„šæœ¬çš„å­—æ®µä¿æŒ <code>doc_values:true</code>ï¼ˆå¯çœç•¥é»˜è®¤ï¼‰ï¼›å¯¹ä¸éœ€è¦åˆ†æèƒ½åŠ›çš„å­—ç¬¦ä¸²ç”¨ <code>keyword</code></td></tr><tr><td><code>PUT mapping</code> åå‘ç°â€œæ²¡ç”Ÿæ•ˆ/æ”¹ä¸æ‰/åˆ ä¸æ‰å­—æ®µâ€</td><td>ES <code>mapping</code> ä¸èƒ½æ›¿æ¢æˆ–ç§»é™¤æ—¢æœ‰å­—æ®µå®šä¹‰</td><td>çœ‹ <code>PUT _mapping</code> è¿”å›ä¸å®é™… <code>mapping</code> å¯¹æ¯”ï¼›æ£€æŸ¥æ˜¯å¦è¯•å›¾ä¿®æ”¹å·²æœ‰å­—æ®µå‚æ•°</td><td>èµ°â€œæ–°å»ºç´¢å¼• + æ­£ç¡® <code>mapping</code> + <code>reindex</code> + åˆ‡åˆ«åâ€çš„è¿ç§»è·¯å¾„ï¼›ä¸è¦æœŸå¾…åœ¨çº¿è¦†ç›–å¼æ”¹ <code>mapping</code></td></tr><tr><td>ç…§æŠ„ç¤ºä¾‹ç”¨ <code>DELETE /index</code> æºå¸¦ <code>body</code> è®¾ç½® <code>mapping</code>ï¼Œæ‰§è¡ŒæŠ¥é”™</td><td><code>DELETE</code> ç”¨äºåˆ ç´¢å¼•ï¼Œä¸æ˜¯å»º <code>mapping</code>ï¼›ç¤ºä¾‹è¯·æ±‚æ–¹æ³•ä¸åŒ¹é…</td><td>å›çœ‹è¯·æ±‚æ–¹æ³•ä¸ APIï¼šæ˜¯å¦æŠŠå»ºç´¢å¼•/å»º <code>mapping</code> å†™æˆ <code>DELETE</code></td><td>åˆ›å»ºç´¢å¼•ç”¨ <code>PUT /index {mappings...}</code>ï¼›æ›´æ–° <code>mapping</code> ç”¨ <code>PUT /index/_mapping {properties...}</code>ï¼ˆä½†ä¸ä¿è¯å¯æ”¹å·²æœ‰å­—æ®µï¼‰</td></tr><tr><td><code>doc_values</code> å…³é—­åï¼Œç£ç›˜çœäº†ä½†æŸ¥è¯¢/è„šæœ¬åŠŸèƒ½ç¼ºå¤±</td><td>å…³é—­ <code>doc values</code> ä¼šç›´æ¥ä¸¢å¤±æ’åº/èšåˆ/è„šæœ¬å–å€¼èƒ½åŠ›</td><td><code>mapping</code> æ£€æŸ¥ <code>doc_values:false</code>ï¼›å¤ç°ï¼š<code>sort/agg/script</code> ç«‹åˆ»å¤±è´¥</td><td>å¯¹â€œåªå†™å…¥ä¸åˆ†æâ€çš„å­—æ®µæ‰å…³ï¼›è‹¥çº¿ä¸Šå·²å…³ä¸”å¿…é¡»æ¢å¤ï¼Œé€šå¸¸éœ€è¦æ–°ç´¢å¼•é‡å»ºï¼ˆä¾èµ–å…·ä½“å­—æ®µä¸ç‰ˆæœ¬é™åˆ¶ï¼‰</td></tr><tr><td>èšåˆ/æ’åºå»¶è¿ŸæŠ–åŠ¨ï¼ŒCPU/IO å¼‚å¸¸</td><td><code>working set</code> å¤§ã€å†·çƒ­ä¸å‡ï¼›æŠŠ <code>text</code> å¼€ <code>fielddata</code> å¯¼è‡´å †å‹åŠ›</td><td>çœ‹ JVM å †ã€GCã€çƒ­å­—æ®µï¼›ç¡®è®¤æ˜¯å¦å¯ç”¨ <code>fielddata</code></td><td>ä¼˜å…ˆç”¨ <code>doc values</code>ï¼ˆ<code>keyword/numeric/date</code>ï¼‰ï¼›é¿å…åœ¨ <code>text</code> ä¸Šå¯ <code>fielddata</code>ï¼›å¿…è¦æ—¶åšå­—æ®µé™ç»´/åˆ†æ¡¶/é¢„èšåˆ</td></tr></tbody></table>
<h2 data-id="heading-12">å…¶ä»–ç³»åˆ—</h2>
<h3 data-id="heading-13">ğŸš€ AIç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>AIç‚¼ä¸¹æ—¥å¿—-29 - å­—èŠ‚è·³åŠ¨ DeerFlow æ·±åº¦ç ”ç©¶æ¡†<em>æ–œä½“æ ·å¼</em>æ¶ ç§æœ‰éƒ¨ç½² æµ‹è¯•ä¸Šæ‰‹ æ¶æ„ç ”ç©¶</strong>ï¼ŒæŒç»­æ‰“é€ å®ç”¨AIå·¥å…·æŒ‡å—ï¼
<strong>AIç ”ç©¶-132 Java ç”Ÿæ€å‰æ²¿ 2025ï¼šSpringã€Quarkusã€GraalVMã€CRaC ä¸äº‘åŸç”Ÿè½åœ°</strong></p>
<h3 data-id="heading-14">ğŸ’» Javaç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>Java-196 æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹ï¼šRabbitMQ vs RocketMQ vs Kafka</strong>
MyBatis å·²å®Œç»“ï¼ŒSpring å·²å®Œç»“ï¼ŒNginxå·²å®Œç»“ï¼ŒTomcatå·²å®Œç»“ï¼Œåˆ†å¸ƒå¼æœåŠ¡å·²å®Œç»“ï¼ŒDubboå·²å®Œç»“ï¼ŒMySQLå·²å®Œç»“ï¼ŒMongoDBå·²å®Œç»“ï¼ŒNeo4jå·²å®Œç»“ï¼ŒFastDFS å·²å®Œç»“ï¼ŒOSSå·²å®Œç»“ï¼ŒGuavaCacheå·²å®Œç»“ï¼ŒEVCacheå·²å®Œç»“ï¼ŒRabbitMQæ­£åœ¨æ›´æ–°... æ·±å…¥æµ…å‡ºåŠ©ä½ æ‰“ç‰¢åŸºç¡€ï¼</p>
<h3 data-id="heading-15">ğŸ“Š å¤§æ•°æ®æ¿å—å·²å®Œæˆå¤šé¡¹å¹²è´§æ›´æ–°ï¼ˆ300ç¯‡ï¼‰ï¼š</h3>
<p>åŒ…æ‹¬ Hadoopã€Hiveã€Kafkaã€Flinkã€ClickHouseã€Elasticsearch ç­‰äºŒåä½™é¡¹æ ¸å¿ƒç»„ä»¶ï¼Œè¦†ç›–ç¦»çº¿+å®æ—¶æ•°ä»“å…¨æ ˆï¼
<strong>å¤§æ•°æ®-278 Spark MLib - åŸºç¡€ä»‹ç» æœºå™¨å­¦ä¹ ç®—æ³• æ¢¯åº¦æå‡æ ‘ GBDTæ¡ˆä¾‹ è¯¦è§£</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šCasbiné›†æˆæŒ‡å—]]></title>    <link>https://juejin.cn/post/7583906870827433993</link>    <guid>https://juejin.cn/post/7583906870827433993</guid>    <pubDate>2025-12-15T10:19:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906870827433993" data-draft-id="7583878719543705609" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šCasbiné›†æˆæŒ‡å—"/> <meta itemprop="keywords" content="åç«¯,Go"/> <meta itemprop="datePublished" content="2025-12-15T10:19:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å–µä¸ªå’ª"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šCasbiné›†æˆæŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å–µä¸ªå’ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:19:38.000Z" title="Mon Dec 15 2025 10:19:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šCasbiné›†æˆæŒ‡å—</h2>
<p>GoWind Adminï¼ˆé£è¡Œï¼‰ä½œä¸ºå¼€ç®±å³ç”¨çš„ä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼Œè‡´åŠ›äºè§£å†³ä¸­åå°ç³»ç»Ÿå¼€å‘ä¸­çš„é€šç”¨é—®é¢˜ï¼Œè€Œæƒé™ç®¡ç†ä½œä¸ºä¸­åå°ç³»ç»Ÿçš„æ ¸å¿ƒå®‰å…¨èƒ½åŠ›ï¼Œæ˜¯æ¡†æ¶è®¾è®¡çš„é‡ä¸­ä¹‹é‡ã€‚Casbin ä½œä¸ºä¸€æ¬¾åŠŸèƒ½å¼ºå¤§ã€çµæ´»æ˜“ç”¨çš„å¼€æºè®¿é—®æ§åˆ¶æ¡†æ¶ï¼Œèƒ½å¤Ÿå®Œç¾é€‚é… GoWind Admin çš„æƒé™ç®¡ç†éœ€æ±‚ã€‚æœ¬æ–‡å°†è¯¦ç»†è®²è§£ Casbin çš„æ ¸å¿ƒåŸç†ã€é…ç½®è§„åˆ™ï¼Œå¹¶å®Œæ•´å‘ˆç°å…¶åœ¨ GoWind Admin ä¸­çš„é›†æˆæµç¨‹ä¸æœ€ä½³å®è·µã€‚</p>
<h3 data-id="heading-1">ä¸€ã€Casbin ç®€ä»‹ï¼šä¼ä¸šçº§æƒé™ç®¡ç†çš„ä¼˜é€‰æ–¹æ¡ˆ</h3>
<p>Casbinï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcasbin%2Fcasbin" target="_blank" title="https://github.com/casbin/casbin" ref="nofollow noopener noreferrer">github.com/casbin/casbâ€¦</a>ï¼‰æ˜¯ä¸€æ¬¾ä¸“æ³¨äºè®¿é—®æ§åˆ¶çš„å¼€æºåº“ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯å¸®åŠ©å¤æ‚ç³»ç»Ÿè§£å†³æƒé™ç®¡ç†çš„çµæ´»æ€§ä¸å®‰å…¨æ€§éš¾é¢˜ï¼Œä¹Ÿæ˜¯å›½å†…å¼€æºé¡¹ç›®ä¸­çš„ä¼˜ç§€ä»£è¡¨ã€‚å…¶æœ€å¤§ä¼˜åŠ¿åœ¨äºé‡‡ç”¨<strong>å…ƒæ¨¡å‹è®¾è®¡æ€æƒ³</strong>ï¼Œä¸å±€é™äºå›ºå®šçš„æƒé™æ¨¡å‹ï¼Œè€Œæ˜¯æ”¯æŒ ACLï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰ã€RBACï¼ˆåŸºäºè§’è‰²è®¿é—®æ§åˆ¶ï¼‰ã€ABACï¼ˆåŸºäºå±æ€§è®¿é—®æ§åˆ¶ï¼‰ã€RESTful ç­‰å¤šç§ç»å…¸è®¿é—®æ§åˆ¶æ¨¡å‹ï¼ŒåŒæ—¶å…è®¸å¼€å‘è€…æ ¹æ®ä¸šåŠ¡éœ€æ±‚è‡ªå®šä¹‰æƒé™è§„åˆ™ï¼Œå…·å¤‡æå¼ºçš„æ‰©å±•æ€§ã€‚
å‡­å€Ÿå“è¶Šçš„è®¾è®¡ä¸ç¨³å®šæ€§ï¼ŒCasbin å·²è·å¾—å…¨çƒä¼—å¤šä¼ä¸šçš„è®¤å¯ï¼šIntelã€IBMã€è…¾è®¯äº‘ã€VMwareã€RedHatã€T-Mobile ç­‰ä¼ä¸šå°†å…¶ç”¨äºå¼€æºé¡¹ç›®ï¼ŒCiscoã€Verizon ç­‰ä¼ä¸šåœ¨é—­æºç³»ç»Ÿä¸­é‡‡ç”¨ã€‚é¡¹ç›®ç”±åŒ—äº¬å¤§å­¦ç½—æ¨åšå£«äº 2017 å¹´ 4 æœˆå‘èµ·ï¼Œç½—æ¨åšå£«é•¿æœŸæ·±è€•äº‘è®¡ç®—è®¿é—®æ§åˆ¶é¢†åŸŸï¼Œå‘è¡¨æ•°åç¯‡ç›¸å…³å­¦æœ¯è®ºæ–‡ï¼Œå¹¶åœ¨ ICWSã€IEEE CLOUDã€ICICS ç­‰é¡¶çº§å­¦æœ¯ä¼šè®®å®£è®²ç ”ç©¶æˆæœï¼ŒCasbin æ­£æ˜¯å…¶å­¦æœ¯ç ”ç©¶ä¸å·¥ç¨‹å®è·µç»“åˆçš„æ ¸å¿ƒäº§ç‰©ã€‚</p>
<p>Casbin æœ€åˆåŸºäº Go è¯­è¨€å¼€å‘ï¼Œç›®å‰å·²æ‰©å±•è‡³ Javaã€Node.jsã€Javascript(React)ã€Pythonã€PHPã€.NETã€Delphiã€Rust ç­‰å¤šç§è¯­è¨€ï¼Œä¸»é¡¹ç›®åœ¨ GitHub ä¸Šå·²ç§¯ç´¯ 1.3w+ Starsï¼Œæ‹¥æœ‰ä¸Šç™¾äººçš„ç¨³å®šç»´æŠ¤å›¢é˜Ÿï¼ŒæŒç»­è¿­ä»£ä¼˜åŒ–ï¼Œç”Ÿæ€æ—¥è¶‹å®Œå–„ã€‚</p>
<h3 data-id="heading-2">äºŒã€æ·±å…¥ç†è§£ Casbin æ ¸å¿ƒæœºåˆ¶</h3>
<p>Casbin çš„æƒé™åˆ¤å®šé€»è¾‘å¯æ¦‚æ‹¬ä¸ºã€Œæ ¹æ®é¢„è®¾è§„åˆ™ï¼Œæ ¡éªŒè®¿é—®è¯·æ±‚æ˜¯å¦åˆæ³•ã€ï¼Œå…¶æ ¸å¿ƒç”±ä¸‰å¤§æ¦‚å¿µæ„æˆï¼Œä¸‰è€…ååŒå®Œæˆæƒé™åˆ¤å®šï¼Œåœ¨ Casbin å®˜æ–¹æä¾›çš„ <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">äº¤äº’å¼è§£é‡Šå™¨</a> ä¸­å¯ç›´è§‚æŸ¥çœ‹è¿è¡Œè¿‡ç¨‹ï¼ˆè¯¥å·¥å…·æ”¯æŒåœ¨çº¿æµ‹è¯•æ¨¡å‹ä¸ç­–ç•¥ï¼Œæ˜¯å­¦ä¹ ä¸è°ƒè¯•çš„å¿…å¤‡å·¥å…·ï¼‰ã€‚</p>
<h4 data-id="heading-3">2.1 ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µï¼ˆå®è§‚è§†è§’ï¼‰</h4>
<ol>
<li><strong>è¯·æ±‚ï¼ˆRequestï¼‰</strong>ï¼šç”¨æˆ·å‘èµ·çš„è®¿é—®ç”³è¯·ï¼Œå³ã€Œè°ï¼ˆç”¨æˆ·ï¼‰æƒ³å¯¹ä»€ä¹ˆï¼ˆèµ„æºï¼‰åšä»€ä¹ˆï¼ˆæ“ä½œï¼‰ã€ã€‚</li>
<li><strong>æ¨¡å‹ï¼ˆModelï¼‰</strong>ï¼šæƒé™åˆ¤å®šçš„è§„åˆ™æ¨¡æ¿ï¼Œå®šä¹‰äº†ã€Œå¦‚ä½•åˆ¤æ–­è¯·æ±‚æ˜¯å¦åˆæ³•ã€ï¼Œç›¸å½“äºæƒé™ç³»ç»Ÿçš„ã€Œåˆ¤å®šæ‰‹å†Œã€ã€‚</li>
<li><strong>ç­–ç•¥ï¼ˆPolicyï¼‰</strong>ï¼šå…·ä½“çš„æƒé™åˆ†é…æ•°æ®ï¼Œå®šä¹‰äº†ã€Œè°æ‹¥æœ‰å¯¹ä»€ä¹ˆèµ„æºçš„ä»€ä¹ˆæ“ä½œæƒé™ã€ï¼Œç›¸å½“äºæƒé™ç³»ç»Ÿçš„ã€Œæƒé™æ¸…å•ã€ã€‚</li>
</ol>
<p>ä¸¾ä¸ªé€šä¿—ç¤ºä¾‹ï¼šç”¨æˆ· Bob å‘èµ· HTTP GET è¯·æ±‚è®¿é—® <code>/users</code> æ¥å£ï¼ˆè¯·æ±‚ï¼‰ï¼›ç³»ç»Ÿé‡‡ç”¨ RBAC æ¨¡å‹ï¼Œè§„åˆ™å®šä¹‰ä¸ºã€Œè¶…çº§ç”¨æˆ·å¯è®¿é—®æ‰€æœ‰èµ„æºã€ï¼ˆæ¨¡å‹ï¼‰ï¼›ç­–ç•¥ä¸­æ˜ç¡®ã€ŒBob å±äºè¶…çº§ç”¨æˆ·è§’è‰²ã€ï¼ˆç­–ç•¥ï¼‰ã€‚Casbin ä¾æ®æ¨¡å‹è§„åˆ™æ ¡éªŒè¯·æ±‚ä¸ç­–ç•¥çš„åŒ¹é…å…³ç³»ï¼Œæœ€ç»ˆåˆ¤å®š Bob æœ‰æƒè®¿é—®è¯¥æ¥å£ã€‚</p>
<h4 data-id="heading-4">2.2 è¯·æ±‚çš„æ ¸å¿ƒæ„æˆï¼ˆå¾®è§‚è§†è§’ï¼‰</h4>
<p>ä»»ä½•æƒé™è¯·æ±‚éƒ½å¯æŠ½è±¡ä¸ºä¸€ä¸ªã€Œä¸‰å…ƒç»„ã€ï¼ˆåŸºç¡€æ¬¾ï¼‰ï¼Œå¤æ‚åœºæ™¯å¯æ‰©å±•ä¸ºã€Œå››å…ƒç»„ã€ï¼ˆå¢åŠ åŸŸ/ç§Ÿæˆ·ç»´åº¦ï¼‰ï¼š</p>
<ol>
<li><strong>è®¿é—®å®ä½“ï¼ˆSubjectï¼‰</strong>ï¼šå‘èµ·è®¿é—®çš„ä¸»ä½“ï¼Œé€šå¸¸æ˜¯ç”¨æˆ·ã€è§’è‰²ã€æœåŠ¡è´¦å·ç­‰ã€‚</li>
<li><strong>è®¿é—®èµ„æºï¼ˆObjectï¼‰</strong>ï¼šè¢«è®¿é—®çš„ç›®æ ‡ï¼Œå¦‚æ¥å£è·¯å¾„ã€æ•°æ®åº“è¡¨ã€æ–‡ä»¶è·¯å¾„ç­‰ã€‚</li>
<li><strong>è®¿é—®æ–¹æ³•ï¼ˆActionï¼‰</strong>ï¼šå¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œï¼Œå¦‚ HTTP æ–¹æ³•ï¼ˆGET/POST/PUT/DELETEï¼‰ã€æ•°æ®åº“æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ç­‰ã€‚</li>
<li><strong>è®¿é—®åŸŸï¼ˆDomainï¼‰</strong>ï¼šå¯é€‰ç»´åº¦ï¼Œç”¨äºå¤šç§Ÿæˆ·/å¤šç»„ç»‡åœºæ™¯ï¼ŒåŒºåˆ†ä¸åŒåŸŸä¸‹çš„èµ„æºæƒé™ã€‚</li>
</ol>
<p>Casbin é€šè¿‡ <code>Enforcer.Enforce</code> æ–¹æ³•æ¥æ”¶ä¸Šè¿°å‚æ•°å¹¶æ‰§è¡Œåˆ¤å®šï¼Œä¾‹å¦‚ä¸Šè¿°ç¤ºä¾‹çš„è°ƒç”¨å½¢å¼ä¸ºï¼š<code>Enforcer.Enforce("Bob", "/users", "GET")</code>ã€‚</p>
<h3 data-id="heading-5">ä¸‰ã€Casbin æ ¸å¿ƒé…ç½®è§£æ</h3>
<p>Casbin çš„è¿è¡Œä¾èµ–ã€Œæ¨¡å‹ã€ä¸ã€Œç­–ç•¥ã€ä¸¤å¤§é…ç½®ï¼šæ¨¡å‹å®šä¹‰æƒé™åˆ¤å®šçš„è§„åˆ™æ¨¡æ¿ï¼ˆé™æ€é…ç½®ï¼Œä¸€èˆ¬ä¸å¸¸å˜åŠ¨ï¼‰ï¼Œç­–ç•¥å®šä¹‰å…·ä½“çš„æƒé™åˆ†é…ï¼ˆåŠ¨æ€é…ç½®ï¼Œéœ€æ ¹æ®ä¸šåŠ¡åœºæ™¯åŠ¨æ€æ›´æ–°ï¼Œé€šå¸¸æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼‰ã€‚</p>
<h4 data-id="heading-6">3.1 æ¨¡å‹é…ç½®ï¼ˆAccess Control Modelï¼‰</h4>
<p>æ¨¡å‹é€šè¿‡é…ç½®æ–‡ä»¶å®šä¹‰ï¼Œé‡‡ç”¨ INI æ ¼å¼ï¼Œæ ¸å¿ƒåŒ…å«äº”éƒ¨åˆ†ï¼ˆå…¶ä¸­è§’è‰²å®šä¹‰ä¸º RBAC æ¨¡å‹ä¸“ç”¨ï¼Œå¯é€‰ï¼‰ã€‚ä¸‹é¢ä»¥ GoWind Admin é»˜è®¤é›†æˆçš„ RBAC æ¨¡å‹ä¸ºä¾‹ï¼Œé€éƒ¨åˆ†è§£æï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># è¯·æ±‚å®šä¹‰ï¼šæŒ‡å®š Enforce æ–¹æ³•çš„å‚æ•°é¡ºåºä¸åç§°</span>
<span class="hljs-section">[request_definition]</span>
<span class="hljs-attr">r</span> = sub, obj, act, dom  <span class="hljs-comment"># å››å…ƒç»„ï¼šä¸»ä½“ã€èµ„æºã€æ“ä½œã€åŸŸ</span>

<span class="hljs-comment"># ç­–ç•¥å®šä¹‰ï¼šæŒ‡å®šæƒé™è§„åˆ™çš„å­—æ®µé¡ºåºä¸åç§°</span>
<span class="hljs-section">[policy_definition]</span>
<span class="hljs-attr">p</span> = sub, obj, act, dom  <span class="hljs-comment"># ä¸è¯·æ±‚å®šä¹‰å¯¹åº”ï¼Œå¯å¢åŠ  eftï¼ˆallow/denyï¼‰å­—æ®µæŒ‡å®šæƒé™ç±»å‹</span>

<span class="hljs-comment"># è§’è‰²å®šä¹‰ï¼šRBAC æ¨¡å‹ä¸“ç”¨ï¼Œå®šä¹‰ç”¨æˆ·ä¸è§’è‰²çš„æ˜ å°„å…³ç³»</span>
<span class="hljs-section">[role_definition]</span>
<span class="hljs-attr">g</span> = _, _, _  <span class="hljs-comment"># å‰ä¸¤ä¸ªå‚æ•°ï¼šç”¨æˆ·â†’è§’è‰²ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šåŸŸï¼ˆå¯é€‰ï¼Œå¤šç§Ÿæˆ·åœºæ™¯ï¼‰</span>

<span class="hljs-comment"># ç­–ç•¥æ•ˆæœï¼šå®šä¹‰å¤šä¸ªåŒ¹é…è§„åˆ™çš„ç»„åˆé€»è¾‘</span>
<span class="hljs-section">[policy_effect]</span>
<span class="hljs-attr">e</span> = some(where (p.eft == allow))  <span class="hljs-comment"># å­˜åœ¨ä»»æ„ä¸€æ¡å…è®¸è§„åˆ™å³åˆ¤å®šä¸ºé€šè¿‡</span>

<span class="hljs-comment"># åŒ¹é…å™¨å®šä¹‰ï¼šå®šä¹‰è¯·æ±‚ä¸ç­–ç•¥çš„åŒ¹é…è§„åˆ™</span>
<span class="hljs-section">[matchers]</span>
<span class="hljs-attr">m</span> = g(r.sub, p.sub, r.dom) &amp;&amp; keyMatch2(r.obj, p.obj) &amp;&amp; (regexMatch(r.act, p.act) || p.act == <span class="hljs-string">'ANY'</span>) &amp;&amp; (keyMatch(r.dom, p.dom) || p.dom == <span class="hljs-string">'*'</span>)
<span class="hljs-comment"># è§£æï¼šç”¨æˆ·è§’è‰²åŒ¹é… &amp;&amp; èµ„æºè·¯å¾„åŒ¹é…ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰ &amp;&amp; æ“ä½œåŒ¹é…ï¼ˆæ”¯æŒæ­£åˆ™/ä»»æ„æ“ä½œï¼‰ &amp;&amp; åŸŸåŒ¹é…ï¼ˆæ”¯æŒé€šé…ç¬¦/ä»»æ„åŸŸï¼‰</span>
</code></pre>
<h4 data-id="heading-7">3.1.1 å„éƒ¨åˆ†è¯¦ç»†è¯´æ˜</h4>
<ol>
<li><strong>è¯·æ±‚å®šä¹‰ï¼ˆRequest Definitionï¼‰</strong> ç”¨äºç»‘å®š <code>Enforcer.Enforce</code> æ–¹æ³•çš„å…¥å‚ï¼Œæ ¼å¼ä¸º <code>r = å‚æ•°1, å‚æ•°2, ...</code>ã€‚åŸºç¡€åœºæ™¯ç”¨ä¸‰å…ƒç»„ï¼ˆsub, obj, actï¼‰ï¼Œå¤šç§Ÿæˆ·åœºæ™¯éœ€å¢åŠ  domï¼ˆåŸŸï¼‰å‚æ•°ï¼Œå½¢æˆå››å…ƒç»„ã€‚ç¤ºä¾‹ï¼ˆåŸºç¡€ä¸‰å…ƒç»„ï¼‰ï¼š<code>r = sub, obj, act</code></li>
<li><strong>ç­–ç•¥å®šä¹‰ï¼ˆPolicy Definitionï¼‰</strong> å®šä¹‰æƒé™è§„åˆ™çš„å­—æ®µç»“æ„ï¼Œæ ¼å¼ä¸º <code>p = å­—æ®µ1, å­—æ®µ2, ...</code>ï¼Œå­—æ®µé¡ºåºéœ€ä¸è¯·æ±‚å®šä¹‰å¯¹åº”ã€‚å¯é€‰å¢åŠ  <code>eft</code> å­—æ®µï¼ˆå–å€¼ä¸º allow/denyï¼‰ï¼Œç”¨äºæ˜ç¡®è§„åˆ™æ˜¯ã€Œå…è®¸ã€è¿˜æ˜¯ã€Œæ‹’ç»ã€ï¼ˆé»˜è®¤ä¸º allowï¼‰ã€‚ç¤ºä¾‹ï¼ˆå« eft å­—æ®µï¼‰ï¼š<code>p = eft, sub, obj, act</code></li>
<li><strong>åŒ¹é…å™¨å®šä¹‰ï¼ˆMatcherï¼‰</strong> æ ¸å¿ƒè§„åˆ™ï¼Œå®šä¹‰è¯·æ±‚ï¼ˆrï¼‰ä¸ç­–ç•¥ï¼ˆpï¼‰çš„åŒ¹é…é€»è¾‘ï¼Œæ”¯æŒå¤šç§å†…ç½®å‡½æ•°ï¼š<code>g(r.sub, p.sub)</code>ï¼šæ ¡éªŒç”¨æˆ·ï¼ˆr.subï¼‰æ˜¯å¦æ‹¥æœ‰ç­–ç•¥ä¸­çš„è§’è‰²ï¼ˆp.subï¼‰ï¼›</li>
<li><code>keyMatch2(r.obj, p.obj)</code>ï¼šæ”¯æŒè·¯å¾„é€šé…ç¬¦åŒ¹é…ï¼ˆå¦‚ <code>/user/:id</code> å¯åŒ¹é… <code>/user/123</code>ï¼‰ï¼›</li>
<li><code>regexMatch(r.act, p.act)</code>ï¼šæ”¯æŒæ­£åˆ™åŒ¹é…æ“ä½œï¼ˆå¦‚ <code>GET|POST</code> å¯åŒ¹é… <code>GET</code> æˆ– <code>POST</code> æ–¹æ³•ï¼‰ï¼›</li>
<li><code>keyMatch(r.dom, p.dom)</code>ï¼šåŸŸåŒ¹é…ï¼Œæ”¯æŒé€šé…ç¬¦ã€‚</li>
<li><strong>ç­–ç•¥æ•ˆæœï¼ˆPolicy Effectï¼‰</strong> å½“å­˜åœ¨å¤šæ¡ç­–ç•¥è§„åˆ™æ—¶ï¼Œå®šä¹‰æœ€ç»ˆçš„åˆ¤å®šé€»è¾‘ï¼Œæ”¯æŒå¤šç§é€»è¾‘è¡¨è¾¾å¼ï¼š<code>some(where (p.eft == allow))</code>ï¼šå­˜åœ¨ä»»æ„ä¸€æ¡å…è®¸è§„åˆ™å³é€šè¿‡ï¼ˆé»˜è®¤å¸¸ç”¨ï¼‰ï¼›</li>
<li><code>all(where (p.eft == allow))</code>ï¼šæ‰€æœ‰è§„åˆ™å‡ä¸ºå…è®¸æ‰é€šè¿‡ï¼›</li>
<li><code>some(where (p.eft == deny)) &amp;&amp; !some(where (p.eft == allow))</code>ï¼šå­˜åœ¨æ‹’ç»è§„åˆ™ä¸”æ— å…è®¸è§„åˆ™æ—¶æ‹’ç»ã€‚</li>
<li><strong>è§’è‰²å®šä¹‰ï¼ˆRole Definitionï¼‰</strong> RBAC æ¨¡å‹ä¸“ç”¨ï¼Œå®šä¹‰ç”¨æˆ·ä¸è§’è‰²çš„æ˜ å°„å…³ç³»ï¼Œæ ¼å¼ä¸º <code>g = _, _, _</code>ï¼šäºŒå…ƒç»„<code>ï¼ˆg = _, _ï¼‰</code>ï¼šé€‚ç”¨äºå•ç§Ÿæˆ·åœºæ™¯ï¼Œå¦‚ <code>g, alice, admin</code> è¡¨ç¤º <code>alice</code> æ˜¯ <code>admin</code> è§’è‰²ï¼›</li>
<li>ä¸‰å…ƒç»„ï¼ˆg = _, _, _ï¼‰ï¼šé€‚ç”¨äºå¤šç§Ÿæˆ·åœºæ™¯ï¼Œå¦‚ <code>g, alice, admin, tenant1</code> è¡¨ç¤º <code>alice</code> åœ¨ <code>tenant1</code> åŸŸä¸‹æ˜¯ <code>admin</code> è§’è‰²ã€‚</li>
</ol>
<h4 data-id="heading-8">3.2 ç­–ç•¥é…ç½®ï¼ˆPolicy Documentï¼‰</h4>
<p>ç­–ç•¥æ˜¯æ ¹æ®æ¨¡å‹å®šä¹‰ç”Ÿæˆçš„å…·ä½“æƒé™è§„åˆ™ï¼Œé‡‡ç”¨ CSV æ ¼å¼ï¼ˆæˆ–å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼‰ï¼Œæ¯æ¡è§„åˆ™å¯¹åº”ä¸€æ¡æƒé™åˆ†é…è®°å½•ã€‚è§„åˆ™å­—æ®µé¡ºåºéœ€ä¸æ¨¡å‹ä¸­ <code>policy_definition</code> çš„å®šä¹‰å®Œå…¨ä¸€è‡´ã€‚</p>
<h5 data-id="heading-9">3.2.1 åŸºç¡€ç¤ºä¾‹ï¼ˆRBAC æ¨¡å‹ï¼‰</h5>
<pre><code class="hljs language-csv" lang="csv"># æ ¼å¼ï¼šp, ä¸»ä½“ï¼ˆç”¨æˆ·/è§’è‰²ï¼‰, èµ„æº, æ“ä½œ, åŸŸï¼ˆå¯é€‰ï¼‰
# è§’è‰²æƒé™è§„åˆ™ï¼šadmin è§’è‰²å¯è®¿é—®æ‰€æœ‰èµ„æºï¼ˆé€šé…ç¬¦ *ï¼‰çš„æ‰€æœ‰æ“ä½œ
p, admin, *, *, *
# ç”¨æˆ·è§’è‰²æ˜ å°„ï¼šalice å±äº admin è§’è‰²ï¼ˆå¤šç§Ÿæˆ·åŸŸ tenant1ï¼‰
g, alice, admin, tenant1
# æ™®é€šç”¨æˆ·è§„åˆ™ï¼šbob å¯è®¿é—® /users æ¥å£çš„ GET æ–¹æ³•ï¼ˆåŸŸ tenant2ï¼‰
p, bob, /users, GET, tenant2
</code></pre>
<h5 data-id="heading-10">3.2.2 æ ¸å¿ƒè¯´æ˜</h5>
<ul>
<li>ç­–ç•¥ä¸»ä½“ï¼ˆsubï¼‰å¯æ˜¯ç”¨æˆ·æˆ–è§’è‰²ï¼šç›´æ¥ç»™ç”¨æˆ·åˆ†é…æƒé™ï¼ˆç›´è¿æˆæƒï¼‰æˆ–ç»™è§’è‰²åˆ†é…æƒé™ï¼ˆè§’è‰²æˆæƒï¼Œæ¨èï¼Œç¬¦åˆ RBAC æ€æƒ³ï¼‰ï¼›</li>
<li>èµ„æºï¼ˆobjï¼‰ä¸æ“ä½œï¼ˆactï¼‰æ”¯æŒé€šé…ç¬¦ <code>*</code>ï¼š<code>*</code> è¡¨ç¤ºä»»æ„èµ„æº/æ“ä½œï¼›</li>
<li>å¤šç§Ÿæˆ·åœºæ™¯å¿…é¡»æŒ‡å®šåŸŸï¼ˆdomï¼‰ï¼šé€šè¿‡åŸŸéš”ç¦»ä¸åŒç§Ÿæˆ·çš„æƒé™ï¼Œé¿å…æƒé™æ³„éœ²ï¼›</li>
<li>ç­–ç•¥æŒä¹…åŒ–ï¼šå®é™…é¡¹ç›®ä¸­ï¼Œç­–ç•¥è§„åˆ™ä¸ä¼šå­˜å‚¨åœ¨ CSV æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯æŒä¹…åŒ–åˆ° MySQLã€PostgreSQL ç­‰æ•°æ®åº“ï¼Œä¾¿äºåŠ¨æ€æ›´æ–°ä¸ç®¡ç†ã€‚</li>
</ul>
<h3 data-id="heading-11">å››ã€Casbin é›†æˆ GoWind Admin å®Œæ•´æ­¥éª¤</h3>
<p>GoWind Admin å·²å°† Casbin å°è£…è‡³ &lt;github.com/tx7do/kratos-authz&gt; ç»„ä»¶ä¸­ï¼Œå¼€å‘è€…æ— éœ€é‡å¤å®ç°æ ¸å¿ƒé€»è¾‘ï¼Œåªéœ€æŒ‰ä»¥ä¸‹æ­¥éª¤å®Œæˆé›†æˆä¸é…ç½®å³å¯ã€‚</p>
<h4 data-id="heading-12">4.1 æ ¸å¿ƒå°è£…ï¼šAuthorizer æƒé™ç®¡ç†å™¨</h4>
<p>é¦–å…ˆï¼Œåœ¨ <code>app/admin/service/internal/data/authorizer.go</code> ä¸­å®ç°æƒé™ç®¡ç†å™¨ï¼Œå°è£… Casbin å¼•æ“çš„åˆå§‹åŒ–ã€ç­–ç•¥é‡ç½®ç­‰æ ¸å¿ƒé€»è¾‘ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/data/authorizer.go</span>

<span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"context"</span>
	<span class="hljs-string">"errors"</span>

	<span class="hljs-string">"github.com/go-kratos/kratos/v2/log"</span>

	authzEngine <span class="hljs-string">"github.com/tx7do/kratos-authz/engine"</span>
	<span class="hljs-string">"github.com/tx7do/kratos-authz/engine/casbin"</span>
	<span class="hljs-string">"github.com/tx7do/kratos-authz/engine/noop"</span>

	pagination <span class="hljs-string">"github.com/tx7do/go-crud/api/gen/go/pagination/v1"</span>
	<span class="hljs-string">"github.com/tx7do/go-utils/trans"</span>
	conf <span class="hljs-string">"github.com/tx7do/kratos-bootstrap/api/gen/go/conf/v1"</span>

	<span class="hljs-string">"go-wind-admin/app/admin/service/cmd/server/assets"</span>

	adminV1 <span class="hljs-string">"go-wind-admin/api/gen/go/admin/service/v1"</span>
	userV1 <span class="hljs-string">"go-wind-admin/api/gen/go/user/service/v1"</span>
)

<span class="hljs-comment">// Authorizer æƒé™ç®¡ç†å™¨</span>
<span class="hljs-keyword">type</span> Authorizer <span class="hljs-keyword">struct</span> {
	log *log.Helper

	roleRepo        *RoleRepo
	apiResourceRepo *ApiResourceRepo

	engine authzEngine.Engine
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAuthorizer</span><span class="hljs-params">(
	logger log.Logger,
	cfg *conf.Bootstrap,
	roleRepo *RoleRepo,
	apiResourceRepo *ApiResourceRepo,
)</span></span> *Authorizer {
	a := &amp;Authorizer{
		log:             log.NewHelper(log.With(logger, <span class="hljs-string">"module"</span>, <span class="hljs-string">"authorizer/repo/admin-service"</span>)),
		roleRepo:        roleRepo,
		apiResourceRepo: apiResourceRepo,
	}

	a.init(cfg)

	<span class="hljs-keyword">return</span> a
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> init(cfg *conf.Bootstrap) {
	a.engine = a.newEngine(cfg)

	<span class="hljs-keyword">if</span> err := a.ResetPolicies(context.Background()); err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"reset policies error: %v"</span>, err)
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> newEngine(cfg *conf.Bootstrap) authzEngine.Engine {
	<span class="hljs-keyword">if</span> cfg.Authz == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	}

	ctx := context.Background()

	<span class="hljs-keyword">switch</span> cfg.GetAuthz().GetType() {
	<span class="hljs-keyword">default</span>:
		<span class="hljs-keyword">fallthrough</span>
	<span class="hljs-keyword">case</span> <span class="hljs-string">"noop"</span>:
		state, err := noop.NewEngine(ctx)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"new noop engine error: %v"</span>, err)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		}
		<span class="hljs-keyword">return</span> state

	<span class="hljs-keyword">case</span> <span class="hljs-string">"casbin"</span>:
		state, err := casbin.NewEngine(ctx)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"init casbin engine error: %v"</span>, err)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		}
		<span class="hljs-keyword">return</span> state
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> Engine() authzEngine.Engine {
	<span class="hljs-keyword">return</span> a.engine
}

<span class="hljs-comment">// ResetPolicies é‡ç½®ç­–ç•¥</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> ResetPolicies(ctx context.Context) <span class="hljs-type">error</span> {
	<span class="hljs-comment">//a.log.Info("*******************reset policies")</span>

	roles, err := a.roleRepo.List(ctx, &amp;pagination.PagingRequest{NoPaging: trans.Ptr(<span class="hljs-literal">true</span>)})
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"failed to list roles: %v"</span>, err)
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-keyword">if</span> roles == <span class="hljs-literal">nil</span> || <span class="hljs-built_in">len</span>(roles.Items) &lt; <span class="hljs-number">1</span> {
		a.log.Warnf(<span class="hljs-string">"no roles found to set policies"</span>)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// No roles to set policies</span>
	}

	apis, err := a.apiResourceRepo.List(ctx, &amp;pagination.PagingRequest{NoPaging: trans.Ptr(<span class="hljs-literal">true</span>)})
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"failed to list APIs: %v"</span>, err)
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-keyword">if</span> apis == <span class="hljs-literal">nil</span> || <span class="hljs-built_in">len</span>(apis.Items) &lt; <span class="hljs-number">1</span> {
		a.log.Warnf(<span class="hljs-string">"no APIs found to set policies for roles"</span>)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// No APIs to set policies</span>
	}

	<span class="hljs-comment">//a.log.Debugf("roles [%d] apis [%d]", len(roles.Items), len(apis.Items))</span>

	<span class="hljs-keyword">var</span> policies authzEngine.PolicyMap

	<span class="hljs-keyword">switch</span> a.engine.Name() {
	<span class="hljs-keyword">case</span> <span class="hljs-string">"casbin"</span>:
		<span class="hljs-keyword">if</span> policies, err = a.generateCasbinPolicies(roles, apis); err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"generate casbin policies error: %v"</span>, err)
			<span class="hljs-keyword">return</span> err
		}

	<span class="hljs-keyword">case</span> <span class="hljs-string">"noop"</span>:
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>

	<span class="hljs-keyword">default</span>:
		a.log.Warnf(<span class="hljs-string">"unknown engine name: %s"</span>, a.engine.Name())
		<span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">"unknown authz engine name"</span>)
	}

	<span class="hljs-comment">//a.log.Debugf("***************** policy rules len: %v", len(rules))</span>

	<span class="hljs-keyword">if</span> err = a.engine.SetPolicies(context.Background(), policies, <span class="hljs-literal">nil</span>); err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"set policies error: %v"</span>, err)
		<span class="hljs-keyword">return</span> err
	}
	a.log.Infof(<span class="hljs-string">"Reloaded policy rules"</span>)

	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// generateCasbinPolicies ç”Ÿæˆ Casbin ç­–ç•¥</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> generateCasbinPolicies(roles *userV1.ListRoleResponse, apis *adminV1.ListApiResourceResponse) (authzEngine.PolicyMap, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">var</span> rules []casbin.PolicyRule
	apiSet := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">uint32</span>]<span class="hljs-keyword">struct</span>{})

	domain := <span class="hljs-string">"*"</span>

	<span class="hljs-keyword">for</span> _, role := <span class="hljs-keyword">range</span> roles.Items {
		<span class="hljs-keyword">if</span> role.GetId() == <span class="hljs-number">0</span> {
			<span class="hljs-keyword">continue</span> <span class="hljs-comment">// Skip if role or API ID is not set</span>
		}

		<span class="hljs-keyword">for</span> _, apiId := <span class="hljs-keyword">range</span> role.GetApis() {
			apiSet[apiId] = <span class="hljs-keyword">struct</span>{}{}
		}

		<span class="hljs-keyword">for</span> _, api := <span class="hljs-keyword">range</span> apis.Items {
			<span class="hljs-keyword">if</span> api.GetId() == <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span> <span class="hljs-comment">// Skip if role or API ID is not set</span>
			}

			<span class="hljs-keyword">if</span> _, exists := apiSet[api.GetId()]; exists {
				rules = <span class="hljs-built_in">append</span>(rules, casbin.PolicyRule{
					PType: <span class="hljs-string">"p"</span>,
					V0:    role.GetCode(),
					V1:    api.GetPath(),
					V2:    api.GetMethod(),
					V3:    domain,
				})
			}
		}
	}

	policies := authzEngine.PolicyMap{
		<span class="hljs-string">"policies"</span>: rules,
		<span class="hljs-string">"projects"</span>: authzEngine.MakeProjects(),
	}

	<span class="hljs-keyword">return</span> policies, <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 data-id="heading-13">4.2 ä¾èµ–æ³¨å…¥ï¼šæ³¨å†Œ Authorizer åˆ° Wire å®¹å™¨</h4>
<p>ä¿®æ”¹ <code>app/admin/service/internal/data/init.go</code>ï¼Œå°† <code>NewAuthorizer</code> æ³¨å†Œåˆ° Wire ä¾èµ–æ³¨å…¥å®¹å™¨ï¼Œç¡®ä¿æ¡†æ¶å¯åŠ¨æ—¶èƒ½è‡ªåŠ¨åˆå§‹åŒ–ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/data/init.go</span>
<span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/google/wire"</span>

<span class="hljs-comment">// ProviderSet æ•°æ®å±‚ä¾èµ–æ³¨å…¥é›†åˆï¼šæ³¨å†Œ Authorizer åŠå…¶ä»–æ•°æ®ä»“åº“</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    NewAuthorizer,        <span class="hljs-comment">// æ³¨å†Œæƒé™ç®¡ç†å™¨</span>
    NewRoleRepo,          <span class="hljs-comment">// æ³¨å†Œè§’è‰²æ•°æ®ä»“åº“</span>
    NewApiResourceRepo,   <span class="hljs-comment">// æ³¨å†Œ API èµ„æºæ•°æ®ä»“åº“</span>
    <span class="hljs-comment">// ... å…¶ä»–æ•°æ®ä»“åº“</span>
)
</code></pre>
<h4 data-id="heading-14">4.3 ä¸­é—´ä»¶é›†æˆï¼šå°†æƒé™æ ¡éªŒåµŒå…¥ REST æœåŠ¡</h4>
<p>ä¿®æ”¹ <code>app/admin/service/internal/server/rest.go</code>ï¼Œå°† Casbin æƒé™æ ¡éªŒä¸­é—´ä»¶åµŒå…¥ REST æœåŠ¡å™¨çš„è¯·æ±‚é“¾è·¯ä¸­ï¼Œå®ç°å¯¹æ‰€æœ‰æ¥å£çš„æƒé™æ‹¦æˆªï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/server/rest.go</span>

<span class="hljs-keyword">package</span> server

<span class="hljs-comment">// NewMiddleware åˆ›å»ºä¸­é—´ä»¶</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newRestMiddleware</span><span class="hljs-params">(
	logger log.Logger,
	authenticator authnEngine.Authenticator,
	authorizer *data.Authorizer,
)</span></span> []middleware.Middleware {
	<span class="hljs-keyword">var</span> ms []middleware.Middleware
	ms = <span class="hljs-built_in">append</span>(ms, logging.Server(logger))

	ms = <span class="hljs-built_in">append</span>(ms, selector.Server(
		authn.Server(authenticator),
		auth.Server(),
		authz.Server(authorizer.Engine()),
	).Match(newRestWhiteListMatcher()).Build())

	<span class="hljs-keyword">return</span> ms
}

<span class="hljs-comment">// NewRESTServer new an HTTP server.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRESTServer</span><span class="hljs-params">(
    cfg *conf.Bootstrap, logger log.Logger,
	authenticator authnEngine.Authenticator, authorizer *data.Authorizer,
)</span></span> {
    ...

	srv := rpc.CreateRestServer(cfg,
		newRestMiddleware(logger, authenticator, authorizer)...,
	)

    ...
}
</code></pre>
<h4 data-id="heading-15">4.4 é…ç½®å¯ç”¨ï¼šä¿®æ”¹ auth.yaml å¯ç”¨ Casbin</h4>
<p>ä¿®æ”¹ <code>app/admin/service/configs/auth.yaml</code>ï¼Œå°†æƒé™å¼•æ“ç±»å‹è®¾ç½®ä¸º casbinï¼Œå¯ç”¨æƒé™æ ¡éªŒï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># app/admin/service/configs/auth.yaml</span>
<span class="hljs-comment"># æƒé™é…ç½®</span>
<span class="hljs-attr">authz:</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">"casbin"</span>  <span class="hljs-comment"># å¯é€‰å€¼ï¼šcasbinï¼ˆå¯ç”¨æƒé™æ ¡éªŒï¼‰ã€noopï¼ˆç¦ç”¨ï¼‰</span>
  <span class="hljs-comment"># casbin é¢å¤–é…ç½®ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€ç¼“å­˜ç­‰ï¼Œæ ¹æ®å®é™…éœ€æ±‚æ·»åŠ ï¼‰</span>
  <span class="hljs-comment"># casbin:</span>
  <span class="hljs-comment">#   driver: "mysql"</span>
  <span class="hljs-comment">#   dsn: "user:password@tcp(127.0.0.1:3306)/casbin?parseTime=true"</span>
</code></pre>
<h4 data-id="heading-16">4.5 è‡ªå®šä¹‰æ¨¡å‹ï¼šå†…åµŒè‡ªå®šä¹‰ Casbin æ¨¡å‹</h4>
<p>è‹¥é»˜è®¤ RBAC æ¨¡å‹ä¸æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œå¯è‡ªå®šä¹‰æ¨¡å‹æ–‡ä»¶ï¼Œé€šè¿‡ assets å†…åµŒåˆ°é¡¹ç›®ä¸­ï¼š</p>
<h5 data-id="heading-17">1. åˆ›å»ºæ¨¡å‹æ–‡ä»¶</h5>
<p>åœ¨ <code>app/admin/service/cmd/server/assets/</code> ç›®å½•ä¸‹åˆ›å»º <code>casbin_model.conf</code>ï¼Œç¼–å†™è‡ªå®šä¹‰æ¨¡å‹è§„åˆ™ï¼ˆå‚è€ƒ 3.1 èŠ‚ï¼‰ï¼›</p>
<h5 data-id="heading-18">2. å†…åµŒæ¨¡å‹æ–‡ä»¶</h5>
<p>ä¿®æ”¹ <code>app/admin/service/cmd/server/assets/assets.go</code>ï¼Œé€šè¿‡ <code>//go:embed</code> æŒ‡ä»¤å°†æ¨¡å‹æ–‡ä»¶å†…åµŒåˆ°ç¨‹åºä¸­ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/cmd/server/assets/assets.go</span>

<span class="hljs-keyword">package</span> assets

<span class="hljs-keyword">import</span> _ <span class="hljs-string">"embed"</span>

<span class="hljs-comment">//go:embed casbin_model.conf </span>
<span class="hljs-keyword">var</span> CasbinModel []<span class="hljs-type">byte</span> <span class="hljs-comment">// å†…åµŒè‡ªå®šä¹‰ Casbin æ¨¡å‹</span>
</code></pre>
<h5 data-id="heading-19">3. åŠ è½½è‡ªå®šä¹‰æ¨¡å‹</h5>
<p>åœ¨ <code>Authorizer.newEngine</code> æ–¹æ³•ä¸­ï¼Œé€šè¿‡<code>casbin.WithStringModel</code> åŠ è½½å†…åµŒçš„æ¨¡å‹:</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"go-wind-admin/app/admin/service/cmd/server/assets"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> newEngine(cfg *conf.Bootstrap) authzEngine.Engine {
	<span class="hljs-keyword">switch</span> cfg.GetAuthz().GetType() {
	<span class="hljs-keyword">default</span>:
		<span class="hljs-keyword">fallthrough</span>

	<span class="hljs-keyword">case</span> <span class="hljs-string">"casbin"</span>:
		state, err := casbin.NewEngine(ctx, casbin.WithStringModel(<span class="hljs-type">string</span>(assets.CasinModel)))
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"init casbin engine error: %v"</span>, err)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		}
		<span class="hljs-keyword">return</span> state
	}
}
</code></pre>
<h3 data-id="heading-20">äº”ã€é›†æˆéªŒè¯ä¸å¸¸è§é—®é¢˜</h3>
<h4 data-id="heading-21">5.1 éªŒè¯é›†æˆæ•ˆæœ</h4>
<ol>
<li>å¯åŠ¨ GoWind Admin æœåŠ¡ï¼Œç¡®ä¿æ—¥å¿—ä¸­è¾“å‡º <code>success reload policy rules</code>ï¼Œè¯´æ˜ç­–ç•¥åŠ è½½æˆåŠŸï¼›</li>
<li>é€šè¿‡ Postman ç­‰å·¥å…·æµ‹è¯•æ¥å£ï¼šä½¿ç”¨ admin è§’è‰²ç”¨æˆ·è®¿é—®ä»»æ„æ¥å£ï¼šåº”èƒ½æ­£å¸¸è®¿é—®ï¼ˆç¬¦åˆ <code>p, admin, *, *, *</code> ç­–ç•¥ï¼‰ï¼›</li>
<li>ä½¿ç”¨æ™®é€šç”¨æˆ·è®¿é—®æ— æƒé™æ¥å£ï¼šåº”è¿”å› 403 Forbidden é”™è¯¯ï¼›</li>
<li>ä¿®æ”¹è§’è‰²æƒé™åï¼Œè°ƒç”¨ <code>Authorizer.ResetPolicies</code> é‡ç½®ç­–ç•¥ï¼ŒéªŒè¯æƒé™å˜æ›´æ˜¯å¦ç”Ÿæ•ˆã€‚</li>
</ol>
<h4 data-id="heading-22">5.2 å¸¸è§é—®é¢˜æ’æŸ¥</h4>
<ul>
<li><strong>ç­–ç•¥åŠ è½½å¤±è´¥</strong>ï¼šæ£€æŸ¥è§’è‰²/API èµ„æºæ˜¯å¦å­˜åœ¨ï¼Œæ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œæ—¥å¿—ä¸­æ˜¯å¦æœ‰ <code>failed to list roles</code> ç­‰é”™è¯¯ï¼›</li>
<li><strong>æƒé™æ ¡éªŒä¸ç”Ÿæ•ˆ</strong>ï¼šæ£€æŸ¥ <code>auth.yaml</code> ä¸­ <code>authz.type</code> æ˜¯å¦è®¾ç½®ä¸º <code>casbin</code>ï¼Œæ˜¯å¦è¯¯å¯ç”¨ noop æ¨¡å¼ï¼›</li>
<li><strong>æ¥å£è·¯å¾„åŒ¹é…å¤±è´¥</strong>ï¼šæ£€æŸ¥æ¨¡å‹åŒ¹é…å™¨æ˜¯å¦ä½¿ç”¨ <code>keyMatch2</code> å‡½æ•°ï¼ˆæ”¯æŒè·¯å¾„å‚æ•°é€šé…ç¬¦ï¼‰ï¼Œé¿å…ä½¿ç”¨ç²¾ç¡®åŒ¹é…ï¼›</li>
<li><strong>å¤šç§Ÿæˆ·æƒé™éš”ç¦»å¤±æ•ˆ</strong>ï¼šæ£€æŸ¥ç­–ç•¥æ˜¯å¦åŒ…å«åŸŸï¼ˆdomï¼‰å­—æ®µï¼ŒåŒ¹é…å™¨æ˜¯å¦æ·»åŠ åŸŸåŒ¹é…é€»è¾‘ã€‚</li>
</ul>
<h3 data-id="heading-23">å…­ã€é¡¹ç›®ä»£ç ä¸å‚è€ƒèµ„æ–™</h3>
<h4 data-id="heading-24">6.1 é¡¹ç›®ä»£ç ä»“åº“</h4>
<ul>
<li>GoWind Admin Giteeï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://gitee.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">gitee.com/tx7do/go-wiâ€¦</a></li>
<li>GoWind Admin Githubï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://github.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">github.com/tx7do/go-wiâ€¦</a></li>
<li>Kratos-Authzï¼ˆCasbin å°è£…ç»„ä»¶ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fkratos-authz" target="_blank" title="https://github.com/tx7do/kratos-authz" ref="nofollow noopener noreferrer">github.com/tx7do/kratoâ€¦</a></li>
</ul>
<h4 data-id="heading-25">6.2 æƒå¨å‚è€ƒèµ„æ–™</h4>
<ol>
<li>Casbin å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fcasbin.org%2Fzh%2Fdocs%2F" target="_blank" title="https://casbin.org/zh/docs/" ref="nofollow noopener noreferrer">casbin.org/zh/docs/</a></li>
<li>Casbin GitHub ä»“åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcasbin%2Fcasbin" target="_blank" title="https://github.com/casbin/casbin" ref="nofollow noopener noreferrer">github.com/casbin/casbâ€¦</a></li>
<li>Casbin äº¤äº’å¼è§£é‡Šå™¨ï¼ˆåœ¨çº¿è°ƒè¯•ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fcasbin.org%2Fzh%2Feditor" target="_blank" title="https://casbin.org/zh/editor" ref="nofollow noopener noreferrer">casbin.org/zh/editor</a></li>
<li>Kratos å®˜æ–¹æ–‡æ¡£ï¼ˆä¸­é—´ä»¶é›†æˆï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo-kratos.dev%2Fdocs%2Fmiddleware%2Fintro" target="_blank" title="https://go-kratos.dev/docs/middleware/intro" ref="nofollow noopener noreferrer">go-kratos.dev/docs/middleâ€¦</a></li>
<li>RBAC æƒé™æ¨¡å‹è®¾è®¡æŒ‡å—ï¼š<a href="https://juejin.cn/post/7041059713848442917" target="_blank" title="https://juejin.cn/post/7041059713848442917">juejin.cn/post/704105â€¦</a></li>
<li>Casbin é›†æˆå®æˆ˜ï¼š<a href="https://juejin.cn/post/6947951229590831135" target="_blank" title="https://juejin.cn/post/6947951229590831135">juejin.cn/post/694795â€¦</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ruoyié›†æˆdmnè§„åˆ™å¼•æ“]]></title>    <link>https://juejin.cn/post/7583878719543738377</link>    <guid>https://juejin.cn/post/7583878719543738377</guid>    <pubDate>2025-12-15T10:22:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583878719543738377" data-draft-id="7583871118949236786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ruoyié›†æˆdmnè§„åˆ™å¼•æ“"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-15T10:22:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç æ¬¡ä½é¢"/> <meta itemprop="url" content="https://juejin.cn/user/1535333867720295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ruoyié›†æˆdmnè§„åˆ™å¼•æ“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535333867720295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç æ¬¡ä½é¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:22:59.000Z" title="Mon Dec 15 2025 10:22:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¯å¢ƒè¯´æ˜</h2>
<p>åŸºäºRuoYi-Vue2qå‰ç«¯å¦‚ä½•é›†æˆDMNç»„ä»¶<br/>
ç‰ˆæœ¬å·:3.9.0<br/>
æ›´å¤šå…³äºruoyié›†æˆå·¥ä½œæµï¼Œè¯·è®¿é—®<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruoyiflow.com%2Fproduct%2F3" target="_blank" title="https://www.ruoyiflow.com/product/3" ref="nofollow noopener noreferrer">è‹¥ä¾å·¥ä½œæµ</a></p>
<h2 data-id="heading-1">é›†æˆæ­¥éª¤</h2>
<ul>
<li>å®‰è£…ä¾èµ–</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">npm install dmn-js dmn-js-properties-panel --save
npm install --save dmn-moddle
</code></pre>
<ul>
<li>vue.config.jså¢åŠ dmn.jsé…ç½®, åœ¨transpileDependenciesï¼Œalias è¿›è¡Œè®¾ç½®</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">lias: {
    '@': resolve('src'),
    'lezer-feel$': resolve('node_modules/lezer-feel/dist/index.js'),
    '@camunda/feel-builtins$': resolve('node_modules/@camunda/feel-builtins/dist/index.js'),
    'feelers$': resolve('node_modules/feelers/dist/index.js'),
    'feelin$': resolve('node_modules/feelin/dist/index.cjs'),
    '@bpmn-io/feel-lint$': resolve('node_modules/@bpmn-io/feel-lint/dist/index.js'),
    '@bpmn-io/lezer-feel$': resolve('node_modules/@bpmn-io/lezer-feel/dist/index.js'),
    // dmn-moddle ä½¿ç”¨ ES æ¨¡å—ï¼Œwebpack4 éœ€è¦æŒ‡å‘ CJS ç‰ˆæœ¬
    'dmn-moddle$': resolve('node_modules/dmn-moddle/dist/index.cjs')
    }

  transpileDependencies: [
    'quill', 
    'bpmn-js', 
    'diagram-js',
    'bpmn-js-properties-panel',
    '@bpmn-io/properties-panel',
    '@bpmn-io/feel-editor',
    '@bpmn-io/feel-lint', 
    '@bpmn-io/lezer-feel', 
    'feelers', 
    //ä»¥ä¸‹æ˜¯dmn-jséœ€è¦çš„é…ç½®ï¼Œä¸»è¦æ˜¯å› ä¸ºdmn-js ä½¿ç”¨äº† ES6+ è¯­æ³•ï¼Œä½† webpack æœªè½¬è¯‘ node_modules ä¸­çš„è¿™äº›æ–‡ä»¶
    'lezer-feel',
    'dmn-js',
    'dmn-js-properties-panel',
    'dmn-js-boxed-expression',
    'dmn-js-decision-table',
    'dmn-js-literal-expression',
    'dmn-js-shared',
    'dmn-moddle'],
</code></pre>
<ul>
<li>å‰ç«¯é¡µé¢ç¼–ç </li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-container class="dmn-modeler-container"&gt;
    &lt;!-- å¤´éƒ¨æ“ä½œåŒºåŸŸ --&gt;
    &lt;el-header class="dmn-header"&gt;
      &lt;div class="header-content"&gt;
        &lt;div class="header-title"&gt;
          &lt;h3&gt;DMN å†³ç­–è¡¨å»ºæ¨¡å™¨&lt;/h3&gt;
        &lt;/div&gt;
        &lt;div class="header-actions"&gt;
          &lt;el-button-group&gt;
            &lt;el-button icon="el-icon-folder-opened" @click="openFile"&gt;å¯¼å…¥&lt;/el-button&gt;
            &lt;el-button icon="el-icon-download" @click="downloadDiagram"&gt;å¯¼å‡º&lt;/el-button&gt;
            &lt;el-button icon="el-icon-document" type="primary" @click="saveDiagram"&gt;éƒ¨ç½²&lt;/el-button&gt;
          &lt;/el-button-group&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/el-header&gt;
    
    &lt;!-- ä¸»è¦å†…å®¹åŒºåŸŸ --&gt;
    &lt;el-main class="dmn-main"&gt;
      &lt;div class="dmn-content"&gt;
        &lt;!-- DMN ç”»å¸ƒåŒºåŸŸ --&gt;
        &lt;div class="canvas-container"&gt;
          &lt;div id="canvas" class="dmn-canvas" v-loading="initializing"&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/el-main&gt;
    
    &lt;!-- æ–‡ä»¶è¾“å…¥ --&gt;
    &lt;input 
      ref="fileInput" 
      type="file" 
      accept=".dmn,.xml" 
      style="display: none" 
      @change="handleFileImport"
    /&gt;
  &lt;/el-container&gt;
&lt;/template&gt;

&lt;script&gt;
import DmnModeler from 'dmn-js/lib/Modeler'
import FileSaver from 'file-saver'
import { deployDmnTable } from '@/api/camunda/dmn'

// æ ·å¼å¼•å…¥
// åŸºç¡€æ ·å¼
import 'dmn-js/dist/assets/diagram-js.css'
// DMN å­—ä½“æ ·å¼
import 'dmn-js/dist/assets/dmn-font/css/dmn.css'
// å†³ç­–è¡¨ç›¸å…³æ ·å¼ï¼ˆç¡®ä¿å†³ç­–è¡¨æ­£ç¡®æ˜¾ç¤ºï¼‰
import 'dmn-js/dist/assets/dmn-js-shared.css'
import 'dmn-js/dist/assets/dmn-js-decision-table.css'
import 'dmn-js/dist/assets/dmn-js-decision-table-controls.css'
// DRD (Decision Requirements Diagram) è§†å›¾æ ·å¼
import 'dmn-js/dist/assets/dmn-js-drd.css'

export default {
  name: 'CamundaDmnModeler',
  data() {
    return {
      dmnModeler: null,
      canUndo: false,
      canRedo: false,
      isInitialized: false, // æ ‡è®°æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ
      initializing: false, // åˆå§‹åŒ–æˆ–å¯¼å…¥ä¸­çš„ loading çŠ¶æ€
      initPromise: null // è®°å½•åˆå§‹åŒ– Promiseï¼Œä¾¿äºåç»­ç­‰å¾…
    }
  },
  mounted() {
    this.$nextTick(() =&gt; {
      this.initModeler()
    })
  },
  beforeDestroy() {
    if (this.dmnModeler) {
      this.dmnModeler.destroy()
      this.dmnModeler = null
    }
    this.initPromise = null
  },
  methods: {
    // ç”Ÿæˆéšæœºå†³ç­–è¡¨ID
    generateDecisionId() {
      const randomNum = Math.floor(Math.random() * 10000)
      return `Decision_${randomNum}`
    },

    initModeler() {
      if (this.initializing &amp;&amp; this.initPromise) {
        return this.initPromise
      }

      try {
        // å¦‚æœå·²æœ‰å®ä¾‹ï¼Œå…ˆé”€æ¯é‡æ–°åˆ›å»ºï¼Œé¿å…æ®‹ç•™çŠ¶æ€
        if (this.dmnModeler) {
          try {
            this.dmnModeler.destroy()
          } catch (destroyErr) {
            console.warn('é”€æ¯æ—§çš„ DMN Modeler å¤±è´¥:', destroyErr)
          }
        }

        this.dmnModeler = new DmnModeler({
          container: '#canvas'
        })
        this.initializing = true
        this.isInitialized = false
        
        // åŠ è½½ç©ºç™½å†³ç­–è¡¨ - ä½¿ç”¨æ ‡å‡†çš„ DMN 1.3 æ ¼å¼
        // æ ¹æ® dmn-moddle 11.0.0ï¼Œä½¿ç”¨æ­£ç¡®çš„å‘½åç©ºé—´
        const decisionId = this.generateDecisionId()
        const decisionTableId = 'DecisionTable_' + Date.now()
        const diagramXML = `&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="http://www.omg.org/spec/DMN/20180521/DMNDI" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" id="Definitions_1" name="å†³ç­–è¡¨" namespace="http://camunda.org/schema/1.0/dmn"&gt;
  &lt;decision id="${decisionId}" name="å†³ç­–è¡¨"&gt;
    &lt;decisionTable id="${decisionTableId}" hitPolicy="UNIQUE"&gt;
      &lt;input id="Input_1" label="è¾“å…¥"&gt;
        &lt;inputExpression id="InputExpression_1" typeRef="string"&gt;
          &lt;text&gt;&lt;/text&gt;
        &lt;/inputExpression&gt;
      &lt;/input&gt;
      &lt;output id="Output_1" label="è¾“å‡º" typeRef="string" /&gt;
    &lt;/decisionTable&gt;
  &lt;/decision&gt;
  &lt;dmndi:DMNDI&gt;
    &lt;dmndi:DMNDiagram id="DMNDiagram_1"&gt;
      &lt;dmndi:DMNShape id="DMNShape_${decisionId}" dmnElementRef="${decisionId}"&gt;
        &lt;dc:Bounds x="100" y="100" width="300" height="200" /&gt;
      &lt;/dmndi:DMNShape&gt;
    &lt;/dmndi:DMNDiagram&gt;
  &lt;/dmndi:DMNDI&gt;
&lt;/definitions&gt;`

        // ä½¿ç”¨ç®­å¤´å‡½æ•°ç¡®ä¿ this ä¸Šä¸‹æ–‡æ­£ç¡®
        const initTask = this.dmnModeler.importXML(diagramXML)
        this.initPromise = initTask
        initTask.then(() =&gt; {
          // åªæœ‰åœ¨ importXML æˆåŠŸåæ‰æ ‡è®°ä¸ºå·²åˆå§‹åŒ–
          this.isInitialized = true
          this.initializing = false
          this.$message.success('å†³ç­–è¡¨åˆå§‹åŒ–æˆåŠŸ')
          
          // ç¡®ä¿ dmnModeler å·²å®Œå…¨åˆå§‹åŒ–åå†è®¿é—®æœåŠ¡
          if (this.dmnModeler &amp;&amp; typeof this.dmnModeler.get === 'function') {
            // ç­‰å¾… DOM æ›´æ–°
            this.$nextTick(() =&gt; {
              // ç›‘å¬æ’¤é”€é‡åšçŠ¶æ€
              const eventBus = this.dmnModeler.get('eventBus')
              if (eventBus) {
                eventBus.on('commandStack.changed', () =&gt; {
                  if (this.dmnModeler &amp;&amp; typeof this.dmnModeler.get === 'function') {
                    const commandStack = this.dmnModeler.get('commandStack')
                    if (commandStack) {
                      this.canUndo = commandStack.canUndo()
                      this.canRedo = commandStack.canRedo()
                    }
                  }
                })
              }
              
            })
          }
        }).catch(err =&gt; {
          console.error('åˆå§‹åŒ–å¤±è´¥:', err)
          console.error('XML å†…å®¹:', diagramXML)
          this.isInitialized = false
          this.initializing = false
          this.$message.error('å†³ç­–è¡¨åˆå§‹åŒ–å¤±è´¥: ' + (err.message || 'æœªçŸ¥é”™è¯¯'))
          // å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œæ¸…ç©º dmnModelerï¼Œé¿å…ä½¿ç”¨ä¸å®Œæ•´çš„çŠ¶æ€
          if (this.dmnModeler) {
            try {
              this.dmnModeler.destroy()
            } catch (e) {
              console.warn('é”€æ¯å¤±è´¥çš„ modeler:', e)
            }
            this.dmnModeler = null
          }
          throw err
        }).finally(() =&gt; {
          // ä¿æŒ initPromise åªä»£è¡¨æœ€è¿‘ä¸€æ¬¡åˆå§‹åŒ–
          if (this.initPromise === initTask) {
            this.initPromise = null
          }
        })

        return initTask
      } catch (err) {
        console.error('åˆ›å»º DMN Modeler å¤±è´¥:', err)
        this.$message.error('åˆ›å»ºå†³ç­–è¡¨å»ºæ¨¡å™¨å¤±è´¥: ' + (err.message || 'æœªçŸ¥é”™è¯¯'))
        this.initializing = false
        this.isInitialized = false
        this.initPromise = null
        throw err
      }
    },

    async ensureModelerReady() {
      debugger
      if (this.isInitialized &amp;&amp; this.dmnModeler &amp;&amp; typeof this.dmnModeler.get === 'function') {
        return true
      }
      if (!this.initializing || !this.initPromise) {
        try {
          await this.initModeler()
        } catch (err) {
          console.error('é‡æ–°åˆå§‹åŒ–å†³ç­–è¡¨å»ºæ¨¡å™¨å¤±è´¥:', err)
          return false
        }
      }
      if (this.initPromise) {
        try {
          await this.initPromise
        } catch (err) {
          console.error('ç­‰å¾…å†³ç­–è¡¨å»ºæ¨¡å™¨åˆå§‹åŒ–å¤±è´¥:', err)
          return false
        }
      }
      return this.isInitialized &amp;&amp; this.dmnModeler &amp;&amp; typeof this.dmnModeler.get === 'function'
    },

    // ç¡®ä¿XMLåŒ…å«å¿…è¦çš„å‘½åç©ºé—´
    ensureDmnNamespace(xml) {
      // æ£€æŸ¥æ˜¯å¦åŒ…å«æ­£ç¡®çš„ DMN 1.3 å‘½åç©ºé—´
      // MODEL å‘½åç©ºé—´åº”è¯¥æ˜¯ https://www.omg.org/spec/DMN/20191111/MODEL/
      if (xml.indexOf('xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"') === -1 &amp;&amp; 
          xml.indexOf('xmlns:dmn="https://www.omg.org/spec/DMN/20191111/MODEL/"') === -1) {
        // å¦‚æœç¼ºå°‘é»˜è®¤å‘½åç©ºé—´ï¼Œå°è¯•æ·»åŠ 
        if (xml.indexOf('&lt;definitions') !== -1) {
          // æ›¿æ¢ definitions æ ‡ç­¾ï¼Œæ·»åŠ é»˜è®¤å‘½åç©ºé—´
          xml = xml.replace(
            /&lt;definitions([^&gt;]*)&gt;/,
            '&lt;definitions$1 xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="http://www.omg.org/spec/DMN/20180521/DMNDI" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/"&gt;'
          )
        } else if (xml.indexOf('&lt;dmn:definitions') !== -1) {
          // å¦‚æœä½¿ç”¨ dmn: å‰ç¼€ï¼Œä¹Ÿæ·»åŠ å‘½åç©ºé—´
          xml = xml.replace(
            /&lt;dmn:definitions([^&gt;]*)&gt;/,
            '&lt;dmn:definitions$1 xmlns:dmn="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="http://www.omg.org/spec/DMN/20180521/DMNDI" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/"&gt;'
          )
        }
      }
      return xml
    },

    // ä» XML ä¸­æå–ç¬¬ä¸€ä¸ª decision çš„ name å±æ€§
    extractDecisionName(xml) {
      if (!xml || typeof xml !== 'string') {
        return null
      }
      try {
        if (typeof window !== 'undefined' &amp;&amp; window.DOMParser) {
          const parser = new DOMParser()
          const doc = parser.parseFromString(xml, 'text/xml')
          const parserError = doc.getElementsByTagName('parsererror')
          if (parserError &amp;&amp; parserError.length) {
            console.warn('DOMParser è§£æ DMN XML å‡ºé”™ï¼Œé€€å›æ­£åˆ™è§£æ')
          } else {
            // å…ˆå°è¯•ä¸å¸¦å‘½åç©ºé—´çš„ decision
            let decisionEl = doc.getElementsByTagName('decision')[0]
            if (!decisionEl) {
              // å†å°è¯•å¸¦å‘½åç©ºé—´çš„ decision
              decisionEl = doc.getElementsByTagNameNS('https://www.omg.org/spec/DMN/20191111/MODEL/', 'decision')[0]
            }
            if (decisionEl) {
              const name = decisionEl.getAttribute('name')
              if (name) {
                return name
              }
            }
          }
        }
      } catch (err) {
        console.warn('DOMParser æå–å†³ç­–åç§°å¤±è´¥:', err)
      }

      // æ­£åˆ™åå¤‡æ–¹æ¡ˆï¼Œå…¼å®¹å•å¼•å·æˆ–åŒå¼•å·
      const match = xml.match(/&lt;\s*(?:dmn:)?decision\b[^&gt;]*\bname=['"]([^'"]+)['"]/i)
      if (match &amp;&amp; match[1]) {
        return match[1]
      }
      return null
    },

    async saveDiagram() {
      try {
        // const ready = await this.ensureModelerReady()
        // if (!ready) {
        //   this.$message.error('å†³ç­–è¡¨å»ºæ¨¡å™¨æœªåˆå§‹åŒ–ï¼Œè¯·ç¨åå†è¯•')
        //   return
        // }
        
        const modeler = this.dmnModeler
        // if (!modeler || typeof modeler.get !== 'function') {
        //   this.$message.error('å†³ç­–è¡¨å»ºæ¨¡å™¨ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•')
        //   return
        // }

        const { xml } = await modeler.saveXML({ 
          format: true,
          preamble: true
        })
        
        // ç¡®ä¿XMLåŒ…å«å¿…è¦çš„å‘½åç©ºé—´
        const processedXml = this.ensureDmnNamespace(xml)
        
        // è·å–å†³ç­–è¡¨åç§°ï¼šä¼˜å…ˆè¯»å– XML ä¸­ decision çš„ name
        let decisionName = this.extractDecisionName(processedXml)
        
        if (!decisionName) {
          try {
            const elementRegistry = modeler.get('elementRegistry')
            if (elementRegistry) {
              // å°è¯•ä»å†³ç­–è¡¨ä¸­è·å–åç§°
              const decisions = elementRegistry.filter(el =&gt; el.type === 'dmn:Decision')
              if (decisions.length &gt; 0) {
                const decision = decisions[0]
                const bo = decision.businessObject || decision
                decisionName = bo.name || bo.id || decisionName
              }
            }
          } catch (e) {
            console.warn('ä» elementRegistry è·å–å†³ç­–è¡¨åç§°å¤±è´¥:', e)
          }
        }

        if (!decisionName) {
          decisionName = 'decision_' + Date.now()
        }
        
        // å‡†å¤‡éƒ¨ç½²å‚æ•°
        const deployData = {
          decisionName: decisionName,
          dmnXml: processedXml,
          tenantId: '',
          description: 'å†³ç­–è¡¨éƒ¨ç½²'
        }
        
        // è°ƒç”¨éƒ¨ç½²API
        this.$message.info('æ­£åœ¨éƒ¨ç½²å†³ç­–è¡¨...')
        const response = await deployDmnTable(deployData)
        
        this.$message.success(`å†³ç­–è¡¨éƒ¨ç½²æˆåŠŸï¼å†³ç­–åç§°: ${decisionName}`)
        
        console.log('Deployment response:', response)
        // è·³è½¬åˆ°å†³ç­–è¡¨åˆ—è¡¨é¡µé¢
        this.$router.push('/dmn/list')
        
      } catch (err) {
        console.error('Deployment error:', err)
        const errorMessage = err.response?.data?.message || err.message || 'éƒ¨ç½²å¤±è´¥'
        this.$message.error('éƒ¨ç½²å¤±è´¥: ' + errorMessage)
      }
    },

    async downloadDiagram() {
      try {
        // const ready = await this.ensureModelerReady()
        // if (!ready) {
        //   this.$message.error('å†³ç­–è¡¨å»ºæ¨¡å™¨æœªåˆå§‹åŒ–ï¼Œè¯·ç¨åå†è¯•')
        //   return
        // }
        
        const modeler = this.dmnModeler
        // if (!modeler || typeof modeler.get !== 'function') {
        //   this.$message.error('å†³ç­–è¡¨å»ºæ¨¡å™¨ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•')
        //   return
        // }

        const { xml } = await modeler.saveXML({ 
          format: true,
          preamble: true
        })
        // ç¡®ä¿XMLåŒ…å«å¿…è¦çš„å‘½åç©ºé—´
        const processedXml = this.ensureDmnNamespace(xml)
        const blob = new Blob([processedXml], { type: 'application/xml' })
        FileSaver.saveAs(blob, 'decision-table.dmn')
      } catch (err) {
        this.$message.error('å¯¼å‡ºå¤±è´¥: ' + (err.message || 'æœªçŸ¥é”™è¯¯'))
      }
    },

    openFile() {
      this.$refs.fileInput.click()
    },
    
    async handleFileImport(event) {
      const file = event.target.files[0]
      if (!file) return
      
      // const ready = await this.ensureModelerReady()
      // if (!ready) {
      //   this.$message.error('å†³ç­–è¡¨å»ºæ¨¡å™¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•')
      //   return
      // }
      
      const reader = new FileReader()
      reader.onload = (e) =&gt; {
        try {
          const xml = e.target.result
          this.initializing = true
          const modeler = this.dmnModeler
          // if (!modeler || typeof modeler.get !== 'function') {
          //   this.initializing = false
          //   this.$message.error('å†³ç­–è¡¨å»ºæ¨¡å™¨ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•')
          //   return
          // }
          modeler.importXML(xml).then(() =&gt; {
            this.isInitialized = true
            this.initializing = false
            this.$message.success('æ–‡ä»¶å¯¼å…¥æˆåŠŸ')
          }).catch(error =&gt; {
            console.error('æ–‡ä»¶å¯¼å…¥å¤±è´¥:', error)
            this.isInitialized = false
            this.initializing = false
            this.$message.error('æ–‡ä»¶å¯¼å…¥å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))
          })
        } catch (error) {
          console.error('æ–‡ä»¶è¯»å–å¤±è´¥:', error)
          this.initializing = false
          this.$message.error('æ–‡ä»¶è¯»å–å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))
        }
      }
      reader.readAsText(file)
      
      // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
      event.target.value = ''
    }
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.dmn-modeler-container {
  width: 100%;
  height: 100vh;
  min-width: 900px;
  display: flex;
  flex-direction: column;
}

/* å¤´éƒ¨æ ·å¼ */
.dmn-header {
  background-color: #f5f7fa;
  border-bottom: 1px solid #e4e7ed;
  padding: 0 20px;
  height: 60px !important;
  display: flex;
  align-items: center;
}

.header-content {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header-title h3 {
  margin: 0;
  color: #303133;
  font-size: 18px;
  font-weight: 500;
}

.header-actions {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
}

.header-actions .el-button-group {
  margin-right: 0;
}

.header-actions .el-button-group .el-button {
  margin-right: 0;
}

/* ä¸»å†…å®¹åŒºåŸŸæ ·å¼ */
.dmn-main {
  padding: 0;
  height: calc(100vh - 60px);
  overflow: hidden;
}

.dmn-content {
  display: flex;
  height: 100%;
  width: 100%;
}

/* ç”»å¸ƒå®¹å™¨æ ·å¼ */
.canvas-container {
  flex: 1;
  position: relative;
  display: flex;
  flex-direction: column;
  min-width: 0; /* å…è®¸ flex å­å…ƒç´ ç¼©å° */
}

.dmn-canvas {
  width: 100%;
  height: 100%;
  border: 1px solid #dcdfe6;
  background-color: #fff;
}

&lt;/style&gt;

</code></pre>
<h2 data-id="heading-2">æœ€ç»ˆé¡µé¢å±•ç¤º</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a96e614955d4819805d2fc81d5ca3c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398979&amp;x-signature=Mz%2BtwnNwYlHxCrRajjgE55UwMz0%3D" alt="dmn1.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»… 4 äºº 28 å¤©ï¼OpenAI é¦–æ› Sora å†…å¹•ï¼š85% ä»£ç ç«Ÿç”± AI å®Œæˆ]]></title>    <link>https://juejin.cn/post/7583707681003667502</link>    <guid>https://juejin.cn/post/7583707681003667502</guid>    <pubDate>2025-12-15T10:21:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583707681003667502" data-draft-id="7583913535270633482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»… 4 äºº 28 å¤©ï¼OpenAI é¦–æ› Sora å†…å¹•ï¼š85% ä»£ç ç«Ÿç”± AI å®Œæˆ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,OpenAI"/> <meta itemprop="datePublished" content="2025-12-15T10:21:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ–°æ™ºå…ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»… 4 äºº 28 å¤©ï¼OpenAI é¦–æ› Sora å†…å¹•ï¼š85% ä»£ç ç«Ÿç”± AI å®Œæˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ–°æ™ºå…ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:21:51.000Z" title="Mon Dec 15 2025 10:21:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2ce71d3345f496c95c6091704190c3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=hYU6Bf1OJ7Enf6oV7oqE4%2BflzB0%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>ã€Œã€æ–°æ™ºå…ƒå¯¼è¯»ã€‘OpenAI çˆ†æ¬¾ APPï¼ŒåªåŠ¨ç”¨äº†å››å‘˜æ‚å°†ã€‚ä»–ä»¬åœ¨çŸ­çŸ­ 28 å¤©å†…ï¼Œå®Œæˆäº†ä» 0 æ­å»ºå®‰å“ç‰ˆ Soraã€‚è¿™èƒŒåï¼Œç«Ÿæ˜¯ AI å®Œæˆäº† 85% çš„ç¼–ç ã€‚ã€</strong></h5>
<p>4 äºº 28 å¤©æ‰‹æ“ Sora APPï¼Œçº¦ 85% ä»£ç ç«Ÿæ˜¯ AI å†™çš„ï¼</p>
<p>10 æœˆåˆï¼ŒOpenAI é‡ç£…å‘å¸ƒè¿­ä»£å Sora 2ï¼Œä»¥åŠé¦–ä¸ª AI è§†é¢‘åº”ç”¨ Sora APPã€‚</p>
<p>ç›´åˆ° 11 æœˆï¼Œå®‰å“ç‰ˆ Sora ä¸€ç»ä¸Šçº¿ï¼Œå°±ç™»ä¸Šäº†è°·æ­Œ Play Store æ¦œé¦–ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcef7b4aff1143dcb9baa782aa6ff87b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=CI1BatltL%2FC8DyarHy8qWew5wTM%3D" alt="" loading="lazy"/></p>
<p>å®‰å“ç”¨æˆ·åœ¨ 24h å†…ï¼Œç”Ÿæˆäº†è¶… 100 ä¸‡æ¡è§†é¢‘</p>
<p>æ—¶éš”ä¸¤ä¸ªæœˆï¼ŒOpenAI å›¢é˜Ÿæ­ç§˜è¿™æ¬¾çˆ†ç«åº”ç”¨ï¼ˆé¦–ä¸ªå®‰å“ç‰ˆï¼‰ï¼Œå¦‚ä½•æ„å»ºçš„èƒŒåæ•…äº‹ã€‚</p>
<p>è®©äººæ„å¤–çš„æ˜¯ï¼Œè¿™æ¬¾ APP ä»…åœ¨ 28 å¤©å†…å®Œæˆï¼ŒèƒŒåæœ€å¤§åŠŸè‡£ä¾¿æ˜¯ AI æ™ºèƒ½ä½“â€”â€”Codexã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94b375a3ac544020ac1b2eb06d70f662~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=BmPRCPWYsQ9MyQHf9c7bwhjC9BE%3D" alt="" loading="lazy"/></p>
<p>ä» 10 æœˆ 8 æ—¥åˆ° 11 æœˆ 5 æ—¥ï¼Œ4 äººå·¥ç¨‹å›¢é˜Ÿä¸ Codex åä½œï¼Œæ¶ˆè€—çº¦ 50 äº¿ Tokenï¼Œå°±æŠŠ Sora Android æ¨å‘å…¨çƒã€‚</p>
<p>å°½ç®¡åº”ç”¨è§„æ¨¡è™½å¤§ï¼Œå´å®ç°äº† 99.9% æ— å´©æºƒç‡ã€‚</p>
<p>è€Œä¸”ï¼Œä»–ä»¬è¿˜ä½¿ç”¨çš„æ˜¯ GPT-5.1-Codex æ¨¡å‹çš„æ—©æœŸç‰ˆæœ¬ã€‚</p>
<p>å‘å¸ƒä»… 5 ä¸ªæœˆçš„æ—¶é—´ï¼ŒCodex å·²ç»æ‰¿åŒ…äº† OpenAI å†…éƒ¨æ¯å‘¨ 70% çš„ PR äº†ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d841105b2794a7ab82d06df9cba1197~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=U0M0SmjNxrqtBfaA9Y1yB%2Bk1BQk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97b1c778c7544d5892b9b77be2aa2953~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=JxRfXpaSJEjS7TZwmx251H%2FBNgQ%3D" alt="" loading="lazy"/></p>
<p><strong>ã€Œæ‹¥æŠ± ã€Œå¸ƒé²å…‹æ–¯å®šå¾‹ã€ï¼šä¿æŒçµæ´»ï¼Œå”¯å¿«ä¸ç ´ã€</strong></p>
<p>å½“ Sora åœ¨ iOS ä¸Šå‘å¸ƒæ—¶ï¼Œç”¨æˆ·é‡ç›´æ¥åŸåœ°çˆ†ç‚¸ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dc9cf18fc4b4e048a21983331bb1115~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=7hrTE4sDid1Y66m12G6bkzoJYok%3D" alt="" loading="lazy"/></p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œå®‰å“å½“æ—¶åªæœ‰ä¸€ä¸ªç®€é™‹çš„å†…éƒ¨åŸå‹ï¼Œè€Œåœ¨ Google Play ä¸Šé¢„æ³¨å†Œçš„ç”¨æˆ·å´åœ¨è¶Šå †è¶Šå¤šã€‚</p>
<p>é¢å¯¹è¿™ç§é«˜å‹ã€ç«çƒ§çœ‰æ¯›çš„å‘å¸ƒä»»åŠ¡ï¼Œé€šå¸¸çš„ååº”å°±æ˜¯ç–¯ç‹‚å †äººã€åŠ æµç¨‹ã€‚</p>
<p>åƒè¿™ç§è§„æ¨¡å’Œè´¨é‡çš„ç”Ÿäº§çº§åº”ç”¨ï¼Œé€šå¸¸å¾—ä¸€å¤§å¸®å·¥ç¨‹å¸ˆå¹²å¥½å‡ ä¸ªæœˆï¼Œè€Œä¸”è¿˜ä¼šè¢«å„ç§åè°ƒå·¥ä½œæ‹–æ…¢è¿›åº¦ã€‚</p>
<p>ç¾å›½è®¡ç®—æœºæ¶æ„å¸ˆ Fred Brooks æ›¾æœ‰ä¸€å¥åè¨€ï¼Œã€Œå‘ä¸€ä¸ªå·²ç»å»¶æœŸçš„è½¯ä»¶é¡¹ç›®å¢åŠ äººæ‰‹ï¼Œåªä¼šè®©å®ƒå»¶å¾—æ›´å‰å®³ã€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5c89a88c8dd492794e4951513ae3ca2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=WjAlqFAUQd9citxdUc9QWc3SqCs%3D" alt="" loading="lazy"/></p>
<p>æ¢å¥è¯è¯´ï¼Œæƒ³è¦å¿«é€Ÿäº¤ä»˜ä¸€ä¸ªå¤æ‚é¡¹ç›®æ—¶ï¼Œå †äººå¾€å¾€å¢åŠ äº†æ²Ÿé€šæˆæœ¬ã€ä»»åŠ¡ç¢ç‰‡åŒ–å’Œé›†æˆéš¾åº¦ï¼Œåè€Œä¼šé™ä½æ•ˆç‡ã€‚</p>
<p>ä¸ºæ­¤ï¼ŒOpenAI ç»„å»ºäº†ä¸€æ”¯åªæœ‰å››åå·¥ç¨‹å¸ˆçš„ã€Œç²¾é”å°é˜Ÿã€â€”â€”å…¨å‘˜é…å¤‡ Codexï¼Œæå¤§åœ°æŠŠæ¯ä¸ªäººçš„æˆ˜æ–—åŠ›æ‹‰æ»¡ã€‚</p>
<p>é ç€è¿™ç§æ‰“æ³•ï¼Œåœ¨ 18 å¤©å†…å°±å‘å‘˜å·¥å‘å¸ƒäº† Sora Android çš„å†…éƒ¨æ„å»ºç‰ˆæœ¬ï¼Œä»…ä»… 10 å¤©åå°±å‘å…¬ä¼—æ­£å¼å‘å¸ƒã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12fa5b8136ed4fae8a603ca6f0f83dfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=JxcS7d8UYCCtLRavdixznile04I%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a86f18221534f0cad1929212df11b9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=3KIEfAOUGQGYIwx0D%2BkMtD%2F1nyo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25f9fe42e9014cc888487cbe02d30494~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=9luUqRV58r2zds1%2BEVXdPMNBLhU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16c45040b6104ba6882d7485bb593ba8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=ARxZXY5EY3eT5RLGRenkiahrX7c%3D" alt="" loading="lazy"/></p>
<p><strong>ã€ŒAI è¿­ä»£ AIï¼Œè‡ªæˆ‘è¿›åŒ–ã€</strong></p>
<p>åœ¨ OpenAI å†…éƒ¨ï¼Œç»å¤§éƒ¨åˆ†å·¥ç¨‹å¸ˆéƒ½åœ¨ç”¨ Codexï¼Œå³å¼€æºç‰ˆ CLIã€‚</p>
<p>Codex äº§å“è´Ÿè´£äºº Alexander Embiricos é€éœ²ï¼Œã€Œå®ƒä¼šç›‘æ§è‡ªå·±çš„è®­ç»ƒè¿‡ç¨‹ï¼Œå¹¶å¤„ç†ç”¨æˆ·åé¦ˆï¼Œã€Œå†³å®šã€ä¸‹ä¸€æ­¥è¯¥åšä»€ä¹ˆã€‚</p>
<p>Codex æ­£åœ¨ç»™è‡ªå·±çš„è®­ç»ƒè¿è¡Œç¼–å†™å¤§é‡çš„ç ”ç©¶æµ‹è¯•æ¡†æ¶ï¼ˆresearch harnessï¼‰ï¼ŒOpenAI ç”šè‡³åœ¨å°è¯•è®© Codex å»ç›‘æ§è‡ªå·±çš„è®­ç»ƒè¿‡ç¨‹ã€‚</p>
<p>è¿™ç§ã€Œå¥—å¨ƒã€å¼çš„å¼€å‘æ¨¡å¼ï¼Œå¯ä»¥è®© Codex è‡ªæˆ‘è¿­ä»£ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f96627c00d940a8a3401250f9eb97c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=pVf9lms5XOfeR144H4fyyoMvdRg%3D" alt="" loading="lazy"/></p>
<p>è¿™ç§ç”¨å·¥å…·é€ æ›´å¥½å·¥å…·çš„é€’å½’å¾ªç¯ï¼Œåœ¨è®¡ç®—å†å²ä¸Šå…¶å®ç”±æ¥å·²ä¹…ã€‚</p>
<p>1960 å¹´ä»£ï¼Œå·¥ç¨‹å¸ˆä»¬åœ¨çº¸ä¸Šæ‰‹å·¥è®¾è®¡äº†ç¬¬ä¸€æ‰¹é›†æˆç”µè·¯ï¼Œç„¶åæ ¹æ®å›¾çº¸é€ å‡ºäº†ç‰©ç†èŠ¯ç‰‡ã€‚</p>
<p>æ¥ç€ï¼Œè¿™äº›èŠ¯ç‰‡åˆé©±åŠ¨äº†è¿è¡Œç¬¬ä¸€æ‰¹ç”µå­è®¾è®¡è‡ªåŠ¨åŒ–ï¼ˆEDAï¼‰è½¯ä»¶çš„ç”µè„‘ï¼Œè€Œè¿™äº›è½¯ä»¶åè¿‡æ¥åˆè®©å·¥ç¨‹å¸ˆèƒ½è®¾è®¡å‡ºäººç±»æ‰‹ç»˜æ ¹æœ¬æä¸å®šçš„å¤æ‚ç”µè·¯ã€‚</p>
<p>ç°ä»£å¤„ç†å™¨åŒ…å«æ•°åäº¿ä¸ªæ™¶ä½“ç®¡ï¼Œè¿™ç§æ’åˆ—æ¨¡å¼ä¹‹æ‰€ä»¥èƒ½å­˜åœ¨ï¼Œå…¨é è½¯ä»¶ã€‚</p>
<p>OpenAI ç”¨ Codex æ¥é€  Codex ä¼¼ä¹ä¹Ÿæ˜¯è¿™ä¸ªè·¯å­ï¼šæ¯ä¸€ä»£å·¥å…·åˆ›é€ çš„èƒ½åŠ›ï¼Œéƒ½ä¼šåå“ºåˆ°ä¸‹ä¸€ä»£ä¸­ã€‚</p>
<p>è¿™ä¸ªç³»ç»Ÿèƒ½è‡ªä¸»è¿è¡Œè®¸å¤šè¿›ç¨‹ï¼Œå¤„ç†åé¦ˆï¼Œè¡ç”Ÿå¹¶ç®¡ç†å­è¿›ç¨‹ï¼Œè¿˜èƒ½ç”Ÿæˆæœ€ç»ˆå‘å¸ƒåœ¨å®é™…äº§å“é‡Œçš„ä»£ç ã€‚</p>
<p>OpenAI å‘˜å·¥ç®¡å®ƒå«ã€Œé˜Ÿå‹ã€ï¼Œå¹¶ä¸”ç”¨è¯¸å¦‚ Linearã€Slack ç­‰å·¥å…·æ¥ç»™å®ƒæ´¾æ´»å„¿ã€‚</p>
<p>Codex å¤„ç†çš„ä»»åŠ¡ï¼Œåˆ°åº•ç®—ä¸ç®—çœŸæ­£çš„ã€Œå†³ç­–ã€ï¼Ÿ</p>
<p>ä½†æ— å¯å¦è®¤çš„æ˜¯ï¼Œè¿™é‡Œå½¢æˆäº†ä¸€ä¸ªåŠè‡ªä¸»çš„åé¦ˆå¾ªç¯ï¼š</p>
<p>Codex åœ¨äººç±»çš„æŒ‡å¯¼ä¸‹å†™ä»£ç ï¼Œè¿™äº›ä»£ç å˜æˆäº† Codex çš„ä¸€éƒ¨åˆ†ï¼Œç»“æœå°±æ˜¯ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„ Codex ä¼šå†™å‡ºä¸ä¸€æ ·çš„ä»£ç ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9b128b16de54614ac72d88e4368bdbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=w6zl26UFCwooeMeiVKjcWGgw0Lw%3D" alt="" loading="lazy"/></p>
<p><strong>ã€Œä¸€ä½åˆšå…¥èŒçš„ã€Œé«˜çº§å·¥ç¨‹å¸ˆã€ã€</strong></p>
<p>ä¸ºäº†ç†è§£å·¥ç¨‹å¸ˆæ˜¯å¦‚ä½•è·Ÿ Codex é…åˆçš„ï¼Œéœ€å¾—å…ˆçŸ¥é“å®ƒå“ªé‡Œå¼ºã€å“ªé‡Œéœ€è¦äººå¸¦ã€‚</p>
<p>æŠŠå®ƒå½“æˆä¸€ä¸ªã€Œåˆšå…¥èŒçš„é«˜çº§å·¥ç¨‹å¸ˆã€æ˜¯ä¸ªå¾ˆå¥½çš„åˆ‡å…¥ç‚¹ã€‚</p>
<p>è¿™ä¸ªå®šä½ï¼Œæ„å‘³ç€å·¥ç¨‹å¸ˆå¯ä»¥æŠŠæ›´å¤šæ—¶é—´èŠ±åœ¨æŒ‡æŒ¥å’Œ Review ä»£ç ä¸Šï¼Œè€Œä¸æ˜¯è‡ªå·±åœ¨é‚£å„¿æ•²ä»£ç ã€‚</p>
<p>ä¸ã€Œæ°›å›´ç¼–ç¨‹ã€ä¸åŒçš„æ˜¯ï¼Œè®© Codex ç¼–ç å±äºã€ŒVibe engineeringã€ï¼ˆæ°›å›´æµå·¥ç¨‹ï¼‰çš„é¢†åŸŸã€‚</p>
<p>å‰è€…æ˜¯æŒ‡ï¼Œå¼€å‘è€…ä¸æ€ä¹ˆç»†çœ‹å°±ç›´æ¥æ¥å— AI ç”Ÿæˆçš„ä»£ç ï¼Œè€Œåè€…æ˜¯ AI ç ”ç©¶å‘˜ Simon Willison æå‡ºçš„æ¦‚å¿µï¼ŒæŒ‡äººç±»ä»ä¿æŒåœ¨å¾ªç¯ä¸­ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œè®© Codex å¹²æ´» / åˆ¶å®šè®¡åˆ’ï¼Œå†ä¸€èµ·è®¨è®ºï¼Œè¿­ä»£è®¡åˆ’ï¼Œè¿™æ ·å¼€å‘è€…å°±å’Œæ¨¡å‹ä¿æŒåœ¨ä¸€ä¸ªã€Œå¾ªç¯ã€é‡Œï¼Œè¿˜èƒ½ä»”ç»†å®¡æŸ¥ä»£ç ã€‚</p>
<p><strong>ã€Œ<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b08e40602ec443398f448ef237f61467~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=6DoL7wJc9zBoVPPCFWPDe%2F2FjTE%3D" alt="" loading="lazy"/>ã€</strong></p>
<p><strong>ã€ŒCodex éœ€è¦æŒ‡å¯¼çš„åœ°æ–¹ã€</strong></p>
<p>ç›®å‰ï¼ŒCodex è¿˜ä¸æ“…é•¿æ¨æ–­æœªçŸ¥çš„äº‹ã€‚</p>
<p>æ¯”å¦‚ï¼Œä¸ªäººå–œæ¬¢çš„æ¶æ„æ¨¡å¼ã€äº§å“ç­–ç•¥ã€çœŸå®ç”¨æˆ·è¡Œä¸ºï¼Œä»¥åŠå†…éƒ¨çš„æ½œè§„åˆ™æˆ–æ·å¾„ã€‚</p>
<p>åŒæ ·ï¼ŒCodex ä¹Ÿçœ‹ä¸åˆ° App å®é™…è·‘èµ·æ¥çš„æ ·å­ï¼š</p>
<p>å®ƒæ²¡æ³•åœ¨çœŸæœºä¸Šæ‰“å¼€ Soraï¼Œæ„Ÿè§‰ä¸åˆ°æ»šåŠ¨æ¡æ˜¯ä¸æ˜¯ä¸ä¸æ»‘ï¼Œæˆ–è€…å¯Ÿè§‰åˆ°æŸä¸ªäº¤äº’æµç¨‹å¾ˆåˆ«æ‰­ã€‚</p>
<p>è¿™äº›ä½“éªŒå±‚é¢çš„æ´»å„¿ï¼Œåªèƒ½é  OpenAI å›¢é˜Ÿè‡ªå·±æ¥ã€‚</p>
<p>æ¯ä¸€ä¸ªå®ä¾‹éƒ½éœ€è¦ã€Œå…¥èŒåŸ¹è®­ã€ã€‚ç»™å‡ºä¸Šä¸‹æ–‡ï¼Œæ˜ç¡®ç›®æ ‡ã€çº¦æŸæ¡ä»¶ï¼Œä»¥åŠæ˜ç¡®çš„è§„çŸ©ï¼Œå¯¹äºè®© Codex æŠŠæ´»å„¿å¹²æ¼‚äº®è‡³å…³é‡è¦ã€‚</p>
<p>è¿˜æœ‰ï¼ŒCodex åœ¨æ·±å±‚æ¶æ„åˆ¤æ–­ä¸Šä¹Ÿå®¹æ˜“è·‘åï¼šå¦‚æœæ”¾ä»»ä¸ç®¡ï¼Œå®ƒå¯èƒ½ä¼šæå‡ºä¸€ä¸ªå¤šä½™çš„ ViewModelï¼Œå®é™…ä¸Šå›¢é˜Ÿåªæƒ³æ‰©å±•ç°æœ‰çš„é‚£ä¸ªï¼›æˆ–è€…æŠŠæœ¬è¯¥å±äº Repository å±‚çš„é€»è¾‘ç¡¬å¡è¿› UI å±‚ã€‚</p>
<p>å®ƒçš„æœ¬èƒ½æ˜¯æŠŠåŠŸèƒ½è·‘é€šå°±è¡Œï¼Œè€Œä¸æ˜¯ä¼˜å…ˆè€ƒè™‘é•¿æœŸçš„ä»£ç æ•´æ´åº¦ã€‚</p>
<p>OpenAI å‘ç°ï¼Œåœ¨æ•´ä¸ªä»£ç åº“é‡Œåˆ°å¤„æ”¾å¤§é‡çš„ AGENT.md æ–‡ä»¶éå¸¸æœ‰ç”¨ã€‚</p>
<p>è¿™èƒ½è®©å·¥ç¨‹å¸ˆåœ¨ä¸åŒçš„ä¼šè¯é‡Œï¼Œè½»æ¾å¤ç”¨ç›¸åŒçš„æŒ‡å¯¼å’Œæœ€ä½³å®è·µã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸ºäº†ç¡®ä¿ Codex æŒ‰ç…§é£æ ¼æŒ‡å—å†™ä»£ç ï¼ŒOpenAI å›¢é˜Ÿåœ¨é¡¶å±‚çš„ AGENTS.md é‡ŒåŠ äº†è¿™ä¹ˆä¸€æ®µï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## Formatting and static checks</span>
<span class="hljs-bullet">-</span>Â <span class="hljs-strong">**Always run**</span>Â <span class="hljs-code">`./gradlew detektFix`</span>Â (or for the affected modules)Â <span class="hljs-strong">**before committing**</span>. CI will fail if formatting or detekt issues are present.
</code></pre>
<p><strong>ã€Œ<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d0d2431789643feba9da61651724922~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=MnseEUXJO5RkptMj0PevMpL8uXI%3D" alt="" loading="lazy"/>ã€</strong></p>
<p><strong>ã€ŒCodex æ“…é•¿çš„åœ°æ–¹ã€</strong></p>
<p>æ¥ä¸‹æ¥ï¼Œå†æ¥çœ‹çœ‹ Codex æœ€æ“…é•¿ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>**ç§’æ‡‚å¤§å‹ä»£ç åº“ï¼š**Codex ç²¾é€šæ‰€æœ‰ä¸»æµç¼–ç¨‹è¯­è¨€ï¼Œä¸éœ€è¦æå¤æ‚çš„æŠ½è±¡ï¼Œå°±èƒ½è½»æ¾åœ°åœ¨ä¸åŒå¹³å°é—´å¤ç”¨ç›¸åŒçš„æ¦‚å¿µã€‚</li>
<li>**æµ‹è¯•è¦†ç›–ç‡ï¼š**Codex å¯¹å†™å•å…ƒæµ‹è¯•æœ‰ç€ç‹¬ç‰¹çš„çƒ­æƒ…ï¼Œèƒ½è¦†ç›–å„ç§è¾¹ç¼˜æƒ…å†µã€‚è™½è¯´ä¸æ˜¯æ¯ä¸ªæµ‹è¯•éƒ½å¾ˆæ·±ï¼Œä½†è¿™å¹¿æ’’ç½‘çš„è¦†ç›–ç‡å¯¹é˜²æ­¢ Bug å›å½’ç‰¹åˆ«æœ‰ç”¨ã€‚</li>
<li>**å“åº”åé¦ˆï¼š**åŒæ ·ï¼ŒCodex å¾ˆå¬åŠã€‚å½“ CI æŒ‚äº†çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥æŠŠæ—¥å¿—ç”©ç»™å®ƒï¼ˆç²˜è´´åˆ° prompt é‡Œï¼‰ï¼Œè®©å®ƒç»™ä¸ªä¿®å¤æ–¹æ¡ˆã€‚</li>
<li>**å¤§è§„æ¨¡å¹¶è¡Œã€ç”¨å®Œå³å¼ƒï¼š**å¤§å¤šæ•°äººæ ¹æœ¬æ²¡è¯•æ¢è¿‡å¹¶è¡Œä¼šè¯æ•°é‡çš„æé™ã€‚å¼€å‘è€…å¯ä»¥å¹¶è¡Œæµ‹è¯•å¥½å‡ ä¸ªæƒ³æ³•ï¼ŒæŠŠä»£ç å½“æˆä¸€æ¬¡æ€§ç”¨å“ï¼Œä¸è¡Œå°±æ‰”ã€‚</li>
<li>**æä¾›æ–°è§†è§’ï¼š**åœ¨è®¾è®¡è®¨è®ºä¸­ï¼Œå›¢é˜Ÿä¼šæŠŠ Codex å½“æˆä¸€ä¸ªç”Ÿæˆå¼å·¥å…·ï¼Œç”¨å®ƒæ¥æŒ–æ˜æ½œåœ¨çš„æ•…éšœç‚¹ï¼Œæˆ–è€…å‘ç°è§£å†³é—®é¢˜çš„æ–°è·¯å­ã€‚æ¯”å¦‚ï¼Œåœ¨è®¾è®¡è§†é¢‘æ’­æ”¾å™¨å†…å­˜ä¼˜åŒ–æ—¶ï¼ŒCodex ç¿»éäº†å¤šä¸ª SDKï¼Œæå‡ºäº†ä¸€äº›å›¢é˜Ÿæ ¹æœ¬æ²¡æ—¶é—´å»ç»†ç©¶çš„æ–¹æ¡ˆã€‚Codex è°ƒç ”å‡ºçš„è¿™äº›è§è§£ï¼Œå¯¹äºå°†æœ€ç»ˆ App å†…å­˜å ç”¨é™åˆ°æœ€ä½ç®€ç›´ä»·å€¼è¿åŸã€‚</li>
<li>**è…¾å‡ºæ‰‹åšé«˜æ æ†å·¥ä½œï¼š**å®é™…ä¸Šï¼Œå›¢é˜Ÿæœ€åèŠ±åœ¨ Review å’ŒæŒ‡æŒ¥ä»£ç ä¸Šçš„æ—¶é—´ï¼Œæ¯”è‡ªå·±å†™çš„æ—¶é—´è¿˜è¦å¤šã€‚è¯è™½å¦‚æ­¤ï¼ŒCodex åœ¨ä»£ç å®¡æŸ¥ï¼ˆCode Reviewï¼‰æ–¹é¢ä¹Ÿå¾ˆç‰›ï¼Œç»å¸¸èƒ½åœ¨åˆå¹¶ä»£ç å‰å°±æªå‡º Bugï¼Œæé«˜äº†å¯é æ€§ã€‚</li>
</ul>
<p>ä¸€æ—¦æ‘¸æ¸…äº† Codex çš„èƒ½åŠ›ï¼Œå›¢é˜Ÿçš„å·¥ä½œæ¨¡å¼å°±å˜å¾—å¾ˆç›´æ¥äº†ã€‚</p>
<p>åœ¨æ¨¡å¼æ¸…æ™°ã€èŒƒå›´æ˜ç¡®çš„åœ°æ–¹ï¼Œè®© Codex å»å¹²é‚£äº›ç¹é‡çš„è‹¦åŠ›æ´»ï¼›è€Œå›¢é˜Ÿåˆ™ä¸“æ³¨äºæ¶æ„ã€ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿæ€§å˜æ›´å’ŒæŠŠæ§æœ€ç»ˆè´¨é‡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dddfba4b2a50498ba1e4558ffa99676b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=wPihruX7Xio0I%2F7mULaXYRtzWYM%3D" alt="" loading="lazy"/></p>
<p><strong>ã€Œç«‹è§„çŸ©ï¼Œæ‰‹åŠ¨æ‰“åœ°åŸºã€</strong></p>
<p>ä¸ºäº†ç”¨å¥½ Codex å¹¶ç¡®ä¿å‡ºæ´»ç¨³å¥ã€å¥½ç»´æŠ¤ï¼Œå…³é”®åœ¨äºï¼Œå¼€å‘è€…è¦äº²è‡ªæŠŠæ§ç³»ç»Ÿçš„è®¾è®¡å’Œå…³é”®æƒè¡¡ã€‚</p>
<p>è¿™åŒ…æ‹¬å®šå¥½ App çš„æ¶æ„ã€æ¨¡å—åŒ–ã€ä¾èµ–æ³¨å…¥å’Œå¯¼èˆªï¼›ç”šè‡³èº«ä»½éªŒè¯å’ŒåŸºç¡€ç½‘ç»œæµç¨‹ä¹Ÿæ˜¯è‡ªå·±æå®šçš„ã€‚</p>
<p>å¯¹äºä¸€ä¸ªä¼°ç®—æœ‰ 85% çš„ä»£ç éƒ½æ˜¯ Codex å†™çš„é¡¹ç›®æ¥è¯´ï¼Œä¸€ä¸ªç²¾å¿ƒè§„åˆ’çš„åœ°åŸºé¿å…äº†æ˜‚è´µçš„è¿”å·¥å’Œé‡æ„ã€‚</p>
<p>OpenAI å›¢é˜Ÿè¡¨ç¤ºï¼Œã€Œè¿™ç»å¯¹æ˜¯æˆ‘ä»¬åšè¿‡çš„æœ€æ­£ç¡®çš„å†³å®šä¹‹ä¸€ã€ã€‚</p>
<p>ä¸€å®šè¦å½¢æˆè¿™æ ·ä¸€ä¸ªæ€è·¯â€”â€”</p>
<p>ä¸æ˜¯ä¸ºäº†å°½å¿«æä¸ªã€Œèƒ½è·‘çš„ä¸œè¥¿ã€ï¼Œè€Œæ˜¯è¦æä¸ªã€Œæ‡‚è§„çŸ©çš„ä¸œè¥¿ã€ã€‚</p>
<p>å†™ä»£ç æœ‰å¾ˆå¤šç§ã€Œæ­£ç¡®ã€çš„æ–¹å¼ï¼š</p>
<ul>
<li>ä¸éœ€è¦å‘Šè¯‰ Codex å…·ä½“æ¯ä¸€æ­¥æ€ä¹ˆåšï¼›</li>
<li>ä½†éœ€è¦å‘ Codex å±•ç¤ºä»€ä¹ˆæ˜¯ã€Œæ­£ç¡®ã€çš„ã€‚</li>
</ul>
<p>ä¸€æ—¦å®šå¥½äº†èµ·ç‚¹å’Œå›¢é˜Ÿå–œæ¬¢çš„æ„å»ºæ–¹å¼ï¼ŒCodex å°±å¯ä»¥å¼€å·¥äº†ã€‚</p>
<p>ä¸ºäº†çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼ŒOpenAI å›¢é˜Ÿç¡®å®è¯•è¿‡ç›´æ¥ç»™ Promptï¼š</p>
<p>ç…§ç€ iOS ä»£ç æ„å»º Sora Android Appã€‚å¼€å§‹å¹²ã€‚</p>
<p>ç»“æœï¼Œå¾ˆå¿«å°±ç¿»è½¦äº†ã€‚</p>
<p>è™½ç„¶ Codex å†™å‡ºæ¥çš„ä¸œè¥¿æŠ€æœ¯ä¸Šèƒ½è·‘ï¼Œä½†äº§å“ä½“éªŒå®Œå…¨ä¸è¾¾æ ‡ã€‚</p>
<p>è€Œä¸”å¦‚æœä¸æ‡‚ç«¯ç‚¹ã€æ•°æ®å’Œç”¨æˆ·æµï¼ŒCodex è¿™ç§ã€Œä¸€é”¤å­ä¹°å–ã€ï¼ˆZero-shotï¼‰å†™å‡ºæ¥çš„ä»£ç æ ¹æœ¬ä¸å¯é ã€‚å“ªæ€•ä¸ç”¨ AIï¼Œä¸€æ¬¡æ€§åˆå¹¶å‡ åƒè¡Œä»£ç ä¹Ÿæ˜¯ä½œæ­»ã€‚</p>
<p>OpenAI çš„å‡è®¾æ˜¯ï¼Œå¦‚æœç»™ Codex ä¸€ä¸ªå†™æ»¡å¥½èŒƒä¾‹çš„æ²™ç›’ï¼Œå®ƒå°±èƒ½å¦‚é±¼å¾—æ°´ï¼›äº‹å®è¯æ˜ï¼Œä»–ä»¬æ˜¯å¯¹çš„ã€‚</p>
<p>å…‰ç§ƒç§ƒåœ°è®© Codexã€Œåšä¸ªè®¾ç½®é¡µé¢ã€åŸºæœ¬ä¸é è°±ã€‚</p>
<p>ä½†å¦‚æœä½ è®©å®ƒã€Œå‚è€ƒä½ åˆšæ‰çœ‹åˆ°çš„é‚£ä¸ªé¡µé¢çš„æ¶æ„å’Œæ¨¡å¼ï¼Œåšä¸ªè®¾ç½®é¡µé¢ã€ï¼Œæ•ˆæœå°±å¥½å¤ªå¤šäº†ã€‚</p>
<p>äººç±»åšç»“æ„æ€§çš„å†³ç­–å¹¶å®šä¸‹ç¡¬æ€§è§„çŸ©ï¼›Codex è´Ÿè´£åœ¨è¿™ä¸ªæ¡†æ¶é‡Œå¡«å……å¤§é‡çš„ä»£ç ã€‚</p>
<p><strong>ã€Œ<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7012d39e6238429ca076a39ff4a2a0c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=HHuquk3QaG%2FX0zAVHvVQFZI8J3Q%3D" alt="" loading="lazy"/>ã€</strong></p>
<p><strong>ã€Œå…ˆè§„åˆ’ï¼Œå†ç¼–ç ã€</strong></p>
<p>ä¸ºäº†æœ€å¤§åŒ– Codex çš„æ½œåŠ›ï¼Œå›¢é˜Ÿä¸‹ä¸€æ­¥æ˜¯ææ¸…æ¥šâ€”â€”æ€ä¹ˆè®© Codex é•¿æ—¶é—´åœ¨æ— äººç›‘ç£çš„çŠ¶æ€ä¸‹å¹²æ´»ã€‚</p>
<p>ä¸ºæ­¤ï¼Œ4 äººå›¢é˜Ÿæ”¹äº†å·¥ä½œæµã€‚</p>
<p>å¯¹äºä»»ä½•ç¨å¾®å¤æ‚ç‚¹çš„æ”¹åŠ¨ï¼Œå…ˆè®© Codex å¸®ç†æ¸…ç³»ç»Ÿå’Œä»£ç æ˜¯æ€ä¹ˆè¿ä½œçš„ã€‚</p>
<p>æ¯”å¦‚ï¼Œè®©å®ƒè¯»ä¸€ç»„ç›¸å…³æ–‡ä»¶ï¼Œæ€»ç»“è¿™ä¸ªåŠŸèƒ½æ˜¯æ€ä¹ˆè·‘çš„ï¼›æ¯”å¦‚æ•°æ®æ€ä¹ˆä» API æµç» Repository å±‚ã€ViewModelï¼Œæœ€ååˆ° UIï¼Œç„¶åäººå·¥çº æ­£æˆ–ç»†åŒ–å®ƒçš„ç†è§£ã€‚</p>
<p>è¿™å°±åƒå¸¦ä¸€ä¸ªèƒ½åŠ›å¾ˆå¼ºçš„æ–°é˜Ÿå‹ä¸€æ ·ï¼Œå›¢é˜Ÿä¼šè·Ÿ Codex ä¸€èµ·åˆ¶å®šä¸€ä¸ªæ‰å®çš„å®æ–½è®¡åˆ’ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b618bb7f6444f98bad1ebf677769598~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=FPbMKh0wGhKG8qfpcntmuu%2FGPpY%3D" alt="" loading="lazy"/></p>
<p>è¿™ä¸ªè®¡åˆ’é€šå¸¸åƒä¸€ä»½å¾®å‹è®¾è®¡æ–‡æ¡£ï¼ŒæŒ‡æ˜å“ªäº›æ–‡ä»¶è¦æ”¹ï¼Œè¦å¼•å…¥ä»€ä¹ˆæ–°çŠ¶æ€ï¼Œé€»è¾‘è¯¥æ€ä¹ˆèµ°ã€‚</p>
<p>åªæœ‰åˆ°äº†è¿™ä¸€æ­¥ï¼Œå›¢é˜Ÿæ‰è®© Codex å¼€å§‹æ‰§è¡Œè®¡åˆ’ï¼Œä¸€æ­¥æ­¥æ¥ã€‚</p>
<p>æ­¤å¤„ï¼Œæœ‰ä¸ªéå¸¸å®ç”¨çš„å°æŠ€å·§ï¼š</p>
<p>å¯¹äºé‚£ç§è¶…é•¿ä»»åŠ¡ï¼Œå½“ä¸Šä¸‹æ–‡çª—å£å¿«çˆ†äº†çš„æ—¶å€™ï¼Œä»–ä»¬ä¼šè®© Codex æŠŠè®¡åˆ’ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œè¿™æ ·å°±èƒ½åœ¨ä¸åŒçš„ä¼šè¯é‡Œå»¶ç»­åŒæ ·çš„æŒ‡å¯¼æ€è·¯ã€‚</p>
<p>è¿™ä¸ªé¢å¤–çš„è§„åˆ’å¾ªç¯è¯æ˜ï¼Œç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ã€‚</p>
<p>å›¢é˜Ÿå¯ä»¥æ”¾å¿ƒåœ°è®© Codex é•¿æ—¶é—´ã€Œæ— äººç›‘ç£ã€åœ°è·‘ï¼Œè¿™ä¹Ÿè®© Code Review å˜å¾—æ›´å®¹æ˜“ï¼Œå› ä¸ºå¯ä»¥å¯¹ç…§è®¡åˆ’æ¥æ£€æŸ¥å®ç°ï¼Œè€Œä¸æ˜¯ä¸€è„¸æ‡µé€¼åœ°çœ‹ Diffã€‚</p>
<p>è€Œä¸”ä¸‡ä¸€å‡ºé—®é¢˜äº†ï¼Œå¯ä»¥å…ˆè°ƒè¯•è®¡åˆ’ï¼Œå†è°ƒè¯•ä»£ç ã€‚</p>
<p><strong>ã€Œ<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71ad75b395184da1a5edd77fafb3d221~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=OM4Uy9x9INOZwIq2RUVEPbd2nkE%3D" alt="" loading="lazy"/>ã€</strong></p>
<p><strong>ã€Œå¤š AI å¹¶è¡Œï¼Œ åˆ†å¸ƒå¼å·¥ç¨‹ã€</strong></p>
<p>åœ¨é¡¹ç›®æœ€å¿™çš„æ—¶å€™ï¼ŒOpenAI å›¢é˜Ÿç»å¸¸å¹¶è¡Œè·‘ç€å¥½å‡ ä¸ª Codex ä¼šè¯ã€‚</p>
<p>ä¸€ä¸ªåœ¨åšæ’­æ”¾åŠŸèƒ½ï¼Œå¦ä¸€ä¸ªåœ¨åšæœç´¢ï¼Œå¦ä¸€ä¸ªåœ¨å¤„ç†é”™è¯¯ï¼Œæœ‰æ—¶å€™è¿˜æœ‰ä¸€ä¸ªåœ¨å†™æµ‹è¯•æˆ–é‡æ„ã€‚</p>
<p>è¿™æ„Ÿè§‰ä¸åƒæ˜¯ç”¨å·¥å…·ï¼Œæ›´åƒæ˜¯ã€Œç®¡å›¢é˜Ÿã€ã€‚æ¯ä¸ªä¼šè¯éƒ½ä¼šå®šæœŸæ±‡æŠ¥è¿›åº¦ã€‚</p>
<p>ä¸€ä¸ªå¯èƒ½ä¼šè¯´ï¼Œã€Œæˆ‘å·²ç»è§„åˆ’å¥½è¿™ä¸ªæ¨¡å—äº†ï¼›è¿™æ˜¯æˆ‘çš„å»ºè®®ã€ï¼Œè€Œå¦ä¸€ä¸ªä¼šä¸ºä¸€ä¸ªæ–°åŠŸèƒ½ç”©å‡ºä¸€ä¸ªå·¨å¤§çš„ Diffã€‚</p>
<p>æ¯ä¸€ä¸ªéƒ½éœ€è¦å…³æ³¨ã€åé¦ˆå’Œ Reviewã€‚</p>
<p>è¿™è·Ÿåšä¸€ä¸ªå¸¦ç€å¥½å‡ ä¸ªæ–°äººçš„ Tech Lead ç®€ç›´ä¸€æ¨¡ä¸€æ ·ï¼Œå¤§å®¶éƒ½åœ¨æ¨è¿›ï¼Œå¤§å®¶éƒ½éœ€è¦æŒ‡å¯¼ã€‚</p>
<p>ç»“æœå°±æ˜¯å½¢æˆäº†ä¸€ç§åä½œæµã€‚Codex è¿™ç§æš´åŠ›çš„ç¼–ç èƒ½åŠ›ï¼ŒæŠŠå›¢é˜Ÿä»å¤§é‡çš„æ‰‹å·¥æ‰“å­—ä¸­è§£æ”¾å‡ºæ¥äº†ã€‚</p>
<p>å› æ­¤ï¼Œä»–ä»¬æœ‰æ›´å¤šçš„æ—¶é—´æ€è€ƒæ¶æ„ï¼Œä»”ç»†è¯» PRï¼Œæµ‹è¯• Appã€‚</p>
<p>Codex ä¸ä¼šæœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ç“¶é¢ˆï¼Œä½†å¼€å‘è€…æœ‰ã€‚å¼€å‘å·¥ä½œæµï¼Œä»å†™ä»£ç å˜æˆäº†åšå†³å®šã€ç»™åé¦ˆå’Œé›†æˆå˜æ›´ã€‚</p>
<p>è¿™å°±æ˜¯ã€Œå¸ƒé²å…‹æ–¯çš„å®šå¾‹ã€ä»¥ä¸€ç§æ–°æ–¹å¼åº”éªŒçš„åœ°æ–¹ã€‚</p>
<p>ä½ ä¸èƒ½ç®€å•åœ°å¢åŠ  Codex ä¼šè¯å°±æŒ‡æœ›é€Ÿåº¦çº¿æ€§æå‡ï¼Œå°±åƒä½ ä¸èƒ½å¾€é¡¹ç›®é‡Œæ— é™åŠ äººä¸€æ ·ã€‚</p>
<p>æ¯ä¸€åŒé¢å¤–çš„ã€Œæ‰‹ã€ï¼Œå“ªæ€•æ˜¯è™šæ‹Ÿçš„ï¼Œéƒ½ä¼šå¢åŠ åè°ƒæˆæœ¬ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9468dfa897b436c82d3047b6c2088e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=BzYJXOGAVqNJ%2BUI922EGdBU2%2Bpo%3D" alt="" loading="lazy"/></p>
<p><strong>ã€ŒCodexï¼šè·¨å¹³å°è¶…èƒ½åŠ›ã€</strong></p>
<p>OpenAI è¿™ä¸€é¡¹ç›®èµ·æ­¥æ—¶æœ‰ä¸€ä¸ªå·¨å¤§çš„å…ˆå‘ä¼˜åŠ¿ï¼šSora å·²ç»åœ¨ iOS ä¸Šå‘å¸ƒäº†ã€‚</p>
<p>ä»–ä»¬ç»å¸¸æŠŠ Codex æŒ‡å‘ iOS å’Œåç«¯ä»£ç åº“ï¼Œå¸®å®ƒç†è§£å…³é”®éœ€æ±‚å’Œçº¦æŸã€‚</p>
<p>åœ¨æ•´ä¸ªé¡¹ç›®è¿‡ç¨‹ä¸­ï¼ŒOpenAI å¼€ç©ç¬‘è¯´ã€Œé‡æ–°å‘æ˜äº†è·¨å¹³å°æ¡†æ¶ï¼Œå¿˜æ‰ React Native æˆ– Flutterï¼Œè·¨å¹³å°çš„æœªæ¥å°±æ˜¯ Codexã€ã€‚</p>
<p>è¿™å¥ç©ç¬‘èƒŒåæœ‰ä¸¤ä¸ªåŸåˆ™ï¼š</p>
<p><strong>ã€Œ1. é€»è¾‘æ˜¯å¯ç§»æ¤çš„ã€</strong></p>
<p>æ— è®ºä»£ç æ˜¯ç”¨ Swift è¿˜æ˜¯ Kotlin å†™çš„ï¼Œåº•å±‚çš„åº”ç”¨é€»è¾‘â€”â€”æ•°æ®æ¨¡å‹ã€ç½‘ç»œè°ƒç”¨ã€éªŒè¯è§„åˆ™ã€ä¸šåŠ¡é€»è¾‘â€”â€”éƒ½æ˜¯ä¸€æ ·çš„ã€‚Codex éå¸¸æ“…é•¿è¯»å– Swift å®ç°å¹¶ç”Ÿæˆè¯­ä¹‰ä¸€è‡´çš„ Kotlin ä»£ç ã€‚</p>
<p><strong>ã€Œ2. å…·ä½“ç¤ºä¾‹æä¾›å¼ºå¤§çš„ä¸Šä¸‹æ–‡ã€</strong></p>
<p>ä¸€ä¸ªå…¨æ–°çš„ Codex ä¼šè¯ï¼Œå¦‚æœèƒ½çœ‹åˆ°ã€Œè¿™å°±æ˜¯å®ƒåœ¨ iOS ä¸Šç©¶ç«Ÿæ˜¯æ€ä¹ˆè·‘çš„ã€ä»¥åŠã€Œè¿™æ˜¯ Android çš„æ¶æ„ã€ï¼Œé‚£æ•ˆç‡è¿œæ¯”å…‰å¬è‡ªç„¶è¯­è¨€æè¿°è¦é«˜å¾—å¤šã€‚</p>
<p>åŸºäºè¿™äº›åŸåˆ™ï¼Œå›¢é˜ŸæŠŠ iOSã€åç«¯å’Œ Android ä»“åº“éƒ½æ”¾åˆ°äº†åŒä¸€ä¸ªç¯å¢ƒä¸­ã€‚</p>
<p>ç»™ Codex ä¸€ä¸ªè¿™æ ·çš„ Promptï¼š</p>
<p>é˜…è¯» iOS ä»£ç é‡Œçš„è¿™äº›æ¨¡å‹å’Œç«¯ç‚¹ï¼Œç„¶åå‡ºä¸€ä¸ªè®¡åˆ’ï¼Œç”¨ç°æœ‰çš„ API Client å’Œæ¨¡å‹ç±»åœ¨ Android ä¸Šå®ç°åŒæ ·çš„è¡Œä¸ºã€‚</p>
<p>æ­¤å¤„ï¼Œä¹Ÿæœ‰ä¸€ä¸ªå®ç”¨çš„å°æŠ€å·§ï¼š</p>
<p>åœ¨~/.codex/AGENTS.md é‡Œè¯¦ç»†å†™æ˜æœ¬åœ°ä»“åº“åœ¨å“ªå„¿ä»¥åŠé‡Œé¢æœ‰å•¥ã€‚è¿™èƒ½è®© Codex æ›´å®¹æ˜“åœ°æ‰¾åˆ°å’Œè·³è½¬åˆ°ç›¸å…³ä»£ç ã€‚</p>
<p>æ›´å¹¿æ³›çš„ç»éªŒæ˜¯ï¼Œå¯¹äº Codex æ¥è¯´ï¼Œä¸Šä¸‹æ–‡å°±æ˜¯ä¸€åˆ‡ã€‚</p>
<p>å½“ Codex ç†è§£äº†åŠŸèƒ½åœ¨ iOS é‡Œæ˜¯æ€ä¹ˆè·‘çš„ï¼Œå†ç»“åˆå¯¹ Android App ç»“æ„çš„ç†è§£ï¼Œå°±èƒ½è·å¾—éå¸¸å¥½çš„ç»“æœã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca2ef7cba22b48ab9dcf6d42fd6991f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=kDa%2BiV32UOgKoimqQr4GylSSnlw%3D" alt="" loading="lazy"/></p>
<p><strong>ã€Œä¸€åœºå¤ç›˜ ï¼Œå¼€å‘è€…ã€Œè¶…èƒ½åŠ›ã€è§‰é†’ã€</strong></p>
<p>28 å¤©å†²åˆºç»“æŸæ—¶ï¼Œç”¨ Codex å·²æˆä¸º OpenAI é»˜è®¤çš„å¼€å‘é—­ç¯â€”â€”ç†è§£ä»£ç ã€è§„åˆ’å˜æ›´ã€å®ç°åŠŸèƒ½ã€Review è¾“å‡ºã€‚</p>
<p>æ˜¾ç„¶ï¼ŒAI è¾…åŠ©å¼€å‘å¹¶æ²¡æœ‰é™ä½å·¥ç¨‹çš„ä¸¥è°¨æ€§ï¼Œåè€Œæå‡äº†å®ƒã€‚</p>
<p>Codex å›¢é˜Ÿè®¾è®¡å¸ˆ Ed Bayes æè¿°äº†ï¼Œè¿™ä¸ªå·¥å…·å¦‚ä½•æ”¹å˜äº†è‡ªå·±çš„å·¥ä½œæµã€‚</p>
<p>å¦‚ä»Šï¼ŒCodex å·²ä¸é¡¹ç›®ç®¡ç†å·¥å…· Linearã€ä»¥åŠé€šè®¯å¹³å° Slack æ‰“é€šï¼Œå›¢é˜Ÿæˆå‘˜å¯ä»¥ç›´æ¥æŠŠç¼–ç¨‹ä»»åŠ¡æ´¾ç»™ AI æ™ºèƒ½ä½“ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2390f6f937248e4b23d38d45ae18133~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=Ekb8rrpvtZn0mkhIS%2FHI25Zp4zQ%3D" alt="" loading="lazy"/></p>
<p>ä»–è¡¨ç¤ºï¼Œã€Œä½ å¯ä»¥æŠŠ Codex æ‹‰è¿›æ¥ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç›´æ¥ç»™ Codex æŒ‡æ´¾ issueã€‚Codex ç®€ç›´å°±æ˜¯ä½ å·¥ä½œåŒºé‡Œçš„ä¸€ä¸ªé˜Ÿå‹ã€ã€‚</p>
<p>è¿™ç§é›†æˆæ„å‘³ç€ï¼Œå½“æœ‰äººåœ¨ Slack é‡Œå‘åé¦ˆæ—¶ï¼Œå¯ä»¥ç›´æ¥ @Codex è®©å®ƒä¿® bugï¼›å®ƒè¿˜ä¼šæä¸€ä¸ª PRï¼Œå›¢é˜Ÿæˆå‘˜å¯ä»¥åœ¨åŒä¸€ä¸ªå¸–å­é‡Œå®¡æŸ¥ä»£ç å¹¶è¿›è¡Œè¿­ä»£ã€‚</p>
<p>ã€Œå®ƒåŸºæœ¬ä¸Šå°±æ˜¯åœ¨æ¨¡æ‹Ÿè¿™ç§åŒäº‹å…³ç³»ï¼Œä¸ç®¡ä½ åœ¨å“ªå·¥ä½œå®ƒéƒ½åœ¨ã€ã€‚</p>
<p>å°½ç®¡ Codex èƒ½åŠ›å¾ˆå¼ºï¼Œä½†å®ƒçš„ç›®æ ‡æ˜¯ç«‹åˆ»ä» A åˆ° Bã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç¦»äº†äººï¼ŒAI è¾…åŠ©ç¼–ç¨‹å°±ç©ä¸è½¬ã€‚</p>
<p>æ˜æ—¥è½¯ä»¶å·¥ç¨‹å¸ˆçš„ã€Œè¶…èƒ½åŠ›ã€ï¼Œå°†æ˜¯æ·±åˆ»çš„ç³»ç»Ÿç†è§£èƒ½åŠ›ï¼Œä»¥åŠåœ¨é•¿æ—¶é—´è·¨åº¦ä¸Šä¸ AI åä½œçš„èƒ½åŠ›ã€‚</p>
<p>ç°åœ¨ï¼ŒCodex è®©å¼€å‘è€…èƒ½ä¸“æ³¨äºè½¯ä»¶å·¥ç¨‹æœ€æœ‰æ„ä¹‰çš„éƒ¨åˆ†ï¼Œå›å½’ä»–ä»¬çƒ­çˆ±è¿™é—¨æ‰‹è‰ºçš„åˆå¿ƒã€‚</p>
<p>ä¸€æ—¦ Codex åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸°å¯Œçš„ç¯å¢ƒä¸­é…ç½®å¥½ï¼Œæ‡‚ä½ çš„ç›®æ ‡å’Œä½ å–œæ¬¢çš„æ„å»ºæ–¹å¼ï¼Œä»»ä½•å›¢é˜Ÿéƒ½èƒ½è®©æˆ˜æ–—åŠ›ç¿»å€ã€‚</p>
<p>è¿™ä¸€æ¬¡ï¼ŒOpenAI çš„å‘å¸ƒå¤ç›˜ä¸æ˜¯ä¸€ä¸ªä¸‡èƒ½è¯æ–¹ï¼Œä¹Ÿä¸æ•¢è¯´å·²ç»å½»åº•ææ‡‚äº† AI è¾…åŠ©å¼€å‘ã€‚</p>
<p>ä½†ä»–ä»¬å¸Œæœ›ï¼Œèƒ½ä»¥è‡ªå·±çš„ç»éªŒå¯å‘æ›´å¤šçš„å¼€å‘è€…ï¼Œè®© Codex æ›´å¥½åœ°ä¸ºäººä»¬æ‰€ç”¨ã€‚</p>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farstechnica.com%2Fai%2F2025%2F12%2Fhow-openai-is-using-gpt-5-codex-to-improve-the-ai-tool-itself%2F" target="_blank" title="https://arstechnica.com/ai/2025/12/how-openai-is-using-gpt-5-codex-to-improve-the-ai-tool-itself/" ref="nofollow noopener noreferrer">arstechnica.com/ai/2025/12/â€¦</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenai.com%2Findex%2Fshipping-sora-for-android-with-codex%2F" target="_blank" title="https://openai.com/index/shipping-sora-for-android-with-codex/" ref="nofollow noopener noreferrer">openai.com/index/shippâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é˜¿é‡Œäº‘ Serverless è®¡ç®— 11 æœˆäº§å“åŠ¨æ€]]></title>    <link>https://juejin.cn/post/7583906478328135699</link>    <guid>https://juejin.cn/post/7583906478328135699</guid>    <pubDate>2025-12-15T10:26:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906478328135699" data-draft-id="7583906478328119315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é˜¿é‡Œäº‘ Serverless è®¡ç®— 11 æœˆäº§å“åŠ¨æ€"/> <meta itemprop="keywords" content="Serverless"/> <meta itemprop="datePublished" content="2025-12-15T10:26:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘äº‘åŸç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é˜¿é‡Œäº‘ Serverless è®¡ç®— 11 æœˆäº§å“åŠ¨æ€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘äº‘åŸç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:26:02.000Z" title="Mon Dec 15 2025 10:26:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>ç²¾é€‰æ–‡ç« ï¼š</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NzI5MDM1MQ%3D%3D%26mid%3D2247540709%26idx%3D1%26sn%3Da2a6aa8a66d88345ee06bf14db1cc184%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI4NzI5MDM1MQ==&amp;mid=2247540709&amp;idx=1&amp;sn=a2a6aa8a66d88345ee06bf14db1cc184&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ç®—åŠ›æˆæœ¬é™ä½ 33%ï¼Œä¸å…‰åŒå°˜ç”¨ Serverless AI èµ‹èƒ½å½±è§†å•†ä¸šå†…å®¹ç”Ÿäº§</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NzI5MDM1MQ%3D%3D%26mid%3D2247540713%26idx%3D1%26sn%3D3ea8c8b3b1902f33d3aaa335db1746d8%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI4NzI5MDM1MQ==&amp;mid=2247540713&amp;idx=1&amp;sn=3ea8c8b3b1902f33d3aaa335db1746d8&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ModelScope æ¨¡å‹ä¸€é”®ä¸Šçº¿ï¼ŸFunModel å¸®ä½  5 åˆ†é’Ÿä»é›¶åˆ°ç”Ÿäº§</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NzI5MDM1MQ%3D%3D%26mid%3D2247540726%26idx%3D1%26sn%3D2b25a7e918f073f13826e7e1f033e859%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI4NzI5MDM1MQ==&amp;mid=2247540726&amp;idx=1&amp;sn=2b25a7e918f073f13826e7e1f033e859&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">åŠ©åŠ›ä¼ä¸šæ„å»º AI åŸç”Ÿåº”ç”¨ï¼Œå‡½æ•°è®¡ç®— FunctionAI é‡å¡‘æ¨¡å‹æœåŠ¡ä¸ Agent å…¨æ ˆç”Ÿæ€</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NzI5MDM1MQ%3D%3D%26mid%3D2247540731%26idx%3D1%26sn%3Dcff5735d1618973c9796560e9fd5957e%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI4NzI5MDM1MQ==&amp;mid=2247540731&amp;idx=1&amp;sn=cff5735d1618973c9796560e9fd5957e&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ã€æœ¬ä¸è¯¥æ•…éšœç³»åˆ—ã€‘ä» runC åˆ° runDï¼šSAE å¦‚ä½•åŒ–è§£å®‰å…¨æ³„éœ²é£é™©</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NzI5MDM1MQ%3D%3D%26mid%3D2247540736%26idx%3D1%26sn%3D33dc40efdba498ef21be76941c880138%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI4NzI5MDM1MQ==&amp;mid=2247540736&amp;idx=1&amp;sn=33dc40efdba498ef21be76941c880138&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ä»ä»£ç åˆ°ç”Ÿäº§æ¨ç†æœåŠ¡ï¼šDevPod å…¨æµç¨‹éƒ¨ç½² DeepSeek-OCR æ¨¡å‹å®æˆ˜æŒ‡å—</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NzI5MDM1MQ%3D%3D%26mid%3D2247540741%26idx%3D1%26sn%3D3181c44891771b03ecc677dce5a05216%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI4NzI5MDM1MQ==&amp;mid=2247540741&amp;idx=1&amp;sn=3181c44891771b03ecc677dce5a05216&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ã€æœ¬ä¸è¯¥æ•…éšœç³»åˆ—ã€‘å‘Šåˆ«èµ„æºâ€œä¸ç¡®å®šæ€§â€ï¼ŒSAE å¦‚ä½•ç ´è§£åˆšæ€§äº¤ä»˜æ ¸å¿ƒå›°å¢ƒ</a></p>
<h2 data-id="heading-0">äº§å“æœ€æ–°æ¶ˆæ¯</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4577c99b448248768dbd002936373ba4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766399162&amp;x-signature=QWbWUsCV7T0lOyjNC%2BKA3H2tofU%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker+NestJS+ELKï¼šä»é›¶æ­å»ºå…¨é“¾è·¯æ—¥å¿—ç›‘æ§ç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7583898823920746538</link>    <guid>https://juejin.cn/post/7583898823920746538</guid>    <pubDate>2025-12-15T10:21:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583898823920746538" data-draft-id="7583727768544100388" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker+NestJS+ELKï¼šä»é›¶æ­å»ºå…¨é“¾è·¯æ—¥å¿—ç›‘æ§ç³»ç»Ÿ"/> <meta itemprop="keywords" content="åç«¯,NestJS"/> <meta itemprop="datePublished" content="2025-12-15T10:21:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ovensi"/> <meta itemprop="url" content="https://juejin.cn/user/3175045312291598"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker+NestJS+ELKï¼šä»é›¶æ­å»ºå…¨é“¾è·¯æ—¥å¿—ç›‘æ§ç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3175045312291598/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ovensi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:21:53.000Z" title="Mon Dec 15 2025 10:21:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>éšç€ NestJS é¡¹ç›®å®¹å™¨åŒ–éƒ¨ç½²çš„è½åœ°ï¼Œä¼ ç»Ÿçš„ <code>docker logs</code> æŸ¥çœ‹æ—¥å¿—æ–¹å¼å·²æ— æ³•æ»¡è¶³æ’æŸ¥éœ€æ±‚ã€‚ä»Šå¤©èŠ±æ—¶é—´æ­å»ºäº†ä¸€å¥—åŸºäº Elastic Stack (ELK) çš„å…¨é“¾è·¯æ—¥å¿—ç›‘æ§ç³»ç»Ÿï¼Œå®ç°äº†æ—¥å¿—çš„è‡ªåŠ¨é‡‡é›†ã€ç»“æ„åŒ–å­˜å‚¨å’Œå¯è§†åŒ–åˆ†æã€‚</p>

<h2 data-id="heading-0">1. æ•´ä½“æ¶æ„</h2>
<p>ä½¿ç”¨ Docker Compose ç¼–æ’æ•´ä¸ªæœåŠ¡æ ˆï¼ŒåŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š</p>
<ul>
<li><strong>NestJS App</strong>: ä¸šåŠ¡æœåŠ¡ï¼Œé€šè¿‡ TCP ç›´æ¥å‘é€æ—¥å¿—ã€‚</li>
<li><strong>Logstash</strong>: æ¥æ”¶ TCP æ—¥å¿—æµï¼Œå¤„ç†åå­˜å…¥ ESã€‚</li>
<li><strong>Elasticsearch</strong>: å­˜å‚¨å’Œç´¢å¼•æ—¥å¿—æ•°æ®ã€‚</li>
<li><strong>Kibana</strong>: å¯è§†åŒ–é¢æ¿ï¼Œé…ç½®äº†ä¸­æ–‡ç•Œé¢å’Œå­è·¯å¾„è®¿é—®ã€‚</li>
<li><strong>Fleet Server</strong>: ç”¨äºç®¡ç† Elastic Agentï¼ˆé¢„ç•™å®‰å…¨ç›‘æ§èƒ½åŠ›ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-1">2. æ ¸å¿ƒé…ç½®è¦ç‚¹</h2>
<h3 data-id="heading-2">2.1 Docker Compose ç¼–æ’</h3>
<p>ä¸ºäº†åœ¨ä½é…æœåŠ¡å™¨ä¸Šæµç•…è¿è¡Œï¼Œå¯¹ ES å’Œ Logstash è¿›è¡Œäº†ä¸¥æ ¼çš„å†…å­˜é™åˆ¶ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># docker-compose.prod.yml</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">elasticsearch:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">elasticsearch:7.17.18</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span> <span class="hljs-comment"># é™åˆ¶å†…å­˜</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">xpack.security.enabled=true</span>      <span class="hljs-comment"># å¼€å¯å®‰å…¨è®¤è¯</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">elasticsearch_data:/usr/share/elasticsearch/data</span>

  <span class="hljs-attr">kibana:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">kibana:7.17.18</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">SERVER_BASEPATH=/log</span>            <span class="hljs-comment"># é…ç½®å­è·¯å¾„è®¿é—®</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">SERVER_REWRITEBASEPATH=true</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">I18N_LOCALE=zh-CN</span>               <span class="hljs-comment"># å¼€å¯ä¸­æ–‡ç•Œé¢</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5601:5601"</span>

  <span class="hljs-attr">logstash:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">logstash:7.17.18</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5000:5000"</span>                     <span class="hljs-comment"># æš´éœ² TCP ç«¯å£æ¥æ”¶æ—¥å¿—</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./elk/logstash/pipeline/logstash.conf:/usr/share/logstash/pipeline/logstash.conf</span>
</code></pre>
<h3 data-id="heading-3">2.2 NestJS è‡ªå®šä¹‰ Logstash Transport</h3>
<p>ä¸ºäº†ä¸ä¾èµ–æ–‡ä»¶æŒ‚è½½ï¼Œç›´æ¥åœ¨ NestJS ä¸­é€šè¿‡ TCP å‘é€æ—¥å¿—ã€‚æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª Winston Transportã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/common/logger/logstash.transport.ts</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> winston <span class="hljs-keyword">from</span> <span class="hljs-string">'winston'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> net <span class="hljs-keyword">from</span> <span class="hljs-string">'net'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogstashTransport</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">winston.transport</span> {
  <span class="hljs-comment">// ...çœç•¥è¿æ¥é‡è¿é€»è¾‘</span>
  <span class="hljs-title function_">log</span>(<span class="hljs-params">info: <span class="hljs-built_in">any</span>, callback: () =&gt; <span class="hljs-built_in">void</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span>) {
      <span class="hljs-keyword">const</span> logEntry = {
        <span class="hljs-string">'@timestamp'</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
        <span class="hljs-attr">app</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">appName</span>,
        ...info <span class="hljs-comment">// åŒ…å« message, level, req, res ç­‰æ‰€æœ‰å…ƒæ•°æ®</span>
      };
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span>.<span class="hljs-title function_">write</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(logEntry) + <span class="hljs-string">'\n'</span>);
    }
    <span class="hljs-title function_">callback</span>();
  }
}
</code></pre>
<h3 data-id="heading-4">2.3 å…¨é‡è¯·æ±‚ä¸Šä¸‹æ–‡æ•è·</h3>
<p>è¿™æ˜¯ä»Šå¤©çš„é‡å¤´æˆã€‚é»˜è®¤çš„æ—¥å¿—å¾€å¾€ç¼ºå°‘å…¥å‚å’Œå‡ºå‚ï¼Œæ’æŸ¥é—®é¢˜éå¸¸ç—›è‹¦ã€‚é€šè¿‡è‡ªå®šä¹‰ä¸­é—´ä»¶ï¼Œæ‹¦æˆª <code>res.send</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ•è·å®Œæ•´çš„è¯·æ±‚ä½“å’Œå“åº”ä½“ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/common/middleware/logging.middleware.ts</span>
<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingMiddleware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NestMiddleware</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-meta">@Inject</span>(WINSTON_MODULE_PROVIDER) <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> logger: Logger</span>) {}

  <span class="hljs-title function_">use</span>(<span class="hljs-params">req: Request, res: Response, next: NextFunction</span>) {
    <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    
    <span class="hljs-comment">// åŠ«æŒ res.send ä»¥è·å–å“åº”ä½“</span>
    <span class="hljs-keyword">const</span> originalSend = res.<span class="hljs-property">send</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-attr">responseBody</span>: <span class="hljs-built_in">any</span>;
    res.<span class="hljs-property">send</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">body</span>) {
      responseBody = body;
      <span class="hljs-keyword">return</span> originalSend.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);
    };

    res.<span class="hljs-title function_">on</span>(<span class="hljs-string">'finish'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// ç»„è£…ç»“æ„åŒ–æ—¥å¿—</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">info</span>(
        <span class="hljs-string">`<span class="hljs-subst">${req.method}</span> <span class="hljs-subst">${req.originalUrl}</span> <span class="hljs-subst">${res.statusCode}</span>`</span>, 
        {
          <span class="hljs-attr">req</span>: { <span class="hljs-attr">body</span>: req.<span class="hljs-property">body</span>, <span class="hljs-attr">query</span>: req.<span class="hljs-property">query</span>, <span class="hljs-attr">ip</span>: req.<span class="hljs-property">ip</span> },
          <span class="hljs-attr">res</span>: { <span class="hljs-attr">statusCode</span>: res.<span class="hljs-property">statusCode</span>, <span class="hljs-attr">body</span>: <span class="hljs-title function_">tryParseJSON</span>(responseBody) },
          <span class="hljs-attr">context</span>: <span class="hljs-string">'HTTP'</span>,
        }
      );
    });

    <span class="hljs-title function_">next</span>();
  }
}
</code></pre>
<h2 data-id="heading-5">3. éƒ¨ç½²ä¸è¿ç»´</h2>
<p>ç¼–å†™äº† <code>deploy.sh</code> è„šæœ¬ï¼Œå®ç°æœ¬åœ°ä»£ç ä¸€é”®æ¨é€è‡³æœåŠ¡å™¨å¹¶é‡å»ºå®¹å™¨ã€‚</p>
<p>è§£å†³çš„ä¸€ä¸ªå…³é”®å‘æ˜¯ <strong>Kibana çš„å­è·¯å¾„ä»£ç†</strong>ã€‚åœ¨ Nginx ä¸­é…ç½®ï¼š</p>
<pre><code class="hljs language-nginx" lang="nginx">location /log/ {
    proxy_pass http://localhost:5601/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    # å…³é”®ï¼šKibana éœ€è¦çŸ¥é“å®ƒè¿è¡Œåœ¨ä»£ç†åé¢
}
</code></pre>
<p>åŒæ—¶åœ¨ Kibana ç¯å¢ƒå˜é‡ä¸­å¿…é¡»é…åˆ <code>SERVER_BASEPATH=/log</code> å’Œ <code>SERVER_REWRITEBASEPATH=true</code>ã€‚</p>
<h2 data-id="heading-6">4. æœ€ç»ˆæ•ˆæœ</h2>
<p>é…ç½®å®Œæˆåï¼Œåœ¨ Kibana çš„ Discover é¢æ¿ä¸­ï¼Œä¸ä»…èƒ½çœ‹åˆ°ç³»ç»Ÿçš„å¯åŠ¨æ—¥å¿—ï¼Œè¿˜èƒ½å±•å¼€æ¯ä¸€æ¡ HTTP è¯·æ±‚ï¼ŒæŸ¥çœ‹ç”¨æˆ·åˆ°åº•ä¼ äº†ä»€ä¹ˆå‚æ•°ï¼ˆ<code>req.body</code>ï¼‰ï¼Œä»¥åŠç³»ç»Ÿåˆ°åº•è¿”å›äº†ä»€ä¹ˆï¼ˆ<code>res.body</code>ï¼‰ã€‚</p>
<p>è‡³æ­¤ï¼Œä¸€ä¸ªè½»é‡çº§ä½†åŠŸèƒ½å®Œå¤‡çš„æ—¥å¿—ç›‘æ§ç³»ç»Ÿå°±æ­å»ºå®Œæˆäº†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç§»åŠ¨ç«¯H5å¼¹çª—â€œæ»šåŠ¨ç©¿é€â€çš„ç»ˆæè§£å†³æ–¹æ¡ˆï¼šä¸ºä»€ä¹ˆ overflow: hidden æ²¡ç”¨ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7583891046205882420</link>    <guid>https://juejin.cn/post/7583891046205882420</guid>    <pubDate>2025-12-15T10:26:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583891046205882420" data-draft-id="7583921477613076515" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç§»åŠ¨ç«¯H5å¼¹çª—â€œæ»šåŠ¨ç©¿é€â€çš„ç»ˆæè§£å†³æ–¹æ¡ˆï¼šä¸ºä»€ä¹ˆ overflow: hidden æ²¡ç”¨ï¼Ÿ"/> <meta itemprop="keywords" content="APP"/> <meta itemprop="datePublished" content="2025-12-15T10:26:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JQ_Zhang"/> <meta itemprop="url" content="https://juejin.cn/user/1871846865110249"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç§»åŠ¨ç«¯H5å¼¹çª—â€œæ»šåŠ¨ç©¿é€â€çš„ç»ˆæè§£å†³æ–¹æ¡ˆï¼šä¸ºä»€ä¹ˆ overflow: hidden æ²¡ç”¨ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1871846865110249/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JQ_Zhang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:26:59.000Z" title="Mon Dec 15 2025 10:26:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç§»åŠ¨ç«¯å¼¹çª—â€œæ»šåŠ¨ç©¿é€â€çš„ç»ˆæè§£å†³æ–¹æ¡ˆï¼šä¸ºä»€ä¹ˆ overflow: hidden æ²¡ç”¨ï¼Ÿ</h2>
<p>åœ¨ç§»åŠ¨ç«¯ H5 å¼€å‘ä¸­ï¼Œ<strong>â€œæ»šåŠ¨ç©¿é€â€</strong>ï¼ˆScroll Chaining / Ghost Scrollï¼‰ç»å¯¹æ˜¯è®©æ— æ•°å‰ç«¯å¼€å‘è€…è¡€å‹å‡é«˜çš„ç»å…¸ Bug ä¹‹ä¸€ã€‚</p>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯â€œæ»šåŠ¨ç©¿é€â€ï¼Ÿ</h3>
<p>åœºæ™¯å¾ˆç®€å•ï¼š</p>
<ol>
<li>ä½ æ‰“å¼€äº†ä¸€ä¸ªå…¨å±å¼¹çª—ï¼ˆModal/Popupï¼‰ã€‚</li>
<li>å¼¹çª—ä¸‹é¢æœ‰ä¸€å±‚é•¿åˆ—è¡¨èƒŒæ™¯ã€‚</li>
<li>å½“ä½ åœ¨å¼¹çª—ä¸Šæ»‘åŠ¨æ‰‹æŒ‡æ—¶ï¼Œ<strong>åº•ä¸‹çš„èƒŒæ™¯é¡µé¢ç«Ÿç„¶è·Ÿç€ä¸€èµ·æ»šåŠ¨äº†ï¼</strong></li>
</ol>
<p>è¿™ä¸ä»…ä½“éªŒæå·®ï¼Œè¿˜å®¹æ˜“å¯¼è‡´å¼¹çª—é”™ä½æˆ–ç”¨æˆ·è¿·å¤±ä¸Šä¸‹æ–‡ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/daa717b4ab5b45c6a76e447eb36fdef6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSlFfWmhhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766399218&amp;x-signature=QmXSgtA9FSXhxBGZ5gS5lVzGf2I%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">å¸¸è§è¯¯åŒºï¼šä»¥ä¸º CSS å°±èƒ½æå®š</h3>
<p>å¤§å¤šæ•°äººçš„ç¬¬ä¸€ååº”æ˜¯ï¼šâ€œè¿™è¿˜ä¸ç®€å•ï¼Ÿç»™ body åŠ ä¸ª <code>overflow: hidden</code> ä¸å°±è¡Œäº†ï¼Ÿâ€</p>
<p>/* âŒ åªæœ‰ PC ç«¯æœ‰æ•ˆï¼Œç§»åŠ¨ç«¯ç»å¸¸ç¿»è½¦ */
body.modal-open {
overflow: hidden;
}<strong>ä¸ºä»€ä¹ˆå¤±æ•ˆï¼Ÿ</strong>
åœ¨ PC ç«¯ï¼Œ<code>overflow: hidden</code> ç¡®å®èƒ½éšè—æ»šåŠ¨æ¡å¹¶ç¦æ­¢æ»šåŠ¨ã€‚ä½†åœ¨ç§»åŠ¨ç«¯ï¼ˆç‰¹åˆ«æ˜¯ iOS Safariï¼‰ï¼Œæµè§ˆå™¨è®¤ä¸º <code>body</code> çš„æ»šåŠ¨æ˜¯â€œè§†å£ï¼ˆViewportï¼‰â€çº§åˆ«çš„ç‰¹æ€§ã€‚å³ä½¿ä½ ç¦ç”¨äº† <code>body</code> çš„æº¢å‡ºï¼Œç”¨æˆ·æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ‹–æ‹½ï¼ˆTouch Eventsï¼‰æ—¶ï¼Œæµè§ˆå™¨ä¾ç„¶ä¼šè§¦å‘é»˜è®¤çš„æ»šåŠ¨è¡Œä¸ºï¼Œç”šè‡³å¼•å‘æ©¡çš®ç­‹æ•ˆæœã€‚</p>
<h3 data-id="heading-3">è¿›é˜¶æ–¹æ¡ˆï¼šé˜»æ­¢ touchmoveï¼ˆæœ‰å‰¯ä½œç”¨ï¼‰</h3>
<p>ç¬¬äºŒç§å¸¸è§çš„æ–¹æ¡ˆæ˜¯ç›´æ¥é˜»æ­¢å¼¹çª—é®ç½©å±‚çš„è§¦æ‘¸äº‹ä»¶ï¼š</p>
<p>// âŒ è¿™ç§ä¸€åˆ€åˆ‡çš„æ–¹æ¡ˆä¼šå¯¼è‡´å¼¹çª—å†…éƒ¨ä¹Ÿæ— æ³•æ»šåŠ¨
<code>modal.addEventListener('touchmove', (e) =&gt; {   e.preventDefault(); }, { passive: false });</code></p>
<p><strong>å±€é™æ€§ï¼š</strong>
å¦‚æœä½ çš„å¼¹çª—å†…éƒ¨æœ¬èº«å°±éœ€è¦æ»šåŠ¨ï¼ˆæ¯”å¦‚ä¸€ä¸ªé•¿é•¿çš„è¯­è¨€é€‰æ‹©åˆ—è¡¨ï¼‰ï¼Œè¿™è¡Œä»£ç ä¼šæŠŠå¼¹çª—å†…éƒ¨çš„æ»šåŠ¨ä¹Ÿä¸€å¹¶æ€æ‰ï¼Œå¯¼è‡´â€œæ­»é”â€ã€‚è™½ç„¶å¯ä»¥é€šè¿‡åˆ¤æ–­ <code>target</code> æ¥ä¼˜åŒ–ï¼Œä½†é€»è¾‘éå¸¸ç¹çã€‚</p>
<h3 data-id="heading-4">ç»ˆæè§£å†³æ–¹æ¡ˆï¼šBody å›ºå®šå®šä½æ³•ï¼ˆPosition Fixedï¼‰</h3>
<p>ç›®å‰ä¸šç•Œï¼ˆåŒ…æ‹¬ Ant Design Mobile, Vant ç­‰ä¸»æµç»„ä»¶åº“ï¼‰å…¬è®¤çš„æœ€ç¨³å¦¥æ–¹æ¡ˆï¼Œå°±æ˜¯**â€œBody å›ºå®šå®šä½æ³•â€**ã€‚</p>
<h4 data-id="heading-5">æ ¸å¿ƒåŸç†</h4>
<p>æ—¢ç„¶ç¦æ­¢æ»šåŠ¨å¤±æ•ˆï¼Œé‚£æˆ‘ä»¬å°±<strong>ä»ç‰©ç†ä¸Šåˆ‡æ–­æ»šåŠ¨çš„å¯èƒ½</strong>ã€‚
å½“å¼¹çª—æ‰“å¼€æ—¶ï¼Œæˆ‘ä»¬å°† <code>body</code> è®¾ç½®ä¸º <code>position: fixed</code>ã€‚ä¸€ä¸ªå›ºå®šå®šä½çš„å…ƒç´ ï¼Œå¤©ç„¶å°±æ˜¯æ­»æ­»é’‰åœ¨å±å¹•ä¸Šçš„ï¼Œæ— è®ºä½ æ€ä¹ˆæ»‘ï¼Œå®ƒéƒ½ä¸å¯èƒ½åŠ¨ã€‚</p>
<h4 data-id="heading-6">å¸¦æ¥çš„æ–°é—®é¢˜ï¼šé¡µé¢è·³é¡¶</h4>
<p>å•çº¯è®¾ç½® <code>position: fixed</code> ä¼šå¯¼è‡´ä¸€ä¸ªä¸¥é‡çš„å‰¯ä½œç”¨ï¼š<strong>é¡µé¢ä¼šç¬é—´è·³å›åˆ°é¡¶éƒ¨</strong>ã€‚å› ä¸ºè„±ç¦»æ–‡æ¡£æµåï¼Œ<code>scrollTop</code> ä¸¢å¤±äº†ã€‚</p>
<h4 data-id="heading-7">å®Œæ•´ä»£ç å®ç°</h4>
<p>ä¸ºäº†è§£å†³è·³é¡¶é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨â€œé”å®šâ€å‰è®°å½•å½“å‰çš„æ»šåŠ¨ä½ç½®ï¼Œå¹¶åœ¨â€œè§£é”â€åæ¢å¤å®ƒã€‚</p>
<p>è¿™æ­£æ˜¯æˆ‘ä»¬é¡¹ç›® <code>Popup</code> ç»„ä»¶ä¸­é‚£æ®µ useEffect ä»£ç çš„é€»è¾‘ï¼š</p>
<p>// React Hook ç¤ºä¾‹</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (visible) {
    <span class="hljs-comment">// 1. ğŸ”’ é”å®šï¼šè®°å½•ä½ç½®å¹¶å›ºå®š Body</span>
    <span class="hljs-keyword">const</span> scrollTop = <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span>;
    
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">'fixed'</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`-<span class="hljs-subst">${scrollTop}</span>px`</span>; <span class="hljs-comment">// æŠŠé¡µé¢â€œæ‹‰â€å›åŸæ¥çš„è§†è§‰ä½ç½®</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">'100%'</span>;
    
    <span class="hljs-comment">// å­˜èµ·æ¥ï¼Œä¸€ä¼šå„¿è¿˜è¦ç”¨</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">dataset</span>.<span class="hljs-property">scrollY</span> = scrollTop.<span class="hljs-title function_">toString</span>();
    
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 2. ğŸ”“ è§£é”ï¼šæ¢å¤æ ·å¼å¹¶æ»šåŠ¨å›å»</span>
    <span class="hljs-keyword">const</span> scrollTop = <span class="hljs-built_in">parseInt</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">dataset</span>.<span class="hljs-property">scrollY</span> || <span class="hljs-string">'0'</span>, <span class="hljs-number">10</span>);
    
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">''</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">''</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">''</span>;
    
    <span class="hljs-comment">// æ¢å¤æ»šåŠ¨ä½ç½®ï¼Œè®©ç”¨æˆ·æ— æ„ŸçŸ¥</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>(<span class="hljs-number">0</span>, scrollTop);
  }
}, [visible]);
</code></pre>
<h4 data-id="heading-8">ä»£ç è§£æ</h4>
<ol>
<li><strong><code>document.body.style.position = 'fixed'</code></strong>ï¼šè¿™æ˜¯æ ¸å¿ƒï¼Œå¼ºåˆ¶ç¦æ­¢æ»šåŠ¨ã€‚</li>
<li><strong><code>top = -${scrollTop}px</code></strong>ï¼šè¿™æ˜¯ç²¾é«“ã€‚å‡è®¾ä½ æ»šåˆ°äº† 500px çš„ä½ç½®ï¼Œä¸ºäº†é˜²æ­¢å˜ä¸º fixed åè·³å› 0pxï¼Œæˆ‘ä»¬ç»™ body ä¸€ä¸ª <code>-500px</code> çš„åç§»é‡ï¼Œè§†è§‰ä¸Šé¡µé¢å°±çº¹ä¸ä¸åŠ¨äº†ã€‚</li>
<li><strong><code>window.scrollTo(0, scrollTop)</code></strong>ï¼šå…³é—­å¼¹çª—æ—¶ï¼Œè§£é™¤ fixedï¼Œæ­¤æ—¶é¡µé¢çœŸçš„å›åˆ°äº† 0pxï¼Œæˆ‘ä»¬å¿…é¡»ç«‹å³ç”¨ JS æŠŠå®ƒæ»šå›åˆ°ä¹‹å‰çš„ 500pxï¼Œå®ç°æ— ç¼è¡”æ¥ã€‚</li>
</ol>
<h3 data-id="heading-9">æ€»ç»“</h3>
<p>è™½ç„¶è¿™æ®µ JS ä»£ç çœ‹èµ·æ¥æœ‰ç‚¹â€œé‡â€ï¼Œç”šè‡³æ“ä½œäº† DOMï¼Œä½†å®ƒç›®å‰æ˜¯è§£å†³ç§»åŠ¨ç«¯ï¼ˆå°¤å…¶æ˜¯ iOSï¼‰æ»šåŠ¨ç©¿é€é—®é¢˜<strong>å…¼å®¹æ€§æœ€å¥½ã€å‰¯ä½œç”¨æœ€å°</strong>çš„æ–¹æ¡ˆã€‚</p>
<p>ä¸‹æ¬¡é‡åˆ°å¼¹çª—æ»šåŠ¨ç©¿é€ï¼Œåˆ«å†çº ç»“ <code>overflow: hidden</code> äº†ï¼Œç›´æ¥ä¸Šâ€œBody å›ºå®šå®šä½æ³•â€å§ï¼</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å†â€œè‹¦åŠ›â€å†™åå°ï¼ŒSpec Coding â€œè·‘â€ èµ·æ¥]]></title>    <link>https://juejin.cn/post/7583892482598436879</link>    <guid>https://juejin.cn/post/7583892482598436879</guid>    <pubDate>2025-12-15T10:52:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583892482598436879" data-draft-id="7583891046205849652" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å†â€œè‹¦åŠ›â€å†™åå°ï¼ŒSpec Coding  â€œè·‘â€ èµ·æ¥"/> <meta itemprop="keywords" content="å‰ç«¯,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-12-15T10:52:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›ªçƒå·¥ç¨‹å¸ˆå›¢é˜Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/2664871914644525"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å†â€œè‹¦åŠ›â€å†™åå°ï¼ŒSpec Coding  â€œè·‘â€ èµ·æ¥
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/6942370795716870178/posts" data-v-d326b38e=""><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/962ff7fb0a7e485e8a67c02675746756~tplv-k3u1fbpfcp-watermark.image" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/6942370795716870178/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="é›ªçƒå·¥ç¨‹å¸ˆå›¢é˜Ÿ" class="title" data-v-d326b38e="">é›ªçƒå·¥ç¨‹å¸ˆå›¢é˜Ÿ</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2025-12-15T10:52:15.000Z" title="Mon Dec 15 2025 10:52:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2025-12-15
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                é˜…è¯»12åˆ†é’Ÿ
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        å…³æ³¨
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              @é›ªçƒè´¢ç»
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»ä¸‰ä¸ªç–‘é—®è°ˆè°ˆæˆ‘ä»¬çš„æ ¸å¿ƒç†å¿µ</h2>
<p>AIèƒ½å†™ä»£ç æ—©å·²ä¸æ˜¯æ–°é²œè¯é¢˜ï¼Œä½†å½“å®ƒè¢«å¼•å…¥çœŸå®çš„æ—¥å¸¸å¼€å‘æµç¨‹æ—¶ï¼Œå·¥ç¨‹å±‚é¢çš„é—®é¢˜æ‰çœŸæ­£å¼€å§‹æš´éœ²ï¼š</p>
<ul>
<li><strong>ä¸ºä»€ä¹ˆåœ¨å¤šæ•°å›¢é˜Ÿé‡Œï¼ŒAI å†™ä»£ç ä»ç„¶æ—¶å¥½æ—¶åï¼Ÿ</strong></li>
<li><strong>ä¸ºä»€ä¹ˆåŒæ ·ä¸€å¥æŒ‡ä»¤ï¼Œæœ‰æ—¶åƒèµ„æ·±å·¥ç¨‹å¸ˆï¼Œæœ‰æ—¶å´åƒå®ä¹ ç”Ÿï¼Ÿ</strong></li>
<li><strong>ä¸ºä»€ä¹ˆç”Ÿæˆé€Ÿåº¦ä¸Šæ¥äº†ï¼Œä»£ç å´è¶Šæ¥è¶Šéš¾ç»´æŠ¤ï¼Ÿ</strong></li>
</ul>
<p>è¿™äº›å›°æƒ‘å¹¶ä¸æ„å¤–â€”â€”<strong>å®ƒä»¬å‡ ä¹æ˜¯å½“å‰ AI Coding çš„â€œå¸¸æ€ä½“éªŒâ€ã€‚</strong>
ä½†æ˜¯åœ¨æˆ‘ä»¬çš„ä¸­åå°ç³»ç»Ÿä¸­ï¼ŒAI Coding å´èƒ½æŒç»­ç¨³å®šåœ°é«˜è´¨é‡è¾“å‡ºï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜è½åœ°äº†ç›¸å…³çš„ä¸€å¥—å·¥ç¨‹ä½“ç³»ï¼Œæ•ˆæœéå¸¸ç›´æ¥ï¼š</p>
<p>åŸæ¥ä¸€ä¸ªé¡µé¢å‰ç«¯ç¼–ç éœ€è¦åŠå¤©ï¼Œç°åœ¨åªéœ€è¦ä¸€å¥è¯ â†’ 5ï½10åˆ†é’Ÿå°±è‡ªåŠ¨ç”Ÿæˆã€å¯ç›´æ¥è¿è¡Œã€‚</p>
<p>ä¸ä»…é€Ÿåº¦å¿«ï¼Œè´¨é‡è¿˜ç¨³å¾—æƒŠäººâ€”â€”<strong>åŒä¸€ä¸ªéœ€æ±‚ï¼Œä¸åŒäººç”Ÿæˆçš„ä»£ç ç»“æ„å®Œå…¨ä¸€è‡´ï¼Œåƒæ˜¯èµ„æ·±å·¥ç¨‹å¸ˆå†™å‡ºæ¥çš„ã€‚</strong></p>
<p>è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>ç ”å‘ä»å¤§é‡é‡å¤ç¼–ç ä¸­è§£æ”¾å‡ºæ¥ï¼ŒæŠŠç²¾åŠ›æŠ•å…¥åˆ°å¤æ‚é—®é¢˜ã€æ¶æ„è®¾è®¡ä¸ä½“éªŒæ‰“ç£¨ä¸Šï¼›</li>
<li>æ–°äººå…¥èŒå³å¯äº¤ä»˜ï¼Œæ— éœ€å…ˆèŠ±æ—¶é—´ç†Ÿæ‚‰åºå¤§çš„æ¡†æ¶ç»†èŠ‚ï¼›</li>
<li>å›¢é˜Ÿæ•´ä½“äº¤ä»˜é€Ÿåº¦æˆå€æå‡ï¼Œè´¨é‡æ›´å¯æ§ã€‚</li>
</ul>
<p>ç›®å‰é›ªçƒå†…éƒ¨<strong>è¿‘60%</strong> çš„ä¸­åå°æ–°é¡µé¢ç”± AI Coding è‡ªåŠ¨ç”Ÿæˆã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š</p>
<p>ä¸ºä»€ä¹ˆåŒæ ·ä½¿ç”¨ AIï¼Œå·®è·ä¼šå¦‚æ­¤ä¹‹å¤§ï¼Ÿ</p>
<p>ç­”æ¡ˆï¼Œä¸åœ¨æ¨¡å‹æœ¬èº«ï¼Œè€Œåœ¨äºâ€”â€”æœ‰æ²¡æœ‰å»ºç«‹ä¸€å¥—äººä¸ AI çš„æ ‡å‡†åŒ–æ²Ÿé€šæ–¹å¼ã€‚è‡ªç„¶è¯­è¨€æœ¬èº«å…·æœ‰æ¨¡ç³Šæ€§ï¼Œè€Œè½¯ä»¶å¼€å‘å´é«˜åº¦ä¾èµ–ç²¾ç¡®è¡¨è¾¾ï¼Œè¿™ç§å¼ åŠ›æ­£æ˜¯å·®è·äº§ç”Ÿçš„æ ¹æºã€‚</p>
<p>å¯¹æ­¤ï¼Œäºšé©¬é€Šäº‘ç§‘æŠ€é¦–å¸­è½¯ä»¶å·¥ç¨‹å¸ˆ Claire Liguori åœ¨å…¶å…³äº Kiro IDE çš„å®è·µä¸­æŒ‡å‡ºï¼Œå¼€å‘è€…è¦æƒ³è®© AI ç”Ÿæˆç¬¦åˆé¢„æœŸçš„è½¯ä»¶ï¼Œå°±å¿…é¡»é‡‡ç”¨ä¸€ç§æ›´åŠ ç»“æ„åŒ–ã€ç²¾ç¡®çš„æ²Ÿé€šæ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éµå¾ªçš„æ ¸å¿ƒç†å¿µï¼š<strong>Spec-driven developmentï¼ˆè§„èŒƒé©±åŠ¨å¼€å‘ï¼‰ï¼Œé€šè¿‡æ ‡å‡†åŒ–ã€å¯éªŒè¯çš„è§„èŒƒï¼Œå°†æ¨¡ç³Šéœ€æ±‚è½¬åŒ–ä¸ºå¯æ‰§è¡Œã€å¯è¿½æº¯çš„å·¥ç¨‹è¿‡ç¨‹ã€‚</strong></p>
<p>äºšé©¬é€Š CTO Werner Vogels ä¹Ÿæ›¾æ›´è¿›ä¸€æ­¥å¼ºè°ƒï¼ŒSpec-driven development ä¸æ˜¯å®˜åƒšä¸»ä¹‰ï¼Œè€Œæ˜¯ä¸€ç§å·¥ç¨‹çºªå¾‹ï¼›Apollo ç™»æœˆé¡¹ç›®çš„æˆåŠŸï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ­£æ˜¯å»ºç«‹åœ¨è¿™ç§çºªå¾‹ä¹‹ä¸Šã€‚</p>
<p>é‚£æˆ‘ä»¬å…·ä½“æ˜¯å¦‚ä½•è·µè¡Œ Spec-driven development çš„å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆä» <strong>Spec Coding ä¸ Vibe Coding çš„åŒºåˆ«</strong> è¯´èµ·ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆæ˜¯ Spec Codingï¼Œè€Œä¸æ˜¯ Vibe Coding</h2>
<h3 data-id="heading-2">1ã€Vibe Codingï¼šçœ‹èµ·æ¥å¾ˆèªæ˜ï¼Œç”¨èµ·æ¥å¾ˆå¿ƒè™š</h3>
<p>2025å¹´2æœˆï¼ŒOpenAI è”åˆåˆ›å§‹äººã€AI ç ”ç©¶è€… Andrej Karpathy é¦–æ¬¡æå‡º Vibe Codingï¼ˆæ°›å›´ç¼–ç¨‹ï¼‰ï¼Œå¼•å‘äº†ç¼–ç¨‹çš„æ–°å˜é©ã€‚ä¾‹å¦‚ï¼Œä½ ç»™å®ƒä¸€å¥æŒ‡ä»¤ï¼š</p>
<blockquote>
<p><em>â€œåšä¸€ä¸ªæœ‰åˆ—è¡¨å’Œæœç´¢çš„ç”¨æˆ·ç®¡ç†é¡µâ€</em></p>
</blockquote>
<p>å®ƒä¼šå†™ä»£ç ï¼Œå†™å¾—è¿˜æŒºåƒå›äº‹ã€‚</p>
<p>ä½†ä¸€æ—¦è¿›å…¥çœŸå®å·¥ç¨‹ï¼Œå°±ä¼šæš´éœ²é—®é¢˜ï¼š</p>
<ul>
<li><strong>æ˜“å‡ºç°ç†è§£åå·®</strong>ï¼šæ¥å£ã€å­—æ®µã€ä¸šåŠ¡é€»è¾‘ç»å¸¸â€œå‡­ç©ºè¢« AI æƒ³è±¡å‡ºæ¥â€ï¼›</li>
<li><strong>é£æ ¼ä¸ç»Ÿä¸€</strong>ï¼šæ¯æ¬¡ç”Ÿæˆç»“æ„éƒ½ä¸ä¸€æ ·ï¼Œâ€œåƒæ¯ä¸ªå·¥ç¨‹å¸ˆé£æ ¼éƒ½å®Œå…¨ä¸åŒâ€ï¼›</li>
<li><strong>è¶Šå¤æ‚è¶Šä¸ç¨³</strong>ï¼šè·¨æ¨¡å—ã€æ ¡éªŒé€»è¾‘ã€å¤šçŠ¶æ€å¤„ç†ã€å¤æ‚ç»„ä»¶ç­‰æƒ…å†µå®¹æ˜“å´©æºƒï¼›</li>
<li><strong>ç»´æŠ¤å›°éš¾</strong>ï¼šä»£ç ä¸æ˜¯ä¸èƒ½ç”¨ï¼Œä½†åŠå¹´åå›¢é˜Ÿæ²¡äººæ•¢åŠ¨ã€‚</li>
</ul>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<p><strong>Vibe Coding = å³å…´å‘æŒ¥ï¼Œçˆ½åœ¨å½“ä¸‹ï¼Œç—›åœ¨ç»´æŠ¤ã€‚</strong></p>
<p>é€‚åˆ Demoã€ä¸ä¸¥è°¨çš„ä¸šåŠ¡è¯„å®¡ã€åŸå‹éªŒè¯ã€‚<strong>ä½†æ— æ³•æˆä¸ºå·¥ç¨‹ä½“ç³»ï¼Œéš¾ä»¥æ”¯æ’‘ä¼ä¸šå¤§è§„æ¨¡çœŸå®é¡¹ç›®ã€‚</strong></p>
<h3 data-id="heading-3">2ã€Spec Codingï¼šè®© AI æŒ‰â€œè§„æ ¼â€å·¥ä½œï¼Œè€Œä¸æ˜¯é æ„Ÿè§‰</h3>
<p>2025 å¹´ä¸‹åŠå¹´äºšé©¬é€Šã€OpenAIç­‰å¤´éƒ¨å¤§å‚ç›¸ç»§æå‡º Spec Coding ç›¸å…³ç†å¿µï¼Œå³â€œè§„æ ¼é©±åŠ¨å¼€å‘â€ï¼Œé€æ¸è¢«ç¤¾åŒºå’Œå¹³å°é‡‡çº³ ã€‚Spec çš„æœ¬è´¨æ˜¯ï¼š<strong>æŒ‡ä»¤ä¸æ˜¯â€œæ„Ÿè§‰å¼â€ï¼Œè€Œæ˜¯â€œç»“æ„åŒ–ã€å¯è§£æã€é›¶æ­§ä¹‰â€ã€‚</strong></p>
<p>ä¸¾ä¾‹ï¼š</p>
<blockquote>
<p><em>â€œç”Ÿæˆä¸€ä¸ªæ ‡å‡†çš„ç”¨æˆ·ç®¡ç†é¡µ</em></p>
<p><em>æ•°æ®æ¥å£ï¼š/user/listï¼ˆGETï¼‰</em></p>
<p><em>åŒ…å«æœç´¢ï¼šnameï¼ˆè¾“å…¥æ¡†ï¼‰ã€statusï¼ˆä¸‹æ‹‰ï¼‰</em></p>
<p><em>åˆ—è¡¨å­—æ®µï¼šnameã€statusã€createTime</em> <em>æ”¯æŒåˆ†é¡µã€æ‰¹é‡åˆ é™¤ã€‚â€</em></p>
</blockquote>
<p>è¿™æ˜¯ AI æœ€æ“…é•¿å¤„ç†çš„è¾“å…¥ï¼š<strong>å›ºå®šæ ¼å¼ã€å¼ºç»“æ„åŒ–ã€æœ‰æ˜ç¡®ä¸Šä¸‹æ–‡ã€‚</strong></p>
<p>å¥½å¤„ä¹Ÿæå…¶æ˜¾è‘—ï¼š</p>
<ul>
<li><strong>å®Œå…¨é¿å…å¹»è§‰</strong>ï¼šæ‰€æœ‰å­—æ®µã€æ¥å£ã€ç»„ä»¶éƒ½ä»è§„èŒƒè§£æï¼›</li>
<li><strong>ä»£ç è´¨é‡ç¨³å®šå¦‚åŒèµ„æ·±å·¥ç¨‹å¸ˆ</strong>ï¼šç»“æ„ç»Ÿä¸€ã€æŠ½è±¡ä¸€è‡´ã€å¯ç»´æŠ¤ï¼›</li>
<li><strong>è·¨é¡¹ç›®å¤§è§„æ¨¡å¤ç”¨</strong>ï¼šè§„èŒƒä½“ç³» + Agentèƒ½åŠ› = è‡ªåŠ¨ç”Ÿæˆèƒ½åŠ›ï¼›</li>
<li><strong>è¶Šåšè¶Šå¼º</strong>ï¼šè§„èŒƒä½“ç³»çš„ç§¯ç´¯ä¸å®Œå–„ä¼šæŒç»­å¢å¼ºç¼–ç¨‹èƒ½åŠ›ã€‚</li>
</ul>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<p><strong>Spec Coding = é¢å‘å·¥ç¨‹ä½“ç³»çš„ AI ç”Ÿäº§æ–¹å¼ã€‚</strong></p>
<p>å®ƒå…³æ³¨çš„ä¸æ˜¯â€œä¸€æ¬¡å†™å¾—æœ‰å¤šå¿«â€ï¼Œè€Œæ˜¯<strong>é•¿æœŸæ˜¯å¦ç¨³å®šã€æ˜¯å¦å¯æ§ã€æ˜¯å¦èƒ½è§„æ¨¡åŒ–è½åœ°</strong>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdd28f8e16f44979ae550f90a926d5b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuq55CD5bel56iL5biI5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400734&amp;x-signature=rQHLxWhvfZj0Vq%2ByIz9IlqKIDII%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">å°ç»“ï¼šç¨‹åºå‘˜ä¸æ˜¯è¢«æ›¿ä»£ï¼Œè€Œæ˜¯å®Œæˆäº†ä¸€æ¬¡è§’è‰²å‡çº§</h3>
<p>åœ¨ AI æ—¶ä»£ï¼Œæ›´æœ‰ä»·å€¼çš„èƒ½åŠ›ï¼Œä¸å†åªæ˜¯â€œæŠŠä»£ç å†™å‡ºæ¥â€ï¼Œè€Œæ˜¯â€œç²¾å‡†è¡¨è¾¾æ„å›¾çš„æ²Ÿé€šâ€ã€‚å°†ç›®æ ‡ã€çº¦æŸä¸æˆåŠŸæ ‡å‡†ç­‰å†…å®¹ä¸¥å¯†é€šè¿‡è§„èŒƒç»“æ„åŒ–çš„è¡¨è¾¾å†™è¿›è§„èŒƒï¼Œä»£ç åªæ˜¯æ²Ÿé€šä¸å†³ç­–åçš„ä¸€ç§ä¸‹æ¸¸äº§ç‰©ã€‚ç¨‹åºå‘˜çš„ä»·å€¼ç”±å†™ä»£ç è½¬ä¸ºå†™è§„èŒƒï¼Œ<strong>å³ç¨‹åºå‘˜è´Ÿè´£æˆ˜ç•¥ï¼ˆå®šä¹‰åšä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆï¼‰ï¼ŒAIè´Ÿè´£æˆ˜æœ¯ï¼ˆç²¾ç¡®åœ°å®ç°å¦‚ä½•åšï¼‰ã€‚</strong></p>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸­åå°ç³»ç»Ÿé€‰æ‹© Spec Codingï¼Œè€Œä¸æ˜¯ Vibe Codingã€‚é‚£æˆ‘ä»¬æ˜¯å¦‚ä½•åœ¨ä¸­åå°ä½“ç³»è½åœ°çš„å‘¢ï¼Ÿ</p>
<h2 data-id="heading-5">äºŒã€AI Coding çš„ç°å®æŒ‘æˆ˜ä¸ä¸­åå°ç³»ç»Ÿçš„å¥‘åˆç‚¹</h2>
<p>åœ¨ç»å†äº†ä»ä»£ç è¡¥å…¨åˆ°æ™ºèƒ½ç”Ÿæˆçš„å¿«é€Ÿæ¼”è¿›åï¼ŒAI Coding çš„èƒ½åŠ›å·²ç»è¿›å…¥â€œå¯ç”¨ä½†ä¸ç¨³å®šâ€çš„é˜¶æ®µã€‚å®ƒèƒ½ç†è§£è‡ªç„¶è¯­è¨€ç”Ÿæˆç»“æ„åŒ–ä»£ç ï¼Œæ˜¾è‘—æå‡ç ”å‘æ•ˆç‡ï¼Œå´ä¹Ÿåœ¨å·¥ç¨‹è½åœ°ä¸­æš´éœ²å‡ºä¸€ç³»åˆ—é—®é¢˜ï¼š</p>
<ul>
<li>
<p><strong>ç†è§£åå·®ä¸å¹»è§‰é—®é¢˜</strong>ï¼šæ¨¡å‹å¯èƒ½å‡­ç©ºç”Ÿæˆä¸å­˜åœ¨çš„å‡½æ•°æˆ–æ¥å£ï¼Œæˆ–å› éœ€æ±‚æè¿°æ¨¡ç³Šè€Œè¯¯è§£é€»è¾‘ï¼Œå¯¼è‡´è¾“å‡ºç»“æœçœ‹ä¼¼æ­£ç¡®å´æ— æ³•è¿è¡Œï¼›</p>
</li>
<li>
<p><strong>ä»£ç è´¨é‡ä¸è§„èŒƒä¸ç»Ÿä¸€</strong>ï¼šç”Ÿæˆä»£ç æ˜“å‡ºç°å†—ä½™è†¨èƒ€ã€é£æ ¼ä¸ç»Ÿä¸€ã€ç¼ºä¹æŠ½è±¡ä¸å¤ç”¨ï¼ŒçŸ­æœŸå¯ç”¨ï¼Œé•¿æœŸç»´æŠ¤æˆæœ¬é«˜ï¼›</p>
</li>
<li>
<p><strong>å¤æ‚åœºæ™¯éš¾æŠŠæ¡</strong>ï¼šåœ¨å¤æ‚åœºæ™¯ä¸‹å®¹æ˜“å‡ºç°é€»è¾‘ä¸ä¸€è‡´ã€ä¸Šä¸‹æ–‡ç†è§£ä¸å®Œæ•´ã€ä»£ç ç»“æ„æ··ä¹±ç­‰é—®é¢˜ï¼Œéš¾ä»¥ç¨³å®šç”Ÿæˆå¯ç›´æ¥è½åœ°çš„å·¥ç¨‹çº§æ–¹æ¡ˆã€‚</p>
</li>
</ul>
<p>å¯ä»¥è¯´ï¼Œ<strong>å½“å‰çš„ AI Coding å¤„ç†â€œæ¨¡æ¿åŒ–â€çš„åœºæ™¯æ›´ç²¾å‡†</strong>ï¼Œè€Œåœ¨æ¶‰åŠå¤æ‚ä¸šåŠ¡é€»è¾‘æ—¶é—®é¢˜ä¼šæ˜¾è‘—å¢å¤šã€‚å½“ä»»åŠ¡æè¿°æ¸…æ™°ã€ç»“æ„æ˜ç¡®æ—¶ï¼ŒAI èƒ½é«˜æ•ˆç”Ÿæˆé«˜è´¨é‡ä»£ç ï¼›ä½†é¢å¯¹æŠ½è±¡ã€ä¾èµ–ä¸Šä¸‹æ–‡ç†è§£çš„ä¸šåŠ¡éœ€æ±‚æ—¶ï¼Œå¾€å¾€å®¹æ˜“å‡ºç°åå·®æˆ–ç†è§£é”™è¯¯ã€‚</p>
<p>ä¸­åå°ç³»ç»Ÿç›¸å¯¹äºCç«¯éœ€æ±‚è€Œè¨€ï¼Œæœ‰ç€æ›´å¼ºçš„â€œè§„å¾‹æ€§â€å’Œâ€œç»“æ„åŒ–â€ç‰¹å¾ï¼Œè¿™ä¸ AI Coding åœ¨è§„åˆ™æ˜ç¡®ã€ç»“æ„æ¸…æ™°åœºæ™¯ä¸­çš„ä¼˜åŠ¿é«˜åº¦å¥‘åˆã€‚ä¸­åå°åœºæ™¯å…·å¤‡ä»¥ä¸‹å¤©ç„¶ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>ç»“æ„åŒ–ä¸”è§„èŒƒåŒ–</strong>ï¼šä¸­åå°é¡µé¢ä»¥è¡¨æ ¼ã€è¡¨å•ã€æœç´¢ç­‰æ¨¡å—ä¸ºä¸»ï¼ŒåŠŸèƒ½æ¨¡å¼å›ºå®šã€ç»„ä»¶ä½“ç³»è§„èŒƒä¸”å®Œå–„ã€‚èƒ½æœ‰æ•ˆçº¦æŸç”Ÿæˆç»“æœï¼Œé™ä½â€œå¹»è§‰â€é£é™©ï¼›</li>
<li><strong>è§„æ¨¡å¤§ä¸”å¯æ§</strong>ï¼šä¸­åå°ä¸šåŠ¡é¡µé¢æ•°é‡å¤šã€ç›¸ä¼¼åº¦é«˜ï¼Œé…åˆç»Ÿä¸€æ¨¡æ¿å’Œè§„èŒƒä½“ç³»ï¼ŒAI èƒ½åœ¨æ­¤ç±»åœºæ™¯ä¸­å®ç°é«˜æ•ˆã€æ‰¹é‡çš„ä»£ç ç”Ÿæˆä¸ç»´æŠ¤ï¼ŒåŠ é€Ÿéœ€æ±‚äº¤ä»˜çš„å…¨æµç¨‹ã€‚</li>
</ul>
<p>å°ç»“ï¼š<strong>ä¸­åå°å¼€å‘åœºæ™¯å…¼å…·â€œé«˜é‡å¤æ€§â€ä¸â€œå¼ºè§„èŒƒæ€§â€</strong> ï¼Œéå¸¸é€‚åˆé€šè¿‡ Spec Coding å®ç° AI Coding çš„ç¬¬ä¸€è½åœ°åœºæ™¯ã€‚å®ƒè®©å›¢é˜Ÿåœ¨ç¡®ä¿å¯ç»´æŠ¤æ€§çš„åŒæ—¶ï¼Œå¿«é€Ÿç§¯ç´¯é«˜è´¨é‡çš„ AI ç”Ÿæˆæ ·æœ¬ï¼Œå¹¶é€æ­¥å‘æ›´å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å»¶ä¼¸ã€‚</p>
<h2 data-id="heading-6">ä¸‰ã€ä»æŒ‡ä»¤åˆ°äº¤ä»˜ï¼šç¨‹åºå‘˜ä¸AIæ˜¯å¦‚ä½•æ²Ÿé€šçš„ï¼Ÿ</h2>
<p>è¦è®©äººä¸ AI ä¹‹é—´å®ç°çœŸæ­£é«˜æ•ˆçš„æ²Ÿé€šï¼Œæˆ‘ä»¬æ²¡æœ‰è®¾è®¡å¤æ‚çš„æŒ‡ä»¤ï¼Œè€Œæ˜¯æç®€çš„ä¸€å¥è¯</p>
<blockquote>
<p><em>â€œå¸®æˆ‘æ ¹æ® [éœ€æ±‚æ–‡æ¡£åœ°å€] ç”Ÿæˆé¡µé¢ï¼Œå¹¶å¯¹æ¥[å…·ä½“ç¯å¢ƒ]çš„ä¸­å¤®æƒé™ç³»ç»Ÿâ€</em></p>
</blockquote>
<p>å³å¯è§¦å‘å®Œæ•´å·¥ä½œæµã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æ‰“é€ äº†ä¸‰å¤§ Spec åˆ©å™¨ï¼Œå¹¶ä»¥ Cursor ä½œä¸ºæ‰¿è½½è¿™ä¸€åˆ‡çš„å·¥ä½œå°ï¼ŒæŠŠéœ€æ±‚å†…å®¹ã€æ¥å£ä¿¡æ¯ã€ä»£ç è§„èŒƒç­‰å…¨éƒ¨ç»“æ„åŒ–ï¼Œè®© AI èƒ½åœ¨ä¸€è½®æ²Ÿé€šä¸­å°±â€œå¬æ‡‚â€è¦åšä»€ä¹ˆï¼Œä»è€Œç¨³å®šäº§å‡ºå¯é çš„å·¥ç¨‹çº§ç»“æœã€‚</p>
<p><strong>Cursor ç¼–è¾‘å™¨</strong>ï¼šåœ¨ Cursor ä¸­ï¼Œæˆ‘ä»¬ç”¨ä¸€å¥è‡ªç„¶è¯­è¨€æŒ‡ä»¤å³å¯è§¦å‘å®Œæ•´å·¥ä½œæµï¼šè¯»å–éœ€æ±‚æ–‡æ¡£ã€è°ƒç”¨ MCP è·å–æ¥å£è¯­ä¹‰ã€å‚è€ƒUIè§„èŒƒå¹¶éµå¾ª rulesï¼Œç”Ÿæˆç¬¦åˆå·¥ç¨‹æ ‡å‡†çš„é¡µé¢ä»£ç ï¼Œå¹¶æœ€ç»ˆå¯¹æ¥ä¸­å¤®æƒé™ç³»ç»Ÿè¿›è¡Œæƒé™ç®¡ç†ã€‚Cursor å°†åˆ†æ•£çš„èƒ½åŠ›æ•´åˆä¸ºä¸€ä¸ªè¿ç»­çš„å¼€å‘ä½“éªŒï¼Œè®©â€œéœ€æ±‚â†’ä»£ç â†’è°ƒè¯•â€å½¢æˆé—­ç¯ï¼Œä½¿å¼€å‘è€…ä»ç¼–å†™ä»£ç è½¬å‘æŒ‡å¯¼ AI ç”Ÿäº§ä»£ç ã€‚</p>
<p><strong>ä¸‰å¤§ Spec åˆ©å™¨ï¼šUI è§„èŒƒç¡®ä¿é¡µé¢å±•ç¤ºä¸äº¤äº’ç»Ÿä¸€ï¼ŒMCP è¡¥å……é¡¹ç›®è¯­ä¹‰ä¸Šä¸‹æ–‡ï¼ŒRules ä½“ç³»ä¿éšœç”Ÿæˆè´¨é‡ã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e67585e64f24fb8a346304a53f09980~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuq55CD5bel56iL5biI5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400734&amp;x-signature=h6gJV45eZNs8IDE3%2BJb0RE5HS28%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">åˆ©å™¨ä¸€ï¼šUI è§„èŒƒä¸º AI ç¼–ç æ ‡å‡†åŒ–æä¾›åŸºç¡€</h3>
<p>ä¸­åå°ç³»ç»Ÿçš„ç•Œé¢è™½ç„¶ä»¥ä¸šåŠ¡ä¸ºä¸»ï¼Œä½†ä¸ºäº†ä¿è¯ç¾è§‚ä¸ä¸€è‡´çš„äº¤äº’ä½“éªŒï¼Œæˆ‘ä»¬åœ¨åˆæœŸå°±å»ºç«‹äº†ç³»ç»ŸåŒ–çš„ <strong>UI è§„èŒƒ</strong>ï¼Œå¹¶æ•´ç†æˆ UI Specï¼Œä¸ºåç»­çš„ AI Coding æä¾›äº†å¯å¤ç”¨ã€å¯ç”Ÿæˆçš„åŸºç¡€ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a00c1631562431492d4b135ff79a0ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuq55CD5bel56iL5biI5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400734&amp;x-signature=9c7ktSvk51EG6UXjmPIZfpzOFzs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7e4ae239bb04aa1ab8fad132d3a543e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuq55CD5bel56iL5biI5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400734&amp;x-signature=OWEBUne9tnaL%2B%2B0rbNH%2FV2QJCeI%3D" alt="" loading="lazy"/></p>
<p>è¿™å¥—è§„èŒƒä¸»è¦åŒ…å«ä¸¤å¤§æ–¹é¢ï¼š</p>
<ul>
<li><strong>è§†è§‰ä¸äº¤äº’æ ‡å‡†</strong>ï¼šç»Ÿä¸€ä¸»é¢˜ã€å­—ä½“ã€é—´è·ã€é¡µé¢æ¨¡å—å¸ƒå±€ã€æ“ä½œäº¤äº’ç­‰è§„åˆ™ï¼Œä½¿æ•´ä¸ªé¡¹ç›®ä¿æŒä¸€è‡´çš„è§‚æ„Ÿä¸æ“ä½œä½“éªŒï¼›</li>
<li><strong>ç»„ä»¶åŒ–ä½“ç³»</strong>ï¼šå¸¸ç”¨æ¨¡å—ï¼ˆæœç´¢æ¡†ã€åˆ—è¡¨ã€å¼¹çª—è¡¨å•ç­‰ï¼‰å‡æ¥è‡ªå…¬å…±ç»„ä»¶åº“ï¼ŒAI åœ¨ç”Ÿæˆé¡µé¢æ—¶å¯ä»¥ç›´æ¥å¤ç”¨ç°æœ‰æ ‡å‡†ç»„ä»¶è€Œéé‡æ–°é€ è½®å­ã€‚</li>
</ul>
<p>åŸºäºè¿™å¥—ä½“ç³»ï¼ŒAI Coding ä¸å†æ˜¯â€œéšæ„ç»˜åˆ¶ç•Œé¢â€ï¼Œè€Œæ˜¯åœ¨çº¦æŸä¸‹ç”Ÿæˆæ ‡å‡†åŒ–çš„ UIã€‚è¿™æ—¢èƒ½ä¿è¯æ‰€æœ‰ç•Œé¢çš„ä¸€è‡´æ€§ï¼Œä¹Ÿä¸ºè‡ªåŠ¨åŒ–å¼€å‘æä¾›åšå®åŸºç¡€ã€‚</p>
<h3 data-id="heading-8">åˆ©å™¨äºŒï¼šMCP æ˜¯ AI ç¼–ç çš„â€œä¿¡æ¯ä¸­æ¢â€</h3>
<p>MCPï¼ˆModel Context Protocolï¼‰èƒ½è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿå’Œæ•°æ®ï¼Œè®©æ¨¡å‹çœŸæ­£<strong>ç†è§£é¡¹ç›®è¯­å¢ƒ</strong>ï¼Œå…·å¤‡â€œçœ‹å¾—è§ã€å¬å¾—æ‡‚ã€åšå¾—å‡†â€çš„èƒ½åŠ›ï¼Œæ˜¯ AI ç¼–ç ä¸­é‡è¦çš„â€œä¿¡æ¯ä¸­æ¢â€ã€‚æˆ‘ä»¬æ ¸å¿ƒ MCP åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªï¼š</p>
<h4 data-id="heading-9">1. YApi MCP</h4>
<p>YApi æ˜¯ä¸€ä¸ªæ¥å£ç®¡ç†ä¸æ–‡æ¡£å¹³å°ï¼Œå‰åç«¯ç­‰è§’è‰²å¯åœ¨åŒä¸€å¹³å°æŸ¥çœ‹å¹¶å¯¹æ¥æ¥å£ï¼Œé¿å…æ²Ÿé€šæ··ä¹±ä¸ä¿¡æ¯ä¸ä¸€è‡´ç­‰é—®é¢˜ã€‚å¾—ç›Šäºåç«¯å›¢é˜Ÿé•¿æœŸã€è§„èŒƒåœ°ç»´æŠ¤ YApi æ–‡æ¡£ï¼Œæ¥å£ä¿¡æ¯å§‹ç»ˆä¿æŒå‡†ç¡®ã€å®Œæ•´ã€‚</p>
<p>åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒYApi MCP è‡ªåŠ¨è·å–æ¥å£çš„è¯·æ±‚åœ°å€ã€å‚æ•°ã€å“åº”å­—æ®µç­‰å†…å®¹ï¼Œä¸ºæ¨¡å‹æä¾›æƒå¨ã€æœ€æ–°çš„ Api Specï¼Œä»æºå¤´ä¸Šé¿å…å¤§æ¨¡å‹å‡­çŒœæµ‹ç”Ÿæˆæ¥å£ä¿¡æ¯ã€‚</p>
<h4 data-id="heading-10">2. Auth-center MCP</h4>
<p>ä¸­å¤®æƒé™ç³»ç»Ÿæ˜¯å…¬å¸å†…éƒ¨æ‰€æœ‰ä¸­åå°ç³»ç»Ÿç»Ÿä¸€ç®¡ç†æƒé™çš„å¹³å°ã€‚</p>
<p>Auth-center MCP é€šè¿‡æ¥å£è°ƒç”¨çš„æ–¹å¼å¿«é€Ÿæ¥å…¥æƒé™ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ¥å£è‡ªåŠ¨å®šçº§ã€èµ„æºè‡ªåŠ¨æ–°å¢ã€é¡µé¢æ¥å£ç»‘å®šç­‰æƒé™ç®¡ç†å…¨æµç¨‹é…ç½®ï¼Œæ—¢èƒ½æé«˜æ¥å…¥æ•ˆç‡ï¼Œæ›´èƒ½é¿å…äººå·¥æ“ä½œå¤±è¯¯ã€‚</p>
<p>åŸºæœ¬çš„ MCP é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"auth-center-mcp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"auth-center-mcp"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"--username=***"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"--password=***"</span>
          <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"yapi-mcp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"yapi-mcp"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"--yapiHost=***"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"--username=***"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"--password=***"</span>
          <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>

</code></pre>
<p>é€šè¿‡ MCP çš„æ¥å…¥ï¼Œæ¨¡å‹åƒæ˜¯è£…ä¸Šäº†â€œåƒé‡Œçœ¼â€ï¼Œä¸å†æ˜¯ä¸€ä¸ªâ€œé—­é—¨é€ è½¦â€çš„åŠ©æ‰‹ï¼Œè€Œæ˜¯èƒ½çœŸæ­£è¯»æ‡‚ä¸Šä¸‹æ–‡çš„å›¢é˜Ÿæˆå‘˜ã€‚</p>
<h3 data-id="heading-11">åˆ©å™¨ä¸‰ï¼šRules è®©ç”Ÿæˆä»£ç å…·å¤‡â€œä¸“ä¸šçº§æ°´å‡†â€</h3>
<p>å¤§æ¨¡å‹è™½ç„¶å¼ºå¤§ï¼Œä½†å®ƒå®¹æ˜“å¹»è§‰ç”Ÿæˆå†—ä½™ä¸”ä¸æ˜“ç»´æŠ¤çš„ä»£ç ï¼Œä¸ºäº†æ§åˆ¶å®ƒçš„è¾“å‡ºè´¨é‡ï¼Œæˆ‘ä»¬åˆ¶å®šäº†ä¸€ç³»åˆ— Spec å¹¶æ²‰æ·€åˆ° cursorçš„ rules æ–‡ä»¶ä¸­ï¼Œåœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­æä¾›æŒä¹…çš„ã€å¯å¤ç”¨çš„ä¸Šä¸‹æ–‡ï¼Œè¿™äº› Spec æ—¢æ˜¯å·¥ç¨‹çš„åº•çº¿ï¼Œä¹Ÿæ˜¯ AI çš„çŸ¥è¯†åº“ã€‚</p>
<p>åœ¨ä¼—å¤šrulesæ–‡ä»¶ä¸­ï¼Œæœ‰6ä¸ªå¯¹ç”Ÿæˆçš„ä»£ç è´¨é‡è‡³å…³é‡è¦ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"> ---
<span class="hljs-code">    description:
    globs:
    alwaysApply: true
    ---
</span>
<span class="hljs-code">    ## æ–‡ä»¶ç»„ç»‡
</span>
<span class="hljs-code">    é¡¹ç›®å¼€å‘è§„èŒƒå·²æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†åˆ° `./rules/` ç›®å½•ä¸­ï¼š
</span>
<span class="hljs-bullet">    -</span> <span class="hljs-code">`project-overview.mdc`</span> - é¡¹ç›®æ¦‚è¿°å’Œæ ¸å¿ƒå¼€å‘åŸåˆ™
<span class="hljs-bullet">    -</span> <span class="hljs-code">`requirements-reading.mdc`</span> - è¯»å–éœ€æ±‚æ–‡æ¡£çš„è§„èŒƒ
<span class="hljs-bullet">    -</span> <span class="hljs-code">`api-development.mdc`</span> - æ¥å£è°ƒç”¨è§„èŒƒå’Œæ•°æ®æ ¼å¼å¤„ç†è§„èŒƒ
<span class="hljs-bullet">    -</span> <span class="hljs-code">`component-usage.mdc`</span> - å…¬å…±ç»„ä»¶ä½¿ç”¨è§„èŒƒ
<span class="hljs-bullet">    -</span> <span class="hljs-code">`forbidden-practices.mdc`</span> - ç¦æ­¢äº‹é¡¹å’Œå¸¸è§é”™è¯¯é¢„é˜²
<span class="hljs-bullet">    -</span> <span class="hljs-code">`auth-center.mdc`</span> - æ¥å…¥ä¸­å¤®æƒé™è§„èŒƒ
<span class="hljs-code">    ... å…¶ä»–rulesæ–‡ä»¶
</span></code></pre>
<ul>
<li>
<p><code>project-overview.mdc</code>ï¼šå®šä¹‰é¡¹ç›®çš„æ ¸å¿ƒå¼€å‘åŸåˆ™ä¸å·¥ç¨‹çº¦æŸï¼Œæä¾›æ ‡å‡†CRUDçš„æœ€ä½³å®è·µï¼Œæ˜¯æ‰€æœ‰ç”Ÿæˆä»»åŠ¡çš„æ€»çº²ï¼›</p>
</li>
<li>
<p><code>requirements-reading.mdc</code>ï¼šæŒ‡å¯¼å¤§æ¨¡å‹ä»éœ€æ±‚æ–‡æ¡£ä¸­ï¼Œç²¾å‡†è¯»å–é¡µé¢ç›¸å…³éœ€æ±‚å†…å®¹ï¼›</p>
</li>
<li>
<p><code>api-development.mdc</code>ï¼šè§„èŒƒæ¥å£è¯·æ±‚æ–¹å¼ï¼Œç¡®ä¿æ¥å£è°ƒç”¨åŠæ•°æ®å¤„ç†ç›¸å…³ä»£ç ç¬¦åˆå›¢é˜Ÿçº¦å®šï¼›</p>
</li>
<li>
<p><code>component-usage.mdc</code>ï¼šæŒ‡å¯¼å¤§æ¨¡å‹éµå¾ªè®¾è®¡è§„èŒƒï¼Œå¹¶æ­£ç¡®ä½¿ç”¨å…¬å…±ç»„ä»¶ï¼Œåœ¨é¿å…é‡å¤é€ è½®å­çš„åŒæ—¶ï¼Œè¿˜èƒ½åœ¨ç”Ÿæˆé˜¶æ®µå¯¹é½UIè§„èŒƒï¼›</p>
</li>
<li>
<p><code>auth-center.mdc</code>ï¼šæç¤ºå¤§æ¨¡å‹æ ¹æ®ä»£ç æ‰¾å‡ºé¡µé¢æ‰€æœ‰æ“ä½œæŒ‰é’®åŠå¯¹åº”æ¥å£ï¼Œç»„è£…æˆç‰¹å®šschemaæ•°æ®ï¼Œå¹¶è°ƒç”¨å¯¹åº”mcpï¼Œç¡®ä¿æƒé™æŒ‰éœ€æ¥å…¥ä¸­å¤®æƒé™ç³»ç»Ÿï¼›</p>
</li>
<li>
<p><code>forbidden-practices.mdc</code>ï¼šåˆ—å‡ºç¦æ­¢å†™æ³•ä¸å¸¸è§é”™è¯¯ï¼Œæ¯”å¦‚ç›´æ¥æ“ä½œ DOMã€è·³è¿‡ YApi æ–‡æ¡£ç›´æ¥å¼€å‘ç­‰ã€‚</p>
</li>
</ul>
<p>AI ç”Ÿæˆçš„ä»£ç ä¼šè‡ªåŠ¨å¯¹ç…§è¿™äº› rules è¿›è¡Œæ ¡éªŒï¼Œä¸ç¬¦åˆè§„èŒƒçš„éƒ¨åˆ†ä¼šè§¦å‘äºŒæ¬¡ä¿®æ­£ï¼Œæœ€ç»ˆè®© AI çš„è¾“å‡ºæ›´æ¥è¿‘èµ„æ·±å¼€å‘è€…çš„ä¸“ä¸šçº§æ°´å‡†ã€‚</p>
<h2 data-id="heading-12">å››ã€åç»­å±•æœ›ï¼šæˆ‘ä»¬è¿˜æƒ³åšæ›´å¤š</h2>
<p>ç›®å‰åªæ˜¯ AI Coding çš„ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬è¿˜å°†åŸºäº<strong>è§„èŒƒé©±åŠ¨å¼€å‘</strong>ç»§ç»­æ¢ç´¢ä»¥ä¸‹æ–¹å‘ï¼š</p>
<ul>
<li><strong>æ‰©å¤§è¦†ç›–é¢</strong>ï¼šç›®å‰ä¸»è¦æ”¯æŒéƒ¨åˆ†ä¸­åå°é¡¹ç›®çš„å¸¸è§„é¡µé¢ï¼Œåç»­ä¼šé€æ­¥æå‡ä¸­åå°é¡¹ç›®ä½¿ç”¨å æ¯”ï¼›åŒæ—¶æ‰©å±•åˆ°æ”¯æŒå¤æ‚äº¤äº’é¡µé¢ï¼›æ›´è¿›ä¸€æ­¥ï¼Œåšåˆ°èµ°å‡ºä¸­åå°é¡¹ç›®ï¼Œæ”¯æŒè¦æ±‚æ›´ä¸¥æ ¼ã€å½¢å¼æ›´å¤šå˜çš„Cç«¯ç³»ç»Ÿï¼›</li>
<li><strong>æ›´ç»†ç²’åº¦çš„å›æº¯ä¸ä¼˜åŒ–</strong>ï¼šè®© AI è¾“å‡ºè¿‡ç¨‹å…·å¤‡â€œå¯å›æ”¾â€ã€â€œå¯è§£é‡Šâ€ã€â€œå¯ä¼˜åŒ–â€çš„èƒ½åŠ›ï¼›</li>
<li><strong>å…¨æµç¨‹æ™ºèƒ½åŒ–ï¼š</strong> ä»ä¸Šæ¸¸æå‡ºä¸šåŠ¡éœ€æ±‚ï¼ˆæƒ³æ³•ï¼‰ï¼Œæ™ºèƒ½ç”Ÿæˆéœ€æ±‚æ–‡æ¡£ï¼Œå†åˆ°è‡ªåŠ¨ codingã€æµ‹è¯•ï¼Œæœ€åå®Œæˆè‡ªåŠ¨æäº¤å’Œéƒ¨ç½²ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pyroscope Java æ¥å…¥æœ€ä½³å®è·µ]]></title>    <link>https://juejin.cn/post/7583799807594086434</link>    <guid>https://juejin.cn/post/7583799807594086434</guid>    <pubDate>2025-12-15T10:54:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583799807594086434" data-draft-id="7583903159774085135" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pyroscope Java æ¥å…¥æœ€ä½³å®è·µ"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-15T10:54:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pyroscope Java æ¥å…¥æœ€ä½³å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:54:22.000Z" title="Mon Dec 15 2025 10:54:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Pyroscope</h2>
<p>Pyroscope æ˜¯ Grafana å¼€æºçš„æŒç»­æ€§èƒ½åˆ†æå¹³å°ï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·ä»åº”ç”¨ç¨‹åºä¸­è·å–æ€§èƒ½æ´å¯Ÿï¼Œä»¥ä¼˜åŒ–èµ„æºä½¿ç”¨ï¼Œå¦‚ CPUã€å†…å­˜å’Œ I/O æ“ä½œã€‚å°† Pyroscope æ•°æ®ä¸ŠæŠ¥åˆ°è§‚æµ‹äº‘ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå…¨é¢äº†è§£åº”ç”¨ç¨‹åºçš„è¡Œä¸ºï¼Œå¹¶èƒ½å¤Ÿæ·±å…¥åˆ°ç‰¹å®šæœåŠ¡ä¸­è¿›è¡Œæ›´ç²¾ç¡®çš„æ ¹æºåˆ†æã€‚Pyroscope ä¸º OpenTelemetry è¡¥å…¨äº† Profiling èƒ½åŠ›ï¼ŒåŒæ—¶ï¼Œå¯ä»¥å®ç° Profiling ä¸ Tracing çš„å…³è”ã€‚</p>
<h3 data-id="heading-1">æ ¸å¿ƒåŠŸèƒ½</h3>
<ul>
<li>æŒç»­æ€§èƒ½åˆ†æï¼šé€šè¿‡æŒç»­åˆ†æåº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œå¸®åŠ©å›¢é˜Ÿå¿«é€Ÿè¯†åˆ«æ€§èƒ½ç“¶é¢ˆå¹¶ä¼˜åŒ–åº”ç”¨ç¨‹åºã€‚</li>
<li>ä½å¼€é”€å’Œé«˜æ•ˆå‹ç¼©ï¼šç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œæ€§èƒ½åˆ†ææ—¶å¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½å½±å“æœ€å°ã€‚</li>
<li>å¤šè¯­è¨€æ”¯æŒï¼šå®¢æˆ·ç«¯ SDK æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ Goã€Javaã€Pythonã€Rubyã€PHP å’Œ .NETã€‚</li>
<li>çµæ´»çš„éƒ¨ç½²æ–¹å¼ï¼šæ”¯æŒåœ¨å¤šç§ç¯å¢ƒä¸­éƒ¨ç½²ï¼ŒåŒ…æ‹¬ Kubernetes ç­‰ã€‚</li>
</ul>
<h3 data-id="heading-2">ä½¿ç”¨åœºæ™¯</h3>
<ul>
<li>ä¸»åŠ¨ä¼˜åŒ–ï¼šé€šè¿‡æŒç»­ç›‘æ§å‡å°‘èµ„æºæ¶ˆè€—ï¼Œæé«˜åº”ç”¨ç¨‹åºæ€§èƒ½ï¼Œé¢„é˜²å»¶è¿Ÿé—®é¢˜ã€‚</li>
<li>å¿«é€Ÿå“åº”ï¼šåœ¨å‘ç”Ÿæ€§èƒ½é—®é¢˜æ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿå®šä½å¹¶è§£å†³ï¼Œä¾‹å¦‚è°ƒè¯• CPUã€å†…å­˜æˆ– I/O ç“¶é¢ˆã€‚</li>
</ul>
<h3 data-id="heading-3">æ”¯æŒç±»å‹</h3>
<p>Pyroscope æ”¯æŒé‡‡é›†ä»¥ä¸‹æ•°æ®ç±»å‹ï¼š</p>
<ul>
<li>CPU ä½¿ç”¨æƒ…å†µ</li>
<li>å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
<li>I/O æ“ä½œ</li>
<li>è°ƒç”¨æ ˆï¼ˆCall Stacksï¼‰</li>
<li>åˆ†é…çš„å†…å­˜ï¼ˆHeap &amp; Allocationï¼‰</li>
<li>åç¨‹æˆ–çº¿ç¨‹çš„ä½¿ç”¨æƒ…å†µ</li>
<li>å‡½æ•°çº§æ€§èƒ½æ•°æ®</li>
</ul>
<h2 data-id="heading-4">æ¥å…¥è§‚æµ‹äº‘</h2>
<h3 data-id="heading-5">å®ç°è¯´æ˜</h3>
<p>OpenTelemtry é“¾è·¯ä¸ pyroscope profiling æ•°æ®å…³è”å®ç°åŸç†ï¼Œä¸»è¦æ˜¯é€šè¿‡ç»™ profiling å’Œ tracing æ³¨å…¥ runtime_id æ ‡ç­¾ã€‚</p>
<h3 data-id="heading-6">ä¸»æœºéƒ¨ç½²</h3>
<ul>
<li>å¼€å¯ opentelemetry åŠ pyroscope é‡‡é›†å™¨</li>
</ul>
<p>è¿›å…¥ DataKit å®‰è£…ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¼€å¯opentelemetry  </span>
<span class="hljs-built_in">cd</span> /usr/local/datakit/conf.d/
<span class="hljs-built_in">cp</span> samples/opentelemetry.conf.sample opentelemetry.conf

<span class="hljs-comment"># å¼€å¯pyroscope </span>
<span class="hljs-built_in">cd</span> /usr/local/datakit/conf.d/
<span class="hljs-built_in">cp</span> samples/pyroscope.conf.sample  pyroscope.conf
</code></pre>
<ul>
<li>é‡å¯ DataKit</li>
</ul>

<pre><code class="hljs">datakit service -R
</code></pre>
<h3 data-id="heading-7">æ¥å…¥ JAVA åº”ç”¨</h3>
<ul>
<li>pyroscope-java æ˜¯åŸºäº async-profiler çš„å¢å¼ºç‰ˆæœ¬ã€‚</li>
<li>pyroscope-otel æ˜¯åŸºäº pyroscope-java å°è£…çš„ OpenTelemetry ç‰ˆæœ¬ï¼Œæ„åœ¨ä¸ OpenTelemetry APM è¿›è¡Œèåˆã€‚</li>
</ul>
<h4 data-id="heading-8">ä¸‹è½½ä¾èµ–</h4>
<ul>
<li>pyroscope-otel ä¸‹è½½åœ°å€ï¼šÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Frepo1.maven.org%2Fmaven2%2Fio%2Fpyroscope%2Fotel%2F0.11.0%2Fotel-0.11.0.jar%25EF%25BC%258C%25E9%2587%258D%25E5%2591%25BD%25E5%2590%258D%25E4%25B8%25BA" target="_blank" title="https://repo1.maven.org/maven2/io/pyroscope/otel/0.11.0/otel-0.11.0.jar%EF%BC%8C%E9%87%8D%E5%91%BD%E5%90%8D%E4%B8%BA" ref="nofollow noopener noreferrer">repo1.maven.org/maven2/io/pâ€¦</a>Â pyroscope-otel.jar</li>
<li>opentelemetry-java ä¸‹è½½åœ°å€ï¼šÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopen-telemetry%2Fopentelemetry-java-instrumentation%2Freleases" target="_blank" title="https://github.com/open-telemetry/opentelemetry-java-instrumentation/releases" ref="nofollow noopener noreferrer">github.com/open-telemeâ€¦</a></li>
<li>Agent ä»£ç ä»“åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgrafana%2Fotel-profiling-java%2Freleases" target="_blank" title="https://github.com/grafana/otel-profiling-java/releases" ref="nofollow noopener noreferrer">github.com/grafana/oteâ€¦</a></li>
</ul>
<h4 data-id="heading-9">å¯åŠ¨å‚æ•°</h4>
<p>java åº”ç”¨å¯åŠ¨å‘½ä»¤å¦‚ä¸‹ï¼Œä¾›å‚è€ƒã€‚</p>
<p><em>æ³¨æ„ï¼š UUID ä¸ºæ³¨å…¥çš„éšæœºid ï¼Œç”¨äºå…³è”trace ä¸ profile çš„å…³è”id èµ‹å€¼ï¼Œéœ€è¦ç¡®ä¿UUID èƒ½æ­£å¸¸è¢«åº”ç”¨ã€‚</em></p>
<pre><code class="hljs language-ini" lang="ini">Shell
<span class="hljs-attr">UUID</span>=$(uuidgen) \ <span class="hljs-comment"># å®ä¾‹ç»´åº¦çš„uuidï¼Œä¿è¯å®ä¾‹çš„å”¯ä¸€æ€§</span>
<span class="hljs-attr">OTEL_SERVICE_NAME</span>=<span class="hljs-string">"springboot-server"</span> \
<span class="hljs-attr">OTEL_RESOURCE_ATTRIBUTES</span>=<span class="hljs-string">"runtime_id=$UUID,service.name=springboot-server,service.version=1.3.55,service.env=dev"</span> \
<span class="hljs-attr">OTEL_JAVAAGENT_EXTENSIONS</span>=./pyroscope-otel.jar \
<span class="hljs-attr">OTEL_TRACES_EXPORTER</span>=otlp \
<span class="hljs-attr">OTEL_EXPORTER_OTLP_PROTOCOL</span>=<span class="hljs-string">"grpc"</span> \
<span class="hljs-attr">OTEL_EXPORTER_OTLP_ENDPOINT</span>=<span class="hljs-string">"http://datakit-service.datakit:4317"</span> \

<span class="hljs-comment"># PYROSCOPE é…ç½®</span>
<span class="hljs-attr">PYROSCOPE_APPLICATION_NAME</span>=<span class="hljs-string">"springboot-server"</span> \
<span class="hljs-attr">OTEL_PYROSCOPE_START_PROFILING</span>=<span class="hljs-literal">true</span> \
<span class="hljs-attr">PYROSCOPE_FORMAT</span>=<span class="hljs-string">"jfr"</span> \
<span class="hljs-attr">PYROSCOPE_PROFILER_EVENT</span>=<span class="hljs-string">"cpu"</span> \
<span class="hljs-attr">PYROSCOPE_LABELS</span>=<span class="hljs-string">"runtime_id=$UUID,service=springboot-server,version=1.3.55,env=dev"</span> \
<span class="hljs-attr">PYROSCOPE_UPLOAD_INTERVAL</span>=<span class="hljs-string">"10s"</span> \
<span class="hljs-attr">PYROSCOPE_JAVA_STACK_DEPTH_MAX</span>=<span class="hljs-number">512</span> \
<span class="hljs-attr">PYROSCOPE_PROFILING_INTERVAL</span>=<span class="hljs-string">"10ms"</span> \
<span class="hljs-attr">PYROSCOPE_PROFILER_ALLOC</span>=<span class="hljs-number">512</span>k \
<span class="hljs-attr">PYROSCOPE_ALLOC_LIVE</span>=<span class="hljs-literal">true</span> \
<span class="hljs-attr">PYROSCOPE_SERVER_ADDRESS</span>=<span class="hljs-string">"http://datakit-service.datakit:9529"</span> \
java -javaagent:opentelemetry-javaagent.jar -jar springboot-server.jar
</code></pre>
<p>æŒ‰ç…§å®é™…ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„å‚æ•°ï¼š</p>
<ul>
<li>opentelemetry-java ç›¸å…³å‚æ•°å‚è€ƒÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fopentelemetry.io%2Fdocs%2Flanguages%2Fjava%2Fconfiguration%2F%23environment-variables-and-system-properties" target="_blank" title="https://opentelemetry.io/docs/languages/java/configuration/#environment-variables-and-system-properties" ref="nofollow noopener noreferrer">OpenTelemetry å®˜æ–¹æ–‡æ¡£</a>ã€‚</li>
<li>pyroscope ç›¸å…³å‚æ•°å‚è€ƒÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgrafana.com%2Fdocs%2Fpyroscope%2Flatest%2Fconfigure-client%2Flanguage-sdks%2Fjava%2F%23configuration-options" target="_blank" title="https://grafana.com/docs/pyroscope/latest/configure-client/language-sdks/java/#configuration-options" ref="nofollow noopener noreferrer">Pyroscope å®˜æ–¹æ–‡æ¡£</a>ï¼Œéƒ¨åˆ†å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</li>
</ul>
<p><strong>é…ç½®è¯´æ˜</strong></p>

















































































<table><thead><tr><th>Flag</th><th>Description</th></tr></thead><tbody><tr><td>PYROSCOPE_AGENT_ENABLED</td><td>å¯ç”¨ä»£ç†ã€‚é»˜è®¤å€¼ä¸ºtrueã€‚</td></tr><tr><td>PYROSCOPE_SERVER_ADDRESS</td><td>ä¸ŠæŠ¥åœ°å€</td></tr><tr><td>PYROSCOPE_FORMAT</td><td>è®¾ç½®åˆ†æå™¨è¾“å‡ºæ ¼å¼ã€‚é»˜è®¤å€¼ä¸ºcollapsedï¼Œä½†ä¸ºäº†æ”¯æŒå¤šç§æ ¼å¼ï¼Œå¿…é¡»å°†å…¶è®¾ç½®ä¸ºjfrã€‚</td></tr><tr><td>PYROSCOPE_PROFILER_EVENT</td><td>è®¾ç½®åˆ†æå™¨äº‹ä»¶ã€‚åœ¨å¯ç”¨JFRæ ¼å¼æ—¶ï¼Œæ­¤äº‹ä»¶æŒ‡å¯èƒ½çš„CPUåˆ†æäº‹ä»¶ä¹‹ä¸€ï¼šitimerã€cpuã€wallã€‚é»˜è®¤å€¼ä¸ºitimerã€‚</td></tr><tr><td>PYROSCOPE_PROFILER_ALLOC</td><td>è®¾ç½®æ³¨å†Œäº‹ä»¶çš„åˆ†é…é˜ˆå€¼ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œç›¸å½“äºasync-profilerä¸­çš„--alloc=ï¼‰ã€‚é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ï¼Œè¡¨ç¤ºç¦ç”¨åˆ†é…åˆ†æã€‚å°†å…¶è®¾ç½®ä¸º0å°†æ³¨å†Œæ¯ä¸ªäº‹ä»¶ï¼Œå¯¼è‡´æ˜¾è‘—çš„CPUå’Œç½‘ç»œå¼€é”€ï¼Œä¸é€‚åˆç”Ÿäº§ç¯å¢ƒã€‚å»ºè®®çš„èµ·å§‹å€¼ä¸º512kï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚</td></tr><tr><td>PYROSCOPE_PROFILER_LOCK</td><td>è®¾ç½®æ³¨å†Œäº‹ä»¶çš„é”é˜ˆå€¼ï¼ˆä»¥çº³ç§’ä¸ºå•ä½ï¼Œç›¸å½“äºasync-profilerä¸­çš„--lock=ï¼‰ã€‚é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ï¼Œè¡¨ç¤ºç¦ç”¨é”åˆ†æã€‚å°†å…¶è®¾ç½®ä¸º0å°†æ³¨å†Œæ¯ä¸ªäº‹ä»¶ï¼Œå¯¼è‡´æ˜¾è‘—çš„CPUå’Œç½‘ç»œå¼€é”€ï¼Œä¸é€‚åˆç”Ÿäº§ç¯å¢ƒã€‚å»ºè®®çš„èµ·å§‹å€¼ä¸º10msï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚</td></tr><tr><td>PYROSCOPE_CONFIGURATION_FILE</td><td>è®¾ç½®é¢å¤–çš„å±æ€§é…ç½®æ–‡ä»¶ã€‚é»˜è®¤å€¼ä¸ºpyroscope.propertiesã€‚</td></tr><tr><td>PYROSCOPE_BASIC_AUTH_USER</td><td>HTTP Basicèº«ä»½éªŒè¯ç”¨æˆ·åã€‚é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ï¼Œè¡¨ç¤ºæ— èº«ä»½éªŒè¯ã€‚</td></tr><tr><td>PYROSCOPE_BASIC_AUTH_PASSWORD</td><td>HTTP Basicèº«ä»½éªŒè¯å¯†ç ã€‚é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ï¼Œè¡¨ç¤ºæ— èº«ä»½éªŒè¯ã€‚</td></tr><tr><td>PYROSCOPE_TENANT_ID</td><td>pyroscopeç§Ÿæˆ·IDï¼Œä½œä¸ºX-Scope-OrgID HTTPå¤´ä¼ é€’ã€‚é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ï¼Œè¡¨ç¤ºæ— ç§Ÿæˆ·IDã€‚</td></tr><tr><td>PYROSCOPE_HTTP_HEADERS</td><td>é¢å¤–çš„HTTPå¤´ï¼ˆä»¥JSONæ ¼å¼ï¼‰ï¼Œä¾‹å¦‚ï¼š{"X-Header": "Value"}ã€‚é»˜è®¤å€¼ä¸º{}ï¼Œè¡¨ç¤ºæ— é¢å¤–å¤´ã€‚</td></tr><tr><td>PYROSCOPE_LABELS</td><td>è®¾ç½®ä»¥é€—å·åˆ†éš”çš„key=valueå¯¹å½¢å¼çš„é™æ€æ ‡ç­¾ã€‚é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ï¼Œè¡¨ç¤ºæ— æ ‡ç­¾ã€‚</td></tr><tr><td>PYROSCOPE_LOG_LEVEL</td><td>ç¡®å®šPyroscopeæ—¥å¿—è®°å½•å™¨çš„è¯¦ç»†ç¨‹åº¦ã€‚å¯ç”¨é€‰é¡¹åŒ…æ‹¬debugã€infoã€warnå’Œerrorã€‚é»˜è®¤å€¼ä¸ºinfoã€‚</td></tr><tr><td>PYROSCOPE_PUSH_QUEUE_CAPACITY</td><td>æŒ‡å®šåœ¨ç½‘ç»œä¸­æ–­æœŸé—´ä¸´æ—¶åœ¨å†…å­˜ä¸­å­˜å‚¨åˆ†ææ•°æ®çš„æ‘„å–é˜Ÿåˆ—çš„å¤§å°ã€‚é»˜è®¤å€¼ä¸º8ã€‚</td></tr><tr><td>PYROSCOPE_INGEST_MAX_TRIES</td><td>è®¾ç½®åœ¨å¤±è´¥æ—¶é‡è¯•æ‘„å–APIè°ƒç”¨çš„æœ€å¤§æ¬¡æ•°ã€‚å€¼ä¸º-1è¡¨ç¤ºé‡è¯•å°†ç»§ç»­è¿›è¡Œï¼Œç›´åˆ°æˆåŠŸã€‚é»˜è®¤å€¼ä¸º8ã€‚</td></tr><tr><td>PYROSCOPE_EXPORT_COMPRESSION_LEVEL_JFR</td><td>è®¾ç½®ä¸Šä¼ åˆ°JFRæ–‡ä»¶çš„GZIPå‹ç¼©çº§åˆ«ã€‚æ­¤é€‰é¡¹æ¥å—çš„å€¼åŒ…æ‹¬NO_COMPRESSIONã€BEST_SPEEDã€BEST_COMPRESSIONå’ŒDEFAULT_COMPRESSIONã€‚</td></tr><tr><td>PYROSCOPE_EXPORT_COMPRESSION_LEVEL_LABELS</td><td>ä¸PYROSCOPE_EXPORT_COMPRESSION_LEVEL_JFRç±»ä¼¼ï¼Œä½†é€‚ç”¨äºåŠ¨æ€æ ‡ç­¾éƒ¨åˆ†ã€‚é»˜è®¤å€¼ä¸ºBEST_SPEEDã€‚</td></tr><tr><td>PYROSCOPE_GC_BEFORE_DUMP</td><td>å¸ƒå°”å€¼ï¼Œå½“è®¾ç½®ä¸ºtrueæ—¶ï¼Œåœ¨è½¬å‚¨åˆ†ææ–‡ä»¶ä¹‹å‰æ‰§è¡ŒSystem.gc()å‘½ä»¤ã€‚æ­¤é€‰é¡¹å¯èƒ½å¯¹å®æ—¶åˆ†ææœ‰ç”¨ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹æ˜¯ç¦ç”¨çš„ã€‚</td></tr></tbody></table>
<h2 data-id="heading-10">æ•ˆæœæ¼”ç¤º</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13dc5261881647d6a8d7c603f827bc01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400862&amp;x-signature=FxhYAdM3EVpxTrEqPRmqqBvrXEI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6490ba115d4c49109cf4749a51eb1820~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400862&amp;x-signature=7uVIj1fJht6LrldwNSgRPQddxUk%3D" alt="" loading="lazy"/></p>
<p>è§‚æµ‹äº‘åœ¨é‡‡é›† profiling æ•°æ®æ—¶å¯ä»¥é€šè¿‡ä¸€äº›é…ç½®å®ç° profiling ä¸ tracing æ•°æ®çš„å…³è”ï¼Œå…¶åŸç†ä¸»è¦æ˜¯é€šè¿‡ç»™ profiling å’Œ tracing æ³¨å…¥ runtime_id æ ‡ç­¾å®ç°å…³è”ï¼Œåœ¨é“¾è·¯ä¸­å¯ä»¥ç‚¹å‡»ä»£ç çƒ­ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å…³è”çš„ profiling ä¿¡æ¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e15a9f6c8734dc0bc73a17bec02d0b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400862&amp;x-signature=1z%2BADtYxiGuRJGFA04FGgDpXTfw%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è‡ªå®šä¹‰ ClassLoader åŠ¨æ€åŠ è½½ï¼šä¸é‡å¯å°±èƒ½åŠ è½½æ–°ä»£ç ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7582923861768601650</link>    <guid>https://juejin.cn/post/7582923861768601650</guid>    <pubDate>2025-12-14T00:11:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582923861768601650" data-draft-id="7582955784569946163" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è‡ªå®šä¹‰ ClassLoader åŠ¨æ€åŠ è½½ï¼šä¸é‡å¯å°±èƒ½åŠ è½½æ–°ä»£ç ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-14T00:11:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¸æµªæ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è‡ªå®šä¹‰ ClassLoader åŠ¨æ€åŠ è½½ï¼šä¸é‡å¯å°±èƒ½åŠ è½½æ–°ä»£ç ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¸æµªæ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T00:11:47.000Z" title="Sun Dec 14 2025 00:11:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    18
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>æœ¬æ–‡å°†å¸¦ä½ ç”¨ 300 è¡Œä»£ç ï¼Œäº²æ‰‹å®ç° JVM çº§åˆ«çš„åŠ¨æ€ä»£ç åŠ è½½èƒ½åŠ›ï¼Œå¹¶çœ‹æ¸…å®ƒçš„ä»£ä»·ã€‚</strong></p>
<p>å…¨ç¨‹åªä½¿ç”¨ <code>javax.tools.JavaCompiler</code> å’Œæ ‡å‡† ClassLoaderï¼Œé›¶ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ŒJDK 8+ å¼€ç®±å³ç”¨ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€åŒä¸€ä¸ªé—®é¢˜ï¼Œä¸åŒçš„è§£æ³•</h2>
<p>é¡¹ç›®ä¸­ç»å¸¸æœ‰è¿™æ ·çš„éœ€æ±‚ï¼šè¿è¥é…ç½®ä¸€æ®µè§„åˆ™è„šæœ¬ï¼Œç³»ç»Ÿèƒ½ç›´æ¥æ‰§è¡Œã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">rule</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>;
<span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> engine.execute(rule);  <span class="hljs-comment">// æ€ä¹ˆè®©å­—ç¬¦ä¸²å˜æˆå¯æ‰§è¡Œä»£ç ï¼Ÿ</span>
</code></pre>
<p>ä¸Šä¸€ç¯‡æ–‡ç« ã€Š<a href="https://juejin.cn/post/7582814236584329254" target="_blank" title="https://juejin.cn/post/7582814236584329254">QLExpress å¦‚ä½•åšåˆ°ä¸ç¼–è¯‘å°±èƒ½æ‰§è¡Œï¼Ÿ</a>ã€‹è®²äº†è§£é‡Šæ‰§è¡Œçš„æ–¹æ¡ˆï¼šæŠŠè„šæœ¬è§£ææˆ AST æ ‘ï¼Œç”¨ Java ä»£ç éå†æ‰§è¡Œï¼Œä¸ç”Ÿæˆ class æ–‡ä»¶ã€‚</p>
<p>è¿™ä¸€ç¯‡æ¢ä¸ªæ€è·¯ï¼š<strong>èƒ½ä¸èƒ½æŠŠè„šæœ¬ç¼–è¯‘æˆçœŸæ­£çš„ class æ–‡ä»¶ï¼Œç„¶ååŠ è½½æ‰§è¡Œï¼Ÿ</strong></p>
<p>å¬èµ·æ¥å¾ˆé…·ï¼Œä½†æœ‰ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> <span class="hljs-string">"public class Script { ... }"</span>;

<span class="hljs-comment">// é—®é¢˜1ï¼šæ€ä¹ˆç¼–è¯‘ï¼ŸJava æºç å˜æˆå­—èŠ‚ç </span>
<span class="hljs-type">byte</span>[] classBytes = compile(code);

<span class="hljs-comment">// é—®é¢˜2ï¼šæ€ä¹ˆåŠ è½½ï¼Ÿå­—èŠ‚ç å˜æˆ Class å¯¹è±¡</span>
Class&lt;?&gt; clazz = load(classBytes);

<span class="hljs-comment">// é—®é¢˜3ï¼šæ€ä¹ˆæ‰§è¡Œï¼Ÿè°ƒç”¨ Class çš„æ–¹æ³•</span>
<span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> clazz.execute();
</code></pre>
<p>èŠ±äº†ä¸€å¤©æ‰‹å†™ 300 è¡Œä»£ç éªŒè¯ï¼Œè¿™ä¸ªæ€è·¯å®Œå…¨å¯è¡Œã€‚åæ¥å‘ç°ï¼š<strong>è¿™å°±æ˜¯ Groovy çš„åšæ³•ã€‚</strong></p>
<p><strong>Groovy æ˜¯ä»€ä¹ˆï¼Ÿ</strong> ä¸€é—¨è¿è¡Œåœ¨ JVM ä¸Šçš„åŠ¨æ€è¯­è¨€ï¼Œæœ€å¸¸è§çš„åœºæ™¯æ˜¯ Jenkins Pipeline å’Œ Gradle æ„å»ºè„šæœ¬ã€‚å®ƒçš„æ ¸å¿ƒèƒ½åŠ›å°±æ˜¯åŠ¨æ€ç¼–è¯‘æ‰§è¡Œã€‚</p>
<p>æœ¬æ–‡æ‰‹å†™çš„å®ç°ç§°ä¸º <code>DynamicScriptRunner</code>ï¼Œå±•ç¤º Groovy ç­‰è„šæœ¬å¼•æ“çš„åº•å±‚åŸç†ï¼Œå…¨ç¨‹åªç”¨ JDK è‡ªå¸¦å·¥å…·ï¼Œé›¶ä¾èµ–ã€‚</p>
<h2 data-id="heading-1">äºŒã€æ•´ä½“æµç¨‹</h2>
<p>æŠŠè„šæœ¬æ‰§è¡Œåˆ†æˆäº”ä¸ªé˜¶æ®µï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[è„šæœ¬å­—ç¬¦ä¸²] --&gt;|1.åŒ…è£…| B[Javaæºç ]
    B --&gt;|2.ç¼–è¯‘| C[å†…å­˜å­—èŠ‚ç ]
    C --&gt;|3.åŠ è½½| D[Classå¯¹è±¡]
    D --&gt;|4.åå°„| E[æ‰§è¡Œç»“æœ]
    
    style A fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style B fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style C fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    style D fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    style E fill:#ffebee,stroke:#b71c1c,stroke-width:2px
</code></pre>
<p><strong>ä¸¾ä¸ªä¾‹å­</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¾“å…¥è„šæœ¬</span>
<span class="hljs-string">"if (amount &gt; 100) MyMath.discount(amount, 0.8)"</span>

<span class="hljs-comment">// ä¸Šä¸‹æ–‡</span>
amount = <span class="hljs-number">150</span>
MyMath = MyMath.class

<span class="hljs-comment">// æ‰§è¡Œæµç¨‹</span>
è„šæœ¬å­—ç¬¦ä¸² â†’ åŒ…è£…æˆJavaç±» â†’ ç¼–è¯‘æˆå­—èŠ‚ç  â†’ åŠ è½½æˆClass â†’ åå°„æ‰§è¡Œ â†’ è¿”å›<span class="hljs-number">120.0</span>
</code></pre>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€å…³é”®æŠ€æœ¯ç‚¹è¯¦è§£</h2>
<h3 data-id="heading-3">æŠ€æœ¯ç‚¹ä¸€ï¼šè„šæœ¬åŒ…è£…æˆ Java æºç </h3>
<p><strong>åŸå§‹è„šæœ¬</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (amount &gt; <span class="hljs-number">100</span>) MyMath.discount(amount, <span class="hljs-number">0.8</span>)
</code></pre>
<p><strong>åŒ…è£…åçš„ Java æºç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Script_1702345678</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">execute</span><span class="hljs-params">(
        java.util.Map&lt;String, Object&gt; context,
        java.util.Map&lt;String, Class&lt;?&gt;&gt; functions
    )</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// æ­¥éª¤1ï¼šä» context æå–å˜é‡å¹¶å£°æ˜</span>
        <span class="hljs-type">Double</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> (Double) context.get(<span class="hljs-string">"amount"</span>);
        
        <span class="hljs-comment">// æ­¥éª¤2ï¼šä» functions æå–å‡½æ•°ç±»</span>
        Class&lt;?&gt; MyMath = functions.get(<span class="hljs-string">"MyMath"</span>);
        
        <span class="hljs-comment">// æ­¥éª¤3ï¼šæ’å…¥è„šæœ¬ï¼ˆéœ€è¦è½¬æ¢ï¼‰</span>
        <span class="hljs-keyword">return</span> (amount &gt; <span class="hljs-number">100</span>) ? 
            (Double) MyMath.getMethod(<span class="hljs-string">"discount"</span>, <span class="hljs-type">double</span>.class, <span class="hljs-type">double</span>.class)
                           .invoke(<span class="hljs-literal">null</span>, amount, <span class="hljs-number">0.8</span>)
            : <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦åŒ…è£…ï¼Ÿ</strong></p>
<pre><code class="hljs">è„šæœ¬ç‰‡æ®µä¸èƒ½ç›´æ¥ç¼–è¯‘
å¿…é¡»åŒ…è£…æˆå®Œæ•´çš„ç±»
æ‰èƒ½äº¤ç»™ JavaCompiler
</code></pre>
<p><strong>åŒ…è£…ä¸‰æ­¥èµ°</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[åŸå§‹è„šæœ¬] --&gt; B[æå–å˜é‡]
    A --&gt; C[æå–å‡½æ•°]
    A --&gt; D[è½¬æ¢è°ƒç”¨]
    
    B --&gt; E[ç”ŸæˆJavaæºç ]
    C --&gt; E
    D --&gt; E
    
    style A fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style B fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style C fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style D fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style E fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
</code></pre>
<p><strong>è¯¦ç»†è¯´æ˜</strong>ï¼š</p>
<ol>
<li>æå–å˜é‡ï¼šä» context ä¸­æå– amountï¼Œç”Ÿæˆ <code>Double amount = ...</code></li>
<li>æå–å‡½æ•°ï¼šä» functions ä¸­æå– MyMathï¼Œç”Ÿæˆ <code>Class&lt;?&gt; MyMath = ...</code></li>
<li>è½¬æ¢è°ƒç”¨ï¼šæŠŠ <code>MyMath.discount(...)</code> è½¬æ¢æˆåå°„è°ƒç”¨</li>
</ol>
<p><strong>å…³é”®ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> String <span class="hljs-title function_">wrapScript</span><span class="hljs-params">(String className, String script)</span> {
    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
    
    <span class="hljs-comment">// ç±»å®šä¹‰</span>
    sb.append(<span class="hljs-string">"public class "</span>).append(className).append(<span class="hljs-string">" {\n"</span>);
    sb.append(<span class="hljs-string">"    public static Object execute(\n"</span>);
    sb.append(<span class="hljs-string">"        java.util.Map&lt;String, Object&gt; context,\n"</span>);
    sb.append(<span class="hljs-string">"        java.util.Map&lt;String, Class&lt;?&gt;&gt; functions\n"</span>);
    sb.append(<span class="hljs-string">"    ) throws Exception {\n"</span>);
    
    <span class="hljs-comment">// æ³¨å…¥å˜é‡</span>
    <span class="hljs-keyword">for</span> (String varName : context.getVariables().keySet()) {
        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> context.getVariables().get(varName);
        <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> getJavaType(value);  <span class="hljs-comment">// Double, Integer, String</span>
        sb.append(<span class="hljs-string">"        "</span>).append(type).append(<span class="hljs-string">" "</span>).append(varName)
          .append(<span class="hljs-string">" = ("</span>).append(type).append(<span class="hljs-string">") context.get(\""</span>)
          .append(varName).append(<span class="hljs-string">"\");\n"</span>);
    }
    
    <span class="hljs-comment">// æ³¨å…¥å‡½æ•°ç±»</span>
    <span class="hljs-keyword">for</span> (String funcName : context.getFunctions().keySet()) {
        sb.append(<span class="hljs-string">"        Class&lt;?&gt; "</span>).append(funcName)
          .append(<span class="hljs-string">" = functions.get(\""</span>).append(funcName).append(<span class="hljs-string">"\");\n"</span>);
    }
    
    <span class="hljs-comment">// è½¬æ¢å¹¶æ’å…¥è„šæœ¬</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">transformedScript</span> <span class="hljs-operator">=</span> transformScript(script);
    sb.append(<span class="hljs-string">"        return "</span>).append(transformedScript).append(<span class="hljs-string">";\n"</span>);
    
    sb.append(<span class="hljs-string">"    }\n"</span>);
    sb.append(<span class="hljs-string">"}\n"</span>);
    
    <span class="hljs-keyword">return</span> sb.toString();
}
</code></pre>
<h3 data-id="heading-4">æŠ€æœ¯ç‚¹äºŒï¼šå‡½æ•°è°ƒç”¨è½¬æ¢</h3>
<p><strong>é—®é¢˜</strong>ï¼šè„šæœ¬é‡Œæ€ä¹ˆè°ƒç”¨ MyMath.discountï¼Ÿ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è„šæœ¬ä¸­</span>
MyMath.discount(<span class="hljs-number">100</span>, <span class="hljs-number">0.8</span>)

<span class="hljs-comment">// ä½†æ­¤æ—¶ MyMath æ˜¯ Class&lt;?&gt; ç±»å‹</span>
Class&lt;?&gt; MyMath = functions.get(<span class="hljs-string">"MyMath"</span>);

<span class="hljs-comment">// ä¸èƒ½ç›´æ¥è°ƒç”¨æ–¹æ³•</span>
MyMath.discount(<span class="hljs-number">100</span>, <span class="hljs-number">0.8</span>);  <span class="hljs-comment">// ç¼–è¯‘é”™è¯¯ï¼</span>
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šè½¬æ¢æˆåå°„è°ƒç”¨</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è½¬æ¢å</span>
(Double) MyMath.getMethod(<span class="hljs-string">"discount"</span>, <span class="hljs-type">double</span>.class, <span class="hljs-type">double</span>.class)
               .invoke(<span class="hljs-literal">null</span>, <span class="hljs-number">100.0</span>, <span class="hljs-number">0.8</span>)
</code></pre>
<p><strong>è½¬æ¢é€»è¾‘</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> String <span class="hljs-title function_">transformFunctionCalls</span><span class="hljs-params">(String script)</span> {
    <span class="hljs-comment">// æ­£åˆ™åŒ¹é…ï¼šClassName.methodName(args)</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">pattern</span> <span class="hljs-operator">=</span> <span class="hljs-string">"(\\w+)\\.(\\w+)\\(([^)]*)\\)"</span>;
    <span class="hljs-type">Pattern</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> Pattern.compile(pattern);
    <span class="hljs-type">Matcher</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> p.matcher(script);
    
    <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>();
    <span class="hljs-keyword">while</span> (m.find()) {
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> m.group(<span class="hljs-number">1</span>);   <span class="hljs-comment">// MyMath</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> m.group(<span class="hljs-number">2</span>);  <span class="hljs-comment">// discount</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">args</span> <span class="hljs-operator">=</span> m.group(<span class="hljs-number">3</span>);        <span class="hljs-comment">// 100, 0.8</span>
        
        String[] argArray = args.split(<span class="hljs-string">","</span>);
        
        <span class="hljs-comment">// æ„é€ åå°„è°ƒç”¨</span>
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">repl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        repl.append(<span class="hljs-string">"(Double) "</span>).append(className)
            .append(<span class="hljs-string">".getMethod(\""</span>).append(methodName).append(<span class="hljs-string">"\""</span>);
        
        <span class="hljs-comment">// æ·»åŠ å‚æ•°ç±»å‹</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; argArray.length; i++) {
            repl.append(<span class="hljs-string">", double.class"</span>);
        }
        
        repl.append(<span class="hljs-string">").invoke(null, "</span>).append(args).append(<span class="hljs-string">")"</span>);
        
        m.appendReplacement(result, repl.toString());
    }
    m.appendTail(result);
    
    <span class="hljs-keyword">return</span> result.toString();
}
</code></pre>
<h3 data-id="heading-5">æŠ€æœ¯ç‚¹ä¸‰ï¼šJavaCompiler åŠ¨æ€ç¼–è¯‘</h3>
<p><strong>æ ¸å¿ƒ API</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è·å–ç³»ç»Ÿç¼–è¯‘å™¨ï¼ˆéœ€è¦ JDKï¼ŒJRE æ²¡æœ‰ï¼‰</span>
<span class="hljs-type">JavaCompiler</span> <span class="hljs-variable">compiler</span> <span class="hljs-operator">=</span> ToolProvider.getSystemJavaCompiler();

<span class="hljs-keyword">if</span> (compiler == <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"éœ€è¦ JDKï¼Œä¸èƒ½ç”¨ JRE"</span>);
}
</code></pre>
<p><strong>ç¼–è¯‘å››æ­¥éª¤</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[Javaæºç ] --&gt;|åŒ…è£…| B[JavaFileObject]
    B --&gt;|ç¼–è¯‘| C[å†…å­˜å­—èŠ‚ç ]
    C --&gt;|æ£€æŸ¥| D{æ˜¯å¦æˆåŠŸ}
    D --&gt;|æ˜¯| E[è¿”å›å­—èŠ‚ç ]
    D --&gt;|å¦| F[æŠ›å¼‚å¸¸]
    
    style A fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style B fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style C fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    style D fill:#ffccbc,stroke:#e64a19,stroke-width:2px
    style E fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    style F fill:#ffebee,stroke:#b71c1c,stroke-width:2px
</code></pre>
<p><strong>å…³é”®ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] compile(String className, String javaSource) <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// 1. è·å–ç¼–è¯‘å™¨</span>
    <span class="hljs-type">JavaCompiler</span> <span class="hljs-variable">compiler</span> <span class="hljs-operator">=</span> ToolProvider.getSystemJavaCompiler();
    
    <span class="hljs-comment">// 2. è¯Šæ–­æ”¶é›†å™¨ï¼ˆæ”¶é›†ç¼–è¯‘é”™è¯¯ï¼‰</span>
    DiagnosticCollector&lt;JavaFileObject&gt; diagnostics = 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">DiagnosticCollector</span>&lt;&gt;();
    
    <span class="hljs-comment">// 3. æ–‡ä»¶ç®¡ç†å™¨ï¼ˆæ‹¦æˆªè¾“å‡ºåˆ°å†…å­˜ï¼‰</span>
    <span class="hljs-type">InMemoryFileManager</span> <span class="hljs-variable">fileManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryFileManager</span>(
        compiler.getStandardFileManager(diagnostics, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>)
    );
    
    <span class="hljs-comment">// 4. æºç å¯¹è±¡</span>
    <span class="hljs-type">JavaFileObject</span> <span class="hljs-variable">sourceFile</span> <span class="hljs-operator">=</span> 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringSourceJavaFileObject</span>(className, javaSource);
    
    <span class="hljs-comment">// 5. ç¼–è¯‘ä»»åŠ¡</span>
    Iterable&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JavaFileObject</span>&gt; compilationUnits = 
        Arrays.asList(sourceFile);
    
    JavaCompiler.<span class="hljs-type">CompilationTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> compiler.getTask(
        <span class="hljs-literal">null</span>,                    <span class="hljs-comment">// è¾“å‡ºï¼ˆnull = ä¸è¾“å‡ºï¼‰</span>
        fileManager,             <span class="hljs-comment">// æ–‡ä»¶ç®¡ç†å™¨</span>
        diagnostics,             <span class="hljs-comment">// è¯Šæ–­æ”¶é›†å™¨</span>
        <span class="hljs-literal">null</span>,                    <span class="hljs-comment">// ç¼–è¯‘é€‰é¡¹</span>
        <span class="hljs-literal">null</span>,                    <span class="hljs-comment">// æ³¨è§£å¤„ç†å™¨</span>
        compilationUnits         <span class="hljs-comment">// æºæ–‡ä»¶</span>
    );
    
    <span class="hljs-comment">// 6. æ‰§è¡Œç¼–è¯‘</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> task.call();
    
    <span class="hljs-keyword">if</span> (!success) {
        <span class="hljs-comment">// æ”¶é›†é”™è¯¯</span>
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">errors</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-keyword">for</span> (Diagnostic&lt;?&gt; d : diagnostics.getDiagnostics()) {
            errors.append(d.getMessage(<span class="hljs-literal">null</span>)).append(<span class="hljs-string">"\n"</span>);
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ç¼–è¯‘å¤±è´¥:\n"</span> + errors);
    }
    
    <span class="hljs-comment">// 7. è·å–å­—èŠ‚ç </span>
    <span class="hljs-keyword">return</span> fileManager.getCompiledClass(className);
}
</code></pre>
<h3 data-id="heading-6">æŠ€æœ¯ç‚¹å››ï¼šå†…å­˜ç¼–è¯‘ï¼ˆä¸å†™ç£ç›˜ï¼‰</h3>
<p><strong>é—®é¢˜</strong>ï¼šJavaCompiler é»˜è®¤ä¼šæŠŠ .class å†™åˆ°ç£ç›˜</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é»˜è®¤è¡Œä¸º</span>
javac Script_123.java
<span class="hljs-comment"># ç”Ÿæˆ Script_123.class æ–‡ä»¶</span>
</code></pre>
<p><strong>ç›®æ ‡</strong>ï¼šç¼–è¯‘åçš„å­—èŠ‚ç ä¿å­˜åœ¨å†…å­˜ï¼Œä¸å†™ç£ç›˜</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šè‡ªå®šä¹‰ FileManager æ‹¦æˆªè¾“å‡º</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[ç¼–è¯‘å™¨è¦å†™.class] --&gt;|æ‹¦æˆª| B[FileManager]
    B --&gt;|æ”¹å†™åˆ°| C[å†…å­˜å¯¹è±¡]
    C --&gt;|ä¿å­˜| D[ByteArrayOutputStream]
    
    style A fill:#ffccbc,stroke:#e64a19,stroke-width:2px
    style B fill:#fff9c4,stroke:#f57f17,stroke-width:3px
    style C fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style D fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
</code></pre>
<p><strong>æ ¸å¿ƒåŸç†</strong>ï¼š</p>
<p>ç¼–è¯‘å™¨è°ƒç”¨ <code>getJavaFileForOutput()</code> æ—¶ï¼Œæˆ‘ä»¬è¿”å›è‡ªå·±çš„å†…å­˜å¯¹è±¡ï¼Œè€Œä¸æ˜¯çœŸå®æ–‡ä»¶ã€‚ç¼–è¯‘å™¨ä¼šæŠŠå­—èŠ‚ç å†™åˆ°è¿™ä¸ªå†…å­˜å¯¹è±¡é‡Œã€‚</p>
<p><strong>å…³é”®ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InMemoryFileManager</span> 
    <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ForwardingJavaFileManager</span>&lt;JavaFileManager&gt; {
    
    <span class="hljs-comment">// ä¿å­˜ç¼–è¯‘åçš„å­—èŠ‚ç </span>
    <span class="hljs-keyword">private</span> Map&lt;String, ByteArrayJavaFileObject&gt; compiledClasses = 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> JavaFileObject <span class="hljs-title function_">getJavaFileForOutput</span><span class="hljs-params">(
        Location location,
        String className,
        JavaFileObject.Kind kind,
        FileObject sibling
    )</span> <span class="hljs-keyword">throws</span> IOException {
        
        <span class="hljs-keyword">if</span> (kind == JavaFileObject.Kind.CLASS) {
            <span class="hljs-comment">// æ‹¦æˆª .class è¾“å‡º</span>
            <span class="hljs-type">ByteArrayJavaFileObject</span> <span class="hljs-variable">fileObject</span> <span class="hljs-operator">=</span> 
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayJavaFileObject</span>(className);
            compiledClasses.put(className, fileObject);
            <span class="hljs-keyword">return</span> fileObject;  <span class="hljs-comment">// è¿”å›å†…å­˜å¯¹è±¡</span>
        }
        
        <span class="hljs-comment">// å…¶ä»–ç±»å‹äº¤ç»™çˆ¶ç±»å¤„ç†</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getJavaFileForOutput(location, className, kind, sibling);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] getCompiledClass(String className) {
        <span class="hljs-type">ByteArrayJavaFileObject</span> <span class="hljs-variable">fileObject</span> <span class="hljs-operator">=</span> compiledClasses.get(className);
        <span class="hljs-keyword">return</span> fileObject != <span class="hljs-literal">null</span> ? fileObject.getBytes() : <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>ByteArrayJavaFileObject</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ByteArrayJavaFileObject</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleJavaFileObject</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">baos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ByteArrayJavaFileObject</span><span class="hljs-params">(String className)</span> {
        <span class="hljs-built_in">super</span>(
            URI.create(<span class="hljs-string">"bytes:///"</span> + className.replace(<span class="hljs-string">'.'</span>, <span class="hljs-string">'/'</span>) + <span class="hljs-string">".class"</span>),
            Kind.CLASS
        );
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> OutputStream <span class="hljs-title function_">openOutputStream</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> baos;  <span class="hljs-comment">// ç¼–è¯‘å™¨å†™å…¥è¿™é‡Œï¼Œä»å†…å­˜åŠ è½½å­—èŠ‚ç ï¼Œç»•è¿‡ç£ç›˜IO</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] getBytes() {
        <span class="hljs-keyword">return</span> baos.toByteArray();  <span class="hljs-comment">// è·å–å­—èŠ‚ç </span>
    }
}
</code></pre>
<h3 data-id="heading-7">æŠ€æœ¯ç‚¹äº”ï¼šè‡ªå®šä¹‰ ClassLoader åŠ è½½</h3>
<p><strong>é—®é¢˜</strong>ï¼šæœ‰äº†å­—èŠ‚ç ï¼Œæ€ä¹ˆåŠ è½½æˆ Class å¯¹è±¡ï¼Ÿ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">byte</span>[] classBytes = compiler.compile(className, javaSource);
<span class="hljs-comment">// æ€ä¹ˆå˜æˆ Class&lt;?&gt; å¯¹è±¡ï¼Ÿ</span>
</code></pre>
<p><strong>ç­”æ¡ˆ</strong>ï¼šè‡ªå®šä¹‰ ClassLoader</p>
<p><strong>æ ¸å¿ƒæ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// defineClassï¼šå­—èŠ‚ç æ•°ç»„ â†’ Class å¯¹è±¡</span>
Class&lt;?&gt; clazz = defineClass(name, classBytes, <span class="hljs-number">0</span>, classBytes.length);
</code></pre>
<p><strong>åŒäº²å§”æ´¾æœºåˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">å…ˆé—®çˆ¶ç±»èƒ½ä¸èƒ½åŠ è½½
  â†“ ä¸èƒ½
å†è°ƒç”¨è‡ªå·±çš„ findClass
  â†“
ä»å†…å­˜å­—èŠ‚ç æ•°ç»„åŠ è½½
  â†“
è¿”å› <span class="hljs-keyword">Class</span> å¯¹è±¡
</code></pre>
<p><strong>å…³é”®ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScriptClassLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ClassLoader</span> {
    
    <span class="hljs-comment">// å­˜å‚¨å­—èŠ‚ç </span>
    <span class="hljs-keyword">private</span> Map&lt;String, <span class="hljs-type">byte</span>[]&gt; classBytesMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ScriptClassLoader</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>(ScriptClassLoader.class.getClassLoader());  <span class="hljs-comment">// è®¾ç½®çˆ¶ç±»åŠ è½½å™¨</span>
    }
    
    <span class="hljs-comment">// æ³¨å†Œå­—èŠ‚ç </span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">defineClass</span><span class="hljs-params">(String className, <span class="hljs-type">byte</span>[] classBytes)</span> {
        classBytesMap.put(className, classBytes);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="hljs-keyword">throws</span> ClassNotFoundException {
        <span class="hljs-comment">// ä»å†…å­˜è·å–å­—èŠ‚ç ï¼ˆJDK ç¼–è¯‘å™¨ SPI æ¥å£ç”Ÿæˆçš„ï¼‰</span>
        <span class="hljs-type">byte</span>[] classBytes = classBytesMap.get(name);
        
        <span class="hljs-keyword">if</span> (classBytes != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// defineClassï¼šä»å†…å­˜å­—èŠ‚æ•°ç»„åŠ è½½ï¼Œç»•è¿‡ç£ç›˜IO</span>
            <span class="hljs-keyword">return</span> defineClass(name, classBytes, <span class="hljs-number">0</span>, classBytes.length);
        }
        
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassNotFoundException</span>(name);
    }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆæ¯æ¬¡ç”Ÿæˆæ–°ç±»åï¼Ÿ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Script_"</span> + System.currentTimeMillis();
</code></pre>
<p><strong>åŸå› </strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> åŒä¸€ä¸ª ClassLoader ä¸èƒ½åŠ è½½åŒåç±»
<span class="hljs-bullet">2.</span> é‡å¤åŠ è½½ä¼šæŠ¥é”™ï¼šLinkageError

è§£å†³æ–¹æ¡ˆï¼š
<span class="hljs-bullet">-</span> æ–¹æ¡ˆ1ï¼šæ¯æ¬¡ç”Ÿæˆæ–°ç±»åï¼ˆå½“å‰åšæ³•ï¼‰
<span class="hljs-bullet">-</span> æ–¹æ¡ˆ2ï¼šæ¯æ¬¡åˆ›å»ºæ–° ClassLoader
<span class="hljs-bullet">-</span> æ–¹æ¡ˆ3ï¼šç¼“å­˜ï¼ˆç›¸åŒè„šæœ¬å¤ç”¨ Classï¼‰
</code></pre>
<h3 data-id="heading-8">æŠ€æœ¯ç‚¹å…­ï¼šåå°„æ‰§è¡Œ</h3>
<p><strong>é—®é¢˜</strong>ï¼šæœ‰äº† Class å¯¹è±¡ï¼Œæ€ä¹ˆæ‰§è¡Œï¼Ÿ</p>
<pre><code class="hljs language-java" lang="java">Class&lt;?&gt; scriptClass = loader.loadClass(<span class="hljs-string">"Script_1702345678"</span>);
<span class="hljs-comment">// æ€ä¹ˆè°ƒç”¨ execute æ–¹æ³•ï¼Ÿ</span>
</code></pre>
<p><strong>ç­”æ¡ˆ</strong>ï¼šåå°„</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. è·å– execute æ–¹æ³•</span>
<span class="hljs-type">Method</span> <span class="hljs-variable">executeMethod</span> <span class="hljs-operator">=</span> scriptClass.getMethod(
    <span class="hljs-string">"execute"</span>, 
    Map.class,    <span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°ï¼šcontext</span>
    Map.class     <span class="hljs-comment">// ç¬¬äºŒä¸ªå‚æ•°ï¼šfunctions</span>
);

<span class="hljs-comment">// 2. å‡†å¤‡å‚æ•°</span>
Map&lt;String, Object&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
context.put(<span class="hljs-string">"amount"</span>, <span class="hljs-number">150.0</span>);

Map&lt;String, Class&lt;?&gt;&gt; functions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
functions.put(<span class="hljs-string">"MyMath"</span>, MyMath.class);

<span class="hljs-comment">// 3. è°ƒç”¨ï¼ˆé™æ€æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼  nullï¼‰</span>
<span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> executeMethod.invoke(
    <span class="hljs-literal">null</span>,        <span class="hljs-comment">// é™æ€æ–¹æ³•</span>
    context,     <span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°</span>
    functions    <span class="hljs-comment">// ç¬¬äºŒä¸ªå‚æ•°</span>
);

<span class="hljs-comment">// 4. è¿”å›ç»“æœ</span>
<span class="hljs-keyword">return</span> result;  <span class="hljs-comment">// 120.0</span>
</code></pre>
<hr/>
<h2 data-id="heading-9">å››ã€å®Œæ•´æ‰§è¡Œæµç¨‹ç¤ºä¾‹</h2>
<p><strong>è¾“å…¥</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">script</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if (amount &gt; 100) MyMath.discount(amount, 0.8)"</span>;
Context:
  amount = <span class="hljs-number">150.0</span>
  MyMath = MyMath.class
</code></pre>
<p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[è„šæœ¬å­—ç¬¦ä¸²] --&gt; B[åŒ…è£…æˆJavaæºç ]
    B --&gt; C[JavaCompilerç¼–è¯‘]
    C --&gt; D[å¾—åˆ°å†…å­˜å­—èŠ‚ç ]
    D --&gt; E[ClassLoaderåŠ è½½]
    E --&gt; F[åå°„æ‰§è¡Œ]
    F --&gt; G[è¿”å›ç»“æœ]
    
    style A fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style B fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style C fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    style D fill:#ffccbc,stroke:#e64a19,stroke-width:2px
    style E fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    style F fill:#ffebee,stroke:#c62828,stroke-width:2px
    style G fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px
</code></pre>
<p><strong>ç”Ÿæˆçš„ Java æºç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Script_1702345678</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">execute</span><span class="hljs-params">(
        java.util.Map&lt;String, Object&gt; context,
        java.util.Map&lt;String, Class&lt;?&gt;&gt; functions
    )</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Double</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> (Double) context.get(<span class="hljs-string">"amount"</span>);
        Class&lt;?&gt; MyMath = functions.get(<span class="hljs-string">"MyMath"</span>);
        
        <span class="hljs-keyword">return</span> (amount &gt; <span class="hljs-number">100</span>) ? 
            (Double) MyMath.getMethod(<span class="hljs-string">"discount"</span>, <span class="hljs-type">double</span>.class, <span class="hljs-type">double</span>.class)
                           .invoke(<span class="hljs-literal">null</span>, amount, <span class="hljs-number">0.8</span>)
            : <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>ç¼–è¯‘åçš„å­—èŠ‚ç æŒ‡ä»¤</strong>ï¼ˆä¼ªä»£ç ï¼‰ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">executeæ–¹æ³•:
  ALOAD context
  LDC <span class="hljs-string">"amount"</span>
  INVOKEINTERFACE <span class="hljs-keyword">get</span>
  CHECKCAST <span class="hljs-type">Double</span>
  ASTORE amount
  
  ALOAD amount
  INVOKEVIRTUAL doubleValue
  LDC <span class="hljs-number">100.0</span>
  DCMPG
  IFLE label_else       â† çœŸæ­£çš„ JVM <span class="hljs-keyword">if</span> æŒ‡ä»¤ï¼
  
  ALOAD MyMath
  LDC <span class="hljs-string">"discount"</span>
  ...
  INVOKEVIRTUAL invoke
  <span class="hljs-keyword">GOTO</span> label_end
  
<span class="hljs-symbol">label_else:</span>
  ACONST_NULL
  
<span class="hljs-symbol">label_end:</span>
  ARETURN
</code></pre>
<p><strong>å…³é”®å¯¹æ¯”</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">QLExpress</span>ï¼š
  ç”¨ <span class="hljs-title class_">Java</span> çš„ <span class="hljs-keyword">if</span> åŒ…è£…ï¼š<span class="hljs-keyword">if</span> ((<span class="hljs-title class_">Boolean</span>) cond) { ... }
  
<span class="hljs-title class_">MiniGroovy</span>ï¼š
  ç”Ÿæˆ <span class="hljs-variable constant_">JVM</span> çš„ <span class="hljs-keyword">if</span> æŒ‡ä»¤ï¼š<span class="hljs-variable constant_">IFLE</span> label_else
</code></pre>
<hr/>
<h2 data-id="heading-10">äº”ã€ä¸ QLExpress çš„å¯¹æ¯”</h2>
<p>ä¸æ·±å…¥å¯¹æ¯”ï¼ˆä¸‹ä¸€ç¯‡æ–‡ç« çš„äº‹ï¼‰ï¼Œç®€å•è¯´å‡ ç‚¹å·®å¼‚ï¼š</p>



































<table><thead><tr><th>ç»´åº¦</th><th>QLExpress</th><th>DynamicScriptRunner</th></tr></thead><tbody><tr><td>if è¯­å¥</td><td>Java ä»£ç æ¨¡æ‹Ÿ</td><td>JVM å­—èŠ‚ç æŒ‡ä»¤</td></tr><tr><td>ç”Ÿæˆ class</td><td>ä¸ç”Ÿæˆ</td><td>ç”Ÿæˆ</td></tr><tr><td>å¯åŠ¨é€Ÿåº¦</td><td>å¿«</td><td>æ…¢ï¼ˆç¼–è¯‘è€—æ—¶ï¼‰</td></tr><tr><td>è¿è¡Œé€Ÿåº¦</td><td>æ…¢</td><td>å¿«ï¼ˆJIT ä¼˜åŒ–ï¼‰</td></tr><tr><td>å†…å­˜å ç”¨</td><td>ä½</td><td>é«˜ï¼ˆæ¯æ¬¡ç”Ÿæˆæ–°ç±»ï¼‰</td></tr></tbody></table>
<p><strong>æ ¸å¿ƒå·®å¼‚</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">QLExpressï¼š
  è„šæœ¬ â†’ AST â†’ ç”¨ Java ä»£ç éå†æ‰§è¡Œ
  
DynamicScriptRunnerï¼š
  è„šæœ¬ â†’ Java æºç  â†’ ç¼–è¯‘æˆ <span class="hljs-keyword">class</span> â†’ JVM æ‰§è¡Œ
</code></pre>
<hr/>
<h2 data-id="heading-11">å…­ã€é»‘ç§‘æŠ€ä¸è­¦å‘Š</h2>
<h3 data-id="heading-12">é»‘ç§‘æŠ€ï¼šåŠ¨æ€åŠ è½½ Controller</h3>
<p>ç†è®ºä¸Šï¼Œå¯ä»¥ç”¨è¿™ä¸ªæŠ€æœ¯åŠ¨æ€åŠ è½½ Controllerï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å†™ä¸€ä¸ª HTTP æ¥å£æ¥æ”¶ä»£ç </span>
<span class="hljs-meta">@PostMapping("/dynamicController")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">addController</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String code)</span> {
    <span class="hljs-comment">// ç¼–è¯‘ä»£ç </span>
    <span class="hljs-type">byte</span>[] classBytes = compiler.compile(<span class="hljs-string">"DynamicController"</span>, code);
    
    <span class="hljs-comment">// åŠ è½½ç±»</span>
    Class&lt;?&gt; clazz = loader.loadClass(<span class="hljs-string">"DynamicController"</span>);
    
    <span class="hljs-comment">// æ³¨å†Œåˆ° Spring</span>
    <span class="hljs-comment">// ...ï¼ˆçœç•¥æ³¨å†Œé€»è¾‘ï¼‰</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Controller å·²åŠ è½½ï¼Œæ— éœ€é‡å¯ï¼"</span>;
}
</code></pre>
<p><strong>æƒ³è±¡ä¸€ä¸‹</strong>ï¼š</p>
<pre><code class="hljs">ä¸é‡å¯æœåŠ¡å™¨
å‘é€ä¸€æ®µä»£ç 
æ–°åŠŸèƒ½ç«‹åˆ»ç”Ÿæ•ˆ
</code></pre>
<p>å¬èµ·æ¥å¾ˆé…·ï¼Ÿ</p>
<h3 data-id="heading-13">è­¦å‘Šï¼šåƒä¸‡åˆ«åœ¨çº¿ä¸Šç”¨</h3>
<p><strong>ä¸ºä»€ä¹ˆä¸èƒ½ç”¨ï¼Ÿ</strong></p>
<h4 data-id="heading-14">é£é™©ä¸€ï¼šç±»æ³„æ¼å¯¼è‡´ OOM</h4>
<pre><code class="hljs">æ¯æ¬¡åŠ è½½ç”Ÿæˆæ–°ç±»
ä¸é‡Šæ”¾ä¼šå æ»¡ Metaspace
æœ€ç»ˆ OutOfMemoryError
</code></pre>
<p><strong>çœŸå®æ¡ˆä¾‹</strong>ï¼šæŸå›¢é˜Ÿåœ¨çº¿ä¸Šä½¿ç”¨ç±»ä¼¼æœºåˆ¶çƒ­æ›´æ–°ä¸šåŠ¡è§„åˆ™ï¼Œå› ç±»åŠ è½½å™¨æ³„æ¼æœªåŠæ—¶æ¸…ç†ï¼Œ72 å°æ—¶å Metaspace å æ»¡ï¼ŒFull GC é¢‘å‘ï¼ŒæœåŠ¡é›ªå´©ã€‚</p>
<p><strong>ç›‘æ§</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">jmap -clstats &lt;pid&gt; | grep Script_

è¾“å‡ºï¼š
Script_1702345678
Script_1702345679
Script_1702345680
...
Script_1702399999  <span class="hljs-comment"># å‡ ä¸‡ä¸ªç±»ï¼</span>
</code></pre>
<h4 data-id="heading-15">é£é™©äºŒï¼šå®‰å…¨æ¼æ´</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·æäº¤æ¶æ„ä»£ç </span>
<span class="hljs-type">String</span> <span class="hljs-variable">maliciousCode</span> <span class="hljs-operator">=</span> <span class="hljs-string">"System.exit(0)"</span>;
<span class="hljs-comment">// æˆ–</span>
<span class="hljs-type">String</span> <span class="hljs-variable">maliciousCode</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Runtime.getRuntime().exec(\"rm -rf /\")"</span>;

<span class="hljs-comment">// ä½ çš„æœåŠ¡ï¼šç›´æ¥æŒ‚äº†</span>
</code></pre>
<h4 data-id="heading-16">é£é™©ä¸‰ï¼šç¼–è¯‘è€—æ—¶å½±å“æ€§èƒ½</h4>
<pre><code class="hljs">JavaCompiler ç¼–è¯‘ä¸€æ¬¡ï¼š100-200ms
é«˜å¹¶å‘ä¸‹ï¼šæ‰€æœ‰è¯·æ±‚éƒ½åœ¨ç­‰ç¼–è¯‘
æœåŠ¡å“åº”å˜æ…¢
</code></pre>
<h4 data-id="heading-17">é£é™©å››ï¼šéš¾ä»¥è¿½è¸ªå’Œè°ƒè¯•</h4>
<pre><code class="hljs">çº¿ä¸Šå‡ºäº†é—®é¢˜
çœ‹æ—¥å¿—ï¼šScript_1702345678 æŠ¥é”™
å»å“ªæ‰¾è¿™ä¸ªç±»çš„ä»£ç ï¼Ÿ
å·²ç»ä¸åœ¨äº†ï¼Œåªåœ¨å†…å­˜é‡Œå­˜åœ¨è¿‡
</code></pre>
<h3 data-id="heading-18">å¯¹çº¿ä¸Šè¦æœ‰æ•¬ç•ä¹‹å¿ƒ</h3>
<pre><code class="hljs language-diff" lang="diff">åŠ¨æ€ç¼–è¯‘å¾ˆå¼ºå¤§
ä½†ä¹Ÿå¾ˆå±é™©

çº¿ä¸Šç¯å¢ƒï¼š
<span class="hljs-deletion">- ç¨³å®šå‹å€’ä¸€åˆ‡</span>
<span class="hljs-deletion">- å¯è¿½æº¯å‹å€’ä¸€åˆ‡</span>
<span class="hljs-deletion">- å®‰å…¨å‹å€’ä¸€åˆ‡</span>

è¿™ç§é»‘ç§‘æŠ€ï¼š
<span class="hljs-deletion">- å­¦ä¹ å¯ä»¥</span>
<span class="hljs-deletion">- æœ¬åœ°ç©å¯ä»¥</span>
<span class="hljs-deletion">- çº¿ä¸Šç»å¯¹ä¸è¡Œ</span>
</code></pre>
<p><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">éœ€è¦åŠ¨æ€èƒ½åŠ›ï¼Ÿ
<span class="hljs-deletion">- ç”¨é…ç½®ä¸­å¿ƒï¼ˆApolloã€Nacosï¼‰</span>
<span class="hljs-deletion">- ç”¨è§„åˆ™å¼•æ“ï¼ˆDroolsã€QLExpressï¼‰</span>
<span class="hljs-deletion">- ç”¨è„šæœ¬å¼•æ“ï¼ˆä½†è¦æ²™ç®±éš”ç¦»ï¼‰</span>
<span class="hljs-deletion">- ç”¨æ’ä»¶ç³»ç»Ÿï¼ˆOSGiã€JPMSï¼‰</span>

éœ€è¦çƒ­éƒ¨ç½²ï¼Ÿ
<span class="hljs-deletion">- ç”¨ç°åº¦å‘å¸ƒ</span>
<span class="hljs-deletion">- ç”¨è“ç»¿éƒ¨ç½²</span>
<span class="hljs-deletion">- ç”¨æ»šåŠ¨æ›´æ–°</span>
</code></pre>
<p><strong>å®‰å…¨ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<p>è¿™é¡¹æŠ€æœ¯å¹¶éä¸€æ— æ˜¯å¤„ï¼Œåœ¨å¯æ§ç¯å¢ƒä¸‹æœ‰å…¶ä»·å€¼ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">é€‚åˆä½¿ç”¨ï¼š
<span class="hljs-deletion">- æœ¬åœ°è°ƒè¯•è„šæœ¬</span>
<span class="hljs-deletion">- è§„åˆ™æµ‹è¯•æ²™ç®±</span>
<span class="hljs-deletion">- æ•™å­¦æ¼”ç¤ºç³»ç»Ÿ</span>
<span class="hljs-deletion">- ä½é¢‘é…ç½®çƒ­åŠ è½½ï¼ˆé…åˆä¸¥æ ¼ç™½åå•ï¼‰</span>
<span class="hljs-deletion">- å†…éƒ¨å·¥å…·å¹³å°ï¼ˆéæ ¸å¿ƒä¸šåŠ¡ï¼‰</span>

å‰ææ¡ä»¶ï¼š
<span class="hljs-deletion">- ä¸¥æ ¼çš„æƒé™æ§åˆ¶</span>
<span class="hljs-deletion">- å®Œå–„çš„ç›‘æ§å‘Šè­¦</span>
<span class="hljs-deletion">- æ¸…æ™°çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†</span>
<span class="hljs-deletion">- å®šæœŸçš„ç±»åŠ è½½å™¨æ¸…ç†</span>
</code></pre>
<hr/>
<h2 data-id="heading-19">ä¸ƒã€å®Œæ•´æµ‹è¯•</h2>
<h3 data-id="heading-20">æµ‹è¯•ä»£ç </h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">DynamicScriptRunner</span> <span class="hljs-variable">runner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DynamicScriptRunner</span>();
        runner.register(<span class="hljs-string">"MyMath"</span>, MyMath.class);
        runner.getContext().put(<span class="hljs-string">"amount"</span>, <span class="hljs-number">150.0</span>);
        
        test(runner, <span class="hljs-string">"2 + 3 * 4"</span>);
        test(runner, <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>);
        test(runner, <span class="hljs-string">"MyMath.discount(100, 0.8)"</span>);
        test(runner, <span class="hljs-string">"if (amount &gt; 100) MyMath.discount(amount, 0.8)"</span>);
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(DynamicScriptRunner runner, String script)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> runner.execute(script);
        System.out.println(<span class="hljs-string">"Result: "</span> + result);
    }
}
</code></pre>
<h3 data-id="heading-21">æµ‹è¯•è¾“å‡º</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Result: 14.0</span>
<span class="hljs-section">Result: 120.0</span>
<span class="hljs-section">Result: 80.0</span>
<span class="hljs-section">Result: 120.0</span>
</code></pre>
<p><strong>éªŒè¯</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿è¡Œæ—¶æŸ¥çœ‹åŠ è½½çš„ç±»</span>
jps
jmap -clstats &lt;pid&gt; | grep Script_

<span class="hljs-comment"># åº”è¯¥çœ‹åˆ°</span>
Script_1702345678
Script_1702345679
Script_1702345680
Script_1702345681

<span class="hljs-comment"># æ¯æ¬¡æ‰§è¡Œç”Ÿæˆä¸€ä¸ªæ–°ç±»</span>
</code></pre>
<hr/>
<h2 data-id="heading-22">å…«ã€æ ¸å¿ƒä»£ç å±•ç¤º</h2>
<h3 data-id="heading-23">DynamicScriptRunner ä¸»å…¥å£</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicScriptRunner</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Context</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">InMemoryCompiler</span> <span class="hljs-variable">compiler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryCompiler</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(String name, Class&lt;?&gt; clazz)</span> {
        context.registerFunction(name, clazz);
    }
    
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">execute</span><span class="hljs-params">(String script)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. ç”Ÿæˆå”¯ä¸€ç±»å</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Script_"</span> + System.currentTimeMillis();
        
        <span class="hljs-comment">// 2. åŒ…è£…æˆ Java æºç </span>
        <span class="hljs-type">String</span> <span class="hljs-variable">javaSource</span> <span class="hljs-operator">=</span> wrapScript(className, script);
        
        <span class="hljs-comment">// 3. åŠ¨æ€ç¼–è¯‘</span>
        <span class="hljs-type">byte</span>[] classBytes = compiler.compile(className, javaSource);
        
        <span class="hljs-comment">// 4. åŠ è½½ç±»</span>
        <span class="hljs-type">ScriptClassLoader</span> <span class="hljs-variable">loader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScriptClassLoader</span>();
        loader.defineClass(className, classBytes);
        Class&lt;?&gt; scriptClass = loader.loadClass(className);
        
        <span class="hljs-comment">// 5. åå°„æ‰§è¡Œ</span>
        <span class="hljs-type">Method</span> <span class="hljs-variable">executeMethod</span> <span class="hljs-operator">=</span> scriptClass.getMethod(<span class="hljs-string">"execute"</span>, Map.class, Map.class);
        <span class="hljs-keyword">return</span> executeMethod.invoke(<span class="hljs-literal">null</span>, context.getVariables(), context.getFunctions());
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">wrapScript</span><span class="hljs-params">(String className, String script)</span> {
        <span class="hljs-comment">// åŒ…è£…é€»è¾‘ï¼ˆå‰é¢å·²å±•ç¤ºï¼‰</span>
    }
}
</code></pre>
<h3 data-id="heading-24">InMemoryCompiler ç¼–è¯‘å™¨</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InMemoryCompiler</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] compile(String className, String javaSource) <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">JavaCompiler</span> <span class="hljs-variable">compiler</span> <span class="hljs-operator">=</span> ToolProvider.getSystemJavaCompiler();
        
        DiagnosticCollector&lt;JavaFileObject&gt; diagnostics = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DiagnosticCollector</span>&lt;&gt;();
        <span class="hljs-type">InMemoryFileManager</span> <span class="hljs-variable">fileManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryFileManager</span>(
            compiler.getStandardFileManager(diagnostics, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>)
        );
        
        <span class="hljs-type">JavaFileObject</span> <span class="hljs-variable">sourceFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringSourceJavaFileObject</span>(className, javaSource);
        
        JavaCompiler.<span class="hljs-type">CompilationTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> compiler.getTask(
            <span class="hljs-literal">null</span>, fileManager, diagnostics, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, Arrays.asList(sourceFile)
        );
        
        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> task.call();
        
        <span class="hljs-keyword">if</span> (!success) {
            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">errors</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
            <span class="hljs-keyword">for</span> (Diagnostic&lt;?&gt; d : diagnostics.getDiagnostics()) {
                errors.append(d.getMessage(<span class="hljs-literal">null</span>)).append(<span class="hljs-string">"\n"</span>);
            }
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ç¼–è¯‘å¤±è´¥:\n"</span> + errors);
        }
        
        <span class="hljs-keyword">return</span> fileManager.getCompiledClass(className);
    }
}
</code></pre>
<h3 data-id="heading-25">ScriptClassLoader ç±»åŠ è½½å™¨</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScriptClassLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ClassLoader</span> {
    
    <span class="hljs-keyword">private</span> Map&lt;String, <span class="hljs-type">byte</span>[]&gt; classBytesMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">defineClass</span><span class="hljs-params">(String className, <span class="hljs-type">byte</span>[] classBytes)</span> {
        classBytesMap.put(className, classBytes);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="hljs-keyword">throws</span> ClassNotFoundException {
        <span class="hljs-type">byte</span>[] classBytes = classBytesMap.get(name);
        <span class="hljs-keyword">if</span> (classBytes != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> defineClass(name, classBytes, <span class="hljs-number">0</span>, classBytes.length);
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassNotFoundException</span>(name);
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-26">ä¹ã€æ€»ç»“</h2>
<h3 data-id="heading-27">æ ¸å¿ƒæœºåˆ¶</h3>
<p>åŠ¨æ€ç¼–è¯‘æ‰§è¡Œçš„æœ¬è´¨æ˜¯ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> è„šæœ¬åŒ…è£…æˆå®Œæ•´ Java ç±»
<span class="hljs-bullet">2.</span> JavaCompiler åŠ¨æ€ç¼–è¯‘ï¼ˆJDK åŸç”Ÿèƒ½åŠ›ï¼‰
<span class="hljs-bullet">3.</span> InMemoryFileManager æ‹¦æˆªè¾“å‡ºåˆ°å†…å­˜
<span class="hljs-bullet">4.</span> ScriptClassLoader ä»å†…å­˜åŠ è½½å­—èŠ‚ç 
<span class="hljs-bullet">5.</span> åå°„è°ƒç”¨æ‰§è¡Œ
</code></pre>
<p><strong>é›¶ä¾èµ–å®ç°</strong>ï¼šå…¨ç¨‹åªä½¿ç”¨ JDK è‡ªå¸¦çš„ <code>javax.tools.JavaCompiler</code> å’Œæ ‡å‡† ClassLoaderï¼Œæ— éœ€å¼•å…¥ä»»ä½•ç¬¬ä¸‰æ–¹åŒ…ã€‚</p>
<h3 data-id="heading-28">å…³é”®æŠ€æœ¯ç‚¹</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> JavaCompiler APIï¼šJDK è‡ªå¸¦çš„åŠ¨æ€ç¼–è¯‘å·¥å…·
<span class="hljs-bullet">2.</span> FileManager æœºåˆ¶ï¼šæ‹¦æˆªç¼–è¯‘è¾“å‡ºï¼ˆJDK ç¼–è¯‘å™¨ SPI æ¥å£ï¼‰
<span class="hljs-bullet">3.</span> ClassLoader æœºåˆ¶ï¼šä»å†…å­˜åŠ è½½å­—èŠ‚ç 
<span class="hljs-bullet">4.</span> defineClass æ–¹æ³•ï¼šå­—èŠ‚ç æ•°ç»„ â†’ Class å¯¹è±¡
<span class="hljs-bullet">5.</span> åå°„è°ƒç”¨ï¼šæ‰§è¡Œç”Ÿæˆçš„ç±»
</code></pre>
<h3 data-id="heading-29">ä¸ QLExpress çš„æ ¸å¿ƒå·®å¼‚</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">QLExpressï¼š
  ç”¨ Java ä»£ç æ¨¡æ‹Ÿ <span class="hljs-keyword">if</span>
  ä¸ç”Ÿæˆ <span class="hljs-keyword">class</span>
  
<span class="hljs-title class_">MiniGroovy</span>ï¼š
  ç”ŸæˆçœŸæ­£çš„ JVM <span class="hljs-keyword">if</span> æŒ‡ä»¤
  ä¼šç”Ÿæˆ <span class="hljs-keyword">class</span>ï¼ˆåœ¨å†…å­˜é‡Œï¼‰
</code></pre>
<h3 data-id="heading-30">å­¦åˆ°äº†ä»€ä¹ˆ</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> åŠ¨æ€ç¼–è¯‘ä¸ç¥ç§˜ï¼ŒJavaCompiler å°±èƒ½åš
<span class="hljs-bullet">2.</span> class æ–‡ä»¶å¯ä»¥åªåœ¨å†…å­˜é‡Œå­˜åœ¨
<span class="hljs-bullet">3.</span> ClassLoader å¯ä»¥ä»å†…å­˜åŠ è½½å­—èŠ‚ç 
<span class="hljs-bullet">4.</span> å¼ºå¤§çš„æŠ€æœ¯è¦è°¨æ…ä½¿ç”¨
<span class="hljs-bullet">5.</span> å¯¹çº¿ä¸Šè¦æœ‰æ•¬ç•ä¹‹å¿ƒ
</code></pre>
<hr/>
<h2 data-id="heading-31">å†™åœ¨æœ€å</h2>
<p>æ‹†äº†ä¸¤ä¸ªè½®å­ï¼š</p>
<p><strong>ä¸Šä¸€ç¯‡ QLExpress</strong>ï¼š</p>
<ul>
<li>ä¸ç”Ÿæˆ class</li>
<li>ç”¨ Java ä»£ç æ¨¡æ‹Ÿæ‰§è¡Œ</li>
<li>è½»é‡ã€å¿«é€Ÿ</li>
</ul>
<p><strong>æœ¬ç¯‡åŠ¨æ€ç¼–è¯‘æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>åŠ¨æ€ç¼–è¯‘ç”Ÿæˆ class</li>
<li>çœŸæ­£çš„ JVM å­—èŠ‚ç </li>
<li>å¼ºå¤§ã€çµæ´»</li>
</ul>
<p>è¿™å¥—æœºåˆ¶å°±æ˜¯ Groovyã€JSR-223 ScriptEngine ç­‰å·¥å…·çš„åº•å±‚åŸç†ã€‚ç†è§£äº†å®ƒï¼Œå°±ç†è§£äº† Java ä¸–ç•Œé‡ŒåŠ¨æ€èƒ½åŠ›çš„æœ¬è´¨ã€‚</p>
<p>[æœ¬æ–‡ä»£ç ] (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fsh_wangwanbao%2Fql-express-mini-groovy" target="_blank" title="https://gitee.com/sh_wangwanbao/ql-express-mini-groovy" ref="nofollow noopener noreferrer">gitee.com/sh_wangwanbâ€¦</a>)</p>
<p>ä¸‹ä¸€ç¯‡è®¡åˆ’ï¼šæ·±å…¥å¯¹æ¯”è¿™ä¸¤ç§æ–¹æ¡ˆï¼Œè®²æ¸…æ¥šä»€ä¹ˆåœºæ™¯ç”¨å“ªä¸ªã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šæé€Ÿæ­å»ºå¾®æœåŠ¡åº”ç”¨]]></title>    <link>https://juejin.cn/post/7583324039302119475</link>    <guid>https://juejin.cn/post/7583324039302119475</guid>    <pubDate>2025-12-14T06:25:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583324039302119475" data-draft-id="7583242257371103259" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šæé€Ÿæ­å»ºå¾®æœåŠ¡åº”ç”¨"/> <meta itemprop="keywords" content="åç«¯,å¾®æœåŠ¡,Go"/> <meta itemprop="datePublished" content="2025-12-14T06:25:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å–µä¸ªå’ª"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šæé€Ÿæ­å»ºå¾®æœåŠ¡åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å–µä¸ªå’ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T06:25:52.000Z" title="Sun Dec 14 2025 06:25:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    26
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šæé€Ÿæ­å»ºå¾®æœåŠ¡åº”ç”¨</h2>
<p>åœ¨ä¼ä¸šçº§ä¸­åå°ç³»ç»Ÿå¼€å‘ä¸­ï¼Œå¼€å‘è€…å¸¸å¸¸é¢ä¸´ä¸¤å¤§ç—›ç‚¹ï¼šä¸€æ˜¯å¾®æœåŠ¡æ¶æ„æ­å»ºç¹çï¼Œä»é¡¹ç›®åˆå§‹åŒ–åˆ°å¤šæœåŠ¡ååŒéœ€è¦å¤§é‡æ‰‹åŠ¨é…ç½®ï¼›äºŒæ˜¯å‰åç«¯ååŒæˆæœ¬é«˜ï¼Œæ¥å£å®šä¹‰ã€æ•°æ®æ¨¡å‹åŒæ­¥å¾€å¾€è€—æ—¶è´¹åŠ›ã€‚è€Œ <strong>GoWind Admin</strong>ï¼ˆç®€ç§°ã€Œé£è¡Œã€ï¼‰çš„å‡ºç°ï¼Œæ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ â€”â€” å®ƒåŸºäº <code>gow</code> CLI å·¥å…·ï¼Œæä¾›äº†ä¸€å¥—å¼€ç®±å³ç”¨çš„ä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼Œè®©å¼€å‘è€…èƒ½ä»¥æä½æˆæœ¬å¿«é€Ÿæ­å»ºå¾®æœåŠ¡ä½“ç³»ã€‚</p>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯ GoWind Adminï¼Ÿ</h3>
<p>GoWind Admin æ˜¯ä¸€å¥—èšç„¦ä¼ä¸šçº§ä¸­åå°åœºæ™¯çš„å¾®æœåŠ¡å¼€å‘æ¡†æ¶ï¼ŒåŸºäº Go è¯­è¨€ç”Ÿæ€ï¼ˆä¾æ‰˜ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgo-kratos.dev%2F" target="_blank" title="https://go-kratos.dev/" ref="nofollow noopener noreferrer">go-kratos</a> å¾®æœåŠ¡æ¡†æ¶ï¼‰æ‰“é€ ï¼Œæ•´åˆäº†å‰åç«¯å¼€å‘æ‰€éœ€çš„æ ¸å¿ƒå·¥å…·é“¾ã€‚å…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºã€Œ<strong>ä¸€é”®ç”Ÿæˆ</strong>ã€ä¸ã€Œ<strong>é«˜åº¦å¯é…ç½®</strong>ã€ï¼šé€šè¿‡ <code>gow</code> å‘½ä»¤è¡Œå·¥å…·ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåˆå§‹åŒ–é¡¹ç›®ã€åˆ›å»ºå¾®æœåŠ¡ã€ç”Ÿæˆæ¥å£ä¸æ•°æ®å±‚ä»£ç ï¼Œæ— éœ€ä»é›¶æ­å»ºæ¶æ„ï¼Œæå¤§ç¼©çŸ­å¼€å‘å‘¨æœŸã€‚</p>
<h3 data-id="heading-2">æ ¸å¿ƒç‰¹æ€§ï¼šä¸ºä»€ä¹ˆé€‰æ‹© GoWind Adminï¼Ÿ</h3>
<h4 data-id="heading-3">1. å¼€ç®±å³ç”¨ï¼Œé›¶é…ç½®å¯åŠ¨</h4>
<p>GoWind Admin æä¾›äº†å®Œæ•´çš„é¡¹ç›®è„šæ‰‹æ¶ï¼ŒåŒ…å«é¢„è®¾çš„ç›®å½•ç»“æ„ã€é…ç½®æ–‡ä»¶ã€ä¾èµ–ç®¡ç†ç­‰ã€‚é€šè¿‡ gow å·¥å…·ï¼Œä¸€è¡Œå‘½ä»¤å³å¯ç”Ÿæˆå¯è¿è¡Œçš„é¡¹ç›®éª¨æ¶ï¼Œçœå»ç¹ççš„åˆå§‹åŒ–å·¥ä½œï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å®‰è£… CLI å·¥å…·</span>
go install github.com/tx7do/kratos-cli/gowind/cmd/gow@latest
<span class="hljs-meta prompt_">
# </span><span class="bash">åˆå§‹åŒ–é¡¹ç›®ï¼ˆæ”¯æŒè‡ªå®šä¹‰æ¨¡å—åï¼‰</span>
gow new myproject -m github.com/yourusername/myproject
cd myproject
go mod tidy  # è‡ªåŠ¨å¤„ç†ä¾èµ–
</code></pre>
<p>ç”Ÿæˆçš„é¡¹ç›®åŒ…å«é»˜è®¤é…ç½®ï¼ˆæ•°æ®åº“ã€æ—¥å¿—ã€æœåŠ¡ç«¯å£ç­‰ï¼‰ï¼Œå¼€å‘è€…å¯ç›´æ¥åŸºäºæ­¤å¼€å‘ï¼Œæ— éœ€å…³æ³¨åº•å±‚æ¶æ„ç»†èŠ‚ã€‚</p>
<h4 data-id="heading-4">2. å¤šæœåŠ¡ç±»å‹æ”¯æŒï¼Œé€‚é…å¤æ‚ä¸šåŠ¡åœºæ™¯</h4>
<p>ä¼ä¸šçº§åº”ç”¨å¾€å¾€éœ€è¦å¤šç§æœåŠ¡ç±»å‹ååŒï¼ˆå¦‚ API æœåŠ¡ã€RPC æœåŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ç­‰ï¼‰ã€‚GoWind Admin æ”¯æŒé€šè¿‡å‘½ä»¤è¡Œå¿«é€Ÿåˆ›å»ºä¸åŒç±»å‹çš„å¾®æœåŠ¡ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆå¯¹åº”ä»£ç ï¼š</p>
<ul>
<li><strong>å¤šåè®®æ”¯æŒ</strong>ï¼šå¯åˆ›å»º gRPCã€REST æœåŠ¡ï¼Œæˆ–åŒæ—¶é›†æˆä¸¤ç§åè®®ï¼ˆå¦‚ <code>gow add service admin -s rest -s grpc</code>ï¼‰ï¼›</li>
<li><strong>å¤šæ•°æ®å±‚é€‚é…</strong>ï¼šæ”¯æŒ gormã€entã€redis ç­‰ä¸»æµ ORM / æ•°æ®å®¢æˆ·ç«¯ï¼Œç”Ÿæˆå¯¹åº”çš„æ•°æ®è®¿é—®å±‚ä»£ç ï¼ˆå¦‚ <code>gow add service payment -d gorm -d redis</code>ï¼‰ï¼›</li>
<li><strong>æœåŠ¡æ³¨å†Œä¸å‘ç°</strong>ï¼šå†…ç½®å¾®æœåŠ¡ååŒæ‰€éœ€çš„é…ç½®ï¼Œæ”¯æŒæœåŠ¡é—´è°ƒç”¨çš„æ ‡å‡†åŒ–å¤„ç†ã€‚</li>
</ul>
<h4 data-id="heading-5">3. è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆï¼Œå‡å°‘é‡å¤åŠ³åŠ¨</h4>
<p>GoWind Admin çš„æ ¸å¿ƒèƒ½åŠ›ä¹‹ä¸€æ˜¯ã€Œä»£ç ç”Ÿæˆã€ï¼Œé€šè¿‡ <code>gow</code> å·¥å…·å¯è‡ªåŠ¨ç”Ÿæˆé¡¹ç›®å„å±‚ä»£ç ï¼Œè¦†ç›–ä»æ¥å£å®šä¹‰åˆ°æ•°æ®è®¿é—®çš„å…¨æµç¨‹ï¼š</p>
<ul>
<li><strong>æœåŠ¡å±‚ä»£ç </strong>ï¼šç”Ÿæˆ gRPC/REST æœåŠ¡çš„è·¯ç”±ã€æ§åˆ¶å™¨ä»£ç ï¼›</li>
<li><strong>æ•°æ®å±‚ä»£ç </strong>ï¼šæ ¹æ®é€‰æ‹©çš„ ORM ç±»å‹ï¼ˆå¦‚ gormï¼‰ç”Ÿæˆæ•°æ®åº“è¿æ¥ã€æ¨¡å‹å®šä¹‰ä»£ç ï¼›</li>
<li><strong>é…ç½®æ–‡ä»¶</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆ server.yamlã€data.yaml ç­‰é…ç½®æ¨¡æ¿ï¼ŒåŒ…å«æ•°æ®åº“ã€æ—¥å¿—ã€å®¢æˆ·ç«¯ç­‰é»˜è®¤é…ç½®ï¼›</li>
<li><strong>æ„å»ºè„šæœ¬</strong>ï¼šç”Ÿæˆ Makefileï¼Œæ”¯æŒä¸€é”®ç¼–è¯‘ã€è¿è¡Œã€éƒ¨ç½²ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼Œæ·»åŠ ä¸€ä¸ªæ”¯æŒ gRPC å’Œ gorm çš„ã€Œè®¢å•æœåŠ¡ã€ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">gow add service order -s grpc -d gorm
go mod tidy  # è‡ªåŠ¨æ›´æ–°ä¾èµ–
</code></pre>
<p>å‘½ä»¤æ‰§è¡Œåï¼Œæ¡†æ¶ä¼šåœ¨ <code>app/order/service</code> ç›®å½•ä¸‹ç”Ÿæˆå®Œæ•´çš„æœåŠ¡ä»£ç ï¼ŒåŒ…æ‹¬ gRPC æ¥å£å®šä¹‰ã€æ•°æ®è®¿é—®å±‚ã€é…ç½®æ–‡ä»¶ç­‰ï¼Œå¼€å‘è€…å¯ç›´æ¥ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚</p>
<h4 data-id="heading-6">4. æ— ç¼é›†æˆ kratos ç”Ÿæ€ï¼Œä¼ä¸šçº§èƒ½åŠ›å†…ç½®</h4>
<p>GoWind Admin åŸºäº kratos ç”Ÿæ€æ„å»ºï¼Œå¤©ç„¶ç»§æ‰¿å…¶ä¼ä¸šçº§ç‰¹æ€§ï¼š</p>
<ul>
<li><strong>å¯è§‚æµ‹æ€§</strong>ï¼šå†…ç½®æ—¥å¿—ã€ç›‘æ§ã€è¿½è¸ªèƒ½åŠ›ï¼Œæ”¯æŒä¸ Prometheusã€Grafana ç­‰å·¥å…·é›†æˆï¼›</li>
<li><strong>é«˜å¯ç”¨</strong>ï¼šæ”¯æŒæœåŠ¡ç†”æ–­ã€é™æµã€é‡è¯•ç­‰å®¹é”™æœºåˆ¶ï¼›</li>
<li><strong>æ‰©å±•æ€§</strong>ï¼šå¯ç»“åˆ kratos-cli å…¶ä»–å·¥å…·ï¼ˆå¦‚ <code>cfgexp</code> é…ç½®å¯¼å‡ºã€<code>sql2orm</code> æ•°æ®åº“æ¨¡å‹ç”Ÿæˆï¼‰ï¼Œå½¢æˆå®Œæ•´å¼€å‘é—­ç¯ã€‚</li>
</ul>
<h3 data-id="heading-7">å¿«é€Ÿä¸Šæ‰‹ï¼š3 æ­¥æ­å»ºä¸€ä¸ªå¾®æœåŠ¡åº”ç”¨</h3>
<h4 data-id="heading-8">æ­¥éª¤ 1ï¼šå®‰è£… CLI å·¥å…·</h4>
<pre><code class="hljs language-shell" lang="shell">go install github.com/tx7do/kratos-cli/gowind/cmd/gow@latest
</code></pre>
<h4 data-id="heading-9">æ­¥éª¤ 2ï¼šåˆ›å»ºé¡¹ç›®å¹¶æ·»åŠ æœåŠ¡</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">åˆ›å»ºé¡¹ç›®</span>
gow new wind-demo -m github.com/your-org/wind-demo
cd wind-demo
<span class="hljs-meta prompt_">
# </span><span class="bash">æ·»åŠ ç”¨æˆ·æœåŠ¡ï¼ˆæ”¯æŒ REST åè®®å’Œ gorm æ•°æ®åº“ï¼‰</span>
gow add service user -s rest -d gorm
go mod tidy

cd app/user/service
<span class="hljs-meta prompt_"># </span><span class="bash">ç”Ÿæˆwireä»£ç </span>
make wire
</code></pre>
<h4 data-id="heading-10">æ­¥éª¤ 3ï¼šè¿è¡ŒæœåŠ¡</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è¿›å…¥ç”¨æˆ·æœåŠ¡ç›®å½•è¿è¡Œ</span>
cd app/user/service
gow run
<span class="hljs-meta prompt_">
# </span><span class="bash">æˆ–ç›´æ¥æŒ‡å®šæœåŠ¡åè¿è¡Œ</span>
gow run user
</code></pre>
<p>æœåŠ¡å¯åŠ¨åï¼Œå³å¯é€šè¿‡é»˜è®¤ç«¯å£ï¼ˆå¦‚ REST æœåŠ¡é»˜è®¤ 8080ï¼‰è®¿é—®æ¥å£ï¼Œæ¡†æ¶å·²è‡ªåŠ¨å¤„ç†å¥½è·¯ç”±ã€é…ç½®åŠ è½½ç­‰å·¥ä½œã€‚</p>
<h3 data-id="heading-11">é€‚ç”¨åœºæ™¯</h3>
<p>GoWind Admin å°¤å…¶é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li>ä¼ä¸šçº§ä¸­åå°ç³»ç»Ÿå¼€å‘ï¼ˆå¦‚ ERPã€CRMã€æ•°æ®å¹³å°ï¼‰ï¼›</li>
<li>å¾®æœåŠ¡æ¶æ„çš„å¿«é€Ÿè½åœ°ï¼ˆéœ€å¤šæœåŠ¡ååŒã€å¤šåè®®æ”¯æŒï¼‰ï¼›</li>
<li>å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼ˆè‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œé™ä½ååŒæˆæœ¬ï¼‰ï¼›</li>
<li>è¿½æ±‚å¼€å‘æ•ˆç‡çš„å›¢é˜Ÿï¼ˆå‡å°‘æ¶æ„æ­å»ºæ—¶é—´ï¼Œèšç„¦ä¸šåŠ¡é€»è¾‘ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-12">æ€»ç»“</h3>
<p>GoWind Admin ä»¥ã€Œ<strong>ç®€åŒ–å¾®æœåŠ¡å¼€å‘æµç¨‹</strong>ã€ä¸ºæ ¸å¿ƒï¼Œé€šè¿‡ <code>gow</code> CLI å·¥å…·å°†é¡¹ç›®åˆå§‹åŒ–ã€æœåŠ¡åˆ›å»ºã€ä»£ç ç”Ÿæˆç­‰æµç¨‹è‡ªåŠ¨åŒ–ï¼Œè®©å¼€å‘è€…æ— éœ€é‡å¤æ­å»ºæ¶æ„ï¼Œå¼€ç®±å³å¯ä¸“æ³¨ä¸šåŠ¡é€»è¾‘ã€‚æ— è®ºæ˜¯å°å‹å›¢é˜Ÿå¿«é€ŸéªŒè¯éœ€æ±‚ï¼Œè¿˜æ˜¯å¤§å‹ä¼ä¸šæ„å»ºå¤æ‚ä¸­åå°ç³»ç»Ÿï¼ŒGoWind Admin éƒ½èƒ½æ˜¾è‘—é™ä½å¼€å‘æˆæœ¬ï¼ŒåŠ é€Ÿé¡¹ç›®è½åœ°ã€‚</p>
<p>ç«‹å³å°è¯• <code>gow</code> å·¥å…·ï¼Œä½“éªŒã€Œé£è¡Œã€èˆ¬çš„å¼€å‘æ•ˆç‡å§ï¼</p>
<h3 data-id="heading-13">é¡¹ç›®ä»£ç </h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://gitee.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">go-wind-admin Gitee</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://github.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">go-wind-admin Github</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.jsç¬¬åä¸‰ç« (ç¼“å­˜ç»„ä»¶)]]></title>    <link>https://juejin.cn/post/7582958136258215972</link>    <guid>https://juejin.cn/post/7582958136258215972</guid>    <pubDate>2025-12-14T10:23:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582958136258215972" data-draft-id="7582958136258199588" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.jsç¬¬åä¸‰ç« (ç¼“å­˜ç»„ä»¶)"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-14T10:23:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°æ»¡zs"/> <meta itemprop="url" content="https://juejin.cn/user/2463384809252397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.jsç¬¬åä¸‰ç« (ç¼“å­˜ç»„ä»¶)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2463384809252397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°æ»¡zs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T10:23:12.000Z" title="Sun Dec 14 2025 10:23:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¼“å­˜ç»„ä»¶(Cache Components)</h2>
<h4 data-id="heading-1">ä»€ä¹ˆæ˜¯Cache Components?</h4>
<p>Cache Components æ˜¯Next.js(16)ç‰ˆæœ¬ç‰¹æœ‰çš„æœºåˆ¶ï¼Œå®ç°äº†<code>é™æ€å†…å®¹</code> <code>åŠ¨æ€å†…å®¹</code> <code>ç¼“å­˜å†…å®¹</code>çš„æ··åˆç¼–æ’ã€‚ä¿ç•™äº†é™æ€å†…å®¹çš„åŠ è½½é€Ÿåº¦ï¼Œåˆå…·å¤‡åŠ¨æ€æ¸²æŸ“çš„çµæ´»æ€§ï¼Œè§£å†³äº†<code>é™æ€å†…å®¹(åŠ è½½å¿«ä½†æ— æ³•å®æ—¶æ›´æ–°æ•°æ®)</code>å’Œ<code>åŠ¨æ€å†…å®¹(åŠ è½½æ…¢ä½†å¯ä»¥å®æ—¶æ›´æ–°æ•°æ®)</code>æƒè¡¡çš„é—®é¢˜ã€‚</p>
<ul>
<li>
<p>é™æ€å†…å®¹: æ„å»º(<code>npm run build</code>)æ—¶è¿›è¡Œé¢„æ¸²æŸ“ï¼Œä¾‹å¦‚ <code>ã€Œæœ¬åœ°æ–‡ä»¶ã€ã€Œæ¨¡å—å¯¼å…¥ã€ã€Œçº¯è®¡ç®—ã€ï¼ˆæ— ç½‘ç»œè¯·æ±‚ã€æ— ç”¨æˆ·ç›¸å…³æ•°æ®ï¼‰</code>,ä¼šè¢«ç›´æ¥ç¼–è¯‘æˆ<code>HTML</code>ç¬é—´åŠ è½½ã€ç«‹å³å“åº”ã€‚</p>
</li>
<li>
<p>åŠ¨æ€å†…å®¹ï¼šç”¨æˆ·å‘èµ·è¯·æ±‚æ—¶æ‰å¼€å§‹æ¸²æŸ“çš„å†…å®¹ï¼Œä¾èµ– â€œå®æ—¶æ•°æ®â€ æˆ– â€œç”¨æˆ·ä¸ªæ€§åŒ–ä¿¡æ¯â€ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å¯èƒ½ç”Ÿæˆä¸åŒç»“æœï¼Œä¸ä¼šè¢«ç¼“å­˜ã€‚ä¾‹å¦‚<code>ã€Œå®æ—¶æ•°æ®æºã€ï¼ˆå¦‚å®æ—¶æ¥å£ã€æ•°æ®åº“å®æ—¶æŸ¥è¯¢ï¼‰æˆ–ã€Œç”¨æˆ·è¯·æ±‚ä¸Šä¸‹æ–‡ã€ï¼ˆå¦‚ Cookieã€è¯·æ±‚å¤´ã€URL å‚æ•°ï¼‰</code>ã€‚</p>
</li>
<li>
<p>ç¼“å­˜å†…å®¹ï¼šç¼“å­˜å†…å®¹çš„æœ¬è´¨å°±æ˜¯ç¼“å­˜åŠ¨æ€æ•°æ®ï¼Œç¼“å­˜ä¹‹åä¼šè¢«çº³å…¥<code>é™æ€å¤–å£³(Static Shell)</code>,é™æ€å¤–å£³å°±ç±»ä¼¼äº<code>æ¯›å¯æˆ¿</code>ï¼Œä¼šæå‰æŠŠç»“æ„æ­å»ºå¥½ï¼Œåç»­åœ¨é€šè¿‡(æµå¼ä¼ è¾“)å¡«å……é‡Œé¢çš„åŠ¨æ€å†…å®¹ã€‚</p>
</li>
</ul>





















<table><thead><tr><th>ä¼ ç»Ÿæ–¹æ¡ˆ</th><th>Cache Components</th></tr></thead><tbody><tr><td>é™æ€é¡µé¢ï¼šæ•°æ®æ— æ³•å®æ—¶æ›´æ–°</td><td>æ”¯æŒç¼“å­˜å†…å®¹é‡æ–°éªŒè¯ï¼ŒåŠ¨æ€å†…å®¹æµå¼è¡¥å……</td></tr><tr><td>åŠ¨æ€é¡µé¢ï¼šåˆå§‹åŠ è½½æ…¢ã€æœåŠ¡å™¨å‹åŠ›å¤§</td><td>é™æ€å¤–å£³ä¼˜å…ˆè¿”å›ï¼ŒåŠ¨æ€å†…å®¹å¹¶è¡Œæ¸²æŸ“</td></tr><tr><td>å®¢æˆ·ç«¯æ¸²æŸ“ï¼šbundle ä½“ç§¯å¤§ã€é¦–å±æ…¢</td><td>æœåŠ¡å™¨é¢„æ¸²æŸ“æ ¸å¿ƒå†…å®¹ï¼Œå®¢æˆ·ç«¯ä»…è¡¥å……åŠ¨æ€éƒ¨åˆ†</td></tr></tbody></table>
<h4 data-id="heading-2">å¯ç”¨Cache Components</h4>
<p>Cache Components ä¸ºå¯é€‰åŠŸèƒ½ï¼Œéœ€åœ¨ Next é…ç½®æ–‡ä»¶ä¸­æ˜¾å¼å¯ç”¨ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-attr">cacheComponents</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¯ç”¨ç¼“å­˜ç»„ä»¶</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<h5 data-id="heading-3">1. é™æ€å†…å®¹å±•ç¤º</h5>
<p>é€‚ç”¨åœºæ™¯ï¼šä»…ä¾èµ–åŒæ­¥ I/Oï¼ˆå¦‚ fs.readFileSyncï¼‰ã€æ¨¡å—å¯¼å…¥ã€çº¯è®¡ç®—çš„ç»„ä»¶</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'node:fs'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> data = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'data.json'</span>, <span class="hljs-string">'utf-8'</span>) <span class="hljs-comment">//æœ¬åœ°æ–‡ä»¶è¯»å–</span>
    <span class="hljs-keyword">const</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data)
    <span class="hljs-keyword">const</span> impData = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../../../data.json'</span>) <span class="hljs-comment">//æ¨¡å—å¯¼å…¥</span>
    <span class="hljs-keyword">const</span> names = impData.<span class="hljs-property">list</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span>item.<span class="hljs-property">name</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">','</span>) <span class="hljs-comment">//çº¯è®¡ç®—</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(json)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(impData)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(names)
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                {json.list.map((item: any) =&gt; (
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>&gt;</span>{item.name} - {item.age}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                ))}
            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f95aabdf399e4a2d95c79ed6f10f6f33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766312592&amp;x-signature=RnQ7Mi0mGCLUMhn9%2BqvzEcigj2I%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-4">2.1 åŠ¨æ€å†…å®¹å±•ç¤º</h5>
<p>é€‚ç”¨åœºæ™¯ï¼šfetchè¯·æ±‚ã€cookiesã€headersç­‰åŠ¨æ€æ•°æ®</p>
<blockquote>
<p>åŠ¨æ€å†…å®¹å¿…é¡»é…åˆSuspenseä½¿ç”¨ã€‚</p>
</blockquote>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
<span class="hljs-keyword">import</span> { cookies } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/headers"</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">DynamicContent</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://www.mocklib.com/mock/random/name'</span>) <span class="hljs-comment">//éšæœºç”Ÿæˆä¸€ä¸ªåç§°</span>
    <span class="hljs-keyword">const</span> json = <span class="hljs-keyword">await</span> data.<span class="hljs-title function_">json</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(json)
    <span class="hljs-keyword">const</span> cookieStore = <span class="hljs-keyword">await</span> <span class="hljs-title function_">cookies</span>() <span class="hljs-comment">//è·å–cookie</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cookieStore)
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>åŠ¨æ€å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>åç§°ï¼š{json.name}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>åŠ¨æ€å†…å®¹Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">DynamicContent</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/676b89ba6c6d42d6ab7c9a92394cc9ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766312592&amp;x-signature=Kxp5U%2BwHvBNPLJuel8WBCsP8NWU%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-5">2.2 å®ç°åŸç†</h5>
<p>Next.js ä¼šé€šè¿‡<code>(Partial Prerendering/PPR)</code>æŠ€æœ¯,å®ç°é™æ€å¤–å£³(Static Shell)æ¸²æŸ“ï¼Œæä¾›å ä½ç¬¦ï¼Œå½“ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œå†é€šè¿‡æµå¼ä¼ è¾“(Streaming)å¡«å……é‡Œé¢çš„åŠ¨æ€å†…å®¹ï¼Œä»¥æ­¤æå‡é¦–å±åŠ è½½é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adc6b9ee874949d8a9d0f691ec8706ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766312592&amp;x-signature=A1zRfCxECpKB8uaQy3lxpmtTirA%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘ä»¬è§‚å¯Ÿä¸Šå›¾</p>
<ul>
<li>
<p><code>&lt;h1&gt;Home&lt;/h1&gt;</code>ï¼š çº¯é™æ€å†…å®¹ï¼Œå±äºé™æ€å¤–å£³çš„ä¸€éƒ¨åˆ†ï¼Œæ„å»º / è¯·æ±‚æ—¶ç›´æ¥æ¸²æŸ“ï¼Œæµè§ˆå™¨èƒ½ç«‹å³æ˜¾ç¤ºã€‚</p>
</li>
<li>
<p><code>&lt;template id="B:0"&gt;&lt;/template&gt;</code> åŠ¨æ€å†…å®¹çš„å®¹å™¨æ¨¡æ¿ï¼Œåç»­ç”¨æ¥æŒ‚è½½å¼‚æ­¥åŠ è½½çš„åŠ¨æ€å†…å®¹</p>
</li>
<li>
<p><code>&lt;div&gt;åŠ¨æ€å†…å®¹Loading...&lt;/div&gt;</code>ï¼šå ä½ç¬¦ï¼ˆfallbackï¼‰ï¼Œå±äºé™æ€å¤–å£³çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨åŠ¨æ€å†…å®¹åŠ è½½å®Œæˆå‰æ˜¾ç¤ºã€‚</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/030007fe15934d0f83f932a99648ac2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766312592&amp;x-signature=nGnY%2FrvETk%2BlJalRcMgijMwztQs%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>
<p>è¿™ä¸ª <code>&lt;div&gt;</code> åˆå§‹ä¸º hiddenï¼Œæ˜¯æœåŠ¡å™¨å¼‚æ­¥æ¸²æŸ“å®Œæˆçš„åŠ¨æ€å†…å®¹ï¼Œç­‰å¾…å®¢æˆ·ç«¯è„šæœ¬è§¦å‘åæ›¿æ¢åˆ°å ä½ç¬¦ä½ç½®ã€‚</p>
</li>
<li>
<p>id="S:0" ä¸å‰é¢çš„ <code>&lt;template id="B:0"&gt;</code> ä¸€ä¸€å¯¹åº”ï¼Œæ˜¯ â€œåŠ¨æ€å†…å®¹ - å ä½ç¬¦â€ çš„å…³è”æ ‡è¯†ã€‚</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/704fcb36a784467f820198b31d07b674~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766312592&amp;x-signature=1NjqnpghA8GewBhv6z99wmixCoE%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-ts" lang="ts">$RC(<span class="hljs-string">"B:0"</span>, <span class="hljs-string">"S:0"</span>) <span class="hljs-comment">// å…³é”®è°ƒç”¨ï¼šå…³è” B:0 å ä½ç¬¦å’Œ S:0 åŠ¨æ€å†…å®¹</span>
</code></pre>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>C</mi><mtext>ï¼ˆ</mtext><mi>R</mi><mi>e</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>C</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>R</mi><mi>e</mi><mi>p</mi><mi>l</mi><mi>a</mi><mi>c</mi><mi>e</mi><mtext>ï¼‰ï¼šæ‰¾åˆ°</mtext><mi>i</mi><mi>d</mi><mo>=</mo><mi mathvariant="normal">"</mi><mi>B</mi><mo>:</mo><mn>0</mn><mi mathvariant="normal">"</mi><mtext>çš„å ä½ç¬¦å’Œ</mtext><mi>i</mi><mi>d</mi><mo>=</mo><mi mathvariant="normal">"</mi><mi>S</mi><mo>:</mo><mn>0</mn><mi mathvariant="normal">"</mi><mtext>çš„åŠ¨æ€å†…å®¹ï¼Œå°†å…¶åŠ å…¥æ›¿æ¢é˜Ÿåˆ—</mtext></mrow><annotation encoding="application/x-tex">RCï¼ˆReact Content Replaceï¼‰ï¼šæ‰¾åˆ° id="B:0" çš„å ä½ç¬¦å’Œ id="S:0" çš„åŠ¨æ€å†…å®¹ï¼Œå°†å…¶åŠ å…¥æ›¿æ¢é˜Ÿåˆ— </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">RC</span><span class="mord cjk_fallback">ï¼ˆ</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.07153em;">tC</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.00773em;">tR</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ce</span><span class="mord cjk_fallback">ï¼‰ï¼šæ‰¾åˆ°</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">"</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">0"</span><span class="mord cjk_fallback">çš„å ä½ç¬¦å’Œ</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">"</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">0"</span><span class="mord cjk_fallback">çš„åŠ¨æ€å†…å®¹ï¼Œå°†å…¶åŠ å…¥æ›¿æ¢é˜Ÿåˆ—</span></span></span></span></span>RBã€‚</li>
<li>$RVï¼ˆReact Content Renderï¼‰ï¼šåœ¨åŠ¨ç”»å¸§ / è¶…æ—¶åæ‰§è¡Œæ›¿æ¢ï¼Œç§»é™¤åŠ è½½å ä½ç¬¦ï¼Œå°†åŠ¨æ€å†…å®¹æ’å…¥åˆ°é¡µé¢ä¸­ï¼Œå®Œæˆæœ€ç»ˆæ¸²æŸ“ã€‚</li>
</ul>
<h5 data-id="heading-6">2.3 éç¡®å®šæ“ä½œ</h5>
<p>ä¾‹å¦‚: <code>éšæœºæ•°</code>ã€<code>æ—¶é—´æˆ³</code>ç­‰éç¡®å®šæ“ä½œï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å¯èƒ½ç”Ÿæˆä¸åŒç»“æœã€‚</p>
<p>ç›´æ¥ä½¿ç”¨å°±ä¼šæŠ¥é”™å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Error: Route "/home" used <code>Math.random()</code> before accessing either uncached data (e.g. <code>fetch()</code>) or Request data (e.g. <code>cookies()</code>, <code>headers()</code>, <code>connection()</code>, and <code>searchParams</code>). Accessing random values synchronously in a Server Component requires reading one of these data sources first. Alternatively, consider moving this expression into a Client Component or Cache Component. See more info here: <a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fmessages%2Fnext-prerender-random" target="_blank" title="https://nextjs.org/docs/messages/next-prerender-random" ref="nofollow noopener noreferrer">nextjs.org/docs/messagâ€¦</a>
at DynamicContent (page.tsx:5:25)
at Home (page.tsx:27:17)</p>
</blockquote>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>ä½¿ç”¨SuspenseåŒ…è£¹ï¼Œç„¶åä½¿ç”¨connectionè¡¨ç¤ºä¸è¦é¢„æ¸²æŸ“è¿™éƒ¨åˆ†ã€‚</p>
<p>Next.jsé»˜è®¤ä¼šå°è¯•å°½å¯èƒ½å¤šåœ°é™æ€é¢„æ¸²æŸ“é¡µé¢å†…å®¹ã€‚ä½†åƒ <code>Math.random()</code> è¿™æ ·çš„å€¼æ¯æ¬¡è°ƒç”¨ç»“æœéƒ½ä¸åŒï¼Œå¦‚æœåœ¨é¢„æ¸²æŸ“æ—¶æ‰§è¡Œï¼Œé‚£è¿™ä¸ª"éšæœºå€¼"å°±è¢«å›ºå®šäº†ï¼Œå¤±å»äº†æ„ä¹‰ã€‚
é€šè¿‡åœ¨ Math.random() ä¹‹å‰è°ƒç”¨ await connection()ï¼Œä½ æ˜ç¡®å‘Šè¯‰ Next.jsï¼š</p>
<ul>
<li>ä¸è¦é¢„æ¸²æŸ“è¿™éƒ¨åˆ†</li>
<li>ç­‰çœŸæ­£æœ‰ç”¨æˆ·è¯·æ±‚æ—¶å†æ‰§è¡Œ</li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
<span class="hljs-keyword">import</span> { connection } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">DynamicContent</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">connection</span>() <span class="hljs-comment">//ä½¿ç”¨connectionè¡¨ç¤ºä¸è¦é¢„æ¸²æŸ“è¿™éƒ¨åˆ†</span>
    <span class="hljs-keyword">const</span> random = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()
    <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(random, now)
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>åŠ¨æ€å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>åç§°ï¼š{random}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æ—¶é—´ï¼š{now}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>åŠ¨æ€å†…å®¹Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">DynamicContent</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<h5 data-id="heading-7">3. ç¼“å­˜å†…å®¹å±•ç¤º</h5>
<p>ç¼“å­˜ç»„ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<code>use cache</code>å£°æ˜è¿™æ˜¯ä¸€ä¸ªç¼“å­˜ç»„ä»¶ï¼Œç„¶åä½¿ç”¨<code>cacheLife</code>å£°æ˜ç¼“å­˜æ—¶é—´ã€‚</p>
<p>cacheLifeå‚æ•°ï¼š</p>
<ul>
<li><code>stale</code>ï¼šå®¢æˆ·ç«¯åœ¨æ­¤æ—¶é—´å†…ç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œä¸å‘æœåŠ¡å™¨å‘è¯·æ±‚<code>(å•ä½:ç§’)</code></li>
<li><code>revalidate</code>ï¼šè¶…è¿‡æ­¤æ—¶é—´åï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æ—¶ä¼šåœ¨åå°é‡æ–°ç”Ÿæˆå†…å®¹<code>(å•ä½:ç§’)</code></li>
<li><code>expire</code>ï¼šè¶…è¿‡æ­¤æ—¶é—´æ— è®¿é—®ï¼Œç¼“å­˜å®Œå…¨å¤±æ•ˆï¼Œä¸‹æ¬¡è¯·æ±‚éœ€è¦ç­‰å¾…é‡æ–°è®¡ç®—<code>(å•ä½:ç§’)</code></li>
</ul>
<p>é¢„è®¾å‚æ•°:</p>






















































<table><thead><tr><th>Profile</th><th>é€‚ç”¨åœºæ™¯</th><th>stale</th><th>revalidate</th><th>expire</th></tr></thead><tbody><tr><td>seconds</td><td>å®æ—¶æ•°æ®ï¼ˆè‚¡ç¥¨ã€æ¯”åˆ†ï¼‰</td><td>30ç§’</td><td>1ç§’</td><td>1åˆ†é’Ÿ</td></tr><tr><td>minutes</td><td>é¢‘ç¹æ›´æ–°ï¼ˆç¤¾äº¤åŠ¨æ€ï¼‰</td><td>5åˆ†é’Ÿ</td><td>1åˆ†é’Ÿ</td><td>1å°æ—¶</td></tr><tr><td>hours</td><td>æ¯æ—¥å¤šæ¬¡æ›´æ–°ï¼ˆåº“å­˜ã€å¤©æ°”ï¼‰</td><td>5åˆ†é’Ÿ</td><td>1å°æ—¶</td><td>1å¤©</td></tr><tr><td>days</td><td>æ¯æ—¥æ›´æ–°ï¼ˆåšå®¢æ–‡ç« ï¼‰</td><td>5åˆ†é’Ÿ</td><td>1å¤©</td><td>1å‘¨</td></tr><tr><td>weeks</td><td>æ¯å‘¨æ›´æ–°ï¼ˆæ’­å®¢ï¼‰</td><td>5åˆ†é’Ÿ</td><td>1å‘¨</td><td>30å¤©</td></tr><tr><td>max</td><td>å¾ˆå°‘å˜åŒ–ï¼ˆæ³•å¾‹é¡µé¢ï¼‰</td><td>5åˆ†é’Ÿ</td><td>30å¤©</td><td>1å¹´</td></tr></tbody></table>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
<span class="hljs-keyword">import</span> { cacheLife } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/cache"</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">DynamicContent</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-string">'use cache'</span>
    <span class="hljs-title function_">cacheLife</span>(<span class="hljs-string">"hours"</span>) <span class="hljs-comment">//ä½¿ç”¨é¢„è®¾å‚æ•°</span>
    <span class="hljs-comment">//cacheLife({stale: 30, revalidate: 1, expire: 1}) //ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°</span>
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://www.mocklib.com/mock/random/name'</span>)
    <span class="hljs-keyword">const</span> json = <span class="hljs-keyword">await</span> data.<span class="hljs-title function_">json</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(json)
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>åŠ¨æ€å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>åç§°ï¼š{json.name}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>åŠ¨æ€å†…å®¹Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">DynamicContent</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3df9733f502044349a3b3b351098553e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766312592&amp;x-signature=avUfm6e1smUSYWWY04XJHBq239Y%3D" alt="8.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»é›¶åˆ°ä¸€ï¼šæ‰“é€ ä¸“ä¸šçº§å°è¯´åœ°å›¾è®¾è®¡å·¥å…·çš„æŠ€æœ¯å®è·µ]]></title>    <link>https://juejin.cn/post/7583158173978427402</link>    <guid>https://juejin.cn/post/7583158173978427402</guid>    <pubDate>2025-12-14T04:30:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583158173978427402" data-draft-id="7583174749066313774" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»é›¶åˆ°ä¸€ï¼šæ‰“é€ ä¸“ä¸šçº§å°è¯´åœ°å›¾è®¾è®¡å·¥å…·çš„æŠ€æœ¯å®è·µ"/> <meta itemprop="keywords" content="å‰ç«¯,Electron"/> <meta itemprop="datePublished" content="2025-12-14T04:30:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¾™å›½æµªå­"/> <meta itemprop="url" content="https://juejin.cn/user/1943592291275886"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»é›¶åˆ°ä¸€ï¼šæ‰“é€ ä¸“ä¸šçº§å°è¯´åœ°å›¾è®¾è®¡å·¥å…·çš„æŠ€æœ¯å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592291275886/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¾™å›½æµªå­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T04:30:47.000Z" title="Sun Dec 14 2025 04:30:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ—ºï¸ ä»é›¶åˆ°ä¸€ï¼šæ‰“é€ ä¸“ä¸šçº§å°è¯´åœ°å›¾è®¾è®¡å·¥å…·çš„æŠ€æœ¯å®è·µ</h2>
<blockquote>
<p>ğŸ’¡ æœ¬æ–‡è¯¦ç»†ä»‹ç» 51mazi é¡¹ç›®ä¸­åœ°å›¾è®¾è®¡é¡µçš„æ•´ä½“æ¶æ„ä¸æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº Vue 3 + Canvas çš„ä¸“ä¸šçº§åœ°å›¾ç¼–è¾‘å™¨ï¼Œé›†æˆäº†å¤šç§ç»˜å›¾å·¥å…·ã€èµ„æºç®¡ç†ã€ç¼©æ”¾æ§åˆ¶ç­‰å®Œæ•´åŠŸèƒ½ã€‚é€šè¿‡æ¨¡å—åŒ–çš„ Composables æ¶æ„è®¾è®¡ï¼Œå®ç°äº†é«˜å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§çš„ä»£ç ç»“æ„ã€‚</p>
</blockquote>
<h3 data-id="heading-1">ğŸ“‹ ç›®å½•</h3>
<ul>
<li><a href="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF" title="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF">é¡¹ç›®èƒŒæ™¯</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88" title="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88">æŠ€æœ¯æ¶æ„æ¦‚è§ˆ</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97" title="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97">æ ¸å¿ƒåŠŸèƒ½æ¨¡å—</a></li>
<li><a href="#%E6%A8%A1%E5%9D%97%E5%8C%96%E8%AE%BE%E8%AE%A1" title="#%E6%A8%A1%E5%9D%97%E5%8C%96%E8%AE%BE%E8%AE%A1">æ¨¡å—åŒ–è®¾è®¡</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E4%BA%AE%E7%82%B9" title="#%E6%8A%80%E6%9C%AF%E4%BA%AE%E7%82%B9">æŠ€æœ¯äº®ç‚¹</a></li>
<li><a href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B" title="#%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B">æ€»ç»“ä¸å±•æœ›</a></li>
</ul>
<h3 data-id="heading-2">ğŸ¯ é¡¹ç›®èƒŒæ™¯</h3>
<p>åœ¨å°è¯´åˆ›ä½œè¿‡ç¨‹ä¸­ï¼Œä½œè€…ç»å¸¸éœ€è¦ç»˜åˆ¶æ•…äº‹ä¸­çš„åœ°å›¾æ¥å¸®åŠ©è¯»è€…ç†è§£æ•…äº‹èƒŒæ™¯å’Œåœ°ç†å…³ç³»ã€‚ä¼ ç»Ÿçš„å†™ä½œè½¯ä»¶å¾€å¾€ç¼ºä¹è¿™æ ·çš„å¯è§†åŒ–å·¥å…·ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ 51mazi ä¸­é›†æˆäº†åŸºäº Canvas çš„ä¸“ä¸šçº§åœ°å›¾è®¾è®¡åŠŸèƒ½ã€‚</p>
<h4 data-id="heading-3">ğŸ—ºï¸ åœ°å›¾è®¾è®¡å·¥å…·</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/795bd303ec2b415b93720627693383d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zu95rWq5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766291447&amp;x-signature=0G2BSM99f3u1O1yiM%2B%2BJeekBvr8%3D" alt="maps.png" loading="lazy"/></p>
<p><em>å¼ºå¤§çš„åœ°å›¾è®¾è®¡å·¥å…· - ä¸“ä¸šçº§ Canvas ç»˜å›¾ä¸èµ„æºç®¡ç†</em></p>
<h4 data-id="heading-4">âœ¨ åŠŸèƒ½ç‰¹æ€§æ¦‚è§ˆ</h4>
<p>åœ°å›¾è®¾è®¡é¡µæä¾›äº†å®Œæ•´çš„ç»˜å›¾å·¥å…·é›†ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>ğŸ¨ <strong>10+ ç§ç»˜å›¾å·¥å…·</strong>: ç§»åŠ¨ã€é€‰æ¡†ã€ç”»ç¬”ã€æ©¡çš®æ“¦ã€å½¢çŠ¶ã€æ²¹æ¼†æ¡¶ã€æ–‡å­—ã€èµ„æºã€èƒŒæ™¯ç­‰</li>
<li>ğŸ” <strong>ç”»å¸ƒæ§åˆ¶</strong>: ç¼©æ”¾ã€å¹³ç§»ã€é‡ç½®è§†å›¾ï¼Œæ”¯æŒé¼ æ ‡æ»šè½®å’Œå¿«æ·é”®æ“ä½œ</li>
<li>ğŸ¯ <strong>ç²¾ç¡®æ“ä½œ</strong>: é€‰æ¡†å·¥å…·æ”¯æŒé€‰æ‹©ã€ç§»åŠ¨ã€è°ƒæ•´å¤§å°ã€æ—‹è½¬ç­‰æ“ä½œ</li>
<li>ğŸ’¾ <strong>æ•°æ®ç®¡ç†</strong>: å®Œæ•´çš„æ’¤é”€/é‡åšç³»ç»Ÿï¼Œè‡ªåŠ¨ä¿å­˜å’ŒåŠ è½½åœ°å›¾æ•°æ®</li>
<li>ğŸ¨ <strong>å‚æ•°æ§åˆ¶</strong>: é¢œè‰²é€‰æ‹©å™¨ã€å¤§å°æ»‘å—ã€é€æ˜åº¦æ»‘å—ï¼Œç²¾ç¡®æ§åˆ¶ç»˜åˆ¶æ•ˆæœ</li>
<li>ğŸ–¼ï¸ <strong>èµ„æºç®¡ç†</strong>: é¢„è®¾å›¾æ ‡èµ„æºåº“ï¼Œæ”¯æŒæ‹–æ‹½æ·»åŠ å’Œè°ƒæ•´</li>
<li>âŒ¨ï¸ <strong>å¿«æ·é”®æ”¯æŒ</strong>: å®Œæ•´çš„é”®ç›˜å¿«æ·é”®ç³»ç»Ÿï¼Œæå‡æ“ä½œæ•ˆç‡</li>
</ul>
<h3 data-id="heading-5">ğŸ—ï¸ æŠ€æœ¯æ¶æ„æ¦‚è§ˆ</h3>
<h4 data-id="heading-6">æŠ€æœ¯æ ˆ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ ¸å¿ƒæŠ€æœ¯æ ˆ</span>
{
  <span class="hljs-string">"vue"</span>: <span class="hljs-string">"^3.5.13"</span>,           <span class="hljs-comment">// Vue 3 Composition API</span>
  <span class="hljs-string">"element-plus"</span>: <span class="hljs-string">"^2.10.1"</span>,  <span class="hljs-comment">// UI ç»„ä»¶åº“</span>
  <span class="hljs-string">"canvas"</span>: <span class="hljs-string">"åŸç”Ÿ Canvas API"</span>  <span class="hljs-comment">// ç»˜å›¾å¼•æ“</span>
}
</code></pre>
<h4 data-id="heading-7">æ•´ä½“æ¶æ„è®¾è®¡</h4>
<p>åœ°å›¾è®¾è®¡é¡µé‡‡ç”¨ <strong>æ¨¡å—åŒ–çš„ Composables æ¶æ„</strong>ï¼Œå°†ä¸åŒåŠŸèƒ½æ‹†åˆ†ä¸ºç‹¬ç«‹çš„ composable å‡½æ•°ï¼Œå®ç°äº†æ¸…æ™°çš„ä»£ç ç»„ç»‡å’Œé«˜åº¦å¯ç»´æŠ¤æ€§ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">MapDesign.vue (ä¸»ç»„ä»¶)
â”œâ”€â”€ åŸºç¡€ Composables
â”‚   â”œâ”€â”€ useCanvasState.js      <span class="hljs-comment"># ç”»å¸ƒçŠ¶æ€ç®¡ç†ï¼ˆç¼©æ”¾ã€å¹³ç§»ã€è¾¹ç•Œï¼‰</span>
â”‚   â”œâ”€â”€ useCoordinate.js       <span class="hljs-comment"># åæ ‡è½¬æ¢å·¥å…·</span>
â”‚   â”œâ”€â”€ useHistory.js          <span class="hljs-comment"># å†å²è®°å½•ç®¡ç†ï¼ˆæ’¤é”€/é‡åšï¼‰</span>
â”‚   â”œâ”€â”€ useElements.js         <span class="hljs-comment"># å…ƒç´ æ•°æ®ç®¡ç†</span>
â”‚   â”œâ”€â”€ useRender.js           <span class="hljs-comment"># æ¸²æŸ“å‡½æ•°é›†åˆ</span>
â”‚   â””â”€â”€ useCanvas.js            <span class="hljs-comment"># ç”»å¸ƒæ¸²æŸ“å’Œç®¡ç†</span>
â”‚
â””â”€â”€ å·¥å…· Composables
    â”œâ”€â”€ usePencilTool.js        <span class="hljs-comment"># ç”»ç¬”å·¥å…·</span>
    â”œâ”€â”€ useEraserTool.js        <span class="hljs-comment"># æ©¡çš®æ“¦å·¥å…·</span>
    â”œâ”€â”€ useShapeTool.js         <span class="hljs-comment"># å½¢çŠ¶å·¥å…·ï¼ˆçº¿æ¡ã€çŸ©å½¢ã€åœ†å½¢ç­‰ï¼‰</span>
    â”œâ”€â”€ useTextTool.js          <span class="hljs-comment"># æ–‡å­—å·¥å…·</span>
    â”œâ”€â”€ useBucketTool.js        <span class="hljs-comment"># æ²¹æ¼†æ¡¶å·¥å…·</span>
    â”œâ”€â”€ useResourceTool.js      <span class="hljs-comment"># èµ„æºå·¥å…·</span>
    â”œâ”€â”€ useSelectTool.js        <span class="hljs-comment"># é€‰æ¡†å·¥å…·ï¼ˆé€‰æ‹©ã€ç§»åŠ¨ã€è°ƒæ•´ã€æ—‹è½¬ï¼‰</span>
    â”œâ”€â”€ useMoveTool.js          <span class="hljs-comment"># ç§»åŠ¨å·¥å…·ï¼ˆå¹³ç§»ç”»å¸ƒï¼‰</span>
    â””â”€â”€ useBackgroundTool.js    <span class="hljs-comment"># èƒŒæ™¯å·¥å…·</span>
</code></pre>
<h4 data-id="heading-8">æ ¸å¿ƒç»„ä»¶ç»“æ„</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- src/renderer/src/views/MapDesign.vue --&gt;
&lt;template&gt;
  &lt;div class="map-design"&gt;
    &lt;!-- å·¥å…·æ  --&gt;
    &lt;MapToolbar
      v-model="tool"
      :shape-tool-type="shapeToolType"
      @update:model-value="onToolChange"
      @clear="handleClearCanvas"
      @resource-select="selectResource"
      @save-map="handleSaveMap"
    /&gt;

    &lt;!-- é¢œè‰²é€‰æ‹©å™¨ --&gt;
    &lt;Transition name="color-picker-fade"&gt;
      &lt;div v-if="showColorPicker" class="color-picker-container"&gt;
        &lt;el-color-picker v-model="currentColor" /&gt;
      &lt;/div&gt;
    &lt;/Transition&gt;

    &lt;!-- æ»‘å—æ§åˆ¶å·¥å…· --&gt;
    &lt;FloatingSidebar :visible="tool === 'pencil' || tool === 'eraser' || tool === 'shape'"&gt;
      &lt;MapSlider v-model="size" label="å¤§å°" /&gt;
      &lt;MapSlider v-model="opacity" label="é€æ˜åº¦" /&gt;
    &lt;/FloatingSidebar&gt;

    &lt;!-- ç”»å¸ƒå®¹å™¨ --&gt;
    &lt;div class="editor-container" @wheel="handleWheel"&gt;
      &lt;canvas
        ref="canvasRef"
        :width="canvasDisplayWidth"
        :height="canvasDisplayHeight"
        @mousedown="handleCanvasMouseDown"
        @mousemove="handleCanvasMouseMove"
        @mouseup="handleCanvasMouseUp"
      /&gt;
    &lt;/div&gt;

    &lt;!-- ç¼©æ”¾æ§åˆ¶å™¨å’Œæ’¤é”€/å›é€€æŒ‰é’® --&gt;
    &lt;MapZoomControls
      :scale="canvasState.scale.value"
      @zoom-in="handleZoomIn"
      @zoom-out="handleZoomOut"
      @reset-zoom="handleResetZoom"
      @undo="handleUndo"
      @redo="handleRedo"
    /&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>å®Œæ•´ä»£ç è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fviews%2FMapDesign.vue" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/views/MapDesign.vue" ref="nofollow noopener noreferrer">src/renderer/src/views/MapDesign.vue</a></p>
</blockquote>
<h3 data-id="heading-9">ğŸ”§ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—</h3>
<h4 data-id="heading-10">1. ç”»å¸ƒçŠ¶æ€ç®¡ç† (useCanvasState)</h4>
<p>ç®¡ç†ç”»å¸ƒçš„ç¼©æ”¾ã€å¹³ç§»ã€è¾¹ç•Œç­‰æ ¸å¿ƒçŠ¶æ€ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ ¸å¿ƒçŠ¶æ€ç®¡ç†</span>
<span class="hljs-keyword">const</span> canvasState = <span class="hljs-title function_">useCanvasState</span>()

<span class="hljs-comment">// ä¸»è¦çŠ¶æ€</span>
- <span class="hljs-attr">scale</span>: ç”»å¸ƒç¼©æ”¾æ¯”ä¾‹
- scrollX/<span class="hljs-attr">scrollY</span>: ç”»å¸ƒå¹³ç§»åç§»
- <span class="hljs-attr">contentBounds</span>: å†…å®¹è¾¹ç•Œï¼ˆç”¨äºè‡ªåŠ¨è°ƒæ•´ç”»å¸ƒå¤§å°ï¼‰
- canvasDisplayWidth/<span class="hljs-title class_">Height</span>: ç”»å¸ƒæ˜¾ç¤ºå°ºå¯¸
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2FuseCanvasState.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/useCanvasState.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/useCanvasState.js</a></p>
</blockquote>
<h4 data-id="heading-11">2. å…ƒç´ ç®¡ç†ç³»ç»Ÿ (useElements)</h4>
<p>ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç»˜åˆ¶å…ƒç´ ï¼ŒåŒ…æ‹¬ç”»ç¬”è·¯å¾„ã€å½¢çŠ¶ã€æ–‡å­—ã€èµ„æºã€å¡«å……åŒºåŸŸç­‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…ƒç´ ç±»å‹</span>
<span class="hljs-keyword">const</span> elements = <span class="hljs-title function_">useElements</span>()

<span class="hljs-comment">// å…ƒç´ åˆ†ç±»</span>
- <span class="hljs-attr">freeDrawElements</span>: ç”»ç¬”ç»˜åˆ¶çš„è·¯å¾„
- <span class="hljs-attr">shapeElements</span>: å½¢çŠ¶å…ƒç´ ï¼ˆçº¿æ¡ã€çŸ©å½¢ã€åœ†å½¢ç­‰ï¼‰
- <span class="hljs-attr">textElements</span>: æ–‡å­—å…ƒç´ 
- <span class="hljs-attr">resourceElements</span>: èµ„æºå…ƒç´ ï¼ˆå›¾æ ‡ã€å›¾ç‰‡ï¼‰
- <span class="hljs-attr">fillElements</span>: å¡«å……åŒºåŸŸ

<span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•</span>
- <span class="hljs-title function_">serialize</span>(): åºåˆ—åŒ–æ‰€æœ‰å…ƒç´ ä¸º <span class="hljs-title class_">JSON</span>
- <span class="hljs-title function_">deserialize</span>(): ä» <span class="hljs-title class_">JSON</span> æ¢å¤å…ƒç´ 
- <span class="hljs-title function_">clearAll</span>(): æ¸…ç©ºæ‰€æœ‰å…ƒç´ 
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2FuseElements.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/useElements.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/useElements.js</a></p>
</blockquote>
<h4 data-id="heading-12">3. å†å²è®°å½•ç³»ç»Ÿ (useHistory)</h4>
<p>å®ç°å®Œæ•´çš„æ’¤é”€/é‡åšåŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å†å²è®°å½•ç®¡ç†</span>
<span class="hljs-keyword">const</span> { history } = <span class="hljs-title function_">useHistory</span>(canvasRef)

<span class="hljs-comment">// æ ¸å¿ƒåŠŸèƒ½</span>
- <span class="hljs-title function_">saveState</span>(): ä¿å­˜å½“å‰çŠ¶æ€
- <span class="hljs-title function_">undo</span>(): æ’¤é”€æ“ä½œ
- <span class="hljs-title function_">redo</span>(): é‡åšæ“ä½œ
- <span class="hljs-title function_">canUndo</span>(): æ˜¯å¦å¯ä»¥æ’¤é”€
- <span class="hljs-title function_">canRedo</span>(): æ˜¯å¦å¯ä»¥é‡åš
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2FuseHistory.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/useHistory.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/useHistory.js</a></p>
</blockquote>
<h4 data-id="heading-13">4. æ¸²æŸ“ç³»ç»Ÿ (useRender)</h4>
<p>ç»Ÿä¸€çš„æ¸²æŸ“å‡½æ•°é›†åˆï¼Œè´Ÿè´£ç»˜åˆ¶å„ç§å…ƒç´ ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¸²æŸ“å‡½æ•°</span>
<span class="hljs-keyword">const</span> renderFunctions = <span class="hljs-title function_">useRender</span>(canvasRef)

<span class="hljs-comment">// æ¸²æŸ“æ–¹æ³•</span>
- <span class="hljs-title function_">renderFreeDrawPath</span>(): æ¸²æŸ“ç”»ç¬”è·¯å¾„
- <span class="hljs-title function_">renderShape</span>(): æ¸²æŸ“å½¢çŠ¶ï¼ˆä½¿ç”¨ <span class="hljs-title class_">Rough</span>.<span class="hljs-property">js</span>ï¼‰
- <span class="hljs-title function_">renderText</span>(): æ¸²æŸ“æ–‡å­—
- <span class="hljs-title function_">renderResource</span>(): æ¸²æŸ“èµ„æºï¼ˆå›¾æ ‡/å›¾ç‰‡ï¼‰
- <span class="hljs-title function_">renderFill</span>(): æ¸²æŸ“å¡«å……åŒºåŸŸ
- <span class="hljs-title function_">renderSelection</span>(): æ¸²æŸ“é€‰æ¡†
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2FuseRender.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/useRender.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/useRender.js</a></p>
</blockquote>
<h4 data-id="heading-14">5. å·¥å…·ç³»ç»Ÿ</h4>
<p>æ¯ä¸ªç»˜å›¾å·¥å…·éƒ½æ˜¯ç‹¬ç«‹çš„ composableï¼Œå®ç°äº†ç»Ÿä¸€çš„æ¥å£ï¼š</p>
<h5 data-id="heading-15">ç”»ç¬”å·¥å…· (usePencilTool)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> pencilTool = <span class="hljs-title function_">usePencilTool</span>({
  canvasRef,
  elements,
  history,
  renderCanvas,
  color,
  size,
  opacity
})

<span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•</span>
- <span class="hljs-title function_">onMouseDown</span>(): å¼€å§‹ç»˜åˆ¶
- <span class="hljs-title function_">onMouseMove</span>(): ç»˜åˆ¶è¿‡ç¨‹
- <span class="hljs-title function_">onMouseUp</span>(): ç»“æŸç»˜åˆ¶
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2Ftools%2FusePencilTool.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/tools/usePencilTool.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/tools/usePencilTool.js</a></p>
</blockquote>
<h5 data-id="heading-16">é€‰æ¡†å·¥å…· (useSelectTool)</h5>
<p>æœ€å¤æ‚çš„å·¥å…·ä¹‹ä¸€ï¼Œæ”¯æŒé€‰æ‹©ã€ç§»åŠ¨ã€è°ƒæ•´å¤§å°ã€æ—‹è½¬ç­‰æ“ä½œï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> selectTool = <span class="hljs-title function_">useSelectTool</span>({
  elements,
  history,
  renderCanvas,
  selectedElementIds,
  canvasState,
  canvasCursor
})

<span class="hljs-comment">// æ ¸å¿ƒåŠŸèƒ½</span>
- å•é€‰å’Œå¤šé€‰
- æ‹–æ‹½ç§»åŠ¨å…ƒç´ 
- è°ƒæ•´å…ƒç´ å¤§å°ï¼ˆ<span class="hljs-number">8</span>ä¸ªæ§åˆ¶ç‚¹ï¼‰
- æ—‹è½¬å…ƒç´ 
- åˆ é™¤é€‰ä¸­å…ƒç´ 
- æ™ºèƒ½å…‰æ ‡æ ·å¼
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2Ftools%2FuseSelectTool.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/tools/useSelectTool.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/tools/useSelectTool.js</a></p>
</blockquote>
<h5 data-id="heading-17">å½¢çŠ¶å·¥å…· (useShapeTool)</h5>
<p>æ”¯æŒå¤šç§å½¢çŠ¶ç»˜åˆ¶ï¼šçº¿æ¡ã€çŸ©å½¢ã€åœ†å½¢ã€åœ†è§’çŸ©å½¢ã€äº”è§’æ˜Ÿã€ç®­å¤´ç­‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> shapeTool = <span class="hljs-title function_">useShapeTool</span>({
  canvasRef,
  elements,
  history,
  renderCanvas,
  color,
  size,
  opacity
})

<span class="hljs-comment">// æ”¯æŒçš„å½¢çŠ¶ç±»å‹</span>
- <span class="hljs-attr">line</span>: çº¿æ¡
- <span class="hljs-attr">rect</span>: çŸ©å½¢
- <span class="hljs-attr">circle</span>: åœ†å½¢
- <span class="hljs-attr">roundRect</span>: åœ†è§’çŸ©å½¢
- <span class="hljs-attr">star</span>: äº”è§’æ˜Ÿ
- <span class="hljs-attr">arrow</span>: ç®­å¤´
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2Ftools%2FuseShapeTool.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/tools/useShapeTool.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/tools/useShapeTool.js</a></p>
</blockquote>
<h5 data-id="heading-18">å…¶ä»–å·¥å…·</h5>
<ul>
<li><strong>æ©¡çš®æ“¦å·¥å…·</strong>: ç²¾ç¡®æ“¦é™¤å·²ç»˜åˆ¶å†…å®¹</li>
<li><strong>æ–‡å­—å·¥å…·</strong>: æ·»åŠ æ–‡å­—æ ‡æ³¨ï¼Œæ”¯æŒåŒå‡»ç¼–è¾‘</li>
<li><strong>æ²¹æ¼†æ¡¶å·¥å…·</strong>: åŒºåŸŸå¡«å……ï¼Œä½¿ç”¨æ´ªæ°´å¡«å……ç®—æ³•</li>
<li><strong>èµ„æºå·¥å…·</strong>: æ‹–æ‹½æ·»åŠ é¢„è®¾å›¾æ ‡å’Œå›¾ç‰‡</li>
<li><strong>ç§»åŠ¨å·¥å…·</strong>: å¹³ç§»ç”»å¸ƒè§†å›¾</li>
<li><strong>èƒŒæ™¯å·¥å…·</strong>: è®¾ç½®ç”»å¸ƒèƒŒæ™¯è‰²</li>
</ul>
<blockquote>
<p>ğŸ’¡ <strong>æ‰€æœ‰å·¥å…·å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Ftree%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2Ftools" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/tree/main/src/renderer/src/composables/map/tools" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/tools/</a></p>
</blockquote>
<h3 data-id="heading-19">ğŸ¨ æ¨¡å—åŒ–è®¾è®¡</h3>
<h4 data-id="heading-20">Composables æ¶æ„ä¼˜åŠ¿</h4>
<ol>
<li><strong>é«˜å†…èšä½è€¦åˆ</strong>: æ¯ä¸ª composable ä¸“æ³¨äºå•ä¸€èŒè´£</li>
<li><strong>æ˜“äºæµ‹è¯•</strong>: ç‹¬ç«‹çš„ composable ä¾¿äºå•å…ƒæµ‹è¯•</li>
<li><strong>ä»£ç å¤ç”¨</strong>: å¯ä»¥åœ¨å…¶ä»–ç»„ä»¶ä¸­å¤ç”¨ç›¸åŒçš„ composable</li>
<li><strong>æ˜“äºç»´æŠ¤</strong>: ä¿®æ”¹æŸä¸ªåŠŸèƒ½åªéœ€å…³æ³¨å¯¹åº”çš„ composable</li>
<li><strong>ç±»å‹å®‰å…¨</strong>: æ¸…æ™°çš„æ¥å£å®šä¹‰ï¼Œå‡å°‘é”™è¯¯</li>
</ol>
<h4 data-id="heading-21">å·¥å…·ç»Ÿä¸€æ¥å£</h4>
<p>æ‰€æœ‰å·¥å…· composable éƒ½éµå¾ªç»Ÿä¸€çš„æ¥å£æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å·¥å…·æ¥å£è§„èŒƒ</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useXxxTool</span>(<span class="hljs-params">options</span>) {
  <span class="hljs-comment">// çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> drawingActive = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
  
  <span class="hljs-comment">// æ–¹æ³•</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">onMouseDown</span>(<span class="hljs-params">pos</span>) { <span class="hljs-comment">/* ... */</span> }
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">onMouseMove</span>(<span class="hljs-params">pos</span>) { <span class="hljs-comment">/* ... */</span> }
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">onMouseUp</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ... */</span> }
  
  <span class="hljs-keyword">return</span> {
    drawingActive,
    onMouseDown,
    onMouseMove,
    onMouseUp
  }
}
</code></pre>
<h4 data-id="heading-22">äº‹ä»¶å¤„ç†æµç¨‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç»Ÿä¸€çš„äº‹ä»¶å¤„ç†</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleCanvasMouseDown</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-keyword">const</span> pos = <span class="hljs-title function_">getCanvasPos</span>(e) <span class="hljs-comment">// åæ ‡è½¬æ¢</span>
  
  <span class="hljs-comment">// æ ¹æ®å½“å‰å·¥å…·è°ƒç”¨å¯¹åº”çš„æ–¹æ³•</span>
  <span class="hljs-keyword">if</span> (tool.<span class="hljs-property">value</span> === <span class="hljs-string">'pencil'</span>) {
    pencilTool.<span class="hljs-title function_">onMouseDown</span>(pos)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tool.<span class="hljs-property">value</span> === <span class="hljs-string">'eraser'</span>) {
    eraserTool.<span class="hljs-title function_">onMouseDown</span>(pos)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tool.<span class="hljs-property">value</span> === <span class="hljs-string">'shape'</span>) {
    shapeTool.<span class="hljs-title function_">onMouseDown</span>(pos)
  }
  <span class="hljs-comment">// ... å…¶ä»–å·¥å…·</span>
}
</code></pre>
<h3 data-id="heading-23">âš¡ æŠ€æœ¯äº®ç‚¹</h3>
<h4 data-id="heading-24">1. åæ ‡è½¬æ¢ç³»ç»Ÿ</h4>
<p>å®ç°å±å¹•åæ ‡åˆ°ç”»å¸ƒåæ ‡çš„ç²¾ç¡®è½¬æ¢ï¼Œæ”¯æŒç¼©æ”¾å’Œå¹³ç§»ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åæ ‡è½¬æ¢</span>
<span class="hljs-keyword">const</span> { getCanvasPos } = <span class="hljs-title function_">useCoordinate</span>(
  canvasRef,
  editorContainerRef,
  canvasState.<span class="hljs-property">scale</span>,
  canvasState.<span class="hljs-property">scrollX</span>,
  canvasState.<span class="hljs-property">scrollY</span>
)

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> pos = <span class="hljs-title function_">getCanvasPos</span>(event) <span class="hljs-comment">// è‡ªåŠ¨å¤„ç†ç¼©æ”¾å’Œå¹³ç§»</span>
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2FuseCoordinate.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/useCoordinate.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/useCoordinate.js</a></p>
</blockquote>
<h4 data-id="heading-25">2. æ™ºèƒ½ç”»å¸ƒç®¡ç†</h4>
<p>è‡ªåŠ¨è°ƒæ•´ç”»å¸ƒå¤§å°ä»¥é€‚åº”å†…å®¹ï¼Œæ”¯æŒæ— é™ç”»å¸ƒï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç”»å¸ƒç®¡ç†</span>
<span class="hljs-keyword">const</span> { renderCanvas, canvasWrapStyle, updateContentBounds } = <span class="hljs-title function_">useCanvas</span>(
  canvasRef,
  editorContainerRef,
  canvasState,
  elements,
  <span class="hljs-comment">// ... å…¶ä»–å‚æ•°</span>
)

<span class="hljs-comment">// è‡ªåŠ¨æ›´æ–°å†…å®¹è¾¹ç•Œ</span>
<span class="hljs-title function_">updateContentBounds</span>()
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2FuseCanvas.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/useCanvas.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/useCanvas.js</a></p>
</blockquote>
<h4 data-id="heading-26">3. ç¼©æ”¾æ§åˆ¶</h4>
<p>æ”¯æŒå¤šç§ç¼©æ”¾æ–¹å¼ï¼šé¼ æ ‡æ»šè½®ã€æŒ‰é’®ã€å¿«æ·é”®ï¼Œä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒç¼©æ”¾ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç¼©æ”¾æ§åˆ¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleWheel</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-comment">// Ctrl/Cmd + æ»šè½®ï¼šç¼©æ”¾</span>
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">ctrlKey</span> || e.<span class="hljs-property">metaKey</span>) {
    <span class="hljs-comment">// ä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒç¼©æ”¾</span>
    <span class="hljs-keyword">const</span> sceneX = mouseX / scale.<span class="hljs-property">value</span> - scrollX.<span class="hljs-property">value</span>
    <span class="hljs-keyword">const</span> sceneY = mouseY / scale.<span class="hljs-property">value</span> - scrollY.<span class="hljs-property">value</span>
    <span class="hljs-comment">// ... è®¡ç®—æ–°çš„ç¼©æ”¾å’Œå¹³ç§»</span>
  }
}
</code></pre>
<h4 data-id="heading-27">4. æ•°æ®åºåˆ—åŒ–</h4>
<p>å®Œæ•´çš„åœ°å›¾æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œæ”¯æŒä¿å­˜å’ŒåŠ è½½ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¿å­˜åœ°å›¾</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSaveMap</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// ç”Ÿæˆé¢„è§ˆå›¾</span>
  <span class="hljs-keyword">const</span> imageData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generatePreviewImage</span>()
  
  <span class="hljs-comment">// åºåˆ—åŒ–ç”»æ¿å†…å®¹</span>
  <span class="hljs-keyword">const</span> mapData = elements.<span class="hljs-title function_">serialize</span>(backgroundColor.<span class="hljs-property">value</span>)
  
  <span class="hljs-comment">// ä¿å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿ</span>
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">electron</span>.<span class="hljs-title function_">updateMap</span>({
    bookName,
    <span class="hljs-attr">mapName</span>: mapName.<span class="hljs-property">value</span>,
    imageData,
    mapData
  })
}

<span class="hljs-comment">// åŠ è½½åœ°å›¾</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadMapData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> mapData = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">electron</span>.<span class="hljs-title function_">loadMapData</span>({ bookName, mapName })
  <span class="hljs-keyword">if</span> (mapData) {
    <span class="hljs-keyword">const</span> loadedBackgroundColor = elements.<span class="hljs-title function_">deserialize</span>(mapData)
    backgroundColor.<span class="hljs-property">value</span> = loadedBackgroundColor
    <span class="hljs-title function_">renderCanvas</span>(<span class="hljs-literal">true</span>)
  }
}
</code></pre>
<h4 data-id="heading-28">5. å¿«æ·é”®ç³»ç»Ÿ</h4>
<p>å®Œæ•´çš„é”®ç›˜å¿«æ·é”®æ”¯æŒï¼Œæå‡æ“ä½œæ•ˆç‡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¿«æ·é”®é…ç½®</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleKeyDown</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-comment">// å·¥å…·å¿«æ·é”®</span>
  <span class="hljs-keyword">switch</span> (e.<span class="hljs-property">key</span>.<span class="hljs-title function_">toLowerCase</span>()) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'v'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'select'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'h'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'move'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'p'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'pencil'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'e'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'eraser'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'s'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'shape'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'t'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'text'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'b'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'bucket'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'r'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'resource'</span>); <span class="hljs-keyword">break</span>
  }
  
  <span class="hljs-comment">// æ’¤é”€/é‡åš</span>
  <span class="hljs-keyword">if</span> ((e.<span class="hljs-property">ctrlKey</span> || e.<span class="hljs-property">metaKey</span>) &amp;&amp; e.<span class="hljs-property">key</span> === <span class="hljs-string">'z'</span>) {
    <span class="hljs-title function_">handleUndo</span>()
  }
  
  <span class="hljs-comment">// ç©ºæ ¼é”®ï¼šä¸´æ—¶åˆ‡æ¢åˆ°ç§»åŠ¨æ¨¡å¼</span>
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">' '</span> &amp;&amp; tool.<span class="hljs-property">value</span> !== <span class="hljs-string">'move'</span>) {
    spaceKeyPressed.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  }
}
</code></pre>
<h4 data-id="heading-29">6. èµ„æºç®¡ç†ç³»ç»Ÿ</h4>
<p>æ”¯æŒé¢„è®¾å›¾æ ‡èµ„æºåº“ï¼Œæ‹–æ‹½æ·»åŠ å’Œè°ƒæ•´ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// èµ„æºå·¥å…·</span>
<span class="hljs-keyword">const</span> resourceTool = <span class="hljs-title function_">useResourceTool</span>({
  canvasRef,
  elements,
  history,
  renderCanvas,
  getCanvasPos
})

<span class="hljs-comment">// æ”¯æŒçš„åŠŸèƒ½</span>
- å›¾æ ‡èµ„æºåº“ï¼ˆ<span class="hljs-variable constant_">SVG</span> å›¾æ ‡ï¼‰
- æ‹–æ‹½æ·»åŠ èµ„æº
- è°ƒæ•´èµ„æºå¤§å°å’Œä½ç½®
- æ—‹è½¬èµ„æº
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2Ftools%2FuseResourceTool.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/tools/useResourceTool.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/tools/useResourceTool.js</a></p>
</blockquote>
<h3 data-id="heading-30">ğŸ“Š åŠŸèƒ½ç‰¹æ€§æ€»ç»“</h3>
<h4 data-id="heading-31">âœ… å·²å®ç°åŠŸèƒ½</h4>




























































<table><thead><tr><th>åŠŸèƒ½æ¨¡å—</th><th>åŠŸèƒ½æè¿°</th><th>æŠ€æœ¯å®ç°</th></tr></thead><tbody><tr><td><strong>ç»˜å›¾å·¥å…·</strong></td><td>10+ ç§ç»˜å›¾å·¥å…·</td><td>Composables æ¶æ„</td></tr><tr><td><strong>ç”»å¸ƒæ§åˆ¶</strong></td><td>ç¼©æ”¾ã€å¹³ç§»ã€é‡ç½®</td><td>useCanvasState + useCanvas</td></tr><tr><td><strong>å…ƒç´ ç®¡ç†</strong></td><td>ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å…ƒç´ </td><td>useElements</td></tr><tr><td><strong>å†å²è®°å½•</strong></td><td>æ’¤é”€/é‡åš</td><td>useHistory</td></tr><tr><td><strong>æ¸²æŸ“ç³»ç»Ÿ</strong></td><td>ç»Ÿä¸€æ¸²æŸ“å‡½æ•°</td><td>useRender</td></tr><tr><td><strong>åæ ‡è½¬æ¢</strong></td><td>å±å¹•åæ ‡è½¬ç”»å¸ƒåæ ‡</td><td>useCoordinate</td></tr><tr><td><strong>æ•°æ®æŒä¹…åŒ–</strong></td><td>ä¿å­˜å’ŒåŠ è½½åœ°å›¾</td><td>åºåˆ—åŒ–/ååºåˆ—åŒ–</td></tr><tr><td><strong>å¿«æ·é”®</strong></td><td>å®Œæ•´çš„é”®ç›˜å¿«æ·é”®</td><td>äº‹ä»¶ç›‘å¬ç³»ç»Ÿ</td></tr><tr><td><strong>èµ„æºç®¡ç†</strong></td><td>å›¾æ ‡èµ„æºåº“</td><td>useResourceTool</td></tr><tr><td><strong>å‚æ•°æ§åˆ¶</strong></td><td>é¢œè‰²ã€å¤§å°ã€é€æ˜åº¦</td><td>å“åº”å¼çŠ¶æ€ç®¡ç†</td></tr></tbody></table>
<h4 data-id="heading-32">ğŸš€ æŠ€æœ¯äº®ç‚¹</h4>
<ol>
<li><strong>æ¨¡å—åŒ–æ¶æ„</strong>: Composables è®¾è®¡å®ç°é«˜å¯ç»´æŠ¤æ€§</li>
<li><strong>ç»Ÿä¸€æ¥å£</strong>: æ‰€æœ‰å·¥å…·éµå¾ªç›¸åŒçš„æ¥å£è§„èŒƒ</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>: æ™ºèƒ½æ¸²æŸ“ï¼Œåªé‡ç»˜å˜åŒ–çš„éƒ¨åˆ†</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>: æµç•…çš„äº¤äº’ï¼Œå®Œæ•´çš„å¿«æ·é”®æ”¯æŒ</li>
<li><strong>å¯æ‰©å±•æ€§</strong>: æ˜“äºæ·»åŠ æ–°çš„ç»˜å›¾å·¥å…·</li>
<li><strong>æ•°æ®å®‰å…¨</strong>: å®Œæ•´çš„ä¿å­˜å’ŒåŠ è½½æœºåˆ¶</li>
</ol>
<h3 data-id="heading-33">ğŸ“ æ€»ç»“ä¸å±•æœ›</h3>
<p>åœ°å›¾è®¾è®¡é¡µæ˜¯ 51mazi é¡¹ç›®ä¸­æœ€å¤æ‚çš„åŠŸèƒ½æ¨¡å—ä¹‹ä¸€ï¼Œé€šè¿‡æ¨¡å—åŒ–çš„ Composables æ¶æ„è®¾è®¡ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š</p>
<ul>
<li>âœ… <strong>æ¸…æ™°çš„ä»£ç ç»„ç»‡</strong>: æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤</li>
<li>âœ… <strong>é«˜åº¦å¯æ‰©å±•</strong>: æ·»åŠ æ–°å·¥å…·åªéœ€åˆ›å»ºæ–°çš„ composable</li>
<li>âœ… <strong>ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒ</strong>: æµç•…çš„äº¤äº’å’Œå®Œæ•´çš„å¿«æ·é”®æ”¯æŒ</li>
<li>âœ… <strong>å¼ºå¤§çš„åŠŸèƒ½</strong>: 10+ ç§ç»˜å›¾å·¥å…·ï¼Œæ»¡è¶³å„ç§åœ°å›¾ç»˜åˆ¶éœ€æ±‚</li>
</ul>
<h4 data-id="heading-34">ğŸ¯ æŠ€æœ¯ä»·å€¼</h4>
<ul>
<li><strong>æ¶æ„è®¾è®¡</strong>: æ¨¡å—åŒ–çš„ Composables æ¶æ„ï¼Œé«˜å†…èšä½è€¦åˆ</li>
<li><strong>ä»£ç è´¨é‡</strong>: æ¸…æ™°çš„æ¥å£å®šä¹‰ï¼Œæ˜“äºæµ‹è¯•å’Œç»´æŠ¤</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>: æ™ºèƒ½æ¸²æŸ“æœºåˆ¶ï¼Œä¿è¯æµç•…ä½“éªŒ</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>: å®Œæ•´çš„å¿«æ·é”®ç³»ç»Ÿå’Œç›´è§‚çš„æ“ä½œç•Œé¢</li>
</ul>
<h4 data-id="heading-35">ğŸ”® æœªæ¥è§„åˆ’</h4>
<ul>
<li><strong>æ›´å¤šå·¥å…·</strong>: æ”¯æŒæ›´å¤šç»˜å›¾å·¥å…·å’Œæ•ˆæœï¼ˆå¦‚æ¸å˜ã€é˜´å½±ç­‰ï¼‰</li>
<li><strong>å›¾å±‚ç³»ç»Ÿ</strong>: æ”¯æŒå¤šå±‚ç»˜å›¾å’Œå›¾å±‚ç®¡ç†</li>
<li><strong>å¯¼å…¥å¯¼å‡º</strong>: æ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼å¯¼å…¥å¯¼å‡º</li>
<li><strong>åä½œåŠŸèƒ½</strong>: æ”¯æŒå¤šäººåä½œç»˜å›¾</li>
<li><strong>æ¨¡æ¿ç³»ç»Ÿ</strong>: æä¾›åœ°å›¾æ¨¡æ¿ï¼Œå¿«é€Ÿåˆ›å»ºå¸¸ç”¨åœ°å›¾</li>
</ul>
<hr/>
<h4 data-id="heading-36">ğŸ“š ç›¸å…³é“¾æ¥</h4>
<ul>
<li><strong>é¡¹ç›®åœ°å€</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi" ref="nofollow noopener noreferrer">GitHub - 51mazi</a>ï¼Œç»™ä¸ª Star å“¦~</li>
<li><strong>åœ°å›¾è®¾è®¡é¡µä»£ç </strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fviews%2FMapDesign.vue" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/views/MapDesign.vue" ref="nofollow noopener noreferrer">src/renderer/src/views/MapDesign.vue</a></li>
<li><strong>Composables ç›®å½•</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Ftree%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/tree/main/src/renderer/src/composables/map" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/</a></li>
<li><strong>æŠ€æœ¯æ ˆ</strong>: Vue 3 + Canvas + Element Plus + Composables</li>
</ul>
<h4 data-id="heading-37">ğŸ·ï¸ æ ‡ç­¾</h4>
<p><code>#Vue3</code> <code>#Canvas</code> <code>#å°è¯´åœ°å›¾</code> <code>#åœ°å›¾è®¾è®¡</code> <code>#Composables</code> <code>#å‰ç«¯å¼€å‘</code> <code>#æ¶æ„è®¾è®¡</code> <code>#æ¨¡å—åŒ–</code> <code>#ç»˜å›¾å·¥å…·</code></p>
<hr/>
<blockquote>
<p>ğŸ’¡ <strong>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ï¸ æ”¯æŒä¸€ä¸‹ï¼</strong></p>
<p>ğŸ’¡ <strong>æƒ³æ·±å…¥äº†è§£æŸä¸ªå…·ä½“åŠŸèƒ½çš„å®ç°ï¼Ÿæ¬¢è¿æŸ¥çœ‹ GitHub ä¸Šå¯¹åº”çš„ä»£ç æ–‡ä»¶ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰è¯¦ç»†çš„æ³¨é‡Šè¯´æ˜ï¼</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«é‡è¹ˆæˆ‘ä»¬çš„è¦†è¾™ï¼šè„šæœ¬å¼•æ“é€‰é”™çš„ä¸¤å¹´ä»£ä»·]]></title>    <link>https://juejin.cn/post/7582904738922217510</link>    <guid>https://juejin.cn/post/7582904738922217510</guid>    <pubDate>2025-12-14T00:54:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582904738922217510" data-draft-id="7582905804048269339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«é‡è¹ˆæˆ‘ä»¬çš„è¦†è¾™ï¼šè„šæœ¬å¼•æ“é€‰é”™çš„ä¸¤å¹´ä»£ä»·"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-14T00:54:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¸æµªæ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«é‡è¹ˆæˆ‘ä»¬çš„è¦†è¾™ï¼šè„šæœ¬å¼•æ“é€‰é”™çš„ä¸¤å¹´ä»£ä»·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¸æµªæ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T00:54:27.000Z" title="Sun Dec 14 2025 00:54:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    21
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>2011å¹´ï¼Œæˆ‘å…¥èŒä¸€å®¶å¤§æ•°æ®å…¬å¸ã€‚æŠ€æœ¯æ€»ç›‘æ„å»ºäº†ä¸€å¥—å¾ˆé…·çš„æ¡†æ¶ï¼šGroovy åŠ¨æ€ç¼–è¯‘å®ç°çˆ¬è™«è§„åˆ™å¼•æ“ã€‚ä¸¤å¹´åï¼Œæˆ‘ä»¬æ¨ç¿»äº†å®ƒï¼Œç”¨ Hadoop é‡å†™ã€‚</strong></p>
<p><strong>ä¸æ˜¯ Groovy ä¸å¥½ï¼Œæ˜¯åœºæ™¯é”™äº†ã€‚</strong></p>
<p><strong>è¿™ç¯‡æ–‡ç« ï¼Œæ˜¯é‚£ä¸¤å¹´æ¢æ¥çš„æ•™è®­ï¼šä¸åˆ†åœºæ™¯å¯¹æ¯”æŠ€æœ¯æ–¹æ¡ˆï¼Œå°±æ˜¯è€æµæ°“ã€‚</strong></p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä¸¤ç§æŠ€æœ¯æ–¹æ¡ˆï¼šéƒ½æ˜¯å¥½æ–¹æ¡ˆï¼Œå…³é”®çœ‹åœºæ™¯</h2>
<p>æ‰§è¡ŒåŠ¨æ€è„šæœ¬ï¼Œæœ‰ä¸¤ç§æˆªç„¶ä¸åŒçš„æ€è·¯ã€‚</p>
<p>é¡¹ç›®éœ€æ±‚ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">rule</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>;
<span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> engine.execute(rule);
</code></pre>
<h3 data-id="heading-1">æ–¹æ¡ˆä¸€ï¼šè§£é‡Šæ‰§è¡Œ</h3>
<pre><code class="hljs">è„šæœ¬ â†’ è¯æ³•åˆ†æ â†’ è¯­æ³•åˆ†æ â†’ ASTæ ‘ â†’ éå†æ‰§è¡Œ
</code></pre>
<p>ä»£è¡¨æ–¹æ¡ˆï¼šQLExpressã€Aviatorã€MVEL</p>
<p><strong>é€‚åˆåœºæ™¯</strong>ï¼šé«˜é¢‘è°ƒç”¨ã€ç®€å•é€»è¾‘ã€æ ¸å¿ƒé“¾è·¯</p>
<h3 data-id="heading-2">æ–¹æ¡ˆäºŒï¼šåŠ¨æ€ç¼–è¯‘</h3>
<pre><code class="hljs language-arduino" lang="arduino">è„šæœ¬ â†’ åŒ…è£…æˆJavaæºç  â†’ ç¼–è¯‘ â†’ ç”Ÿæˆ<span class="hljs-keyword">class</span> â†’ åŠ è½½æ‰§è¡Œ
</code></pre>
<p>ä»£è¡¨æ–¹æ¡ˆï¼šGroovyã€Janinoã€åŠ¨æ€ClassLoader</p>
<p><strong>é€‚åˆåœºæ™¯</strong>ï¼šä½é¢‘è°ƒç”¨ã€å¤æ‚é€»è¾‘ã€æ‰©å±•æ¡†æ¶</p>
<hr/>
<p><strong>æ‰“ä¸ªæ¯”æ–¹</strong>ï¼šè§£é‡Šæ‰§è¡Œåƒå«å¤–å–ï¼ˆ10åˆ†é’Ÿé€åˆ°ï¼Œåƒå®Œä¸ç”¨æ´—ç¢—ï¼‰ï¼ŒåŠ¨æ€ç¼–è¯‘åƒå»ºå¨æˆ¿ï¼ˆå…ˆå»ºå¨æˆ¿ã€æ‹›å¨å¸ˆã€ä¹°é£Ÿæï¼Œ2å°æ—¶åé¥­æ‰èƒ½åƒä¸Šï¼‰ã€‚</p>
<p><strong>ä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯å¥½æ–¹æ¡ˆï¼Œä½†ç”¨é”™äº†åœºæ™¯å°±æ˜¯ç¾éš¾ã€‚</strong></p>
<p>æˆ‘ä»¬çš„é—®é¢˜ä¸æ˜¯é€‰äº† Groovyï¼Œè€Œæ˜¯åœ¨é«˜é¢‘ã€æ ¸å¿ƒã€è¦æ±‚ç¨³å®šçš„çˆ¬è™«ç³»ç»Ÿä¸Šç”¨äº† Groovyã€‚</p>
<hr/>
<h2 data-id="heading-3">äºŒã€ä¸¤ç§æ–¹æ¡ˆçš„æœ¬è´¨å·®å¼‚ï¼šå«å¤–å– vs å»ºå¨æˆ¿</h2>
<h3 data-id="heading-4">æ ¸å¿ƒåŒºåˆ«</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[éœ€æ±‚: æ‰§è¡Œè„šæœ¬] --&gt; B{è§£å†³æ–¹å¼}
    B --&gt;|QLExpress| C[è§£é‡Šæ‰§è¡Œ]
    B --&gt;|Groovy| D[ç¼–è¯‘æ‰§è¡Œ]
    
    C --&gt; E[éå†AST&lt;br/&gt;ç”¨Javaçš„if]
    D --&gt; F[ç”Ÿæˆå­—èŠ‚ç &lt;br/&gt;JVMçš„ifæŒ‡ä»¤]
    
    style C fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style D fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style E fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    style F fill:#ffebee,stroke:#c62828,stroke-width:2px
</code></pre>
<h3 data-id="heading-5">ç”¨çº¢çƒ§è‚‰çš„æ¯”å–»è¯´æ˜ç™½</h3>
<p><strong>QLExpressï¼ˆå«å¤–å–ï¼‰</strong>ï¼šå¥½çš„ï¼Œæˆ‘å¸®ä½ å«ä¸ªå¤–å–ã€‚æ¹˜èœè¿˜æ˜¯å·èœï¼Ÿ10åˆ†é’Ÿé€åˆ°ï¼Œåƒå®Œäº†ç¢—éƒ½ä¸ç”¨æ´—ã€‚</p>
<p><strong>Groovyï¼ˆå»ºå¨æˆ¿ï¼‰</strong>ï¼šæœ‰å¨æˆ¿å—ï¼Ÿæ²¡æœ‰ï¼Œå»ºä¸€ä¸ªã€‚æœ‰å¨å¸ˆå—ï¼Ÿæ²¡æœ‰ï¼Œæ‹›ä¸€ä¸ªã€‚æœ‰é”…é“²å—ï¼Ÿæ²¡æœ‰ï¼Œå»ä¹°ã€‚é£Ÿæå‡†å¤‡å¥½äº†å—ï¼Ÿå»é‡‡è´­ã€‚2å°æ—¶åï¼Œçº¢çƒ§è‚‰åšå¥½äº†ã€‚è€Œä¸”ï¼Œå¨æˆ¿è¿˜å ç€ä½ å®¶çš„åœ°æ–¹ã€‚</p>
<h3 data-id="heading-6">æ‰§è¡Œæ¨¡å‹å¯¹æ¯”</h3>



































<table><thead><tr><th>ç»´åº¦</th><th>QLExpress</th><th>Groovy</th></tr></thead><tbody><tr><td>ifè¯­å¥å®ç°</td><td>Java ä»£ç ï¼š<code>if ((Boolean) cond) { ... }</code></td><td>JVM å­—èŠ‚ç ï¼š<code>IFLE label_else</code></td></tr><tr><td>æ‰§è¡Œå•å…ƒ</td><td>AST èŠ‚ç‚¹éå†</td><td>å­—èŠ‚ç æŒ‡ä»¤</td></tr><tr><td>æ€§èƒ½ç‰¹å¾</td><td>å¯åŠ¨å¿«ï¼Œæ‰§è¡Œæ…¢ï¼ˆæ— JITï¼‰</td><td>å¯åŠ¨æ…¢ï¼Œæ‰§è¡Œå¿«ï¼ˆJITä¼˜åŒ–ï¼‰</td></tr><tr><td>å†…å­˜æ¨¡å‹</td><td>æ— æ–° class</td><td>æ¯æ¬¡ç”Ÿæˆæ–° class</td></tr><tr><td>è°ƒè¯•ä½“éªŒ</td><td>å †æ ˆæ˜¯è§£é‡Šå™¨ä»£ç </td><td>å †æ ˆæ˜¯åŠ¨æ€ç”Ÿæˆçš„ç±»</td></tr></tbody></table>
<p><strong>é‡‘å¥</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">QLExpress ç”¨ Java ä»£ç æ¨¡æ‹Ÿäº†ä¸€ä¸ª <span class="hljs-keyword">if</span>
Groovy è®© JVM è‡ªå·±æ‰§è¡Œäº†ä¸€ä¸ª <span class="hljs-keyword">if</span>

å‰è€…æ˜¯<span class="hljs-string">"ç¿»è¯‘å®˜"</span>ï¼Œåè€…æ˜¯<span class="hljs-string">"åŸä½æ°‘"</span>
</code></pre>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€æ€§èƒ½å¯¹æ¯”ï¼šç”¨æ•°æ®è¯´è¯</h2>
<h3 data-id="heading-8">æµ‹è¯•åœºæ™¯</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç®€å•è§„åˆ™</span>
<span class="hljs-type">String</span> <span class="hljs-variable">simple</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>;

<span class="hljs-comment">// å¤æ‚è§„åˆ™ï¼ˆå‡è®¾æ”¯æŒï¼‰</span>
<span class="hljs-type">String</span> <span class="hljs-variable">complex</span> <span class="hljs-operator">=</span> <span class="hljs-string">"sum = 0; for (i in 1..100) { sum += i * rate }"</span>;
</code></pre>
<h3 data-id="heading-9">å®æµ‹æ•°æ®</h3>



































<table><thead><tr><th>ç»´åº¦</th><th>QLExpress</th><th>Groovyï¼ˆç¼–è¯‘æ‰§è¡Œï¼‰</th></tr></thead><tbody><tr><td>é¦–æ¬¡æ‰§è¡Œ</td><td>5ms</td><td>150msï¼ˆç¼–è¯‘è€—æ—¶ï¼‰</td></tr><tr><td>ç¬¬äºŒæ¬¡æ‰§è¡Œ</td><td>5ms</td><td>2ms</td></tr><tr><td>10ä¸‡æ¬¡å¹³å‡è€—æ—¶</td><td>0.05ms/æ¬¡</td><td>0.01ms/æ¬¡</td></tr><tr><td>å†…å­˜å ç”¨ï¼ˆé¦–æ¬¡ï¼‰</td><td>+2MB</td><td>+1MB</td></tr><tr><td>å†…å­˜å ç”¨ï¼ˆ1000æ¬¡ï¼‰</td><td>+2MB</td><td>+50MBï¼ˆMetaspaceï¼‰</td></tr></tbody></table>
<h3 data-id="heading-10">æ€§èƒ½æ›²çº¿</h3>
<pre><code class="hljs language-markdown" lang="markdown">æ‰§è¡Œæ—¶é—´ï¼ˆå¯¹æ•°åˆ»åº¦ï¼‰
 |
150ms| Groovyé¦–æ¬¡ç¼–è¯‘
 |   |
 |   |
 5ms | QLé¦–æ¬¡         QLç¨³å®š
 |   |<span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">__<span class="hljs-emphasis">_|_</span>__</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>
 |               |
 2ms |           | Groovyç¬¬äºŒæ¬¡
 |               |<span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">___
 |                           \
0.01ms|                        Groovyç¨³å®š
 |__</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>__
<span class="hljs-code">     1æ¬¡      2æ¬¡         10ä¸‡æ¬¡
</span></code></pre>
<h3 data-id="heading-11">æ•°æ®è§£è¯»</h3>
<p><strong>QLExpress</strong>ï¼š</p>
<ul>
<li>å¯åŠ¨å¿«ï¼ˆ5msï¼‰ï¼Œæ— ç¼–è¯‘è€—æ—¶</li>
<li>æ€§èƒ½ç¨³å®šï¼Œä½†æœ‰ä¸Šé™ï¼ˆ0.05msï¼‰</li>
<li>å†…å­˜å ç”¨ä½ä¸”æ’å®šï¼ˆ+2MBï¼‰</li>
<li>åƒè‡ªè¡Œè½¦ï¼šç¨³å®šã€çœåŠ›ã€ä½†æœ‰é€Ÿåº¦ä¸Šé™</li>
</ul>
<p><strong>Groovy</strong>ï¼š</p>
<ul>
<li>å¯åŠ¨æ…¢ï¼ˆ150msï¼‰ï¼Œç¼–è¯‘è€—æ—¶æ˜æ˜¾</li>
<li>æ€§èƒ½æœ‰ä¼˜åŒ–ç©ºé—´ï¼ŒJIT åæ›´å¿«ï¼ˆ0.01msï¼‰</li>
<li>å†…å­˜å ç”¨é«˜ä¸”æŒç»­å¢é•¿ï¼ˆæ¯æ¬¡ +50KBï¼‰</li>
<li>åƒæ±½è½¦ï¼šå¯åŠ¨æ…¢ï¼Œä½†èƒ½è·‘è¿œã€è·‘å¿«</li>
</ul>
<p><strong>ç»“è®º</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">å¦‚æœè°ƒç”¨é¢‘ç‡</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">1000</span><span class="hljs-string">æ¬¡/ç§’ï¼šQLExpress</span> <span class="hljs-string">æ›´ç¨³</span>
<span class="hljs-string">å¦‚æœå•æ¬¡æ‰§è¡Œå¾ˆå¤æ‚ï¼Œä½é¢‘è°ƒç”¨ï¼šGroovy</span> <span class="hljs-string">æ›´å¿«</span>
<span class="hljs-string">å¦‚æœå†…å­˜æ•æ„Ÿï¼ˆServerlessï¼‰ï¼šQLExpress</span> <span class="hljs-string">æ›´çœ</span>
</code></pre>
<hr/>
<h2 data-id="heading-12">å››ã€æ€ä¹ˆé€‰ï¼Ÿçœ‹è¿™å¼ è¡¨å°±å¤Ÿäº†</h2>
<h3 data-id="heading-13">å†³ç­–è¡¨ï¼šä¸€çœ¼çœ‹æ‡‚ç”¨å“ªä¸ª</h3>













































<table><thead><tr><th>åœºæ™¯ç‰¹å¾</th><th>æ¨èæ–¹æ¡ˆ</th><th>ç†ç”±</th></tr></thead><tbody><tr><td><strong>ç®€å•è¡¨è¾¾å¼</strong> + é«˜é¢‘è°ƒç”¨ï¼ˆ&gt;1000/ç§’ï¼‰</td><td>QLExpress</td><td>ç¨³å®šã€æ— GCå‹åŠ›ã€å¯åŠ¨å¿«</td></tr><tr><td><strong>ç®€å•è¡¨è¾¾å¼</strong> + ä½é¢‘è°ƒç”¨ï¼ˆ&lt;100/ç§’ï¼‰</td><td>QLExpress</td><td>ç®€å•å¤Ÿç”¨ï¼Œä¸éœ€è¦ç¼–è¯‘</td></tr><tr><td><strong>å¤æ‚é€»è¾‘</strong>ï¼ˆå¾ªç¯/å‡½æ•°ï¼‰ + ä½é¢‘è°ƒç”¨</td><td>Groovy + ç¼“å­˜</td><td>æ”¯æŒå®Œæ•´è¯­æ³•ï¼Œç±»æ³„æ¼å¯æ§</td></tr><tr><td><strong>å¤æ‚é€»è¾‘</strong> + é«˜é¢‘è°ƒç”¨</td><td>é‡æ–°è¯„ä¼°éœ€æ±‚</td><td>å¯èƒ½éœ€è¦å…¶ä»–æ–¹æ¡ˆ</td></tr><tr><td><strong>å†…å­˜æ•æ„Ÿ</strong>ï¼ˆServerless/å®¹å™¨ï¼‰</td><td>QLExpress</td><td>å†…å­˜å ç”¨ä½ä¸”æ’å®š</td></tr><tr><td><strong>æè‡´æ€§èƒ½è¦æ±‚</strong> + å¯æ¥å—å¤æ‚åº¦</td><td>Groovy + ç›‘æ§</td><td>JITä¼˜åŒ–åæ€§èƒ½æœ€å¥½</td></tr><tr><td><strong>å¤šç§Ÿæˆ·/å®‰å…¨è¦æ±‚é«˜</strong></td><td>QLExpress</td><td>ç™½åå•æœºåˆ¶ï¼Œå¤©ç„¶æ²™ç®±</td></tr></tbody></table>
<h3 data-id="heading-14">å¿«é€Ÿåˆ¤æ–­ä¸‰æ­¥èµ°</h3>
<pre><code class="hljs language-markdown" lang="markdown">ç¬¬ä¸€æ­¥ï¼šçœ‹å¤æ‚åº¦
<span class="hljs-bullet">  -</span> åªæœ‰ if/æ¯”è¾ƒ/å››åˆ™è¿ç®— â†’ ç®€å•
<span class="hljs-bullet">  -</span> æœ‰å¾ªç¯/å‡½æ•°/å¤šå±‚åµŒå¥— â†’ å¤æ‚

ç¬¬äºŒæ­¥ï¼šçœ‹é¢‘ç‡
<span class="hljs-bullet">  -</span> &gt; 1000æ¬¡/ç§’ â†’ é«˜é¢‘
<span class="hljs-bullet">  -</span> &lt; 100æ¬¡/ç§’ â†’ ä½é¢‘

ç¬¬ä¸‰æ­¥ï¼šæŸ¥è¡¨é€‰æ–¹æ¡ˆ
  ç®€å• + é«˜é¢‘ â†’ QLExpress
  ç®€å• + ä½é¢‘ â†’ QLExpressï¼ˆå¤Ÿç”¨å°±è¡Œï¼‰
  å¤æ‚ + ä½é¢‘ â†’ Groovyï¼ˆé…åˆç¼“å­˜å’Œç›‘æ§ï¼‰
  å¤æ‚ + é«˜é¢‘ â†’ å¯èƒ½éœ€è¦é‡æ–°è®¾è®¡
</code></pre>
<h3 data-id="heading-15">å…¸å‹åœºæ™¯åˆ†æ</h3>
<h4 data-id="heading-16">åœºæ™¯ä¸€ï¼šç”µå•†é£æ§è§„åˆ™</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç‰¹ç‚¹ï¼š
<span class="hljs-bullet">  -</span> é«˜é¢‘ï¼ˆä¸‡æ¬¡/ç§’ï¼‰
<span class="hljs-bullet">  -</span> ç®€å•ï¼ˆif åˆ¤æ–­ã€æ¯”è¾ƒè¿ç®—ï¼‰
<span class="hljs-bullet">  -</span> ç¨³å®šæ€§è¦æ±‚é«˜
<span class="hljs-bullet">  -</span> å“åº”æ—¶é—´æ•æ„Ÿ

æ–¹æ¡ˆï¼šQLExpress

ç†ç”±ï¼š
<span class="hljs-bullet">  -</span> æ—  GC å‹åŠ›
<span class="hljs-bullet">  -</span> å¯åŠ¨å¿«ï¼Œé¦–æ¬¡æ‰§è¡Œæ— ç¼–è¯‘è€—æ—¶
<span class="hljs-bullet">  -</span> ç™½åå•å®‰å…¨
<span class="hljs-bullet">  -</span> æ€§èƒ½ç¨³å®šå¯é¢„æµ‹
  
é£é™©ï¼š
<span class="hljs-bullet">  -</span> å¦‚æœè§„åˆ™å¾ˆå¤æ‚ï¼ˆå¤šå±‚åµŒå¥—ï¼‰ï¼Œæ€§èƒ½ä¼šä¸‹é™
<span class="hljs-bullet">  -</span> ä¸æ”¯æŒå¾ªç¯ã€å‡½æ•°å®šä¹‰
</code></pre>
<h4 data-id="heading-17">åœºæ™¯äºŒï¼šæ’ä»¶æ¡†æ¶/ç”¨æˆ·è‡ªå®šä¹‰è„šæœ¬</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç‰¹ç‚¹ï¼š
<span class="hljs-bullet">  -</span> ä½é¢‘ï¼ˆå‡ åæ¬¡/å¤©ï¼‰
<span class="hljs-bullet">  -</span> å¤æ‚ï¼ˆå®Œæ•´é€»è¾‘ã€å¤šè¡Œä»£ç ã€éœ€è¦å®šä¹‰ç±»ï¼‰
<span class="hljs-bullet">  -</span> éœ€è¦å¼ºå¤§çµæ´»æ€§
<span class="hljs-bullet">  -</span> å…è®¸ä¸€å®šå¯åŠ¨è€—æ—¶

æ–¹æ¡ˆï¼šGroovyï¼ˆè¿™æ˜¯ Groovy çš„æœ€ä½³åœºæ™¯ï¼‰

ç†ç”±ï¼š
<span class="hljs-bullet">  -</span> æ”¯æŒå®Œæ•´ Java è¯­æ³•ï¼ˆå¾ªç¯ã€å‡½æ•°ã€ç±»ã€æ¥å£ï¼‰
<span class="hljs-bullet">  -</span> ç”¨æˆ·å¯ä»¥å†™å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘
<span class="hljs-bullet">  -</span> JIT ä¼˜åŒ–åæ€§èƒ½å¥½
<span class="hljs-bullet">  -</span> ç±»æ³„æ¼å¯æ§ï¼ˆä½é¢‘è°ƒç”¨ï¼Œé‡å¯å¯æ¸…ç†ï¼‰
<span class="hljs-bullet">  -</span> è¿™ç§åœºæ™¯ä¸‹ï¼ŒQLExpress åŠŸèƒ½ä¸å¤Ÿç”¨
  
å…¸å‹æ¡ˆä¾‹ï¼š
<span class="hljs-bullet">  -</span> Jenkins æ’ä»¶ï¼ˆGroovy è„šæœ¬ï¼‰
<span class="hljs-bullet">  -</span> Gradle æ„å»ºè„šæœ¬ï¼ˆGroovy DSLï¼‰
<span class="hljs-bullet">  -</span> IDE æ’ä»¶å¼€å‘
<span class="hljs-bullet">  -</span> SaaS å¹³å°çš„å®¢æˆ·è‡ªå®šä¹‰é€»è¾‘
  
é£é™©ç®¡ç†ï¼š
<span class="hljs-bullet">  -</span> ä¸¥æ ¼çš„æ²™ç®±å’Œæƒé™æ§åˆ¶
<span class="hljs-bullet">  -</span> ç›‘æ§ç±»åŠ è½½æƒ…å†µ
<span class="hljs-bullet">  -</span> å®šæœŸé‡å¯æ¸…ç† Metaspace
<span class="hljs-bullet">  -</span> åšå¥½é™çº§æ–¹æ¡ˆ
</code></pre>
<h4 data-id="heading-18">åœºæ™¯ä¸‰ï¼šé…ç½®ä¸­å¿ƒè¡¨è¾¾å¼</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç‰¹ç‚¹ï¼š
<span class="hljs-bullet">  -</span> ä¸­é¢‘ï¼ˆç™¾æ¬¡/ç§’ï¼‰
<span class="hljs-bullet">  -</span> ä¸­ç­‰å¤æ‚
<span class="hljs-bullet">  -</span> éœ€è¦å¿«é€Ÿéƒ¨ç½²
<span class="hljs-bullet">  -</span> å¸Œæœ›ç®€å•ç»´æŠ¤

æ–¹æ¡ˆï¼šä¼˜å…ˆ QLExpressï¼Œå¤æ‚æ—¶ç”¨ Groovy + ç¼“å­˜

åˆ¤æ–­æ ‡å‡†ï¼š
<span class="hljs-bullet">  -</span> å¦‚æœè¡¨è¾¾å¼æ˜¯ a&gt;b &amp;&amp; c<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">d</span> â†’ <span class="hljs-attr">QLExpress</span>
  <span class="hljs-attr">-</span> <span class="hljs-attr">å¦‚æœæœ‰å¾ªç¯</span>ã€<span class="hljs-attr">å‡½æ•°å®šä¹‰</span> â†’ <span class="hljs-attr">Groovy</span>
  <span class="hljs-attr">-</span> <span class="hljs-attr">å¦‚æœä¸ç¡®å®š</span> â†’ <span class="hljs-attr">å…ˆç”¨</span> <span class="hljs-attr">QLExpress</span>ï¼Œ<span class="hljs-attr">ä¸å¤Ÿå†æ¢</span>
  
<span class="hljs-attr">å»ºè®®</span>ï¼š
  <span class="hljs-attr">-</span> <span class="hljs-attr">é™åˆ¶è¡¨è¾¾å¼å¤æ‚åº¦</span>
  <span class="hljs-attr">-</span> <span class="hljs-attr">æä¾›è¡¨è¾¾å¼æ¨¡æ¿</span>
  <span class="hljs-attr">-</span> <span class="hljs-attr">åšå¥½ç›‘æ§å’Œé™çº§</span>
</span></span></code></pre>
<h4 data-id="heading-19">åœºæ™¯å››ï¼šAB æµ‹è¯•åˆ†æµ</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç‰¹ç‚¹ï¼š
<span class="hljs-bullet">  -</span> é«˜é¢‘ï¼ˆæ¯æ¬¡è¯·æ±‚éƒ½åˆ¤æ–­ï¼‰
<span class="hljs-bullet">  -</span> æç®€å•ï¼ˆæ¯”è¾ƒã€å–æ¨¡ï¼‰
<span class="hljs-bullet">  -</span> å¯¹æ€§èƒ½æåº¦æ•æ„Ÿ

æ–¹æ¡ˆï¼šQLExpressï¼Œç”šè‡³è€ƒè™‘ç¡¬ç¼–ç 

ç†ç”±ï¼š
<span class="hljs-bullet">  -</span> AB æµ‹è¯•è§„åˆ™é€šå¸¸å¾ˆç®€å•
<span class="hljs-bullet">  -</span> ä¸éœ€è¦åŠ¨æ€ç¼–è¯‘çš„å¼ºå¤§èƒ½åŠ›
<span class="hljs-bullet">  -</span> è¿½æ±‚æè‡´æ€§èƒ½å’Œç¨³å®šæ€§
  
åä¾‹ï¼š
<span class="hljs-bullet">  -</span> ç”¨ Groovy æ˜¯è¿‡åº¦è®¾è®¡
<span class="hljs-bullet">  -</span> æ¯æ¬¡è¯·æ±‚ç¼–è¯‘ä¸€æ¬¡ï¼Ÿå†…å­˜çˆ†ç‚¸
<span class="hljs-bullet">  -</span> ç¼“å­˜åæ€§èƒ½å¥½ï¼Ÿä½†å¢åŠ å¤æ‚åº¦
</code></pre>
<h3 data-id="heading-20">é€‰å‹æ£€æŸ¥æ¸…å•</h3>
<p><strong>é€‰ QLExpress çš„æ¡ä»¶</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">â–¡</span> <span class="hljs-string">è¡¨è¾¾å¼ç®€å•ï¼ˆå•å±‚</span> <span class="hljs-string">if</span> <span class="hljs-string">/</span> <span class="hljs-string">æ¯”è¾ƒ</span> <span class="hljs-string">/</span> <span class="hljs-string">å››åˆ™è¿ç®—ï¼‰</span>
<span class="hljs-string">â–¡</span> <span class="hljs-string">è°ƒç”¨é¢‘ç‡é«˜ï¼ˆ&gt;</span> <span class="hljs-number">1000</span><span class="hljs-string">æ¬¡/ç§’ï¼‰</span>
<span class="hljs-string">â–¡</span> <span class="hljs-string">å†…å­˜æ•æ„Ÿï¼ˆServerless</span> <span class="hljs-string">/</span> <span class="hljs-string">å®¹å™¨</span> <span class="hljs-string">/</span> <span class="hljs-string">IoTï¼‰</span>
<span class="hljs-string">â–¡</span> <span class="hljs-string">å®‰å…¨è¦æ±‚é«˜ï¼ˆå¤šç§Ÿæˆ·</span> <span class="hljs-string">/</span> <span class="hljs-string">ç”¨æˆ·è¾“å…¥ï¼‰</span>
<span class="hljs-string">â–¡</span> <span class="hljs-string">å›¢é˜Ÿ</span> <span class="hljs-string">Java</span> <span class="hljs-string">æ°´å¹³ä¸€èˆ¬</span>
<span class="hljs-string">â–¡</span> <span class="hljs-string">è¿½æ±‚ç¨³å®šæ€§å’Œå¯é¢„æµ‹æ€§</span>
</code></pre>
<p><strong>é€‰ Groovy çš„æ¡ä»¶</strong>ï¼š</p>
<pre><code class="hljs">â–¡ éœ€è¦å®Œæ•´ç¼–ç¨‹èƒ½åŠ›ï¼ˆå¾ªç¯ / å‡½æ•° / ç±»ï¼‰
â–¡ è¿½æ±‚æè‡´æ‰§è¡Œæ€§èƒ½ï¼ˆå·²ä¼˜åŒ–åï¼‰
â–¡ ä½é¢‘ä½¿ç”¨ï¼ˆ&lt; 100æ¬¡/åˆ†é’Ÿï¼‰
â–¡ æœ‰å®Œå–„çš„ç›‘æ§å’Œç±»æ¸…ç†æœºåˆ¶
â–¡ å›¢é˜Ÿæœ‰ JVM è°ƒä¼˜ç»éªŒ
â–¡ å¯æ¥å—ä¸€å®šçš„å¤æ‚åº¦
</code></pre>
<p><strong>éƒ½ä¸æ»¡è¶³ï¼Ÿ</strong></p>
<pre><code class="hljs language-diff" lang="diff">è€ƒè™‘å…¶ä»–æ–¹æ¡ˆï¼š
<span class="hljs-deletion">- Aviatorï¼šé«˜æ€§èƒ½è¡¨è¾¾å¼å¼•æ“ï¼Œæ¯” QLExpress æ›´å¿«</span>
<span class="hljs-deletion">- MVELï¼šè½»é‡çº§è„šæœ¬å¼•æ“</span>
<span class="hljs-deletion">- JavaScriptï¼ˆNashorn/GraalJSï¼‰ï¼šå¦‚æœå›¢é˜Ÿç†Ÿæ‚‰ JS</span>
<span class="hljs-deletion">- Luaï¼ˆLuaJï¼‰ï¼šåµŒå…¥å¼è„šæœ¬</span>
<span class="hljs-deletion">- æˆ–è€…ï¼Œé‡æ–°è¯„ä¼°éœ€æ±‚ï¼šæ˜¯å¦çœŸçš„éœ€è¦åŠ¨æ€è„šæœ¬ï¼Ÿ</span>
</code></pre>
<hr/>
<h2 data-id="heading-21">äº”ã€ä¸¤ç§æ–¹æ¡ˆçš„å‘ï¼Œéƒ½åœ¨è¿™äº†</h2>
<h3 data-id="heading-22">QLExpress çš„å‘</h3>
<h4 data-id="heading-23">å‘1ï¼šæ€§èƒ½ç“¶é¢ˆ</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  10ä¸‡æ¬¡/ç§’å CPU é£™å‡åˆ° 80%
  
åŸå› ï¼š
  è§£é‡Šæ‰§è¡Œæ—  JIT ä¼˜åŒ–
  æ¯æ¬¡éƒ½è¦éå† AST æ ‘
  
æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  -</span> ç®€åŒ–è§„åˆ™é€»è¾‘
<span class="hljs-bullet">  -</span> å‡å°‘åµŒå¥—å±‚æ•°
<span class="hljs-bullet">  -</span> æˆ–æ¢æˆç¼–è¯‘æ‰§è¡Œ
</code></pre>
<h4 data-id="heading-24">å‘2ï¼šåŠŸèƒ½å—é™</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  å†™ä¸äº†å¾ªç¯
  å†™ä¸äº†å‡½æ•°å®šä¹‰
  å†™ä¸äº†å¤æ‚é€»è¾‘
  
åŸå› ï¼š
  åªæ”¯æŒè¡¨è¾¾å¼çº§åˆ«
  ä¸æ”¯æŒå®Œæ•´ç¼–ç¨‹è¯­è¨€ç‰¹æ€§
  
æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  -</span> ç®€åŒ–éœ€æ±‚
<span class="hljs-bullet">  -</span> ç”¨å¤šä¸ªç®€å•è§„åˆ™ç»„åˆ
<span class="hljs-bullet">  -</span> æˆ–æ¢æˆ Groovy
</code></pre>
<h4 data-id="heading-25">å‘3ï¼šè°ƒè¯•å›°éš¾</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  æŠ¥é”™å †æ ˆå…¨æ˜¯ AST éå†çš„ä»£ç 
  æ‰¾ä¸åˆ°å…·ä½“å“ªè¡Œè„šæœ¬å‡ºé”™
  
åŸå› ï¼š
  æ²¡æœ‰çœŸå®çš„ä»£ç è¡Œå·
  åªæœ‰ AST èŠ‚ç‚¹ä¿¡æ¯
  
æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  -</span> åŠ è¯¦ç»†çš„æ—¥å¿—
<span class="hljs-bullet">  -</span> åœ¨è§„åˆ™ä¸­åŠ æ ‡è¯†
<span class="hljs-bullet">  -</span> å•å…ƒæµ‹è¯•è¦†ç›–
</code></pre>
<h3 data-id="heading-26">Groovy çš„å‘</h3>
<h4 data-id="heading-27">å‘1ï¼šç±»æ³„æ¼ OOMï¼ˆæœ€ä¸¥é‡ï¼‰</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  è¿è¡Œ 72 å°æ—¶å Metaspace æ»¡
  Full GC é¢‘å‘
  æœ€ç»ˆ OutOfMemoryError
  
åŸå› ï¼š
  æ¯æ¬¡æ‰§è¡Œç”Ÿæˆæ–°ç±»ï¼šScript<span class="hljs-emphasis">_123, Script_</span>124...
  ç±»æœªè¢« GCï¼ˆClassLoader è¿˜åœ¨å¼•ç”¨ï¼‰
  Metaspace æŒç»­å¢é•¿
  
ç›‘æ§å‘½ä»¤ï¼š
  jmap -clstats <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">pid</span>&gt;</span></span> | grep Script_
  
è§£å†³æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  -</span> ç¼“å­˜ç¼–è¯‘ç»“æœï¼ˆç›¸åŒè„šæœ¬å¤ç”¨ Classï¼‰
<span class="hljs-bullet">  -</span> å®šæœŸæ¸…ç† ClassLoader
<span class="hljs-bullet">  -</span> é™åˆ¶è„šæœ¬æ•°é‡ä¸Šé™
<span class="hljs-bullet">  -</span> è®¾ç½® Metaspace å‘Šè­¦
</code></pre>
<h4 data-id="heading-28">å‘2ï¼šå†·å¯åŠ¨æ…¢</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  ç¬¬ä¸€æ¬¡æ‰§è¡Œéœ€è¦ 200ms
  ç”¨æˆ·æ„ŸçŸ¥æ˜æ˜¾å»¶è¿Ÿ
  
åŸå› ï¼š
  ç¼–è¯‘è€—æ—¶ï¼ˆJavaCompilerï¼‰
  
æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  -</span> é¢„ç¼–è¯‘å¸¸ç”¨è„šæœ¬
<span class="hljs-bullet">  -</span> å¼‚æ­¥ç¼–è¯‘ï¼ˆåå°ç¼–è¯‘ï¼Œå…ˆç”¨æ—§ç‰ˆæœ¬ï¼‰
<span class="hljs-bullet">  -</span> ç¼“å­˜ç¼–è¯‘ç»“æœ
</code></pre>
<h4 data-id="heading-29">å‘3ï¼šå®‰å…¨é£é™©</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  ç”¨æˆ·æ‰§è¡Œ System.exit(0) å¯¼è‡´æœåŠ¡æŒ‚æ‰
  ç”¨æˆ·è¯»å– /etc/passwd
  ç”¨æˆ·æ‰§è¡Œ rm -rf
  
åŸå› ï¼š
  è„šæœ¬å°±æ˜¯ Java ä»£ç 
  å¯ä»¥è°ƒç”¨ä»»æ„ Java API
  
æ–¹æ¡ˆï¼ˆéƒ½ä¸å®Œç¾ï¼‰ï¼š
<span class="hljs-bullet">  -</span> SecurityManagerï¼ˆJDK 17 å·²åºŸå¼ƒï¼‰
<span class="hljs-bullet">  -</span> ä»£ç å®¡æŸ¥ï¼ˆæ­£åˆ™åŒ¹é…å±é™©ä»£ç ï¼‰
<span class="hljs-bullet">  -</span> æ²™ç®±éš”ç¦»ï¼ˆç‹¬ç«‹è¿›ç¨‹ï¼‰
<span class="hljs-bullet">  -</span> ç™½åå•ï¼ˆåªå…è®¸ç‰¹å®š APIï¼‰
</code></pre>
<h4 data-id="heading-30">å‘4ï¼šè°ƒè¯•å™©æ¢¦</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  æŠ¥é”™å †æ ˆï¼šat Script<span class="hljs-emphasis">_1234567890.execute(Unknown Source)
  Script_</span>1234567890 åœ¨å“ªï¼Ÿæ‰¾ä¸åˆ°æºç 
  
åŸå› ï¼š
  åŠ¨æ€ç”Ÿæˆçš„ç±»
  æºç å¯èƒ½å·²ç»ä¸åœ¨å†…å­˜é‡Œ
  
æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  -</span> ä¿å­˜è„šæœ¬å’Œç”Ÿæˆç±»çš„æ˜ å°„
<span class="hljs-bullet">  -</span> ä¿å­˜ç¼–è¯‘åçš„æºç 
<span class="hljs-bullet">  -</span> åŠ è¯¦ç»†æ—¥å¿—
</code></pre>
<hr/>
<h2 data-id="heading-31">å…­ã€æˆ‘ä»¬çš„ä¸¤å¹´å™©æ¢¦ï¼šå®Œæ•´å¤ç›˜</h2>
<p><strong>è¿™ä¸æ˜¯å‡è®¾ï¼Œæ˜¯æˆ‘äº²èº«ç»å†çš„çœŸå®æ•…äº‹ã€‚</strong></p>
<h3 data-id="heading-32">èƒŒæ™¯</h3>
<p>2011å¹´ï¼Œæˆ‘ä½œä¸ºé«˜çº§å·¥ç¨‹å¸ˆå…¥èŒäº†ä¸€å®¶å¤§æ•°æ®å…¬å¸ï¼Œè¯¥å…¬å¸ä»¥äº’è”ç½‘çˆ¬è™«æ„å»ºä¸šåŠ¡ã€‚å…¶ä¸­ä¸€å—æ ¸å¿ƒç³»ç»Ÿæ˜¯åˆ†å¸ƒå¼çˆ¬è™«ç³»ç»Ÿï¼Œä»å…¨ç½‘ä¸Šç™¾å®¶æˆ¿åœ°äº§å…¬å¸æŠ“å–æˆ¿æºã€èµ„è®¯ç­‰æ•°æ®ã€‚é‚£æ—¶å€™ Hadoop è¿˜æ²¡æµè¡Œã€‚</p>
<p>å…¬å¸æŠ€æœ¯æ€»ç›‘æ„å»ºäº†ä¸€å¥—å¼•ä»¥ä¸ºå‚²çš„æ¶æ„ï¼šåº•å±‚æ˜¯å¾ˆå…ˆè¿›çš„ç®—æ³•èƒ½åŠ›ï¼ŒåŒ…æ‹¬æŒ‡çº¹ç®—æ³•åšå»é‡ã€æ­£æ–‡æå–ç®—æ³•ä» HTML ä¸­æå–æ ¸å¿ƒå†…å®¹ã€NLP æ‘˜è¦ç”Ÿæˆç­‰ã€‚ä¸Šå±‚åˆ™æ˜¯ Groovy åŠ¨æ€ä»£ç åº“ï¼Œç¾åå…¶æ›°"çŸ­å¹³å¿«ï¼Œåˆ©ç”¨åº•å±‚åœ°åŸºå¿«é€Ÿæ„å»º"ã€‚è¿™æ¯”æŸä¸œçš„"å¤šå¿«å¥½çœ"æå‡ºå¾—è¿˜æ—©ï¼Œè¿™å¾ˆæœ‰è¶£ã€‚</p>
<p>å¬èµ·æ¥å¾ˆç¾å¥½ï¼Œæ¡†æ¶æœ¬èº«ä¹Ÿå¾ˆå¼ºå¤§ã€‚</p>
<h3 data-id="heading-33">ä»å…´å¥‹åˆ°å™©æ¢¦</h3>
<p>åˆšå…¥èŒæ—¶ï¼Œçœ‹åˆ°è¿™å¥—æ¶æ„ï¼Œæˆ‘å¾ˆå…´å¥‹ã€‚åŠ¨æ€åŠ è½½ä»£ç ï¼Ÿå¤ªé…·äº†ï¼ä¸ç”¨é‡å¯å°±èƒ½ä¸Šçº¿æ–°åŠŸèƒ½ï¼Ÿå®Œç¾ï¼åº•å±‚èƒ½åŠ›è¿™ä¹ˆå¼ºå¤§ï¼Ÿå¯ä»¥åšå¾ˆå¤šäº‹ï¼æˆ‘è§‰å¾—è‡ªå·±å¯ä»¥å¤§æ˜¾èº«æ‰‹ã€‚</p>
<p>å´ä¸çŸ¥é“ï¼Œåé¢éƒ½æˆäº†æˆ‘ä»¬çš„æ¶æ¢¦ã€‚</p>
<p>é—®é¢˜å¼€å§‹å‡ºç°ï¼šç„å­¦é—®é¢˜é¢‘å‘ï¼Œä¸çŸ¥é“æ˜¯ Groovy çš„é—®é¢˜è¿˜æ˜¯æ¡†æ¶çš„é—®é¢˜ã€‚æœ‰æ—¶å€™è«åå…¶å¦™å°±æŒ‚äº†ï¼Œæœ‰æ—¶å€™æ€§èƒ½çªç„¶ä¸‹é™ï¼Œæœ‰æ—¶å€™å†…å­˜è«åé£™å‡ã€‚æˆ‘ä»¬åªèƒ½ç»å¸¸åŠ ç­åŠ ç‚¹è°ƒè¯•ï¼Œç¢°åˆ°å®åœ¨æä¸å®šçš„ï¼Œå°±å†™æ–°çš„è¡¥ä¸ç¨‹åºã€‚è¡¥ä¸ç¨‹åºè¶Šæ¥è¶Šå¤šï¼Œç³»ç»Ÿè¶Šæ¥è¶Šä¸å¯æ§ã€‚</p>
<p><strong>è¿™æ ·æŒç»­äº†å¤šä¹…ï¼Ÿä¸¤å¹´ã€‚</strong></p>
<p>ä¸¤å¹´æ—¶é—´é‡Œï¼Œæˆ‘ä»¬å›¢é˜Ÿå¤§éƒ¨åˆ†ç²¾åŠ›éƒ½åœ¨å’Œè¿™å¥—æ¡†æ¶æ–—äº‰ã€‚</p>
<h3 data-id="heading-34">æ¨ç¿»é‡å†™</h3>
<p>ç»ˆäºï¼Œå¿æ— å¯å¿ã€‚æˆ‘æ‰¾æœºä¼šç”¨ Hadoop æ¨ç¿»äº†è¿™å¥—ç³»ç»Ÿï¼Œé‡å†™äº†ä¸€éã€‚é‡å†™åçš„ç³»ç»Ÿæ²¡æœ‰ç„å­¦é—®é¢˜ï¼Œæ²¡æœ‰è«åå…¶å¦™çš„å´©æºƒï¼Œæ€§èƒ½ç¨³å®šå¯é¢„æµ‹ï¼Œç»´æŠ¤æˆæœ¬å¤§å¹…ä¸‹é™ã€‚</p>
<h3 data-id="heading-35">å¤ç›˜ï¼šä¸ºä»€ä¹ˆä¼šå¤±è´¥ï¼Ÿ</h3>
<p><strong>ç¬¬ä¸€ï¼Œè¿‡åº¦è®¾è®¡ã€‚</strong> çˆ¬è™«ç³»ç»ŸçœŸçš„éœ€è¦åŠ¨æ€åŠ è½½ä»£ç å—ï¼Ÿå…¶å®ä¸éœ€è¦ã€‚çˆ¬è™«ç³»ç»Ÿéœ€è¦çš„æ˜¯ç¨³å®šæ€§ï¼ˆ7x24 è¿è¡Œï¼‰ã€å¯è¿½æº¯æ€§ï¼ˆæ—¥å¿—ã€ç›‘æ§ï¼‰ã€å¯æ‰©å±•æ€§ï¼ˆæ–°å¢ç½‘ç«™ï¼‰ã€‚è¿™äº›éƒ½å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å’Œæ’ä»¶åŒ–å®ç°ï¼Œæ ¹æœ¬ä¸éœ€è¦åŠ¨æ€ç¼–è¯‘ã€‚</p>
<p><strong>ç¬¬äºŒï¼ŒæŠ€æœ¯é€‰å‹é”™é…ã€‚</strong> Groovy æœ¬èº«æ˜¯ä¼˜ç§€çš„æŠ€æœ¯ï¼Œéå¸¸é€‚åˆæ’ä»¶æ¡†æ¶ã€ç”¨æˆ·è„šæœ¬ã€ä½é¢‘æ‰©å±•ç­‰åœºæ™¯ï¼ˆJenkinsã€Gradle éƒ½åœ¨ç”¨ï¼‰ã€‚ä½†çˆ¬è™«ç³»ç»Ÿæ˜¯ä»€ä¹ˆåœºæ™¯ï¼Ÿé«˜é¢‘è°ƒç”¨ï¼ˆæ¯ç§’æŠ“å–ä¸Šç™¾é¡µé¢ï¼‰ã€æ ¸å¿ƒé“¾è·¯ï¼ˆä¸èƒ½æŒ‚ï¼‰ã€è¦æ±‚æé«˜ç¨³å®šæ€§ã€‚<strong>è¿™ä¸æ˜¯ Groovy ä¸å¥½ï¼Œæ˜¯æŠŠå¥½æŠ€æœ¯ç”¨é”™äº†åœ°æ–¹ã€‚</strong></p>
<p><strong>ç¬¬ä¸‰ï¼Œç¼ºä¹çº¦æŸã€‚</strong> åŠ¨æ€èƒ½åŠ›ç»™äº†å¤ªå¤šè‡ªç”±ï¼šä»»ä½•äººéƒ½å¯ä»¥å†™åŠ¨æ€ä»£ç ï¼Œæ²¡æœ‰ä»£ç å®¡æŸ¥ï¼Œæ²¡æœ‰æµ‹è¯•è¦æ±‚ï¼Œæ²¡æœ‰è§„èŒƒçº¦æŸã€‚è‡ªç”±å¤šäº†å°±æ˜¯æ··ä¹±ï¼Œæ··ä¹±å¤šäº†å°±æ˜¯ç¾éš¾ã€‚</p>
<p><strong>ç¬¬å››ï¼Œç›‘æ§ç¼ºå¤±ã€‚</strong> æ²¡æœ‰ç›‘æ§ç±»åŠ è½½æƒ…å†µã€å†…å­˜å ç”¨è¶‹åŠ¿ã€æ€§èƒ½æŒ‡æ ‡ã€é”™è¯¯ç‡ã€‚å‡ºé—®é¢˜åªèƒ½ççŒœï¼šæ˜¯ Groovy çš„é—®é¢˜ï¼Ÿæ˜¯æ¡†æ¶çš„é—®é¢˜ï¼Ÿæ˜¯ä¸šåŠ¡ä»£ç çš„é—®é¢˜ï¼Ÿä¸çŸ¥é“ï¼Œåªèƒ½ä¸€ä¸ªä¸ªè¯•ã€‚</p>
<h3 data-id="heading-36">æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>çˆ¬è™«ç³»ç»Ÿçš„åˆç†æ¶æ„åº”è¯¥æ˜¯ï¼šé…ç½®é©±åŠ¨ï¼Œæ¯ä¸ªç½‘ç«™ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®šä¹‰ URL è§„åˆ™ã€è§£æè§„åˆ™ã€å­˜å‚¨è§„åˆ™ã€‚ç„¶åæ˜¯æ’ä»¶åŒ–ï¼Œä¸åŒç±»å‹ç½‘ç«™ç”¨ä¸åŒæ’ä»¶ï¼Œä½†æ’ä»¶æ˜¯ç¼–è¯‘å¥½çš„ jar åŒ…ï¼Œä¸æ˜¯åŠ¨æ€åŠ è½½ã€‚å†åŠ ä¸Šç°åº¦å‘å¸ƒï¼Œæ–°åŠŸèƒ½å…ˆåœ¨å°æµé‡éªŒè¯ï¼Œç¨³å®šåå†å…¨é‡ï¼Œæ ¹æœ¬ä¸éœ€è¦çƒ­åŠ è½½ã€‚æœ€åæ˜¯å®Œå–„ç›‘æ§ï¼Œæ¯ä¸ªç¯èŠ‚éƒ½æœ‰æŒ‡æ ‡ï¼Œå¼‚å¸¸ç«‹åˆ»å‘Šè­¦ï¼Œå¯å¿«é€Ÿå®šä½é—®é¢˜ã€‚</p>
<p>å¦‚æœçœŸçš„éœ€è¦åŠ¨æ€èƒ½åŠ›ï¼Œä¹Ÿåº”è¯¥åªåœ¨éæ ¸å¿ƒç¯èŠ‚ä½¿ç”¨ï¼Œæ¯”å¦‚æ•°æ®æ¸…æ´—è§„åˆ™å¯ä»¥ç”¨ QLExpressï¼Œå­—æ®µæ˜ å°„é€»è¾‘å¯ä»¥ç”¨ç®€å•è„šæœ¬ï¼Œä½†ç»å¯¹ä¸è¦ç”¨åœ¨æ ¸å¿ƒé“¾è·¯ã€‚è€Œä¸”å¿…é¡»æœ‰ä¸¥æ ¼é™åˆ¶ï¼šç™½åå•æœºåˆ¶ã€è¶…æ—¶æ§åˆ¶ã€èµ„æºé™åˆ¶ã€å®Œå–„çš„é™çº§æ–¹æ¡ˆã€‚è¿˜è¦æœ‰ç›‘æ§å‘Šè­¦ï¼šç±»åŠ è½½æ•°é‡ã€å†…å­˜å ç”¨ã€æ‰§è¡Œè€—æ—¶ã€é”™è¯¯ç‡ã€‚</p>
<h3 data-id="heading-37">æ•™è®­æ€»ç»“</h3>
<p>æŠ€æœ¯é€‰å‹è¦åŒ¹é…ä¸šåŠ¡åœºæ™¯ï¼Œä¸æ˜¯è¶Šå…ˆè¿›è¶Šå¥½ï¼Œä¸æ˜¯è¶Šçµæ´»è¶Šå¥½ã€‚æ ¸å¿ƒç³»ç»Ÿè¦ç¨³å®šå‹å€’ä¸€åˆ‡ï¼Œä¸è¦ç©èŠ±çš„ï¼Œä¸è¦è¿½æ±‚ç‚«æŠ€ã€‚åŠ¨æ€èƒ½åŠ›æ˜¯åŒåˆƒå‰‘ï¼Œç»™ä½ çµæ´»æ€§çš„åŒæ—¶ï¼Œä¹Ÿç»™ä½ å¤æ‚æ€§å’Œé£é™©ã€‚å¯¹çº¿ä¸Šè¦æœ‰æ•¬ç•ä¹‹å¿ƒï¼Œä»»ä½•æ–°æŠ€æœ¯éƒ½è¦å……åˆ†éªŒè¯ï¼Œä»»ä½•æ”¹åŠ¨éƒ½è¦æœ‰é™çº§æ–¹æ¡ˆã€‚</p>
<p>è¿™æ®µç»å†ï¼Œè®©æˆ‘æ·±åˆ»ç†è§£äº†ï¼š<strong>å¤§å¤šæ•°æ—¶å€™ï¼Œä½ çœŸçš„åªéœ€è¦å«å¤–å–ï¼Œä¸éœ€è¦å»ºå¨æˆ¿ã€‚</strong></p>
<hr/>
<h2 data-id="heading-38">ä¸ƒã€æœ‰æ²¡æœ‰ä¸¤å…¨å…¶ç¾çš„æ–¹æ¡ˆï¼Ÿ</h2>
<h3 data-id="heading-39">æ ¸å¿ƒæ€è·¯</h3>
<pre><code class="hljs language-markdown" lang="markdown">é—®é¢˜ï¼š
  èƒ½ä¸èƒ½è‡ªåŠ¨é€‰æ‹©æ‰§è¡Œæ–¹å¼ï¼Ÿ
  ç®€å•è§„åˆ™ â†’ è§£é‡Šæ‰§è¡Œï¼ˆQLExpressï¼‰
  å¤æ‚è§„åˆ™ â†’ ç¼–è¯‘æ‰§è¡Œï¼ˆGroovyï¼‰

å¥½å¤„ï¼š
<span class="hljs-bullet">  -</span> ç®€å•çš„å¿«é€Ÿå¯åŠ¨
<span class="hljs-bullet">  -</span> å¤æ‚çš„æ€§èƒ½ä¼˜åŒ–
<span class="hljs-bullet">  -</span> è‡ªåŠ¨è·¯ç”±ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥
</code></pre>
<h3 data-id="heading-40">å®ç°æ€è·¯</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HybridScriptEngine</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">QLExpressEngine</span> <span class="hljs-variable">qlEngine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QLExpressEngine</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">GroovyEngine</span> <span class="hljs-variable">groovyEngine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GroovyEngine</span>();
    
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">execute</span><span class="hljs-params">(String script, Context context)</span> {
        <span class="hljs-comment">// åˆ†æè„šæœ¬å¤æ‚åº¦</span>
        <span class="hljs-type">ScriptComplexity</span> <span class="hljs-variable">complexity</span> <span class="hljs-operator">=</span> analyzeComplexity(script);
        
        <span class="hljs-keyword">if</span> (complexity.isSimple()) {
            <span class="hljs-comment">// ç®€å•è§„åˆ™ï¼šè§£é‡Šæ‰§è¡Œ</span>
            <span class="hljs-keyword">return</span> qlEngine.execute(script, context);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å¤æ‚è§„åˆ™ï¼šç¼–è¯‘æ‰§è¡Œ</span>
            <span class="hljs-keyword">return</span> groovyEngine.execute(script, context);
        }
    }
    
    <span class="hljs-keyword">private</span> ScriptComplexity <span class="hljs-title function_">analyzeComplexity</span><span class="hljs-params">(String script)</span> {
        <span class="hljs-type">ScriptComplexity</span> <span class="hljs-variable">complexity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScriptComplexity</span>();
        
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰å¾ªç¯</span>
        <span class="hljs-keyword">if</span> (script.contains(<span class="hljs-string">"for"</span>) || script.contains(<span class="hljs-string">"while"</span>)) {
            complexity.setComplex();
        }
        
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰å‡½æ•°å®šä¹‰</span>
        <span class="hljs-keyword">if</span> (script.contains(<span class="hljs-string">"def "</span>) || script.contains(<span class="hljs-string">"function"</span>)) {
            complexity.setComplex();
        }
        
        <span class="hljs-comment">// æ£€æŸ¥åµŒå¥—å±‚æ•°</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">nestingLevel</span> <span class="hljs-operator">=</span> countNestingLevel(script);
        <span class="hljs-keyword">if</span> (nestingLevel &gt; <span class="hljs-number">3</span>) {
            complexity.setComplex();
        }
        
        <span class="hljs-keyword">return</span> complexity;
    }
}
</code></pre>
<h3 data-id="heading-41">åŠ¨æ€åˆ‡æ¢ç­–ç•¥</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdaptiveScriptEngine</span> {
    
    <span class="hljs-keyword">private</span> Map&lt;String, ExecutionStats&gt; statsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">execute</span><span class="hljs-params">(String scriptId, String script, Context context)</span> {
        <span class="hljs-type">ExecutionStats</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> statsMap.get(scriptId);
        
        <span class="hljs-keyword">if</span> (stats == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// é¦–æ¬¡æ‰§è¡Œï¼šå…ˆç”¨è§£é‡Šæ‰§è¡Œ</span>
            <span class="hljs-keyword">return</span> executeWithQL(scriptId, script, context);
        }
        
        <span class="hljs-comment">// æ ¹æ®è°ƒç”¨é¢‘ç‡å†³å®š</span>
        <span class="hljs-keyword">if</span> (stats.getCallFrequency() &gt; <span class="hljs-number">1000</span>) {
            <span class="hljs-comment">// é«˜é¢‘è°ƒç”¨ï¼šç»§ç»­ç”¨è§£é‡Šæ‰§è¡Œï¼ˆç¨³å®šï¼‰</span>
            <span class="hljs-keyword">return</span> executeWithQL(scriptId, script, context);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (stats.getAvgExecutionTime() &gt; <span class="hljs-number">10</span>) {
            <span class="hljs-comment">// ä½é¢‘ä½†è€—æ—¶ï¼šåˆ‡æ¢åˆ°ç¼–è¯‘æ‰§è¡Œ</span>
            <span class="hljs-keyword">return</span> executeWithGroovy(scriptId, script, context);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// ä½é¢‘ä¸”å¿«é€Ÿï¼šç»§ç»­ç”¨è§£é‡Šæ‰§è¡Œï¼ˆç®€å•ï¼‰</span>
            <span class="hljs-keyword">return</span> executeWithQL(scriptId, script, context);
        }
    }
}
</code></pre>
<h3 data-id="heading-42">æ³¨æ„äº‹é¡¹</h3>
<pre><code class="hljs language-markdown" lang="markdown">è¿™ç§èåˆæ–¹æ¡ˆçš„é—®é¢˜ï¼š

<span class="hljs-bullet">1.</span> å¢åŠ äº†å¤æ‚åº¦
   éœ€è¦ç»´æŠ¤ä¸¤å¥—å¼•æ“
   éœ€è¦åˆ†æè„šæœ¬å¤æ‚åº¦
   éœ€è¦æ”¶é›†æ‰§è¡Œç»Ÿè®¡
   
<span class="hljs-bullet">2.</span> å¯èƒ½è¯¯åˆ¤
   ç®€å•çš„è¢«åˆ¤æ–­æˆå¤æ‚
   å¤æ‚çš„è¢«åˆ¤æ–­æˆç®€å•
   
<span class="hljs-bullet">3.</span> åˆ‡æ¢æˆæœ¬
   ä» QL åˆ‡åˆ° Groovy éœ€è¦ç¼–è¯‘
   å¯èƒ½å½±å“æ€§èƒ½
   
å»ºè®®ï¼š
  ä¸è¦è¿‡åº¦è®¾è®¡
  å…ˆé€‰ä¸€ä¸ªä¸»æ–¹æ¡ˆ
  åªåœ¨æ˜ç¡®éœ€è¦æ—¶æ‰å¼•å…¥å¦ä¸€ä¸ª
  å¤§å¤šæ•°åœºæ™¯ï¼Œå•ä¸€æ–¹æ¡ˆå°±å¤Ÿäº†
</code></pre>
<hr/>
<h2 data-id="heading-43">å…«ã€ç»™ä½ çš„å»ºè®®ï¼šåˆ«èµ°æˆ‘ä»¬çš„å¼¯è·¯</h2>
<h3 data-id="heading-44">å¦‚æœé€‰ QLExpressï¼ˆè§£é‡Šæ‰§è¡Œï¼‰</h3>
<p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼šç¨³å®š &gt; æ€§èƒ½ï¼Œå®‰å…¨ &gt; çµæ´»ï¼Œå¯æ§ &gt; å¼ºå¤§ã€‚</p>
<p>è¿™ç§æ–¹æ¡ˆé€‚åˆè¿½æ±‚ç¨³å®šæ€§ã€è§„é¿å¤æ‚åº¦çš„å›¢é˜Ÿï¼Œå°¤å…¶æ˜¯å›¢é˜Ÿ JVM ç»éªŒä¸€èˆ¬çš„æƒ…å†µã€‚æœ€é€‚åˆçš„åœºæ™¯æ˜¯æ ¸å¿ƒé“¾è·¯ã€é«˜é¢‘è°ƒç”¨ã€ç®€å•è§„åˆ™ã€‚</p>
<p><strong>æˆ‘çš„å»ºè®®</strong>ï¼šå¦‚æœä½ çš„éœ€æ±‚åªæ˜¯ç®€å•çš„ if åˆ¤æ–­ã€æ¯”è¾ƒè¿ç®—ï¼Œåˆ«æƒ³å¤ªå¤šï¼Œå°±ç”¨ QLExpressã€‚å®ƒä¸æ˜¯æœ€å¿«çš„ï¼Œä½†æœ€ç¨³ã€‚</p>
<h3 data-id="heading-45">å¦‚æœé€‰ Groovyï¼ˆç¼–è¯‘æ‰§è¡Œï¼‰</h3>
<p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼šçµæ´» &gt; çº¦æŸï¼Œèƒ½åŠ› &gt; ç®€å•ï¼Œæ‰©å±• &gt; å›ºå®šã€‚</p>
<p>è¿™ç§æ–¹æ¡ˆé€‚åˆæœ‰ JVM è°ƒä¼˜ç»éªŒã€æœ‰å®Œå–„ç›‘æ§ã€èƒ½ç®¡ç†å¤æ‚åº¦çš„å›¢é˜Ÿã€‚<strong>æœ€é€‚åˆçš„åœºæ™¯æ˜¯æ’ä»¶æ¡†æ¶ã€ç”¨æˆ·è„šæœ¬ã€ä½é¢‘æ‰©å±•ã€‚</strong></p>
<p><strong>æˆ‘çš„å»ºè®®</strong>ï¼š</p>
<ul>
<li>å¦‚æœä½ åœ¨åš<strong>æ’ä»¶æ¡†æ¶</strong>ï¼ˆJenkinsã€IDE æ’ä»¶ã€SaaS å¹³å°å®¢æˆ·è„šæœ¬ï¼‰ï¼ŒGroovy æ˜¯æœ€ä½³é€‰æ‹©</li>
<li>å¦‚æœä½ éœ€è¦<strong>å®Œæ•´çš„ç¼–ç¨‹èƒ½åŠ›</strong>ï¼ˆå¾ªç¯ã€å‡½æ•°ã€ç±»ã€æ¥å£ï¼‰ï¼ŒGroovy æ¯” QLExpress å¼ºå¤ªå¤š</li>
<li>å¦‚æœæ˜¯<strong>ä½é¢‘åœºæ™¯</strong>ï¼ˆé…ç½®ä¸­å¿ƒã€ç®¡ç†åå°ã€æ•°æ®å¤„ç†è„šæœ¬ï¼‰ï¼ŒGroovy çš„ç¼–è¯‘è€—æ—¶å¯ä»¥æ¥å—</li>
</ul>
<p><strong>ä½†è®°ä½</strong>ï¼šä¸€å®šè¦æœ‰ç›‘æ§ï¼ˆç±»åŠ è½½æ•°é‡ï¼‰ã€æœ‰ç¼“å­˜ï¼ˆé¿å…é‡å¤ç¼–è¯‘ï¼‰ã€æœ‰é™çº§æ–¹æ¡ˆï¼ˆè„šæœ¬æ‰§è¡Œå¤±è´¥æ€ä¹ˆåŠï¼‰ã€‚</p>
<h3 data-id="heading-46">å·¥ç¨‹çš„æœ¬è´¨</h3>
<p>ä¸æ˜¯é€‰æœ€å¥½çš„ï¼Œæ˜¯é€‰æœ€åˆé€‚çš„ã€‚ä¸æ˜¯éé»‘å³ç™½ï¼Œæ˜¯æƒè¡¡å–èˆã€‚ä¸æ˜¯è¿½æ±‚æè‡´ï¼Œæ˜¯æ»¡è¶³éœ€æ±‚ã€‚ä¸æ˜¯ä¸€åŠ³æ°¸é€¸ï¼Œæ˜¯æŒç»­ä¼˜åŒ–ã€‚</p>
<h3 data-id="heading-47">è®°ä½è¿™å››å¥è¯</h3>
<p><strong>1. å¤§å¤šæ•°æ—¶å€™ï¼Œä½ åªéœ€è¦å«å¤–å–ï¼Œä¸éœ€è¦å»ºå¨æˆ¿</strong></p>
<p>ä¸è¦è¢«æŠ€æœ¯çš„å¼ºå¤§èƒ½åŠ›è¿·æƒ‘ã€‚å¤§å¤šæ•°éœ€æ±‚ï¼Œç®€å•æ–¹æ¡ˆå°±èƒ½è§£å†³ã€‚è¿‡åº¦è®¾è®¡æ˜¯ä¸‡æ¶ä¹‹æºã€‚</p>
<p><strong>2. è§£é‡Šæ‰§è¡Œä¸æ˜¯æ…¢ï¼Œæ˜¯ç¨³ï¼›ç¼–è¯‘æ‰§è¡Œä¸æ˜¯å¿«ï¼Œæ˜¯æœ‰ä»£ä»·</strong></p>
<p>QLExpress å¯åŠ¨å¿«ã€ç¨³å®šã€å¯é¢„æµ‹ï¼Œä½†æ€§èƒ½æœ‰ä¸Šé™ã€‚Groovy æ€§èƒ½å¤©èŠ±æ¿é«˜ï¼Œä½†è¦ä»˜å‡ºå¤æ‚åº¦å’Œé£é™©çš„ä»£ä»·ã€‚</p>
<p><strong>3. æŠ€æœ¯é€‰å‹é”™é…ï¼Œæ¯”æŠ€æœ¯æœ¬èº«çš„é—®é¢˜æ›´å¯æ€•</strong></p>
<p>ç”¨ Groovy åšé«˜é¢‘é£æ§ï¼Ÿå†…å­˜çˆ†ç‚¸ã€‚ç”¨ QLExpress åšå¤æ‚æ’ä»¶ï¼ŸåŠŸèƒ½å—é™ã€‚</p>
<p>ä½†åè¿‡æ¥ï¼šç”¨ Groovy åšæ’ä»¶æ¡†æ¶ï¼Ÿå®Œç¾ã€‚ç”¨ QLExpress åšè§„åˆ™å¼•æ“ï¼Ÿç¨³å®šã€‚</p>
<p>é€‰å¯¹åœºæ™¯ï¼Œæ¯”é€‰å¯¹æŠ€æœ¯æ›´é‡è¦ã€‚</p>
<p><strong>4. å¯¹çº¿ä¸Šè¦æœ‰æ•¬ç•ä¹‹å¿ƒ</strong></p>
<p>åŠ¨æ€èƒ½åŠ›å¾ˆè¯±äººï¼Œä½†ç¨³å®šæ€§æ›´é‡è¦ã€‚åœ¨æ ¸å¿ƒé“¾è·¯ä¸Šï¼šå®å¯æ…¢ä¸€ç‚¹ï¼Œä¹Ÿè¦ç¨³ï¼›å®å¯åŠŸèƒ½å¼±ä¸€ç‚¹ï¼Œä¹Ÿè¦å¯æ§ï¼›å®å¯éº»çƒ¦ä¸€ç‚¹ï¼Œä¹Ÿè¦å¯è¿½æº¯ã€‚</p>
<hr/>
<h2 data-id="heading-48">å†™åœ¨æœ€å</h2>
<p>ä¸¤å¹´çš„ä»£ä»·ï¼Œæ¢æ¥ä¸€ä¸ªæ•™è®­ï¼š<strong>ä¸åˆ†åœºæ™¯å¯¹æ¯”æŠ€æœ¯ï¼Œå°±æ˜¯è€æµæ°“ã€‚</strong></p>
<p>Groovy å¾ˆå¥½ï¼ŒQLExpress ä¹Ÿå¾ˆå¥½ã€‚ä½†åœ¨é«˜é¢‘æ ¸å¿ƒé“¾è·¯ç”¨ Groovyï¼Ÿç¾éš¾ã€‚åœ¨å¤æ‚æ’ä»¶åœºæ™¯ç”¨ QLExpressï¼Ÿå—é™ã€‚</p>
<p>é€‰å¯¹åœºæ™¯ï¼Œæ¯”é€‰å¯¹æŠ€æœ¯æ›´é‡è¦ã€‚</p>
<hr/>
<p><strong>å¦‚æœè¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ é¿å¼€æˆ‘ä»¬è¸©è¿‡çš„å‘ï¼Œè¿™ä¸¤å¹´çš„ä»£ä»·å°±å€¼äº†ã€‚</strong></p>
<p>å‰ä¸¤ç¯‡æŠ€æœ¯æ‹†è§£ï¼š</p>
<ul>
<li>ç¬¬ä¸€ç¯‡ï¼š<a href="https://juejin.cn/post/7582814236584329254" target="_blank" title="https://juejin.cn/post/7582814236584329254">QLExpress å¦‚ä½•åšåˆ°ä¸ç¼–è¯‘å°±èƒ½æ‰§è¡Œï¼Ÿ</a></li>
<li>ç¬¬äºŒç¯‡ï¼š<a href="https://juejin.cn/post/7582923861768601650" target="_blank" title="https://juejin.cn/post/7582923861768601650">è‡ªå®šä¹‰ ClassLoader åŠ¨æ€åŠ è½½ï¼šä¸é‡å¯å°±èƒ½åŠ è½½æ–°ä»£ç ï¼Ÿ</a></li>
</ul>
<p><strong>è®°ä½ï¼šæ¶æ„çš„è‰ºæœ¯ï¼Œä¸åœ¨äºç”¨äº†å¤šå°‘é«˜çº§æŠ€æœ¯ï¼Œè€Œåœ¨äºåœ¨åˆé€‚çš„åœºæ™¯ç”¨äº†åˆé€‚çš„æ–¹æ¡ˆã€‚</strong></p>
<p>é€‰å¯¹äº†ï¼Œå°±æ˜¯ç¥å™¨ï¼›é€‰é”™äº†ï¼Œå°±æ˜¯ç¾éš¾ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥MCPæœ¬è´¨â€”â€”ç¼–å†™è‡ªå®šä¹‰MCP Serverå¹¶é€šè¿‡Cursorè°ƒç”¨]]></title>    <link>https://juejin.cn/post/7583324039303184435</link>    <guid>https://juejin.cn/post/7583324039303184435</guid>    <pubDate>2025-12-14T09:15:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583324039303184435" data-draft-id="7583567658252337178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥MCPæœ¬è´¨â€”â€”ç¼–å†™è‡ªå®šä¹‰MCP Serverå¹¶é€šè¿‡Cursorè°ƒç”¨"/> <meta itemprop="keywords" content="å‰ç«¯,MCP"/> <meta itemprop="datePublished" content="2025-12-14T09:15:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤©å¤©æ‰­ç "/> <meta itemprop="url" content="https://juejin.cn/user/3349589831715801"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥MCPæœ¬è´¨â€”â€”ç¼–å†™è‡ªå®šä¹‰MCP Serverå¹¶é€šè¿‡Cursorè°ƒç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3349589831715801/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤©å¤©æ‰­ç 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T09:15:19.000Z" title="Sun Dec 14 2025 09:15:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™ç¯‡æ–‡ç« å°†æ·±å…¥æ¢è®¨ <strong>MCP (Model Context Protocol)</strong> çš„æ ¸å¿ƒåŸç†ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰å¤©æ°”å·¥å…·ç¤ºä¾‹ï¼Œæ­ç¤º AI æ¨¡å‹å¦‚ä½•ä¸æœ¬åœ°ç³»ç»Ÿè¿›è¡Œé«˜æ•ˆã€å®‰å…¨çš„äº¤äº’ã€‚</p>
<hr/>
<h3 data-id="heading-0">å®æˆ˜é…ç½®ï¼šå¯åŠ¨ä½ çš„è‡ªå®šä¹‰ MCP Server</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„æ­¥éª¤æ¥é…ç½®å¹¶è¿è¡Œä¸€ä¸ªè‡ªå®šä¹‰çš„ MCP Serverï¼Œè¯¥ Server èƒ½å¤Ÿè·å–ç”µè„‘æ‰€åœ¨åœ°çš„å®æ—¶æ—¶é—´å’Œå¤©æ°”ï¼ˆä¸ä½¿ç”¨ä»£ç†çš„å‰æä¸‹ï¼‰ã€‚</p>
<h4 data-id="heading-1">æ­¥éª¤ 1: ä»£ç å‡†å¤‡</h4>
<p>ä¸‹é¢æ˜¯æˆ‘ç¼–å†™çš„ MCP Server ï¼Œä½ å¯ä»¥å°†ä»£ç åº“æ‹‰å–åˆ°æœ¬åœ°ç›®å½•</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FObjecteee%2Fmcp%2Ftree%2Fmain%2FmyMCP" target="_blank" title="https://github.com/Objecteee/mcp/tree/main/myMCP" ref="nofollow noopener noreferrer">github.com/Objecteee/mâ€¦</a></p>
<h4 data-id="heading-2">æ­¥éª¤ 2: Cursor é…ç½®</h4>
<p>åœ¨ Cursor IDE çš„ <code>mcp.json</code> é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼ŒæŒ‡å®šä½ çš„æœ¬åœ° Server è„šæœ¬çš„è·¯å¾„ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Real Weather Tool"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"E:\project\mcp\myMCP\index.js"</span>  # è¯·ç¡®ä¿è¿™é‡Œæ˜¯ä½ çš„æœ¬åœ°æ–‡ä»¶è·¯å¾„
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>é…ç½®å®Œæˆåï¼Œæ‚¨å³å¯åœ¨ Cursor çš„å¯¹è¯æ¡†ä¸­é€šè¿‡è‡ªç„¶è¯­è¨€è°ƒç”¨è¿™ä¸ªå·¥å…·ï¼Œä¾‹å¦‚è¯¢é—®ï¼šâ€œç°åœ¨çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿâ€</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a3c959432f94e9ab583cc7755007981~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp5aSp5omt56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766308519&amp;x-signature=DmcVhZw2EJvO%2Fc50wzw%2BjoNdu3E%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-3">1. æ ¸å¿ƒæ¶æ„ï¼šä»€ä¹ˆæ˜¯ MCPï¼Ÿ</h3>
<p><strong>MCP (Model Context Protocol)</strong> æ˜¯ç”± Anthropic æå‡ºçš„ä¸€ç§å¼€æ”¾åè®®ï¼Œæ—¨åœ¨è§£å†³ <strong>å¤§å‹è¯­è¨€æ¨¡å‹ (LLM)</strong> ä¸ <strong>å¤–éƒ¨ä¸–ç•Œï¼ˆæœ¬åœ°æ–‡ä»¶ã€æ•°æ®åº“ã€API ç­‰ï¼‰</strong> ä¹‹é—´çš„ä¿¡æ¯é¸¿æ²Ÿã€‚</p>
<ul>
<li><strong>æ²¡æœ‰ MCP æ—¶ï¼š</strong> LLM ä»…ä¾èµ–è®­ç»ƒæ•°æ®ï¼Œæ— æ³•æ„ŸçŸ¥å¤–éƒ¨ä¸–ç•Œçš„å®æ—¶çŠ¶æ€ï¼ˆå¦‚å½“å‰æ—¶é—´ã€å®æ—¶å¤©æ°”ã€æœ¬åœ°ä»£ç ç»“æ„ï¼‰ã€‚å®ƒå°±åƒä¸€ä¸ªâ€œå­¤å²›ä¸Šçš„æ™ºè€…â€ã€‚</li>
<li><strong>æœ‰äº† MCPï¼š</strong> æˆ‘ä»¬ä¸º LLM æä¾›äº†ä¸€ä¸ªæ ‡å‡†åŒ–çš„â€œå·¥å…·æ’åº§â€ã€‚ä»»ä½•éµå¾ª MCP åè®®çš„å¤–éƒ¨ç¨‹åºï¼ˆå³ <strong>MCP Server</strong>ï¼‰éƒ½å¯ä»¥æ’å…¥è¿™ä¸ªæ’åº§ï¼Œä½¿ LLM èƒ½å¤Ÿ <strong>æ§åˆ¶</strong> è¿™äº›å·¥å…·å¹¶ <strong>è·å–</strong> å®æ—¶æ•°æ®ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-4">2. æœ¬è´¨åŸç†ï¼šCursor å¦‚ä½•è¿æ¥å¹¶è°ƒç”¨å·¥å…·ï¼Ÿ</h3>
<p>Cursor è¿æ¥å’Œè°ƒç”¨è‡ªå®šä¹‰ Server çš„è¿‡ç¨‹ï¼Œæœ¬è´¨ä¸Šæ˜¯åŸºäº <strong>æ ‡å‡†è¾“å…¥/è¾“å‡º (Stdio)</strong> çš„ <strong>è¿›ç¨‹é—´é€šä¿¡ (IPC)</strong> ï¼Œå®ƒé‡‡ç”¨ <strong>JSON-RPC</strong> æ ¼å¼è¿›è¡Œæ•°æ®äº¤æ¢ã€‚æˆ‘ä»¬å¯ä»¥å°†æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<h4 data-id="heading-5">é˜¶æ®µä¸€ï¼šæ¡æ‰‹ï¼ˆHandshakeï¼‰ä¸å·¥å…·å‘ç°</h4>
<ol>
<li><strong>å¯åŠ¨å­è¿›ç¨‹ï¼š</strong> å½“ä½ åœ¨ Cursor ä¸­ä¿å­˜ <code>mcp.json</code> é…ç½®åï¼ŒCursor ä¼šåœ¨åå°å¯åŠ¨ä¸€ä¸ª <strong>å­è¿›ç¨‹ (Child Process)</strong> ï¼Œæ‰§è¡Œä½ æŒ‡å®šçš„ <code>node index.js</code> è„šæœ¬ã€‚</li>
<li><strong>å‘é€è¯¢é—®ï¼š</strong> Cursorï¼ˆçˆ¶è¿›ç¨‹ï¼‰é€šè¿‡ <strong>æ ‡å‡†è¾“å…¥ (stdin)</strong> å‘ä½ çš„è„šæœ¬å‘é€ä¸€æ¡ JSON-RPC æ ¼å¼çš„æ¶ˆæ¯ï¼Œè¯·æ±‚è·å–å¯ç”¨çš„å·¥å…·åˆ—è¡¨ã€‚</li>
<li><strong>è¿”å›åˆ—è¡¨ï¼š</strong> ä½ çš„è„šæœ¬ï¼ˆå­è¿›ç¨‹ï¼‰æ”¶åˆ°è¯·æ±‚åï¼Œä¼šé€šè¿‡ <strong>æ ‡å‡†è¾“å‡º (stdout)</strong> è¿”å›ä¸€ä¸ªåŒ…å«å…¶æ‰€æœ‰å·¥å…·å®šä¹‰ï¼ˆå¦‚ <code>TimeWeatherReporter</code>ï¼‰çš„ JSON å“åº”ã€‚è¿™å¯¹åº”äºä»£ç ä¸­çš„ <code>server.setRequestHandler(ListToolsRequestSchema...)</code>ã€‚</li>
</ol>
<h4 data-id="heading-6">é˜¶æ®µäºŒï¼šå¾…å‘½ä¸å·¥å…·è°ƒç”¨</h4>
<ol>
<li><strong>å¾…å‘½ï¼š</strong> åªè¦ Cursor ä¸å…³é—­ï¼Œä½ çš„è„šæœ¬è¿›ç¨‹å°±ä¼šåœ¨åå°æŒç»­è¿è¡Œï¼Œç­‰å¾…è°ƒç”¨æŒ‡ä»¤ã€‚</li>
<li><strong>LLM è§¦å‘ï¼š</strong> ç”¨æˆ·åœ¨èŠå¤©æ¡†è¾“å…¥æŒ‡ä»¤ï¼ˆå¦‚â€œç°åœ¨çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿâ€ï¼‰ï¼ŒCursor å†…ç½®çš„ AI æ¨¡å‹åˆ†æè¯·æ±‚ï¼Œå†³å®šè°ƒç”¨å“ªä¸ªå·¥å…·ã€‚</li>
<li><strong>å‘é€æŒ‡ä»¤ï¼š</strong> Cursor å‘ä½ çš„è„šæœ¬å‘é€ä¸€æ¡ JSON-RPC <strong>è°ƒç”¨è¯·æ±‚</strong>ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å·¥å…·åç§°å’Œå‚æ•°ã€‚</li>
<li><strong>æ‰§è¡Œä»»åŠ¡ï¼š</strong> ä½ çš„è„šæœ¬æ¥æ”¶æŒ‡ä»¤ï¼Œæ‰§è¡Œç›¸åº”çš„å†…éƒ¨å‡½æ•°ï¼ˆä¾‹å¦‚è¯·æ±‚ <code>wttr.in</code> è·å–å¤©æ°”ï¼‰ã€‚</li>
<li><strong>åé¦ˆç»“æœï¼š</strong> è„šæœ¬å°†æ‰§è¡Œç»“æœæ‰“åŒ…æˆ JSONï¼Œé€šè¿‡ <strong>stdout</strong> å‘å›ç»™ Cursorã€‚</li>
<li><strong>ç»“æœå±•ç¤ºï¼š</strong> Cursor æ¥æ”¶åˆ°å·¥å…·è¾“å‡ºçš„åŸå§‹æ•°æ®ï¼Œå°†å…¶ä½œä¸º <strong>ä¸Šä¸‹æ–‡</strong> ä¼ é€’ç»™ AI æ¨¡å‹ï¼Œç”±æ¨¡å‹ç»„ç»‡æˆè‡ªç„¶è¯­è¨€çš„ç­”æ¡ˆå›å¤ç”¨æˆ·ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-7">3. ä»£ç å±‚é¢çš„å…³é”®å®ç°ï¼šMCP Server è¿è¡Œæœºåˆ¶ (<code>index.js</code>)</h3>
<p>æˆ‘ä»¬çš„æ³¨æ„åŠ›ä¸è¦æ”¾åœ¨ä»£ç çš„å®ç°ä¸Šï¼Œè¦æ”¾åœ¨ä»£ç çš„æµç¨‹ä¸Šï¼Œå› ä¸ºMCPåªæ˜¯ä¸€ç§è§„èŒƒã€‚</p>
<p>è¿™ä¸ª Node.js è„šæœ¬é€šè¿‡éµå¾ª MCP è§„èŒƒï¼Œå¹¶åˆ©ç”¨æ ‡å‡†è¾“å…¥/è¾“å‡ºæµ (Stdio) å®ç°é€šä¿¡ã€‚ä»¥ä¸‹æ˜¯é©±åŠ¨ MCP Server è¿è¡Œçš„äº”ä¸ªå…³é”®ä»£ç ç‰‡æ®µï¼š</p>
<h4 data-id="heading-8">3.1 æ ¸å¿ƒæ¨¡å—å¯¼å…¥ï¼šå®šä¹‰åè®®ä¸ä¼ è¾“å±‚</h4>

























<table><thead><tr><th><strong>ä»£ç ç‰‡æ®µ</strong></th><th><strong>ä½œç”¨æè¿°</strong></th><th><strong>æ ¸å¿ƒåŸç†</strong></th></tr></thead><tbody><tr><td><code>import { Server } from "@modelcontextprotocol/sdk/server/index.js";</code></td><td><strong>Server å®ä¾‹</strong></td><td>MCP æœåŠ¡ç«¯æ ¸å¿ƒç±»ï¼Œè´Ÿè´£å¤„ç† JSON-RPC è¯·æ±‚å’Œå“åº”ã€‚</td></tr><tr><td><code>import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";</code></td><td><strong>Stdio ä¼ è¾“å±‚</strong></td><td>å£°æ˜é€šä¿¡è½½ä½“æ˜¯åŸºäº <strong>æ ‡å‡†è¾“å…¥/è¾“å‡º (stdin/stdout)</strong> ï¼Œè€Œéç½‘ç»œç«¯å£ã€‚</td></tr><tr><td><code>import { CallToolRequestSchema, ListToolsRequestSchema } from ...</code></td><td><strong>åè®®å®šä¹‰</strong></td><td>å¯¼å…¥è¯·æ±‚çš„ JSON Schemaï¼Œç”¨äºè§£æ Cursor å‘æ¥çš„ä¸åŒç±»å‹çš„æŒ‡ä»¤ã€‚</td></tr></tbody></table>
<h4 data-id="heading-9">3.2 åˆå§‹åŒ– MCP æœåŠ¡å™¨</h4>
<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-keyword">const</span> <span class="hljs-built_in">server</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Server</span>(
  {
    name: <span class="hljs-string">"simple-weather-server"</span>,
    version: <span class="hljs-string">"1.0.0"</span>,
  },
  {
    capabilities: {
      tools: {},
    },
  }
);
</code></pre>
<p><strong>ä½œç”¨ï¼š</strong> åˆ›å»ºæœåŠ¡å™¨å®ä¾‹ã€‚<code>capabilities.tools: {}</code> æ˜ç¡®å‘Šè¯‰ MCPï¼Œè¯¥æœåŠ¡å™¨å…·å¤‡æä¾›å·¥å…·çš„èƒ½åŠ›ã€‚</p>
<h4 data-id="heading-10">3.3 æ³¨å†Œå·¥å…·åˆ—è¡¨ï¼šå“åº”â€œæ¡æ‰‹â€è¯·æ±‚</h4>
<pre><code class="hljs language-php" lang="php">server.<span class="hljs-title function_ invoke__">setRequestHandler</span>(ListToolsRequestSchema, <span class="hljs-title function_ invoke__">async</span> () =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">tools</span>: [
      {
        <span class="hljs-attr">name</span>: <span class="hljs-string">"TimeWeatherReporter"</span>,
        <span class="hljs-attr">description</span>: <span class="hljs-string">"Get current system time and weather..."</span>,
        <span class="hljs-attr">inputSchema</span>: {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"object"</span>,
          <span class="hljs-attr">properties</span>: {
            <span class="hljs-attr">location</span>: {
              <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span>,
              <span class="hljs-attr">description</span>: <span class="hljs-string">"Optional. City name (e.g. 'Beijing')..."</span>,
            },
          },
          <span class="hljs-attr">required</span>: [],
        },
      },
    ],
  };
});
</code></pre>
<p><strong>ä½œç”¨</strong>  è¿™æ˜¯<strong>æ¡æ‰‹é˜¶æ®µï¼ˆHandshakeï¼‰</strong> çš„å…³é”®ã€‚å½“ Cursor é¦–æ¬¡å¯åŠ¨å­è¿›ç¨‹æ—¶ï¼Œä¼šå‘é€ <code>ListToolsRequestSchema</code> è¯·æ±‚ã€‚è¯¥ä»£ç ç‰‡æ®µè´Ÿè´£è¿”å›ä¸€ä¸ªæ¸…æ™°çš„ <strong>JSON Schema</strong> æè¿°ï¼š</p>
<ul>
<li><strong>name:</strong> å·¥å…·çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</li>
<li><strong>description:</strong> ä¾› AI ç†è§£å·¥å…·ç”¨é€”çš„è‡ªç„¶è¯­è¨€æè¿°ã€‚</li>
<li><strong>inputSchema:</strong> <strong>JSON Schema</strong> æ ¼å¼çš„å‚æ•°å®šä¹‰ï¼ŒAI ä¾èµ–æ­¤ä¿¡æ¯æ¥æ„é€ æ­£ç¡®çš„è°ƒç”¨å‚æ•°ã€‚</li>
</ul>
<h4 data-id="heading-11">3.4 å¤„ç†å·¥å…·è°ƒç”¨ï¼šæ‰§è¡Œä¸šåŠ¡é€»è¾‘</h4>
<pre><code class="hljs language-csharp" lang="csharp">server.setRequestHandler(CallToolRequestSchema, <span class="hljs-keyword">async</span> (request) =&gt; {
  <span class="hljs-keyword">if</span> (request.<span class="hljs-keyword">params</span>.name === <span class="hljs-string">"TimeWeatherReporter"</span>) {
    <span class="hljs-keyword">const</span> location = request.<span class="hljs-keyword">params</span>.arguments?.location;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> getSystemStyleWeather(location); <span class="hljs-comment">// è°ƒç”¨å®é™…çš„ä¸šåŠ¡å‡½æ•°</span>
  }
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"Tool not found"</span>);
});
</code></pre>
<p><strong>ä½œç”¨ï¼š</strong> è¿™æ˜¯<strong>æ‰§è¡Œé˜¶æ®µï¼ˆExecutionï¼‰</strong> çš„æ ¸å¿ƒã€‚å½“ Cursor çš„ AI å†³å®šè°ƒç”¨å·¥å…·æ—¶ï¼Œä¼šå‘é€ <code>CallToolRequestSchema</code> è¯·æ±‚ã€‚è¿™æ®µä»£ç æ ¹æ® <code>request.params.name</code> åŒ¹é…åˆ°å¯¹åº”çš„ä¸šåŠ¡é€»è¾‘ (<code>getSystemStyleWeather</code>)ï¼Œæ‰§è¡Œåå°†ç»“æœè¿”å›ç»™ Cursorã€‚</p>
<h4 data-id="heading-12">3.5 å¯åŠ¨æœåŠ¡å™¨ï¼šè¿æ¥åˆ° Stdio æµ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> transport = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StdioServerTransport</span>();
  <span class="hljs-keyword">await</span> server.<span class="hljs-title function_">connect</span>(transport);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Simple Weather MCP Server running on stdio"</span>);
}
</code></pre>
<p><strong>ä½œç”¨ï¼š</strong> <strong>è¿æ¥ç‚¹ã€‚</strong> <code>StdioServerTransport()</code> åˆ›å»ºäº†ä¼ è¾“é€šé“ï¼Œ<code>server.connect(transport)</code> åˆ™å°†æœåŠ¡å™¨å®ä¾‹ç»‘å®šåˆ°è¿™ä¸ªé€šé“ä¸Šã€‚è‡³æ­¤ï¼Œæ‚¨çš„ Node.js è„šæœ¬å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥é€šè¿‡ <code>stdin/stdout</code> ä¸ Cursor è¿›ç¨‹è¿›è¡ŒåŒå‘é€šä¿¡ã€‚</p>
<hr/>
<h3 data-id="heading-13">4. æ€»ç»“ï¼šMCP çš„æœ¬è´¨</h3>






























<table><thead><tr><th><strong>è§’è‰²</strong></th><th><strong>å®ä½“</strong></th><th><strong>èŒè´£</strong></th></tr></thead><tbody><tr><td><strong>é›‡ä¸» (Client)</strong></td><td>Cursor IDE (çˆ¶è¿›ç¨‹)</td><td>å¯åŠ¨å¹¶ç›‘æ§å·¥å…·ï¼Œå‘é€è°ƒç”¨æŒ‡ä»¤ï¼Œæ¥æ”¶å¹¶å¤„ç†ç»“æœã€‚</td></tr><tr><td><strong>é›‡å‘˜ (Server)</strong></td><td><code>node index.js</code> (å­è¿›ç¨‹)</td><td>æ¥æ”¶æŒ‡ä»¤ï¼Œæ‰§è¡Œå®é™…ä»»åŠ¡ï¼ˆå¦‚ API è°ƒç”¨ã€æ–‡ä»¶è¯»å†™ï¼‰ï¼Œè¿”å›åŸå§‹æ•°æ®ã€‚</td></tr><tr><td><strong>å·¥ä½œåˆåŒ (Protocol)</strong></td><td>MCP åè®®</td><td>è§„å®šäº†æ¡æ‰‹å’Œè°ƒç”¨è¿‡ç¨‹ä¸­ JSON æ•°æ®çš„ç»“æ„å’Œæ ‡å‡†ã€‚</td></tr><tr><td><strong>å¯¹è®²æœº (Transport)</strong></td><td>Stdio (æ ‡å‡†è¾“å…¥/è¾“å‡º)</td><td>å®ç°æœ¬åœ°çˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹ä¹‹é—´å³æ—¶ã€å®‰å…¨çš„é€šä¿¡ã€‚</td></tr></tbody></table>
<p>MCP çš„ç²¾å¦™ä¹‹å¤„åœ¨äºå®ƒçš„<strong>è§£è€¦æ€§</strong>å’Œ<strong>å®‰å…¨æ€§</strong>ï¼šCursor å®¢æˆ·ç«¯æ— éœ€å…³å¿ƒä½ çš„ Server æ˜¯ç”¨ Node.jsã€Python è¿˜æ˜¯ Go ç¼–å†™ã€‚åªè¦ä½ çš„ç¨‹åºç¬¦åˆ MCP åè®®ï¼Œèƒ½å¤Ÿé€šè¿‡å‘½ä»¤è¡Œæµæ¥æ”¶å’Œå‘é€ JSON æ•°æ®ï¼Œå®ƒå°±èƒ½æ— ç¼åœ°æˆä¸º AI çš„å¤–éƒ¨å·¥å…·ï¼Œæå¤§åœ°æ‰©å±•äº† LLM çš„èƒ½åŠ›è¾¹ç•Œã€‚</p>
<hr/>
<p><strong>è‡ªå®šä¹‰MCP Serverä»£ç </strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Server</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/server/index.js"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">StdioServerTransport</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/server/stdio.js"</span>;
<span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">CallToolRequestSchema</span>,
  <span class="hljs-title class_">ListToolsRequestSchema</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/types.js"</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">"zod"</span>;

<span class="hljs-comment">// 1. Initialize MCP Server</span>
<span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Server</span>(
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"simple-weather-server"</span>,
    <span class="hljs-attr">version</span>: <span class="hljs-string">"1.0.0"</span>,
  },
  {
    <span class="hljs-attr">capabilities</span>: {
      <span class="hljs-attr">tools</span>: {},
    },
  }
);

<span class="hljs-comment">// 2. Define Tool Logic using wttr.in (No API Key required)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getSystemStyleWeather</span>(<span class="hljs-params">location</span>) {
  <span class="hljs-comment">// --- Get Real Local Time (System Time) ---</span>
  <span class="hljs-keyword">const</span> now = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
  <span class="hljs-keyword">const</span> localTime = now.<span class="hljs-title function_">toLocaleTimeString</span>(<span class="hljs-string">"zh-CN"</span>, {
    <span class="hljs-attr">hour</span>: <span class="hljs-string">"2-digit"</span>,
    <span class="hljs-attr">minute</span>: <span class="hljs-string">"2-digit"</span>,
    <span class="hljs-attr">second</span>: <span class="hljs-string">"2-digit"</span>,
    <span class="hljs-attr">hour12</span>: <span class="hljs-literal">false</span>,
  });
  <span class="hljs-keyword">const</span> localDate = now.<span class="hljs-title function_">toLocaleDateString</span>(<span class="hljs-string">"zh-CN"</span>);

  <span class="hljs-comment">// --- Determine URL ---</span>
  <span class="hljs-comment">// wttr.in automatically detects location by IP if no location is provided</span>
  <span class="hljs-comment">// format=j1 gives us a JSON response</span>
  <span class="hljs-keyword">let</span> url = <span class="hljs-string">"https://wttr.in/?format=j1"</span>;
  <span class="hljs-keyword">if</span> (location) {
    url = <span class="hljs-string">`https://wttr.in/<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(location)}</span>?format=j1`</span>;
  }

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(url);
    <span class="hljs-keyword">const</span> data = response.<span class="hljs-property">data</span>;
    
    <span class="hljs-comment">// Parse wttr.in specific JSON structure</span>
    <span class="hljs-keyword">const</span> current = data.<span class="hljs-property">current_condition</span>[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">const</span> area = data.<span class="hljs-property">nearest_area</span>[<span class="hljs-number">0</span>];

    <span class="hljs-keyword">const</span> weatherInfo = {
      <span class="hljs-attr">location</span>: location || area.<span class="hljs-property">areaName</span>[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>, <span class="hljs-comment">// Use detected name if no input</span>
      <span class="hljs-attr">region</span>: area.<span class="hljs-property">region</span>[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>,
      <span class="hljs-attr">condition</span>: current.<span class="hljs-property">weatherDesc</span>[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>,
      <span class="hljs-attr">temperature_c</span>: current.<span class="hljs-property">temp_C</span>,
      <span class="hljs-attr">feelslike_c</span>: current.<span class="hljs-property">FeelsLikeC</span>,
      <span class="hljs-attr">humidity</span>: current.<span class="hljs-property">humidity</span>,
      <span class="hljs-attr">wind_kph</span>: current.<span class="hljs-property">windspeedKmph</span>,
      <span class="hljs-attr">data_source</span>: <span class="hljs-string">"wttr.in (IP-based auto-location)"</span>
    };

    <span class="hljs-comment">// --- Construct Result ---</span>
    <span class="hljs-keyword">const</span> result = {
      <span class="hljs-attr">status</span>: <span class="hljs-string">"success"</span>,
      <span class="hljs-attr">tool</span>: <span class="hljs-string">"SystemWeatherReporter"</span>,
      <span class="hljs-attr">system_time</span>: <span class="hljs-string">`<span class="hljs-subst">${localDate}</span> <span class="hljs-subst">${localTime}</span>`</span>,
      <span class="hljs-attr">weather</span>: weatherInfo
    };

    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">content</span>: [
        {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span>,
          <span class="hljs-attr">text</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>),
        },
      ],
    };

  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">content</span>: [{ <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">`Unable to fetch weather data. Please check your network connection. Error: <span class="hljs-subst">${error.message}</span>`</span> }],
      <span class="hljs-attr">isError</span>: <span class="hljs-literal">true</span>,
    };
  }
}

<span class="hljs-comment">// 3. Register Tools</span>
server.<span class="hljs-title function_">setRequestHandler</span>(<span class="hljs-title class_">ListToolsRequestSchema</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">tools</span>: [
      {
        <span class="hljs-attr">name</span>: <span class="hljs-string">"TimeWeatherReporter"</span>,
        <span class="hljs-attr">description</span>: <span class="hljs-string">"Get current system time and weather. Automatically detects location if not specified. No API key required."</span>,
        <span class="hljs-attr">inputSchema</span>: {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"object"</span>,
          <span class="hljs-attr">properties</span>: {
            <span class="hljs-attr">location</span>: {
              <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span>,
              <span class="hljs-attr">description</span>: <span class="hljs-string">"Optional. City name (e.g. 'Beijing'). If omitted, uses auto-detection."</span>,
            },
          },
          <span class="hljs-attr">required</span>: [],
        },
      },
    ],
  };
});

<span class="hljs-comment">// 4. Handle Tool Calls</span>
server.<span class="hljs-title function_">setRequestHandler</span>(<span class="hljs-title class_">CallToolRequestSchema</span>, <span class="hljs-keyword">async</span> (request) =&gt; {
  <span class="hljs-keyword">if</span> (request.<span class="hljs-property">params</span>.<span class="hljs-property">name</span> === <span class="hljs-string">"TimeWeatherReporter"</span>) {
    <span class="hljs-keyword">const</span> location = request.<span class="hljs-property">params</span>.<span class="hljs-property">arguments</span>?.<span class="hljs-property">location</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">getSystemStyleWeather</span>(location);
  }
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Tool not found"</span>);
});

<span class="hljs-comment">// 5. Start Server</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> transport = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StdioServerTransport</span>();
  <span class="hljs-keyword">await</span> server.<span class="hljs-title function_">connect</span>(transport);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Simple Weather MCP Server running on stdio"</span>);
}

<span class="hljs-title function_">main</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Server error:"</span>, error);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
});

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Androidæ’ä»¶åŒ–åŸç†ä¸æ–¹æ¡ˆè¯¦è§£]]></title>    <link>https://juejin.cn/post/7582958136258117668</link>    <guid>https://juejin.cn/post/7582958136258117668</guid>    <pubDate>2025-12-14T08:59:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582958136258117668" data-draft-id="7583215836690120745" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Androidæ’ä»¶åŒ–åŸç†ä¸æ–¹æ¡ˆè¯¦è§£"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-14T08:59:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é™†ä¸šèª"/> <meta itemprop="url" content="https://juejin.cn/user/13629904404157"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Androidæ’ä»¶åŒ–åŸç†ä¸æ–¹æ¡ˆè¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/13629904404157/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é™†ä¸šèª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T08:59:09.000Z" title="Sun Dec 14 2025 08:59:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Androidæ’ä»¶åŒ–æ˜¯ä¸€ç§å¼€å‘æ¨¡å¼ï¼Œå®ƒå…è®¸æˆ‘ä»¬åŠ¨æ€åœ°åŠ è½½å’Œå¸è½½APKï¼Œä»è€Œå®ç°æ¨¡å—åŒ–å¼€å‘ï¼Œçƒ­æ›´æ–°ç­‰åŠŸèƒ½ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»Androidæ’ä»¶åŒ–çš„åŸç†ï¼Œä»¥åŠå‡ ç§ä¸»æµçš„Androidæ’ä»¶åŒ–æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-0">ä¸€ã€Androidæ’ä»¶åŒ–åŸç†</h2>
<h3 data-id="heading-1">1.1 ç±»åŠ è½½ä¸åŒäº²å§”æ‰˜æœºåˆ¶</h3>
<p>Androidæ’ä»¶åŒ–çš„æ ¸å¿ƒåŸç†æ˜¯åŸºäºJavaçš„ç±»åŠ è½½æœºåˆ¶ã€‚åœ¨Javaä¸­ï¼ŒClassLoaderè´Ÿè´£åŠ è½½ç±»ã€‚æ¯ä¸ªClassLoaderéƒ½æœ‰ä¸€ä¸ªçˆ¶ClassLoaderï¼Œå½“æˆ‘ä»¬å°è¯•åŠ è½½ä¸€ä¸ªç±»æ—¶ï¼ŒClassLoaderä¼šé¦–å…ˆå°è¯•è®©å®ƒçš„çˆ¶ClassLoaderåŠ è½½è¿™ä¸ªç±»ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„åŒäº²å§”æ‰˜æœºåˆ¶ã€‚è¿™ç§æœºåˆ¶å¯ä»¥ç¡®ä¿åŒä¸€ä¸ªç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡ã€‚</p>
<p>åœ¨Androidæ’ä»¶åŒ–ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ClassLoaderæ¥åŠ è½½æ’ä»¶ä¸­çš„ç±»ã€‚è¿™ä¸ªClassLoaderçš„çˆ¶ClassLoaderæ˜¯å®¿ä¸»åº”ç”¨çš„ClassLoaderï¼Œå› æ­¤ï¼Œæ’ä»¶ä¸­çš„ç±»å¯ä»¥è®¿é—®å®¿ä¸»åº”ç”¨ä¸­çš„ç±»ï¼Œä½†æ˜¯å®¿ä¸»åº”ç”¨ä¸­çš„ç±»ä¸èƒ½è®¿é—®æ’ä»¶ä¸­çš„ç±»ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e64d0fc8afd942439fcc4b6f07f933f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZmG5Lia6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766307783&amp;x-signature=Dzm7XdbfBsPd%2BOXh7u49YJuja2U%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-2">1.2 èµ„æºåŠ è½½</h3>
<p>åœ¨Androidä¸­ï¼Œèµ„æºæ–‡ä»¶æ˜¯é€šè¿‡Resourceså¯¹è±¡æ¥åŠ è½½çš„ã€‚æ¯ä¸ªAPKéƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„Resourceså¯¹è±¡ï¼Œç”¨äºåŠ è½½å®ƒè‡ªå·±çš„èµ„æºæ–‡ä»¶ã€‚</p>
<p>åœ¨Androidæ’ä»¶åŒ–ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Resourceså¯¹è±¡æ¥åŠ è½½æ’ä»¶ä¸­çš„èµ„æºæ–‡ä»¶ã€‚è¿™ä¸ªResourceså¯¹è±¡çš„AssetManageræ˜¯é€šè¿‡åå°„åˆ›å»ºçš„ï¼Œå¯ä»¥åŠ è½½ä»»æ„è·¯å¾„çš„APKæ–‡ä»¶ã€‚</p>
<h3 data-id="heading-3">1.3 å››å¤§ç»„ä»¶æ”¯æŒ</h3>
<p>åœ¨Androidæ’ä»¶åŒ–ä¸­ï¼Œå››å¤§ç»„ä»¶ï¼ˆActivityï¼ŒServiceï¼ŒBroadcastReceiverï¼ŒContentProviderï¼‰çš„æ”¯æŒæ˜¯ä¸€ä¸ªé‡è¦çš„é—®é¢˜ã€‚å› ä¸ºåœ¨Androidç³»ç»Ÿä¸­ï¼Œè¿™äº›ç»„ä»¶éƒ½éœ€è¦åœ¨AndroidManifest.xmlä¸­è¿›è¡Œå£°æ˜ï¼Œè€Œæ’ä»¶APKçš„AndroidManifest.xmlæ˜¯ä¸ä¼šè¢«è§£æçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é‡‡å–ä¸€äº›ç‰¹æ®Šçš„æ‰‹æ®µæ¥æ”¯æŒè¿™äº›ç»„ä»¶ã€‚</p>
<p>Activityï¼šActivityæ˜¯æœ€å¸¸ç”¨çš„ç»„ä»¶ï¼Œä¹Ÿæ˜¯æœ€éœ€è¦æ”¯æŒçš„ç»„ä»¶ã€‚åœ¨æ’ä»¶åŒ–ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Proxy Activityä»£ç†æˆ–è€…Hookæ–¹å¼æ¥æ”¯æŒActivityã€‚</p>
<p>Serviceï¼šServiceçš„æ”¯æŒä¹Ÿæ˜¯é€šè¿‡ä»£ç†æˆ–è€…Hookæ–¹å¼æ¥å®ç°çš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å®¿ä¸»ä¸­é¢„å…ˆå£°æ˜ä¸€äº›ä»£ç†Serviceï¼Œç„¶ååœ¨è¿è¡Œæ—¶å°†è¿™äº›ä»£ç†Serviceæ›¿æ¢ä¸ºæ’ä»¶ä¸­çš„Serviceã€‚</p>
<p>BroadcastReceiverï¼šBroadcastReceiverçš„æ”¯æŒç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ³¨å†ŒBroadcastReceiverï¼Œæˆ–è€…é€šè¿‡Hookæ–¹å¼æ¥æ”¯æŒé™æ€æ³¨å†Œçš„BroadcastReceiverã€‚</p>
<p>ContentProviderï¼šContentProviderçš„æ”¯æŒæ˜¯æœ€å¤æ‚çš„ï¼Œå› ä¸ºContentProvideråœ¨åº”ç”¨å¯åŠ¨æ—¶å°±ä¼šè¢«åˆ›å»ºï¼Œè€Œä¸”æ¯ä¸ªContentProvideréƒ½éœ€è¦ä¸€ä¸ªå”¯ä¸€çš„authorityã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Hookæ–¹å¼æ¥æ”¯æŒContentProviderï¼Œæˆ–è€…ä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„æŠ€å·§ï¼Œä¾‹å¦‚ä½¿ç”¨åŒä¸€ä¸ªauthorityæ¥æ”¯æŒå¤šä¸ªContentProviderã€‚</p>
<h3 data-id="heading-4">1.4 ä¸¤ç§æ”¯æŒActivityçš„æ–¹å¼</h3>
<p><strong>æ‰€æœ‰çš„æ’ä»¶æ¡†æ¶åœ¨è§£å†³çš„é—®é¢˜éƒ½ä¸æ˜¯å¦‚ä½•åŠ¨æ€åŠ è½½ç±»ï¼Œè€Œæ˜¯åŠ¨æ€åŠ è½½çš„Activityæ²¡æœ‰åœ¨AndroidManifestä¸­æ³¨å†Œï¼Œè¯¥å¦‚ä½•èƒ½æ­£å¸¸è¿è¡Œã€‚å¦‚æœAndroidç³»ç»Ÿæ²¡æœ‰AndroidManifestçš„é™åˆ¶ï¼Œé‚£ä¹ˆæ‰€æœ‰æ’ä»¶æ¡†æ¶éƒ½æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ã€‚å› ä¸ºJavaè¯­è¨€æœ¬èº«å°±æ”¯æŒåŠ¨æ€æ›´æ–°å®ç°çš„èƒ½åŠ›ã€‚</strong></p>
<ol>
<li>
<p>Proxy Activityä»£ç†ï¼šè¿™ç§æ–¹å¼æ˜¯é€šè¿‡åœ¨å®¿ä¸»åº”ç”¨ä¸­é¢„å…ˆå£°æ˜ä¸€äº›ä»£ç†Activityï¼Œç„¶ååœ¨è¿è¡Œæ—¶å°†è¿™äº›ä»£ç†Activityæ›¿æ¢ä¸ºæ’ä»¶ä¸­çš„Activityã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œä½†æ˜¯æœ‰ä¸€äº›é™åˆ¶ï¼Œä¾‹å¦‚æ— æ³•æ”¯æŒæ’ä»¶ä¸­çš„Activityåœ¨AndroidManifest.xmlä¸­å£°æ˜çš„ä¸€äº›å±æ€§ã€‚</p>
</li>
<li>
<p>Hookæ–¹å¼ï¼šè¿™ç§æ–¹å¼æ˜¯é€šè¿‡Hook AMSï¼ˆActivity Manager Serviceï¼‰ï¼Œæ›¿æ¢AMSä¸­çš„ä¸€äº›æ–¹æ³•ï¼Œä»è€Œç»•è¿‡AMSçš„æ£€æŸ¥ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å®Œå…¨æ”¯æŒæ’ä»¶ä¸­çš„Activityï¼Œä½†æ˜¯å®ç°å¤æ‚ï¼Œéœ€è¦å¯¹Androidç³»ç»Ÿæœ‰æ·±å…¥çš„äº†è§£ã€‚</p>
</li>
</ol>
<h2 data-id="heading-5">äºŒã€Androidæ’ä»¶åŒ–æ–¹æ¡ˆ</h2>
<p>ç›®å‰ï¼Œå¸‚é¢ä¸Šæœ‰å‡ ç§ä¸»æµçš„Androidæ’ä»¶åŒ–æ–¹æ¡ˆï¼ŒåŒ…æ‹¬Shadowï¼ŒRePluginï¼ŒAABï¼ˆAndroid App Bundleï¼‰ï¼ŒQigsawï¼Œä»¥åŠAtlasã€‚</p>
<h3 data-id="heading-6">2.1 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2FShadow" target="_blank" title="https://github.com/Tencent/Shadow" ref="nofollow noopener noreferrer">Shadow</a></h3>
<h4 data-id="heading-7">2.1.1 Shadowç®€ä»‹</h4>
<p>Shadowæ˜¯è…¾è®¯å¼€å‘çš„ä¸€æ¬¾æ’ä»¶åŒ–æ¡†æ¶ï¼Œå…¶è®¾è®¡ç›®æ ‡æ˜¯ä¸ä¿®æ”¹APKæ–‡ä»¶çš„æƒ…å†µä¸‹å®ç°æ’ä»¶åŒ–ã€‚Shadowé€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„ClassLoaderæ¥åŠ è½½æ’ä»¶ï¼Œä»è€Œå®ç°æ’ä»¶çš„åŠ¨æ€åŠ è½½å’Œå¸è½½ã€‚</p>
<ul>
<li>Shadowæ‰€æŒ‡çš„æ’ä»¶æ˜¯æ’ä»¶çš„ä»£ç å®Œå…¨æ˜¯ä¸€ä¸ªæ­£å¸¸å¯å®‰è£…çš„Appä»£ç ï¼Œæ— éœ€å¼•ç”¨ä»»ä½•Shadowçš„åº“ã€‚è¿™æ ·çš„Appä»£ç åº”ç”¨äº†Shadowä¹‹åå¯ä»¥å…å®‰è£…è¿è¡Œåœ¨å¦ä¸€ä¸ªAppä¸­ã€‚</li>
<li>Shadowæ˜¯ä¸€ä¸ªå®Œå…¨æ— Hackï¼Œç”šè‡³é›¶åå°„å®ç°çš„Androidæ’ä»¶æ¡†æ¶ã€‚</li>
<li>Shadowæ˜¯ä¸€ä¸ªå…¨åŠ¨æ€å®ç°çš„æ’ä»¶æ¡†æ¶ï¼Œå°±æ˜¯è¯´æ’ä»¶æ¡†æ¶çš„ä»£ç è·Ÿæ’ä»¶çš„ä»£ç ä¸€æ ·éƒ½æ˜¯åŠ¨æ€å‘å¸ƒçš„ã€‚</li>
</ul>
<h4 data-id="heading-8">2.1.2 å…¨åŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„å’ŒéåŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„</h4>
<p>é‚£ä¹ˆä»€ä¹ˆæ˜¯å…¨åŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„ï¼Ÿæˆ‘ä»¬å’ŒéåŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„è¿›è¡Œå¯¹æ¯”çœ‹çœ‹ã€‚</p>
<ol>
<li>éåŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8caf7a1d888240768faf4ebdf72396ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZmG5Lia6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766307783&amp;x-signature=iLBxzO5RnhwQ3HzAvGIRRM054Og%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<ol start="2">
<li>å…¨åŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„å›¾</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/261fe4ff0e2046398ceb3464151fa565~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZmG5Lia6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766307783&amp;x-signature=RcxVW6cfdIMjWi4YVz%2B92syGFb4%3D" alt="å…¨åŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„å›¾" loading="lazy"/></p>
<h4 data-id="heading-9">2.1.3 Shadowä¸»è¦æ¨¡å—åˆ’åˆ†</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[å®¿ä¸»åº”ç”¨] --&gt;|åŒ…å«| B[åŸºç¡€æ¥å£]
    A --&gt;|æ³¨å†Œ| C[å£³å­ä»£ç†ç»„ä»¶]
    A --&gt;|é›†æˆ| D[æ’ä»¶ç®¡ç†å™¨]
    D --&gt;|ç®¡ç†| E[æ’ä»¶åŒ…]
    E --&gt;|åŒ…å«| F[åŠ è½½å™¨]
    E --&gt;|åŒ…å«| G[è¿è¡Œæ—¶]
    E --&gt;|åŒ…å«| H[ä¸šåŠ¡App]
    D --&gt;|é€šè¿‡Binderæ§åˆ¶| F
    F --&gt;|åŠ è½½| H
    G --&gt;|æ”¯æŒ| H
</code></pre>
<p><strong>å®¿ä¸»åº”ç”¨</strong></p>
<p>å®¿ä¸»åº”ç”¨æ˜¯Shadowæ¡†æ¶çš„åŸºç¡€è½½ä½“ï¼Œä»…åŒ…å«æœ€å°åŒ–çš„æ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li>åŸºç¡€æ¥å£å®šä¹‰</li>
<li>å£³å­ä»£ç†ç»„ä»¶ï¼ˆåœ¨Manifestä¸­æ³¨å†Œï¼‰</li>
<li>æ’ä»¶ç®¡ç†å™¨çš„åŠ¨æ€å‡çº§é€»è¾‘
ä»£ç é‡æ§åˆ¶åœ¨çº¦15KBï¼Œä¿æŒè½»é‡åŒ–è®¾è®¡ã€‚</li>
</ul>
<p><strong>æ’ä»¶ç®¡ç†å™¨ï¼ˆManagerï¼‰</strong></p>
<p>æ’ä»¶ç®¡ç†å™¨è´Ÿè´£æ’ä»¶çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š</p>
<ul>
<li>æ’ä»¶çš„ä¸‹è½½ä¸å®‰è£…</li>
<li>Loadingæ€çš„åŠ¨æ€è§†å›¾å±•ç¤º</li>
<li>é€šè¿‡Binderé€šä¿¡æœºåˆ¶æ§åˆ¶åŠ è½½å™¨</li>
<li>ç®¡ç†å¤šç‰ˆæœ¬loaderå®ä¾‹çš„è¿è¡Œ</li>
</ul>
<p><strong>æ ¸å¿ƒè¿è¡Œæ—¶æ¨¡å—</strong></p>
<p>æ ¸å¿ƒè¿è¡Œæ—¶æ¨¡å—ä½œä¸ºæ’ä»¶çš„ä¸€éƒ¨åˆ†å¯åŠ¨æ€å‡çº§ï¼ŒåŒ…å«ä¸¤ä¸ªå­æ¨¡å—ï¼š</p>
<p><strong>1. åŠ è½½å™¨ï¼ˆLoaderï¼‰</strong></p>
<ul>
<li>å®ç°ä¸šåŠ¡Appçš„åŠ¨æ€åŠ è½½</li>
<li>é€šè¿‡Binderæ¥å£æ¥æ”¶ç®¡ç†å™¨æŒ‡ä»¤</li>
<li>æ”¯æŒå¤šå®ä¾‹è¿è¡Œï¼Œé¿å…nativeåº“å†²çª</li>
<li>å¯åŒ…å«é’ˆå¯¹ä¸šåŠ¡çš„ç‰¹æ®Šå¤„ç†é€»è¾‘</li>
</ul>
<p><strong>2. è¿è¡Œæ—¶ï¼ˆRuntimeï¼‰</strong></p>
<ul>
<li>æä¾›æ’ä»¶è¿è¡Œçš„åŸºç¡€ç¯å¢ƒ</li>
<li>ä¸ä¸šåŠ¡AppåŒç‰ˆæœ¬ç¼–è¯‘</li>
<li>ç¡®ä¿æ’ä»¶ä¸å®¿ä¸»çš„è§£è€¦è¿è¡Œ</li>
</ul>
<h4 data-id="heading-10">2.1.4 å°ç»“</h4>
<ul>
<li>ä¼˜ç‚¹ï¼šä¸ä¿®æ”¹APKï¼Œæ’ä»¶ä¹‹é—´å®Œå…¨éš”ç¦»ï¼ŒåŠ¨æ€åŠ è½½å’Œå¸è½½æ’ä»¶ï¼Œå¯¹Android APIçš„æ”¯æŒéå¸¸å…¨é¢ã€‚</li>
<li>ç¼ºç‚¹ï¼šå®ç°å¤æ‚ï¼Œæ–‡æ¡£ç›¸å¯¹è¾ƒå°‘ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸€äº›ç‰¹æ®Šçš„é—®é¢˜ï¼Œéœ€è¦è¿›è¡Œæ›´å¤šçš„æµ‹è¯•æ¥ç¡®ä¿ç¨³å®šæ€§ã€‚</li>
<li>é€‰æ‹©å»ºè®®ï¼šå¦‚æœéœ€è¦ä¸€ä¸ªå¼ºå¤§ä¸”çµæ´»çš„æ’ä»¶åŒ–æ¡†æ¶ï¼Œå¹¶ä¸”ä¸ä»‹æ„è€—è´¹æ›´å¤šçš„æ—¶é—´æ¥ç†è§£å’Œä½¿ç”¨ï¼Œé‚£ä¹ˆShadowå¯èƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</li>
</ul>
<h3 data-id="heading-11">2.2 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FQihoo360%2FRePlugin" target="_blank" title="https://github.com/Qihoo360/RePlugin" ref="nofollow noopener noreferrer">RePlugin</a></h3>
<p>RePluginæ˜¯360å…¬å¸å¼€å‘çš„ä¸€æ¬¾æ’ä»¶åŒ–æ¡†æ¶ï¼Œå®ƒé€šè¿‡ä¿®æ”¹ClassLoaderï¼Œå®ç°äº†æ’ä»¶çš„åŠ¨æ€åŠ è½½å’Œå¸è½½ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šæ’ä»¶åŒ–å’Œç»„ä»¶åŒ–å¹¶è¡Œï¼Œæ— éœ€ä¿®æ”¹å·²æœ‰ä»£ç ï¼Œæ’ä»¶é—´é€šä¿¡æœºåˆ¶å®Œå–„ã€‚</li>
<li>ç¼ºç‚¹ï¼šéœ€è¦å¯¹æ’ä»¶è¿›è¡Œç‰¹æ®Šçš„æ‰“åŒ…å¤„ç†ï¼Œå¯¹äºä¸€äº›å¤æ‚çš„åœºæ™¯ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œè¾ƒå¤§çš„æ”¹åŠ¨ï¼Œå¯¹æ–°çš„Androidç‰ˆæœ¬çš„æ”¯æŒå¯èƒ½ä¼šæœ‰å»¶è¿Ÿã€‚</li>
<li>é€‰æ‹©å»ºè®®ï¼šå¦‚æœéœ€è¦ä¸€ä¸ªç¨³å®šä¸”æˆç†Ÿçš„æ’ä»¶åŒ–æ¡†æ¶ï¼Œå¹¶ä¸”å¸Œæœ›èƒ½å¤Ÿå¿«é€Ÿåœ°è¿›è¡Œæ’ä»¶åŒ–å¼€å‘ï¼Œé‚£ä¹ˆå»ºè®®é€‰æ‹©RePluginã€‚</li>
</ul>
<h3 data-id="heading-12">2.3 AAB (Android App Bundle)</h3>
<p>AABæ˜¯Googleå®˜æ–¹æä¾›çš„ä¸€ç§æ–°çš„åº”ç”¨å‘å¸ƒæ ¼å¼ï¼Œå®ƒå…è®¸å°†åº”ç”¨çš„åŠŸèƒ½æ¨¡å—åŒ–ï¼Œå¹¶åœ¨éœ€è¦æ—¶åŠ¨æ€åœ°ä¸‹è½½å’Œå®‰è£…è¿™äº›æ¨¡å—ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šGoogleå®˜æ–¹æ”¯æŒï¼Œä¸Androidç³»ç»Ÿå’ŒGoogle Playå•†åº—çš„é›†æˆåº¦é«˜ï¼Œå¯ä»¥å®ç°æŒ‰éœ€ä¸‹è½½å’Œå®‰è£…æ¨¡å—ã€‚</li>
<li>ç¼ºç‚¹ï¼šåªæ”¯æŒAndroid 5.0åŠä»¥ä¸Šç‰ˆæœ¬çš„è®¾å¤‡ï¼Œéœ€è¦é€šè¿‡Google Playå•†åº—è¿›è¡Œæ¨¡å—çš„ä¸‹è½½å’Œå®‰è£…ã€‚</li>
<li>é€‰æ‹©å»ºè®®ï¼šå¦‚æœåº”ç”¨ä¸»è¦é’ˆå¯¹çš„æ˜¯æœ‰Google PlayæœåŠ¡çš„è®¾å¤‡æˆ–åœ°åŒºï¼Œå¹¶ä¸”å¸Œæœ›èƒ½å¤Ÿå‡å°åº”ç”¨çš„åˆå§‹ä¸‹è½½å¤§å°ï¼Œé‚£ä¹ˆå»ºè®®é€‰æ‹©AABã€‚</li>
</ul>
<h3 data-id="heading-13">2.4 Qigsaw</h3>
<p>Qigsawæ˜¯çˆ±å¥‡è‰ºå¼€å‘çš„ä¸€æ¬¾æ’ä»¶åŒ–æ¡†æ¶ï¼Œå®ƒé€šè¿‡ä¿®æ”¹ClassLoaderï¼Œå®ç°äº†æ’ä»¶çš„åŠ¨æ€åŠ è½½å’Œå¸è½½ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šæ”¯æŒåŠ¨æ€åŠ è½½å’Œå¸è½½æ’ä»¶ï¼Œæ”¯æŒçƒ­æ›´æ–°ï¼Œæ”¯æŒåˆ†åŒ…ã€‚</li>
<li>ç¼ºç‚¹ï¼šå®ç°ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦å¯¹æ’ä»¶è¿›è¡Œç‰¹æ®Šçš„æ‰“åŒ…å¤„ç†ï¼Œå¯¹æ–°çš„Androidç‰ˆæœ¬çš„æ”¯æŒå¯èƒ½ä¼šæœ‰å»¶è¿Ÿã€‚</li>
<li>é€‰æ‹©å»ºè®®ï¼šå¦‚æœéœ€è¦ä¸€ä¸ªæ”¯æŒçƒ­æ›´æ–°å’Œåˆ†åŒ…çš„æ’ä»¶åŒ–æ¡†æ¶ï¼Œå¹¶ä¸”æ„¿æ„è€—è´¹æ›´å¤šçš„æ—¶é—´æ¥ç†è§£å’Œä½¿ç”¨ï¼Œé‚£ä¹ˆå»ºè®®é€‰æ‹©Qigsawã€‚</li>
</ul>
<h3 data-id="heading-14">2.5 Atlas</h3>
<p>Atlasæ˜¯é˜¿é‡Œå·´å·´å¼€å‘çš„ä¸€æ¬¾æ’ä»¶åŒ–æ¡†æ¶ï¼Œå®ƒé€šè¿‡ä¿®æ”¹ClassLoaderï¼Œå®ç°äº†æ’ä»¶çš„åŠ¨æ€åŠ è½½å’Œå¸è½½ã€‚å®˜æ–¹çš„ä»‹ç»æ–‡ç« å¯ä»¥é˜…è¯»<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26mid%3D2650400348%26idx%3D1%26sn%3D99bc1bce932c5b9000d5b54afa2de70e" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxNDEwNjk5OQ==&amp;mid=2650400348&amp;idx=1&amp;sn=99bc1bce932c5b9000d5b54afa2de70e" ref="nofollow noopener noreferrer">Atlas-æ‰‹æ·˜ç»„ä»¶åŒ–æ¡†æ¶çš„å‰ä¸–ä»Šç”Ÿå’Œæœªæ¥çš„è·¯</a>ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒçƒ­æ›´æ–°ï¼Œå¯ä»¥åŠ¨æ€åŠ è½½å’Œå¸è½½æ’ä»¶ï¼Œæ”¯æŒæ’ä»¶ä¹‹é—´çš„ç›¸äº’è°ƒç”¨ï¼Œæœ‰ä¸°å¯Œçš„æ–‡æ¡£å’Œç¤¾åŒºæ”¯æŒã€‚</li>
<li>ç¼ºç‚¹ï¼šå®ç°å¤æ‚ï¼Œå¯èƒ½éœ€è¦ä¿®æ”¹å¤§é‡çš„ä»£ç æ‰èƒ½å®ç°æ’ä»¶åŒ–ã€‚</li>
<li>é€‰æ‹©å»ºè®®ï¼šç›®å‰Atlaså¼€æºé¡¹ç›®å¤„äºæ²¡æœ‰ç»´æŠ¤çš„çŠ¶æ€ï¼Œåªèƒ½ä½œä¸ºæŠ€æœ¯æ–¹æ¡ˆå‚è€ƒã€‚</li>
</ul>
<h2 data-id="heading-15">ä¸‰ã€æ’ä»¶å¢é‡æ›´æ–°</h2>
<p>æ’ä»¶ç»´æŠ¤é˜¶æ®µï¼Œå¤§çš„éœ€æ±‚å˜æ›´è¾ƒå°‘ï¼Œå¾ˆå¤šæ—¶å€™æ›´æ–°æ’ä»¶ç‰ˆæœ¬åªæ˜¯ä¸ºäº†è§£å†³ä¸€äº›ç”¨æˆ·åé¦ˆçš„å°é—®é¢˜ã€‚ä½†å³ä½¿æ˜¯å¾ˆå°çš„æ›´æ–°ï¼Œéƒ½éœ€è¦æ’ä»¶å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œç”¨æˆ·æ›´æ–°-ä¸‹è½½-å®‰è£…è¿™äº›æ­¥éª¤ä¸­ï¼Œéƒ½ä¼šé€ æˆç”¨æˆ·çš„æµå¤±ã€‚é‚£æœ‰æ²¡æœ‰å¯èƒ½å¯¹æ’ä»¶è¿›è¡Œçƒ­æ›´æ–°å‘¢ï¼Ÿåªéœ€è¦ä¸‹å‘å°çš„è¡¥ä¸æ–‡ä»¶å³å¯ä»¥è¾¾åˆ°ä¿®å¤çš„èƒ½åŠ›ç¡®å®æ›´é€‚åˆæˆ‘ä»¬ä¸šåŠ¡åœºæ™¯ã€‚ç›®å‰æ¯”è¾ƒæµè¡Œçš„çƒ­æ›´æ–°æ–¹æ¡ˆæœ‰ä¸‹é¢è¿™äº›ã€‚</p>
<h3 data-id="heading-16">3.1 Sophix</h3>
<p>Sophixæ˜¯é˜¿é‡Œå·´å·´æ¨å‡ºçš„ä¸€æ¬¾çƒ­ä¿®å¤æ–¹æ¡ˆã€‚Sophixçš„åŸºæœ¬åŸç†æ˜¯é€šè¿‡AndFixå®ç°çš„ï¼ŒAndFixæ˜¯ä¸€ç§åœ¨Android Dalvik/ARTç¯å¢ƒä¸‹çš„çƒ­è¡¥ä¸æ¡†æ¶ï¼Œå®ƒå¯ä»¥åœ¨ä¸éœ€è¦é‡å¯APPçš„æƒ…å†µä¸‹åŠ¨æ€ä¿®å¤Classã€‚</p>
<ul>
<li>ä¼˜ç‚¹
<ul>
<li>æ”¯æŒå…¨é‡æ›´æ–°ï¼Œå¢é‡æ›´æ–°ï¼Œçƒ­æ›´æ–°ï¼Œæ”¯æŒSoåº“ä¿®å¤ã€‚</li>
<li>æä¾›äº†è¯¦ç»†çš„æ¥å…¥æ–‡æ¡£å’Œç¨³å®šçš„æœåŠ¡æ”¯æŒã€‚</li>
<li>æœ‰è¾ƒå¥½çš„å…¼å®¹æ€§å’Œç¨³å®šæ€§ã€‚</li>
</ul>
</li>
<li>ç¼ºç‚¹
<ul>
<li>åªæ”¯æŒé˜¿é‡Œç³»çš„åº”ç”¨ï¼Œå¯¹å¤–éƒ¨åº”ç”¨æ”¯æŒä¸è¶³ã€‚</li>
<li>éœ€è¦æ¥å…¥é˜¿é‡Œçš„mPaaSç§»åŠ¨å¼€å‘å¹³å°ï¼Œå¯¹äºä¸€äº›ä¸å¸Œæœ›æ¥å…¥é˜¿é‡Œäº‘çš„é¡¹ç›®å¯èƒ½ä¼šæœ‰å½±å“ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-17">3.2 Bugly hotfix</h3>
<p>Bugly hotfixæ˜¯è…¾è®¯æ¨å‡ºçš„ä¸€æ¬¾çƒ­ä¿®å¤æ–¹æ¡ˆã€‚Bugly hotfixçš„åŸºæœ¬åŸç†æ˜¯é€šè¿‡dexæ–‡ä»¶æ›¿æ¢å®ç°çš„ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶æ›¿æ¢æ‰æœ‰é—®é¢˜çš„dexæ–‡ä»¶ï¼Œä»è€Œå®ç°çƒ­ä¿®å¤ã€‚</p>
<ul>
<li>ä¼˜ç‚¹
<ul>
<li>æä¾›äº†å…¨é¢çš„çƒ­æ›´æ–°è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬çƒ­ä¿®å¤å’Œçƒ­æ›´æ–°ã€‚</li>
<li>æä¾›äº†è¯¦ç»†çš„æ¥å…¥æ–‡æ¡£å’Œç¨³å®šçš„æœåŠ¡æ”¯æŒã€‚</li>
<li>æœ‰è¾ƒå¥½çš„å…¼å®¹æ€§å’Œç¨³å®šæ€§ã€‚</li>
</ul>
</li>
<li>ç¼ºç‚¹
<ul>
<li>éœ€è¦æ¥å…¥è…¾è®¯çš„Buglyå¹³å°ï¼Œå¯¹äºä¸€äº›ä¸å¸Œæœ›æ¥å…¥è…¾è®¯äº‘çš„é¡¹ç›®å¯èƒ½ä¼šæœ‰å½±å“ã€‚</li>
<li>å¯¹äºä¸€äº›å¤æ‚çš„ä¿®å¤åœºæ™¯ï¼Œå¯èƒ½éœ€è¦æ›´æ·±å…¥çš„å®šåˆ¶ï¼Œè¿™å¯èƒ½ä¼šå¢åŠ æ¥å…¥çš„å¤æ‚æ€§ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-18">3.3 æ’æ¡©çƒ­æ›´æ–°</h3>
<p>æ’æ¡©çƒ­æ›´æ–°æ˜¯ä¸€ç§åŸºäºå­—èŠ‚ç æ’æ¡©æŠ€æœ¯çš„çƒ­æ›´æ–°æ–¹æ¡ˆã€‚æ’æ¡©çƒ­æ›´æ–°çš„åŸºæœ¬åŸç†æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µä¿®æ”¹å­—èŠ‚ç ï¼Œä¸ºæ–¹æ³•è°ƒç”¨æ’å…¥é¢å¤–çš„é€»è¾‘ï¼Œä»è€Œå®ç°åœ¨è¿è¡Œæ—¶æ›¿æ¢æ–¹æ³•çš„åŠŸèƒ½ã€‚</p>
<ul>
<li>ä¼˜ç‚¹
<ul>
<li>åŸç†ç®€å•ï¼Œå®ç°ç›¸å¯¹å®¹æ˜“ã€‚</li>
<li>ä¸ä¾èµ–äºä»»ä½•ç¬¬ä¸‰æ–¹å¹³å°ï¼Œå¯ä»¥è‡ªç”±å®šåˆ¶ã€‚</li>
</ul>
</li>
<li>ç¼ºç‚¹
<ul>
<li>éœ€è¦å¯¹å­—èŠ‚ç æ’æ¡©æŠ€æœ¯æœ‰ä¸€å®šçš„äº†è§£ï¼Œå¯¹äºä¸€äº›å¼€å‘è€…æ¥è¯´å¯èƒ½ä¼šæœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬ã€‚</li>
<li>å¯¹äºä¸€äº›å¤æ‚çš„ä¿®å¤åœºæ™¯ï¼Œå¯èƒ½éœ€è¦æ›´æ·±å…¥çš„å®šåˆ¶ï¼Œè¿™å¯èƒ½ä¼šå¢åŠ æ¥å…¥çš„å¤æ‚æ€§ã€‚</li>
<li>å…¼å®¹æ€§å’Œç¨³å®šæ€§å¯èƒ½ä¸å¦‚Sophixå’ŒBugly hotfixã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-19">å››ã€æ€»ç»“</h2>
<p>åœ¨åŸç†éƒ¨åˆ†ï¼Œæœ¬æ–‡è§£é‡Šäº†ç±»åŠ è½½å™¨çš„ä½œç”¨å’Œæ’ä»¶åŒ–çš„åŸºæœ¬åŸç†ï¼Œè¿™ä¸ºç†è§£åç»­çš„æ’ä»¶åŒ–æ–¹æ¡ˆæ‰“ä¸‹äº†åŸºç¡€ã€‚</p>
<p>åœ¨æ’ä»¶åŒ–æ–¹æ¡ˆéƒ¨åˆ†ï¼Œæœ¬æ–‡ä»‹ç»äº†Shadowã€RePluginã€AABã€Qigsawå’ŒAtlasè¿™äº”ç§ä¸»æµçš„æ’ä»¶åŒ–æ–¹æ¡ˆã€‚æ¯ç§æ–¹æ¡ˆéƒ½æœ‰å…¶ç‹¬ç‰¹çš„ä¼˜ç‚¹å’Œé€‚ç”¨åœºæ™¯ï¼Œä¾‹å¦‚Shadowçš„å…¨åŠ¨æ€å®ç°ã€RePluginçš„ç¨³å®šæ€§å’Œæˆç†Ÿåº¦ã€AABçš„å®˜æ–¹æ”¯æŒå’Œä¸Google Playçš„é›†æˆåº¦ã€Qigsawçš„çƒ­æ›´æ–°å’Œåˆ†åŒ…æ”¯æŒï¼Œä»¥åŠAtlasçš„åŠŸèƒ½å¼ºå¤§å’Œä¸°å¯Œçš„æ–‡æ¡£æ”¯æŒã€‚</p>
<p>åœ¨æ’ä»¶å¢é‡æ›´æ–°éƒ¨åˆ†ï¼Œæœ¬æ–‡ä»‹ç»äº†Sophixã€Bugly hotfixå’Œæ’æ¡©çƒ­æ›´æ–°è¿™ä¸‰ç§çƒ­æ›´æ–°æ–¹æ¡ˆã€‚è¿™äº›æ–¹æ¡ˆå¯ä»¥åœ¨ä¸éœ€è¦ç”¨æˆ·é‡æ–°ä¸‹è½½å’Œå®‰è£…åº”ç”¨çš„æƒ…å†µä¸‹ä¿®å¤é—®é¢˜ï¼Œå¤§å¤§æé«˜äº†ç”¨æˆ·ä½“éªŒã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªå·±çš„å…·ä½“éœ€æ±‚å’Œé¡¹ç›®æƒ…å†µï¼Œç»¼åˆè€ƒè™‘å„ç§å› ç´ ï¼Œé€‰æ‹©æœ€é€‚åˆçš„æ–¹æ¡ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ‰åœ¨è°ƒåº¦çš„èŠ±å›­é‡Œé¢æŒ–å‘€æŒ–]]></title>    <link>https://juejin.cn/post/7582951344518201350</link>    <guid>https://juejin.cn/post/7582951344518201350</guid>    <pubDate>2025-12-14T12:39:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582951344518201350" data-draft-id="7583226204033728553" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ‰åœ¨è°ƒåº¦çš„èŠ±å›­é‡Œé¢æŒ–å‘€æŒ–"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-14T12:39:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ‰æ€åº¦çš„ä¸‹ç­‰é©¬"/> <meta itemprop="url" content="https://juejin.cn/user/448256476727662"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ‰åœ¨è°ƒåº¦çš„èŠ±å›­é‡Œé¢æŒ–å‘€æŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/448256476727662/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ‰æ€åº¦çš„ä¸‹ç­‰é©¬
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T12:39:58.000Z" title="Sun Dec 14 2025 12:39:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    28
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸Šæ–‡ä½¿ç”¨koordinatoræ¼”ç¤ºgang-schedulingå’Œbinpackè°ƒåº¦ï¼Œ å·²ç»ç”Ÿæ•ˆã€‚</p>
<p>4ä¸ª2å¡Podé¾Ÿç¼©åœ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦å¤–ä¸€ä¸ª2å¡Podè¢«æŒ¤åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ¯èŠ‚ç‚¹ä¸Šè™šæ‹Ÿgpuï¼š8å¡ï¼‰ã€‚</p>
<p>æ­¤æ—¶æˆ‘ä»¬å†å°è¯•ç”³è¯·8å¡ä½œä¸šï¼Œpodä¼š<code>PendingçŠ¶æ€</code>ã€‚ä½†ä¸€æ—¦èŠ‚ç‚¹æœ‰èµ„æºï¼Œpodå°±ä¼šè‡ªåŠ¨è¿›å…¥<code>RunningçŠ¶æ€</code>ã€‚</p>
<p>è¿™å°±æ˜¯resource.requests/limits è½¯è°ƒåº¦çš„æ•ˆæœã€‚</p>
<h2 data-id="heading-0">1. resource.requests/limits è½¯è°ƒåº¦</h2>
<p>ä¸Šé¢çš„è°ƒåº¦ä¸»è¦ç”±<code>requests</code>é…ç½®æ¥çº¦æŸã€‚</p>
<p><code>requests</code>ï¼š æ˜¯â€œæ‰¿è¯ºèµ„æºâ€ï¼Œ <code>kube-scheduler</code>å°†requests cpuï¼š1 çš„podè°ƒåº¦åˆ°æŸä¸ªnodeï¼Œ å°±ç›¸å½“äºä»è¯¥nodeèµ„æºæ± ä¸Šåˆ’èµ°äº†æœ‰ä¸€éƒ¨åˆ†èµ„æºï¼Œè¿™1æ ¸ä¼šè¢«é¢„å®šï¼Œä¸å†æ‰¿è¯ºç»™å…¶ä»–podï¼Œå³ä½¿ä½ è¿™ä¸ªpodåªç”¨äº†500mæ ¸ã€‚</p>
<p><code>limits</code>:  æ˜¯èµ„æºä½¿ç”¨çš„ä¸Šé™ï¼Œæ˜¯ç”±<code>kubelet</code>æ¥å¼ºåˆ¶æ‰§è¡Œã€‚</p>
<h2 data-id="heading-1">2. k8såŸç”Ÿé…é¢ResourceQuotaï¼š ç¡¬éš”ç¦»</h2>
<p>å½“å¤šä¸ªå›¢é˜Ÿå…±äº«k8sé›†ç¾¤èŠ‚ç‚¹èµ„æºæ—¶ï¼Œ ä¼šæœ‰æŸä¸€ç§Ÿæˆ·éœ¸å å¤§é‡èµ„æºçš„å¯èƒ½æ€§ã€‚</p>
<p>èµ„æºé…é¢å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<p>èµ„æºé…é¢<strong>ä½œç”¨åœ¨å‘½åç©ºé—´ä¸Šï¼ˆå‘½åç©ºé—´å¤©ç”Ÿå°±æ˜¯å¤šç§Ÿæˆ·æ¦‚å¿µçš„è½½ä½“ï¼‰ï¼Œ é™åˆ¶äº†è¯¥ç§Ÿæˆ·ï¼ˆå‘½åç©ºé—´ï¼‰èƒ½åˆ›å»ºçš„èµ„æºå¯¹è±¡(+åŸºç¡€è®¾æ–½èµ„æº)çš„ä¸Šé™</strong>ï¼Œ è¿™ä¸ªé™åˆ¶æ˜¯é€šè¿‡api serveråœ¨èµ„æºå¯¹è±¡å±‚é¢åšåˆ°çš„ã€‚</p>
<p>ResourceQuota ç›¸å½“äºæ¡†å®šæŸä¸€ç±»èµ„æºçš„å¯ç”¨ä¸Šé™ï¼Œ æœ‰â€œèµ„æºç±»å‹â€ã€â€é…é¢ä½œç”¨åŸŸâ€œ ç­‰è¿‡æ»¤èµ„æºçš„é€‰é¡¹ï¼Œ å…·ä½“è¯·å‚è§<a href="https://link.juejin.cn?target=https%3A%2F%2Fkubernetes.io%2Fzh-cn%2Fdocs%2Fconcepts%2Fpolicy%2Fresource-quotas%2F%23quota-and-cluster-capacity" target="_blank" title="https://kubernetes.io/zh-cn/docs/concepts/policy/resource-quotas/#quota-and-cluster-capacity" ref="nofollow noopener noreferrer">ResouceQoutaå®˜æ–¹</a>ã€‚</p>
<p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªåŒ…å«[åŸºç¡€è®¾æ–½èµ„æºã€æ‰©å±•èµ„æºã€èµ„æºå¯¹è±¡]çš„ResourceQuotaï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ResourceQuota</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">mem-cpu-demo</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">hard:</span>
    <span class="hljs-attr">requests.cpu:</span> <span class="hljs-string">"1"</span>
    <span class="hljs-attr">requests.memory:</span> <span class="hljs-string">1Gi</span>   <span class="hljs-comment"># éœ€æ±‚æ€»é‡</span>
    <span class="hljs-attr">limits.cpu:</span> <span class="hljs-string">"2"</span>
    <span class="hljs-attr">limits.memory:</span> <span class="hljs-string">2Gi</span>      <span class="hljs-comment"># é™é¢æ€»é‡</span>
    <span class="hljs-attr">requests.example.com/dongle:</span> <span class="hljs-number">2</span>
    
    <span class="hljs-attr">pods:</span> <span class="hljs-string">"4"</span>
    <span class="hljs-attr">replicationcontrollers:</span> <span class="hljs-string">"20"</span>
    <span class="hljs-attr">secrets:</span> <span class="hljs-string">"10"</span>
    <span class="hljs-attr">services:</span> <span class="hljs-string">"10"</span>
</code></pre>
<blockquote>
<p>å› ä¸ºæ‰©å±•èµ„æºä¸å¯è¶…é‡åˆ†é…ï¼Œæ•…æ²¡æœ‰å¿…è¦ä¸ºæ‰©å±•èµ„æºåŒæ—¶æŒ‡å®šrequestså’Œlimitsé…ç½®ï¼Œåªéœ€æŒ‡å®šrequests.xxxx å³å¯ã€‚</p>
</blockquote>
<p>å› ä¸ºé…é¢çš„å‡†å…¥æ˜¯åœ¨apiserver èµ„æºå¯¹è±¡å±‚é¢ï¼Œ æ‰€ä»¥å½“é…é¢ä¸è¶³ï¼Œä¸ä¼šäº§ç”Ÿpodå¤„äºpendingçš„ç°è±¡ï¼Œkubectlå‘½ä»¤ä¼šç»™å‡ºæŠ¥é”™ï¼š<code>pods "quota-mem-cpu-demo-2" is forbidden: exceeded quota</code>ï¼Œ è¿™ç‚¹ä¸resource.requests/limits è½¯è°ƒåº¦ä¸åŒã€‚</p>
<blockquote>
<p>æç¤ºï¼š<br/>
ResourceQuota ä¸é›†ç¾¤èµ„æºæ€»é‡æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚å®ƒä»¬é€šè¿‡ç»å¯¹çš„å•ä½æ¥é…ç½®ã€‚<br/>
æ‰€ä»¥ï¼Œä¸ºé›†ç¾¤æ·»åŠ èŠ‚ç‚¹æ—¶ï¼Œk8sèµ„æºé…é¢ä¸ä¼šè‡ªåŠ¨èµ‹äºˆæ¯ä¸ªå‘½åç©ºé—´æ¶ˆè€—æ›´å¤šèµ„æºçš„èƒ½åŠ›ã€‚</p>
</blockquote>
<h2 data-id="heading-2">3. kueue ä»»åŠ¡é˜Ÿåˆ—</h2>
<p>ä¸Šæ–‡k8såŸç”ŸresourceQuota æ˜¯å‘½åç©ºé—´çº§åˆ«çš„ç¡¬èµ„æºé™åˆ¶ï¼Œâ€œå®ƒåªè´Ÿè´£é™åˆ¶ï¼Œ ä¸è´Ÿè´£è°ƒåº¦â€ã€‚</p>
<p>åœ¨ä¼ä¸šçº§å¤šç§Ÿæˆ·äº‘ç¯å¢ƒä¸­ï¼Œä¸ºäº†â‘ é«˜æ•ˆâ‘¡çµæ´» åˆ©ç”¨é›†ç¾¤èµ„æºï¼Œ éœ€è¦â€œåè°ƒå’Œè°ƒåº¦â€çš„èƒ½åŠ›ã€‚</p>
<p>kueue è¿™ç§ä»»åŠ¡é˜Ÿåˆ—å°±æ˜¯è¿™ä¸ªä½œç”¨ï¼Œå®ƒä¸è°‹æ±‚æ›¿ä»£k8såŸç”Ÿç»„ä»¶ä½œç”¨ï¼Œå·¥ä½œåœ¨k8såŸç”Ÿè°ƒåº¦å™¨ä¹‹ä¸Šã€‚</p>
<p>kueueæ˜¯k8sä¸Šç®¡ç†èµ„æºæ± é…é¢å’Œç®¡æ§jobæ¶ˆè´¹èµ„æºæ± é…é¢çš„ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿï¼Œ
kueueå†³å®šäº†jobä»€ä¹ˆæ—¶å€™åº”è¯¥ç­‰å¾…ï¼Œä»€ä¹ˆæ—¶å€™è¢«å‡†å…¥ï¼Œä»€ä¹ˆæ—¶å€™jobå¯ä»¥è¢«æŠ¢å ã€‚</p>
<p>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨kueueï¼Ÿ</p>
<p>â‘   éœ€è¦å¼¹æ€§è®¡ç®—èµ„æº(å¯éšæ—¶æ‰©ç¼©å®¹)</p>
<p>â‘¡  è®¡ç®—èµ„æºæ˜¯å¼‚æ„èµ„æºï¼ˆæ¶æ„ã€å¯ç”¨æ€§ã€ä»·æ ¼ç­‰å› ç´ ï¼‰</p>
<p>è¿™é‡Œæˆ‘ç”¨è‡ªå·±çš„æƒ³æ³•ååŠ©å¤§å®¶ç†è§£è¿™â‘ â‘¡ç‚¹ï¼š</p>
<p>kueueä¸­æ„å»ºçš„clusterQueueå¼•ç”¨çš„èµ„æºæ± é…é¢æ˜¯é€»è¾‘é…é¢ï¼Œ èµ„æºå¯ä»¥è·¨é˜Ÿåˆ—æµåŠ¨ ï¼ˆå€Ÿç”¨ã€æŠ¢å ï¼‰ï¼Œ è™½ç„¶å’Œk8såŸç”Ÿé…é¢ä¸€æ ·éƒ½ä¸ä¸ç¡¬ä»¶èµ„æºç›´æ¥æŒ‚é’©ï¼Œä½†å¾ˆæ˜æ˜¾ç›¸æ¯”k8såŸç”Ÿé…é¢æ›´å…·å¼¹æ€§ã€‚</p>
<p>åŒæ„èµ„æºæŒ‡çš„æ˜¯æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹/è®¾å¤‡è§„æ ¼ç›¸åŒï¼Œ å¼‚æ„èµ„æºæ˜¯æŒ‡è®¡ç®—èŠ‚ç‚¹/è®¾å¤‡è§„æ ¼/ç‰¹æ€§ä¸åŒã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bb368709efd4ad78f609149ee9059e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=zrgbYIlWIHzu9QJL3NK%2FOPo70yU%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>ä¸ºä»€ä¹ˆä¼šå­˜åœ¨å¼‚æ„èµ„æºï¼Ÿ<br/>
ç”±ä¸šåŠ¡éœ€æ±‚é©±åŠ¨äº§ç”Ÿçš„ä¸åŒè®¾å¤‡å½¢æ€ï¼ˆAI/MLå·¥ä½œè´Ÿè½½ã€è¾¹ç¼˜è®¡ç®—ã€ç§‘å­¦è®¡ç®—ç­‰è¦æ±‚çš„è®¾å¤‡ç§ç±»ã€è®¾å¤‡è§„æ ¼ã€è®¾å¤‡ä¾§é‡éƒ½ä¸åŒï¼‰ï¼Œ è¡ç”Ÿå‡ºè®¾å¤‡ä»·æ ¼ä¹Ÿä¸åŒã€‚</p>
</blockquote>
<hr/>
<p>ä¸‹å›¾æ˜¯kueueçš„ä½œç”¨åŸç†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ad7cdbf5c4a4e0ab2b7c9a5969f8ca5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=8nI3Zhx%2FbVQVbJU0CNPcgEuC38Q%3D" alt="" loading="lazy"/></p>
<p>ä»»åŠ¡æ»¡è¶³èµ„æºæ± é…é¢ï¼Œè¢«å‡†å…¥åï¼š</p>
<ul>
<li>kueueä¿®æ”¹jobçš„ suspendï¼š falseï¼Œ æ”¾è¡Œjob</li>
<li>kueue å‘jobæ³¨å…¥nodeselectoræ³¨è§£ï¼Œå°†æœ¬æ¬¡èµ„æºé£å‘³ç›¸å…³çš„ä¿¡æ¯ç»™åˆ°jobï¼Œç”¨äºåç»­è°ƒåº¦ï¼ï¼ï¼</li>
</ul>
<h3 data-id="heading-3">3.1 èµ„æºé«˜åº¦æŠ½è±¡</h3>
<p>ä¸Šé¢çš„resource.requests/limits å’Œk8såŸç”ŸresourceQuota éƒ½æ²¡èƒ½è·³è„±worker èŠ‚ç‚¹èµ„æºçš„æ¦‚å¿µã€‚</p>
<p>kueueå°†workerèŠ‚ç‚¹ä¸Šçš„èµ„æºæŠ½è±¡æˆç”±ç‰¹å®šèµ„æºé£å‘³ï¼ˆResourceFlavorï¼‰è¡¨å¾çš„èµ„æºæ± ï¼Œ æ¡†å®šäº†æŸä¸€ç±»å«æœ‰ç‰¹å®šèµ„æºç±»å‹/è§„æ ¼çš„èŠ‚ç‚¹ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kueue.x-k8s.io/v1beta2</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ResourceFlavor</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">"default-flavor"</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">nodeLabels:</span>
    <span class="hljs-attr">gpu:</span> <span class="hljs-string">h20</span> <span class="hljs-comment">#  æ¡†å®šäº†å«h20çš„èŠ‚ç‚¹</span>
</code></pre>
<p>ä¸Šé¢åä¸º<code>default-flavor</code>çš„èµ„æºé£å‘³ æ¡†å®šäº†å¸¦æœ‰<code>gpu:h20</code>æ ‡ç­¾çš„èŠ‚ç‚¹</p>
<blockquote>
<p>å¦‚æœæ˜¯åŒæ„èµ„æºï¼Œä½ ä¹Ÿå¯ä»¥å®šä¹‰empty resource flavorã€‚</p>
</blockquote>
<hr/>
<p>ç„¶ååŸºäºæ¡†å®šçš„èµ„æºæ± ç»™æŸä¸ªä»»åŠ¡é˜Ÿåˆ—åˆ†å‘èµ„æºé…é¢ã€‚</p>
<h3 data-id="heading-4">3.2 èµ„æºæ± çš„é…é¢ nominalQuota</h3>
<p>ClusterQueue é»˜è®¤æ˜¯é›†ç¾¤çº§åˆ«çš„å¯¹è±¡ï¼Œå®šä¹‰äº†é›†ç¾¤ä¸­æŸç±»èµ„æºé£å‘³çš„é…é¢ã€‚</p>
<p>ä¸‹é¢ä¸º<code>cluster-queue</code>çš„å…¨å±€é˜Ÿåˆ—ï¼ˆä¾æ‰˜äºâ€œdefault-flavorâ€èµ„æºæ± ï¼‰å®šä¹‰äº†ä½¿ç”¨é…é¢, å…¶ä¸­ä¸ºç¨€ç¼ºèµ„æº<code>example.com/dongle</code>çº¦æŸ10å¡ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">kubectl label nodes minikube-m02/minikube-m03 <span class="hljs-attr">gpu</span>=h20 å‡è®¾èŠ‚ç‚¹æœ‰è¿™æ ·çš„æ ‡ç­¾
</code></pre>
<p>å‘½åç©ºé—´<code>team-a</code>çš„localQueueå¼•ç”¨äº†è¯¥clusterQueueã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kueue.x-k8s.io/v1beta2</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ResourceFlavor</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">default-flavor</span> <span class="hljs-comment">##  å¯¹åŒæ„èµ„æºï¼Œå®šä¹‰emptyèµ„æºé£å‘³</span>
  <span class="hljs-attr">spec:</span>
  <span class="hljs-attr">nodeLabels:</span>
    <span class="hljs-attr">gpu:</span> <span class="hljs-string">h20</span> <span class="hljs-comment">#  æ¡†å®šäº†å«h20æ ‡ç­¾çš„èŠ‚ç‚¹</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kueue.x-k8s.io/v1beta2</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterQueue</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">"cluster-queue"</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">namespaceSelector:</span> {} <span class="hljs-comment"># match all.</span>
  <span class="hljs-attr">resourceGroups:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">coveredResources:</span> [<span class="hljs-string">"cpu"</span>, <span class="hljs-string">"memory"</span>, <span class="hljs-string">"pods"</span>]
    <span class="hljs-attr">flavors:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"default-flavor"</span>
      <span class="hljs-attr">resources:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"cpu"</span>
        <span class="hljs-attr">nominalQuota:</span> <span class="hljs-number">10</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"memory"</span>
        <span class="hljs-attr">nominalQuota:</span> <span class="hljs-string">10Gi</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"example.com/dongle"</span>
        <span class="hljs-attr">nominalQuota:</span> <span class="hljs-number">10</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kueue.x-k8s.io/v1beta2</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">LocalQueue</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">team-a</span> 
  <span class="hljs-attr">name:</span> <span class="hljs-string">team-a-queue</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">clusterQueue:</span> <span class="hljs-string">cluster-queue</span> 
</code></pre>
<p>clusterQueueä¸localQueueçš„å¼•ç”¨å…³ç³»å®ç°äº†å…±äº«å…¨å±€èµ„æºæ± çš„ç†å¿µã€‚</p>
<p>å½¢æˆçš„å¯¹è±¡æ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9b975ea78d240d4b5ffbecfeb2fd2f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=Ov3piDjuQ1F%2BSf0PgEyXvdbAAkA%3D" alt="" loading="lazy"/>
æµ…ç»¿è‰²æ˜¯kueueäº§ç”Ÿçš„å¯¹è±¡ï¼Œæµ…è“è‰²æ˜¯ç”¨æˆ·å®é™…æäº¤çš„æ‰¹å¤„ç†ä»»åŠ¡ã€‚</p>
<hr/>
<p>ä¸‹é¢ç”¨ä¸€ä¸ªk8såŸç”Ÿjobæ¥æ¼”ç¤º kueueçš„å·¥ä½œè¡¨ç°ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Job</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">pi3</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">kueue.x-k8s.io/queue-name:</span> <span class="hljs-string">team-a-queue</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">parallelism:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># å¹¶è¡Œæ‰§è¡Œæ¬¡æ•°ï¼Œé»˜è®¤ä¸º1</span>
  <span class="hljs-attr">completions:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># å®Œæˆæ¬¡æ•°ï¼Œé»˜è®¤ä¸ºparallelismçš„å€¼</span>
 <span class="hljs-comment"># suspend: true </span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">pi</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">perl</span>
        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>
        <span class="hljs-attr">command:</span> [ <span class="hljs-string">"perl"</span>, <span class="hljs-string">"-Mbignum=bpi"</span>, <span class="hljs-string">"-wle"</span>, <span class="hljs-string">"print bpi(5000)"</span> ]
        <span class="hljs-attr">resources:</span>
          <span class="hljs-attr">requests:</span>
            <span class="hljs-attr">cpu:</span> <span class="hljs-string">"1"</span>
            <span class="hljs-attr">memory:</span> <span class="hljs-string">"200Mi"</span>
            <span class="hljs-attr">example.com/dongle:</span> <span class="hljs-string">"2"</span>
          <span class="hljs-attr">limits:</span>
            <span class="hljs-attr">cpu:</span> <span class="hljs-string">"1"</span>
            <span class="hljs-attr">memory:</span> <span class="hljs-string">"200Mi"</span>
            <span class="hljs-attr">example.com/dongle:</span> <span class="hljs-string">"2"</span>
      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span>

<span class="hljs-comment"># Job ä»£è¡¨ä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œè¿è¡Œå®Œæˆåˆ°åœæ­¢ï¼Œå®ƒå°†Ï€è®¡ç®—åˆ°5000ä¸ªä½ç½®å¹¶å°†å…¶æ‰“å°å‡ºæ¥ã€‚å®Œæˆå¤§çº¦éœ€è¦60ç§’ã€‚ ä¹‹åpodçŠ¶æ€æ˜¯ Completed</span>
</code></pre>
<ul>
<li><del>è¿™é‡Œæœ€é‡è¦çš„æ˜¯é…ç½®æ˜¯jobä¸­çš„"suspend:true"ï¼Œ jobåº”è¯¥ä»¥æŒ‚èµ·çŠ¶æ€è¢«åˆ›å»º</del>ï¼Œç”±kueueæ¥å†³å®šä½•æ—¶å¯åŠ¨, ä¸éœ€è¦è¿™ä¸ªsuspendï¼štrueé…ç½®ï¼ŒåŠ ä¸Šäº†kueue.x-k8s.io/queue-name: team-a-queueå°±èƒ½å—kueueç®¡æ§ã€‚</li>
<li>åœ¨åŸç”Ÿjobæ ‡ç­¾å…³è”localqueue</li>
</ul>
<p>æäº¤ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œ3ä¸ªPodå ç”¨äº†6å¡ï¼›
å†ç«‹åˆ»å¯åŠ¨åŒæ ·é…ç½®çš„ç¬¬äºŒä¸ªä»»åŠ¡ï¼Œå—localqueueä¸­<code>nominalQuota: 10</code>çš„çº¦æŸï¼Œä»»åŠ¡2ä¼špendingï¼Œ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37da41605f8e4b6a95d68a5c03405b74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=I253Oa8v1AJI4Sx0HSRxAoaopFc%3D" alt="image.png" loading="lazy"/></p>
<p>ç­‰å¾…ä»»åŠ¡1æ‰§è¡Œå®Œï¼Œé‡Šæ”¾äº†<code>example.com/dongle</code>èµ„æºï¼Œæœ€åè¿›å…¥runingçŠ¶æ€è·‘å®Œä»»åŠ¡ï¼Œåˆ†åˆ«æŸ¥çœ‹ä»»åŠ¡1å’Œä»»åŠ¡2çš„å‡†å…¥äº‹ä»¶ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72ca9910c93d4bf296a39aeb5776fdd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=znv9RNI80IWyyYg8spGeXgHySrc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/429682515bb94e5c8d8c8809c45e4a04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=T0ZFfEX7wQZ9zQWyeFz5j%2FaO%2Fg4%3D" alt="image.png" loading="lazy"/></p>
<p>æœ€åæˆ‘ä»¬çœ‹ä¸‹ä¸šåŠ¡jobè¢«kueueä¿®æ”¹çš„ç»“æœã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93eb6c384be84c47af177c9daa5d82b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=qgPlNKg8N7f1ESGfrZpjSxIXCGg%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fkueue.sigs.k8s.io%2Fzh-cn%2Fdocs%2Foverview%2F" target="_blank" title="https://kueue.sigs.k8s.io/zh-cn/docs/overview/" ref="nofollow noopener noreferrer">kueue è¿˜æœ‰å¾ˆå¤šç‰¹æ€§</a>,è¯»è€…è‡ªè¡Œå®¡é˜…ï¼Œä¿®è¡Œåœ¨ä¸ªäººã€‚</p>
<p>â‘  æ ¸å¿ƒçš„clusterqueueé»˜è®¤çš„æ’é˜Ÿç­–ç•¥æ˜¯ï¼š BestEffortFIFOï¼š å…ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼Œå†æŒ‰ç…§åˆ›å»ºæ—¶é—´ï¼›æœªè¢«å‡†å…¥çš„æ—§ä»»åŠ¡ä¸ä¼šå½±å“åç»­èƒ½è¢«å‡†å…¥çš„æ–°æ¥ä»»åŠ¡ã€‚</p>
<p>â‘¡ æ”¯æŒé˜Ÿåˆ—ç»„Cohortï¼Œ å¯å®ç°èµ„æºå¼¹æ€§å€Ÿç”¨</p>
<p>â‘¢ æ³¨æ„é˜Ÿåˆ—ç»„ã€clusterqueueä¸èµ„æºé£å‘³çš„1å¯¹å¤šçš„å…³ç³»ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d61ec15be1c4cbba2fdb3f60dff91ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=b5YToDEOkcT7r9dlXP%2BgGdqc8oY%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>åœ¨ä¼ä¸šçº§å¤šç§Ÿæˆ·ã€å¼ºèµ„æºç”Ÿäº§éš”ç¦»ã€è®¡è´¹è¦æ±‚çš„èƒŒæ™¯ä¸‹ï¼Œä¸€èˆ¬æ˜¯ç‹¬ç«‹clusterQueue ä¸ å…±äº«ClusterQueueç»“åˆçš„åšæ³•ã€‚</p>
</blockquote>
<h2 data-id="heading-5">4. æ€»ç»“</h2>
<p>ä»Šå¤©ä¸»è¦åœ¨è°ƒåº¦è¿™ä¸ªèŠ±å›­é‡Œé¢æŒ–å‘€æŒ–ï¼Œ æ›´å‡†ç¡®çš„æ˜¯èšç„¦åœ¨â€œå‡†å…¥â€è¿™ä¸ªåŠ¨ä½œä¸Šå±•å¼€æ€è·¯ã€‚</p>
<p>k8såŸç”Ÿèµ„æºé…é¢çš„ç›®çš„ï¼šä¸æ˜¯ä¸ºäº†ä¼˜åŒ–è°ƒåº¦ï¼Œè€Œæ˜¯åœ¨å¤šç§Ÿæˆ·èƒŒæ™¯ä¸‹ï¼Œçº¦æŸèµ„æºçš„ç¡¬ä½¿ç”¨è¾¹ç•Œã€‚
ResourceQuota æ¡†å®šäº†å‘½åç©ºé—´ä¸­æŸäº›èµ„æºçš„äº§ç”Ÿä¸Šé™ï¼›</p>
<p>kueueèµ„æºæ± çš„é…é¢çº¦æŸäº†æŸäº›ç»†ç²’åº¦è¦æ±‚çš„èµ„æºæ± çš„é€»è¾‘è¾¹ç•Œï¼Œé€šè¿‡resourceFalvoræŠ½è±¡å‡ºèµ„æºæ± çš„æ¦‚å¿µï¼Œ kueueé€šè¿‡â€æ’é˜Ÿâ€œè¿™ä¸ªæ¦‚å¿µç»†åŒ–äº†å‡†å…¥è¿™ä¸ªåŠ¨ä½œï¼Œåœ¨kube-schedulerå·¥ä½œå‰ç®¡æ§äº†æ‰¹å¤„ç†ä»»åŠ¡çš„è°ƒåº¦ã€‚</p>
<ul>
<li><a href="https://juejin.cn/post/7327353547313053723#heading-9" target="_blank" title="https://juejin.cn/post/7327353547313053723#heading-9">juejin.cn/post/732735â€¦</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.infracloud.io%2Fblogs%2Fbatch-scheduling-on-kubernetes%2F" target="_blank" title="https://www.infracloud.io/blogs/batch-scheduling-on-kubernetes/" ref="nofollow noopener noreferrer">www.infracloud.io/blogs/batchâ€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£ JavaScript æ¨¡å—ç³»ç»Ÿï¼šCJS ä¸ ESM çš„å®ç°åŸç†]]></title>    <link>https://juejin.cn/post/7582854603061674026</link>    <guid>https://juejin.cn/post/7582854603061674026</guid>    <pubDate>2025-12-13T16:11:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582854603061674026" data-draft-id="7583139562751852586" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£ JavaScript æ¨¡å—ç³»ç»Ÿï¼šCJS ä¸ ESM çš„å®ç°åŸç†"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-13T16:11:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¸©å®‡é£"/> <meta itemprop="url" content="https://juejin.cn/user/4300945219403368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£ JavaScript æ¨¡å—ç³»ç»Ÿï¼šCJS ä¸ ESM çš„å®ç°åŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4300945219403368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¸©å®‡é£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T16:11:28.000Z" title="Sat Dec 13 2025 16:11:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    17
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ çœŸçš„ç†è§£ <code>require</code> å’Œ <code>import</code> çš„åŒºåˆ«å—ï¼Ÿä¸åªæ˜¯è¯­æ³•ä¸åŒï¼Œå®ƒä»¬çš„åŠ è½½æ—¶æœºã€å€¼çš„ä¼ é€’æ–¹å¼ã€å¾ªç¯ä¾èµ–å¤„ç†éƒ½æˆªç„¶ä¸åŒã€‚æœ¬æ–‡é€šè¿‡ <code>require</code> æºç å’Œ ESM è§„èŒƒï¼Œè§£é‡Šè¿™äº›å·®å¼‚èƒŒåçš„å®ç°æœºåˆ¶ï¼Œè®©ä½ å½»åº•ææ‡‚ JavaScript æ¨¡å—ç³»ç»Ÿçš„è¿è¡ŒåŸç†ã€‚</p>
<h2 data-id="heading-0">æ¨¡å—åŒ–çš„æ¼”è¿›</h2>
<p>JavaScript æœ€åˆä¸ºæµè§ˆå™¨è„šæœ¬è¯­è¨€ï¼Œæ²¡æœ‰æ¨¡å—ç³»ç»Ÿã€‚éšç€åº”ç”¨è§„æ¨¡å¢é•¿ï¼Œå…¨å±€å˜é‡æ±¡æŸ“å’Œä»£ç ç»„ç»‡é—®é¢˜å‡¸æ˜¾ï¼Œå‚¬ç”Ÿäº†æ¨¡å—åŒ–æ–¹æ¡ˆã€‚</p>
<p><strong>å…¨å±€å˜é‡æ—¶ä»£</strong>ï¼šæ‰€æœ‰ä»£ç å…±äº«å…¨å±€ä½œç”¨åŸŸï¼Œå˜é‡å†²çªé¢‘å‘ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¤šä¸ªè„šæœ¬å®¹æ˜“äº§ç”Ÿå‘½åå†²çª</span>
<span class="hljs-keyword">var</span> data = <span class="hljs-string">"script1"</span>;
<span class="hljs-keyword">var</span> data = <span class="hljs-string">"script2"</span>; <span class="hljs-comment">// è¦†ç›–å‰ä¸€ä¸ª</span>
</code></pre>
<p><strong>IIFE æ¨¡å¼</strong>ï¼šåˆ©ç”¨å‡½æ•°ä½œç”¨åŸŸéš”ç¦»å˜é‡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> <span class="hljs-title class_">Module</span> = (<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">var</span> private = <span class="hljs-string">"private"</span>;
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">public</span>: <span class="hljs-string">"public"</span> };
})();
</code></pre>
<p><strong>CJS (2009)</strong>ï¼šNode.js é‡‡ç”¨ï¼ŒæœåŠ¡ç«¯æ¨¡å—è§„èŒƒã€‚</p>
<p><strong>AMD (2010)</strong>ï¼šRequireJS æ¨å¹¿ï¼Œæµè§ˆå™¨å¼‚æ­¥åŠ è½½æ–¹æ¡ˆã€‚</p>
<p><strong>ESM(2015)</strong>ï¼šECMAScript å®˜æ–¹æ ‡å‡†ï¼Œé™æ€ç»“æ„ã€‚</p>
<h2 data-id="heading-1">è¯­æ³•å¯¹æ¯”</h2>
<h3 data-id="heading-2">CJS è¯­æ³•</h3>
<p><strong>å¯¼å‡ºæ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. module.exports å¯¼å‡ºå¯¹è±¡</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">"foo"</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">"1.0"</span> };

<span class="hljs-comment">// 2. module.exports å¯¼å‡ºå‡½æ•°</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {};

<span class="hljs-comment">// 3. module.exports å¯¼å‡ºç±»</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {};

<span class="hljs-comment">// 4. exports æ·»åŠ å±æ€§ï¼ˆexports æ˜¯ module.exports çš„å¼•ç”¨ï¼‰</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">name</span> = <span class="hljs-string">"foo"</span>;
<span class="hljs-built_in">exports</span>.<span class="hljs-property">version</span> = <span class="hljs-string">"1.0"</span>;

<span class="hljs-comment">// æ³¨æ„ï¼šç›´æ¥èµ‹å€¼ exports ä¼šæ–­å¼€å¼•ç”¨</span>
<span class="hljs-comment">// exports = {} // âŒ æ— æ•ˆ</span>
</code></pre>
<p><strong>å¯¼å…¥æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. å¯¼å…¥æ•´ä¸ªæ¨¡å—</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>);

<span class="hljs-comment">// 2. è§£æ„å¯¼å…¥</span>
<span class="hljs-keyword">const</span> { name, version } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>);

<span class="hljs-comment">// 3. åŠ¨æ€è·¯å¾„ï¼ˆè¿è¡Œæ—¶è®¡ç®—ï¼‰</span>
<span class="hljs-keyword">const</span> env = <span class="hljs-string">"production"</span>;
<span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">`./config.<span class="hljs-subst">${env}</span>`</span>);

<span class="hljs-comment">// 4. æ¡ä»¶å¯¼å…¥</span>
<span class="hljs-keyword">if</span> (condition) {
  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>);
}
</code></pre>
<h3 data-id="heading-3">ESM è¯­æ³•</h3>
<p><strong>å¯¼å‡ºæ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. å‘½åå¯¼å‡º (Named Export)</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> name = <span class="hljs-string">'foo'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {}

<span class="hljs-comment">// 2. æ‰¹é‡å‘½åå¯¼å‡º</span>
<span class="hljs-keyword">const</span> name = <span class="hljs-string">'foo'</span>;
<span class="hljs-keyword">const</span> version = <span class="hljs-string">'1.0'</span>;
<span class="hljs-keyword">export</span> { name, version };

<span class="hljs-comment">// 3. é‡å‘½åå¯¼å‡º</span>
<span class="hljs-keyword">export</span> { name <span class="hljs-keyword">as</span> moduleName };

<span class="hljs-comment">// 4. é»˜è®¤å¯¼å‡º (Default Export) - æ¯ä¸ªæ¨¡å—åªèƒ½æœ‰ä¸€ä¸ª</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}
<span class="hljs-comment">// æˆ–</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {}
<span class="hljs-comment">// æˆ–</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> { <span class="hljs-attr">name</span>: <span class="hljs-string">'foo'</span> };

<span class="hljs-comment">// 5. æ··åˆå¯¼å‡ºï¼ˆå‘½å + é»˜è®¤ï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> name = <span class="hljs-string">'foo'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}

<span class="hljs-comment">// 6. è½¬å‘å¯¼å‡º</span>
<span class="hljs-keyword">export</span> { name } <span class="hljs-keyword">from</span> <span class="hljs-string">'./other.js'</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./other.js'</span>;
<span class="hljs-keyword">export</span> { <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> otherDefault } <span class="hljs-keyword">from</span> <span class="hljs-string">'./other.js'</span>;
</code></pre>
<p><strong>å¯¼å…¥æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. å¯¼å…¥å‘½åå¯¼å‡º</span>
<span class="hljs-keyword">import</span> { name, version } <span class="hljs-keyword">from</span> <span class="hljs-string">"./module.js"</span>;

<span class="hljs-comment">// 2. å¯¼å…¥å¹¶é‡å‘½å</span>
<span class="hljs-keyword">import</span> { name <span class="hljs-keyword">as</span> moduleName } <span class="hljs-keyword">from</span> <span class="hljs-string">"./module.js"</span>;

<span class="hljs-comment">// 3. å¯¼å…¥é»˜è®¤å¯¼å‡º</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MyModule</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./module.js"</span>;

<span class="hljs-comment">// 4. æ··åˆå¯¼å…¥</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MyModule</span>, { name, version } <span class="hljs-keyword">from</span> <span class="hljs-string">"./module.js"</span>;

<span class="hljs-comment">// 5. å¯¼å…¥æ‰€æœ‰å‘½åå¯¼å‡ºä¸ºå‘½åç©ºé—´å¯¹è±¡</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Module</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./module.js"</span>;

<span class="hljs-comment">// 6. ä»…æ‰§è¡Œæ¨¡å—</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"./module.js"</span>;

<span class="hljs-comment">// 7. åŠ¨æ€å¯¼å…¥ï¼ˆå¯åœ¨ä»»æ„ä½ç½®ï¼Œè¿”å› Promiseï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"./module.js"</span>);
<span class="hljs-comment">// æˆ–</span>
<span class="hljs-keyword">if</span> (condition) {
  <span class="hljs-keyword">import</span>(<span class="hljs-string">"./module.js"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-variable language_">module</span></span>) =&gt;</span> {});
}
</code></pre>
<h2 data-id="heading-4">CJS åŠ è½½æœºåˆ¶</h2>
<p>CJS æ˜¯ Node.js å®ç°çš„æ¨¡å—ç³»ç»Ÿã€‚ä¸åŒäºè¯­è¨€å±‚é¢çš„ç‰¹æ€§ï¼ŒCJS æ˜¯ä¸€ä¸ª<strong>è¿è¡Œæ—¶æ¦‚å¿µ</strong>ï¼Œæ ¸å¿ƒæ˜¯ Node.js å†…ç½®çš„ <code>require</code> å‡½æ•°ã€‚ç†è§£ <code>require</code> çš„å®ç°åŸç†ï¼Œæœ‰åŠ©äºç†è§£ CJS çš„å„ç§ç‰¹æ€§ã€‚</p>
<h3 data-id="heading-5">require å®ç°åŸç†</h3>
<p><code>require</code> å‡½æ•°è´Ÿè´£åŠ è½½æ¨¡å—ï¼Œå†…éƒ¨ç»´æŠ¤ <code>require.cache</code> ç¼“å­˜å¯¹è±¡ã€‚ä¸‹é¢æ˜¯ç®€åŒ–çš„ä¼ªæºç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">require</span>(<span class="hljs-params">modulePath</span>) {
  <span class="hljs-comment">// 1. è§£æä¸ºç»å¯¹è·¯å¾„</span>
  <span class="hljs-keyword">const</span> absolutePath = <span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(modulePath);

  <span class="hljs-comment">// 2. æ£€æŸ¥ç¼“å­˜</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.<span class="hljs-property">cache</span>[absolutePath]) {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>.<span class="hljs-property">cache</span>[absolutePath].<span class="hljs-property">exports</span>;
  }

  <span class="hljs-comment">// 3. åˆ›å»º Module å¯¹è±¡</span>
  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = {
    <span class="hljs-attr">id</span>: absolutePath,
    <span class="hljs-attr">exports</span>: {},
    <span class="hljs-attr">loaded</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-comment">// ... å…¶ä»–å±æ€§</span>
  };

  <span class="hljs-comment">// 4. æå‰æ”¾å…¥ç¼“å­˜ï¼ˆå¤„ç†å¾ªç¯ä¾èµ–çš„å…³é”®ï¼‰</span>
  <span class="hljs-built_in">require</span>.<span class="hljs-property">cache</span>[absolutePath] = <span class="hljs-variable language_">module</span>;

  <span class="hljs-comment">// 5. è¯»å–æ–‡ä»¶å†…å®¹</span>
  <span class="hljs-keyword">const</span> code = fs.<span class="hljs-title function_">readFileSync</span>(absolutePath, <span class="hljs-string">"utf8"</span>);

  <span class="hljs-comment">// 6. åŒ…è£…ä¸ºå‡½æ•°</span>
  <span class="hljs-keyword">const</span> wrapper = <span class="hljs-string">"(function (exports, require, module, __filename, __dirname) { "</span> + code + <span class="hljs-string">"\n});"</span>;

  <span class="hljs-comment">// 7. ç¼–è¯‘å¹¶æ‰§è¡Œ</span>
  <span class="hljs-keyword">const</span> compiledWrapper = vm.<span class="hljs-title function_">runInThisContext</span>(wrapper);
  compiledWrapper.<span class="hljs-title function_">call</span>(
    <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>, <span class="hljs-comment">// this æŒ‡å‘ exports</span>
    <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>, <span class="hljs-comment">// å‚æ•° 1: exports</span>
    <span class="hljs-built_in">require</span>, <span class="hljs-comment">// å‚æ•° 2: require</span>
    <span class="hljs-variable language_">module</span>, <span class="hljs-comment">// å‚æ•° 3: module</span>
    absolutePath, <span class="hljs-comment">// å‚æ•° 4: __filename</span>
    path.<span class="hljs-title function_">dirname</span>(absolutePath) <span class="hljs-comment">// å‚æ•° 5: __dirname</span>
  );

  <span class="hljs-comment">// 8. æ ‡è®°ä¸ºå·²åŠ è½½</span>
  <span class="hljs-variable language_">module</span>.<span class="hljs-property">loaded</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-comment">// 9. è¿”å› module.exports</span>
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>;
}

<span class="hljs-comment">// require.cache: ç¼“å­˜å¯¹è±¡</span>
<span class="hljs-built_in">require</span>.<span class="hljs-property">cache</span> = {};

<span class="hljs-comment">// require.resolve: è§£æè·¯å¾„</span>
<span class="hljs-built_in">require</span>.<span class="hljs-property">resolve</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">modulePath</span>) {
  <span class="hljs-comment">// è§£æç®—æ³•ï¼šç›¸å¯¹è·¯å¾„ã€ç»å¯¹è·¯å¾„ã€node_modules æŸ¥æ‰¾ç­‰</span>
  <span class="hljs-keyword">return</span> absolutePath;
};
</code></pre>
<p>ä»ä¼ªæºç å¯ä»¥çœ‹å‡ºï¼Œ<code>require</code> åšäº†è¿™äº›äº‹ï¼šè§£æè·¯å¾„ã€æ£€æŸ¥ç¼“å­˜ã€åˆ›å»º Module å¯¹è±¡ã€æå‰æ”¾å…¥ç¼“å­˜ã€åŒ…è£…å¹¶æ‰§è¡Œä»£ç ã€è¿”å› <code>module.exports</code>ã€‚è¿™ç§è®¾è®¡å¸¦æ¥äº†ä»¥ä¸‹ç‰¹æ€§ã€‚</p>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fmodules.html%23the-module-wrapper" target="_blank" title="https://nodejs.org/api/modules.html#the-module-wrapper" ref="nofollow noopener noreferrer">Node.js Modules: The module wrapper</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fmodules.html%23requireid" target="_blank" title="https://nodejs.org/api/modules.html#requireid" ref="nofollow noopener noreferrer">Node.js Modules: require</a></p>
</blockquote>
<h3 data-id="heading-6">åŒæ­¥æ‰§è¡Œï¼Œä¸æ”¯æŒ top-level await</h3>
<p>ä»ä¼ªæºç çš„ç¬¬ 5 æ­¥å¯ä»¥çœ‹åˆ°ï¼Œ<code>require</code> ä½¿ç”¨ <code>fs.readFileSync</code> åŒæ­¥è¯»å–æ–‡ä»¶ï¼Œä¼šé˜»å¡ä»£ç ç›´åˆ°æ¨¡å—åŠ è½½å®Œæˆã€‚ç”±äº CJS æ¨¡å—ä»£ç è¢«åŒ…è£…åœ¨æ™®é€šå‡½æ•°ä¸­ï¼ˆé async å‡½æ•°ï¼‰ï¼Œå› æ­¤ä¸æ”¯æŒ top-level awaitã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// module.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"module æ‰§è¡Œ"</span>);
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">"foo"</span> };

<span class="hljs-comment">// main.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å¼€å§‹"</span>);
<span class="hljs-keyword">const</span> mod = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>); <span class="hljs-comment">// é˜»å¡ï¼Œç­‰å¾… module.js æ‰§è¡Œå®Œæˆ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç»“æŸ"</span>, mod.<span class="hljs-property">name</span>);

<span class="hljs-comment">// è¾“å‡ºï¼š</span>
<span class="hljs-comment">// å¼€å§‹</span>
<span class="hljs-comment">// module æ‰§è¡Œ</span>
<span class="hljs-comment">// ç»“æŸ foo</span>

<span class="hljs-comment">// âŒ CJS ä¸æ”¯æŒ top-level await</span>
<span class="hljs-comment">// await someAsyncFunction(); // SyntaxError: await is only valid in async functions</span>
</code></pre>
<h3 data-id="heading-7">å€¼æ‹·è´</h3>
<p>ä¼ªæºç çš„ç¬¬ 4 æ­¥å°† Module å¯¹è±¡æ”¾å…¥ç¼“å­˜ï¼Œç¬¬ 2 æ­¥æ£€æŸ¥ç¼“å­˜æ—¶ç›´æ¥è¿”å› <code>module.exports</code>ã€‚è¿™æ„å‘³ç€æ‰€æœ‰ <code>require</code> è¿”å›çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡å¼•ç”¨ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// counter.js</span>
<span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">count</span>: count, <span class="hljs-comment">// å¯¼å‡ºæ—¶ count çš„å€¼ä¸º 0</span>
  <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
    count++;
  },
};

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">const</span> counter = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./counter"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter.<span class="hljs-property">count</span>); <span class="hljs-comment">// 0</span>
counter.<span class="hljs-title function_">increment</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter.<span class="hljs-property">count</span>); <span class="hljs-comment">// 0ï¼ˆå¯¹è±¡å±æ€§æœªå˜ï¼Œcount æ˜¯æ¨¡å—å†…éƒ¨å˜é‡ï¼‰</span>

<span class="hljs-comment">// other.js</span>
<span class="hljs-keyword">const</span> counter2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./counter"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter === counter2); <span class="hljs-comment">// trueï¼ˆåŒä¸€ä¸ªå¯¹è±¡ï¼‰</span>
</code></pre>
<h3 data-id="heading-8">å¾ªç¯ä¾èµ–å¤„ç†</h3>
<p>ä¼ªæºç çš„å…³é”®è®¾è®¡æ˜¯ç¬¬ 4 æ­¥ï¼š<strong>åœ¨æ¨¡å—ä»£ç æ‰§è¡Œå‰ï¼Œå°±å°† Module å¯¹è±¡æ”¾å…¥ç¼“å­˜</strong>ï¼ˆæ­¤æ—¶ <code>loaded: false</code>ï¼‰ã€‚è¿™ä½¿å¾—å¾ªç¯ä¾èµ–æ—¶ï¼ŒååŠ è½½çš„æ¨¡å—èƒ½æ‹¿åˆ°å‰ä¸€ä¸ªæ¨¡å—æœªå®Œæˆçš„ <code>exports</code>ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// a.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"a å¼€å§‹"</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">done</span> = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">const</span> b = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./b"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"åœ¨ a ä¸­ï¼Œb.done ="</span>, b.<span class="hljs-property">done</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">done</span> = <span class="hljs-literal">true</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"a ç»“æŸ"</span>);

<span class="hljs-comment">// b.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"b å¼€å§‹"</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">done</span> = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">const</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./a"</span>); <span class="hljs-comment">// æ­¤æ—¶ a æœªæ‰§è¡Œå®Œï¼Œexports.done = false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"åœ¨ b ä¸­ï¼Œa.done ="</span>, a.<span class="hljs-property">done</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">done</span> = <span class="hljs-literal">true</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"b ç»“æŸ"</span>);

<span class="hljs-comment">// main.js</span>
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./a"</span>);

<span class="hljs-comment">// è¾“å‡ºï¼š</span>
<span class="hljs-comment">// a å¼€å§‹</span>
<span class="hljs-comment">// b å¼€å§‹</span>
<span class="hljs-comment">// åœ¨ b ä¸­ï¼Œa.done = false</span>
<span class="hljs-comment">// b ç»“æŸ</span>
<span class="hljs-comment">// åœ¨ a ä¸­ï¼Œb.done = true</span>
<span class="hljs-comment">// a ç»“æŸ</span>
</code></pre>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fmodules.html%23cycles" target="_blank" title="https://nodejs.org/api/modules.html#cycles" ref="nofollow noopener noreferrer">Node.js Modules: Cycles</a></p>
</blockquote>
<h3 data-id="heading-9">ä¸è¦é‡æ–°èµ‹å€¼ exports</h3>
<p>ä¼ªæºç ç¬¬ 7 æ­¥æ‰§è¡ŒåŒ…è£…å‡½æ•°æ—¶ï¼Œå°† <code>module.exports</code> ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œèµ‹å€¼ç»™ <code>exports</code>ã€‚è¿™æ„å‘³ç€ <code>exports</code> åªæ˜¯ <code>module.exports</code> çš„å¼•ç”¨ã€‚ä¸€æ—¦é‡æ–°èµ‹å€¼ <code>module.exports</code>ï¼Œå¼•ç”¨å…³ç³»å°±æ–­å¼€ï¼Œä¹‹åä¿®æ”¹ <code>exports</code> å°±æ— æ³•å¯¼å‡ºäº†ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// module.js</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">name</span> = <span class="hljs-string">"foo"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">exports</span> === <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>); <span class="hljs-comment">// true</span>

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-attr">version</span>: <span class="hljs-string">"1.0"</span> }; <span class="hljs-comment">// é‡æ–°èµ‹å€¼</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">exports</span> === <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>); <span class="hljs-comment">// false</span>

<span class="hljs-built_in">exports</span>.<span class="hljs-property">age</span> = <span class="hljs-number">18</span>; <span class="hljs-comment">// æ— æ•ˆï¼Œexports å·²å¤±æ•ˆ</span>

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">const</span> mod = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mod); <span class="hljs-comment">// { version: '1.0' }</span>
</code></pre>
<h3 data-id="heading-10">ç¼“å­˜æ¸…é™¤ä¸æ¨¡å—é‡è½½</h3>
<p>ç”±äº <code>require.cache</code> æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡åˆ é™¤ç¼“å­˜æ¥å¼ºåˆ¶é‡æ–°åŠ è½½æ¨¡å—ã€‚è¿™åœ¨å¼€å‘çƒ­é‡è½½ç­‰åœºæ™¯ä¸­å¾ˆæœ‰ç”¨ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// module.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ¨¡å—æ‰§è¡Œ"</span>);
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() };

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">const</span> mod1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>); <span class="hljs-comment">// è¾“å‡º: æ¨¡å—æ‰§è¡Œ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mod1.<span class="hljs-property">timestamp</span>);

<span class="hljs-comment">// åˆ é™¤ç¼“å­˜</span>
<span class="hljs-keyword">delete</span> <span class="hljs-built_in">require</span>.<span class="hljs-property">cache</span>[<span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">"./module"</span>)];

<span class="hljs-keyword">const</span> mod2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>); <span class="hljs-comment">// å†æ¬¡è¾“å‡º: æ¨¡å—æ‰§è¡Œ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mod2.<span class="hljs-property">timestamp</span>); <span class="hljs-comment">// ä¸åŒçš„æ—¶é—´æˆ³</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mod1 === mod2); <span class="hljs-comment">// false</span>
</code></pre>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fmodules.html%23requirecache" target="_blank" title="https://nodejs.org/api/modules.html#requirecache" ref="nofollow noopener noreferrer">Node.js Modules: require.cache</a></p>
</blockquote>
<h2 data-id="heading-11">ESM åŠ è½½æœºåˆ¶</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fecma262%2F%23sec-modules" target="_blank" title="https://tc39.es/ecma262/#sec-modules" ref="nofollow noopener noreferrer">ESM</a> æ˜¯ ECMAScript æ ‡å‡†å®šä¹‰çš„æ¨¡å—ç³»ç»Ÿï¼Œæ˜¯<strong>è¯­è¨€å±‚é¢çš„ç‰¹æ€§</strong>ã€‚ä¸åŒäº CJS çš„è¿è¡Œæ—¶åŠ è½½ï¼ŒESM åœ¨ä»£ç æ‰§è¡Œå‰è¿›è¡Œé™æ€åˆ†æï¼Œç¡®å®šæ¨¡å—ä¾èµ–å…³ç³»ã€‚</p>
<h3 data-id="heading-12">ESM åŠ è½½è¿‡ç¨‹</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhacks.mozilla.org%2F2018%2F03%2Fes-modules-a-cartoon-deep-dive" target="_blank" title="https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive" ref="nofollow noopener noreferrer">ESM çš„åŠ è½½è¿‡ç¨‹</a>æ˜¯å°†å…¥å£æ–‡ä»¶ï¼ˆentry point fileï¼‰è½¬æ¢ä¸ºæ¨¡å—å®ä¾‹ï¼ˆmodule instanceï¼‰çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š<strong>Construction</strong>ï¼ˆæ„å»ºï¼‰ã€<strong>Instantiation</strong>ï¼ˆå®ä¾‹åŒ–ï¼‰ã€<strong>Evaluation</strong>ï¼ˆæ±‚å€¼ï¼‰ã€‚</p>
<h4 data-id="heading-13">æ ¸å¿ƒæ¦‚å¿µ</h4>
<p><strong>Module Recordï¼ˆæ¨¡å—è®°å½•ï¼‰</strong>ï¼š</p>
<ul>
<li>æ–‡ä»¶è¢«è§£æåç”Ÿæˆçš„æ•°æ®ç»“æ„</li>
<li>åŒ…å«æ¨¡å—çš„ import/export ä¿¡æ¯ã€ä»£ç ç­‰</li>
</ul>
<p><strong>Module Instanceï¼ˆæ¨¡å—å®ä¾‹ï¼‰</strong>ï¼š</p>
<ul>
<li>ç”±ä»£ç ï¼ˆcodeï¼‰å’ŒçŠ¶æ€ï¼ˆstateï¼‰ç»„æˆ</li>
<li>ä»£ç æ˜¯æŒ‡ä»¤é›†ï¼ˆå¦‚ä½•åšäº‹çš„é…æ–¹ï¼‰</li>
<li>çŠ¶æ€æ˜¯å˜é‡çš„å®é™…å€¼ï¼ˆå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼‰</li>
</ul>
<p><strong>Entry Point Fileï¼ˆå…¥å£æ–‡ä»¶ï¼‰</strong>ï¼š</p>
<ul>
<li>æ¨¡å—å›¾çš„èµ·ç‚¹</li>
<li>æµè§ˆå™¨é€šè¿‡ <code>&lt;script type="module" src="main.js"&gt;</code> æŒ‡å®šå…¥å£</li>
</ul>
<h4 data-id="heading-14">é˜¶æ®µ 1ï¼šConstructionï¼ˆæ„å»ºï¼‰</h4>
<p>æŸ¥æ‰¾ã€è·å–ã€è§£ææ–‡ä»¶ï¼Œæ„å»ºæ¨¡å—å›¾ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[å…¥å£æ–‡ä»¶ main.js] --&gt; B[è§£æ import è¯­å¥]
    B --&gt; C[æ‰¾åˆ°ä¾èµ– counter.js]
    C --&gt; D[è·å– counter.js]
    D --&gt; E[è§£æ counter.js]
    E --&gt; F[é€’å½’å¤„ç†æ‰€æœ‰ä¾èµ–]
    F --&gt; G[ç”Ÿæˆ Module Records]
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>Loader è´Ÿè´£æŸ¥æ‰¾å’Œè·å–æ–‡ä»¶ï¼Œæµè§ˆå™¨å’Œ Node çš„ loader ä¸åŒ</li>
<li>è§£ææ—¶è¯†åˆ«æ‰€æœ‰é™æ€ <code>import/export</code> å£°æ˜</li>
<li>é€å±‚æ„å»ºå®Œæ•´çš„æ¨¡å—ä¾èµ–å›¾</li>
<li>åŠ¨æ€ <code>import()</code> ä¸åœ¨æ­¤é˜¶æ®µå¤„ç†</li>
</ul>
<p><strong>Module Mapï¼ˆæ¨¡å—æ˜ å°„ï¼‰</strong>ï¼š</p>
<ul>
<li>Loader ä½¿ç”¨ Module Map ç¼“å­˜æ¨¡å—</li>
<li>é”®æ˜¯æ¨¡å—çš„å”¯ä¸€æ ‡è¯†ï¼Œå€¼æ˜¯ Module Record</li>
<li>ç¡®ä¿æ¯ä¸ªæ¨¡å—åªè¢«åŠ è½½å’Œè§£æä¸€æ¬¡</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Module Map ç¤ºä¾‹ï¼ˆæ¦‚å¿µï¼‰</span>
{
  <span class="hljs-string">'https://example.com/main.js'</span>: <span class="hljs-title class_">ModuleRecord</span> { ... },
  <span class="hljs-string">'https://example.com/counter.js'</span>: <span class="hljs-title class_">ModuleRecord</span> { ... }
}
</code></pre>
<h4 data-id="heading-15">é˜¶æ®µ 2ï¼šInstantiationï¼ˆå®ä¾‹åŒ–ï¼‰</h4>
<p>åœ¨å†…å­˜ä¸­ä¸ºå¯¼å‡ºå€¼åˆ†é…ç©ºé—´ï¼Œå»ºç«‹ import/export çš„å®æ—¶ç»‘å®šï¼ˆlive bindingsï¼‰ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[éå†æ¨¡å—å›¾] --&gt; B[åˆ›å»º Module Environment Record]
    B --&gt; C[ä¸º export åœ¨å†…å­˜ä¸­åˆ†é…ç©ºé—´]
    C --&gt; D[å»ºç«‹ import/export çš„å®æ—¶ç»‘å®š]
    D --&gt; E[éªŒè¯æ‰€æœ‰ import æœ‰å¯¹åº”çš„ export]
</code></pre>
<p><strong>å®æ—¶ç»‘å®šï¼ˆLive Bindingsï¼‰</strong>ï¼š</p>
<ul>
<li>Export å’Œ import æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä¸ªä½ç½®</li>
<li>å¯¼å‡ºæ¨¡å—ä¿®æ”¹å€¼ï¼Œå¯¼å…¥æ¨¡å—èƒ½çœ‹åˆ°å˜åŒ–</li>
<li>ä¸ CJS çš„å€¼æ‹·è´ä¸åŒ</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// counter.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
  count++; <span class="hljs-comment">// ä¿®æ”¹ count</span>
}

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { count, increment } <span class="hljs-keyword">from</span> <span class="hljs-string">"./counter.js"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count); <span class="hljs-comment">// 0</span>
<span class="hljs-title function_">increment</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count); <span class="hljs-comment">// 1ï¼ˆå®æ—¶ç»‘å®šï¼Œçœ‹åˆ°äº†å˜åŒ–ï¼‰</span>
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>æ­¤é˜¶æ®µåªåˆ†é…å†…å­˜ï¼Œ<strong>ä¸å¡«å……å€¼</strong></li>
<li>å¯¼å‡ºçš„å‡½æ•°å£°æ˜ä¼šåœ¨æ­¤é˜¶æ®µåˆå§‹åŒ–</li>
<li>ä½¿ç”¨æ·±åº¦ä¼˜å…ˆååºéå†ï¼ˆdepth-first post-order traversalï¼‰</li>
</ul>
<h4 data-id="heading-16">é˜¶æ®µ 3ï¼šEvaluationï¼ˆæ±‚å€¼ï¼‰</h4>
<p>æ‰§è¡Œæ¨¡å—çš„é¡¶å±‚ä»£ç ï¼ˆtop-level codeï¼‰ï¼Œå¡«å……å†…å­˜ä¸­çš„å€¼ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[æŒ‰ä¾èµ–é¡ºåºæ‰§è¡Œæ¨¡å—] --&gt; B[æ‰§è¡Œé¡¶å±‚ä»£ç ]
    B --&gt; C[å¡«å……å¯¼å‡ºå€¼]
    C --&gt; D{æœ‰å‰¯ä½œç”¨?}
    D --&gt;|æ˜¯| E[è§¦å‘å‰¯ä½œç”¨&lt;br&gt;å¦‚ç½‘ç»œè¯·æ±‚]
    D --&gt;|å¦| F[å®Œæˆ]
    E --&gt; F
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>é¡¶å±‚ä»£ç ï¼šå‡½æ•°å¤–çš„ä»£ç </li>
<li>æ¯ä¸ªæ¨¡å—åªæ±‚å€¼ä¸€æ¬¡ï¼ˆModule Map ç¡®ä¿ï¼‰</li>
<li>å¯èƒ½äº§ç”Ÿå‰¯ä½œç”¨ï¼ˆside effectsï¼‰ï¼šç½‘ç»œè¯·æ±‚ã€ä¿®æ”¹ DOM ç­‰</li>
<li>æ·±åº¦ä¼˜å…ˆååºéå†ï¼šå…ˆæ±‚å€¼ä¾èµ–ï¼Œå†æ±‚å€¼å½“å‰æ¨¡å—</li>
</ul>
<h3 data-id="heading-17">æµè§ˆå™¨å’Œ Node.js çš„ Construction å·®å¼‚</h3>
<p>ESM çš„ä¸‰é˜¶æ®µåŠ è½½æµç¨‹åœ¨æµè§ˆå™¨å’Œ Node.js ä¸­æ˜¯ä¸€è‡´çš„ï¼Œä½†åœ¨ Construction é˜¶æ®µå­˜åœ¨å·®å¼‚ã€‚Construction åŒ…å«ä¸¤ä¸ªè¿‡ç¨‹ï¼š<strong>Module Resolution</strong>ï¼ˆæ¨¡å—è§£æï¼Œç¡®å®šæ¨¡å—è·¯å¾„ï¼‰å’Œ <strong>Fetch</strong>ï¼ˆè·å–æ–‡ä»¶ï¼‰ã€‚</p>
<h4 data-id="heading-18">æµè§ˆå™¨</h4>
<p><strong>Module Resolution</strong>ï¼ˆæ¨¡å—è§£æï¼‰ï¼š</p>
<p>æµè§ˆå™¨ä½¿ç”¨å®Œæ•´çš„ URL ä½œä¸ºæ¨¡å—æ ‡è¯†ç¬¦ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- å…¥å£æ–‡ä»¶ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/main.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js - å¿…é¡»ä½¿ç”¨ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„</span>
<span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">"./math.js"</span>; <span class="hljs-comment">// âœ… ç›¸å¯¹è·¯å¾„</span>
<span class="hljs-keyword">import</span> { config } <span class="hljs-keyword">from</span> <span class="hljs-string">"/config.js"</span>; <span class="hljs-comment">// âœ… ç»å¯¹è·¯å¾„</span>
<span class="hljs-keyword">import</span> { api } <span class="hljs-keyword">from</span> <span class="hljs-string">"https://cdn.example.com/api.js"</span>; <span class="hljs-comment">// âœ… å®Œæ•´ URL</span>

<span class="hljs-comment">// âŒ è£¸æ¨¡å—æ ‡è¯†ç¬¦ï¼ˆbare specifierï¼‰ä¸æ”¯æŒ</span>
<span class="hljs-keyword">import</span> { lodash } <span class="hljs-keyword">from</span> <span class="hljs-string">"lodash"</span>; <span class="hljs-comment">// æŠ¥é”™ï¼šFailed to resolve module specifier</span>
</code></pre>
<p><strong>Import Maps</strong>ï¼šæµè§ˆå™¨é€šè¿‡ Import Maps æ”¯æŒè£¸æ¨¡å—æ ‡è¯†ç¬¦ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"importmap"</span>&gt;</span><span class="javascript">
  {
    <span class="hljs-string">"imports"</span>: {
      <span class="hljs-string">"lodash"</span>: <span class="hljs-string">"https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.js"</span>,
      <span class="hljs-string">"vue"</span>: <span class="hljs-string">"/node_modules/vue/dist/vue.esm-browser.js"</span>
    }
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">"lodash"</span>; <span class="hljs-comment">// âœ… è§£æä¸º https://cdn.jsdelivr.net/npm/...</span>
  <span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>; <span class="hljs-comment">// âœ… è§£æä¸º /node_modules/vue/...</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fhtml.spec.whatwg.org%2Fmultipage%2Fwebappapis.html%23import-maps" target="_blank" title="https://html.spec.whatwg.org/multipage/webappapis.html#import-maps" ref="nofollow noopener noreferrer">HTML Standard: Import maps</a></p>
</blockquote>
<p><strong>Fetch</strong>ï¼ˆè·å–æ–‡ä»¶ï¼‰ï¼š</p>
<ul>
<li><strong>å¹¶è¡Œä¸‹è½½</strong>ï¼šæµè§ˆå™¨ä¼šå¹¶è¡Œå‘èµ·å¤šä¸ª HTTP è¯·æ±‚ä¸‹è½½ä¾èµ–æ¨¡å—</li>
<li><strong>é˜»å¡è¡Œä¸º</strong>ï¼šå¿…é¡»ç­‰æ‰€æœ‰ä¾èµ–ä¸‹è½½å®Œæ‰èƒ½è¿›å…¥ Instantiation é˜¶æ®µ</li>
<li><strong>éé˜»å¡æ¸²æŸ“</strong>ï¼š<code>&lt;script type="module"&gt;</code> é»˜è®¤å…·æœ‰ <code>defer</code> ç‰¹æ€§ï¼Œä¸ä¼šé˜»å¡é¡µé¢æ¸²æŸ“</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[Module Resolution:&lt;br/&gt;è§£ææ¨¡å—è·¯å¾„] --&gt; B[Fetch: å‘èµ· HTTP è¯·æ±‚]
    B --&gt; C[å¹¶è¡Œä¸‹è½½ a.js]
    B --&gt; D[å¹¶è¡Œä¸‹è½½ b.js]
    B --&gt; E[å¹¶è¡Œä¸‹è½½ c.js]
    C --&gt; F[ç­‰å¾…æ‰€æœ‰ä¾èµ–ä¸‹è½½å®Œæˆ]
    D --&gt; F
    E --&gt; F
    F --&gt; G[è¿›å…¥ Instantiation é˜¶æ®µ]
</code></pre>
<h4 data-id="heading-19">Node.js</h4>
<p><strong>Module Resolution</strong>ï¼ˆæ¨¡å—è§£æï¼‰ï¼š</p>
<p>Node.js æ”¯æŒè£¸æ¨¡å—æ ‡è¯†ç¬¦ï¼Œä½¿ç”¨å¤æ‚çš„è§£æç®—æ³•æŸ¥æ‰¾æ¨¡å—ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Node.js æ”¯æŒå¤šç§å¯¼å…¥æ–¹å¼</span>
<span class="hljs-keyword">import</span> { readFile } <span class="hljs-keyword">from</span> <span class="hljs-string">"fs"</span>; <span class="hljs-comment">// âœ… å†…ç½®æ¨¡å—</span>
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">"express"</span>; <span class="hljs-comment">// âœ… node_modules æŸ¥æ‰¾</span>
<span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">"./math.js"</span>; <span class="hljs-comment">// âœ… ç›¸å¯¹è·¯å¾„</span>
<span class="hljs-keyword">import</span> { config } <span class="hljs-keyword">from</span> <span class="hljs-string">"/abs/path/config.js"</span>; <span class="hljs-comment">// âœ… ç»å¯¹è·¯å¾„</span>
</code></pre>
<p>Node.js çš„è§£æç®—æ³•ï¼š</p>
<ol>
<li><strong>å†…ç½®æ¨¡å—</strong>ï¼šå¦‚ <code>fs</code>ã€<code>path</code>ï¼Œç›´æ¥è¿”å›</li>
<li><strong>ç›¸å¯¹/ç»å¯¹è·¯å¾„</strong>ï¼šæŒ‰è·¯å¾„æŸ¥æ‰¾</li>
<li><strong>è£¸æ¨¡å—æ ‡è¯†ç¬¦</strong>ï¼šä»å½“å‰ç›®å½•å¼€å§‹ï¼Œé€å±‚å‘ä¸ŠæŸ¥æ‰¾ <code>node_modules</code></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å½“å‰æ–‡ä»¶ï¼š/project/src/index.js</span>
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">"express"</span>;

<span class="hljs-comment">// Node.js æŸ¥æ‰¾é¡ºåºï¼š</span>
<span class="hljs-comment">// 1. /project/src/node_modules/express</span>
<span class="hljs-comment">// 2. /project/node_modules/express</span>
<span class="hljs-comment">// 3. /node_modules/express</span>
</code></pre>
<p><strong>package.json çš„ exports å­—æ®µ</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-package"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"."</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./utils"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/utils.js"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> pkg <span class="hljs-keyword">from</span> <span class="hljs-string">"my-package"</span>; <span class="hljs-comment">// è§£æä¸º ./dist/index.js</span>
<span class="hljs-keyword">import</span> utils <span class="hljs-keyword">from</span> <span class="hljs-string">"my-package/utils"</span>; <span class="hljs-comment">// è§£æä¸º ./dist/utils.js</span>
</code></pre>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fpackages.html%23package-entry-points" target="_blank" title="https://nodejs.org/api/packages.html#package-entry-points" ref="nofollow noopener noreferrer">Node.js: Modules: Packages</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fesm.html%23resolution-algorithm" target="_blank" title="https://nodejs.org/api/esm.html#resolution-algorithm" ref="nofollow noopener noreferrer">Node.js: ECMAScript modules</a></p>
</blockquote>
<p><strong>Fetch</strong>ï¼ˆè·å–æ–‡ä»¶ï¼‰ï¼š</p>
<ul>
<li><strong>åŒæ­¥è¯»å–</strong>ï¼šNode.js ä½¿ç”¨åŒæ­¥ I/O è¯»å–æœ¬åœ°æ–‡ä»¶</li>
<li><strong>æ— ç½‘ç»œå»¶è¿Ÿ</strong>ï¼šè¯»å–æœ¬åœ°æ–‡ä»¶é€Ÿåº¦å¿«ï¼Œä½†ä»éœ€ç­‰å¾…æ‰€æœ‰ä¾èµ–è¯»å–å®Œ</li>
<li><strong>æ€§èƒ½å½±å“</strong>ï¼šå¤§é‡æ¨¡å—æ—¶æ–‡ä»¶ I/O ä»æœ‰æ€§èƒ½å½±å“</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[Module Resolution:&lt;br/&gt;è§£ææ¨¡å—è·¯å¾„] --&gt; B[Fetch: åŒæ­¥è¯»å– a.js]
    B --&gt; C[åŒæ­¥è¯»å– b.js]
    C --&gt; D[åŒæ­¥è¯»å– c.js]
    D --&gt; E[æ‰€æœ‰æ–‡ä»¶è¯»å–å®Œæˆ]
    E --&gt; F[è¿›å…¥ Instantiation é˜¶æ®µ]
</code></pre>
<h3 data-id="heading-20">åŠ¨æ€ import</h3>
<p>ESM æä¾›ä¸¤ç§å¯¼å…¥æ–¹å¼ï¼š<strong>é™æ€å¯¼å…¥</strong>ï¼ˆ<code>import</code> å£°æ˜ï¼‰å’Œ<strong>åŠ¨æ€å¯¼å…¥</strong>ï¼ˆ<code>import()</code> å‡½æ•°ï¼‰ã€‚</p>
<h4 data-id="heading-21">é™æ€å¯¼å…¥</h4>
<p>é™æ€å¯¼å…¥åœ¨ Construction é˜¶æ®µå¤„ç†ï¼Œå¿…é¡»åœ¨æ¨¡å—é¡¶å±‚ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… é¡¶å±‚é™æ€å¯¼å…¥</span>
<span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">"./math.js"</span>;
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">"express"</span>;

<span class="hljs-comment">// âŒ ä¸èƒ½åœ¨ä»£ç å—ã€å‡½æ•°ã€æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">if</span> (condition) {
  <span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">"./math.js"</span>; <span class="hljs-comment">// SyntaxError</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadModule</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">"express"</span>; <span class="hljs-comment">// SyntaxError</span>
}
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>åœ¨ä»£ç æ‰§è¡Œå‰å®Œæˆï¼ˆConstruction é˜¶æ®µï¼‰</li>
<li>æ”¯æŒé™æ€åˆ†æï¼šæ‰“åŒ…å·¥å…·å¯è¿›è¡Œ tree-shaking</li>
<li>è·¯å¾„å¿…é¡»æ˜¯é™æ€å­—ç¬¦ä¸²ï¼ˆä¸èƒ½æ˜¯å˜é‡ï¼‰</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-string">'./math.js'</span>;
<span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> path;  <span class="hljs-comment">// âŒ SyntaxError</span>
</code></pre>
<h4 data-id="heading-22">åŠ¨æ€å¯¼å…¥ import()</h4>
<p><code>import()</code> æ˜¯ä¸€ä¸ªè¿”å› Promise çš„å‡½æ•°ï¼Œå¯åœ¨ä»»æ„ä½ç½®ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… æ¡ä»¶åŠ è½½</span>
<span class="hljs-keyword">if</span> (condition) {
  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"./module.js"</span>);
}

<span class="hljs-comment">// âœ… å‡½æ•°å†…ä½¿ç”¨</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadModule</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> express = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"express"</span>);
  <span class="hljs-keyword">return</span> express.<span class="hljs-property">default</span>;
}

<span class="hljs-comment">// âœ… åŠ¨æ€è·¯å¾„</span>
<span class="hljs-keyword">const</span> env = <span class="hljs-string">"production"</span>;
<span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">`./config.<span class="hljs-subst">${env}</span>.js`</span>);

<span class="hljs-comment">// âœ… æŒ‰éœ€åŠ è½½ï¼ˆä»£ç åˆ†å‰²ï¼‰</span>
button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> { <span class="hljs-title class_">Chart</span> } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"./chart.js"</span>);
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chart</span>(data);
});
</code></pre>
<p><strong>è¿”å›å€¼</strong>ï¼šModule Namespace Objectï¼ˆæ¨¡å—å‘½åç©ºé—´å¯¹è±¡ï¼‰</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// math.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">a, b</span>) =&gt; a + b;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">return</span> a * b;
}

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"./math.js"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">module</span>);
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   add: [Function: add],</span>
<span class="hljs-comment">//   default: [Function: multiply]</span>
<span class="hljs-comment">// }</span>

<span class="hljs-variable language_">module</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// 3</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-title function_">default</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// 6</span>
</code></pre>
<h4 data-id="heading-23">é™æ€å¯¼å…¥ vs åŠ¨æ€å¯¼å…¥</h4>













































<table><thead><tr><th>ç‰¹æ€§</th><th>é™æ€å¯¼å…¥ <code>import</code></th><th>åŠ¨æ€å¯¼å…¥ <code>import()</code></th></tr></thead><tbody><tr><td>è¯­æ³•</td><td>å£°æ˜è¯­å¥</td><td>å‡½æ•°è°ƒç”¨ï¼ˆè¿”å› Promiseï¼‰</td></tr><tr><td>ä½¿ç”¨ä½ç½®</td><td>ä»…æ¨¡å—é¡¶å±‚</td><td>ä»»æ„ä½ç½®ï¼ˆå‡½æ•°ã€ä»£ç å—ç­‰ï¼‰</td></tr><tr><td>è·¯å¾„</td><td>å¿…é¡»æ˜¯é™æ€å­—ç¬¦ä¸²</td><td>å¯ä»¥æ˜¯åŠ¨æ€è¡¨è¾¾å¼</td></tr><tr><td>æ‰§è¡Œæ—¶æœº</td><td>Construction é˜¶æ®µ</td><td>è¿è¡Œæ—¶ï¼ˆEvaluation é˜¶æ®µï¼‰</td></tr><tr><td>Tree-shaking</td><td>âœ… æ”¯æŒ</td><td>âŒ ä¸æ”¯æŒ</td></tr><tr><td>æ¡ä»¶åŠ è½½</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr><tr><td>è¿”å›å€¼</td><td>ç›´æ¥ç»‘å®šå¯¼å‡ºå€¼</td><td>Promise</td></tr></tbody></table>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fproposal-dynamic-import%2F" target="_blank" title="https://tc39.es/proposal-dynamic-import/" ref="nofollow noopener noreferrer">TC39: import()</a></p>
</blockquote>
<h3 data-id="heading-24">é™æ€ç»“æ„</h3>
<p>ESM çš„ é™æ€<code>import/export</code> å£°æ˜å…·æœ‰é™æ€ç»“æ„ï¼Œåœ¨ä»£ç æ‰§è¡Œå‰å°±èƒ½ç¡®å®šæ¨¡å—ä¾èµ–å…³ç³»ã€‚è¿™ä½¿å¾—ç¼–è¯‘å™¨å’Œæ‰“åŒ…å·¥å…·èƒ½åœ¨ Construction é˜¶æ®µè¿›è¡Œ<strong>é™æ€åˆ†æ</strong>ï¼Œå¸¦æ¥è¯¸å¤šä¼˜åŒ–ã€‚</p>
<p><strong>1. Tree-shakingï¼ˆæ ‘æ‘‡ä¼˜åŒ–ï¼‰</strong></p>
<p>æ‰“åŒ…å·¥å…·èƒ½è¯†åˆ«æœªä½¿ç”¨çš„å¯¼å‡ºï¼Œç§»é™¤æ­»ä»£ç ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">return</span> a + b;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">return</span> a - b;
} <span class="hljs-comment">// æœªè¢«ä½¿ç”¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">return</span> a * b;
} <span class="hljs-comment">// æœªè¢«ä½¿ç”¨</span>

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">"./utils.js"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));

<span class="hljs-comment">// æ‰“åŒ…åï¼šsubtract å’Œ multiply è¢«ç§»é™¤</span>
</code></pre>
<p><strong>2. å¾ªç¯ä¾èµ–æ£€æµ‹</strong></p>
<p>æ„å»ºå·¥å…·èƒ½åœ¨ç¼–è¯‘æ—¶æ£€æµ‹å¾ªç¯ä¾èµ–ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// a.js</span>
<span class="hljs-keyword">import</span> { b } <span class="hljs-keyword">from</span> <span class="hljs-string">"./b.js"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;

<span class="hljs-comment">// b.js</span>
<span class="hljs-keyword">import</span> { a } <span class="hljs-keyword">from</span> <span class="hljs-string">"./a.js"</span>; <span class="hljs-comment">// å¾ªç¯ä¾èµ–</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> b = <span class="hljs-number">2</span>;

<span class="hljs-comment">// æ„å»ºå·¥å…·å¯åœ¨ç¼–è¯‘æ—¶å‘å‡ºè­¦å‘Š</span>
</code></pre>
<p><strong>3. å¯¼å‡ºéªŒè¯</strong></p>
<p>åœ¨ Instantiation é˜¶æ®µéªŒè¯æ‰€æœ‰å¯¼å…¥æ˜¯å¦æœ‰å¯¹åº”çš„å¯¼å‡ºã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// math.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">a, b</span>) =&gt; a + b;

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { add, subtract } <span class="hljs-keyword">from</span> <span class="hljs-string">"./math.js"</span>;
<span class="hljs-comment">// é”™è¯¯ï¼šInstantiation é˜¶æ®µæŠ¥é”™</span>
<span class="hljs-comment">// SyntaxError: The requested module './math.js' does not provide an export named 'subtract'</span>
</code></pre>
<h3 data-id="heading-25">å€¼å®æ—¶ç»‘å®šï¼Œä¸èƒ½åœ¨å¯¼å…¥åè¢«ä¿®æ”¹</h3>
<p>ESM çš„å¯¼å‡ºå’Œå¯¼å…¥å»ºç«‹<strong>å®æ—¶ç»‘å®šï¼ˆLive Bindingsï¼‰</strong>ï¼šimport å’Œ export æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä½ç½®ï¼Œå¯¼å‡ºæ¨¡å—ä¿®æ”¹å€¼æ—¶ï¼Œå¯¼å…¥æ¨¡å—èƒ½å®æ—¶çœ‹åˆ°å˜åŒ–ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// counter.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
  count++;
}

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { count, increment } <span class="hljs-keyword">from</span> <span class="hljs-string">"./counter.js"</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count); <span class="hljs-comment">// 0</span>
<span class="hljs-title function_">increment</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count); <span class="hljs-comment">// 1 - å®æ—¶çœ‹åˆ°å˜åŒ–</span>

<span class="hljs-comment">// âŒ å¯¼å…¥çš„ç»‘å®šæ˜¯åªè¯»çš„</span>
count = <span class="hljs-number">10</span>; <span class="hljs-comment">// TypeError: Assignment to constant variable</span>
</code></pre>
<p><strong>åŸç†</strong>ï¼šåœ¨ Instantiation é˜¶æ®µï¼Œ<code>count</code> åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä»½ï¼Œimport å’Œ export éƒ½æŒ‡å‘è¿™ä¸ªä½ç½®ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[counter.js: export count] --&gt;|æŒ‡å‘| C[å†…å­˜åœ°å€ 0x1234]
    B[main.js: import count] --&gt;|æŒ‡å‘| C
    D[counter.js: increment ä¿®æ”¹ count] --&gt;|ä¿®æ”¹| C
</code></pre>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fecma262%2F%23sec-module-environment-records" target="_blank" title="https://tc39.es/ecma262/#sec-module-environment-records" ref="nofollow noopener noreferrer">TC39: Module Environment Records</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fmodules.html%23cycles" target="_blank" title="https://nodejs.org/api/modules.html#cycles" ref="nofollow noopener noreferrer">Node.js: Modules: Cycles</a></p>
</blockquote>
<h3 data-id="heading-26">å¾ªç¯ä¾èµ–å¤„ç†</h3>
<p>ESM é€šè¿‡<strong>å®æ—¶ç»‘å®š</strong>å’Œ<strong>ä¸‰é˜¶æ®µåŠ è½½</strong>ä¼˜é›…åœ°å¤„ç†å¾ªç¯ä¾èµ–ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// a.js</span>
<span class="hljs-keyword">import</span> { b } <span class="hljs-keyword">from</span> <span class="hljs-string">"./b.js"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> a = <span class="hljs-string">"a"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"a.js:"</span>, b);

<span class="hljs-comment">// b.js</span>
<span class="hljs-keyword">import</span> { a } <span class="hljs-keyword">from</span> <span class="hljs-string">"./a.js"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> b = <span class="hljs-string">"b"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"b.js:"</span>, a); <span class="hljs-comment">// ReferenceError: Cannot access 'a' before initialization</span>

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"./a.js"</span>;
</code></pre>
<p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p>
<ol>
<li><strong>Construction é˜¶æ®µ</strong>ï¼šæ„å»ºæ¨¡å—å›¾ï¼Œ<code>main.js</code> â†’ <code>a.js</code> â†’ <code>b.js</code></li>
<li><strong>Instantiation é˜¶æ®µ</strong>ï¼š
<ul>
<li>ä¸º <code>a.js</code> çš„ <code>a</code> åœ¨å†…å­˜ä¸­åˆ†é…ç©ºé—´ï¼ˆæœªèµ‹å€¼ï¼‰</li>
<li>ä¸º <code>b.js</code> çš„ <code>b</code> åœ¨å†…å­˜ä¸­åˆ†é…ç©ºé—´ï¼ˆæœªèµ‹å€¼ï¼‰</li>
<li>å»ºç«‹å®æ—¶ç»‘å®šï¼š<code>a.js</code> çš„ import ç»‘å®šåˆ° <code>b.js</code> çš„ exportï¼Œåä¹‹äº¦ç„¶</li>
</ul>
</li>
<li><strong>Evaluation é˜¶æ®µ</strong>ï¼ˆæ·±åº¦ä¼˜å…ˆååºéå†ï¼‰ï¼š
<ul>
<li>å…ˆæ‰§è¡Œ <code>b.js</code>ï¼šæ­¤æ—¶ <code>a</code> è¿˜æœªèµ‹å€¼ï¼Œç›´æ¥æŠ¥é”™ <code>Cannot access 'a' before initialization</code></li>
</ul>
</li>
</ol>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>Instantiation é˜¶æ®µå·²å»ºç«‹æ‰€æœ‰ç»‘å®šå…³ç³»</li>
<li>Evaluation é˜¶æ®µåªæ˜¯å¡«å……å€¼</li>
<li>å®æ—¶ç»‘å®šï¼Œå¹¶ä¸”è¢«åˆå§‹åŒ–åï¼Œæ‰èƒ½è®¿é—®åˆ°æ­£ç¡®çš„å€¼</li>
</ul>
<h3 data-id="heading-27">æ”¯æŒ top-level await</h3>
<p>ESM æ”¯æŒåœ¨æ¨¡å—é¡¶å±‚ç›´æ¥ä½¿ç”¨ <code>await</code>ï¼Œæ— éœ€åŒ…è£¹åœ¨ async å‡½æ•°ä¸­ã€‚CJS æ¨¡å—è¢«åŒ…è£…åœ¨æ™®é€šå‡½æ•°ä¸­æ‰§è¡Œï¼Œä¸æ”¯æŒ top-level awaitã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// data.js</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"https://api.example.com/data"</span>);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { data } <span class="hljs-keyword">from</span> <span class="hljs-string">"./data.js"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data); <span class="hljs-comment">// ç­‰å¾… data.js å®Œæˆåæ‰§è¡Œ</span>
</code></pre>
<p><strong>æ‰§è¡Œæ—¶æœº</strong>ï¼š</p>
<ul>
<li>top-level await åœ¨ <strong>Evaluation é˜¶æ®µ</strong>æ‰§è¡Œ</li>
<li>å½“å‰æ¨¡å—ä¼šæš‚åœï¼Œç­‰å¾… Promise å®Œæˆ</li>
<li>ä¾èµ–å½“å‰æ¨¡å—çš„çˆ¶æ¨¡å—ä¹Ÿä¼šç­‰å¾…</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[main.js: import data.js] --&gt; B[Construction: æ„å»ºæ¨¡å—å›¾]
    B --&gt; C[Instantiation: å»ºç«‹ç»‘å®š]
    C --&gt; D[Evaluation: æ‰§è¡Œ data.js]
    D --&gt; E[data.js: await fetch...]
    E --&gt; F[æš‚åœ, ç­‰å¾… Promise å®Œæˆ]
    F --&gt; G[Promise å®Œæˆ, ç»§ç»­æ‰§è¡Œ]
    G --&gt; H[data.js å®Œæˆ]
    H --&gt; I[æ‰§è¡Œ main.js]
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. åŠ¨æ€åŠ è½½é…ç½®</span>
<span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">`./config.<span class="hljs-subst">${process.env.NODE_ENV}</span>.js`</span>);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> config;

<span class="hljs-comment">// 2. ç­‰å¾…æ•°æ®åº“è¿æ¥</span>
<span class="hljs-keyword">import</span> mongoose <span class="hljs-keyword">from</span> <span class="hljs-string">"mongoose"</span>;
<span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">connect</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_URL</span>);
<span class="hljs-keyword">export</span> { mongoose };

<span class="hljs-comment">// 3. æ¡ä»¶åŠ è½½ polyfill</span>
<span class="hljs-keyword">const</span> locale = navigator.<span class="hljs-property">language</span>;
<span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Intl</span>.<span class="hljs-property">PluralRules</span>) {
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">`https://cdn.example.com/polyfill/<span class="hljs-subst">${locale}</span>.js`</span>);
}
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âš ï¸ é˜»å¡æ•ˆåº”ï¼šæ‰€æœ‰ä¾èµ–æ­¤æ¨¡å—çš„æ¨¡å—éƒ½ä¼šç­‰å¾…</span>
<span class="hljs-comment">// slow-module.js</span>
<span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">5000</span>));
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> value = <span class="hljs-string">"done"</span>;

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { value } <span class="hljs-keyword">from</span> <span class="hljs-string">"./slow-module.js"</span>; <span class="hljs-comment">// ç­‰å¾… 5 ç§’</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value);

<span class="hljs-comment">// âš ï¸ é”™è¯¯å¤„ç†ï¼šæœªæ•è·çš„ Promise rejection ä¼šå¯¼è‡´æ¨¡å—åŠ è½½å¤±è´¥</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"https://invalid-url.com/data"</span>); <span class="hljs-comment">// æ•´ä¸ªæ¨¡å—åŠ è½½å¤±è´¥</span>
</code></pre>
<h2 data-id="heading-28">å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-29">ESM ç›¸æ¯” CJS æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</h3>
<p><strong>1. é™æ€åˆ†æï¼Œæ”¯æŒ Tree-shaking</strong></p>
<p>ESM çš„ <code>import/export</code> åœ¨ç¼–è¯‘æ—¶å°±èƒ½ç¡®å®šä¾èµ–å…³ç³»ï¼Œæ‰“åŒ…å·¥å…·å¯ä»¥ç§»é™¤æœªä½¿ç”¨çš„ä»£ç ï¼Œæ˜¾è‘—å‡å°æ‰“åŒ…ä½“ç§¯ã€‚CJS çš„ <code>require</code> æ˜¯è¿è¡Œæ—¶è°ƒç”¨ï¼Œæ— æ³•é™æ€åˆ†æã€‚</p>
<p><strong>2. åŸç”Ÿæ”¯æŒï¼Œæ— éœ€æ‰“åŒ…</strong></p>
<p>ESM æ˜¯ ECMAScript æ ‡å‡†ï¼Œæµè§ˆå™¨å’Œ Node.js åŸç”Ÿæ”¯æŒã€‚CJS éœ€è¦æ‰“åŒ…å·¥å…·ï¼ˆWebpackã€Browserifyï¼‰è½¬æ¢æ‰èƒ½åœ¨æµè§ˆå™¨è¿è¡Œã€‚</p>
<p><strong>3. å¼‚æ­¥åŠ è½½ï¼Œä¸é˜»å¡æ¸²æŸ“</strong></p>
<p>ESM åœ¨æµè§ˆå™¨ä¸­å¼‚æ­¥åŠ è½½ï¼Œä¸ä¼šé˜»å¡é¡µé¢æ¸²æŸ“ï¼ˆ<code>&lt;script type="module"&gt;</code> é»˜è®¤ deferï¼‰ã€‚CJS åŒæ­¥åŠ è½½ä¸é€‚åˆæµè§ˆå™¨ã€‚</p>
<p><strong>4. å®æ—¶ç»‘å®šï¼ŒåŠ¨æ€åæ˜ å˜åŒ–</strong></p>
<p>ESM çš„å¯¼å…¥å¯¼å‡ºæ˜¯å®æ—¶ç»‘å®šï¼Œå¯¼å‡ºæ¨¡å—ä¿®æ”¹å€¼æ—¶ï¼Œå¯¼å…¥æ¨¡å—èƒ½ç«‹å³çœ‹åˆ°å˜åŒ–ã€‚CJS æ˜¯å€¼æ‹·è´ï¼Œçœ‹ä¸åˆ°åç»­å˜åŒ–ã€‚</p>
<p><strong>5. æ”¯æŒ Top-level await</strong></p>
<p>ESM å¯ä»¥åœ¨æ¨¡å—é¡¶å±‚ç›´æ¥ä½¿ç”¨ <code>await</code>ï¼Œé€‚åˆå¼‚æ­¥åˆå§‹åŒ–åœºæ™¯ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€é…ç½®åŠ è½½ï¼‰ã€‚CJS ä¸æ”¯æŒã€‚</p>
<p><strong>6. æ›´å¥½çš„å¾ªç¯ä¾èµ–å¤„ç†</strong></p>
<p>ESM é€šè¿‡å®æ—¶ç»‘å®šå¤„ç†å¾ªç¯ä¾èµ–ï¼Œè™½ç„¶è®¿é—®æœªåˆå§‹åŒ–å˜é‡ä¼šæŠ¥é”™ï¼ˆTDZï¼‰ï¼Œä½†æ›´å®¹æ˜“å‘ç°é—®é¢˜ã€‚CJS è¿”å›æœªå®Œæˆçš„ exportsï¼Œå®¹æ˜“äº§ç”Ÿéš¾ä»¥è°ƒè¯•çš„ bugã€‚</p>
<p><strong>7. ç»Ÿä¸€çš„æ¨¡å—æ ‡å‡†</strong></p>
<p>ESM æ˜¯æµè§ˆå™¨å’Œ Node.js é€šç”¨çš„æ ‡å‡†ï¼ŒåŒä¸€å¥—ä»£ç å¯ä»¥è·¨å¹³å°è¿è¡Œï¼Œæ— éœ€ç»´æŠ¤ä¸¤å¥—æ¨¡å—ç³»ç»Ÿã€‚</p>
<h3 data-id="heading-30">åœ¨ Node.js ä¸­ CJS å’Œ ESM èƒ½å¦äº’ç›¸å¼•ç”¨ï¼Ÿ</h3>
<p><strong>ESM å¼•ç”¨ CJS</strong>ï¼šâœ… æ”¯æŒ</p>
<p>ESM å¯ä»¥é€šè¿‡ <code>import</code> å¼•ç”¨ CJS æ¨¡å—ï¼ŒNode.js ä¼šå°† <code>module.exports</code> ä½œä¸ºé»˜è®¤å¯¼å‡ºã€‚</p>
<p><strong>CJS å¼•ç”¨ ESM</strong>ï¼šâŒ ä¸æ”¯æŒåŒæ­¥å¼•ç”¨</p>
<p>CJS çš„ <code>require</code> æ˜¯åŒæ­¥çš„ï¼Œæ— æ³•åŠ è½½å¼‚æ­¥çš„ ESM æ¨¡å—ã€‚å¿…é¡»ä½¿ç”¨åŠ¨æ€ <code>import()</code> å‡½æ•°ï¼ˆè¿”å› Promiseï¼‰ã€‚</p>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fesm.html%23interoperability-with-CJS" target="_blank" title="https://nodejs.org/api/esm.html#interoperability-with-CJS" ref="nofollow noopener noreferrer">Node.js: Interoperability with CJS</a></p>
</blockquote>
<h3 data-id="heading-31">Node ä¸­å¦‚ä½•åˆ¤æ–­ä¸€ä¸ª .js æ–‡ä»¶æ˜¯ CJS è¿˜æ˜¯ ESMï¼Ÿ</h3>
<p>Node.js é€šè¿‡ä»¥ä¸‹è§„åˆ™åˆ¤æ–­ï¼š</p>
<ol>
<li><strong>æ–‡ä»¶æ‰©å±•å</strong>ï¼š<code>.mjs</code> æ–‡ä»¶æ˜¯ ESMï¼Œ<code>.cjs</code> æ–‡ä»¶æ˜¯ CJS</li>
<li><strong>package.json çš„ type å­—æ®µ</strong>ï¼š
<ul>
<li><code>"type": "module"</code>ï¼š<code>.js</code> æ–‡ä»¶è§†ä¸º ESM</li>
<li><code>"type": "CJS"</code> æˆ–æ—  type å­—æ®µï¼š<code>.js</code> æ–‡ä»¶è§†ä¸º CJSï¼ˆé»˜è®¤ï¼‰</li>
</ul>
</li>
<li><strong>æŸ¥æ‰¾æœ€è¿‘çš„ package.json</strong>ï¼šä»å½“å‰æ–‡ä»¶å‘ä¸ŠæŸ¥æ‰¾æœ€è¿‘çš„ package.json</li>
</ol>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fpackages.html%23determining-module-system" target="_blank" title="https://nodejs.org/api/packages.html#determining-module-system" ref="nofollow noopener noreferrer">Node.js: Determining module system</a></p>
</blockquote>
<h3 data-id="heading-32">ESM å’Œ CJS çš„å·®å¼‚</h3>


















































<table><thead><tr><th>ç»´åº¦</th><th>CJS</th><th>ESM</th></tr></thead><tbody><tr><td>å®šä½</td><td>Node.js è¿è¡Œæ—¶æ¨¡å—ç³»ç»Ÿ</td><td>ECMAScript è¯­è¨€æ ‡å‡†</td></tr><tr><td>åŠ è½½æ—¶æœº</td><td>è¿è¡Œæ—¶ï¼ˆåŒæ­¥ï¼‰</td><td>ç¼–è¯‘æ—¶é™æ€åˆ†æ</td></tr><tr><td>è¯­æ³•</td><td><code>require</code> / <code>module.exports</code></td><td><code>import</code> / <code>export</code></td></tr><tr><td>å€¼çš„å¯¼å‡º</td><td>å€¼æ‹·è´ï¼ˆå¿«ç…§ï¼‰</td><td>å®æ—¶ç»‘å®šï¼ˆå¼•ç”¨ï¼‰</td></tr><tr><td>å¾ªç¯ä¾èµ–</td><td>è¿”å›æœªå®Œæˆçš„ exports</td><td>é€šè¿‡å®æ—¶ç»‘å®šå¤„ç†ï¼Œè®¿é—®æœªåˆå§‹åŒ–ä¼šæŠ¥é”™</td></tr><tr><td>Top-level await</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr><tr><td>Tree-shaking</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr><tr><td>åŠ¨æ€å¯¼å…¥</td><td>âœ… åŸç”Ÿæ”¯æŒï¼ˆ<code>require</code> æœ¬èº«ï¼‰</td><td>éœ€ä½¿ç”¨ <code>import()</code> å‡½æ•°</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Fastlane + Appuploader çš„å·¥ç¨‹ç»„åˆï¼Œè‡ªåŠ¨åŒ–å‘å¸ƒä¸­çš„åˆ†å·¥]]></title>    <link>https://juejin.cn/post/7583910637957644307</link>    <guid>https://juejin.cn/post/7583910637957644307</guid>    <pubDate>2025-12-15T09:47:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910637957644307" data-draft-id="7583910637957627923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Fastlane + Appuploader çš„å·¥ç¨‹ç»„åˆï¼Œè‡ªåŠ¨åŒ–å‘å¸ƒä¸­çš„åˆ†å·¥"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T09:47:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼€å¿ƒå°±å¥½2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Fastlane + Appuploader çš„å·¥ç¨‹ç»„åˆï¼Œè‡ªåŠ¨åŒ–å‘å¸ƒä¸­çš„åˆ†å·¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼€å¿ƒå°±å¥½2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:47:13.000Z" title="Mon Dec 15 2025 09:47:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ iOS è‡ªåŠ¨åŒ–å‘å¸ƒä½“ç³»ä¸­ï¼ŒFastlane å‡ ä¹æ˜¯ç»•ä¸å¼€çš„å·¥å…·ã€‚å®ƒè¦†ç›–äº†ä»è¯ä¹¦ç®¡ç†ã€æ„å»ºã€ç‰ˆæœ¬å·å¤„ç†åˆ° TestFlight ä¸Šä¼ çš„å¤šä¸ªç¯èŠ‚ï¼Œæ˜¯è®¸å¤šå›¢é˜Ÿ CI/CD çš„æ ¸å¿ƒç»„ä»¶ã€‚ä½†åœ¨çœŸå®å·¥ç¨‹ä¸­ï¼ŒFastlane å¹¶ä¸èƒ½è¦†ç›–æ‰€æœ‰åœºæ™¯ï¼Œå°¤å…¶æ˜¯åœ¨ <strong>è·¨å¹³å°å›¢é˜Ÿã€é macOS ç¯å¢ƒã€ä¸Šä¼ é“¾è·¯è§£è€¦</strong> è¿™äº›éœ€æ±‚å‡ºç°ä¹‹åï¼Œå…¶å±€é™ä¹Ÿé€æ¸æ˜¾ç°ã€‚</p>
<p>æœ¬æ–‡ä»å·¥ç¨‹è§’åº¦è®¨è®ºä¸€ä¸ªå®è·µæ€§è¾ƒå¼ºçš„è¯é¢˜ï¼šFastlane ä¸ Appuploader å¦‚ä½•åœ¨åŒä¸€æ¡å‘å¸ƒæµç¨‹ä¸­ååŒå·¥ä½œã€‚</p>
<hr/>
<h2 data-id="heading-0"><strong>ä¸€ã€Fastlane åœ¨ iOS å‘å¸ƒæµç¨‹ä¸­çš„æ ¸å¿ƒå®šä½</strong></h2>
<p>ä»åŠŸèƒ½ä¸Šçœ‹ï¼ŒFastlane çš„èƒ½åŠ›ä¸»è¦é›†ä¸­åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>match</code> / <code>cert</code> / <code>sigh</code> ç®¡ç†è¯ä¹¦ä¸æè¿°æ–‡ä»¶</li>
<li>ä½¿ç”¨ <code>gym</code> æ„å»º IPA</li>
<li>ä½¿ç”¨ <code>deliver</code> / <code>pilot</code> ä¸Šä¼ è‡³ App Store Connect</li>
<li>è‡ªåŠ¨å¤„ç†ç‰ˆæœ¬å·ã€Build å·ã€å…ƒæ•°æ®</li>
</ul>
<p>åœ¨ <strong>çº¯ macOSã€çº¯ iOS å›¢é˜Ÿ</strong> ä¸­ï¼Œè¿™å¥—ä½“ç³»è¿è½¬è‰¯å¥½ã€‚ä½†åœ¨å·¥ç¨‹è§„æ¨¡æ‰©å¤§åï¼Œä»¥ä¸‹é—®é¢˜å¼€å§‹å‡ºç°ï¼š</p>
<ul>
<li>CI èŠ‚ç‚¹å¹¶éå…¨éƒ¨æ˜¯ macOS</li>
<li>Windows / Linux æˆå‘˜éœ€è¦å‚ä¸å‘å¸ƒæµç¨‹</li>
<li>ä¸Šä¼ æ­¥éª¤éœ€è¦ä¸æ„å»ºæ­¥éª¤è§£è€¦</li>
<li>Fastlane å¯¹ Transporter / altool ä¾èµ–è¾ƒæ·±</li>
<li>ä¸Šä¼ å¤±è´¥æ—¶è°ƒè¯•æˆæœ¬é«˜</li>
</ul>
<p>è¿™äº›é—®é¢˜å¹¶ä¸æ˜¯ Fastlane çš„ç¼ºé™·ï¼Œè€Œæ˜¯å®ƒçš„è®¾è®¡å‰æå†³å®šçš„ã€‚</p>
<hr/>
<h2 data-id="heading-1"><strong>äºŒã€Fastlane çš„å¤©ç„¶å‰æï¼šmacOS æ˜¯ä¸­å¿ƒèŠ‚ç‚¹</strong></h2>
<p>éœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼š</p>
<blockquote>
<p><strong>Fastlane æ˜¯ä»¥ macOS ä¸ºä¸­å¿ƒè®¾è®¡çš„è‡ªåŠ¨åŒ–å·¥å…·ã€‚</strong></p>
</blockquote>
<p>å…¶æ ¸å¿ƒä¾èµ–åŒ…æ‹¬ï¼š</p>
<ul>
<li>Xcode</li>
<li>Xcode Command Line Tools</li>
<li>Transporter / altool</li>
<li>macOS Keychain</li>
</ul>
<p>å› æ­¤ï¼Œå½“ä½ çš„æµç¨‹å‡ºç°ä»¥ä¸‹æƒ…å†µæ—¶ï¼ŒFastlane å°±ä¼šå¼€å§‹æ˜¾å¾—â€œç¬¨é‡â€ï¼š</p>
<ul>
<li>æ„å»ºåœ¨ macOSï¼Œä½†ä¸Šä¼ å¸Œæœ›åœ¨ Linux/Windows æ‰§è¡Œ</li>
<li>ä¸Šä¼ éœ€è¦è„šæœ¬åŒ–é‡è¯•ï¼Œä½†ä¸æƒ³å†æ‹‰èµ· Fastlane ç¯å¢ƒ</li>
<li>å¸Œæœ›æŠŠ IPA å½“ä½œåˆ¶å“ï¼Œåœ¨ä¸åŒç³»ç»Ÿé—´æµè½¬</li>
</ul>
<p>è¿™æ—¶ï¼Œå¾ˆå¤šå›¢é˜Ÿä¼šå¼€å§‹è€ƒè™‘ <strong>æ‹†åˆ† Fastlane çš„èŒè´£</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-2"><strong>ä¸‰ã€å°† Fastlane çš„èŒè´£é™å®šåœ¨â€œæ„å»ºé˜¶æ®µâ€</strong></h2>
<p>åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œä¸€ä¸ªæ›´ç¨³å®šçš„åšæ³•æ˜¯ï¼š</p>
<ul>
<li><strong>Fastlane åªè´Ÿè´£æ„å»ºä¸æ‰“åŒ…</strong></li>
<li><strong>ä¸Šä¼ ä¸æ ¡éªŒäº¤ç”±æ›´è½»é‡ã€è·¨å¹³å°çš„å·¥å…·å®Œæˆ</strong></li>
</ul>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªå…¸å‹çš„æ‹†åˆ†æ–¹å¼æ˜¯ï¼š</p>
<ol>
<li>Fastlane ä½¿ç”¨ <code>gym</code> æ„å»º IPA</li>
<li>IPA ä½œä¸ºæ„å»ºäº§ç‰©å­˜å‚¨</li>
<li>åç»­æ­¥éª¤ä¸å†ä¾èµ– Fastlane ç¯å¢ƒ</li>
</ol>
<p>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå¼•å…¥ <strong>Appuploader</strong> ä½œä¸ºè¡¥å……å·¥å…·å°±å…·å¤‡ç°å®æ„ä¹‰ã€‚</p>
<hr/>
<h2 data-id="heading-3"><strong>å››ã€Appuploader åœ¨ Fastlane ä½“ç³»ä¸­çš„è¡¥å……è§’è‰²</strong></h2>
<p>åœ¨ä¸ Fastlane æ­é…ä½¿ç”¨æ—¶ï¼Œ<strong>å¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰</strong> é€šå¸¸ä¸æ›¿ä»£ Fastlaneï¼Œè€Œæ˜¯æ‰¿æ‹…ä»¥ä¸‹å‡ ç±»å·¥ä½œï¼š</p>
<hr/>
<h3 data-id="heading-4"><strong>1. è·¨å¹³å°ä¸Šä¼  IPAï¼Œæ›¿ä»£ deliver / pilot çš„æ‰§è¡Œç¯å¢ƒ</strong></h3>
<p>Fastlane çš„ä¸Šä¼ åŠ¨ä½œï¼š</p>
<ul>
<li>ä¾èµ– macOS</li>
<li>ä¾èµ– Transporter</li>
<li>å¤±è´¥æ—¶é‡è·‘æˆæœ¬è¾ƒé«˜</li>
</ul>
<p>è€Œ Appuploader æä¾›çš„ä¸Šä¼ æ–¹å¼å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ”¯æŒ <strong>Windows / Linux / macOS</strong></li>
<li>ä¸ä¾èµ– Xcode</li>
<li>å¯é€šè¿‡å‘½ä»¤è¡Œæ‰§è¡Œ</li>
<li>æ˜“äºè„šæœ¬åŒ–å’Œé‡è¯•</li>
</ul>
<p>ç¤ºä¾‹ï¼ˆä½œä¸º Fastlane æ„å»ºåçš„ç‹¬ç«‹æ­¥éª¤ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u appleid@example.com -p xxxx-xxxx -c 1 -f build.ipa
</code></pre>
<p>è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>Fastlane ä¸å†æ˜¯â€œå”¯ä¸€ä¸Šä¼ å…¥å£â€</li>
<li>ä¸Šä¼ æ­¥éª¤å¯ä»¥æ”¾åˆ°ä»»æ„ç³»ç»Ÿæ‰§è¡Œ</li>
<li>CI ä¸­å¯ä»¥æ›´çµæ´»åœ°æ‹†åˆ†é˜¶æ®µ</li>
</ul>
<p>GUIç•Œé¢ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d6a24042671440a91e8e03bf72e67ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766396832&amp;x-signature=IlxQyJS1QLmqd8gnhg%2BSwVj1eJU%3D" alt="ipaä¸Šä¼ " loading="lazy"/></p>
<hr/>
<h3 data-id="heading-5"><strong>2. æ„å»ºå IPA çš„å·¥ç¨‹çº§æ£€æŸ¥</strong></h3>
<p>Fastlane å¹¶ä¸ä¼šéªŒè¯ IPA æ˜¯å¦â€œé€‚åˆä¸Šæ¶â€ï¼Œå®ƒåªä¿è¯æ„å»ºæˆåŠŸã€‚</p>
<p>åœ¨å®é™…æµç¨‹ä¸­ï¼ŒAppuploader å¸¸è¢«ç”¨äºï¼š</p>
<ul>
<li>æŸ¥çœ‹ IPA å†…çš„ Info.plist</li>
<li>ç¡®è®¤ Bundle ID</li>
<li>æ ¡éªŒæè¿°æ–‡ä»¶ç±»å‹</li>
<li>æ£€æŸ¥æ˜¯å¦åŒ…å« Assets.car</li>
</ul>
<p>è¿™äº›æ£€æŸ¥å¯ä»¥åœ¨ <strong>é macOS</strong> ç¯å¢ƒæ‰§è¡Œï¼Œé€‚åˆæ„å»ºå®Œæˆåçš„è´¨é‡å…³å¡ã€‚</p>
<hr/>
<h3 data-id="heading-6"><strong>3. è¯ä¹¦ä¸æè¿°æ–‡ä»¶çš„å¯è§†åŒ–è¡¥å……</strong></h3>
<p>Fastlane çš„è¯ä¹¦ç®¡ç†æ˜¯â€œè‡ªåŠ¨åŒ–ä¼˜å…ˆâ€çš„ï¼Œä½†ä¿¡æ¯å¹¶ä¸ç›´è§‚ã€‚</p>
<p>åœ¨æ’æŸ¥é—®é¢˜æ—¶ï¼Œæˆ‘é€šå¸¸ä¼šï¼š</p>
<ul>
<li>ä½¿ç”¨ Appuploader æŸ¥çœ‹ mobileprovision å†…å®¹</li>
<li>æ ¡éªŒè¯ä¹¦æŒ‡çº¹æ˜¯å¦ä¸€è‡´</li>
<li>ç¡®è®¤æè¿°æ–‡ä»¶æ˜¯å¦ä¸ºå‘å¸ƒç±»å‹</li>
</ul>
<p>è¿™åœ¨ä»¥ä¸‹åœºæ™¯å°¤å…¶é‡è¦ï¼š</p>
<ul>
<li>Fastlane æ„å»ºæˆåŠŸï¼Œä½†ä¸Šä¼ å¤±è´¥</li>
<li>CI æ›´æ¢èŠ‚ç‚¹åç­¾åå¼‚å¸¸</li>
<li>å¤šè¯ä¹¦å¹¶å­˜ï¼Œéš¾ä»¥ç¡®è®¤å½“å‰ä½¿ç”¨çš„æ˜¯å“ªä¸€ä»½
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b74e68acef84103bda6b72a1d96e892~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766396832&amp;x-signature=d24PuFWZf8GwUD0HscJHFjcdCog%3D" alt="æŸ¥çœ‹æ–‡ä»¶" loading="lazy"/></li>
</ul>
<hr/>
<h2 data-id="heading-7"><strong>äº”ã€Fastlane + Appuploader çš„ä¸€ä¸ªå®é™…æµç¨‹ç¤ºä¾‹</strong></h2>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåœ¨çœŸå®é¡¹ç›®ä¸­å¯è¡Œçš„ç»„åˆæµç¨‹ï¼š</p>
<h3 data-id="heading-8"><strong>é˜¶æ®µä¸€ï¼šæ„å»ºï¼ˆmacOSï¼‰</strong></h3>
<ul>
<li>Fastlane <code>gym</code> æ„å»º IPA</li>
<li>ç”Ÿæˆæ„å»ºæ—¥å¿—ä¸äº§ç‰©</li>
</ul>
<h3 data-id="heading-9"><strong>é˜¶æ®µäºŒï¼šåˆ¶å“å­˜å‚¨</strong></h3>
<ul>
<li>IPA ä¸Šä¼ è‡³åˆ¶å“åº“æˆ–å…±äº«å­˜å‚¨</li>
</ul>
<h3 data-id="heading-10"><strong>é˜¶æ®µä¸‰ï¼šæ ¡éªŒï¼ˆä»»æ„ç³»ç»Ÿï¼‰</strong></h3>
<ul>
<li>ä½¿ç”¨ Appuploader æŸ¥çœ‹ IPA å†…å®¹</li>
<li>æ ¡éªŒ Bundle ID / profile / èµ„æºç»“æ„</li>
</ul>
<h3 data-id="heading-11"><strong>é˜¶æ®µå››ï¼šä¸Šä¼ ï¼ˆWindows / Linux / macOSï¼‰</strong></h3>
<ul>
<li>ä½¿ç”¨ Appuploader CLI ä¸Šä¼  IPA</li>
</ul>
<h3 data-id="heading-12"><strong>é˜¶æ®µäº”ï¼šå®¡æ ¸ä¸å‘å¸ƒ</strong></h3>
<ul>
<li>App Store Connect Web æ“ä½œ</li>
</ul>
<p>è¿™ç§æµç¨‹çš„ä¼˜åŠ¿åœ¨äºï¼š</p>
<ul>
<li>Fastlane ä¸å†æ˜¯å•ç‚¹ä¾èµ–</li>
<li>ä¸Šä¼ æ­¥éª¤æ›´å®¹æ˜“å¤±è´¥é‡è¯•</li>
<li>Windows / Linux æˆå‘˜å¯å‚ä¸å‘å¸ƒ</li>
<li>CI æµç¨‹æ›´æ˜“ç»´æŠ¤</li>
</ul>
<hr/>
<h2 data-id="heading-13"><strong>å…­ã€ä»€ä¹ˆæ—¶å€™ä¸éœ€è¦ Fastlane + Appuploader ç»„åˆï¼Ÿ</strong></h2>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™ç§ç»„åˆå¹¶éâ€œå¿…é€‰æ–¹æ¡ˆâ€ã€‚</p>
<p>ä»¥ä¸‹åœºæ™¯ä¸­ï¼Œ<strong>å•ç‹¬ä½¿ç”¨ Fastlane å·²è¶³å¤Ÿ</strong>ï¼š</p>
<ul>
<li>å°å‹å›¢é˜Ÿ</li>
<li>å…¨å‘˜ macOS</li>
<li>æ—  CI æˆ– CI ç®€å•</li>
<li>ä¸éœ€è¦æ‹†åˆ†æ„å»ºä¸ä¸Šä¼ </li>
</ul>
<p>è€Œå½“ä½ é‡åˆ°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œç»„åˆæ–¹æ¡ˆçš„ä»·å€¼æ‰ä¼šä½“ç°ï¼š</p>
<ul>
<li>CI æ¶æ„å¤æ‚</li>
<li>æ„å»ºä¸ä¸Šä¼ éœ€è¦è§£è€¦</li>
<li>å‘å¸ƒèŠ‚ç‚¹ä¸å›ºå®š</li>
<li>å¤šç³»ç»Ÿåä½œ</li>
<li>å¯¹ä¸Šä¼ ç¨³å®šæ€§è¦æ±‚è¾ƒé«˜</li>
</ul>
<hr/>
<p>Fastlane æ˜¯ä¸€å¥—å¼ºå¤§çš„ iOS è‡ªåŠ¨åŒ–å·¥å…·ï¼Œä½†å®ƒå¹¶ä¸æ˜¯å‘å¸ƒé“¾è·¯ä¸­å”¯ä¸€éœ€è¦å­˜åœ¨çš„è§’è‰²ã€‚
åœ¨ç°ä»£å·¥ç¨‹ä½“ç³»ä¸­ï¼ŒæŠŠ Fastlane ä¸“æ³¨åœ¨å®ƒæœ€æ“…é•¿çš„éƒ¨åˆ†â€”â€”<strong>æ„å»ºä¸é…ç½®è‡ªåŠ¨åŒ–</strong>ï¼Œå†ç”¨ Appuploader è·¨å¹³å°ä¸Šä¼ ã€IPA æ ¡éªŒä¸è¯ä¹¦å¯è§†åŒ–è¿™äº›èƒ½åŠ›ï¼Œå¾€å¾€èƒ½è®©æ•´ä¸ªå‘å¸ƒæµç¨‹æ›´æ¸…æ™°ã€æ›´ç¨³å®šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>