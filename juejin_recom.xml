<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[å‰ç«¯æ§åˆ¶æ‰¹é‡è¯·æ±‚å¹¶å‘]]></title>    <link>https://juejin.cn/post/7577378514402197539</link>    <guid>https://juejin.cn/post/7577378514402197539</guid>    <pubDate>2025-11-28T08:35:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577378514402197539" data-draft-id="7576538234273562634" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯æ§åˆ¶æ‰¹é‡è¯·æ±‚å¹¶å‘"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-28T08:35:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Nayana"/> <meta itemprop="url" content="https://juejin.cn/user/1679709498509534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯æ§åˆ¶æ‰¹é‡è¯·æ±‚å¹¶å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1679709498509534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Nayana
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T08:35:00.000Z" title="Fri Nov 28 2025 08:35:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"ğŸ‹"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"ğŸ“"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"ğŸ‘"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"ğŸ‰"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"ğŸ’"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘å‡†å¤‡åšå¤§æ–‡ä»¶ä¸Šä¼ çš„ä¸šåŠ¡ï¼Œå°±è”æƒ³åˆ°å‰æ®µæ—¶é—´å¾ˆç«çš„é¢è¯•é¢˜ğŸ¤¦â€â™‚ï¸ <code>å‡å¦‚æœ‰100æ¡è¯·æ±‚ï¼Œå‰ç«¯å¦‚ä½•æ§åˆ¶å¹¶å‘</code>ã€‚å› æ­¤åœ¨ç½‘ä¸Šçœ‹äº†ä¸€äº›ä¼˜åŒ–ç›¸å…³æ€§èƒ½çš„æ–¹æ¡ˆï¼Œç®€å•è®°å½•ä¸€ä¸‹</p>
<h4 data-id="heading-0">ä¸åšå¹¶å‘</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-title function_">upload</span>(<span class="hljs-params">Chunks</span>) {
<span class="hljs-keyword">let</span> queue = [...chunks];
 <span class="hljs-keyword">while</span> (i&lt;queue.<span class="hljs-property">length</span>) {
       <span class="hljs-comment">//æ­¤æ–¹æ³•æ˜¯è‡ªå®šä¹‰çš„ä¸Šä¼ å¼‚æ­¥æ–¹æ³•ä¸èµ˜è¿°</span>
	<span class="hljs-keyword">let</span> uploadRes = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">uploadFetch</span>(queue[i])
        <span class="hljs-keyword">if</span>(uploadRes){
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æˆåŠŸ'</span>ï¼‰
        }<span class="hljs-keyword">else</span>{
        <span class="hljs-comment">// å¯å†™å¼‚å¸¸ å†é‡è¯•</span>
        <span class="hljs-comment">//é‡è¯•ä¼˜åŒ–å…ˆä¸å†™  queue.push(queue[i])</span>
        }
        i++;
     }			
  },

</code></pre>
<p><strong>å±€é™</strong>ï¼š</p>
<ul>
<li>èµ„æºåˆ©ç”¨ç‡å·®ï¼Œå¯¹äºæ–‡ä»¶ç‰‡æ®µå¤šçš„æ—¶å€™å…¨éƒ¨æ¥å£æˆåŠŸç­‰å¾…é•¿æ—¶é—´ã€‚</li>
</ul>
<h4 data-id="heading-1">promnise.allåˆ†ç»„å¹¶å‘</h4>
<p>å°†è¯·æ±‚æ•°ç»„å‡åˆ†ä¸ºå¤šä¸ªå°æ•°ç»„ï¼Œæ¯æ¬¡æœ€å¤šåªå¼€å¯<code>concurrency</code>ä¸ªå¹¶å‘è¯·æ±‚ï¼Œä»¥æ­¤æ¥æ§åˆ¶å¹¶å‘æ•°é‡ã€‚æ¯å½“ä¸€ç»„è¯·æ±‚å®Œæˆåå†å‘é€æ–°çš„ä¸€æ‰¹è¯·æ±‚ï¼Œå¯ä»¥å®ç°å¯¹å¼‚æ­¥ä»»åŠ¡çš„å¹¶å‘æ§åˆ¶ã€‚</p>
<pre><code class="hljs language-js" lang="js">        <span class="hljs-comment">//concurrency å‚æ•°ä¸ºå¹¶å‘æ•°é‡</span>
      **æµè§ˆå™¨å¹¶å‘é™åˆ¶æ˜¯æŒ‡æµè§ˆå™¨å¯¹åŒä¸€åŸŸååŒæ—¶å‘èµ·çš„<span class="hljs-variable constant_">HTTP</span>è¯·æ±‚æ•°é‡çš„ä¸Šé™**â€Œï¼Œé€šå¸¸é™åˆ¶åœ¨<span class="hljs-number">6</span>-<span class="hljs-number">8</span>ä¸ªä¹‹é—´ **
        <span class="hljs-comment">//Chrome/Firefoxï¼šé»˜è®¤6ä¸ª å‡å¦‚é¢„ç•™ä¸€ä¸ªç©ºé—²ä½çš„è¯concurrencyè®¾ç½®ä¸º5 </span>
	<span class="hljs-keyword">async</span> <span class="hljs-title function_">concurrencyUpload</span>(<span class="hljs-params">chunks,concurrency</span>) {
	<span class="hljs-keyword">let</span> queue = [...chunks];
	<span class="hljs-keyword">while</span> (queue.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
	<span class="hljs-keyword">const</span> currentChunks = queue.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, concurrency);
	 <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
	      currentChunks.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> chunk =&gt; {
	      <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">//æ­¤æ–¹æ³•æ˜¯è‡ªå®šä¹‰çš„ä¸Šä¼ å¼‚æ­¥æ–¹æ³•</span>
		<span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">uploadFetch</span>(chunk);
		} <span class="hljs-keyword">catch</span> (err) {
		<span class="hljs-comment">// é‡è¯•ï¼šå°†åˆ†ç‰‡é‡æ–°åŠ å…¥é˜Ÿåˆ—</span>
                <span class="hljs-comment">//å¯ä¼˜åŒ–é‡è¯•é€»è¾‘ æ§åˆ¶å•ä»»åŠ¡é‡è¯•æ¬¡æ•°</span>
		<span class="hljs-comment">// queue.push(chunk);</span>
		}
		})
		).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å‡ºé”™:'</span>, err));
		}
		}
</code></pre>
<p><strong>å±€é™</strong>ï¼š</p>
<ul>
<li>å½“å‰æ‰¹æ¬¡è¯·æ±‚å…¨éƒ¨å®Œæˆåæ‰ä¼šç»§ç»­ä¸‹ä¸€æ‰¹æ¬¡ï¼Œå¯èƒ½å­˜åœ¨ç©ºé—²ä½ã€‚</li>
<li>å¯èƒ½è¿”å›æ— åºçš„ç»“æœã€‚</li>
<li>æœ‰ä¸€ä¸ªè¯·æ±‚å¤±è´¥äº†ï¼Œè¿™ä¸ªÂ <code>Promise.all</code>å°±å¤±è´¥äº†ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚</li>
</ul>
<h4 data-id="heading-2">ä½¿ç”¨é˜Ÿåˆ—</h4>
<p>å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—æ¥æ‰‹åŠ¨ç®¡ç†å¹¶å‘ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥ç®¡ç†å¹¶å‘è¯·æ±‚çš„å‘é€ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestQueue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">maxConcurrent</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxConcurrent</span> = maxConcurrent;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">running</span> = <span class="hljs-number">0</span>;
  }

  <span class="hljs-title function_">enqueue</span>(<span class="hljs-params">promiseFn</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>.<span class="hljs-title function_">push</span>(promiseFn);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">processQueue</span>();
    });
  }

  <span class="hljs-title function_">processQueue</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">while</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">running</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxConcurrent</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">const</span>  promiseFn = <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>.<span class="hljs-title function_">shift</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">running</span>++;
      <span class="hljs-title function_">promiseFn</span>()
        .<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span>{
        <span class="hljs-comment">//console.log('å•ä»»åŠ¡è¿”å›æˆåŠŸ'ï¼‰</span>
        })
        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">()=&gt;</span>{
        <span class="hljs-comment">// é‡è¯•ï¼šå°†ä¸Šä¼ ä»»åŠ¡é‡æ–°åŠ å…¥é˜Ÿåˆ—</span>
         <span class="hljs-comment">//å¯ä¼˜åŒ–é‡è¯•é€»è¾‘ æ§åˆ¶å•ä»»åŠ¡é‡è¯•æ¬¡æ•°</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>.<span class="hljs-title function_">push</span>(promiseFn)
        })
        .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">running</span>--;
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">processQueue</span>(); <span class="hljs-comment">// Process the next item in the queue</span>
        });
    }
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestQueue</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// æœ€å¤§å¹¶å‘5ä¸ªè¯·æ±‚</span>

<span class="hljs-comment">// è¯·æ±‚å‡½æ•° uploadFetch å·²ç»æ˜¯ä¸€ä¸ªpromiseæ–¹æ³•</span>
chunks.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">chunk</span>=&gt;</span>{queue.<span class="hljs-title function_">enqueue</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">uploadFetch</span>(chunk))})
</code></pre>
<h4 data-id="heading-3">ç”¨ç¬¬ä¸‰æ–¹åº“ <code>p-limit</code></h4>
<h6 data-id="heading-4">å®‰è£…ä¾èµ–</h6>
<pre><code class="hljs language-js" lang="js">npm install p-limit
</code></pre>
<h6 data-id="heading-5">jså®ç°</h6>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> pLimit form <span class="hljs-string">'p-limit'</span>;

<span class="hljs-keyword">const</span> limit = <span class="hljs-title function_">pLimit</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// é™åˆ¶å¹¶å‘æ•°ä¸º2</span>
<span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(chunks.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> <span class="hljs-title function_">limit</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">uploadFetch</span>(chunk))));

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯é«˜æ‰‹è¿›é˜¶ï¼šä»åä¸‡åˆ°åƒä¸‡ï¼Œæˆ‘çš„æ€§èƒ½ä¼˜åŒ–ç»ˆææŒ‡å—ï¼ˆå®æˆ˜ç¯‡ï¼‰]]></title>    <link>https://juejin.cn/post/7577461079598301203</link>    <guid>https://juejin.cn/post/7577461079598301203</guid>    <pubDate>2025-11-28T08:55:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577461079598301203" data-draft-id="7577574644694876196" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯é«˜æ‰‹è¿›é˜¶ï¼šä»åä¸‡åˆ°åƒä¸‡ï¼Œæˆ‘çš„æ€§èƒ½ä¼˜åŒ–ç»ˆææŒ‡å—ï¼ˆå®æˆ˜ç¯‡ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-28T08:55:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ssjlincgavw"/> <meta itemprop="url" content="https://juejin.cn/user/4126890557181043"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯é«˜æ‰‹è¿›é˜¶ï¼šä»åä¸‡åˆ°åƒä¸‡ï¼Œæˆ‘çš„æ€§èƒ½ä¼˜åŒ–ç»ˆææŒ‡å—ï¼ˆå®æˆ˜ç¯‡ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4126890557181043/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ssjlincgavw
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T08:55:11.000Z" title="Fri Nov 28 2025 08:55:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ€§èƒ½ä¼˜åŒ–ï¼Œä¸€ä¸ªè€ç”Ÿå¸¸è°ˆå´åˆå¸¸è°ˆå¸¸æ–°çš„è¯é¢˜ã€‚å®ƒä¸ä»…æ˜¯æŠ€æœ¯çš„ä½“ç°ï¼Œæ›´æ˜¯ä¸€ç§ç”¨æˆ·ä½“éªŒè‡³ä¸Šçš„äº§å“æ€ç»´ã€‚å¾ˆå¤šåˆå­¦è€…è§‰å¾—æ€§èƒ½ä¼˜åŒ–å°±æ˜¯â€œå‡å°‘HTTPè¯·æ±‚â€ã€â€œå‹ç¼©å›¾ç‰‡â€ï¼Œä½†è¿™åªæ˜¯å†°å±±ä¸€è§’ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥æ€å¼€è¿™åº§å†°å±±ï¼Œä»å®è§‚åˆ°å¾®è§‚ï¼Œæ„å»ºä¸€å¥—å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–ä½“ç³»ã€‚</p>
<h4 data-id="heading-0"><strong>ä¸€ã€ æ ¸å¿ƒæŒ‡æ ‡ï¼šæˆ‘ä»¬åˆ°åº•åœ¨ä¼˜åŒ–ä»€ä¹ˆï¼Ÿ</strong></h4>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»æ˜ç¡®ç›®æ ‡ã€‚ç°ä»£å‰ç«¯æ€§èƒ½çš„æ ¸å¿ƒæ˜¯Â <strong>Web Vitals</strong>ï¼Œè¿™æ˜¯è°·æ­Œæå‡ºçš„ä¸€å¥—å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼š</p>
<ol>
<li>
<p><strong>LCPï¼šæœ€å¤§å†…å®¹ç»˜åˆ¶</strong></p>
<ul>
<li><strong>ç›®æ ‡ï¼š</strong> Â &lt; 2.5ç§’</li>
<li><strong>æ„ä¹‰ï¼š</strong> Â è¡¡é‡é¡µé¢çš„ä¸»è¦å†…å®¹åŠ è½½é€Ÿåº¦ã€‚æ…¢ï¼Ÿç”¨æˆ·ä¼šè§‰å¾—â€œè¿™ä¸ªç½‘ç«™å¡ä½äº†â€ã€‚</li>
</ul>
</li>
<li>
<p><strong>FIDï¼šé¦–æ¬¡è¾“å…¥å»¶è¿Ÿ</strong></p>
<ul>
<li><strong>ç›®æ ‡ï¼š</strong> Â &lt; 100æ¯«ç§’</li>
<li><strong>æ„ä¹‰ï¼š</strong> Â è¡¡é‡é¡µé¢çš„å¯äº¤äº’æ€§ã€‚ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®æ²¡ååº”ï¼Ÿè¿™å°±æ˜¯FIDå¤ªå·®ã€‚</li>
</ul>
</li>
<li>
<p><strong>CLSï¼šç´¯ç§¯å¸ƒå±€åç§»</strong></p>
<ul>
<li><strong>ç›®æ ‡ï¼š</strong> Â &lt; 0.1</li>
<li><strong>æ„ä¹‰ï¼š</strong> Â è¡¡é‡é¡µé¢çš„è§†è§‰ç¨³å®šæ€§ã€‚çªç„¶å¼¹å‡ºçš„å›¾ç‰‡æˆ–å¹¿å‘ŠæŠŠé˜…è¯»ä¸­çš„æŒ‰é’®æŒ¤èµ°äº†ï¼Ÿè¿™å°±æ˜¯CLSé—®é¢˜ã€‚</li>
</ul>
</li>
</ol>
<p>æˆ‘ä»¬çš„æ‰€æœ‰ä¼˜åŒ–ï¼Œéƒ½åº”è¯¥å›´ç»•ç€æå‡è¿™å‡ é¡¹æ ¸å¿ƒæŒ‡æ ‡å±•å¼€ã€‚</p>
<h4 data-id="heading-1"><strong>äºŒã€ ç½‘ç»œå±‚ä¼˜åŒ–ï¼šé€Ÿåº¦çš„â€œç¬¬ä¸€å…¬é‡Œâ€</strong></h4>
<p>80%çš„æ€§èƒ½é—®é¢˜å‡ºåœ¨ç½‘ç»œå±‚é¢ã€‚</p>
<p><strong>1. æ‹¥æŠ±ç°ä»£æ„å»ºå·¥å…·ï¼šVite &gt; Webpack</strong><br/>
ä¸ºä»€ä¹ˆä½ çš„Â <code>npm run dev</code>Â è¦ç­‰åŠå¤©ï¼Ÿä¸ºä»€ä¹ˆçƒ­æ›´æ–°é‚£ä¹ˆæ…¢ï¼Ÿæ˜¯æ—¶å€™äº†è§£ä¸€ä¸‹Â <strong>Vite</strong>Â äº†ã€‚å®ƒåˆ©ç”¨æµè§ˆå™¨åŸç”Ÿ ES æ¨¡å—ï¼Œå®ç°äº†é—ªç”µèˆ¬çš„å†·å¯åŠ¨å’Œç¬é—´çƒ­æ›´æ–°ã€‚å¯¹äºå¤§å‹é¡¹ç›®ï¼Œå¼€å‘ä½“éªŒçš„æå‡æ˜¯é¢ è¦†æ€§çš„ã€‚</p>
<p>javascript</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// ä½ çš„ vite.config.js</span>
import { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
export <span class="hljs-keyword">default</span> <span class="hljs-title function_ invoke__">defineConfig</span>({
  <span class="hljs-attr">build</span>: {
    // æ„å»ºäº§ç‰©æ›´å°ï¼ŒåŠ è½½æ›´å¿«
    <span class="hljs-attr">minify</span>: <span class="hljs-string">'esbuild'</span>,
    // ä»£ç åˆ†å‰²ç­–ç•¥
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">manualChunks</span>: {
          <span class="hljs-attr">vendor</span>: [<span class="hljs-string">'react'</span>, <span class="hljs-string">'react-dom'</span>],
          <span class="hljs-attr">utils</span>: [<span class="hljs-string">'lodash-es'</span>, <span class="hljs-string">'dayjs'</span>]
        }
      }
    }
  }
})
</code></pre>
<p><strong>2. æè‡´çš„èµ„æºå‹ç¼©ä¸åˆ†å‘</strong></p>
<ul>
<li>
<p><strong>å›¾ç‰‡ä¼˜åŒ–æ˜¯é‡ç¾åŒºï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ç°ä»£çš„Â <strong>WebP/AVIF</strong>Â æ ¼å¼ï¼Œä½“ç§¯æ¯” PNG/JPG å° 30%-70%ã€‚</li>
<li>ä½¿ç”¨Â <code>sharp</code>Â åº“åœ¨æ„å»ºæ—¶è‡ªåŠ¨å‹ç¼©å›¾ç‰‡ã€‚</li>
<li>å®ç°å“åº”å¼å›¾ç‰‡ï¼š<code>&lt;picture&gt;</code>Â å…ƒç´ å’ŒÂ <code>srcset</code>Â å±æ€§ï¼Œä¸ºä¸åŒè®¾å¤‡æä¾›æœ€åˆé€‚çš„å›¾ç‰‡å°ºå¯¸ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¼€å¯ Gzip/Brotli å‹ç¼©ï¼š</strong> Â åœ¨æœåŠ¡å™¨ï¼ˆå¦‚ Nginxï¼‰ä¸Šå¼€å¯ Brotli å‹ç¼©ï¼Œå‹ç¼©ç‡æ¯” Gzip æ›´é«˜ã€‚</p>
</li>
<li>
<p><strong>åˆ©ç”¨ HTTP/2 å’Œ CDNï¼š</strong> Â HTTP/2 çš„å¤šè·¯å¤ç”¨å½»åº•è§£å†³äº† HTTP/1.1 çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚é…åˆå…¨çƒåˆ†å¸ƒçš„ CDNï¼Œè®©ç”¨æˆ·ä»æœ€è¿‘çš„èŠ‚ç‚¹è·å–èµ„æºã€‚</p>
</li>
</ul>
<h4 data-id="heading-2"><strong>ä¸‰ã€ æ¸²æŸ“å±‚ä¼˜åŒ–ï¼šè®©æ¯ä¸€å¸§éƒ½ä¸æ»‘</strong></h4>
<p>ç½‘ç»œèµ„æºåŠ è½½å®Œäº†ï¼Œé¡µé¢ä¸ºä»€ä¹ˆè¿˜æ˜¯å¡ï¼Ÿ</p>
<p><strong>1. ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½</strong><br/>
ä¸è¦æŠŠæ‰€æœ‰ä»£ç éƒ½æ‰“åŒ…åˆ°ä¸€ä¸ªÂ <code>bundle.js</code>Â é‡Œï¼ä½¿ç”¨Â <code>React.lazy</code>Â å’ŒÂ <code>Suspense</code>Â å®ç°è·¯ç”±çº§å’Œç»„ä»¶çº§çš„æ‡’åŠ è½½ã€‚</p>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼ï¼šé¦–å±å°±åŠ è½½æ‰€æœ‰ç»„ä»¶</span>
<span class="hljs-comment">// import HeavyComponent from './HeavyComponent';</span>

<span class="hljs-comment">// ä¼˜åŒ–åï¼šæŒ‰éœ€åŠ è½½</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HeavyComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./HeavyComponent'</span>));

<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">HeavyComponent</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>2. å…³é”® CSS ä¸é˜²å¸ƒå±€åç§»</strong></p>
<ul>
<li>
<p><strong>å…³é”® CSSï¼š</strong> Â å°†é¦–å±æ¸²æŸ“æ‰€å¿…é¡»çš„ CSS æ ·å¼å†…è”åˆ°Â <code>&lt;head&gt;</code>Â ä¸­ï¼Œé¿å…å› ç­‰å¾… CSS æ–‡ä»¶åŠ è½½è€Œå¯¼è‡´çš„é¡µé¢ç™½å±ï¼ˆFOUCï¼‰ã€‚</p>
</li>
<li>
<p><strong>é˜²å¸ƒå±€åç§»ï¼š</strong></p>
<ul>
<li>ä¸ºå›¾ç‰‡ã€è§†é¢‘ç­‰å…ƒç´ æ˜ç¡®è®¾ç½®Â <code>width</code>Â å’ŒÂ <code>height</code>Â å±æ€§ã€‚</li>
<li>ä¸ºå¹¿å‘Šã€åµŒå…¥å†…å®¹é¢„ç•™å¥½ç©ºé—´ã€‚</li>
<li>ä½¿ç”¨Â <code>aspect-ratio</code>Â CSS å±æ€§æ¥ç»´æŒå…ƒç´ çš„å®½é«˜æ¯”ã€‚</li>
</ul>
</li>
</ul>
<p><strong>3. è™šæ‹Ÿåˆ—è¡¨ï¼šæµ·é‡æ•°æ®æ¸²æŸ“çš„æ•‘æ˜Ÿ</strong><br/>
å½“ä½ éœ€è¦æ¸²æŸ“æˆç™¾ä¸Šåƒæ¡åˆ—è¡¨æ•°æ®æ—¶ï¼ˆå¦‚è¡¨æ ¼ã€èŠå¤©è®°å½•ï¼‰ï¼Œç›´æ¥æ¸²æŸ“ä¼šå¯¼è‡´ DOM èŠ‚ç‚¹è¿‡å¤šï¼Œé¡µé¢ç›´æ¥å¡æ­»ã€‚<strong>è™šæ‹Ÿåˆ—è¡¨</strong>Â æŠ€æœ¯åªæ¸²æŸ“å¯è§†åŒºåŸŸå†…çš„å…ƒç´ ï¼Œæ€§èƒ½æå‡ç«‹ç«¿è§å½±ã€‚å¯ä»¥ä½¿ç”¨Â <code>react-window</code>Â æˆ–Â <code>vue-virtual-scroller</code>Â ç­‰åº“è½»æ¾å®ç°ã€‚</p>
<h4 data-id="heading-3"><strong>å››ã€ JavaScript æ‰§è¡Œæ•ˆç‡ï¼šå‘Šåˆ«å¡é¡¿</strong></h4>
<p><strong>1. é˜²æŠ–ä¸èŠ‚æµ</strong><br/>
æ»šåŠ¨ã€æœç´¢ã€çª—å£ç¼©æ”¾ç­‰é«˜é¢‘è§¦å‘çš„äº‹ä»¶ï¼Œå¿…é¡»ä½¿ç”¨é˜²æŠ–æˆ–èŠ‚æµã€‚</p>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æœç´¢æ¡†é˜²æŠ–</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, wait</span>) {
  <span class="hljs-keyword">let</span> timeout;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">executedFunction</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">later</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-built_in">clearTimeout</span>(timeout);
      <span class="hljs-title function_">func</span>(...args);
    };
    <span class="hljs-built_in">clearTimeout</span>(timeout);
    timeout = <span class="hljs-built_in">setTimeout</span>(later, wait);
  };
}

<span class="hljs-keyword">const</span> searchInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'search'</span>);
searchInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, <span class="hljs-title function_">debounce</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-comment">// å‘èµ·æœç´¢è¯·æ±‚</span>
}, <span class="hljs-number">300</span>));
</code></pre>
<p><strong>2. ä½¿ç”¨ Web Workers å¤„ç†é‡è®¡ç®—</strong><br/>
åƒå›¾åƒå¤„ç†ã€å¤æ‚æ•°æ®æ’åºã€è¯­æ³•é«˜äº®ç­‰CPUå¯†é›†å‹ä»»åŠ¡ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´é¡µé¢æ— æ³•å“åº”ã€‚æŠŠå®ƒä»¬ä¸¢ç»™Â <strong>Web Worker</strong>Â åœ¨åå°çº¿ç¨‹æ‰§è¡Œï¼Œè§£æ”¾ä¸»çº¿ç¨‹ã€‚</p>
<p><strong>3. æ€§èƒ½ç›‘æ§ä¸æŒç»­ä¼˜åŒ–</strong><br/>
ä¼˜åŒ–ä¸æ˜¯ä¸€åŠ³æ°¸é€¸çš„ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ€§èƒ½ç›‘æ§ï¼š</p>
<ul>
<li><strong>ä½¿ç”¨Â <code>PerformanceObserver</code>Â API</strong>Â æ¥ç›‘å¬ Web Vitals æŒ‡æ ‡ã€‚</li>
<li><strong>ä½¿ç”¨ Chrome DevTools çš„ Performance é¢æ¿</strong>Â å½•åˆ¶å¹¶åˆ†æè¿è¡Œæ—¶æ€§èƒ½ï¼Œæ‰¾åˆ°é•¿ä»»åŠ¡å’Œæ€§èƒ½ç“¶é¢ˆã€‚</li>
</ul>
<h3 data-id="heading-4"><strong>æ€»ç»“ä¸å±•æœ›</strong></h3>
<p>æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€æ¡æ²¡æœ‰å°½å¤´çš„è·¯ï¼Œå®ƒè¦æ±‚æˆ‘ä»¬ä¸ä»…æ‡‚ APIï¼Œæ›´è¦æ‡‚æµè§ˆå™¨åŸç†ã€ç½‘ç»œåè®®å’Œç”¨æˆ·ä½“éªŒã€‚æ€»ç»“ä¸€ä¸‹æœ¬æ–‡çš„æ ¸å¿ƒè·¯å¾„ï¼š</p>
<p><strong>æ„å»º â†’ å‹ç¼© â†’ ç¼“å­˜ â†’ åˆ†å‰² â†’ æ‡’åŠ è½½ â†’ é«˜æ•ˆæ¸²æŸ“ â†’ æŒç»­ç›‘æ§</strong></p>
<p>å°†è¿™ä¸ƒä¸ªæ­¥éª¤èå…¥åˆ°ä½ çš„æ—¥å¸¸å¼€å‘ä¹ æƒ¯ä¸­ï¼Œä½ å°±èƒ½ä»ä¸€ä¸ªâ€œåŠŸèƒ½å®ç°è€…â€èœ•å˜ä¸ºâ€œä½“éªŒæ‰“é€ è€…â€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¼˜æƒ åˆ¸ç³»ç»Ÿè®¾è®¡ä¸å®ç°]]></title>    <link>https://juejin.cn/post/7577431644069265459</link>    <guid>https://juejin.cn/post/7577431644069265459</guid>    <pubDate>2025-11-28T09:12:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577431644069265459" data-draft-id="7577599299598499891" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¼˜æƒ åˆ¸ç³»ç»Ÿè®¾è®¡ä¸å®ç°"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-28T09:12:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¼˜æƒ åˆ¸ç³»ç»Ÿè®¾è®¡ä¸å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:12:13.000Z" title="Fri Nov 28 2025 09:12:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»23åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¼˜æƒ åˆ¸ç³»ç»Ÿè®¾è®¡ä¸å®ç°</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>ä¼˜æƒ åˆ¸ç³»ç»Ÿæ˜¯ç”µå•†å¹³å°ä¿ƒé”€çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚äº¬ä¸œã€æ·˜å®ç­‰å¹³å°æ¯å¤©å‘æ”¾æ•°ä»¥äº¿è®¡çš„ä¼˜æƒ åˆ¸ï¼Œæ¶‰åŠå¤šç§åˆ¸ç±»å‹ã€å¤æ‚çš„ä½¿ç”¨è§„åˆ™ã€é«˜å¹¶å‘çš„é¢†å–åœºæ™¯ã€‚æœ¬æ–‡å°†ä»ç³»ç»Ÿæ¶æ„ã€æ•°æ®åº“è®¾è®¡ã€æ ¸å¿ƒåŠŸèƒ½å®ç°ç­‰æ–¹é¢ï¼Œè¯¦ç»†è®²è§£å¦‚ä½•è®¾è®¡ä¸€ä¸ªå®Œæ•´çš„ä¼˜æƒ åˆ¸ç³»ç»Ÿã€‚</p>
<h3 data-id="heading-2">ä¸€ã€ä¼˜æƒ åˆ¸ç³»ç»Ÿä¸šåŠ¡åˆ†æ</h3>
<h4 data-id="heading-3">1.1 ä¼˜æƒ åˆ¸ç±»å‹</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+------------------+------------------+------------------+------------------+</span>
|    æ»¡å‡åˆ¸        |     æŠ˜æ‰£åˆ¸       |     ç«‹å‡åˆ¸       |     è¿è´¹åˆ¸       |
|  æ»¡100å‡20      |    å…¨åœº8æŠ˜       |   æ— é—¨æ§›å‡10å…ƒ   |   å…è¿è´¹åˆ¸       |
<span class="hljs-addition">+------------------+------------------+------------------+------------------+</span>
         |                  |                  |                  |
         v                  v                  v                  v
<span class="hljs-addition">+------------------+------------------+------------------+------------------+</span>
|    å“ç±»åˆ¸        |     åº—é“ºåˆ¸       |    å•å“åˆ¸        |    é€šç”¨åˆ¸        |
|  é™ç‰¹å®šå“ç±»ä½¿ç”¨   |   é™ç‰¹å®šåº—é“º     |   é™ç‰¹å®šå•†å“     |   å…¨å¹³å°å¯ç”¨     |
<span class="hljs-addition">+------------------+------------------+------------------+------------------+</span>
</code></pre>
<h4 data-id="heading-4">1.2 ä¼˜æƒ åˆ¸ç”Ÿå‘½å‘¨æœŸ</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">----------+     +----------+     +----------+     +----------+     +----------+</span>
|  åˆ›å»º    | <span class="hljs-comment">--&gt; |  å‘å¸ƒ    | --&gt; |  é¢†å–    | --&gt; |  ä½¿ç”¨    | --&gt; |  æ ¸é”€    |</span>
+<span class="hljs-comment">----------+     +----------+     +----------+     +----------+     +----------+</span>
     |               |               |               |               |
     v               v               v               v               v
+<span class="hljs-comment">----------+     +----------+     +----------+     +----------+     +----------+</span>
| æ¨¡æ¿é…ç½®  |     | æ´»åŠ¨ä¸Šçº¿  |     | ç”¨æˆ·é¢†åˆ¸  |     | ä¸‹å•æŠµæ‰£  |     | è®¢å•å®Œæˆ  |
| è§„åˆ™è®¾ç½®  |     | åº“å­˜åˆ†é…  |     | åº“å­˜æ‰£å‡  |     | é‡‘é¢è®¡ç®—  |     | çŠ¶æ€æ›´æ–°  |
+<span class="hljs-comment">----------+     +----------+     +----------+     +----------+     +----------+</span>
                                       |
                                       v
                                  +<span class="hljs-comment">----------+</span>
                                  |  è¿‡æœŸ    |
                                  | è‡ªåŠ¨å¤±æ•ˆ  |
                                  +<span class="hljs-comment">----------+</span>
</code></pre>
<h4 data-id="heading-5">1.3 æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡</h4>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>è¯´æ˜</th><th>ç›®æ ‡å€¼</th></tr></thead><tbody><tr><td>é¢†åˆ¸QPS</td><td>å¤§ä¿ƒæœŸé—´é¢†åˆ¸å³°å€¼</td><td>10ä¸‡+</td></tr><tr><td>ç”¨åˆ¸è®¡ç®—</td><td>è®¢å•ä¼˜æƒ è®¡ç®—è€—æ—¶</td><td>&lt;50ms</td></tr><tr><td>åˆ¸æ ¸é”€ç‡</td><td>é¢†å–åå®é™…ä½¿ç”¨æ¯”ä¾‹</td><td>30-50%</td></tr><tr><td>å‘æ”¾æˆåŠŸç‡</td><td>ä¼˜æƒ åˆ¸å‘æ”¾æˆåŠŸç‡</td><td>99.99%</td></tr></tbody></table>
<h3 data-id="heading-6">äºŒã€ç³»ç»Ÿæ¶æ„è®¾è®¡</h3>
<h4 data-id="heading-7">2.1 æ•´ä½“æ¶æ„</h4>
<pre><code class="hljs language-sql" lang="sql">                           <span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span>
                           <span class="hljs-operator">|</span>      ç”¨æˆ·ç«¯        <span class="hljs-operator">|</span>
                           <span class="hljs-operator">|</span>  APP<span class="hljs-operator">/</span>å°ç¨‹åº<span class="hljs-operator">/</span>H5    <span class="hljs-operator">|</span>
                           <span class="hljs-operator">+</span><span class="hljs-comment">---------+----------+</span>
                                     <span class="hljs-operator">|</span>
                           <span class="hljs-operator">+</span><span class="hljs-comment">---------v----------+</span>
                           <span class="hljs-operator">|</span>    API Gateway     <span class="hljs-operator">|</span>
                           <span class="hljs-operator">|</span>   è®¤è¯<span class="hljs-operator">/</span>é™æµ<span class="hljs-operator">/</span>è·¯ç”±    <span class="hljs-operator">|</span>
                           <span class="hljs-operator">+</span><span class="hljs-comment">---------+----------+</span>
                                     <span class="hljs-operator">|</span>
         <span class="hljs-operator">+</span><span class="hljs-comment">---------------------------+---------------------------+</span>
         <span class="hljs-operator">|</span>                           <span class="hljs-operator">|</span>                           <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">--------v--------+        +---------v--------+        +---------v--------+</span>
<span class="hljs-operator">|</span>   ä¼˜æƒ åˆ¸æœåŠ¡     <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>    è®¢å•æœåŠ¡      <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>    è¥é”€æœåŠ¡      <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> Coupon<span class="hljs-operator">-</span>Service  <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>  <span class="hljs-keyword">Order</span><span class="hljs-operator">-</span>Service   <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span> Marketing<span class="hljs-operator">-</span>Service<span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">--------+--------+        +---------+--------+        +---------+--------+</span>
         <span class="hljs-operator">|</span>                           <span class="hljs-operator">|</span>                           <span class="hljs-operator">|</span>
         <span class="hljs-operator">+</span><span class="hljs-comment">---------------------------+---------------------------+</span>
                                     <span class="hljs-operator">|</span>
         <span class="hljs-operator">+</span><span class="hljs-comment">---------------------------+---------------------------+</span>
         <span class="hljs-operator">|</span>                           <span class="hljs-operator">|</span>                           <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">--------v--------+        +---------v--------+        +---------v--------+</span>
<span class="hljs-operator">|</span>   Redisé›†ç¾¤     <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>   RocketMQ      <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>   MySQLé›†ç¾¤      <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  ç¼“å­˜<span class="hljs-operator">/</span>åˆ†å¸ƒå¼é”   <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>   å¼‚æ­¥å¤„ç†      <span class="hljs-operator">|</span>        <span class="hljs-operator">|</span>   æ•°æ®æŒä¹…åŒ–     <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-----------------+        +------------------+        +------------------+</span>
</code></pre>
<h4 data-id="heading-8">2.2 ä¼˜æƒ åˆ¸æœåŠ¡æ ¸å¿ƒæ¨¡å—</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">------------------------------------------------------------------+</span>
|                        ä¼˜æƒ åˆ¸æœåŠ¡                                 |
+<span class="hljs-comment">------------------------------------------------------------------+</span>
|  +<span class="hljs-comment">-------------+  +-------------+  +-------------+  +-----------+ |</span>
|  | æ¨¡æ¿ç®¡ç†    |  | æ´»åŠ¨ç®¡ç†    |  | é¢†åˆ¸æœåŠ¡    |  | ç”¨åˆ¸æœåŠ¡  | |
|  | Template    |  | Activity    |  | Receive     |  | Apply     | |
|  +<span class="hljs-comment">-------------+  +-------------+  +-------------+  +-----------+ |</span>
|                                                                   |
|  +<span class="hljs-comment">-------------+  +-------------+  +-------------+  +-----------+ |</span>
|  | åº“å­˜ç®¡ç†    |  | è§„åˆ™å¼•æ“    |  | è¿‡æœŸå¤„ç†    |  | ç»Ÿè®¡åˆ†æ  | |
|  | Stock       |  | Rule        |  | Expire      |  | Statistics| |
|  +<span class="hljs-comment">-------------+  +-------------+  +-------------+  +-----------+ |</span>
+<span class="hljs-comment">------------------------------------------------------------------+</span>
</code></pre>
<h3 data-id="heading-9">ä¸‰ã€æ•°æ®åº“è®¾è®¡</h3>
<h4 data-id="heading-10">3.1 æ ¸å¿ƒè¡¨ç»“æ„</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¼˜æƒ åˆ¸æ¨¡æ¿è¡¨ï¼ˆå®šä¹‰åˆ¸çš„åŸºæœ¬å±æ€§ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `coupon_template` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'æ¨¡æ¿ID'</span>,
    `name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åˆ¸åç§°'</span>,
    `logo` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åˆ¸Logo'</span>,
    `description` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åˆ¸æè¿°'</span>,
    `category` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åˆ¸ç±»å‹ï¼š1-æ»¡å‡åˆ¸ï¼Œ2-æŠ˜æ‰£åˆ¸ï¼Œ3-ç«‹å‡åˆ¸ï¼Œ4-è¿è´¹åˆ¸'</span>,
    `product_line` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'äº§å“çº¿ï¼š1-é€šç”¨ï¼Œ2-å“ç±»ï¼Œ3-åº—é“ºï¼Œ4-å•å“'</span>,
    `coupon_count` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ€»å‘è¡Œé‡'</span>,
    `user_limit` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'æ¯äººé™é¢†æ•°é‡'</span>,
    `threshold` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'ä½¿ç”¨é—¨æ§›é‡‘é¢'</span>,
    `discount_amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä¼˜æƒ é‡‘é¢ï¼ˆæ»¡å‡/ç«‹å‡ï¼‰'</span>,
    `discount_rate` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">4</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æŠ˜æ‰£ç‡ï¼ˆæŠ˜æ‰£åˆ¸ï¼‰'</span>,
    `max_discount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æœ€å¤§ä¼˜æƒ é‡‘é¢ï¼ˆæŠ˜æ‰£åˆ¸ä¸Šé™ï¼‰'</span>,
    `valid_type` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'æœ‰æ•ˆæœŸç±»å‹ï¼š1-å›ºå®šæ—¶é—´ï¼Œ2-é¢†å–åNå¤©'</span>,
    `valid_start_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å›ºå®šæœ‰æ•ˆæœŸå¼€å§‹æ—¶é—´'</span>,
    `valid_end_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å›ºå®šæœ‰æ•ˆæœŸç»“æŸæ—¶é—´'</span>,
    `valid_days` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'é¢†å–åæœ‰æ•ˆå¤©æ•°'</span>,
    `rule_json` TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä½¿ç”¨è§„åˆ™JSONï¼ˆå“ç±»IDã€åº—é“ºIDã€å•†å“IDç­‰ï¼‰'</span>,
    `status` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'çŠ¶æ€ï¼š1-è‰ç¨¿ï¼Œ2-å¾…å®¡æ ¸ï¼Œ3-å·²å‘å¸ƒï¼Œ4-å·²åœæ­¢'</span>,
    `create_user` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åˆ›å»ºäºº'</span>,
    `create_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    `update_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    KEY `idx_status` (`status`),
    KEY `idx_category` (`category`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'ä¼˜æƒ åˆ¸æ¨¡æ¿è¡¨'</span>;

<span class="hljs-comment">-- ä¼˜æƒ åˆ¸æ´»åŠ¨è¡¨ï¼ˆå®šä¹‰å‘åˆ¸æ´»åŠ¨ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `coupon_activity` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'æ´»åŠ¨ID'</span>,
    `name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ´»åŠ¨åç§°'</span>,
    `template_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åˆ¸æ¨¡æ¿ID'</span>,
    `activity_type` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ´»åŠ¨ç±»å‹ï¼š1-ç”¨æˆ·é¢†å–ï¼Œ2-ç³»ç»Ÿå‘æ”¾ï¼Œ3-æ–°äººä¸“äº«ï¼Œ4-ä¼šå‘˜ä¸“äº«'</span>,
    `total_count` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ´»åŠ¨å‘åˆ¸æ€»é‡'</span>,
    `remaining_count` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å‰©ä½™æ•°é‡'</span>,
    `start_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ´»åŠ¨å¼€å§‹æ—¶é—´'</span>,
    `end_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ´»åŠ¨ç»“æŸæ—¶é—´'</span>,
    `target_user` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">512</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç›®æ ‡ç”¨æˆ·ï¼ˆJSONï¼šä¼šå‘˜ç­‰çº§ã€ç”¨æˆ·æ ‡ç­¾ç­‰ï¼‰'</span>,
    `status` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'çŠ¶æ€ï¼š1-æœªå¼€å§‹ï¼Œ2-è¿›è¡Œä¸­ï¼Œ3-å·²ç»“æŸï¼Œ4-å·²åœæ­¢'</span>,
    `create_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    `update_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    KEY `idx_template_id` (`template_id`),
    KEY `idx_status_time` (`status`, `start_time`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'ä¼˜æƒ åˆ¸æ´»åŠ¨è¡¨'</span>;

<span class="hljs-comment">-- ç”¨æˆ·ä¼˜æƒ åˆ¸è¡¨ï¼ˆç”¨æˆ·é¢†å–çš„åˆ¸ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `user_coupon` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'ID'</span>,
    `coupon_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åˆ¸ç ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰'</span>,
    `user_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç”¨æˆ·ID'</span>,
    `template_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åˆ¸æ¨¡æ¿ID'</span>,
    `activity_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ´»åŠ¨ID'</span>,
    `status` TINYINT(<span class="hljs-number">1</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'çŠ¶æ€ï¼š1-æœªä½¿ç”¨ï¼Œ2-å·²ä½¿ç”¨ï¼Œ3-å·²è¿‡æœŸï¼Œ4-å·²å†»ç»“'</span>,
    `receive_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'é¢†å–æ—¶é—´'</span>,
    `valid_start_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æœ‰æ•ˆæœŸå¼€å§‹æ—¶é—´'</span>,
    `valid_end_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æœ‰æ•ˆæœŸç»“æŸæ—¶é—´'</span>,
    `use_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä½¿ç”¨æ—¶é—´'</span>,
    `order_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä½¿ç”¨è®¢å•å·'</span>,
    `create_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    `update_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    <span class="hljs-keyword">UNIQUE</span> KEY `uk_coupon_code` (`coupon_code`),
    KEY `idx_user_status` (`user_id`, `status`),
    KEY `idx_template_id` (`template_id`),
    KEY `idx_valid_end_time` (`valid_end_time`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'ç”¨æˆ·ä¼˜æƒ åˆ¸è¡¨'</span>;

<span class="hljs-comment">-- ä¼˜æƒ åˆ¸ä½¿ç”¨è®°å½•è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `coupon_use_record` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
    `coupon_code` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åˆ¸ç '</span>,
    `user_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç”¨æˆ·ID'</span>,
    `order_no` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è®¢å•å·'</span>,
    `order_amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è®¢å•é‡‘é¢'</span>,
    `discount_amount` <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä¼˜æƒ é‡‘é¢'</span>,
    `use_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ä½¿ç”¨æ—¶é—´'</span>,
    `create_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    KEY `idx_coupon_code` (`coupon_code`),
    KEY `idx_order_no` (`order_no`),
    KEY `idx_user_id` (`user_id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'ä¼˜æƒ åˆ¸ä½¿ç”¨è®°å½•è¡¨'</span>;

<span class="hljs-comment">-- é¢†åˆ¸è®°å½•è¡¨ï¼ˆç”¨äºé™é¢†æ ¡éªŒï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `coupon_receive_record` (
    `id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
    `user_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç”¨æˆ·ID'</span>,
    `template_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¨¡æ¿ID'</span>,
    `activity_id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ´»åŠ¨ID'</span>,
    `receive_count` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'é¢†å–æ•°é‡'</span>,
    `create_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    `update_time` DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
    <span class="hljs-keyword">UNIQUE</span> KEY `uk_user_activity` (`user_id`, `activity_id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'é¢†åˆ¸è®°å½•è¡¨'</span>;
</code></pre>
<h4 data-id="heading-11">3.2 ERå…³ç³»å›¾</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">------------------+       +------------------+       +------------------+</span>
|  coupon_template |       | coupon_activity  |       |   user_coupon    |
+<span class="hljs-comment">------------------+       +------------------+       +------------------+</span>
| id (PK)          |&lt;<span class="hljs-comment">------| template_id (FK) |       | id (PK)          |</span>
| name             |       | id (PK)          |&lt;<span class="hljs-comment">------| activity_id (FK) |</span>
| category         |       | name             |       | template_id (FK) |<span class="hljs-comment">----+</span>
| product_line     |       | activity_type    |       | user_id          |    |
| coupon_count     |       | total_count      |       | coupon_code      |    |
| threshold        |       | remaining_count  |       | <span class="hljs-built_in">status</span>           |    |
| discount_amount  |       | start_time       |       | valid_start_time |    |
| discount_rate    |       | end_time         |       | valid_end_time   |    |
| ...              |       | <span class="hljs-built_in">status</span>           |       | ...              |    |
+<span class="hljs-comment">------------------+       +------------------+       +------------------+    |</span>
         ^                                                                    |
         +<span class="hljs-comment">--------------------------------------------------------------------+</span>
</code></pre>
<h3 data-id="heading-12">å››ã€æ ¸å¿ƒå®ä½“ç±»è®¾è®¡</h3>
<h4 data-id="heading-13">4.1 å®ä½“ç±»å®šä¹‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.entity;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.*;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-comment">/**
 * ä¼˜æƒ åˆ¸æ¨¡æ¿å®ä½“
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName("coupon_template")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponTemplate</span> {

    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-keyword">private</span> String logo;

    <span class="hljs-keyword">private</span> String description;

    <span class="hljs-comment">/**
     * åˆ¸ç±»å‹ï¼š1-æ»¡å‡åˆ¸ï¼Œ2-æŠ˜æ‰£åˆ¸ï¼Œ3-ç«‹å‡åˆ¸ï¼Œ4-è¿è´¹åˆ¸
     */</span>
    <span class="hljs-keyword">private</span> Integer category;

    <span class="hljs-comment">/**
     * äº§å“çº¿ï¼š1-é€šç”¨ï¼Œ2-å“ç±»ï¼Œ3-åº—é“ºï¼Œ4-å•å“
     */</span>
    <span class="hljs-keyword">private</span> Integer productLine;

    <span class="hljs-keyword">private</span> Integer couponCount;

    <span class="hljs-keyword">private</span> Integer userLimit;

    <span class="hljs-comment">/**
     * ä½¿ç”¨é—¨æ§›
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal threshold;

    <span class="hljs-comment">/**
     * ä¼˜æƒ é‡‘é¢
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal discountAmount;

    <span class="hljs-comment">/**
     * æŠ˜æ‰£ç‡
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal discountRate;

    <span class="hljs-comment">/**
     * æœ€å¤§ä¼˜æƒ é‡‘é¢
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal maxDiscount;

    <span class="hljs-comment">/**
     * æœ‰æ•ˆæœŸç±»å‹ï¼š1-å›ºå®šæ—¶é—´ï¼Œ2-é¢†å–åNå¤©
     */</span>
    <span class="hljs-keyword">private</span> Integer validType;

    <span class="hljs-keyword">private</span> LocalDateTime validStartTime;

    <span class="hljs-keyword">private</span> LocalDateTime validEndTime;

    <span class="hljs-keyword">private</span> Integer validDays;

    <span class="hljs-comment">/**
     * ä½¿ç”¨è§„åˆ™JSON
     */</span>
    <span class="hljs-keyword">private</span> String ruleJson;

    <span class="hljs-keyword">private</span> Integer status;

    <span class="hljs-keyword">private</span> String createUser;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span>
    <span class="hljs-keyword">private</span> LocalDateTime createTime;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span>
    <span class="hljs-keyword">private</span> LocalDateTime updateTime;
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.entity;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.*;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-comment">/**
 * ç”¨æˆ·ä¼˜æƒ åˆ¸å®ä½“
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName("user_coupon")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserCoupon</span> {

    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-comment">/**
     * åˆ¸ç 
     */</span>
    <span class="hljs-keyword">private</span> String couponCode;

    <span class="hljs-keyword">private</span> Long userId;

    <span class="hljs-keyword">private</span> Long templateId;

    <span class="hljs-keyword">private</span> Long activityId;

    <span class="hljs-comment">/**
     * çŠ¶æ€ï¼š1-æœªä½¿ç”¨ï¼Œ2-å·²ä½¿ç”¨ï¼Œ3-å·²è¿‡æœŸï¼Œ4-å·²å†»ç»“
     */</span>
    <span class="hljs-keyword">private</span> Integer status;

    <span class="hljs-keyword">private</span> LocalDateTime receiveTime;

    <span class="hljs-keyword">private</span> LocalDateTime validStartTime;

    <span class="hljs-keyword">private</span> LocalDateTime validEndTime;

    <span class="hljs-keyword">private</span> LocalDateTime useTime;

    <span class="hljs-keyword">private</span> String orderNo;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span>
    <span class="hljs-keyword">private</span> LocalDateTime createTime;

    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span>
    <span class="hljs-keyword">private</span> LocalDateTime updateTime;
}
</code></pre>
<h4 data-id="heading-14">4.2 æšä¸¾å®šä¹‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.enums;

<span class="hljs-keyword">import</span> lombok.Getter;

<span class="hljs-comment">/**
 * ä¼˜æƒ åˆ¸ç±»å‹æšä¸¾
 */</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">CouponCategoryEnum</span> {

    FULL_REDUCTION(<span class="hljs-number">1</span>, <span class="hljs-string">"æ»¡å‡åˆ¸"</span>),
    DISCOUNT(<span class="hljs-number">2</span>, <span class="hljs-string">"æŠ˜æ‰£åˆ¸"</span>),
    IMMEDIATE_REDUCTION(<span class="hljs-number">3</span>, <span class="hljs-string">"ç«‹å‡åˆ¸"</span>),
    FREIGHT(<span class="hljs-number">4</span>, <span class="hljs-string">"è¿è´¹åˆ¸"</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;

    CouponCategoryEnum(Integer code, String desc) {
        <span class="hljs-built_in">this</span>.code = code;
        <span class="hljs-built_in">this</span>.desc = desc;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CouponCategoryEnum <span class="hljs-title function_">of</span><span class="hljs-params">(Integer code)</span> {
        <span class="hljs-keyword">for</span> (CouponCategoryEnum value : values()) {
            <span class="hljs-keyword">if</span> (value.getCode().equals(code)) {
                <span class="hljs-keyword">return</span> value;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.enums;

<span class="hljs-keyword">import</span> lombok.Getter;

<span class="hljs-comment">/**
 * ç”¨æˆ·åˆ¸çŠ¶æ€æšä¸¾
 */</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">UserCouponStatusEnum</span> {

    UNUSED(<span class="hljs-number">1</span>, <span class="hljs-string">"æœªä½¿ç”¨"</span>),
    USED(<span class="hljs-number">2</span>, <span class="hljs-string">"å·²ä½¿ç”¨"</span>),
    EXPIRED(<span class="hljs-number">3</span>, <span class="hljs-string">"å·²è¿‡æœŸ"</span>),
    FROZEN(<span class="hljs-number">4</span>, <span class="hljs-string">"å·²å†»ç»“"</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;

    UserCouponStatusEnum(Integer code, String desc) {
        <span class="hljs-built_in">this</span>.code = code;
        <span class="hljs-built_in">this</span>.desc = desc;
    }
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.enums;

<span class="hljs-keyword">import</span> lombok.Getter;

<span class="hljs-comment">/**
 * äº§å“çº¿æšä¸¾
 */</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ProductLineEnum</span> {

    UNIVERSAL(<span class="hljs-number">1</span>, <span class="hljs-string">"é€šç”¨åˆ¸"</span>),
    CATEGORY(<span class="hljs-number">2</span>, <span class="hljs-string">"å“ç±»åˆ¸"</span>),
    SHOP(<span class="hljs-number">3</span>, <span class="hljs-string">"åº—é“ºåˆ¸"</span>),
    PRODUCT(<span class="hljs-number">4</span>, <span class="hljs-string">"å•å“åˆ¸"</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;

    ProductLineEnum(Integer code, String desc) {
        <span class="hljs-built_in">this</span>.code = code;
        <span class="hljs-built_in">this</span>.desc = desc;
    }
}
</code></pre>
<h4 data-id="heading-15">4.3 DTOå®šä¹‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.dto;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * ä¼˜æƒ åˆ¸ä½¿ç”¨è§„åˆ™DTO
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponRuleDTO</span> {

    <span class="hljs-comment">/**
     * é€‚ç”¨å“ç±»IDåˆ—è¡¨
     */</span>
    <span class="hljs-keyword">private</span> List&lt;Long&gt; categoryIds;

    <span class="hljs-comment">/**
     * é€‚ç”¨åº—é“ºIDåˆ—è¡¨
     */</span>
    <span class="hljs-keyword">private</span> List&lt;Long&gt; shopIds;

    <span class="hljs-comment">/**
     * é€‚ç”¨å•†å“IDåˆ—è¡¨
     */</span>
    <span class="hljs-keyword">private</span> List&lt;Long&gt; productIds;

    <span class="hljs-comment">/**
     * æ’é™¤å“ç±»IDåˆ—è¡¨
     */</span>
    <span class="hljs-keyword">private</span> List&lt;Long&gt; excludeCategoryIds;

    <span class="hljs-comment">/**
     * æ’é™¤å•†å“IDåˆ—è¡¨
     */</span>
    <span class="hljs-keyword">private</span> List&lt;Long&gt; excludeProductIds;

    <span class="hljs-comment">/**
     * æ˜¯å¦å¯ä¸å…¶ä»–åˆ¸å åŠ 
     */</span>
    <span class="hljs-keyword">private</span> Boolean canStack;

    <span class="hljs-comment">/**
     * å åŠ ä¸Šé™
     */</span>
    <span class="hljs-keyword">private</span> Integer stackLimit;

    <span class="hljs-comment">/**
     * é€‚ç”¨æ¸ é“ï¼š1-APPï¼Œ2-å°ç¨‹åºï¼Œ3-H5ï¼Œ4-å…¨æ¸ é“
     */</span>
    <span class="hljs-keyword">private</span> List&lt;Integer&gt; channels;

    <span class="hljs-comment">/**
     * é€‚ç”¨æ”¯ä»˜æ–¹å¼
     */</span>
    <span class="hljs-keyword">private</span> List&lt;Integer&gt; payTypes;
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.dto;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-comment">/**
 * ç”¨æˆ·åˆ¸ä¿¡æ¯DTOï¼ˆå±•ç¤ºç”¨ï¼‰
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserCouponDTO</span> {

    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-keyword">private</span> String couponCode;

    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-keyword">private</span> String description;

    <span class="hljs-keyword">private</span> Integer category;

    <span class="hljs-keyword">private</span> String categoryDesc;

    <span class="hljs-keyword">private</span> BigDecimal threshold;

    <span class="hljs-keyword">private</span> BigDecimal discountAmount;

    <span class="hljs-keyword">private</span> BigDecimal discountRate;

    <span class="hljs-keyword">private</span> Integer status;

    <span class="hljs-keyword">private</span> String statusDesc;

    <span class="hljs-keyword">private</span> LocalDateTime validStartTime;

    <span class="hljs-keyword">private</span> LocalDateTime validEndTime;

    <span class="hljs-comment">/**
     * æ˜¯å¦å³å°†è¿‡æœŸï¼ˆ3å¤©å†…ï¼‰
     */</span>
    <span class="hljs-keyword">private</span> Boolean expiringSoon;

    <span class="hljs-comment">/**
     * ä½¿ç”¨èŒƒå›´æè¿°
     */</span>
    <span class="hljs-keyword">private</span> String scopeDesc;
}
</code></pre>
<h3 data-id="heading-16">äº”ã€é¢†åˆ¸æœåŠ¡å®ç°</h3>
<h4 data-id="heading-17">5.1 é¢†åˆ¸æµç¨‹</h4>
<pre><code class="hljs language-rust" lang="rust">+----------+     +----------+     +----------+     +----------+     +----------+
| è¯·æ±‚æ ¡éªŒ  | -<span class="hljs-punctuation">-&gt;</span> | æ´»åŠ¨æ ¡éªŒ  | -<span class="hljs-punctuation">-&gt;</span> | é™é¢†æ ¡éªŒ  | -<span class="hljs-punctuation">-&gt;</span> | åº“å­˜æ‰£å‡  | -<span class="hljs-punctuation">-&gt;</span> | ç”Ÿæˆåˆ¸ç   |
+----------+     +----------+     +----------+     +----------+     +----------+
     |               |               |               |               |
     v               v               v               v               v
  å‚æ•°æ ¡éªŒ       æ—¶é—´/çŠ¶æ€æ ¡éªŒ    ç”¨æˆ·é™é¢†æ•°æ ¡éªŒ    RedisåŸå­æ‰£å‡   é›ªèŠ±ç®—æ³•ç”Ÿæˆ
  ç”¨æˆ·è®¤è¯       ç›®æ ‡ç”¨æˆ·æ ¡éªŒ    æ´»åŠ¨é™é¢†æ•°æ ¡éªŒ    DBå¼‚æ­¥æ›´æ–°      å†™å…¥user_coupon
</code></pre>
<h4 data-id="heading-18">5.2 é¢†åˆ¸æœåŠ¡æ ¸å¿ƒä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.service;

<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
<span class="hljs-keyword">import</span> com.coupon.common.exception.CouponException;
<span class="hljs-keyword">import</span> com.coupon.common.result.ResultCode;
<span class="hljs-keyword">import</span> com.coupon.service.dto.ReceiveCouponRequest;
<span class="hljs-keyword">import</span> com.coupon.service.entity.CouponActivity;
<span class="hljs-keyword">import</span> com.coupon.service.entity.CouponReceiveRecord;
<span class="hljs-keyword">import</span> com.coupon.service.entity.CouponTemplate;
<span class="hljs-keyword">import</span> com.coupon.service.entity.UserCoupon;
<span class="hljs-keyword">import</span> com.coupon.service.mapper.CouponActivityMapper;
<span class="hljs-keyword">import</span> com.coupon.service.mapper.CouponReceiveRecordMapper;
<span class="hljs-keyword">import</span> com.coupon.service.mapper.CouponTemplateMapper;
<span class="hljs-keyword">import</span> com.coupon.service.mapper.UserCouponMapper;
<span class="hljs-keyword">import</span> com.coupon.service.utils.CouponCodeGenerator;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.script.RedisScript;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.util.Arrays;
<span class="hljs-keyword">import</span> java.util.Collections;

<span class="hljs-comment">/**
 * é¢†åˆ¸æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponReceiveService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponActivityMapper activityMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponTemplateMapper templateMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserCouponMapper userCouponMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponReceiveRecordMapper receiveRecordMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RedisScript&lt;Long&gt; receiveScript;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ACTIVITY_STOCK_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"coupon:activity:stock:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">USER_RECEIVE_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"coupon:receive:"</span>;

    <span class="hljs-comment">/**
     * é¢†å–ä¼˜æƒ åˆ¸
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">receiveCoupon</span><span class="hljs-params">(Long userId, ReceiveCouponRequest request)</span> {
        <span class="hljs-type">Long</span> <span class="hljs-variable">activityId</span> <span class="hljs-operator">=</span> request.getActivityId();

        <span class="hljs-comment">// 1. æŸ¥è¯¢æ´»åŠ¨ä¿¡æ¯</span>
        <span class="hljs-type">CouponActivity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> activityMapper.selectById(activityId);
        <span class="hljs-keyword">if</span> (activity == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.ACTIVITY_NOT_EXIST);
        }

        <span class="hljs-comment">// 2. æ ¡éªŒæ´»åŠ¨çŠ¶æ€</span>
        validateActivity(activity);

        <span class="hljs-comment">// 3. æŸ¥è¯¢åˆ¸æ¨¡æ¿</span>
        <span class="hljs-type">CouponTemplate</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> templateMapper.selectById(activity.getTemplateId());
        <span class="hljs-keyword">if</span> (template == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.TEMPLATE_NOT_EXIST);
        }

        <span class="hljs-comment">// 4. æ ¡éªŒç”¨æˆ·é¢†å–èµ„æ ¼</span>
        validateUserEligibility(userId, activity, template);

        <span class="hljs-comment">// 5. RedisåŸå­æ‰£å‡åº“å­˜ + è®°å½•é¢†å–</span>
        <span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> executeReceiveScript(userId, activityId, template.getUserLimit());

        <span class="hljs-keyword">if</span> (result == -<span class="hljs-number">1</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.COUPON_STOCK_EMPTY);
        }
        <span class="hljs-keyword">if</span> (result == -<span class="hljs-number">2</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.COUPON_RECEIVE_LIMIT);
        }

        <span class="hljs-comment">// 6. ç”Ÿæˆåˆ¸ç </span>
        <span class="hljs-type">String</span> <span class="hljs-variable">couponCode</span> <span class="hljs-operator">=</span> CouponCodeGenerator.generate();

        <span class="hljs-comment">// 7. è®¡ç®—æœ‰æ•ˆæœŸ</span>
        LocalDateTime validStartTime;
        LocalDateTime validEndTime;

        <span class="hljs-keyword">if</span> (template.getValidType() == <span class="hljs-number">1</span>) {
            <span class="hljs-comment">// å›ºå®šæœ‰æ•ˆæœŸ</span>
            validStartTime = template.getValidStartTime();
            validEndTime = template.getValidEndTime();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// é¢†å–åNå¤©æœ‰æ•ˆ</span>
            validStartTime = LocalDateTime.now();
            validEndTime = validStartTime.plusDays(template.getValidDays());
        }

        <span class="hljs-comment">// 8. ä¿å­˜ç”¨æˆ·åˆ¸</span>
        <span class="hljs-type">UserCoupon</span> <span class="hljs-variable">userCoupon</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserCoupon</span>();
        userCoupon.setCouponCode(couponCode);
        userCoupon.setUserId(userId);
        userCoupon.setTemplateId(template.getId());
        userCoupon.setActivityId(activityId);
        userCoupon.setStatus(<span class="hljs-number">1</span>);  <span class="hljs-comment">// æœªä½¿ç”¨</span>
        userCoupon.setReceiveTime(LocalDateTime.now());
        userCoupon.setValidStartTime(validStartTime);
        userCoupon.setValidEndTime(validEndTime);

        userCouponMapper.insert(userCoupon);

        <span class="hljs-comment">// 9. æ›´æ–°é¢†å–è®°å½•</span>
        updateReceiveRecord(userId, activityId, template.getId());

        log.info(<span class="hljs-string">"ç”¨æˆ·é¢†åˆ¸æˆåŠŸ: userId={}, activityId={}, couponCode={}"</span>,
            userId, activityId, couponCode);

        <span class="hljs-keyword">return</span> couponCode;
    }

    <span class="hljs-comment">/**
     * æ ¡éªŒæ´»åŠ¨çŠ¶æ€
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateActivity</span><span class="hljs-params">(CouponActivity activity)</span> {
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();

        <span class="hljs-keyword">if</span> (activity.getStatus() == <span class="hljs-number">4</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.ACTIVITY_STOPPED);
        }

        <span class="hljs-keyword">if</span> (now.isBefore(activity.getStartTime())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.ACTIVITY_NOT_START);
        }

        <span class="hljs-keyword">if</span> (now.isAfter(activity.getEndTime())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.ACTIVITY_ENDED);
        }
    }

    <span class="hljs-comment">/**
     * æ ¡éªŒç”¨æˆ·é¢†å–èµ„æ ¼
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateUserEligibility</span><span class="hljs-params">(Long userId, CouponActivity activity,
                                          CouponTemplate template)</span> {
        <span class="hljs-comment">// æ ¡éªŒç›®æ ‡ç”¨æˆ·ï¼ˆä¼šå‘˜ç­‰çº§ã€ç”¨æˆ·æ ‡ç­¾ç­‰ï¼‰</span>
        <span class="hljs-keyword">if</span> (activity.getTargetUser() != <span class="hljs-literal">null</span> &amp;&amp; !activity.getTargetUser().isEmpty()) {
            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> è°ƒç”¨ç”¨æˆ·æœåŠ¡æ ¡éªŒç”¨æˆ·æ ‡ç­¾</span>
        }

        <span class="hljs-comment">// æ ¡éªŒç”¨æˆ·å·²é¢†å–æ•°é‡</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">userReceiveKey</span> <span class="hljs-operator">=</span> USER_RECEIVE_KEY + activity.getId() + <span class="hljs-string">":"</span> + userId;
        <span class="hljs-type">Object</span> <span class="hljs-variable">receivedCount</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(userReceiveKey);

        <span class="hljs-keyword">if</span> (receivedCount != <span class="hljs-literal">null</span> &amp;&amp; Integer.parseInt(receivedCount.toString()) &gt;= template.getUserLimit()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.COUPON_RECEIVE_LIMIT);
        }
    }

    <span class="hljs-comment">/**
     * æ‰§è¡Œé¢†åˆ¸Luaè„šæœ¬
     */</span>
    <span class="hljs-keyword">private</span> Long <span class="hljs-title function_">executeReceiveScript</span><span class="hljs-params">(Long userId, Long activityId, Integer userLimit)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">stockKey</span> <span class="hljs-operator">=</span> ACTIVITY_STOCK_KEY + activityId;
        <span class="hljs-type">String</span> <span class="hljs-variable">userKey</span> <span class="hljs-operator">=</span> USER_RECEIVE_KEY + activityId + <span class="hljs-string">":"</span> + userId;

        <span class="hljs-keyword">return</span> redisTemplate.execute(
            receiveScript,
            Arrays.asList(stockKey, userKey),
            userLimit
        );
    }

    <span class="hljs-comment">/**
     * æ›´æ–°é¢†å–è®°å½•
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateReceiveRecord</span><span class="hljs-params">(Long userId, Long activityId, Long templateId)</span> {
        <span class="hljs-type">CouponReceiveRecord</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> receiveRecordMapper.selectOne(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;CouponReceiveRecord&gt;()
                .eq(CouponReceiveRecord::getUserId, userId)
                .eq(CouponReceiveRecord::getActivityId, activityId)
        );

        <span class="hljs-keyword">if</span> (record == <span class="hljs-literal">null</span>) {
            record = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponReceiveRecord</span>();
            record.setUserId(userId);
            record.setTemplateId(templateId);
            record.setActivityId(activityId);
            record.setReceiveCount(<span class="hljs-number">1</span>);
            receiveRecordMapper.insert(record);
        } <span class="hljs-keyword">else</span> {
            record.setReceiveCount(record.getReceiveCount() + <span class="hljs-number">1</span>);
            receiveRecordMapper.updateById(record);
        }
    }
}
</code></pre>
<h4 data-id="heading-19">5.3 é¢†åˆ¸Luaè„šæœ¬</h4>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- é¢†åˆ¸Luaè„šæœ¬</span>
<span class="hljs-comment">-- KEYS[1]: æ´»åŠ¨åº“å­˜key</span>
<span class="hljs-comment">-- KEYS[2]: ç”¨æˆ·é¢†å–è®°å½•key</span>
<span class="hljs-comment">-- ARGV[1]: ç”¨æˆ·é™é¢†æ•°é‡</span>

<span class="hljs-keyword">local</span> stockKey = KEYS[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> userKey = KEYS[<span class="hljs-number">2</span>]
<span class="hljs-keyword">local</span> userLimit = <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">1</span>])

<span class="hljs-comment">-- æ£€æŸ¥åº“å­˜</span>
<span class="hljs-keyword">local</span> stock = <span class="hljs-built_in">tonumber</span>(redis.call(<span class="hljs-string">'GET'</span>, stockKey) <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
<span class="hljs-keyword">if</span> stock &lt;= <span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>  <span class="hljs-comment">-- åº“å­˜ä¸è¶³</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- æ£€æŸ¥ç”¨æˆ·é¢†å–æ•°é‡</span>
<span class="hljs-keyword">local</span> userReceived = <span class="hljs-built_in">tonumber</span>(redis.call(<span class="hljs-string">'GET'</span>, userKey) <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>)
<span class="hljs-keyword">if</span> userReceived &gt;= userLimit <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">-2</span>  <span class="hljs-comment">-- è¶…è¿‡é™é¢†æ•°é‡</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- æ‰£å‡åº“å­˜</span>
redis.call(<span class="hljs-string">'DECR'</span>, stockKey)

<span class="hljs-comment">-- å¢åŠ ç”¨æˆ·é¢†å–æ•°é‡</span>
redis.call(<span class="hljs-string">'INCR'</span>, userKey)
redis.call(<span class="hljs-string">'EXPIRE'</span>, userKey, <span class="hljs-number">86400</span> * <span class="hljs-number">30</span>)  <span class="hljs-comment">-- 30å¤©è¿‡æœŸ</span>

<span class="hljs-keyword">return</span> stock - <span class="hljs-number">1</span>  <span class="hljs-comment">-- è¿”å›å‰©ä½™åº“å­˜</span>
</code></pre>
<h4 data-id="heading-20">5.4 åˆ¸ç ç”Ÿæˆå™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.utils;

<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.time.format.DateTimeFormatter;
<span class="hljs-keyword">import</span> java.util.concurrent.ThreadLocalRandom;

<span class="hljs-comment">/**
 * åˆ¸ç ç”Ÿæˆå™¨
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponCodeGenerator</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CHARS</span> <span class="hljs-operator">=</span> <span class="hljs-string">"ABCDEFGHJKLMNPQRSTUVWXYZ23456789"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">FORMATTER</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyMMdd"</span>);

    <span class="hljs-comment">/**
     * ç”Ÿæˆåˆ¸ç 
     * æ ¼å¼ï¼šæ—¥æœŸ(6ä½) + éšæœºå­—ç¬¦(10ä½) = 16ä½
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generate</span><span class="hljs-params">()</span> {
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();

        <span class="hljs-comment">// æ—¥æœŸéƒ¨åˆ†</span>
        sb.append(LocalDateTime.now().format(FORMATTER));

        <span class="hljs-comment">// éšæœºå­—ç¬¦éƒ¨åˆ†</span>
        <span class="hljs-type">ThreadLocalRandom</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> ThreadLocalRandom.current();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            sb.append(CHARS.charAt(random.nextInt(CHARS.length())));
        }

        <span class="hljs-keyword">return</span> sb.toString();
    }

    <span class="hljs-comment">/**
     * ç”Ÿæˆå¸¦å‰ç¼€çš„åˆ¸ç 
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateWithPrefix</span><span class="hljs-params">(String prefix)</span> {
        <span class="hljs-keyword">return</span> prefix + generate();
    }
}
</code></pre>
<h3 data-id="heading-21">å…­ã€ç”¨åˆ¸æœåŠ¡å®ç°</h3>
<h4 data-id="heading-22">6.1 ä¼˜æƒ è®¡ç®—æµç¨‹</h4>
<pre><code class="hljs language-lua" lang="lua">                         +<span class="hljs-comment">------------------+</span>
                         |    è®¢å•å•†å“åˆ—è¡¨   |
                         +<span class="hljs-comment">--------+---------+</span>
                                  |
                         +<span class="hljs-comment">--------v---------+</span>
                         |   æŸ¥è¯¢å¯ç”¨åˆ¸åˆ—è¡¨   |
                         +<span class="hljs-comment">--------+---------+</span>
                                  |
         +<span class="hljs-comment">------------------------+------------------------+</span>
         |                        |                        |
+<span class="hljs-comment">--------v--------+     +---------v--------+     +---------v--------+</span>
|   æ»¡å‡åˆ¸è®¡ç®—     |     |   æŠ˜æ‰£åˆ¸è®¡ç®—      |     |   ç«‹å‡åˆ¸è®¡ç®—      |
|  thresholdæ ¡éªŒ  |     |  discountRate    |     |  ç›´æ¥å‡å…         |
|  é€‚ç”¨å•†å“ç­›é€‰   |     |  maxDiscountä¸Šé™  |     |                  |
+<span class="hljs-comment">--------+--------+     +---------+--------+     +---------+--------+</span>
         |                        |                        |
         +<span class="hljs-comment">------------------------+------------------------+</span>
                                  |
                         +<span class="hljs-comment">--------v---------+</span>
                         |   æœ€ä¼˜ç»„åˆè®¡ç®—    |
                         +<span class="hljs-comment">--------+---------+</span>
                                  |
                         +<span class="hljs-comment">--------v---------+</span>
                         |   è¿”å›ä¼˜æƒ æ˜ç»†    |
                         +<span class="hljs-comment">------------------+</span>
</code></pre>
<h4 data-id="heading-23">6.2 ä¼˜æƒ è®¡ç®—æœåŠ¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.service;

<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;
<span class="hljs-keyword">import</span> com.coupon.service.dto.CouponRuleDTO;
<span class="hljs-keyword">import</span> com.coupon.service.dto.OrderItemDTO;
<span class="hljs-keyword">import</span> com.coupon.service.dto.CouponCalculateResult;
<span class="hljs-keyword">import</span> com.coupon.service.dto.UserCouponDTO;
<span class="hljs-keyword">import</span> com.coupon.service.entity.CouponTemplate;
<span class="hljs-keyword">import</span> com.coupon.service.entity.UserCoupon;
<span class="hljs-keyword">import</span> com.coupon.service.enums.CouponCategoryEnum;
<span class="hljs-keyword">import</span> com.coupon.service.enums.UserCouponStatusEnum;
<span class="hljs-keyword">import</span> com.coupon.service.mapper.CouponTemplateMapper;
<span class="hljs-keyword">import</span> com.coupon.service.mapper.UserCouponMapper;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.math.RoundingMode;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-comment">/**
 * ä¼˜æƒ åˆ¸è®¡ç®—æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponCalculateService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserCouponMapper userCouponMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponTemplateMapper templateMapper;

    <span class="hljs-comment">/**
     * è®¡ç®—è®¢å•å¯ç”¨ä¼˜æƒ åˆ¸
     */</span>
    <span class="hljs-keyword">public</span> List&lt;CouponCalculateResult&gt; <span class="hljs-title function_">calculateAvailableCoupons</span><span class="hljs-params">(
            Long userId, List&lt;OrderItemDTO&gt; orderItems)</span> {

        <span class="hljs-comment">// 1. æŸ¥è¯¢ç”¨æˆ·æœªä½¿ç”¨çš„æœ‰æ•ˆåˆ¸</span>
        List&lt;UserCoupon&gt; userCoupons = userCouponMapper.selectAvailableCoupons(
            userId, UserCouponStatusEnum.UNUSED.getCode(), LocalDateTime.now());

        <span class="hljs-keyword">if</span> (userCoupons.isEmpty()) {
            <span class="hljs-keyword">return</span> Collections.emptyList();
        }

        <span class="hljs-comment">// 2. è·å–åˆ¸æ¨¡æ¿ä¿¡æ¯</span>
        List&lt;Long&gt; templateIds = userCoupons.stream()
            .map(UserCoupon::getTemplateId)
            .distinct()
            .collect(Collectors.toList());

        Map&lt;Long, CouponTemplate&gt; templateMap = templateMapper.selectBatchIds(templateIds)
            .stream()
            .collect(Collectors.toMap(CouponTemplate::getId, t -&gt; t));

        <span class="hljs-comment">// 3. è®¡ç®—æ¯å¼ åˆ¸çš„ä¼˜æƒ é‡‘é¢</span>
        List&lt;CouponCalculateResult&gt; results = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-keyword">for</span> (UserCoupon userCoupon : userCoupons) {
            <span class="hljs-type">CouponTemplate</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> templateMap.get(userCoupon.getTemplateId());
            <span class="hljs-keyword">if</span> (template == <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>;

            <span class="hljs-type">CouponCalculateResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> calculateSingleCoupon(
                userCoupon, template, orderItems);

            <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span> &amp;&amp; result.isAvailable()) {
                results.add(result);
            }
        }

        <span class="hljs-comment">// 4. æŒ‰ä¼˜æƒ é‡‘é¢é™åºæ’åº</span>
        results.sort((a, b) -&gt; b.getDiscountAmount().compareTo(a.getDiscountAmount()));

        <span class="hljs-keyword">return</span> results;
    }

    <span class="hljs-comment">/**
     * è®¡ç®—å•å¼ åˆ¸çš„ä¼˜æƒ 
     */</span>
    <span class="hljs-keyword">private</span> CouponCalculateResult <span class="hljs-title function_">calculateSingleCoupon</span><span class="hljs-params">(
            UserCoupon userCoupon, CouponTemplate template, List&lt;OrderItemDTO&gt; orderItems)</span> {

        <span class="hljs-type">CouponCalculateResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponCalculateResult</span>();
        result.setCouponCode(userCoupon.getCouponCode());
        result.setCouponName(template.getName());
        result.setCategory(template.getCategory());

        <span class="hljs-comment">// 1. ç­›é€‰é€‚ç”¨å•†å“</span>
        List&lt;OrderItemDTO&gt; applicableItems = filterApplicableItems(template, orderItems);

        <span class="hljs-keyword">if</span> (applicableItems.isEmpty()) {
            result.setAvailable(<span class="hljs-literal">false</span>);
            result.setUnavailableReason(<span class="hljs-string">"æ— é€‚ç”¨å•†å“"</span>);
            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-comment">// 2. è®¡ç®—é€‚ç”¨å•†å“æ€»é‡‘é¢</span>
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">applicableAmount</span> <span class="hljs-operator">=</span> applicableItems.stream()
            .map(item -&gt; item.getPrice().multiply(BigDecimal.valueOf(item.getQuantity())))
            .reduce(BigDecimal.ZERO, BigDecimal::add);

        <span class="hljs-comment">// 3. æ ¡éªŒä½¿ç”¨é—¨æ§›</span>
        <span class="hljs-keyword">if</span> (applicableAmount.compareTo(template.getThreshold()) &lt; <span class="hljs-number">0</span>) {
            result.setAvailable(<span class="hljs-literal">false</span>);
            result.setUnavailableReason(String.format(<span class="hljs-string">"æœªæ»¡%.2få…ƒ"</span>, template.getThreshold()));
            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-comment">// 4. è®¡ç®—ä¼˜æƒ é‡‘é¢</span>
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">discountAmount</span> <span class="hljs-operator">=</span> calculateDiscount(template, applicableAmount);

        result.setAvailable(<span class="hljs-literal">true</span>);
        result.setApplicableAmount(applicableAmount);
        result.setDiscountAmount(discountAmount);
        result.setApplicableItems(applicableItems);

        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-comment">/**
     * ç­›é€‰é€‚ç”¨å•†å“
     */</span>
    <span class="hljs-keyword">private</span> List&lt;OrderItemDTO&gt; <span class="hljs-title function_">filterApplicableItems</span><span class="hljs-params">(
            CouponTemplate template, List&lt;OrderItemDTO&gt; orderItems)</span> {

        <span class="hljs-comment">// è§£æä½¿ç”¨è§„åˆ™</span>
        <span class="hljs-type">CouponRuleDTO</span> <span class="hljs-variable">rule</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">if</span> (template.getRuleJson() != <span class="hljs-literal">null</span> &amp;&amp; !template.getRuleJson().isEmpty()) {
            rule = JSON.parseObject(template.getRuleJson(), CouponRuleDTO.class);
        }

        <span class="hljs-comment">// é€šç”¨åˆ¸ï¼Œæ‰€æœ‰å•†å“é€‚ç”¨</span>
        <span class="hljs-keyword">if</span> (template.getProductLine() == <span class="hljs-number">1</span> || rule == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(orderItems);
        }

        <span class="hljs-keyword">final</span> <span class="hljs-type">CouponRuleDTO</span> <span class="hljs-variable">finalRule</span> <span class="hljs-operator">=</span> rule;

        <span class="hljs-keyword">return</span> orderItems.stream()
            .filter(item -&gt; isItemApplicable(item, template.getProductLine(), finalRule))
            .collect(Collectors.toList());
    }

    <span class="hljs-comment">/**
     * åˆ¤æ–­å•†å“æ˜¯å¦é€‚ç”¨
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isItemApplicable</span><span class="hljs-params">(OrderItemDTO item, Integer productLine, CouponRuleDTO rule)</span> {
        <span class="hljs-comment">// æ’é™¤å•†å“æ ¡éªŒ</span>
        <span class="hljs-keyword">if</span> (rule.getExcludeProductIds() != <span class="hljs-literal">null</span> &amp;&amp;
            rule.getExcludeProductIds().contains(item.getProductId())) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// æ’é™¤å“ç±»æ ¡éªŒ</span>
        <span class="hljs-keyword">if</span> (rule.getExcludeCategoryIds() != <span class="hljs-literal">null</span> &amp;&amp;
            rule.getExcludeCategoryIds().contains(item.getCategoryId())) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">switch</span> (productLine) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:  <span class="hljs-comment">// å“ç±»åˆ¸</span>
                <span class="hljs-keyword">return</span> rule.getCategoryIds() != <span class="hljs-literal">null</span> &amp;&amp;
                       rule.getCategoryIds().contains(item.getCategoryId());
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:  <span class="hljs-comment">// åº—é“ºåˆ¸</span>
                <span class="hljs-keyword">return</span> rule.getShopIds() != <span class="hljs-literal">null</span> &amp;&amp;
                       rule.getShopIds().contains(item.getShopId());
            <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:  <span class="hljs-comment">// å•å“åˆ¸</span>
                <span class="hljs-keyword">return</span> rule.getProductIds() != <span class="hljs-literal">null</span> &amp;&amp;
                       rule.getProductIds().contains(item.getProductId());
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }

    <span class="hljs-comment">/**
     * è®¡ç®—ä¼˜æƒ é‡‘é¢
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal <span class="hljs-title function_">calculateDiscount</span><span class="hljs-params">(CouponTemplate template, BigDecimal applicableAmount)</span> {
        <span class="hljs-type">CouponCategoryEnum</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> CouponCategoryEnum.of(template.getCategory());

        <span class="hljs-keyword">if</span> (category == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> BigDecimal.ZERO;
        }

        <span class="hljs-keyword">switch</span> (category) {
            <span class="hljs-keyword">case</span> FULL_REDUCTION:
            <span class="hljs-keyword">case</span> IMMEDIATE_REDUCTION:
                <span class="hljs-comment">// æ»¡å‡åˆ¸ã€ç«‹å‡åˆ¸ï¼šç›´æ¥è¿”å›ä¼˜æƒ é‡‘é¢</span>
                <span class="hljs-keyword">return</span> template.getDiscountAmount();

            <span class="hljs-keyword">case</span> DISCOUNT:
                <span class="hljs-comment">// æŠ˜æ‰£åˆ¸ï¼šè®¡ç®—æŠ˜æ‰£é‡‘é¢ï¼Œä½†ä¸è¶…è¿‡ä¸Šé™</span>
                <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">discount</span> <span class="hljs-operator">=</span> applicableAmount
                    .multiply(BigDecimal.ONE.subtract(template.getDiscountRate()))
                    .setScale(<span class="hljs-number">2</span>, RoundingMode.HALF_UP);

                <span class="hljs-comment">// æ ¡éªŒæœ€å¤§ä¼˜æƒ ä¸Šé™</span>
                <span class="hljs-keyword">if</span> (template.getMaxDiscount() != <span class="hljs-literal">null</span> &amp;&amp;
                    discount.compareTo(template.getMaxDiscount()) &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">return</span> template.getMaxDiscount();
                }
                <span class="hljs-keyword">return</span> discount;

            <span class="hljs-keyword">case</span> FREIGHT:
                <span class="hljs-comment">// è¿è´¹åˆ¸ï¼šè¿”å›è¿è´¹é‡‘é¢ï¼ˆç”±è®¢å•æœåŠ¡ä¼ å…¥ï¼‰</span>
                <span class="hljs-keyword">return</span> template.getDiscountAmount();

            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> BigDecimal.ZERO;
        }
    }

    <span class="hljs-comment">/**
     * è®¡ç®—æœ€ä¼˜åˆ¸ç»„åˆï¼ˆæ”¯æŒå åŠ ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> List&lt;CouponCalculateResult&gt; <span class="hljs-title function_">calculateBestCombination</span><span class="hljs-params">(
            Long userId, List&lt;OrderItemDTO&gt; orderItems, Integer maxStack)</span> {

        List&lt;CouponCalculateResult&gt; availableCoupons = calculateAvailableCoupons(userId, orderItems);

        <span class="hljs-keyword">if</span> (availableCoupons.isEmpty()) {
            <span class="hljs-keyword">return</span> Collections.emptyList();
        }

        <span class="hljs-comment">// ä¸æ”¯æŒå åŠ ï¼Œè¿”å›æœ€ä¼˜å•å¼ åˆ¸</span>
        <span class="hljs-keyword">if</span> (maxStack == <span class="hljs-literal">null</span> || maxStack &lt;= <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> Collections.singletonList(availableCoupons.get(<span class="hljs-number">0</span>));
        }

        <span class="hljs-comment">// æ”¯æŒå åŠ ï¼šä½¿ç”¨è´ªå¿ƒç®—æ³•é€‰æ‹©æœ€ä¼˜ç»„åˆ</span>
        <span class="hljs-keyword">return</span> selectBestCombination(availableCoupons, orderItems, maxStack);
    }

    <span class="hljs-comment">/**
     * è´ªå¿ƒç®—æ³•é€‰æ‹©æœ€ä¼˜åˆ¸ç»„åˆ
     */</span>
    <span class="hljs-keyword">private</span> List&lt;CouponCalculateResult&gt; <span class="hljs-title function_">selectBestCombination</span><span class="hljs-params">(
            List&lt;CouponCalculateResult&gt; coupons, List&lt;OrderItemDTO&gt; orderItems, <span class="hljs-type">int</span> maxStack)</span> {

        List&lt;CouponCalculateResult&gt; selected = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        Set&lt;Long&gt; usedProducts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">totalDiscount</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;

        <span class="hljs-comment">// æŒ‰ä¼˜æƒ é‡‘é¢æ’åºï¼Œä¼˜å…ˆé€‰æ‹©ä¼˜æƒ å¤§çš„</span>
        List&lt;CouponCalculateResult&gt; sorted = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(coupons);
        sorted.sort((a, b) -&gt; b.getDiscountAmount().compareTo(a.getDiscountAmount()));

        <span class="hljs-keyword">for</span> (CouponCalculateResult coupon : sorted) {
            <span class="hljs-keyword">if</span> (selected.size() &gt;= maxStack) {
                <span class="hljs-keyword">break</span>;
            }

            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰å•†å“é‡å ï¼ˆç®€åŒ–å¤„ç†ï¼šä¸å…è®¸åŒä¸€å•†å“ä½¿ç”¨å¤šå¼ åˆ¸ï¼‰</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">hasOverlap</span> <span class="hljs-operator">=</span> coupon.getApplicableItems().stream()
                .anyMatch(item -&gt; usedProducts.contains(item.getProductId()));

            <span class="hljs-keyword">if</span> (!hasOverlap) {
                selected.add(coupon);
                totalDiscount = totalDiscount.add(coupon.getDiscountAmount());

                <span class="hljs-comment">// æ ‡è®°å·²ä½¿ç”¨çš„å•†å“</span>
                coupon.getApplicableItems().forEach(item -&gt;
                    usedProducts.add(item.getProductId()));
            }
        }

        <span class="hljs-keyword">return</span> selected;
    }
}
</code></pre>
<h4 data-id="heading-24">6.3 è®¡ç®—ç»“æœDTO</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.dto;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * ä¼˜æƒ åˆ¸è®¡ç®—ç»“æœ
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponCalculateResult</span> {

    <span class="hljs-comment">/**
     * åˆ¸ç 
     */</span>
    <span class="hljs-keyword">private</span> String couponCode;

    <span class="hljs-comment">/**
     * åˆ¸åç§°
     */</span>
    <span class="hljs-keyword">private</span> String couponName;

    <span class="hljs-comment">/**
     * åˆ¸ç±»å‹
     */</span>
    <span class="hljs-keyword">private</span> Integer category;

    <span class="hljs-comment">/**
     * æ˜¯å¦å¯ç”¨
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> available;

    <span class="hljs-comment">/**
     * ä¸å¯ç”¨åŸå› 
     */</span>
    <span class="hljs-keyword">private</span> String unavailableReason;

    <span class="hljs-comment">/**
     * é€‚ç”¨å•†å“æ€»é‡‘é¢
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal applicableAmount;

    <span class="hljs-comment">/**
     * ä¼˜æƒ é‡‘é¢
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal discountAmount;

    <span class="hljs-comment">/**
     * é€‚ç”¨å•†å“åˆ—è¡¨
     */</span>
    <span class="hljs-keyword">private</span> List&lt;OrderItemDTO&gt; applicableItems;
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.dto;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.math.BigDecimal;

<span class="hljs-comment">/**
 * è®¢å•å•†å“DTO
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderItemDTO</span> {

    <span class="hljs-comment">/**
     * å•†å“ID
     */</span>
    <span class="hljs-keyword">private</span> Long productId;

    <span class="hljs-comment">/**
     * å•†å“åç§°
     */</span>
    <span class="hljs-keyword">private</span> String productName;

    <span class="hljs-comment">/**
     * å“ç±»ID
     */</span>
    <span class="hljs-keyword">private</span> Long categoryId;

    <span class="hljs-comment">/**
     * åº—é“ºID
     */</span>
    <span class="hljs-keyword">private</span> Long shopId;

    <span class="hljs-comment">/**
     * å•†å“å•ä»·
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal price;

    <span class="hljs-comment">/**
     * è´­ä¹°æ•°é‡
     */</span>
    <span class="hljs-keyword">private</span> Integer quantity;

    <span class="hljs-comment">/**
     * å•†å“å°è®¡
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal subtotal;
}
</code></pre>
<h3 data-id="heading-25">ä¸ƒã€ç”¨åˆ¸æ ¸é”€æœåŠ¡</h3>
<h4 data-id="heading-26">7.1 æ ¸é”€æµç¨‹</h4>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">----------+     +----------+     +----------+     +----------+     +----------+</span>
| å‚æ•°æ ¡éªŒ  | <span class="hljs-comment">--&gt; | åˆ¸çŠ¶æ€æ ¡éªŒ | --&gt; | æœ‰æ•ˆæœŸæ ¡éªŒ | --&gt; | è§„åˆ™æ ¡éªŒ  | --&gt; | å†»ç»“ä¼˜æƒ åˆ¸ |</span>
+<span class="hljs-comment">----------+     +----------+     +----------+     +----------+     +----------+</span>
                                                                          |
                                                                          v
+<span class="hljs-comment">----------+     +----------+     +----------+                      +----------+</span>
| ä½¿ç”¨è®°å½•  | &lt;<span class="hljs-comment">-- | æ›´æ–°çŠ¶æ€  | &lt;-- | è®¢å•æ”¯ä»˜  | &lt;------------------ | é¢„å ä¼˜æƒ åˆ¸ |</span>
+<span class="hljs-comment">----------+     +----------+     +----------+                      +----------+</span>
                      |
                      v
               +<span class="hljs-comment">----------+</span>
               | è®¢å•å–æ¶ˆ  |
               | é‡Šæ”¾åˆ¸    |
               +<span class="hljs-comment">----------+</span>
</code></pre>
<h4 data-id="heading-27">7.2 æ ¸é”€æœåŠ¡å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.service;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;
<span class="hljs-keyword">import</span> com.coupon.common.exception.CouponException;
<span class="hljs-keyword">import</span> com.coupon.common.result.ResultCode;
<span class="hljs-keyword">import</span> com.coupon.service.dto.UseCouponRequest;
<span class="hljs-keyword">import</span> com.coupon.service.entity.CouponTemplate;
<span class="hljs-keyword">import</span> com.coupon.service.entity.CouponUseRecord;
<span class="hljs-keyword">import</span> com.coupon.service.entity.UserCoupon;
<span class="hljs-keyword">import</span> com.coupon.service.enums.UserCouponStatusEnum;
<span class="hljs-keyword">import</span> com.coupon.service.mapper.CouponTemplateMapper;
<span class="hljs-keyword">import</span> com.coupon.service.mapper.CouponUseRecordMapper;
<span class="hljs-keyword">import</span> com.coupon.service.mapper.UserCouponMapper;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.redisson.api.RLock;
<span class="hljs-keyword">import</span> org.redisson.api.RedissonClient;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * ä¼˜æƒ åˆ¸æ ¸é”€æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponUseService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserCouponMapper userCouponMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponTemplateMapper templateMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponUseRecordMapper useRecordMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponCalculateService calculateService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RedissonClient redissonClient;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">COUPON_LOCK_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"coupon:lock:"</span>;

    <span class="hljs-comment">/**
     * é¢„å ä¼˜æƒ åˆ¸ï¼ˆä¸‹å•æ—¶è°ƒç”¨ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lockCoupon</span><span class="hljs-params">(Long userId, String couponCode, String orderNo)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> COUPON_LOCK_PREFIX + couponCode;
        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(lockKey);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">boolean</span> <span class="hljs-variable">acquired</span> <span class="hljs-operator">=</span> lock.tryLock(<span class="hljs-number">3</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);
            <span class="hljs-keyword">if</span> (!acquired) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.COUPON_BUSY);
            }

            <span class="hljs-comment">// 1. æŸ¥è¯¢ä¼˜æƒ åˆ¸</span>
            <span class="hljs-type">UserCoupon</span> <span class="hljs-variable">userCoupon</span> <span class="hljs-operator">=</span> userCouponMapper.selectByCode(couponCode);
            <span class="hljs-keyword">if</span> (userCoupon == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.COUPON_NOT_EXIST);
            }

            <span class="hljs-comment">// 2. æ ¡éªŒåˆ¸å½’å±</span>
            <span class="hljs-keyword">if</span> (!userCoupon.getUserId().equals(userId)) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.COUPON_NOT_BELONG);
            }

            <span class="hljs-comment">// 3. æ ¡éªŒåˆ¸çŠ¶æ€</span>
            <span class="hljs-keyword">if</span> (!UserCouponStatusEnum.UNUSED.getCode().equals(userCoupon.getStatus())) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.COUPON_STATUS_ERROR);
            }

            <span class="hljs-comment">// 4. æ ¡éªŒæœ‰æ•ˆæœŸ</span>
            <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();
            <span class="hljs-keyword">if</span> (now.isBefore(userCoupon.getValidStartTime()) ||
                now.isAfter(userCoupon.getValidEndTime())) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.COUPON_EXPIRED);
            }

            <span class="hljs-comment">// 5. å†»ç»“ä¼˜æƒ åˆ¸</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">affected</span> <span class="hljs-operator">=</span> userCouponMapper.update(<span class="hljs-literal">null</span>,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;UserCoupon&gt;()
                    .eq(UserCoupon::getCouponCode, couponCode)
                    .eq(UserCoupon::getStatus, UserCouponStatusEnum.UNUSED.getCode())
                    .set(UserCoupon::getStatus, UserCouponStatusEnum.FROZEN.getCode())
                    .set(UserCoupon::getOrderNo, orderNo)
            );

            <span class="hljs-keyword">if</span> (affected == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.COUPON_STATUS_ERROR);
            }

            log.info(<span class="hljs-string">"ä¼˜æƒ åˆ¸é¢„å æˆåŠŸ: couponCode={}, orderNo={}"</span>, couponCode, orderNo);

        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.SYSTEM_ERROR);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (lock.isHeldByCurrentThread()) {
                lock.unlock();
            }
        }
    }

    <span class="hljs-comment">/**
     * ä½¿ç”¨ä¼˜æƒ åˆ¸ï¼ˆæ”¯ä»˜æˆåŠŸåè°ƒç”¨ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">useCoupon</span><span class="hljs-params">(UseCouponRequest request)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">couponCode</span> <span class="hljs-operator">=</span> request.getCouponCode();

        <span class="hljs-comment">// 1. æŸ¥è¯¢ä¼˜æƒ åˆ¸</span>
        <span class="hljs-type">UserCoupon</span> <span class="hljs-variable">userCoupon</span> <span class="hljs-operator">=</span> userCouponMapper.selectByCode(couponCode);
        <span class="hljs-keyword">if</span> (userCoupon == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.COUPON_NOT_EXIST);
        }

        <span class="hljs-comment">// 2. æ ¡éªŒçŠ¶æ€ï¼ˆå¿…é¡»æ˜¯å†»ç»“çŠ¶æ€ï¼‰</span>
        <span class="hljs-keyword">if</span> (!UserCouponStatusEnum.FROZEN.getCode().equals(userCoupon.getStatus())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.COUPON_STATUS_ERROR);
        }

        <span class="hljs-comment">// 3. æ ¡éªŒè®¢å•å·</span>
        <span class="hljs-keyword">if</span> (!request.getOrderNo().equals(userCoupon.getOrderNo())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponException</span>(ResultCode.COUPON_ORDER_NOT_MATCH);
        }

        <span class="hljs-comment">// 4. æ›´æ–°ä¸ºå·²ä½¿ç”¨</span>
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();
        userCouponMapper.update(<span class="hljs-literal">null</span>,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;UserCoupon&gt;()
                .eq(UserCoupon::getCouponCode, couponCode)
                .set(UserCoupon::getStatus, UserCouponStatusEnum.USED.getCode())
                .set(UserCoupon::getUseTime, now)
        );

        <span class="hljs-comment">// 5. è®°å½•ä½¿ç”¨æµæ°´</span>
        <span class="hljs-type">CouponUseRecord</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponUseRecord</span>();
        record.setCouponCode(couponCode);
        record.setUserId(userCoupon.getUserId());
        record.setOrderNo(request.getOrderNo());
        record.setOrderAmount(request.getOrderAmount());
        record.setDiscountAmount(request.getDiscountAmount());
        record.setUseTime(now);

        useRecordMapper.insert(record);

        log.info(<span class="hljs-string">"ä¼˜æƒ åˆ¸æ ¸é”€æˆåŠŸ: couponCode={}, orderNo={}, discountAmount={}"</span>,
            couponCode, request.getOrderNo(), request.getDiscountAmount());
    }

    <span class="hljs-comment">/**
     * é‡Šæ”¾ä¼˜æƒ åˆ¸ï¼ˆè®¢å•å–æ¶ˆ/æ”¯ä»˜è¶…æ—¶æ—¶è°ƒç”¨ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseCoupon</span><span class="hljs-params">(String couponCode, String orderNo)</span> {
        <span class="hljs-comment">// 1. æŸ¥è¯¢ä¼˜æƒ åˆ¸</span>
        <span class="hljs-type">UserCoupon</span> <span class="hljs-variable">userCoupon</span> <span class="hljs-operator">=</span> userCouponMapper.selectByCode(couponCode);
        <span class="hljs-keyword">if</span> (userCoupon == <span class="hljs-literal">null</span>) {
            log.warn(<span class="hljs-string">"ä¼˜æƒ åˆ¸ä¸å­˜åœ¨ï¼Œè·³è¿‡é‡Šæ”¾: couponCode={}"</span>, couponCode);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 2. æ ¡éªŒçŠ¶æ€</span>
        <span class="hljs-keyword">if</span> (!UserCouponStatusEnum.FROZEN.getCode().equals(userCoupon.getStatus())) {
            log.warn(<span class="hljs-string">"ä¼˜æƒ åˆ¸çŠ¶æ€ä¸æ˜¯å†»ç»“ï¼Œè·³è¿‡é‡Šæ”¾: couponCode={}, status={}"</span>,
                couponCode, userCoupon.getStatus());
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 3. æ ¡éªŒè®¢å•å·</span>
        <span class="hljs-keyword">if</span> (!orderNo.equals(userCoupon.getOrderNo())) {
            log.warn(<span class="hljs-string">"è®¢å•å·ä¸åŒ¹é…ï¼Œè·³è¿‡é‡Šæ”¾: couponCode={}, expectedOrder={}, actualOrder={}"</span>,
                couponCode, orderNo, userCoupon.getOrderNo());
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 4. æ£€æŸ¥æ˜¯å¦å·²è¿‡æœŸ</span>
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();
        Integer newStatus;
        <span class="hljs-keyword">if</span> (now.isAfter(userCoupon.getValidEndTime())) {
            newStatus = UserCouponStatusEnum.EXPIRED.getCode();
        } <span class="hljs-keyword">else</span> {
            newStatus = UserCouponStatusEnum.UNUSED.getCode();
        }

        <span class="hljs-comment">// 5. é‡Šæ”¾ä¼˜æƒ åˆ¸</span>
        userCouponMapper.update(<span class="hljs-literal">null</span>,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;UserCoupon&gt;()
                .eq(UserCoupon::getCouponCode, couponCode)
                .eq(UserCoupon::getOrderNo, orderNo)
                .set(UserCoupon::getStatus, newStatus)
                .set(UserCoupon::getOrderNo, <span class="hljs-literal">null</span>)
        );

        log.info(<span class="hljs-string">"ä¼˜æƒ åˆ¸é‡Šæ”¾æˆåŠŸ: couponCode={}, orderNo={}, newStatus={}"</span>,
            couponCode, orderNo, newStatus);
    }
}
</code></pre>
<h3 data-id="heading-28">å…«ã€è¿‡æœŸå¤„ç†æœåŠ¡</h3>
<h4 data-id="heading-29">8.1 è¿‡æœŸå¤„ç†æ–¹æ¡ˆ</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+------------------+------------------+------------------+</span>
|    å®šæ—¶æ‰«æ       |    å»¶è¿Ÿé˜Ÿåˆ—       |    è¢«åŠ¨è¿‡æœŸ       |
<span class="hljs-addition">+------------------+------------------+------------------+</span>
| ä¼˜ç‚¹ï¼šå®ç°ç®€å•    | ä¼˜ç‚¹ï¼šæ—¶æ•ˆæ€§å¥½    | ä¼˜ç‚¹ï¼šæ— é¢å¤–å¼€é”€   |
| ç¼ºç‚¹ï¼šæ—¶æ•ˆæ€§å·®    | ç¼ºç‚¹ï¼šæ¶ˆæ¯å †ç§¯    | ç¼ºç‚¹ï¼šæ•°æ®ä¸ä¸€è‡´   |
| é€‚ç”¨ï¼šT+1ç»“ç®—    | é€‚ç”¨ï¼šç²¾ç¡®è¿‡æœŸ    | é€‚ç”¨ï¼šæŸ¥è¯¢æ—¶æ ¡éªŒ   |
<span class="hljs-addition">+------------------+------------------+------------------+</span>
</code></pre>
<h4 data-id="heading-30">8.2 å®šæ—¶ä»»åŠ¡å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.job;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;
<span class="hljs-keyword">import</span> com.coupon.service.entity.UserCoupon;
<span class="hljs-keyword">import</span> com.coupon.service.enums.UserCouponStatusEnum;
<span class="hljs-keyword">import</span> com.coupon.service.mapper.UserCouponMapper;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.Scheduled;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * ä¼˜æƒ åˆ¸è¿‡æœŸå¤„ç†å®šæ—¶ä»»åŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponExpireJob</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserCouponMapper userCouponMapper;

    <span class="hljs-comment">/**
     * æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œå¤„ç†è¿‡æœŸåˆ¸
     */</span>
    <span class="hljs-meta">@Scheduled(cron = "0 0 * * * ?")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processExpiredCoupons</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"å¼€å§‹å¤„ç†è¿‡æœŸä¼˜æƒ åˆ¸..."</span>);

        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();
        <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">totalProcessed</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// åˆ†æ‰¹æŸ¥è¯¢è¿‡æœŸåˆ¸</span>
            List&lt;UserCoupon&gt; expiredCoupons = userCouponMapper.selectExpiredCoupons(
                UserCouponStatusEnum.UNUSED.getCode(),
                now,
                batchSize
            );

            <span class="hljs-keyword">if</span> (expiredCoupons.isEmpty()) {
                <span class="hljs-keyword">break</span>;
            }

            <span class="hljs-comment">// æ‰¹é‡æ›´æ–°çŠ¶æ€</span>
            List&lt;String&gt; couponCodes = expiredCoupons.stream()
                .map(UserCoupon::getCouponCode)
                .toList();

            <span class="hljs-type">int</span> <span class="hljs-variable">affected</span> <span class="hljs-operator">=</span> userCouponMapper.batchUpdateStatus(
                couponCodes,
                UserCouponStatusEnum.EXPIRED.getCode()
            );

            totalProcessed += affected;

            log.info(<span class="hljs-string">"æœ¬æ‰¹æ¬¡å¤„ç†è¿‡æœŸåˆ¸: {}"</span>, affected);

            <span class="hljs-comment">// å¦‚æœæœ¬æ‰¹æ¬¡æ•°æ®é‡å°äºæ‰¹æ¬¡å¤§å°ï¼Œè¯´æ˜å·²å¤„ç†å®Œ</span>
            <span class="hljs-keyword">if</span> (expiredCoupons.size() &lt; batchSize) {
                <span class="hljs-keyword">break</span>;
            }
        }

        log.info(<span class="hljs-string">"è¿‡æœŸä¼˜æƒ åˆ¸å¤„ç†å®Œæˆï¼Œå…±å¤„ç†: {}"</span>, totalProcessed);
    }

    <span class="hljs-comment">/**
     * å¤„ç†å†»ç»“è¶…æ—¶çš„åˆ¸ï¼ˆ30åˆ†é’Ÿæœªæ”¯ä»˜ï¼‰
     */</span>
    <span class="hljs-meta">@Scheduled(cron = "0 */5 * * * ?")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processFrozenTimeoutCoupons</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"å¼€å§‹å¤„ç†å†»ç»“è¶…æ—¶ä¼˜æƒ åˆ¸..."</span>);

        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">timeoutThreshold</span> <span class="hljs-operator">=</span> LocalDateTime.now().minusMinutes(<span class="hljs-number">30</span>);

        <span class="hljs-comment">// æŸ¥è¯¢å†»ç»“è¶…è¿‡30åˆ†é’Ÿçš„åˆ¸</span>
        List&lt;UserCoupon&gt; frozenCoupons = userCouponMapper.selectFrozenTimeout(
            UserCouponStatusEnum.FROZEN.getCode(),
            timeoutThreshold,
            <span class="hljs-number">500</span>
        );

        <span class="hljs-keyword">for</span> (UserCoupon coupon : frozenCoupons) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¿‡æœŸ</span>
                <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();
                <span class="hljs-type">Integer</span> <span class="hljs-variable">newStatus</span> <span class="hljs-operator">=</span> now.isAfter(coupon.getValidEndTime()) ?
                    UserCouponStatusEnum.EXPIRED.getCode() :
                    UserCouponStatusEnum.UNUSED.getCode();

                userCouponMapper.update(<span class="hljs-literal">null</span>,
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;UserCoupon&gt;()
                        .eq(UserCoupon::getCouponCode, coupon.getCouponCode())
                        .eq(UserCoupon::getStatus, UserCouponStatusEnum.FROZEN.getCode())
                        .set(UserCoupon::getStatus, newStatus)
                        .set(UserCoupon::getOrderNo, <span class="hljs-literal">null</span>)
                );

                log.info(<span class="hljs-string">"å†»ç»“è¶…æ—¶åˆ¸å·²é‡Šæ”¾: couponCode={}"</span>, coupon.getCouponCode());

            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"å¤„ç†å†»ç»“è¶…æ—¶åˆ¸å¤±è´¥: couponCode={}"</span>, coupon.getCouponCode(), e);
            }
        }

        log.info(<span class="hljs-string">"å†»ç»“è¶…æ—¶ä¼˜æƒ åˆ¸å¤„ç†å®Œæˆï¼Œå…±å¤„ç†: {}"</span>, frozenCoupons.size());
    }
}
</code></pre>
<h4 data-id="heading-31">8.3 å»¶è¿Ÿé˜Ÿåˆ—æ–¹æ¡ˆï¼ˆRocketMQï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.mq;

<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;
<span class="hljs-keyword">import</span> com.coupon.service.dto.CouponExpireMessage;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.apache.rocketmq.spring.core.RocketMQTemplate;
<span class="hljs-keyword">import</span> org.springframework.messaging.Message;
<span class="hljs-keyword">import</span> org.springframework.messaging.support.MessageBuilder;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.time.Duration;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-comment">/**
 * ä¼˜æƒ åˆ¸è¿‡æœŸæ¶ˆæ¯ç”Ÿäº§è€…
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponExpireProducer</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RocketMQTemplate rocketMQTemplate;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOPIC</span> <span class="hljs-operator">=</span> <span class="hljs-string">"coupon-expire-topic"</span>;

    <span class="hljs-comment">/**
     * å‘é€è¿‡æœŸæ¶ˆæ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendExpireMessage</span><span class="hljs-params">(String couponCode, LocalDateTime expireTime)</span> {
        <span class="hljs-type">CouponExpireMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponExpireMessage</span>();
        message.setCouponCode(couponCode);
        message.setExpireTime(expireTime);

        <span class="hljs-type">String</span> <span class="hljs-variable">jsonMessage</span> <span class="hljs-operator">=</span> JSON.toJSONString(message);
        Message&lt;String&gt; msg = MessageBuilder.withPayload(jsonMessage).build();

        <span class="hljs-comment">// è®¡ç®—å»¶è¿Ÿçº§åˆ«</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">delayLevel</span> <span class="hljs-operator">=</span> calculateDelayLevel(expireTime);

        rocketMQTemplate.syncSend(TOPIC, msg, <span class="hljs-number">3000</span>, delayLevel);

        log.debug(<span class="hljs-string">"è¿‡æœŸæ¶ˆæ¯å·²å‘é€: couponCode={}, expireTime={}"</span>, couponCode, expireTime);
    }

    <span class="hljs-comment">/**
     * è®¡ç®—å»¶è¿Ÿçº§åˆ«
     * RocketMQå»¶è¿Ÿçº§åˆ«ï¼š1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculateDelayLevel</span><span class="hljs-params">(LocalDateTime expireTime)</span> {
        <span class="hljs-type">Duration</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> Duration.between(LocalDateTime.now(), expireTime);
        <span class="hljs-type">long</span> <span class="hljs-variable">hours</span> <span class="hljs-operator">=</span> duration.toHours();

        <span class="hljs-keyword">if</span> (hours &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">17</span>;  <span class="hljs-comment">// 1h</span>
        <span class="hljs-keyword">if</span> (hours &lt;= <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">18</span>;  <span class="hljs-comment">// 2h</span>
        <span class="hljs-comment">// è¶…è¿‡2å°æ—¶çš„ï¼Œè®¾ç½®ä¸º2å°æ—¶åé‡æ–°è®¡ç®—</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">18</span>;
    }
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.mq;

<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;
<span class="hljs-keyword">import</span> com.coupon.service.dto.CouponExpireMessage;
<span class="hljs-keyword">import</span> com.coupon.service.entity.UserCoupon;
<span class="hljs-keyword">import</span> com.coupon.service.enums.UserCouponStatusEnum;
<span class="hljs-keyword">import</span> com.coupon.service.mapper.UserCouponMapper;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.apache.rocketmq.spring.annotation.RocketMQMessageListener;
<span class="hljs-keyword">import</span> org.apache.rocketmq.spring.core.RocketMQListener;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-comment">/**
 * ä¼˜æƒ åˆ¸è¿‡æœŸæ¶ˆæ¯æ¶ˆè´¹è€…
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-meta">@RocketMQMessageListener(
    topic = "coupon-expire-topic",
    consumerGroup = "coupon-expire-consumer-group"
)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponExpireConsumer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RocketMQListener</span>&lt;String&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserCouponMapper userCouponMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponExpireProducer expireProducer;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(String message)</span> {
        log.debug(<span class="hljs-string">"æ”¶åˆ°è¿‡æœŸæ¶ˆæ¯: {}"</span>, message);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">CouponExpireMessage</span> <span class="hljs-variable">expireMessage</span> <span class="hljs-operator">=</span> JSON.parseObject(message, CouponExpireMessage.class);
            <span class="hljs-type">String</span> <span class="hljs-variable">couponCode</span> <span class="hljs-operator">=</span> expireMessage.getCouponCode();
            <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">expireTime</span> <span class="hljs-operator">=</span> expireMessage.getExpireTime();

            <span class="hljs-comment">// æŸ¥è¯¢åˆ¸ä¿¡æ¯</span>
            <span class="hljs-type">UserCoupon</span> <span class="hljs-variable">userCoupon</span> <span class="hljs-operator">=</span> userCouponMapper.selectByCode(couponCode);
            <span class="hljs-keyword">if</span> (userCoupon == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// éæœªä½¿ç”¨çŠ¶æ€ï¼Œä¸å¤„ç†</span>
            <span class="hljs-keyword">if</span> (!UserCouponStatusEnum.UNUSED.getCode().equals(userCoupon.getStatus())) {
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();

            <span class="hljs-comment">// è¿˜æœªåˆ°è¿‡æœŸæ—¶é—´ï¼Œé‡æ–°å‘é€å»¶è¿Ÿæ¶ˆæ¯</span>
            <span class="hljs-keyword">if</span> (now.isBefore(expireTime)) {
                expireProducer.sendExpireMessage(couponCode, expireTime);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// æ›´æ–°ä¸ºè¿‡æœŸçŠ¶æ€</span>
            userCouponMapper.update(<span class="hljs-literal">null</span>,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;UserCoupon&gt;()
                    .eq(UserCoupon::getCouponCode, couponCode)
                    .eq(UserCoupon::getStatus, UserCouponStatusEnum.UNUSED.getCode())
                    .set(UserCoupon::getStatus, UserCouponStatusEnum.EXPIRED.getCode())
            );

            log.info(<span class="hljs-string">"ä¼˜æƒ åˆ¸å·²è¿‡æœŸ: couponCode={}"</span>, couponCode);

        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"å¤„ç†è¿‡æœŸæ¶ˆæ¯å¤±è´¥: {}"</span>, message, e);
        }
    }
}
</code></pre>
<h3 data-id="heading-32">ä¹ã€åº“å­˜ç®¡ç†</h3>
<h4 data-id="heading-33">9.1 åº“å­˜é¢„çƒ­</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.service;

<span class="hljs-keyword">import</span> com.coupon.service.entity.CouponActivity;
<span class="hljs-keyword">import</span> com.coupon.service.mapper.CouponActivityMapper;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.Scheduled;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> javax.annotation.PostConstruct;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * åº“å­˜ç®¡ç†æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StockService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponActivityMapper activityMapper;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ACTIVITY_STOCK_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"coupon:activity:stock:"</span>;

    <span class="hljs-comment">/**
     * å¯åŠ¨æ—¶é¢„çƒ­åº“å­˜
     */</span>
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">warmUpOnStartup</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"ç³»ç»Ÿå¯åŠ¨ï¼Œå¼€å§‹é¢„çƒ­ä¼˜æƒ åˆ¸åº“å­˜..."</span>);
        warmUpStock();
    }

    <span class="hljs-comment">/**
     * å®šæ—¶é¢„çƒ­åº“å­˜ï¼ˆæ¯5åˆ†é’Ÿï¼‰
     */</span>
    <span class="hljs-meta">@Scheduled(cron = "0 */5 * * * ?")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduledWarmUp</span><span class="hljs-params">()</span> {
        warmUpStock();
    }

    <span class="hljs-comment">/**
     * é¢„çƒ­åº“å­˜
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">warmUpStock</span><span class="hljs-params">()</span> {
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">future</span> <span class="hljs-operator">=</span> now.plusHours(<span class="hljs-number">1</span>);  <span class="hljs-comment">// é¢„çƒ­1å°æ—¶å†…çš„æ´»åŠ¨</span>

        <span class="hljs-comment">// æŸ¥è¯¢å³å°†å¼€å§‹æˆ–è¿›è¡Œä¸­çš„æ´»åŠ¨</span>
        List&lt;CouponActivity&gt; activities = activityMapper.selectActiveActivities(now, future);

        <span class="hljs-keyword">for</span> (CouponActivity activity : activities) {
            <span class="hljs-type">String</span> <span class="hljs-variable">stockKey</span> <span class="hljs-operator">=</span> ACTIVITY_STOCK_KEY + activity.getId();

            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²é¢„çƒ­</span>
            <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(redisTemplate.hasKey(stockKey))) {
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-comment">// é¢„çƒ­åº“å­˜</span>
            redisTemplate.opsForValue().set(stockKey, activity.getRemainingCount());

            <span class="hljs-comment">// è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæ´»åŠ¨ç»“æŸå1å°æ—¶ï¼‰</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">expireSeconds</span> <span class="hljs-operator">=</span> java.time.Duration.between(
                now, activity.getEndTime().plusHours(<span class="hljs-number">1</span>)).getSeconds();
            <span class="hljs-keyword">if</span> (expireSeconds &gt; <span class="hljs-number">0</span>) {
                redisTemplate.expire(stockKey, expireSeconds, TimeUnit.SECONDS);
            }

            log.info(<span class="hljs-string">"æ´»åŠ¨åº“å­˜é¢„çƒ­å®Œæˆ: activityId={}, stock={}"</span>,
                activity.getId(), activity.getRemainingCount());
        }
    }

    <span class="hljs-comment">/**
     * è·å–åº“å­˜
     */</span>
    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getStock</span><span class="hljs-params">(Long activityId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> ACTIVITY_STOCK_KEY + activityId;
        <span class="hljs-type">Object</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(key);
        <span class="hljs-keyword">return</span> stock != <span class="hljs-literal">null</span> ? Integer.parseInt(stock.toString()) : <span class="hljs-number">0</span>;
    }

    <span class="hljs-comment">/**
     * åŒæ­¥åº“å­˜åˆ°æ•°æ®åº“
     */</span>
    <span class="hljs-meta">@Scheduled(cron = "0 */10 * * * ?")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">syncStockToDb</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"å¼€å§‹åŒæ­¥åº“å­˜åˆ°æ•°æ®åº“..."</span>);

        List&lt;CouponActivity&gt; activities = activityMapper.selectActiveActivities(
            LocalDateTime.now(), LocalDateTime.now().plusDays(<span class="hljs-number">7</span>));

        <span class="hljs-keyword">for</span> (CouponActivity activity : activities) {
            <span class="hljs-type">String</span> <span class="hljs-variable">stockKey</span> <span class="hljs-operator">=</span> ACTIVITY_STOCK_KEY + activity.getId();
            <span class="hljs-type">Object</span> <span class="hljs-variable">redisStock</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(stockKey);

            <span class="hljs-keyword">if</span> (redisStock != <span class="hljs-literal">null</span>) {
                <span class="hljs-type">int</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> Integer.parseInt(redisStock.toString());
                activityMapper.updateRemainingCount(activity.getId(), stock);
            }
        }

        log.info(<span class="hljs-string">"åº“å­˜åŒæ­¥å®Œæˆ"</span>);
    }
}
</code></pre>
<h3 data-id="heading-34">åã€æ¥å£å±‚å®ç°</h3>
<h4 data-id="heading-35">10.1 Controller</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.controller;

<span class="hljs-keyword">import</span> com.coupon.common.result.Result;
<span class="hljs-keyword">import</span> com.coupon.service.dto.*;
<span class="hljs-keyword">import</span> com.coupon.service.service.CouponCalculateService;
<span class="hljs-keyword">import</span> com.coupon.service.service.CouponQueryService;
<span class="hljs-keyword">import</span> com.coupon.service.service.CouponReceiveService;
<span class="hljs-keyword">import</span> com.coupon.service.service.CouponUseService;
<span class="hljs-keyword">import</span> com.coupon.service.utils.UserContext;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-keyword">import</span> javax.validation.Valid;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * ä¼˜æƒ åˆ¸æ¥å£
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/coupon")</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponReceiveService receiveService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponQueryService queryService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponCalculateService calculateService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponUseService useService;

    <span class="hljs-comment">/**
     * é¢†å–ä¼˜æƒ åˆ¸
     */</span>
    <span class="hljs-meta">@PostMapping("/receive")</span>
    <span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">receiveCoupon</span><span class="hljs-params">(<span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> ReceiveCouponRequest request)</span> {
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserContext.getCurrentUserId();
        <span class="hljs-type">String</span> <span class="hljs-variable">couponCode</span> <span class="hljs-operator">=</span> receiveService.receiveCoupon(userId, request);
        <span class="hljs-keyword">return</span> Result.success(couponCode);
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢ç”¨æˆ·ä¼˜æƒ åˆ¸åˆ—è¡¨
     */</span>
    <span class="hljs-meta">@GetMapping("/list")</span>
    <span class="hljs-keyword">public</span> Result&lt;List&lt;UserCouponDTO&gt;&gt; <span class="hljs-title function_">getUserCoupons</span><span class="hljs-params">(
            <span class="hljs-meta">@RequestParam(required = false)</span> Integer status)</span> {
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserContext.getCurrentUserId();
        List&lt;UserCouponDTO&gt; coupons = queryService.getUserCoupons(userId, status);
        <span class="hljs-keyword">return</span> Result.success(coupons);
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢ä¼˜æƒ åˆ¸è¯¦æƒ…
     */</span>
    <span class="hljs-meta">@GetMapping("/{couponCode}")</span>
    <span class="hljs-keyword">public</span> Result&lt;UserCouponDTO&gt; <span class="hljs-title function_">getCouponDetail</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String couponCode)</span> {
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserContext.getCurrentUserId();
        <span class="hljs-type">UserCouponDTO</span> <span class="hljs-variable">coupon</span> <span class="hljs-operator">=</span> queryService.getCouponDetail(userId, couponCode);
        <span class="hljs-keyword">return</span> Result.success(coupon);
    }

    <span class="hljs-comment">/**
     * è®¡ç®—è®¢å•å¯ç”¨ä¼˜æƒ åˆ¸
     */</span>
    <span class="hljs-meta">@PostMapping("/calculate")</span>
    <span class="hljs-keyword">public</span> Result&lt;List&lt;CouponCalculateResult&gt;&gt; <span class="hljs-title function_">calculateCoupons</span><span class="hljs-params">(
            <span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> CalculateCouponRequest request)</span> {
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserContext.getCurrentUserId();
        List&lt;CouponCalculateResult&gt; results = calculateService.calculateAvailableCoupons(
            userId, request.getOrderItems());
        <span class="hljs-keyword">return</span> Result.success(results);
    }

    <span class="hljs-comment">/**
     * é¢„å ä¼˜æƒ åˆ¸
     */</span>
    <span class="hljs-meta">@PostMapping("/lock")</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">lockCoupon</span><span class="hljs-params">(<span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> LockCouponRequest request)</span> {
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserContext.getCurrentUserId();
        useService.lockCoupon(userId, request.getCouponCode(), request.getOrderNo());
        <span class="hljs-keyword">return</span> Result.success();
    }

    <span class="hljs-comment">/**
     * ä½¿ç”¨ä¼˜æƒ åˆ¸
     */</span>
    <span class="hljs-meta">@PostMapping("/use")</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">useCoupon</span><span class="hljs-params">(<span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> UseCouponRequest request)</span> {
        useService.useCoupon(request);
        <span class="hljs-keyword">return</span> Result.success();
    }

    <span class="hljs-comment">/**
     * é‡Šæ”¾ä¼˜æƒ åˆ¸
     */</span>
    <span class="hljs-meta">@PostMapping("/release")</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">releaseCoupon</span><span class="hljs-params">(<span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> ReleaseCouponRequest request)</span> {
        useService.releaseCoupon(request.getCouponCode(), request.getOrderNo());
        <span class="hljs-keyword">return</span> Result.success();
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢å¯é¢†å–çš„æ´»åŠ¨åˆ—è¡¨
     */</span>
    <span class="hljs-meta">@GetMapping("/activity/list")</span>
    <span class="hljs-keyword">public</span> Result&lt;List&lt;CouponActivityDTO&gt;&gt; <span class="hljs-title function_">getActivityList</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserContext.getCurrentUserId();
        List&lt;CouponActivityDTO&gt; activities = queryService.getAvailableActivities(userId);
        <span class="hljs-keyword">return</span> Result.success(activities);
    }
}
</code></pre>
<h4 data-id="heading-36">10.2 è¯·æ±‚DTO</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.dto;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> javax.validation.constraints.NotNull;

<span class="hljs-comment">/**
 * é¢†åˆ¸è¯·æ±‚
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReceiveCouponRequest</span> {

    <span class="hljs-meta">@NotNull(message = "æ´»åŠ¨IDä¸èƒ½ä¸ºç©º")</span>
    <span class="hljs-keyword">private</span> Long activityId;
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.dto;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> javax.validation.constraints.NotBlank;
<span class="hljs-keyword">import</span> javax.validation.constraints.NotNull;
<span class="hljs-keyword">import</span> java.math.BigDecimal;

<span class="hljs-comment">/**
 * ä½¿ç”¨ä¼˜æƒ åˆ¸è¯·æ±‚
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UseCouponRequest</span> {

    <span class="hljs-meta">@NotBlank(message = "åˆ¸ç ä¸èƒ½ä¸ºç©º")</span>
    <span class="hljs-keyword">private</span> String couponCode;

    <span class="hljs-meta">@NotBlank(message = "è®¢å•å·ä¸èƒ½ä¸ºç©º")</span>
    <span class="hljs-keyword">private</span> String orderNo;

    <span class="hljs-meta">@NotNull(message = "è®¢å•é‡‘é¢ä¸èƒ½ä¸ºç©º")</span>
    <span class="hljs-keyword">private</span> BigDecimal orderAmount;

    <span class="hljs-meta">@NotNull(message = "ä¼˜æƒ é‡‘é¢ä¸èƒ½ä¸ºç©º")</span>
    <span class="hljs-keyword">private</span> BigDecimal discountAmount;
}
</code></pre>
<h3 data-id="heading-37">åä¸€ã€ç»Ÿè®¡åˆ†æ</h3>
<h4 data-id="heading-38">11.1 ç»Ÿè®¡æŒ‡æ ‡</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+------------------+------------------+------------------+------------------+</span>
|    å‘æ”¾ç»Ÿè®¡       |    é¢†å–ç»Ÿè®¡       |    ä½¿ç”¨ç»Ÿè®¡       |    æ•ˆæœåˆ†æ       |
<span class="hljs-addition">+------------------+------------------+------------------+------------------+</span>
| å‘æ”¾æ€»é‡          | é¢†å–æ€»é‡          | ä½¿ç”¨æ€»é‡          | æ ¸é”€ç‡           |
| å‘æ”¾é‡‘é¢          | é¢†å–äººæ•°          | ä½¿ç”¨äººæ•°          | æ‹‰æ–°æ•ˆæœ         |
| æ´»åŠ¨ç»´åº¦ç»Ÿè®¡      | æ¸ é“ç»´åº¦ç»Ÿè®¡      | è®¢å•ç»´åº¦ç»Ÿè®¡      | GMVè´¡çŒ®          |
<span class="hljs-addition">+------------------+------------------+------------------+------------------+</span>
</code></pre>
<h4 data-id="heading-39">11.2 ç»Ÿè®¡æœåŠ¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.service;

<span class="hljs-keyword">import</span> com.coupon.service.dto.CouponStatisticsDTO;
<span class="hljs-keyword">import</span> com.coupon.service.mapper.CouponStatisticsMapper;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.math.RoundingMode;
<span class="hljs-keyword">import</span> java.time.LocalDate;

<span class="hljs-comment">/**
 * ä¼˜æƒ åˆ¸ç»Ÿè®¡æœåŠ¡
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponStatisticsService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CouponStatisticsMapper statisticsMapper;

    <span class="hljs-comment">/**
     * è·å–æ´»åŠ¨ç»Ÿè®¡æ•°æ®
     */</span>
    <span class="hljs-keyword">public</span> CouponStatisticsDTO <span class="hljs-title function_">getActivityStatistics</span><span class="hljs-params">(Long activityId)</span> {
        <span class="hljs-type">CouponStatisticsDTO</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponStatisticsDTO</span>();

        <span class="hljs-comment">// å‘æ”¾ç»Ÿè®¡</span>
        stats.setTotalIssued(statisticsMapper.countIssuedByActivity(activityId));

        <span class="hljs-comment">// é¢†å–ç»Ÿè®¡</span>
        stats.setTotalReceived(statisticsMapper.countReceivedByActivity(activityId));
        stats.setReceivedUsers(statisticsMapper.countReceivedUsersByActivity(activityId));

        <span class="hljs-comment">// ä½¿ç”¨ç»Ÿè®¡</span>
        stats.setTotalUsed(statisticsMapper.countUsedByActivity(activityId));
        stats.setUsedUsers(statisticsMapper.countUsedUsersByActivity(activityId));

        <span class="hljs-comment">// é‡‘é¢ç»Ÿè®¡</span>
        stats.setTotalDiscountAmount(statisticsMapper.sumDiscountAmountByActivity(activityId));

        <span class="hljs-comment">// è®¡ç®—æ ¸é”€ç‡</span>
        <span class="hljs-keyword">if</span> (stats.getTotalReceived() &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">useRate</span> <span class="hljs-operator">=</span> BigDecimal.valueOf(stats.getTotalUsed())
                .divide(BigDecimal.valueOf(stats.getTotalReceived()), <span class="hljs-number">4</span>, RoundingMode.HALF_UP)
                .multiply(BigDecimal.valueOf(<span class="hljs-number">100</span>));
            stats.setUseRate(useRate);
        }

        <span class="hljs-keyword">return</span> stats;
    }

    <span class="hljs-comment">/**
     * è·å–æ—¥ç»Ÿè®¡æ•°æ®
     */</span>
    <span class="hljs-keyword">public</span> CouponStatisticsDTO <span class="hljs-title function_">getDailyStatistics</span><span class="hljs-params">(LocalDate date)</span> {
        <span class="hljs-type">CouponStatisticsDTO</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponStatisticsDTO</span>();

        stats.setTotalReceived(statisticsMapper.countReceivedByDate(date));
        stats.setTotalUsed(statisticsMapper.countUsedByDate(date));
        stats.setTotalDiscountAmount(statisticsMapper.sumDiscountAmountByDate(date));
        stats.setReceivedUsers(statisticsMapper.countReceivedUsersByDate(date));
        stats.setUsedUsers(statisticsMapper.countUsedUsersByDate(date));

        <span class="hljs-keyword">return</span> stats;
    }
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.dto;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.math.BigDecimal;

<span class="hljs-comment">/**
 * ä¼˜æƒ åˆ¸ç»Ÿè®¡DTO
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponStatisticsDTO</span> {

    <span class="hljs-comment">/**
     * å‘æ”¾æ€»é‡
     */</span>
    <span class="hljs-keyword">private</span> Integer totalIssued;

    <span class="hljs-comment">/**
     * é¢†å–æ€»é‡
     */</span>
    <span class="hljs-keyword">private</span> Integer totalReceived;

    <span class="hljs-comment">/**
     * é¢†å–äººæ•°
     */</span>
    <span class="hljs-keyword">private</span> Integer receivedUsers;

    <span class="hljs-comment">/**
     * ä½¿ç”¨æ€»é‡
     */</span>
    <span class="hljs-keyword">private</span> Integer totalUsed;

    <span class="hljs-comment">/**
     * ä½¿ç”¨äººæ•°
     */</span>
    <span class="hljs-keyword">private</span> Integer usedUsers;

    <span class="hljs-comment">/**
     * æ€»ä¼˜æƒ é‡‘é¢
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal totalDiscountAmount;

    <span class="hljs-comment">/**
     * æ ¸é”€ç‡(%)
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal useRate;

    <span class="hljs-comment">/**
     * å¸¦åŠ¨GMV
     */</span>
    <span class="hljs-keyword">private</span> BigDecimal gmvContribution;
}
</code></pre>
<h3 data-id="heading-40">åäºŒã€å¼‚å¸¸å¤„ç†</h3>
<h4 data-id="heading-41">12.1 ç»Ÿä¸€å¼‚å¸¸å®šä¹‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.common.exception;

<span class="hljs-keyword">import</span> com.coupon.common.result.ResultCode;
<span class="hljs-keyword">import</span> lombok.Getter;

<span class="hljs-comment">/**
 * ä¼˜æƒ åˆ¸ä¸šåŠ¡å¼‚å¸¸
 */</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CouponException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String message;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CouponException</span><span class="hljs-params">(ResultCode resultCode)</span> {
        <span class="hljs-built_in">super</span>(resultCode.getMessage());
        <span class="hljs-built_in">this</span>.code = resultCode.getCode();
        <span class="hljs-built_in">this</span>.message = resultCode.getMessage();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CouponException</span><span class="hljs-params">(Integer code, String message)</span> {
        <span class="hljs-built_in">super</span>(message);
        <span class="hljs-built_in">this</span>.code = code;
        <span class="hljs-built_in">this</span>.message = message;
    }
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.common.result;

<span class="hljs-keyword">import</span> lombok.Getter;

<span class="hljs-comment">/**
 * å“åº”çŠ¶æ€ç 
 */</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ResultCode</span> {

    SUCCESS(<span class="hljs-number">200</span>, <span class="hljs-string">"æ“ä½œæˆåŠŸ"</span>),
    ERROR(<span class="hljs-number">500</span>, <span class="hljs-string">"ç³»ç»Ÿé”™è¯¯"</span>),

    <span class="hljs-comment">// æ´»åŠ¨ç›¸å…³ 1xxx</span>
    ACTIVITY_NOT_EXIST(<span class="hljs-number">1001</span>, <span class="hljs-string">"æ´»åŠ¨ä¸å­˜åœ¨"</span>),
    ACTIVITY_NOT_START(<span class="hljs-number">1002</span>, <span class="hljs-string">"æ´»åŠ¨æœªå¼€å§‹"</span>),
    ACTIVITY_ENDED(<span class="hljs-number">1003</span>, <span class="hljs-string">"æ´»åŠ¨å·²ç»“æŸ"</span>),
    ACTIVITY_STOPPED(<span class="hljs-number">1004</span>, <span class="hljs-string">"æ´»åŠ¨å·²åœæ­¢"</span>),

    <span class="hljs-comment">// æ¨¡æ¿ç›¸å…³ 2xxx</span>
    TEMPLATE_NOT_EXIST(<span class="hljs-number">2001</span>, <span class="hljs-string">"åˆ¸æ¨¡æ¿ä¸å­˜åœ¨"</span>),

    <span class="hljs-comment">// ä¼˜æƒ åˆ¸ç›¸å…³ 3xxx</span>
    COUPON_NOT_EXIST(<span class="hljs-number">3001</span>, <span class="hljs-string">"ä¼˜æƒ åˆ¸ä¸å­˜åœ¨"</span>),
    COUPON_NOT_BELONG(<span class="hljs-number">3002</span>, <span class="hljs-string">"ä¼˜æƒ åˆ¸ä¸å±äºå½“å‰ç”¨æˆ·"</span>),
    COUPON_STATUS_ERROR(<span class="hljs-number">3003</span>, <span class="hljs-string">"ä¼˜æƒ åˆ¸çŠ¶æ€å¼‚å¸¸"</span>),
    COUPON_EXPIRED(<span class="hljs-number">3004</span>, <span class="hljs-string">"ä¼˜æƒ åˆ¸å·²è¿‡æœŸ"</span>),
    COUPON_STOCK_EMPTY(<span class="hljs-number">3005</span>, <span class="hljs-string">"ä¼˜æƒ åˆ¸å·²é¢†å®Œ"</span>),
    COUPON_RECEIVE_LIMIT(<span class="hljs-number">3006</span>, <span class="hljs-string">"è¶…è¿‡é¢†å–é™åˆ¶"</span>),
    COUPON_BUSY(<span class="hljs-number">3007</span>, <span class="hljs-string">"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•"</span>),
    COUPON_ORDER_NOT_MATCH(<span class="hljs-number">3008</span>, <span class="hljs-string">"è®¢å•å·ä¸åŒ¹é…"</span>),

    <span class="hljs-comment">// ç”¨æˆ·ç›¸å…³ 4xxx</span>
    USER_NOT_LOGIN(<span class="hljs-number">4001</span>, <span class="hljs-string">"ç”¨æˆ·æœªç™»å½•"</span>);

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Integer code;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String message;

    ResultCode(Integer code, String message) {
        <span class="hljs-built_in">this</span>.code = code;
        <span class="hljs-built_in">this</span>.message = message;
    }
}
</code></pre>
<h4 data-id="heading-42">12.2 å…¨å±€å¼‚å¸¸å¤„ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.coupon.service.handler;

<span class="hljs-keyword">import</span> com.coupon.common.exception.CouponException;
<span class="hljs-keyword">import</span> com.coupon.common.result.Result;
<span class="hljs-keyword">import</span> com.coupon.common.result.ResultCode;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.validation.BindException;
<span class="hljs-keyword">import</span> org.springframework.web.bind.MethodArgumentNotValidException;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;

<span class="hljs-comment">/**
 * å…¨å±€å¼‚å¸¸å¤„ç†å™¨
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RestControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {

    <span class="hljs-comment">/**
     * ä¸šåŠ¡å¼‚å¸¸
     */</span>
    <span class="hljs-meta">@ExceptionHandler(CouponException.class)</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">handleCouponException</span><span class="hljs-params">(CouponException e)</span> {
        log.warn(<span class="hljs-string">"ä¸šåŠ¡å¼‚å¸¸: code={}, message={}"</span>, e.getCode(), e.getMessage());
        <span class="hljs-keyword">return</span> Result.error(e.getCode(), e.getMessage());
    }

    <span class="hljs-comment">/**
     * å‚æ•°æ ¡éªŒå¼‚å¸¸
     */</span>
    <span class="hljs-meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">handleValidException</span><span class="hljs-params">(MethodArgumentNotValidException e)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> e.getBindingResult().getFieldError() != <span class="hljs-literal">null</span> ?
            e.getBindingResult().getFieldError().getDefaultMessage() : <span class="hljs-string">"å‚æ•°é”™è¯¯"</span>;
        log.warn(<span class="hljs-string">"å‚æ•°æ ¡éªŒå¤±è´¥: {}"</span>, message);
        <span class="hljs-keyword">return</span> Result.error(<span class="hljs-number">400</span>, message);
    }

    <span class="hljs-comment">/**
     * å‚æ•°ç»‘å®šå¼‚å¸¸
     */</span>
    <span class="hljs-meta">@ExceptionHandler(BindException.class)</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">handleBindException</span><span class="hljs-params">(BindException e)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> e.getFieldError() != <span class="hljs-literal">null</span> ?
            e.getFieldError().getDefaultMessage() : <span class="hljs-string">"å‚æ•°é”™è¯¯"</span>;
        log.warn(<span class="hljs-string">"å‚æ•°ç»‘å®šå¤±è´¥: {}"</span>, message);
        <span class="hljs-keyword">return</span> Result.error(<span class="hljs-number">400</span>, message);
    }

    <span class="hljs-comment">/**
     * å…¶ä»–å¼‚å¸¸
     */</span>
    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span>
    <span class="hljs-keyword">public</span> Result&lt;Void&gt; <span class="hljs-title function_">handleException</span><span class="hljs-params">(Exception e)</span> {
        log.error(<span class="hljs-string">"ç³»ç»Ÿå¼‚å¸¸"</span>, e);
        <span class="hljs-keyword">return</span> Result.error(ResultCode.ERROR);
    }
}
</code></pre>
<h3 data-id="heading-43">åä¸‰ã€é…ç½®æ–‡ä»¶</h3>
<h4 data-id="heading-44">13.1 application.yml</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">coupon-service</span>

  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/coupon?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">hikari:</span>
      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">10</span>
      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">50</span>
      <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">30000</span>

  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">lettuce:</span>
      <span class="hljs-attr">pool:</span>
        <span class="hljs-attr">max-active:</span> <span class="hljs-number">100</span>
        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">50</span>
        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">10</span>

<span class="hljs-attr">rocketmq:</span>
  <span class="hljs-attr">name-server:</span> <span class="hljs-string">localhost:9876</span>
  <span class="hljs-attr">producer:</span>
    <span class="hljs-attr">group:</span> <span class="hljs-string">coupon-producer-group</span>
    <span class="hljs-attr">send-message-timeout:</span> <span class="hljs-number">3000</span>

<span class="hljs-attr">mybatis-plus:</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span>
  <span class="hljs-attr">global-config:</span>
    <span class="hljs-attr">db-config:</span>
      <span class="hljs-attr">id-type:</span> <span class="hljs-string">auto</span>
  <span class="hljs-attr">configuration:</span>
    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span>

<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">com.coupon:</span> <span class="hljs-string">debug</span>
  <span class="hljs-attr">pattern:</span>
    <span class="hljs-attr">console:</span> <span class="hljs-string">"%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"</span>

<span class="hljs-comment"># ä¼˜æƒ åˆ¸é…ç½®</span>
<span class="hljs-attr">coupon:</span>
  <span class="hljs-comment"># é¢†åˆ¸é™æµ</span>
  <span class="hljs-attr">receive-rate-limit:</span> <span class="hljs-number">100</span>
  <span class="hljs-comment"># åº“å­˜é¢„çƒ­æå‰æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</span>
  <span class="hljs-attr">warmup-advance-minutes:</span> <span class="hljs-number">60</span>
</code></pre>
<h3 data-id="heading-45">åå››ã€æ€»ç»“</h3>
<h4 data-id="heading-46">14.1 æ ¸å¿ƒæŠ€æœ¯ç‚¹</h4>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
|      æ¨¡å—        |      æŠ€æœ¯        |             è¯´æ˜                 |
<span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
|     é¢†åˆ¸æœåŠ¡     |  Redis+Lua      |   åŸå­æ‰£å‡åº“å­˜ï¼Œé˜²æ­¢è¶…å‘          |
<span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
|     ç”¨åˆ¸æœåŠ¡     |  è§„åˆ™å¼•æ“        |   çµæ´»çš„ä¼˜æƒ è®¡ç®—è§„åˆ™              |
<span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
|     åº“å­˜ç®¡ç†     |  é¢„çƒ­+å¼‚æ­¥åŒæ­¥   |   é«˜æ€§èƒ½åº“å­˜ç®¡ç†                  |
<span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
|     è¿‡æœŸå¤„ç†     |  å®šæ—¶+å»¶è¿Ÿé˜Ÿåˆ—   |   åˆ¸è¿‡æœŸè‡ªåŠ¨å¤„ç†                  |
<span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
|     åˆ†å¸ƒå¼é”     |  Redisson       |   é˜²æ­¢å¹¶å‘é—®é¢˜                    |
<span class="hljs-addition">+------------------+------------------+----------------------------------+</span>
</code></pre>
<h4 data-id="heading-47">14.2 æœ€ä½³å®è·µ</h4>
<ol>
<li><strong>åˆ¸ç è®¾è®¡</strong>ï¼šé‡‡ç”¨æ—¥æœŸ+éšæœºå­—ç¬¦çš„æ–¹å¼ï¼Œé¿å…è¢«çŒœæµ‹</li>
<li><strong>åº“å­˜é¢„çƒ­</strong>ï¼šæ´»åŠ¨å¼€å§‹å‰å°†åº“å­˜åŠ è½½åˆ°Redis</li>
<li><strong>åˆ†å±‚è¿‡æ»¤</strong>ï¼šæœ¬åœ°ç¼“å­˜ -&gt; Redis -&gt; æ•°æ®åº“ï¼Œå‡å°‘å‹åŠ›</li>
<li><strong>é¢„å æœºåˆ¶</strong>ï¼šä¸‹å•æ—¶å†»ç»“åˆ¸ï¼Œæ”¯ä»˜åæ ¸é”€ï¼Œè¶…æ—¶è‡ªåŠ¨é‡Šæ”¾</li>
<li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šéæ ¸å¿ƒé“¾è·¯å¼‚æ­¥åŒ–ï¼Œæé«˜å“åº”é€Ÿåº¦</li>
<li><strong>å¹‚ç­‰è®¾è®¡</strong>ï¼šæ‰€æœ‰æ“ä½œä¿è¯å¹‚ç­‰ï¼Œé˜²æ­¢é‡å¤å¤„ç†</li>
</ol>
<h4 data-id="heading-48">14.3 æ‰©å±•æ–¹å‘</h4>
<ol>
<li><strong>åˆ¸åŒ…åŠŸèƒ½</strong>ï¼šæ”¯æŒä¸€æ¬¡æ€§å‘æ”¾å¤šå¼ åˆ¸</li>
<li><strong>è½¬èµ åŠŸèƒ½</strong>ï¼šæ”¯æŒç”¨æˆ·é—´ä¼˜æƒ åˆ¸è½¬èµ </li>
<li><strong>æ™ºèƒ½æ¨è</strong>ï¼šåŸºäºç”¨æˆ·è¡Œä¸ºæ¨èæœ€ä¼˜åˆ¸</li>
<li><strong>ABæµ‹è¯•</strong>ï¼šæ”¯æŒä¸åŒå‘åˆ¸ç­–ç•¥å¯¹æ¯”</li>
<li><strong>é£æ§ç³»ç»Ÿ</strong>ï¼šè¯†åˆ«åˆ·åˆ¸ã€é»„ç‰›ç­‰å¼‚å¸¸è¡Œä¸º</li>
</ol>
<hr/>
<blockquote>
<p>æœ¬æ–‡å®Œæ•´æ¼”ç¤ºäº†ä»¿äº¬ä¸œä¼˜æƒ åˆ¸ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°ï¼Œæ¶µç›–äº†ä¼˜æƒ åˆ¸çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿˜éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Bipesé¡¹ç›®äºŒæ¬¡å¼€å‘/è®¾ç½®åŠŸèƒ½-1ï¼ˆäº”ï¼‰]]></title>    <link>https://juejin.cn/post/7577574644694925348</link>    <guid>https://juejin.cn/post/7577574644694925348</guid>    <pubDate>2025-11-28T09:02:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577574644694925348" data-draft-id="7577461079598366739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Bipesé¡¹ç›®äºŒæ¬¡å¼€å‘/è®¾ç½®åŠŸèƒ½-1ï¼ˆäº”ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-28T09:02:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¯”è€é©¬è¿˜å…­"/> <meta itemprop="url" content="https://juejin.cn/user/2212677374711006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Bipesé¡¹ç›®äºŒæ¬¡å¼€å‘/è®¾ç½®åŠŸèƒ½-1ï¼ˆäº”ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2212677374711006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¯”è€é©¬è¿˜å…­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:02:47.000Z" title="Fri Nov 28 2025 09:02:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Bipesé¡¹ç›®äºŒæ¬¡å¼€å‘/è®¾ç½®åŠŸèƒ½-1ï¼ˆäº”ï¼‰</h2>
<p>è®¾ç½®åŠŸèƒ½ï¼Œè¿™ä¸€æœŸæ”¹åŠ¨æœ‰ç‚¹å¤šï¼Œå¯èƒ½åæœŸä¹Ÿä¼šç»§ç»­å‡ºè®¾ç½®åŠŸèƒ½-næ–‡ç« ï¼Œè¿™ä¸€æœŸæ˜¯ç¼–ç¨‹æ¨¡å¼ï¼Œé‚£åšç›®çš„æœ‰ä¸¤ä¸ªï¼š
1ï¼Œä»£ç è®¾è®¡
ç°åœ¨ç¡®å®šåšçš„æ¨¡å¼æœ‰ä¸‰ç§ï¼Œç¡¬ä»¶ç¼–ç¨‹ï¼Œç¦»çº¿ç¼–ç¨‹ï¼Œæµ·é¾Ÿç¼–ç¨‹ä¸‰ç§ã€‚æ¯ç§æ¨¡å¼æ‰€æ¶‰åŠçš„ä»£ç ä¸åŒï¼Œæ‰€ä»¥å¾—åˆ’åˆ†å‡ºæ¥ã€‚</p>
<p>2ï¼Œå¯é…ç½®æ€§
åæœŸå¯èƒ½ä¼šå‡ºä¸€äº›å®šåˆ¶å¼€å‘ï¼Œç•Œé¢å°±å¯ä»¥é€šè¿‡é…ç½®ï¼Œè¿›è¡Œç•Œé¢è°ƒæ•´ã€‚</p>
<h2 data-id="heading-1">ç¼–ç¨‹æ¨¡å¼</h2>
<h3 data-id="heading-2">html</h3>
<p>é¡µé¢åˆå§‹å†…å®¹</p>
<pre><code class="hljs language-cpp" lang="cpp">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"settings-preview"</span>&gt;
    &lt;div id=<span class="hljs-string">"settings-modal"</span>&gt;
      &lt;h3&gt;è®¾ç½®&lt;/h3&gt;
      &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"settings-group"</span>&gt;
        &lt;label&gt;æ¨¡å¼é€‰æ‹©&lt;/label&gt;
        &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"radio-group"</span>&gt;
          &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"radio-option"</span>&gt;
            &lt;input type=<span class="hljs-string">"radio"</span> id=<span class="hljs-string">"mode-hardware"</span> name=<span class="hljs-string">"programMode"</span> value=<span class="hljs-string">"hardware"</span> checked&gt;
            &lt;span&gt;ç¡¬ä»¶ç¼–ç¨‹&lt;/span&gt;
          &lt;/div&gt;
          &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"radio-option"</span>&gt;
            &lt;input type=<span class="hljs-string">"radio"</span> id=<span class="hljs-string">"mode-offline"</span> name=<span class="hljs-string">"programMode"</span> value=<span class="hljs-string">"offline"</span>&gt;
            &lt;span&gt;ç¦»çº¿ç¼–ç¨‹&lt;/span&gt;
          &lt;/div&gt;
          &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"radio-option"</span>&gt;
            &lt;input type=<span class="hljs-string">"radio"</span> id=<span class="hljs-string">"mode-turtle"</span> name=<span class="hljs-string">"programMode"</span> value=<span class="hljs-string">"turtle"</span>&gt;
            &lt;span&gt;æµ·é¾Ÿç¼–ç¨‹&lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"modal-actions"</span>&gt;
        &lt;button id=<span class="hljs-string">"cancel-settings"</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">"btn btn-secondary"</span>&gt;å–æ¶ˆ&lt;/button&gt;
        &lt;button id=<span class="hljs-string">"save-settings"</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;ä¿å­˜&lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
</code></pre>
<h3 data-id="heading-3">js</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">import</span> Common from <span class="hljs-string">"./common"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SettingPreview</span> extends Common {
    <span class="hljs-built_in">constructor</span>() {
        <span class="hljs-built_in">super</span>()
        <span class="hljs-keyword">this</span>.state = <span class="hljs-literal">false</span> <span class="hljs-comment">// è®¾ç½®å¼¹çª—æ˜¯å¦æ˜¾ç¤º</span>
    }
    <span class="hljs-built_in">initEvent</span>() {
        $(<span class="hljs-string">'#settingsButton'</span>).<span class="hljs-built_in">on</span>(<span class="hljs-string">'click'</span>, () =&gt; {
            <span class="hljs-keyword">this</span>.<span class="hljs-built_in">changeSetting</span>(!<span class="hljs-keyword">this</span>.state)
        })
        
        <span class="hljs-comment">// æ·»åŠ å–æ¶ˆæŒ‰é’®äº‹ä»¶ç›‘å¬</span>
        $(<span class="hljs-string">'#cancel-settings'</span>).<span class="hljs-built_in">on</span>(<span class="hljs-string">'click'</span>, () =&gt; {
            <span class="hljs-keyword">this</span>.<span class="hljs-built_in">changeSetting</span>(<span class="hljs-literal">false</span>)
        })
        
        <span class="hljs-comment">// æ·»åŠ ç¡®è®¤æŒ‰é’®äº‹ä»¶ç›‘å¬</span>
        $(<span class="hljs-string">'#save-settings'</span>).<span class="hljs-built_in">on</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">this</span>.saveSettings.<span class="hljs-built_in">bind</span>(<span class="hljs-keyword">this</span>))
    }
    <span class="hljs-built_in">changeSetting</span>(state) {
        let status = state ? <span class="hljs-string">'on'</span> : <span class="hljs-string">'off'</span>
        $(<span class="hljs-string">'.settings-preview'</span>).<span class="hljs-built_in">css</span>(<span class="hljs-string">'visibility'</span>, (state ? <span class="hljs-string">'visible'</span> : <span class="hljs-string">'hidden'</span>))
        $(<span class="hljs-string">'#settingsButton'</span>).<span class="hljs-built_in">css</span>(<span class="hljs-string">'background'</span>, `<span class="hljs-built_in">url</span>(../media/<span class="hljs-keyword">new</span>-icon/setting-${status}.png) center / cover`)
        
        <span class="hljs-keyword">if</span> (state) {
            <span class="hljs-comment">// æ˜¾ç¤ºæ—¶å¯ä»¥åŠ è½½å·²ä¿å­˜çš„è®¾ç½®</span>
            <span class="hljs-keyword">this</span>.<span class="hljs-built_in">loadSettings</span>();
        }

        <span class="hljs-keyword">this</span>.state = state
    }
    
    <span class="hljs-comment">// ä¿å­˜è®¾ç½®åˆ°æœ¬åœ°ç¼“å­˜</span>
    <span class="hljs-built_in">saveSettings</span>() {
        <span class="hljs-comment">// è·å–é€‰ä¸­çš„æ¨¡å¼</span>
        let selectedMode = <span class="hljs-string">'hardware'</span>; <span class="hljs-comment">// é»˜è®¤å€¼</span>
        <span class="hljs-type">const</span> selectedRadio = $(<span class="hljs-string">'input[name="programMode"]:checked'</span>);
        <span class="hljs-keyword">if</span> (selectedRadio.length &gt; <span class="hljs-number">0</span>) {
            selectedMode = selectedRadio.<span class="hljs-built_in">val</span>();
        }
        
        <span class="hljs-comment">// åˆ›å»ºè®¾ç½®å¯¹è±¡å¹¶ä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜</span>
        <span class="hljs-type">const</span> settings = {
            mode: selectedMode
        };
        
        <span class="hljs-keyword">try</span> {
            localStorage.<span class="hljs-built_in">setItem</span>(<span class="hljs-string">'settings'</span>, JSON.<span class="hljs-built_in">stringify</span>(settings));
            console.<span class="hljs-built_in">log</span>(<span class="hljs-string">'è®¾ç½®å·²ä¿å­˜:'</span>, settings);
        } <span class="hljs-built_in">catch</span> (error) {
            console.<span class="hljs-built_in">error</span>(<span class="hljs-string">'ä¿å­˜è®¾ç½®å¤±è´¥:'</span>, error);
        }

        <span class="hljs-keyword">this</span>.<span class="hljs-built_in">changeSetting</span>(<span class="hljs-literal">false</span>)
    }
    
    <span class="hljs-comment">// ä»æœ¬åœ°ç¼“å­˜åŠ è½½è®¾ç½®</span>
    <span class="hljs-built_in">loadSettings</span>() {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">const</span> savedSettings = localStorage.<span class="hljs-built_in">getItem</span>(<span class="hljs-string">'settings'</span>);
            <span class="hljs-keyword">if</span> (savedSettings) {
                <span class="hljs-type">const</span> settings = JSON.<span class="hljs-built_in">parse</span>(savedSettings);
                <span class="hljs-keyword">if</span> (settings.mode) {
                    <span class="hljs-comment">// è®¾ç½®é€‰ä¸­çš„å•é€‰æŒ‰é’®</span>
                    $(`input[name=<span class="hljs-string">"programMode"</span>][value=<span class="hljs-string">"${settings.mode}"</span>]`).<span class="hljs-built_in">prop</span>(<span class="hljs-string">'checked'</span>, <span class="hljs-literal">true</span>);
                }
            }
        } <span class="hljs-built_in">catch</span> (error) {
            console.<span class="hljs-built_in">error</span>(<span class="hljs-string">'åŠ è½½è®¾ç½®å¤±è´¥:'</span>, error);
        }
    }
}
</code></pre>
<h3 data-id="heading-4">ç•Œé¢æ•ˆæœ</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f01e515d15646cea5b54b10f8216af4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q-U6ICB6ams6L-Y5YWt:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764925366&amp;x-signature=ICuNFD%2BqyzMMQ9pqbD5j07J0Iv0%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-5">æ€»ç»“</h3>
<p>å‡ºè¿™ä¸€æœŸä¸»è¦é’ˆå¯¹ç¼–ç¨‹æ¨¡å¼ï¼Œä¸åŒæ¨¡å¼ä¸‹åšä¸åŒåŠŸèƒ½ã€‚
ç¡¬ä»¶ç¼–ç¨‹ï¼šä¿ç•™åŸæœ‰åŠŸèƒ½ï¼Œé€šè¿‡è¿æ¥æ¿å­ï¼Œä¸æ¿å­é€šä¿¡ï¼Œåœ¨æ¿å­ä¸Šè¿è¡Œç¼–å†™å¥½çš„ä»£ç ï¼Œåšå‡ºä¸åŒæ•ˆæœ
ç¦»çº¿ç¼–ç¨‹ï¼šå­¦ä¹ ï¼Œäº†è§£ç¼–ç¨‹
æµ·é¾Ÿç¼–ç¨‹ï¼šå­¦ä¹ ï¼Œäº†è§£ç¼–ç¨‹ï¼Œè®©ç¼–ç¨‹å˜å¾—ä¸æ¯ç‡¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Konvajså®ç°è™šæ‹Ÿè¡¨æ ¼]]></title>    <link>https://juejin.cn/post/7577417823342493731</link>    <guid>https://juejin.cn/post/7577417823342493731</guid>    <pubDate>2025-11-28T09:07:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577417823342493731" data-draft-id="7577439614953914420" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Konvajså®ç°è™šæ‹Ÿè¡¨æ ¼"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-28T09:07:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ€çˆ±è€è™å¤´"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919024039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Konvajså®ç°è™šæ‹Ÿè¡¨æ ¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919024039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ€çˆ±è€è™å¤´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:07:57.000Z" title="Fri Nov 28 2025 09:07:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™æ˜¯ä¸€ä¸ªä¸“æ  <a href="https://juejin.cn/column/7576661150684725263" target="_blank" title="https://juejin.cn/column/7576661150684725263">ä»é›¶å®ç°å¤šç»´è¡¨æ ¼</a>ï¼Œæ­¤ä¸“æ å°†å¸¦ä½ ä¸€æ­¥æ­¥å®ç°ä¸€ä¸ªå¤šç»´è¡¨æ ¼ï¼Œç¼“æ…¢æ›´æ–°ä¸­</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbalabll%2Fmulti-table%2Ftree%2F002" target="_blank" title="https://github.com/balabll/multi-table/tree/002" ref="nofollow noopener noreferrer">æœ¬æ–‡æ¶‰åŠçš„ä»£ç </a></p>
<h4 data-id="heading-0">è™šæ‹Ÿè¡¨æ ¼</h4>
<p>è™šæ‹Ÿè¡¨æ ¼ï¼ˆVirtual Tableï¼‰ æ˜¯ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œç”¨äºå¤„ç†å¤§é‡æ•°æ®æ—¶çš„æ€§èƒ½é—®é¢˜ã€‚å®ƒåªæ¸²æŸ“å½“å‰å¯è§åŒºåŸŸï¼ˆè§†å£ï¼‰å†…çš„è¡¨æ ¼å•å…ƒæ ¼ï¼Œè€Œä¸æ˜¯æ¸²æŸ“æ•´ä¸ªè¡¨æ ¼çš„æ‰€æœ‰æ•°æ®ã€‚</p>
<h4 data-id="heading-1">å®ç°åŸç†</h4>
<p>ä¸€ä¸ªç®€å•çš„è™šæ‹Ÿè¡¨æ ¼å®ç°ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸¤ç‚¹ï¼ˆæ³¨ï¼šä¸€ä¸ªå®Œå–„çš„è™šæ‹Ÿè¡¨æ ¼éœ€è¦å…³æ³¨çš„æ–¹é¢æ›´å¤šï¼Œè¿™é‡Œåªè®¨è®ºæ ¸å¿ƒå®ç°ï¼Œåç»­çš„ä¼˜åŒ–é¡¹ä¼šåœ¨æœ¬ä¸“æ çš„åç»­æ–‡ç« ä¸­å®ç°ï¼‰</p>
<ol>
<li>æŒ‰éœ€æ¸²æŸ“ï¼šåªåˆ›å»ºå’Œæ¸²æŸ“ç”¨æˆ·å½“å‰èƒ½çœ‹åˆ°çš„æ•°æ®è¡Œå’Œåˆ—</li>
<li>æ»šåŠ¨ç›‘å¬ï¼šç›‘å¬å®¹å™¨æ»šåŠ¨äº‹ä»¶ï¼ŒåŠ¨æ€è®¡ç®—æ–°çš„å¯è§èŒƒå›´</li>
</ol>
<h4 data-id="heading-2">ä»£ç å¤§çº²</h4>
<p>åŸºäºä¸Šè¿°åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºå¦‚ä¸‹ä»£ç :</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Konva</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"konva"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Layer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"konva/lib/Layer"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Stage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"konva/lib/Stage"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Column</span> = {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">VirtualTableConfig</span> = {
  <span class="hljs-attr">container</span>: <span class="hljs-title class_">HTMLDivElement</span>;
  <span class="hljs-attr">columns</span>: <span class="hljs-title class_">Column</span>[];
  <span class="hljs-attr">dataSource</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;[];
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Range</span> = { <span class="hljs-attr">start</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">end</span>: <span class="hljs-built_in">number</span> };

<span class="hljs-keyword">class</span> <span class="hljs-title class_">VirtualTable</span> {
  <span class="hljs-comment">// =========== è¡¨æ ¼åŸºç¡€å±æ€§ ===========</span>
  <span class="hljs-attr">rows</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">20</span>;
  <span class="hljs-attr">cols</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">20</span>;
  <span class="hljs-attr">columns</span>: <span class="hljs-title class_">Column</span>[];
  <span class="hljs-attr">stage</span>: <span class="hljs-title class_">Stage</span>;
  <span class="hljs-attr">layer</span>: <span class="hljs-title class_">Layer</span>;
  <span class="hljs-attr">dataSource</span>: <span class="hljs-title class_">TableDataSource</span>;

  <span class="hljs-comment">// =========== è™šæ‹Ÿè¡¨æ ¼å®ç° ===========</span>
  <span class="hljs-comment">// æ»šåŠ¨ç›¸å…³å±æ€§</span>
  <span class="hljs-attr">scrollTop</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  <span class="hljs-attr">scrollLeft</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  <span class="hljs-attr">maxScrollTop</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  <span class="hljs-attr">maxScrollLeft</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  <span class="hljs-attr">visibleRowCount</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  <span class="hljs-comment">// å¯è§è¡Œåˆ—èŒƒå›´</span>
  <span class="hljs-attr">visibleRows</span>: <span class="hljs-title class_">Range</span> = { <span class="hljs-attr">start</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">end</span>: <span class="hljs-number">0</span> };
  <span class="hljs-attr">visibleCols</span>: <span class="hljs-title class_">Range</span> = { <span class="hljs-attr">start</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">end</span>: <span class="hljs-number">0</span> };
  <span class="hljs-comment">// è¡¨æ ¼å¯è§å®½é«˜</span>
  <span class="hljs-attr">visibleWidth</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">visibleHeight</span>: <span class="hljs-built_in">number</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">config: VirtualTableConfig</span>) {
    <span class="hljs-keyword">const</span> { container, columns, dataSource } = config;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">columns</span> = columns;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span> = dataSource;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleWidth</span> = container.<span class="hljs-title function_">getBoundingClientRect</span>().<span class="hljs-property">width</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleHeight</span> = container.<span class="hljs-title function_">getBoundingClientRect</span>().<span class="hljs-property">height</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleRowCount</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleHeight</span> / <span class="hljs-variable constant_">ROW_HEIGHT</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxScrollTop</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(
      <span class="hljs-number">0</span>,
      (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rows</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleRowCount</span>) * <span class="hljs-variable constant_">ROW_HEIGHT</span>
    );

    <span class="hljs-comment">// è®¡ç®—æ€»åˆ—å®½</span>
    <span class="hljs-keyword">const</span> totalColWidth = <span class="hljs-variable language_">this</span>.<span class="hljs-property">columns</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, col</span>) =&gt;</span> sum + col.<span class="hljs-property">width</span>, <span class="hljs-number">0</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxScrollLeft</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, totalColWidth - <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleWidth</span>);

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Konva</span>.<span class="hljs-title class_">Stage</span>({
      container,
      <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleHeight</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleWidth</span>,
    });
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">layer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Konva</span>.<span class="hljs-title class_">Layer</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stage</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">layer</span>);

    <span class="hljs-comment">// ç›‘å¬æ»šåŠ¨äº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bindScrollEvent</span>(container);
    <span class="hljs-comment">// åˆå§‹åŒ–è°ƒç”¨</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateVisibleRange</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderCells</span>();
  }

  <span class="hljs-comment">// ç›‘å¬æ»šåŠ¨äº‹ä»¶</span>
  <span class="hljs-title function_">bindScrollEvent</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateVisibleRange</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderCells</span>();
  }

  <span class="hljs-comment">// è®¡ç®—å¯è§è¡Œåˆ—èŒƒå›´</span>
  <span class="hljs-title function_">updateVisibleRange</span>(<span class="hljs-params"/>) {}

  <span class="hljs-comment">// æ¸²æŸ“å¯è§èŒƒå›´å†…çš„ cell</span>
  <span class="hljs-title function_">renderCells</span>(<span class="hljs-params"/>) {}
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">VirtualTable</span>;
</code></pre>
<h4 data-id="heading-3">è®¡ç®—å¯è§è¡Œåˆ—èŒƒå›´</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">updateVisibleRange</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// è®¡ç®—å¯è§è¡Œ</span>
    <span class="hljs-keyword">const</span> startRow = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollTop</span> / <span class="hljs-variable constant_">ROW_HEIGHT</span>);
    <span class="hljs-keyword">const</span> endRow = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
      startRow + <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleRowCount</span>,
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>.<span class="hljs-property">length</span>
    );
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleRows</span> = { <span class="hljs-attr">start</span>: startRow, <span class="hljs-attr">end</span>: endRow };

    <span class="hljs-comment">// è®¡ç®—å¯è§åˆ—</span>
    <span class="hljs-keyword">let</span> accumulatedWidth = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> startCol = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> endCol = <span class="hljs-number">0</span>;

    <span class="hljs-comment">// è®¡ç®—å¼€å§‹åˆ—</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">columns</span>.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">const</span> col = <span class="hljs-variable language_">this</span>.<span class="hljs-property">columns</span>[i];
      <span class="hljs-keyword">if</span> (accumulatedWidth + col.<span class="hljs-property">width</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollLeft</span>) {
        startCol = i;
        <span class="hljs-keyword">break</span>;
      }
      accumulatedWidth += col.<span class="hljs-property">width</span>;
    }

    <span class="hljs-comment">// è®¡ç®—ç»“æŸåˆ—</span>
    accumulatedWidth = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = startCol; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">columns</span>.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">const</span> col = <span class="hljs-variable language_">this</span>.<span class="hljs-property">columns</span>[i];
      accumulatedWidth += col.<span class="hljs-property">width</span>;
      <span class="hljs-keyword">if</span> (accumulatedWidth &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleWidth</span>) {
        endCol = i + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">break</span>;
      }
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleCols</span> = {
      <span class="hljs-attr">start</span>: startCol,
      <span class="hljs-attr">end</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(endCol, <span class="hljs-variable language_">this</span>.<span class="hljs-property">columns</span>.<span class="hljs-property">length</span>),
    };
  }
</code></pre>
<h4 data-id="heading-4">æ»šåŠ¨äº‹ä»¶ç›‘å¬</h4>
<pre><code class="hljs language-typescript" lang="typescript">
  <span class="hljs-comment">/**
   * ç»‘å®šæ»šåŠ¨äº‹ä»¶
   */</span>
  <span class="hljs-title function_">bindScrollEvent</span>(<span class="hljs-params">container: HTMLDivElement</span>) {
    container.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"wheel"</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      e.<span class="hljs-title function_">preventDefault</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleScroll</span>(e.<span class="hljs-property">deltaX</span>, e.<span class="hljs-property">deltaY</span>);
    });

    <span class="hljs-comment">// æ”¯æŒè§¦æ‘¸æ»šåŠ¨</span>
    <span class="hljs-keyword">let</span> lastTouchY = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> lastTouchX = <span class="hljs-number">0</span>;
    container.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"touchstart"</span>, <span class="hljs-function">(<span class="hljs-params">e: TouchEvent</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> touch = e.<span class="hljs-property">touches</span>?.[<span class="hljs-number">0</span>];
      <span class="hljs-keyword">if</span> (touch) {
        lastTouchY = touch.<span class="hljs-property">clientY</span>;
        lastTouchX = touch.<span class="hljs-property">clientX</span>;
      }
    });

    container.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"touchmove"</span>, <span class="hljs-function">(<span class="hljs-params">e: TouchEvent</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> touch = e.<span class="hljs-property">touches</span>?.[<span class="hljs-number">0</span>];
      <span class="hljs-keyword">if</span> (touch) {
        <span class="hljs-keyword">const</span> deltaY = lastTouchY - touch.<span class="hljs-property">clientY</span>;
        <span class="hljs-keyword">const</span> deltaX = lastTouchX - touch.<span class="hljs-property">clientX</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleScroll</span>(deltaX, deltaY);
        lastTouchY = touch.<span class="hljs-property">clientY</span>;
        lastTouchX = touch.<span class="hljs-property">clientX</span>;
      }
    });
  }

  <span class="hljs-comment">/**
   * å¤„ç†æ»šåŠ¨
   */</span>
  <span class="hljs-title function_">handleScroll</span>(<span class="hljs-params">deltaX: <span class="hljs-built_in">number</span>, deltaY: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-comment">// æ›´æ–°æ»šåŠ¨ä½ç½®</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollTop</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(
      <span class="hljs-number">0</span>,
      <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollTop</span> + deltaY, <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxScrollTop</span>)
    );
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollLeft</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(
      <span class="hljs-number">0</span>,
      <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollLeft</span> + deltaX, <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxScrollLeft</span>)
    );

    <span class="hljs-comment">// æ›´æ–°å¯è§è¡Œåˆ—èŒƒå›´</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateVisibleRange</span>();

    <span class="hljs-comment">// æ›´æ–°å•å…ƒæ ¼æ¸²æŸ“</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderCells</span>();
  }
</code></pre>
<h4 data-id="heading-5">å•å…ƒæ ¼æ¸²æŸ“é€»è¾‘</h4>
<pre><code class="hljs language-typescript" lang="typescript">
  <span class="hljs-comment">/**
   * è·å–æŒ‡å®šè¡Œçš„ Y åæ ‡
   * <span class="hljs-doctag">@param</span> <span class="hljs-variable">rowIndex</span> - è¡Œç´¢å¼•
   * <span class="hljs-doctag">@returns</span> Y åæ ‡å€¼
   */</span>
  <span class="hljs-title function_">getRowY</span>(<span class="hljs-attr">rowIndex</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> rowIndex * <span class="hljs-variable constant_">ROW_HEIGHT</span>;
  }

  <span class="hljs-comment">/**
   * è·å–æŒ‡å®šåˆ—çš„ X åæ ‡
   * <span class="hljs-doctag">@param</span> <span class="hljs-variable">colIndex</span> - åˆ—ç´¢å¼•
   * <span class="hljs-doctag">@returns</span> X åæ ‡å€¼
   */</span>
  <span class="hljs-title function_">getColX</span>(<span class="hljs-attr">colIndex</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; colIndex; i++) {
      <span class="hljs-keyword">const</span> col = <span class="hljs-variable language_">this</span>.<span class="hljs-property">columns</span>[i];
      <span class="hljs-keyword">if</span> (col) {
        x += col.<span class="hljs-property">width</span>;
      }
    }
    <span class="hljs-keyword">return</span> x;
  }

  <span class="hljs-title function_">renderCell</span>(<span class="hljs-params">rowIndex: <span class="hljs-built_in">number</span>, colIndex: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-keyword">const</span> column = <span class="hljs-variable language_">this</span>.<span class="hljs-property">columns</span>[colIndex];
    <span class="hljs-keyword">if</span> (!column) <span class="hljs-keyword">return</span>;
    <span class="hljs-comment">// è®¡ç®—åæ ‡æ—¶è€ƒè™‘æ»šåŠ¨åç§»</span>
    <span class="hljs-keyword">const</span> x = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getColX</span>(colIndex) - <span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollLeft</span>;
    <span class="hljs-keyword">const</span> y = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getRowY</span>(rowIndex) - <span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollTop</span>;
    <span class="hljs-comment">// åˆ›å»ºå•å…ƒæ ¼</span>
    <span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Konva</span>.<span class="hljs-title class_">Group</span>({
      x,
      y,
    });
    <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Konva</span>.<span class="hljs-title class_">Rect</span>({
      <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">width</span>: column.<span class="hljs-property">width</span>,
      <span class="hljs-attr">height</span>: <span class="hljs-variable constant_">ROW_HEIGHT</span>,
      <span class="hljs-attr">fill</span>: <span class="hljs-string">"#FFF"</span>,
      <span class="hljs-attr">stroke</span>: <span class="hljs-string">"#ccc"</span>,
      <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">1</span>,
    });

    <span class="hljs-comment">// åˆ›å»ºæ–‡æœ¬</span>
    <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Konva</span>.<span class="hljs-title class_">Text</span>({
      <span class="hljs-attr">x</span>: <span class="hljs-number">8</span>,
      <span class="hljs-attr">y</span>: <span class="hljs-number">8</span>,
      <span class="hljs-attr">width</span>: column.<span class="hljs-property">width</span> - <span class="hljs-number">16</span>,
      <span class="hljs-attr">height</span>: <span class="hljs-number">16</span>,
      <span class="hljs-attr">text</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>[rowIndex][colIndex],
      <span class="hljs-attr">fontSize</span>: <span class="hljs-number">14</span>,
      <span class="hljs-attr">fill</span>: <span class="hljs-string">"#000"</span>,
      <span class="hljs-attr">align</span>: <span class="hljs-string">"left"</span>,
      <span class="hljs-attr">verticalAlign</span>: <span class="hljs-string">"middle"</span>,
      <span class="hljs-attr">ellipsis</span>: <span class="hljs-literal">true</span>,
    });
    group.<span class="hljs-title function_">add</span>(rect);
    group.<span class="hljs-title function_">add</span>(text);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">layer</span>.<span class="hljs-title function_">add</span>(group);
  }

  <span class="hljs-comment">/**
   * æ¸²æŸ“å¯è§èŒƒå›´å†…çš„æ‰€æœ‰å•å…ƒæ ¼
   * é¦–å…ˆæ¸…é™¤æ—§å•å…ƒæ ¼ï¼Œç„¶åæŒ‰è¡Œåˆ—é‡æ–°æ¸²æŸ“
   */</span>
  <span class="hljs-title function_">renderCells</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">layer</span>.<span class="hljs-title function_">destroyChildren</span>();
    <span class="hljs-comment">// æ¸²æŸ“æ•°æ®è¡Œ</span>
    <span class="hljs-keyword">for</span> (
      <span class="hljs-keyword">let</span> rowIndex = <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleRows</span>.<span class="hljs-property">start</span>;
      rowIndex &lt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleRows</span>.<span class="hljs-property">end</span>;
      rowIndex++
    ) {
      <span class="hljs-keyword">for</span> (
        <span class="hljs-keyword">let</span> colIndex = <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleCols</span>.<span class="hljs-property">start</span>;
        colIndex &lt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">visibleCols</span>.<span class="hljs-property">end</span>;
        colIndex++
      ) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderCell</span>(rowIndex, colIndex);
      }
    }
  }
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbalabll%2Fmulti-table%2Ftree%2F002" target="_blank" title="https://github.com/balabll/multi-table/tree/002" ref="nofollow noopener noreferrer">æœ¬æ–‡æ¶‰åŠçš„ä»£ç </a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript ä¸­çš„ ç®€å•æ•°æ®ç±»å‹ï¼šSymbolâ€”â€”æ˜¯JavaScriptæˆç†Ÿçš„æ ‡å¿—]]></title>    <link>https://juejin.cn/post/7577411657394176042</link>    <guid>https://juejin.cn/post/7577411657394176042</guid>    <pubDate>2025-11-28T09:08:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577411657394176042" data-draft-id="7577461079598399507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" JavaScript ä¸­çš„ ç®€å•æ•°æ®ç±»å‹ï¼šSymbolâ€”â€”æ˜¯JavaScriptæˆç†Ÿçš„æ ‡å¿—"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-28T09:08:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ €ç§‹666"/> <meta itemprop="url" content="https://juejin.cn/user/2566698322650307"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             JavaScript ä¸­çš„ ç®€å•æ•°æ®ç±»å‹ï¼šSymbolâ€”â€”æ˜¯JavaScriptæˆç†Ÿçš„æ ‡å¿—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2566698322650307/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ €ç§‹666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:08:50.000Z" title="Fri Nov 28 2025 09:08:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ·±å…¥ç†è§£ JavaScript ä¸­çš„ Symbolï¼šä¸åªæ˜¯â€œå”¯ä¸€å€¼â€çš„å“²å­¦</h2>
<p>åœ¨ JavaScript çš„å…«ç§æ•°æ®ç±»å‹ä¸­ï¼Œ<code>Symbol</code> æ˜¯ ES6 å¼•å…¥çš„æ–°æˆå‘˜ã€‚å®ƒä¸åƒ <code>number</code> æˆ– <code>string</code> é‚£æ ·ç›´è§‚ï¼Œä¹Ÿä¸åƒ <code>object</code> é‚£æ ·å¤æ‚å¤šå˜ã€‚å®ƒå®‰é™åœ°å­˜åœ¨äºè¯­è¨€åº•å±‚ï¼Œå´æ‰¿è½½ç€ä¸€ç§ç‹¬ç‰¹çš„â€œèº«ä»½æ ‡è¯†â€ä½¿å‘½ã€‚å¾ˆå¤šäººåˆè¯† <code>Symbol</code> æ—¶ï¼Œå¾€å¾€åªè®°ä½ä¸€å¥è¯ï¼šâ€œå®ƒæ˜¯å”¯ä¸€çš„å€¼â€ï¼Œç„¶åä¾¿æ­¢æ­¥äºæ­¤ã€‚ä½†çœŸæ­£ç†è§£ <code>Symbol</code>ï¼Œéœ€è¦æˆ‘ä»¬è·³å‡ºâ€œå”¯ä¸€æ€§â€è¿™ä¸ªæ ‡ç­¾ï¼Œå»æ€è€ƒå®ƒçš„è®¾è®¡å“²å­¦ã€ä½¿ç”¨åœºæ™¯ä»¥åŠå®ƒå¦‚ä½•æ‚„ç„¶æ”¹å˜äº† JavaScript å¯¹è±¡æ¨¡å‹çš„è¿ä½œæ–¹å¼ã€‚</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€Symbol çš„æœ¬è´¨ï¼šä¸æ˜¯â€œå€¼â€ï¼Œè€Œæ˜¯â€œèº«ä»½â€</h3>
<p>ä»æŠ€æœ¯å±‚é¢çœ‹ï¼Œ<code>Symbol</code> æ˜¯ä¸€ä¸ªåŸå§‹æ•°æ®ç±»å‹ï¼ˆprimitive typeï¼‰ï¼Œé€šè¿‡è°ƒç”¨å…¨å±€å‡½æ•° <code>Symbol()</code> åˆ›å»ºï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> sym1 = <span class="hljs-title class_">Symbol</span>();
<span class="hljs-keyword">const</span> sym2 = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'description'</span>);
</code></pre>
<p>æ¯æ¬¡è°ƒç”¨ <code>Symbol()</code> éƒ½ä¼šè¿”å›ä¸€ä¸ª<strong>å…¨æ–°ä¸”ç‹¬ä¸€æ— äºŒ</strong>çš„ symbol å€¼ï¼Œå³ä½¿å‚æ•°ç›¸åŒä¹Ÿæ˜¯å¦‚æ­¤ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'foo'</span>) === <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'foo'</span>); <span class="hljs-comment">// false</span>
</code></pre>
<p>è¿™è¯´æ˜ï¼Œ<code>Symbol</code> ä¸æ˜¯åœ¨æ¯”è¾ƒå†…å®¹ï¼Œè€Œæ˜¯åœ¨æ¯”è¾ƒâ€œèº«ä»½â€ã€‚å°±åƒä¸–ç•Œä¸Šæ²¡æœ‰ä¸¤ç‰‡å®Œå…¨ç›¸åŒçš„é›ªèŠ±ï¼Œä¹Ÿæ²¡æœ‰ä¸¤ä¸ªç›¸åŒçš„ symbol â€”â€” å®ƒä»¬ç”Ÿæ¥å°±æ˜¯ä¸åŒçš„ä¸ªä½“ã€‚</p>
<p>è¿™ç§ç‰¹æ€§ä½¿å¾— <code>Symbol</code> å¤©ç„¶é€‚åˆä½œä¸ºå¯¹è±¡çš„â€œç§æœ‰é”®â€æˆ–â€œå…ƒå±æ€§é”®â€ã€‚ä½†å®ƒçœŸæ­£çš„ä»·å€¼ï¼Œå¹¶ä¸åœ¨äºâ€œä¸å¯é‡å¤â€ï¼Œè€Œåœ¨äº <strong>â€œä¸å¯é¢„è§â€</strong> å’Œ <strong>â€œä¸å¯æšä¸¾â€</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-2">äºŒã€Symbol ä¸å¯¹è±¡ï¼šä¸€åœºå…³äºâ€œå‘½åå†²çªâ€çš„æ•‘èµ</h3>
<p>JavaScript çš„å¯¹è±¡æ˜¯åŠ¨æ€çš„ï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶æ·»åŠ å±æ€§ã€‚ä½†åœ¨å¤§å‹é¡¹ç›®æˆ–å¤šå›¢é˜Ÿåä½œä¸­ï¼Œè¿™ç§çµæ´»æ€§åè€Œæˆäº†éšæ‚£ï¼šä¸åŒæ¨¡å—å¯èƒ½æ— æ„ä¸­ä½¿ç”¨äº†ç›¸åŒçš„å±æ€§åï¼Œå¯¼è‡´è¦†ç›–å’Œ bugã€‚</p>
<p>ä¼ ç»Ÿåšæ³•æ˜¯åŠ å‰ç¼€ï¼Œæ¯”å¦‚ <code>_privateProp</code> æˆ– <code>$$internal</code>ï¼Œä½†è¿™åªæ˜¯â€œçº¦å®šä¿—æˆâ€ï¼Œæ— æ³•çœŸæ­£é¿å…å†²çªã€‚</p>
<p>è€Œ <code>Symbol</code> æä¾›äº†ä¸€ç§<strong>è¯­è¨€çº§åˆ«çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// æ¨¡å— A</span>
<span class="hljs-keyword">const</span> cacheKey = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'cache'</span>);
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
  [cacheKey] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

  <span class="hljs-title function_">setCache</span>(<span class="hljs-params">key, value</span>) {
    <span class="hljs-variable language_">this</span>[cacheKey].<span class="hljs-title function_">set</span>(key, value);
  }

  <span class="hljs-title function_">getCache</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>[cacheKey].<span class="hljs-title function_">get</span>(key);
  }
}

<span class="hljs-comment">// æ¨¡å— B å³ä½¿ä¹Ÿåˆ›å»ºäº†ä¸€ä¸ªåŒå Symbolï¼Œä¹Ÿä¸ä¼šå½±å“æ¨¡å— A</span>
<span class="hljs-keyword">const</span> anotherCacheKey = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'cache'</span>); <span class="hljs-comment">// å®Œå…¨æ— å…³</span>
</code></pre>
<p>è¿™é‡Œçš„ <code>cacheKey</code> æ˜¯ä¸€ä¸ª symbolï¼Œä½œä¸ºå¯¹è±¡çš„ key ä½¿ç”¨æ—¶ï¼Œä¸ä¼šè¢«å¤–éƒ¨è½»æ˜“è®¿é—®æˆ–è¦†ç›–ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå…¶ä»–ä»£ç å³ä½¿çŸ¥é“ä½ ç”¨äº† <code>'cache'</code> è¿™ä¸ªæè¿°ï¼Œä¹Ÿæ— æ³•æ„é€ å‡ºç›¸åŒçš„ key â€”â€” å› ä¸º symbol çš„å”¯ä¸€æ€§ä¸ç”±æè¿°å†³å®šã€‚</p>
<p>è¿™å°±æ˜¯ <code>Symbol</code> çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š<strong>æä¾›ä¸€ç§æœºåˆ¶ï¼Œè®©å¼€å‘è€…å¯ä»¥å®‰å…¨åœ°å‘å¯¹è±¡æ³¨å…¥å…ƒä¿¡æ¯ï¼Œè€Œä¸å¿…æ‹…å¿ƒåå­—æ±¡æŸ“ã€‚</strong></p>
<hr/>
<h3 data-id="heading-3">ä¸‰ã€Symbol çš„â€œéšèº«æ€§â€ï¼šfor...in çœ‹ä¸è§å®ƒ</h3>
<p><code>Symbol</code> ä½œä¸ºå¯¹è±¡ key æ—¶ï¼Œé»˜è®¤ä¸ä¼šå‡ºç°åœ¨å¸¸è§„çš„å±æ€§æšä¸¾ä¸­ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>
};

obj[<span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'secret'</span>)] = <span class="hljs-string">'hidden'</span>;

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> obj) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key); <span class="hljs-comment">// åªè¾“å‡º 'name'</span>
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj));        <span class="hljs-comment">// ['name']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));     <span class="hljs-comment">// {"name":"Alice"}</span>
</code></pre>
<p>ç”šè‡³è¿ <code>JSON.stringify</code> éƒ½ä¼šå¿½ç•¥ symbol å±æ€§ï¼è¿™æ˜¯æœ‰æ„ä¸ºä¹‹çš„è®¾è®¡ â€”â€” è¡¨æ˜ symbol æ›´åƒæ˜¯â€œå…ƒæ•°æ®â€è€Œéâ€œä¸šåŠ¡æ•°æ®â€ã€‚</p>
<p>ä½†å¦‚æœä½ çœŸçš„æƒ³è·å–è¿™äº›â€œéšè—é’¥åŒ™â€ï¼ŒJavaScript ä¹Ÿæä¾›äº†ä¸“é—¨çš„æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertySymbols</span>(obj); 
<span class="hljs-comment">// è¿”å› [Symbol(secret)]</span>
</code></pre>
<p>è¿™å°±å½¢æˆäº†ä¸€ç§æœ‰è¶£çš„åˆ†å±‚ç»“æ„ï¼š</p>
<ul>
<li><code>for...in</code>ã€<code>Object.keys()</code>ï¼šé¢å‘å…¬ä¼—çš„å±æ€§</li>
<li><code>Object.getOwnPropertySymbols()</code>ï¼šé¢å‘å†…éƒ¨æˆ–ç‰¹å®šä¸Šä¸‹æ–‡çš„å…ƒå±æ€§</li>
</ul>
<p>è¿™ç§åˆ†ç¦»è®©æˆ‘ä»¬å¯ä»¥åœ¨ä¸å¹²æ‰°å…¬å…± API çš„å‰æä¸‹ï¼Œé™„åŠ è°ƒè¯•ä¿¡æ¯ã€ç¼“å­˜ã€çŠ¶æ€æ ‡è®°ç­‰ã€‚</p>
<hr/>
<h3 data-id="heading-4">å››ã€Symbol çš„é«˜çº§ç”¨æ³•ï¼šä¸ä»…ä»…æ˜¯ key</h3>
<p>é™¤äº†ä½œä¸ºå¯¹è±¡ keyï¼Œ<code>Symbol</code> è¿˜æœ‰ä¸€äº›å†…ç½®çš„â€œçŸ¥åç¬¦å·â€ï¼ˆWell-Known Symbolsï¼‰ï¼Œç”¨äºå®šåˆ¶ JavaScript å¯¹è±¡çš„è¡Œä¸ºã€‚è¿™äº›ä»¥ <code>Symbol.xxx</code> å½¢å¼å­˜åœ¨çš„å±æ€§ï¼Œå…¶å®æ˜¯è¯­è¨€å†…éƒ¨çš„é’©å­ï¼ˆhooksï¼‰ã€‚</p>
<h4 data-id="heading-5">1. <code>Symbol.iterator</code>ï¼šè®©å¯¹è±¡å¯è¿­ä»£</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> myCollection = {
  <span class="hljs-attr">items</span>: [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>],
  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]() {
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">next</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">return</span> index &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> ?
          { <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>[index++], <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> } :
          { <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span> };
      }
    };
  }
};

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> item <span class="hljs-keyword">of</span> myCollection) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item); <span class="hljs-comment">// a, b, c</span>
}
</code></pre>
<p>é€šè¿‡å®ç° <code>Symbol.iterator</code>ï¼Œæ™®é€šå¯¹è±¡ä¹Ÿèƒ½è¢« <code>for...of</code> éå†ã€‚è¿™æ˜¯ JavaScript è¿­ä»£åè®®çš„æ ¸å¿ƒã€‚</p>
<h4 data-id="heading-6">2. <code>Symbol.toStringTag</code>ï¼šè‡ªå®šä¹‰ toString è¾“å‡º</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> myObj = {
  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">toStringTag</span>]: <span class="hljs-string">'MySpecialObject'</span>
};

<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(myObj); 
<span class="hljs-comment">// "[object MySpecialObject]"</span>
</code></pre>
<p>åŸæœ¬æ‰€æœ‰å¯¹è±¡ <code>toString</code> éƒ½æ˜¯ <code>[object Object]</code>ï¼Œç°åœ¨ä½ å¯ä»¥è®©å®ƒæ›´å…·ä½“ã€‚</p>
<h4 data-id="heading-7">3. <code>Symbol.hasInstance</code>ï¼šæ§åˆ¶ instanceof è¡Œä¸º</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
  <span class="hljs-keyword">static</span> [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">hasInstance</span>](instance) {
    <span class="hljs-keyword">return</span> instance.<span class="hljs-property">type</span> === <span class="hljs-string">'myclass'</span>;
  }
}

<span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">type</span>: <span class="hljs-string">'myclass'</span> };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyClass</span>); <span class="hljs-comment">// true!</span>
</code></pre>
<p>è¿™æ‰“ç ´äº† <code>instanceof</code> å¿…é¡»åŸºäºåŸå‹é“¾çš„ä¼ ç»Ÿè®¤çŸ¥ï¼Œèµ‹äºˆæˆ‘ä»¬æ›´å¤§çš„æ§åˆ¶æƒã€‚</p>
<p>è¿™äº›å†…ç½® <code>Symbol</code> è¡¨æ˜ï¼š<code>Symbol</code> ä¸åªæ˜¯ä¸€ä¸ªâ€œé˜²é‡å‘½åå·¥å…·â€ï¼Œæ›´æ˜¯ JavaScript å¼€æ”¾å…¶å†…éƒ¨æœºåˆ¶çš„ä¸€ç§æ‰‹æ®µ â€”â€” å®ƒæŠŠåŸæœ¬å°é—­çš„è¯­è¨€è¡Œä¸ºï¼Œå˜æˆäº†å¯æ‰©å±•çš„æ¥å£ã€‚</p>
<hr/>
<h3 data-id="heading-8">äº”ã€Symbol çš„å±€é™ä¸è¯¯è§£</h3>
<p>å°½ç®¡å¼ºå¤§ï¼Œ<code>Symbol</code> å¹¶éé“¶å¼¹ã€‚æˆ‘ä»¬éœ€è¦æ¸…é†’è®¤è¯†å®ƒçš„è¾¹ç•Œï¼š</p>
<h4 data-id="heading-9">âŒ Symbol ä¸æ˜¯çœŸæ­£çš„â€œç§æœ‰â€</h4>
<p>è™½ç„¶ symbol key ä¸æ˜“è¢«è®¿é—®ï¼Œä½†å¹¶éç»å¯¹ç§æœ‰ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> sym = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertySymbols</span>(obj)[<span class="hljs-number">0</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj[sym]); <span class="hljs-comment">// ä¾ç„¶èƒ½æ‹¿åˆ°</span>
</code></pre>
<p>å¦‚æœæœ‰äººæ‹¿åˆ°äº† symbol å¼•ç”¨ï¼Œå°±èƒ½è®¿é—®å¯¹åº”å±æ€§ã€‚çœŸæ­£çš„ç§æœ‰åº”ä½¿ç”¨ <code>#field</code>ï¼ˆES2022 ç§æœ‰å­—æ®µï¼‰ã€‚</p>
<h4 data-id="heading-10">âŒ Symbol ä¸èƒ½åºåˆ—åŒ–</h4>
<p>å¦‚å‰æ‰€è¿°ï¼Œ<code>JSON.stringify</code> ä¼šå¿½ç•¥ symbol å±æ€§ã€‚å› æ­¤ä¸é€‚åˆç”¨äºéœ€è¦æŒä¹…åŒ–çš„æ•°æ®ç»“æ„ã€‚</p>
<h4 data-id="heading-11">âŒ å…¨å±€ symbolï¼Ÿå¯ä»¥ç”¨ <code>Symbol.for()</code></h4>
<p>å¦‚æœç¡®å®éœ€è¦è·¨æ–‡ä»¶å…±äº«åŒä¸€ä¸ª symbolï¼Œå¯ä»¥ä½¿ç”¨å…¨å±€æ³¨å†Œè¡¨ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> s1 = <span class="hljs-title class_">Symbol</span>.<span class="hljs-title function_">for</span>(<span class="hljs-string">'shared'</span>);
<span class="hljs-keyword">const</span> s2 = <span class="hljs-title class_">Symbol</span>.<span class="hljs-title function_">for</span>(<span class="hljs-string">'shared'</span>);
s1 === s2; <span class="hljs-comment">// true</span>
</code></pre>
<p>æ³¨æ„ï¼š<code>Symbol.for(key)</code> æ˜¯æŸ¥æ‰¾æˆ–åˆ›å»ºï¼Œè€Œ <code>Symbol(key)</code> æ°¸è¿œæ–°å»ºã€‚</p>
<hr/>
<h3 data-id="heading-12">å…­ã€Symbol çš„å“²å­¦æ„ä¹‰ï¼šä»â€œå‘½åâ€åˆ°â€œæ ‡è¯†â€</h3>
<p>å›é¡¾ç¼–ç¨‹å²ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä¸â€œå‘½åâ€æ–—äº‰ã€‚å˜é‡åã€å‡½æ•°åã€ç±»åâ€¦â€¦æ¯ä¸€ä¸ªåå­—éƒ½æ˜¯ä¸€æ¬¡æ‰¿è¯ºï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€æ¬¡å¦¥åã€‚å½“ç³»ç»Ÿè¶Šæ¥è¶Šå¤§ï¼Œå‘½åç©ºé—´å°±å˜å¾—æ‹¥æŒ¤ä¸å ªã€‚</p>
<p><code>Symbol</code> çš„å‡ºç°ï¼ŒæŸç§ç¨‹åº¦ä¸Šæ˜¯å¯¹â€œå‘½åä¸­å¿ƒä¸»ä¹‰â€çš„åå›ã€‚å®ƒå‘Šè¯‰æˆ‘ä»¬ï¼šæœ‰äº›ä¸œè¥¿ä¸éœ€è¦åå­—ï¼Œåªéœ€è¦èº«ä»½ã€‚</p>
<p>å°±åƒç°å®ä¸–ç•Œä¸­ï¼Œæ¯ä¸ªäººéƒ½æœ‰èº«ä»½è¯å·ï¼Œä½†å¹³æ—¶æˆ‘ä»¬ç”¨åå­—ç§°å‘¼å½¼æ­¤ã€‚<code>Symbol</code> å°±æ˜¯é‚£ä¸ªèº«ä»½è¯å· â€”â€” ä¸å¸¸æèµ·ï¼Œä½†åœ¨å…³é”®æ—¶å€™èƒ½å‡†ç¡®è¯†åˆ«â€œä½ æ˜¯è°â€ã€‚</p>
<p>è¿™ä¹Ÿåæ˜ äº†ç°ä»£ç¼–ç¨‹çš„ä¸€ä¸ªè¶‹åŠ¿ï¼š<strong>ä»â€œæ˜¾å¼å‘½åâ€è½¬å‘â€œéšå¼æ ‡è¯†â€</strong>ã€‚æ— è®ºæ˜¯ React çš„ fiber èŠ‚ç‚¹ã€Vue çš„å“åº”å¼ä¾èµ–è¿½è¸ªï¼Œè¿˜æ˜¯ Redux çš„ action typeï¼Œè¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿå¼€å§‹ä½¿ç”¨ symbol æ¥ç®¡ç†å†…éƒ¨çŠ¶æ€ï¼Œé¿å…å¯¹å¤–æš´éœ²è¿‡å¤šç»†èŠ‚ã€‚</p>
<hr/>
<h3 data-id="heading-13">ä¸ƒã€å®æˆ˜å»ºè®®ï¼šä½•æ—¶è¯¥ç”¨ Symbolï¼Ÿ</h3>
<p>ç»“åˆä»¥ä¸Šåˆ†æï¼Œä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>Symbol</code> çš„å…¸å‹åœºæ™¯ï¼š</p>

































<table><thead><tr><th>åœºæ™¯</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>âœ… é˜²æ­¢å±æ€§åå†²çª</td><td>æ’ä»¶ç³»ç»Ÿä¸­æŒ‚è½½ç§æœ‰çŠ¶æ€</td></tr><tr><td>âœ… æ·»åŠ å…ƒä¿¡æ¯</td><td>ç»™ DOM å…ƒç´ é™„åŠ è°ƒè¯•æ ‡è®°</td></tr><tr><td>âœ… å®ç°è¯­è¨€åè®®</td><td>è®©å¯¹è±¡æ”¯æŒè¿­ä»£ã€è½¬æ¢å­—ç¬¦ä¸²ç­‰</td></tr><tr><td>âœ… æ¨¡æ‹Ÿç§æœ‰æˆå‘˜</td><td>ç±»çš„å†…éƒ¨ç¼“å­˜ã€é…ç½®é¡¹</td></tr><tr><td>âŒ æ•°æ®å­˜å‚¨</td><td>éœ€è¦ JSON åºåˆ—åŒ–çš„å­—æ®µ</td></tr><tr><td>âŒ çœŸæ­£çš„ç§æœ‰</td><td>åº”ä½¿ç”¨ <code>#private</code> å­—æ®µ</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-14">ç»“è¯­ï¼šSymbol æ˜¯ JavaScript æˆç†Ÿçš„æ ‡å¿—</h3>
<p><code>Symbol</code> çœ‹ä¼¼å°ä¼—ï¼Œå®åˆ™æ˜¯ JavaScript èµ°å‘æˆç†Ÿçš„é‡è¦ä¸€æ­¥ã€‚å®ƒä¸å†æ»¡è¶³äºåšä¸€ä¸ªâ€œè„šæœ¬è¯­è¨€â€ï¼Œè€Œæ˜¯å¼€å§‹æ„å»ºæ›´ä¸¥è°¨çš„æŠ½è±¡èƒ½åŠ›ã€‚</p>
<p>å®ƒæ•™ä¼šæˆ‘ä»¬ï¼šæœ‰æ—¶å€™ï¼Œâ€œçœ‹ä¸è§â€æ¯”â€œçœ‹å¾—è§â€æ›´æœ‰åŠ›é‡ï¼›â€œå”¯ä¸€â€ä¸ä»…æ˜¯æŠ€æœ¯ç‰¹æ€§ï¼Œæ›´æ˜¯ä¸€ç§è®¾è®¡å“²å­¦ã€‚</p>
<p>å½“ä½ ä¸‹æ¬¡é¢å¯¹å¯¹è±¡å±æ€§å‘½åçº ç»“æ—¶ï¼Œä¸å¦¨é—®è‡ªå·±ä¸€å¥ï¼š</p>
<blockquote>
<p>â€œè¿™ä¸ªå±æ€§ï¼ŒçœŸçš„éœ€è¦ä¸€ä¸ªåå­—å—ï¼Ÿâ€</p>
</blockquote>
<p>ä¹Ÿè®¸ç­”æ¡ˆæ˜¯ï¼šå®ƒåªéœ€è¦ä¸€ä¸ª <code>Symbol</code>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…³äºObjectAnimator]]></title>    <link>https://juejin.cn/post/7577563004481732662</link>    <guid>https://juejin.cn/post/7577563004481732662</guid>    <pubDate>2025-11-28T08:31:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577563004481732662" data-draft-id="7577364921657819178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…³äºObjectAnimator "/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-28T08:31:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŸä¸œç±³ç²‰å„¿"/> <meta itemprop="url" content="https://juejin.cn/user/4283353029151694"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…³äºObjectAnimator 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4283353029151694/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŸä¸œç±³ç²‰å„¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T08:31:16.000Z" title="Fri Nov 28 2025 08:31:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åŸºæœ¬ä½¿ç”¨</h2>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-type">ObjectAnimator</span> <span class="hljs-variable">animator</span> <span class="hljs-operator">=</span> ObjectAnimator.ofFloat(view,<span class="hljs-string">"alpha"</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);
    animator.start();
</code></pre>
<p>å…³é”®ç‚¹åœ¨äºç¬¬äºŒä¸ªå‚æ•°ï¼šString propertyName
å¦‚æœéœ€è¦ä½¿ç”¨è¿™ä¸ªå‚æ•°å¯¹åº”çš„æ•ˆæœï¼Œéœ€è¦æ“ä½œçš„viewä¸­æœ‰å¯¹åº”çš„setå±æ€§æ–¹æ³•ï¼ˆset å‡½æ•°çš„å‘½åå¿…é¡»é‡‡ç”¨éª†é©¼æ‹¼å†™æ³•ï¼‰ã€‚
ä¾‹å¦‚ï¼šalpha å¯¹åº” setAlpha()æ–¹æ³•</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11096675d18746be8dccae1f1092c186~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O5Lic57Gz57KJ5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764923476&amp;x-signature=Eu5Q5UOpeChQgqelayUhFnQEGDU%3D" alt="image.png" loading="lazy"/>
å¼•ç”¨è‡ªã€ŠAndroidè‡ªå®šä¹‰æ§ä»¶å¼€å‘å…¥é—¨ä¸å®æˆ˜ã€‹</p>
<p>æ‰€ä»¥ValueAnimator ä¸€èˆ¬åœ¨å›è°ƒä¸­æ“ä½œï¼Œè€ŒObjectAnimatoræ–¹ä¾¿åœ¨è‡ªå®šä¹‰viewä¸­è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚</p>
<p><strong>å…³äºofObject()çš„ä½¿ç”¨</strong></p>
<p>ofObject()å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤„ç†çš„å€¼ä¸é™äºintæˆ–è€…floatï¼Œæˆ‘ä»¬å¯ä»¥ä¼ è‡ªå®šä¹‰çš„å€¼è¿›è¡Œå¤„ç†ï¼Œå¦‚å¯¹è±¡ã€‚</p>
<p>ä½¿ç”¨å®ä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ObjectAnimator</span> <span class="hljs-variable">animator</span> <span class="hljs-operator">=</span> ObjectAnimator.ofObject(view,<span class="hljs-string">"jump"</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">JumpEvaluator</span>(),<span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>),<span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>(<span class="hljs-number">30</span>ï¼Œ<span class="hljs-number">30</span>));
animator.setDuration(<span class="hljs-number">299</span>);
animator.start();
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JumpEvaluator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TypeEvalutor</span>&lt;Point&gt;{
    <span class="hljs-keyword">private</span> <span class="hljs-type">Point</span> <span class="hljs-variable">point</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>();
   
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Point <span class="hljs-title function_">evaluate</span><span class="hljs-params">(<span class="hljs-type">float</span> fraction, Point startValue, Point endValue)</span> { 
        <span class="hljs-comment">//è‡ªå·±çš„é€»è¾‘</span>
        <span class="hljs-comment">//point.x = (int)(startValue.x + fraction *(endValue.x - startValue.x));</span>
        <span class="hljs-comment">//if (fraction*2&lt;=1){ </span>
        <span class="hljs-comment">//    point.y = (int)(startValue.y + fraction*2*(endValue.y - startValue.y));</span>
        <span class="hljs-comment">// }else { </span>
        <span class="hljs-comment">//    point.y = endValue.y; </span>
        <span class="hljs-comment">//} </span>
    <span class="hljs-keyword">return</span> point;
}
</code></pre>
<p><strong>æ³¨æ„</strong></p>
<p>å¯¹äºofFloat(),ofInt()æœ€åä¸€ä¸ªå¯å˜å‚æ•°ï¼Œå¦‚æœåªä¼ ä¸€ä¸ªå€¼ï¼Œå› ä¸ºå¯¹åº”çš„getæ–¹æ³•ï¼Œè€Œfloat,int å¯¹åº”é»˜è®¤å€¼ä¸º0ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šæŠ¥è­¦å‘Šä½†ä¸è‡³äºå´©æºƒï¼Œè€ŒofObject()å¯¹åº”çš„å±æ€§ï¼Œæ²¡æœ‰é»˜è®¤çš„getæ–¹æ³•ï¼Œæ‰€ä»¥å•ä¸ªå‚æ•°ä¼šå´©æºƒ</p>
<p><strong>å…¶ä»–</strong></p>
<p><code>void setRepeatCount(int value)</code>  //è®¾ç½®å¾ªç¯æ¬¡æ•°ï¼Œè®¾ç½®ä¸º INFINITE è¡¨ç¤ºæ— é™å¾ªç¯</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIç”ŸæˆCADå›¾çº¸ï¼ˆäº‘åŸç”ŸCAD+AIè®©è®¾è®¡åƒèŠå¤©ä¸€æ ·ç®€å•ï¼‰]]></title>    <link>https://juejin.cn/post/7577587651894132777</link>    <guid>https://juejin.cn/post/7577587651894132777</guid>    <pubDate>2025-11-28T09:20:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577587651894132777" data-draft-id="7577364921657688106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIç”ŸæˆCADå›¾çº¸ï¼ˆäº‘åŸç”ŸCAD+AIè®©è®¾è®¡åƒèŠå¤©ä¸€æ ·ç®€å•ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-11-28T09:20:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¢¦æƒ³CADæ§ä»¶"/> <meta itemprop="url" content="https://juejin.cn/user/4151388919837671"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIç”ŸæˆCADå›¾çº¸ï¼ˆäº‘åŸç”ŸCAD+AIè®©è®¾è®¡åƒèŠå¤©ä¸€æ ·ç®€å•ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4151388919837671/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¢¦æƒ³CADæ§ä»¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:20:19.000Z" title="Fri Nov 28 2025 09:20:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é¡¹ç›®æ¦‚è¿°</h2>
<p>æœ¬ç« èŠ‚æ¢è®¨AIæŠ€æœ¯ä¸åœ¨çº¿CADç›¸ç»“åˆï¼Œèƒ½å¦æ‰“é€ ä¸€ä¸ªèƒ½è®©CAD"å¬æ‡‚äººè¯"çš„æ™ºèƒ½åŠ©æ‰‹ã€‚</p>
<p><strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šå‘Šåˆ«ç¹ççš„æ‰‹åŠ¨ç»˜å›¾ï¼Œç”¨è‡ªç„¶è¯­è¨€å°±èƒ½å®ŒæˆCADè®¾è®¡ã€‚æ— è®ºæ˜¯å»ºç­‘å·¥ç¨‹å¸ˆã€æœºæ¢°è®¾è®¡å¸ˆï¼Œè¿˜æ˜¯CADå¼€å‘è€…ï¼Œéƒ½èƒ½é€šè¿‡AIå¤§å¹…æå‡å·¥ä½œæ•ˆç‡ã€‚</p>
<h2 data-id="heading-1">ä¸ºä»€ä¹ˆé€‰æ‹©MxCADæ¥åšCADæ™ºèƒ½ç³»ç»Ÿï¼Ÿ</h2>
<h3 data-id="heading-2">1. åŸå­åŒ–API - AIæ—¶ä»£çš„CADå¼€å‘åˆ©å™¨</h3>
<p>ä¼ ç»ŸCADè½¯ä»¶çš„é—®é¢˜æ˜¯ï¼šä½ åªèƒ½ç”¨å®ƒç»™ä½ çš„åŠŸèƒ½ï¼Œæ¯”å¦‚"ç”»ç›´çº¿"ã€"ç”»åœ†"è¿™æ ·çš„æ•´ä½“åŠŸèƒ½ã€‚ä½†MxCADçš„APIæŠŠæ‰€æœ‰åŠŸèƒ½éƒ½æ‹†å¾—ç‰¹åˆ«ç»†ï¼Œå°±åƒä¹é«˜ç§¯æœ¨ä¸€æ ·ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼ï¼šåªèƒ½è°ƒç”¨drawCircle()</span>
<span class="hljs-title function_">drawCircle</span>(center, radius);
<span class="hljs-comment">// MxCADåŸå­åŒ–APIï¼šAIå¯ä»¥ç²¾ç¡®æ§åˆ¶æ¯ä¸ªç»†èŠ‚</span>
<span class="hljs-keyword">const</span>Â centerÂ = <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">McGePoint3</span>d(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>); Â <span class="hljs-comment">// ç²¾ç¡®æ§åˆ¶åœ†å¿ƒ</span>
<span class="hljs-keyword">const</span>Â circleÂ = <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">McDbCircle</span>(); Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">// åˆ›å»ºåœ†å¯¹è±¡</span>
circle.<span class="hljs-property">center</span>Â = center; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// è®¾ç½®åœ†å¿ƒ</span>
circle.<span class="hljs-property">radius</span>Â = <span class="hljs-number">50</span>; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// è®¾ç½®åŠå¾„</span>
circle.<span class="hljs-property">trueColor</span>Â = <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">McCmColor</span>(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); Â <span class="hljs-comment">// ç²¾ç¡®æ§åˆ¶é¢œè‰²</span>
entitys.<span class="hljs-title function_">push</span>(circle); Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// æ·»åŠ åˆ°å›¾çº¸</span>
</code></pre>
<p><strong>è¿™å¯¹AIæ„å‘³ç€ä»€ä¹ˆï¼Ÿ</strong></p>
<blockquote>
<p>-Â AIå¯ä»¥åƒäººç±»å·¥ç¨‹å¸ˆä¸€æ ·æ€è€ƒï¼Œç†è§£æ¯ä¸ªå‡ ä½•å…ƒç´ çš„å«ä¹‰</p>
<p>-Â å¯ä»¥ç²¾ç¡®æ§åˆ¶é¢œè‰²ã€å›¾å±‚ã€çº¿å‹ç­‰æ‰€æœ‰å±æ€§</p>
<p>-Â èƒ½å¤„ç†å¤æ‚çš„ç©ºé—´å˜æ¢å’Œå‡ ä½•è®¡ç®—</p>
<p>-Â ç”Ÿæˆçš„ä»£ç è´¨é‡æ›´é«˜ï¼Œæ›´ç¬¦åˆå·¥ç¨‹è§„èŒƒ</p>
</blockquote>
<h3 data-id="heading-3">2. æ™ºèƒ½ä½“ç­–ç•¥ - è®©AIåƒä¸“ä¸šå·¥ç¨‹å¸ˆä¸€æ ·æ€è€ƒ</h3>
<p>æˆ‘ä»¬è®¾è®¡äº†ä¸‰ç§AIæ™ºèƒ½ä½“ï¼Œå„è‡ªè´Ÿè´£ä¸åŒçš„ä¸“ä¸šé¢†åŸŸï¼š</p>
<h4 data-id="heading-4">A.å»ºæ¨¡æ™ºèƒ½ä½“ï¼ˆModelingAgentï¼‰</h4>
<p><strong>ä¸“ä¸šé¢†åŸŸ</strong> ï¼šCADå›¾å½¢åˆ›å»ºå’Œè¿­ä»£ä¿®æ”¹</p>
<p><strong>å·¥ä½œæµç¨‹</strong> ï¼š</p>
<blockquote>
<p>1.Â æ¥æ”¶è‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼ˆå¦‚"ç”»ä¸€ä¸ªå¸¦åœ†è§’çš„çŸ©å½¢ï¼Œé•¿100å®½60ï¼Œåœ†è§’åŠå¾„5"ï¼‰</p>
<p>2.Â åˆ†æéœ€æ±‚ï¼Œæ‹†è§£ä¸ºå‡ ä½•å…ƒç´ </p>
<p>3.Â ç”Ÿæˆç²¾ç¡®çš„MxCADä»£ç </p>
<p>4.Â åœ¨æ²™ç®±ä¸­é¢„è§ˆæ•ˆæœ</p>
<p>5.Â è‡ªåŠ¨ä¿®å¤å¯èƒ½çš„é”™è¯¯</p>
<p>6.Â æœ€ç»ˆæ’å…¥åˆ°å›¾çº¸ä¸­</p>
</blockquote>
<p><strong>æŠ€æœ¯äº®ç‚¹</strong> ï¼š</p>
<blockquote>
<p>-Â æ”¯æŒä»£ç è¿­ä»£ä¿®æ”¹ï¼š"åˆšæ‰é‚£ä¸ªçŸ©å½¢ï¼ŒæŠŠåœ†è§’æ”¹æˆ10"</p>
<p>-Â è‡ªåŠ¨ç®¡ç†å®ä½“æ•°ç»„ï¼Œé¿å…é‡å¤å’Œé—æ¼</p>
<p>-Â æ™ºèƒ½é”™è¯¯ä¿®å¤ï¼šä»£ç æ‰§è¡Œå¤±è´¥æ—¶è‡ªåŠ¨åˆ†æé”™è¯¯å¹¶ä¿®å¤</p>
<p>-Â æœ€å¤šé‡è¯•3æ¬¡ï¼Œç¡®ä¿æˆåŠŸç‡
Â </p>
</blockquote>
<h4 data-id="heading-5">B.é€šç”¨æ™ºèƒ½ä½“ï¼ˆDefaultAgentï¼‰</h4>
<p><strong>ä¸“ä¸šé¢†åŸŸ</strong> ï¼šCADå›¾çº¸æ“ä½œå’ŒæŸ¥è¯¢</p>
<p><strong>å…¸å‹ä»»åŠ¡</strong> ï¼š</p>
<blockquote>
<p>-Â "é€‰ä¸­æ‰€æœ‰é•¿åº¦å¤§äº100çš„ç›´çº¿"</p>
<p>-Â "æŠŠå›¾å±‚"æ ‡æ³¨"çš„é¢œè‰²æ”¹æˆçº¢è‰²"</p>
<p>-Â "è®¡ç®—è¿™ä¸ªåŒºåŸŸçš„é¢ç§¯"</p>
<p>-Â "å¯¼å‡ºé€‰ä¸­çš„å®ä½“ä¸ºDXF"
Â </p>
</blockquote>
<p><strong>æŠ€æœ¯äº®ç‚¹</strong> ï¼š</p>
<blockquote>
<p>-Â ç†è§£CADä¸“ä¸šæœ¯è¯­å’Œæ¦‚å¿µ</p>
<p>-Â èƒ½æ“ä½œå›¾å±‚ã€çº¿å‹ã€æ ‡æ³¨ç­‰CADç‰¹æœ‰åŠŸèƒ½</p>
<p>-Â æ”¯æŒå¤æ‚çš„é€‰æ‹©æ¡ä»¶å’Œè¿‡æ»¤</p>
</blockquote>
<h4 data-id="heading-6">C.æ„å›¾è¯†åˆ«æ™ºèƒ½ä½“ï¼ˆIntentRecognitionAgentï¼‰</h4>
<p><strong>è§’è‰²</strong> ï¼šæ™ºèƒ½è°ƒåº¦å‘˜</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<blockquote>
<p>1.Â å…³é”®è¯åŒ¹é…ï¼šå¿«é€Ÿè¯†åˆ«ç”¨æˆ·æ„å›¾ï¼ˆå¦‚åŒ…å«"ç”»"ã€"åˆ›å»º"ç­‰è¯ â†’ å»ºæ¨¡æ™ºèƒ½ä½“ï¼‰</p>
<p>2.Â LLMæ·±åº¦åˆ†æï¼šå¤æ‚è¯·æ±‚è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹åˆ†æ</p>
<p>3.Â æ™ºèƒ½è·¯ç”±ï¼šè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æ™ºèƒ½ä½“å¤„ç†</p>
</blockquote>
<p><strong>ä¼˜åŠ¿</strong>ï¼šç”¨æˆ·æ— éœ€æ‰‹åŠ¨é€‰æ‹©æ¨¡å¼ï¼Œç³»ç»Ÿæ™ºèƒ½åˆ¤æ–­</p>
<h3 data-id="heading-7">3.å®‰å…¨æ²™ç®±-è®©AIä»£ç å®‰å…¨è¿è¡Œ</h3>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦æ²™ç®±ï¼Ÿ</strong></p>
<p>AIç”Ÿæˆçš„ä»£ç å¯èƒ½åŒ…å«é”™è¯¯ã€æ— é™å¾ªç¯æˆ–æ¶æ„ä»£ç ï¼Œç›´æ¥åœ¨ä¸»åº”ç”¨ä¸­æ‰§è¡Œå¯èƒ½å¯¼è‡´å´©æºƒæˆ–æ•°æ®ä¸¢å¤±ã€‚</p>
<p><strong>æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<blockquote>
<p>ç”¨æˆ·è¾“å…¥ â†’ AIç”Ÿæˆä»£ç  â†’ æ²™ç®±é¢„è§ˆ â†’ é”™è¯¯æ£€æµ‹ â†’ è‡ªåŠ¨ä¿®å¤ â†’ ç”¨æˆ·ç¡®è®¤ â†’ æ’å…¥å›¾çº¸</p>
</blockquote>
<p><strong>æŠ€æœ¯å®ç°</strong>ï¼š</p>
<blockquote>
<p>-Â åœ¨éš”ç¦»çš„iframeä¸­æ‰§è¡Œä»£ç </p>
<p>-Â é™åˆ¶è®¿é—®DOMå’Œæœ¬åœ°å­˜å‚¨</p>
<p>-Â æ•è·æ‰€æœ‰é”™è¯¯ä¿¡æ¯</p>
<p>-Â æä¾›è¯¦ç»†çš„é”™è¯¯å †æ ˆåˆ†æ</p>
<p>-Â æ”¯æŒæœ€å¤š3æ¬¡è‡ªåŠ¨ä¿®å¤å°è¯•
Â </p>
</blockquote>
<p><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼š</p>
<blockquote>
<p>-Â å®æ—¶é¢„è§ˆAIç»˜å›¾æ•ˆæœ</p>
<p>-Â ç¡®è®¤æ— è¯¯åå†æ’å…¥å›¾çº¸</p>
<p>-Â éšæ—¶å–æ¶ˆæˆ–é‡æ–°ç”Ÿæˆ</p>
<p>-Â æ”¯æŒæ’¤é”€æ“ä½œ</p>
</blockquote>
<h2 data-id="heading-8">AIåŠŸèƒ½è¯¦è§£</h2>
<h3 data-id="heading-9">è‡ªç„¶è¯­è¨€åˆ°CADä»£ç è½¬æ¢</h3>
<p>ç¤ºä¾‹1ï¼šç»˜åˆ¶å¤æ‚æœºæ¢°é›¶ä»¶</p>
<pre><code class="hljs language-js" lang="js">ç”¨æˆ·ï¼šç”»ä¸€ä¸ªæ³•å…°ç›˜ï¼Œå¤–å¾„<span class="hljs-number">200</span>ï¼Œå†…å¾„<span class="hljs-number">100</span>ï¼Œ<span class="hljs-number">6</span>ä¸ªç›´å¾„<span class="hljs-number">20</span>çš„èºæ “å­”å‡åŒ€åˆ†å¸ƒ
<span class="hljs-variable constant_">AI</span>ç”Ÿæˆä»£ç ï¼š
<span class="hljs-comment">// åˆ›å»ºå¤–åœ†</span>
<span class="hljs-keyword">const</span> outerCircle = <span class="hljs-keyword">new</span> <span class="hljs-title class_">McDbCircle</span>();
outerCircle.<span class="hljs-property">center</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">McGePoint3</span>d(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
outerCircle.<span class="hljs-property">radius</span> = <span class="hljs-number">100</span>;
entitys.<span class="hljs-title function_">push</span>(outerCircle);
<span class="hljs-comment">// åˆ›å»ºå†…åœ†</span>
<span class="hljs-keyword">const</span> innerCircle = <span class="hljs-keyword">new</span> <span class="hljs-title class_">McDbCircle</span>();
innerCircle.<span class="hljs-property">center</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">McGePoint3</span>d(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
innerCircle.<span class="hljs-property">radius</span> = <span class="hljs-number">50</span>;
entitys.<span class="hljs-title function_">push</span>(innerCircle);
<span class="hljs-comment">// åˆ›å»º6ä¸ªèºæ “å­”</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++) {
Â  <span class="hljs-keyword">const</span> angle = (i * <span class="hljs-number">60</span>) * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>;
Â  <span class="hljs-keyword">const</span> hole = <span class="hljs-keyword">new</span> <span class="hljs-title class_">McDbCircle</span>();
Â  hole.<span class="hljs-property">center</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">McGePoint3</span>d(<span class="hljs-number">75</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(angle), <span class="hljs-number">75</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(angle), <span class="hljs-number">0</span>);
Â  hole.<span class="hljs-property">radius</span> = <span class="hljs-number">10</span>;
Â  entitys.<span class="hljs-title function_">push</span>(hole);
}
</code></pre>
<p>ç¤ºä¾‹2ï¼šå»ºç­‘å¹³é¢å›¾</p>
<pre><code class="hljs">ç”¨æˆ·ï¼šç”»ä¸€ä¸ª10mÃ—8mçš„æˆ¿é—´ï¼Œå¢™åš240mmï¼Œé—¨å®½900mmåœ¨å³ä¾§å¢™ä¸­å¤®
AIè‡ªåŠ¨è®¡ç®—æ‰€æœ‰å°ºå¯¸ï¼Œç”Ÿæˆç¬¦åˆå»ºç­‘è§„èŒƒçš„å¢™ä½“å’Œé—¨çª—
</code></pre>
<h3 data-id="heading-10">æ™ºèƒ½ä»£ç ä¼˜åŒ–</h3>
<p><strong>è‡ªåŠ¨è¡¥å…¨importè¯­å¥</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// AIç”Ÿæˆçš„ä»£ç å¯èƒ½ç¼ºå°‘import</span>
<span class="hljs-keyword">const</span>Â lineÂ = <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">McDbLine</span>(); <span class="hljs-comment">// é”™è¯¯ï¼šMcDbLineæœªå®šä¹‰</span>
<span class="hljs-comment">// ç³»ç»Ÿè‡ªåŠ¨è¡¥å…¨</span>
<span class="hljs-keyword">import</span>Â { <span class="hljs-title class_">McDbLine</span>, <span class="hljs-title class_">McGePoint3</span>dÂ } <span class="hljs-keyword">from</span>Â <span class="hljs-string">"mxcad"</span>;
<span class="hljs-keyword">const</span>Â lineÂ = <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">McDbLine</span>(); <span class="hljs-comment">// æ­£ç¡®</span>
</code></pre>
<p><strong>ç®¡ç†å®ä½“æ•°ç»„</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// AIå¯èƒ½å¿˜è®°å°†å®ä½“æ·»åŠ åˆ°å›¾çº¸</span>
<span class="hljs-keyword">const</span>Â circleÂ = <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">McDbCircle</span>();
<span class="hljs-comment">// ç¼ºå°‘ entitys.push(circle);</span>
<span class="hljs-comment">// ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å¹¶æ·»åŠ </span>
<span class="hljs-keyword">const</span>Â circleÂ = <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">McDbCircle</span>();
entitys.<span class="hljs-title function_">push</span>(circle); <span class="hljs-comment">// è‡ªåŠ¨æ·»åŠ </span>
</code></pre>
<p><strong>æ™ºèƒ½ä¿®å¤è¯­æ³•é”™è¯¯</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// AIå¯èƒ½ç”Ÿæˆæœ‰è¯­æ³•é”™è¯¯çš„ä»£ç </span>
<span class="hljs-keyword">const</span>Â pointÂ = <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">McGePoint3</span>d(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// ç¼ºå°‘åˆ†å·</span>
<span class="hljs-comment">// ç³»ç»Ÿè‡ªåŠ¨ä¿®å¤</span>
<span class="hljs-keyword">const</span>Â pointÂ = <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">McGePoint3</span>d(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// è‡ªåŠ¨æ·»åŠ åˆ†å·</span>
</code></pre>
<h3 data-id="heading-11">å¤šAIæ¨¡å‹æ”¯æŒ</h3>
<p><strong>æ”¯æŒçš„AIæä¾›å•†</strong>ï¼š</p>
<blockquote>
<p>-Â OpenRouterï¼šç»Ÿä¸€æ¥å£ï¼Œæ”¯æŒDeepSeekã€Llamaã€Geminiç­‰100+æ¨¡å‹</p>
<p>-Â OpenAIï¼šGPT-4ã€GPT-3.5ç­‰å®˜æ–¹æ¨¡å‹</p>
<p>-Â iFlowï¼šå›½äº§å¤§æ¨¡å‹ï¼ŒåŒ…æ‹¬é€šä¹‰åƒé—®ã€Kimiã€DeepSeekç­‰</p>
<p>-Â è‡ªå®šä¹‰ï¼šæ”¯æŒä»»ä½•OpenAIå…¼å®¹çš„API</p>
</blockquote>
<p><strong>æ¨¡å‹é€‰æ‹©ç­–ç•¥</strong>ï¼š</p>
<blockquote>
<p>-Â å…è´¹æ¨¡å‹ï¼šé€‚åˆæµ‹è¯•å’Œç®€å•ä»»åŠ¡</p>
<p>-Â ä»˜è´¹æ¨¡å‹ï¼šé€‚åˆå¤æ‚ä»»åŠ¡å’Œé«˜è´¨é‡è¦æ±‚</p>
<p>-Â å›½äº§æ¨¡å‹ï¼šé€‚åˆæ•°æ®å®‰å…¨è¦æ±‚é«˜çš„åœºæ™¯</p>
</blockquote>
<h2 data-id="heading-12">å®é™…åº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-13">åœºæ™¯ä¸€ï¼šå»ºç­‘å·¥ç¨‹å¸ˆ - å¿«é€Ÿç»˜åˆ¶æ ‡å‡†æˆ·å‹</h3>
<p><strong>ä¼ ç»Ÿæ–¹å¼</strong>ï¼š</p>
<blockquote>
<p>1.Â æ‰“å¼€CADè½¯ä»¶</p>
<p>2.Â é€‰æ‹©ç”»çº¿å·¥å…·</p>
<p>3.Â è¾“å…¥èµ·ç‚¹åæ ‡(0,0)</p>
<p>4.Â è¾“å…¥ç»ˆç‚¹åæ ‡(10000,0) Â // 10ç±³å¢™</p>
<p>5.Â é‡å¤æ­¥éª¤3-4ï¼Œç”»4é¢å¢™</p>
<p>6.Â é€‰æ‹©åç§»å·¥å…·ï¼Œåç§»240mmç”Ÿæˆå†…å¢™çº¿</p>
<p>7.Â é€‰æ‹©ä¿®å‰ªå·¥å…·ï¼Œä¿®å‰ªå¢™è§’</p>
<p>8.Â æ’å…¥é—¨ã€çª—å›¾å—</p>
<p>9.Â æ·»åŠ å°ºå¯¸æ ‡æ³¨</p>
<p>10.Â æ•´ä¸ªè¿‡ç¨‹çº¦15-30åˆ†é’Ÿ
Â </p>
</blockquote>
<p><strong>AIæ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">è¾“å…¥ï¼šç”»ä¸€ä¸ª10mÃ—8mçš„æˆ¿é—´ï¼Œå¢™åš240mmï¼Œé—¨å®½900mmåœ¨å³ä¾§å¢™ä¸­å¤®ï¼Œçª—å®½1500mmåœ¨å·¦ä¾§å¢™ä¸­å¤®
AIå“åº”ï¼šâœ… å·²ç”Ÿæˆæ ‡å‡†æˆ¿é—´å¹³é¢å›¾
<span class="hljs-deletion">- å¤–å¢™ï¼š10mÃ—8mï¼Œå¢™åš240mm</span>
<span class="hljs-deletion">- é—¨ï¼š900mmå®½ï¼Œä½äºå³ä¾§å¢™ä¸­å¤®</span>
<span class="hljs-deletion">- çª—ï¼š1500mmå®½ï¼Œä½äºå·¦ä¾§å¢™ä¸­å¤®</span>
<span class="hljs-deletion">- å·²æ·»åŠ å°ºå¯¸æ ‡æ³¨</span>
ç”¨æ—¶ï¼š10ç§’
</code></pre>
<h3 data-id="heading-14">åœºæ™¯äºŒï¼šæœºæ¢°è®¾è®¡å¸ˆ - å‚æ•°åŒ–é›¶ä»¶è®¾è®¡</h3>
<p><strong>ä¼ ç»Ÿæ–¹å¼</strong>ï¼š</p>
<blockquote>
<p>-Â æ‰‹åŠ¨è®¡ç®—æ‰€æœ‰å°ºå¯¸</p>
<p>-Â é€ä¸ªç»˜åˆ¶æ¯ä¸ªç‰¹å¾</p>
<p>-Â å®¹æ˜“å‡ºé”™ï¼Œä¿®æ”¹å›°éš¾</p>
</blockquote>
<p><strong>AIæ–¹å¼</strong>ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šç”Ÿæˆä¸€ä¸ªM10èºæ “ï¼Œé•¿åº¦50mmï¼Œå¤´éƒ¨å…­è§’å¯¹è¾¹16mm</p>
<p>AIå“åº”ï¼šâœ… å·²ç”ŸæˆM10èºæ “æ¨¡å‹</p>
<ul>
<li>èºçº¹å…¬ç§°ç›´å¾„ï¼š10mm</li>
<li>èºæ “é•¿åº¦ï¼š50mm</li>
<li>å…­è§’å¤´å¯¹è¾¹å®½åº¦ï¼š16mm</li>
<li>ç¬¦åˆGB/T 5782æ ‡å‡†
ç”¨æ—¶ï¼š5ç§’</li>
</ul>
</blockquote>
<h3 data-id="heading-15">åœºæ™¯ä¸‰ï¼šå›¾çº¸ä¿®æ”¹-æ™ºèƒ½æ‰¹é‡æ“ä½œ</h3>
<p><strong>ä¼ ç»Ÿæ–¹å¼</strong>ï¼š</p>
<blockquote>
<p>-Â æ‰‹åŠ¨æŸ¥æ‰¾éœ€è¦ä¿®æ”¹çš„å…ƒç´ </p>
<p>-Â é€ä¸ªä¿®æ”¹ï¼Œè€—æ—¶ä¸”å®¹æ˜“é—æ¼</p>
</blockquote>
<p><strong>AIæ–¹å¼</strong>ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šæŠŠæ‰€æœ‰æ ‡æ³¨æ–‡å­—çš„å­—ä½“æ”¹æˆä»¿å®‹ï¼Œå­—é«˜æ”¹ä¸º3.5mm</p>
<p>AIå“åº”ï¼šâœ… å·²ä¿®æ”¹23ä¸ªæ ‡æ³¨å¯¹è±¡</p>
<ul>
<li>å­—ä½“ï¼šä»¿å®‹</li>
<li>å­—é«˜ï¼š3.5mm</li>
<li>ä¿®æ”¹å¯¹è±¡ï¼š23ä¸ªå°ºå¯¸æ ‡æ³¨
ç”¨æ—¶ï¼š3ç§’
Â </li>
</ul>
</blockquote>
<h2 data-id="heading-16">æŠ€æœ¯æ¶æ„æ·±åº¦è§£æ</h2>
<h3 data-id="heading-17">ä»£ç æ‰§è¡Œæµç¨‹</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41cbe44fc65943898237b09b7af85e77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qKm5oOzQ0FE5o6n5Lu2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926418&amp;x-signature=RAyTLy1I6DLagP2%2F9x%2BF4jpLxiE%3D" alt="ä»£ç æ‰§è¡Œæµç¨‹.png" loading="lazy"/></p>
<h3 data-id="heading-18">æ ¸å¿ƒæ¨¡å—è¯´æ˜</h3>
<p><strong>1. agents/AgentStrategy.ts</strong></p>
<blockquote>
<p>-Â æ™ºèƒ½ä½“ç­–ç•¥æ¥å£å®šä¹‰</p>
<p>-Â æ™ºèƒ½ä½“å®ä¾‹ç®¡ç†</p>
<p>-Â æ™ºèƒ½ä½“é€‰æ‹©é€»è¾‘</p>
</blockquote>
<p><strong>2. agents/ModelingAgent.ts</strong></p>
<blockquote>
<p>-Â CADå»ºæ¨¡ä¸“ç”¨æ™ºèƒ½ä½“</p>
<p>-Â ä»£ç ç”Ÿæˆä¸ä¿®æ”¹</p>
<p>-Â é”™è¯¯è‡ªåŠ¨ä¿®å¤</p>
</blockquote>
<p><strong>3. agents/IntentRecognitionAgent.ts</strong></p>
<blockquote>
<p>-Â ç”¨æˆ·æ„å›¾è¯†åˆ«</p>
<p>-Â æ™ºèƒ½ä½“è·¯ç”±è°ƒåº¦</p>
<p>-Â å¯¹è¯çŠ¶æ€ç®¡ç†</p>
</blockquote>
<p><strong>4. core/LLMClient.ts</strong></p>
<blockquote>
<p>-Â å¤šAIæä¾›å•†æ”¯æŒ</p>
<p>-Â è¯·æ±‚ç®¡ç†ä¸å–æ¶ˆ</p>
<p>-Â é”™è¯¯å¤„ç†ä¸é‡è¯•</p>
</blockquote>
<p><strong>5. core/codeModificationUtils.ts</strong></p>
<blockquote>
<p>-Â ä»£ç æ™ºèƒ½ä¿®æ”¹</p>
<p>-Â JSONæŒ‡ä»¤è§£æ</p>
<p>-Â è¯­æ³•é”™è¯¯ä¿®å¤</p>
</blockquote>
<p><strong>6. sandbox.ts</strong></p>
<blockquote>
<p>-Â æ²™ç®±ç¯å¢ƒåˆå§‹åŒ–</p>
<p>-Â ä»£ç å®‰å…¨æ‰§è¡Œ</p>
<p>-Â é”™è¯¯ä¿¡æ¯æ•è·</p>
</blockquote>
<p><strong>7. services/openRouterAPI.ts</strong></p>
<blockquote>
<p>-Â AIæ¨¡å‹ç®¡ç†</p>
<p>-Â APIé…ç½®ç®¡ç†</p>
<p>-Â æ¨¡å‹ç¼“å­˜æœºåˆ¶
Â </p>
</blockquote>
<h2 data-id="heading-19">å¿«é€Ÿä½“éªŒAIæ™ºèƒ½ä½“æœåŠ¡</h2>
<p>é¦–å…ˆæ‰“å¼€<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo2.mxdraw3d.com%3A3000%2Fmxcad%2F" target="_blank" title="https://demo2.mxdraw3d.com:3000/mxcad/" ref="nofollow noopener noreferrer">demo2.mxdraw3d.com:3000/mxcad/</a>ï¼Œ å¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ef5feb6d37b4ff9a63150bcfef2a695~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qKm5oOzQ0FE5o6n5Lu2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926418&amp;x-signature=M6efcVkHZf19vZjSMf2x3p7zDpU%3D" alt="ç‚¹å‡»ä½¿ç”¨AIæœåŠ¡.png" loading="lazy"/>
æ‰“å¼€AIæœåŠ¡ä¼šå¼¹å‡ºä¸€ä¸ªèƒ¶å›Šè¾“å…¥æ¡†ã€‚æˆ‘ä»¬ç‚¹å‡»è®¾ç½®æŒ‰é’®ï¼Œå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a0429a973774615869385f1ada53264~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qKm5oOzQ0FE5o6n5Lu2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926418&amp;x-signature=hyFfr%2FD51rMwzJYwm0M959nCNYI%3D" alt="æ‰“å¼€è®¾ç½®æŒ‰é’®.png" loading="lazy"/>
æˆ‘ä»¬éœ€è¦çº¿é…ç½®AIçš„apiæ¥å£ã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©iflow AIæœåŠ¡ è¿™æ˜¯ç›®å‰å›½å†…å…è´¹çš„æœ€ä½³ä¾›åº”å•†ï¼Œå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe287791cc174012936bc073ae5a1941~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qKm5oOzQ0FE5o6n5Lu2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926418&amp;x-signature=KGY1ITWvqKUJyJe%2BLqWcS389OEQ%3D" alt="è®¾ç½®apiKeyçš„å¼¹æ¡†.png" loading="lazy"/></p>
<p><strong>å…·æœ‰é…ç½®å¦‚ä¸‹ï¼š</strong></p>
<p>é¦–å…ˆæˆ‘ä»¬æ‰“å¼€<a href="https://link.juejin.cn?target=https%3A%2F%2Fiflow.cn" target="_blank" title="https://iflow.cn" ref="nofollow noopener noreferrer">iflow.cn</a> ç™»å½•è´¦å·ï¼Œç„¶åæˆ‘ä»¬é¼ æ ‡ç§»å…¥å¤´åƒï¼Œæ‰¾åˆ°apiç®¡ç†ï¼Œå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8edd3d8462542d4bc1e4018e9886f49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qKm5oOzQ0FE5o6n5Lu2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926418&amp;x-signature=Ik3wY%2BuLrNjznBrX%2BiUm7FB7S98%3D" alt="iflowæ‰¾åˆ°apiç®¡ç†è®¾ç½®.png" loading="lazy"/></p>
<p>æˆ‘ä»¬æŠŠapi keyå¡«å†™åˆ°MxCAD AIæœåŠ¡ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74b8a87c5e6649d9a93bff4fe9a92cc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qKm5oOzQ0FE5o6n5Lu2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926418&amp;x-signature=f9idadyKeXcbKh1Wsud6v32IGsE%3D" alt="iflowå¤åˆ¶apikey.png" loading="lazy"/></p>
<p><strong>é€‰æ‹©æ¨¡å‹å•†: iFlow</strong></p>
<p>å¡«å†™API Key: åˆšåˆšå¤åˆ¶çš„keyç²˜è´´åœ¨è¿™é‡Œï¼Œ
æ¨¡å‹é€‰æ‹©: æ”¯æŒå¾ˆå¤šæ¨¡å‹ï¼Œéƒ½å¯ä»¥ï¼Œç”šè‡³ç¨å¾®å·®ä¸€äº›çš„æ¨¡å‹éƒ½å¯ä»¥ï¼ŒiFlowç›®å‰æ‰€æœ‰çš„æ¨¡å‹éƒ½æ˜¯å…è´¹ä½¿ç”¨ã€‚</p>
<p>ç„¶åæˆ‘ä»¬ç‚¹å‡»â€œä¿å­˜â€æŒ‰é’®ã€‚å°±å¯ä»¥å¼€å§‹åœ¨èƒ¶å›Šè¾“å…¥æ¡†å†…è¾“å…¥ä½ çš„éœ€æ±‚äº†ï¼Œæ¯”å¦‚ï¼šä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡çš„éœ€æ±‚, "ç”»ä¸€æœµèŠ±" ç„¶åæŒ‰ä¸‹å›è½¦é”®ï¼Œå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd9fb2b37da44c469aca25aa8f6a657b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qKm5oOzQ0FE5o6n5Lu2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926418&amp;x-signature=OU4Bv2v4x1WkQcPDAjjsoKs7kS4%3D" alt="éœ€æ±‚ï¼šèŠ±ä¸€æœµèŠ±.png" loading="lazy"/>
ç­‰å¾…ä¸€ä¼šå„¿, å°±æŠŠä»£ç ç”Ÿæˆå‡ºæ¥ç»™ä½ çœ‹ï¼Œå¹¶ä¸”è¿˜æœ‰é¢„è§ˆæ•ˆæœï¼Œå¦‚æœæ»¡æ„çš„è¯ç‚¹å‡»ç¡®è®¤å°±å¯ä»¥æŠŠè¿™æœµèŠ±æ’å…¥åˆ°å›¾å…ƒä¸­äº†ã€‚å¦‚æœä¸æ»¡æ„ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ä¸AIå¯¹è¯è¿›è¡Œä¿®æ”¹ï¼Œå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/371db4a03015442186d20e9e77c1c338~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qKm5oOzQ0FE5o6n5Lu2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926418&amp;x-signature=YpoiEi5QZJD4ca%2Bv%2BH2hBrg1leo%3D" alt="éœ€æ±‚ï¼šèŠ±ä¸€æœµèŠ±çš„æ•ˆæœ.png" loading="lazy"/>
æ¯”å¦‚ç°åœ¨æˆ‘ä»¬è§‰å¾—è¿™ä¸ªèŠ±ä¸å¤Ÿç²¾è‡´ã€‚æˆ‘ä»¬å’ŒAIè¯´, â€œèŠ±ä¸å¤Ÿç²¾è‡´â€ã€‚ç„¶åæŒ‰ä¸‹å›è½¦é”®ï¼Œå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9f35cdd239049e98d3ce8c27cb77657~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qKm5oOzQ0FE5o6n5Lu2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926418&amp;x-signature=uw2oiscJXZlhWQ9%2Bn3ajpEvuFrM%3D" alt="éœ€æ±‚ï¼šèŠ±ä¸å¤Ÿç²¾è‡´.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6701fcb729c6496b9e557f4a49b406d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qKm5oOzQ0FE5o6n5Lu2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926418&amp;x-signature=L1IhFmJyA2TvAVBwCpu05TJfY%2Fk%3D" alt="éœ€æ±‚ï¼šèŠ±ä¸å¤Ÿç²¾è‡´çš„æ•ˆæœ.png" loading="lazy"/>
æˆ‘ä»¬å¯ä»¥ä¸æ–­çš„è®©AIä¿®æ”¹ä»£ç ï¼Œä»è€Œè¾¾åˆ°ä¸€ä¸ªæ»¡æ„çš„æ•ˆæœã€‚ä½†è¦çœŸæ­£æŠ•å…¥ä½¿ç”¨ï¼Œè¿˜éœ€è¦ç»“åˆå…·ä½“çš„éœ€æ±‚è°ƒæ•´æç¤ºè¯å’Œæ•´ä¸ªæ™ºèƒ½ä½“çš„æµç¨‹ï¼Œä»¥ä¸Šæ¼”ç¤ºçš„æ˜¯å»ºæ¨¡æ™ºèƒ½ä½“çš„èƒ½åŠ›ã€‚è€Œé€šç”¨æ™ºèƒ½ä½“çš„èƒ½åŠ›ï¼Œç›®å‰ä¸»è¦æ˜¯ç”¨äºæ“ä½œä¸€äº›å®ä½“ã€‚</p>
<p>æ¯”å¦‚ï¼š"é€‰ä¸­å®ä½“æŒ‰ç…§åŸæœ¬æ¯”ä¾‹æ”¾å¤§10å€ï¼Œé—´è·è¿˜æ˜¯åŸæœ¬çš„é—´è·"
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0faa1a4e01004f48a0eeca44798481f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qKm5oOzQ0FE5o6n5Lu2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926418&amp;x-signature=AqxUcBBDtNBwzmL%2BulxzPdRCF%2F8%3D" alt="image.png" loading="lazy"/>
æˆ‘ä»¬ç‚¹å‡»ç”Ÿæˆçš„ä»£ç ç‚¹å‡»è¿è¡Œï¼Œæ•ˆæœå°±å‡ºæ¥äº†ï¼Œå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bdc3b354ded42c087e7c82787d38132~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qKm5oOzQ0FE5o6n5Lu2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926418&amp;x-signature=o42NfqD4tqd2sAbaK%2FNlGzdt99g%3D" alt="image-1.png" loading="lazy"/>
è¿˜æœ‰å¾ˆå¤šæ“ä½œï¼Œåªè¦æ˜¯ä»£ç å¯ä»¥å®Œæˆçš„æ“ä½œï¼Œéƒ½å¯ä»¥é€šè¿‡AIé…åˆç½‘é¡µCADå®Œæˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gitï¼šå¦‚ä½•æ’æŸ¥éçº¿æ€§å†å²ä¸­è¢«éšç§˜è¦†ç›–çš„ä¿®æ”¹ï¼ˆå®Œæ•´å®æˆ˜ç¬”è®°ï¼‰]]></title>    <link>https://juejin.cn/post/7577574644695023652</link>    <guid>https://juejin.cn/post/7577574644695023652</guid>    <pubDate>2025-11-28T09:20:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577574644695023652" data-draft-id="7577563004482011190" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gitï¼šå¦‚ä½•æ’æŸ¥éçº¿æ€§å†å²ä¸­è¢«éšç§˜è¦†ç›–çš„ä¿®æ”¹ï¼ˆå®Œæ•´å®æˆ˜ç¬”è®°ï¼‰"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2025-11-28T09:20:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·4786129720692"/> <meta itemprop="url" content="https://juejin.cn/user/1480395756415229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gitï¼šå¦‚ä½•æ’æŸ¥éçº¿æ€§å†å²ä¸­è¢«éšç§˜è¦†ç›–çš„ä¿®æ”¹ï¼ˆå®Œæ•´å®æˆ˜ç¬”è®°ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1480395756415229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·4786129720692
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:20:54.000Z" title="Fri Nov 28 2025 09:20:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¤šäººåä½œå¼€å‘ä¸­ï¼Œå°¤å…¶æ˜¯ i18n æ–‡æ¡ˆæ–‡ä»¶ï¼ˆå¦‚ <code>assets/locales/ja_JP.json</code>ï¼‰ä½“é‡åºå¤§æ—¶ï¼Œ<strong>æŸä¸€æ®µ key è¢«çªç„¶â€œæ¶ˆå¤±â€</strong> ï¼Œå¾€å¾€ä¸æ˜¯æ•…æ„åˆ é™¤ï¼Œè€Œæ˜¯ï¼š</p>
<ul>
<li>åŒäº‹åŸºäºæ—§åˆ†æ”¯å¼€å‘</li>
<li>merge commit é‡‡å– <strong>ours/theirs</strong> ç­–ç•¥è‡ªåŠ¨è¦†ç›–</li>
<li>æˆ– merge çš„æŸä¸ª parent ç‰ˆæœ¬è¾ƒæ—§ï¼Œå¯¼è‡´æ–° key åœ¨å¦ä¸€ä¸ª parent ä¸­è¢«ä¸¢å¼ƒ</li>
<li>æ²¡æœ‰çº¿æ€§å†å²ï¼ŒGitLab UI çš„ diff ä¸ä¸€å®šèƒ½çœ‹åˆ°</li>
</ul>
<p>è¿™ä¸ªé—®é¢˜å¾ˆéšè”½ï¼Œä½†å¯ä»¥å®Œå…¨å®šä½ã€‚</p>
<p>æœ¬æ–‡æ€»ç»“æ’æŸ¥æµç¨‹ã€‚</p>
<h2 data-id="heading-0"><strong>ç¬¬ä¸€æ­¥ï¼šç¡®è®¤é—®é¢˜æ˜¯å¦è¢«è¦†ç›–ï¼ˆéæ•…æ„åˆ é™¤ï¼‰</strong></h2>
<p>æˆ‘ä»¬è¦çŸ¥é“ï¼š</p>
<blockquote>
<p>è¿™ä¸ª Key æ˜¯ â€œè¢«äººå†™ä»£ç åˆ æ‰â€ è¿˜æ˜¯ â€œmerge è‡ªåŠ¨è¦†ç›–æ‰â€ï¼Ÿ</p>
</blockquote>
<p>ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">log</span> -S <span class="hljs-string">"modbus_server"</span> -p -- assets/locales/ja_JP.json
</code></pre>
<p>å«ä¹‰ï¼š</p>
<ul>
<li>ç”¨ <code>S</code> æœç´¢æ–‡æœ¬å‡ºç°/æ¶ˆå¤±çš„ä½ç½®</li>
<li><code>p</code> å±•ç¤º diff</li>
</ul>
<p>ç»“æœæ˜¾ç¤ºï¼š</p>
<h4 data-id="heading-1">âœ”ï¸ Key çš„æ·»åŠ å‡ºç°åœ¨æœ€æ—©çš„ commit</h4>
<h4 data-id="heading-2">âŒ Key çš„åˆ é™¤å¹¶æœªä»¥æ˜æ˜¾ diff æ–¹å¼å‡ºç°</h4>
<p>â†’ è¯´æ˜ä¸æ˜¯ç¼–è¾‘åˆ é™¤ï¼Œè€Œæ˜¯ <strong>merge å¯¼è‡´è¦†ç›–</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-3">2ï¸âƒ£ <strong>ç¬¬äºŒæ­¥ï¼šé”å®š key ä»å­˜åœ¨æ—¶çš„æœ€åä¸€ä¸ª commit</strong></h2>
<p>é€šè¿‡å®šä½ï¼š</p>
<pre><code class="hljs">2b86a183de12891ae463bcb941defb8a338d2046
</code></pre>
<p>è¿™ä¸ªç‰ˆæœ¬ä¸­ key ä»ç„¶å­˜åœ¨ã€‚</p>
<hr/>
<h2 data-id="heading-4">3ï¸âƒ£ <strong>ç¬¬ä¸‰æ­¥ï¼šæŸ¥æ‰¾å®ƒçš„ç›´æ¥ children</strong></h2>
<p>å› ä¸º develop å†å²æ˜¯éçº¿æ€§çš„ï¼Œæ‰€ä»¥ä¸èƒ½åªçœ‹æ—¶é—´é¡ºåºã€‚</p>
<p>ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-css" lang="css">git rev-list <span class="hljs-attr">--children</span> develop | grep <span class="hljs-number">2</span>b86a183
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-erlang" lang="erlang"><span class="hljs-number">2</span>b86a183 ... ce3ba83f ... f8e8dc155ae6...
<span class="hljs-number">80e7</span>ca4386... <span class="hljs-number">2</span>b86a183...
</code></pre>
<p>å«ä¹‰ï¼š</p>
<ul>
<li>
<p>commit <code>2b86a183</code> æœ‰ <strong>ä¸¤ä¸ª child</strong>ï¼š</p>
<ul>
<li><code>ce3ba83f</code></li>
<li><code>f8e8dc155ae6</code></li>
</ul>
</li>
</ul>
<p>â†’ <strong>åªè¦æ‰¾åˆ°å“ªä¸ª child åˆ é™¤äº† keyï¼Œå°±èƒ½å®šä½å…ƒå‡¶</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-5">4ï¸âƒ£ <strong>ç¬¬å››æ­¥ï¼šå¯¹æ¯”ä¸¤ä¸ª child ä¸ parent</strong></h2>
<h4 data-id="heading-6">A. å¯¹æ¯”ç¬¬ä¸€ä¸ª childï¼š</h4>
<pre><code class="hljs language-bash" lang="bash">git diff 2b86a183..ce3ba83f -- assets/locales/ja_JP.json
</code></pre>
<p>è¾“å‡ºæ˜ç¡®æ˜¾ç¤ºï¼š</p>
<p>âœ”ï¸ <code>modbus_server</code> æ•´æ®µå†…å®¹è¢« <em>åˆ æ‰äº†</em></p>
<p>â†’ <strong>å…³é”®ï¼šè¿™å°±æ˜¯åˆ é™¤ key çš„ç¡®åˆ‡ commitï¼</strong></p>
<h4 data-id="heading-7">B. å¯¹æ¯”ç¬¬äºŒä¸ª childï¼š</h4>
<pre><code class="hljs">git diff 2b86a183..f8e8dc155ae6
</code></pre>
<p>æ²¡æœ‰æ¶‰åŠè¯¥ key</p>
<p>â†’ ä¸æ˜¯å®ƒçš„é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-8">5ï¸âƒ£ <strong>ç¬¬äº”æ­¥ï¼šåœ¨ GitLab è¿œç«¯æŸ¥çœ‹ï¼ˆUIï¼‰</strong></h2>
<p>GitLab Compare é¡µé¢å¿…é¡»ä½¿ç”¨æ ¼å¼ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">&lt;http:<span class="hljs-regexp">//xxxx</span><span class="hljs-regexp">/-/</span>compare/&gt;&lt;base&gt;...&lt;target&gt;
</code></pre>
<p>ä¸‰ä¸ªç‚¹ï¼š</p>
<pre><code class="hljs">2b86a183...ce3ba83f
</code></pre>
<p>å¦‚æœä½¿ç”¨ä¸¤ä¸ªç‚¹æˆ–åå‘ï¼Œä¼šå¤±è´¥ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">&lt;http://code-oss.sigenpower.com:8090/sigen_app/sigenmain/-/compare/2b86a183de12...ce3ba83f5dce&gt;
</code></pre>
<p>å³å¯åœ¨ UI ä¸­çœ‹åˆ°è¯¥ diffã€‚</p>
<hr/>
<h2 data-id="heading-9">6ï¸âƒ£ <strong>ä¸ºä»€ä¹ˆ GitLab çœ‹ä¸åˆ°åˆ é™¤ diffï¼Ÿ</strong></h2>
<p>å› ä¸ºï¼š</p>
<ul>
<li>æäº¤ <code>ce3ba83f</code> æ˜¯ä¸€ä¸ª merge commit</li>
<li>GitLab é»˜è®¤æ˜¾ç¤º merge commit çš„ diff æ˜¯<strong>å¯¹æ‰€æœ‰ parent çš„ combined diff</strong></li>
<li>è‹¥åŒ…å«æ–‡ä»¶å®Œå…¨è¦†ç›–ï¼ŒGitLab UI ä¼šâ€œéšè—â€è¿™ç±»å¤§å—å˜æ›´</li>
<li>JSON å·¨æ–‡ä»¶ä¼šè§¦å‘ GitLab çš„ â€œcut diffâ€ è¡Œä¸ºï¼Œä¸å±•ç¤ºå…¨éƒ¨å†…å®¹</li>
</ul>
<p>æ‰€ä»¥ï¼š</p>
<blockquote>
<p>æœ¬åœ° diff èƒ½çœ‹åˆ°åˆ æ‰æ•´æ®µ</p>
<p>GitLab UI ä¸ä¸€å®šå±•ç¤º</p>
</blockquote>
<p>å¾ˆå¸¸è§ã€‚</p>
<hr/>
<h2 data-id="heading-10">7ï¸âƒ£ <strong>æœ€ç»ˆç¡®è®¤ï¼šè¿™ä¸ª commit ç¡®å®å°±æ˜¯åˆ é™¤çš„æ¥æºå—ï¼Ÿ</strong></h2>
<p>âœ”ï¸ æ˜¯çš„ã€‚</p>
<p>åˆ¤æ–­ä¾æ®ï¼š</p>
<ol>
<li><code>git diff parent..child</code> ç›´æ¥æ˜¾ç¤ºåˆ é™¤ â†’ <strong>100% æ˜ç¡®</strong></li>
<li>å¦ä¸€ä¸ª child æ²¡åˆ é™¤</li>
<li><code>git log -S</code> æ²¡æ‰¾åˆ°æ˜¾å¼åˆ é™¤çš„è®°å½• â†’ merge è¦†ç›–å¯¼è‡´</li>
<li>Git DAG å¯è¯æ˜å”¯ä¸€è·¯å¾„åŒ…å«è¿™ä¸ª child</li>
</ol>
<p>ç»“è®ºï¼š</p>
<blockquote>
<p>åˆ é™¤æºå¤´ commit æ˜ç¡®ä¸ºï¼š</p>
<p><strong>ce3ba83f5dce2bcda26d1d2081d9259c904aa8e7</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-11">8ï¸âƒ£ <strong>æ€»ç»“ï¼šå¦‚ä½•åœ¨éçº¿æ€§å†å²ä¸­å®šä½â€œè¢«è¦†ç›–çš„æ”¹åŠ¨â€</strong></h2>
<p>æµç¨‹ç®€åŒ–ç‰ˆï¼š</p>
<ol>
<li>
<p>æŸ¥æ‰¾ key æœ€åå‡ºç°çš„ commit</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">log</span> -S <span class="hljs-string">"xxx-key"</span>
</code></pre>
</li>
<li>
<p>æ‰¾å®ƒçš„ children</p>
<pre><code class="hljs language-css" lang="css">git rev-list <span class="hljs-attr">--children</span> develop | grep &lt;commit&gt;
</code></pre>
</li>
<li>
<p>å¯¹æ¯” parent ä¸ children</p>
<pre><code class="hljs language-xml" lang="xml">git diff <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>..<span class="hljs-tag">&lt;<span class="hljs-name">child</span>&gt;</span>
</code></pre>
</li>
<li>
<p>å“ªä¸ª child åˆ é™¤äº† key â†’ é—®é¢˜æäº¤</p>
</li>
<li>
<p>GitLab Compare ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">... </span>  (ä¸‰ä¸ªç‚¹)
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å°è£…ä¸€ä¸ªæ”¯æŒåŠ¨æ€è¡¨å¤´ä¸æƒé™æ§åˆ¶çš„é€šç”¨ VxeTable ç»„ä»¶]]></title>    <link>https://juejin.cn/post/7577583653728616486</link>    <guid>https://juejin.cn/post/7577583653728616486</guid>    <pubDate>2025-11-28T09:28:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577583653728616486" data-draft-id="7577599299598549043" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å°è£…ä¸€ä¸ªæ”¯æŒåŠ¨æ€è¡¨å¤´ä¸æƒé™æ§åˆ¶çš„é€šç”¨ VxeTable ç»„ä»¶"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-28T09:28:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GYY_y"/> <meta itemprop="url" content="https://juejin.cn/user/343465213307293"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å°è£…ä¸€ä¸ªæ”¯æŒåŠ¨æ€è¡¨å¤´ä¸æƒé™æ§åˆ¶çš„é€šç”¨ VxeTable ç»„ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/343465213307293/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GYY_y
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:28:10.000Z" title="Fri Nov 28 2025 09:28:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>é¡¹ç›®èƒŒæ™¯
åŸºç¡€éœ€æ±‚ï¼š æˆ‘è¿™è¾¹çš„éœ€æ±‚æ˜¯è¦æŠŠè¡¨æ ¼çš„è¡¨å¤´è®¾ç½®ä¸ºåŠ¨æ€çš„æƒ…å†µã€å¹¶ä¸”å…è®¸é»˜å†™åˆ—è¿›è¡Œæ˜¾ç¤ºéšè—ã€å†»ç»“ã€æ’åºã€é»˜è®¤æŸå‡ é¡¹è¿›è¡Œç¦æ­¢å–æ¶ˆå‹¾é€‰ã€‚
åœ¨è¿™ä¸ªåŸºç¡€éœ€æ±‚ä¸Šéœ€è¦å…¼å®¹æŒ‰é’®æƒé™ã€ä»¥åŠæ¯ä¸€ä¸ªå•å…ƒæ ¼å†…çš„ç‚¹å‡»äº‹ä»¶å’Œtoolbarçš„æŒ‰é’®åŠ¨æ€ç¦æ­¢åŠŸèƒ½</p>
<p>åŠ¨æ€è¡¨å¤´é…ç½®</p>
</blockquote>
<blockquote>
<p>ä¸åŒè§’è‰²ã€ä¸åŒåœºæ™¯ä¸‹ï¼Œç”¨æˆ·å¯¹å­—æ®µçš„å…³æ³¨ç‚¹ä¸åŒï¼Œéœ€æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´è¡¨å¤´ç»“æ„ï¼ŒåŒ…æ‹¬åˆ—çš„æ˜¾ç¤º/éšè—ã€é¡ºåºè°ƒæ•´ã€å®½åº¦è®°å¿†ç­‰ã€‚
ç²¾ç»†åŒ–åˆ—æ§åˆ¶
å…è®¸éƒ¨åˆ†ä¸šåŠ¡åˆ—ï¼ˆå¦‚â€œå¤‡æ³¨â€â€œæ ‡ç­¾â€ï¼‰è¢«ç”¨æˆ·è‡ªç”±éšè—ï¼›
å…³é”®åˆ—ï¼ˆå¦‚é¦–åˆ—ã€æ“ä½œåˆ—ã€å¤é€‰æ¡†ã€åºå·ï¼‰å¿…é¡»å§‹ç»ˆå¯è§ï¼Œç¦æ­¢åœ¨åˆ—è®¾ç½®ä¸­å–æ¶ˆå‹¾é€‰ï¼›
æ”¯æŒåˆ—å†»ç»“ï¼ˆå›ºå®šå·¦/å³ï¼‰ã€æ’åºã€å®½åº¦æ‹–æ‹½ç­‰äº¤äº’èƒ½åŠ›ã€‚
æ·±åº¦äº¤äº’ä¸æƒé™é›†æˆ
æ¯ä¸ªå•å…ƒæ ¼éœ€æ”¯æŒç‹¬ç«‹ç‚¹å‡»äº‹ä»¶ï¼ˆå¦‚è·³è½¬è¯¦æƒ…ã€ç¼–è¾‘å†…è”ï¼‰ï¼›
è¡¨æ ¼å·¥å…·æ ï¼ˆToolbarï¼‰æŒ‰é’®éœ€æŒ‰ç”¨æˆ·æƒé™åŠ¨æ€æ¸²æŸ“ï¼ˆå…¼å®¹ v-permission ç­‰æŒ‡ä»¤ï¼‰ï¼›
æ“ä½œåˆ—ä¸­çš„æŒ‰é’®åŒæ ·éœ€æ”¯æŒæƒé™æ§åˆ¶ä¸è‡ªå®šä¹‰æ’æ§½ã€‚
é…ç½®æŒä¹…åŒ–</p>
</blockquote>
<p>ç”¨æˆ·å¯¹è¡¨å¤´çš„ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå¦‚éšè—äº†å“ªäº›åˆ—ã€è°ƒæ•´äº†å“ªäº›é¡ºåºï¼‰åº”è‡ªåŠ¨ä¿å­˜è‡³æœåŠ¡ç«¯ï¼Œå¹¶åœ¨ä¸‹æ¬¡è®¿é—®æ—¶è¿˜åŸï¼Œæå‡ä½¿ç”¨ä½“éªŒã€‚</p>
<h3 data-id="heading-0">æ•ˆæœå›¾</h3>
<h4 data-id="heading-1">å›¾ç‰‡</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c8f2522b7df49f08e18504da30b0b1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR1lZX3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926890&amp;x-signature=eipsJPaQLsKTXg6OgNtQKvzsViQ%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87a852f2681f4c2b9666060909480928~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR1lZX3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764926890&amp;x-signature=Kc%2F1rCeCtllf%2F4ApNhuzJRV8dVI%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-2">è§†é¢‘æ•ˆæœ</h4>
<p><a href="https://link.juejin.cn?target=%25E8%25A7%2586%25E9%25A2%2591%25E6%2595%2588%25E6%259E%259C" target="_blank" title="%E8%A7%86%E9%A2%91%E6%95%88%E6%9E%9C" ref="nofollow noopener noreferrer"/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Flive.csdn.net%2Fv%2F503221" target="_blank" title="https://live.csdn.net/v/503221" ref="nofollow noopener noreferrer">live.csdn.net/v/503221</a></p>
<h3 data-id="heading-3">ç‰ˆæœ¬å·</h3>
<pre><code class="hljs language-javascript" lang="javascript">åœ¨è¿™é‡Œæ’å…¥ä»£ç ç‰‡
  <span class="hljs-string">"vxe-pc-ui"</span>: <span class="hljs-string">"^4.10.30"</span>,
   <span class="hljs-string">"vxe-table"</span>: <span class="hljs-string">"^4.17.20"</span>,
   <span class="hljs-string">"xe-utils"</span>: <span class="hljs-string">"^3.7.9"</span>,
   <span class="hljs-string">"vue"</span>: <span class="hljs-string">"^3.5.18"</span>
</code></pre>
<h3 data-id="heading-4">Props è¯´æ˜</h3>













































































<table><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>border</code></td><td>Boolean</td><td><code>true</code></td><td>æ˜¯å¦æ˜¾ç¤ºè¡¨æ ¼è¾¹æ¡†</td></tr><tr><td><code>stripe</code></td><td>Boolean</td><td><code>true</code></td><td>æ˜¯å¦æ˜¾ç¤ºæ–‘é©¬çº¹</td></tr><tr><td><code>cloumnDrag</code></td><td>Boolean</td><td><code>false</code></td><td>æ˜¯å¦å…è®¸æ‹–æ‹½è°ƒæ•´åˆ—é¡ºåº</td></tr><tr><td><code>toolDrag</code></td><td>Boolean</td><td><code>true</code></td><td>æ˜¯å¦æ˜¾ç¤ºå³ä¸Šè§’â€œåˆ—è®¾ç½®â€æŒ‰é’®ï¼ˆé½¿è½®å›¾æ ‡ï¼‰</td></tr><tr><td><code>height</code></td><td>String / Number</td><td><code>'500px'</code></td><td>è¡¨æ ¼é«˜åº¦ï¼Œæ”¯æŒ <code>'400px'</code> æˆ– <code>'80%'</code></td></tr><tr><td><code>code</code></td><td>String</td><td><code>''</code></td><td><strong>å¿…å¡«</strong>ï¼å½“å‰é¡µé¢å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºä¿å­˜/æ¢å¤åˆ—é…ç½®</td></tr><tr><td><code>showCheckbox</code></td><td>Boolean</td><td><code>true</code></td><td>æ˜¯å¦æ˜¾ç¤ºå¤é€‰æ¡†åˆ—</td></tr><tr><td><code>showIndex</code></td><td>Boolean</td><td><code>false</code></td><td>æ˜¯å¦æ˜¾ç¤ºåºå·åˆ—</td></tr><tr><td><code>showAction</code></td><td>Boolean</td><td><code>false</code></td><td>æ˜¯å¦æ˜¾ç¤ºæ“ä½œåˆ—</td></tr><tr><td><code>actionWidth</code></td><td>Number</td><td><code>100</code></td><td>æ“ä½œåˆ—å®½åº¦ï¼ˆå•ä½ï¼špxï¼‰</td></tr><tr><td><code>slotsFields</code></td><td>Array&lt;String&gt;</td><td><code>[]</code></td><td>éœ€è¦ç”¨æ’æ§½æ¸²æŸ“çš„å­—æ®µåï¼Œå¦‚ <code>['status', 'name']</code></td></tr></tbody></table>
<h3 data-id="heading-5">åŒå‘æ•°æ®ç»‘å®š</h3>





























<table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>data</td><td>Array</td><td>[]</td><td>è¡¨æ ¼ä¸»ä½“æ•°æ®ï¼Œæ¯ä¸€é¡¹ä¸ºä¸€è¡Œè®°å½•</td></tr><tr><td>buttons</td><td>Array</td><td>[]</td><td>å·¦ä¾§å·¥å…·æ æŒ‰é’®é…ç½®ï¼Œæ ¼å¼å¦‚ï¼š{ code: 'add', name: 'æ–°å¢' }</td></tr><tr><td>column</td><td>Array</td><td>[]</td><td>è¡¨å¤´åˆ—é…ç½®ï¼Œæ¯åˆ—éœ€åŒ…å« fieldï¼ˆå­—æ®µåï¼‰ã€titleï¼ˆæ ‡é¢˜ï¼‰ã€visibleï¼ˆæ˜¯å¦æ˜¾ç¤ºï¼‰ç­‰å±æ€§</td></tr></tbody></table>
<h3 data-id="heading-6">æ’æ§½</h3>
<pre><code class="hljs language-js" lang="js">&lt;!-- æ¸²æŸ“ status å­—æ®µ --&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">status</span>=<span class="hljs-string">"{ row, column, $rowIndex }"</span>&gt;</span>  
 <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ row.statusText }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>  
</code></pre>
<h3 data-id="heading-7">eventæ–¹æ³•</h3>



































<table><thead><tr><th>äº‹ä»¶å</th><th>å›è°ƒå‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>cellClick</td><td>(row, column, value, title)</td><td>ç‚¹å‡»å•å…ƒæ ¼æ—¶è§¦å‘</td></tr><tr><td>checkAll</td><td>(selectedRows: Array)</td><td>å…¨é€‰/å–æ¶ˆå…¨é€‰æ—¶è§¦å‘</td></tr><tr><td>check</td><td>(selectedRows: Array)</td><td>å•è¡Œå‹¾é€‰çŠ¶æ€å˜åŒ–æ—¶è§¦å‘</td></tr><tr><td>saveSuccess</td><td>â€”</td><td>ç”¨æˆ·ç‚¹å‡»ã€ç¡®å®šã€‘æˆ–ã€æ¢å¤é»˜è®¤ã€‘åè§¦å‘ï¼ˆç”¨äºé‡æ–°åŠ è½½è¡¨æ ¼ï¼‰</td></tr><tr><td>leftBar</td><td>(button: Object)</td><td>ç‚¹å‡»å·¦ä¾§å·¥å…·æ æŒ‰é’®æ—¶è§¦å‘</td></tr></tbody></table>
<h3 data-id="heading-8">å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç»„ä»¶</span>
&lt;<span class="hljs-title class_">Table</span>  
		 ref=<span class="hljs-string">"tableRef"</span> 
		 v-<span class="hljs-attr">model</span>:column=<span class="hljs-string">"columns"</span> 
		 v-<span class="hljs-attr">model</span>:data=<span class="hljs-string">"tableData"</span> 
		 v-<span class="hljs-attr">model</span>:buttons=<span class="hljs-string">"buttons"</span> 
		 :code=<span class="hljs-string">"ViewName.CRM_MY_CUSTOMER_LIST"</span> 
		 :height=<span class="hljs-string">"tableHeight"</span> 
		 :show-action=<span class="hljs-string">"true"</span> 
		 :stripe=<span class="hljs-string">"false"</span> 
		 action-width=<span class="hljs-string">"200"</span> 
		 :slots-fields=<span class="hljs-string">"slotsFields"</span> 
		 @cell-click=<span class="hljs-string">"handleCellClick"</span> 
		 @check-all=<span class="hljs-string">"handleSelectChange"</span> 
		 @check=<span class="hljs-string">"handleSelectChange"</span> 
		 @save-success=<span class="hljs-string">"initList"</span> 
		 @left-bar=<span class="hljs-string">"handleLeftBar"</span>&gt;  
		 <span class="hljs-comment">// è¿™é‡Œçš„æ“ä½œæ æ˜¯action åç§°å¿…é¡»å›ºå®šä¸ºaction éœ€é…åˆshow-actionå±æ€§</span>
		 <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">action</span>=<span class="hljs-string">"{ row }"</span>&gt;</span> 
			 <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"shouldShowActions(row)"</span>&gt;</span> 
				 <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">v-permission</span>=<span class="hljs-string">"['customer:my:edit']"</span> <span class="hljs-attr">link</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleTableUpdate(row)"</span> &gt;</span>ç¼–è¾‘<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>  
			 <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> 
		 <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>  
		 <span class="hljs-comment">// è¿™æ¬¡æ’æ§½totalConsumeAmountå¿…é¡»è¦åœ¨slotsFieldså†…å¡«å†™ ä¸ç„¶ä¸å…è®¸ä½¿ç”¨</span>
		 <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">phoneNumber</span>=<span class="hljs-string">"{ row }"</span>&gt;</span> 
			 <span class="hljs-tag">&lt;<span class="hljs-name">IconifyIconOnline</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"row.phoneNumber"</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">"ep:copy-document"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"display: inline; cursor: pointer"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"copy(row.phoneNumber)"</span> /&gt;</span><span class="hljs-symbol">&amp;nbsp;</span> {{ row.phoneNumber }} 
			 <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>  
			 <span class="hljs-comment">// è¿™æ¬¡æ’æ§½totalConsumeAmountå¿…é¡»è¦åœ¨slotsFieldså†…å¡«å†™ ä¸ç„¶ä¸å…è®¸ä½¿ç”¨</span>
		 <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">followUpCount</span>=<span class="hljs-string">"{ row }"</span>&gt;</span> 
			 <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">link</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"previewTable(row)"</span> &gt;</span>ç‚¹å‡»æŸ¥çœ‹<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span> 
		 <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>  
		 <span class="hljs-comment">// è¿™æ¬¡æ’æ§½totalConsumeAmountå¿…é¡»è¦åœ¨slotsFieldså†…å¡«å†™ ä¸ç„¶ä¸å…è®¸ä½¿ç”¨</span>
		 <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">totalConsumeAmount</span>=<span class="hljs-string">"{ row }"</span>&gt;</span> 
			 <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom_high"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClickConsumptionUserInfo(row)"</span> &gt;</span>{{ row.totalConsumeAmount }&lt;/span &gt; 
		 <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
	 <span class="hljs-tag">&lt;/<span class="hljs-name">Table</span>&gt;</span></span>

	<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
		<span class="hljs-keyword">import</span> { computed, ref, onMounted, defineOptions, nextTick } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

		<span class="hljs-keyword">const</span> tableRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// è¡¨æ ¼ref</span>
		<span class="hljs-keyword">const</span> columns = <span class="hljs-title function_">ref</span>([]); <span class="hljs-comment">// åˆ—åç§°list</span>
		<span class="hljs-keyword">const</span> tableData = <span class="hljs-title function_">ref</span>([]); <span class="hljs-comment">// æ•°æ®list</span>

		<span class="hljs-comment">// è¡¨æ ¼é«˜åº¦</span>
		<span class="hljs-keyword">const</span> tableHeight = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
		  <span class="hljs-comment">// searchHeight ä¸ºformçš„é«˜åº¦</span>
		  <span class="hljs-keyword">const</span> searchHeight = searchBoxHeight.<span class="hljs-property">value</span> || <span class="hljs-number">0</span>;
		  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> - <span class="hljs-number">280</span> - searchHeight;
		});
		<span class="hljs-comment">// å•å…ƒæ ¼éœ€è¦ç”¨åˆ°çš„æ’æ§½ éœ€è¦åœ¨è¿™é‡Œå®šä¹‰æ‰èƒ½ä½¿ç”¨ é‡ç‚¹ï¼ï¼ï¼</span>
		<span class="hljs-keyword">const</span> slotsFields = <span class="hljs-title function_">ref</span>([
		  <span class="hljs-string">"customerName"</span>,
		  <span class="hljs-string">"sourceChannelName"</span>,
		  <span class="hljs-string">"phoneNumber"</span>,
		  <span class="hljs-string">"followStatus"</span>,
		  <span class="hljs-string">"totalConsumeAmount"</span>,
		  <span class="hljs-string">"totalRechargeAmount"</span>
		]);
		
		<span class="hljs-keyword">const</span> selectListIds = <span class="hljs-title function_">ref</span>([]); <span class="hljs-comment">// å‹¾é€‰å€¼idåˆ—è¡¨</span>
		<span class="hljs-comment">// å‹¾é€‰äº‹ä»¶</span>
		<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSelectChange</span> = val =&gt; {
		  selectListIds.<span class="hljs-property">value</span> = val.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span>);
		};
		<span class="hljs-comment">// toolbarä¸Šé¢çš„æŒ‰é’®</span>
		<span class="hljs-keyword">const</span> rawButtons = [
		  {
		    <span class="hljs-attr">code</span>: <span class="hljs-string">"addMember"</span>, <span class="hljs-comment">// å¿…ä¼ å€¼</span>
		    <span class="hljs-attr">name</span>: <span class="hljs-string">"æ·»åŠ å®¢æˆ·"</span>,  <span class="hljs-comment">//  å¿…ä¼ å€¼ æ–‡æœ¬(é¡µé¢å±•ç¤º)</span>
		    <span class="hljs-attr">icon</span>: <span class="hljs-string">"vxe-icon-add"</span>,  <span class="hljs-comment">// icon</span>
		    <span class="hljs-attr">status</span>: <span class="hljs-string">"primary"</span>, <span class="hljs-comment">// çŠ¶æ€</span>
		    <span class="hljs-attr">permissionCode</span>: <span class="hljs-string">"customer:my:add"</span> <span class="hljs-comment">// æ˜¯å¦æœ‰æŒ‰é’®æƒé™ã€‚å¦‚æœä¸ä¼ æˆ–è€…ä¸ºå€¼ä¸ºç©ºå­—ç¬¦ä¸² ä»£è¡¨æ‰€æœ‰äººå¯è§</span>
		  },
		  {
		    <span class="hljs-attr">code</span>: <span class="hljs-string">"batchImport"</span>,
		    <span class="hljs-attr">name</span>: <span class="hljs-string">"æ‰¹é‡å¯¼å…¥"</span>,
		    <span class="hljs-attr">status</span>: <span class="hljs-string">"default"</span>,
		    <span class="hljs-attr">permissionCode</span>: <span class="hljs-string">"customer:my:batchImport"</span>
		  },
		  {
		    <span class="hljs-attr">code</span>: <span class="hljs-string">"edit"</span>, <span class="hljs-comment">// å¿…ä¼ å€¼</span>
		    <span class="hljs-attr">name</span>: <span class="hljs-string">"ç¼–è¾‘"</span>, <span class="hljs-comment">//  å¿…ä¼ å€¼ æ–‡æœ¬(é¡µé¢å±•ç¤º)</span>
		    <span class="hljs-attr">status</span>: <span class="hljs-string">"default"</span>, <span class="hljs-comment">// çŠ¶æ€</span>
		    <span class="hljs-attr">dependsOnSelection</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ˜¯å¦è¢«å‹¾é€‰æ¡†æ§åˆ¶ å¦‚æœå€¼ä¸ºtrueä»£è¡¨è¢«checkboxå‹¾é€‰æœ‰å…³ ä¸ä¼ æˆ–è€…ä¸ºfalseåˆ™ä¸è¢«checkboxæ§åˆ¶</span>
		    <span class="hljs-attr">permissionCode</span>: <span class="hljs-string">"customer:my:edit"</span> <span class="hljs-comment">// æ˜¯å¦æœ‰æŒ‰é’®æƒé™ã€‚å¦‚æœä¸ä¼ æˆ–è€…ä¸ºå€¼ä¸ºç©ºå­—ç¬¦ä¸² ä»£è¡¨æ‰€æœ‰äººå¯è§</span>
		  }
		];
		
		<span class="hljs-comment">// usePermissionButtons å‡½æ•°ä¸ºæ§åˆ¶toolbaræŒ‰é’®æƒé™å¤„ç†</span>
		<span class="hljs-keyword">const</span> buttons = <span class="hljs-title function_">usePermissionButtons</span>(rawButtons, selectListIds);
		
		<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLeftBar</span> = val =&gt; {
		  <span class="hljs-keyword">switch</span> (val.<span class="hljs-property">code</span>) {
		    <span class="hljs-keyword">case</span> <span class="hljs-string">"addMember"</span>:
		      <span class="hljs-keyword">break</span>;
		    <span class="hljs-keyword">case</span> <span class="hljs-string">"batchImport"</span>:
		      <span class="hljs-keyword">break</span>;
		    <span class="hljs-attr">default</span>:
		      <span class="hljs-keyword">break</span>;
		  }
		};
		
		<span class="hljs-keyword">const</span> <span class="hljs-title function_">getHeader</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
		  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getTableHeader</span>(<span class="hljs-title class_">ViewName</span>.<span class="hljs-property">CRM_MY_CUSTOMER_LIST</span>);
		  columns.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> {
		    <span class="hljs-keyword">return</span> {
		      ...i,
		      <span class="hljs-attr">field</span>: i.<span class="hljs-property">key</span>, <span class="hljs-comment">// å¿…ä¼ </span>
		      <span class="hljs-attr">title</span>: i.<span class="hljs-property">label</span>, <span class="hljs-comment">// å¿…ä¼ </span>
		      <span class="hljs-attr">width</span>: i.<span class="hljs-property">width</span> ?? <span class="hljs-string">"100px"</span> <span class="hljs-comment">// å¿…ä¼ </span>
		    };
		  });
		};
		
		<span class="hljs-keyword">const</span> <span class="hljs-title function_">initList</span> = (<span class="hljs-params"/>) =&gt; {
		  <span class="hljs-title function_">getHeader</span>(); <span class="hljs-comment">// è·å–è¡¨å¤´æ•°æ®</span>
		  <span class="hljs-title function_">getList</span>(); <span class="hljs-comment">// è·å–åˆ—è¡¨æ•°æ®</span>
		};
	</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
	
</code></pre>
<h3 data-id="heading-9">usePermissionButtonsæ–‡ä»¶</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// usePermissionButtons.jsæ–‡ä»¶ä»£ç </span>

<span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/store/modules/user"</span>;

<span class="hljs-comment">// store</span>
<span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>();

<span class="hljs-comment">/**
 * æ ¹æ® rawButtons å’Œé€‰ä¸­çŠ¶æ€ï¼Œç”Ÿæˆå¸¦æƒé™æ§åˆ¶å’Œç¦ç”¨çŠ¶æ€çš„æŒ‰é’®åˆ—è¡¨
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} <span class="hljs-variable">rawButtons</span> - åŸå§‹æŒ‰é’®é…ç½®æ•°ç»„
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Ref&lt;number[]&gt; | Ref&lt;any[]&gt;</span>} <span class="hljs-variable">selectListIds</span> - é€‰ä¸­çš„ ID åˆ—è¡¨ï¼ˆrefï¼‰
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">ComputedRef&lt;Array&gt;</span>} è¿‡æ»¤å¹¶å¤„ç†åçš„æŒ‰é’®åˆ—è¡¨
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">usePermissionButtons</span>(<span class="hljs-params">rawButtons, selectListIds</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> isEmpty = selectListIds.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> permissionList = <span class="hljs-title function_">getPermissionCodeList</span>(); <span class="hljs-comment">// ç¡®ä¿è¿™æ˜¯å“åº”å¼çš„æˆ–æœ€æ–°å€¼</span>
    <span class="hljs-keyword">if</span> (permissionList[<span class="hljs-number">0</span>] === <span class="hljs-string">"*:*:*"</span>) {
      <span class="hljs-comment">// admin</span>
      <span class="hljs-keyword">return</span> rawButtons;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// éadmin</span>
      <span class="hljs-keyword">return</span> rawButtons
        .<span class="hljs-title function_">filter</span>(
          <span class="hljs-function"><span class="hljs-params">btn</span> =&gt;</span>
            !btn.<span class="hljs-property">permissionCode</span> || permissionList.<span class="hljs-title function_">includes</span>(btn.<span class="hljs-property">permissionCode</span>)
        )
        .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">btn</span> =&gt;</span> ({
          ...btn,
          <span class="hljs-attr">disabled</span>: btn.<span class="hljs-property">dependsOnSelection</span> ? isEmpty : (btn.<span class="hljs-property">disabled</span> ?? <span class="hljs-literal">false</span>)
        }));
    }
  });
}


<span class="hljs-comment">// è·å–ç™»å½•äººæ‰€æœ‰çš„æŒ‰é’®æƒé™</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getPermissionCodeList</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> userStore.<span class="hljs-property">permissions</span> || [];
};
</code></pre>
<h3 data-id="heading-10">Tableç»„ä»¶ä»£ç </h3>
<pre><code class="hljs language-javascript" lang="javascript">
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"demo-page-wrapper"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-grid</span>
      <span class="hljs-attr">ref</span>=<span class="hljs-string">"gridRef"</span>
      <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"gridOptions"</span>
      @<span class="hljs-attr">toolbar-button-click</span>=<span class="hljs-string">"handleLeftToolbar"</span>
      @<span class="hljs-attr">checkbox-all</span>=<span class="hljs-string">"selectAllChangeEvent"</span>
      @<span class="hljs-attr">checkbox-change</span>=<span class="hljs-string">"selectChangeEvent"</span>
      @<span class="hljs-attr">cell-click</span>=<span class="hljs-string">"handleCellClick"</span>
      @<span class="hljs-attr">custom</span>=<span class="hljs-string">"handleColumnCustom"</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(_, name) in $slots"</span> #[<span class="hljs-attr">name</span>]=<span class="hljs-string">"slotData"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">:name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"slotData"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">vxe-grid</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> {
  ref,
  defineProps,
  defineExpose,
  defineModel,
  defineEmits,
  computed
} <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">XEUtils</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"xe-utils"</span>;
<span class="hljs-keyword">import</span> { headCancel, headSave } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/api/view"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"element-plus"</span>;

<span class="hljs-keyword">const</span> emits = <span class="hljs-title function_">defineEmits</span>([
  <span class="hljs-string">"cellClick"</span>,
  <span class="hljs-string">"checkAll"</span>,
  <span class="hljs-string">"check"</span>,
  <span class="hljs-string">"saveSuccess"</span>,
  <span class="hljs-string">"leftBar"</span>
]);
<span class="hljs-comment">// å®šä¹‰ props</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-comment">// è¾¹æ¡†çº¿</span>
  <span class="hljs-attr">border</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-comment">// æ–‘é©¬çº¿</span>
  <span class="hljs-attr">stripe</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-comment">// åˆ—æ‹–æ‹½</span>
  <span class="hljs-attr">cloumnDrag</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>
  },
  <span class="hljs-comment">// è‡ªå®šä¹‰æ‹–æ‹½icon</span>
  <span class="hljs-attr">toolDrag</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-comment">// è¡¨æ ¼é«˜åº¦</span>
  <span class="hljs-attr">height</span>: {
    <span class="hljs-attr">type</span>: [<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Number</span>],
    <span class="hljs-attr">default</span>: <span class="hljs-string">"500px"</span> <span class="hljs-comment">// ä¹Ÿæ”¯æŒ%</span>
  },
  <span class="hljs-comment">// æ¯ä¸ªæ•°æ®çš„å”¯ä¸€code</span>
  <span class="hljs-attr">code</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">default</span>: <span class="hljs-string">""</span> },
  <span class="hljs-comment">// æ˜¯å¦å±•ç¤ºå¤é€‰æ¡†</span>
  <span class="hljs-attr">showCheckbox</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>, <span class="hljs-attr">default</span>: <span class="hljs-literal">true</span> },
  <span class="hljs-comment">// æ˜¯å¦å±•ç¤ºç´¢å¼•å·</span>
  <span class="hljs-attr">showIndex</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>, <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span> },
  <span class="hljs-comment">// æ˜¯å¦å±•ç¤ºæ“ä½œåˆ—</span>
  <span class="hljs-attr">showAction</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>, <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span> },
  <span class="hljs-comment">// æ“ä½œåˆ—å®½åº¦</span>
  <span class="hljs-attr">actionWidth</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">default</span>: <span class="hljs-number">100</span> },
  <span class="hljs-comment">// éœ€è¦çš„æ’æ§½ ä¾‹å­: ["name", "id", ....]</span>
  <span class="hljs-attr">slotsFields</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">return</span> [];
    }
  }
});

<span class="hljs-comment">// è¡¨æ ¼æ•°æ®</span>
<span class="hljs-keyword">const</span> tableData = <span class="hljs-title function_">defineModel</span>(<span class="hljs-string">"data"</span>, {
  <span class="hljs-attr">default</span>: []
});

<span class="hljs-comment">// å·¦ä¾§æ“ä½œæ </span>
<span class="hljs-keyword">const</span> buttonsList = <span class="hljs-title function_">defineModel</span>(<span class="hljs-string">"buttons"</span>, {
  <span class="hljs-attr">default</span>: []
});

<span class="hljs-comment">// è¡¨å¤´æ•°æ®</span>
<span class="hljs-keyword">const</span> column = <span class="hljs-title function_">defineModel</span>(<span class="hljs-string">"column"</span>, {
  <span class="hljs-attr">default</span>: []
});

<span class="hljs-comment">// å°†è¿™äº›å€¼è¿›è¡Œç¦ç”¨</span>
<span class="hljs-keyword">const</span> disabledKeys = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> column.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>
    ? [<span class="hljs-string">"checkbox"</span>, <span class="hljs-string">"seq"</span>, <span class="hljs-string">"action"</span>, column.<span class="hljs-property">value</span>[<span class="hljs-number">0</span>].<span class="hljs-property">field</span>]
    : [<span class="hljs-string">"checkbox"</span>, <span class="hljs-string">"seq"</span>, <span class="hljs-string">"action"</span>];
});
<span class="hljs-comment">// å¤„ç†slotæ’æ§½</span>
<span class="hljs-keyword">const</span> processedColumns = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> column.<span class="hljs-property">value</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> {
    <span class="hljs-comment">// ç¡®ä¿æ˜¯æ™®é€šæ•°æ®åˆ—ä¸”æœ‰ field</span>
    <span class="hljs-keyword">if</span> (!col.<span class="hljs-property">type</span> &amp;&amp; col.<span class="hljs-property">field</span> != <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">if</span> (props.<span class="hljs-property">slotsFields</span>.<span class="hljs-title function_">includes</span>(col.<span class="hljs-property">field</span>)) {
        <span class="hljs-keyword">return</span> {
          ...col,
          <span class="hljs-attr">slots</span>: { <span class="hljs-attr">default</span>: col.<span class="hljs-property">field</span> }
        };
      }
    }
    <span class="hljs-keyword">return</span> col; <span class="hljs-comment">// åŸæ ·è¿”å›ï¼ˆåŒ…æ‹¬æ—  field çš„åˆ—ã€type åˆ—ç­‰ï¼‰</span>
  });
});

<span class="hljs-comment">// ä½¿ç”¨ computedï¼Œç¡®ä¿æ¯æ¬¡éƒ½æ˜¯æœ€æ–°å€¼</span>
<span class="hljs-keyword">const</span> gridOptions = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> cols = [];

  <span class="hljs-comment">// å¤é€‰æ¡†åˆ—</span>
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">showCheckbox</span>) {
    cols.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">type</span>: <span class="hljs-string">"checkbox"</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-number">40</span>,
      <span class="hljs-attr">fixed</span>: <span class="hljs-string">"left"</span>,
      <span class="hljs-attr">visible</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">field</span>: <span class="hljs-string">"checkbox"</span> <span class="hljs-comment">// è¯¥å€¼æ˜¯ä¸ºäº†ç¦ç”¨å¤åˆ¶çš„å”¯ä¸€å€¼</span>
    });
  }

  <span class="hljs-comment">// åºå·åˆ—</span>
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">showIndex</span>) {
    cols.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">type</span>: <span class="hljs-string">"seq"</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-number">50</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">"åºå·"</span>,
      <span class="hljs-attr">fixed</span>: <span class="hljs-string">"left"</span>,
      <span class="hljs-attr">visible</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">field</span>: <span class="hljs-string">"seq"</span> <span class="hljs-comment">// è¯¥å€¼æ˜¯ä¸ºäº†ç¦ç”¨å¤åˆ¶çš„å”¯ä¸€å€¼</span>
    });
  }

  <span class="hljs-comment">//  åªåŠ å¤„ç†åçš„ä¸šåŠ¡åˆ—ï¼ˆå·²è‡ªåŠ¨æ³¨å…¥ slotsï¼‰</span>
  cols.<span class="hljs-title function_">push</span>(...processedColumns.<span class="hljs-property">value</span>);

  <span class="hljs-comment">// æ“ä½œåˆ—</span>
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">showAction</span>) {
    cols.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">field</span>: <span class="hljs-string">"action"</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">"æ“ä½œ"</span>,
      <span class="hljs-attr">width</span>: props.<span class="hljs-property">actionWidth</span>,
      <span class="hljs-attr">fixed</span>: <span class="hljs-string">"right"</span>,
      <span class="hljs-attr">align</span>: <span class="hljs-string">"center"</span>,
      <span class="hljs-attr">visible</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">slots</span>: { <span class="hljs-attr">default</span>: <span class="hljs-string">"action"</span> }
    });
  }

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">border</span>: props.<span class="hljs-property">border</span>,
    <span class="hljs-attr">stripe</span>: props.<span class="hljs-property">stripe</span>,
    <span class="hljs-attr">showOverflow</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">height</span>: props.<span class="hljs-property">height</span>,
    <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">columnConfig</span>: { <span class="hljs-attr">drag</span>: props.<span class="hljs-property">cloumnDrag</span>, <span class="hljs-attr">resizable</span>: <span class="hljs-literal">true</span> },
    <span class="hljs-attr">rowConfig</span>: { <span class="hljs-attr">isCurrent</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">isHover</span>: <span class="hljs-literal">true</span> },
    <span class="hljs-attr">columnDragConfig</span>: { <span class="hljs-attr">trigger</span>: <span class="hljs-string">"cell"</span>, <span class="hljs-attr">showGuidesStatus</span>: <span class="hljs-literal">true</span> },
    <span class="hljs-attr">customConfig</span>: {
      <span class="hljs-comment">// è¯¥åˆ—æ˜¯å¦å…è®¸é€‰ä¸­</span>
      <span class="hljs-title function_">checkMethod</span>(<span class="hljs-params">{ column }</span>) {
        <span class="hljs-keyword">return</span> !disabledKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(column.<span class="hljs-property">field</span>);
      }
    },
    <span class="hljs-attr">toolbarConfig</span>: {
      <span class="hljs-attr">custom</span>: props.<span class="hljs-property">toolDrag</span>,
      <span class="hljs-attr">zoom</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">buttons</span>: buttonsList.<span class="hljs-property">value</span>
    },
    <span class="hljs-attr">checkboxConfig</span>: { <span class="hljs-attr">range</span>: <span class="hljs-literal">true</span> },
    <span class="hljs-attr">columns</span>: cols,
    <span class="hljs-comment">// columns: cols.filter(i =&gt; i.field !== "checkbox" &amp;&amp; i.field !== "seq"),</span>
    <span class="hljs-attr">data</span>: tableData.<span class="hljs-property">value</span>
  };
});

<span class="hljs-keyword">const</span> gridRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// é€‰ä¸­çš„é¡¹</span>
<span class="hljs-keyword">const</span> selectedRows = <span class="hljs-title function_">ref</span>([]);

<span class="hljs-comment">// äº‹ä»¶å¤„ç†</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">selectAllChangeEvent</span> = (<span class="hljs-params">{ checked }</span>) =&gt; {
  selectedRows.<span class="hljs-property">value</span> = gridRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">getCheckboxRecords</span>() || [];
  <span class="hljs-title function_">emits</span>(<span class="hljs-string">"checkAll"</span>, selectedRows.<span class="hljs-property">value</span>);
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">selectChangeEvent</span> = (<span class="hljs-params">{ checked }</span>) =&gt; {
  selectedRows.<span class="hljs-property">value</span> = gridRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">getCheckboxRecords</span>() || [];
  <span class="hljs-title function_">emits</span>(<span class="hljs-string">"check"</span>, selectedRows.<span class="hljs-property">value</span>);
};

<span class="hljs-comment">// æ¸…ç©ºé€‰ä¸­çš„æ•°æ®</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">clearSelectEvent</span> = (<span class="hljs-params"/>) =&gt; {
  gridRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">clearCheckboxRow</span>();
};

<span class="hljs-comment">// è·å–é€‰ä¸­çš„æ•°æ®</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getSelectEvent</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> records = gridRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">getCheckboxRecords</span>() || [];
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å·²é€‰ä¸­ <span class="hljs-subst">${records.length}</span> æ¡æ•°æ®`</span>);
};

<span class="hljs-comment">// é€‰ä¸­æ‰€æœ‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">selectAllEvent</span> = (<span class="hljs-params"/>) =&gt; {
  gridRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">setAllCheckboxRow</span>(<span class="hljs-literal">true</span>);
};

<span class="hljs-comment">// è®¾ç½®è‡ªå®šä¹‰å‹¾é€‰æ•°æ®</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">setSelectRow</span> = (<span class="hljs-params">rows, checked = <span class="hljs-literal">true</span></span>) =&gt; {
  gridRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">setCheckboxRow</span>(rows, checked);
};

<span class="hljs-comment">// å•å…ƒæ ¼ç‚¹å‡»</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleCellClick</span> = (<span class="hljs-params">{
  row,
  rowIndex,
  $rowIndex,
  column,
  columnIndex,
  $columnIndex,
  triggerRadio,
  triggerCheckbox,
  triggerTreeNode,
  triggerExpandNode,
  $event
}</span>) =&gt; {
  <span class="hljs-title function_">emits</span>(<span class="hljs-string">"cellClick"</span>, row, column, row[column.<span class="hljs-property">property</span>], column.<span class="hljs-property">title</span>);
};

<span class="hljs-comment">// è‡ªå®šä¹‰ç­›é€‰iconå¼¹çª—äº‹ä»¶</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleColumnCustom</span> = params =&gt; {
  <span class="hljs-keyword">switch</span> (params.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"open"</span>:
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"confirm"</span>: {
      <span class="hljs-comment">// ç™½åå•åˆ—è¡¨ å°†æ“ä½œåˆ—å’Œå¤é€‰æ¡†ã€åºå·åˆ—è¿‡æ»¤</span>
      <span class="hljs-keyword">const</span> whiteList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-string">"action"</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">undefined</span>]);
      <span class="hljs-comment">// è·å–å‹¾é€‰çš„</span>
      <span class="hljs-comment">// const visibleColumn = gridRef.value?.getColumns() || [];</span>
      <span class="hljs-comment">// è·å–æ‰€æœ‰çš„ visibleæ¥åŒºåˆ†æ˜¯å¦å‹¾é€‰</span>
      <span class="hljs-keyword">const</span> visibleColumn = gridRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">getFullColumns</span>() || [];
      <span class="hljs-keyword">const</span> result = visibleColumn
        .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> {
          <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">key</span>: i.<span class="hljs-property">field</span>,
            <span class="hljs-attr">fixed</span>: i.<span class="hljs-property">fixed</span>,
            <span class="hljs-attr">visible</span>: i.<span class="hljs-property">visible</span>,
            <span class="hljs-attr">width</span>: i.<span class="hljs-property">width</span>,
            <span class="hljs-attr">title</span>: i.<span class="hljs-property">title</span>,
            <span class="hljs-attr">label</span>: i.<span class="hljs-property">label</span>,
            <span class="hljs-attr">field</span>: i.<span class="hljs-property">field</span>
          };
        })
        .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">k</span> =&gt;</span> !whiteList.<span class="hljs-title function_">has</span>(k.<span class="hljs-property">key</span>))
        .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.<span class="hljs-property">field</span> !== <span class="hljs-string">"checkbox"</span> &amp;&amp; i.<span class="hljs-property">field</span> !== <span class="hljs-string">"seq"</span>);

      <span class="hljs-title function_">headSave</span>(result, props.<span class="hljs-property">code</span>)
        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"ä¿å­˜æˆåŠŸ"</span>);
          <span class="hljs-title function_">emits</span>(<span class="hljs-string">"saveSuccess"</span>);
        })
        .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);
        });
      <span class="hljs-keyword">break</span>;
    }
    <span class="hljs-keyword">case</span> <span class="hljs-string">"reset"</span>: {
      <span class="hljs-comment">// æ¢å¤é»˜è®¤</span>
      <span class="hljs-title function_">headCancel</span>(props.<span class="hljs-property">code</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">emits</span>(<span class="hljs-string">"saveSuccess"</span>);
      });
      <span class="hljs-keyword">break</span>;
    }
    <span class="hljs-keyword">case</span> <span class="hljs-string">"close"</span>: {
      <span class="hljs-keyword">break</span>;
    }
  }
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLeftToolbar</span> = val =&gt; {
  <span class="hljs-keyword">const</span> { code, button, $event } = val;
  <span class="hljs-title function_">emits</span>(<span class="hljs-string">"leftBar"</span>, button);
};

<span class="hljs-comment">// æš´éœ²æ–¹æ³•</span>
<span class="hljs-title function_">defineExpose</span>({
  gridRef,
  clearSelectEvent,
  getSelectEvent,
  selectAllEvent,
  setSelectRow
});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.demo-page-wrapper</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue2 é€šç”¨æ–‡ä»¶åœ¨çº¿é¢„è§ˆä¸‹è½½ç»„ä»¶ï¼šä¸€ç«™å¼è§£å†³å¤šç±»å‹æ–‡ä»¶å¤„ç†éœ€æ±‚ï¼ˆæ”¯æŒè§†é¢‘ã€æ–‡æ¡£ã€å›¾ç‰‡ã€Officeï¼‰]]></title>    <link>https://juejin.cn/post/7577417823342641187</link>    <guid>https://juejin.cn/post/7577417823342641187</guid>    <pubDate>2025-11-28T09:34:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577417823342641187" data-draft-id="7577356848338403363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue2 é€šç”¨æ–‡ä»¶åœ¨çº¿é¢„è§ˆä¸‹è½½ç»„ä»¶ï¼šä¸€ç«™å¼è§£å†³å¤šç±»å‹æ–‡ä»¶å¤„ç†éœ€æ±‚ï¼ˆæ”¯æŒè§†é¢‘ã€æ–‡æ¡£ã€å›¾ç‰‡ã€Officeï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-28T09:34:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æŸåªå¤©è½"/> <meta itemprop="url" content="https://juejin.cn/user/370997139088592"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue2 é€šç”¨æ–‡ä»¶åœ¨çº¿é¢„è§ˆä¸‹è½½ç»„ä»¶ï¼šä¸€ç«™å¼è§£å†³å¤šç±»å‹æ–‡ä»¶å¤„ç†éœ€æ±‚ï¼ˆæ”¯æŒè§†é¢‘ã€æ–‡æ¡£ã€å›¾ç‰‡ã€Officeï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/370997139088592/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æŸåªå¤©è½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:34:52.000Z" title="Fri Nov 28 2025 09:34:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæ–‡ä»¶é¢„è§ˆä¸ä¸‹è½½æ˜¯é«˜é¢‘éœ€æ±‚ï¼Œä½†ä¸åŒæ–‡ä»¶ç±»å‹ï¼ˆè§†é¢‘ã€å›¾ç‰‡ã€æ–‡æ¡£ã€Officeï¼‰çš„é¢„è§ˆé€»è¾‘å·®å¼‚å¤§ï¼Œä¸”å­˜åœ¨ â€œé¢„è§ˆå¤±è´¥é™çº§â€â€œè·¨æµè§ˆå™¨å…¼å®¹â€ ç­‰ç—›ç‚¹ã€‚ä»Šå¤©åˆ†äº«ä¸€æ¬¾æˆ‘å°è£…çš„ Vue2 æ–‡ä»¶é¢„è§ˆä¸‹è½½ç»„ä»¶ï¼Œæ— éœ€é‡å¤å¼€å‘ï¼Œä¼ å…¥æ–‡ä»¶ URL å³å¯å®ç° â€œèƒ½é¢„è§ˆåˆ™é¢„è§ˆï¼Œä¸èƒ½é¢„è§ˆåˆ™ä¸‹è½½â€ çš„é—­ç¯ä½“éªŒï¼Œé€‚é… 90%+ ä¸šåŠ¡åœºæ™¯ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ç»„ä»¶æ ¸å¿ƒåŠŸèƒ½ä¸€è§ˆ</h2>
<p>ç»„ä»¶å›´ç»• â€œæ–‡ä»¶é¢„è§ˆ + ä¸‹è½½â€ æ ¸å¿ƒè¯‰æ±‚ï¼Œæ‹†è§£ä¸º<strong>çŠ¶æ€ç®¡ç†ã€åˆ†ç±»å‹é¢„è§ˆã€é”™è¯¯å¤„ç†ã€ä¸‹è½½èƒ½åŠ›</strong>å››å¤§æ¨¡å—ï¼Œé€»è¾‘é—­ç¯ä¸”äº¤äº’å‹å¥½ï¼š</p>
<h3 data-id="heading-1">1. åŸºç¡€çŠ¶æ€ä¸ä¿¡æ¯ç®¡ç†</h3>

























<table><thead><tr><th>åŠŸèƒ½ç‚¹</th><th>å®ç°é€»è¾‘</th><th>ä»·å€¼</th></tr></thead><tbody><tr><td>åŠ è½½çŠ¶æ€</td><td>åˆå§‹åŒ–æ˜¾ç¤º â€œåŠ è½½ä¸­â€ï¼Œå»¶è¿Ÿ 1 ç§’éšè—ï¼ˆç»™èµ„æºåŠ è½½ç•™ç¼“å†²ï¼‰</td><td>é¿å…ç”¨æˆ·å› æ–‡ä»¶åŠ è½½æ…¢è¯¯ä»¥ä¸º â€œæ— å†…å®¹â€ï¼Œæå‡äº¤äº’æ„ŸçŸ¥</td></tr><tr><td>æ–‡ä»¶ä¿¡æ¯è§£æ</td><td>ä»ä¼ å…¥çš„Â <code>fileUrl</code>Â ä¸­åˆ†å‰² URLã€è§£ææ–‡ä»¶å / åç¼€ï¼ˆå¦‚ä»Â <code>http://xxx/test.mp4</code>Â æå–Â <code>test.mp4</code>Â å’ŒÂ <code>mp4</code>ï¼‰</td><td>è‡ªåŠ¨è¯†åˆ«æ–‡ä»¶å±æ€§ï¼Œæ— éœ€ä¸šåŠ¡ä¾§æ‰‹åŠ¨ä¼ å…¥æ–‡ä»¶å / ç±»å‹</td></tr><tr><td>é”™è¯¯çŠ¶æ€ç®¡ç†</td><td>ç›‘å¬ video/iframe é¢„è§ˆé”™è¯¯ï¼Œå±•ç¤ºé’ˆå¯¹æ€§æç¤ºï¼ˆå¦‚ â€œè§†é¢‘é¢„è§ˆå¤±è´¥â€â€œæ–‡ä»¶é“¾æ¥æ— æ•ˆâ€ï¼‰</td><td>æ˜ç¡®å¤±è´¥åŸå› ï¼Œå¼•å¯¼ç”¨æˆ·ä¸‹ä¸€æ­¥æ“ä½œï¼ˆä¸‹è½½ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-2">2. åˆ†ç±»å‹æ–‡ä»¶é¢„è§ˆï¼ˆæ ¸å¿ƒæ ¸å¿ƒï¼‰</h3>
<p>ç»„ä»¶æŒ‰æ–‡ä»¶ç±»å‹åˆ’åˆ†é¢„è§ˆç­–ç•¥ï¼Œè¦†ç›–<strong>è§†é¢‘ã€å›¾ç‰‡ã€æ–‡æ¡£ã€Office å››å¤§ç±»</strong>ï¼Œé€‚é…ä¸åŒæ–‡ä»¶çš„åŸç”Ÿé¢„è§ˆèƒ½åŠ›ï¼š</p>



































<table><thead><tr><th>æ–‡ä»¶ç±»å‹</th><th>é¢„è§ˆæ–¹å¼</th><th>ç‰¹æ®Šå¤„ç†</th><th>æ”¯æŒçš„æ ¼å¼</th></tr></thead><tbody><tr><td>è§†é¢‘æ–‡ä»¶</td><td>åŸç”ŸÂ <code>&lt;video&gt;</code>Â æ ‡ç­¾ + æ’­æ”¾æ§ä»¶</td><td>é¢„è§ˆå¤±è´¥åè‡ªåŠ¨ç§»é™¤è§†é¢‘æ ¼å¼çš„é¢„è§ˆæ”¯æŒï¼Œåˆ‡æ¢ä¸ºä¸‹è½½æ¨¡å¼</td><td>mp4ã€aviã€movã€mkvã€flvã€wmv</td></tr><tr><td>Office æ–‡ä»¶ï¼ˆdoc/xls/ppt åŠæ–°ç‰ˆï¼‰</td><td>iframe åµŒå¥—å¾®è½¯åœ¨çº¿é¢„è§ˆæœåŠ¡</td><td>æ‹¼æ¥å¾®è½¯é¢„è§ˆ URLï¼ˆ<code>view.officeapps.live.com</code>ï¼‰ï¼Œè§£å†³å‰ç«¯æ— æ³•ç›´æ¥é¢„è§ˆ Office çš„ç—›ç‚¹</td><td>docã€docxã€xlsã€xlsxã€pptã€pptx</td></tr><tr><td>å›¾ç‰‡ / æ–‡æœ¬ / PDF</td><td>iframe ç›´æ¥åŠ è½½æ–‡ä»¶ URL</td><td>åˆ©ç”¨æµè§ˆå™¨åŸç”Ÿæ¸²æŸ“èƒ½åŠ›ï¼Œæ— éœ€é¢å¤–ä¾èµ–</td><td>jpg/png/gif/bmpã€txtã€html/htmã€pdf</td></tr><tr><td>ä¸æ”¯æŒçš„æ–‡ä»¶ï¼ˆzip/rar/ æœªçŸ¥æ ¼å¼ï¼‰</td><td>æ— é¢„è§ˆï¼Œå±•ç¤ºä¸‹è½½åŒºåŸŸ</td><td>æ˜¾ç¤ºæ–‡ä»¶å›¾æ ‡ã€ç±»å‹ã€æç¤ºè¯­ï¼Œæä¾›ä¸‹è½½æŒ‰é’®</td><td>zipã€rar åŠæœªåˆ—å…¥é¢„è§ˆåˆ—è¡¨çš„æ ¼å¼</td></tr></tbody></table>
<h3 data-id="heading-3">3. é”™è¯¯å…œåº•ä¸é™çº§å¤„ç†</h3>

























<table><thead><tr><th>é”™è¯¯åœºæ™¯</th><th>å¤„ç†é€»è¾‘</th><th>ç”¨æˆ·ä½“éªŒ</th></tr></thead><tbody><tr><td>è§†é¢‘é¢„è§ˆå¤±è´¥ï¼ˆæ ¼å¼ä¸æ”¯æŒ / æ–‡ä»¶æŸåï¼‰</td><td>æ˜¾ç¤ºé”™è¯¯æç¤ºï¼ŒåŒæ—¶å°†è§†é¢‘æ ¼å¼ä» â€œæ”¯æŒé¢„è§ˆåˆ—è¡¨â€ ä¸­ç§»é™¤ï¼Œå¼ºåˆ¶åˆ‡æ¢ä¸ºä¸‹è½½æ¨¡å¼</td><td>é¿å…ç”¨æˆ·çœ‹åˆ°ç©ºç™½ / æŠ¥é”™çš„ video æ ‡ç­¾ï¼Œç›´æ¥å¼•å¯¼ä¸‹è½½</td></tr><tr><td>iframe é¢„è§ˆå¤±è´¥ï¼ˆOffice é“¾æ¥å¤±æ•ˆ / PDF æŸåï¼‰</td><td>æ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œè¡¥å…… â€œå»ºè®®ä¸‹è½½æŸ¥çœ‹â€ çš„å¼•å¯¼</td><td>æ˜ç¡®å¤±è´¥åŸå› ï¼Œä¸é˜»å¡ç”¨æˆ·è·å–æ–‡ä»¶</td></tr><tr><td>è§£ææ–‡ä»¶ä¿¡æ¯å¤±è´¥</td><td>å…œåº•æ˜¾ç¤º â€œæœªçŸ¥æ–‡ä»¶â€â€œæœªçŸ¥ç±»å‹â€ï¼Œä»ä¿ç•™ä¸‹è½½åŠŸèƒ½</td><td>å…¼å®¹å¼‚å¸¸ URLï¼ˆå¦‚æ— åç¼€ã€URL æ ¼å¼é”™è¯¯ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-4">4. è½»é‡åŒ–ä¸‹è½½åŠŸèƒ½</h3>
<p>é€šè¿‡åŠ¨æ€åˆ›å»º<code>&lt;a&gt;</code>æ ‡ç­¾å®ç°æ— åˆ·æ–°ä¸‹è½½ï¼Œæ”¯æŒè‡ªå®šä¹‰æ–‡ä»¶åï¼Œæ•è·ä¸‹è½½å¼‚å¸¸å¹¶ç»™å‡ºå‹å¥½æç¤ºï¼ˆå¦‚ â€œæ–‡ä»¶ä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥â€ï¼‰ã€‚</p>
<h3 data-id="heading-5">5. å‹å¥½çš„è§†è§‰ä¸äº¤äº’</h3>
<ul>
<li>åŠ è½½çŠ¶æ€å±…ä¸­æ˜¾ç¤º â€œåŠ è½½ä¸­â€ï¼Œé¿å…ç”¨æˆ·è¯¯ä»¥ä¸ºæ— å†…å®¹ï¼›</li>
<li>é¢„è§ˆåŒºåŸŸè‡ªé€‚åº”å®¹å™¨å¤§å°ï¼Œè§†é¢‘é‡‡ç”¨<code>object-fit: contain</code>é˜²æ­¢æ‹‰ä¼¸ï¼›</li>
<li>ä¸‹è½½åŒºåŸŸç”¨å›¾æ ‡ + æ–‡å­—ç»„åˆï¼ŒæŒ‰é’®è“è‰²å¼ºè°ƒï¼Œæç¤ºè¯­æµ…ç°è‰²å¼±åŒ–ï¼Œè§†è§‰å±‚çº§æ¸…æ™°ï¼›</li>
<li>é”™è¯¯æç¤ºç”¨çº¢è‰²è­¦ç¤ºï¼Œæå‡è¾¨è¯†åº¦ã€‚</li>
</ul>
<h2 data-id="heading-6">äºŒã€åº”ç”¨åœºæ™¯å’Œç»„ä»¶å®Œæ•´ä»£ç </h2>
<p>è¯¥ç»„ä»¶é€‚é…æ‰€æœ‰éœ€è¦ â€œæ–‡ä»¶é¢„è§ˆ / ä¸‹è½½â€ çš„ä¸šåŠ¡åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯é«˜é¢‘è½åœ°åœºæ™¯ï¼š</p>
<h6 data-id="heading-7">1. åå°ç®¡ç†ç³»ç»Ÿï¼ˆæ ¸å¿ƒåœºæ™¯ï¼‰</h6>
<ul>
<li><strong>æ–‡ä»¶ç®¡ç†æ¨¡å—ï¼ˆOA / ä¼ä¸šç½‘ç›˜ï¼‰</strong> ï¼šç”¨æˆ·ä¸Šä¼ æ–‡ä»¶åï¼Œåˆ—è¡¨ / è¯¦æƒ…é¡µå±•ç¤ºé¢„è§ˆï¼Œæ”¯æŒåœ¨çº¿æŸ¥çœ‹è§†é¢‘ / PDF/Officeï¼Œå‹ç¼©åŒ…ç­‰ç›´æ¥ä¸‹è½½ï¼›</li>
<li><strong>å·¥å• / å®¡æ‰¹ç³»ç»Ÿ</strong>ï¼šå®¡æ‰¹é™„ä»¶ï¼ˆå¦‚æŠ¥é”€å• PDFã€é¡¹ç›®æ–‡æ¡£ Wordï¼‰åœ¨çº¿é¢„è§ˆï¼Œæ— éœ€ä¸‹è½½å³å¯å®¡æ ¸ï¼Œæå‡å®¡æ‰¹æ•ˆç‡ï¼›</li>
<li><strong>ç´ æç®¡ç†ç³»ç»Ÿ</strong>ï¼šè¿è¥ / è®¾è®¡äººå‘˜ä¸Šä¼ çš„è§†é¢‘ / å›¾ç‰‡ç´ æåœ¨çº¿é¢„è§ˆï¼Œå¿«é€Ÿæ ¸å¯¹å†…å®¹æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚</li>
</ul>
<h6 data-id="heading-8">2. ç”¨æˆ·ä¸­å¿ƒ / å®¢æˆ·é—¨æˆ·</h6>
<ul>
<li><strong>èµ„è´¨å®¡æ ¸åœºæ™¯ï¼ˆæ”¿åŠ¡ / é‡‘èï¼‰</strong> ï¼šç”¨æˆ·ä¸Šä¼ çš„èº«ä»½è¯ï¼ˆå›¾ç‰‡ï¼‰ã€è¥ä¸šæ‰§ç…§ï¼ˆPDFï¼‰åœ¨çº¿é¢„è§ˆï¼Œå·¥ä½œäººå‘˜æ— éœ€ä¸‹è½½å³å¯å®¡æ ¸ï¼›</li>
<li><strong>è¯¾ç¨‹ / åŸ¹è®­å¹³å°</strong>ï¼šè¯¾ç¨‹é™„ä»¶ï¼ˆè§†é¢‘ã€è®²ä¹‰ PDFã€è¯¾ä»¶ PPTï¼‰åœ¨çº¿é¢„è§ˆï¼Œå­¦å‘˜æ— éœ€ä¸‹è½½å³å¯å­¦ä¹ ï¼Œé™ä½å­¦ä¹ é—¨æ§›ï¼›</li>
<li><strong>å”®åå·¥å•ç³»ç»Ÿ</strong>ï¼šç”¨æˆ·ä¸Šä¼ çš„å”®åå‡­è¯ï¼ˆè§†é¢‘ / å›¾ç‰‡ï¼‰åœ¨çº¿é¢„è§ˆï¼Œå®¢æœå¿«é€Ÿæ ¸å®é—®é¢˜ï¼Œæå‡å”®åæ•ˆç‡ã€‚</li>
</ul>
<h6 data-id="heading-9">3. ç”µå•† / é›¶å”®ç³»ç»Ÿ</h6>
<ul>
<li><strong>å•†å“èµ„æ–™ç®¡ç†</strong>ï¼šå•†å“è§†é¢‘ã€è¯´æ˜ä¹¦ PDFã€å‚æ•°è¡¨ Excel åœ¨çº¿é¢„è§ˆï¼Œè¿è¥äººå‘˜å¿«é€Ÿæ ¸å¯¹å•†å“ä¿¡æ¯ï¼›</li>
<li><strong>å•†å®¶åå°</strong>ï¼šå•†å®¶ä¸Šä¼ çš„èµ„è´¨æ–‡ä»¶ï¼ˆè¥ä¸šæ‰§ç…§ã€é£Ÿå“ç»è¥è®¸å¯è¯ï¼‰åœ¨çº¿é¢„è§ˆï¼Œå¹³å°å®¡æ ¸äººå‘˜ä¸€é”®æŸ¥çœ‹ã€‚</li>
</ul>
<h6 data-id="heading-10">4. åŒ»ç–— / æ•™è‚²ç³»ç»Ÿ</h6>
<ul>
<li><strong>åŒ»ç–—æŠ¥å‘Šé¢„è§ˆ</strong>ï¼šæ£€æŸ¥æŠ¥å‘Š PDFã€åŒ»å­¦å½±åƒï¼ˆå›¾ç‰‡ï¼‰åœ¨çº¿é¢„è§ˆï¼ŒåŒ»ç”Ÿ / æ‚£è€…æ— éœ€ä¸‹è½½å³å¯æŸ¥çœ‹ï¼›</li>
<li><strong>åœ¨çº¿è€ƒè¯•ç³»ç»Ÿ</strong>ï¼šè€ƒè¯•é™„ä»¶ï¼ˆè¯•é¢˜ PDFã€å‚è€ƒèµ„æ–™ Wordï¼‰åœ¨çº¿é¢„è§ˆï¼Œè€ƒç”Ÿåœ¨çº¿ç­”é¢˜æ—¶å¯å¿«é€ŸæŸ¥é˜…ã€‚</li>
</ul>
<h3 data-id="heading-11">ä»£ç </h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"file-preview-container"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- åŠ è½½çŠ¶æ€ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"loading"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loading"</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- è§†é¢‘æ–‡ä»¶ï¼šç”¨ video æ ‡ç­¾é¢„è§ˆ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">video</span>
      <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"isVideo &amp;&amp; canPreview"</span>
      <span class="hljs-attr">:src</span>=<span class="hljs-string">"fileUrl"</span>
      <span class="hljs-attr">controls</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"video-preview"</span>
      @<span class="hljs-attr">error</span>=<span class="hljs-string">"handleVideoError"</span>
    &gt;</span>
      æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘é¢„è§ˆ
    <span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- éè§†é¢‘å¯é¢„è§ˆæ–‡ä»¶ï¼šç”¨ iframe å±•ç¤º --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">iframe</span>
      <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"!isVideo &amp;&amp; canPreview"</span>
      <span class="hljs-attr">:src</span>=<span class="hljs-string">"iframeSrc"</span>
      <span class="hljs-attr">width</span>=<span class="hljs-string">"100%"</span>
      <span class="hljs-attr">height</span>=<span class="hljs-string">"100%"</span>
      <span class="hljs-attr">frameborder</span>=<span class="hljs-string">"0"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"preview-iframe"</span>
      @<span class="hljs-attr">error</span>=<span class="hljs-string">"handleIframeError"</span>
    &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- ä¸æ”¯æŒé¢„è§ˆçš„æ–‡ä»¶ï¼šæ˜¾ç¤ºä¸‹è½½æŒ‰é’® --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"download-section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"file-icon"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-video-camera"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"isVideo"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-document"</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"fileType === 'doc' || fileType === 'docx'"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-table-lines"</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"fileType === 'xls' || fileType === 'xlsx'"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-present"</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"fileType === 'ppt' || fileType === 'pptx'"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-file-pdf"</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"fileType === 'pdf'"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-image"</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"['jpg','jpeg','png','gif','bmp'].includes(fileType)"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-archive"</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"fileType === 'zip' || fileType === 'rar'"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-exclamation"</span> <span class="hljs-attr">v-else</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"file-info"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"file-name"</span>&gt;</span>{{ fileName }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"file-type"</span>&gt;</span>æ–‡ä»¶ç±»å‹ï¼š.{{ fileType }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"file-tip"</span>&gt;</span>
          {{
            isVideo
              ? "è§†é¢‘æ— æ³•é¢„è§ˆï¼Œè¯·ä¸‹è½½åæŸ¥çœ‹"
              : "è¯¥æ–‡ä»¶ç±»å‹ä¸æ”¯æŒåœ¨çº¿é¢„è§ˆï¼Œè¯·ä¸‹è½½åæŸ¥çœ‹"
          }}
        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"download-btn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"downloadFile"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon-download"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> ä¸‹è½½æ–‡ä»¶
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- é”™è¯¯æç¤º --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"errorMsg"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"error-message"</span>&gt;</span>{{ errorMsg }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"FilePreviewDownload"</span>,
  <span class="hljs-attr">props</span>: {
    <span class="hljs-comment">// æ–‡ä»¶å®Œæ•´é“¾æ¥ï¼ˆå¦‚ï¼šhttp://xxx.com/video.mp4ã€http://xxx.com/image.pngï¼‰</span>
    <span class="hljs-attr">fileUrl</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
      <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">validator</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
        <span class="hljs-comment">// ç®€å•æ ¡éªŒURLæ ¼å¼</span>
        <span class="hljs-keyword">return</span> <span class="hljs-regexp">/^https?:/</span><span class="hljs-regexp">/.+/i</span>.<span class="hljs-title function_">test</span>(value) || <span class="hljs-regexp">/^/</span><span class="hljs-regexp">/.+/i</span>.<span class="hljs-title function_">test</span>(value);
      },
    },
    <span class="hljs-comment">// è‡ªå®šä¹‰æ–‡ä»¶åï¼ˆå¯é€‰ï¼Œé»˜è®¤ä»URLæå–ï¼‰</span>
    <span class="hljs-attr">customFileName</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
      <span class="hljs-attr">default</span>: <span class="hljs-string">""</span>,
    },
  },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">errorMsg</span>: <span class="hljs-string">""</span>,
      <span class="hljs-attr">fileName</span>: <span class="hljs-string">""</span>, <span class="hljs-comment">// æ–‡ä»¶åï¼ˆå¦‚ï¼štest.mp4ï¼‰</span>
      <span class="hljs-attr">fileType</span>: <span class="hljs-string">""</span>, <span class="hljs-comment">// æ–‡ä»¶åç¼€ï¼ˆå¦‚ï¼šmp4ï¼‰</span>
      <span class="hljs-comment">// æ”¯æŒçš„æ–‡ä»¶ç±»å‹åˆ—è¡¨</span>
      <span class="hljs-attr">previewableTypes</span>: [
        <span class="hljs-comment">// è§†é¢‘ç±»</span>
        <span class="hljs-string">"mp4"</span>, <span class="hljs-string">"avi"</span>, <span class="hljs-string">"mov"</span>, <span class="hljs-string">"mkv"</span>, <span class="hljs-string">"flv"</span>, <span class="hljs-string">"wmv"</span>,
        <span class="hljs-comment">// æ–‡æ¡£ç±»</span>
        <span class="hljs-string">"pdf"</span>, <span class="hljs-string">"txt"</span>, <span class="hljs-string">"html"</span>, <span class="hljs-string">"htm"</span>,
        <span class="hljs-comment">// å›¾ç‰‡ç±»</span>
        <span class="hljs-string">"jpg"</span>, <span class="hljs-string">"jpeg"</span>, <span class="hljs-string">"png"</span>, <span class="hljs-string">"gif"</span>, <span class="hljs-string">"bmp"</span>,
        <span class="hljs-comment">// Office æ ¼å¼</span>
        <span class="hljs-string">"docx"</span>, <span class="hljs-string">"xlsx"</span>, <span class="hljs-string">"pptx"</span>, <span class="hljs-string">"doc"</span>, <span class="hljs-string">"xls"</span>, <span class="hljs-string">"ppt"</span>,
      ],
      <span class="hljs-comment">// è§†é¢‘æ ¼å¼å•ç‹¬åŒºåˆ†ï¼ˆç”¨äºåˆ¤æ–­æ˜¯å¦ç”¨ video æ ‡ç­¾ï¼‰</span>
      <span class="hljs-attr">videoTypes</span>: [<span class="hljs-string">"mp4"</span>, <span class="hljs-string">"avi"</span>, <span class="hljs-string">"mov"</span>, <span class="hljs-string">"mkv"</span>, <span class="hljs-string">"flv"</span>, <span class="hljs-string">"wmv"</span>],
    };
  },
  <span class="hljs-attr">computed</span>: {
    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ”¯æŒé¢„è§ˆ</span>
    <span class="hljs-title function_">canPreview</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewableTypes</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fileType</span>);
    },
    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¸ºè§†é¢‘æ–‡ä»¶</span>
    <span class="hljs-title function_">isVideo</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">videoTypes</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fileType</span>);
    },
    <span class="hljs-comment">// iframe é¢„è§ˆåœ°å€ï¼ˆå¤„ç† Office æ–‡ä»¶ï¼‰</span>
    <span class="hljs-title function_">iframeSrc</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// Office æ–‡ä»¶ç”¨å¾®è½¯åœ¨çº¿é¢„è§ˆå¢å¼ºå…¼å®¹æ€§</span>
      <span class="hljs-keyword">if</span> ([<span class="hljs-string">"doc"</span>, <span class="hljs-string">"docx"</span>, <span class="hljs-string">"xls"</span>, <span class="hljs-string">"xlsx"</span>, <span class="hljs-string">"ppt"</span>, <span class="hljs-string">"pptx"</span>].<span class="hljs-title function_">includes</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fileType</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`https://view.officeapps.live.com/op/embed.aspx?src=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-variable language_">this</span>.fileUrl)}</span>`</span>;
      }
      <span class="hljs-comment">// å…¶ä»–æ–‡ä»¶ç›´æ¥ç”¨åŸé“¾æ¥</span>
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileUrl</span>;
    },
  },
  <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// è§£ææ–‡ä»¶åå’Œç±»å‹</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">parseFileInfo</span>();
    <span class="hljs-comment">// å»¶è¿Ÿéšè—åŠ è½½ï¼ˆç»™èµ„æºåŠ è½½ç•™æ—¶é—´ï¼Œå¯é€šè¿‡propsè‡ªå®šä¹‰å»¶è¿Ÿï¼‰</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
    }, <span class="hljs-number">1000</span>);
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// è§£ææ–‡ä»¶åå’Œåç¼€</span>
    <span class="hljs-title function_">parseFileInfo</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// ä¼˜å…ˆä½¿ç”¨è‡ªå®šä¹‰æ–‡ä»¶å</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">customFileName</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileName</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">customFileName</span>;
          <span class="hljs-keyword">const</span> nameParts = <span class="hljs-variable language_">this</span>.<span class="hljs-property">customFileName</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">"."</span>);
          <span class="hljs-keyword">if</span> (nameParts.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileType</span> = nameParts[nameParts.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-title function_">toLowerCase</span>();
          }
          <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// ä»URLæå–æ–‡ä»¶å</span>
        <span class="hljs-keyword">const</span> urlParts = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileUrl</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">"/"</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileName</span> = urlParts[urlParts.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] || <span class="hljs-string">"æœªçŸ¥æ–‡ä»¶"</span>;
        <span class="hljs-comment">// å¤„ç†URLå‚æ•°ï¼ˆå¦‚ï¼štest.pdf?timestamp=123 â†’ test.pdfï¼‰</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileName</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileName</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">"?"</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">"#"</span>)[<span class="hljs-number">0</span>];
        <span class="hljs-comment">// æå–æ–‡ä»¶åç¼€</span>
        <span class="hljs-keyword">const</span> nameParts = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileName</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">"."</span>);
        <span class="hljs-keyword">if</span> (nameParts.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileType</span> = nameParts[nameParts.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-title function_">toLowerCase</span>();
        }
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"è§£ææ–‡ä»¶ä¿¡æ¯å¤±è´¥ï¼š"</span>, err);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileName</span> = <span class="hljs-string">"æœªçŸ¥æ–‡ä»¶"</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileType</span> = <span class="hljs-string">""</span>;
      }
    },

    <span class="hljs-comment">// è§†é¢‘é¢„è§ˆé”™è¯¯å¤„ç†</span>
    <span class="hljs-title function_">handleVideoError</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">errorMsg</span> = <span class="hljs-string">"è§†é¢‘é¢„è§ˆå¤±è´¥ï¼Œå¯èƒ½æ ¼å¼ä¸æ”¯æŒæˆ–æ–‡ä»¶æŸå"</span>;
      <span class="hljs-comment">// è§†é¢‘é¢„è§ˆå¤±è´¥ååˆ‡æ¢ä¸ºä¸‹è½½æ¨¡å¼</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewableTypes</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewableTypes</span>.<span class="hljs-title function_">filter</span>(
        <span class="hljs-function">(<span class="hljs-params">type</span>) =&gt;</span> !<span class="hljs-variable language_">this</span>.<span class="hljs-property">videoTypes</span>.<span class="hljs-title function_">includes</span>(type)
      );
    },

    <span class="hljs-comment">// iframe é¢„è§ˆé”™è¯¯å¤„ç†</span>
    <span class="hljs-title function_">handleIframeError</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">errorMsg</span> = <span class="hljs-string">"æ–‡ä»¶é¢„è§ˆå¤±è´¥ï¼Œå¯èƒ½æ–‡ä»¶å·²æŸåæˆ–é“¾æ¥æ— æ•ˆ"</span>;
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">previewableTypes</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fileType</span>)) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">errorMsg</span> += <span class="hljs-string">"ï¼Œå»ºè®®ä¸‹è½½æ–‡ä»¶æŸ¥çœ‹"</span>;
      }
    },

    <span class="hljs-comment">// ä¸‹è½½æ–‡ä»¶</span>
    <span class="hljs-title function_">downloadFile</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"a"</span>);
        link.<span class="hljs-property">href</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileUrl</span>;
        <span class="hljs-comment">// è§£å†³è·¨åŸŸä¸‹è½½æ—¶downloadå±æ€§å¤±æ•ˆé—®é¢˜ï¼ˆéœ€åç«¯é…åˆè®¾ç½®Content-Dispositionï¼‰</span>
        link.<span class="hljs-property">download</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileName</span>;
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(link);
        link.<span class="hljs-title function_">click</span>();
        <span class="hljs-comment">// è§¦å‘ä¸‹è½½åç§»é™¤aæ ‡ç­¾</span>
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(link);
        }, <span class="hljs-number">100</span>);
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"ä¸‹è½½å¤±è´¥ï¼š"</span>, err);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>?.<span class="hljs-property">error</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ–‡ä»¶ä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥"</span>) : <span class="hljs-title function_">alert</span>(<span class="hljs-string">"æ–‡ä»¶ä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥"</span>);
      }
    },
  },
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.file-preview-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#eee</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-comment">/* è§†é¢‘é¢„è§ˆæ ·å¼ */</span>
<span class="hljs-selector-class">.video-preview</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">object-fit</span>: contain;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#000</span>;
}

<span class="hljs-comment">/* iframe é¢„è§ˆæ ·å¼ */</span>
<span class="hljs-selector-class">.preview-iframe</span> {
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">border</span>: none;
}

<span class="hljs-comment">/* åŠ è½½çŠ¶æ€ */</span>
<span class="hljs-selector-class">.loading</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
}

<span class="hljs-comment">/* ä¸‹è½½åŒºåŸŸ */</span>
<span class="hljs-selector-class">.download-section</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-selector-class">.file-icon</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#417aff</span>;
  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">30px</span>;
}

<span class="hljs-selector-class">.file-info</span> {
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">180px</span>;
}

<span class="hljs-selector-class">.file-name</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">white-space</span>: nowrap;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">text-overflow</span>: ellipsis;
}

<span class="hljs-selector-class">.file-type</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.file-tip</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.4</span>;
}

<span class="hljs-selector-class">.download-btn</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">6px</span> <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#417aff</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">display</span>: inline-flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.download-btn</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#2d62d0</span>;
}

<span class="hljs-selector-class">.download-btn</span> <span class="hljs-selector-tag">i</span> {
  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-comment">/* é”™è¯¯æç¤º */</span>
<span class="hljs-selector-class">.error-message</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#f56c6c</span>;
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.5</span>;
}

<span class="hljs-comment">/* å“åº”å¼é€‚é… */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.file-preview-container</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  }
  <span class="hljs-selector-class">.download-section</span> {
    <span class="hljs-attribute">flex-direction</span>: column;
    <span class="hljs-attribute">text-align</span>: center;
  }
  <span class="hljs-selector-class">.file-icon</span> {
    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">16px</span>;
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-12">ä¸‰ã€å¿«é€Ÿä½¿ç”¨æŒ‡å—</h2>
<h3 data-id="heading-13">1. å®‰è£…ä¾èµ–ï¼ˆå¯é€‰ï¼‰</h3>
<p>ç»„ä»¶ä¾èµ– Element UI å›¾æ ‡ï¼Œè‹¥é¡¹ç›®æœªé›†æˆ Element UIï¼Œå¯å®‰è£…ï¼š</p>
<pre><code class="hljs language-css" lang="css">npm install element-ui <span class="hljs-attr">--save</span>
</code></pre>
<p>æˆ–æ›¿æ¢ä¸ºåŸç”Ÿå›¾æ ‡ï¼ˆå¦‚ Font Awesomeï¼‰ï¼Œç§»é™¤ Element UI ä¾èµ–ã€‚</p>
<h3 data-id="heading-14">2. å¼•å…¥ç»„ä»¶</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨éœ€è¦ä½¿ç”¨çš„é¡µé¢å¼•å…¥</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">FilePreviewDownload</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/FilePreviewDownload.vue"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: {
    <span class="hljs-title class_">FilePreviewDownload</span>,
  },
};
</code></pre>
<h3 data-id="heading-15">3. é¡µé¢ä¸­ä½¿ç”¨</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- åŸºç¡€ç”¨æ³•ï¼šä»…ä¼ å…¥æ–‡ä»¶URL --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">FilePreviewDownload</span> <span class="hljs-attr">fileUrl</span>=<span class="hljs-string">"http://xxx.com/test.pdf"</span> /&gt;</span>

<span class="hljs-comment">&lt;!-- è‡ªå®šä¹‰æ–‡ä»¶å --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">FilePreviewDownload</span> 
  <span class="hljs-attr">fileUrl</span>=<span class="hljs-string">"http://xxx.com/123.mp4"</span> 
  <span class="hljs-attr">customFileName</span>=<span class="hljs-string">"äº§å“ä»‹ç»è§†é¢‘.mp4"</span> 
/&gt;</span>
</code></pre>
<h2 data-id="heading-16">å››ã€ç»„ä»¶ä¼˜åŠ¿</h2>

























<table><thead><tr><th>ä¼˜åŠ¿ç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>é€šç”¨æ€§å¼º</td><td>è¦†ç›–è§†é¢‘ã€å›¾ç‰‡ã€æ–‡æ¡£ã€Office ç­‰ä¸»æµæ–‡ä»¶ç±»å‹ï¼Œé€‚é… 90%+ ä¸šåŠ¡åœºæ™¯</td></tr><tr><td>ä½“éªŒå‹å¥½</td><td>åŠ è½½ / é”™è¯¯ / é™çº§é€»è¾‘å®Œå–„ï¼Œç”¨æˆ·æ“ä½œè·¯å¾„æ¸…æ™°ï¼ˆé¢„è§ˆâ†’å¤±è´¥â†’ä¸‹è½½ï¼‰</td></tr><tr><td>è½»é‡æ˜“é›†æˆ</td><td>åŸºäºåŸç”Ÿæ ‡ç­¾ + Vue å¼€å‘ï¼Œä»…ä¾èµ– Element å›¾æ ‡ï¼Œæ¥å…¥æˆæœ¬ä½</td></tr><tr><td>è§£å†³ Office é¢„è§ˆç—›ç‚¹</td><td>å€ŸåŠ©å¾®è½¯åœ¨çº¿é¢„è§ˆæœåŠ¡ï¼Œæ— éœ€å‰ç«¯é›†æˆé‡å‹ Office è§£æåº“</td></tr></tbody></table>
<h3 data-id="heading-17">1. é€šç”¨æ€§å¼ºï¼Œè¦†ç›–å…¨åœºæ™¯</h3>
<p>æ”¯æŒè§†é¢‘ã€å›¾ç‰‡ã€æ–‡æ¡£ã€Office ç­‰ 18 + å¸¸è§æ–‡ä»¶ç±»å‹ï¼Œæ— éœ€ä¸ºä¸åŒæ–‡ä»¶å†™ä¸“å±é€»è¾‘ï¼Œé€‚é…åå°ç®¡ç†ã€ç”¨æˆ·ä¸­å¿ƒã€ç”µå•†ç­‰å¤šä¸šåŠ¡åœºæ™¯ã€‚</p>
<h3 data-id="heading-18">2. ä½“éªŒå‹å¥½ï¼Œä¼˜é›…é™çº§</h3>
<p>â€œé¢„è§ˆä¼˜å…ˆï¼Œä¸‹è½½å…œåº•â€ çš„é€»è¾‘ï¼Œé¿å… â€œæ— æ³•é¢„è§ˆâ€ çš„ç”Ÿç¡¬ä½“éªŒï¼›é¢„è§ˆå¤±è´¥æ—¶ç»™å‡ºæ˜ç¡®æç¤ºï¼Œå¼•å¯¼ç”¨æˆ·ä¸‹ä¸€æ­¥æ“ä½œï¼Œå‡å°‘å›°æƒ‘ã€‚</p>
<h3 data-id="heading-19">3. è½»é‡æ— å†—ä½™ï¼Œæ¥å…¥æˆæœ¬ä½</h3>
<ul>
<li>æ ¸å¿ƒé€»è¾‘ä»… 200 + è¡Œï¼Œæ— é‡å‹ä¾èµ–ï¼Œæ‰“åŒ…ä½“ç§¯å°ï¼›</li>
<li>ä»…éœ€ä¼ å…¥<code>fileUrl</code>å³å¯ä½¿ç”¨ï¼Œæ— éœ€é…ç½®å¤æ‚å‚æ•°ï¼Œæ–°æ‰‹ä¹Ÿèƒ½å¿«é€Ÿä¸Šæ‰‹ã€‚</li>
</ul>
<h3 data-id="heading-20">4. é€‚é…æ€§å¼ºï¼Œå…¼å®¹å¤šç«¯</h3>
<ul>
<li>åŸºäºåŸç”Ÿ HTML æ ‡ç­¾ï¼ˆvideo/iframeï¼‰å¼€å‘ï¼Œå…¼å®¹ Chromeã€Firefoxã€Edge ç­‰ä¸»æµæµè§ˆå™¨ï¼›</li>
<li>æ ·å¼æ”¯æŒå“åº”å¼ï¼Œé€‚é…ç§»åŠ¨ç«¯ / H5ï¼Œå¯ç›´æ¥å¤ç”¨åœ¨å°ç¨‹åºå†…åµŒé¡µé¢ã€‚</li>
</ul>
<h2 data-id="heading-21">äº”ã€å±€é™æ€§ä¸ä¼˜åŒ–æ–¹å‘</h2>



































<table><thead><tr><th>å±€é™æ€§</th><th>å½±å“åœºæ™¯</th><th>ä¼˜åŒ–æ–¹å‘</th></tr></thead><tbody><tr><td>æ ·å¼ç¡¬ç¼–ç </td><td>å®¹å™¨å®½åº¦ 300px å›ºå®šï¼Œé€‚é…ä¸åŒå¸ƒå±€ï¼ˆå¦‚å…¨å±é¢„è§ˆï¼‰éœ€ä¿®æ”¹æ ·å¼</td><td>å°†å®½åº¦ / é«˜åº¦ / é¢œè‰²ç­‰ä½œä¸º props ä¼ å…¥ï¼Œæ”¯æŒè‡ªå®šä¹‰</td></tr><tr><td>Office é¢„è§ˆä¾èµ–å¤–ç½‘</td><td>å†…ç½‘ç¯å¢ƒä¸‹å¾®è½¯åœ¨çº¿é¢„è§ˆå¤±æ•ˆï¼ŒOffice æ–‡ä»¶æ— æ³•é¢„è§ˆ</td><td>é›†æˆå¼€æºæ–‡ä»¶é¢„è§ˆæœåŠ¡ï¼ˆå¦‚ kkfileviewã€LibreOffice Onlineï¼‰</td></tr><tr><td>è§†é¢‘é¢„è§ˆæ ¼å¼æœ‰é™</td><td>å°ä¼—æ ¼å¼ï¼ˆrmvbã€webmï¼‰ä¸æ”¯æŒï¼Œä¸”æ— æ ¼å¼è½¬æ¢é€»è¾‘</td><td>é›†æˆ ffmpeg.wasm å®ç°å‰ç«¯è§†é¢‘æ ¼å¼è§£ç ï¼Œæˆ–åç«¯è½¬ç ä¸º mp4</td></tr><tr><td>ä¸‹è½½åŠŸèƒ½å…¼å®¹é—®é¢˜</td><td>è·¨åŸŸæ–‡ä»¶çš„Â <code>download</code>Â å±æ€§å¤±æ•ˆï¼Œæ— æ³•ç›´æ¥ä¸‹è½½</td><td>åç«¯è½¬å‘æ–‡ä»¶ï¼ˆå‰ç«¯è¯·æ±‚åç«¯æ¥å£ï¼Œåç«¯è¿”å›æ–‡ä»¶æµï¼‰</td></tr><tr><td>åŠ è½½å»¶è¿Ÿå›ºå®š 1 ç§’</td><td>æ–‡ä»¶åŠ è½½å¿«æ—¶å¤šä½™æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼ŒåŠ è½½æ…¢æ—¶æå‰éšè—</td><td>ç›‘å¬ video/iframe çš„Â <code>onload</code>Â äº‹ä»¶ï¼ŒåŠ¨æ€æ§åˆ¶åŠ è½½çŠ¶æ€</td></tr></tbody></table>
<h3 data-id="heading-22">1. ç°å­˜å±€é™æ€§</h3>
<ul>
<li><strong>æ ·å¼ç¡¬ç¼–ç </strong>ï¼šå®¹å™¨å®½åº¦é»˜è®¤ 300pxï¼Œé€‚é…ä¸åŒå¸ƒå±€éœ€æ‰‹åŠ¨ä¿®æ”¹æ ·å¼ï¼›</li>
<li><strong>Office é¢„è§ˆä¾èµ–å¤–ç½‘</strong>ï¼šå†…ç½‘ç¯å¢ƒä¸‹å¾®è½¯åœ¨çº¿é¢„è§ˆæœåŠ¡å¤±æ•ˆï¼Œæ— æ³•é¢„è§ˆ Office æ–‡ä»¶ï¼›</li>
<li><strong>è§†é¢‘æ ¼å¼æ”¯æŒæœ‰é™</strong>ï¼šå°ä¼—æ ¼å¼ï¼ˆå¦‚ rmvbã€webmï¼‰ä¸æ”¯æŒåŸç”Ÿé¢„è§ˆï¼›</li>
<li><strong>è·¨åŸŸä¸‹è½½é—®é¢˜</strong>ï¼šè·¨åŸŸæ–‡ä»¶çš„<code>download</code>å±æ€§å¯èƒ½å¤±æ•ˆï¼Œéœ€åç«¯é…åˆè®¾ç½®å“åº”å¤´ã€‚</li>
</ul>
<h3 data-id="heading-23">2. æ‰©å±•æ–¹å‘ï¼ˆæŒ‰éœ€è¿­ä»£ï¼‰</h3>
<h4 data-id="heading-24">ï¼ˆ1ï¼‰æ”¯æŒè‡ªå®šä¹‰æ ·å¼é…ç½®</h4>
<p>å°†å®½åº¦ã€é«˜åº¦ã€è¾¹æ¡†ã€é¢œè‰²ç­‰æ ·å¼æŠ½ç¦»ä¸º propsï¼Œå…è®¸ä¸šåŠ¡ä¾§çµæ´»é…ç½®ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;FilePreviewDownload 
  fileUrl="http://xxx.com/test.jpg<span class="hljs-string">"
  :styleConfig="</span>{ <span class="hljs-attribute">width</span>: <span class="hljs-string">'500px'</span>, height: <span class="hljs-string">'300px'</span>, border: <span class="hljs-string">'1px solid #ccc'</span> }"
/&gt;
</code></pre>
<h4 data-id="heading-25">ï¼ˆ2ï¼‰å¢åŠ æƒé™æ§åˆ¶</h4>
<p>æ”¯æŒä¼ å…¥<code>token</code>å‚æ•°ï¼Œåœ¨é¢„è§ˆ URL ä¸­æ‹¼æ¥é‰´æƒä¿¡æ¯ï¼Œé˜²æ­¢æ–‡ä»¶é“¾æ¥æ³„éœ²ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ‰©å±•iframeSrcè®¡ç®—å±æ€§</span>
<span class="hljs-title function_">iframeSrc</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> url = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileUrl</span>;
  <span class="hljs-comment">// æ‹¼æ¥é‰´æƒtoken</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span>) {
    url = <span class="hljs-string">`<span class="hljs-subst">${url}</span><span class="hljs-subst">${url.includes(<span class="hljs-string">"?"</span>) ? <span class="hljs-string">"&amp;"</span> : <span class="hljs-string">"?"</span>}</span>token=<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.token}</span>`</span>;
  }
  <span class="hljs-keyword">if</span> ([<span class="hljs-string">"doc"</span>, <span class="hljs-string">"docx"</span>, <span class="hljs-string">"xls"</span>, <span class="hljs-string">"xlsx"</span>, <span class="hljs-string">"ppt"</span>, <span class="hljs-string">"pptx"</span>].<span class="hljs-title function_">includes</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fileType</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`https://view.officeapps.live.com/op/embed.aspx?src=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(url)}</span>`</span>;
  }
  <span class="hljs-keyword">return</span> url;
},
</code></pre>
<h4 data-id="heading-26">ï¼ˆ3ï¼‰å†…ç½‘ç¯å¢ƒ Office é¢„è§ˆé€‚é…</h4>
<p>é›†æˆå¼€æºæ–‡ä»¶é¢„è§ˆæœåŠ¡ï¼ˆå¦‚ kkfileviewã€LibreOffice Onlineï¼‰ï¼Œæ›¿ä»£å¾®è½¯åœ¨çº¿é¢„è§ˆï¼Œè§£å†³å†…ç½‘ç¯å¢ƒé¢„è§ˆå¤±æ•ˆé—®é¢˜ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼˜åŒ–downloadFileæ–¹æ³•</span>
<span class="hljs-title function_">downloadFile</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// è·¨åŸŸæ–‡ä»¶é€šè¿‡åç«¯æ¥å£ä¸‹è½½</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isCrossDomain</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">`/api/file/download?url=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-variable language_">this</span>.fileUrl)}</span>&amp;fileName=<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.fileName}</span>`</span>);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-comment">// éè·¨åŸŸæ–‡ä»¶ç›´æ¥ä¸‹è½½ï¼ˆåŸé€»è¾‘ï¼‰</span>
  <span class="hljs-comment">// ...</span>
},
</code></pre>
<h4 data-id="heading-27">ï¼ˆ6ï¼‰å¢åŠ æ‰¹é‡é¢„è§ˆ / ä¸‹è½½</h4>
<p>æ‰©å±•ä¸ºåˆ—è¡¨çº§ç»„ä»¶ï¼Œæ”¯æŒå¤šé€‰æ–‡ä»¶æ‰¹é‡é¢„è§ˆã€æ‰¹é‡ä¸‹è½½ï¼Œé€‚é…æ–‡ä»¶ç®¡ç†ç³»ç»Ÿåœºæ™¯ã€‚</p>
<h2 data-id="heading-28">å…­ã€æ€»ç»“</h2>
<p>è¿™æ¬¾æ–‡ä»¶é¢„è§ˆä¸‹è½½ç»„ä»¶ä»¥ â€œé€šç”¨ã€è½»é‡ã€å‹å¥½â€ ä¸ºæ ¸å¿ƒè®¾è®¡ç†å¿µï¼Œè§£å†³äº†å‰ç«¯æ–‡ä»¶å¤„ç†çš„é‡å¤å¼€å‘é—®é¢˜ï¼Œæ˜¯åå°ç®¡ç†ã€ç”¨æˆ·ä¸­å¿ƒç­‰é¡¹ç›®çš„å¿…å¤‡åŸºç¡€ç»„ä»¶ã€‚å®ƒä¸ä»…èƒ½ç›´æ¥å¤ç”¨ï¼Œè¿˜æ”¯æŒæŒ‰éœ€æ‰©å±•ï¼Œå¯æ ¹æ®ä¸šåŠ¡åœºæ™¯è¿­ä»£æƒé™æ§åˆ¶ã€å†…ç½‘é€‚é…ã€æ‰¹é‡æ“ä½œç­‰åŠŸèƒ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ—¥æœ¬è‚¡ç¥¨å¸‚åœºæ¸²æŸ“ KlineCharts K çº¿å›¾]]></title>    <link>https://juejin.cn/post/7577583653728665638</link>    <guid>https://juejin.cn/post/7577583653728665638</guid>    <pubDate>2025-11-28T09:35:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577583653728665638" data-draft-id="7577668116501119014" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ—¥æœ¬è‚¡ç¥¨å¸‚åœºæ¸²æŸ“ KlineCharts K çº¿å›¾"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-28T09:35:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é‡‘èæ•°æ®å‡ºæµ·"/> <meta itemprop="url" content="https://juejin.cn/user/3252824581613819"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ—¥æœ¬è‚¡ç¥¨å¸‚åœºæ¸²æŸ“ KlineCharts K çº¿å›¾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3252824581613819/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é‡‘èæ•°æ®å‡ºæµ·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:35:11.000Z" title="Fri Nov 28 2025 09:35:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸‹é¢æ˜¯é’ˆå¯¹<strong>æ—¥æœ¬è‚¡ç¥¨å¸‚åœº</strong>çš„å®Œæ•´å¯¹æ¥æ–¹æ¡ˆï¼ŒåŒ…å«ä»<strong>è·å–è‚¡ç¥¨åˆ—è¡¨</strong>åˆ°<strong>æ¸²æŸ“ KlineCharts K çº¿å›¾</strong>çš„è¯¦ç»†æ­¥éª¤å’Œä»£ç ã€‚</p>
<h3 data-id="heading-0">æ ¸å¿ƒæµç¨‹</h3>
<ol>
<li><strong>è·å–æ—¥æœ¬è‚¡ç¥¨åˆ—è¡¨</strong>ï¼šä½¿ç”¨ <code>countryId=35</code> æŸ¥è¯¢æ—¥æœ¬å¸‚åœºçš„è‚¡ç¥¨ï¼Œè·å–ç›®æ ‡è‚¡ç¥¨çš„ <code>id</code> (å³ PID)ã€‚</li>
<li><strong>è·å– K çº¿æ•°æ®</strong>ï¼šä½¿ç”¨è¯¥ <code>pid</code> è¯·æ±‚å†å² K çº¿æ•°æ®ã€‚</li>
<li><strong>ç»˜åˆ¶å›¾è¡¨</strong>ï¼šå°†æ•°æ®è½¬æ¢ä¸º KlineCharts æ ¼å¼å¹¶æ¸²æŸ“ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-1">ç¬¬ä¸€æ­¥ï¼šè·å–æ—¥æœ¬è‚¡ç¥¨ PID (API è°ƒè¯•)</h3>
<p>åœ¨å†™ä»£ç å‰ï¼Œæ‚¨éœ€è¦å…ˆé€šè¿‡ API æ‹¿åˆ°æ‚¨æƒ³å±•ç¤ºçš„æ—¥æœ¬è‚¡ç¥¨ï¼ˆä¾‹å¦‚ä¸°ç”°ã€ç´¢å°¼ç­‰ï¼‰çš„ <code>id</code>ã€‚</p>
<p><strong>è¯·æ±‚æ–¹å¼ï¼š</strong></p>
<ul>
<li><strong>æ¥å£ URL</strong>: <code>https://api.stocktv.top/stock/stocks</code></li>
<li><strong>å‚æ•°</strong>:
<ul>
<li><code>countryId</code>: <strong>35</strong> (æ—¥æœ¬)</li>
<li><code>pageSize</code>: <code>10</code></li>
<li><code>key</code>: <code>æ‚¨çš„Key</code></li>
</ul>
</li>
</ul>
<p><strong>è¯·æ±‚ç¤ºä¾‹ (GET):</strong></p>
<pre><code class="hljs language-http" lang="http">https://api.stocktv.top/stock/stocks?countryId=35&amp;pageSize=10&amp;page=1&amp;key=æ‚¨çš„Key
</code></pre>
<p><strong>è¿”å›ç¤ºä¾‹ (å‡è®¾):</strong>
æ‚¨ä¼šåœ¨è¿”å›çš„ <code>data.records</code> åˆ—è¡¨ä¸­æ‰¾åˆ°è‚¡ç¥¨ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">99999</span><span class="hljs-punctuation">,</span>  &lt;-- è¿™ä¸ªæ˜¯ PIDï¼Œè®°ä¸‹è¿™ä¸ªæ•°å­—ç”¨äºä¸‹ä¸€æ­¥
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Toyota Motor Corp"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"symbol"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7203"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"countryId"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">35</span><span class="hljs-punctuation">,</span>
  ...
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-2">ç¬¬äºŒæ­¥ï¼šå®Œæ•´å®ç°ä»£ç  (HTML + KlineCharts)</h3>
<p>å°†ä»¥ä¸‹ä»£ç ä¿å­˜ä¸º <code>.html</code> æ–‡ä»¶ã€‚<strong>è¯·æ›¿æ¢ä»£ç é¡¶éƒ¨çš„ <code>YOUR_API_KEY</code> å’Œæ‚¨åœ¨ä¸Šä¸€æ­¥è·å–åˆ°çš„ <code>JAPAN_STOCK_PID</code>ã€‚</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ—¥æœ¬è‚¡ç¥¨ Kçº¿å›¾ (KlineCharts)<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/klinecharts/dist/klinecharts.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">"Segoe UI"</span>, Roboto, <span class="hljs-string">"Helvetica Neue"</span>, Arial, sans-serif; }
        <span class="hljs-selector-tag">h2</span> { <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>; }
        <span class="hljs-selector-class">.config-box</span> { 
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f5</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>; <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>; <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>; 
            <span class="hljs-attribute">display</span>: flex; <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>; <span class="hljs-attribute">align-items</span>: center; <span class="hljs-attribute">flex-wrap</span>: wrap;
        }
        <span class="hljs-selector-tag">input</span>, select, <span class="hljs-selector-tag">button</span> { <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>; <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>; <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>; }
        <span class="hljs-selector-tag">button</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#007bff</span>; <span class="hljs-attribute">color</span>: white; <span class="hljs-attribute">border</span>: none; <span class="hljs-attribute">cursor</span>: pointer; }
        <span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:hover</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#0056b3</span>; }
        <span class="hljs-selector-id">#chart-container</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">600px</span>; <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>; <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>StockTV æ—¥æœ¬è‚¡ç¥¨ Kçº¿æ¼”ç¤º (CountryID=35)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"config-box"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>è‚¡ç¥¨PID: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"number"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"pidInput"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"953373"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"ä¾‹å¦‚: 953373"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>å‘¨æœŸ: 
            <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"intervalSelect"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"P1D"</span>&gt;</span>æ—¥çº¿ (1 Day)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"PT1H"</span>&gt;</span>1å°æ—¶ (1 Hour)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"PT15M"</span>&gt;</span>15åˆ†é’Ÿ (15 Min)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"PT5M"</span>&gt;</span>5åˆ†é’Ÿ (5 Min)<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"loadChartData()"</span>&gt;</span>ç”Ÿæˆå›¾è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"chart-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// é…ç½®æ‚¨çš„ API Key</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API_KEY</span> = <span class="hljs-string">'è”ç³»æˆ‘ä»¬è·å–key'</span>; <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> è¯·åœ¨æ­¤å¤„å¡«å…¥æ‚¨çš„çœŸå® Key</span>
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BASE_URL</span> = <span class="hljs-string">'https://api.stocktv.top'</span>;

        <span class="hljs-comment">// åˆå§‹åŒ– KlineCharts</span>
        <span class="hljs-keyword">let</span> chart = klinecharts.<span class="hljs-title function_">init</span>(<span class="hljs-string">'chart-container'</span>);
        
        <span class="hljs-comment">// è®¾ç½®ä¸€äº›åŸºç¡€æ ·å¼</span>
        chart.<span class="hljs-title function_">setStyleOptions</span>({
            <span class="hljs-attr">candle</span>: {
                <span class="hljs-attr">tooltip</span>: {
                    <span class="hljs-attr">labels</span>: [<span class="hljs-string">'æ—¶é—´'</span>, <span class="hljs-string">'å¼€'</span>, <span class="hljs-string">'æ”¶'</span>, <span class="hljs-string">'é«˜'</span>, <span class="hljs-string">'ä½'</span>, <span class="hljs-string">'æˆäº¤é‡'</span>]
                }
            }
        });

        chart.<span class="hljs-title function_">createIndicator</span>(<span class="hljs-string">'VOL'</span>); <span class="hljs-comment">// åˆ›å»ºæˆäº¤é‡æŒ‡æ ‡</span>

        <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadChartData</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> pid = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'pidInput'</span>).<span class="hljs-property">value</span>;
            <span class="hljs-keyword">const</span> interval = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'intervalSelect'</span>).<span class="hljs-property">value</span>;

            <span class="hljs-keyword">if</span> (!pid) {
                <span class="hljs-title function_">alert</span>(<span class="hljs-string">"è¯·è¾“å…¥è‚¡ç¥¨ PID"</span>);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ­£åœ¨è¯·æ±‚æ—¥æœ¬è‚¡ç¥¨æ•°æ®: PID=<span class="hljs-subst">${pid}</span>, Interval=<span class="hljs-subst">${interval}</span>`</span>);

            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// æ„é€  StockTV API è¯·æ±‚</span>
                <span class="hljs-comment">// æ–‡æ¡£æ¥å£: /stock/kline</span>
                <span class="hljs-keyword">const</span> url = <span class="hljs-string">`<span class="hljs-subst">${BASE_URL}</span>/stock/kline?pid=<span class="hljs-subst">${pid}</span>&amp;interval=<span class="hljs-subst">${interval}</span>&amp;key=<span class="hljs-subst">${API_KEY}</span>`</span>;
                
                <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);
                <span class="hljs-keyword">const</span> resJson = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();

                <span class="hljs-keyword">if</span> (resJson.<span class="hljs-property">code</span> === <span class="hljs-number">200</span>) {
                    <span class="hljs-keyword">const</span> stockData = resJson.<span class="hljs-property">data</span>;

                    <span class="hljs-keyword">if</span> (!stockData || stockData.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
                        <span class="hljs-title function_">alert</span>(<span class="hljs-string">"è¯¥è‚¡ç¥¨åœ¨æ­¤å‘¨æœŸä¸‹æ— æ•°æ®"</span>);
                        <span class="hljs-keyword">return</span>;
                    }

                    <span class="hljs-comment">// æ•°æ®æ ¼å¼è½¬æ¢</span>
                    <span class="hljs-comment">// StockTV: { time: 1719818400000, open: 239.42, ... }</span>
                    <span class="hljs-comment">// KlineCharts: { timestamp: 1719818400000, open: 239.42, ... }</span>
                    <span class="hljs-keyword">const</span> klineData = stockData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
                        <span class="hljs-keyword">return</span> {
                            <span class="hljs-attr">timestamp</span>: item.<span class="hljs-property">time</span>, <span class="hljs-comment">// ç›´æ¥ä½¿ç”¨ API è¿”å›çš„æ—¶é—´æˆ³</span>
                            <span class="hljs-attr">open</span>: <span class="hljs-title class_">Number</span>(item.<span class="hljs-property">open</span>),
                            <span class="hljs-attr">high</span>: <span class="hljs-title class_">Number</span>(item.<span class="hljs-property">high</span>),
                            <span class="hljs-attr">low</span>: <span class="hljs-title class_">Number</span>(item.<span class="hljs-property">low</span>),
                            <span class="hljs-attr">close</span>: <span class="hljs-title class_">Number</span>(item.<span class="hljs-property">close</span>),
                            <span class="hljs-attr">volume</span>: <span class="hljs-title class_">Number</span>(item.<span class="hljs-property">volume</span>)
                        };
                    });

                    <span class="hljs-comment">// ç¡®ä¿æŒ‰æ—¶é—´å‡åºæ’åº</span>
                    klineData.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.<span class="hljs-property">timestamp</span> - b.<span class="hljs-property">timestamp</span>);

                    <span class="hljs-comment">// æ¸²æŸ“æ•°æ®</span>
                    chart.<span class="hljs-title function_">applyNewData</span>(klineData);
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å›¾è¡¨æ¸²æŸ“æˆåŠŸï¼Œæ•°æ®æ¡æ•°:"</span>, klineData.<span class="hljs-property">length</span>);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"API é”™è¯¯:"</span>, resJson);
                    <span class="hljs-title function_">alert</span>(<span class="hljs-string">"æ¥å£æŠ¥é”™: "</span> + resJson.<span class="hljs-property">message</span>);
                }

            } <span class="hljs-keyword">catch</span> (err) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"è¯·æ±‚å¤±è´¥:"</span>, err);
                <span class="hljs-title function_">alert</span>(<span class="hljs-string">"ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å° (F12)"</span>);
            }
        }

        <span class="hljs-comment">// çª—å£å¤§å°è°ƒæ•´æ—¶è‡ªåŠ¨è°ƒæ•´å›¾è¡¨</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-function">() =&gt;</span> {
            chart.<span class="hljs-title function_">resize</span>();
        });
        
        <span class="hljs-comment">// é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å°è¯•åŠ è½½ä¸€æ¬¡ï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰</span>
        <span class="hljs-comment">// å¦‚æœæ‚¨æœ‰ç¡®å®šçš„æ—¥æœ¬è‚¡ç¥¨PIDï¼Œå¯ä»¥åœ¨ input çš„ value ä¸­é¢„è®¾</span>
        <span class="hljs-comment">// loadChartData(); </span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">å…³é”®ç‚¹è¯´æ˜</h3>
<ol>
<li>
<p><strong>CountryId=35 çš„ä½¿ç”¨</strong>ï¼š</p>
<ul>
<li><code>countryId=35</code> ä¸»è¦ç”¨äº<strong>æŸ¥è¯¢åˆ—è¡¨</strong> (<code>/stock/stocks</code>) é˜¶æ®µï¼Œç”¨äºç­›é€‰å‡ºæ—¥æœ¬å¸‚åœºçš„è‚¡ç¥¨åŠå…¶å¯¹åº”çš„ PIDã€‚</li>
<li>ä¸€æ—¦æ‹¿åˆ° PIDï¼Œåœ¨è¯·æ±‚ K çº¿æ•°æ® (<code>/stock/kline</code>) æ—¶ï¼Œåªéœ€è¦ PIDï¼Œ<strong>ä¸éœ€è¦</strong>å†ä¼  countryIdã€‚</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®æ˜ å°„ (Mapping)</strong>ï¼š</p>
<ul>
<li>StockTV è¿”å›çš„å­—æ®µæ˜¯ <code>time</code>, <code>open</code>, <code>high</code>, <code>low</code>, <code>close</code>, <code>volume</code>ã€‚</li>
<li>KlineCharts è¦æ±‚çš„å­—æ®µæ˜¯ <code>timestamp</code>, <code>open</code>, <code>high</code>, <code>low</code>, <code>close</code>, <code>volume</code>ã€‚</li>
<li>ä»£ç ä¸­ <code>timestamp: item.time</code> è¿™ä¸€è¡Œå®Œæˆäº†å…³é”®çš„è½¬æ¢ã€‚</li>
</ul>
</li>
<li>
<p><strong>å‘¨æœŸæ ¼å¼</strong>ï¼š</p>
<ul>
<li>è¯·ç¡®ä¿ä¼ ç»™ API çš„ <code>interval</code> å‚æ•°æ˜¯ <code>P1D</code> (æ—¥), <code>PT1H</code> (æ—¶) ç­‰ ISO8601 æ ¼å¼ï¼Œå¦åˆ™ API å¯èƒ½ä¼šæŠ¥é”™æˆ–è¿”å›ç©ºæ•°æ®ã€‚</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é»‘é©¬å–½å¤§é—¹å¤©å®«ä¸JavaScriptçš„å¯»äº²è®°ï¼šä½œç”¨åŸŸä¸ä½œç”¨åŸŸé“¾å…¨è§£æ]]></title>    <link>https://juejin.cn/post/7577594229413756947</link>    <guid>https://juejin.cn/post/7577594229413756947</guid>    <pubDate>2025-11-28T09:34:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577594229413756947" data-draft-id="7577574644694564900" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é»‘é©¬å–½å¤§é—¹å¤©å®«ä¸JavaScriptçš„å¯»äº²è®°ï¼šä½œç”¨åŸŸä¸ä½œç”¨åŸŸé“¾å…¨è§£æ"/> <meta itemprop="keywords" content="JavaScript,é¢è¯•,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-28T09:34:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AY1024"/> <meta itemprop="url" content="https://juejin.cn/user/2232439936132313"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é»‘é©¬å–½å¤§é—¹å¤©å®«ä¸JavaScriptçš„å¯»äº²è®°ï¼šä½œç”¨åŸŸä¸ä½œç”¨åŸŸé“¾å…¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2232439936132313/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AY1024
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:34:10.000Z" title="Fri Nov 28 2025 09:34:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é»‘é©¬å–½å¤§é—¹å¤©å®«ä¸JavaScriptçš„å¯»äº²è®°ï¼šä½œç”¨åŸŸä¸ä½œç”¨åŸŸé“¾å…¨è§£æ</h2>
<blockquote>
<p><strong>å¼€åœºç™½</strong>ï¼šä¸€ä¸ªå˜é‡çš„"æ— æ³•æ— å¤©"ä¸å®ƒçš„"å¯»äº²ä¹‹è·¯"</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">ğŸ“– ç¬¬ä¸€ç« ï¼šé»‘é©¬å–½çš„åš£å¼ å²æœˆ</h3>
<p>è¯è¯´åœ¨å‰ç«¯æ±Ÿæ¹–çš„ES5æ—¶ä»£ï¼Œæœ‰ä¸ªå«<code>var</code>çš„é»‘é©¬å–½ï¼Œè¿™å®¶ä¼™ç®€ç›´æ— æ³•æ— å¤©ï¼å®ƒæƒ³æ¥å°±æ¥ï¼Œæƒ³èµ°å°±èµ°ï¼Œå®Œå…¨ä¸é¡¾ä»€ä¹ˆå—çº§ä½œç”¨åŸŸçš„è§„çŸ©ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½ ä»¬çœ‹çœ‹è¿™é»‘é©¬å–½çš„å¾·è¡Œ</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i); <span class="hljs-comment">// ä½ çŒœè¾“å‡ºå•¥ï¼Ÿ3,3,3ï¼</span>
    }, <span class="hljs-number">100</span>);
}
<span class="hljs-comment">// å¾ªç¯ç»“æŸäº†ï¼Œiè¿˜åœ¨å¤–é¢æ™ƒè¡</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i); <span class="hljs-comment">// 3ï¼Œç§ç§ï¼Œè·‘å‡ºæ¥äº†å§ï¼</span>
</code></pre>
<p>ä½†ä»Šå¤©å’±ä»¬ä¸ä»…è¦æ‰’ä¸€æ‰’<code>var</code>çš„åº•è£¤ï¼Œè¿˜è¦è®²è®²å˜é‡ä»¬æ˜¯æ€ä¹ˆ"å¯»äº²"çš„â€”â€”è¿™å°±æ˜¯<strong>ä½œç”¨åŸŸ</strong>å’Œ<strong>ä½œç”¨åŸŸé“¾</strong>çš„æ•…äº‹ã€‚</p>
<hr/>
<h3 data-id="heading-2">ğŸ”§ ç¬¬äºŒç« ï¼šç¼–è¯‘å™¨çš„ä¸‰æŠŠæ–§â€”â€”ä»£ç çš„"æ¢³å¦†æ‰“æ‰®"</h3>
<p>è¦è¯´æ¸…æ¥šä½œç”¨åŸŸï¼Œå¾—å…ˆä»JavaScriptçš„ç¼–è¯‘è¯´èµ·ã€‚åˆ«çœ‹JSæ˜¯è§£é‡Šå‹è¯­è¨€ï¼Œå®ƒåœ¨æ‰§è¡Œå‰ä¹Ÿè¦ç»å†ä¸€ç•ª"æ¢³å¦†æ‰“æ‰®"ã€‚</p>
<h4 data-id="heading-3">2.1 è¯æ³•åˆ†æï¼šæ‹†è§£å­—ç¬¦ä¸²çš„é­”æœ¯</h4>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œç¼–è¯‘å™¨å°±åƒä¸ªè®¤çœŸçš„è¯­æ–‡è€å¸ˆï¼ŒæŠŠä»£ç è¿™ä¸ªé•¿å¥å­æ‹†æˆä¸€ä¸ªä¸ªæœ‰æ„ä¹‰çš„è¯è¯­ï¼š</p>
<p><code>var a = 1</code> â†’ <code>var</code>ã€<code>a</code>ã€<code>=</code>ã€<code>1</code></p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šç©ºæ ¼è¦ä¸è¦æ‹†å¼€ï¼Œå¾—çœ‹å®ƒæœ‰æ²¡æœ‰ç”¨ã€‚å°±åƒè¯»ä¹¦æ—¶è¦ä¸è¦åœé¡¿ï¼Œå¾—çœ‹è¯­æ°”ï¼</p>
</blockquote>
<h4 data-id="heading-4">2.2 è¯­æ³•åˆ†æï¼šæ„å»ºå®¶è°±æ ‘</h4>
<p>æ‹†å®Œè¯ä¹‹åï¼Œç¼–è¯‘å™¨å¼€å§‹ç†æ¸…å…³ç³»â€”â€”è°å£°æ˜äº†è°ï¼Œè°èµ‹å€¼ç»™è°ï¼Œæœ€åç”Ÿæˆä¸€æ£µ<strong>æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰</strong>ã€‚</p>
<p>è¿™å°±åƒæŠŠä¸€å †é›¶æ•£çš„å®¶åº­æˆå‘˜ä¿¡æ¯ï¼Œæ•´ç†æˆæ¸…æ™°çš„å®¶è°±ã€‚</p>
<h4 data-id="heading-5">2.3 ä»£ç ç”Ÿæˆï¼šå‡†å¤‡æ‰§è¡Œ</h4>
<p>æœ€åï¼Œç¼–è¯‘å™¨æŠŠå®¶è°±æ ‘è½¬æ¢æˆæœºå™¨èƒ½æ‡‚çš„æŒ‡ä»¤ï¼Œå‡†å¤‡æ‰§è¡Œã€‚</p>
<blockquote>
<p><strong>å…³é”®ç‚¹</strong>ï¼šJSçš„ç¼–è¯‘å‘ç”Ÿåœ¨ä»£ç æ‰§è¡Œå‰çš„ä¸€ç¬é—´ï¼Œå¿«åˆ°ä½ å‡ ä¹æ„Ÿè§‰ä¸åˆ°ï¼</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">ğŸ’• ç¬¬ä¸‰ç« ï¼šå˜é‡èµ‹å€¼çš„ä¸‰è§’æ‹</h3>
<p><code>var a = 1</code>è¿™ä¹ˆç®€å•çš„ä¸€è¡Œä»£ç ï¼ŒèƒŒåå±…ç„¶ä¸Šæ¼”ç€ä¸€åœº"ä¸‰è§’æ‹"ï¼š</p>
<ul>
<li>ğŸ¯ <strong>ç¼–è¯‘å™¨</strong>ï¼šå¹²è„æ´»ç´¯æ´»çš„åª’äººï¼Œè´Ÿè´£è§£æå’Œç‰µçº¿</li>
<li>âš¡ <strong>JSå¼•æ“</strong>ï¼šæ‰§è¡Œå…·ä½“åŠ¨ä½œçš„æ–°éƒ</li>
<li>ğŸ  <strong>ä½œç”¨åŸŸ</strong>ï¼šç®¡ç†å®¾å®¢åå•çš„ç®¡å®¶</li>
</ul>
<h4 data-id="heading-7">3.1 è®¢å©šä»ªå¼ï¼ˆç¼–è¯‘é˜¶æ®µï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å½“çœ‹åˆ° var a = 1;</span>
ç¼–è¯‘å™¨ï¼šç®¡å®¶ï¼Œå’±ä»¬è¿™æœ‰å«açš„å˜é‡å—ï¼Ÿ
ä½œç”¨åŸŸï¼šå›å¤§äººï¼Œè¿˜æ²¡æœ‰ã€‚
ç¼–è¯‘å™¨ï¼šé‚£å°±åœ¨å½“å‰åœºåˆå£°æ˜ä¸€ä¸ªaï¼
</code></pre>
<h4 data-id="heading-8">3.2 ç»“å©šå…¸ç¤¼ï¼ˆæ‰§è¡Œé˜¶æ®µï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable constant_">JS</span>å¼•æ“ï¼šç®¡å®¶ï¼Œæˆ‘è¦æ‰¾aè¿™ä¸ªäººèµ‹å€¼ï¼
ä½œç”¨åŸŸï¼šå¤§äººè¯·ï¼Œaå°±åœ¨è¿™å„¿ã€‚
<span class="hljs-variable constant_">JS</span>å¼•æ“ï¼šå¥½ï¼ŒæŠŠ<span class="hljs-number">1</span>èµ‹ç»™aï¼
</code></pre>
<p>è¿™é‡Œæ¶‰åŠåˆ°ä¸¤ç§æŸ¥æ‰¾æ–¹å¼ï¼š</p>
<p><strong>LHSæŸ¥è¯¢</strong>ï¼šæ‰¾å®¹å™¨ï¼ˆæ‰¾æ–°å¨˜ï¼‰</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>; <span class="hljs-comment">// æ‰¾åˆ°aè¿™ä¸ªå®¹å™¨è£…1</span>
</code></pre>
<p><strong>RHSæŸ¥è¯¢</strong>ï¼šæ‰¾æºå¤´ï¼ˆæ‰¾æ–°å¨˜çš„å¨˜å®¶ï¼‰</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a); <span class="hljs-comment">// æ‰¾åˆ°açš„å€¼</span>
<span class="hljs-title function_">foo</span>();         <span class="hljs-comment">// æ‰¾åˆ°fooå‡½æ•°æœ¬èº«</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71a4f3b46fa64f48bb399fa6efd0cb04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQVkxMDI0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764927250&amp;x-signature=p1MMNYSFmR47TG%2FZWqGIc1Dntik%3D" alt="ç¼–è¯‘è¿‡ç¨‹ç¤ºæ„å›¾" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-9">ğŸ’ ç¬¬å››ç« ï¼šé»‘é©¬å–½çš„ç½ªè¯å±•ç¤º</h3>
<p>åœ¨ES5æ—¶ä»£ï¼Œ<code>var</code>è¿™å®¶ä¼™çœŸæ˜¯ç›®ä¸­æ— äººï¼š</p>
<h4 data-id="heading-10">4.1 æ— è§†å—çº§ä½œç”¨åŸŸ</h4>
<pre><code class="hljs language-javascript" lang="javascript">{
    <span class="hljs-keyword">var</span> rogue = <span class="hljs-string">"æˆ‘æ˜¯é»‘é©¬å–½ï¼Œæˆ‘æƒ³å»å“ªå°±å»å“ª"</span>;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(rogue); <span class="hljs-comment">// ç…§æ ·èƒ½è®¿é—®ï¼</span>
</code></pre>
<h4 data-id="heading-11">4.2 å˜é‡æå‡çš„è¯¡è®¡</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(naughty); <span class="hljs-comment">// undefinedï¼Œè€Œä¸æ˜¯æŠ¥é”™ï¼</span>
<span class="hljs-keyword">var</span> naughty = <span class="hljs-string">"æˆ‘æå‡äº†"</span>;
</code></pre>
<p>è¿™è´§ç›¸å½“äºï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> naughty;          <span class="hljs-comment">// å£°æ˜æå‡åˆ°é¡¶éƒ¨</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(naughty); <span class="hljs-comment">// undefined</span>
naughty = <span class="hljs-string">"æˆ‘æå‡äº†"</span>; <span class="hljs-comment">// èµ‹å€¼ç•™åœ¨åŸåœ°</span>
</code></pre>
<hr/>
<h3 data-id="heading-12">ğŸ™ ç¬¬äº”ç« ï¼šå¦‚æ¥ä½›ç¥–çš„äº”æŒ‡å±±â€”â€”letå’Œconst</h3>
<p>ES6æ—¶ä»£ï¼Œå¦‚æ¥ä½›ç¥–ï¼ˆTC39å§”å‘˜ä¼šï¼‰çœ‹ä¸ä¸‹å»äº†ï¼Œæ´¾å‡ºäº†<code>let</code>å’Œ<code>const</code>ä¸¤ä½å¤§ç¥ï¼š</p>
<h4 data-id="heading-13">5.1 å—çº§ä½œç”¨åŸŸçš„ç´§ç®å’’</h4>
<pre><code class="hljs language-javascript" lang="javascript">{
    <span class="hljs-keyword">let</span> disciplined = <span class="hljs-string">"æˆ‘åœ¨å—é‡Œé¢å¾ˆè€å®"</span>;
    <span class="hljs-keyword">const</span> wellBehaved = <span class="hljs-string">"æˆ‘ä¹Ÿæ˜¯å¥½å­©å­"</span>;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(disciplined); <span class="hljs-comment">// ReferenceErrorï¼å‡ºä¸æ¥å’¯</span>
</code></pre>
<h4 data-id="heading-14">5.2 æš‚æ—¶æ€§æ­»åŒºçš„é™å¦–é˜µ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(rebel); <span class="hljs-comment">// ReferenceErrorï¼æ­¤è·¯ä¸é€š</span>
<span class="hljs-keyword">let</span> rebel = <span class="hljs-string">"æƒ³æå‡ï¼Ÿæ²¡é—¨ï¼"</span>;
</code></pre>
<blockquote>
<p><strong>çœŸç›¸</strong>ï¼š<code>let/const</code>å…¶å®ä¹Ÿä¼šæå‡ï¼Œä½†æ˜¯è¢«å…³è¿›äº†"æš‚æ—¶æ€§æ­»åŒº"è¿™ä¸ªäº”æŒ‡å±±é‡Œï¼Œåœ¨å£°æ˜å‰è°éƒ½åˆ«æƒ³è®¿é—®ï¼</p>
</blockquote>
<hr/>
<h3 data-id="heading-15">ğŸ§© ç¬¬å…­ç« ï¼šé»‘é©¬å–½çš„è¿·æƒ‘è¡Œä¸ºâ€”â€”è¯æ³•ä½œç”¨åŸŸçš„çœŸç›¸</h3>
<h4 data-id="heading-16">6.1 ä¸€ä¸ªè®©é»‘é©¬å–½å›°æƒ‘çš„ä¾‹å­</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"/>){
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>( myName);  <span class="hljs-comment">// é»‘é©¬å–½ï¼šè¿™é‡Œè¯¥è¾“å‡ºå•¥ï¼Ÿ</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>){
    <span class="hljs-keyword">var</span> myName = <span class="hljs-string">"ç™½å—å–½"</span>;
    <span class="hljs-title function_">bar</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"1:"</span>, myName)   <span class="hljs-comment">// è¿™ä¸ªæˆ‘æ‡‚ï¼Œè¾“å‡º"ç™½å—å–½"</span>
}

<span class="hljs-keyword">var</span> myName = <span class="hljs-string">"é»‘å—å–½"</span>;
<span class="hljs-title function_">foo</span>()  <span class="hljs-comment">// è¾“å‡ºï¼š"é»‘å—å–½","ç™½å—å–½"</span>
</code></pre>
<p>é»‘é©¬å–½æŒ ç€å¤´æƒ³ï¼š"ä¸å¯¹å•Šï¼<code>bar()</code>åœ¨<code>foo()</code>é‡Œé¢è°ƒç”¨ï¼Œä¸æ˜¯åº”è¯¥æ‰¾åˆ°<code>foo()</code>é‡Œçš„<code>myName = "ç™½å—å–½"</code>å—ï¼Ÿæ€ä¹ˆä¼šæ˜¯<code>é»‘å—å–½</code>å‘¢ï¼Ÿ"</p>
<h4 data-id="heading-17">6.2 outeræŒ‡é’ˆï¼šå‡½æ•°çš„"èº«ä»½è¯"</h4>
<p>åŸæ¥ï¼Œåœ¨<strong>ç¼–è¯‘é˜¶æ®µ</strong>ï¼Œæ¯ä¸ªå‡½æ•°å°±å·²ç»ç¡®å®šäº†è‡ªå·±çš„"å¨˜å®¶"ï¼ˆè¯æ³•ä½œç”¨åŸŸï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç¼–è¯‘é˜¶æ®µå‘ç”Ÿçš„äº‹æƒ…ï¼š</span>
<span class="hljs-comment">// 1. barå‡½æ•°å‡ºç”Ÿï¼Œå®ƒçš„outeræŒ‡å‘å…¨å±€ä½œç”¨åŸŸï¼ˆå®ƒå£°æ˜åœ¨å…¨å±€ï¼‰</span>
<span class="hljs-comment">// 2. fooå‡½æ•°å‡ºç”Ÿï¼Œå®ƒçš„outerä¹ŸæŒ‡å‘å…¨å±€ä½œç”¨åŸŸï¼ˆå®ƒå£°æ˜åœ¨å…¨å±€ï¼‰</span>
<span class="hljs-comment">// 3. å˜é‡myNameå£°æ˜æå‡ï¼švar myName = "é»‘å—å–½"</span>

<span class="hljs-comment">// æ‰§è¡Œé˜¶æ®µï¼š</span>
<span class="hljs-keyword">var</span> myName = <span class="hljs-string">"é»‘å—å–½"</span>;  <span class="hljs-comment">// å…¨å±€myNameèµ‹å€¼ä¸º"é»‘å—å–½"</span>
<span class="hljs-title function_">foo</span>();                 <span class="hljs-comment">// è°ƒç”¨fooå‡½æ•°</span>
</code></pre>
<p><strong>é»‘é©¬å–½çš„é”™è¯¯ç†è§£</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">bar</span>() â†’ <span class="hljs-built_in">foo</span>() â†’ å…¨å±€
</code></pre>
<p><strong>å®é™…çš„ä½œç”¨åŸŸæŸ¥æ‰¾</strong>ï¼ˆæ ¹æ®outeræŒ‡é’ˆï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">bar</span>() â†’ å…¨å±€
</code></pre>
<p><strong>å¦‚å›¾</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f47f377172d45a88cbf8e0afb4d57bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQVkxMDI0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764927250&amp;x-signature=MzVspWzc%2FzaTC3NgQAzj8%2BbcSEU%3D" alt="C9AE3D8E-F1DA-4767-AE87-AF4B1AF8B94D.png" loading="lazy"/></p>
<h4 data-id="heading-18">6.3 è¯æ³•ä½œç”¨åŸŸ vs åŠ¨æ€ä½œç”¨åŸŸ</h4>
<p><strong>è¯æ³•ä½œç”¨åŸŸï¼ˆJavaScriptï¼‰</strong>ï¼šçœ‹å‡ºç”Ÿåœ°</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> hero = <span class="hljs-string">"å…¨å±€è‹±é›„"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createWarrior</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> hero = <span class="hljs-string">"éƒ¨è½å‹‡å£«"</span>;
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">fight</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hero); <span class="hljs-comment">// æ°¸è¿œè¾“å‡º"éƒ¨è½å‹‡å£«"</span>
    }
    
    <span class="hljs-keyword">return</span> fight;
}

<span class="hljs-keyword">const</span> warrior = <span class="hljs-title function_">createWarrior</span>();
<span class="hljs-title function_">warrior</span>(); <span class="hljs-comment">// "éƒ¨è½å‹‡å£«" - è®°å¾—å‡ºç”Ÿæ—¶çš„ç¯å¢ƒ</span>
</code></pre>
<p><strong>åŠ¨æ€ä½œç”¨åŸŸ</strong>ï¼šçœ‹è°ƒç”¨åœ°ï¼ˆJavaScriptä¸æ˜¯è¿™æ ·ï¼ï¼‰</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‡è®¾JavaScriptæ˜¯åŠ¨æ€ä½œç”¨åŸŸï¼ˆå®é™…ä¸Šä¸æ˜¯ï¼ï¼‰</span>
<span class="hljs-keyword">var</span> hero = <span class="hljs-string">"æˆ˜åœºè‹±é›„"</span>;
<span class="hljs-keyword">const</span> warrior = <span class="hljs-title function_">createWarrior</span>();
<span class="hljs-title function_">warrior</span>(); <span class="hljs-comment">// å¦‚æœæ˜¯åŠ¨æ€ä½œç”¨åŸŸï¼Œä¼šè¾“å‡º"æˆ˜åœºè‹±é›„"</span>
</code></pre>
<hr/>
<h3 data-id="heading-19">ğŸ—ºï¸ ç¬¬ä¸ƒç« ï¼šä½œç”¨åŸŸé“¾â€”â€”å˜é‡çš„å¯»äº²è·¯çº¿å›¾</h3>
<h4 data-id="heading-20">7.1 æ¯ä¸ªå‡½æ•°éƒ½å¸¦ç€"å‡ºç”Ÿè¯æ˜"</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> grandma = <span class="hljs-string">"å¥¶å¥¶çš„ç³–æœ"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">mom</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> momCookie = <span class="hljs-string">"å¦ˆå¦ˆçš„é¥¼å¹²"</span>;
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">me</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">var</span> myCandy = <span class="hljs-string">"æˆ‘çš„æ£’æ£’ç³–"</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myCandy);    <span class="hljs-comment">// è‡ªå·±å£è¢‹æ‰¾</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(momCookie);  <span class="hljs-comment">// outeræŒ‡å‘mom</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(grandma);    <span class="hljs-comment">// outerçš„outeræŒ‡å‘å…¨å±€</span>
    }
    
    <span class="hljs-title function_">me</span>();
}

<span class="hljs-title function_">mom</span>();
</code></pre>
<h4 data-id="heading-21">7.2 ä½œç”¨åŸŸé“¾çš„å»ºé€ è¿‡ç¨‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…¨å±€ä½œç”¨åŸŸ</span>
<span class="hljs-keyword">var</span> city = <span class="hljs-string">"åŒ—äº¬"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildDistrict</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> district = <span class="hljs-string">"æœé˜³åŒº"</span>;
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">buildStreet</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">var</span> street = <span class="hljs-string">"ä¸‰é‡Œå±¯"</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(street);     <span class="hljs-comment">// è‡ªå·±çš„</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(district);   <span class="hljs-comment">// outeræŒ‡å‘buildDistrict</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(city);       <span class="hljs-comment">// outerçš„outeræŒ‡å‘å…¨å±€</span>
    }
    
    <span class="hljs-keyword">return</span> buildStreet;
}

<span class="hljs-comment">// ç¼–è¯‘é˜¶æ®µå°±ç¡®å®šçš„å…³ç³»ï¼š</span>
<span class="hljs-comment">// buildStreet.outer = buildDistrictä½œç”¨åŸŸ</span>
<span class="hljs-comment">// buildDistrict.outer = å…¨å±€ä½œç”¨åŸŸ</span>
</code></pre>
<p><strong>å¦‚å›¾</strong></p>
<h3 data-id="heading-22"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e445d8934c22499490df1d1877e882c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQVkxMDI0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764927250&amp;x-signature=T%2B2q%2FNyHnis5DpnyCJ6SXTeceIk%3D" alt="9625B41F-066C-4BD2-AF8B-44B93C395CF9.png" loading="lazy"/></h3>
<h3 data-id="heading-23">âš”ï¸ ç¬¬å…«ç« ï¼šä½œç”¨åŸŸé“¾çš„å®æˆ˜å…µæ³•</h3>
<h4 data-id="heading-24">8.1 å…µæ³•ä¸€ï¼šæ¨¡å—åŒ–å¼€å‘</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCounter</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>; <span class="hljs-comment">// ç§æœ‰å˜é‡ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®</span>
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">increment</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            count++; <span class="hljs-comment">// é—­åŒ…ï¼šouteræŒ‡å‘createCounterä½œç”¨åŸŸ</span>
            <span class="hljs-keyword">return</span> count;
        },
        <span class="hljs-attr">getValue</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">return</span> count;
        }
    };
}

<span class="hljs-keyword">const</span> counter = <span class="hljs-title function_">createCounter</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter.<span class="hljs-title function_">increment</span>()); <span class="hljs-comment">// 1</span>
<span class="hljs-comment">// console.log(count); // æŠ¥é”™ï¼countæ˜¯ç§æœ‰çš„</span>
</code></pre>
<h4 data-id="heading-25">8.2 å…µæ³•äºŒï¼šè§£å†³å¾ªç¯é™·é˜±</h4>
<h5 data-id="heading-26">é»‘é©¬å–½çš„å‘</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i); <span class="hljs-comment">// 3, 3, 3 - æ‰€æœ‰å‡½æ•°å…±äº«åŒä¸€ä¸ªi</span>
    }, <span class="hljs-number">100</span>);
}
</code></pre>
<h5 data-id="heading-27">ä½œç”¨åŸŸé“¾çš„æ•‘èµ</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ–¹æ³•1ï¼šä½¿ç”¨letåˆ›å»ºå—çº§ä½œç”¨åŸŸ</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i); <span class="hljs-comment">// 0, 1, 2 - æ¯ä¸ªiéƒ½æœ‰è‡ªå·±çš„ä½œç”¨åŸŸ</span>
    }, <span class="hljs-number">100</span>);
}

<span class="hljs-comment">// æ–¹æ³•2ï¼šIIFEåˆ›å»ºæ–°ä½œç”¨åŸŸ</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    (<span class="hljs-keyword">function</span>(<span class="hljs-params">j</span>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(j); <span class="hljs-comment">// 0, 1, 2 - jåœ¨IIFEä½œç”¨åŸŸä¸­</span>
        }, <span class="hljs-number">100</span>);
    })(i);
}
</code></pre>
<h4 data-id="heading-28">8.3 å…µæ³•ä¸‰ï¼šæ­£ç¡®çš„å‡½æ•°åµŒå¥—</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>){
    <span class="hljs-keyword">var</span> myName = <span class="hljs-string">"yang"</span>;
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"/>){  <span class="hljs-comment">// ç°åœ¨barçš„outeræŒ‡å‘fooäº†ï¼</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"2:"</span>, myName);  <span class="hljs-comment">// æ‰¾åˆ°fooçš„myName</span>
    }
    
    <span class="hljs-title function_">bar</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"1:"</span>, myName)
}

<span class="hljs-keyword">var</span> myName = <span class="hljs-string">"yang1"</span>;
<span class="hljs-title function_">foo</span>()  <span class="hljs-comment">// è¾“å‡ºï¼š2: yang, 1: yang</span>
</code></pre>
<hr/>
<h3 data-id="heading-29">ğŸš€ ç¬¬ä¹ç« ï¼šç°ä»£JavaScriptçš„ä½œç”¨åŸŸä½“ç³»</h3>
<h4 data-id="heading-30">9.1 å—çº§ä½œç”¨åŸŸçš„ç²¾ç»†åŒ–ç®¡ç†</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">modernScope</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> functionScoped = <span class="hljs-string">"å‡½æ•°ä½œç”¨åŸŸ"</span>;
    <span class="hljs-keyword">let</span> blockScoped = <span class="hljs-string">"å—çº§ä½œç”¨åŸŸ"</span>;
    
    <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">let</span> innerLet = <span class="hljs-string">"å†…éƒ¨çš„let"</span>;
        <span class="hljs-keyword">var</span> innerVar = <span class="hljs-string">"å†…éƒ¨çš„var"</span>; <span class="hljs-comment">// ä¾ç„¶æå‡åˆ°å‡½æ•°é¡¶éƒ¨ï¼</span>
        
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(blockScoped); <span class="hljs-comment">// âœ… å¯ä»¥è®¿é—®å¤–å±‚çš„let</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(functionScoped); <span class="hljs-comment">// âœ… å¯ä»¥è®¿é—®å¤–å±‚çš„var</span>
    }
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(innerVar); <span class="hljs-comment">// âœ… å¯ä»¥è®¿é—®</span>
    <span class="hljs-comment">// console.log(innerLet); // âŒ æŠ¥é”™ï¼letæ˜¯å—çº§ä½œç”¨åŸŸ</span>
}
</code></pre>
<h4 data-id="heading-31">9.2 ä½œç”¨åŸŸé“¾çš„æ–°å±‚çº§</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…¨å±€ä½œç”¨åŸŸ</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">GLOBAL</span> = <span class="hljs-string">"åœ°çƒ"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">country</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å‡½æ•°ä½œç”¨åŸŸ</span>
    <span class="hljs-keyword">let</span> nationalLaw = <span class="hljs-string">"å›½å®¶æ³•å¾‹"</span>;
    
    {
        <span class="hljs-comment">// å—çº§ä½œç”¨åŸŸ1</span>
        <span class="hljs-keyword">let</span> provincialLaw = <span class="hljs-string">"çœæ³•è§„"</span>;
        
        <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// å—çº§ä½œç”¨åŸŸ2</span>
            <span class="hljs-keyword">let</span> cityRule = <span class="hljs-string">"å¸‚è§„å®š"</span>;
            
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cityRule);     <span class="hljs-comment">// âœ… æœ¬å¸‚æœ‰æ•ˆ</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(provincialLaw); <span class="hljs-comment">// âœ… æœ¬çœæœ‰æ•ˆ</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(nationalLaw);   <span class="hljs-comment">// âœ… å…¨å›½æœ‰æ•ˆ</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable constant_">GLOBAL</span>);        <span class="hljs-comment">// âœ… å…¨çƒæœ‰æ•ˆ</span>
        }
        
        <span class="hljs-comment">// console.log(cityRule); // âŒ è·¨å¸‚æ— æ•ˆ</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-32">âš¡ ç¬¬åç« ï¼šä½œç”¨åŸŸé“¾çš„æ€§èƒ½ä¸ä¼˜åŒ–</h3>
<h4 data-id="heading-33">10.1 ä½œç”¨åŸŸæŸ¥æ‰¾çš„ä»£ä»·</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> globalVar = <span class="hljs-string">"æˆ‘åœ¨æœ€å¤–å±‚"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">level3</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// è¿™ä¸ªæŸ¥æ‰¾è¦ç»è¿‡ï¼šè‡ªå·± â†’ level2 â†’ level1 â†’ å…¨å±€</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(globalVar);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">level2</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">level3</span>();
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">level1</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">level2</span>();
}
</code></pre>
<h4 data-id="heading-34">10.2 ä¼˜åŒ–å¿ƒæ³•</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">optimized</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> localCopy = globalVar; <span class="hljs-comment">// å±€éƒ¨ç¼“å­˜ï¼Œå‡å°‘æŸ¥æ‰¾æ·±åº¦</span>
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(localCopy); <span class="hljs-comment">// ç›´æ¥è®¿é—®ï¼Œå¿«é€Ÿï¼</span>
    }
    
    <span class="hljs-title function_">inner</span>();
}
</code></pre>
<hr/>
<h3 data-id="heading-35">ğŸ† å¤§ç»“å±€ï¼šé»‘é©¬å–½çš„æ¯•ä¸šæ€»ç»“</h3>
<p>ç»è¿‡è¿™ç•ªå­¦ä¹ ï¼Œé»‘é©¬å–½ç»ˆäºæ˜ç™½äº†ä½œç”¨åŸŸçš„çœŸè°›ï¼š</p>
<h4 data-id="heading-36">ğŸ¯ ä½œç”¨åŸŸçš„è¿›åŒ–å²</h4>
<ol>
<li><strong>ES5çš„æ··ä¹±</strong>ï¼š<code>var</code>æ— è§†å—çº§ä½œç”¨åŸŸï¼Œåˆ°å¤„æ£ä¹±</li>
<li><strong>ES6çš„ç§©åº</strong>ï¼š<code>let/const</code>å¼•å…¥å—çº§ä½œç”¨åŸŸå’Œæš‚æ—¶æ€§æ­»åŒº</li>
<li><strong>outeræŒ‡é’ˆæœºåˆ¶</strong>ï¼šè¯æ³•ä½œç”¨åŸŸåœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œä¸€è¾ˆå­ä¸å˜</li>
</ol>
<h4 data-id="heading-37">ğŸ§  ä½œç”¨åŸŸé“¾çš„ç²¾é«“</h4>
<ol>
<li><strong>outeræŒ‡é’ˆ</strong>ï¼šå‡½æ•°åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šäº†è‡ªå·±çš„"å¨˜å®¶"</li>
<li><strong>è¯æ³•ä½œç”¨åŸŸ</strong>ï¼šçœ‹å‡ºç”Ÿåœ°ï¼Œä¸æ˜¯çœ‹è°ƒç”¨åœ°</li>
<li><strong>å°±è¿‘åŸåˆ™</strong>ï¼šå…ˆæ‰¾è‡ªå·±ï¼Œå†æŒ‰outeræŒ‡é’ˆæ‰¾ä¸Šçº§</li>
<li><strong>é—­åŒ…çš„åŠ›é‡</strong>ï¼šå‡½æ•°æ°¸è¿œè®°å¾—è‡ªå·±å‡ºç”Ÿæ—¶çš„ç¯å¢ƒ</li>
</ol>
<h4 data-id="heading-38">ğŸ’¡ æœ€ä½³å®è·µå¿ƒæ³•</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¥½çš„ä½œç”¨åŸŸè®¾è®¡å°±åƒå¥½çš„å®¶é£</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createFamily</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å¤–å±‚ï¼šå®¶æ—ç§˜å¯†ï¼Œå†…éƒ¨å…±äº«</span>
    <span class="hljs-keyword">const</span> familySecret = <span class="hljs-string">"ä¼ å®¶å®"</span>;
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">teachChild</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// ä¸­å±‚ï¼šæ•™è‚²æ–¹æ³•</span>
        <span class="hljs-keyword">const</span> education = <span class="hljs-string">"ä¸¥æ ¼æ•™è‚²"</span>;
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">child</span>(<span class="hljs-params"/>) {
            <span class="hljs-comment">// å†…å±‚ï¼šä¸ªäººæˆé•¿</span>
            <span class="hljs-keyword">const</span> talent = <span class="hljs-string">"å¤©èµ‹å¼‚ç¦€"</span>;
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æˆ‘æœ‰<span class="hljs-subst">${talent}</span>ï¼Œæ¥å—<span class="hljs-subst">${education}</span>ï¼ŒçŸ¥é“<span class="hljs-subst">${familySecret}</span>`</span>);
        };
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">teachChild</span>();
}

<span class="hljs-keyword">const</span> familyMember = <span class="hljs-title function_">createFamily</span>();
<span class="hljs-title function_">familyMember</span>(); <span class="hljs-comment">// å³ä½¿ç‹¬ç«‹ç”Ÿæ´»ï¼Œä¾ç„¶è®°å¾—å®¶æ—ä¼ æ‰¿</span>
</code></pre>
<h3 data-id="heading-39">ğŸŒŸ ç»ˆæå¥¥ä¹‰</h3>
<p>é»‘é©¬å–½æ„Ÿæ…¨åœ°æ€»ç»“é“ï¼š</p>
<blockquote>
<p>"åŸæ¥JavaScriptçš„ä½œç”¨åŸŸå°±åƒè¡€ç¼˜å…³ç³»ï¼š</p>
<ul>
<li><strong>ä½œç”¨åŸŸ</strong>æ˜¯å®¶è§„ï¼ˆåœ¨å“ªé‡Œèƒ½æ´»åŠ¨ï¼‰</li>
<li><strong>ä½œç”¨åŸŸé“¾</strong>æ˜¯æ—è°±ï¼ˆæ€ä¹ˆæ‰¾åˆ°ç¥–å…ˆï¼‰</li>
<li><strong>outeræŒ‡é’ˆ</strong>æ˜¯å‡ºç”Ÿè¯æ˜ï¼ˆä¸€è¾ˆå­ä¸å˜ï¼‰</li>
<li><strong>è¯æ³•ä½œç”¨åŸŸ</strong>æ˜¯å®¶æ—ä¼ æ‰¿ï¼ˆçœ‹å‡ºç”Ÿåœ°ï¼Œä¸æ˜¯çœ‹ç°ä½åœ°ï¼‰"</li>
</ul>
</blockquote>
<p>ä»æ­¤ï¼Œé»‘é©¬å–½æ˜ç™½äº†ï¼šæƒ³è¦åœ¨å‰ç«¯æ±Ÿæ¹–æ··å¾—å¥½ï¼Œå°±è¦éµå®ˆä½œç”¨åŸŸçš„å®¶è§„ï¼Œç†è§£ä½œç”¨åŸŸé“¾çš„æ—è°±ï¼Œå°Šé‡outeræŒ‡é’ˆçš„å‡ºç”Ÿè¯æ˜ï¼</p>
<hr/>
<p><em>ğŸ’ é»‘é©¬å–½å¯„è¯­ï¼šè®°ä½ï¼Œå‡½æ•°çš„ä½œç”¨åŸŸæ˜¯å®ƒçš„"å¨˜å®¶"ï¼Œç¼–è¯‘æ—¶å®šäº²ï¼Œä¸€è¾ˆå­ä¸å˜ï¼ç†è§£äº†è¿™å¥—è§„åˆ™ï¼Œä½ å°±èƒ½é©¯æœä»»ä½•JavaScriptä»£ç ï¼</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ’­æ”¾å™¨æœ€æ€•â€œé¦–å¸§é»‘å±â€ï¼Ÿæˆ‘ç»™ LibreTV åŠ äº†ä¸€å¥—ç¼“å†²ä¸é¢„åŠ è½½ç­–ç•¥]]></title>    <link>https://juejin.cn/post/7577438119559036979</link>    <guid>https://juejin.cn/post/7577438119559036979</guid>    <pubDate>2025-11-28T09:30:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577438119559036979" data-draft-id="7577599299598696499" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ’­æ”¾å™¨æœ€æ€•â€œé¦–å¸§é»‘å±â€ï¼Ÿæˆ‘ç»™ LibreTV åŠ äº†ä¸€å¥—ç¼“å†²ä¸é¢„åŠ è½½ç­–ç•¥"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-28T09:30:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜æˆ‘çš„é‡‘"/> <meta itemprop="url" content="https://juejin.cn/user/1880601465463385"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ’­æ”¾å™¨æœ€æ€•â€œé¦–å¸§é»‘å±â€ï¼Ÿæˆ‘ç»™ LibreTV åŠ äº†ä¸€å¥—ç¼“å†²ä¸é¢„åŠ è½½ç­–ç•¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1880601465463385/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜æˆ‘çš„é‡‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:30:04.000Z" title="Fri Nov 28 2025 09:30:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>â€œé¦–å¸§é»‘å±ä¸‰ç§’ï¼Œæˆ‘å°±é»˜è®¤è¿™æ’­æ”¾å™¨å‡‰äº†ã€‚â€</strong></p>
<p>å…è´¹æºç»™äººçš„å°è±¡å¸¸å¸¸æ˜¯â€œéšç¼˜æ’­æ”¾â€ã€‚æˆ‘å¸Œæœ›è‡³å°‘èƒ½åšåˆ°ï¼šå½“ç”¨æˆ·ç‚¹æ’­æ”¾æŒ‰é’®æ—¶ï¼Œæ’­æ”¾å™¨åœ¨å°å‰å°åéƒ½è¦å¿™èµ·æ¥ï¼šæ™šé«˜å³°æºæ…¢ï¼Ÿå…ˆç¼“å­˜æ’­æ”¾ URLï¼›å‰§é›†å¤šï¼Ÿå…ˆæ¢æµ‹å¯æ’­é¡¹ï¼›æ€•è·³è½¬å¤±è´¥ï¼Ÿå¸¦ä¸Šé¢„åŠ è½½ç­–ç•¥ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘å…·ä½“åšäº†ä»€ä¹ˆã€‚</p>
<p>æˆ‘ç»™è‡ªå·±å®šäº†å‡ ä¸ªä»»åŠ¡ï¼š</p>
<ol>
<li>ç‚¹å‡»æ’­æ”¾é‚£ä¸€åˆ»å°±é”å®šå‰§é›†ã€API ä¿¡æ¯ï¼Œé¿å…é‡å¤è¯·æ±‚ï¼›</li>
<li>å¦‚æœæ˜¯å¤šæºï¼Œå¿«é€Ÿæ£€æŸ¥å¯æ’­æ”¾ URLï¼Œå¤±è´¥å°±è‡ªåŠ¨åˆ‡æ¢ï¼›</li>
<li>åœ¨ PlayerActivity é‡Œä¿è¯é¦–å¸§å°½å¿«å‡ºç°â€”â€”åŒ…æ‹¬é¢„åŠ è½½ä¸ç¼“å­˜ fallbackã€‚</li>
</ol>
<p>ä¸ºè¾¾æˆè¿™äº›ç›®æ ‡ï¼Œéœ€è¦åœ¨æ’­æ”¾å™¨å…¥å£å’Œ PlayerActivity ä¸¤ä¾§åŠ¨æ‰‹æœ¯ã€‚</p>
<hr/>
<h2 data-id="heading-0">æœç´¢é˜¶æ®µï¼šæå‰ç¡®è®¤å¯æ’­ URL</h2>
<p>å½“ç”¨æˆ·åœ¨ SearchActivity ç‚¹å‡»å‰§é›†æ—¶ï¼Œæˆ‘ä¼šå³æ—¶æ‹‰å–è¯¦æƒ…ï¼Œè§£æ episodeï¼Œå¹¶ä¸”æ ¹æ®æºç±»å‹å†³å®šå±•ç¤ºæ–¹å¼ã€‚å…³é”®æ˜¯ <code>handleVideoSelection()</code> é‡Œï¼Œåœ¨ç¡®å®šè¦æ’­æ”¾ä¹‹å‰ï¼Œå°±æŠŠ <code>detail.vodId / sourceCode / apiUrl</code> æºå¸¦åœ¨ Intent é‡Œã€‚<br/>
åŒæ—¶ï¼Œå¦‚æœå‰§é›†åªæœ‰ä¸€é›†æˆ–ç”µå½±ï¼Œå°±ç›´æ¥å†³å®š <code>firstEpisode</code>ï¼Œå…å¾—è¿›å…¥ PlayerActivity å†å»çŒœã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> intent = Intent(<span class="hljs-keyword">this</span>, PlayerActivity::<span class="hljs-keyword">class</span>.java).apply {
    putExtra(<span class="hljs-string">"VIDEO_ID"</span>, detail.vodId)
    putExtra(<span class="hljs-string">"VIDEO_TITLE"</span>, detail.vodName)
    putExtra(<span class="hljs-string">"EPISODE_NAME"</span>, firstEpisode.name)
    putExtra(<span class="hljs-string">"EPISODE_URL"</span>, firstEpisode.url)
    putExtra(<span class="hljs-string">"EPISODE_INDEX"</span>, <span class="hljs-number">0</span>)
    putExtra(<span class="hljs-string">"SOURCE_CODE"</span>, detail.sourceCode)
    putExtra(<span class="hljs-string">"SOURCE_NAME"</span>, detail.sourceName)
    putExtra(<span class="hljs-string">"API_URL"</span>, detail.apiUrl)
}
</code></pre>
<p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼ŒPlayerActivity ä¸€å¯åŠ¨å°±èƒ½çŸ¥é“è¯¥è¯·æ±‚å“ªä¸ª APIã€å“ªä¸ªæºï¼Œä¸éœ€è¦å†å›å¤´é—® SearchActivityã€‚</p>
<hr/>
<h2 data-id="heading-1">PlayerActivityï¼šé¢„åŠ è½½å’Œé™çº§ç­–ç•¥</h2>
<p>åœ¨ PlayerActivity é‡Œï¼Œæœ€å…³é”®çš„å‡ ä¸ªåŠ¨ä½œï¼š</p>
<ol>
<li><strong>é¦–å¸§ä¼˜åŒ–</strong>ï¼šåœ¨ <code>onCreate</code> ä¸­å°±å¼€å§‹å‡†å¤‡ ExoPlayerï¼ŒåŒæ—¶åŠ è½½æµ·æŠ¥/èƒŒæ™¯å›¾ï¼Œç•Œé¢ä¸Šè‡³å°‘æœ‰ä¸œè¥¿å…ˆé¡¶ç€ã€‚</li>
<li><strong>è‡ªåŠ¨åˆ‡æº</strong>ï¼šå¦‚æœå½“å‰æºçš„ episode URL æ’­æ”¾å¤±è´¥ï¼Œå°±è°ƒç”¨ <code>VideoDetailViewModel</code> å†æ‹‰ä¸€æ¬¡è¯¦æƒ…æ‰¾å…¶å®ƒå¯æ’­é¡¹ï¼Œæˆ–è€…ç›´æ¥æç¤ºâ€œæœ¬æºæ— æ•ˆâ€ã€‚</li>
<li><strong>ç¼“å­˜å›é€€</strong>ï¼š<code>VideoDetailCache</code> ä¼šå­˜ä¹‹å‰çœ‹è¿‡çš„è¯¦æƒ…ï¼Œå¦‚æœæºæš‚æ—¶æŒ‚æ‰ï¼Œä¹Ÿèƒ½ç”¨æ—§åˆ—è¡¨è®©ç”¨æˆ·é€‰æ‹©ï¼Œå†å°è¯•æ’­æ”¾ã€‚</li>
</ol>
<p>å¯¹äºé¢„åŠ è½½ï¼Œæˆ‘é‡‡ç”¨äº†â€œå…ˆå‡†å¤‡ MediaItem å† attach åˆ°æ’­æ”¾å™¨â€çš„æ–¹å¼ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">preparePlayer</span><span class="hljs-params">(episodeUrl: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">val</span> mediaItem = MediaItem.Builder()
        .setUri(episodeUrl)
        .setMimeType(MimeTypes.APPLICATION_M3U8)
        .build()
    exoPlayer.setMediaItem(mediaItem, <span class="hljs-comment">/* startPosition= */</span> <span class="hljs-number">0</span>)
    exoPlayer.prepare() <span class="hljs-comment">// å…ˆå‡†å¤‡ï¼Œç­‰ UI ready å† playWhenReady = true</span>
}
</code></pre>
<p>è¿™ä¸€æ­¥åœ¨ <code>onCreate</code> å°±ä¼šè°ƒç”¨ï¼Œæ‰€ä»¥ç­‰ UI æ¸²æŸ“å®Œå† <code>play()</code> æ—¶ï¼Œé¦–å¸§æ›´å¿«å‡ºç°ã€‚å®é™…ä½“éªŒä¸Šï¼Œæ™šé«˜å³°ä¹Ÿèƒ½æŠŠâ€œé»‘å±çŠ¶æ€â€å‹ç¼©åˆ° 1 ç§’ä»¥å†…ã€‚</p>
<hr/>
<h2 data-id="heading-2">å¤œé—´åˆ‡æºï¼šåˆ«è®©åæºæ‹–ç´¯ä½“éªŒ</h2>
<p>æ™šä¸Šçš„é—®é¢˜ä¸»è¦æ˜¯æŸäº›æºå“åº”æ…¢ç”šè‡³ç›´æ¥æŒ‚ã€‚æˆ‘åœ¨ <code>VideoRepository</code> çš„æµå¼æœç´¢é‡Œï¼Œå·²ç»æŠŠæ¯ä¸ªæºçš„ç»“æœåˆ†æ‰¹è¿”å›ï¼›åœ¨ PlayerActivity é‡Œï¼Œåªè¦æŸä¸ª episode æ’­æ”¾å¤±è´¥ï¼Œå°±ä¼šå›è°ƒ ViewModel å»æ‹¿å…¶ä»–æºï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">viewModel.videoDetail.observe(<span class="hljs-keyword">this</span>) { detail -&gt;
    <span class="hljs-comment">// detail.episodes é‡ŒåŒ…å«å½“å‰æºå¯æ’­è®°å½•</span>
}
</code></pre>
<p>å†ç»“åˆ <code>CommonEpisodesBottomSheet</code>ï¼Œç”¨æˆ·å¯ä»¥é‡æ–°é€‰ä¸€é›†æˆ–è€…æ¢æºï¼Œé¿å…â€œå®Œå…¨æ²¡å“åº”â€çš„å°´å°¬ã€‚</p>
<hr/>
<h2 data-id="heading-3">ç°åœ¨çš„ä½“éªŒæ€ä¹ˆæ ·ï¼Ÿ</h2>
<ul>
<li>ç‚¹å‡»æ’­æ”¾å UI ç«‹åˆ»å˜åŒ–ï¼Œæµ·æŠ¥ã€èƒŒæ™¯å…ˆå ä½ï¼Œä¸å†æ˜¯ç°å±ï¼›</li>
<li>é¦–å¸§å‡ºç°æ—¶é—´æ›´ç¨³å®šï¼Œæ™šé«˜å³°ä¹Ÿèƒ½åœ¨ 1ï½2 ç§’å†…çœ‹åˆ°ç”»é¢ï¼›</li>
<li>æºæŒ‚äº†ä¹Ÿä¼šæç¤ºï¼Œç”¨æˆ·å¯ä»¥æ¢æºæˆ–é‡è¯•ï¼Œè€Œä¸æ˜¯ç›´æ¥å´©ï¼›</li>
<li>ç¼“å­˜å›é€€è®©â€œæ°å¥½æºæŒ‚æ‰â€çš„åœºæ™¯è¿˜èƒ½ç»§ç»­æ‰¾ä¸Šä¸€æ¡å‰§é›†ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-4">æƒ³é—®é—®ä½ </h2>
<ol>
<li>ä½ é‡åˆ°è¿‡æœ€éš¾å¿çš„æ’­æ”¾å™¨é¦–å¸§é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>å¦‚æœå¯ä»¥è‡ªå®šä¹‰ç¼“å†²ç­–ç•¥ï¼Œä½ å¸Œæœ›å“ªäº›å‚æ•°ï¼ˆèµ·æ’­æ—¶é—´ã€æœ€å¤§é‡è¯•æ¬¡æ•°ï¼‰å¼€æ”¾ç»™ç”¨æˆ·ï¼Ÿ</li>
<li>é™¤äº†è‡ªåŠ¨åˆ‡æºï¼Œä½ è¿˜å¸Œæœ›æ’­æ”¾å™¨åœ¨å¤±è´¥æ—¶åšä»€ä¹ˆï¼Ÿæ¯”å¦‚ä¸€é”®åé¦ˆï¼Ÿæ¬¢è¿ç•™è¨€è®¨è®ºã€‚</li>
</ol>
<p>å…è´¹çœ‹å‰§æœ¬æ¥å°±é™ä¸ä¸‹å¿ƒï¼Œå†è®©é¦–å¸§é»‘å±ï¼Œåªä¼šè®©äººæ›´æƒ³å¸è½½ã€‚å¸Œæœ›è¿™å¥—ç¼“å†²å’Œé¢„åŠ è½½ç­–ç•¥ï¼Œä¹Ÿèƒ½å¸®ä½ åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œå°‘ä¸€ç‚¹â€œéšç¼˜â€ï¼Œå¤šä¸€ç‚¹å¯æ§ã€‚æ¬¢è¿ç•™è¨€åˆ†äº«ä½ åœ¨æ’­æ”¾å±‚çš„ä¼˜åŒ–æ‰‹æ³•ï¼Œæˆ‘ä»¬ç»§ç»­æŠ˜è…¾ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutter é›†æˆflutter_Boost]]></title>    <link>https://juejin.cn/post/7577431644069330995</link>    <guid>https://juejin.cn/post/7577431644069330995</guid>    <pubDate>2025-11-28T09:22:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577431644069330995" data-draft-id="7577431644069298227" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutter é›†æˆflutter_Boost"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-11-28T09:22:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ€åˆçš„é»„æ˜"/> <meta itemprop="url" content="https://juejin.cn/user/3422105034831214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutter é›†æˆflutter_Boost
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3422105034831214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ€åˆçš„é»„æ˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:22:41.000Z" title="Fri Nov 28 2025 09:22:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>flutter_Boots æ˜¯å’¸é±¼å¼€æºçš„ä¸‰æ–¹æ¡†æ¶ï¼Œä¸»è¦æ˜¯ä¸ºåŸç”Ÿå’Œflutterä¹‹é—´æ··åˆè·³è½¬æä¾›çš„è§£å†³æ–¹æ¡ˆï¼Œä¸‹é¢è¯´ä¸€ä¸‹é›†æˆflutter_Bootsçš„æ­¥éª¤å’Œå¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨flutter_Bootsã€‚</p>
<ol>
<li>
<p><strong>åˆ›å»ºåŸç”Ÿå·¥ç¨‹å’Œflutter module</strong></p>
<ol>
<li>ä½¿ç”¨xcodeåˆ›å»ºiOS appåŸç”Ÿå·¥ç¨‹ï¼Œè¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œé¢å°±ä¸å»è´´å›¾äº†ã€‚</li>
<li>åˆ›å»ºflutter module,æ‰§è¡Œå‘½ä»¤ flutter create -t module my_flutter_moduleã€‚</li>
<li>è¿™æ ·åœ¨æœ¬åœ°å°±æŠŠiOSå·¥ç¨‹å’Œflutter moduleåˆ›å»ºå¥½äº†ï¼Œå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffba68600ebe4b04943113278526a2ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyA5Yid55qE6buE5piP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764927099&amp;x-signature=oehr2DufWTJhe0clBZjmDtXF9xs%3D" alt="image.png" loading="lazy"/></li>
</ol>
</li>
<li>
<p><strong>flutterå®‰è£…flutter_Bootsä¾èµ–</strong></p>
<ol>
<li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œflutter_boostçš„é«˜ç‰ˆæœ¬éœ€è¦ä½¿ç”¨gitè¿™ç§æ–¹å¼å»å®‰è£…ä¾èµ–ã€‚</li>
<li>å®‰è£…æˆªå›¾é…ç½®ä¾èµ–ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ flutter pub getæŒ‰é’®ä¾èµ–ã€‚</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78d8a2016cb545a08bf8ebffeec02a58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyA5Yid55qE6buE5piP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764927099&amp;x-signature=57bXE8mSxySxaYDRbzTPwPL%2FlAY%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p><strong>ios é…ç½®pod</strong></p>
<ol>
<li>cd my_ios_app</li>
<li>pod init</li>
<li>ä¿®æ”¹podfileæ–‡ä»¶</li>
<li>pod install</li>
</ol>

<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># Uncomment the next line to define a global platform for your project</span>
platform <span class="hljs-symbol">:ios</span>, <span class="hljs-string">'13.0'</span>

flutter_application_path = <span class="hljs-string">'../my_flutter_module'</span>
load <span class="hljs-title class_">File</span>.join(flutter_application_path, <span class="hljs-string">'.ios'</span>, <span class="hljs-string">'Flutter'</span>, <span class="hljs-string">'podhelper.rb'</span>)

target <span class="hljs-string">'my_ios_app'</span> <span class="hljs-keyword">do</span>
  <span class="hljs-comment"># Comment the next line if you don't want to use dynamic frameworks</span>
  use_frameworks!

  install_all_flutter_pods(flutter_application_path)

  <span class="hljs-comment"># Pods for my_ios_app</span>

<span class="hljs-keyword">end</span>

post_install <span class="hljs-keyword">do</span> |<span class="hljs-params">installer</span>|
  flutter_post_install(installer) <span class="hljs-keyword">if</span> <span class="hljs-keyword">defined</span>?(flutter_post_install)
<span class="hljs-keyword">end</span>
</code></pre>
</li>
<li>
<p><strong>flutter ç¼–å†™flutter_boosté›†æˆä»£ç </strong></p>
<ol>
<li>
<p>å¯¼å…¥flutter_boost</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter_boost/flutter_boost.dart'</span>;
</code></pre>
</li>
<li>
<p>åˆ›å»ºCustomFlutterBinding</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomFlutterBinding</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WidgetsFlutterBinding</span></span>
    <span class="hljs-keyword">with</span> <span class="hljs-type">BoostFlutterBinding</span> {}
</code></pre>
</li>
<li>
<p>æµ‹è¯•é¡µé¢</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DefaultPage</span>({super.key});
  @override
  Widget <span class="hljs-title function_ invoke__">build</span>(BuildContext context) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Scaffold</span>(
      <span class="hljs-attr">appBar</span>: <span class="hljs-title function_ invoke__">AppBar</span>(<span class="hljs-attr">title</span>: <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'Flutter Boost'</span>)),
      <span class="hljs-attr">body</span>: <span class="hljs-title function_ invoke__">Center</span>(
        <span class="hljs-attr">child</span>: <span class="hljs-title function_ invoke__">Column</span>(
          <span class="hljs-attr">mainAxisAlignment</span>: MainAxisAlignment.center,
          <span class="hljs-attr">children</span>: [
            <span class="hljs-title function_ invoke__">ElevatedButton</span>(
              <span class="hljs-attr">onPressed</span>: () {
                BoostNavigator.instance.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-string">'/one'</span>,
                    <span class="hljs-attr">arguments</span>: {<span class="hljs-string">'msg'</span>: <span class="hljs-string">'hello from default page 1'</span>});
              },
              <span class="hljs-attr">child</span>: <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'go to page one'</span>),
            ),
            <span class="hljs-title function_ invoke__">ElevatedButton</span>(
              <span class="hljs-attr">onPressed</span>: () {
                BoostNavigator.instance.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-string">'/two'</span>,
                    <span class="hljs-attr">arguments</span>: {<span class="hljs-string">'msg'</span>: <span class="hljs-string">'hello from default page 2'</span>});
              },
              <span class="hljs-attr">child</span>: <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'go to page two'</span>),
            ),
            <span class="hljs-title function_ invoke__">ElevatedButton</span>(
              <span class="hljs-attr">onPressed</span>: () {
                BoostNavigator.instance.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-string">'/home'</span>,
                    <span class="hljs-attr">arguments</span>: {<span class="hljs-string">'msg'</span>: <span class="hljs-string">'hello from default page 2'</span>});
              },
              <span class="hljs-attr">child</span>: <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'go to page native home'</span>),
            )
          ],
        ),
      ),
    );
  }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OnePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">OnePage</span>({super.key, required this.pramas});
  <span class="hljs-keyword">final</span> Map pramas;
  @override
  Widget <span class="hljs-title function_ invoke__">build</span>(BuildContext context) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Scaffold</span>(
      <span class="hljs-attr">appBar</span>: <span class="hljs-title function_ invoke__">AppBar</span>(<span class="hljs-attr">title</span>: <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'page one'</span>)),
      <span class="hljs-attr">body</span>: <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'page one, å‚æ•°: ${pramas['</span>msg<span class="hljs-string">']}'</span>),
    );
  }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TwoPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TwoPage</span>({super.key, required this.pramas});
  <span class="hljs-keyword">final</span> Map pramas;
  @override
  Widget <span class="hljs-title function_ invoke__">build</span>(BuildContext context) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Scaffold</span>(
      <span class="hljs-attr">appBar</span>: <span class="hljs-title function_ invoke__">AppBar</span>(<span class="hljs-attr">title</span>: <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'page two'</span>)),
      <span class="hljs-attr">body</span>: <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'page two, å‚æ•°: ${pramas['</span>msg<span class="hljs-string">']}'</span>),
    );
  }
}
</code></pre>
</li>
<li>
<p>ç¼–å†™widgetå’Œè·¯ç”±ä»£ç </p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-title class_">CustomFlutterBinding</span>();
  <span class="hljs-title function_">runApp</span>(<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyApp</span>());
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">StatefulWidget</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">MyApp</span>({<span class="hljs-variable language_">super</span>.<span class="hljs-property">key</span>});

  <span class="hljs-meta">@override</span>
  <span class="hljs-title class_">State</span>&lt;<span class="hljs-title class_">StatefulWidget</span>&gt; <span class="hljs-title function_">createState</span>() =&gt; <span class="hljs-title function_">_MyAppState</span>();
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">_MyAppState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">State</span>&lt;<span class="hljs-title class_">MyApp</span>&gt; {
  <span class="hljs-meta">@override</span>
  <span class="hljs-title class_">Widget</span> <span class="hljs-title function_">build</span>(<span class="hljs-params">BuildContext context</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">FlutterBoostApp</span>(routeFactory);
  }

  <span class="hljs-title class_">Widget</span> <span class="hljs-title function_">appBuilder</span>(<span class="hljs-params">Widget home</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">MaterialApp</span>(
      <span class="hljs-attr">home</span>: home,
      <span class="hljs-attr">debugShowCheckedModeBanner</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">builder</span>: (_, __) {
        <span class="hljs-keyword">return</span> home;
      },
    );
  }
}

<span class="hljs-title class_">Route</span>&lt;dynamic&gt;? <span class="hljs-title function_">routeFactory</span>(<span class="hljs-params">
    RouteSettings settings, bool isContainerPage, <span class="hljs-built_in">String</span>? uniqueId</span>) {
  final pramas = (settings.<span class="hljs-property">arguments</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Map</span>?) ?? {};
  <span class="hljs-keyword">switch</span> (settings.<span class="hljs-property">name</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'/'</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">MaterialPageRoute</span>(
          <span class="hljs-attr">settings</span>: settings, <span class="hljs-attr">builder</span>: <span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">DefaultPage</span>());
    <span class="hljs-keyword">case</span> <span class="hljs-string">'/one'</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">MaterialPageRoute</span>(
          <span class="hljs-attr">settings</span>: settings, <span class="hljs-attr">builder</span>: <span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> <span class="hljs-title class_">OnePage</span>(<span class="hljs-attr">pramas</span>: pramas));
    <span class="hljs-keyword">case</span> <span class="hljs-string">'/two'</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">MaterialPageRoute</span>(
          <span class="hljs-attr">settings</span>: settings, <span class="hljs-attr">builder</span>: <span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> <span class="hljs-title class_">TwoPage</span>(<span class="hljs-attr">pramas</span>: pramas));
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
}
</code></pre>
<p>flutterç«¯ä»£ç é›†æˆå®Œæ¯•ã€‚</p>
</li>
</ol>
</li>
<li>
<p><strong>iOSç«¯ä»£ç é›†æˆ</strong></p>
<ol>
<li>
<p>å…ˆåˆ›å»ºä¸€ä¸ªBoostDelegateç»§æ‰¿FlutterBoostDelegateï¼Œé‡Œé¢ä¸»è¦çš„é€»è¾‘å°±æ˜¯å®ç°pushåŸç”Ÿã€push flutterã€popçš„æ–¹æ³•.</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Foundation
<span class="hljs-keyword">import</span> flutter_boost

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BoostDelegate</span>: <span class="hljs-title class_">NSObject</span>, <span class="hljs-title class_">FlutterBoostDelegate</span> {
    
    <span class="hljs-comment">//pushå¯¼èˆªæ </span>
    <span class="hljs-keyword">var</span> navigationController: <span class="hljs-type">UINavigationController</span>?
    
    <span class="hljs-comment">//è®°å½•è¿”å›flutterä¾§è¿”å›ç»“æœåˆ—è¡¨</span>
    <span class="hljs-keyword">var</span> resultTable: <span class="hljs-type">Dictionary</span>&lt;<span class="hljs-type">String</span>, ([<span class="hljs-type">AnyHashable</span>: <span class="hljs-keyword">Any</span>]?) -&gt; <span class="hljs-type">Void</span>&gt; <span class="hljs-operator">=</span> [:]
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">pushNativeRoute</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">pageName</span>: <span class="hljs-type">String</span>!, <span class="hljs-params">arguments</span>: [<span class="hljs-params">AnyHashable</span> : <span class="hljs-keyword">Any</span>]<span class="hljs-operator">!</span>) {
        <span class="hljs-keyword">let</span> isPresent <span class="hljs-operator">=</span> arguments[<span class="hljs-string">"isPresent"</span>] <span class="hljs-keyword">as?</span> <span class="hljs-type">Bool</span> <span class="hljs-operator">??</span> <span class="hljs-literal">false</span>
        <span class="hljs-keyword">let</span> isAnimated <span class="hljs-operator">=</span> arguments[<span class="hljs-string">"isAnimated"</span>] <span class="hljs-keyword">as?</span> <span class="hljs-type">Bool</span> <span class="hljs-operator">??</span> <span class="hljs-literal">true</span>
        <span class="hljs-keyword">var</span> targetViewController <span class="hljs-operator">=</span> <span class="hljs-type">UIViewController</span>()
        <span class="hljs-keyword">if</span> pageName <span class="hljs-operator">==</span> <span class="hljs-string">"/home"</span> {
            targetViewController <span class="hljs-operator">=</span> <span class="hljs-type">HomeViewController</span>()
        }
        <span class="hljs-keyword">if</span> isPresent {
            navigationController<span class="hljs-operator">?</span>.present(targetViewController, animated: isAnimated)
        } <span class="hljs-keyword">else</span> {
            navigationController<span class="hljs-operator">?</span>.pushViewController(targetViewController, animated: isAnimated)
        }
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">pushFlutterRoute</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">options</span>: <span class="hljs-type">FlutterBoostRouteOptions</span>!) {
        <span class="hljs-keyword">let</span> vc: <span class="hljs-type">FBFlutterViewContainer</span> <span class="hljs-operator">=</span> <span class="hljs-type">FBFlutterViewContainer</span>()
        vc.setName(options.pageName,
                   uniqueId:options.uniqueId,
                   params: options.arguments,
                   opaque: options.opaque)
        <span class="hljs-keyword">let</span> isPresent <span class="hljs-operator">=</span> options.arguments[<span class="hljs-string">"isPresent"</span>] <span class="hljs-keyword">as?</span> <span class="hljs-type">Bool</span> <span class="hljs-operator">??</span> <span class="hljs-literal">false</span>
        <span class="hljs-keyword">let</span> isAnimated <span class="hljs-operator">=</span> options.arguments[<span class="hljs-string">"isAnimated"</span>] <span class="hljs-keyword">as?</span> <span class="hljs-type">Bool</span> <span class="hljs-operator">??</span> <span class="hljs-literal">true</span>
        
        <span class="hljs-comment">//å¯¹è¿™ä¸ªé¡µé¢è®¾ç½®ç»“æœ</span>
        resultTable[options.pageName] <span class="hljs-operator">=</span> options.onPageFinished
        
        <span class="hljs-keyword">if</span> (isPresent <span class="hljs-operator">||</span> <span class="hljs-operator">!</span>options.opaque) {
            navigationController<span class="hljs-operator">?</span>.present(vc, animated: isAnimated)
        } <span class="hljs-keyword">else</span> {
            navigationController<span class="hljs-operator">?</span>.pushViewController(vc, animated: isAnimated)
        }
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">popRoute</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">options</span>: <span class="hljs-type">FlutterBoostRouteOptions</span>!) {
        <span class="hljs-comment">//å¦‚æœå½“å‰è¢«presentçš„vcæ˜¯containerï¼Œé‚£ä¹ˆå°±æ‰§è¡Œdismissé€»è¾‘</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> vc <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.navigationController<span class="hljs-operator">?</span>.presentedViewController <span class="hljs-keyword">as?</span> <span class="hljs-type">FBFlutterViewContainer</span>,vc.uniqueIDString() <span class="hljs-operator">==</span> options.uniqueId{
            
            <span class="hljs-comment">//è¿™é‡Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œç”±äºUIModalPresentationOverFullScreenä¸‹ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¾ç¤ºä¼šæœ‰é—®é¢˜</span>
            <span class="hljs-comment">//æ‰€ä»¥éœ€è¦æ‰‹åŠ¨è°ƒç”¨çš„åœºæ™¯ï¼Œä»è€Œä½¿ä¸‹é¢åº•éƒ¨çš„vcè°ƒç”¨viewAppearç›¸å…³é€»è¾‘</span>
            <span class="hljs-keyword">if</span> vc.modalPresentationStyle <span class="hljs-operator">==</span> .overFullScreen {
                
                <span class="hljs-comment">//è¿™é‡Œæ‰‹åŠ¨beginAppearanceTransitionè§¦å‘é¡µé¢ç”Ÿå‘½å‘¨æœŸ</span>
                <span class="hljs-keyword">self</span>.navigationController<span class="hljs-operator">?</span>.topViewController<span class="hljs-operator">?</span>.beginAppearanceTransition(<span class="hljs-literal">true</span>, animated: <span class="hljs-literal">false</span>)
                
                vc.dismiss(animated: <span class="hljs-literal">true</span>) {
                    <span class="hljs-keyword">self</span>.navigationController<span class="hljs-operator">?</span>.topViewController<span class="hljs-operator">?</span>.endAppearanceTransition()
                }
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-comment">//æ­£å¸¸åœºæ™¯ï¼Œç›´æ¥dismiss</span>
                vc.dismiss(animated: <span class="hljs-literal">true</span>, completion: <span class="hljs-literal">nil</span>)
            }
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">self</span>.navigationController<span class="hljs-operator">?</span>.popViewController(animated: <span class="hljs-literal">true</span>)
        }
        <span class="hljs-comment">//å¦åˆ™ç›´æ¥æ‰§è¡Œpopé€»è¾‘</span>
        <span class="hljs-comment">//è¿™é‡Œåœ¨popçš„æ—¶å€™å°†å‚æ•°å¸¦å‡º,å¹¶ä¸”ä»ç»“æœè¡¨ä¸­ç§»é™¤</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> onPageFinshed <span class="hljs-operator">=</span> resultTable[options.pageName] {
            onPageFinshed(options.arguments)
            resultTable.removeValue(forKey: options.pageName)
        }
    }
}
</code></pre>
</li>
</ol>
</li>
<li>
<p>ä¿®æ”¹Appdelegateæ–‡ä»¶</p>
<pre><code class="hljs language-swift" lang="swift"> <span class="hljs-keyword">var</span> boostDelegate <span class="hljs-operator">=</span> <span class="hljs-type">BoostDelegate</span>() 
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">application</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">application</span>: <span class="hljs-type">UIApplication</span>, <span class="hljs-params">didFinishLaunchingWithOptions</span> <span class="hljs-params">launchOptions</span>: [<span class="hljs-type">UIApplication</span>.<span class="hljs-params">LaunchOptionsKey</span>: <span class="hljs-keyword">Any</span>]<span class="hljs-operator">?</span>) -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-comment">// Override point for customization after application launch.</span>
        <span class="hljs-type">FlutterBoost</span>.instance().setup(application, delegate: boostDelegate, callback: { engine <span class="hljs-keyword">in</span>
        })
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
</code></pre>
</li>
<li>
<p><strong>æ·»åŠ è·³è½¬äº¤äº’</strong></p>
<ol>
<li>
<p>è·³è½¬flutter</p>
<pre><code class="hljs language-ini" lang="ini"> if let <span class="hljs-attr">appDelegate</span> = UIApplication.shared.delegate as? AppDelegate {
            <span class="hljs-attr">appDelegate.boostDelegate.navigationController</span> = self.navigationController
        }
        let <span class="hljs-attr">ops</span> = FlutterBoostRouteOptions()
        <span class="hljs-attr">ops.pageName</span> = <span class="hljs-string">"/"</span>
        <span class="hljs-attr">ops.arguments</span> = [<span class="hljs-string">"msg"</span>:<span class="hljs-string">"app"</span>]
        FlutterBoost.instance().open(ops)
</code></pre>
</li>
<li>
<p>è·³è½¬åŸç”Ÿ</p>
<pre><code class="hljs language-php" lang="php"> <span class="hljs-title function_ invoke__">ElevatedButton</span>(
              <span class="hljs-attr">onPressed</span>: () {
                BoostNavigator.instance.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-string">'/home'</span>,
                    <span class="hljs-attr">arguments</span>: {<span class="hljs-string">'msg'</span>: <span class="hljs-string">'hello from default page 2'</span>});
              },
              child: <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">Text</span>(<span class="hljs-string">'go to page native home'</span>),
            )
</code></pre>
</li>
</ol>
</li>
</ol>
<p>é€šè¿‡ä»¥ä¸Šçš„é›†æˆæ­¥éª¤å’Œä»£ç ç¼–å†™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æµç•…çš„åœ¨flutterå’ŒåŸç”Ÿä¹‹é—´äº’ç›¸è·³è½¬äº†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TRAE SOLO ä¸­å›½ç‰ˆï¼Œæ­£å¼å‘å¸ƒï¼AI ç¼–ç¨‹çš„ "Solo" æ—¶ä»£æ¥äº†ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7577583653728763942</link>    <guid>https://juejin.cn/post/7577583653728763942</guid>    <pubDate>2025-11-28T09:39:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577583653728763942" data-draft-id="7577609608827731994" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TRAE SOLO ä¸­å›½ç‰ˆï¼Œæ­£å¼å‘å¸ƒï¼AI ç¼–ç¨‹çš„ &quot;Solo&quot; æ—¶ä»£æ¥äº†ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-28T09:39:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="indieAI"/> <meta itemprop="url" content="https://juejin.cn/user/4488643649743614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TRAE SOLO ä¸­å›½ç‰ˆï¼Œæ­£å¼å‘å¸ƒï¼AI ç¼–ç¨‹çš„ "Solo" æ—¶ä»£æ¥äº†ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4488643649743614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    indieAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:39:51.000Z" title="Fri Nov 28 2025 09:39:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¦‚æœè¯´ 2024 å¹´æ˜¯ AI Copilotï¼ˆå‰¯é©¾é©¶ï¼‰çš„å…ƒå¹´ï¼Œé‚£ä¹ˆ 2025 å¹´æœ«ï¼Œæˆ‘ä»¬ç»ˆäºè¿æ¥äº† AI <strong>Agentï¼ˆæ™ºèƒ½ä½“ï¼‰</strong> çš„çœŸæ­£è½åœ°ã€‚</p>
<p>ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å¯»æ‰¾é‚£ä¸ªèƒ½çœŸæ­£è®©æˆ‘ä»¬ "Solo" æ•´ä¸ªé¡¹ç›®çš„å·¥å…·â€”â€”ä¸éœ€è¦ç¹ççš„é…ç½®ï¼Œä¸éœ€è¦é«˜æ˜‚çš„è®¢é˜…è´¹ï¼Œç”šè‡³ä¸éœ€è¦æ¢¯å­ã€‚ä»Šå¤©ï¼Œ<strong>å­—èŠ‚è·³åŠ¨</strong> æ­£å¼äº¤å‡ºäº†ä»–ä»¬çš„ç­”å·ï¼š<strong>TRAE SOLO ä¸­å›½ç‰ˆ</strong> æ­£å¼ä¸Šçº¿ï¼</p>
<p>ä¸å†åªæ˜¯ "è¡¥å…¨ä»£ç "ï¼Œè€Œæ˜¯ "æ¥ç®¡ä»»åŠ¡"ã€‚è¿™æ¬¾å·ç§°è¦è®©å¼€å‘è€… <strong>â€œä¸€ä¸ªäººæ´»æˆä¸€æ”¯é˜Ÿä¼â€</strong> çš„ IDE ç©¶ç«Ÿæˆè‰²å‡ ä½•ï¼Ÿä½œä¸ºé¦–æ‰¹ä½“éªŒç”¨æˆ·ï¼Œæˆ‘è¿å¤œå®æµ‹ï¼Œä¸ºå¤§å®¶å¸¦æ¥è¿™ç¯‡ç¡¬æ ¸è§£è¯»ã€‚</p>
<hr/>
<h3 data-id="heading-0"><strong>ä¸€ã€ ä»€ä¹ˆæ˜¯ TRAE SOLOï¼Ÿ</strong></h3>
<p><strong>Trae</strong> (The Real AI Engineer) æ˜¯å­—èŠ‚è·³åŠ¨æ¨å‡ºçš„ä¸€æ¬¾ <strong>AI Native IDE</strong>ã€‚ä¸ VS Code å®‰è£…æ’ä»¶çš„æ¨¡å¼ä¸åŒï¼ŒTrae æ˜¯åŸç”Ÿé›†æˆäº† AI èƒ½åŠ›çš„å¼€å‘ç¯å¢ƒã€‚</p>
<p>è€Œè¿™æ¬¡å‘å¸ƒçš„ <strong>"SOLO" ä¸­å›½ç‰ˆ</strong>ï¼Œä¸ä»…ä»…æ˜¯ç®€å•çš„æ±‰åŒ–ï¼Œå®ƒæ˜¯ä¸€ä¸ªé’ˆå¯¹ä¸­å›½å¼€å‘è€…ç—›ç‚¹æ·±åº¦å®šåˆ¶çš„ "å®Œå…¨ä½“"ã€‚å®ƒæœ€å¤§çš„æ ¸å¿ƒç†å¿µå°±æ˜¯ï¼š<strong>é€šè¿‡å¼ºå¤§çš„ Agent èƒ½åŠ›ï¼Œè®©å•å…µä½œæˆ˜çš„å¼€å‘è€…æ‹¥æœ‰å›¢é˜Ÿçº§çš„äº§å‡ºæ•ˆç‡ã€‚</strong></p>
<h4 data-id="heading-1"><strong>æ ¸å¿ƒäº®ç‚¹ä¸€è§ˆï¼š</strong></h4>
<ul>
<li><strong>å…¨åŠŸèƒ½å…è´¹ï¼š</strong> æ²¡é”™ï¼Œç›®å‰é˜¶æ®µæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼ˆåŒ…æ‹¬æ¨¡å‹è°ƒç”¨ï¼‰å…¨éƒ¨å…è´¹ã€‚</li>
<li><strong>å›½äº§æœ€å¼ºæ¨¡å‹åº•åº§ï¼š</strong> æ¥å…¥å­—èŠ‚è‡ªç ” <strong>è±†åŒ… (Doubao-1.5-pro)</strong> åŠ <strong>DeepSeek R1/V3</strong> æ»¡è¡€ç‰ˆï¼Œé€Ÿåº¦ä¸æ™ºå•†åŒé£ã€‚</li>
<li><strong>ä¸‰æ å¼ "Solo é©¾é©¶èˆ±"ï¼š</strong> é¢ è¦†ä¼ ç»Ÿçš„ IDE å¸ƒå±€ï¼Œä¸“ä¸º AI åä½œè®¾è®¡ã€‚</li>
<li><strong>Plan Mode (è§„åˆ’æ¨¡å¼)ï¼š</strong> æ‹’ç» "åªä¼šå†™ä»£ç ä¸ä¼šæ”¹ä»£ç " çš„å‚»ç“œå¼ AIï¼Œå®ƒèƒ½å…ˆæ€è€ƒã€å†æ‰§è¡Œã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-2"><strong>äºŒã€ ç¡¬æ ¸åŠŸèƒ½å®æµ‹ï¼šå®ƒå‡­ä»€ä¹ˆè®©ä½  "Solo"ï¼Ÿ</strong></h3>
<p>åœ¨å®æµ‹ä¸­ï¼ŒTRAE SOLO å±•ç°äº†å‡ ä¸ªæ˜æ˜¾åŒºåˆ«äº Cursor çš„å·®å¼‚åŒ–èƒ½åŠ›ï¼š</p>
<h4 data-id="heading-3"><strong>1. ä¸‰æ å¸ƒå±€ï¼šçœŸæ­£çš„ "Solo é©¾é©¶èˆ±"</strong></h4>
<p>æ‰“å¼€ TRAE SOLOï¼Œä½ ä¼šå‘ç°å®ƒé‡‡ç”¨äº†å…¨æ–°çš„ <strong>å·¦-ä¸­-å³</strong> ä¸‰æ å¸ƒå±€ï¼Œè¿™æ˜¯ä¸ºäº†é€‚åº” "äººæœºååŒ" çš„æ–°èŒƒå¼ï¼š</p>
<ul>
<li><strong>å·¦ä¾§ï¼šä»»åŠ¡ç®¡ç† (Task Manager)</strong> â€”â€” å¯ä»¥åœ¨è¿™é‡Œå¹¶è¡Œå¤šä¸ªå¼€å‘ä»»åŠ¡ï¼ŒAI åœ¨åå° "å¤šçº¿ç¨‹" æ¬ç –ï¼Œä½ åªéœ€ç›‘æ§è¿›åº¦ã€‚</li>
<li><strong>ä¸­é—´ï¼šå¯¹è¯æµ (Chat &amp; Plan)</strong> â€”â€” è¿™é‡Œæ˜¯ä¸ AI äº¤äº’çš„æŒ‡æŒ¥ä¸­å¿ƒã€‚</li>
<li><strong>å³ä¾§ï¼šä»£ç ç¼–è¾‘ (Editor)</strong> â€”â€” ä¼ ç»Ÿçš„ä»£ç å±•ç¤ºåŒºã€‚</li>
</ul>
<p>è¿™ç§è®¾è®¡è§£å†³äº†ä¸€ä¸ªç—›ç‚¹ï¼š<strong>ä¸Šä¸‹æ–‡è¿·å¤±</strong>ã€‚ä½ å¯ä»¥åœ¨å·¦ä¾§æŒ‚èµ·ä¸€ä¸ª "é‡æ„æ•°æ®åº“" çš„ä»»åŠ¡ï¼ŒåŒæ—¶åœ¨ä¸­é—´å’Œ AI è®¨è®º "å‰ç«¯ UI ä¿®æ”¹"ï¼Œäº’ä¸å¹²æ‰°ã€‚</p>
<h4 data-id="heading-4"><strong>2. Plan Modeï¼šå…ˆæ€è€ƒï¼ŒååŠ¨å·¥</strong></h4>
<p>è¿™æ˜¯ TRAE SOLO çš„æ€æ‰‹é”ã€‚å½“ä½ æŠ›å‡ºä¸€ä¸ªå¤æ‚éœ€æ±‚ï¼ˆä¾‹å¦‚ï¼š"ç»™ç›®å‰çš„åšå®¢ç³»ç»Ÿå¢åŠ ä¸€ä¸ªåŸºäº Redis çš„ç‚¹èµåŠŸèƒ½"ï¼‰ï¼š</p>
<ol>
<li><strong>AI ä¸ä¼šç›´æ¥çå†™ä»£ç </strong>ï¼Œè€Œæ˜¯å…ˆè¿›å…¥ <strong>Plan Mode</strong>ã€‚</li>
<li>å®ƒä¼šåˆ—å‡ºæ­¥éª¤ï¼š<code>1. ä¿®æ”¹åç«¯ API</code> -&gt; <code>2. æ›´æ–°æ•°æ®åº“ Schema</code> -&gt; <code>3. ç¼–å†™ Redis é€»è¾‘</code> -&gt; <code>4. ä¿®æ”¹å‰ç«¯ç»„ä»¶</code>ã€‚</li>
<li>å®ƒä¼šå‘ä½ ç¡®è®¤ï¼š"è€æ¿ï¼Œè¿™ä¸ªè®¡åˆ’è¡Œå—ï¼Ÿ"</li>
<li>ç¡®è®¤åï¼Œå®ƒè‡ªåŠ¨åˆ›å»ºæ–‡ä»¶ã€è¿è¡Œç»ˆç«¯å‘½ä»¤ã€ä¿®æ”¹ä»£ç ã€‚</li>
</ol>
<p><strong>å®æµ‹æ„Ÿå—ï¼š</strong> è¿™ç§ "Agent" çš„æ„Ÿè§‰éå¸¸å¼ºçƒˆã€‚å®ƒä¸åƒæ˜¯ä¸€ä¸ªåªä¼šè¡¥å…¨ä¸‹ä¸€è¡Œçš„å·¥å…·äººï¼Œæ›´åƒæ˜¯ä¸€ä¸ªåˆçº§å·¥ç¨‹å¸ˆï¼ŒçŸ¥é“åœ¨å†™ä»£ç å‰å…ˆå†™æŠ€æœ¯æ–¹æ¡ˆã€‚</p>
<h4 data-id="heading-5"><strong>3. ä¸Šä¸‹æ–‡ç®¡ç†ä¸ "DiffView"</strong></h4>
<p>åšè¿‡ RAG çš„æœ‹å‹éƒ½çŸ¥é“ï¼ŒContext Windowï¼ˆä¸Šä¸‹æ–‡çª—å£ï¼‰æ˜¯æ˜‚è´µçš„èµ„æºã€‚</p>
<p>TRAE SOLO å¼•å…¥äº† æ™ºèƒ½ä¸Šä¸‹æ–‡å‹ç¼© æŠ€æœ¯ã€‚å®ƒæ”¯æŒä¸€æ¬¡æ€§æ£€ç´¢æ•°ä¸‡ä¸ªæ–‡ä»¶ï¼Œä½†ä¼šè‡ªåŠ¨æŠŠä¸é‡è¦çš„ä¿¡æ¯ "æŠ˜å "ï¼ŒåªæŠŠå…³é”®é€»è¾‘å–‚ç»™å¤§æ¨¡å‹ã€‚</p>
<p>æ­¤å¤–ï¼Œå®ƒçš„ <strong>DiffView (å˜æ›´è§†å›¾)</strong> éå¸¸ç›´è§‚ã€‚AI ä¿®æ”¹äº† 5 ä¸ªæ–‡ä»¶ï¼Œä½ ä¸éœ€è¦ä¸€ä¸ªä¸ªç‚¹å¼€çœ‹ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªæ±‡æ€»å¡ç‰‡ï¼Œè®©ä½ åƒä½œä¸º Tech Lead Review ä»£ç ä¸€æ ·ï¼Œä¸€ç›®äº†ç„¶åœ°å†³å®š <code>Accept</code> è¿˜æ˜¯ <code>Reject</code>ã€‚</p>
<hr/>
<h3 data-id="heading-6"><strong>ä¸‰ã€ ä¸­å›½ç‰ˆç‰¹ä¾›ï¼šæœ¬åœ°åŒ–çš„èƒœåˆ©</strong></h3>
<p>å¯¹äºå›½å†…å¼€å‘è€…æ¥è¯´ï¼ŒCursor è™½ç„¶å¥½ç”¨ï¼Œä½†ç—›ç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š<strong>ç½‘ç»œå»¶è¿Ÿ</strong>ã€<strong>æ”¯ä»˜å›°éš¾</strong>ã€<strong>æ•°æ®åˆè§„</strong>ã€‚</p>
<p>TRAE SOLO ä¸­å›½ç‰ˆå®Œç¾è§£å†³äº†è¿™äº›é—®é¢˜ï¼š</p>
<ul>
<li><strong>æ¨¡å‹æœ¬åœ°åŒ–ï¼š</strong> é»˜è®¤æ¥å…¥ <strong>è±†åŒ… (Doubao)</strong> æ¨¡å‹ã€‚ç»è¿‡å®æµ‹ï¼Œè±†åŒ…åœ¨ä¸­æ–‡è¯­å¢ƒç†è§£ã€ä¸­æ–‡æ³¨é‡Šç”Ÿæˆä»¥åŠå›½å†…ä¸»æµæŠ€æœ¯æ ˆï¼ˆå¦‚ Vue, Spring Boot, Uni-appï¼‰çš„æ”¯æŒä¸Šï¼Œè¡¨ç°æƒŠäººï¼Œç”šè‡³ä¼˜äº GPT-4oã€‚åŒæ—¶æ”¯æŒåˆ‡æ¢åˆ° <strong>DeepSeek</strong>ï¼Œæ»¡è¶³é€»è¾‘æ¨ç†éœ€æ±‚ã€‚</li>
<li><strong>æè‡´ä½å»¶è¿Ÿï¼š</strong> æ²¡æœ‰äº†è·¨æ´‹ç½‘ç»œçš„é˜»éš”ï¼Œä»£ç è¡¥å…¨å‡ ä¹æ˜¯æ¯«ç§’çº§çš„ï¼Œè¿™ç§ "è·Ÿæ‰‹" çš„æ„Ÿè§‰åœ¨å†™ä»£ç æ—¶æå…¶é‡è¦ã€‚</li>
<li><strong>é›¶é—¨æ§›ï¼š</strong> ä¸éœ€è¦ Visa å¡ï¼Œä¸éœ€è¦é­”æ³•ï¼Œä¸‹è½½å³ç”¨ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-7"><strong>å››ã€ Trae Solo vs Cursorï¼šæ€ä¹ˆé€‰ï¼Ÿ</strong></h3>
<p>å¾ˆå¤šæœ‹å‹è‚¯å®šä¼šé—®ï¼Œè¿™èƒ½ä¸èƒ½æ›¿ä»£ Cursorï¼Ÿæˆ‘åšäº†ä¸€ä¸ªç®€å•çš„å¯¹æ¯”è¡¨ï¼š</p>















































<table><thead><tr><th><strong>ç»´åº¦</strong></th><th><strong>Trae Solo (ä¸­å›½ç‰ˆ)</strong></th><th><strong>Cursor</strong></th><th><strong>è¯„ä»·</strong></th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒæ¨¡å‹</strong></td><td>è±†åŒ… / DeepSeek</td><td>Claude 3.5 / GPT-4o</td><td>è±†åŒ…ä¸­æ–‡ç†è§£æ›´å¥½ï¼ŒClaude é€»è¾‘ä¸Šé™ç•¥é«˜</td></tr><tr><td><strong>å“åº”é€Ÿåº¦</strong></td><td>æå¿« (å›½å†…èŠ‚ç‚¹)</td><td>è§†ç½‘ç»œç¯å¢ƒè€Œå®š</td><td><strong>Trae èƒœ</strong></td></tr><tr><td><strong>Agent èƒ½åŠ›</strong></td><td>Plan Mode (å¼ºè§„åˆ’)</td><td>Composer (å¼ºæ‰§è¡Œ)</td><td>å„æœ‰åƒç§‹ï¼ŒTrae æ›´ä¾§é‡æµç¨‹ç®¡æ§</td></tr><tr><td><strong>ä»·æ ¼</strong></td><td><strong>å…è´¹</strong> (ç›®å‰)</td><td>$20/æœˆ</td><td><strong>Trae èƒœ</strong></td></tr><tr><td><strong>å¤šä»»åŠ¡å¹¶è¡Œ</strong></td><td>æ”¯æŒ (å·¦ä¾§é¢æ¿)</td><td>è¾ƒå¼± (å•çº¿ç¨‹ä¸ºä¸»)</td><td><strong>Trae èƒœ</strong></td></tr><tr><td><strong>ç”Ÿæ€æ’ä»¶</strong></td><td>å…¼å®¹ VS Code æ’ä»¶</td><td>å…¼å®¹ VS Code æ’ä»¶</td><td>å¹³æ‰‹</td></tr></tbody></table>
<p><strong>ç»“è®ºï¼š</strong></p>
<ul>
<li>å¦‚æœä½ æ˜¯ <strong>å›½å†…å¼€å‘è€…</strong>ï¼Œå—å¤Ÿäº†ç½‘ç»œæ³¢åŠ¨ï¼Œä¸”ä¸»è¦å¤„ç†ä¸­æ–‡ä¸šåŠ¡é€»è¾‘ï¼Œ<strong>TRAE SOLO æ˜¯ä¸äºŒä¹‹é€‰</strong>ã€‚</li>
<li>å¦‚æœä½ æ˜¯ <strong>DeepSeek</strong> çš„ä¿¡å¾’ï¼Œå¸Œæœ›åœ¨ IDE é‡ŒåŸç”Ÿä½“éªŒ R1 çš„æ¨ç†èƒ½åŠ›ï¼ŒTRAE SOLO ç›´æ¥é›†æˆäº†æ»¡è¡€ç‰ˆã€‚</li>
<li>å¦‚æœä½ å·²ç»æ˜¯ Cursor çš„ä»˜è´¹æ·±åº¦ç”¨æˆ·ï¼Œä¸”é‡åº¦ä¾èµ– Claude 3.5 Sonnet çš„ç‰¹å®šä»£ç é£æ ¼ï¼Œå¯ä»¥æš‚æ—¶è§‚æœ›ï¼Œä½†å»ºè®®ä¸‹è½½ TRAE ä½œä¸ºä¸€ä¸ªå…è´¹çš„å¤‡é€‰æ–¹æ¡ˆã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-8"><strong>äº”ã€ æ€»ç»“ï¼šä» Copilot åˆ° Teammate</strong></h3>
<p>TRAE SOLO çš„å‘å¸ƒï¼Œæ ‡å¿—ç€ AI ç¼–ç¨‹å·¥å…·è¿›å…¥äº† <strong>2.0 æ—¶ä»£</strong>ã€‚æˆ‘ä»¬ä¸å†æ»¡è¶³äºä¸€ä¸ª "ä¼šè¡¥å…¨ä»£ç çš„ç¼–è¾‘å™¨"ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ª "æ‡‚ä¸šåŠ¡ã€èƒ½è§„åˆ’ã€ä¼šæ‰§è¡Œ" çš„ <strong>æ•°å­—åŒäº‹</strong>ã€‚</p>
<p>å­—èŠ‚è·³åŠ¨è¿™æ¬¡çš„ "å…è´¹ç­–ç•¥" + "æœ¬åœŸåŒ–æ¨¡å‹" æ˜¯ä¸€è®°é‡æ‹³ã€‚å¯¹äºå¹¿å¤§ä¸­å›½å¼€å‘è€…æ¥è¯´ï¼Œè¿™ä¸ä»…æ˜¯å·¥å…·çš„å‡çº§ï¼Œæ›´æ˜¯ç”Ÿäº§åŠ›çš„è§£æ”¾ã€‚</p>
<p>èµ¶ç´§å»å®˜ç½‘ä¸‹è½½ä½“éªŒï¼Œè®© AI å¸®ä½ å†™ä»£ç ï¼Œä½ è´Ÿè´£ Solo å…¨åœºï¼</p>
<blockquote>
<p><strong>äº’åŠ¨è¯é¢˜ï¼š</strong> ä½ è§‰å¾— TRAE SOLO èƒ½å–ä»£ä½ ç°åœ¨çš„ IDE å—ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„çœ‹æ³•ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UIAutomatorViewer å®‰è£…æŒ‡å— (macOS m3pro èŠ¯ç‰‡)]]></title>    <link>https://juejin.cn/post/7577356848338485283</link>    <guid>https://juejin.cn/post/7577356848338485283</guid>    <pubDate>2025-11-28T09:29:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577356848338485283" data-draft-id="7577417823342608419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UIAutomatorViewer å®‰è£…æŒ‡å— (macOS m3pro èŠ¯ç‰‡)"/> <meta itemprop="keywords" content="Android Studio"/> <meta itemprop="datePublished" content="2025-11-28T09:29:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç‹å…­å²"/> <meta itemprop="url" content="https://juejin.cn/user/2796746683729335"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UIAutomatorViewer å®‰è£…æŒ‡å— (macOS m3pro èŠ¯ç‰‡)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2796746683729335/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç‹å…­å²
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:29:40.000Z" title="Fri Nov 28 2025 09:29:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">UIAutomatorViewer å®‰è£…æŒ‡å— (macOS m3pro èŠ¯ç‰‡)</h2>
<h3 data-id="heading-1">ç¯å¢ƒä¿¡æ¯</h3>
<ul>
<li>ç³»ç»Ÿï¼šmacOS (Apple Silicon / M ç³»åˆ—èŠ¯ç‰‡)</li>
<li>Javaï¼šOpenJDK 25.0.1 (Homebrew å®‰è£…)</li>
<li>å®‰è£…æ—¥æœŸï¼š2025 å¹´ 11 æœˆ 28 æ—¥</li>
</ul>
<hr/>
<h3 data-id="heading-2">ä¸€ã€å®‰è£…æ­¥éª¤</h3>
<h4 data-id="heading-3">1. å®‰è£… Mavenï¼ˆä¸´æ—¶ä½¿ç”¨ï¼Œå®Œæˆåå¯å¸è½½ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash">brew install maven
mvn -version  <span class="hljs-comment"># éªŒè¯å®‰è£…</span>
</code></pre>
<h4 data-id="heading-4">2. å…‹éš†é¡¹ç›®ä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /Users/wang/Library/Android/sdk/platform-tools
git <span class="hljs-built_in">clone</span> https://github.com/cmlanche/uiautomatorviewer-standalone.git
</code></pre>
<h4 data-id="heading-5">3. æ›¿æ¢ SWT åº“ï¼ˆé€‚é… macOS ARM64ï¼‰</h4>
<p>åŸé¡¹ç›®çš„ SWT åº“æ˜¯ Windows ç‰ˆæœ¬ï¼Œéœ€è¦ä¸‹è½½ macOS ARM64 ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸‹è½½ macOS ARM64 ç‰ˆæœ¬çš„ SWT</span>
curl -L -o /tmp/swt-macos.zip <span class="hljs-string">"https://download.eclipse.org/eclipse/downloads/drops4/R-4.29-202309031000/swt-4.29-cocoa-macosx-aarch64.zip"</span>

<span class="hljs-comment"># è§£å‹</span>
<span class="hljs-built_in">cd</span> /tmp &amp;&amp; unzip -o swt-macos.zip -d swt-macos

<span class="hljs-comment"># æ›¿æ¢é¡¹ç›®ä¸­çš„ swt.jar</span>
<span class="hljs-built_in">cp</span> /tmp/swt-macos/swt.jar /Users/wang/Library/Android/sdk/platform-tools/uiautomatorviewer-standalone-1.0/libs/swt.jar
</code></pre>
<h4 data-id="heading-6">4. Maven æ‰“åŒ…</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /Users/wang/Library/Android/sdk/platform-tools/uiautomatorviewer-standalone-1.0
mvn clean package -DskipTests
</code></pre>
<h4 data-id="heading-7">5. å¤åˆ¶ jar åŒ…åˆ° adb åŒçº§ç›®å½•</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cp</span> target/uiautomatorviewer-standalone-1.1-all.jar /Users/wang/Library/Android/sdk/platform-tools/
</code></pre>
<h4 data-id="heading-8">6. é…ç½®å¿«æ·å‘½ä»¤</h4>
<p>å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° <code>~/.zshrc</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># UIAutomatorViewer å¿«æ·å‘½ä»¤</span>
<span class="hljs-built_in">alias</span> uiviewer=<span class="hljs-string">"cd /Users/wang/Library/Android/sdk/platform-tools &amp;&amp; /opt/homebrew/Cellar/openjdk/25.0.1/libexec/openjdk.jdk/Contents/Home/bin/java -XstartOnFirstThread -jar ./uiautomatorviewer-standalone-1.1-all.jar"</span>
</code></pre>
<p>ä½¿é…ç½®ç”Ÿæ•ˆï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.zshrc
</code></pre>
<h4 data-id="heading-9">7. æ¸…ç†ï¼ˆå¯é€‰ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ é™¤ä¸´æ—¶æ–‡ä»¶</span>
<span class="hljs-built_in">rm</span> -rf /tmp/swt-macos /tmp/swt-macos.zip

<span class="hljs-comment"># åˆ é™¤æºä»£ç ç›®å½•</span>
<span class="hljs-built_in">rm</span> -rf /Users/wang/Library/Android/sdk/platform-tools/uiautomatorviewer-standalone-1.0

<span class="hljs-comment"># å¸è½½ mavenï¼ˆä¸å†éœ€è¦ï¼‰</span>
brew uninstall maven
</code></pre>
<hr/>
<h3 data-id="heading-10">äºŒã€ä½¿ç”¨æ–¹æ³•</h3>
<p>åœ¨ä»»æ„ç»ˆç«¯è¾“å…¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">uiviewer
</code></pre>
<p>å³å¯å¯åŠ¨ UIAutomatorViewerã€‚</p>
<hr/>
<h3 data-id="heading-11">ä¸‰ã€é‡è¦è¯´æ˜</h3>
<ol>
<li><strong>å¿…é¡»ä½¿ç”¨ Java 17+</strong>ï¼šæ–°ç‰ˆ SWT åº“éœ€è¦ Java 17 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œæœ¬æœºä½¿ç”¨ Java 25</li>
<li><strong>å¿…é¡»åœ¨ adb ç›®å½•ä¸‹è¿è¡Œ</strong>ï¼šç¨‹åºéœ€è¦è°ƒç”¨ adbï¼Œæ‰€ä»¥ jar åŒ…å¿…é¡»æ”¾åœ¨ adb åŒçº§ç›®å½•</li>
<li><strong>å¿…é¡»ä½¿ç”¨ <code>-XstartOnFirstThread</code> å‚æ•°</strong>ï¼šè¿™æ˜¯ macOS ä¸Š SWT åº”ç”¨çš„è¦æ±‚</li>
</ol>
<hr/>
<h3 data-id="heading-12">å››ã€æ–‡ä»¶ä½ç½®</h3>





















<table><thead><tr><th>æ–‡ä»¶</th><th>è·¯å¾„</th></tr></thead><tbody><tr><td>jar åŒ…</td><td><code>/Users/wang/Library/Android/sdk/platform-tools/uiautomatorviewer-standalone-1.1-all.jar</code></td></tr><tr><td>adb</td><td><code>/Users/wang/Library/Android/sdk/platform-tools/adb</code></td></tr><tr><td>Java</td><td><code>/opt/homebrew/Cellar/openjdk/25.0.1/libexec/openjdk.jdk/Contents/Home/bin/java</code></td></tr></tbody></table>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¿å§†çº§æ•™ç¨‹ï¼š3åˆ†é’Ÿå¸¦ä½ è½»æ¾æ­å»ºN8Nè‡ªåŠ¨åŒ–å¹³å°ï¼(å†…é™„è§†é¢‘)]]></title>    <link>https://juejin.cn/post/7577609608827764762</link>    <guid>https://juejin.cn/post/7577609608827764762</guid>    <pubDate>2025-11-28T09:42:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577609608827764762" data-draft-id="7577583653728796710" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¿å§†çº§æ•™ç¨‹ï¼š3åˆ†é’Ÿå¸¦ä½ è½»æ¾æ­å»ºN8Nè‡ªåŠ¨åŒ–å¹³å°ï¼(å†…é™„è§†é¢‘)"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,å·¥ä½œæµå¼•æ“"/> <meta itemprop="datePublished" content="2025-11-28T09:42:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaä¸­æ–‡ç¤¾ç¾¤"/> <meta itemprop="url" content="https://juejin.cn/user/61228381386487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¿å§†çº§æ•™ç¨‹ï¼š3åˆ†é’Ÿå¸¦ä½ è½»æ¾æ­å»ºN8Nè‡ªåŠ¨åŒ–å¹³å°ï¼(å†…é™„è§†é¢‘)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/61228381386487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaä¸­æ–‡ç¤¾ç¾¤
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:42:10.000Z" title="Fri Nov 28 2025 09:42:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä»Šå¤©å¸¦å¤§å®¶å¹²ä¸€ä»¶å¤§äº‹â€”â€”<strong>åœ¨æœ¬åœ°éƒ¨ç½²è‡ªåŠ¨åŒ–ç¥å™¨ n8n</strong>ã€‚</p>
<p>å¾ˆå¤šåŒå­¦æƒ³ç”¨ n8n åšå·¥ä½œæµè‡ªåŠ¨åŒ–ï¼Œä½†åˆæ‹…å¿ƒæ•°æ®å®‰å…¨æˆ–è€…ä¸æƒ³ä»˜è®¢é˜…è´¹ã€‚æ²¡å…³ç³»ï¼Œå’±ä»¬ç›´æ¥éƒ¨ç½²åœ¨è‡ªå·±ç”µè„‘ä¸Šï¼Œæ•°æ®è‡ªå·±é€šè¿‡ MySQL æŒæ¡ï¼Œç¨³å¾—å¾ˆï¼</p>
<p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€æ•´ï¼Œä¿å§†çº§æ•™ç¨‹èµ°èµ·ã€‚</p>
<hr/>
<h2 data-id="heading-0">è§†é¢‘æ•™ç¨‹</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV11pSjBLEAi%2F" target="_blank" title="https://www.bilibili.com/video/BV11pSjBLEAi/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV11pâ€¦</a></p>
<h2 data-id="heading-1">ç¬¬ä¸€æ­¥ï¼šæå®š Docker Desktop</h2>
<p>n8n çš„æœ¬åœ°è¿è¡Œä¾èµ–äº Dockerï¼Œæ‰€ä»¥å’±ä»¬ç¬¬ä¸€æ­¥å¾—å…ˆæŠŠç¯å¢ƒæ­å¥½ã€‚</p>
<ol>
<li><strong>ä¸‹è½½è½¯ä»¶</strong>ï¼šå» Docker å®˜ç½‘ä¸‹è½½ <code>Docker Desktop</code>ã€‚æ˜¯ç”¨ Macã€Linux è¿˜æ˜¯ Windowsï¼Œçœ‹ä½ è‡ªå·±ç”µè„‘æƒ…å†µã€‚</li>
<li><strong>å®‰è£…æ³¨æ„</strong>ï¼š
<ul>
<li>Windows ç”¨æˆ·ä¸‹è½½å®Œå°±æ˜¯ä¸ª <code>.exe</code>ï¼ŒåŒå‡»ä¸€è·¯â€œä¸‹ä¸€æ­¥â€å°±è¡Œã€‚</li>
<li><strong>é‡ç‚¹æ¥äº†</strong>ï¼šDocker æœ¬è´¨æ˜¯å¸®ä½ è£…äº†ä¸€ä¸ª Linux å­ç³»ç»Ÿï¼Œæ‰€ä»¥å®‰è£…è¿‡ç¨‹å¯èƒ½ä¼šä¸‹è½½ä¸€äº›ç»„ä»¶ï¼Œè¿‡ç¨‹æœ‰ç‚¹é•¿ï¼Œ<strong>è¯·ä¿æŒç½‘ç»œé€šç•…ï¼Œè€å¿ƒç­‰å¾…</strong>ã€‚</li>
</ul>
</li>
<li><strong>éªŒè¯å®‰è£…</strong>ï¼šè£…å¥½åæ‰“å¼€ï¼Œå¦‚æœç•Œé¢åƒ QQ éŸ³ä¹ä¸€æ ·æ­£å¸¸æ˜¾ç¤ºï¼Œè¯´æ˜ç¯å¢ƒæå®šäº†ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-2">ç¬¬äºŒæ­¥ï¼šæ‹‰å– n8n é•œåƒ</h2>
<p>ç¯å¢ƒæœ‰äº†ï¼Œæ¥ä¸‹æ¥å»â€œè¿›è´§â€ã€‚</p>
<ol>
<li>æ‰“å¼€ Docker Desktopï¼Œç‚¹å‡»é¡¶éƒ¨çš„æœç´¢æ ã€‚</li>
<li>è¾“å…¥å…³é”®è¯ <strong><code>n8n</code></strong> å›è½¦ã€‚</li>
<li>å¦‚æœæœä¸åˆ°ï¼Œå¯èƒ½æ˜¯å› ä¸ºç½‘ç»œé—®é¢˜ï¼ˆä½ æ‡‚çš„ï¼‰ï¼Œè¿™æ—¶éœ€è¦åŠ ä¸Šä¸€ç‚¹â€œé­”æ³•â€ã€‚</li>
<li>æ‰¾åˆ°åˆ—è¡¨é‡Œçš„ç¬¬ä¸€ä¸ªç»“æœï¼Œç‚¹å‡» <strong><code>Pull</code></strong>ï¼ˆä¸‹è½½ï¼‰ã€‚
<ul>
<li><em>æ³¨æ„ï¼šé•œåƒå¤§æ¦‚ 1.6GBï¼Œæ¯”è¾ƒå¤§ï¼Œå»å–æ¯èŒ¶ç­‰å®ƒä¸‹å®Œã€‚</em></li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-3">ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨é…ç½®ï¼ˆâš ï¸æœ€å…³é”®çš„ä¸€æ­¥ï¼‰</h2>
<p>é•œåƒä¸‹å¥½äº†ï¼Œåˆ«æ€¥ç€ç‚¹ Run å®Œäº‹ï¼è¿™é‡Œé¢çš„<strong>å‚æ•°é…ç½®</strong>æ‰æ˜¯å†³å®šä½ åæœŸç”¨å¾—çˆ½ä¸çˆ½çš„å…³é”®ã€‚</p>
<p>æˆ‘ä»¬åœ¨ Docker çš„ Images åˆ—è¡¨é‡Œæ‰¾åˆ° n8nï¼Œç‚¹å‡» <strong>Run</strong> æŒ‰é’®ï¼Œè¿™æ—¶å€™ä¼šå¼¹å‡ºä¸€ä¸ªè®¾ç½®é¡µé¢ã€‚è¿™é‡Œæœ‰ä¸¤ç‚¹å¼ºçƒˆå»ºè®®å¤§å®¶é…ç½®ï¼š</p>
<h3 data-id="heading-4">1. æŒ‚è½½æ•°æ®ç›®å½•ï¼ˆé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼‰</h3>
<p>Docker å°±åƒä¸€ä¸ªç‹¬ç«‹çš„æ²™ç›’ç³»ç»Ÿã€‚å¦‚æœä½ ä¸æŠŠæ•°æ®æ˜ å°„å‡ºæ¥ï¼Œä¸‡ä¸€å®¹å™¨åˆ äº†ï¼Œä½ çš„å·¥ä½œæµå°±å…¨æ²¡äº†ã€‚</p>
<ul>
<li><strong>æ“ä½œ</strong>ï¼šåœ¨è®¾ç½®é‡Œåšä¸€ä¸ªè·¯å¾„æ˜ å°„ã€‚</li>
<li>æ¯”å¦‚æŠŠä½ æœ¬åœ° D ç›˜çš„ <code>D:\Date\n8n\mnt</code>ï¼ˆç¡®ä¿ä½ æœ¬åœ°æœ‰è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œè·¯å¾„ä¸è¦å¸¦ä¸­æ–‡å’Œç©ºæ ¼ï¼‰ï¼Œæ˜ å°„åˆ° Docker é‡Œçš„ n8n æ•°æ®å­˜å‚¨ç›®å½•ã€‚</li>
</ul>
<h3 data-id="heading-5">2. è¿æ¥ MySQL æ•°æ®åº“ï¼ˆå¼ºçƒˆæ¨è ğŸ”¥ï¼‰</h3>
<p>n8n é»˜è®¤ç”¨çš„æ˜¯ SQLite æ•°æ®åº“ï¼Œå®ƒæ˜¯å­˜æˆæ–‡ä»¶çš„ã€‚ä½†ç£Šå“¥<strong>å¼ºçƒˆå»ºè®®å¤§å®¶æ¢æˆ MySQL</strong>ï¼ŒåŸå› å¾ˆç®€å•ï¼š</p>
<ul>
<li><strong>æ€§èƒ½åŠæ‰“</strong>ï¼šSQLite å¹¶å‘å·®ï¼ŒMySQL æ€§èƒ½é«˜ã€‚</li>
<li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šMySQL æ”¯æŒå¤šäººè¿æ¥ï¼Œå¼ ä¸‰å†™çš„å·¥ä½œæµï¼Œæå››ä¹Ÿèƒ½åŒæ­¥çœ‹åˆ°ã€‚</li>
<li><strong>æ‰©å±•æ€§</strong>ï¼šä»¥åæ•°æ®é‡å¤§äº†ï¼ŒMySQL æ‰›å¾—ä½ã€‚</li>
</ul>
<p><strong>é…ç½®æ–¹æ³•ï¼š</strong>
åœ¨ Docker å¯åŠ¨é¡µé¢çš„ <strong>Environment Variablesï¼ˆç¯å¢ƒå˜é‡ï¼‰</strong> é‡Œï¼Œå¡«å…¥ä½ æœ¬åœ° MySQL çš„ä¿¡æ¯ï¼š</p>
<ul>
<li><strong>Host</strong>ï¼šå¡«å†™ä½ æœ¬æœºçš„å±€åŸŸç½‘ IP æˆ–ä¸“ç”¨å®¿ä¸»æœºåœ°å€ï¼ˆä¸è¦å¡« 127.0.0.1ï¼Œå› ä¸ºé‚£æ˜¯å®¹å™¨å†…éƒ¨ï¼‰ã€‚</li>
<li><strong>Port</strong>ï¼šé»˜è®¤ <code>3306</code>ã€‚</li>
<li><strong>Database</strong>ï¼šèµ·ä¸ªåï¼Œæ¯”å¦‚ <code>n8n</code>ã€‚</li>
<li><strong>User</strong>ï¼šä¸€èˆ¬å¡« <code>root</code>ã€‚</li>
<li><strong>Password</strong>ï¼šå¡«ä½ å®‰è£… MySQL æ—¶è®¾ç½®çš„å¯†ç ã€‚</li>
<li><strong>DB_TYPE</strong>ï¼šè®°å¾—è®¾ç½®ä¸º <code>mysqldb</code>ã€‚</li>
</ul>
<p><em>(PS: å¦‚æœä½ æœ¬åœ°è¿˜æ²¡è£… MySQLï¼Œå»ç¿»ç¿»æˆ‘ä¹‹å‰çš„ MySQL å®‰è£…æ•™ç¨‹ï¼Œå…ˆæŠŠæ•°æ®åº“è£…å¥½)</em></p>
<hr/>
<h2 data-id="heading-6">ç¬¬å››æ­¥ï¼šç«¯å£è®¾ç½®ä¸å¯åŠ¨</h2>
<ul>
<li><strong>ç«¯å£å·</strong>ï¼šé»˜è®¤æ˜¯ <code>5678</code>ã€‚é™¤éä½ åƒæˆ‘ä¸€æ ·æœ¬åœ°å·²ç»å ç”¨äº†è¿™ä¸ªç«¯å£ï¼ˆè§†é¢‘é‡Œæˆ‘æ”¹æˆäº† 5688ï¼‰ï¼Œå¦åˆ™å¤§å®¶<strong>ä¿æŒé»˜è®¤ 5678</strong> å°±è¡Œï¼Œçœå¾—åé¢éº»çƒ¦ã€‚</li>
</ul>
<p>ä¸€åˆ‡è®¾ç½®å¦¥å½“åï¼Œç‚¹å‡» <strong>Run</strong>ï¼
å½“ä½ åœ¨ Logsï¼ˆæ—¥å¿—ï¼‰é‡Œçœ‹åˆ°ç‰ˆæœ¬å·å’Œè®¿é—®åœ°å€æ—¶ï¼Œæ­å–œä½ ï¼Œå¯åŠ¨æˆåŠŸï¼</p>
<hr/>
<h2 data-id="heading-7">ç¬¬äº”æ­¥ï¼šåˆå§‹åŒ–ä¸æ¿€æ´»</h2>
<ol>
<li>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® <code>http://localhost:5678</code>ã€‚</li>
<li><strong>æ³¨å†Œè´¦å·</strong>ï¼šå¡«å†™é‚®ç®±ã€å§“åå’Œå¯†ç ã€‚è¿™ä¸ªè´¦å·æ˜¯ä¿å­˜åœ¨ä½ æœ¬åœ°æ•°æ®åº“çš„ï¼Œä¸ç”¨æ‹…å¿ƒéšç§æ³„éœ²ã€‚</li>
<li><strong>è·³è¿‡é—®å·</strong>ï¼šä¹‹åçš„è°ƒæŸ¥é—®å·å¯ä»¥è·³è¿‡ã€‚</li>
<li><strong>æ¿€æ´»é«˜çº§åŠŸèƒ½</strong>ï¼ˆå¯é€‰ï¼‰ï¼š
<ul>
<li>åœ¨è®¾ç½®é‡Œå¡«ä¸ªé‚®ç®±ï¼Œç‚¹å‡» Sendï¼Œå»é‚®ç®±æ‹¿ä¸ª Key å¡«å›æ¥ã€‚</li>
<li>è¿™æ ·å¯ä»¥è§£é”â€œå·¥ä½œæµåˆ†ç»„â€ç­‰åŠŸèƒ½ï¼Œç™½å«–çš„åŠŸèƒ½ä¸è¦ç™½ä¸è¦å˜›ï¼</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-8">æå®šæ”¶å·¥ï¼</h2>
<p>åˆ°è¿™é‡Œï¼Œä½ çš„æœ¬åœ° n8n å°±å½»åº•æ­å»ºå¥½äº†ã€‚ä¸‹ä¸€æ­¥ï¼Œä¸ç®¡ä½ æ˜¯æƒ³åšè‡ªåŠ¨å›å¤ã€æ•°æ®æŠ“å–è¿˜æ˜¯åŠå…¬è‡ªåŠ¨åŒ–ï¼Œéƒ½å¯ä»¥é€šè¿‡æ‹–æ‹½èŠ‚ç‚¹æ¥å®ç°äº†ã€‚</p>
<p>å…³äºå¦‚ä½•æ­å»º n8n å°±è®²åˆ°è¿™é‡Œï¼Œå¤§å®¶èµ¶ç´§åŠ¨æ‰‹è¯•è¯•å§ï¼æœ‰é—®é¢˜è¯„è®ºåŒºè§ï¼ğŸ‘‡</p>
<blockquote>
<p>æœ¬æ–‡å·²æ”¶å½•åˆ°æˆ‘çš„æŠ€æœ¯å°ç«™ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.javacn.site" target="_blank" title="https://www.javacn.site" ref="nofollow noopener noreferrer">www.javacn.site</a>ï¼Œç½‘ç«™åŒ…å«çš„å†…å®¹æœ‰ï¼š<strong>LangChain/N8N/SpringAI/SpringAIAlibaba/LangChain4j/Dify/Coze/AIå®æˆ˜é¡¹ç›®/AIå¸¸è§é¢è¯•é¢˜</strong>ç­‰æŠ€æœ¯åˆ†äº«ï¼Œæ¬¢è¿å„ä½å¤§ä½¬å…‰ä¸´æŒ‡å¯¼~</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript è¯æ³•ä½œç”¨åŸŸä¸é—­åŒ…ï¼šä»åº•å±‚åŸç†åˆ°å®æˆ˜ç†è§£]]></title>    <link>https://juejin.cn/post/7577345758036869120</link>    <guid>https://juejin.cn/post/7577345758036869120</guid>    <pubDate>2025-11-28T09:41:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577345758036869120" data-draft-id="7577284968922660864" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript è¯æ³•ä½œç”¨åŸŸä¸é—­åŒ…ï¼šä»åº•å±‚åŸç†åˆ°å®æˆ˜ç†è§£"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-28T09:41:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ‰æ„ä¹‰"/> <meta itemprop="url" content="https://juejin.cn/user/1739866211617625"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript è¯æ³•ä½œç”¨åŸŸä¸é—­åŒ…ï¼šä»åº•å±‚åŸç†åˆ°å®æˆ˜ç†è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1739866211617625/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ‰æ„ä¹‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:41:42.000Z" title="Fri Nov 28 2025 09:41:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JSè¿è¡Œæœºåˆ¶</h2>
<h2 data-id="heading-1">è¯æ³•ä½œç”¨åŸŸ</h2>
<p>â€œè¯æ³•â€è¿™ä¸ªè¯å¬èµ·æ¥æœ‰ç‚¹æŠ½è±¡ï¼Œå…¶å®å®ƒçš„æ„æ€å¾ˆç®€å•ï¼š <strong>â€œè¯æ³•â€ = â€œå’Œä½ å†™ä»£ç çš„ä½ç½®æœ‰å…³â€</strong> ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼ŒJavaScript ä¸­å¾ˆå¤šè¡Œä¸ºåœ¨ä½ <strong>å†™ä»£ç çš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†</strong>ï¼Œè€Œä¸æ˜¯ç­‰åˆ°ç¨‹åºè¿è¡Œæ—¶æ‰å†³å®šã€‚è¿™ç§ç‰¹æ€§ä¹Ÿå«<strong>é™æ€ä½œç”¨åŸŸ</strong>ï¼ˆstatic scopingï¼‰ã€‚</p>
<p>ä½ å¯ä»¥è¿™æ ·ç†è§£ï¼š</p>
<blockquote>
<p>ä»£ç æ€ä¹ˆå†™çš„ï¼Œå®ƒå°±æ€ä¹ˆæ‰§è¡Œâ€”â€”è¿™éå¸¸ç¬¦åˆæˆ‘ä»¬çš„ç›´è§‰ã€‚</p>
</blockquote>
<p>æ¯”å¦‚ï¼Œ<code>let</code> å’Œ <code>const</code> å£°æ˜çš„å˜é‡ä¹‹æ‰€ä»¥ä¸èƒ½åœ¨å£°æ˜å‰ä½¿ç”¨ï¼ˆä¼šæŠ¥â€œæš‚æ—¶æ€§æ­»åŒºâ€é”™è¯¯ï¼‰ï¼Œå°±æ˜¯å› ä¸ºå®ƒä»¬å±äº<strong>è¯æ³•ç¯å¢ƒ</strong>çš„ä¸€éƒ¨åˆ†ã€‚è€Œè¯æ³•ç¯å¢ƒæ­£æ˜¯ç”±ä½ åœ¨æºä»£ç ä¸­çš„ä¹¦å†™ä½ç½®å†³å®šçš„ã€‚ä½ æŠŠå˜é‡å†™åœ¨å“ªé‡Œï¼Œå®ƒå°±åœ¨å“ªé‡Œç”Ÿæ•ˆï¼Œä¸èƒ½â€œç©¿è¶Šâ€åˆ°è¿˜æ²¡å†™åˆ°çš„åœ°æ–¹å»ç”¨â€”â€”è¿™å¾ˆåˆç†ï¼Œä¹Ÿå¾ˆç›´è§‚ã€‚</p>
<p>æ‰€ä»¥ï¼Œâ€œè¯æ³•â€æœ¬è´¨ä¸Šå°±æ˜¯ï¼š<strong>çœ‹ä»£ç ç»“æ„ï¼Œè€Œä¸æ˜¯çœ‹è¿è¡Œè¿‡ç¨‹</strong>ã€‚</p>
<p>çœ‹ä¸€æ®µå…³äºè¯æ³•ä½œç”¨åŸŸçš„ä»£ç </p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myName);
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> myName = <span class="hljs-string">'æå®¢é‚¦'</span>
    <span class="hljs-title function_">bar</span>()<span class="hljs-comment">// è¿è¡Œæ—¶</span>
}
<span class="hljs-keyword">var</span> myName = <span class="hljs-string">'æå®¢æ—¶é—´'</span>
<span class="hljs-title function_">foo</span>();
</code></pre>
<p>è¿™é‡Œè¾“å‡ºçš„æ˜¯</p>
<p><code>æå®¢æ—¶é—´</code>
ä¸ºä»€ä¹ˆè¾“å‡ºçš„ä¸æ˜¯ <code>"æå®¢é‚¦"</code>ï¼Ÿ</p>
<p>å› ä¸º <code>bar</code> å‡½æ•°æ˜¯åœ¨<strong>å…¨å±€ä½œç”¨åŸŸä¸­å£°æ˜çš„</strong>ï¼Œæ‰€ä»¥å®ƒçš„è¯æ³•ä½œç”¨åŸŸé“¾åœ¨å®šä¹‰æ—¶å°±å·²ç»å›ºå®šä¸ºï¼š<strong>è‡ªèº«ä½œç”¨åŸŸ â†’ å…¨å±€ä½œç”¨åŸŸ</strong>ã€‚</p>
<p>JavaScript æŸ¥æ‰¾å˜é‡æ—¶ï¼Œéµå¾ªçš„æ˜¯<strong>è¯æ³•ä½œç”¨åŸŸè§„åˆ™</strong>â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåªå…³å¿ƒ<strong>å‡½æ•°åœ¨å“ªé‡Œè¢«å®šä¹‰</strong>ï¼Œè€Œä¸å…³å¿ƒ<strong>å‡½æ•°åœ¨å“ªé‡Œè¢«è°ƒç”¨</strong>ã€‚</p>
<p>å½“ <code>bar</code> å†…éƒ¨è®¿é—®å˜é‡ï¼ˆæ¯”å¦‚ <code>test</code> æˆ– <code>myName</code>ï¼‰æ—¶ï¼Œå¼•æ“ä¼šå…ˆåœ¨ <code>bar</code> è‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾ï¼›å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±æ²¿ç€è¯æ³•ä½œç”¨åŸŸé“¾å‘å¤–å±‚æŸ¥æ‰¾ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥è·³åˆ°<strong>å…¨å±€ä½œç”¨åŸŸ</strong>ï¼Œè€Œ<strong>ä¸ä¼šè¿›å…¥ <code>foo</code> çš„ä½œç”¨åŸŸ</strong>â€”â€”å°½ç®¡ <code>bar</code> æ˜¯åœ¨ <code>foo</code> é‡Œé¢è¢«è°ƒç”¨çš„ã€‚</p>
<p>å› æ­¤ï¼Œ<code>bar</code> æ ¹æœ¬â€œçœ‹ä¸è§â€ <code>foo</code> ä¸­çš„ <code>myName = "æå®¢é‚¦"</code>ï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•è¾“å‡ºå®ƒã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5549c7fe79f4478ca3ce531ffe544a3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oSP5LmJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764927702&amp;x-signature=M6ho%2BlaleZNY%2FuR%2Bv%2Fv6zNtSSag%3D" alt="image.png" loading="lazy"/></p>
<p>æ€»ç»“ï¼š</p>
<blockquote>
<p>JavaScript ä½¿ç”¨ <strong>è¯æ³•ä½œç”¨åŸŸï¼ˆLexical Scopingï¼‰</strong> ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°åœ¨<strong>å®šä¹‰æ—¶</strong>å°±å†³å®šäº†å®ƒèƒ½è®¿é—®å“ªäº›å˜é‡ï¼Œè€Œä¸æ˜¯åœ¨<strong>è°ƒç”¨æ—¶</strong>ã€‚</p>
</blockquote>
<h2 data-id="heading-2">è¯æ³•ä½œç”¨åŸŸé“¾ï¼šå˜é‡æŸ¥æ‰¾çš„è·¯å¾„</h2>
<p>å½“ JavaScript å¼•æ“æ‰§è¡Œä»£ç æ—¶ï¼Œä¼šä¸ºæ¯ä¸€æ®µå¯æ‰§è¡Œä»£ç åˆ›å»ºä¸€ä¸ª <strong>æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecution Contextï¼‰</strong> ã€‚<br/>
æ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡éƒ½åŒ…å«ä¸€ä¸ª <strong>è¯æ³•ç¯å¢ƒï¼ˆLexical Environmentï¼‰</strong> ï¼Œå®ƒä¸ä»…ä¿å­˜äº†å½“å‰ä½œç”¨åŸŸä¸­å£°æ˜çš„å˜é‡ï¼Œè¿˜æŒæœ‰ä¸€ä¸ªæŒ‡å‘<strong>å¤–å±‚è¯æ³•ç¯å¢ƒ</strong>çš„å¼•ç”¨ã€‚è¿™äº›åµŒå¥—çš„è¯æ³•ç¯å¢ƒè¿æ¥èµ·æ¥ï¼Œå°±å½¢æˆäº† <strong>ä½œç”¨åŸŸé“¾ï¼ˆScope Chainï¼‰</strong> ã€‚</p>
<ul>
<li><strong>å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ä½äºè°ƒç”¨æ ˆçš„åº•éƒ¨ï¼Œæ˜¯ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºçš„ã€‚</li>
<li>æ¯å½“è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶å°†å…¶å‹å…¥è°ƒç”¨æ ˆã€‚</li>
<li>å½“éœ€è¦æŸ¥æ‰¾æŸä¸ªå˜é‡æ—¶ï¼ŒJavaScript ä¼šä»å½“å‰ä½œç”¨åŸŸå¼€å§‹ï¼Œ<strong>æ²¿ç€ä½œç”¨åŸŸé“¾ç”±å†…å‘å¤–é€å±‚æŸ¥æ‰¾</strong>ï¼Œç›´åˆ°æ‰¾åˆ°è¯¥å˜é‡ï¼Œæˆ–æœ€ç»ˆåˆ°è¾¾å…¨å±€ä½œç”¨åŸŸä¸ºæ­¢ã€‚</li>
</ul>
<p>è¿™ç§æœºåˆ¶ç¡®ä¿äº†å˜é‡è®¿é—®éµå¾ªè¯æ³•ä½œç”¨åŸŸè§„åˆ™â€”â€”å³â€œåœ¨å“ªé‡Œå®šä¹‰ï¼Œå°±çœ‹å“ªé‡Œçš„å˜é‡â€ï¼Œè€Œä¸æ˜¯â€œåœ¨å“ªé‡Œè°ƒç”¨â€ã€‚</p>
<p>çœ‹çœ‹è¿™æ®µå…³äºä½œç”¨åŸŸé“¾å’Œå—çº§ä½œç”¨åŸŸçš„ä»£ç ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span> () {
  <span class="hljs-keyword">var</span> myName = <span class="hljs-string">"æå®¢ä¸–ç•Œ"</span>;
  <span class="hljs-keyword">let</span> test1 = <span class="hljs-number">100</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-number">1</span>) {
    <span class="hljs-keyword">let</span> myName = <span class="hljs-string">"Chrome æµè§ˆå™¨"</span>  <span class="hljs-comment">// 1.å…ˆåœ¨è¯æ³•ç¯å¢ƒæŸ¥æ‰¾ä¸€ä¸‹</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(test)
  }
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">var</span> myName = <span class="hljs-string">"æå®¢é‚¦"</span>;
  <span class="hljs-keyword">let</span> test = <span class="hljs-number">2</span>;
  {
    <span class="hljs-keyword">let</span> test = <span class="hljs-number">3</span>;
    <span class="hljs-title function_">bar</span>()
  }
}
<span class="hljs-keyword">var</span> myName = <span class="hljs-string">"æå®¢æ—¶é—´"</span>;
<span class="hljs-keyword">let</span> myAge = <span class="hljs-number">10</span>;
<span class="hljs-keyword">let</span> test = <span class="hljs-number">1</span>;
<span class="hljs-title function_">foo</span>();
</code></pre>
<p>è¿™æ®µä»£ç çš„æ‰§è¡Œç»“æœ<strong>ä¸ä¼šæŠ¥é”™</strong>ï¼Œè€Œæ˜¯ä¼šæ­£å¸¸è¾“å‡ºï¼š</p>
<pre><code class="hljs language-text" lang="text">1
</code></pre>
<p>åŸå› æ­£æ˜¯åŸºäº JavaScript çš„ <strong>è¯æ³•ä½œç”¨åŸŸï¼ˆLexical Scopingï¼‰</strong> æœºåˆ¶ã€‚</p>
<p>è™½ç„¶ <code>bar()</code> æ˜¯åœ¨ <code>foo()</code> å†…éƒ¨è¢«è°ƒç”¨çš„ï¼Œä½†å®ƒçš„<strong>å£°æ˜ä½ç½®åœ¨å…¨å±€ä½œç”¨åŸŸ</strong>ã€‚å› æ­¤ï¼Œå½“ <code>bar</code> å†…éƒ¨å¼•ç”¨å˜é‡ <code>test</code> æ—¶ï¼ŒJavaScript å¼•æ“ä¼šä» <code>bar</code> è‡ªèº«çš„ä½œç”¨åŸŸå¼€å§‹æŸ¥æ‰¾ï¼›æ‰¾ä¸åˆ°æ—¶ï¼Œå°±æ²¿ç€<strong>è¯æ³•ä½œç”¨åŸŸé“¾</strong>å‘å¤–å±‚æŸ¥æ‰¾â€”â€”ä¹Ÿå°±æ˜¯ç›´æ¥è·³åˆ°<strong>å…¨å±€ä½œç”¨åŸŸ</strong>ï¼Œè€Œä¸ä¼šè¿›å…¥ <code>foo</code> çš„ä½œç”¨åŸŸã€‚</p>
<p>ç”±äºå…¨å±€ä½œç”¨åŸŸä¸­å­˜åœ¨ <code>let test = 1;</code>ï¼Œæ‰€ä»¥ <code>console.log(test)</code> æœ€ç»ˆè¾“å‡ºçš„æ˜¯ <code>1</code>ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5dfe7ee140624ad8b3313040440e5751~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oSP5LmJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764927702&amp;x-signature=b6q3FaQtnG0ev1OnG%2BrruIwaBrI%3D" alt="image.png" loading="lazy"/></p>
<p>æ¢å¥è¯è¯´ï¼š<strong>å˜é‡æŸ¥æ‰¾çœ‹çš„æ˜¯å‡½æ•°â€œåœ¨å“ªé‡Œå®šä¹‰â€ï¼Œè€Œä¸æ˜¯â€œåœ¨å“ªé‡Œè°ƒç”¨â€</strong> ã€‚è¿™æ¡ç”±å†…å‘å¤–çš„æŸ¥æ‰¾è·¯å¾„ï¼Œå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ <strong>ä½œç”¨åŸŸé“¾</strong>ã€‚</p>
<p>åœ¨ JavaScript çš„è®¾è®¡ä¸­ï¼Œæ¯ä¸ªå‡½æ•°çš„<strong>æ‰§è¡Œä¸Šä¸‹æ–‡</strong>éƒ½åŒ…å«ä¸€ä¸ªå†…éƒ¨æŒ‡é’ˆï¼ˆé€šå¸¸ç§°ä¸º <code>[[Outer]]</code> æˆ– â€œouter å¼•ç”¨â€ï¼‰ï¼Œå®ƒæŒ‡å‘è¯¥å‡½æ•°<strong>å®šä¹‰æ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸ</strong>â€”â€”ä¹Ÿå°±æ˜¯å®ƒçš„<strong>è¯æ³•å¤–å±‚ç¯å¢ƒ</strong>ã€‚</p>
<p>å½“ä½ åœ¨ä»£ç ä¸­åµŒå¥—å®šä¹‰å¤šä¸ªå‡½æ•°æ—¶ï¼Œæ¯ä¸ªå‡½æ•°éƒ½ä¼šé€šè¿‡è¿™ä¸ª <code>outer</code> æŒ‡é’ˆï¼Œé“¾æ¥åˆ°å®ƒä¸Šä¸€å±‚çš„è¯æ³•ç¯å¢ƒã€‚è¿™æ ·ä¸€å±‚å¥—ä¸€å±‚ï¼Œå°±å½¢æˆäº†ä¸€æ¡<strong>é™æ€çš„ã€ç”±ä»£ç ç»“æ„å†³å®šçš„é“¾å¼ç»“æ„</strong>ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <strong>è¯æ³•ä½œç”¨åŸŸé“¾ï¼ˆLexical Scope Chainï¼‰</strong> ã€‚</p>
<p>æ­£æ˜¯è¿™æ¡é“¾ï¼Œå†³å®šäº†å˜é‡æŸ¥æ‰¾çš„è·¯å¾„ï¼šä»å½“å‰ä½œç”¨åŸŸå¼€å§‹ï¼Œæ²¿ç€ <code>outer</code> æŒ‡é’ˆé€çº§å‘å¤–æœç´¢ï¼Œç›´åˆ°å…¨å±€ä½œç”¨åŸŸä¸ºæ­¢ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87db148438d64f6f82d166cc9e1694e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oSP5LmJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764927702&amp;x-signature=n791ysmYtd5uDKD%2FmnEDUzLsJ4Q%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™ç§æœºåˆ¶æ˜¯ JavaScript é—­åŒ…ã€å˜é‡è®¿é—®å’Œä½œç”¨åŸŸè¡Œä¸ºçš„æ ¸å¿ƒåŸºç¡€ã€‚ç†è§£äº† <code>outer</code> æŒ‡é’ˆå¦‚ä½•è¿æ¥å„ä¸ªè¯æ³•ç¯å¢ƒï¼Œä½ å°±çœŸæ­£æŒæ¡äº†è¯æ³•ä½œç”¨åŸŸé“¾çš„æœ¬è´¨ã€‚</p>
<h2 data-id="heading-3">é—­åŒ… â€”â€”å‰é¢å†…å®¹çš„ä¼˜é›…å‡å</h2>
<p>é—­åŒ…ï¼ˆClosureï¼‰æ˜¯ JavaScript ä¸­ä¸€ä¸ªåŸºäº<strong>è¯æ³•ä½œç”¨åŸŸ</strong>çš„æ ¸å¿ƒæœºåˆ¶ã€‚æŒæ¡å®ƒï¼Œä¸ä»…èƒ½å†™å‡ºæ›´çµæ´»ã€æ¨¡å—åŒ–çš„ä»£ç ï¼Œè¿˜èƒ½è½»æ¾åº”å¯¹é¢è¯•ä¸­çš„é«˜é¢‘é—®é¢˜ã€‚ä¸‹é¢ç”¨é€šä¿—æ˜“æ‡‚çš„æ–¹å¼ï¼Œå¸¦ä½ å½»åº•ææ‡‚é—­åŒ…ã€‚</p>
<hr/>
<h3 data-id="heading-4">ä¸€ã€ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ</h3>
<blockquote>
<p><strong>é—­åŒ… = ä¸€ä¸ªå‡½æ•° + å®ƒå®šä¹‰æ—¶æ‰€å¤„çš„è¯æ³•ç¯å¢ƒã€‚</strong></p>
</blockquote>
<p>æ¢å¥è¯è¯´ï¼š<br/>
å½“ä¸€ä¸ªå‡½æ•°å³ä½¿åœ¨<strong>è‡ªå·±åŸå§‹ä½œç”¨åŸŸä¹‹å¤–è¢«è°ƒç”¨</strong>ï¼Œä»ç„¶èƒ½å¤Ÿ<strong>è®¿é—®å¹¶æ“ä½œå…¶å®šä¹‰æ—¶æ‰€åœ¨ä½œç”¨åŸŸä¸­çš„å˜é‡</strong>ï¼Œè¿™ä¸ªå‡½æ•°å°±å½¢æˆäº†é—­åŒ…ã€‚</p>
<p>è¿™å¹¶ä¸æ˜¯é­”æ³•ï¼Œè€Œæ˜¯ JavaScript <strong>è¯æ³•ä½œç”¨åŸŸæœºåˆ¶çš„è‡ªç„¶ç»“æœ</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-5">äºŒã€é—­åŒ…å½¢æˆçš„ä¸¤ä¸ªå¿…è¦æ¡ä»¶ï¼ˆç¼ºä¸€ä¸å¯ï¼‰</h3>
<ol>
<li><strong>å‡½æ•°åµŒå¥—</strong>ï¼šå†…éƒ¨å‡½æ•°å¼•ç”¨äº†å¤–éƒ¨å‡½æ•°çš„å˜é‡ï¼›</li>
<li><strong>å†…éƒ¨å‡½æ•°è¢«æš´éœ²åˆ°å¤–éƒ¨</strong>ï¼šæ¯”å¦‚é€šè¿‡Â <code>return</code>Â è¿”å›ã€èµ‹å€¼ç»™å…¨å±€å˜é‡ã€ä½œä¸ºå›è°ƒä¼ é€’ç­‰ï¼Œå¹¶åœ¨å¤–éƒ¨è¢«è°ƒç”¨ã€‚</li>
</ol>
<p>åªæœ‰åŒæ—¶æ»¡è¶³è¿™ä¸¤ç‚¹ï¼Œé—­åŒ…æ‰ä¼šçœŸæ­£â€œç”Ÿæ•ˆâ€ã€‚</p>
<hr/>
<h3 data-id="heading-6">ä¸‰ã€ç»å…¸ç¤ºä¾‹ï¼šç›´è§‚æ„Ÿå—é—­åŒ…</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">var</span> myName = <span class="hljs-string">"æå®¢æ—¶é—´"</span>;
  <span class="hljs-keyword">let</span> test1 = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">const</span> test2 = <span class="hljs-number">2</span>; <span class="hljs-comment">// æ³¨æ„ï¼štest2 æœªè¢«å†…éƒ¨å‡½æ•°ä½¿ç”¨</span>

  <span class="hljs-keyword">var</span> innerBar = {
    <span class="hljs-attr">getName</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(test1); <span class="hljs-comment">// å¼•ç”¨äº†å¤–éƒ¨å˜é‡ test1</span>
      <span class="hljs-keyword">return</span> myName;      <span class="hljs-comment">// å¼•ç”¨äº†å¤–éƒ¨å˜é‡ myName</span>
    },
    <span class="hljs-attr">setName</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">newName</span>) {
      myName = newName;   <span class="hljs-comment">// ä¿®æ”¹å¤–éƒ¨å˜é‡ myName</span>
    }
  };

  <span class="hljs-keyword">return</span> innerBar; <span class="hljs-comment">// å°†å†…éƒ¨å¯¹è±¡è¿”å›ï¼Œä½¿å†…éƒ¨å‡½æ•°å¯åœ¨å¤–éƒ¨è°ƒç”¨</span>
}

<span class="hljs-comment">// æ‰§è¡Œ fooï¼Œè·å–è¿”å›çš„å¯¹è±¡</span>
<span class="hljs-keyword">var</span> bar = <span class="hljs-title function_">foo</span>(); <span class="hljs-comment">// æ­¤æ—¶ foo å·²æ‰§è¡Œå®Œæ¯•ï¼Œä¸Šä¸‹æ–‡å‡ºæ ˆ</span>

<span class="hljs-comment">// åœ¨å¤–éƒ¨è°ƒç”¨å†…éƒ¨å‡½æ•° â€”â€” é—­åŒ…å¼€å§‹å·¥ä½œï¼</span>
bar.<span class="hljs-title function_">setName</span>(<span class="hljs-string">"æå®¢é‚¦"</span>);
bar.<span class="hljs-title function_">getName</span>();               <span class="hljs-comment">// è¾“å‡ºï¼š1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bar.<span class="hljs-title function_">getName</span>());  <span class="hljs-comment">// è¾“å‡ºï¼š1 å’Œ "æå®¢é‚¦"</span>
</code></pre>
<p>âœ… <strong>è¾“å‡ºç»“æœï¼š</strong></p>
<pre><code class="hljs language-text" lang="text">1
1
æå®¢é‚¦
</code></pre>
<hr/>
<h3 data-id="heading-7">å››ã€å…³é”®é—®é¢˜ï¼šä¸ºä»€ä¹ˆ foo çš„å˜é‡æ²¡è¢«åƒåœ¾å›æ”¶ï¼Ÿ</h3>
<ul>
<li>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå‡½æ•°æ‰§è¡Œç»“æŸåï¼Œå…¶å±€éƒ¨å˜é‡ä¼šè¢«åƒåœ¾å›æ”¶ã€‚</p>
</li>
<li>
<p>ä½†åœ¨é—­åŒ…åœºæ™¯ä¸­ï¼Œ<strong>åªè¦å†…éƒ¨å‡½æ•°ä»è¢«å¤–éƒ¨å¼•ç”¨</strong>ï¼ŒJavaScript å¼•æ“å°±ä¼š<strong>ä¿ç•™è¯¥å‡½æ•°æ‰€ä¾èµ–çš„å¤–éƒ¨å˜é‡</strong>ã€‚</p>
</li>
<li>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼š</p>
<ul>
<li><code>getName</code>Â å’ŒÂ <code>setName</code>Â å¼•ç”¨äº†Â <code>myName</code>Â å’ŒÂ <code>test1</code>Â â†’ è¿™ä¸¤ä¸ªå˜é‡è¢«â€œæ•è·â€å¹¶ä¿ç•™åœ¨å†…å­˜ä¸­ï¼›</li>
<li><code>test2</code>Â æ²¡æœ‰è¢«ä»»ä½•å‡½æ•°ä½¿ç”¨ â†’ è¢«æ­£å¸¸å›æ”¶ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ“Œ é‡ç‚¹ï¼š<strong>é—­åŒ…ä¸ä¼šé˜»æ­¢æ•´ä¸ªå‡½æ•°ä¸Šä¸‹æ–‡é”€æ¯ï¼Œåªä¿ç•™â€œè¢«å¼•ç”¨â€çš„å˜é‡</strong>ã€‚<br/>
è¿™æ—¢ä¿è¯äº†åŠŸèƒ½ï¼Œåˆé¿å…äº†å†…å­˜æµªè´¹ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04fe434f36f340a29cbaff61e5f2b41f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oSP5LmJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764927702&amp;x-signature=uA2XYriJBE4wgczrHvM3A7XpWvE%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-8">äº”ã€é—­åŒ…çš„æœ¬è´¨ä¸è¯æ³•ä½œç”¨åŸŸçš„å…³ç³»</h3>
<h4 data-id="heading-9">1. é—­åŒ…çš„æœ¬è´¨</h4>
<p>é—­åŒ…ä¸æ˜¯æŸç§ç‰¹æ®Šè¯­æ³•ï¼Œè€Œæ˜¯ä¸€ç§<strong>è¿è¡Œæ—¶è¡Œä¸º</strong>ï¼š</p>
<blockquote>
<p><strong>å‡½æ•° + å®ƒå‡ºç”Ÿæ—¶çš„è¯æ³•ç¯å¢ƒ = é—­åŒ…</strong></p>
</blockquote>
<p>ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆï¼šå‡½æ•°éšèº«å¸¦äº†ä¸€ä¸ªâ€œèƒŒåŒ…â€ï¼Œé‡Œé¢è£…ç€å®ƒå®šä¹‰æ—¶èƒ½è®¿é—®çš„æ‰€æœ‰å¤–éƒ¨å˜é‡ã€‚æ— è®ºå®ƒèµ°åˆ°å“ªé‡Œï¼ˆå“ªæ€•åœ¨å…¨å±€è°ƒç”¨ï¼‰ï¼Œéƒ½èƒ½ä»èƒŒåŒ…é‡Œå–ç”¨æˆ–ä¿®æ”¹è¿™äº›æ•°æ®ã€‚</p>
<h4 data-id="heading-10">2. ä¸è¯æ³•ä½œç”¨åŸŸçš„å…³è”</h4>
<ul>
<li><strong>è¯æ³•ä½œç”¨åŸŸ</strong>ï¼šå˜é‡çš„ä½œç”¨åŸŸç”±<strong>ä»£ç ä¹¦å†™ä½ç½®</strong>å†³å®šï¼ˆé™æ€çš„ã€ç¼–è¯‘æœŸç¡®å®šï¼‰ã€‚</li>
<li><strong>é—­åŒ…</strong>ï¼šæ­£æ˜¯è¯æ³•ä½œç”¨åŸŸåœ¨<strong>å‡½æ•°è¢«ä¼ é€’åˆ°å¤–éƒ¨åä¾ç„¶ç”Ÿæ•ˆ</strong>çš„ä½“ç°ã€‚</li>
</ul>
<blockquote>
<p>âœ… æ‰€ä»¥è¯´ï¼š<strong>é—­åŒ…ä¸æ˜¯é¢å¤–ç‰¹æ€§ï¼Œè€Œæ˜¯è¯æ³•ä½œç”¨åŸŸ + å‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘ çš„å¿…ç„¶äº§ç‰©ã€‚</strong></p>
</blockquote>
<hr/>
<blockquote>
<p>ğŸ’¡ <strong>è®°ä½ä¸€å¥è¯</strong>ï¼š<br/>
<strong>é—­åŒ…ä¸æ˜¯â€œä¸è®©å˜é‡é”€æ¯â€ï¼Œè€Œæ˜¯â€œè¿˜æœ‰äººç”¨ï¼Œæ‰€ä»¥ä¸èƒ½é”€æ¯â€ã€‚</strong><br/>
å®ƒè®© JavaScript å®ç°äº†ç§æœ‰çŠ¶æ€ã€æ¨¡å—å°è£…ã€å›è°ƒè®°å¿†ç­‰å¼ºå¤§èƒ½åŠ›ã€‚</p>
</blockquote>
<p>ç†è§£é—­åŒ…ï¼Œä½ å°±çœŸæ­£è¿ˆå…¥äº† JavaScript é«˜é˜¶ç¼–ç¨‹çš„å¤§é—¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android å‰å°æœåŠ¡ "Bad Notification" å´©æºƒæœºåˆ¶åˆ†ææ–‡æ¡£]]></title>    <link>https://juejin.cn/post/7577378514402541603</link>    <guid>https://juejin.cn/post/7577378514402541603</guid>    <pubDate>2025-11-28T09:52:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577378514402541603" data-draft-id="7577607051585847311" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android å‰å°æœåŠ¡ &quot;Bad Notification&quot; å´©æºƒæœºåˆ¶åˆ†ææ–‡æ¡£"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-28T09:52:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JavaNoober"/> <meta itemprop="url" content="https://juejin.cn/user/1028798611994030"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android å‰å°æœåŠ¡ "Bad Notification" å´©æºƒæœºåˆ¶åˆ†ææ–‡æ¡£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1028798611994030/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JavaNoober
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T09:52:11.000Z" title="Fri Nov 28 2025 09:52:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Android å‰å°æœåŠ¡ "Bad Notification" å´©æºƒæœºåˆ¶åˆ†ææ–‡æ¡£</strong></h2>
<h3 data-id="heading-1"><strong>1. é—®é¢˜æ¦‚è¿°</strong></h3>
<p>åœ¨åº”ç”¨ (<code>com.shawn.guardtest</code>) å¯åŠ¨å‰å°æœåŠ¡ (<code>startForeground</code>) æ—¶ï¼Œä¼ å…¥çš„ <code>Notification</code> åŒ…å«æ— æ³•è¢« SystemUI è§£æçš„å¸ƒå±€ï¼ˆå¼•ç”¨äº† <code>androidx.compose.ui.platform.ComposeView</code>ï¼‰ã€‚å¯¼è‡´ SystemUI æ¸²æŸ“å¤±è´¥ï¼Œè¿›è€Œè§¦å‘ System Server çš„ä¿æŠ¤æœºåˆ¶ï¼Œæœ€ç»ˆå¯¼è‡´åº”ç”¨è¿›ç¨‹å´©æºƒå¹¶è¢«ç³»ç»Ÿå¼ºåˆ¶æŸ¥æ€ã€‚
å´©æºƒä¿¡æ¯æ˜¯é€šè¿‡handlerå‘é€æ¶ˆæ¯ï¼Œæœ€ç»ˆè°ƒç”¨throwRemoteServiceExceptionã€‚ä½†æ˜¯é€šè¿‡ActivityThreadçš„handlerè¿›è¡Œtry catchï¼Œåº”ç”¨ä»ç„¶ä¼šå´©æºƒã€‚</p>
<h3 data-id="heading-2"><strong>2. æ ¸å¿ƒåŸå›  (Root Cause)</strong></h3>
<ul>
<li><strong>æ ¹æœ¬åŸå› </strong>ï¼š<code>RemoteViews</code> æœºåˆ¶ä¸æ”¯æŒ Jetpack Compose ç»„ä»¶ã€‚SystemUI è¿›ç¨‹ä¸åŒ…å«åº”ç”¨çš„ Dex å’Œ Compose åº“ï¼Œè§£æ XML æ—¶æ— æ³•æ‰¾åˆ° <code>ComposeView</code> ç±»ã€‚</li>
<li><strong>ç›´æ¥åŸå› </strong>ï¼šAndroid ç³»ç»Ÿï¼ˆAPI 31+ï¼‰å¼ºåˆ¶æ ¡éªŒå‰å°æœåŠ¡é€šçŸ¥çš„æœ‰æ•ˆæ€§ã€‚å½“ SystemUI æ±‡æŠ¥æ¸²æŸ“å¤±è´¥ï¼ŒAMS åˆ¤å®šè¯¥æœåŠ¡å¤„äºéæ³•çŠ¶æ€ï¼ˆInvalid Stateï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-3"><strong>3. å…³é”®æ—¥å¿—è¯æ®é“¾ (Log Evidence)</strong></h3>
<p>æ•´ä¸ªå´©æºƒè¿‡ç¨‹åœ¨æ—¥å¿—ä¸­å‘ˆç°ä¸ºä¸‰ä¸ªæ¸…æ™°çš„é˜¶æ®µï¼Œå®Œå…¨å°è¯äº†æºç é€»è¾‘ã€‚</p>
<h4 data-id="heading-4"><strong>é˜¶æ®µä¸€ï¼šSystemUI æ¸²æŸ“å¤±è´¥ (Trigger)</strong></h4>
<p><strong>æ—¶é—´ç‚¹</strong>ï¼š<code>17:09:33.886</code> <strong>è¿›ç¨‹</strong>ï¼š<code>com.android.systemui</code> <strong>ç°è±¡</strong>ï¼šSystemUI è¯•å›¾ Inflate é€šçŸ¥å¸ƒå±€æ—¶æŠ›å‡º <code>ClassNotFoundException</code>ã€‚</p>
<p><code>2025-11-28 17:09:33.886 2559-2559 CentralSurfaces com.android.systemui E couldn't inflate view for notification com.shawn.guardtest/0x3e9 android.widget.RemoteViews$ActionException: android.view.InflateException: Binary XML file line #12 in com.shawn.guardtest:layout/notification_error: Error inflating class androidx.compose.ui.platform.ComposeView ... Caused by: android.view.InflateException: Binary XML file line #12 ... Error inflating class androidx.compose.ui.platform.ComposeView Caused by: java.lang.ClassNotFoundException: androidx.compose.ui.platform.ComposeView at java.lang.Class.classForName(Native Method) at java.lang.Class.forName(Class.java:597) at android.view.LayoutInflater.createView(LayoutInflater.java:819) ...</code></p>
<h4 data-id="heading-5"><strong>é˜¶æ®µäºŒï¼šåº”ç”¨æ¥æ”¶å´©æºƒæŒ‡ä»¤ (Path A: Soft Crash)</strong></h4>
<p><strong>æ—¶é—´ç‚¹</strong>ï¼š(ç´§éš SystemUI æŠ¥é”™å) <strong>è¿›ç¨‹</strong>ï¼š<code>com.shawn.guardtest</code> <strong>ç°è±¡</strong>ï¼šAMS é€šè¿‡ Binder é€šçŸ¥åº”ç”¨ä¸»çº¿ç¨‹æŠ›å‡º <code>RemoteServiceException</code>ã€‚</p>
<p><code>2025-11-28 15:51:40.048 27153-27153 ActivityThreadGuard com.shawn.guardtest E Exception message: Bad notification(tag=null, id=1001) posted from package com.shawn.guardtest, crashing app(uid=10247, pid=27153): Couldn't inflate contentViewsandroid.widget.RemoteViews$ActionException: android.view.InflateException: Binary XML file line #12 ...</code></p>
<h4 data-id="heading-6"><strong>é˜¶æ®µä¸‰ï¼šç³»ç»Ÿå¼ºåˆ¶æŸ¥æ€ (Path B: Hard Kill)</strong></h4>
<p><strong>æ—¶é—´ç‚¹</strong>ï¼š<code>17:20:44.819</code> <strong>è¿›ç¨‹</strong>ï¼š<code>system_server</code> <strong>ç°è±¡</strong>ï¼šAMS è®°å½•ä¸‹â€œéæ³•çŠ¶æ€â€å¹¶ç›´æ¥æ¸…ç†è¿›ç¨‹ã€‚</p>
<p><code>2025-11-28 17:20:44.819 1412-1686 ActivityManager system_server I Killing 14555:com.shawn.guardtest/u0a247 (adj 0): killed for invalid state</code></p>
<hr/>
<h3 data-id="heading-7"><strong>4. ç³»ç»Ÿæºç æ‰§è¡Œæµç¨‹ (Code Flow Analysis)</strong></h3>
<p>æ ¹æ®æºç è¿½è¸ªï¼Œç³»ç»Ÿå†…éƒ¨æ‰§è¡Œé€»è¾‘å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p><strong>æ¸²æŸ“æŠ¥é”™ä¸ä¸ŠæŠ¥</strong></p>
<ul>
<li><code>SystemUI</code> æ•è· <code>InflateException</code>ã€‚</li>
<li>è°ƒç”¨ <code>IBinder</code> é€šçŸ¥ <code>NotificationManagerService</code> (NMS) çš„ <code>onNotificationError</code> æ–¹æ³•ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ„å»ºå´©æºƒä¿¡æ¯</strong></p>
<ul>
<li>NMS åœ¨ <code>onNotificationError</code> ä¸­æ„å»ºé”™è¯¯æè¿°ï¼š<code>"Bad notification(tag= ....."</code>ã€‚</li>
<li><code>onNotificationError </code>è°ƒç”¨ <code>ActivityManagerService</code> (AMS) çš„ <code>crashApplicationWithType</code> æ–¹æ³•ã€‚</li>
</ul>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5aedd137211e4a57bb9d30c0e4ae09c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YU5vb2Jlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764928331&amp;x-signature=%2F9RGVQ3le0xO6WoKlP5ql4yKJkM%3D" alt="image.png" loading="lazy"/></p>
<ol>
<li>
<p><strong>æ‰§è¡ŒåŒé‡å¤„å†³ (AppErrors.java)</strong> AMS çš„ <code>crashApplicationWithType</code> æœ€ç»ˆè°ƒç”¨ <code>AppErrors.scheduleAppCrashLocked</code>ï¼Œè¯¥æ–¹æ³•<strong>å¹¶è¡Œæ‰§è¡Œ</strong>äº†ä¸¤é¡¹æ“ä½œï¼š</p>
<ul>
<li><strong>æ“ä½œ 1ï¼šå‘é€ Crash æŒ‡ä»¤ (å¯¹åº”é˜¶æ®µäºŒæ—¥å¿—)</strong> è°ƒç”¨ <code>ProcessRecord.scheduleCrashLocked</code> -&gt; <code>mThread.scheduleCrash(...)</code>ã€‚ è¿™é€šè¿‡ Binder å‘é€æ¶ˆæ¯ç»™åº”ç”¨è¿›ç¨‹çš„ <code>ActivityThread</code>ï¼Œæœ€ç»ˆåœ¨åº”ç”¨ä¸»çº¿ç¨‹ Handlerå‘é€æ¶ˆæ¯<strong>SCHEDULE_CRASH</strong>ï¼Œæœ€ç»ˆæ‰§è¡Œ <code>throw new RemoteServiceException(...)</code>ã€‚</li>
<li><strong>æ“ä½œ 2ï¼šç«‹å³æŸ¥æ€è¿›ç¨‹ (å¯¹åº”é˜¶æ®µä¸‰æ—¥å¿—)</strong> è°ƒç”¨ <code>killAppImmediateLSP(..., "killed for invalid state", ...)</code>ã€‚ è¯¥æ–¹æ³•æœ€ç»ˆè°ƒç”¨ native å±‚çš„ <code>Process.killProcessQuiet(mPid)</code>ï¼Œç›´æ¥å‘å†…æ ¸å‘é€ <code>SIGKILL</code> ä¿¡å·ã€‚</li>
</ul>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf3658190eb4417fa31b4ba1d93d8eba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YU5vb2Jlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764928331&amp;x-signature=nbP1cTRzjeJH6s1htk8yXpFOKVQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f937d9754a224b98ae57937f1d56730d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YU5vb2Jlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764928331&amp;x-signature=Liehj1wtm13%2B%2BKBBbm1QzcJ7Oc0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8"><strong>5. æ—¶åºå›¾æ€»ç»“</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba00163c17fd4dd887c10ef90a4425a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YU5vb2Jlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764928331&amp;x-signature=M2Yc2tNTTM441BX6ZkFzDrmf98M%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">6.åŒé‡å¤„å†³çš„ç›®çš„æ˜¯ä»€ä¹ˆ</h3>
<h4 data-id="heading-10"><strong>ç¬¬ä¸€é‡å¤„å†³ï¼šæ–‡æ˜çš„â€œèµæ­»â€ (Soft Kill / Crash Instruction)</strong></h4>
<p>è¿™æ˜¯ç³»ç»Ÿç»™åº”ç”¨ç•™çš„â€œæœ€åä¸€ç‚¹ä½“é¢â€ï¼Œç›®çš„æ˜¯ä¸ºäº†<strong>ç”Ÿæˆé”™è¯¯æ—¥å¿—ï¼ˆStack Traceï¼‰</strong> ï¼Œè®©å¼€å‘è€…çŸ¥é“è‡ªå·±ä¸ºä»€ä¹ˆæŒ‚äº†ã€‚</p>
<ul>
<li><strong>æ‰‹æ®µ</strong>ï¼šBinder è·¨è¿›ç¨‹è°ƒç”¨ã€‚</li>
<li><strong>æ‰§è¡Œè€…</strong>ï¼šåº”ç”¨çš„ä¸»çº¿ç¨‹ï¼ˆUI çº¿ç¨‹ï¼‰ã€‚</li>
<li><strong>ä»£ç è·¯å¾„</strong>ï¼š<code>app.thread.scheduleCrash(...)</code>ã€‚</li>
<li><strong>è¡¨ç°</strong>ï¼š åº”ç”¨ä¼šåœ¨ Logcat ä¸­æ‰“å° <code>FATAL EXCEPTION</code>ã€‚ ä½ ä¼šçœ‹åˆ° <code>RemoteServiceException</code> æˆ– <code>BadForegroundServiceNotificationException</code>ã€‚ Crashlytics/Bugly ç­‰å´©æºƒä¸ŠæŠ¥å·¥å…·èƒ½æ•è·åˆ°è¿™ä¸ªå¼‚å¸¸ã€‚</li>
<li><strong>ç›®çš„</strong>ï¼š <strong>â€œå‘ŠçŸ¥â€</strong> ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸€æ­¥ï¼Œä½ çš„è¿›ç¨‹çªç„¶æ¶ˆå¤±äº†ï¼Œæ²¡æœ‰ä»»ä½• Java å †æ ˆä¿¡æ¯ï¼Œå¼€å‘è€…ä¼šä¸€è„¸æ‡µé€¼ã€‚</li>
</ul>
<h4 data-id="heading-11"><strong>ç¬¬äºŒé‡å¤„å†³ï¼šæš´åŠ›çš„â€œæ–©ç«‹å†³â€ (Hard Kill / Process Cleanup)</strong></h4>
<p>è¿™æ˜¯ç³»ç»Ÿä¸ºäº†<strong>ç³»ç»Ÿç¨³å®šæ€§</strong>å’Œ<strong>å®‰å…¨æ€§</strong>åšçš„å…œåº•æªæ–½ã€‚ç³»ç»Ÿè®¤ä¸ºä½ çš„å‰å°æœåŠ¡å·²ç»åäº†ï¼ˆæ²¡æœ‰é€šçŸ¥ï¼‰ï¼Œé‚£ä½ è¿™ä¸ªè¿›ç¨‹å°±æ˜¯â€œéæ³•â€çš„ï¼Œå¿…é¡»ç«‹åˆ»ä»å†…å­˜ä¸­æ¸…é™¤ï¼Œä¸æ¥å—ä»»ä½•åé©³ã€‚</p>
<ul>
<li><strong>æ‰‹æ®µ</strong>ï¼šå†…æ ¸çº§ä¿¡å· (SIGKILL)ã€‚</li>
<li><strong>æ‰§è¡Œè€…</strong>ï¼šSystem Server (AMS) è°ƒç”¨ç³»ç»Ÿåº•å±‚ã€‚</li>
<li><strong>ä»£ç è·¯å¾„</strong>ï¼š<code>ProcessRecord.killAppImmediateLSP(..., "killed for invalid state", ...)</code> -&gt; <code>Process.killProcessQuiet(pid)</code>ã€‚</li>
<li><strong>è¡¨ç°</strong>ï¼š Logcat ä¸­å‡ºç° <code>ActivityManager: Killing &lt;pid&gt; ... killed for invalid state</code>ã€‚ è¿›ç¨‹ç›´æ¥æ¶ˆå¤±ï¼Œä¸ä¼šèµ° <code>onDestroy</code>ï¼Œä¸ä¼šèµ°ä»»ä½•ç”Ÿå‘½å‘¨æœŸå›è°ƒã€‚</li>
<li><strong>ç›®çš„</strong>ï¼š <strong>â€œå¼ºåˆ¶æ‰§æ³•â€</strong> ã€‚ç¡®ä¿è¿›ç¨‹çœŸæ­£æ­»äº¡ï¼Œé˜²æ­¢åº”ç”¨é€šè¿‡ Hook åæ‰å¼‚å¸¸åç»§ç»­åœ¨è¯¥æ­»çš„çŠ¶æ€ä¸‹è¿è¡Œï¼ˆæ¯”å¦‚å ç”¨å‰å°æœåŠ¡é…é¢ä½†ä¸æ˜¾ç¤ºé€šçŸ¥ï¼Œè¿™æ˜¯æ¶æ„è½¯ä»¶è¡Œä¸ºï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-12"><strong>7. ç»“è®ºä¸è§£å†³æ–¹æ¡ˆ</strong></h3>
<p><strong>ç»“è®º</strong>ï¼š å´©æºƒæ˜¯ Android ç³»ç»Ÿåº•å±‚æœºåˆ¶ï¼ˆ<code>ActivityManagerService</code> å’Œ <code>NotificationManagerService</code>ï¼‰å…±åŒä½œç”¨çš„ç»“æœã€‚ å³ä½¿é€šè¿‡ Hook æ‰‹æ®µæ‹¦æˆªäº† <strong>Path A</strong> ä¸­çš„ <code>scheduleCrash</code> æ¶ˆæ¯ï¼Œåº”ç”¨ä¾ç„¶æ— æ³•é€ƒè„± <strong>Path B</strong> ä¸­ <code>killAppImmediateLSP</code> å¯¼è‡´çš„ç³»ç»Ÿçº§å¼ºæ€ã€‚
æ‰€ä»¥åªæ˜¯é€šè¿‡hook ActivityThreadçš„handlerè¿›è¡Œtry catchï¼Œå¹¶ä¸èƒ½å®Œå…¨æ•è·è¿™ä¸ªå´©æºƒé—®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨ä¼ä¸šçº§ Java ä¸­åº”ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼šä¸€ç§è¡Œä¸ºé©±åŠ¨æ–¹æ³•]]></title>    <link>https://juejin.cn/post/7577438119558578227</link>    <guid>https://juejin.cn/post/7577438119558578227</guid>    <pubDate>2025-11-28T08:10:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577438119558578227" data-draft-id="7577430671947595802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨ä¼ä¸šçº§ Java ä¸­åº”ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼šä¸€ç§è¡Œä¸ºé©±åŠ¨æ–¹æ³•"/> <meta itemprop="keywords" content="é¢†åŸŸé©±åŠ¨è®¾è®¡"/> <meta itemprop="datePublished" content="2025-11-28T08:10:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¿¡ç ç”±ç¼°"/> <meta itemprop="url" content="https://juejin.cn/user/2110664941509214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨ä¼ä¸šçº§ Java ä¸­åº”ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼šä¸€ç§è¡Œä¸ºé©±åŠ¨æ–¹æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2110664941509214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¿¡ç ç”±ç¼°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T08:10:32.000Z" title="Fri Nov 28 2025 08:10:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>äº†è§£å¦‚ä½•ç»“åˆ DDD å’Œ BDD äºä¼ä¸šçº§ Java ä¸­ï¼Œä»¥åˆ›å»ºèƒ½å¤Ÿæ¨¡æ‹ŸçœŸå®ä¸šåŠ¡é¢†åŸŸå¹¶é€šè¿‡å¯æ‰§è¡Œåœºæ™¯éªŒè¯è¡Œä¸ºçš„è½¯ä»¶ã€‚</p>
</blockquote>
<p><img src="https://cf-blog.icodebuddy.com/image/94/94-0.png" alt="" loading="lazy"/></p>
<p>åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œæœ€å¤§çš„é”™è¯¯ä¹‹ä¸€å°±æ˜¯äº¤ä»˜å®¢æˆ·"ç²¾ç¡®"æƒ³è¦çš„ä¸œè¥¿ã€‚è¿™å¬èµ·æ¥å¯èƒ½åƒé™ˆè¯æ»¥è°ƒï¼Œä½†å³ä½¿åœ¨è¡Œä¸šæ‘¸çˆ¬æ»šæ‰“æ•°åå¹´åï¼Œè¿™ä¸ªé—®é¢˜ä¾ç„¶å­˜åœ¨ã€‚ä¸€ä¸ªæ›´æœ‰æ•ˆçš„æ–¹æ³•æ˜¯ä»å…³æ³¨ä¸šåŠ¡éœ€æ±‚å¼€å§‹æµ‹è¯•ã€‚</p>
<p><strong>è¡Œä¸ºé©±åŠ¨å¼€å‘</strong>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fdzone.com%2Farticles%2Fwhat-is-bdd-a-complete-guide" target="_blank" title="https://dzone.com/articles/what-is-bdd-a-complete-guide" ref="nofollow noopener noreferrer">Behavior-driven development</a>ã€‘ï¼ˆ<strong>BDD</strong>ï¼‰æ˜¯ä¸€ç§å¼ºè°ƒè¡Œä¸ºå’Œé¢†åŸŸæœ¯è¯­ï¼ˆä¹Ÿç§°ä¸º<strong>ç»Ÿä¸€è¯­è¨€</strong>ï¼‰çš„è½¯ä»¶å¼€å‘æ–¹æ³•è®ºã€‚å®ƒä½¿ç”¨å…±äº«çš„è‡ªç„¶è¯­è¨€ï¼Œä»ç”¨æˆ·çš„è§’åº¦å®šä¹‰å’Œæµ‹è¯•è½¯ä»¶è¡Œä¸ºã€‚BDD å»ºç«‹åœ¨<strong>æµ‹è¯•é©±åŠ¨å¼€å‘</strong>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fdzone.com%2Farticles%2Fthe-importance-of-test-driven-development-in-softw" target="_blank" title="https://dzone.com/articles/the-importance-of-test-driven-development-in-softw" ref="nofollow noopener noreferrer">test-driven development</a>ã€‘ï¼ˆ<strong>TDD</strong>ï¼‰çš„åŸºç¡€ä¸Šï¼Œä¸“æ³¨äºä¸ä¸šåŠ¡ç›¸å…³çš„åœºæ™¯ã€‚è¿™äº›åœºæ™¯ä»¥çº¯è¯­è¨€è§„èŒƒçš„å½¢å¼ç¼–å†™ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–æˆæµ‹è¯•ï¼ŒåŒæ—¶ä¹Ÿå……å½“æ´»æ–‡æ¡£ã€‚</p>
<p>è¿™ç§æ–¹æ³•ä¿ƒè¿›äº†æŠ€æœ¯å’ŒéæŠ€æœ¯åˆ©ç›Šç›¸å…³è€…ä¹‹é—´çš„å…±è¯†ï¼Œç¡®ä¿è½¯ä»¶æ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼Œå¹¶æœ‰åŠ©äºå‡å°‘è¿”å·¥å’Œå¼€å‘æ—¶é—´ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥æ¢è®¨è¿™ç§æ–¹æ³•è®ºï¼Œå¹¶è®¨è®ºå¦‚ä½•ä½¿ç”¨ Oracle NoSQL å’Œ Java æ¥å®ç°å®ƒã€‚</p>
<h2 data-id="heading-0">BDD ä¸ DDD å¦‚ä½•ååŒå·¥ä½œ</h2>
<p>ä¹çœ‹ä¹‹ä¸‹ï¼Œè¡Œä¸ºé©±åŠ¨å¼€å‘ï¼ˆBDDï¼‰å’Œé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰ä¼¼ä¹è§£å†³çš„æ˜¯ä¸åŒçš„é—®é¢˜â€”â€”ä¸€ä¸ªä¾§é‡äº<em>æµ‹è¯•</em>ï¼Œå¦ä¸€ä¸ªä¾§é‡äº<em>å»ºæ¨¡</em>ã€‚ç„¶è€Œï¼Œå®ƒä»¬å…±äº«ç›¸åŒçš„å“²å­¦åŸºç¡€ï¼šç¡®ä¿è½¯ä»¶çœŸå®åæ˜ å…¶æ‰€æœåŠ¡çš„<strong>ä¸šåŠ¡é¢†åŸŸ</strong>ã€‚</p>
<p><strong>DDD</strong>ï¼Œç”± Eric Evans åœ¨å…¶ 2003 å¹´å…·æœ‰å¼€åˆ›æ€§çš„è‘—ä½œ*ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼šè½¯ä»¶æ ¸å¿ƒå¤æ‚æ€§çš„åº”å¯¹ä¹‹é“ã€‹*ä¸­æå‡ºï¼Œæ•™å¯¼æˆ‘ä»¬å›´ç»•ä¸šåŠ¡æ¦‚å¿µï¼ˆå®ä½“ã€å€¼å¯¹è±¡ã€èšåˆå’Œé™ç•Œä¸Šä¸‹æ–‡ï¼‰æ¥å»ºæ¨¡è½¯ä»¶ã€‚å…¶åŠ›é‡åœ¨äºä½¿ç”¨<strong>ç»Ÿä¸€è¯­è¨€</strong>ï¼Œè¿™æ˜¯ä¸€ç§è¿æ¥å¼€å‘äººå‘˜å’Œé¢†åŸŸä¸“å®¶çš„å…±äº«è¯æ±‡è¡¨ã€‚</p>
<p><strong>BDD</strong>ï¼Œç”± Dan North åœ¨å‡ å¹´åæå‡ºï¼Œæ˜¯è¿™ä¸€æ€æƒ³è‡ªç„¶è€Œç„¶çš„å»¶ä¼¸ã€‚å®ƒå°†ç»Ÿä¸€è¯­è¨€å¼•å…¥æµ‹è¯•è¿‡ç¨‹ï¼Œå°†ä¸šåŠ¡è§„åˆ™è½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„è§„èŒƒã€‚DDD å®šä¹‰äº†ç³»ç»Ÿåº”è¯¥è¡¨ç¤º<em>ä»€ä¹ˆ</em>ï¼Œè€Œ BDD åˆ™æ ¹æ®è¯¥æ¨¡å‹éªŒè¯ç³»ç»Ÿçš„<em>è¡Œä¸ºæ–¹å¼</em>ã€‚</p>
<p>å½“ç»“åˆä½¿ç”¨æ—¶ï¼ŒDDD å’Œ BDD å½¢æˆäº†ä¸€ä¸ªæŒç»­çš„åé¦ˆå¾ªç¯ï¼š</p>
<ul>
<li>
<p>DDD å¡‘é€ äº†æ•è·ä¸šåŠ¡é€»è¾‘çš„<strong>é¢†åŸŸæ¨¡å‹</strong>ã€‚</p>
</li>
<li>
<p>BDD ç¡®ä¿<strong>ç³»ç»Ÿè¡Œä¸º</strong>éšç€æ—¶é—´çš„æ¨ç§»ä¸è¯¥æ¨¡å‹ä¿æŒä¸€è‡´ã€‚</p>
</li>
</ul>
<p>åœ¨å®è·µä¸­ï¼Œè¿™ç§ååŒä½œç”¨æ„å‘³ç€æ‚¨å¯ä»¥ç¼–å†™ä¸èšåˆï¼ˆå¦‚ Room å’Œ Reservationï¼‰ç›´æ¥ç›¸å…³çš„ç‰¹æ€§åœºæ™¯â€”â€”ä¾‹å¦‚"å½“æˆ‘é¢„è®¢ä¸€ä¸ª VIP æˆ¿é—´æ—¶ï¼Œç³»ç»Ÿåº”å°†å…¶æ ‡è®°ä¸ºä¸å¯ç”¨"ã€‚è¿™äº›æµ‹è¯•æˆä¸ºå¼€å‘äººå‘˜å’Œåˆ©ç›Šç›¸å…³è€…çš„æ´»æ–‡æ¡£ï¼Œç¡®ä¿æ‚¨çš„é¢†åŸŸå§‹ç»ˆä¸çœŸå®çš„ä¸šåŠ¡éœ€æ±‚ä¿æŒä¸€è‡´ã€‚</p>
<p>å¦‚æœæ‚¨æƒ³æ·±å…¥æ¢ç´¢è¿™ç§ç»“åˆï¼Œæˆ‘çš„è‘—ä½œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fbpbonline.com%2Fproducts%2Fdomain-driven-design-with-java" target="_blank" title="https://bpbonline.com/products/domain-driven-design-with-java" ref="nofollow noopener noreferrer">ã€ŠDomain-Driven Design with Javaã€‹</a>è¯¦ç»†é˜è¿°äº†è¿™äº›åŸåˆ™ã€‚å®ƒå±•ç¤ºäº†å¦‚ä½•åœ¨ç°ä»£ Java åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ Jakarta EEã€Spring å’Œäº‘æŠ€æœ¯åº”ç”¨ DDD æ¨¡å¼ï¼Œä¸ºç»Ÿä¸€æ¶æ„å’Œè¡Œä¸ºæä¾›äº†å®è·µåŸºç¡€ã€‚</p>
<p>æ€»ä¹‹ï¼ŒDDD å’Œ BDD å…±åŒå¼¥åˆäº†ç†è§£ä¸šåŠ¡ä¸è¯æ˜å…¶å¯è¡Œä¹‹é—´çš„å·®è·â€”â€”å°†è½¯ä»¶ä»æŠ€æœ¯åˆ¶å“è½¬å˜ä¸ºé¢†åŸŸæœ¬èº«çš„å¿ å®è¡¨è¾¾ã€‚</p>
<h2 data-id="heading-1">ä»£ç å®ç°</h2>
<p>åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¼ä¸šçº§ Java å’Œ Oracle NoSQL æ•°æ®åº“ç”Ÿæˆä¸€ä¸ªç®€å•çš„é…’åº—ç®¡ç†åº”ç”¨ç¨‹åºã€‚</p>
<p>ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºé¡¹ç›®ã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Java SEï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Maven å‘½ä»¤ç”Ÿæˆå®ƒï¼š</p>
<pre><code class="hljs language-shell" lang="shell">
mvn archetype:generate \

"-DarchetypeGroupId=io.cucumber" \

"-DarchetypeArtifactId=cucumber-archetype" \

"-DarchetypeVersion=7.30.0" \

"-DgroupId=org.soujava.demos.hotel" \

"-DartifactId=behavior-driven-development" \

"-Dpackage=org.soujava.demos" \

"-Dversion=1.0.0-SNAPSHOT" \

"-DinteractiveMode=false"

</code></pre>
<p>ä¸‹ä¸€æ­¥æ˜¯å¼•å…¥ <strong>Eclipse JNoSQL</strong> ä¸ <strong>Oracle NoSQL</strong>ï¼Œä»¥åŠ <strong>Jakarta EE ç»„ä»¶çš„å®ç°</strong>ï¼šCDIã€JSON å’Œ Eclipse MicroProfile å®ç°ã€‚</p>
<p>æ‚¨å¯ä»¥æ‰¾åˆ°å®Œæ•´çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsoujava%2Fbehavior-driven-development-oracle-nosql%2Fblob%2Fmain%2Fpom.xml" target="_blank" title="https://github.com/soujava/behavior-driven-development-oracle-nosql/blob/main/pom.xml" ref="nofollow noopener noreferrer"><code>pom.xml</code></a> æ–‡ä»¶ã€‚</p>
<p>åˆå§‹é¡¹ç›®å‡†å¤‡å°±ç»ªåï¼Œæˆ‘ä»¬å°†ä»åˆ›å»ºæµ‹è¯•å¼€å§‹ã€‚</p>
<p>è¯·è®°ä½ï¼ŒBDD æ˜¯ TDD çš„æ‰©å±•ï¼Œå®ƒåŒ…å«äº†ç»Ÿä¸€è¯­è¨€â€”â€”é¢†åŸŸå’Œä¸šåŠ¡ä¹‹é—´çš„å…±äº«è¯æ±‡ã€‚</p>
<pre><code class="hljs language-textile" lang="textile">
åŠŸèƒ½: ç®¡ç†é…’åº—æˆ¿é—´

  


åœºæ™¯: æ³¨å†Œä¸€ä¸ªæ–°æˆ¿é—´

å‡è®¾ é…’åº—ç®¡ç†ç³»ç»Ÿæ­£åœ¨è¿è¡Œ

å½“ æˆ‘æ³¨å†Œä¸€ä¸ªå·ç ä¸º 203 çš„æˆ¿é—´

é‚£ä¹ˆ å·ç ä¸º 203 çš„æˆ¿é—´åº”è¯¥å‡ºç°åœ¨æˆ¿é—´åˆ—è¡¨ä¸­

  


åœºæ™¯: æ³¨å†Œå¤šä¸ªæˆ¿é—´

å‡è®¾ é…’åº—ç®¡ç†ç³»ç»Ÿæ­£åœ¨è¿è¡Œ

å½“ æˆ‘æ³¨å†Œä»¥ä¸‹æˆ¿é—´:

| number | type | status | cleanStatus |

| 101 | STANDARD | AVAILABLE | CLEAN |

| 102 | SUITE | RESERVED | DIRTY |

| 103 | VIP_SUITE | UNDER_MAINTENANCE | CLEAN |

é‚£ä¹ˆ ç³»ç»Ÿä¸­åº”è¯¥æœ‰ 3 ä¸ªå¯ç”¨æˆ¿é—´

  


åœºæ™¯: æ›´æ”¹æˆ¿é—´çŠ¶æ€

å‡è®¾ é…’åº—ç®¡ç†ç³»ç»Ÿæ­£åœ¨è¿è¡Œ

å¹¶ä¸” ä¸€ä¸ªå·ç ä¸º 101 çš„æˆ¿é—´å·²æ³¨å†Œä¸º AVAILABLE

å½“ æˆ‘å°†æˆ¿é—´ 101 æ ‡è®°ä¸º OUT_OF_SERVICE

é‚£ä¹ˆ æˆ¿é—´ 101 åº”è¢«æ ‡è®°ä¸º OUT_OF_SERVICE

</code></pre>
<p>Maven é¡¹ç›®å®Œæˆåï¼Œè®©æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œå³åˆ›å»ºå»ºæ¨¡å’Œå­˜å‚¨åº“ã€‚å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬å°†ä¸“æ³¨äºæˆ¿é—´ç®¡ç†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ä¸‹ä¸€ä¸ªç›®æ ‡æ˜¯ç¡®ä¿ä¹‹å‰å®šä¹‰çš„ BDD æµ‹è¯•é€šè¿‡ã€‚è®©æˆ‘ä»¬ä»å®ç°é¢†åŸŸæ¨¡å‹å’Œå­˜å‚¨åº“å¼€å§‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">CleanStatus</span> {

CLEAN, <span class="hljs-comment">// æ¸…æ´</span>

DIRTY, <span class="hljs-comment">// è„æ±¡</span>

INSPECTION_NEEDED <span class="hljs-comment">// éœ€è¦æ£€æŸ¥</span>

}

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">RoomStatus</span> {

AVAILABLE, <span class="hljs-comment">// å¯ç”¨</span>

RESERVED, <span class="hljs-comment">// å·²é¢„è®¢</span>

UNDER_MAINTENANCE, <span class="hljs-comment">// ç»´æŠ¤ä¸­</span>

OUT_OF_SERVICE <span class="hljs-comment">// åœæ­¢æœåŠ¡</span>

}

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">RoomType</span> {

STANDARD, <span class="hljs-comment">// æ ‡å‡†é—´</span>

DELUXE, <span class="hljs-comment">// è±ªåé—´</span>

SUITE, <span class="hljs-comment">// å¥—æˆ¿</span>

VIP_SUITE <span class="hljs-comment">// VIPå¥—æˆ¿</span>

}

  


<span class="hljs-meta">@Entity</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Room</span> {

  


<span class="hljs-meta">@Id</span>

<span class="hljs-keyword">private</span> String id;

  


<span class="hljs-meta">@Column</span>

<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> number; <span class="hljs-comment">// æˆ¿é—´å·</span>

  


<span class="hljs-meta">@Column</span>

<span class="hljs-keyword">private</span> RoomType type; <span class="hljs-comment">// æˆ¿é—´ç±»å‹</span>

  


<span class="hljs-meta">@Column</span>

<span class="hljs-keyword">private</span> RoomStatus status; <span class="hljs-comment">// æˆ¿é—´çŠ¶æ€</span>

  


<span class="hljs-meta">@Column</span>

<span class="hljs-keyword">private</span> CleanStatus cleanStatus; <span class="hljs-comment">// æ¸…æ´çŠ¶æ€</span>

  


<span class="hljs-meta">@Column</span>

<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> smokingAllowed; <span class="hljs-comment">// å…è®¸å¸çƒŸ</span>

  


<span class="hljs-meta">@Column</span>

<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> underMaintenance; <span class="hljs-comment">// å¤„äºç»´æŠ¤çŠ¶æ€</span>

  


}

</code></pre>
<p>æœ‰äº†æ¨¡å‹ï¼Œä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¼ä¸šçº§ Java ä¸ä½œä¸ºéå…³ç³»å‹æ•°æ®åº“çš„ Oracle NoSQL ä¹‹é—´çš„æ¡¥æ¢ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Jakarta Data éå¸¸è½»æ¾åœ°å®Œæˆï¼Œå®ƒåªæœ‰ä¸€ä¸ªå­˜å‚¨åº“æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æ‹…å¿ƒå®ç°ã€‚</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@Repository</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RoomRepository</span> {

  


<span class="hljs-meta">@Query("FROM Room")</span>

List&lt;Room&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span>;

  


<span class="hljs-meta">@Save</span>

Room <span class="hljs-title function_">save</span><span class="hljs-params">(Room room)</span>;

  


<span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteBy</span><span class="hljs-params">()</span>;

  


Optional&lt;Room&gt; <span class="hljs-title function_">findByNumber</span><span class="hljs-params">(Integer number)</span>;

}

</code></pre>
<p>é¡¹ç›®å®Œæˆåï¼Œä¸‹ä¸€æ­¥æ˜¯å‡†å¤‡æµ‹è¯•ç¯å¢ƒï¼Œé¦–å…ˆæä¾›ä¸€ä¸ªæ•°æ®åº“å®ä¾‹ç”¨äºæµ‹è¯•ã€‚å¤šäºäº† Testcontainersï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾å¯åŠ¨ä¸€ä¸ªéš”ç¦»çš„ Oracle NoSQL å®ä¾‹æ¥è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•ã€‚</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">DatabaseContainer</span> {

  


INSTANCE;

  


<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> GenericContainer&lt;?&gt; container = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericContainer</span>&lt;&gt;

(DockerImageName.parse(<span class="hljs-string">"ghcr.io/oracle/nosql:latest-ce"</span>))

.withExposedPorts(<span class="hljs-number">8080</span>);

  


{

container.start();

}

<span class="hljs-keyword">public</span> DatabaseManager <span class="hljs-title function_">get</span><span class="hljs-params">(String database)</span> {

<span class="hljs-type">DatabaseManagerFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> managerFactory();

<span class="hljs-keyword">return</span> factory.apply(database);

}

  


<span class="hljs-keyword">public</span> DatabaseManagerFactory <span class="hljs-title function_">managerFactory</span><span class="hljs-params">()</span> {

<span class="hljs-type">var</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> DatabaseConfiguration.getConfiguration();

<span class="hljs-type">Settings</span> <span class="hljs-variable">settings</span> <span class="hljs-operator">=</span> Settings.builder()

.put(OracleNoSQLConfigurations.HOST, host())

.build();

<span class="hljs-keyword">return</span> configuration.apply(settings);

}

  


<span class="hljs-keyword">public</span> String <span class="hljs-title function_">host</span><span class="hljs-params">()</span> {

<span class="hljs-keyword">return</span> <span class="hljs-string">"http://"</span> + container.getHost() + <span class="hljs-string">":"</span> + container.getFirstMappedPort();

}

}

</code></pre>
<p>ä¹‹åï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªä¸ <code>@Alternative</code> CDI æ³¨è§£é›†æˆçš„ç”Ÿäº§è€…ã€‚æ­¤é…ç½®æŒ‡å¯¼ CDI å¦‚ä½•æä¾›æ•°æ®åº“å®ä¾‹â€”â€”åœ¨æœ¬ä¾‹ä¸­æ˜¯ç”± Testcontainers ç®¡ç†çš„å®ä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@ApplicationScoped</span>

<span class="hljs-meta">@Alternative</span>

<span class="hljs-meta">@Priority(Interceptor.Priority.APPLICATION)</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ManagerSupplier</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Supplier</span>&lt;DatabaseManager&gt; {

  


<span class="hljs-meta">@Produces</span>

<span class="hljs-meta">@Database(DatabaseType.DOCUMENT)</span>

<span class="hljs-meta">@Default</span>

<span class="hljs-keyword">public</span> DatabaseManager <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {

<span class="hljs-keyword">return</span> DatabaseContainer.INSTANCE.get(<span class="hljs-string">"hotel"</span>);

}

  


}

</code></pre>
<p>å€ŸåŠ© Cucumberï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå°†ç±»æ³¨å…¥åˆ° Cucumber æµ‹è¯•ä¸Šä¸‹æ–‡ä¸­çš„ ObjectFactoryã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨ CDI å¹¶ä»¥ Weld ä½œä¸ºå®ç°ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>WeldCucumberObjectFactory</code> æ¥æ— ç¼é›†æˆè¿™ä¸¤ç§æŠ€æœ¯ã€‚</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeldCucumberObjectFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ObjectFactory</span> {

  


<span class="hljs-keyword">private</span> Weld weld;

<span class="hljs-keyword">private</span> WeldContainer container;

  


<span class="hljs-meta">@Override</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> {

weld = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Weld</span>();

container = weld.initialize();

}

  


<span class="hljs-meta">@Override</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> {

<span class="hljs-keyword">if</span> (weld != <span class="hljs-literal">null</span>) {

weld.shutdown();

}

}

  


<span class="hljs-meta">@Override</span>

<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addClass</span><span class="hljs-params">(Class&lt;?&gt; stepClass)</span> {

<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

}

  


<span class="hljs-meta">@Override</span>

<span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">getInstance</span><span class="hljs-params">(Class&lt;T&gt; type)</span> {

<span class="hljs-keyword">return</span> (T) container.select(type).get();

}

}

</code></pre>
<p>ä¸€ä¸ªé‡è¦æç¤ºï¼šæ­¤è®¾ç½®ä½œä¸º SPIï¼ˆæœåŠ¡æä¾›è€…æ¥å£ï¼‰å·¥ä½œã€‚å› æ­¤ï¼Œæ‚¨å¿…é¡»åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š</p>
<p><code>src/test/resources/META-INF/services/io.cucumber.core.backend.ObjectFactory</code></p>
<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">
org.soujava.demos.hotels.config.WeldCucumberObjectFactory

</code></pre>
<p>æˆ‘ä»¬å°†è®© Mapper å°†æˆ‘ä»¬çš„æ•°æ®è¡¨è½¬æ¢ä¸ºæ‰€æœ‰æ¨¡å‹ä¸­çš„ Room å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@ApplicationScoped</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RoomDataTableMapper</span> {

  


<span class="hljs-meta">@DataTableType</span>

<span class="hljs-keyword">public</span> Room <span class="hljs-title function_">roomEntry</span><span class="hljs-params">(Map&lt;String, String&gt; entry)</span> {

<span class="hljs-keyword">return</span> Room.builder()

.number(Integer.parseInt(entry.get(<span class="hljs-string">"number"</span>)))

.type(RoomType.valueOf(entry.get(<span class="hljs-string">"type"</span>)))

.status(RoomStatus.valueOf(entry.get(<span class="hljs-string">"status"</span>)))

.cleanStatus(CleanStatus.valueOf(entry.get(<span class="hljs-string">"cleanStatus"</span>)))

.build();

}

}

</code></pre>
<p>æ•´ä¸ªæµ‹è¯•åŸºç¡€è®¾æ–½å®Œæˆåï¼Œä¸‹ä¸€æ­¥æ˜¯è®¾è®¡åŒ…å«æˆ‘ä»¬å®é™…æµ‹è¯•çš„ Step æµ‹è¯•ç±»ã€‚</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@ApplicationScoped</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotelRoomSteps</span> {

  


<span class="hljs-meta">@Inject</span>

<span class="hljs-keyword">private</span> RoomRepository repository;

  


<span class="hljs-meta">@Before</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanDatabase</span><span class="hljs-params">()</span> {

repository.deleteBy();

}

  


<span class="hljs-meta">@Given("the hotel management system is operational")</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">theHotelManagementSystemIsOperational</span><span class="hljs-params">()</span> {

Assertions.assertThat(repository).as(<span class="hljs-string">"RoomRepository åº”è¯¥å·²åˆå§‹åŒ–"</span>).isNotNull();

}

  


<span class="hljs-meta">@When("I register a room with number {int}")</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">iRegisterARoomWithNumber</span><span class="hljs-params">(Integer number)</span> {

<span class="hljs-type">Room</span> <span class="hljs-variable">room</span> <span class="hljs-operator">=</span> Room.builder()

.number(number)

.type(RoomType.STANDARD)

.status(RoomStatus.AVAILABLE)

.cleanStatus(CleanStatus.CLEAN)

.build();

repository.save(room);

}

  


<span class="hljs-meta">@Then("the room with number {int} should appear in the room list")</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">theRoomWithNumberShouldAppearInTheRoomList</span><span class="hljs-params">(Integer number)</span> {

List&lt;Room&gt; rooms = repository.findAll();

Assertions.assertThat(rooms)

.extracting(Room::getNumber)

.contains(number);

}

  


<span class="hljs-meta">@When("I register the following rooms:")</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">iRegisterTheFollowingRooms</span><span class="hljs-params">(List&lt;Room&gt; rooms)</span> {

rooms.forEach(repository::save);

}

  


<span class="hljs-meta">@Then("there should be {int} rooms available in the system")</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">thereShouldBeRoomsAvailableInTheSystem</span><span class="hljs-params">(<span class="hljs-type">int</span> expectedCount)</span> {

List&lt;Room&gt; rooms = repository.findAll();

Assertions.assertThat(rooms).hasSize(expectedCount);

}

  


<span class="hljs-meta">@Given("a room with number {int} is registered as {word}")</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">aRoomWithNumberIsRegisteredAs</span><span class="hljs-params">(Integer number, String statusName)</span> {

<span class="hljs-type">RoomStatus</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> RoomStatus.valueOf(statusName);

<span class="hljs-type">Room</span> <span class="hljs-variable">room</span> <span class="hljs-operator">=</span> Room.builder()

.number(number)

.type(RoomType.STANDARD)

.status(status)

.cleanStatus(CleanStatus.CLEAN)

.build();

repository.save(room);

}

  


<span class="hljs-meta">@When("I mark the room {int} as {word}")</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">iMarkTheRoomAs</span><span class="hljs-params">(Integer number, String newStatusName)</span> {

<span class="hljs-type">RoomStatus</span> <span class="hljs-variable">newStatus</span> <span class="hljs-operator">=</span> RoomStatus.valueOf(newStatusName);

Optional&lt;Room&gt; roomOpt = repository.findByNumber(number);

  


Assertions.assertThat(roomOpt)

.as(<span class="hljs-string">"æˆ¿é—´ %s åº”è¯¥å­˜åœ¨"</span>, number)

.isPresent();

  


<span class="hljs-type">Room</span> <span class="hljs-variable">updatedRoom</span> <span class="hljs-operator">=</span> roomOpt.orElseThrow();

updatedRoom.update(newStatus); <span class="hljs-comment">// å‡è®¾ Room ç±»æœ‰ update æ–¹æ³•</span>

  


repository.save(updatedRoom);

}

  


<span class="hljs-meta">@Then("the room {int} should be marked as {word}")</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">theRoomShouldBeMarkedAs</span><span class="hljs-params">(Integer number, String expectedStatusName)</span> {

<span class="hljs-type">RoomStatus</span> <span class="hljs-variable">expectedStatus</span> <span class="hljs-operator">=</span> RoomStatus.valueOf(expectedStatusName);

Optional&lt;Room&gt; roomOpt = repository.findByNumber(number);

  


Assertions.assertThat(roomOpt)

.as(<span class="hljs-string">"æˆ¿é—´ %s åº”è¯¥å­˜åœ¨"</span>, number)

.isPresent()

.get()

.extracting(Room::getStatus)

.isEqualTo(expectedStatus);

}

}

</code></pre>
<p>æ˜¯æ—¶å€™æ‰§è¡Œæµ‹è¯•äº†ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">
mvn clean test

</code></pre>
<p>æ‚¨å¯ä»¥çœ‹åˆ°ç»“æœï¼š</p>
<pre><code class="hljs language-shell" lang="shell">
INFO: Connecting to Oracle NoSQL database at http://localhost:61325 using ON_PREMISES deployment type

âœ” Given the hotel management system is operational # org.soujava.demos.hotels.HotelRoomSteps.theHotelManagementSystemIsOperational()

âœ” And a room with number 101 is registered as AVAILABLE # org.soujava.demos.hotels.HotelRoomSteps.aRoomWithNumberIsRegisteredAs(java.lang.Integer,java.lang.String)

âœ” When I mark the room 101 as OUT_OF_SERVICE # org.soujava.demos.hotels.HotelRoomSteps.iMarkTheRoomAs(java.lang.Integer,java.lang.String)

âœ” Then the room 101 should be marked as OUT_OF_SERVICE # org.soujava.demos.hotels.HotelRoomSteps.theRoomShouldBeMarkedAs(java.lang.Integer,java.lang.String)

Oct 21, 2025 6:18:43 PM org.jboss.weld.environment.se.WeldContainer shutdown

INFO: WELD-ENV-002001: Weld SE container fc4b3b51-fba8-4ea6-9cef-42bcee97d220 shut down

[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 7.231 s -- in org.soujava.demos.hotels.RunCucumberTest

[INFO] Running org.soujava.demos.hotels.MongoDBTest

[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 s -- in org.soujava.demos.hotels.MongoDBTest

[INFO]

[INFO] Results:

[INFO]

[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0

[INFO]

</code></pre>
<h2 data-id="heading-2">ç»“è®º</h2>
<p>é€šè¿‡ç»“åˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰å’Œè¡Œä¸ºé©±åŠ¨å¼€å‘ï¼ˆBDDï¼‰ï¼Œå¼€å‘äººå‘˜å¯ä»¥è¶…è¶ŠæŠ€æœ¯æ­£ç¡®æ€§ï¼Œæ„å»ºçœŸæ­£åæ˜ ä¸šåŠ¡æ„å›¾çš„è½¯ä»¶ã€‚DDD ä¸ºé¢†åŸŸæä¾›äº†ç»“æ„ï¼Œç¡®ä¿æ¨¡å‹ç²¾ç¡®åœ°æ•æ‰ç°å®ä¸–ç•Œçš„æ¦‚å¿µï¼Œè€Œ BDD åˆ™é€šè¿‡ç”¨ä¸šåŠ¡æœ¬èº«çš„è¯­è¨€ç¼–å†™çš„æ¸…æ™°ã€å¯æµ‹è¯•çš„åœºæ™¯ï¼Œç¡®ä¿è¿™äº›æ¨¡å‹æŒ‰é¢„æœŸè¿è¡Œã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ Oracle NoSQLã€Eclipse JNoSQL å’Œ Jakarta EE è¿æ¥è¿™ä¸¤ä¸ªä¸–ç•Œâ€”â€”ä»å®šä¹‰æ‚¨çš„é¢†åŸŸåˆ°è¿è¡Œç”± Cucumber å’Œ CDI æ”¯æŒçš„çœŸå®è¡Œä¸ºæµ‹è¯•ã€‚è¿™ç§ååŒä½œç”¨å°†æµ‹è¯•è½¬åŒ–ä¸ºæ´»æ–‡æ¡£ï¼Œå¼¥åˆäº†å·¥ç¨‹å¸ˆå’Œåˆ©ç›Šç›¸å…³è€…ä¹‹é—´çš„å·®è·ï¼Œå¹¶ç¡®ä¿æ‚¨çš„ç³»ç»Ÿåœ¨æ¼”è¿›è¿‡ç¨‹ä¸­å§‹ç»ˆä¸ä¸šåŠ¡ç›®æ ‡ä¿æŒä¸€è‡´ã€‚</p>
<p>æ‚¨å¯ä»¥æ·±å…¥æ¢ç´¢å¹¶å°† DDD ä¸ BDD ç»“åˆèµ·æ¥ã€‚åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fbpbonline.com%2Fproducts%2Fdomain-driven-design-with-java" target="_blank" title="https://bpbonline.com/products/domain-driven-design-with-java" ref="nofollow noopener noreferrer">ã€ŠDomain-Driven Design with Javaã€‹</a>è¿™æœ¬ä¹¦ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹æ¥ç†è§£ä¸ºä»€ä¹ˆ DDD å¯¹æˆ‘ä»¬ä»ç„¶å¾ˆé‡è¦ã€‚å®ƒæ‰©å±•äº†è¿™é‡Œåˆ†äº«çš„æƒ³æ³•ï¼Œå±•ç¤ºäº† DDD å’Œ BDD å¦‚ä½•å…±åŒå¸¦æ¥æ›´ç®€å•ã€æ›´æ˜“ç»´æŠ¤ä¸”ä»¥ä¸šåŠ¡ä¸ºä¸­å¿ƒçš„è½¯ä»¶ã€‚è¿™ç§è½¯ä»¶äº¤ä»˜çš„æ˜¯è¶…è¶Šéœ€æ±‚çš„å®é™…ä»·å€¼ã€‚</p>
<hr/>
<p>ã€æ³¨ã€‘æœ¬æ–‡è¯‘è‡ªï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdzone.com%2Farticles%2Fdomain-driven-design-enterprise-java" target="_blank" title="https://dzone.com/articles/domain-driven-design-enterprise-java" ref="nofollow noopener noreferrer">Applying Domain-Driven Design With Enterprise Java: A Behavior-Driven Approach</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DongSQLæ•°æ®åº“å†…æ ¸V1.1.0ä»‹ç»]]></title>    <link>https://juejin.cn/post/7577439614953652276</link>    <guid>https://juejin.cn/post/7577439614953652276</guid>    <pubDate>2025-11-28T08:13:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577439614953652276" data-draft-id="7577395040593264650" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DongSQLæ•°æ®åº“å†…æ ¸V1.1.0ä»‹ç»"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-28T08:13:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äº¬ä¸œé›¶å”®æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/4233576972293643"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DongSQLæ•°æ®åº“å†…æ ¸V1.1.0ä»‹ç»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4233576972293643/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äº¬ä¸œé›¶å”®æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T08:13:37.000Z" title="Fri Nov 28 2025 08:13:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p><strong>äº¬ä¸œé›¶å”®æ•°æ®åº“å›¢é˜ŸæŒç»­å¤šå¹´æ·±è€•æ•°æ®åº“æŠ€æœ¯é¢†åŸŸ</strong>ï¼Œå›¢é˜Ÿäºä»Šå¹´(2025.9)æ‰“ç£¨å‡ºäº†æ·±åº¦ä¼˜åŒ–çš„è‡ªç ”æ•°æ®åº“å†…æ ¸â€”â€”DongSQL V1.1.0ã€‚</p>
<p><em>[å¦‚æœå¯¹å‰å› åæœæ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œå¯ä»¥ç§»æ­¥ä¸Šä¸€ç¯‡æ–‡ç« </em><a href="https://link.juejin.cn?target=http%3A%2F%2Fsd.jd.com%2Farticle%2F47706%3FshareId%3D52009%26isHideShareButton%3D1" target="_blank" title="http://sd.jd.com/article/47706?shareId=52009&amp;isHideShareButton=1" ref="nofollow noopener noreferrer"> <em>ã€Šå®å‰‘é”‹ä»ç£¨ç ºå‡ºâ€”â€”é›¶å”®æ•°æ®åº“å†…æ ¸ï¼Œä¸ºå¤§ä¿ƒé“¸å‰‘ï¼ã€‹</em> </a><em>]</em></p>
<p>æœ¬æ–‡å°†æ·±åº¦è§£æDongSQLåœ¨è¯­æ³•æ‰©å±•ã€å¹¶å‘æ§åˆ¶ã€æŸ¥è¯¢ä¼˜åŒ–ç­‰æ–¹é¢çš„å†…æ ¸æ”¹é€ ï¼Œä»¥åŠåœ¨ç”µå•†åœºæ™¯ä¸‹çš„ä¼˜åŒ–å®è·µã€‚</p>
<p><img src="" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">1ã€DongSQLåœ¨è¯­æ³•æ‰©å±•ä¸Šçš„ä¼˜åŒ–</h2>
<h3 data-id="heading-2">1.1. RETURNINGå­å¥åŠŸèƒ½</h3>
<p><strong>â–¶ï¸ è¯­æ³•æ‰©å±•åˆ›æ–°</strong>ï¼šDongSQLåœ¨æ ‡å‡†SQLè¯­æ³•åŸºç¡€ä¸Šæ‰©å±•äº†RETURNINGå­å¥ï¼Œè¿™æ˜¯é‡è¦è¯­æ³•åˆ›æ–°ã€‚RETURNINGå­å¥å…è®¸DMLè¯­å¥(INSERTã€UPDATEã€DELETEã€REPLACE)åœ¨æ‰§è¡Œæ•°æ®ä¿®æ”¹æ“ä½œçš„åŒæ—¶è¿”å›å—å½±å“çš„è¡Œæ•°æ®ï¼Œæ— éœ€é¢å¤–æŸ¥è¯¢ã€‚</p>
<p>ä¼ ç»Ÿæ•°æ®åº“åœ¨æ‰§è¡ŒDMLæ“ä½œåï¼Œå¦‚æœéœ€è¦è·å–æ“ä½œç»“æœï¼Œå¿…é¡»æ‰§è¡Œé¢å¤–çš„SELECTæŸ¥è¯¢ï¼Œè¿™åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼šäº§ç”Ÿé¢å¤–çš„ç½‘ç»œå¾€è¿”å¼€é”€ã€‚DongSQLé€šè¿‡RETURNINGå­å¥å½»åº•è§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- INSERTæ“ä½œè¿”å›è‡ªå¢ID</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> orders (customer_id, order_date) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1001</span>, NOW()) RETURNING order_id;

<span class="hljs-comment">-- UPDATEæ“ä½œè¿”å›æ›´æ–°åçš„æ•°æ®</span>
<span class="hljs-keyword">UPDATE</span> products <span class="hljs-keyword">SET</span> price <span class="hljs-operator">=</span> price <span class="hljs-operator">*</span> <span class="hljs-number">1.1</span> <span class="hljs-keyword">WHERE</span> category <span class="hljs-operator">=</span> <span class="hljs-string">'electronics'</span> 
RETURNING product_id, name, old_price, price;

<span class="hljs-comment">-- DELETEæ“ä½œè¿”å›è¢«åˆ é™¤çš„è®°å½•</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> expired_sessions <span class="hljs-keyword">WHERE</span> expire_time <span class="hljs-operator">&lt;</span> NOW() 
RETURNING session_id, user_id, expire_time;
</code></pre>
<p><strong>â–¶ï¸ æ€§èƒ½æå‡æ•ˆæœ</strong>ï¼šç»æµ‹è¯•éªŒè¯ï¼ŒRETURNINGå­å¥åœ¨ä¸åŒåœºæ™¯ä¸‹éƒ½èƒ½å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼š</p>
<p>â€¢<strong>å›ºå®šè¡Œæ›´æ–°åœºæ™¯</strong>ï¼š16å¹¶å‘æ—¶TPSæå‡61%ï¼Œå“åº”æ—¶é—´é™ä½44%</p>
<p>â€¢<strong>éšæœºè¡Œæ›´æ–°åœºæ™¯</strong>ï¼š128å¹¶å‘æ—¶TPSæå‡18%</p>
<p>â€¢<strong>å¤§è§„æ¨¡æ›´æ–°æµ‹è¯•</strong>ï¼š2000ä¸‡æ¬¡æ“ä½œä¸­å¹³å‡TPSæå‡5-10%</p>
<p><img src="" alt="" loading="lazy"/></p>
<p><strong>â–¶ï¸ ç”Ÿäº§è½åœ°é¢„æœŸ</strong>ï¼šè¯¥åŠŸèƒ½ä¸DongDALå‘å·å™¨é€»è¾‘é«˜åº¦åŒ¹é…ï¼Œæœ‰æœ›å°†å‘å·å™¨æ€§èƒ½ç“¶é¢ˆå¤§å¹…æå‡(DongDALå›¢é˜Ÿé…å¥—å¼€å‘æ¨è¿›ä¸­)</p>
<h3 data-id="heading-3">1.2. Hintè¯­æ³•æ‰©å±•</h3>
<p><strong>â–¶ï¸ å¤šæ ·åŒ–Hintæ”¯æŒ</strong>ï¼šDongSQLæ‰©å±•äº†Hintè¯­æ³•ä½“ç³»ï¼Œæä¾›äº†é’ˆå¯¹ç”µå•†åœºæ™¯çš„ä¸“ç”¨æç¤ºåŠŸèƒ½ï¼ŒåŒ…æ‹¬å¹¶å‘æ§åˆ¶ã€åº“å­˜ç®¡ç†ç­‰é¢†åŸŸç‰¹å®šçš„ä¼˜åŒ–ã€‚</p>
<p><strong>â–¶ï¸ Inventory Hint</strong>ï¼šä¸“é—¨é’ˆå¯¹ç”µå•†åº“å­˜ç®¡ç†åœºæ™¯è®¾è®¡çš„æç¤ºè¯­æ³•ï¼Œæä¾›ç›®æ ‡å½±å“è¡Œæ•°æ§åˆ¶ã€è‡ªåŠ¨æäº¤/å›æ»šç­‰ç‰¹æ€§ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">-- åº“å­˜æ‰£å‡ï¼šç¡®ä¿åªå½±å“ä¸€è¡Œï¼ŒæˆåŠŸè‡ªåŠ¨æäº¤ï¼Œå¤±è´¥è‡ªåŠ¨å›æ»š
UPDATE /*+ TARGET_AFFECT_ROW(1) COMMIT_ON_SUCCESS ROLLBACK_ON_FAIL */
inventory SET <span class="hljs-attr">stock</span> = stock - <span class="hljs-number">5</span> 
WHERE <span class="hljs-attr">product_id</span> = <span class="hljs-number">1001</span> AND stock &gt;= <span class="hljs-number">5</span><span class="hljs-comment">;</span>
</code></pre>
<p><strong>â–¶ï¸ æ€§èƒ½æå‡æ•°æ®</strong>ï¼šåœ¨16å¹¶å‘çš„åº“å­˜æ‰£å‡åœºæ™¯ä¸‹ï¼Œä½¿ç”¨Inventory Hintæ¯”ä¸ä½¿ç”¨hintæ€§èƒ½æå‡215%ã€‚</p>
<p><img src="" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">2ã€DongSQLåœ¨å¹¶å‘æ§åˆ¶ä¸Šçš„ä¼˜åŒ–</h2>
<h3 data-id="heading-5">2.1. CCLå¹¶å‘æ§åˆ¶</h3>
<p><strong>â–¶ï¸ å¤šç»´åº¦é™æµæœºåˆ¶</strong>ï¼šDongSQLå®ç°äº†CCL(Concurrency Control)å¹¶å‘æ§åˆ¶åŠŸèƒ½ï¼Œé€šè¿‡å¤šç»´åº¦çš„é™æµç­–ç•¥ï¼Œæœ‰æ•ˆè§£å†³ç”µå•†ç§’æ€åœºæ™¯ä¸‹çš„çƒ­ç‚¹æ•°æ®è®¿é—®é—®é¢˜ã€‚</p>
<p>ä¼ ç»Ÿæ•°æ®åº“åœ¨é¢å¯¹é«˜å¹¶å‘çƒ­ç‚¹æ•°æ®è®¿é—®æ—¶ï¼Œå¾€å¾€ä¼šå› ä¸ºæ¿€çƒˆçš„é”ç«äº‰å¯¼è‡´æ€§èƒ½æ€¥å‰§ä¸‹é™ï¼Œç”šè‡³ç³»ç»Ÿé›ªå´©ã€‚DongSQLçš„CCLé€šè¿‡æ™ºèƒ½æ’é˜Ÿæœºåˆ¶ï¼Œå°†æ— åºçš„å¹¶å‘è¯·æ±‚è½¬æ¢ä¸ºæœ‰åºå¤„ç†ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚</p>
<p><strong>â–¶ï¸ å¤šç»´åº¦æ§åˆ¶ç­–ç•¥</strong>ï¼š</p>
<p>â€¢<strong>åŸºäºå­—æ®µçš„é™æµ</strong>ï¼š<code>ccl_queue_field(column_name, concurrency)</code>ï¼Œå¯¹ç‰¹å®šå­—æ®µå€¼è¿›è¡Œå¹¶å‘æ§åˆ¶</p>
<p>â€¢<strong>åŸºäºå€¼çš„é™æµ</strong>ï¼š<code>ccl_queue_value(value, concurrency)</code>ï¼Œå¯¹ç‰¹å®šæ•°æ®å€¼è¿›è¡Œç²¾å‡†é™æµ</p>
<p>â€¢<strong>åŸºäºSQLæŒ‡çº¹çš„é™æµ</strong>ï¼š<code>ccl_queue_digest(concurrency)</code>ï¼Œå¯¹ç›¸åŒSQLæ¨¡å¼è¿›è¡Œç»Ÿä¸€ç®¡æ§</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å¯¹å•†å“IDä¸º999çš„çƒ­é—¨å•†å“è¿›è¡Œé™æµï¼Œå¹¶å‘åº¦é™åˆ¶ä¸º5</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-comment">/*+ ccl_queue_value(999, 5) */</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> product_id <span class="hljs-operator">=</span> <span class="hljs-number">999</span>;

<span class="hljs-comment">-- å¯¹åº“å­˜æ‰£å‡æ“ä½œæŒ‰å•†å“IDè¿›è¡Œé™æµ</span>
<span class="hljs-keyword">UPDATE</span> <span class="hljs-comment">/*+ ccl_queue_field(product_id, 8) */</span> inventory <span class="hljs-keyword">SET</span> stock <span class="hljs-operator">=</span> stock <span class="hljs-operator">-</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> product_id <span class="hljs-operator">=</span> ?;

<span class="hljs-comment">-- å¯¹ç›¸åŒSQLæ¨¡å¼è¿›è¡Œç»Ÿä¸€é™æµ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-comment">/*+ ccl_queue_digest(10) */</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> hot_products <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>â–¶ï¸ æ€§èƒ½çªç ´æ•°æ®</strong>ï¼š</p>
<p>â€¢<strong>ç§’æ€åœºæ™¯ä¼˜åŒ–</strong>ï¼šåœ¨4096å¹¶å‘ä¸‹ï¼Œä½¿ç”¨CCLé™æµåTPSä»573æå‡è‡³1337ï¼Œæ€§èƒ½æå‡133%</p>
<p>â€¢<strong>ç³»ç»Ÿç¨³å®šæ€§</strong>ï¼šæœ‰æ•ˆé˜²æ­¢ç³»ç»Ÿé›ªå´©ï¼Œå°†æ— åºå¹¶å‘è½¬æ¢ä¸ºæœ‰åºå¤„ç†</p>
<p>â€¢<strong>çƒ­ç‚¹ç¼“è§£</strong>ï¼šé€šè¿‡é˜Ÿåˆ—æœºåˆ¶æ˜¾è‘—é™ä½çƒ­ç‚¹æ•°æ®çš„é”ç«äº‰</p>
<p><img src="" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">2.2. Statement Outlineæ‰§è¡Œè®¡åˆ’åŠè‡ªå®šä¹‰æç¤ºç®¡ç†</h3>
<p><strong>â–¶ï¸ ä¼ä¸šçº§è®¡åˆ’ç¨³å®šæ€§</strong>ï¼šDongSQLæä¾›äº†Statement OutlineåŠŸèƒ½ï¼Œç”¨äºå›ºåŒ–é‡è¦SQLçš„æ‰§è¡Œè®¡åˆ’ï¼Œé˜²æ­¢å› æ•°æ®å˜åŒ–å¯¼è‡´çš„è®¡åˆ’ä¸ç¨³å®šé—®é¢˜ã€‚</p>
<p><strong>â–¶ï¸ è‡ªå®šä¹‰Hintæ³¨å…¥å·¥å…·</strong>ï¼šåŒ…æ‹¬ä½†ä¸é™äºä¸Šè¿°ç§’æ€ã€CCLé™æµåœºæ™¯çš„Hintï¼Œå³ä½¿ä¸šåŠ¡ç ”å‘é¢„æœŸå¤–çš„è¿‡è½½æˆ–è€…çªå‘æµé‡å‘ç”Ÿï¼Œåº”æ€¥æƒ…å†µä¸‹DBAä¹Ÿå¯ä»¥é€šè¿‡Statement OutlineåŠŸèƒ½å¯¹é—®é¢˜SQLè¿›è¡Œå¹²é¢„</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¸ºé‡è¦SQLå›ºåŒ–æ‰§è¡Œè®¡åˆ’</span>
<span class="hljs-keyword">CALL</span> dbms_outln.add_index_outline(
  <span class="hljs-string">'test_db'</span>, <span class="hljs-string">''</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'USE INDEX'</span>, <span class="hljs-string">'idx_status'</span>, <span class="hljs-string">''</span>,
  <span class="hljs-string">'SELECT * FROM orders WHERE status = "PAID"'</span>
);

<span class="hljs-comment">-- ä¸ºç‰¹å®šæŸ¥è¯¢æ·»åŠ ccl_queue_digesté™æµhintï¼Œé™åˆ¶å¹¶å‘åº¦ä¸º2</span>
<span class="hljs-keyword">CALL</span> dbms_outln.add_optimizer_outline(
  <span class="hljs-string">'test_db'</span>, <span class="hljs-string">''</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'/*+ ccl_queue_digest(2) */'</span>,
  <span class="hljs-string">'SELECT * FROM orders WHERE customer_id = 1001'</span>
);
</code></pre>
<p><strong>â–¶ï¸ æ ¸å¿ƒä»·å€¼</strong>ï¼š</p>
<p>â€¢<strong>æ€§èƒ½ç¨³å®šæ€§</strong>ï¼šä¿éšœæ ¸å¿ƒSQLæ€§èƒ½ä¸å› æ•°æ®å˜åŒ–è€Œæ³¢åŠ¨</p>
<p>â€¢<strong>æ™ºèƒ½é™æµ</strong>ï¼šæ”¯æŒåŸºäºSQLæŒ‡çº¹çš„æ‰‹åŠ¨é™æµå’Œè‡ªåŠ¨é™æµ(è‡ªåŠ¨é™æµé»˜è®¤ä¸å¼€å¯ï¼Œéœ€è¦å¼€å¯çš„ä¸šåŠ¡éœ€å•ç‹¬ç”³è¯·)</p>
<p>â€¢<strong>ä¼ä¸šçº§ç®¡ç†</strong>ï¼šæä¾›ç”Ÿäº§çº§çš„æ‰§è¡Œè®¡åˆ’ç®¡ç†èƒ½åŠ›</p>
<h2 data-id="heading-7">3ã€DongSQLåœ¨æŸ¥è¯¢ä¼˜åŒ–ä¸Šçš„æ”¹è¿›</h2>
<h3 data-id="heading-8">3.1. å•ç‚¹æŸ¥è¯¢ä¼˜åŒ–</h3>
<p><strong>â–¶ï¸ æŸ¥è¯¢è·¯å¾„ä¼˜åŒ–</strong>ï¼šDongSQLå®ç°äº†å•ç‚¹æŸ¥è¯¢bypassåŠŸèƒ½ï¼Œé’ˆå¯¹ä¸»é”®ç­‰å€¼æŸ¥è¯¢è¿™ç±»é«˜é¢‘ç®€å•æŸ¥è¯¢ï¼Œç»•è¿‡éƒ¨åˆ†SQLå±‚å¤„ç†é€»è¾‘ï¼Œç›´æ¥è®¿é—®å­˜å‚¨å¼•æ“ï¼Œå¤§å¹…æå‡æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<p>ç”µå•†åœºæ™¯ä¸­ï¼Œå•†å“è¯¦æƒ…æŸ¥è¯¢ã€ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢ç­‰åŸºäºä¸»é”®çš„ç®€å•æŸ¥è¯¢å æ®äº†å¾ˆå¤§æ¯”ä¾‹ã€‚è™½ç„¶è¿™äº›æŸ¥è¯¢é€»è¾‘ç®€å•ï¼Œä½†åœ¨é«˜å¹¶å‘ä¸‹ä»ç„¶æ¶ˆè€—å¤§é‡CPUèµ„æºã€‚DongSQLçš„å•ç‚¹æŸ¥è¯¢ä¼˜åŒ–é’ˆå¯¹è¿™ä¸€ç—›ç‚¹è¿›è¡Œäº†ä¸“é¡¹ä¼˜åŒ–ã€‚</p>
<p><strong>â–¶ï¸ æ€§èƒ½æå‡æ•°æ®</strong>ï¼š</p>
<p>â€¢<strong>ä¸åŒç¯å¢ƒæ€§èƒ½æå‡</strong>ï¼šå®¹å™¨ç¯å¢ƒæå‡20%ï¼Œç‰©ç†æœºç¯å¢ƒæå‡30%</p>
<p>â€¢<strong>é«˜å¹¶å‘åœºæ™¯</strong>ï¼šå½“CPUè¾¾åˆ°ç“¶é¢ˆæ—¶ï¼ŒQPSæå‡20-28%</p>
<p>â€¢<strong>èµ„æºæ•ˆç‡</strong>ï¼šç›¸åŒç¡¬ä»¶é…ç½®ä¸‹å¤„ç†èƒ½åŠ›æ˜¾è‘—æå‡</p>
<p><img src="" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">3.2. çº¿ç¨‹æ± ä¼˜åŒ–</h3>
<p><strong>â–¶ï¸ é«˜å¹¶å‘å¤„ç†èƒ½åŠ›</strong>ï¼šDongSQLå®ç°äº†ä¼ä¸šçº§çº¿ç¨‹æ± åŠŸèƒ½ï¼Œé€šè¿‡æ™ºèƒ½çº¿ç¨‹è°ƒåº¦å’Œèµ„æºç®¡ç†ï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„å¤„ç†èƒ½åŠ›å’Œç¨³å®šæ€§ã€‚</p>
<p>ä¼ ç»Ÿæ•°æ®åº“åœ¨é¢å¯¹å¤§é‡å¹¶å‘è¿æ¥æ—¶ï¼Œä¼šä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºç‹¬ç«‹çº¿ç¨‹ï¼Œè¿™åœ¨é«˜å¹¶å‘ä¸‹ä¼šå¯¼è‡´çº¿ç¨‹åˆ‡æ¢å¼€é”€è¿‡å¤§ã€å†…å­˜æ¶ˆè€—æ¿€å¢ç­‰é—®é¢˜ã€‚DongSQLçš„çº¿ç¨‹æ± ä¼˜åŒ–é€šè¿‡å¤ç”¨çº¿ç¨‹èµ„æºï¼Œæœ‰æ•ˆè§£å†³äº†è¿™äº›é—®é¢˜ã€‚</p>
<p><strong>â–¶ï¸ è°ƒåº¦æœºåˆ¶</strong>ï¼š</p>
<p>â€¢<strong>çº¿ç¨‹å¤ç”¨ï¼š</strong> é€šè¿‡çº¿ç¨‹æ± å¤ç”¨å‡å°‘çº¿ç¨‹åˆ›å»ºé”€æ¯å¼€é”€</p>
<p>â€¢<strong>è´Ÿè½½å‡è¡¡ï¼š</strong> åˆ†é…ä»»åŠ¡åˆ°ä¸åŒçº¿ç¨‹ï¼Œé¿å…çƒ­ç‚¹çº¿ç¨‹</p>
<p>â€¢<strong>ä¼˜å…ˆçº§è°ƒåº¦ï¼š</strong> æ”¯æŒä»»åŠ¡ä¼˜å…ˆçº§ï¼Œä¿éšœé‡è¦ä¸šåŠ¡ä¼˜å…ˆå¤„ç†</p>
<p><strong>â–¶ï¸ æ€§èƒ½çªç ´æ•°æ®</strong>ï¼ˆåŸºäº8C32Gæµ‹è¯•ç¯å¢ƒï¼Œsysbench 16å¼ è¡¨æ¯å¼ 1000ä¸‡è¡Œæ•°æ®ï¼‰ï¼š</p>
<p><strong>åªè¯»åœºæ™¯æ€§èƒ½å¯¹æ¯”</strong>ï¼š</p>
<p>â€¢<strong>ä½å¹¶å‘ä¼˜åŠ¿</strong>ï¼š32çº¿ç¨‹æ—¶ï¼Œçº¿ç¨‹æ± æ¨¡å¼QPSè¾¾åˆ°141,261ï¼Œç›¸æ¯”ä¼ ç»Ÿæ¨¡å¼çš„110,658æå‡27.6%</p>
<p>â€¢<strong>é«˜å¹¶å‘ç¨³å®šæ€§</strong>ï¼šåœ¨512çº¿ç¨‹é«˜å¹¶å‘ä¸‹ï¼Œçº¿ç¨‹æ± æ¨¡å¼QPSä¿æŒ131,939ï¼Œè€Œä¼ ç»Ÿæ¨¡å¼ä»…61,580ï¼Œæ€§èƒ½æå‡114%</p>
<p>â€¢<strong>å»¶è¿Ÿæ§åˆ¶</strong>ï¼š512çº¿ç¨‹æ—¶TP99å»¶è¿Ÿä»ä¼ ç»Ÿæ¨¡å¼çš„297.92msä¼˜åŒ–åˆ°118.92msï¼Œé™ä½60%</p>
<p><strong>çº¯å†™åœºæ™¯æ€§èƒ½çªç ´</strong>ï¼š</p>
<p>â€¢<strong>ä¸­ç­‰å¹¶å‘</strong>ï¼š64çº¿ç¨‹æ—¶QPSä»46,577æå‡åˆ°57,655ï¼Œæ€§èƒ½æå‡23.8%</p>
<p>â€¢<strong>é«˜å¹¶å‘åœºæ™¯</strong>ï¼š512çº¿ç¨‹æ—¶QPSä»29,541æå‡åˆ°58,166ï¼Œæ€§èƒ½æå‡97%</p>
<p>â€¢<strong>è¶…é«˜å¹¶å‘</strong>ï¼š4096çº¿ç¨‹æ—¶QPSä»28,571æå‡åˆ°54,687ï¼Œæ€§èƒ½æå‡91%</p>
<p><strong>è¯»å†™æ··åˆåœºæ™¯ä¼˜åŒ–</strong>ï¼š</p>
<p>â€¢<strong>128çº¿ç¨‹</strong>ï¼šQPSä»54,870æå‡åˆ°80,244ï¼Œæ€§èƒ½æå‡46%</p>
<p>â€¢<strong>256çº¿ç¨‹</strong>ï¼šQPSä»48,787æå‡åˆ°77,961ï¼Œæ€§èƒ½æå‡60%</p>
<p>â€¢<strong>å»¶è¿Ÿä¼˜åŒ–</strong>ï¼š256çº¿ç¨‹æ—¶TP99å»¶è¿Ÿä»196.89msä¼˜åŒ–åˆ°158.63msï¼Œé™ä½19%</p>
<p><img src="" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">3.3. å…¶ä»–æŸ¥è¯¢æ‰§è¡Œä¼˜åŒ–</h3>
<p><strong>â–¶ï¸ æ‰§è¡Œè·¯å¾„ä¼˜åŒ–</strong>ï¼šDongSQLåœ¨æŸ¥è¯¢æ‰§è¡Œå¼•æ“å±‚é¢è¿›è¡Œäº†å¤šé¡¹ä¼˜åŒ–ï¼ŒåŒ…æ‹¬ç®—å­ä¼˜åŒ–ã€å†…å­˜ç®¡ç†ä¼˜åŒ–ã€å¹¶è¡Œæ‰§è¡Œä¼˜åŒ–ç­‰ã€‚</p>
<p><strong>â–¶ï¸ ç¼“å­˜æœºåˆ¶å¢å¼º</strong>ï¼šä¼˜åŒ–äº†Buffer Poolç®¡ç†ç­–ç•¥ï¼Œé¡µé¢mutexä¼˜åŒ–ï¼Œæå‡äº†æ•°æ®è®¿é—®æ•ˆç‡ï¼Œé™ä½äº†I/Oé”å†²çªã€‚</p>
<h2 data-id="heading-11">4ã€æ€§èƒ½åŸºå‡†æµ‹è¯•æ±‡æ€»</h2>
<h3 data-id="heading-12">OLTPæ ‡å‡†åŸºå‡†æµ‹è¯•</h3>
<p>åŸºäºæ ‡å‡†æµ‹è¯•ç¯å¢ƒçš„æ€§èƒ½æ•°æ®ï¼ˆ16C32G, 16å¼ è¡¨ï¼Œæ¯å¼ è¡¨100ä¸‡è¡Œï¼‰ï¼š</p>





















































<table><thead><tr><th>æµ‹è¯•åœºæ™¯</th><th>æœ€ä½³çº¿ç¨‹æ•°</th><th>TPS</th><th>QPS</th><th>TP99å»¶è¿Ÿ</th><th>å¹³å‡å»¶è¿Ÿ</th></tr></thead><tbody><tr><td>åªè¯»æŸ¥è¯¢</td><td>64</td><td>19,484</td><td>311,745</td><td>21.50ms</td><td>3.28ms</td></tr><tr><td>åªå†™æ“ä½œ</td><td>256</td><td>17,004</td><td>102,025</td><td>29.72ms</td><td>15.05ms</td></tr><tr><td>æ’å…¥æ“ä½œ</td><td>256</td><td>25,614</td><td>25,614</td><td>15.83ms</td><td>9.99ms</td></tr><tr><td>è¯»å†™æ··åˆ</td><td>128</td><td>9,795</td><td>195,908</td><td>33.12ms</td><td>13.06ms</td></tr><tr><td>ç‚¹æŸ¥è¯¢</td><td>64</td><td>560,933</td><td>560,933</td><td>0.18ms</td><td>0.11ms</td></tr></tbody></table>
<h3 data-id="heading-13">ç”µå•†åœºæ™¯ä¸“é¡¹æ€§èƒ½æ±‡æ€»</h3>



































<table><thead><tr><th>ä¼˜åŒ–æ¨¡å—</th><th>æµ‹è¯•åœºæ™¯</th><th>æ€§èƒ½æå‡å¹…åº¦</th><th>å…³é”®æŒ‡æ ‡</th></tr></thead><tbody><tr><td><strong>RETURNINGå­å¥</strong></td><td>å›ºå®šè¡Œæ›´æ–°</td><td><strong>61%</strong></td><td>TPS: 925â†’1,490</td></tr><tr><td><strong>CCLå¹¶å‘æ§åˆ¶</strong></td><td>ç§’æ€åœºæ™¯</td><td><strong>133%</strong></td><td>TPS: 573â†’1,337</td></tr><tr><td><strong>Inventory Hint</strong></td><td>åº“å­˜æ‰£å‡</td><td><strong>215%</strong></td><td>TPS: 1,537â†’4,843</td></tr><tr><td><strong>å•ç‚¹æŸ¥è¯¢ä¼˜åŒ–</strong></td><td>ä¸»é”®æŸ¥è¯¢</td><td><strong>28%</strong></td><td>QPS: 76,432â†’98,470</td></tr></tbody></table>
<h2 data-id="heading-14">5ã€æœªæ¥è§„åˆ’</h2>
<p>1.<strong>æŒç»­è¯­æ³•æ‰©å±•</strong>ï¼šåŸºäºä¸šåŠ¡éœ€æ±‚ç»§ç»­æ‰©å±•SQLè¯­æ³•åŠŸèƒ½</p>
<p>2.<strong>æ™ºèƒ½ä¼˜åŒ–å¢å¼º</strong>ï¼šå¼•å…¥æœºå™¨å­¦ä¹ ä¼˜åŒ–æ‰§è¡Œè®¡åˆ’é€‰æ‹©</p>
<p>3.<strong>å†…æ ¸çº§æŠ€æœ¯æ”¯æŒ</strong>ï¼šå…·å¤‡å†…æ ¸ç ”å‘èƒ½åŠ›çš„å›¢é˜Ÿï¼ŒæŒç»­ä»æœ€åº•å±‚ä¸ºä¸šåŠ¡ç ”å‘æä¾›æ·±åº¦ä¼˜åŒ–çš„æ•°æ®åº“è§£å†³æ–¹æ¡ˆ</p>
<p>4.<strong>äº‘åŸç”Ÿå­˜ç®—åˆ†ç¦»</strong>ï¼šç»§ç»­æ‰“é€ å±äºäº¬ä¸œè‡ªå·±çš„é«˜æ€§èƒ½ä½æˆæœ¬æ•°æ®åº“äº§å“</p>
<h2 data-id="heading-15">6ã€ç»“è¯­</h2>
<p>ä»å¼€æºå†…æ ¸åˆ°è‡ªç ”DongSQLï¼Œäº¬ä¸œé›¶å”®æ•°æ®åº“å›¢é˜Ÿå§‹ç»ˆä»¥"ä¸šåŠ¡ä»·å€¼é©±åŠ¨æŠ€æœ¯åˆ›æ–°"ä¸ºæ ¸å¿ƒç†å¿µã€‚DongSQLä½œä¸ºä¸“ä¸ºäº¬ä¸œç”µå•†åœºæ™¯è®¾è®¡çš„æ•°æ®åº“ï¼Œé€šè¿‡è¯­æ³•æ‰©å±•ã€å¹¶å‘æ§åˆ¶ã€æŸ¥è¯¢ä¼˜åŒ–ç­‰å¤šä¸ªæ¨¡å—çš„æ·±åº¦åˆ›æ–°ï¼Œä¸ºç”µå•†ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•æä¾›äº†å¼ºæœ‰åŠ›çš„æ•°æ®åº“æŠ€æœ¯æ”¯æ’‘ã€‚</p>
<p>è¿™äº›ä¼˜åŒ–ä¸ä»…æå‡äº†ç³»ç»Ÿæ€§èƒ½ï¼Œæ›´é‡è¦çš„æ˜¯ä¸ºé›†å›¢åŸºç¡€æŠ€æœ¯åº•åº§æä¾›äº†åšå®çš„åŸºç¡€ã€‚æœªæ¥ï¼Œäº¬ä¸œé›¶å”®æ•°æ®åº“å›¢é˜Ÿå°†æŒç»­æ·±è€•æ•°æ®åº“å†…æ ¸æŠ€æœ¯ï¼Œè®©æ•°æ®åº“æ›´å¥½åœ°æœåŠ¡ä¸šåŠ¡å‘å±•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»0åˆ°1ç”¨Goæ’¸ä¸€ä¸ªAIåº”ç”¨ï¼ŸEinoæ¡†æ¶è®©ä½ æ•ˆç‡ç¿»å€ï¼]]></title>    <link>https://juejin.cn/post/7577239264308822016</link>    <guid>https://juejin.cn/post/7577239264308822016</guid>    <pubDate>2025-11-27T10:07:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577239264308822016" data-draft-id="7577229187896246307" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»0åˆ°1ç”¨Goæ’¸ä¸€ä¸ªAIåº”ç”¨ï¼ŸEinoæ¡†æ¶è®©ä½ æ•ˆç‡ç¿»å€ï¼"/> <meta itemprop="keywords" content="åç«¯,Go"/> <meta itemprop="datePublished" content="2025-11-27T10:07:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç ä¸€è¡Œ"/> <meta itemprop="url" content="https://juejin.cn/user/2963939081856328"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»0åˆ°1ç”¨Goæ’¸ä¸€ä¸ªAIåº”ç”¨ï¼ŸEinoæ¡†æ¶è®©ä½ æ•ˆç‡ç¿»å€ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2963939081856328/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç ä¸€è¡Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T10:07:21.000Z" title="Thu Nov 27 2025 10:07:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œä¸ºGoå¼€å‘è€…ï¼Œä½ æ˜¯å¦ä¹Ÿæ›¾ç¾¡æ…•Pythonç”Ÿæ€é‡Œå±‚å‡ºä¸ç©·çš„LLMæ¡†æ¶ï¼Ÿä»LangChainåˆ°LlamaIndexï¼ŒPythonå¼€å‘è€…æ€»èƒ½è½»æ¾æ­èµ·AIåº”ç”¨çš„éª¨æ¶ã€‚ä½†ç°åœ¨ï¼ŒGoå¼€å‘è€…ä¹Ÿæœ‰äº†ä¸“å±çš„ç»ˆæè§£å†³æ–¹æ¡ˆâ€”â€”Einoæ¡†æ¶ï¼</p>
<h2 data-id="heading-0">Go AIåº”ç”¨å¼€å‘çš„è¿›åŒ–ä¹‹è·¯</h2>
<p>å›é¡¾Goè¯­è¨€åœ¨AIé¢†åŸŸçš„åº”ç”¨å†ç¨‹ï¼Œå¤§è‡´å¯åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>
<p><strong>1. åŸç”ŸAPIè°ƒç”¨é˜¶æ®µ</strong></p>
<p>æ—©æœŸå¼€å‘è€…åªèƒ½ç›´æ¥è°ƒç”¨OpenAIç­‰å¹³å°çš„HTTP APIï¼Œæ‰‹å†™è¯·æ±‚ç­¾åã€å¤„ç†æµå¼å“åº”ï¼Œä»£ç å……æ–¥ç€å¤§é‡é‡å¤çš„ç½‘ç»œè¯·æ±‚é€»è¾‘ã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// åŸå§‹APIè°ƒç”¨ç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">callOpenAI</span><span class="hljs-params">(prompt <span class="hljs-type">string</span>)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    reqBody := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-3.5-turbo"</span>,
        <span class="hljs-string">"messages"</span>: []<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt},
        },
    }
    <span class="hljs-comment">// æ‰‹åŠ¨å¤„ç†HTTPè¯·æ±‚ã€ç­¾åã€åºåˆ—åŒ–...</span>
    <span class="hljs-comment">// å¤§é‡æ¨¡æ¿ä»£ç å ç”¨å¼€å‘ç²¾åŠ›</span>
}
</code></pre>
<p><strong>2. åŸºç¡€å·¥å…·åº“é˜¶æ®µ</strong></p>
<p>ç¤¾åŒºå‡ºç°äº†ä¸€äº›å°è£…APIçš„å·¥å…·åº“ï¼Œä½†ç¼ºä¹ç»Ÿä¸€æ ‡å‡†ï¼Œç»„ä»¶é—´éš¾ä»¥ååŒï¼Œå¤æ‚æµç¨‹ç¼–æ’ä»éœ€æ‰‹åŠ¨å®ç°ã€‚</p>
<p><strong>3. å…¨åŠŸèƒ½æ¡†æ¶é˜¶æ®µ</strong></p>
<p>éšç€Einoçš„å‡ºç°ï¼ŒGoç»ˆäºæœ‰äº†ä¸“ä¸ºLLMåº”ç”¨è®¾è®¡çš„å®Œæ•´æ¡†æ¶ï¼Œæä¾›ç»„ä»¶åŒ–ã€æµç¨‹ç¼–æ’ã€ç±»å‹å®‰å…¨ç­‰ä¼ä¸šçº§èƒ½åŠ›ã€‚</p>
<h2 data-id="heading-1">Einoï¼šGoç”Ÿæ€çš„LLMåº”ç”¨å¼€å‘åˆ©å™¨</h2>
<p>Einoï¼ˆå‘éŸ³ç±»ä¼¼"I know"ï¼‰æ˜¯CloudWeGoå›¢é˜Ÿæ¨å‡ºçš„Goè¯­è¨€LLMåº”ç”¨å¼€å‘æ¡†æ¶ï¼Œå€Ÿé‰´äº†LangChainç­‰æ¡†æ¶çš„ä¼˜ç§€æ€æƒ³ï¼ŒåŒæ—¶æ·±åº¦è´´åˆGoè¯­è¨€ç‰¹æ€§ã€‚</p>
<p>å®ƒçš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š</p>
<ul>
<li>
<p>æ ‡å‡†åŒ–ç»„ä»¶æŠ½è±¡ï¼šæ¨¡å‹ã€å·¥å…·ã€æ£€ç´¢å™¨ç­‰ç»„ä»¶å³æ’å³ç”¨</p>
</li>
<li>
<p>å¼ºå¤§çš„ç¼–æ’èƒ½åŠ›ï¼šå¤„ç†ç±»å‹æ£€æŸ¥ã€æµå¼å“åº”ã€å¹¶å‘ç®¡ç†ç­‰å¤æ‚é—®é¢˜</p>
</li>
<li>
<p>ç®€æ´APIè®¾è®¡ï¼šç¬¦åˆGoå¼€å‘è€…çš„ä½¿ç”¨ä¹ æƒ¯</p>
</li>
<li>
<p>ä¸°å¯Œæœ€ä½³å®è·µï¼šå†…ç½®æµç¨‹æ¨¡æ¿å’Œç¤ºä¾‹ä»£ç </p>
</li>
<li>
<p>å…¨ç”Ÿå‘½å‘¨æœŸå·¥å…·ï¼šä»å¼€å‘è°ƒè¯•åˆ°ç›‘æ§è¯„ä¼°ä¸€åº”ä¿±å…¨</p>
<ul>
<li/>
</ul>
</li>
</ul>
<h2 data-id="heading-2">å¿«é€Ÿä¸Šæ‰‹ï¼š30è¡Œä»£ç å®ç°æ™ºèƒ½é—®ç­”</h2>
<p>è®©æˆ‘ä»¬ç”¨Einoå¿«é€Ÿå®ç°ä¸€ä¸ªç®€å•çš„AIé—®ç­”åº”ç”¨ï¼Œä½“éªŒå…¶ç®€æ´é«˜æ•ˆçš„å¼€å‘æ¨¡å¼ã€‚</p>
<h3 data-id="heading-3">1. å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-arduino" lang="arduino">go get github.com/cloudwego/eino
go get github.com/cloudwego/eino-ext
</code></pre>
<h3 data-id="heading-4">2. åŸºç¡€é—®ç­”ç¤ºä¾‹</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"context"</span>
    <span class="hljs-string">"fmt"</span>
    
    <span class="hljs-string">"github.com/cloudwego/eino"</span>
    <span class="hljs-string">"github.com/cloudwego/eino/components/model"</span>
    <span class="hljs-string">"github.com/cloudwego/eino-ext/model/openai"</span>
    <span class="hljs-string">"github.com/cloudwego/eino/schema"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    ctx := context.Background()
    
    <span class="hljs-comment">// 1. é…ç½®OpenAIæ¨¡å‹</span>
    config := &amp;openai.ChatConfig{
        APIKey: <span class="hljs-string">"your-api-key"</span>,
        Model:  <span class="hljs-string">"gpt-3.5-turbo"</span>,
    }
    
    <span class="hljs-comment">// 2. åˆ›å»ºæ¨¡å‹å®ä¾‹</span>
    chatModel, err := openai.NewChatModel(ctx, config)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }
    
    <span class="hljs-comment">// 3. ç”Ÿæˆå›ç­”</span>
    message, err := chatModel.Generate(ctx, []*schema.Message{
        schema.SystemMessage(<span class="hljs-string">"ä½ æ˜¯ä¸€ä¸ªGoå¼€å‘è€…åŠ©æ‰‹ï¼Œç”¨ç®€æ´çš„è¯­è¨€å›ç­”é—®é¢˜"</span>),
        schema.UserMessage(<span class="hljs-string">"å¦‚ä½•ç”¨Goå®ç°ä¸€ä¸ªç®€å•çš„LLMå®¢æˆ·ç«¯ï¼Ÿ"</span>),
    })
    
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }
    
    fmt.Println(<span class="hljs-string">"AIå›ç­”ï¼š"</span>, message.Content)
}
</code></pre>
<h3 data-id="heading-5">3. è¿›é˜¶ï¼šä½¿ç”¨Chainç¼–æ’å¤æ‚æµç¨‹</h3>
<p>å½“éœ€æ±‚å˜å¾—å¤æ‚æ—¶ï¼ŒEinoçš„Chainç¼–æ’èƒ½åŠ›å°±èƒ½æ´¾ä¸Šç”¨åœºã€‚æ¯”å¦‚å®ç°"æç¤ºæ¨¡æ¿â†’LLMè°ƒç”¨"çš„æµæ°´çº¿ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">func</span> <span class="hljs-selector-tag">main</span>() {
    ctx := context.<span class="hljs-attribute">Background()
    
    // 1. åˆ›å»ºæ¨¡å‹
    chatModel, _ </span>:= openai.<span class="hljs-built_in">NewChatModel</span>(ctx, &amp;openai.ChatConfig{
        <span class="hljs-attribute">APIKey</span>: <span class="hljs-string">"your-api-key"</span>,
        <span class="hljs-attribute">Model</span>:  <span class="hljs-string">"gpt-3.5-turbo"</span>,
    })
    
    <span class="hljs-comment">// 2. åˆ›å»ºæç¤ºæ¨¡æ¿</span>
    <span class="hljs-attribute">promptTpl </span>:= prompt.<span class="hljs-built_in">FromMessages</span>(
        schema.Jinja2,
        schema.<span class="hljs-built_in">SystemMessage</span>(<span class="hljs-string">"ä½ æ˜¯{{role}}ï¼Œè¯·å›ç­”ï¼š{{question}}"</span>),
    )
    
    <span class="hljs-comment">// 3. æ„å»ºChain</span>
    chain, <span class="hljs-attribute">_ </span>:= compose.NewChain[map[string]any, *schema.Message]().
        <span class="hljs-built_in">AppendChatTemplate</span>(promptTpl).
        <span class="hljs-built_in">AppendChatModel</span>(chatModel).
        <span class="hljs-built_in">Compile</span>(ctx)
    
    <span class="hljs-comment">// 4. æ‰§è¡ŒChain</span>
    result, <span class="hljs-attribute">_ </span>:= chain.<span class="hljs-built_in">Invoke</span>(ctx, map[string]any{
        <span class="hljs-string">"role"</span>:     <span class="hljs-string">"Goä¸“å®¶"</span>,
        <span class="hljs-string">"question"</span>: <span class="hljs-string">"Go 1.21ç‰ˆæœ¬æœ‰å“ªäº›é‡è¦æ›´æ–°ï¼Ÿ"</span>,
    })
    
    fmt.<span class="hljs-built_in">Println</span>(result.Content)
}
</code></pre>
<h3 data-id="heading-6">4. å·¥å…·è°ƒç”¨ç¤ºä¾‹</h3>
<p>Einoå†…ç½®äº†å·¥å…·è°ƒç”¨èƒ½åŠ›ï¼Œè®©AIå¯ä»¥è°ƒç”¨å¤–éƒ¨å‡½æ•°è·å–ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªå¤©æ°”æŸ¥è¯¢å·¥å…·</span>
<span class="hljs-keyword">type</span> WeatherTool <span class="hljs-keyword">struct</span>{}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *WeatherTool)</span></span> Info(ctx context.Context) (*schema.ToolInfo, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">return</span> &amp;schema.ToolInfo{
        Name: <span class="hljs-string">"get_weather"</span>,
        Desc: <span class="hljs-string">"æŸ¥è¯¢æŒ‡å®šåŸå¸‚çš„å¤©æ°”"</span>,
        ParamsOneOf: schema.NewParamsOneOfByParams(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*schema.ParameterInfo{
            <span class="hljs-string">"city"</span>: {
                Desc:     <span class="hljs-string">"åŸå¸‚åç§°"</span>,
                Required: <span class="hljs-literal">true</span>,
                Type:     schema.String,
            },
        }),
    }, <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *WeatherTool)</span></span> InvokableRun(ctx context.Context, args <span class="hljs-type">string</span>) (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// å®é™…å®ç°è°ƒç”¨å¤©æ°”APIçš„é€»è¾‘</span>
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"åŸå¸‚%sçš„å¤©æ°”æ˜¯æ™´æœ—ï¼Œ25â„ƒ"</span>, args), <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// åœ¨Agentä¸­ä½¿ç”¨å·¥å…·</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    ctx := context.Background()
    
    <span class="hljs-comment">// åˆ›å»ºæ¨¡å‹</span>
    model, _ := openai.NewChatModel(ctx, &amp;openai.ChatConfig{
        APIKey: <span class="hljs-string">"your-api-key"</span>,
    })
    
    <span class="hljs-comment">// åˆ›å»ºå·¥å…·</span>
    weatherTool := &amp;WeatherTool{}
    
    <span class="hljs-comment">// é…ç½®Agent</span>
    agent, _ := adk.NewChatModelAgent(ctx, &amp;adk.ChatModelAgentConfig{
        Name:        <span class="hljs-string">"weather_agent"</span>,
        Description: <span class="hljs-string">"æŸ¥è¯¢å¤©æ°”çš„æ™ºèƒ½åŠ©æ‰‹"</span>,
        Model:       model,
        ToolsConfig: adk.ToolsConfig{
            ToolsNodeConfig: compose.ToolsNodeConfig{
                Tools: []tool.Tool{weatherTool},
            },
        },
    })
    
    <span class="hljs-comment">// è¿è¡ŒAgent</span>
    input := &amp;adk.AgentInput{
        Messages: []*schema.Message{
            schema.UserMessage(<span class="hljs-string">"åŒ—äº¬ä»Šå¤©çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"</span>),
        },
    }
    
    iter := agent.Run(ctx, input)
    <span class="hljs-keyword">for</span> iter.Next(ctx) {
        event := iter.Value()
        <span class="hljs-keyword">if</span> event.Output != <span class="hljs-literal">nil</span> &amp;&amp; event.Output.MessageOutput != <span class="hljs-literal">nil</span> {
            msg, _ := event.Output.MessageOutput.GetMessage()
            fmt.Println(<span class="hljs-string">"AIå›å¤ï¼š"</span>, msg.Content)
        }
    }
}
</code></pre>
<h2 data-id="heading-7">Einoæ¡†æ¶æ¶æ„è§£æ</h2>
<p>Einoé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š</p>
<ul>
<li>
<p><strong>æ ¸å¿ƒæ¡†æ¶ï¼ˆeinoï¼‰</strong> ï¼šç±»å‹å®šä¹‰ã€æµå¤„ç†ã€ç»„ä»¶æŠ½è±¡ã€ç¼–æ’åŠŸèƒ½</p>
</li>
<li>
<p><strong>æ‰©å±•ç»„ä»¶ï¼ˆeino-extï¼‰</strong> ï¼šå„ç±»ç»„ä»¶çš„å…·ä½“å®ç°ï¼Œå¦‚OpenAIæ¨¡å‹ã€å·¥å…·ç­‰</p>
</li>
<li>
<p><strong>DevOpså·¥å…·</strong>ï¼šå¯è§†åŒ–å¼€å‘ã€è°ƒè¯•å·¥å…·</p>
</li>
<li>
<p><strong>ç¤ºä¾‹ä»£ç ï¼ˆeino-examplesï¼‰</strong> ï¼šæœ€ä½³å®è·µå‚è€ƒ</p>
<ul>
<li/>
</ul>
</li>
</ul>
<p>è¿™ç§æ¶æ„è®©å¼€å‘è€…å¯ä»¥æ ¹æ®éœ€æ±‚çµæ´»é€‰æ‹©ç»„ä»¶ï¼ŒåŒæ—¶ä¿è¯äº†æ¡†æ¶çš„å¯æ‰©å±•æ€§ã€‚</p>
<h2 data-id="heading-8">ä¸ºä»€ä¹ˆé€‰æ‹©Einoï¼Ÿ</h2>
<ol>
<li>
<p><strong>ç±»å‹å®‰å…¨</strong>ï¼šGoçš„é™æ€ç±»å‹ç‰¹æ€§ç»“åˆEinoçš„ç±»å‹æ£€æŸ¥ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯</p>
</li>
<li>
<p><strong>æ€§èƒ½ä¼˜åŠ¿</strong>ï¼šGoçš„å¹¶å‘æ¨¡å‹ç‰¹åˆ«é€‚åˆå¤„ç†LLMçš„æµå¼å“åº”</p>
</li>
<li>
<p><strong>ä¼ä¸šçº§æ”¯æŒ</strong>ï¼šCloudWeGoå›¢é˜ŸèƒŒä¹¦ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒä½¿ç”¨</p>
</li>
<li>
<p><strong>ç”Ÿæ€èåˆ</strong>ï¼šå¯ä¸Kitexã€Hertzç­‰CloudWeGoé¡¹ç›®æ— ç¼é›†æˆ</p>
</li>
<li>
<p><strong>æŒç»­è¿­ä»£</strong>ï¼šæ´»è·ƒçš„å¼€å‘å›¢é˜Ÿä¸æ–­ä¼˜åŒ–åŠŸèƒ½</p>
<ol>
<li/>
</ol>
</li>
</ol>
<h2 data-id="heading-9">å¼€å§‹ä½¿ç”¨Eino</h2>
<ul>
<li>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcloudwego%2Feino" target="_blank" title="https://github.com/cloudwego/eino" ref="nofollow noopener noreferrer">github.com/cloudwego/eâ€¦</a></p>
</li>
<li>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cloudwego.io%2Fzh%2Fdocs%2Feino%2F" target="_blank" title="https://www.cloudwego.io/zh/docs/eino/" ref="nofollow noopener noreferrer">www.cloudwego.io/zh/docs/einâ€¦</a></p>
</li>
<li>
<p>å¿«é€Ÿå…¥é—¨ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cloudwego.io%2Fzh%2Fdocs%2Feino%2Fquick_start%2F" target="_blank" title="https://www.cloudwego.io/zh/docs/eino/quick_start/" ref="nofollow noopener noreferrer">www.cloudwego.io/zh/docs/einâ€¦</a></p>
<ul>
<li/>
</ul>
</li>
</ul>
<p>å¦‚æœä½ æ˜¯Goå¼€å‘è€…ï¼Œæƒ³è¦å¿«é€Ÿæ„å»ºå¯é çš„LLMåº”ç”¨ï¼ŒEinoç»å¯¹å€¼å¾—ä¸€è¯•ã€‚ç°åœ¨å°±å…‹éš†ä»“åº“ï¼Œå¼€å§‹ä½ çš„Go AIå¼€å‘ä¹‹æ—…å§ï¼</p>
<p>æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ ç”¨Goå¼€å‘AIåº”ç”¨çš„ç»éªŒï¼Œæˆ–è€…å¯¹Einoæ¡†æ¶çš„æœŸå¾…~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ¢ç§˜æ–°ä¸€ä»£å‘é‡å­˜å‚¨æ ¼å¼Lance-format (ä¸€)Lance é¡¹ç›®æ¦‚è§ˆä¸è®¾è®¡ç†å¿µ]]></title>    <link>https://juejin.cn/post/7576935292427567146</link>    <guid>https://juejin.cn/post/7576935292427567146</guid>    <pubDate>2025-11-27T01:49:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576935292427567146" data-draft-id="7576923573777596458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ¢ç§˜æ–°ä¸€ä»£å‘é‡å­˜å‚¨æ ¼å¼Lance-format (ä¸€)Lance é¡¹ç›®æ¦‚è§ˆä¸è®¾è®¡ç†å¿µ"/> <meta itemprop="keywords" content="æ¶æ„"/> <meta itemprop="datePublished" content="2025-11-27T01:49:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¯­è½å¿ƒç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/2875978147955741"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ¢ç§˜æ–°ä¸€ä»£å‘é‡å­˜å‚¨æ ¼å¼Lance-format (ä¸€)Lance é¡¹ç›®æ¦‚è§ˆä¸è®¾è®¡ç†å¿µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978147955741/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¯­è½å¿ƒç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T01:49:02.000Z" title="Thu Nov 27 2025 01:49:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬ä¸€ç« ï¼šLance é¡¹ç›®æ¦‚è§ˆä¸è®¾è®¡ç†å¿µ</h2>
<h3 data-id="heading-1">æ ¸å¿ƒæ¦‚è§ˆ</h3>
<p>Lance æ˜¯ä¸€ä¸ªé¢å‘å¤šæ¨¡æ€ AI å·¥ä½œæµçš„åˆ—å¼æ•°æ®æ ¼å¼ã€‚å®ƒè§£å†³çš„æ ¹æœ¬é—®é¢˜æ˜¯ï¼š<strong>å¦‚ä½•åœ¨ç»Ÿä¸€çš„å­˜å‚¨æ ¼å¼ä¸­ï¼Œé«˜æ•ˆåœ°æ”¯æŒå‘é‡æœç´¢ã€éšæœºè®¿é—®ã€SQL æŸ¥è¯¢å’Œå¤šæ¨¡æ€æ•°æ®å­˜å‚¨</strong>ã€‚</p>
<p>æƒ³è±¡æ‚¨åœ¨æ„å»ºä¸€ä¸ªè§†é¢‘æ¨èç³»ç»Ÿï¼š</p>
<ul>
<li>éœ€è¦å­˜å‚¨è§†é¢‘å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€æè¿°ã€æ ‡ç­¾ï¼‰</li>
<li>éœ€è¦å­˜å‚¨è§†é¢‘çš„å‘é‡åµŒå…¥ç”¨äºç›¸ä¼¼åº¦æœç´¢</li>
<li>éœ€è¦å­˜å‚¨åŸå§‹è§†é¢‘æ•°æ®ï¼ˆBLOBï¼‰</li>
<li>éœ€è¦åœ¨è¿™äº›æ•°æ®ä¸Šæ‰§è¡Œå¤æ‚çš„ SQL æŸ¥è¯¢å’Œå‘é‡æœç´¢</li>
</ul>
<p>Lance å°±æ˜¯ä¸ºè¿™æ ·çš„åœºæ™¯è®¾è®¡çš„ã€‚</p>
<h3 data-id="heading-2">Lance ä¸»æ¶æ„è®¾è®¡</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "åº”ç”¨å±‚ Application Layer"
        A1["Python API&lt;br/&gt;(PyLance)"]
        A2["Java API&lt;br/&gt;(JNI)"]
        A3["Rust API"]
    end
    
    subgraph "æŸ¥è¯¢å¼•æ“å±‚ Query Engine"
        B1["DataFusion é›†æˆ&lt;br/&gt;lance-datafusion"]
        B2["SQL æŸ¥è¯¢&lt;br/&gt;è§£æä¸è§„åˆ’"]
        B3["Scanner&lt;br/&gt;æŸ¥è¯¢æ‰§è¡Œ"]
    end
    
    subgraph "æ•°æ®é›†å±‚ Dataset Layer"
        C1["Dataset&lt;br/&gt;ç‰ˆæœ¬ç®¡ç†"]
        C2["Transaction&lt;br/&gt;äº‹åŠ¡å¤„ç†"]
        C3["Fragment&lt;br/&gt;æ•°æ®åˆ†ç‰‡"]
        C4["Schema&lt;br/&gt;æ¼”åŒ–ç®¡ç†"]
    end
    
    subgraph "ç´¢å¼•å±‚ Index Layer"
        D1["å‘é‡ç´¢å¼•&lt;br/&gt;IVF/HNSW/FLAT"]
        D2["æ ‡é‡ç´¢å¼•&lt;br/&gt;BTree/Bitmap"]
        D3["å…¨æ–‡ç´¢å¼•&lt;br/&gt;Tantivy"]
    end
    
    subgraph "è¡¨ç®¡ç†å±‚ Table Layer"
        E1["Manifest&lt;br/&gt;lance-table"]
        E2["Commit åè®®&lt;br/&gt;ç‰ˆæœ¬æ§åˆ¶"]
        E3["RowID ç³»ç»Ÿ&lt;br/&gt;è¡Œåœ°å€ç®¡ç†"]
    end
    
    subgraph "å­˜å‚¨å±‚ Storage Layer"
        F1["æ–‡ä»¶æ ¼å¼&lt;br/&gt;lance-file"]
        F2["ç¼–ç å™¨&lt;br/&gt;lance-encoding"]
        F3["IO è°ƒåº¦&lt;br/&gt;lance-io"]
    end
    
    subgraph "æ ¸å¿ƒå±‚ Core Layer"
        G1["ç±»å‹ç³»ç»Ÿ&lt;br/&gt;lance-core"]
        G2["ç¼“å­˜ç®¡ç†"]
        G3["Arrow é›†æˆ&lt;br/&gt;lance-arrow"]
    end
    
    subgraph "å¯¹è±¡å­˜å‚¨ Object Storage"
        H1["S3"]
        H2["Azure Blob"]
        H3["GCS"]
        H4["æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ"]
    end
    
    A1 --&gt; B1
    A2 --&gt; B1
    A3 --&gt; C1
    B1 --&gt; B3
    B2 --&gt; B1
    B3 --&gt; C1
    C1 --&gt; C2
    C1 --&gt; C3
    C1 --&gt; C4
    C1 --&gt; D1
    C1 --&gt; D2
    C3 --&gt; E1
    C2 --&gt; E2
    C1 --&gt; E3
    D1 --&gt; F1
    D2 --&gt; F1
    D3 --&gt; F1
    E1 --&gt; F1
    E2 --&gt; F1
    E3 --&gt; F1
    F1 --&gt; F2
    F1 --&gt; F3
    F2 --&gt; G1
    F3 --&gt; G1
    G1 --&gt; G3
    F3 --&gt; H1
    F3 --&gt; H2
    F3 --&gt; H3
    F3 --&gt; H4
</code></pre>
<h3 data-id="heading-3">æ ¸å¿ƒåŠŸèƒ½æ—¶åºå›¾</h3>
<h4 data-id="heading-4">1. æ•°æ®å†™å…¥æµç¨‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User
    participant Dataset
    participant Transaction
    participant Writer
    participant Encoder
    participant ObjectStore
    participant Manifest
    
    User-&gt;&gt;Dataset: write_dataset(data, uri)
    Dataset-&gt;&gt;Transaction: begin_transaction()
    Transaction-&gt;&gt;Writer: create_writer(schema)
    
    loop æ¯ä¸ª RecordBatch
        Writer-&gt;&gt;Encoder: encode_batch(batch)
        Encoder-&gt;&gt;Encoder: é€‰æ‹©ç¼–ç æ–¹å¼
        Encoder-&gt;&gt;ObjectStore: write_data_file()
        ObjectStore--&gt;&gt;Encoder: ç¡®è®¤å†™å…¥
    end
    
    Writer-&gt;&gt;Dataset: è¿”å› Fragments
    Dataset-&gt;&gt;Manifest: create_new_version()
    Manifest-&gt;&gt;ObjectStore: write_manifest()
    Dataset-&gt;&gt;Transaction: commit()
    Transaction-&gt;&gt;ObjectStore: åŸå­æ€§æäº¤
    Transaction--&gt;&gt;User: è¿”å›æ–°ç‰ˆæœ¬
</code></pre>
<h4 data-id="heading-5">2. æ•°æ®æ‰«ææµç¨‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User
    participant Scanner
    participant Dataset
    participant Fragment
    participant FileReader
    participant Decoder
    participant Cache
    
    User-&gt;&gt;Scanner: scan().project([columns])
    Scanner-&gt;&gt;Scanner: build_execution_plan()
    Scanner-&gt;&gt;Dataset: get_fragments()
    Dataset--&gt;&gt;Scanner: Fragmentåˆ—è¡¨
    
    loop æ¯ä¸ª Fragment
        Scanner-&gt;&gt;Fragment: open_reader()
        Fragment-&gt;&gt;FileReader: create_reader()
        FileReader-&gt;&gt;Cache: check_cache()
        
        alt ç¼“å­˜å‘½ä¸­
            Cache--&gt;&gt;FileReader: è¿”å›ç¼“å­˜æ•°æ®
        else ç¼“å­˜æœªå‘½ä¸­
            FileReader-&gt;&gt;Decoder: decode_page()
            Decoder-&gt;&gt;Decoder: è§£å‹ä¸è§£ç 
            Decoder--&gt;&gt;FileReader: RecordBatch
            FileReader-&gt;&gt;Cache: store_cache()
        end
        
        FileReader--&gt;&gt;Scanner: RecordBatch
    end
    
    Scanner--&gt;&gt;User: Stream&lt;RecordBatch&gt;
</code></pre>
<h4 data-id="heading-6">3. å‘é‡ç´¢å¼•åˆ›å»ºæµç¨‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User
    participant Dataset
    participant IndexBuilder
    participant KMeans
    participant Quantizer
    participant IVFStorage
    participant ObjectStore
    
    User-&gt;&gt;Dataset: create_index(column, IVF_PQ)
    Dataset-&gt;&gt;IndexBuilder: build_index()
    IndexBuilder-&gt;&gt;Dataset: scan_vectors()
    Dataset--&gt;&gt;IndexBuilder: å‘é‡æ•°æ®æµ
    
    IndexBuilder-&gt;&gt;KMeans: train_centroids(vectors, k)
    KMeans-&gt;&gt;KMeans: è¿­ä»£èšç±»
    KMeans--&gt;&gt;IndexBuilder: è´¨å¿ƒåˆ—è¡¨
    
    IndexBuilder-&gt;&gt;Quantizer: train_pq(vectors)
    Quantizer-&gt;&gt;Quantizer: å­¦ä¹  codebooks
    Quantizer--&gt;&gt;IndexBuilder: PQ æ¨¡å‹
    
    IndexBuilder-&gt;&gt;IndexBuilder: assign_to_partitions()
    
    loop æ¯ä¸ªåˆ†åŒº
        IndexBuilder-&gt;&gt;Quantizer: quantize_vectors()
        Quantizer--&gt;&gt;IndexBuilder: PQ codes
        IndexBuilder-&gt;&gt;IVFStorage: write_partition()
        IVFStorage-&gt;&gt;ObjectStore: æŒä¹…åŒ–
    end
    
    IndexBuilder-&gt;&gt;Dataset: update_index_metadata()
    Dataset-&gt;&gt;ObjectStore: æ›´æ–° Manifest
    Dataset--&gt;&gt;User: ç´¢å¼•åˆ›å»ºå®Œæˆ
</code></pre>
<h4 data-id="heading-7">4. å‘é‡æœç´¢æµç¨‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User
    participant Scanner
    participant VectorIndex
    participant IVF
    participant Quantizer
    participant PostFilter
    participant Ranker
    
    User-&gt;&gt;Scanner: nearest(query, k=10)
    Scanner-&gt;&gt;VectorIndex: search(query_vector)
    
    VectorIndex-&gt;&gt;IVF: compute_distances_to_centroids()
    IVF--&gt;&gt;VectorIndex: æ’åºçš„åˆ†åŒºåˆ—è¡¨
    
    VectorIndex-&gt;&gt;VectorIndex: select_nprobes(nprobes)
    
    loop å¯¹äºæ¯ä¸ªé€‰ä¸­çš„åˆ†åŒº
        VectorIndex-&gt;&gt;IVF: load_partition()
        IVF-&gt;&gt;Quantizer: approximate_distances()
        Quantizer--&gt;&gt;IVF: è¿‘ä¼¼è·ç¦»åˆ—è¡¨
        IVF-&gt;&gt;Ranker: add_candidates()
    end
    
    Ranker-&gt;&gt;Ranker: top_k_selection()
    Ranker-&gt;&gt;PostFilter: refine_distances()
    PostFilter-&gt;&gt;PostFilter: è®¡ç®—ç²¾ç¡®è·ç¦»
    PostFilter--&gt;&gt;Scanner: æœ€ç»ˆ Top-K ç»“æœ
    Scanner--&gt;&gt;User: RecordBatch with scores
</code></pre>
<h4 data-id="heading-8">5. äº‹åŠ¡æäº¤æµç¨‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Client
    participant Transaction
    participant CommitHandler
    participant DynamoDB
    participant ObjectStore
    participant Manifest
    
    Client-&gt;&gt;Transaction: commit_changes()
    Transaction-&gt;&gt;Transaction: validate_operations()
    Transaction-&gt;&gt;Manifest: build_new_manifest()
    Manifest--&gt;&gt;Transaction: manifest_data
    
    Transaction-&gt;&gt;CommitHandler: begin_commit()
    
    alt ä½¿ç”¨ DynamoDB é”
        CommitHandler-&gt;&gt;DynamoDB: acquire_lock(dataset_id)
        DynamoDB--&gt;&gt;CommitHandler: lock_acquired
    else ä½¿ç”¨æ–‡ä»¶é”
        CommitHandler-&gt;&gt;ObjectStore: create_lock_file()
        ObjectStore--&gt;&gt;CommitHandler: lock_acquired
    end
    
    CommitHandler-&gt;&gt;ObjectStore: write_manifest(version_n)
    ObjectStore--&gt;&gt;CommitHandler: write_success
    
    CommitHandler-&gt;&gt;ObjectStore: update_latest_pointer()
    ObjectStore--&gt;&gt;CommitHandler: update_success
    
    alt ä½¿ç”¨ DynamoDB é”
        CommitHandler-&gt;&gt;DynamoDB: release_lock()
    else ä½¿ç”¨æ–‡ä»¶é”
        CommitHandler-&gt;&gt;ObjectStore: delete_lock_file()
    end
    
    CommitHandler--&gt;&gt;Transaction: commit_success
    Transaction--&gt;&gt;Client: è¿”å›æ–°ç‰ˆæœ¬å·
</code></pre>
<hr/>
<h3 data-id="heading-9">ç¬¬ä¸€éƒ¨åˆ†ï¼šLance çš„å®šä½ä¸åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-10">What - Lance æ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<p><strong>å®šä¹‰</strong>ï¼šLance æ˜¯ä¸€ä¸ª Apache è®¸å¯çš„ã€å¼€æºçš„åˆ—å¼æ•°æ®æ ¼å¼å’Œè¡¨æ ¼å¼ï¼ˆLakehouse Formatï¼‰ã€‚</p>
<p>æ ¸å¿ƒç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>åˆ—å¼å­˜å‚¨</strong>ï¼šæŒ‰åˆ—è€Œéè¡Œå­˜å‚¨æ•°æ®ï¼Œé€‚åˆåˆ†æå‹æŸ¥è¯¢</li>
<li><strong>å‘é‡åŸç”Ÿæ”¯æŒ</strong>ï¼šå†…ç½®å‘é‡ç´¢å¼•å’Œæœç´¢èƒ½åŠ›</li>
<li><strong>å¤šæ¨¡æ€æ•°æ®</strong>ï¼šæ”¯æŒå›¾åƒã€è§†é¢‘ã€éŸ³é¢‘ã€æ–‡æœ¬ã€å‘é‡ç­‰æ··åˆå­˜å‚¨</li>
<li><strong>ACID äº‹åŠ¡</strong>ï¼šæ”¯æŒåŸå­æ€§æ›´æ–°å’Œç‰ˆæœ¬æ§åˆ¶</li>
</ul>
<h4 data-id="heading-11">Why - ä¸ºä»€ä¹ˆéœ€è¦ Lanceï¼Ÿ</h4>
<h5 data-id="heading-12">é—®é¢˜èƒŒæ™¯</h5>
<p>ä¼ ç»Ÿæ•°æ®æ ¼å¼å­˜åœ¨çš„ç—›ç‚¹ï¼š</p>















































<table><thead><tr><th>åŠŸèƒ½éœ€æ±‚</th><th>Parquet</th><th>ORC</th><th>Iceberg</th><th>Lance</th></tr></thead><tbody><tr><td>éšæœºè®¿é—®é€Ÿåº¦</td><td>â­</td><td>â­</td><td>â­â­</td><td>â­â­â­â­â­</td></tr><tr><td>å‘é‡æœç´¢æ”¯æŒ</td><td>âŒ</td><td>âŒ</td><td>âŒ</td><td>âœ…</td></tr><tr><td>å¤šæ¨¡æ€æ”¯æŒ</td><td>å·®</td><td>å·®</td><td>å·®</td><td>âœ…</td></tr><tr><td>Schema æ¼”åŒ–</td><td>å›°éš¾</td><td>å›°éš¾</td><td>âœ…</td><td>âœ…</td></tr><tr><td>ç‰ˆæœ¬æ§åˆ¶</td><td>éœ€è¦å¤–éƒ¨ç³»ç»Ÿ</td><td>éœ€è¦å¤–éƒ¨ç³»ç»Ÿ</td><td>âœ…</td><td>âœ…</td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹© Lanceï¼Ÿ</strong></p>
<ol>
<li><strong>100 å€éšæœºè®¿é—®é€Ÿåº¦æå‡</strong>ï¼šParquet ä¸º 100ns/éšæœºè®¿é—®ï¼ŒLance ä¸º 1nsï¼Œå¯¹äº ML è®­ç»ƒè‡³å…³é‡è¦</li>
<li><strong>å‘é‡æœç´¢åŠ é€Ÿ</strong>ï¼šå†…ç½® IVF-PQã€HNSW ç­‰ç´¢å¼•ï¼Œæ¯«ç§’çº§æŸ¥è¯¢</li>
<li><strong>é›¶æ‹·è´ç‰ˆæœ¬æ§åˆ¶</strong>ï¼šæ— éœ€æ•°æ®å¤åˆ¶å³å¯å®ç°ç‰ˆæœ¬ç®¡ç†å’Œæ—¶é—´æ—…è¡Œ</li>
<li><strong>å¤šæ¨¡æ€ä¸€ä½“åŒ–</strong>ï¼šåœ¨åŒä¸€æ ¼å¼ä¸­å­˜å‚¨ç»“æ„åŒ–æ•°æ®å’Œéç»“æ„åŒ–æ•°æ®</li>
</ol>
<h4 data-id="heading-13">How - Lance å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Ÿ</h4>
<h5 data-id="heading-14">æ ¸å¿ƒè®¾è®¡åŸåˆ™</h5>
<pre><code class="hljs language-python" lang="python">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Lance çš„å››å¤§è®¾è®¡æ”¯æŸ±                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">1</span>ï¸âƒ£ é«˜æ•ˆçš„åˆ—å¼å­˜å‚¨                                        â”‚
â”‚    â†’ é€šè¿‡å¤šç§ç¼–ç ï¼ˆBitpackingã€<span class="hljs-type">Dict</span>ã€RLEï¼‰æœ€å°åŒ–å­˜å‚¨    â”‚
â”‚    â†’ æ”¯æŒå¿«é€Ÿåˆ—æ‰«æå’Œéšæœºè®¿é—®                            â”‚
â”‚                                                          â”‚
â”‚ <span class="hljs-number">2</span>ï¸âƒ£ å‘é‡åŸç”Ÿèƒ½åŠ›                                         â”‚
â”‚    â†’ å†…ç½®å‘é‡ç´¢å¼•å’Œé‡åŒ–æŠ€æœ¯                             â”‚
â”‚    â†’ æ”¯æŒæ··åˆæœç´¢ï¼ˆå‘é‡+SQLï¼‰                            â”‚
â”‚                                                          â”‚
â”‚ <span class="hljs-number">3</span>ï¸âƒ£ çµæ´»çš„ç‰ˆæœ¬ç®¡ç†                                       â”‚
â”‚    â†’ Manifest + Fragment è®¾è®¡                           â”‚
â”‚    â†’ æ— é”å¹¶å‘æ›´æ–°                                       â”‚
â”‚                                                          â”‚
â”‚ <span class="hljs-number">4</span>ï¸âƒ£ äº‘åŸç”Ÿæ¶æ„                                          â”‚
â”‚    â†’ åŸºäºå¯¹è±¡å­˜å‚¨ï¼ˆS3/GCS/Azureï¼‰                       â”‚
â”‚    â†’ åˆ†å¸ƒå¼è®¡ç®—å‹å¥½                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-15">ç¬¬äºŒéƒ¨åˆ†ï¼šä¸å…¶ä»–æ ¼å¼çš„å¯¹æ¯”ä¼˜åŠ¿</h3>
<h4 data-id="heading-16">Parquet ä¸ Lance çš„å·®å¼‚</h4>
<p><strong>åœºæ™¯ 1ï¼šæœºå™¨å­¦ä¹ è®­ç»ƒ</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Parquet çš„é—®é¢˜ï¼šéœ€è¦é¡ºåºè¯»å–å¤§éƒ¨åˆ†æ•°æ®</span>
<span class="hljs-comment"># è®­ç»ƒä¸€ä¸ª 1000 ä¸‡è¡Œçš„æ•°æ®é›†ï¼Œä½†æ¯æ¬¡è¿­ä»£åªéœ€è¦ 100 è¡Œ</span>
<span class="hljs-comment"># - è¯»å– Parquetï¼šå¿…é¡»æ‰«ææ•´ä¸ªæ–‡ä»¶ï¼Œæ€§èƒ½ä½</span>

<span class="hljs-comment"># Lance çš„ä¼˜åŠ¿ï¼šæ”¯æŒéšæœºè¡Œè®¿é—®</span>
dataset = lance.<span class="hljs-built_in">open</span>(<span class="hljs-string">"features.lance"</span>)
<span class="hljs-comment"># ç›´æ¥è·å–ç¬¬ 5000ã€8000ã€12000 è¡Œï¼Œæ— éœ€å…¨æ‰«æ</span>
rows = dataset.take([<span class="hljs-number">5000</span>, <span class="hljs-number">8000</span>, <span class="hljs-number">12000</span>])
</code></pre>
<p><strong>åœºæ™¯ 2ï¼šå¤šæ¨¡æ€å­˜å‚¨</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># éœ€è¦å­˜å‚¨ï¼šæ–‡æœ¬ + å›¾åƒå‘é‡ + åŸå§‹å›¾åƒ</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> lance

df = pd.DataFrame({
    <span class="hljs-string">'text'</span>: [<span class="hljs-string">'A cat sleeping'</span>, <span class="hljs-string">'A dog running'</span>, ...],
    <span class="hljs-string">'image_vector'</span>: [[<span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.3</span>, ...], ...],  <span class="hljs-comment"># å‘é‡åµŒå…¥</span>
    <span class="hljs-string">'image_blob'</span>: [image_bytes_1, image_bytes_2, ...],  <span class="hljs-comment"># åŸå§‹å›¾åƒ</span>
})

<span class="hljs-comment"># Lance åŸç”Ÿæ”¯æŒè¿™ç§æ··åˆå­˜å‚¨</span>
dataset = lance.write_dataset(df, <span class="hljs-string">"multimodal.lance"</span>)
</code></pre>
<p><strong>åœºæ™¯ 3ï¼šå®æ—¶ç‰¹å¾æ›´æ–°</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># éœ€è¦ä¸æ–­æ›´æ–°ç‰¹å¾å€¼ï¼ŒåŒæ—¶ä¿æŒç‰ˆæœ¬å†å²</span>
<span class="hljs-comment"># Iceberg éœ€è¦é‡å†™å¤§é‡æ–‡ä»¶</span>
<span class="hljs-comment"># Lance åªéœ€è¿½åŠ æ–° Fragment + æ›´æ–° Manifest</span>

dataset = lance.<span class="hljs-built_in">open</span>(<span class="hljs-string">"features.lance"</span>)
dataset.add_column(<span class="hljs-string">"new_feature"</span>, values)  <span class="hljs-comment"># åŸå­æ€§æ·»åŠ </span>
<span class="hljs-comment"># è‡ªåŠ¨ç‰ˆæœ¬æ§åˆ¶ï¼Œå¯å›æº¯åˆ°ä»»ä½•å†å²ç‰ˆæœ¬</span>
</code></pre>
<h4 data-id="heading-17">ä¸ Iceberg çš„å·®å¼‚</h4>



































<table><thead><tr><th>æ–¹é¢</th><th>Iceberg</th><th>Lance</th></tr></thead><tbody><tr><td>è®¾è®¡ç›®æ ‡</td><td>æ•°æ®æ¹–ã€è¡¨ç®¡ç†</td><td>å‘é‡æœç´¢ã€ML å·¥ä½œæµ</td></tr><tr><td>å‘é‡æ”¯æŒ</td><td>æ— åŸç”Ÿæ”¯æŒ</td><td>å†…ç½®ç´¢å¼•å’Œé‡åŒ–</td></tr><tr><td>éšæœºè®¿é—®</td><td>éœ€è¦é¢å¤–ä¼˜åŒ–</td><td>å†…ç½®ä¼˜åŒ–</td></tr><tr><td>å­¦ä¹ æ›²çº¿</td><td>é™¡å³­</td><td>å¹³ç¼“</td></tr><tr><td>ç”Ÿæ€æ”¯æŒ</td><td>æ›´å®Œå–„ï¼ˆSparkã€Flinkï¼‰</td><td>æ­£åœ¨å¿«é€Ÿå‘å±•</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ•´ä½“æ¶æ„è®¾è®¡æ€æƒ³</h3>
<h4 data-id="heading-19">åˆ†å±‚æ¶æ„æ¨¡å‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "åº”ç”¨å±‚ Application"
        A1["Python API"]
        A2["Java API"]
        A3["SQL Interface"]
    end
    
    subgraph "æŸ¥è¯¢å¼•æ“å±‚ Query Engine"
        B1["DataFusion"]
        B2["Scanner"]
        B3["Index Planner"]
    end
    
    subgraph "æ•°æ®ç®¡ç†å±‚ Data Management"
        C1["Dataset"]
        C2["Transaction"]
        C3["Version Control"]
    end
    
    subgraph "ç´¢å¼•åŠ é€Ÿå±‚ Index Acceleration"
        D1["å‘é‡ç´¢å¼•&lt;br/&gt;IVF/HNSW"]
        D2["æ ‡é‡ç´¢å¼•&lt;br/&gt;BTree/Bitmap"]
    end
    
    subgraph "å­˜å‚¨ç¼–ç å±‚ Storage &amp; Encoding"
        E1["File Format"]
        E2["Compression"]
        E3["Encoding"]
    end
    
    subgraph "å¯¹è±¡å­˜å‚¨ Object Storage"
        F["S3/GCS/Local"]
    end
    
    A1 --&gt; B1
    A2 --&gt; B1
    A3 --&gt; B1
    B1 --&gt; B2
    B1 --&gt; B3
    B2 --&gt; C1
    B3 --&gt; C1
    C1 --&gt; C2
    C1 --&gt; C3
    C1 --&gt; D1
    C1 --&gt; D2
    D1 --&gt; E1
    D2 --&gt; E1
    E1 --&gt; E2
    E2 --&gt; E3
    E3 --&gt; F
</code></pre>
<h4 data-id="heading-20">æ ¸å¿ƒè®¾è®¡æ€æƒ³è§£æ</h4>
<h5 data-id="heading-21">1. <strong>æ¨¡å—åŒ–ä¸å…³æ³¨ç‚¹åˆ†ç¦»</strong></h5>
<p>Lance éµå¾ªä¸¥æ ¼çš„åˆ†å±‚è®¾è®¡ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨å±‚ï¼šæä¾›ç”¨æˆ·å‹å¥½çš„ APIï¼ˆPythonã€Javaã€<span class="hljs-keyword">SQL</span>ï¼‰         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æŸ¥è¯¢å±‚ï¼šè´Ÿè´£æŸ¥è¯¢è§„åˆ’ã€ä¼˜åŒ–ã€æ‰§è¡Œ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å±‚ï¼šDatasetã€Transactionã€ç‰ˆæœ¬ç®¡ç†                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç´¢å¼•å±‚ï¼šå‘é‡ç´¢å¼•ã€æ ‡é‡ç´¢å¼•çš„æ„å»ºå’ŒæŸ¥è¯¢                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å­˜å‚¨å±‚ï¼šæ–‡ä»¶æ ¼å¼ã€ç¼–ç ã€å‹ç¼©ã€IO è°ƒåº¦                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸºç¡€è®¾æ–½ï¼šå¯¹è±¡å­˜å‚¨ã€ç¼“å­˜ã€çº¿ç¨‹ç®¡ç†                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>æ¯å±‚å¯ç‹¬ç«‹ä¼˜åŒ–å’Œæ‰©å±•</li>
<li>æ¸…æ™°çš„æ¥å£è¾¹ç•Œä¾¿äºç†è§£å’Œç»´æŠ¤</li>
<li>ä¾¿äºæ–°åŠŸèƒ½çš„æ·»åŠ ï¼ˆå¦‚æ–°çš„ç´¢å¼•ç±»å‹ï¼‰</li>
</ul>
<h5 data-id="heading-22">2. <strong>å¼‚æ­¥ä¼˜å…ˆè®¾è®¡</strong></h5>
<p>Lance å¤§é‡ä½¿ç”¨ Rust çš„å¼‚æ­¥ç¼–ç¨‹ï¼ˆtokio è¿è¡Œæ—¶ï¼‰ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// ä¸é˜»å¡ IO çš„å†™å…¥</span>
<span class="hljs-keyword">await</span> dataset.<span class="hljs-title function_ invoke__">write</span>(data);

<span class="hljs-comment">// å¹¶å‘è¯»å–å¤šä¸ª Fragment</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">futures</span> = fragments
    .<span class="hljs-title function_ invoke__">iter</span>()
    .<span class="hljs-title function_ invoke__">map</span>(|f| f.<span class="hljs-title function_ invoke__">read_async</span>())
    .collect::&lt;<span class="hljs-type">Vec</span>&lt;_&gt;&gt;();
futures::future::<span class="hljs-title function_ invoke__">join_all</span>(futures).<span class="hljs-keyword">await</span>;
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆï¼Ÿ</strong></p>
<ul>
<li>I/O ä¸å†é˜»å¡è®¡ç®—çº¿ç¨‹</li>
<li>å•ä¸ªçº¿ç¨‹å¯å¤„ç†æ•°åƒä¸ªå¹¶å‘è¯·æ±‚</li>
<li>åœ¨äº‘ç¯å¢ƒä¸­è¡¨ç°ä¼˜å¼‚</li>
</ul>
<h5 data-id="heading-23">3. <strong>é›¶æ‹·è´ä¸ Arrow åŸç”Ÿ</strong></h5>
<p>Lance ä¸ Apache Arrow æ·±åº¦é›†æˆï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// æ•°æ®ä»æ–‡ä»¶è§£ç ç›´æ¥å˜æˆ Arrow RecordBatch</span>
<span class="hljs-comment">// æ— éœ€ä¸­é—´è½¬æ¢æˆ–æ‹·è´</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">batch</span>: RecordBatch = decoder.<span class="hljs-title function_ invoke__">decode</span>().<span class="hljs-keyword">await</span>?;

<span class="hljs-comment">// RecordBatch å¯ç›´æ¥ä¼ é€’ç»™ NumPyã€Pandasã€Polars</span>
<span class="hljs-comment">// å…±äº«å†…å­˜åœ°å€ï¼Œé›¶æ‹·è´</span>
</code></pre>
<h5 data-id="heading-24">4. <strong>ç´¢å¼•é€æ˜åŒ–</strong></h5>
<p>ç´¢å¼•å¯¹ç”¨æˆ·å®Œå…¨é€æ˜ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç”¨æˆ·ç¼–å†™ç®€å•çš„æŸ¥è¯¢</span>
results = dataset.search(query_vector, k=<span class="hljs-number">10</span>)

<span class="hljs-comment"># å†…éƒ¨è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç´¢å¼•</span>
<span class="hljs-comment"># - å¦‚æœæœ‰å‘é‡ç´¢å¼• â†’ ä½¿ç”¨ IVF/HNSW</span>
<span class="hljs-comment"># - å¦‚æœæœ‰æ ‡é‡ç´¢å¼• â†’ ä½¿ç”¨è°“è¯ä¸‹æ¨</span>
<span class="hljs-comment"># - å¦åˆ™ â†’ å…¨è¡¨æ‰«æ</span>
</code></pre>
<hr/>
<h3 data-id="heading-25">å®æˆ˜åœºæ™¯ç¤ºä¾‹</h3>
<h4 data-id="heading-26">åœºæ™¯ 1ï¼šç”µå•†æ¨èç³»ç»Ÿ</h4>
<p><strong>éœ€æ±‚</strong>ï¼š</p>
<ul>
<li>å­˜å‚¨ 1 äº¿ä¸ªå•†å“ï¼ˆIDã€åç§°ã€æè¿°ã€ä»·æ ¼ã€åˆ†ç±»ï¼‰</li>
<li>æ¯ä¸ªå•†å“æœ‰ 768 ç»´å‘é‡åµŒå…¥</li>
<li>éœ€è¦åŸºäºå‘é‡çš„ç›¸ä¼¼å•†å“æ¨è</li>
<li>éœ€è¦åŸºäºä»·æ ¼ã€åˆ†ç±»çš„æ ‡é‡è¿‡æ»¤</li>
</ul>
<p><strong>Lance è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> lance
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> lance.vector_search <span class="hljs-keyword">import</span> IVF_PQ

<span class="hljs-comment"># 1. åˆå§‹æ•°æ®åŠ è½½</span>
products = pd.read_csv(<span class="hljs-string">"products.csv"</span>)
dataset = lance.write_dataset(products, <span class="hljs-string">"products.lance"</span>)

<span class="hljs-comment"># 2. åˆ›å»ºå‘é‡ç´¢å¼•åŠ é€Ÿæœç´¢</span>
dataset.create_index(<span class="hljs-string">"vector"</span>, index_type=IVF_PQ(num_partitions=<span class="hljs-number">256</span>))

<span class="hljs-comment"># 3. æ¨èæŸ¥è¯¢ï¼ˆå‘é‡ + SQLï¼‰</span>
query_vector = embed_text(<span class="hljs-string">"é«˜ç«¯è¿åŠ¨é‹"</span>)
results = dataset.search(
    query_vector,
    k=<span class="hljs-number">100</span>,
    where=<span class="hljs-string">"price &lt; 500 AND category == 'é‹ç±»'"</span>,  <span class="hljs-comment"># æ ‡é‡è¿‡æ»¤</span>
    metric=<span class="hljs-string">"cosine"</span>
)
<span class="hljs-comment"># æ¯«ç§’çº§è¿”å›æœ€ç›¸å…³çš„ 100 ä¸ªå•†å“</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆ Lance ä¼˜äº Elasticsearchï¼Ÿ</strong></p>
<ul>
<li>æ›´ç´§å‡‘çš„å­˜å‚¨ï¼ˆç¼–ç ä¼˜åŒ–ï¼‰</li>
<li>æ›´å¿«çš„å‘é‡æœç´¢ï¼ˆPQ é‡åŒ–ï¼‰</li>
<li>åŸç”Ÿ SQL æ”¯æŒï¼ˆæ— éœ€å†™ JSON æŸ¥è¯¢ï¼‰</li>
<li>æ›´ä½çš„å­¦ä¹ æˆæœ¬</li>
</ul>
<h4 data-id="heading-27">åœºæ™¯ 2ï¼šç”Ÿç‰©ä¿¡æ¯å­¦åˆ†æ</h4>
<p><strong>éœ€æ±‚</strong>ï¼š</p>
<ul>
<li>å­˜å‚¨åŸºå› åºåˆ—æ•°æ®ï¼ˆè¶…å¤§ BLOBï¼‰</li>
<li>å­˜å‚¨ DNA åºåˆ—çš„å‘é‡åŒ–è¡¨ç¤º</li>
<li>æ”¯æŒç›¸ä¼¼æ€§æœç´¢å’Œç»Ÿè®¡åˆ†æ</li>
</ul>
<p><strong>Lance ä¼˜åŠ¿</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å­˜å‚¨åŸå§‹ DNA åºåˆ— + å‘é‡åŒ–è¡¨ç¤º</span>
dna_data = pd.DataFrame({
    <span class="hljs-string">'gene_id'</span>: [<span class="hljs-string">'BRCA1'</span>, <span class="hljs-string">'TP53'</span>, ...],
    <span class="hljs-string">'sequence'</span>: [dna_seq_1, dna_seq_2, ...],  <span class="hljs-comment"># è¶…å¤§å­—ç¬¦ä¸²</span>
    <span class="hljs-string">'embedding'</span>: [vec1, vec2, ...],  <span class="hljs-comment"># 768 ç»´å‘é‡</span>
    <span class="hljs-string">'properties'</span>: [prop1, prop2, ...]  <span class="hljs-comment"># å…ƒæ•°æ®</span>
})

dataset = lance.write_dataset(dna_data, <span class="hljs-string">"dna.lance"</span>)

<span class="hljs-comment"># ç›´æ¥æ”¯æŒæ··åˆæŸ¥è¯¢</span>
results = dataset.search(
    query_embedding,
    k=<span class="hljs-number">10</span>,
    where=<span class="hljs-string">"properties.organism == 'human'"</span>
)
</code></pre>
<hr/>
<h3 data-id="heading-28">æ ¸å¿ƒå·¥ä½œæµæ¦‚è§ˆ</h3>
<h4 data-id="heading-29">ä¸€ä¸ªå®Œæ•´çš„ Lance ä½¿ç”¨å‘¨æœŸ</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User
    participant Python API
    participant Dataset
    participant Index
    participant Storage
    
    User-&gt;&gt;Python API: 1. åˆ›å»ºæ•°æ®é›†
    Python API-&gt;&gt;Dataset: write_dataset(data)
    Dataset-&gt;&gt;Storage: å†™å…¥æ–‡ä»¶
    
    User-&gt;&gt;Python API: 2. åˆ›å»ºç´¢å¼•
    Python API-&gt;&gt;Dataset: create_index()
    Dataset-&gt;&gt;Index: æ„å»ºå‘é‡ç´¢å¼•
    Index-&gt;&gt;Storage: ä¿å­˜ç´¢å¼•
    
    User-&gt;&gt;Python API: 3. æ‰§è¡ŒæŸ¥è¯¢
    Python API-&gt;&gt;Dataset: search(query)
    Dataset-&gt;&gt;Index: ä½¿ç”¨ç´¢å¼•åŠ é€Ÿ
    Index-&gt;&gt;Storage: è¯»å–æ•°æ®
    Python API--&gt;&gt;User: è¿”å›ç»“æœ
    
    User-&gt;&gt;Python API: 4. æ›´æ–°æ•°æ®
    Python API-&gt;&gt;Dataset: add_column()/update()
    Dataset-&gt;&gt;Storage: åŸå­æ€§æäº¤
    Dataset--&gt;&gt;User: æ–°ç‰ˆæœ¬å·
</code></pre>
<hr/>
<h3 data-id="heading-30">å…³é”®è®¾è®¡å†³ç­–æ€»ç»“</h3>








































<table><thead><tr><th>å†³ç­–</th><th>åŸå› </th><th>æƒè¡¡</th></tr></thead><tbody><tr><td><strong>Rust å®ç°</strong></td><td>æ€§èƒ½ã€å†…å­˜å®‰å…¨</td><td>å¼€å‘æ•ˆç‡ç¨ä½</td></tr><tr><td><strong>Async First</strong></td><td>é«˜å¹¶å‘ã€äº‘åŸç”Ÿ</td><td>ç¼–ç¨‹å¤æ‚åº¦å¢åŠ </td></tr><tr><td><strong>åˆ—å¼å­˜å‚¨</strong></td><td>æ‰«ææ€§èƒ½ã€å‹ç¼©ç‡</td><td>ä¸é€‚åˆè¡Œçº§æ›´æ–°</td></tr><tr><td><strong>å¤šç§ç¼–ç </strong></td><td>é€‚åº”ä¸åŒæ•°æ®ç±»å‹</td><td>ç¼–ç /è§£ç å¼€é”€</td></tr><tr><td><strong>å‘é‡ç´¢å¼•</strong></td><td>ML å·¥ä½œæµå¿…éœ€</td><td>ç´¢å¼•æ„å»ºæˆæœ¬</td></tr><tr><td><strong>é›¶æ‹·è´è®¾è®¡</strong></td><td>å‡å°‘å†…å­˜å ç”¨</td><td>ä¾èµ– Arrow å…¼å®¹æ€§</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-31">æ€»ç»“</h3>
<p>Lance é€šè¿‡ä»¥ä¸‹åˆ›æ–°è§£å†³äº† AI æ—¶ä»£çš„æ•°æ®å­˜å‚¨éš¾é¢˜ï¼š</p>
<ol>
<li><strong>æ€§èƒ½ä¼˜å…ˆ</strong>ï¼š100 å€éšæœºè®¿é—®ã€æ¯«ç§’çº§å‘é‡æœç´¢</li>
<li><strong>åŠŸèƒ½å…¨é¢</strong>ï¼šå‘é‡ã€SQLã€å¤šæ¨¡æ€åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­</li>
<li><strong>ç”¨æˆ·å‹å¥½</strong>ï¼šè‡ªåŠ¨ç´¢å¼•é€‰æ‹©ã€é€æ˜çš„ä¼˜åŒ–</li>
<li><strong>ç”Ÿäº§å°±ç»ª</strong>ï¼šACID äº‹åŠ¡ã€ç‰ˆæœ¬æ§åˆ¶ã€äº‘æ”¯æŒ</li>
</ol>
<p>åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ Lance çš„å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œä»é¡¹ç›®ç»“æ„ã€æ•°æ®æ¨¡å‹ã€æ–‡ä»¶æ ¼å¼ã€åˆ°ç´¢å¼•å’ŒæŸ¥è¯¢å¼•æ“ï¼Œå…¨é¢ç†è§£è¿™ä¸ªå¼ºå¤§çš„ç³»ç»Ÿæ˜¯å¦‚ä½•è¿ä½œçš„ã€‚</p>
<hr/>
<h3 data-id="heading-32">å…³é”®æ¦‚å¿µé€Ÿè®°</h3>
<ul>
<li><strong>åˆ—å¼å­˜å‚¨</strong>ï¼šæŒ‰åˆ—è€Œéè¡Œç»„ç»‡æ•°æ®</li>
<li><strong>å‘é‡ç´¢å¼•</strong>ï¼šåŠ é€Ÿå‘é‡ç›¸ä¼¼æ€§æœç´¢çš„æ•°æ®ç»“æ„</li>
<li><strong>IVF-PQ</strong>ï¼šä¹˜ç§¯é‡åŒ–çš„å€’æ’æ–‡ä»¶ï¼ŒLance ä¸­å¸¸ç”¨çš„ç´¢å¼•æ–¹å¼</li>
<li><strong>Manifest</strong>ï¼šè®°å½•æ•°æ®é›†ç‰ˆæœ¬ä¿¡æ¯çš„å…ƒæ•°æ®æ–‡ä»¶</li>
<li><strong>Fragment</strong>ï¼šæ•°æ®é›†ä¸­çš„æ•°æ®åˆ†ç‰‡å•ä½</li>
<li><strong>é›¶æ‹·è´</strong>ï¼šæ•°æ®åœ¨å†…å­˜ä¸­ä¼ é€’è€Œæ— éœ€å¤åˆ¶</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é—®é¢˜è®°å½• - Android IdleHandler æ²¡æœ‰æ‰§è¡Œ]]></title>    <link>https://juejin.cn/post/7577016562253398067</link>    <guid>https://juejin.cn/post/7577016562253398067</guid>    <pubDate>2025-11-27T10:13:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577016562253398067" data-draft-id="7576968345875496987" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é—®é¢˜è®°å½• - Android IdleHandler æ²¡æœ‰æ‰§è¡Œ"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-27T10:13:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Best_Jerry"/> <meta itemprop="url" content="https://juejin.cn/user/1099167360106999"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é—®é¢˜è®°å½• - Android IdleHandler æ²¡æœ‰æ‰§è¡Œ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167360106999/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Best_Jerry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T10:13:28.000Z" title="Thu Nov 27 2025 10:13:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. é—®é¢˜èƒŒæ™¯</h2>
<p>æœ€è¿‘æµ‹è¯•åŒå­¦åé¦ˆäº†ä¸€ä¸ªé—®é¢˜ï¼Œæœ‰ä¸ªè‡ªå®šä¹‰ View çš„å†…å®¹åŒºåŸŸåœ¨æŸä¸ªç‰¹å®šåœºæ™¯ä¸‹å±•ç¤ºç©ºç™½ã€‚</p>
<p>é¦–å…ˆæŠ“åŒ…çœ‹äº†åç«¯ä¸‹å‘çš„æ•°æ®æ˜¯æ­£å¸¸çš„ï¼ŒåŒæ—¶æ•°æ®ä¹Ÿæ­£ç¡®ä¼ ç»™äº† Viewï¼Œå¯ä»¥æ’é™¤æ˜¯æ•°æ®é—®é¢˜ã€‚</p>
<p>æ¥ä¸‹æ¥æ€€ç–‘æ˜¯ View çš„åˆå§‹åŒ–æœ‰é—®é¢˜ï¼Œæ–­ç‚¹å‘ç°ï¼ŒView å†…éƒ¨çš„åˆå§‹åŒ–æ–¹æ³•çš„ç¡®æ²¡æœ‰æ‰§è¡Œåˆ°ã€‚ç”±äºè¿™ä¸ª View ä¸æ˜¯é¡µé¢é¦–å±å¿…é¡»å±•ç¤ºçš„ï¼Œä¸ºäº†æå‡é¦–å±æ‰“å¼€é€Ÿåº¦ï¼Œå®ƒçš„åˆå§‹åŒ–æ–¹æ³•æ˜¯é€šè¿‡ <code>addIdleHandler</code> çš„æ–¹å¼å»è§¦å‘ã€‚</p>
<p>æŒ‰ç†è¯´ï¼Œä¸»çº¿ç¨‹å¤„ç†å®Œé¦–å±çš„ UI æ¸²æŸ“ä»¥åŠå…¶ä»–è®¡ç®—å·¥ä½œä¹‹åï¼Œæ€»ä¼šæœ‰ç©ºé—²çš„æ—¶æœºæ‰§è¡Œ <code>IdleHandler</code> ä»»åŠ¡ã€‚ä½†è¿™ä¸ª <code>IdleHandler</code> ä¸€ç›´å¾—ä¸åˆ°æ‰§è¡Œï¼Œé‚£åªèƒ½è¯´æ˜ä¸»çº¿ç¨‹ä¸€ç›´å¤„äºç¹å¿™çš„çŠ¶æ€ã€‚</p>
<blockquote>
<p>è¿™é‡Œå…ˆç›´æ¥è¯´åŸå› ï¼šè¯¥åœºæ™¯ä¸‹å­˜åœ¨å¤šä¸ªè‡ªå®šä¹‰ <code>TextView</code> åœ¨ <code>onLayout()</code> æ–¹æ³•ä¸­è°ƒç”¨ update æ–¹æ³•ï¼Œupdate æ–¹æ³•åˆä¼šä½¿å¾— <code>onLayout()</code> æ–¹æ³•è¢«è°ƒç”¨ï¼Œä»¥æ­¤æ— é™å¾ªç¯ï¼Œå‘ MessageQueue ä¸€ç›´å‘é€å¤§é‡ Messageï¼Œå¯¼è‡´ä¸»çº¿ç¨‹æ ¹æœ¬æ²¡æœ‰ç©ºé—²çš„æ—¶é—´æ‰§è¡Œ <code>IdleHandler</code> ä»»åŠ¡ã€‚ä¸»çº¿ç¨‹è™½ç„¶ç¹å¿™ä½†æ²¡æœ‰å¡é¡¿ï¼Œå› ä¸ºåšçš„éƒ½æ˜¯ UI æ¸²æŸ“å·¥ä½œã€‚</p>
</blockquote>
<p>çŸ¥é“æ˜¯ä¸»çº¿ç¨‹ç¹å¿™å¼•èµ·çš„ä¸éš¾ï¼Œä½†æ˜¯è¦å®šä½åˆ°å…·ä½“æ˜¯å“ªæ®µä»£ç å‡ºçš„é—®é¢˜è¿˜æ˜¯èŠ±äº†ä¸å°‘æ—¶é—´ã€‚è¿‡ç¨‹ä¸­ç»•äº†å¾ˆå¤šå¼¯è·¯ï¼Œæœ€ç»ˆæ‰å¾—çŸ¥æœ‰å¿«é€Ÿå®šä½çš„æ–¹æ³•ï¼Œåœ¨æ­¤åˆ†äº«ç»™å¤§å®¶ï¼š</p>
<blockquote>
<p>é€šè¿‡ <code>Looper.setMessageLogging()</code> æ–¹æ³•ç›‘å¬ä¸»çº¿ç¨‹ MessageQueue ä¸Šçš„ Message æ—¥å¿—ï¼Œè§‚å¯Ÿæ—¥å¿—ä¾¿èƒ½å¾ˆå®¹æ˜“æ‰¾å‡ºé—®é¢˜æ‰€åœ¨ã€‚</p>
</blockquote>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-number">2025</span>-<span class="hljs-number">11</span>-<span class="hljs-number">27</span> <span class="hljs-number">16</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span><span class="hljs-symbol">:</span><span class="hljs-number">26.173</span> <span class="hljs-number">28376</span>-<span class="hljs-number">28494</span> xxx   D  [<span class="hljs-symbol">:</span><span class="hljs-number">0</span>, ]<span class="hljs-symbol">:</span><span class="hljs-number">28376</span> <span class="hljs-number">28376</span> &gt;&gt;&gt;&gt;&gt; <span class="hljs-title class_">Dispatching</span> to <span class="hljs-title class_">Handler</span> (android.view.<span class="hljs-title class_">ViewRootImpl</span><span class="hljs-variable">$ViewRootHandler</span>) {2da134c} com.xxx.yyy.zzz.customTextView<span class="hljs-variable">$$</span><span class="hljs-title class_">ExternalSyntheticLambda1</span><span class="hljs-variable">@82a6bb1</span>: <span class="hljs-number">0</span>
<span class="hljs-number">2025</span>-<span class="hljs-number">11</span>-<span class="hljs-number">27</span> <span class="hljs-number">16</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span><span class="hljs-symbol">:</span><span class="hljs-number">26.174</span> <span class="hljs-number">28376</span>-<span class="hljs-number">28494</span> xxx   D  [<span class="hljs-symbol">:</span><span class="hljs-number">0</span>, ]<span class="hljs-symbol">:</span><span class="hljs-number">28376</span> <span class="hljs-number">28376</span> &lt;&lt;&lt;&lt;&lt; <span class="hljs-title class_">Finished</span> to <span class="hljs-title class_">Handler</span> (android.view.<span class="hljs-title class_">ViewRootImpl</span><span class="hljs-variable">$ViewRootHandler</span>) {2da134c} com.xxx.yyy.zzz.customTextView<span class="hljs-variable">$$</span><span class="hljs-title class_">ExternalSyntheticLambda1</span><span class="hljs-variable">@82a6bb1</span>
<span class="hljs-number">2025</span>-<span class="hljs-number">11</span>-<span class="hljs-number">27</span> <span class="hljs-number">16</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span><span class="hljs-symbol">:</span><span class="hljs-number">26.189</span> <span class="hljs-number">28376</span>-<span class="hljs-number">28494</span> xxx   D  [<span class="hljs-symbol">:</span><span class="hljs-number">0</span>, ]<span class="hljs-symbol">:</span><span class="hljs-number">28376</span> <span class="hljs-number">28376</span> &gt;&gt;&gt;&gt;&gt; <span class="hljs-title class_">Dispatching</span> to <span class="hljs-title class_">Handler</span> (android.view.<span class="hljs-title class_">ViewRootImpl</span><span class="hljs-variable">$ViewRootHandler</span>) {2da134c} com.xxx.yyy.zzz.customTextView<span class="hljs-variable">$$</span><span class="hljs-title class_">ExternalSyntheticLambda1</span><span class="hljs-variable">@9854804</span>: <span class="hljs-number">0</span>
<span class="hljs-number">2025</span>-<span class="hljs-number">11</span>-<span class="hljs-number">27</span> <span class="hljs-number">16</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span><span class="hljs-symbol">:</span><span class="hljs-number">26.189</span> <span class="hljs-number">28376</span>-<span class="hljs-number">28494</span> xxx   D  [<span class="hljs-symbol">:</span><span class="hljs-number">0</span>, ]<span class="hljs-symbol">:</span><span class="hljs-number">28376</span> <span class="hljs-number">28376</span> &lt;&lt;&lt;&lt;&lt; <span class="hljs-title class_">Finished</span> to <span class="hljs-title class_">Handler</span> (android.view.<span class="hljs-title class_">ViewRootImpl</span><span class="hljs-variable">$ViewRootHandler</span>) {2da134c} com.xxx.yyy.zzz.customTextView<span class="hljs-variable">$$</span><span class="hljs-title class_">ExternalSyntheticLambda1</span><span class="hljs-variable">@9854804</span>
<span class="hljs-number">2025</span>-<span class="hljs-number">11</span>-<span class="hljs-number">27</span> <span class="hljs-number">16</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span><span class="hljs-symbol">:</span><span class="hljs-number">26.206</span> <span class="hljs-number">28376</span>-<span class="hljs-number">28494</span> xxx   D  [<span class="hljs-symbol">:</span><span class="hljs-number">0</span>, ]<span class="hljs-symbol">:</span><span class="hljs-number">28376</span> <span class="hljs-number">28376</span> &gt;&gt;&gt;&gt;&gt; <span class="hljs-title class_">Dispatching</span> to <span class="hljs-title class_">Handler</span> (android.view.<span class="hljs-title class_">ViewRootImpl</span><span class="hljs-variable">$ViewRootHandler</span>) {2da134c} com.xxx.yyy.zzz.customTextView<span class="hljs-variable">$$</span><span class="hljs-title class_">ExternalSyntheticLambda1</span><span class="hljs-variable">@d1702b3</span>: <span class="hljs-number">0</span>
<span class="hljs-number">2025</span>-<span class="hljs-number">11</span>-<span class="hljs-number">27</span> <span class="hljs-number">16</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span><span class="hljs-symbol">:</span><span class="hljs-number">26.207</span> <span class="hljs-number">28376</span>-<span class="hljs-number">28494</span> xxx   D  [<span class="hljs-symbol">:</span><span class="hljs-number">0</span>, ]<span class="hljs-symbol">:</span><span class="hljs-number">28376</span> <span class="hljs-number">28376</span> &lt;&lt;&lt;&lt;&lt; <span class="hljs-title class_">Finished</span> to <span class="hljs-title class_">Handler</span> (android.view.<span class="hljs-title class_">ViewRootImpl</span><span class="hljs-variable">$ViewRootHandler</span>) {2da134c} com.xxx.yyy.zzz.customTextView<span class="hljs-variable">$$</span><span class="hljs-title class_">ExternalSyntheticLambda1</span><span class="hljs-variable">@d1702b3</span>
<span class="hljs-number">2025</span>-<span class="hljs-number">11</span>-<span class="hljs-number">27</span> <span class="hljs-number">16</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span><span class="hljs-symbol">:</span><span class="hljs-number">26.223</span> <span class="hljs-number">28376</span>-<span class="hljs-number">28494</span> xxx   D  [<span class="hljs-symbol">:</span><span class="hljs-number">0</span>, ]<span class="hljs-symbol">:</span><span class="hljs-number">28376</span> <span class="hljs-number">28376</span> &gt;&gt;&gt;&gt;&gt; <span class="hljs-title class_">Dispatching</span> to <span class="hljs-title class_">Handler</span> (android.view.<span class="hljs-title class_">ViewRootImpl</span><span class="hljs-variable">$ViewRootHandler</span>) {2da134c} com.xxx.yyy.zzz.customTextView<span class="hljs-variable">$$</span><span class="hljs-title class_">ExternalSyntheticLambda1</span><span class="hljs-variable">@fab846e</span>: <span class="hljs-number">0</span>
<span class="hljs-number">2025</span>-<span class="hljs-number">11</span>-<span class="hljs-number">27</span> <span class="hljs-number">16</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span><span class="hljs-symbol">:</span><span class="hljs-number">26.224</span> <span class="hljs-number">28376</span>-<span class="hljs-number">28494</span> xxx   D  [<span class="hljs-symbol">:</span><span class="hljs-number">0</span>, ]<span class="hljs-symbol">:</span><span class="hljs-number">28376</span> <span class="hljs-number">28376</span> &lt;&lt;&lt;&lt;&lt; <span class="hljs-title class_">Finished</span> to <span class="hljs-title class_">Handler</span> (android.view.<span class="hljs-title class_">ViewRootImpl</span><span class="hljs-variable">$ViewRootHandler</span>) {2da134c} com.xxx.yyy.zzz.customTextView<span class="hljs-variable">$$</span><span class="hljs-title class_">ExternalSyntheticLambda1</span><span class="hljs-variable">@fab846e</span>
<span class="hljs-number">2025</span>-<span class="hljs-number">11</span>-<span class="hljs-number">27</span> <span class="hljs-number">16</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span><span class="hljs-symbol">:</span><span class="hljs-number">26.241</span> <span class="hljs-number">28376</span>-<span class="hljs-number">28494</span> xxx   D  [<span class="hljs-symbol">:</span><span class="hljs-number">0</span>, ]<span class="hljs-symbol">:</span><span class="hljs-number">28376</span> <span class="hljs-number">28376</span> &gt;&gt;&gt;&gt;&gt; <span class="hljs-title class_">Dispatching</span> to <span class="hljs-title class_">Handler</span> (android.view.<span class="hljs-title class_">ViewRootImpl</span><span class="hljs-variable">$ViewRootHandler</span>) {2da134c} com.xxx.yyy.zzz.customTextView<span class="hljs-variable">$$</span><span class="hljs-title class_">ExternalSyntheticLambda1</span><span class="hljs-variable">@a3f91a5</span>: <span class="hljs-number">0</span>
<span class="hljs-number">2025</span>-<span class="hljs-number">11</span>-<span class="hljs-number">27</span> <span class="hljs-number">16</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span><span class="hljs-symbol">:</span><span class="hljs-number">26.242</span> <span class="hljs-number">28376</span>-<span class="hljs-number">28494</span> xxx   D  [<span class="hljs-symbol">:</span><span class="hljs-number">0</span>, ]<span class="hljs-symbol">:</span><span class="hljs-number">28376</span> <span class="hljs-number">28376</span> &lt;&lt;&lt;&lt;&lt; <span class="hljs-title class_">Finished</span> to <span class="hljs-title class_">Handler</span> (android.view.<span class="hljs-title class_">ViewRootImpl</span><span class="hljs-variable">$ViewRootHandler</span>) {2da134c} com.xxx.yyy.zzz.customTextView<span class="hljs-variable">$$</span><span class="hljs-title class_">ExternalSyntheticLambda1</span><span class="hljs-variable">@a3f91a5</span>
<span class="hljs-number">2025</span>-<span class="hljs-number">11</span>-<span class="hljs-number">27</span> <span class="hljs-number">16</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span><span class="hljs-symbol">:</span><span class="hljs-number">26.256</span> <span class="hljs-number">28376</span>-<span class="hljs-number">28494</span> xxx   D  [<span class="hljs-symbol">:</span><span class="hljs-number">0</span>, ]<span class="hljs-symbol">:</span><span class="hljs-number">28376</span> <span class="hljs-number">28376</span> &gt;&gt;&gt;&gt;&gt; <span class="hljs-title class_">Dispatching</span> to <span class="hljs-title class_">Handler</span> (android.view.<span class="hljs-title class_">ViewRootImpl</span><span class="hljs-variable">$ViewRootHandler</span>) {2da134c} com.xxx.yyy.zzz.customTextView<span class="hljs-variable">$$</span><span class="hljs-title class_">ExternalSyntheticLambda1</span><span class="hljs-variable">@27c4d88</span>: <span class="hljs-number">0</span>Æ’
</code></pre>
<p>ä¸Šé¢çš„æ—¥å¿—ä¸­ <code>com.xxx.yyy.zzz.customTextView</code> ä¸æ–­åœ°å¤§é‡å‡ºç°ï¼Œå¿…ç„¶æœ‰é—®é¢˜ï¼Œç‚¹è¿›è¿™ä¸ª TextView é‡Œé¢å¯»æ‰¾è‚¯å®šèƒ½æ‰¾åˆ°é—®é¢˜æ ¹æºï¼Œè¿‡ç¨‹è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚</p>
<p><code>Looper.setMessageLogging()</code> çš„å…·ä½“ç”¨æ³•åœ¨ä¸‹é¢çš„ç¯‡å¹…ä¼šæœ‰è¯´æ˜ã€‚</p>
<h2 data-id="heading-1">2. IdleHandler</h2>
<h3 data-id="heading-2">IdleHandler ç®€ä»‹</h3>
<p>åº”ç”¨ä¸­æœ‰äº›ä»»åŠ¡å¾ˆé‡è¦å¿…é¡»è¢«æ‰§è¡Œï¼Œä½†æ—¶æœºä¸Šåˆæ²¡æœ‰é‚£ä¹ˆè¿«åˆ‡ã€‚äºæ˜¯ä¾¿æœ‰äº† IdleHandlerï¼Œå®ƒæœ€é€‚åˆå¤„ç†è¿™ç§åœºæ™¯ï¼Œæ—¢èƒ½å……åˆ†åˆ©ç”¨ CPU ä½†åˆä¸è·Ÿç´§æ€¥ä»»åŠ¡äº‰å¤º CPUã€‚å½“çº¿ç¨‹æ²¡æœ‰ message éœ€è¦å¤„ç†è€Œé˜»å¡æ—¶ï¼Œç®€å•æ¥è¯´å°±æ˜¯çº¿ç¨‹ç©ºé—²ï¼Œ<code>IdleHandler.queueIdle()</code> è¢«å›è°ƒã€‚<code>queueIdle()</code> è¿”å› false æ—¶å°†è‡ªåŠ¨ä» MessageQueue ä¸­æ¸…ç†å½“å‰ IdleHandlerã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Callback interface for discovering when a thread is going to block
 * waiting for more messages.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IdleHandler</span> {
    <span class="hljs-comment">/**
     * Called when the message queue has run out of messages and will now
     * wait for more.  Return true to keep your idle handler active, false
     * to have it removed.  This may be called if there are still messages
     * pending in the queue, but they are all scheduled to be dispatched
     * after the current time.
     */</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">queueIdle</span><span class="hljs-params">()</span>;
}
</code></pre>
<h3 data-id="heading-3">IdleHandler ç”¨æ³•</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">Looper.myQueue().addIdleHandler(<span class="hljs-keyword">object</span> : IdleHandler {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">queueIdle</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
        Log.d(<span class="hljs-string">"TAG"</span>, <span class="hljs-string">"addIdleHandler example"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    }
})
</code></pre>
<p>ä¸Šé¢è¿™æ®µä»£ç è¾“å‡ºÂ 1 æ¬¡Â <code>addIdleHandler example</code>ã€‚ä¸è¿‡è¦æ˜¯å°† <code>return false</code> æ”¹æˆ <code>return true</code>ï¼Œåˆ™ä¼šåœ¨ç©ºé—²æ—¶é—´å¤šæ¬¡è¾“å‡º <code>addIdleHandler example</code>ï¼Œç›´åˆ°å°†è¿™ä¸ª IdleHandler ç§»é™¤ã€‚</p>
<p><strong>MessageQueue.addIdleHandler()</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Add a new {<span class="hljs-doctag">@link</span> IdleHandler} to this message queue.  This may be
 * removed automatically for you by returning false from
 * {<span class="hljs-doctag">@link</span> IdleHandler#queueIdle IdleHandler.queueIdle()} when it is
 * invoked, or explicitly removing it with {<span class="hljs-doctag">@link</span> #removeIdleHandler}.
 *
 * &lt;p&gt;This method is safe to call from any thread.
 *
 * <span class="hljs-doctag">@param</span> handler The IdleHandler to be added.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addIdleHandler</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> IdleHandler handler)</span> {
    <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">"Can't add a null IdleHandler"</span>);
    }
    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
        mIdleHandlers.add(handler);
    }
}
</code></pre>
<p>Android ç³»ç»Ÿä¸­ä¹Ÿæœ‰ç”¨åˆ° IdleHandlerï¼Œè¯¦è§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faosp-mirror%2Fplatform_frameworks_base%2Fblob%2Fmaster%2Fcore%2Fjava%2Fandroid%2Fapp%2FActivityThread.java%23L2192" target="_blank" title="https://github.com/aosp-mirror/platform_frameworks_base/blob/master/core/java/android/app/ActivityThread.java#L2192" ref="nofollow noopener noreferrer">ActivityThread.scheduleGcIdler()</a>ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GcIdler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MessageQueue</span>.IdleHandler {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">queueIdle</span><span class="hljs-params">()</span> {
        doGcIfNeeded();
        purgePendingResources();
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}

<span class="hljs-meta">@UnsupportedAppUsage</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduleGcIdler</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (!mGcIdlerScheduled) {
        mGcIdlerScheduled = <span class="hljs-literal">true</span>;
        Looper.myQueue().addIdleHandler(mGcIdler);
    }
    mH.removeMessages(H.GC_WHEN_IDLE);
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">unscheduleGcIdler</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (mGcIdlerScheduled) {
        mGcIdlerScheduled = <span class="hljs-literal">false</span>;
        Looper.myQueue().removeIdleHandler(mGcIdler);
    }
    mH.removeMessages(H.GC_WHEN_IDLE);
}
</code></pre>
<h3 data-id="heading-4">æºç åˆ†æ</h3>
<p>çœ‹çœ‹ <code>MessageQueue.next()</code> æ–¹æ³•æ˜¯å¦‚ä½•å¤„ç† IdleHandler çš„ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@UnsupportedAppUsage</span>
Message <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// Return here if the message loop has already quit and been disposed.</span>
    <span class="hljs-comment">// This can happen if the application tries to restart a looper after quit</span>
    <span class="hljs-comment">// which is not supported.</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">ptr</span> <span class="hljs-operator">=</span> mPtr;
    <span class="hljs-keyword">if</span> (ptr == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-type">int</span> <span class="hljs-variable">pendingIdleHandlerCount</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>; <span class="hljs-comment">// -1 only during first iteration</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">nextPollTimeoutMillis</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-keyword">if</span> (nextPollTimeoutMillis != <span class="hljs-number">0</span>) {
            Binder.flushPendingCommands();
        }

        nativePollOnce(ptr, nextPollTimeoutMillis);

        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            <span class="hljs-comment">// Try to retrieve the next message.  Return if found.</span>
            <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> SystemClock.uptimeMillis();
            <span class="hljs-type">Message</span> <span class="hljs-variable">prevMsg</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
            <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> mMessages;
            <span class="hljs-keyword">if</span> (msg != <span class="hljs-literal">null</span> &amp;&amp; msg.target == <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// Stalled by a barrier.  Find the next asynchronous message in the queue.</span>
                <span class="hljs-keyword">do</span> {
                    prevMsg = msg;
                    msg = msg.next;
                } <span class="hljs-keyword">while</span> (msg != <span class="hljs-literal">null</span> &amp;&amp; !msg.isAsynchronous());
            }
            <span class="hljs-keyword">if</span> (msg != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">if</span> (now &lt; msg.when) {
                    <span class="hljs-comment">// Next message is not ready.  Set a timeout to wake up when it is ready.</span>
                    nextPollTimeoutMillis = (<span class="hljs-type">int</span>) Math.min(msg.when - now, Integer.MAX_VALUE);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// Got a message.</span>
                    mBlocked = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">if</span> (prevMsg != <span class="hljs-literal">null</span>) {
                        prevMsg.next = msg.next;
                        <span class="hljs-keyword">if</span> (prevMsg.next == <span class="hljs-literal">null</span>) {
                            mLast = prevMsg;
                        }
                    } <span class="hljs-keyword">else</span> {
                        mMessages = msg.next;
                        <span class="hljs-keyword">if</span> (msg.next == <span class="hljs-literal">null</span>) {
                            mLast = <span class="hljs-literal">null</span>;
                        }
                    }
                    msg.next = <span class="hljs-literal">null</span>;
                    <span class="hljs-keyword">if</span> (DEBUG) Log.v(TAG, <span class="hljs-string">"Returning message: "</span> + msg);
                    msg.markInUse();
                    <span class="hljs-keyword">if</span> (msg.isAsynchronous()) {
                        mAsyncMessageCount--;
                    }
                    <span class="hljs-keyword">return</span> msg;
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// No more messages.</span>
                nextPollTimeoutMillis = -<span class="hljs-number">1</span>;
            }

            <span class="hljs-comment">// Process the quit message now that all pending messages have been handled.</span>
            <span class="hljs-keyword">if</span> (mQuitting) {
                dispose();
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }

            <span class="hljs-comment">// If first time idle, then get the number of idlers to run.</span>
            <span class="hljs-comment">// Idle handles only run if the queue is empty or if the first message</span>
            <span class="hljs-comment">// in the queue (possibly a barrier) is due to be handled in the future.</span>
            <span class="hljs-keyword">if</span> (pendingIdleHandlerCount &lt; <span class="hljs-number">0</span>
                    &amp;&amp; (mMessages == <span class="hljs-literal">null</span> || now &lt; mMessages.when)) {
                pendingIdleHandlerCount = mIdleHandlers.size();
            }
            <span class="hljs-keyword">if</span> (pendingIdleHandlerCount &lt;= <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// No idle handlers to run.  Loop and wait some more.</span>
                <span class="hljs-comment">// æ²¡æœ‰ IdleHandlerï¼Œç»§ç»­å¾ªç¯</span>
                mBlocked = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-keyword">if</span> (mPendingIdleHandlers == <span class="hljs-literal">null</span>) {
                mPendingIdleHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdleHandler</span>[Math.max(pendingIdleHandlerCount, <span class="hljs-number">4</span>)];
            }
            mPendingIdleHandlers = mIdleHandlers.toArray(mPendingIdleHandlers);
        }

        <span class="hljs-comment">// Run the idle handlers.</span>
        <span class="hljs-comment">// We only ever reach this code block during the first iteration.</span>
        <span class="hljs-comment">// è¿è¡Œ IdleHandler</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; pendingIdleHandlerCount; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">IdleHandler</span> <span class="hljs-variable">idler</span> <span class="hljs-operator">=</span> mPendingIdleHandlers[i];
            mPendingIdleHandlers[i] = <span class="hljs-literal">null</span>; <span class="hljs-comment">// release the reference to the handler</span>

            <span class="hljs-type">boolean</span> <span class="hljs-variable">keep</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">try</span> {
                keep = idler.queueIdle();
            } <span class="hljs-keyword">catch</span> (Throwable t) {
                Log.wtf(TAG, <span class="hljs-string">"IdleHandler threw exception"</span>, t);
            }

            <span class="hljs-comment">// åˆ é™¤ä¸è¢«ä¿ç•™çš„ IdleHandler</span>
            <span class="hljs-keyword">if</span> (!keep) {
                <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
                    mIdleHandlers.remove(idler);
                }
            }
        }

        <span class="hljs-comment">// Reset the idle handler count to 0 so we do not run them again.</span>
        pendingIdleHandlerCount = <span class="hljs-number">0</span>;

        <span class="hljs-comment">// While calling an idle handler, a new message could have been delivered</span>
        <span class="hljs-comment">// so go back and look again for a pending message without waiting.</span>
        nextPollTimeoutMillis = <span class="hljs-number">0</span>;
    }
}
</code></pre>
<p>æ­£å¦‚æºç æ‰€è¿°ï¼ŒIdleHandler ä»…åœ¨çº¿ç¨‹ç©ºé—²æ—¶æ‰è¢«æ‰§è¡Œã€‚</p>
<ul>
<li>
<p>å¦‚æœ <code>MessageQueue</code> ä¸­æœ‰æ¶ˆæ¯ï¼Œä¸ä¼šæ‰§è¡Œ IdleHandler</p>
</li>
<li>
<p>æ¯æ¬¡ <code>next()</code> è°ƒç”¨æ—¶ IdleHandler æœ€å¤šåªæœ‰ä¸€æ¬¡è¢«æ‰§è¡Œçš„æœºä¼š</p>
</li>
</ul>
<h2 data-id="heading-5">3. è§£å†³æ–¹æ³•</h2>
<p>ä¸ºä»€ä¹ˆ IdleHandler ä¸è¢«æ‰§è¡Œï¼Ÿå½“ç„¶æ˜¯å› ä¸º <code>MessageQueue</code> ä¸­çš„æ¶ˆæ¯å¤ªå¤šï¼Œæ¯æ¬¡ <code>next()</code> è°ƒç”¨æ—¶éƒ½èƒ½æ‰¾åˆ°ä¸€ä¸ªå¾…å¤„ç†çš„ Messageï¼Œæ‰€ä»¥ IdleHandler æ ¹æœ¬æ²¡æœ‰å¤„ç†çš„æœºä¼šã€‚</p>
<p>é‚£ä¹ˆæ€ä¹ˆæŸ¥çœ‹ <code>MessageQueue</code> ä¸­æœ‰å“ªäº›æ¶ˆæ¯å‘¢ï¼Ÿ</p>
<h3 data-id="heading-6">setMessageLogging()</h3>
<p>æ³¨é‡Šæ–‡æ¡£ä¸­è¯´ï¼Œ<code>setMessageLogging()</code>Â ç”¨äºå½“å‰ Looper å¤„ç† Message æ—¶æ‰“å°æ—¥å¿—ã€‚</p>
<ul>
<li>
<p>ä¼  null å‚æ•°å…³é—­æ—¥å¿—åŠŸèƒ½ï¼Œä¼ é null çš„Â <code>printer</code>Â å¼€å¯æ—¥å¿—åŠŸèƒ½</p>
</li>
<li>
<p>å¼€å¯æ—¥å¿—åŠŸèƒ½åï¼Œä¼šåœ¨æ¯ä¸ª Message åˆ†å‘çš„å¼€å§‹ä»¥åŠç»“æŸæ—¶è¾“å‡ºæ—¥å¿—ä¿¡æ¯åˆ°Â <code>printer</code>ï¼Œå…·ä½“çš„æ—¥å¿—ä¿¡æ¯åŒ…æ‹¬åŒºåˆ† Message çš„ç›®æ ‡ Hander ä»¥åŠ Message å†…å®¹</p>
</li>
</ul>
<p>å¯¹ç…§Â <code>Looper.loop()</code>Â æ–¹æ³•æºç ï¼Œè·Ÿä¸Šé¢æè¿°ä¸€è‡´ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Run the message queue in this thread. Be sure to call
 * {<span class="hljs-doctag">@link</span> #quit()} to end the loop.
 */</span>
<span class="hljs-meta">@SuppressWarnings({"UnusedTokenOfOriginalCallingIdentity",
        "ClearIdentityCallNotFollowedByTryFinally",
        "ResultOfClearIdentityCallNotStoredInVariable"})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">Looper</span> <span class="hljs-variable">me</span> <span class="hljs-operator">=</span> myLooper();
    ...
    <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-keyword">if</span> (!loopOnce(me, ident, thresholdOverride)) {
            <span class="hljs-keyword">return</span>;
        }
    }
}

<span class="hljs-comment">/**
 * Poll and deliver single message, return true if the outer loop should continue.
 */</span>
<span class="hljs-meta">@SuppressWarnings({"UnusedTokenOfOriginalCallingIdentity",
        "ClearIdentityCallNotFollowedByTryFinally"})</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">loopOnce</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Looper me,
        <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> ident, <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> thresholdOverride)</span> {
    ...
    <span class="hljs-comment">// This must be in a local variable, in case a UI event sets the logger</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">Printer</span> <span class="hljs-variable">logging</span> <span class="hljs-operator">=</span> me.mLogging;
    <span class="hljs-keyword">if</span> (logging != <span class="hljs-literal">null</span>) {
        logging.println(<span class="hljs-string">"&gt;&gt;&gt;&gt;&gt; Dispatching to "</span> + msg.target + <span class="hljs-string">" "</span>
                + msg.callback + <span class="hljs-string">": "</span> + msg.what);
    }
    ...
        msg.target.dispatchMessage(msg);
    ...

    <span class="hljs-keyword">if</span> (logging != <span class="hljs-literal">null</span>) {
        logging.println(<span class="hljs-string">"&lt;&lt;&lt;&lt;&lt; Finished to "</span> + msg.target + <span class="hljs-string">" "</span> + msg.callback);
    }
    ...
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h4 data-id="heading-7">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printer</span><span class="hljs-params">()</span></span> {
    Looper.getMainLooper().setMessageLogging { printer -&gt;
        <span class="hljs-keyword">if</span> (printer != <span class="hljs-literal">null</span> &amp;&amp; !printer.contains(<span class="hljs-string">"FrameDisplayEventReceiver"</span>)
            &amp;&amp; !printer.contains(<span class="hljs-string">"HardwareRendererObserver"</span>)
        ) {
            Log.d(<span class="hljs-string">"xxx"</span>, printer)
        }
    }
}
</code></pre>
<p>ä¸ºäº†ä¾¿äº logcat ä¸­è§‚å¯Ÿï¼Œè¿™é‡Œå°†æ—¥å¿—ä¸­åŒ…å« <code>FrameDisplayEventReceiver</code> å’Œ <code>HardwareRendererObserver</code> éƒ½å‰”é™¤äº†ã€‚</p>
<h3 data-id="heading-8">MessageHelper å·¥å…·ç±»</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageHelper</span> : <span class="hljs-type">Choreographer.FrameCallback</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> messagesField: Field? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> nextField: Field? = <span class="hljs-literal">null</span>

    <span class="hljs-keyword">init</span> {
        <span class="hljs-keyword">try</span> {
            messagesField = MessageQueue::<span class="hljs-keyword">class</span>.java.getDeclaredField(<span class="hljs-string">"mMessages"</span>)
            messagesField?.isAccessible = <span class="hljs-literal">true</span>
            nextField = Message::<span class="hljs-keyword">class</span>.java.getDeclaredField(<span class="hljs-string">"next"</span>)
            nextField?.isAccessible = <span class="hljs-literal">true</span>
        } <span class="hljs-keyword">catch</span> (e: NoSuchFieldException) {
            e.printStackTrace()
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printMessages</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> queue = Looper.myQueue()
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">var</span> msg: Message? = messagesField?.<span class="hljs-keyword">get</span>(queue) <span class="hljs-keyword">as</span> Message?
            <span class="hljs-keyword">val</span> sb = StringBuilder()
            <span class="hljs-keyword">while</span> (msg != <span class="hljs-literal">null</span>) {
                sb.append(msg.toString())
                sb.append(<span class="hljs-string">"\n"</span>)
                msg = nextField?.<span class="hljs-keyword">get</span>(msg) <span class="hljs-keyword">as</span> Message?
            }
            <span class="hljs-keyword">val</span> finalString = sb.toString()
            <span class="hljs-keyword">if</span> (!finalString.contains(<span class="hljs-string">"FrameDisplayEventReceiver"</span>)
                &amp;&amp; !finalString.contains(<span class="hljs-string">"HardwareRendererObserver"</span>)
            ) {
                Log.i(TAG, finalString)
            }
        } <span class="hljs-keyword">catch</span> (e: IllegalAccessException) {
            e.printStackTrace()
        }
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
        Choreographer.getInstance().postFrameCallback(<span class="hljs-keyword">this</span>)

        printMessages()
    }

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> TAG = <span class="hljs-string">"MessageHelper"</span>
    }
}
</code></pre>
<p>ä¸ºäº†ä¾¿äº logcat ä¸­è§‚å¯Ÿï¼Œè¿™é‡Œå°†æ—¥å¿—ä¸­åŒ…å« <code>FrameDisplayEventReceiver</code> å’Œ <code>HardwareRendererObserver</code> éƒ½å‰”é™¤äº†ã€‚</p>
<h4 data-id="heading-9">ä½¿ç”¨ç¤ºä¾‹</h4>
<p>è°ƒç”¨ä»¥ä¸‹ä»£ç å°†è¾“å‡ºæ¯ä¸€å¸§ MessageQueue ä¸­çš„æ¶ˆæ¯ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Choreographer.getInstance().postFrameCallback(MessageHelper())
</code></pre>
<h2 data-id="heading-10">4. æ€»ç»“</h2>
<ul>
<li>
<p>IdleHandler å¯ä»¥ç”¨æ¥å¤„ç†ä¸€äº›ä¸ç´§æ€¥çš„ä»»åŠ¡ï¼Œæ¯”å¦‚ ActivityThread ä½¿ç”¨å®ƒæ¥æ‰§è¡Œ gc ä»»åŠ¡</p>
</li>
<li>
<p><code>Looper.setMessageLogging()</code>æ–¹æ³•æ‰“å°æ¶ˆæ¯æ—¥å¿—ï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰å¼‚å¸¸æ¶ˆæ¯</p>
</li>
<li>
<p>ä½¿ç”¨ä¸Šè¿° MessageHelper ç±»æ‰“å°å½“å‰ MessageQueue ä¸­çš„æ‰€æœ‰ Messageï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰å¼‚å¸¸æ¶ˆæ¯</p>
</li>
</ul>
<h2 data-id="heading-11">5. å‚è€ƒ</h2>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.dreamtobe.cn%2F2016%2F03%2F11%2Fandroid_handler_looper%2F" target="_blank" title="https://blog.dreamtobe.cn/2016/03/11/android_handler_looper/" ref="nofollow noopener noreferrer">Android Handler Looperæœºåˆ¶ | Jacks Blog</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmy.oschina.net%2Fyouranhongcha%2Fblog%2F492591" target="_blank" title="https://my.oschina.net/youranhongcha/blog/492591" ref="nofollow noopener noreferrer">èŠä¸€èŠAndroidçš„æ¶ˆæ¯æœºåˆ¶ - æ‚ ç„¶çº¢èŒ¶çš„ä¸ªäººé¡µé¢ - å¼€æºä¸­å›½</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fcdecde111%2Farticle%2Fdetails%2F54670136" target="_blank" title="https://blog.csdn.net/cdecde111/article/details/54670136" ref="nofollow noopener noreferrer">android åˆ©ç”¨Handleræœºåˆ¶ä¸­SyncBarrierçš„ç‰¹æ€§å®ç°é¢„åŠ è½½ - CSDNåšå®¢</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.dreamtobe.cn%2F2016%2F03%2F11%2Fandroid_handler_looper%2F" target="_blank" title="https://blog.dreamtobe.cn/2016/03/11/android_handler_looper/" ref="nofollow noopener noreferrer">Android Handler Looperæœºåˆ¶ | Jacks Blog</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000002982318" target="_blank" title="https://segmentfault.com/a/1190000002982318" ref="nofollow noopener noreferrer">Androidåº”ç”¨ç¨‹åºæ¶ˆæ¯å¤„ç†æœºåˆ¶ - ç‚¹ç‚¹æ»´æ»´ - SegmentFault æ€å¦</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kancloud.cn%2Falex_wsc%2Fandroid-deep2%2F413394" target="_blank" title="https://www.kancloud.cn/alex_wsc/android-deep2/413394" ref="nofollow noopener noreferrer">2.3.3 nativePollOnceå‡½æ•°åˆ†æ Â· æ·±å…¥ç†è§£Androidï¼šå·2 Â· çœ‹äº‘</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2F9849026e7232" target="_blank" title="https://www.jianshu.com/p/9849026e7232" ref="nofollow noopener noreferrer">Androidæ¶ˆæ¯å¾ªç¯æœºåˆ¶ï¼ˆäºŒï¼‰Looperæ€§èƒ½æ£€æµ‹çš„ç¼ºé™· - ç®€ä¹¦</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fdegwei%2Farticle%2Fdetails%2F50602445" target="_blank" title="https://blog.csdn.net/degwei/article/details/50602445" ref="nofollow noopener noreferrer">Android Barrier - CSDNåšå®¢</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fdasusu%2Fp%2F8311324.html" target="_blank" title="https://www.cnblogs.com/dasusu/p/8311324.html" ref="nofollow noopener noreferrer">Android å±å¹•åˆ·æ–°æœºåˆ¶ - è¯·å«æˆ‘å¤§è‹ - åšå®¢å›­</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sunmoonblog.com%2F2018%2F07%2F26%2Fhandler-sync-barrier%2F" target="_blank" title="https://www.sunmoonblog.com/2018/07/26/handler-sync-barrier/" ref="nofollow noopener noreferrer">Handleré—®é¢˜è®°å½•</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨ React + React Router v7 SSR é¡¹ç›®é‡Œåšå¤šç«¯é€‚é…ï¼Œæˆ‘è¸©çš„ä¸¤ä¸ªå‘]]></title>    <link>https://juejin.cn/post/7577050643204374578</link>    <guid>https://juejin.cn/post/7577050643204374578</guid>    <pubDate>2025-11-27T15:27:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577050643204374578" data-draft-id="7577222731790696474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨ React + React Router v7 SSR é¡¹ç›®é‡Œåšå¤šç«¯é€‚é…ï¼Œæˆ‘è¸©çš„ä¸¤ä¸ªå‘"/> <meta itemprop="keywords" content="å‰ç«¯,React.js"/> <meta itemprop="datePublished" content="2025-11-27T15:27:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¦å¤§å‘½å¤§"/> <meta itemprop="url" content="https://juejin.cn/user/2154698523020205"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨ React + React Router v7 SSR é¡¹ç›®é‡Œåšå¤šç«¯é€‚é…ï¼Œæˆ‘è¸©çš„ä¸¤ä¸ªå‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2154698523020205/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¦å¤§å‘½å¤§
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T15:27:02.000Z" title="Thu Nov 27 2025 15:27:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ€è¿‘å¸®äººç»´æŠ¤ä¸€ä¸ª <code>SSR</code> çš„ <code>React</code> é¡¹ç›®ï¼Œéœ€è¦åœ¨åŒä¸€å¥—ä»£ç é‡Œé€‚é… <code>PC</code>ã€æ‰‹æœºå’Œå¹³æ¿ã€‚é¡µé¢é‡Œå¤§é‡é€»è¾‘æ˜¯åŸºäº <code>deviceType</code>ï¼ˆ<code>desktop | tablet | mobile</code>ï¼‰æ¥åšå¸ƒå±€å’Œäº¤äº’å·®å¼‚çš„ã€‚</p>
<p>åˆšå¼€å§‹çœ‹ä¸Šå»åªæ˜¯â€œåˆ¤æ–­ä¸€ä¸‹å®½åº¦ + å†™ç‚¹åª’ä½“æŸ¥è¯¢â€çš„å°éœ€æ±‚ï¼Œä½†åœ¨ <code>SSR + iOS</code> çœŸæœº è¿™ä¸¤ä¸ªç»´åº¦å åŠ ä¹‹åï¼Œè¸©äº†ä¸å°‘å…¼å®¹æ€§çš„å‘ï¼Œç‰¹åˆ«æ˜¯ï¼š</p>
<ol>
<li><code>SSR</code> ç¯å¢ƒä¸‹æ‹¿ä¸åˆ° <code>window</code>ï¼Œå¯¼è‡´é¡µé¢åœ¨å®¢æˆ·ç«¯é¦–æ¬¡æ¸²æŸ“æ—¶é—ªçƒï¼›</li>
<li><code>iOS</code> çœŸæœºä¸Š <code>window.innerWidth</code> è·å–å­˜åœ¨å»¶è¿Ÿï¼Œå¯¼è‡´å¶å‘æ€§è¯†åˆ«é”™è¯¯ã€‚</li>
</ol>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦è®°å½•ä¸€ä¸‹è¿™ä¸¤ä¸ªé—®é¢˜çš„å…·ä½“è¡¨ç°ã€è§£å†³æ€è·¯ï¼Œä»¥åŠæœ€ç»ˆæŠ½å‡ºæ¥çš„ä¸€ä¸ª <code>useDeviceType</code> <code>Hook</code>ã€‚</p>
<p>å¦‚æœæ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œ<strong>è®°å¾—ä¸€é”®ä¸‰è¿å“Ÿ</strong>ã€‚æœ‰é—®é¢˜å’Œç–‘æƒ‘çš„è¯ä¹Ÿå¯ä»¥åœ¨è¯„è®ºåŒºç•™è¨€ã€‚æˆ‘ä¼šç¬¬ä¸€æ—¶é—´å›å¤å¤§å®¶ï¼Œå¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å“ªé‡Œæœ‰çŸ¥è¯†ç‚¹é”™è¯¯çš„è¯ï¼Œä¹Ÿæ³è¯·èƒ½å¤Ÿå‘ŠçŸ¥ï¼ŒæŠŠé”™çš„ä¸œè¥¿ç†è§£æˆå¯¹çš„ï¼Œæ— è®ºåœ¨ä»€ä¹ˆè¡Œä¸šï¼Œéƒ½æ˜¯è‡´å‘½çš„ã€‚</p>
<h2 data-id="heading-1">é—®é¢˜èƒŒæ™¯</h2>
<p>å› ä¸ºæ˜¯ <code>SSR</code> é¡¹ç›®ï¼ŒæœåŠ¡ç«¯åˆå§‹ä¼šæŠŠé¡µé¢ <code>HTML</code> æ¸²æŸ“å‡ºæ¥ï¼Œå†ç”±å®¢æˆ·ç«¯è¿›è¡Œ <code>hydration</code>ã€‚<br/>
åŒæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åšåˆ°ï¼š</p>
<ul>
<li><code>PC</code> ç«¯ï¼šå±•ç¤ºå®Œæ•´å¸ƒå±€ï¼›</li>
<li>æ‰‹æœºç«¯ï¼šå±•ç¤ºç²¾ç®€å¸ƒå±€ï¼Œç»„ä»¶å±‚çº§ä¹Ÿæœ‰å·®å¼‚ï¼›</li>
<li>å¹³æ¿ç«¯ï¼šå¸ƒå±€/äº¤äº’ä»‹äºä¸¤è€…ä¹‹é—´ã€‚</li>
</ul>
<p>é¡¹ç›®é‡Œæœ‰å¤§é‡ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„é€»è¾‘ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> { deviceType } = <span class="hljs-title function_">useDeviceType</span>();

<span class="hljs-keyword">return</span> (
  <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
    {deviceType === "desktop" &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">DesktopLayout</span> /&gt;</span>}
    {deviceType === "tablet" &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">TabletLayout</span> /&gt;</span>}
    {deviceType === "mobile" &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">MobileLayout</span> /&gt;</span>}
  <span class="hljs-tag">&lt;/&gt;</span></span>
);
</code></pre>
<p>è¿™æ„å‘³ç€ <strong>åˆå§‹æ¸²æŸ“é˜¶æ®µçš„è®¾å¤‡ç±»å‹åˆ¤æ–­éå¸¸å…³é”®</strong>ï¼Œä¸€æ—¦å‰åä¸ä¸€è‡´ï¼Œå°±ä¼šå¯¼è‡´é—ªçƒã€<code>Hydration Mismatch</code> ç­‰é—®é¢˜ã€‚</p>
<h2 data-id="heading-2">SSR ç¯å¢ƒä¸­æ‹¿ä¸åˆ° window å¯¼è‡´é¡µé¢é—ªçƒ</h2>
<h3 data-id="heading-3">é—®é¢˜è¡¨ç°</h3>
<ul>
<li><code>deviceType</code> é»˜è®¤å‡å®šä¸º <code>"desktop"</code>ï¼›</li>
<li>ç”¨æˆ·åœ¨ <strong>æ‰‹æœº</strong> ä¸Šæ‰“å¼€é¡µé¢æ—¶ï¼š
<ul>
<li><code>SSR</code> é˜¶æ®µï¼šæœåŠ¡ç«¯æ ¹æ®é»˜è®¤å€¼ <code>"desktop"</code> æ¸²æŸ“ï¼›</li>
<li>å®¢æˆ·ç«¯ <code>hydration</code> åï¼š<code>useEffect</code> / <code>useLayoutEffect</code> ä¸­æ ¹æ® <code>window.innerWidth</code> åˆ¤æ–­å‡ºå…¶å®æ˜¯ <code>"mobile"</code>ï¼Œç„¶åçŠ¶æ€æ›´æ–°ï¼›</li>
</ul>
</li>
<li>åœ¨è¿™ä¸ªåˆ‡æ¢çš„ç¬é—´ï¼Œå¸ƒå±€ä¼šä» <code>desktop</code> ç‰ˆâ€œç¬é—´â€è·³ä¸º <code>mobile</code> ç‰ˆï¼Œéå¸¸æ˜æ˜¾çš„é—ªçƒã€‚</li>
</ul>
<p>å¦‚æœä½ ç”¨çš„æ˜¯ <code>useLayoutEffect</code>ï¼Œåœ¨ SSR ç¯å¢ƒä¸‹è¿˜ä¼šçœ‹åˆ°ï¼š</p>
<blockquote>
<p>Warning: useLayoutEffect does nothing on the server, because its effect cannot be encoded into the server renderer's output...</p>
</blockquote>
<h3 data-id="heading-4">é—®é¢˜æ ¹æº</h3>
<ul>
<li><code>SSR</code> ç¯å¢ƒæ²¡æœ‰ <code>window</code>ï¼Œæ— æ³•ç”¨å®½åº¦åˆ¤æ–­è®¾å¤‡ï¼›</li>
<li>åˆå§‹æ¸²æŸ“çš„ <code>HTML</code> æ˜¯ <code>desktop</code> ç‰ˆï¼Œå®¢æˆ·ç«¯ <code>hydration</code> æ—¶æ‰â€œæ„è¯†åˆ°â€è¿™æ˜¯æ‰‹æœºï¼›</li>
<li>ç”±äºåˆå§‹ <code>state</code> å’Œå®é™…è®¾å¤‡ä¸åŒ¹é…ï¼Œå¯¼è‡´ï¼š
<ul>
<li><code>UI</code> é—ªçƒï¼›</li>
<li>ä»¥åŠ <code>hydration mismatch</code> è­¦å‘Šã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">è§£å†³æ€è·¯ï¼šåŒæ„ç‰ˆçš„ useLayoutEffect</h3>
<ul>
<li><strong>åœ¨æµè§ˆå™¨ç«¯</strong>ï¼šä½¿ç”¨ <code>useLayoutEffect</code>ï¼Œåœ¨æµè§ˆå™¨ç»˜åˆ¶å‰å®Œæˆ DOM è°ƒæ•´ï¼Œå°½é‡å‡å°‘é—ªçƒï¼›</li>
<li>**åœ¨ <strong><code>SSR</code></strong> ç«¯ï¼šä¸è¦ä½¿ç”¨ <code>useLayoutEffect</code>ï¼Œé¿å…è­¦å‘Šï¼Œé€€åŒ–ä¸ºæ™®é€šçš„ <code>useEffect</code>ã€‚</li>
</ul>
<p>å®ç°æ–¹å¼å¾ˆç®€å•ï¼Œå°è£…ä¸€ä¸ª<code>Hook</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { useEffect, useLayoutEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">const</span> useIsomorphicLayoutEffect =
  <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">"undefined"</span> ? useLayoutEffect : useEffect;
</code></pre>
<p>ç„¶ååœ¨éœ€è¦åšé¦–å±å¸ƒå±€è°ƒæ•´çš„åœ°æ–¹ï¼Œç»Ÿä¸€ç”¨ <code>useIsomorphicLayoutEffect</code> æ›¿æ¢ <code>useLayoutEffect</code>ã€‚</p>
<h3 data-id="heading-6">å†é…åˆä¸€ä¸ªå…³é”®ç‚¹ï¼šåˆå§‹å€¼ä¿æŒä¸€è‡´</h3>
<p>ä¸ºäº†é¿å…<code> hydration mismatch</code>ï¼Œåˆå§‹ <code>state</code> å¿…é¡»åœ¨ <code>SSR</code> å’Œå®¢æˆ·ç«¯é¦–æ¬¡æ¸²æŸ“æ—¶ä¿æŒä¸€è‡´ï¼Œæ‰€ä»¥å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> [deviceInfo, setDeviceInfo] = useState&lt;<span class="hljs-title class_">DeviceInfo</span>&gt;({
  <span class="hljs-attr">deviceType</span>: <span class="hljs-string">"desktop"</span>,  <span class="hljs-comment">// æœåŠ¡ç«¯ &amp; å®¢æˆ·ç«¯åˆå§‹éƒ½è®¤ä¸ºæ˜¯ desktop</span>
  <span class="hljs-attr">isMinWidth</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">currentWidth</span>: <span class="hljs-number">1024</span>,
});
</code></pre>
<p>æŒ‚è½½åï¼Œå†é€šè¿‡ <code>window.innerWidth + UA</code> å»çº æ­£è¿™ä¸ªé»˜è®¤å€¼ã€‚</p>
<h2 data-id="heading-7">iOS çœŸæœºä¸Š innerWidth å»¶è¿Ÿå¯¼è‡´è®¾å¤‡è¯¯åˆ¤</h2>
<p>è¿™ä¸ªå‘æ¯”ç¬¬ä¸€ä¸ªæ›´éšè”½ä¸€äº›ã€‚</p>
<h3 data-id="heading-8">é—®é¢˜è¡¨ç°</h3>
<p>åœ¨æŸäº› <code>iOS</code> ç‰ˆæœ¬çš„ <code>Safari / PWA </code>ä¸­ï¼Œå‡ºç°äº†è¿™æ ·çš„æƒ…å†µ(æˆ‘çš„æ˜¯ <code>iOS26</code>)ï¼š</p>
<ol>
<li>é¡µé¢åˆšåŠ è½½æ—¶ï¼Œ<code>window.innerWidth</code> è¿”å›çš„å€¼åå¤§ï¼ˆç±»ä¼¼å¹³æ¿æˆ–æ¡Œé¢å®½åº¦ï¼‰ï¼›</li>
<li>åœ¨åˆæ¬¡è¯†åˆ« <code>deviceType</code> æ—¶ï¼Œé€»è¾‘ä¼šè®¤ä¸ºæ˜¯ <code>"tablet"</code> æˆ– <code>"desktop"</code>ï¼›</li>
<li>ç”¨æˆ·ä¸€æ»šåŠ¨/ç‚¹å‡»ï¼Œè§¦å‘é‡æ’ï¼ˆ<code>reflow</code>ï¼‰åï¼Œ<code>innerWidth</code> æ‰å˜æˆå®é™…çš„æ‰‹æœºå®½åº¦ï¼›</li>
<li>äºæ˜¯ <code>resize</code> äº‹ä»¶è§¦å‘ï¼Œåˆé‡æ–°åˆ¤äº†ä¸€æ¬¡è®¾å¤‡ç±»å‹ï¼Œè¿™æ¬¡æ‰å˜æˆ <code>"mobile"</code>ï¼›</li>
<li>æœ€ç»ˆç»“æœï¼šé¡µé¢å¶å‘æ€§åœ°å…ˆæ¸²æŸ“æˆå¹³æ¿å¸ƒå±€ï¼Œä½“éªŒéå¸¸å·®ã€‚</li>
</ol>
<h3 data-id="heading-9">è§£å†³æ€è·¯ï¼šUA ä¸ºä¸»ï¼Œå®½åº¦ä¸ºè¾…</h3>
<p>å•çº¯ä¾èµ– <code>window.innerWidth</code> åœ¨ <code>iOS</code> ä¸Šä¸å¤Ÿç¨³ã€‚<br/>
æ›´ç¨³å¦¥çš„æ–¹å¼æ˜¯ï¼š</p>
<ol>
<li><strong>ä½¿ç”¨ UA ä½œä¸ºç¬¬ä¸€åˆ¤æ–­ä¾æ®</strong><br/>
åˆ©ç”¨ <code>ua-parser-js</code> è·å–è®¾å¤‡ç±»å‹ï¼Œå¦‚æœ <code>UA</code> æ˜ç¡®å‘Šè¯‰ä½ æ˜¯ <code>mobile</code>ï¼Œé‚£å°±ç›´æ¥æŒ‰ <code>mobile</code> å¤„ç†ï¼Œæ˜ç¡®æ˜¯ <code>tablet</code>ï¼Œå°±ç›´æ¥å½“å¹³æ¿ã€‚</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UAParser</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"ua-parser-js"</span>;

<span class="hljs-keyword">const</span> parser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UAParser</span>(navigator.<span class="hljs-property">userAgent</span>);
<span class="hljs-keyword">const</span> result = parser.<span class="hljs-title function_">getResult</span>();
<span class="hljs-keyword">const</span> uaDeviceType = result.<span class="hljs-property">device</span>.<span class="hljs-property">type</span>; <span class="hljs-comment">// 'mobile' | 'tablet' | 'console' | 'smarttv' | 'wearable' | undefined</span>
</code></pre>
<ol start="2">
<li><strong>é’ˆå¯¹ <code>iPad Pro</code> ç­‰ <code>pad</code> è®¾å¤‡åšç‰¹æ®Šè¯†åˆ«</strong><br/>
<code>iPad Pro+Air</code>  <code>UA</code> ä¼šä¼ªè£…æˆ <code>Mac</code>ï¼Œå› æ­¤éœ€è¦ç»“åˆ <code>OS</code> + èƒ½å¦è§¦æ‘¸åˆ¤æ–­ï¼š</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> isIPadPro = result.<span class="hljs-property">os</span>.<span class="hljs-property">name</span> === <span class="hljs-string">"Mac OS"</span> &amp;&amp; navigator.<span class="hljs-property">maxTouchPoints</span> &gt; <span class="hljs-number">1</span>;
</code></pre>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿ <code>UA</code> çœ‹èµ·æ¥åƒ <code>Mac</code> ç”µè„‘ï¼Œä¹Ÿè¦å½“å¹³æ¿å¤„ç†ã€‚</p>
<ol start="3">
<li><strong>UA ä¸æ˜ç¡®æ—¶ï¼Œå†ç”¨å®½åº¦å…œåº•</strong><br/>
æ¯”å¦‚ <code>UA</code> æ˜¾ç¤ºä¸ºæ¡Œé¢ï¼Œæˆ–è€… <code>UA</code> ä¸å¯é æ—¶ï¼Œå¯ä»¥é€€å›åˆ°å®½åº¦åˆ¤æ–­ï¼š</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (width &lt; <span class="hljs-number">768</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">"mobile"</span>;
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (width &gt;= <span class="hljs-number">768</span> &amp;&amp; width &lt; <span class="hljs-number">1280</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">"tablet"</span>;
}
<span class="hljs-keyword">return</span> <span class="hljs-string">"desktop"</span>;
</code></pre>
<ol start="4">
<li><strong>ç›‘å¬ resize åšçŸ«æ­£</strong><br/>
å³ä½¿åˆæ¬¡åˆ¤æ–­ä¸å®Œç¾ï¼Œä¹Ÿå¯ä»¥åœ¨åç»­ <code>resize</code>ï¼ˆåŒ…æ‹¬æ¨ªç«–å±åˆ‡æ¢ã€çª—å£å˜åŒ–ç­‰ï¼‰æ—¶é‡æ–°è®¡ç®—è®¾å¤‡ç±»å‹è¿›è¡Œçº æ­£ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-10">æœ€ç»ˆå®ç°ï¼šuseDeviceType Hook</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæœ€ç»ˆæ•´åˆåçš„ <code>Hook</code>ï¼Œå®ç°äº†ï¼š</p>
<ul>
<li>SSR ç¯å¢ƒå…¼å®¹ï¼ˆ<code>useIsomorphicLayoutEffect</code>ï¼‰ï¼›</li>
<li><code>UA</code> + å®½åº¦ç»„åˆåˆ¤æ–­è®¾å¤‡ç±»å‹ï¼›</li>
<li>åŠ¨æ€è®¾ç½® <code>viewport</code> / <code>minWidth</code> / å®‰å…¨åŒºåŸŸæ ·å¼ï¼›</li>
<li>ç›‘å¬ <code>resize</code> è‡ªåŠ¨æ›´æ–°ã€‚</li>
</ul>
<h3 data-id="heading-11">è®¾å¤‡ç±»å‹åˆ¤æ–­é€»è¾‘</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// hooks/useDeviceType.ts</span>
<span class="hljs-keyword">import</span> { useState, useEffect, useLayoutEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UAParser</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"ua-parser-js"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> {
  <span class="hljs-title class_">DeviceInfo</span>,
  <span class="hljs-title class_">DeviceType</span>,
  <span class="hljs-title class_">UseDeviceTypeOptions</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"~/types/GameDataType"</span>;

<span class="hljs-comment">// SSR ä¸‹é¿å… useLayoutEffect è­¦å‘Š</span>
<span class="hljs-keyword">const</span> useIsomorphicLayoutEffect =
  <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">"undefined"</span> ? useLayoutEffect : useEffect;

<span class="hljs-comment">// UA + å®½åº¦ç»¼åˆåˆ¤æ–­è®¾å¤‡ç±»å‹</span>
<span class="hljs-keyword">const</span> getDeviceType = (<span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">DeviceType</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> parser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UAParser</span>(navigator.<span class="hljs-property">userAgent</span>);
  <span class="hljs-keyword">const</span> result = parser.<span class="hljs-title function_">getResult</span>();
  <span class="hljs-keyword">const</span> uaDeviceType = result.<span class="hljs-property">device</span>.<span class="hljs-property">type</span>;

  <span class="hljs-comment">// iPad Pro æ¡Œé¢æ¨¡å¼çš„ç‰¹æ®Šå¤„ç†ï¼šMac OS + æ”¯æŒè§¦æ‘¸</span>
  <span class="hljs-keyword">const</span> isIPadPro = result.<span class="hljs-property">os</span>.<span class="hljs-property">name</span> === <span class="hljs-string">"Mac OS"</span> &amp;&amp; navigator.<span class="hljs-property">maxTouchPoints</span> &gt; <span class="hljs-number">1</span>;

  <span class="hljs-comment">// 1. UA æ˜ç¡®è¯†åˆ«ä¸º mobile</span>
  <span class="hljs-keyword">if</span> (uaDeviceType === <span class="hljs-string">"mobile"</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"mobile"</span>;
  }

  <span class="hljs-comment">// 2. UA æ˜ç¡®è¯†åˆ«ä¸º tabletï¼ˆåŒ…æ‹¬ iPad Proï¼‰</span>
  <span class="hljs-keyword">if</span> (uaDeviceType === <span class="hljs-string">"tablet"</span> || isIPadPro) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"tablet"</span>;
  }

  <span class="hljs-comment">// 3. å…¶å®ƒæƒ…å†µç”¨å®½åº¦å…œåº•</span>
  <span class="hljs-keyword">if</span> (width &lt; <span class="hljs-number">768</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"mobile"</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (width &gt;= <span class="hljs-number">768</span> &amp;&amp; width &lt; <span class="hljs-number">1280</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"tablet"</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-string">"desktop"</span>;
};
</code></pre>
<h3 data-id="heading-12">Hook ä¸»ä½“</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useDeviceType = (
  <span class="hljs-attr">options</span>: <span class="hljs-title class_">UseDeviceTypeOptions</span> = {}
): <span class="hljs-function"><span class="hljs-params">DeviceInfo</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> {
    minWidth = <span class="hljs-number">240</span>,
    preventZoom = <span class="hljs-literal">true</span>,
    enableSafeAreas = <span class="hljs-literal">true</span>,
  } = options;

  <span class="hljs-comment">// SSR &amp; å®¢æˆ·ç«¯åˆå§‹ä¿æŒä¸€è‡´ï¼Œé¿å… Hydration Mismatch</span>
  <span class="hljs-keyword">const</span> [deviceInfo, setDeviceInfo] = useState&lt;<span class="hljs-title class_">DeviceInfo</span>&gt;({
    <span class="hljs-attr">deviceType</span>: <span class="hljs-string">"desktop"</span>,
    <span class="hljs-attr">isMinWidth</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">currentWidth</span>: <span class="hljs-number">1024</span>,
  });

  <span class="hljs-title function_">useIsomorphicLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkDevice</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">const</span> width = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>;
      <span class="hljs-keyword">const</span> isAtMinWidth = width &lt;= minWidth;

      <span class="hljs-keyword">const</span> deviceType = <span class="hljs-title function_">getDeviceType</span>(width);

      <span class="hljs-title function_">setDeviceInfo</span>({
        deviceType,
        <span class="hljs-attr">isMinWidth</span>: isAtMinWidth,
        <span class="hljs-attr">currentWidth</span>: width,
      });

      <span class="hljs-comment">// å¦‚æœæœ‰éœ€è¦ï¼Œå¯ä»¥æŒä¹…åŒ–</span>
      <span class="hljs-comment">// localStorage.setItem("deviceType", deviceType);</span>
    };

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">setViewport</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">let</span> viewport = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'meta[name="viewport"]'</span>);

      <span class="hljs-keyword">if</span> (!viewport) {
        viewport = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"meta"</span>);
        viewport.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">"name"</span>, <span class="hljs-string">"viewport"</span>);
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(viewport);
      }

      <span class="hljs-keyword">if</span> (preventZoom) {
        viewport.<span class="hljs-title function_">setAttribute</span>(
          <span class="hljs-string">"content"</span>,
          <span class="hljs-string">"width=device-width, initial-scale=1.0, "</span> +
            <span class="hljs-string">"minimum-scale=1.0, maximum-scale=1.0, "</span> +
            <span class="hljs-string">"user-scalable=no, viewport-fit=cover"</span>
        );
      } <span class="hljs-keyword">else</span> {
        viewport.<span class="hljs-title function_">setAttribute</span>(
          <span class="hljs-string">"content"</span>,
          <span class="hljs-string">"width=device-width, initial-scale=1.0"</span>
        );
      }
    };

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">setMinWidthStyle</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">const</span> styleId = <span class="hljs-string">"min-width-style"</span>;
      <span class="hljs-keyword">let</span> styleElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(styleId) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLStyleElement</span>;

      <span class="hljs-keyword">if</span> (!styleElement) {
        styleElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"style"</span>);
        styleElement.<span class="hljs-property">id</span> = styleId;
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(styleElement);
      }

      styleElement.<span class="hljs-property">textContent</span> = <span class="hljs-string">`
        body {
          min-width: <span class="hljs-subst">${minWidth}</span>px;
          overflow-x: auto;
        }
        .container-limit {
          min-width: <span class="hljs-subst">${minWidth}</span>px;
        }
        <span class="hljs-subst">${
          enableSafeAreas
            ? <span class="hljs-string">`
        .safe-area-bottom {
          padding-bottom: env(safe-area-inset-bottom);
        }
        .safe-area-left {
          padding-left: env(safe-area-inset-left);
        }
        .safe-area-right {
          padding-right: env(safe-area-inset-right);
        }
        `</span>
            : <span class="hljs-string">""</span>
        }</span>
      `</span>;
    };

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResize</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-title function_">checkDevice</span>();
      <span class="hljs-title function_">setViewport</span>();
      <span class="hljs-title function_">setMinWidthStyle</span>();
    };

    <span class="hljs-comment">// æŒ‚è½½åç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œå°½é‡åœ¨é¦–å±ç»˜åˆ¶å‰å®Œæˆ</span>
    <span class="hljs-title function_">handleResize</span>();

    <span class="hljs-comment">// ç›‘å¬ resize åšåç»­çŸ«æ­£ï¼Œå¯ä»¥åŠ é˜²æŠ–èŠ‚æµ</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"resize"</span>, handleResize);

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">"resize"</span>, handleResize);
    };
  }, [minWidth, preventZoom, enableSafeAreas]);

  <span class="hljs-keyword">return</span> deviceInfo;
};
</code></pre>
<p>ä½¿ç”¨æ—¶éå¸¸ç®€å•ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> { deviceType, currentWidth, isMinWidth } = <span class="hljs-title function_">useDeviceType</span>();

<span class="hljs-keyword">if</span> (deviceType === <span class="hljs-string">"desktop"</span>) {
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-13">ä¸€äº›å…¼å®¹æ€§å’Œæ¶æ„å±‚é¢çš„æ€è€ƒ</h2>
<p>å³ä¾¿ä¸Šé¢è¿™ä¸€å¥— <code>UA</code> + å®½åº¦ + <code>resize</code> çš„æ–¹æ¡ˆåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹èƒ½è·‘å¾—æ¯”è¾ƒç¨³ï¼Œä½†ä»æœ‰ä¸€äº›æ½œåœ¨é—®é¢˜ï¼š</p>
<ul>
<li><code>UA</code> æœ¬èº«ä¸å¯é ï¼šè¢«ä¼ªè£…ã€è¢«æµè§ˆå™¨ä¿®æ”¹ï¼›</li>
<li>æ–°è®¾å¤‡ / æ–°ç³»ç»Ÿç‰ˆæœ¬å‡ºç°æ–°çš„ UA ç»„åˆï¼Œéœ€è¦ä¸æ–­ç»´æŠ¤è§„åˆ™ï¼›</li>
<li>æŸäº›åµŒå…¥å¼ <code>WebView</code> æˆ–ç‰¹æ®Šæµè§ˆå™¨çš„è¡Œä¸ºä¸ç¡®å®šã€‚</li>
</ul>
<p>ä»é•¿æœŸç»´æŠ¤æˆæœ¬å’Œå¤æ‚åº¦æ¥çœ‹ï¼Œå¦‚æœä¸šåŠ¡å…è®¸ï¼Œæˆ‘æ›´æ¨èä¸‹é¢è¿™ç§æ–¹å¼ï¼š</p>
<ul>
<li><code>PC</code> ä¸ <code>Mobile</code>/<code>Pad</code> åˆ†ä¸¤å¥—ä»£ç </li>
<li><code>Mobile</code> å†…éƒ¨ç”¨åª’ä½“æŸ¥è¯¢åŒºåˆ† <code>Phone</code> / <code>Tablet</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kubernetes Deployment é…ç½®ç®€åŒ–å®æˆ˜ï¼šä»å¤æ‚åˆ°é«˜æ•ˆ]]></title>    <link>https://juejin.cn/post/7577228831138168875</link>    <guid>https://juejin.cn/post/7577228831138168875</guid>    <pubDate>2025-11-27T13:22:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577228831138168875" data-draft-id="7577198193216045099" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kubernetes Deployment é…ç½®ç®€åŒ–å®æˆ˜ï¼šä»å¤æ‚åˆ°é«˜æ•ˆ"/> <meta itemprop="keywords" content="Kubernetes"/> <meta itemprop="datePublished" content="2025-11-27T13:22:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kubernetes Deployment é…ç½®ç®€åŒ–å®æˆ˜ï¼šä»å¤æ‚åˆ°é«˜æ•ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T13:22:13.000Z" title="Thu Nov 27 2025 13:22:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€ï¼šDeployment é…ç½®çš„å¤æ‚æ€§æŒ‘æˆ˜</h2>
<p>åœ¨ Kubernetes ä¸­ï¼ŒDeployment æ˜¯ç®¡ç†æ— çŠ¶æ€åº”ç”¨çš„æ ¸å¿ƒèµ„æºå¯¹è±¡ï¼Œå®ƒé€šè¿‡å£°æ˜å¼é…ç½®ä¸ºæˆ‘ä»¬æä¾›äº†å‰¯æœ¬ç®¡ç†ã€æ»šåŠ¨æ›´æ–°ã€ç‰ˆæœ¬å›æ»šç­‰å¼ºå¤§åŠŸèƒ½ã€‚ç„¶è€Œï¼Œéšç€åº”ç”¨å¤æ‚åº¦çš„å¢åŠ ï¼ŒDeployment é…ç½®æ–‡ä»¶ä¹Ÿå˜å¾—æ„ˆå‘å†—é•¿å’Œå¤æ‚ï¼Œä¸€ä¸ªç”Ÿäº§ç¯å¢ƒçš„ YAML æ–‡ä»¶å¯èƒ½åŒ…å«æ•°åä¸ªå‚æ•°ï¼Œè¿™ç»™ç»´æŠ¤å’Œæ­£ç¡®æ€§å¸¦æ¥äº†ä¸¥å³»æŒ‘æˆ˜ã€‚</p>
<p>æœ¬æ–‡å°†ç³»ç»Ÿæ€§åœ°ä»‹ç»å¤šç§ç®€åŒ– Kubernetes Deployment é…ç½®çš„ç­–ç•¥å’Œå·¥å…·ï¼Œå¸®åŠ©æ‚¨åœ¨ä¿æŒåŠŸèƒ½å®Œæ•´æ€§çš„åŒæ—¶ï¼Œæ˜¾è‘—é™ä½é…ç½®å¤æ‚åº¦å’Œå‡ºé”™æ¦‚ç‡ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€é—®é¢˜æ ¹æºï¼šä¸ºä»€ä¹ˆ Deployment é…ç½®å¦‚æ­¤å¤æ‚ï¼Ÿ</h2>
<p>åœ¨æ¢è®¨è§£å†³æ–¹æ¡ˆå‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç†è§£ Deployment é…ç½®å¤æ‚æ€§çš„æ ¹æºã€‚ä¸€ä¸ªå…¸å‹çš„ç”Ÿäº§çº§ Deployment é…ç½®å¯èƒ½åŒ…å«ä»¥ä¸‹å¤šä¸ªç»´åº¦çš„å‚æ•°ï¼š</p>
<ul>
<li><strong>åŸºç¡€é…ç½®</strong>ï¼šå‰¯æœ¬æ•°é‡ã€é•œåƒæ ‡ç­¾ã€å®¹å™¨ç«¯å£</li>
<li><strong>èµ„æºç®¡ç†</strong>ï¼šCPU/å†…å­˜è¯·æ±‚å’Œé™åˆ¶</li>
<li><strong>å¥åº·æ£€æŸ¥</strong>ï¼šå°±ç»ªæ¢é’ˆã€å­˜æ´»æ¢é’ˆã€å¯åŠ¨æ¢é’ˆ</li>
<li><strong>æ›´æ–°ç­–ç•¥</strong>ï¼šæ»šåŠ¨æ›´æ–°å‚æ•°ã€æœ€å¤§ä¸å¯ç”¨æ¯”ä¾‹</li>
<li><strong>å®‰å…¨ä¸Šä¸‹æ–‡</strong>ï¼šç”¨æˆ·æƒé™ã€å®‰å…¨ç­–ç•¥</li>
<li><strong>ç¯å¢ƒé…ç½®</strong>ï¼šç¯å¢ƒå˜é‡ã€é…ç½®æ˜ å°„ã€å¯†é’¥</li>
</ul>
<p>è¿™ç§å¤æ‚æ€§æºäºç”Ÿäº§ç¯å¢ƒå¯¹<strong>åº”ç”¨é«˜å¯ç”¨æ€§</strong>ã€<strong>å¯æ‰©å±•æ€§</strong>å’Œ<strong>å¯è§‚æµ‹æ€§</strong>çš„ä¸¥æ ¼è¦æ±‚ã€‚ç›´æ¥ä¿®æ”¹è¿™äº›å†—é•¿çš„ YAML æ–‡ä»¶ä¸ä»…å®¹æ˜“å‡ºé”™ï¼Œè€Œä¸”åœ¨å¤šç¯å¢ƒéƒ¨ç½²æ—¶éš¾ä»¥ä¿æŒä¸€è‡´æ€§ã€‚</p>
<h2 data-id="heading-2">äºŒã€è§£å†³æ–¹æ¡ˆä¸€ï¼šæ¨¡æ¿åŒ–ä¸æŠ½è±¡åŒ–</h2>
<h3 data-id="heading-3">2.1 ä½¿ç”¨ Helm è¿›è¡Œåº”ç”¨æ‰“åŒ…</h3>
<p>Helm ä½œä¸º Kubernetes çš„åŒ…ç®¡ç†å™¨ï¼Œé€šè¿‡æ¨¡æ¿åŒ–å’Œå€¼åˆ†ç¦»ï¼Œæå¤§åœ°ç®€åŒ–äº†å¤šç¯å¢ƒéƒ¨ç½²çš„å¤æ‚åº¦ã€‚</p>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>æ¨¡æ¿å¼•æ“ï¼šä½¿ç”¨ Go æ¨¡æ¿è¯­è¨€ï¼Œæ”¯æŒæ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯</li>
<li>å€¼è¦†ç›–ï¼šé€šè¿‡ç‹¬ç«‹çš„ values.yaml æ–‡ä»¶ç®¡ç†ç¯å¢ƒå·®å¼‚åŒ–é…ç½®</li>
<li>ä¾èµ–ç®¡ç†ï¼šæ”¯æŒå­å›¾è¡¨å’Œä¾èµ–å…³ç³»è§£æ</li>
</ul>
<p><strong>å®æˆ˜ç¤ºä¾‹</strong>ï¼š</p>
<p>åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ Helm å›¾è¡¨ç»“æ„ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">my-app-chart/
â”œâ”€â”€ Chart.yaml
â”œâ”€â”€ values.yaml
â””â”€â”€ templates/
<span class="hljs-code">    â”œâ”€â”€ deployment.yaml
    â”œâ”€â”€ service.yaml
    â””â”€â”€ configmap.yaml
</span></code></pre>
<p>åœ¨ <code>templates/deployment.yaml</code>ä¸­ä½¿ç”¨æ¨¡æ¿å˜é‡ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> {{ <span class="hljs-string">.Release.Name</span> }}<span class="hljs-string">-deployment</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> {{ <span class="hljs-string">.Values.replicaCount</span> }}
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> {{ <span class="hljs-string">.Chart.Name</span> }}
        <span class="hljs-attr">image:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ .Values.image.repository }}</span>:<span class="hljs-template-variable">{{ .Values.image.tag }}</span>"</span>
        <span class="hljs-attr">ports:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> {{ <span class="hljs-string">.Values.service.port</span> }}
</code></pre>
<p>å¯¹åº”çš„ <code>values.yaml</code>æä¾›é»˜è®¤å€¼ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">replicaCount:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">image:</span>
  <span class="hljs-attr">repository:</span> <span class="hljs-string">nginx</span>
  <span class="hljs-attr">tag:</span> <span class="hljs-string">stable</span>
<span class="hljs-attr">service:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
</code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰åˆ›å»ºä¸åŒçš„ values æ–‡ä»¶ï¼Œè€Œä¿æŒæ¨¡æ¿ä¸å˜ã€‚</p>
<h3 data-id="heading-4">2.2 ä½¿ç”¨ Kustomize è¿›è¡Œé…ç½®è¦†ç›–</h3>
<p>Kustomize é‡‡ç”¨"åŸºç¡€+è¦†ç›–"çš„æ¨¡å‹ï¼Œä¸éœ€è¦å­¦ä¹ æ¨¡æ¿è¯­æ³•å³å¯å®ç°é…ç½®å·®å¼‚åŒ–ã€‚</p>
<p><strong>é¡¹ç›®ç»“æ„ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">my-app/
â”œâ”€â”€ <span class="hljs-keyword">base</span>/
â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â””â”€â”€ service.yaml
â””â”€â”€ overlays/
    â”œâ”€â”€ development/
    â”‚   â”œâ”€â”€ kustomization.yaml
    â”‚   â””â”€â”€ replica-patch.yaml
    â””â”€â”€ production/
        â”œâ”€â”€ kustomization.yaml
        â”œâ”€â”€ replica-patch.yaml
        â””â”€â”€ hpa.yaml
</code></pre>
<p><strong>å¼€å‘ç¯å¢ƒè¦†ç›–é…ç½®</strong>ï¼ˆoverlays/development/kustomization.yamlï¼‰ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">apiVersion: kustomize.config.k8s.io/v1beta1</span>
<span class="hljs-section">kind: Kustomization</span>

<span class="hljs-section">resources:</span>
- ../../base

<span class="hljs-section">patchesStrategicMerge:</span>
- replica-patch.yaml

<span class="hljs-section">namePrefix: dev-</span>
</code></pre>
<p>è¿™ç§æ–¹æ³•é¿å…äº†æ¨¡æ¿è¯­æ³•å¤æ‚åº¦ï¼Œç›´æ¥ä½¿ç”¨åŸç”Ÿ YAML è¿›è¡Œé…ç½®è¡¥ä¸ã€‚</p>
<h2 data-id="heading-5">ä¸‰ã€è§£å†³æ–¹æ¡ˆäºŒï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹</h2>
<h3 data-id="heading-6">3.1 ä½¿ç”¨ Skaffold å®ç°æŒç»­å¼€å‘</h3>
<p>Skaffold æ˜¯è°·æ­Œå¼€å‘çš„ Kubernetes å¼€å‘å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–æ„å»ºã€æ¨é€å’Œéƒ¨ç½²æµç¨‹ã€‚</p>
<p><strong>Skaffold æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨æ£€æµ‹ä»£ç å˜æ›´å¹¶è§¦å‘é‡æ–°éƒ¨ç½²</li>
<li>æ”¯æŒå¤šç§éƒ¨ç½²å·¥å…·ï¼ˆkubectlã€Helmã€Kustomizeï¼‰</li>
<li>æä¾›ç«¯åˆ°ç«¯çš„å¼€å‘å·¥ä½œæµ</li>
</ul>
<p><strong>åŸºç¡€é…ç½®ç¤ºä¾‹</strong>ï¼ˆskaffold.yamlï¼‰ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">skaffold/v4beta13</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Config</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">my-app</span>
<span class="hljs-attr">build:</span>
  <span class="hljs-attr">artifacts:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">my-app</span>
    <span class="hljs-attr">context:</span> <span class="hljs-string">src</span>
    <span class="hljs-attr">docker:</span>
      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span>
<span class="hljs-attr">deploy:</span>
  <span class="hljs-attr">kubectl:</span>
    <span class="hljs-attr">manifests:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">k8s/*.yaml</span>
<span class="hljs-attr">profiles:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">dev</span>
  <span class="hljs-attr">deploy:</span>
    <span class="hljs-attr">kustomize:</span>
      <span class="hljs-attr">paths:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">overlays/dev</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">prod</span>
  <span class="hljs-attr">deploy:</span>
    <span class="hljs-attr">helm:</span>
      <span class="hljs-attr">releases:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">my-app</span>
        <span class="hljs-attr">chartPath:</span> <span class="hljs-string">charts/my-app</span>
</code></pre>
<p>é€šè¿‡ Skaffoldï¼Œå¼€å‘è€…åªéœ€è¿è¡Œ <code>skaffold dev</code>å³å¯è¿›å…¥è‡ªåŠ¨åŒ–å¼€å‘å¾ªç¯ï¼Œå¤§å¹…ç®€åŒ–æœ¬åœ°å¼€å‘å’Œè°ƒè¯•æµç¨‹ã€‚</p>
<h3 data-id="heading-7">3.2 GitOps å·¥ä½œæµ</h3>
<p>ç»“åˆ ArgoCD æˆ– Flux å®ç° GitOpsï¼Œå°†é…ç½®å­˜å‚¨åœ¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå†…ï¼Œå®ç°å£°æ˜å¼çš„åŸºç¡€è®¾æ–½ç®¡ç†ã€‚</p>
<p><strong>GitOps æ ¸å¿ƒåŸåˆ™</strong>ï¼š</p>
<ul>
<li>å£°æ˜å¼ï¼šç³»ç»ŸçŠ¶æ€é€šè¿‡å£°æ˜æ€§æè¿°å®šä¹‰</li>
<li>ç‰ˆæœ¬æ§åˆ¶ï¼šæ‰€æœ‰é…ç½®å˜æ›´ç‰ˆæœ¬åŒ–ã€å¯å®¡è®¡</li>
<li>è‡ªåŠ¨åŒæ­¥ï¼šç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹é…ç½®å˜æ›´å¹¶åº”ç”¨</li>
<li>è‡ªæ„ˆï¼šç³»ç»ŸæŒç»­è¶‹å‘æœŸæœ›çŠ¶æ€</li>
</ul>
<h2 data-id="heading-8">å››ã€è§£å†³æ–¹æ¡ˆä¸‰ï¼šé…ç½®æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-9">4.1 å¥åº·æ£€æŸ¥æ ‡å‡†åŒ–</h3>
<p>æ­£ç¡®é…ç½®å¥åº·æ£€æŸ¥æ¢é’ˆæ˜¯ç¡®ä¿åº”ç”¨é«˜å¯ç”¨çš„åŸºç¡€ã€‚</p>
<p><strong>æ¢é’ˆé…ç½®ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">containers:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">app</span>
  <span class="hljs-attr">livenessProbe:</span>
    <span class="hljs-attr">httpGet:</span>
      <span class="hljs-attr">path:</span> <span class="hljs-string">/health</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
    <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span>
    <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span>
    <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">5</span>
  <span class="hljs-attr">readinessProbe:</span>
    <span class="hljs-attr">httpGet:</span>
      <span class="hljs-attr">path:</span> <span class="hljs-string">/ready</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
    <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span>
    <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">5</span>
    <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">3</span>
  <span class="hljs-attr">startupProbe:</span>
    <span class="hljs-attr">httpGet:</span>
      <span class="hljs-attr">path:</span> <span class="hljs-string">/startup</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
    <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">30</span>
    <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span>
</code></pre>
<p>å¥åº·æ£€æŸ¥ç¡®ä¿ Kubernetes èƒ½å¤Ÿå‡†ç¡®åˆ¤æ–­åº”ç”¨çŠ¶æ€ï¼Œæ˜¯å®ç°è‡ªæ„ˆå’Œæ»šåŠ¨æ›´æ–°çš„åŸºç¡€ã€‚</p>
<h3 data-id="heading-10">4.2 èµ„æºç®¡ç†ä¸é™åˆ¶</h3>
<p>åˆç†è®¾ç½®èµ„æºè¯·æ±‚å’Œé™åˆ¶æ˜¯ä¿è¯åº”ç”¨ç¨³å®šè¿è¡Œçš„å…³é”®ã€‚</p>
<p><strong>èµ„æºé™åˆ¶ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">resources:</span>
  <span class="hljs-attr">requests:</span>
    <span class="hljs-attr">memory:</span> <span class="hljs-string">"128Mi"</span>
    <span class="hljs-attr">cpu:</span> <span class="hljs-string">"250m"</span>
  <span class="hljs-attr">limits:</span>
    <span class="hljs-attr">memory:</span> <span class="hljs-string">"512Mi"</span>
    <span class="hljs-attr">cpu:</span> <span class="hljs-string">"1000m"</span>
</code></pre>
<p>èµ„æºç®¡ç†æœ€ä½³å®è·µï¼š</p>
<ul>
<li>å§‹ç»ˆè®¾ç½®èµ„æºè¯·æ±‚å’Œé™åˆ¶</li>
<li>é€šè¿‡ HPA å®ç°è‡ªåŠ¨æ‰©ç¼©å®¹</li>
<li>å®šæœŸç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µå¹¶ä¼˜åŒ–</li>
</ul>
<h3 data-id="heading-11">4.3 å‘½åç©ºé—´ä¸æ ‡ç­¾ç­–ç•¥</h3>
<p>ä½¿ç”¨å‘½åç©ºé—´å’Œæ ‡ç­¾å®ç°é€»è¾‘éš”ç¦»å’Œèµ„æºç»„ç»‡ã€‚</p>
<p><strong>æ ‡ç­¾æ ‡å‡†åŒ–ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">user-service</span>
    <span class="hljs-attr">version:</span> <span class="hljs-string">v1.2.3</span>
    <span class="hljs-attr">environment:</span> <span class="hljs-string">production</span>
    <span class="hljs-attr">tier:</span> <span class="hljs-string">backend</span>
</code></pre>
<p>ç»Ÿä¸€çš„æ ‡ç­¾ç­–ç•¥ä¾¿äºèµ„æºæŸ¥è¯¢ã€ç›‘æ§å’Œè‡ªåŠ¨åŒ–ç®¡ç†ã€‚</p>
<h2 data-id="heading-12">äº”ã€æ¸è¿›å¼é…ç½®ç­–ç•¥</h2>
<h3 data-id="heading-13">5.1 ä»ç®€å•å¼€å§‹ï¼Œé€æ­¥å®Œå–„</h3>
<p>ä¸è¦è¯•å›¾ä¸€æ¬¡æ€§åˆ›å»ºå®Œç¾çš„ Deployment é…ç½®ï¼Œè€Œåº”é‡‡ç”¨æ¸è¿›å¼æ–¹æ³•ï¼š</p>
<ol>
<li><strong>åŸºç¡€é˜¶æ®µ</strong>ï¼šä»…åŒ…å«å¿…è¦å­—æ®µï¼ˆé•œåƒã€å‰¯æœ¬æ•°ã€ç«¯å£ï¼‰</li>
<li><strong>å¢å¼ºé˜¶æ®µ</strong>ï¼šæ·»åŠ å¥åº·æ£€æŸ¥ã€èµ„æºé™åˆ¶</li>
<li><strong>ä¼˜åŒ–é˜¶æ®µ</strong>ï¼šé…ç½®é«˜çº§ç­–ç•¥ï¼ˆç½‘ç»œã€å®‰å…¨ã€å­˜å‚¨ï¼‰</li>
</ol>
<p><strong>åŸºç¡€é…ç½®ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">my-app</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">my-app</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">my-app</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">app</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">my-app:latest</span>
        <span class="hljs-attr">ports:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span>
</code></pre>
<h3 data-id="heading-14">5.2 é…ç½®éªŒè¯ä¸è‡ªåŠ¨åŒ–æµ‹è¯•</h3>
<p>å°†é…ç½®éªŒè¯é›†æˆåˆ° CI/CD æµæ°´çº¿ä¸­ï¼Œç¡®ä¿å˜æ›´å®‰å…¨å¯é ã€‚</p>
<p><strong>éªŒè¯æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>è¯­æ³•éªŒè¯ï¼š<code>kubectl apply --dry-run=client -f deployment.yaml</code></li>
<li>ç­–ç•¥æ£€æŸ¥ï¼šä½¿ç”¨ OPA/Conftest éªŒè¯å®‰å…¨ç­–ç•¥</li>
<li>é›†æˆæµ‹è¯•ï¼šåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é…ç½®æ­£ç¡®æ€§</li>
</ol>
<h2 data-id="heading-15">å…­ã€å·¥å…·é“¾æ•´åˆ</h2>
<p>ä»¥ä¸‹è¡¨æ ¼å¯¹æ¯”äº†ä¸åŒç®€åŒ–æ–¹æ¡ˆçš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ï¼š</p>



































<table><thead><tr><th>å·¥å…·/æ–¹æ³•</th><th>æ ¸å¿ƒä¼˜åŠ¿</th><th>é€‚ç”¨åœºæ™¯</th><th>å­¦ä¹ æ›²çº¿</th></tr></thead><tbody><tr><td>Helm</td><td>å¼ºå¤§çš„æ¨¡æ¿åŒ–ã€ç‰ˆæœ¬ç®¡ç†ã€ä¾èµ–è§£å†³</td><td>å¤æ‚åº”ç”¨ã€å¤šç¯å¢ƒéƒ¨ç½²ã€åº”ç”¨åˆ†å‘</td><td>ä¸­ç­‰</td></tr><tr><td>Kustomize</td><td>æ— æ¨¡æ¿ã€çº¯ YAMLã€Kubernetes åŸç”Ÿ</td><td>ç¯å¢ƒå·®å¼‚åŒ–ã€é…ç½®è¡¥ä¸ã€ç®€å•åº”ç”¨</td><td>å¹³ç¼“</td></tr><tr><td>Skaffold</td><td>è‡ªåŠ¨åŒ–å¼€å‘æµç¨‹ã€å¿«é€Ÿåé¦ˆ</td><td>æœ¬åœ°å¼€å‘ã€æŒç»­é›†æˆã€å¾®æœåŠ¡æ¶æ„</td><td>ä¸­ç­‰</td></tr><tr><td>GitOps</td><td>å£°æ˜å¼ã€ç‰ˆæœ¬æ§åˆ¶ã€è‡ªæ„ˆèƒ½åŠ›</td><td>ç”Ÿäº§ç¯å¢ƒã€å›¢é˜Ÿåä½œã€åˆè§„è¦æ±‚</td><td>é™¡å³­</td></tr></tbody></table>
<h2 data-id="heading-16">ä¸ƒã€å®æˆ˜æ¡ˆä¾‹ï¼šç”µå•†åº”ç”¨é…ç½®ç®€åŒ–</h2>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”µå•†åº”ç”¨ï¼Œéœ€è¦ç®¡ç†å‰ç«¯ã€åç«¯å’Œæ•°æ®åº“å¤šä¸ªç»„ä»¶ã€‚</p>
<p><strong>åŸå§‹å¤æ‚é…ç½®</strong>ï¼ˆéƒ¨åˆ†ï¼‰ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># åŸå§‹å†—é•¿ä¸”é‡å¤çš„é…ç½®</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">ecommerce-frontend</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">frontend</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">frontend:1.2.3</span>
        <span class="hljs-attr">env:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">DB_HOST</span>
          <span class="hljs-attr">value:</span> <span class="hljs-string">"db.example.com"</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">API_ENDPOINT</span>  
          <span class="hljs-attr">value:</span> <span class="hljs-string">"https://api.example.com"</span>
        <span class="hljs-comment"># ... æ›´å¤šç¯å¢ƒå˜é‡</span>
</code></pre>
<p><strong>ç®€åŒ–åé…ç½®</strong>ï¼ˆä½¿ç”¨ Kustomize + Helmï¼‰ï¼š</p>
<ol>
<li><strong>åŸºç¡€é…ç½®</strong>ï¼ˆbase/deployment.yamlï¼‰ï¼š</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> {{ <span class="hljs-string">.Release.Name</span> }}<span class="hljs-string">-frontend</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> {{ <span class="hljs-string">.Values.replicaCount</span> }}
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">frontend</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ .Values.image.repository }}</span>:<span class="hljs-template-variable">{{ .Values.image.tag }}</span>"</span>
        <span class="hljs-attr">envFrom:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">configMapRef:</span>
            <span class="hljs-attr">name:</span> {{ <span class="hljs-string">.Release.Name</span> }}<span class="hljs-string">-environment</span>
</code></pre>
<ol>
<li><strong>ç¯å¢ƒç‰¹å®šå€¼</strong>ï¼ˆvalues/production.yamlï¼‰ï¼š</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">replicaCount:</span> <span class="hljs-number">5</span>
<span class="hljs-attr">image:</span>
  <span class="hljs-attr">repository:</span> <span class="hljs-string">frontend</span>
  <span class="hljs-attr">tag:</span> <span class="hljs-number">2.0</span><span class="hljs-number">.0</span><span class="hljs-string">-prod</span>
</code></pre>
<ol>
<li><strong>é…ç½®æ˜ å°„ç”Ÿæˆ</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">apiVersion:</span> v1
<span class="hljs-symbol">kind:</span> ConfigMap
<span class="hljs-symbol">metadata:</span>
  name: {{ .Release.Name }}-environment
<span class="hljs-symbol">data:</span>
  {{- range $<span class="hljs-keyword">key</span>, $value := .Values.environment }}
  {{ $<span class="hljs-keyword">key</span> }}: {{ $value | quote }}
  {{- <span class="hljs-keyword">end</span> }}
</code></pre>
<p>è¿™ç§æ–¹æ³•å°†é…ç½®åˆ†è§£ä¸ºå¯ç®¡ç†çš„éƒ¨åˆ†ï¼Œå¤§å¹…æå‡äº†å¯ç»´æŠ¤æ€§ã€‚</p>
<h2 data-id="heading-17">å…«ã€æ€»ç»“</h2>
<p>Kubernetes Deployment é…ç½®çš„å¤æ‚æ€§æ˜¯ä¸å¯é¿å…çš„ï¼Œä½†é€šè¿‡åˆé€‚çš„å·¥å…·å’Œæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ç§å¤æ‚æ€§æœ‰æ•ˆç®¡ç†èµ·æ¥ã€‚å…³é”®è¦ç‚¹æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>å·¥å…·é€‰æ‹©</strong>ï¼šæ ¹æ®å›¢é˜Ÿè§„æ¨¡å’ŒæŠ€æœ¯æ ˆé€‰æ‹©åˆé€‚çš„å·¥å…·ç»„åˆï¼ˆHelm + Kustomize + Skaffoldï¼‰</li>
<li><strong>æ¸è¿›é‡‡çº³</strong>ï¼šä»ç®€å•é…ç½®å¼€å§‹ï¼Œé€æ­¥æ·»åŠ é«˜çº§åŠŸèƒ½</li>
<li><strong>æ ‡å‡†åŒ–</strong>ï¼šå»ºç«‹å›¢é˜Ÿç»Ÿä¸€çš„é…ç½®è§„èŒƒå’Œæœ€ä½³å®è·µ</li>
<li><strong>è‡ªåŠ¨åŒ–</strong>ï¼šå°†éªŒè¯ã€æµ‹è¯•å’Œéƒ¨ç½²æµç¨‹è‡ªåŠ¨åŒ–</li>
<li><strong>æ–‡æ¡£åŒ–</strong>ï¼šä¸ºé…ç½®æ¨¡æ¿å’Œå€¼æ–‡ä»¶æä¾›æ¸…æ™°çš„æ–‡æ¡£</li>
</ol>
<p>é€šè¿‡å®æ–½è¿™äº›ç­–ç•¥ï¼Œæ‚¨ä¸ä»…èƒ½å¤Ÿé™ä½ Kubernetes Deployment çš„é…ç½®å¤æ‚åº¦ï¼Œè¿˜èƒ½æå‡éƒ¨ç½²æ•ˆç‡å’Œåº”ç”¨å¯é æ€§ï¼ŒçœŸæ­£å‘æŒ¥ Kubernetes ä½œä¸ºå®¹å™¨ç¼–æ’å¹³å°çš„å¼ºå¤§èƒ½åŠ›ã€‚</p>
<blockquote>
<p>æœ¬æ–‡ä»‹ç»çš„æ–¹æ³•å’Œå·¥å…·å¯ä»¥å•ç‹¬æˆ–ç»„åˆä½¿ç”¨ï¼Œå»ºè®®å›¢é˜Ÿæ ¹æ®å…·ä½“éœ€æ±‚å’ŒæŠ€èƒ½æ°´å¹³é€‰æ‹©æœ€é€‚åˆçš„ç®€åŒ–è·¯å¾„ï¼Œé€æ­¥å»ºç«‹é«˜æ•ˆå¯é çš„ Kubernetes åº”ç”¨äº¤ä»˜æµç¨‹ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kubernetesæ»šåŠ¨å‘å¸ƒè¯¦è§£]]></title>    <link>https://juejin.cn/post/7577220965438406710</link>    <guid>https://juejin.cn/post/7577220965438406710</guid>    <pubDate>2025-11-27T14:24:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577220965438406710" data-draft-id="7577278843233353771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kubernetesæ»šåŠ¨å‘å¸ƒè¯¦è§£"/> <meta itemprop="keywords" content="Kubernetes"/> <meta itemprop="datePublished" content="2025-11-27T14:24:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kubernetesæ»šåŠ¨å‘å¸ƒè¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T14:24:07.000Z" title="Thu Nov 27 2025 14:24:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Kubernetes ä¸­çš„æ»šåŠ¨å‘å¸ƒï¼ˆRolling Updateï¼‰æ˜¯ä¸€ç§éå¸¸ä¼˜é›…çš„éƒ¨ç½²ç­–ç•¥ï¼Œå®ƒèƒ½è®©ä½ åœ¨æ›´æ–°åº”ç”¨æ—¶ï¼Œå®ç°<strong>é›¶åœæœº</strong>å’Œ<strong>ç”¨æˆ·æ— æ„ŸçŸ¥</strong>çš„å¹³æ»‘å‡çº§ã€‚ä¸‹é¢è¿™å¼ å›¾æ¸…æ™°åœ°å±•ç¤ºäº†å®ƒçš„æ ¸å¿ƒå·¥ä½œæµç¨‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/992c09ff7ece4fb0a77945fdf73376ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTmqZjlrZDnmq4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764858302&amp;x-signature=C0ZEOOBSCWEfjFdgOTYaXGkU79Y%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬è¯¦ç»†è§£è¯»è¿™ä¸ªè¿‡ç¨‹ï¼Œå¹¶çœ‹çœ‹å¦‚ä½•æŒæ§å®ƒã€‚</p>
<h3 data-id="heading-0">ğŸ”„ æ»šåŠ¨å‘å¸ƒå¦‚ä½•å·¥ä½œ</h3>
<p>æ»šåŠ¨å‘å¸ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>é€æ­¥æ›¿æ¢</strong>ã€‚å®ƒä¸æ˜¯ä¸€æ¬¡æ€§åœæ­¢æ‰€æœ‰æ—§ç‰ˆæœ¬çš„ Podï¼ˆå®ä¾‹ï¼‰ï¼Œç„¶åå†å¯åŠ¨æ‰€æœ‰æ–°ç‰ˆæœ¬çš„ Podã€‚ç›¸åï¼Œå®ƒéµå¾ªä¸€ä¸ªç²¾å¿ƒæ§åˆ¶çš„æµç¨‹ï¼š</p>
<ol>
<li><strong>é€æ­¥æ›´æ›¿</strong>ï¼šå¦‚æµç¨‹å›¾æ‰€ç¤ºï¼Œç³»ç»Ÿä¼šå…ˆå¯åŠ¨ä¸€ä¸ª<strong>æ–°ç‰ˆæœ¬ Pod</strong>ï¼ˆV2ï¼‰ï¼Œå¹¶ç­‰å¾…å…¶é€šè¿‡<strong>å°±ç»ªæ¢é’ˆ</strong>æ£€æŸ¥ï¼Œç¡®è®¤å…¶å·²å‡†å¤‡å¥½æ¥æ”¶æµé‡ã€‚</li>
<li><strong>æµé‡åˆ‡æ¢</strong>ï¼šä¸€æ—¦æ–°çš„ Pod å°±ç»ªï¼Œè´Ÿè½½å‡è¡¡å™¨ï¼ˆé€šå¸¸æ˜¯ Kubernetes Serviceï¼‰å°±ä¼šå°†æµé‡å¼•å¯¼åˆ°å®ƒä¸Šé¢ï¼ŒåŒæ—¶<strong>ç»ˆæ­¢ä¸€ä¸ªæ—§ç‰ˆæœ¬ Pod</strong>ï¼ˆV1ï¼‰ã€‚</li>
<li><strong>å¾ªç¯å¾€å¤</strong>ï¼šè¿™ä¸ªè¿‡ç¨‹å¾ªç¯è¿›è¡Œï¼Œç›´åˆ°æ‰€æœ‰æ—§ç‰ˆæœ¬çš„ Pod éƒ½è¢«æ›¿æ¢ä¸ºæ–°ç‰ˆæœ¬çš„ Podã€‚</li>
</ol>
<p>è¿™ç§æ–¹å¼ç¡®ä¿äº†åœ¨æ•´ä¸ªæ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå§‹ç»ˆæœ‰å¯ç”¨çš„ Pod å®ä¾‹åœ¨å¯¹å¤–æä¾›æœåŠ¡ï¼Œä»è€Œå®ç°äº†é›¶åœæœºã€‚</p>
<h3 data-id="heading-1">âš™ï¸ æ ¸å¿ƒé…ç½®å‚æ•°</h3>
<p>æ»šåŠ¨å‘å¸ƒçš„ç²¾ç»†æ§åˆ¶ï¼Œä¸»è¦é€šè¿‡ Deployment é…ç½®ä¸­çš„ <code>strategy.rollingUpdate</code>ä¸‹çš„ä¸¤ä¸ªå…³é”®å‚æ•°å®ç°ï¼š</p>























<table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th><th>é»˜è®¤å€¼</th><th>ç”Ÿäº§ç¯å¢ƒå»ºè®®</th></tr></thead><tbody><tr><td>**<code>maxSurge</code>**â€‹</td><td>æ§åˆ¶<strong>æœ€å¤šèƒ½åˆ›å»ºå¤šå°‘ä¸ªè¶…å‡ºæœŸæœ›å‰¯æœ¬æ•°</strong>çš„ Podã€‚</td><td>25%</td><td>é€šå¸¸è®¾ç½®ä¸º 1 æˆ– 25%ã€‚è¿™ç›¸å½“äºæ›´æ–°è¿‡ç¨‹ä¸­çš„â€œç¼“å†²åŒºâ€ï¼Œå…è®¸æ–° Pod æå‰å¯åŠ¨ã€‚</td></tr><tr><td>**<code>maxUnavailable</code>**â€‹</td><td>æ§åˆ¶<strong>åœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæœ€å¤šå…è®¸å¤šå°‘ä¸ª Pod ä¸å¯ç”¨</strong>ã€‚</td><td>25%</td><td>å¯¹äºè¦æ±‚é«˜å¯ç”¨çš„æœåŠ¡ï¼Œå¯è®¾ç½®ä¸º 0ï¼Œç¡®ä¿æ›´æ–°æœŸé—´æœåŠ¡å®¹é‡ä¸é™ä½ã€‚</td></tr></tbody></table>
<p><strong>ä¸¾ä¸ªä¾‹å­</strong>ï¼šå¦‚æœä½ çš„åº”ç”¨æœ‰ 4 ä¸ªå‰¯æœ¬ï¼Œå¹¶è®¾ç½® <code>maxSurge=1</code>ï¼ˆæœ€å¤šå¯è¶… 1 ä¸ª Podï¼‰ï¼Œ<code>maxUnavailable=0</code>ï¼ˆä¸å…è®¸ä»»ä½• Pod ä¸å¯ç”¨ï¼‰ã€‚é‚£ä¹ˆæ»šåŠ¨æ›´æ–°æ—¶ï¼ŒKubernetes ä¼šå…ˆåˆ›å»ºä¸€ä¸ªæ–° Podï¼ˆæ­¤æ—¶æ€»æ•°ä¸º 5 ä¸ªï¼‰ï¼Œå¾…å…¶å°±ç»ªåï¼Œå†ç»ˆæ­¢ä¸€ä¸ªæ—§ Podï¼ˆæ€»æ•°æ¢å¤ 4 ä¸ªï¼‰ï¼Œå¦‚æ­¤å¾ªç¯ã€‚è¿™æ ·ï¼Œä»»ä½•æ—¶å€™éƒ½è‡³å°‘æœ‰ 4 ä¸ª Pod æ˜¯å¯ç”¨çš„ã€‚</p>
<h3 data-id="heading-2">ğŸ› ï¸ å®æˆ˜æ“ä½œæŒ‡å—</h3>
<p>æŒæ¡äº†åŸç†åï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥ç®¡ç†å’Œç›‘æ§æ»šåŠ¨å‘å¸ƒï¼š</p>

































<table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>kubectl set image deployment/&lt;éƒ¨ç½²åç§°&gt; &lt;å®¹å™¨å&gt;=&lt;æ–°é•œåƒ&gt;:&lt;æ ‡ç­¾&gt;</code></td><td><strong>è§¦å‘æ›´æ–°</strong>ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„è§¦å‘æ–¹å¼ã€‚</td></tr><tr><td><code>kubectl rollout status deployment/&lt;éƒ¨ç½²åç§°&gt;</code></td><td><strong>å®æ—¶æŸ¥çœ‹</strong>æ›´æ–°çŠ¶æ€å’Œè¿›åº¦ã€‚</td></tr><tr><td><code>kubectl rollout pause deployment/&lt;éƒ¨ç½²åç§°&gt;</code></td><td><strong>æš‚åœ</strong>æ»šåŠ¨æ›´æ–°ã€‚é€‚ç”¨äºæƒ³åœ¨æŸä¸ªä¸­é—´çŠ¶æ€è¿›è¡ŒéªŒè¯çš„åœºæ™¯ã€‚</td></tr><tr><td><code>kubectl rollout resume deployment/&lt;éƒ¨ç½²åç§°&gt;</code></td><td><strong>ç»§ç»­</strong>è¢«æš‚åœçš„æ»šåŠ¨æ›´æ–°ã€‚</td></tr><tr><td><code>kubectl rollout undo deployment/&lt;éƒ¨ç½²åç§°&gt;</code></td><td><strong>å›æ»š</strong>åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ã€‚è¿™æ˜¯æ»šåŠ¨å‘å¸ƒå¸¦æ¥çš„å·¨å¤§ä¼˜åŠ¿ä¹‹ä¸€ã€‚</td></tr><tr><td><code>kubectl get pods -w</code></td><td><strong>è§‚å¯Ÿ Pod çš„æ–°æ—§æ›¿æ¢è¿‡ç¨‹</strong>ï¼Œç›´è§‚çœ‹åˆ°æµç¨‹å›¾ä¸­çš„æ¯ä¸€æ­¥ã€‚</td></tr></tbody></table>
<h3 data-id="heading-3">ğŸ’¡ ç¡®ä¿å¹³æ»‘å‘å¸ƒçš„è¿›é˜¶æŠ€å·§</h3>
<p>è¦è®©æ»šåŠ¨å‘å¸ƒçœŸæ­£ä¸æ»‘ï¼Œè¿˜éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li><strong>é…ç½®å°±ç»ªæ¢é’ˆ</strong>ï¼šè¿™æ˜¯æœ€é‡è¦çš„é…ç½®ï¼<code>readinessProbe</code>å‘Šè¯‰ Kubernetes ä½ çš„åº”ç”¨<strong>ä½•æ—¶çœŸæ­£å‡†å¤‡å¥½</strong>æ¥æ”¶æµé‡ã€‚å¦‚æœæ²¡æœ‰å®ƒï¼ŒKubernetes ä¼šåœ¨å®¹å™¨è¿›ç¨‹å¯åŠ¨åç«‹å³å‘é€æµé‡ï¼Œè€Œæ­¤æ—¶ä½ çš„åº”ç”¨ï¼ˆå¦‚ Spring Boot é¡¹ç›®ï¼‰å¯èƒ½è¿˜åœ¨åŠ è½½ Spring ä¸Šä¸‹æ–‡æˆ–è¿æ¥æ•°æ®åº“ï¼Œå¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚åŠ¡å¿…æ ¹æ®åº”ç”¨å¯åŠ¨ç‰¹ç‚¹é…ç½®åˆç†çš„è·¯å¾„å’Œå»¶è¿Ÿæ—¶é—´ã€‚</li>
<li><strong>é…ç½®ä¼˜é›…ç»ˆæ­¢</strong>ï¼šåœ¨ Pod è¢«ç»ˆæ­¢æ—¶ï¼ŒKubernetes ä¼šå‘å®¹å™¨å†…çš„è¿›ç¨‹å‘é€ SIGTERM ä¿¡å·ã€‚ä½ çš„åº”ç”¨åº”è¯¥æ•è·è¿™ä¸ªä¿¡å·ï¼Œç„¶ååœæ­¢æ¥æ”¶æ–°è¯·æ±‚ï¼Œå¹¶ç­‰å¾…å·²æœ‰è¯·æ±‚å¤„ç†å®Œæˆåå†é€€å‡ºã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ Deployment ä¸­é…ç½® <code>spec.template.spec.terminationGracePeriodSeconds</code>å¹¶ç»“åˆ <code>preStop</code>é’©å­æ¥å®ç°ï¼Œç»™åº”ç”¨ä¸€ä¸ªæ¸…ç†å’Œé€€å‡ºçš„ç¼“å†²æ—¶é—´ã€‚</li>
<li><strong>é¿å…ä½¿ç”¨ <code>latest</code>æ ‡ç­¾</strong>ï¼šåœ¨ Deployment çš„ YAML ä¸­ï¼Œæ˜ç¡®æŒ‡å®šé•œåƒç‰ˆæœ¬æ ‡ç­¾ã€‚ä½¿ç”¨ <code>latest</code>æ ‡ç­¾ä¼šå¯¼è‡´æ— æ³•æ¸…æ™°è¿½è¸ªå½“å‰è¿è¡Œçš„ç‰ˆæœ¬ï¼Œä¹Ÿç»™å›æ»šå¸¦æ¥ä¸ç¡®å®šæ€§ã€‚</li>
</ol>
<h3 data-id="heading-4">âš–ï¸ ä¼˜ç¼ºç‚¹ä¸ç­–ç•¥å¯¹æ¯”</h3>



































<table><thead><tr><th>ç‰¹ç‚¹</th><th>æ»šåŠ¨å‘å¸ƒ</th><th>é‡å»ºå‘å¸ƒ</th><th>è“ç»¿å‘å¸ƒ</th></tr></thead><tbody><tr><td><strong>å‘å¸ƒæ–¹å¼</strong>â€‹</td><td>é€æ­¥æ›¿æ¢ï¼Œæ–°è€ç‰ˆæœ¬<strong>åŒæ—¶å­˜åœ¨</strong>ä¸€æ®µæ—¶é—´</td><td>å…ˆ<strong>å…¨éƒ¨åœæ­¢</strong>æ—§ç‰ˆæœ¬ï¼Œå†å¯åŠ¨æ–°ç‰ˆæœ¬</td><td>éƒ¨ç½²<strong>ä¸¤å¥—å®Œæ•´ç¯å¢ƒ</strong>ï¼Œæµé‡ä¸€æ¬¡æ€§åˆ‡æ¢</td></tr><tr><td><strong>èµ„æºå ç”¨</strong>â€‹</td><td>ä½ï¼ˆåªéœ€è¿è¡Œä¸€å¥—ç¯å¢ƒï¼‰</td><td>ä½ï¼ˆåªéœ€è¿è¡Œä¸€å¥—ç¯å¢ƒï¼‰</td><td>é«˜ï¼ˆéœ€è¦ä¸¤å¥—ç¯å¢ƒçš„èµ„æºï¼‰</td></tr><tr><td><strong>å‘å¸ƒé£é™©</strong>â€‹</td><td>ä¸­ï¼ˆé£é™©è¢«åˆ†æ•£ï¼Œå¯å¿«é€Ÿå›æ»šï¼‰</td><td>é«˜ï¼ˆæœåŠ¡æœ‰ä¸­æ–­æœŸï¼‰</td><td>ä½ï¼ˆå›æ»šæå¿«ï¼‰</td></tr><tr><td><strong>å¤æ‚åº¦</strong>â€‹</td><td>ä½ï¼ˆKubernetes åŸç”Ÿæ”¯æŒï¼‰</td><td>ä½</td><td>ä¸­ï¼ˆéœ€è¦é¢å¤–çš„æµé‡æ§åˆ¶èƒ½åŠ›ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-5">ğŸ’ æ€»ç»“</h3>
<p>æ€»è€Œè¨€ä¹‹ï¼ŒKubernetes çš„æ»šåŠ¨å‘å¸ƒæ˜¯ä¸€ç§å¼ºå¤§ä¸”å®ç”¨çš„éƒ¨ç½²ç­–ç•¥ã€‚ç†è§£å…¶<strong>é€æ­¥æ›¿æ¢</strong>çš„å·¥ä½œåŸç†ï¼Œç†Ÿç»ƒè¿ç”¨ <strong><code>maxSurge</code>å’Œ <code>maxUnavailable</code><strong>â€‹ æ¥æ§åˆ¶èŠ‚å¥ï¼Œå¹¶ç»“åˆ</strong>å°±ç»ªæ¢é’ˆå’Œä¼˜é›…ç»ˆæ­¢</strong>ç­‰æœ€ä½³å®è·µï¼Œä½ å°±èƒ½çœŸæ­£æŒæ¡åœ¨ Kubernetes ä¸Šè¿›è¡Œå¹³æ»‘ã€æ— æŸåº”ç”¨å‘å¸ƒçš„è‰ºæœ¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç«å±±å¼•æ“å¤šåª’ä½“å®éªŒå®¤AIGCè§†é¢‘ç”»è´¨ç†è§£å¤§æ¨¡å‹VQ-Insightå…¥é€‰AAAI 2025 Oral]]></title>    <link>https://juejin.cn/post/7577431644069036083</link>    <guid>https://juejin.cn/post/7577431644069036083</guid>    <pubDate>2025-11-28T08:25:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577431644069036083" data-draft-id="7577430671947644954" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç«å±±å¼•æ“å¤šåª’ä½“å®éªŒå®¤AIGCè§†é¢‘ç”»è´¨ç†è§£å¤§æ¨¡å‹VQ-Insightå…¥é€‰AAAI 2025 Oral"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-28T08:25:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å­—èŠ‚è·³åŠ¨è§†é¢‘äº‘æŠ€æœ¯å›¢é˜Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3026268632912584"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç«å±±å¼•æ“å¤šåª’ä½“å®éªŒå®¤AIGCè§†é¢‘ç”»è´¨ç†è§£å¤§æ¨¡å‹VQ-Insightå…¥é€‰AAAI 2025 Oral
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3026268632912584/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å­—èŠ‚è·³åŠ¨è§†é¢‘äº‘æŠ€æœ¯å›¢é˜Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T08:25:39.000Z" title="Fri Nov 28 2025 08:25:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>ä¼šè®®èƒŒæ™¯</strong></p>
<p>è¿‘æ—¥ï¼ŒAAAI 2026å…¬å¸ƒäº†å½•ç”¨ç»“æœï¼Œè¯¥ä¼šè®®æ˜¯æ˜¯äººå·¥æ™ºèƒ½é¢†åŸŸæå…·å½±å“åŠ›çš„å›½é™…é¡¶çº§å­¦æœ¯ä¼šè®®ä¹‹ä¸€ã€‚æ®æ‚‰æœ¬æ¬¡ä¼šè®®å…±æœ‰23680ç¯‡æŠ•ç¨¿è¿›å…¥å®¡ç¨¿é˜¶æ®µï¼Œæœ€ç»ˆ4167ç¯‡è®ºæ–‡è¢«å½•ç”¨ï¼Œå½•å–ç‡ä¸º17.6%ã€‚</p>
<p>ç«å±±å¼•æ“å¤šåª’ä½“å®éªŒå®¤å’ŒåŒ—äº¬å¤§å­¦åˆä½œçš„è®ºæ–‡<strong>VQ-Insight: Teaching VLMs for AI-Generated Video Quality Understanding via Progressive Visual Reinforcement Learning</strong> è¢«é€‰ä¸ºæœ¬æ¬¡ä¼šè®®å£å¤´æ±‡æŠ¥æ–‡ç« ã€‚</p>
<p><strong>VQ-Insightï¼šAIGCè§†é¢‘ç”»è´¨ç†è§£å¤§æ¨¡å‹</strong></p>
<p><strong>è®ºæ–‡èƒŒæ™¯</strong></p>
<p>éšç€è§†é¢‘ç”Ÿæˆæ¨¡å‹çš„æ¶Œç°ï¼Œä»…å‡­ä¸€å¥æç¤ºè¯æˆ–ä¸€å¼ å›¾ç‰‡ç”Ÿæˆé€¼çœŸã€ç”ŸåŠ¨çš„é«˜è´¨æ„Ÿè§†é¢‘æ­£é€æ¸æˆä¸ºç°å®ã€‚éšç€ AIGC è§†é¢‘æŠ€æœ¯åŠ é€Ÿæ¼”è¿›ï¼Œ<strong>å¦‚ä½•åœ¨åè®­ç»ƒé˜¶æ®µè¿›ä¸€æ­¥æå‡æ¨¡å‹çš„ç”Ÿæˆè´¨é‡</strong>å˜å¾—å°¤ä¸ºå…³é”®ã€‚å¯é çš„è´¨é‡è¯„ä¼°ä¸åå¥½é€‰æ‹©ä¸ä»…æ˜¯è¯„ä»·å·¥å…·ï¼Œæ›´æ˜¯åè®­ç»ƒçš„é‡è¦é©±åŠ¨åŠ›ï¼Œå®ƒä»¬èƒ½å¤Ÿç²¾ç¡®å¼•å¯¼è§†é¢‘ç”Ÿæˆæ¨¡å‹å‘äººçœ¼æ„ŸçŸ¥å¯¹é½ï¼Œä»è€Œæ˜¾è‘—æå‡ç”»é¢è´¨é‡ä¸æ—¶åºä¸€è‡´æ€§ã€‚</p>
<p>æ­¤å‰ï¼ŒåŒ—äº¬å¤§å­¦ä¸ç«å±±å¼•æ“å¤šåª’ä½“å®éªŒå®¤è”åˆæå‡ºäº†é¦–ä¸ªåŸºäºå¼ºåŒ–å­¦ä¹ è®­ç»ƒçš„å¤šæ¨¡æ€å¤§æ¨¡å‹å›¾åƒç”»è´¨ç†è§£æ–¹æ¡ˆ <strong>Q-Insight</strong>ã€‚è¯¥æ–¹æ³•æ‘†è„±äº†å¯¹å¤§è§„æ¨¡æ–‡æœ¬æ ‡æ³¨çš„ä¾èµ–ï¼Œå……åˆ†æŒ–æ˜å¤§æ¨¡å‹çš„æ¨ç†æ½œåŠ›ï¼Œä½¿å…¶èƒ½å¤Ÿæ·±å…¥æ€è€ƒå›¾åƒè´¨é‡èƒŒåçš„æœ¬è´¨å› ç´ ã€‚ç„¶è€Œï¼Œå°†è¿™ä¸€æ€è·¯æ‰©å±•åˆ° AIGC è§†é¢‘è¯„ä¼°ä»é¢ä¸´æ–°çš„æŒ‘æˆ˜ï¼Œå³ï¼š<strong>1ï¼‰</strong> å¦‚ä½•æ›´æœ‰æ•ˆåœ°æ¿€å‘å¤§æ¨¡å‹çš„æ—¶åºæ„ŸçŸ¥èƒ½åŠ›ä¸å¤šç»´åº¦ç”»è´¨ç†è§£èƒ½åŠ›ï¼›<strong>2ï¼‰</strong> å¦‚ä½•å»ºç«‹è¯„ä¼°æ¨¡å‹ä¸ç”Ÿæˆæ¨¡å‹çš„åé¦ˆäº’åŠ¨ï¼Œä½¿ä¸¤è€…åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­è·å¾—åŠ¨æ€å¢å¼ºï¼Œç›¸äº’ä¿ƒè¿›ã€‚Â </p>
<p><strong>æ¸è¿›å¼è§†è§‰è´¨é‡å¼ºåŒ–å­¦ä¹ æ¡†æ¶</strong></p>
<p>å›¾åƒåªæ•æ‰è§†é¢‘çš„ä¸€ä¸ªåˆ‡ç‰‡ï¼Œç”¨æˆ·çœŸå®çš„è§†é¢‘è§‚çœ‹ä½“éªŒè¿˜å–å†³äºæ—¶é—´ç»´åº¦ï¼Œä¾‹å¦‚è¿åŠ¨æ˜¯å¦è‡ªç„¶ï¼Ÿè‰²å½©æ˜¯å¦åœ¨åŠ¨æ€ä¸­ç¨³å®šï¼Ÿå› æ­¤ï¼Œæˆ‘ä»¬æŠŠQ-Insightçš„â€œæ¨ç†å¼ + å¼ºåŒ–å­¦ä¹ â€æ€è·¯ï¼Œæ‹“å±•åˆ°è‡ªç„¶è§†é¢‘å’ŒAIGCè§†é¢‘ä¸­ï¼Œæå‡ºäº†æ¨ç†å¼AIGCè§†é¢‘ç”»è´¨ç†è§£å¤§æ¨¡å‹<strong>VQ-Insight</strong>ã€‚è¯¥æ–¹æ³•ä½¿ç”¨æ¸è¿›å¼çš„è§†è§‰è´¨é‡å¼ºåŒ–å­¦ä¹ æ¡†æ¶ï¼ŒåŒ…æ‹¬å›¾åƒæ‰“åˆ†é¢„çƒ­é˜¶æ®µã€ä»»åŠ¡é©±åŠ¨çš„é€šç”¨æ—¶åºå­¦ä¹ é˜¶æ®µä»¥åŠä¸è§†é¢‘ç”Ÿæˆæ¨¡å‹çš„è”åˆå¾®è°ƒé˜¶æ®µã€‚é€šè¿‡ç”±æ˜“åˆ°éš¾ã€ç”±é€šç”¨åˆ°å…·ä½“çš„è§†é¢‘è´¨é‡æ‰“åˆ†å­¦ä¹ ï¼Œä»…ä½¿ç”¨å°‘é‡æ•°æ®å°±èƒ½æ•™ä¼šAIGCè§†é¢‘åå¥½æ¯”è¾ƒï¼ŒAIGCè§†é¢‘å¤šç»´åº¦æ‰“åˆ†ï¼Œè‡ªç„¶è§†é¢‘æ‰“åˆ†ç­‰å¤šé¡¹ä»»åŠ¡ï¼Œå¹¶æœ€ç»ˆå»ºç«‹å’Œä¸‹æ¸¸ç”Ÿæˆæ¨¡å‹çš„ä¸“é¡¹è¯„ä¼°èƒ½åŠ›ã€‚åŒæ—¶ï¼Œè¯¥æ–¹æ³•å¼•å…¥æ—¶åºå»ºæ¨¡å¥–åŠ±å‡½æ•°å’Œé•¿åº¦æ§åˆ¶å¥–åŠ±å‡½æ•°ï¼Œé¼“åŠ±å¤§æ¨¡å‹æ¢ç´¢è§†é¢‘å¸§é—´çš„ç›¸å…³æ€§å’Œè¿è´¯æ€§ï¼Œå¹¶æä¾›å¯¹äºè§†é¢‘è´¨é‡çº¿ç´¢çš„ä¸°å¯Œåˆ†æï¼Œå¢å¼ºåå¥½æ¯”è¾ƒå’Œåˆ†æ•°å›å½’çš„å‡†ç¡®æ€§ã€‚</p>
<p>è¿›ä¸€æ­¥ï¼Œè¯¥æ–¹æ³•æå‡ºäº†ä¸€ç§ç”Ÿæˆæ¨¡å‹ä¸è´¨é‡è¯„ä¼°æ¨¡å‹â€œå…±åŒè¿›åŒ–â€çš„è”åˆè®­ç»ƒæ–¹å¼ï¼šç”Ÿæˆæ¨¡å‹æ¯ä¸€è½®éƒ½ä¼šäº§ç”Ÿä¸€æ‰¹æ–°è§†é¢‘ï¼ŒVQ-Insightè‡ªåŠ¨ä»ä¸­æŒ‘é€‰å‡ºæ›´å¥½çš„å’Œæ›´å·®çš„æ ·æœ¬ï¼Œæ„å»ºé«˜è´¨é‡åå¥½æ•°æ®ï¼›è¿™äº›åå¥½æ•°æ®æ—¢ç”¨äºç»§ç»­ä¼˜åŒ–è§†é¢‘ç”Ÿæˆæ¨¡å‹ï¼ˆå¦‚ DPOï¼‰ï¼Œä¹Ÿç”¨äºåå‘åŠ å¼º VQ-Insight çš„åå¥½ç†è§£èƒ½åŠ›ï¼Œä½¿å…¶é€æ­¥é€‚é…å¹¶å¼•å¯¼å½“å‰çš„ç”Ÿæˆæ¨¡å‹ã€‚é€šè¿‡è¿™ç§é—­ç¯å¼çš„ååŒä¼˜åŒ–ï¼Œç”Ÿæˆæ¨¡å‹å’Œè¯„ä¼°æ¨¡å‹ä¼šéšç€è¿­ä»£ä¸æ–­å˜å¼ºï¼Œå®ç°â€œè¶Šç”Ÿæˆè¶Šæ‡‚ã€è¶Šæ‡‚è¶Šèƒ½ç”Ÿâ€çš„æŒç»­æå‡æ•ˆæœã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b0e7c3c3d834642b6d3fb7c02d4366a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2X6IqC6Lez5Yqo6KeG6aKR5LqR5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764923139&amp;x-signature=ZD%2FPfVZJlRKH%2FdphFmmeNL0I4vI%3D" alt="å›¾ç‰‡1.png" loading="lazy"/></p>
<p><strong>å®éªŒç»“æœ</strong></p>
<p>å®éªŒç»“æœå……åˆ†éªŒè¯äº†VQ-Insightåœ¨AIGCè§†é¢‘åå¥½æ¯”è¾ƒï¼Œå¤šç»´åº¦æ‰“åˆ†å’Œè‡ªç„¶è§†é¢‘æ‰“åˆ†ä»»åŠ¡ä¸­çš„å“è¶Šè¡¨ç°ã€‚</p>
<p>â€¢Â åœ¨AIGCåå¥½æ¯”è¾ƒä»»åŠ¡ä¸Šï¼ŒVQ-Insightåœ¨å¤šä¸ªå…¬å¼€æ•°æ®é›†ä¸Šçš„è¡¨ç°å‡è¶…è¿‡å½“å‰æœ€å…ˆè¿›çš„æ–¹æ³•ï¼Œå¹¶èƒ½å¤Ÿä»è§†è§‰è´¨é‡ã€æ—¶åºä¸€è‡´æ€§ã€åŠ¨æ€ç¨‹åº¦å’Œè§†é¢‘çœŸå®æ€§æ–¹é¢æä¾›å®Œæ•´è¯¦ç»†çš„æ¨ç†è¿‡ç¨‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbec38ab5244400fb8725acf4c104c2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2X6IqC6Lez5Yqo6KeG6aKR5LqR5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764923139&amp;x-signature=EdxjUJwL5lBIovw7JBd3rrQ%2BREM%3D" alt="å›¾ç‰‡2.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1ded8bab34f4d2aa0f9757ae0df5568~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2X6IqC6Lez5Yqo6KeG6aKR5LqR5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764923139&amp;x-signature=1If2M1R3fIQIF%2BAuqUpAO0UqS5k%3D" alt="å›¾ç‰‡3.png" loading="lazy"/></p>
<p>â€¢Â åœ¨AIGCå¤šç»´åº¦æ‰“åˆ†ä»»åŠ¡ä¸Šï¼ŒVQ-Insightèƒ½å¤Ÿåœ¨ç©ºé—´è´¨é‡ã€æ—¶åºè´¨é‡å’Œæ–‡æœ¬è§†é¢‘ä¸€è‡´æ€§æ‰“åˆ†ä¸Šéƒ½å–å¾—æœ€ä¼˜æ€§èƒ½ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61c2dc3f8c8f4ffe8d247a9e1c35e6d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2X6IqC6Lez5Yqo6KeG6aKR5LqR5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764923139&amp;x-signature=0bEYIA7SXxtKDxMET0w1coPBLAY%3D" alt="å›¾ç‰‡4.png" loading="lazy"/></p>
<p>â€¢Â åœ¨è‡ªç„¶è§†é¢‘æ‰“åˆ†ä»»åŠ¡ä¸Šï¼ŒVQ-InsightåŒæ ·è¡¨ç°å‡ºå‡ºè‰²çš„åˆ†æ•°æ‹Ÿåˆç²¾ç¡®åº¦ï¼Œç‰¹åˆ«æ˜¯åœ¨åŸŸå¤–æ•°æ®é›†ä¸Šæ³›åŒ–èƒ½åŠ›çªå‡ºã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff5da555e9a84f468e9e46825769e379~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2X6IqC6Lez5Yqo6KeG6aKR5LqR5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764923139&amp;x-signature=XLBYzxgd32q6cPd8VKqftyePpH8%3D" alt="å›¾ç‰‡5.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2af8022fbfc43248cbb2b946d786822~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2X6IqC6Lez5Yqo6KeG6aKR5LqR5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764923139&amp;x-signature=gwtYmlN99DRjXDx%2BsdaUaqZBH3A%3D" alt="å›¾ç‰‡6.png" loading="lazy"/></p>
<p>â€¢Â VQ-Insightå¼ºå¤§çš„AIGCè§†é¢‘åå¥½æ¯”è¾ƒèƒ½åŠ›ï¼Œå¯ç›´æ¥åº”ç”¨äºè§†é¢‘ç”Ÿæˆæ¨¡å‹çš„ç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDPOï¼‰ã€‚å¦‚å›¾æ‰€ç¤ºï¼ŒåŸºäºVQ-Insightçš„æ–¹æ¡ˆç›¸æ¯”äºç”Ÿæˆæ¨¡å‹åŸºçº¿å’Œå¯¹æ¯”æ–¹æ³•ï¼Œæœ‰æ•ˆåœ°ç¼“è§£äº†é”™è¯¯ç”Ÿæˆçš„é—®é¢˜ï¼Œå¹¶æœ‰ç€æ›´é²œè‰³çš„è‰²å½©å’ŒåŠ¨æ€ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8535ff4bef26447fa02d2a436abdc326~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2X6IqC6Lez5Yqo6KeG6aKR5LqR5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764923139&amp;x-signature=NF65fTa6K1KbDewh7saWisHWzFE%3D" alt="å›¾ç‰‡7.png" loading="lazy"/>
<strong>æ€»ç»“</strong></p>
<p>VQ-Insight å°†â€œæ¨ç†å¼ + å¼ºåŒ–å­¦ä¹ â€æ€è·¯åº”ç”¨äºAIGCè§†é¢‘ç”»è´¨ç†è§£ä»»åŠ¡ä¸­ï¼Œåœ¨åå¥½æ¯”è¾ƒã€å¤šç»´åº¦ç”»è´¨æ‰“åˆ†ä¸è‡ªç„¶è§†é¢‘è´¨é‡è¯„ä¼°ç­‰ä»»åŠ¡ä¸Šå‡å–å¾—äº†çªç ´æ€§è¡¨ç°ã€‚é€šè¿‡æ¸è¿›å¼è§†è§‰è´¨é‡å¼ºåŒ–å­¦ä¹ æ¡†æ¶ä¸åˆ›æ–°çš„æ—¶åºå¥–åŠ±æœºåˆ¶ï¼ŒVQ-Insight èƒ½å¤Ÿä»¥æå°‘çš„æ•°æ®å®ç°å¼ºæ³›åŒ–å’Œå¼ºè§£é‡Šæ€§ï¼Œç²¾å‡†æ•æ‰è§†é¢‘çš„ç©ºé—´æ¸…æ™°åº¦ã€åŠ¨æ€ä¸€è‡´æ€§ã€å†…å®¹çœŸå®æ€§ç­‰å¤šç»´åº¦è´¨é‡ç‰¹å¾ã€‚æ›´é‡è¦çš„æ˜¯ï¼ŒVQ-Insight å·²èƒ½ç›´æ¥ç”¨äºç”Ÿæˆæ¨¡å‹çš„åè®­ç»ƒï¼Œæˆä¸ºç”Ÿæˆè§†é¢‘è®­ç»ƒçš„å¯æ’æ‹”å¥–åŠ±ä¸åå¥½æ¨¡å—ï¼ŒæŠŠâ€œçœ‹å¾—å‡†â€è½¬åŒ–ä¸ºâ€œç”Ÿæˆå¾—æ›´å¥½â€ï¼Œä¸ºæœªæ¥çš„è§†é¢‘ç”Ÿæˆæ¨¡å‹å¸¦æ¥æ›´ç¨³å®šã€æ›´ç¬¦åˆäººçœ¼æ„ŸçŸ¥çš„ç”»é¢è´¨é‡ï¼Œä¸ºä¸‹ä¸€ä»£ AIGC è§†é¢‘ç”ŸæˆæŠ€æœ¯çš„å‘å±•å¥ å®šäº†å…³é”®åŸºç¡€ã€‚</p>
<p><strong>ç›¸å…³é“¾æ¥</strong></p>
<p>ï¿½ï¿½VQ-Insight: <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2506.18564" target="_blank" title="https://arxiv.org/pdf/2506.18564" ref="nofollow noopener noreferrer">arxiv.org/pdf/2506.18â€¦</a></p>
<p>ï¿½ï¿½Q-Insight: <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2503.22679" target="_blank" title="https://arxiv.org/pdf/2503.22679" ref="nofollow noopener noreferrer">arxiv.org/pdf/2503.22â€¦</a></p>
<p>â­ï¸è®­ç»ƒä¸æ¨ç†ä»£ç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbytedance%2FQ-Insight" target="_blank" title="https://github.com/bytedance/Q-Insight" ref="nofollow noopener noreferrer">github.com/bytedance/Qâ€¦</a></p>
<p>ï¿½ï¿½å¼€æºæ¨¡å‹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2FByteDance%2FQ-Insight" target="_blank" title="https://huggingface.co/ByteDance/Q-Insight" ref="nofollow noopener noreferrer">huggingface.co/ByteDance/Qâ€¦</a></p>
<p><strong>å›¢é˜Ÿä»‹ç»</strong></p>
<p>å¤šåª’ä½“å®éªŒå®¤æ˜¯å­—èŠ‚è·³åŠ¨æ——ä¸‹çš„ç ”ç©¶å›¢é˜Ÿï¼Œè‡´åŠ›äºæ¢ç´¢å¤šåª’ä½“é¢†åŸŸçš„å‰æ²¿æŠ€æœ¯ï¼Œå‚ä¸å›½é™…æ ‡å‡†åŒ–å·¥ä½œï¼Œå…¶ä¼—å¤šåˆ›æ–°ç®—æ³•åŠè½¯ç¡¬ä»¶è§£å†³æ–¹æ¡ˆå·²ç»å¹¿æ³›åº”ç”¨åœ¨æŠ–éŸ³ã€è¥¿ç“œè§†é¢‘ç­‰äº§å“çš„å¤šåª’ä½“ä¸šåŠ¡ï¼Œå¹¶å‘ç«å±±å¼•æ“çš„ä¼ä¸šçº§å®¢æˆ·æä¾›æŠ€æœ¯æœåŠ¡ã€‚å®éªŒå®¤æˆç«‹ä»¥æ¥ï¼Œå¤šç¯‡è®ºæ–‡å…¥é€‰å›½é™…é¡¶ä¼šå’Œæ——èˆ°æœŸåˆŠï¼Œå¹¶è·å¾—æ•°é¡¹å›½é™…çº§æŠ€æœ¯èµ›äº‹å† å†›ã€è¡Œä¸šåˆ›æ–°å¥–åŠæœ€ä½³è®ºæ–‡å¥–ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HTMLåŸºæœ¬æ ¼å¼ - ç¬¬ä¸€ä¸ªHTMLç½‘é¡µ]]></title>    <link>https://juejin.cn/post/7577439614953635892</link>    <guid>https://juejin.cn/post/7577439614953635892</guid>    <pubDate>2025-11-28T08:08:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577439614953635892" data-draft-id="7577378514401476643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HTMLåŸºæœ¬æ ¼å¼ - ç¬¬ä¸€ä¸ªHTMLç½‘é¡µ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-28T08:08:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GinoWi"/> <meta itemprop="url" content="https://juejin.cn/user/687651121011707"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HTMLåŸºæœ¬æ ¼å¼ - ç¬¬ä¸€ä¸ªHTMLç½‘é¡µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/687651121011707/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GinoWi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T08:08:14.000Z" title="Fri Nov 28 2025 08:08:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><h2 data-id="heading-0">HTMLåŸºæœ¬æ ¼å¼ - ç¬¬ä¸€ä¸ªHTMLç½‘é¡µ</h2>
<h3 data-id="heading-1">ä¸€ã€ç¬¬ä¸€ä¸ªHTMLç½‘é¡µ</h3>
<p><strong>ç¼–å†™ç½‘é¡µçš„æ­¥éª¤ï¼š</strong></p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚</li>
<li>åˆ©ç”¨è®°äº‹æœ¬æ‰“å¼€ã€‚</li>
<li>ç¼–å†™HTMLä»£ç ã€‚</li>
<li>ä¿å­˜å¹¶ä¸”ä¿®æ”¹çº¯æ–‡æœ¬æ–‡æ¡£çš„æ‰©å±•åä¸º.htmlï¼ˆæ–‡ä»¶å‘½åä¸€å®šè¦ä½¿ç”¨è‹±æ–‡ï¼‰ã€‚</li>
<li>åˆ©ç”¨æµè§ˆå™¨æ‰“å¼€ç¼–å†™å¥½çš„æ–‡æ¡£.</li>
</ol>
<p><strong>ä½¿ç”¨HTMLç¼–å†™ç½‘é¡µçš„åŸºæœ¬ç»“æ„ï¼ˆæ ¼å¼ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
 Â  Â  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
 Â <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
 Â <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span> 
 Â <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>HTMLåŸºæœ¬æ ¼å¼ä¸­æ¯ä¸ªæ ‡ç­¾çš„å«ä¹‰ï¼š</strong></p>
<p>é€šè¿‡è§‚å¯Ÿï¼Œå¯ä»¥å‘ç°HTMLåŸºæœ¬ç»“æ„ä¸­ï¼Œæ‰€æœ‰æ ‡ç­¾éƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œè¿™äº›æˆå¯¹å‡ºç°çš„æ ‡ç­¾ä¸­ï¼Œæœ‰ä¸€ä¸ªå¸¦æ–œæ ï¼Œæœ‰ä¸€ä¸ªä¸å¸¦æ–œæ ã€‚</p>
<p>ä¸å¸¦æ–œæ çš„æ ‡ç­¾æ˜¯å¼€å§‹æ ‡ç­¾ï¼Œå¸¦æ–œæ çš„æ ‡ç­¾æ˜¯ç»“æŸæ ‡ç­¾ã€‚</p>
<p><code>html</code>æ ‡ç­¾ï¼š</p>
<ul>
<li>
<p>ä½œç”¨ï¼šç”¨äºå‘Šè¯‰æµè§ˆå™¨è¿™æ˜¯ä¸€ä¸ªç½‘é¡µï¼ˆhtmlæ–‡æ¡£ï¼‰ã€‚</p>
</li>
<li>
<p>æ³¨æ„ç‚¹ï¼šå…¶ä»–æ‰€æœ‰çš„æ ‡ç­¾éƒ½å¿…é¡»å†™åœ¨<code>html</code>æ ‡ç­¾é‡Œé¢ã€‚</p>
</li>
</ul>
<p><code>head</code>æ ‡ç­¾ï¼š</p>
<ul>
<li>
<p>ä½œç”¨ï¼šç”¨äºç»™ç½‘ç«™æ·»åŠ ä¸€äº›é…ç½®ä¿¡æ¯ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨åœºæ™¯ï¼šå¯ä»¥ç»™ç½‘ç«™è§„å®šæ ‡é¢˜ï¼›æŒ‡å®šæ ‡ç­¾é¡µä¸­çš„å°å›¾æ ‡ï¼›è¿˜å¯ä»¥æ·»åŠ ç½‘ç«™SEOç›¸å…³ä¿¡æ¯ï¼ˆæŒ‡å®šç½‘ç«™å…³é”®å­—/æŒ‡å®šç½‘ç«™çš„æè¿°ä¿¡æ¯ï¼‰ï¼›å¤–æŒ‚ä¸€äº›å¤–éƒ¨çš„<code>.css/.js</code>æ–‡ä»¶ï¼›æ·»åŠ ä¸€äº›æµè§ˆå™¨é€‚é…ç›¸å…³çš„å†…å®¹ã€‚</p>
</li>
<li>
<p>æ³¨æ„ç‚¹ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå†™åœ¨<code>head</code>æ ‡ç­¾å½“ä¸­çš„å†…å®¹ï¼Œéƒ½ä¸æ˜¯ç”¨æ¥æ˜¾ç¤ºç»™ç”¨æˆ·æŸ¥çœ‹ã€‚</p>
</li>
</ul>
<p><code>title</code>æ ‡ç­¾ï¼š</p>
<ul>
<li>
<p>ä½œç”¨ï¼šä¸“é—¨ç”¨äºæŒ‡å®šç½‘ç«™çš„æ ‡é¢˜ï¼Œå¹¶ä¸”è¿™ä¸ªæŒ‡å®šçš„æ ‡é¢˜å°†æ¥è¿˜ä¼šä½œä¸ºç”¨æˆ·ä¿å­˜ç½‘ç«™çš„é»˜è®¤æ ‡é¢˜ã€‚</p>
</li>
<li>
<p>æ³¨æ„ç‚¹ï¼š<code>title</code>æ ‡ç­¾å¿…é¡»å†™åœ¨<code>head</code>æ ‡ç­¾é‡Œé¢.</p>
</li>
</ul>
<p><code>body</code>æ ‡ç­¾ï¼š</p>
<ul>
<li>
<p>ä½œç”¨ï¼šä¸“é—¨ç”¨æ¥å®šä¹‰HTMLæ–‡æ¡£ä¸­éœ€è¦æ˜¾ç¤ºç»™ç”¨æˆ·æŸ¥çœ‹çš„å†…å®¹ï¼ˆæ–‡å­—/å›¾ç‰‡/éŸ³é¢‘/è§†é¢‘â€¦â€¦ï¼‰</p>
</li>
<li>
<p>æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>è™½ç„¶æœ‰æ—¶å€™å¯èƒ½å°†å†…å®¹å†™åˆ°äº†åˆ«çš„åœ°æ–¹ï¼Œåœ¨ç½‘é¡µä¸­ä¹Ÿå¯ä»¥æ­£å¸¸å±•ç¤ºï¼Œä½†æ˜¯æœ€å¥½ä¸è¦è¿™æ ·å†™ï¼Œæœ€å¥½å°†ç½‘é¡µéœ€è¦æ˜¾ç¤ºçš„å†…å®¹å†™åœ¨<code>body</code>æ ‡ç­¾é‡Œé¢ã€‚</li>
<li>ä¸€å¯¹<code>html</code>æ ‡ç­¾ä¸­ï¼ˆä¸€ä¸ª<code>&lt;html&gt;</code>å¼€å§‹æ ‡ç­¾å’Œä¸€ä¸ª<code>&lt;/html&gt;</code>ç»“æŸæ ‡ç­¾ä¸­ï¼‰åªèƒ½æœ‰ä¸€å¯¹<code>body</code>æ ‡ç­¾ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">äºŒã€å­—ç¬¦é›†é—®é¢˜</h3>
<p>å½“ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€htmlæ–‡ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå‘ç°ç½‘é¡µå±•ç¤ºçš„å†…å®¹æ˜¯ä¹±ç ï¼Œå¾€å¾€å¯ä»¥é€šè¿‡ä¿®æ”¹æµè§ˆå™¨è®¾ç½®å½“ä¸­çš„å­—ç¬¦é›†é€‰é¡¹ï¼Œå³å¯æ­£ç¡®å±•ç¤ºæƒ³è¦å±•ç¤ºçš„å†…å®¹ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ç»™ç½‘é¡µæŒ‡å®šä¸€ä¸ªé»˜è®¤çš„å­—ç¬¦é›†ï¼Œä½¿ç”¨<code>meta</code>æ ‡ç­¾ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆç½‘é¡µä¼šå‡ºç°ä¹±ç ç°è±¡ï¼Ÿ</strong></p>
<p>å› ä¸ºæˆ‘ä»¬åœ¨ç¼–å†™ç½‘é¡µçš„æ—¶å€™æ²¡æœ‰æŒ‡å®šå­—ç¬¦é›†ã€‚</p>
<p><strong>å¦‚ä½•è§£å†³ä¹±ç ç°è±¡ï¼Ÿ</strong></p>
<p>åœ¨<code>head</code>æ ‡ç­¾å½“ä¸­æ·»åŠ <code>&lt;meta charset = 'GBK' /&gt;</code>ï¼ŒæŒ‡å®šå­—ç¬¦é›†</p>
<p><strong>ä»€ä¹ˆæ˜¯å­—ç¬¦é›†ï¼Ÿ</strong></p>
<p>å­—ç¬¦é›†å°±æ˜¯å­—ç¬¦çš„é›†åˆã€‚ç”±äºä¸åŒå­—ç¬¦é›†ï¼Œå¯¹äºåŒä¸€ä¸ªå­—ç¬¦æ˜ å°„çš„ç¼–ç æ˜¯ä¸åŒçš„ï¼Œæ•…åœ¨æµè§ˆå™¨æ¸²æŸ“çš„æ—¶å€™ï¼Œä½¿ç”¨ç›¸åŒçš„ç¼–ç åˆ°ä¸åŒçš„å­—ç¬¦é›†æŸ¥æ‰¾å­—ç¬¦çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½å‡ºç°ä¹±ç çš„æƒ…å†µã€‚</p>
<p>è€Œæˆ‘ä»¬æŒ‡å®šå­—ç¬¦é›†ï¼Œå°±æ˜¯ä¸ºäº†æ˜ç¡®å‘Šè¯‰æµè§ˆå™¨ï¼Œæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯å“ªä¸ªå­—ç¬¦é›†ï¼Œä¾¿äºæµè§ˆå™¨æ›´å¥½çš„æ˜ å°„ï¼Œæ‰¾åˆ°æ­£ç¡®çš„å­—ç¬¦ã€‚æˆ‘ä»¬å¸¸è§çš„å­—ç¬¦é›†ï¼šGBKã€UTF-8</p>
<p><strong>GBKï¼ˆGB2312ï¼‰å’ŒUTF-8çš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li>GBKï¼ˆGB2312ï¼‰é‡Œé¢å­˜å‚¨çš„å­—ç¬¦æ¯”è¾ƒå°‘ï¼Œä»…ä»…å­˜å‚¨äº†æ±‰å­—å’Œä¸€äº›å¸¸ç”¨çš„å¤–æ–‡ï¼Œä½“ç§¯æ¯”è¾ƒå°ã€‚</li>
<li>UTF-8å­˜å‚¨äº†ä¸–ç•Œä¸Šæ‰€æœ‰çš„å­—ç¬¦ã€‚ä½“ç§¯æ¯”è¾ƒå¤§ã€‚</li>
<li>å¦‚æœç½‘ç«™ä»…ä»…åŒ…å«ä¸­æ–‡ï¼Œæ¨èä½¿ç”¨GB2312ï¼Œå› ä¸ºä½“ç§¯æ›´å°ï¼Œè®¿é—®é€Ÿåº¦æ›´å¿«ï¼›å¦‚æœç½‘ç«™é™¤äº†ä¸­æ–‡ä»¥å¤–ï¼Œè¿˜åŒ…å«äº†å…¶ä»–å›½å®¶çš„è¯­è¨€ï¼Œé‚£ä¹ˆæ¨èä½¿ç”¨UTF-8ã€‚</li>
</ul>
<p><code>meta</code>æ ‡ç­¾ï¼š</p>
<ul>
<li>
<p>ä½œç”¨ï¼šå°±æ˜¯æŒ‡å®šå½“å‰ç½‘é¡µçš„å­—ç¬¦é›†ã€‚</p>
</li>
<li>
<p>æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>åœ¨htmlçš„æ–‡ä»¶ä¸­ï¼ŒæŒ‡å®šçš„å­—ç¬¦é›†å¿…é¡»å’Œä¿å­˜htmlæ–‡ä»¶æ—¶çš„å­—ç¬¦é›†ä¿æŒä¸€è‡´ï¼Œå¦åˆ™è¿˜æ˜¯ä¼šå‡ºç°ä¹±ç ã€‚</li>
<li>ä»…ä»…æŒ‡å®šå­—ç¬¦é›†ä¸ä¸€å®šèƒ½è§£å†³ä¹±ç é—®é¢˜ï¼Œè¿˜éœ€è¦ä¿å­˜æ–‡ä»¶çš„æ—¶å€™ï¼Œæ–‡ä»¶ä¿å­˜æ—¶çš„å­—ç¬¦é›†å’ŒæŒ‡å®šçš„å­—ç¬¦é›†ä¿æŒä¸€è‡´ï¼Œæ‰èƒ½ä¿è¯æ²¡æœ‰ä¹±ç é—®é¢˜ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">ä¸‰ã€æ ‡ç­¾çš„åˆ†ç±»</h3>
<p>åˆ†ç±»ï¼š</p>
<ul>
<li>
<p><strong>å•æ ‡ç­¾</strong>ï¼šåªæœ‰å¼€å§‹æ ‡ç­¾ï¼Œæ²¡æœ‰ç»“æŸæ ‡ç­¾ã€‚</p>
</li>
<li>
<p><strong>åŒæ ‡ç­¾</strong>ï¼šæœ‰å¼€å§‹æ ‡ç­¾å’Œç»“æŸæ ‡ç­¾çš„ã€‚å¸¸è§çš„åŒæ ‡ç­¾ï¼š<code>html</code>ã€<code>body</code>â€¦â€¦</p>
</li>
</ul>
<p>æ ‡ç­¾é—´çš„å…³ç³»ï¼š</p>
<ul>
<li>
<p><strong>å¹¶åˆ—å…³ç³»ï¼ˆå…„å¼Ÿ/å¹³çº§ï¼‰</strong>ï¼šæ¯”å¦‚<code>head</code>å’Œ<code>body</code>æ ‡ç­¾å°±æ˜¯å¹¶åˆ—å…³ç³»ã€‚</p>
</li>
<li>
<p><strong>åµŒå¥—å…³ç³»ï¼ˆçˆ¶å­/ä¸Šä¸‹çº§ï¼‰</strong>ï¼šæ¯”å¦‚<code>head</code>å’Œ<code>title</code>å°±æ˜¯çˆ¶å­å…³ç³»ã€‚</p>
</li>
</ul>
<h3 data-id="heading-4">å››ã€DTDæ–‡æ¡£å£°æ˜</h3>
<p><strong>ä»€ä¹ˆæ˜¯DTDæ–‡æ¡£å£°æ˜ï¼Ÿ</strong></p>
<p>ç”±äºHTMLæœ‰å¾ˆå¤šä¸ªç‰ˆæœ¬è§„èŒƒï¼Œæ¯ä¸ªç‰ˆæœ¬çš„è§„èŒƒä¹‹é—´åˆæœ‰ä¸€å®šçš„å·®å¼‚ï¼Œæ‰€ä»¥ä¸ºäº†è®©æµè§ˆå™¨èƒ½å¤Ÿæ­£ç¡®çš„ç¼–è¯‘ã€è§£æã€æ¸²æŸ“ç½‘é¡µï¼Œæˆ‘ä»¬éœ€è¦åœ¨HTMLæ–‡ä»¶ç¬¬ä¸€è¡Œå‘Šè¯‰æµè§ˆå™¨ï¼Œæˆ‘ä»¬å½“å‰æ˜¯ç”¨å“ªä¸€ä¸ªç‰ˆæœ¬çš„è§„èŒƒæ¥ç¼–å†™çš„ï¼Œæµè§ˆå™¨åªè¦çŸ¥é“äº†æˆ‘ä»¬æ˜¯ä½¿ç”¨å“ªä¸€ä¸ªç‰ˆæœ¬çš„è§„èŒƒç¼–å†™ä¹‹åï¼Œä»–å°±èƒ½æ­£ç¡®çš„ç¼–è¯‘ã€è§£æã€æ¸²æŸ“ç½‘é¡µã€‚</p>
<p><strong>DTDæ–‡æ¡£å£°æ˜çš„æ ¼å¼</strong></p>
<p>æ¯ä¸€ä¸ªä¸åŒç‰ˆæœ¬çš„è§„èŒƒï¼Œéƒ½æœ‰ä¸åŒçš„DTDæ–‡æ¡£å£°æ˜ã€‚å› ä¸ºHTML5çš„DTDæ–‡æ¡£å£°æ˜æ˜¯å‘ä¸‹å…¼å®¹çš„ï¼Œæ‰€ä»¥ä½¿ç”¨HTML5çš„DTDæ–‡æ¡£å£°æ˜å¯ä»¥å…¼å®¹æ¸²æŸ“XHTMLå’ŒHTMLçš„å…¶ä»–ç‰ˆæœ¬ã€‚</p>
<p>æ ¼å¼ï¼š<code>&lt;!DOCTYPE html&gt;</code>æˆ–è€…<code>&lt;!doctype html&gt;</code></p>
<p><strong>DTDæ–‡æ¡£å£°æ˜çš„æ³¨æ„ç‚¹ï¼š</strong></p>
<ul>
<li>ä»»ä½•ä¸€ä¸ªæ ‡å‡†çš„HTMLç½‘é¡µï¼Œç¬¬ä¸€è¡Œä¸€å®šæ˜¯DTDæ–‡æ¡£å£°æ˜ï¼Œä¹Ÿå°±æ˜¯è¯´DTDæ–‡æ¡£å£°æ˜å¿…é¡»å†™åœ¨HTMLç½‘é¡µç¬¬ä¸€è¡Œã€‚</li>
<li>DTDæ–‡æ¡£å£°æ˜ä¸åŒºåˆ†å¤§å°å†™ã€‚</li>
<li>DTDæ–‡æ¡£å£°æ˜ä¸æ˜¯ä¸€ä¸ªæ ‡ç­¾ã€‚</li>
<li>è™½ç„¶DTDæ–‡æ¡£å£°æ˜çš„ä½œç”¨æ˜¯å‘Šè¯‰æµè§ˆå™¨ï¼Œæˆ‘ä»¬è¿™ä¸ªç½‘é¡µä½¿ç”¨å“ªä¸ªç‰ˆæœ¬èµ„æºç¼–å†™ï¼Œä»¥ä¾¿äºæ–¹ä¾¿æµè§ˆå™¨è§£æå’Œæ¸²æŸ“ï¼Œä½†æ˜¯æµè§ˆå™¨å¹¶ä¸ä¼šå®Œå…¨ä¾èµ–DTDæ–‡æ¡£å£°æ˜ï¼Œæµè§ˆå™¨æœ‰ä¸€å¥—è‡ªå·±çš„æœºåˆ¶ã€‚æ•…DTDæ–‡æ¡£å£°æ˜ä¸å†™ç½‘é¡µä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯æ ¹æ®è§„èŒƒï¼Œæˆ‘ä»¬ä»éœ€åœ¨ç¬¬ä¸€è¡Œè¿›è¡Œå£°æ˜ã€‚</li>
</ul>
<p><strong>å…¶ä»–DTDæ–‡æ¡£å£°æ˜è§„èŒƒï¼š</strong></p>
<p>HTML5ä¹‹å‰æœ‰2å¤§ç§è§„èŒƒ, æ¯ç§è§„èŒƒä¸­åˆæœ‰3å°ç§è§„èŒƒ</p>

































<table><thead><tr><th>å¤§è§„èŒƒ</th><th>å°è§„èŒƒ</th></tr></thead><tbody><tr><td>HTML</td><td>Strict (ä¸¥æ ¼çš„)</td></tr><tr><td>HTML</td><td>Transitional(è¿‡åº¦çš„,æ™®é€šçš„,å®½æ¾çš„)</td></tr><tr><td>HTML</td><td>Frameset(å¸¦æœ‰æ¡†æ¶çš„é¡µé¢)</td></tr><tr><td>XHTML</td><td>Strict (ä¸¥æ ¼çš„)</td></tr><tr><td>XHTML</td><td>Transitional(è¿‡åº¦çš„,æ™®é€šçš„,å®½æ¾çš„)</td></tr><tr><td>XHTML</td><td>Frameset(å¸¦æœ‰æ¡†æ¶çš„é¡µé¢)</td></tr></tbody></table>
<ul>
<li>
<p>HTMLçš„DTDæ–‡æ¡£å£°æ˜å’ŒXHTMLçš„DTDæ–‡æ¡£å£°æ˜æœ‰ä½•åŒºåˆ«?</p>
<ul>
<li>XHTMLæœ¬èº«è§„å®šæ¯”å¦‚æ ‡ç­¾å¿…é¡»å°å†™ã€å¿…é¡»ä¸¥æ ¼é—­åˆã€å¿…é¡»ä½¿ç”¨å¼•å·å¼•èµ·å±æ€§ç­‰ç­‰, è€ŒHTMLä¼šæ›´åŠ æ¾æ•£æ²¡æœ‰è¿™ä¹ˆä¸¥æ ¼ã€‚</li>
</ul>
</li>
<li>
<p>ä»€ä¹ˆæ˜¯å°è§„èŒƒï¼Ÿ</p>
<ul>
<li>
<p>Strictè¡¨ç¤ºä¸¥æ ¼çš„, è¿™ç§æ¨¡å¼é‡Œé¢çš„è¦æ±‚æ›´ä¸ºä¸¥æ ¼.è¿™ç§ä¸¥æ ¼ä¸»è¦ä½“ç°åœ¨æœ‰ä¸€äº›ç”¨äºä¿®æ”¹æ–‡æœ¬æ ·å¼çš„æ ‡ç­¾ä¸èƒ½ä½¿ç”¨ï¼Œä¾‹å¦‚fontæ ‡ç­¾/uæ ‡ç­¾ç­‰</p>
</li>
<li>
<p>Transitionalè¡¨ç¤ºæ™®é€šçš„, è¿™ç§æ¨¡å¼æ˜¯æ²¡æœ‰ä¸€äº›åˆ«çš„è¦æ±‚ï¼Œä¾‹å¦‚å¯ä»¥ä½¿ç”¨fontæ ‡ç­¾ã€uæ ‡ç­¾ç­‰</p>
</li>
<li>
<p>Framesetè¡¨ç¤ºæ¡†æ¶, åœ¨æ¡†æ¶çš„é¡µé¢ä½¿ç”¨</p>
</li>
</ul>
</li>
</ul>
<p><strong>å¸¸è§çš„DTDæ–‡æ¡£å£°æ˜ï¼š</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- HTML4.01 --&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">HTML</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span>
<span class="hljs-string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span>
â€‹
<span class="hljs-comment">&lt;!-- XHTML 1.0 --&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span>
<span class="hljs-string">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span>&gt;</span>
â€‹
<span class="hljs-comment">&lt;!-- HTML5 --&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">äº”ã€HTMLã€XHTMLå’ŒHTML5çš„åŒºåˆ«</h3>
<ul>
<li>HTMLè¯­æ³•éå¸¸å®½æ¾å®¹é”™æ€§å¼ºã€‚</li>
<li>XHTMLæ›´ä¸ºä¸¥æ ¼ï¼Œä»–è¦æ±‚æ ‡ç­¾å¿…é¡»å°å†™ï¼Œå¿…é¡»ä¸¥æ ¼é—­åˆï¼Œæ ‡é¢˜ä¸­çš„å±æ€§å¿…é¡»ä½¿ç”¨å¼•å·ã€‚</li>
<li>HTML5æ˜¯HTMLçš„ä¸‹ä¸€ä¸ªç‰ˆæœ¬æ‰€ä»¥é™¤äº†éå¸¸å®½æ¾å®¹é”™æ€§å¼ºä»¥å¤–ï¼Œè¿˜å¢åŠ è®¸å¤šæ–°çš„ç‰¹æ€§ã€‚</li>
</ul>
<h3 data-id="heading-6">å…­ã€.htmå’Œ.htmlçš„åŒºåˆ«</h3>
<p>DOSç³»ç»Ÿåªå…è®¸åç¼€åæœ‰ä¸‰ä½ï¼Œä½†æ˜¯åæ¥Windowsæ”¯æŒåç¼€åæœ‰å››ä½ï¼Œæœ¬è´¨å¹¶æ— å…¶ä»–åŒºåˆ«ã€‚</p>
<p><strong>å‚è€ƒé“¾æ¥ï¼š</strong></p>
<p>W3Schoolå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3school.com.cn%2F" target="_blank" title="https://www.w3school.com.cn/" ref="nofollow noopener noreferrer">www.w3school.com.cn</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«ç”¨â€œè®¾è®¡æ„Ÿâ€æ©ç›–æ— çŸ¥ï¼šä»ä¸€æ¬¡ null == 0 çš„äº‹æ•…è¯´èµ·]]></title>    <link>https://juejin.cn/post/7577345758036475904</link>    <guid>https://juejin.cn/post/7577345758036475904</guid>    <pubDate>2025-11-28T08:26:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577345758036475904" data-draft-id="7577356848337977379" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«ç”¨â€œè®¾è®¡æ„Ÿâ€æ©ç›–æ— çŸ¥ï¼šä»ä¸€æ¬¡ null == 0 çš„äº‹æ•…è¯´èµ·"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-28T08:26:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç™½æ°”æ€¥"/> <meta itemprop="url" content="https://juejin.cn/user/3855363959685260"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«ç”¨â€œè®¾è®¡æ„Ÿâ€æ©ç›–æ— çŸ¥ï¼šä»ä¸€æ¬¡ null == 0 çš„äº‹æ•…è¯´èµ·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3855363959685260/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç™½æ°”æ€¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T08:26:44.000Z" title="Fri Nov 28 2025 08:26:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>é‚£å¤©ä¸‹åˆï¼Œæˆ‘ç›¯ç€ä¸€è¡Œå†æ™®é€šä¸è¿‡çš„ä»£ç ï¼Œè¶³è¶³æ„£äº†ä¸‰åˆ†é’Ÿï¼š</p>
<pre><code class="hljs language-C#" lang="C#"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">value</span>.Equals(<span class="hljs-literal">null</span>)) 
{
 Â  Â <span class="hljs-comment">// è¿™è¡Œå±…ç„¶æ‰§è¡Œäº†ï¼Ÿï¼</span>
}
</code></pre>
<p><code>value</code> æ˜¯ä¸€ä¸ª <code>Value</code> ç±»å‹çš„å¯¹è±¡ï¼Œæ„é€ æ—¶ä¼ å…¥çš„æ˜¯æ•´æ•° <code>0</code>â€”â€”å®ƒæ˜æ˜ä¸æ˜¯ <code>null</code>ã€‚è°ƒè¯•å™¨é‡Œå­—æ®µæ­£å¸¸ï¼Œå†…å­˜åœ°å€ä¹Ÿæ¸…æ¸…æ¥šæ¥šã€‚å¯ <code>.Equals(null)</code> å´è¿”å›äº† <code>true</code>ã€‚è¿™å·²ç»ä¸æ˜¯â€œå¥‡æ€ªâ€äº†ï¼Œè¿™æ˜¯åœ¨æŒ‘æˆ˜æˆ‘å¯¹ç¼–ç¨‹è¯­è¨€çš„åŸºæœ¬ä¿¡ä»»ã€‚</p>
<p>å¸¦ç€ä¸€ä¸ä¸å®‰ï¼Œæˆ‘ç‚¹è¿›äº† <code>Value.Equals</code>ï¼š</p>
<pre><code class="hljs language-C#" lang="C#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Value</span> : <span class="hljs-title">XXObject</span>, <span class="hljs-title">IObject</span>
{
 Â  Â <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> obj</span>)</span>
    {
 Â       <span class="hljs-keyword">return</span> <span class="hljs-keyword">base</span>.Equals(obj);
    }
}
</code></pre>
<p>å“¦ï¼Œå®ƒè‡ªå·±æ²¡å®ç°ï¼Œç›´æ¥ç”©é”…ç»™çˆ¶ç±» <code>XXObject</code>ã€‚é‚£å°±ç»§ç»­è¿½</p>
<pre><code class="hljs language-C#" lang="C#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">XXObject</span> : <span class="hljs-title">IObject</span>
{
 Â  Â <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params"><span class="hljs-built_in">object</span>? obj</span>)</span>
    {
 Â       <span class="hljs-keyword">return</span> XXEquals.Equals(_value, obj);
    }
}
</code></pre>
<p>çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘å¿ƒé‡Œå’¯å™”ä¸€ä¸‹ï¼š <strong>ä¸ºä»€ä¹ˆä¸€ä¸ª <code>Equals</code> è¦å§”æ‰˜ç»™é™æ€ç±»ï¼Ÿ</strong> <strong>ä¸ºä»€ä¹ˆ <code>Value</code> å’Œ <code>XXObject</code> éƒ½è¦å®ç°åŒä¸€ä¸ªæ¥å£ <code>IObject</code>ï¼Ÿ</strong> æ„Ÿè§‰å°±æ˜¯è¿‡åº¦æŠ½è±¡+é™æ€å·¥å…·æ»¥ç”¨</p>
<p>ä½† debug ä¸èƒ½åœã€‚æˆ‘ç¡¬ç€å¤´çš®ç‚¹è¿› <code>XXEquals.Equals</code>ï¼Œçœ¼å‰å‡ºç°äº†ä¸€æ®µå ªç§°â€œå²è¯—çº§è½®å­â€çš„ switch å¤§æ³•ï¼š</p>
<pre><code class="hljs language-C#" lang="C#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> <span class="hljs-keyword">value</span>, <span class="hljs-built_in">object</span>? obj</span>)</span>
{
 Â  Â <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">is</span> IObject _obj)
 Â   {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> Equals(<span class="hljs-keyword">value</span>, _obj.GetValue());
 Â   }
 Â  Â <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">value</span>)
    {
â€‹
 Â  Â  Â  Â <span class="hljs-keyword">case</span> <span class="hljs-built_in">int</span> v:
 Â       {
 Â  Â  Â       <span class="hljs-keyword">return</span> obj <span class="hljs-keyword">switch</span>
 Â  Â  Â       {
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-built_in">byte</span> v2 =&gt; v == v2,
 Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-built_in">short</span> v2 =&gt; v == v2,
 Â  Â  Â  Â  Â       <span class="hljs-comment">// ... çœç•¥ä¸€å †ç±»å‹</span>
 Â  Â  Â  Â  Â       _ =&gt; v == XXConvert.ToInt(obj)
 Â  Â  Â       };
 Â   }
}
</code></pre>
<p>é—®é¢˜å°±å‡ºåœ¨æœ€åé‚£ä¸ªå…œåº•åˆ†æ”¯ï¼š<code>XXConvert.ToInt(obj)</code>ã€‚ å½“ <code>obj</code> æ˜¯ <code>null</code> æ—¶ï¼Œå®ƒå±…ç„¶æ²¡æœ‰æŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯.....è¿”å›äº† <code>0</code>ï¼Ÿ</p>
<p>æˆ‘é¢¤æŠ–ç€æ‰‹ç‚¹è¿›å»ï¼š</p>
<pre><code class="hljs language-C#" lang="C#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> <span class="hljs-title">ToInt</span>(<span class="hljs-params"><span class="hljs-built_in">object</span>? obj, <span class="hljs-built_in">int</span> def = <span class="hljs-literal">default</span></span>)</span>
{
 Â  Â <span class="hljs-keyword">return</span> ToIntNull(obj) ?? def;
}
</code></pre>
<p>è€Œ <code>def</code> çš„é»˜è®¤å€¼æ˜¯ <code>default(int)</code>ï¼Œä¹Ÿå°±æ˜¯ <code>0</code>ã€‚ æ‰€ä»¥ <code>ToInt(null)</code> â†’ <code>ToIntNull(null)</code> è¿”å› <code>null</code> â†’ <code>?? 0</code> â†’ æœ€ç»ˆå¾—åˆ° <code>0</code>ã€‚</p>
<p>äºæ˜¯æ•´ä¸ªé“¾æ¡é—­ç¯äº†ï¼š</p>
<ul>
<li><code>value.Equals(null)</code></li>
<li>â†’ <code>XXEquals.Equals(0, null)</code></li>
<li>â†’ <code>0 == XXConvert.ToInt(null)</code></li>
<li>â†’ <code>0 == 0</code></li>
<li>â†’ <strong><code>true</code></strong></li>
</ul>
<p>é‚£ä¸€åˆ»ï¼Œæˆ‘æ‚¬ç€çš„å¿ƒç»ˆäºæ­»äº†ï¼š</p>
<p><strong>è¿™ä¸æ˜¯ bugï¼Œè¿™æ˜¯ä¸€ä¸ªè‡ªä»¥ä¸ºâ€œé€šç”¨â€çš„è½®å­ï¼Œåœ¨ç”¨ä¸€å¥—çœ‹ä¼¼åˆç†å®åˆ™è’è°¬çš„é€»è¾‘ï¼Œç³»ç»Ÿæ€§åœ°è·µè¸è¯­è¨€æœ€åŸºæœ¬çš„å¥‘çº¦ã€‚</strong></p>
<p>å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œåœ¨ .NETï¼ˆC# 7.0+ï¼‰ä¸­ï¼Œæˆ‘ä»¬<strong>ä¸éœ€è¦ä¾èµ–å¯èƒ½è¢«é‡å†™çš„ <code>Equals</code> æˆ– <code>==</code> æ¥åˆ¤æ–­ null</strong>ã€‚ å®˜æ–¹æ—©å·²æä¾›äº†ä¸€ç§<strong>è¯­ä¹‰æ˜ç¡®ã€æ— æ³•è¢«ç¯¡æ”¹</strong>çš„ null æ£€æŸ¥æ–¹å¼</p>
<pre><code class="hljs language-C#" lang="C#"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">value</span> <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span>)
{
 Â  Â <span class="hljs-comment">// ä¸­</span>
}
</code></pre>
<p>æ‰€ä»¥ï¼Œå³ä½¿åº•å±‚æœ‰äººé€ äº†â€œnull è½¬ 0â€çš„è½®å­ï¼Œåªè¦ä¸Šå±‚ç”¨ <code>is null</code>ï¼Œå°±èƒ½å…ç–«è¿™ç±»é™é»˜é”™è¯¯</p>
<p>ä½†è¿™åªæ˜¯â€œæ­¢è¡€â€ï¼Œä¸æ˜¯â€œæ²»ç—…â€</p>
<p>è™½ç„¶ <code>is null</code> èƒ½è®©æˆ‘ä»¬æš‚æ—¶é¿å¼€é™·é˜±ï¼Œä½†é—®é¢˜çš„æ ¹æºä¾ç„¶å­˜åœ¨</p>
<h3 data-id="heading-0">åˆ«ç”¨â€œè®¾è®¡â€æ©ç›–æ— çŸ¥</h3>
<p>è¯´å®è¯ï¼Œçœ‹åˆ° <code>XXConvert.ToInt(null)</code> è¿”å› <code>0</code> çš„é‚£ä¸€åˆ»ï¼Œæˆ‘æ°”ç¬‘äº†</p>
<p>ä¸æ˜¯å› ä¸ºä»£ç å¤æ‚ï¼Œè€Œæ˜¯å› ä¸º<strong>è¿™ç§è®¾è®¡é€éœ²å‡ºä¸€ç§ä»¤äººä¸å®‰çš„å‚²æ…¢</strong>ï¼š</p>
<blockquote>
<p>â€œæˆ‘çŸ¥é“ç”¨æˆ·å¯èƒ½ä¼šä¼  <code>null</code>ï¼Œä½†æˆ‘ä¸æƒ³è®©ä»–ä»¬å¤„ç†å¼‚å¸¸â€”â€”æˆ‘æ›¿ä»–ä»¬â€˜æ™ºèƒ½â€™åœ°å¤„ç†æˆé»˜è®¤å€¼ã€‚â€</p>
</blockquote>
<p>å¬èµ·æ¥å¾ˆè´´å¿ƒï¼Ÿä¸ï¼Œè¿™æ˜¯<strong>å¯¹è¯­ä¹‰çš„èƒŒå›</strong>ã€‚</p>
<p>åœ¨å‡ ä¹æ‰€æœ‰ä¸»æµç¼–ç¨‹è¯­è¨€ä¸­ï¼Œ<code>null</code> éƒ½ä»£è¡¨â€œæ— å€¼â€ã€â€œç¼ºå¤±â€ã€â€œæœªåˆå§‹åŒ–â€ã€‚è€Œ <code>0</code> æ˜¯ä¸€ä¸ª<strong>æ˜ç¡®çš„ã€æœ‰æ•ˆçš„å€¼</strong>ã€‚æŠŠâ€œæ— â€ç­‰åŒäºâ€œé›¶â€ï¼Œå°±åƒæŠŠâ€œæ²¡äººæ¥å¼€ä¼šâ€ç†è§£æˆâ€œæ¥äº†ä¸€ä¸ªäººï¼Œä»–å«å¼ ä¸‰ï¼ŒèŒä½æ˜¯ 0 å·å‘˜å·¥â€ä¸€æ ·è’è°¬ã€‚</p>
<p>æ›´å¯æ€•çš„æ˜¯ï¼Œè¿™ç§â€œæ™ºèƒ½â€è¢«åŒ…è£…åœ¨ä¸‰å±‚æŠ½è±¡ä¹‹ä¸‹ï¼š</p>
<ul>
<li>æ¥å£ <code>IObject</code>ï¼ˆçœ‹ä¼¼è§„èŒƒï¼‰</li>
<li>åŸºç±» <code>XXObject</code>ï¼ˆçœ‹ä¼¼å¤ç”¨ï¼‰</li>
<li>é™æ€å·¥å…·ç±» <code>XXEquals</code> + <code>XXConvert</code>ï¼ˆçœ‹ä¼¼è§£è€¦ï¼‰</li>
</ul>
<p>ç»“æœå‘¢ï¼Ÿ<strong>è§£è€¦ä¸è§£ç¥¸ï¼Œå°è£…ä¸å°é”™</strong>ã€‚ æ‰€æœ‰è°ƒç”¨è€…éƒ½è¢«è’™åœ¨é¼“é‡Œï¼Œç›´åˆ°æŸå¤©æŸä¸ª <code>if (obj.Equals(null))</code> çªç„¶èµ°é”™åˆ†æ”¯ï¼Œç³»ç»Ÿåœ¨é™é»˜ä¸­èµ°å‘å´©æºƒã€‚</p>
<hr/>
<p>è¿™ä»¶äº‹è®©æˆ‘æ„è¯†åˆ°ï¼š <strong>æ‰€è°“ä¸“ä¸šï¼Œä¸æ˜¯ä½ ä¼šé€ å¤šå¤æ‚çš„è½®å­ï¼Œè€Œæ˜¯ä½ æ¸…æ¥šå“ªäº›è¾¹ç•Œç»ä¸èƒ½ç¢°â€”â€”æ¯”å¦‚ç›¸ç­‰æ€§ã€ç©ºå€¼è¯­ä¹‰ã€ç±»å‹å®‰å…¨è¿™äº›è®¾è®¡åº•çº¿ã€‚</strong></p>
<p>åœ¨è¿™ä¸ªè¡Œä¸šï¼Œ<strong>æœ€æ˜‚è´µçš„è½®å­ï¼Œä»æ¥ä¸æ˜¯é‡å¤é€ çš„ï¼Œè€Œæ˜¯é€ æ­ªäº†è¿˜è£…ä¸Šè½¦çš„</strong>ã€‚</p>
<blockquote>
<p><strong>ç‰ˆæƒå£°æ˜</strong>ï¼šæœ¬æ–‡ä¸ºä¸ªäººåŸåˆ›ï¼Œé¦–å‘äºå¾®ä¿¡å…¬ä¼—å·ã€æ˜é‡‘å¹³å°ã€åšå®¢å›­ï¼Œä½œè€…å‡ä¸ºã€Œç™½æ°”æ€¥ã€ã€‚è½¬è½½è¯·æ ‡æ˜å‡ºå¤„å¹¶é™„å¸¦é“¾æ¥ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Astro é¡¹ç›®å‡çº§å…¨æ ˆï¼šEdgeOne Pages éƒ¨ç½²æŒ‡å—]]></title>    <link>https://juejin.cn/post/7577395040593330186</link>    <guid>https://juejin.cn/post/7577395040593330186</guid>    <pubDate>2025-11-28T08:17:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577395040593330186" data-draft-id="7577668116500430886" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Astro é¡¹ç›®å‡çº§å…¨æ ˆï¼šEdgeOne Pages éƒ¨ç½²æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-28T08:17:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¡¶é²œèŠ±çš„ç‰›ç²ª"/> <meta itemprop="url" content="https://juejin.cn/user/2049145403352205"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Astro é¡¹ç›®å‡çº§å…¨æ ˆï¼šEdgeOne Pages éƒ¨ç½²æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2049145403352205/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¡¶é²œèŠ±çš„ç‰›ç²ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T08:17:46.000Z" title="Fri Nov 28 2025 08:17:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯ä»‹ç»</h2>
<p>æœ€è¿‘ç”¨è…¾è®¯äº‘çš„ EdgeOne Pages ï¼ˆä¸‹æ–‡ç§° Pagesï¼‰éƒ¨ç½²äº†ä¸ªäººç«™ç‚¹ï¼Œè®°å½•ä¸€ä¸‹ä» SSG å‡çº§åˆ° SSR çš„è¿‡ç¨‹ã€‚Pages æ˜¯è…¾è®¯äº‘æ¨å‡ºçš„ç½‘ç«™æ‰˜ç®¡æœåŠ¡ï¼Œæ”¯æŒ SSR å’Œè¾¹ç¼˜å‡½æ•°ï¼Œå›½å†…è®¿é—®ç¨³å®šæ€§ç›¸æ¯”è€Œè¨€ä¼šæ›´å¥½ä¸€ç‚¹ã€‚Astro æ˜¯ä¸€ä¸ª"å†…å®¹ä¼˜å…ˆ"çš„ç°ä»£ Web æ¡†æ¶ï¼Œç‰¹åˆ«é€‚åˆåšå®¢ã€æ–‡æ¡£ç­‰å†…å®¹å‹ç½‘ç«™ï¼Œé»˜è®¤è¾“å‡ºé›¶ JavaScript çš„é™æ€ HTMLï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ SSR æ¨¡å¼ã€‚æˆ‘çš„ä¸ªäººåšå®¢å°±æ˜¯ä½¿ç”¨çš„ Pages è¿›è¡Œæ‰˜ç®¡ï¼ŒPages ä¹‹å‰åªæ”¯æŒ SSG æ¨¡å¼ï¼Œå¯¹åˆæœŸæ¥è¯´æˆ‘çš„ç«™ç‚¹å®Œå…¨å¤Ÿç”¨äº†ï¼Œä½†éšç€ç½‘ç«™å†…å®¹å¢å¤šã€è®¿é—®é‡ä¸Šå‡ï¼Œæˆ‘å¸Œæœ›é€šè¿‡ SSR è·å¾—æ›´å¥½çš„ SEO æ•ˆæœã€‚åˆšå¥½æœ€è¿‘çœ‹åˆ° Pages æ”¯æŒäº† Astro çš„ SSR æ¨¡å¼ï¼Œæ­£å¥½å€Ÿæ­¤æœºä¼šå‡çº§å¹¶è®°å½•å®è·µè¿‡ç¨‹ã€‚</p>
<h2 data-id="heading-1">åŸºæœ¬ä¿¡æ¯</h2>
<p><strong>ç¤ºä¾‹é¡¹ç›®</strong></p>
<p>æœ¬æ–‡ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnuonuo-888%2Fportfolio-sofidev-garrux" target="_blank" title="https://github.com/nuonuo-888/portfolio-sofidev-garrux" ref="nofollow noopener noreferrer">demo-portfolio</a> é¡¹ç›®ä½œä¸ºç¤ºä¾‹ï¼Œä¸€ä¸ªåŸºäº Astro çš„ä¸ªäººä½œå“é›†ç½‘ç«™ã€‚é¡¹ç›® fork è‡ªåŸä½œè€…ä»“åº“ï¼Œæˆ‘å¯¹å…¶è¿›è¡Œäº† Astro ç‰ˆæœ¬å‡çº§å’Œ bug ä¿®å¤ï¼Œä»¥æ›´å¥½åœ°é€‚é… Pages çš„ SSR æ¨¡å¼ï¼ˆæ¬¢è¿ç»™åŸä½œè€… starï¼‰ã€‚</p>
<p><strong>Astro é€‚é…å™¨</strong></p>
<p>é€‚é…å™¨ï¼ˆAdapterï¼‰æ˜¯ Astro ç”¨äºé€‚é…ä¸åŒéƒ¨ç½²å¹³å°çš„æ’ä»¶ï¼Œè´Ÿè´£å°†é¡¹ç›®è½¬æ¢ä¸ºç›®æ ‡å¹³å°æ‰€éœ€çš„æ ¼å¼ã€‚Pages æä¾›äº†å®˜æ–¹é€‚é…å™¨ <code>@edgeone/astro</code>ï¼Œæ”¯æŒåœ¨è¾¹ç¼˜è®¡ç®—ç¯å¢ƒä¸­è¿è¡Œ SSR æ¨¡å¼ã€‚</p>
<p><strong>Pages è„šæ‰‹æ¶</strong></p>
<p>Pages æä¾›å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡ <code>npm install edgeone -g</code> å®‰è£…ï¼Œæ”¯æŒé¡¹ç›®åˆå§‹åŒ–ã€æœ¬åœ°è°ƒè¯•å’Œä¸€é”®éƒ¨ç½²ã€‚</p>
<h2 data-id="heading-2">å®è·µè¿‡ç¨‹</h2>
<h3 data-id="heading-3">é¡¹ç›®å‡†å¤‡</h3>
<p>é¦–å…ˆä» GitHub ä¸‹è½½ç¤ºä¾‹é¡¹ç›®åˆ°æœ¬åœ°ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/nuonuo-888/portfolio-sofidev-garrux
<span class="hljs-built_in">cd</span> portfolio-sofidev-garrux
npm install
</code></pre>
<h3 data-id="heading-4">é¡¹ç›®é…ç½®</h3>
<p><strong>åŸå§‹ SSG æ¨¡å¼</strong></p>
<p>é¡¹ç›®çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶æ˜¯ <code>astro.config.mjs</code>ï¼Œä½¿ç”¨ SSG æ¨¡å¼æ—¶çš„é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">"astro/config"</span>;
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">"@astrojs/react"</span>;
<span class="hljs-keyword">import</span> tailwind <span class="hljs-keyword">from</span> <span class="hljs-string">"@astrojs/tailwind"</span>;
<span class="hljs-keyword">import</span> sitemap <span class="hljs-keyword">from</span> <span class="hljs-string">"@astrojs/sitemap"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">site</span>: <span class="hljs-string">"https://examples.com/"</span>, <span class="hljs-comment">// ç½‘ç«™çš„éƒ¨ç½²URLï¼Œç”¨äºç”Ÿæˆsitemapå’ŒRSS</span>
  <span class="hljs-attr">output</span>: <span class="hljs-string">"static"</span>, <span class="hljs-comment">// è¾“å‡ºæ¨¡å¼ï¼šstaticè¡¨ç¤ºé™æ€ç«™ç‚¹ç”Ÿæˆ(SSG)</span>
  <span class="hljs-attr">integrations</span>: [<span class="hljs-title function_">react</span>(), <span class="hljs-title function_">tailwind</span>(), <span class="hljs-title function_">sitemap</span>()], <span class="hljs-comment">// é›†æˆæ’ä»¶ï¼šReactç»„ä»¶æ”¯æŒã€Tailwind CSSã€ç«™ç‚¹åœ°å›¾ç”Ÿæˆ</span>
});
</code></pre>
<p>ä½¿ç”¨ <code>npm run build</code> æ„å»ºåï¼Œä¼šåœ¨ <code>dist/</code> ç›®å½•ç”Ÿæˆä»¥ä¸‹ç»“æ„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">dist/
â”œâ”€â”€ _astro/              <span class="hljs-comment"># Astro æ„å»ºç”Ÿæˆçš„èµ„æºæ–‡ä»¶</span>
â”œâ”€â”€ 404.html            <span class="hljs-comment"># 404 é”™è¯¯é¡µé¢</span>
â”œâ”€â”€ about/              <span class="hljs-comment"># å…³äºé¡µé¢</span>
â”œâ”€â”€ assets/             <span class="hljs-comment"># é™æ€èµ„æºæ–‡ä»¶ï¼ˆSVG å›¾æ ‡ï¼‰</span>
â”œâ”€â”€ blog/               <span class="hljs-comment"># åšå®¢æ–‡ç« ç›®å½•</span>
â”œâ”€â”€ docs/               <span class="hljs-comment"># æ–‡æ¡£æ–‡ä»¶</span>
â”œâ”€â”€ img/                <span class="hljs-comment"># å›¾ç‰‡èµ„æº</span>
â”œâ”€â”€ index.html          <span class="hljs-comment"># é¦–é¡µ</span>
â”œâ”€â”€ favicon.svg         <span class="hljs-comment"># ç½‘ç«™å›¾æ ‡</span>
â”œâ”€â”€ sitemap-0.xml       <span class="hljs-comment"># ç«™ç‚¹åœ°å›¾æ–‡ä»¶</span>
â””â”€â”€ sitemap-index.xml   <span class="hljs-comment"># ç«™ç‚¹åœ°å›¾ç´¢å¼•</span>
</code></pre>
<p>è¿™äº›æ–‡ä»¶å¯ä»¥ç›´æ¥éƒ¨ç½²åˆ°ä»»ä½•é™æ€æ‰˜ç®¡æœåŠ¡ï¼ˆå¦‚ CDNã€å¯¹è±¡å­˜å‚¨ï¼‰ï¼Œæ— éœ€æœåŠ¡å™¨è¿è¡Œæ—¶æ”¯æŒã€‚</p>
<p><strong>å‡çº§ä¸º SSR æ¨¡å¼</strong></p>
<p>ç°åœ¨æˆ‘ä»¬å°†é¡¹ç›®ä» SSG æ¨¡å¼å‡çº§ä¸º SSR æ¨¡å¼ã€‚é¦–å…ˆéœ€è¦å®‰è£… Pages çš„é€‚é…å™¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install @edgeone/astro
</code></pre>
<p>ç„¶åä¿®æ”¹ <code>astro.config.mjs</code> é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">"astro/config"</span>;
<span class="hljs-keyword">import</span> edgeone <span class="hljs-keyword">from</span> <span class="hljs-string">"@edgeone/astro"</span>; <span class="hljs-comment">// å¼•å…¥EdgeOneé€‚é…å™¨</span>
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">"@astrojs/react"</span>;
<span class="hljs-keyword">import</span> tailwind <span class="hljs-keyword">from</span> <span class="hljs-string">"@astrojs/tailwind"</span>;
<span class="hljs-keyword">import</span> sitemap <span class="hljs-keyword">from</span> <span class="hljs-string">"@astrojs/sitemap"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">site</span>: <span class="hljs-string">"https://examples.com/"</span>,
  <span class="hljs-attr">output</span>: <span class="hljs-string">"server"</span>, <span class="hljs-comment">// ä» 'static' æ”¹ä¸º 'server' å¯ç”¨SSR</span>
  <span class="hljs-attr">adapter</span>: <span class="hljs-title function_">edgeone</span>(), <span class="hljs-comment">// é…ç½®EdgeOneé€‚é…å™¨</span>
  <span class="hljs-attr">integrations</span>: [<span class="hljs-title function_">react</span>(), <span class="hljs-title function_">tailwind</span>(), <span class="hljs-title function_">sitemap</span>()],
});
</code></pre>
<p>å‡çº§ä¸º SSR æ¨¡å¼éœ€è¦ä¿®æ”¹ä¸¤ä¸ªé…ç½®ï¼šå°† <code>output</code> ä» <code>'static'</code> æ”¹ä¸º <code>'server'</code> æ¥å¯ç”¨æœåŠ¡ç«¯æ¸²æŸ“ï¼Œä»¥åŠæ·»åŠ  <code>adapter: edgeone()</code> æ¥é…ç½® EdgeOne é€‚é…å™¨ã€‚</p>
<p>é…ç½®å®Œæˆåï¼Œæ‰§è¡Œæ„å»ºå‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm run build
</code></pre>
<p>æ„å»ºå®Œæˆåä¼šåœ¨ <code>.edgeone/</code> ç›®å½•ç”Ÿæˆä»¥ä¸‹ç»“æ„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">.edgeone/
â”œâ”€â”€ assets/                    <span class="hljs-comment"># é™æ€èµ„æºæ–‡ä»¶</span>
â””â”€â”€ server-handler/            <span class="hljs-comment"># æœåŠ¡å™¨ç«¯å¤„ç†æ–‡ä»¶</span>
</code></pre>
<p>å…¶ä¸­ <code>assets/</code> ç›®å½•åŒ…å«æ‰€æœ‰é™æ€æ–‡ä»¶ï¼ˆCSSã€JSã€å›¾ç‰‡ç­‰ï¼‰ï¼Œ<code>server-handler/</code> ç›®å½•åŒ…å«æœåŠ¡ç«¯æ¸²æŸ“ä»£ç ï¼Œç”¨äºåœ¨ Pages è¾¹ç¼˜èŠ‚ç‚¹ä¸ŠåŠ¨æ€å¤„ç†è¯·æ±‚å’Œæ¸²æŸ“é¡µé¢ã€‚</p>
<p>æ„å»ºäº§ç‰©ä¹‹æ‰€ä»¥ç”Ÿæˆåˆ° <code>.edgeone/</code> ç›®å½•ï¼Œæ˜¯å› ä¸ºé€‚é…å™¨çš„ä½œç”¨å°±æ˜¯å°† Astro çš„æ„å»ºç»“æœè½¬æ¢ä¸ºç›®æ ‡éƒ¨ç½²å¹³å°æ‰€éœ€çš„æ ¼å¼å’Œç›®å½•ç»“æ„ã€‚ä¸åŒå¹³å°çš„é€‚é…å™¨ä¼šç”Ÿæˆå¯¹åº”çš„ç›®å½•ï¼Œä¾‹å¦‚ <code>@astrojs/vercel</code> é€‚é…å™¨ä¼šç”Ÿæˆ <code>.vercel/</code> ç›®å½•ï¼Œ<code>@astrojs/netlify</code> é€‚é…å™¨ä¼šç”Ÿæˆ <code>.netlify/</code> ç›®å½•ï¼Œè¿™æ ·å„å¹³å°çš„éƒ¨ç½²å·¥å…·å°±èƒ½è¯†åˆ«å¹¶æ­£ç¡®éƒ¨ç½²è¿™äº›æ„å»ºäº§ç‰©ã€‚</p>
<p><strong>é€‚é…å™¨å‚æ•°é…ç½®</strong></p>
<p><code>@edgeone/astro</code> é€‚é…å™¨æ”¯æŒä¼ å…¥ä»¥ä¸‹å‚æ•°æ¥è‡ªå®šä¹‰æ„å»ºè¡Œä¸ºï¼š</p>
<ul>
<li><strong>includeFiles</strong>ï¼ˆå¯é€‰ï¼‰ï¼šå¼ºåˆ¶åŒ…å«çš„æ–‡ä»¶åˆ—è¡¨ï¼Œæ”¯æŒ glob æ¨¡å¼åŒ¹é…</li>
<li><strong>excludeFiles</strong>ï¼ˆå¯é€‰ï¼‰ï¼šæ’é™¤çš„æ–‡ä»¶åˆ—è¡¨ï¼Œä¸»è¦ç”¨äºæ’é™¤ node_modules ä¸­çš„ç‰¹å®šæ–‡ä»¶ï¼Œæ”¯æŒ glob æ¨¡å¼åŒ¹é…</li>
</ul>
<p>é…ç½®ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> edgeone <span class="hljs-keyword">from</span> <span class="hljs-string">"@edgeone/astro"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">adapter</span>: <span class="hljs-title function_">edgeone</span>({
    <span class="hljs-attr">outDir</span>: <span class="hljs-string">".edgeone"</span>,
    <span class="hljs-attr">includeFiles</span>: [<span class="hljs-string">"src/locales/**"</span>, <span class="hljs-string">"public/config.json"</span>],
    <span class="hljs-attr">excludeFiles</span>: [<span class="hljs-string">"node_modules/.cache/**"</span>],
  }),
});
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šæ ¹æ® <a href="https://link.juejin.cn?target=https%3A%2F%2Fpages.edgeone.ai%2Fzh%2Fdocument%2Fframework-astro" target="_blank" title="https://pages.edgeone.ai/zh/document/framework-astro" ref="nofollow noopener noreferrer">Pages å®˜æ–¹æ–‡æ¡£</a> è¯´æ˜ï¼Œå½“å‰ç‰ˆæœ¬æš‚ä¸æ”¯æŒ Astro çš„ Image ç»„ä»¶ï¼Œè¯·ä½¿ç”¨å¸¸è§„çš„ <code>&lt;img&gt;</code> æ ‡ç­¾æ¥æ˜¾ç¤ºå›¾ç‰‡ã€‚</p>
<h3 data-id="heading-5">æœ¬åœ°éªŒè¯</h3>
<p>åœ¨éƒ¨ç½²å‰ï¼Œå»ºè®®å…ˆåœ¨æœ¬åœ°è¿è¡Œé¡¹ç›®ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm run dev
</code></pre>
<p>å¯åŠ¨æˆåŠŸåï¼Œè®¿é—® <code>http://localhost:4321</code> å³å¯é¢„è§ˆç½‘ç«™æ•ˆæœï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9000e9d3c0514349a59fbd6d606ea2c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aG26bKc6Iqx55qE54mb57Kq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764922665&amp;x-signature=dSdz4wGBtwX%2F1NfP%2Fcqm2lQGOjo%3D" alt="é¦–é¡µé¢„è§ˆ" loading="lazy"/></p>
<p>ç¡®è®¤æœ¬åœ°è¿è¡Œæ— è¯¯åï¼Œå°±å¯ä»¥è¿›è¡Œéƒ¨ç½²äº†ã€‚</p>
<h3 data-id="heading-6">éƒ¨ç½²æ­¥éª¤</h3>
<p>Pages æä¾›ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼š</p>
<p><strong>æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œéƒ¨ç½²ï¼ˆæ¨èï¼‰</strong></p>
<p>é¦–å…ˆå…¨å±€å®‰è£…å‘½ä»¤è¡Œå·¥å…·ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install edgeone -g
</code></pre>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œéƒ¨ç½²å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">edgeone pages deploy --name my-personal-website --token &lt;your-token&gt;
</code></pre>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><code>--name</code>ï¼šæŒ‡å®šé¡¹ç›®åç§°</li>
<li><code>--token</code>ï¼šEdgeOne API Tokenï¼Œç”¨äºèº«ä»½éªŒè¯ï¼ˆå¯åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.cloud.tencent.com%2Fedgeone%2Fpages%3Ftab%3Dapi" target="_blank" title="https://console.cloud.tencent.com/edgeone/pages?tab=api" ref="nofollow noopener noreferrer">Pages API ç®¡ç†é¡µé¢</a> åˆ›å»ºï¼‰</li>
</ul>
<p><strong>éƒ¨ç½²ä¸­çš„è¾“å‡ºä¿¡æ¯ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[cli]</span><span class="hljs-section">[âœ”]</span> Using provided API token for deployment...
<span class="hljs-section">[cli]</span><span class="hljs-section">[âœ”]</span> Deploying /Users/your-mac-account-name/*/portfolio-sofidev-garrux/.edgeone to project my-personal-website (Production environment, global area)...
<span class="hljs-section">[cli]</span>â—ï¸ Project my-personal-website doesn't exist. Creating new project.
<span class="hljs-section">[cli]</span><span class="hljs-section">[CreatePagesProject]</span> Creating new project with name: my-personal-website in global area
<span class="hljs-section">[cli]</span><span class="hljs-section">[âœ”]</span> Using Project ID: pages-******
<span class="hljs-section">[cli]</span>No existing .env file found, will create new one
<span class="hljs-section">[cli]</span>Pulling environment variables...
<span class="hljs-section">[cli]</span>No environment variables found.
<span class="hljs-section">[cli]</span><span class="hljs-section">[Uploader]</span> Uploading file: <span class="hljs-section">[â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“]</span> 100%
<span class="hljs-section">[cli]</span><span class="hljs-section">[âœ”]</span> File uploaded successfully
<span class="hljs-section">[cli]</span><span class="hljs-section">[âœ”]</span> Creating deployment in Production environment...
<span class="hljs-section">[cli]</span><span class="hljs-section">[âœ”]</span> Created deployment with Deployment ID: ******
<span class="hljs-section">[cli]</span><span class="hljs-section">[DeployStatus]</span> Deploying.....
</code></pre>
<p><strong>éƒ¨ç½²æˆåŠŸåçš„è¾“å‡ºä¿¡æ¯ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[cli]</span><span class="hljs-section">[âœ”]</span> Deploy Success
<span class="hljs-section">[cli]</span><span class="hljs-section">[âœ”]</span> Deployment to EdgeOne Pages completed successfully! To view your project's live <span class="hljs-attr">URL.
EDGEONE_DEPLOY_URL</span>=https://my-personal-website.edgeone.site?eo_token=******
<span class="hljs-attr">EDGEONE_DEPLOY_TYPE</span>=preset
<span class="hljs-attr">EDGEONE_PROJECT_ID</span>=pages-******
<span class="hljs-section">[cli]</span><span class="hljs-section">[âœ”]</span> You can view your deployment in the EdgeOne Pages Console at:
https://console.cloud.tencent.com/edgeone/pages/project/*****
</code></pre>
<p>éƒ¨ç½²æˆåŠŸåï¼Œä½ å¯ä»¥è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.cloud.tencent.com%2Fedgeone%2Fpages%3Ftab%3Dprojects" target="_blank" title="https://console.cloud.tencent.com/edgeone/pages?tab=projects" ref="nofollow noopener noreferrer">Pages æ§åˆ¶å°</a> æŸ¥çœ‹æ–°éƒ¨ç½²çš„é¡¹ç›®ï¼Œçœ‹åˆ°é¡¹ç›®åˆ—è¡¨ä¸­å‡ºç°ä½ çš„é¡¹ç›®å³è¡¨ç¤ºå‘å¸ƒæˆåŠŸã€‚</p>
<p>åœ¨æ§åˆ¶å°çš„é¡¹ç›®åˆ—è¡¨ä¸­ï¼Œç‚¹å‡»è¿›å…¥ä½ çš„é¡¹ç›®è¯¦æƒ…é¡µï¼Œå¯ä»¥æŸ¥çœ‹é¡¹ç›®çš„é¢„è§ˆåœ°å€ï¼ˆPreview URLï¼‰ï¼Œé€šè¿‡è¯¥åœ°å€å³å¯è®¿é—®ä½ éƒ¨ç½²çš„ç½‘ç«™ã€‚</p>
<p><strong>æ–¹å¼äºŒï¼šGitHub è‡ªåŠ¨éƒ¨ç½²</strong></p>
<p>è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.cloud.tencent.com%2Fedgeone%2Fpages%2Fcreate%2Fgit" target="_blank" title="https://console.cloud.tencent.com/edgeone/pages/create/git" ref="nofollow noopener noreferrer">Git é¡¹ç›®éƒ¨ç½²é¡µé¢</a>ï¼Œå…³è” GitHub è´¦æˆ·å¹¶é€‰æ‹©ä»“åº“ï¼Œé…ç½®å®Œæˆåæ¯æ¬¡æ¨é€ä»£ç å³å¯è‡ªåŠ¨è§¦å‘éƒ¨ç½²ï¼Œç±»ä¼¼ Vercelã€Netlify çš„å·¥ä½œæµç¨‹ã€‚</p>
<h3 data-id="heading-7">éªŒè¯ SSR éƒ¨ç½²</h3>
<p>éƒ¨ç½²å®Œæˆåï¼Œä½ å¯ä»¥é€šè¿‡ <code>curl</code> å‘½ä»¤åœ¨ç»ˆç«¯éªŒè¯ SSR æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">curl https://my-personal-website.edgeone.site
</code></pre>
<p>å¦‚æœè¿”å›å®Œæ•´çš„ HTML å†…å®¹ï¼Œè¯´æ˜æœåŠ¡ç«¯æ¸²æŸ“å·²æˆåŠŸè¿è¡Œã€‚</p>
<p><strong>é€šè¿‡ä¸­é—´ä»¶éªŒè¯ SSR</strong></p>
<p>ä¸ºäº†æ›´ç›´è§‚åœ°éªŒè¯ SSR æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­æ·»åŠ  Astro ä¸­é—´ä»¶ï¼Œåœ¨å“åº”å¤´ä¸­åŠ å…¥è‡ªå®šä¹‰ä¿¡æ¯å’ŒæœåŠ¡ç«¯æ¸²æŸ“æ—¶é—´ã€‚</p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º <code>src/middleware.js</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">onRequest</span>(<span class="hljs-params">context, next</span>) {
  <span class="hljs-comment">// è®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´</span>
  <span class="hljs-keyword">const</span> startTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();

  <span class="hljs-comment">// ç»§ç»­å¤„ç†è¯·æ±‚</span>
  <span class="hljs-keyword">const</span> response = <span class="hljs-title function_">next</span>();

  <span class="hljs-comment">// åœ¨å“åº”å¤´ä¸­æ·»åŠ è‡ªå®šä¹‰ä¿¡æ¯</span>
  response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"X-Rendered-By"</span>, <span class="hljs-string">"EdgeOne-Pages-SSR"</span>);
  response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"X-Render-Time"</span>, <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now() - startTime}</span>ms`</span>);

  <span class="hljs-keyword">return</span> response;
}
</code></pre>
<p>é‡æ–°æ„å»ºå¹¶éƒ¨ç½²é¡¹ç›®åï¼Œä½¿ç”¨ <code>curl</code> å‘½ä»¤æŸ¥çœ‹å“åº”å¤´ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">curl -I https://my-personal-website.edgeone.site
</code></pre>
<p>ä½ ä¼šåœ¨å“åº”å¤´ä¸­çœ‹åˆ°ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">X-Rendered-By: EdgeOne-Pages-SSR</span>
<span class="hljs-section">X-Render-Time: 15ms</span>
</code></pre>
<p>è¿™äº›è‡ªå®šä¹‰å“åº”å¤´è¯æ˜äº†é¡µé¢æ˜¯åœ¨æœåŠ¡ç«¯åŠ¨æ€æ¸²æŸ“çš„ï¼Œ<code>X-Render-Time</code> æ˜¾ç¤ºäº†æœåŠ¡ç«¯æ¸²æŸ“æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚</p>
<h2 data-id="heading-8">æ€»ç»“</h2>
<p>ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨ Pages éƒ¨ç½² Astro SSR é¡¹ç›®çš„å…¨è¿‡ç¨‹ã€‚ä» SSG å‡çº§åˆ° SSR çš„æ­¥éª¤æ¯”è¾ƒç®€å•ï¼šå®‰è£…é€‚é…å™¨ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ã€é‡æ–°æ„å»ºéƒ¨ç½²ã€‚SSR æ¨¡å¼ç›¸æ¯” SSG åœ¨ SEO å’Œé¦–å±åŠ è½½ä¸Šä¼šæœ‰ä¸€äº›ä¼˜åŠ¿ï¼Œé€‚åˆå†…å®¹å‹ç½‘ç«™ã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¯¹åŒæ ·æƒ³è¦å°† Astro é¡¹ç›®éƒ¨ç½²åˆ° Pages çš„å¼€å‘è€…æä¾›å‚è€ƒï¼Œå¦‚æœé‡åˆ°é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é»‘é©¬ã€ŠJavaæ¶æ„å¸ˆå®æˆ˜è®­ç»ƒè¥ (å«å®Œæ•´èµ„æ–™)ã€‹]]></title>    <link>https://juejin.cn/post/7577431644069052467</link>    <guid>https://juejin.cn/post/7577431644069052467</guid>    <pubDate>2025-11-28T08:26:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577431644069052467" data-draft-id="7577668116500561958" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é»‘é©¬ã€ŠJavaæ¶æ„å¸ˆå®æˆ˜è®­ç»ƒè¥ (å«å®Œæ•´èµ„æ–™)ã€‹"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-28T08:26:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èµµå¤§æµ·"/> <meta itemprop="url" content="https://juejin.cn/user/2385264130397209"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é»‘é©¬ã€ŠJavaæ¶æ„å¸ˆå®æˆ˜è®­ç»ƒè¥ (å«å®Œæ•´èµ„æ–™)ã€‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2385264130397209/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èµµå¤§æµ·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T08:26:57.000Z" title="Fri Nov 28 2025 08:26:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>51CTO-AIå¤§æ¨¡å‹æŠ€æœ¯ä½“ç³»è¯¾ï¼šä»Transformeråˆ°Agentçš„ä»£ç å®è·µä¹‹æ—…</strong></h3>
<p>æœ¬æ–‡æ—¨åœ¨é€šè¿‡å…³é”®ä»£ç ç‰‡æ®µï¼Œæ­ç¤ºâ€œ51CTO-AIå¤§æ¨¡å‹æŠ€æœ¯ä½“ç³»è¯¾â€æ‰€æ¶µç›–çš„æ ¸å¿ƒæŠ€æœ¯æ ˆã€‚æˆ‘ä»¬å°†è·³è¿‡æ³›æ³›è€Œè°ˆï¼Œç›´å‡»æŠ€æœ¯æœ¬è´¨ï¼Œå±•ç¤ºè¯¾ç¨‹å¦‚ä½•é€šè¿‡ä»£ç å°†å¤æ‚çš„ç†è®ºè½åœ°ã€‚</p>
<h4 data-id="heading-1"><strong>ä¸€ã€åŸºçŸ³ï¼šTransformeræ¶æ„çš„ä»£ç è§£å‰–</strong></h4>
<p>ä»»ä½•å¤§æ¨¡å‹è¯¾ç¨‹çš„æ ¸å¿ƒéƒ½æ˜¯Transformerã€‚è¯¾ç¨‹ä¸ä¼šåªç»™ä½ çœ‹å…¬å¼ï¼Œè€Œæ˜¯å¸¦ä½ ç”¨PyTorchæ­å»ºå…¶æ ¸å¿ƒç»„ä»¶â€”â€”è‡ªæ³¨æ„åŠ›æœºåˆ¶ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">import torch
import torch.nn as nn
import torch.nn.functional as F

class SelfAttention(nn.Module):
    def __init__(self, d_model, heads):
        super().__init__()
        <span class="hljs-attr">self.d_model</span> = d_model
        <span class="hljs-attr">self.heads</span> = heads
        <span class="hljs-attr">self.head_dim</span> = d_model // heads
        
        assert d_model % <span class="hljs-attr">heads</span> == <span class="hljs-number">0</span>, <span class="hljs-string">"d_model must be divisible by number of heads"</span>
        
        <span class="hljs-comment"># çº¿æ€§å˜æ¢å¾—åˆ°Q, K, V</span>
        <span class="hljs-attr">self.to_queries</span> = nn.Linear(d_model, d_model, bias=<span class="hljs-literal">False</span>)
        <span class="hljs-attr">self.to_keys</span> = nn.Linear(d_model, d_model, bias=<span class="hljs-literal">False</span>)
        <span class="hljs-attr">self.to_values</span> = nn.Linear(d_model, d_model, bias=<span class="hljs-literal">False</span>)
        
        <span class="hljs-comment"># è¾“å‡ºçº¿æ€§å±‚</span>
        <span class="hljs-attr">self.unify_heads</span> = nn.Linear(d_model, d_model)
        
    def forward(self, x):
        <span class="hljs-comment"># x shape: (batch, seq_len, d_model)</span>
        b, t, <span class="hljs-attr">d</span> = x.size()
        <span class="hljs-attr">h</span> = self.heads
        
        <span class="hljs-comment"># ç”ŸæˆQ, K, Vï¼Œå¹¶åˆ†å‰²æˆå¤šå¤´</span>
        <span class="hljs-attr">Q</span> = self.to_queries(x).view(b, t, h, self.head_dim).transpose(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>) <span class="hljs-comment"># (b, h, t, head_dim)</span>
        <span class="hljs-attr">K</span> = self.to_keys(x).view(b, t, h, self.head_dim).transpose(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
        <span class="hljs-attr">V</span> = self.to_values(x).view(b, t, h, self.head_dim).transpose(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
        
        <span class="hljs-comment"># è®¡ç®—æ³¨æ„åŠ›åˆ†æ•° (Q * K^T) / sqrt(d_k)</span>
        <span class="hljs-attr">scores</span> = torch.matmul(Q, K.transpose(-<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>)) / (self.head_dim ** <span class="hljs-number">0.5</span>)
        <span class="hljs-attr">attn_weights</span> = F.softmax(scores, dim=-<span class="hljs-number">1</span>)
        
        <span class="hljs-comment"># åº”ç”¨æ³¨æ„åŠ›æƒé‡åˆ°V</span>
        <span class="hljs-attr">out</span> = torch.matmul(attn_weights, V) <span class="hljs-comment"># (b, h, t, head_dim)</span>
        
        <span class="hljs-comment"># åˆå¹¶å¤šå¤´</span>
        <span class="hljs-attr">out</span> = out.transpose(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>).contiguous().view(b, t, d) <span class="hljs-comment"># (b, t, d_model)</span>
        
        <span class="hljs-comment"># é€šè¿‡çº¿æ€§å±‚</span>
        return self.unify_heads(out)

<span class="hljs-comment"># ç¤ºä¾‹ï¼šå®ä¾‹åŒ–ä¸€ä¸ª8å¤´ï¼Œ512ç»´çš„è‡ªæ³¨æ„åŠ›å±‚</span>
<span class="hljs-attr">attn_layer</span> = SelfAttention(d_model=<span class="hljs-number">512</span>, heads=<span class="hljs-number">8</span>)
<span class="hljs-attr">x</span> = torch.randn(<span class="hljs-number">2</span>, <span class="hljs-number">10</span>, <span class="hljs-number">512</span>) <span class="hljs-comment"># (batch_size, sequence_length, d_model)</span>
<span class="hljs-attr">output</span> = attn_layer(x)
print(f"Input shape: {x.shape}")
print(f"Output shape: {output.shape}")
</code></pre>
<p><strong>è¯¾ç¨‹ä»·å€¼</strong>ï¼šé€šè¿‡æ‰‹å†™SelfAttentionï¼Œå­¦å‘˜å°†æ·±åˆ»ç†è§£å¤šå¤´æœºåˆ¶ã€ç¼©æ”¾ç‚¹ç§¯ã€ç»´åº¦å˜æ¢ç­‰æ ¸å¿ƒæ¦‚å¿µï¼Œä¸ºç†è§£BERTã€GPTç­‰æ¨¡å‹æ‰“ä¸‹åšå®åŸºç¡€ã€‚</p>
<h4 data-id="heading-2"><strong>äºŒã€é¢„è®­ç»ƒä¸å¾®è°ƒï¼šä»é›¶å¼€å§‹ç†è§£GPTçš„ç”Ÿæˆè¿‡ç¨‹</strong></h4>
<p>è¯¾ç¨‹ä¼šæ·±å…¥å¤§æ¨¡å‹çš„é¢„è®­ç»ƒç›®æ ‡â€”â€”å› æœè¯­è¨€å»ºæ¨¡ï¼Œå¹¶å±•ç¤ºæœ€æœ´ç´ çš„æ–‡æœ¬ç”Ÿæˆä»£ç ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">def causal_lm_training_step(model, tokenizer, text_batch):
    """
    ç®€åŒ–ç‰ˆçš„å› æœè¯­è¨€æ¨¡å‹è®­ç»ƒæ­¥éª¤
    """
    <span class="hljs-comment"># 1. åˆ†è¯å¹¶æ„å»ºè¾“å…¥å’Œæ ‡ç­¾</span>
    <span class="hljs-attr">inputs</span> = tokenizer(text_batch, return_tensors=<span class="hljs-string">'pt'</span>, padding=<span class="hljs-literal">True</span>, truncation=<span class="hljs-literal">True</span>)
    <span class="hljs-attr">input_ids</span> = inputs[<span class="hljs-string">'input_ids'</span>]
    
    <span class="hljs-comment"># æ ‡ç­¾æ˜¯è¾“å…¥å‘å³åç§»ä¸€ä½</span>
    <span class="hljs-attr">labels</span> = input_ids[:, <span class="hljs-number">1</span>:].contiguous() <span class="hljs-comment"># ä»ç¬¬äºŒä¸ªtokenå¼€å§‹ä½œä¸ºæ ‡ç­¾</span>
    <span class="hljs-comment"># éœ€è¦å°†è¾“å…¥æˆªæ–­ä¸€ä½ï¼Œä¸æ ‡ç­¾é•¿åº¦å¯¹é½</span>
    <span class="hljs-attr">input_ids</span> = input_ids[:, :-<span class="hljs-number">1</span>] <span class="hljs-comment"># åˆ°å€’æ•°ç¬¬äºŒä¸ªtokenä¸ºæ­¢ä½œä¸ºè¾“å…¥</span>
    
    <span class="hljs-comment"># 2. å‰å‘ä¼ æ’­</span>
    <span class="hljs-attr">outputs</span> = model(input_ids=input_ids)
    <span class="hljs-attr">logits</span> = outputs.logits <span class="hljs-comment"># (batch, seq_len, vocab_size)</span>
    
    <span class="hljs-comment"># 3. è®¡ç®—æŸå¤±ï¼ˆäº¤å‰ç†µï¼‰</span>
    <span class="hljs-attr">loss_fn</span> = nn.CrossEntropyLoss(ignore_index=tokenizer.pad_token_id)
    <span class="hljs-attr">loss</span> = loss_fn(logits.view(-<span class="hljs-number">1</span>, logits.size(-<span class="hljs-number">1</span>)), labels.view(-<span class="hljs-number">1</span>))
    
    return loss

def simple_generate(model, tokenizer, prompt, <span class="hljs-attr">max_length</span>=<span class="hljs-number">50</span>):
    """
    ç®€å•çš„è‡ªå›å½’ç”Ÿæˆï¼ˆè´ªå©ªè§£ç ï¼‰
    """
    model.eval()
    <span class="hljs-attr">input_ids</span> = tokenizer.encode(prompt, return_tensors=<span class="hljs-string">'pt'</span>)
    
    with torch.no_grad():
        for _ in range(max_length):
            <span class="hljs-attr">outputs</span> = model(input_ids)
            <span class="hljs-attr">next_token_logits</span> = outputs.logits[:, -<span class="hljs-number">1</span>, :] <span class="hljs-comment"># å–æœ€åä¸€ä¸ªæ—¶é—´æ­¥çš„logits</span>
            <span class="hljs-attr">next_token_id</span> = torch.argmax(next_token_logits, dim=-<span class="hljs-number">1</span>).unsqueeze(-<span class="hljs-number">1</span>) <span class="hljs-comment"># è´ªå©ªé€‰æ‹©</span>
            
            <span class="hljs-comment"># å°†æ–°ç”Ÿæˆçš„tokenæ‹¼æ¥åˆ°è¾“å…¥ä¸­</span>
            <span class="hljs-attr">input_ids</span> = torch.cat([input_ids, next_token_id], dim=<span class="hljs-number">1</span>)
            
            <span class="hljs-comment"># å¦‚æœç”Ÿæˆäº†ç»“æŸç¬¦ï¼Œåˆ™åœæ­¢</span>
            if <span class="hljs-attr">next_token_id</span> == tokenizer.eos_token_id:
                break
                
    <span class="hljs-attr">generated_text</span> = tokenizer.decode(input_ids.squeeze(), skip_special_tokens=<span class="hljs-literal">True</span>)
    return generated_text

<span class="hljs-comment"># ç¤ºä¾‹ä½¿ç”¨ï¼ˆå‡è®¾modelå’Œtokenizerå·²åŠ è½½ï¼‰</span>
<span class="hljs-comment"># loss = causal_lm_training_step(model, tokenizer, [â€œä»Šå¤©å¤©æ°”çœŸå¥½â€ï¼Œ â€œäººå·¥æ™ºèƒ½æ˜¯æœªæ¥çš„æ–¹å‘â€])</span>
<span class="hljs-comment"># generated = simple_generate(model, tokenizer, â€œäººå·¥æ™ºèƒ½å¯ä»¥â€)</span>
</code></pre>
<p><strong>è¯¾ç¨‹ä»·å€¼</strong>ï¼šè¿™æ®µä»£ç æ­ç¤ºäº†GPTå®¶æ—æ¨¡å‹â€œé€è¯ç”Ÿæˆâ€çš„æœ¬è´¨ã€‚å­¦å‘˜å°†æ˜ç™½é¢„è®­ç»ƒå¦‚ä½•è®©æ¨¡å‹å­¦ä¼šè¯­è¨€è§„å¾‹ï¼Œä»¥åŠå¾®è°ƒå¦‚ä½•åœ¨æ­¤åŸºç¡€ä¸Šé€‚åº”ç‰¹å®šä»»åŠ¡ã€‚</p>
<h4 data-id="heading-3"><strong>ä¸‰ã€æ ¸å¿ƒæŠ€å·§ï¼šæŒ‡ä»¤å¾®è°ƒä¸RLHFçš„å…³é”®ä»£ç é€»è¾‘</strong></h4>
<p>è¯¾ç¨‹ä¼šæ·±å…¥å¤§æ¨¡å‹å¯¹é½çš„æ ¸å¿ƒâ€”â€”æŒ‡ä»¤å¾®è°ƒå’ŒåŸºäºäººç±»åé¦ˆçš„å¼ºåŒ–å­¦ä¹ ï¼Œå±•ç¤ºå…¶æ ¸å¿ƒé€»è¾‘ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æŒ‡ä»¤å¾®è°ƒï¼ˆInstruction Tuningï¼‰çš„æ ¸å¿ƒï¼šæ„é€ æŒ‡ä»¤-å›ç­”å¯¹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">format_instruction_data</span>(<span class="hljs-params">instruction, response</span>):
    <span class="hljs-string">"""å°†æŒ‡ä»¤å’Œå›ç­”æ ¼å¼åŒ–ä¸ºæ¨¡å‹è¾“å…¥"""</span>
    <span class="hljs-comment"># å¸¸ç”¨æ¨¡æ¿ï¼Œå¦‚Alpacaæ ¼å¼</span>
    prompt_template = <span class="hljs-string">f"Below is an instruction that describes a task. Write a response that appropriately completes the request.\n\n### Instruction:\n<span class="hljs-subst">{instruction}</span>\n\n### Response:\n"</span>
    full_input = prompt_template
    full_target = response <span class="hljs-comment"># æ¨¡å‹éœ€è¦ç”Ÿæˆçš„ç›®æ ‡éƒ¨åˆ†</span>
    <span class="hljs-keyword">return</span> full_input, full_target

<span class="hljs-comment"># RLHFä¸­çš„å¥–åŠ±æ¨¡å‹è®­ç»ƒï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RewardModel</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, base_model</span>):
        <span class="hljs-built_in">super</span>().__init__()
        self.transformer = base_model
        <span class="hljs-comment"># åœ¨åŸºç¡€æ¨¡å‹ä¸ŠåŠ ä¸€ä¸ªå›å½’å¤´ï¼Œè¾“å‡ºä¸€ä¸ªæ ‡é‡åˆ†æ•°</span>
        self.value_head = nn.Linear(base_model.config.hidden_size, <span class="hljs-number">1</span>)
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, input_ids</span>):
        outputs = self.transformer(input_ids=input_ids)
        hidden_states = outputs.last_hidden_state <span class="hljs-comment"># (batch, seq, hidden_size)</span>
        <span class="hljs-comment"># å–æœ€åä¸€ä¸ªtokençš„éšè—çŠ¶æ€ä½œä¸ºåºåˆ—è¡¨ç¤º</span>
        last_token_hidden = hidden_states[:, -<span class="hljs-number">1</span>, :]
        reward_score = self.value_head(last_token_hidden).squeeze(-<span class="hljs-number">1</span>)
        <span class="hljs-keyword">return</span> reward_score

<span class="hljs-comment"># PPOè®­ç»ƒå¾ªç¯çš„å…³é”®æ­¥éª¤ï¼ˆæ¦‚å¿µæ€§ä»£ç ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">ppo_training_step</span>(<span class="hljs-params">policy_model, ref_model, reward_model, prompt</span>):
    <span class="hljs-comment"># 1. ç­–ç•¥æ¨¡å‹æ ¹æ®promptç”Ÿæˆå›ç­”</span>
    generated_response = policy_model.generate(prompt)
    
    <span class="hljs-comment"># 2. ä½¿ç”¨å¥–åŠ±æ¨¡å‹ä¸ºç”Ÿæˆçš„å›ç­”æ‰“åˆ†</span>
    <span class="hljs-keyword">with</span> torch.no_grad():
        reward_score = reward_model(generated_response)
        
    <span class="hljs-comment"># 3. è®¡ç®—å½“å‰ç­–ç•¥æ¨¡å‹å’Œå‚è€ƒæ¨¡å‹ï¼ˆæ—§ç­–ç•¥ï¼‰çš„KLæ•£åº¦ï¼Œä½œä¸ºæƒ©ç½šé¡¹</span>
    <span class="hljs-comment"># ... (æ¶‰åŠlogitsçš„å¤æ‚è®¡ç®—)</span>
    
    <span class="hljs-comment"># 4. ç»„åˆå¥–åŠ±å’ŒKLæƒ©ç½šï¼Œå½¢æˆPPOçš„ä¼˜åŒ–ç›®æ ‡</span>
    <span class="hljs-comment"># ... (PPO-Clipæ ¸å¿ƒç®—æ³•)</span>
    
    <span class="hljs-comment"># 5. åå‘ä¼ æ’­ï¼Œæ›´æ–°ç­–ç•¥æ¨¡å‹</span>
    <span class="hljs-comment"># ...</span>
</code></pre>
<p><strong>è¯¾ç¨‹ä»·å€¼</strong>ï¼šé€šè¿‡ä»£ç åŒ–çš„RLHFæµç¨‹ï¼Œå­¦å‘˜å°†ç†è§£ChatGPTç­‰å¯¹è¯æ¨¡å‹ä¸ºä½•èƒ½å¦‚æ­¤â€œå¬è¯â€å’Œâ€œæœ‰ç”¨â€ï¼ŒæŒæ¡è®©å¤§æ¨¡å‹ä¸äººç±»ä»·å€¼è§‚å¯¹é½çš„å…³é”®æŠ€æœ¯ã€‚</p>
<h4 data-id="heading-4"><strong>å››ã€åº”ç”¨è½åœ°ï¼šæ„å»ºåŸºäºFunction Callingçš„AI Agent</strong></h4>
<p>è¯¾ç¨‹æœ€åä¼šå¼•å¯¼å­¦å‘˜å°†å¤§æ¨¡å‹è½¬åŒ–ä¸ºèƒ½è°ƒç”¨å·¥å…·ã€æ‰§è¡Œä»»åŠ¡çš„æ™ºèƒ½ä½“ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> json

<span class="hljs-comment"># å®šä¹‰å·¥å…·ï¼ˆå‡½æ•°ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weather</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”æƒ…å†µã€‚"""</span>
    <span class="hljs-comment"># è¿™é‡Œæ˜¯æ¨¡æ‹Ÿå®ç°</span>
    weather_data = {
        <span class="hljs-string">"åŒ—äº¬"</span>: <span class="hljs-string">"æ™´ï¼Œ25Â°C"</span>,
        <span class="hljs-string">"ä¸Šæµ·"</span>: <span class="hljs-string">"å¤šäº‘ï¼Œ27Â°C"</span>,
        <span class="hljs-string">"æ·±åœ³"</span>: <span class="hljs-string">"é˜µé›¨ï¼Œ30Â°C"</span>
    }
    <span class="hljs-keyword">return</span> weather_data.get(city, <span class="hljs-string">"æœªæ‰¾åˆ°è¯¥åŸå¸‚å¤©æ°”ä¿¡æ¯"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculator</span>(<span class="hljs-params">expression: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""è®¡ç®—æ•°å­¦è¡¨è¾¾å¼ã€‚"""</span>
    <span class="hljs-keyword">try</span>:
        result = <span class="hljs-built_in">eval</span>(expression) <span class="hljs-comment"># æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒç¦ç”¨evalï¼Œæ­¤å¤„ä»…ä¸ºç¤ºä¾‹</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{expression}</span> = <span class="hljs-subst">{result}</span>"</span>
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"è®¡ç®—é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¡¨è¾¾å¼ã€‚"</span>

<span class="hljs-comment"># å¯ä¾›æ¨¡å‹è°ƒç”¨çš„å·¥å…·åˆ—è¡¨</span>
available_functions = {
    <span class="hljs-string">"get_weather"</span>: get_weather,
    <span class="hljs-string">"calculator"</span>: calculator
}

<span class="hljs-comment"># æ¨¡æ‹Ÿå¤§æ¨¡å‹çš„Function Callingè¾“å‡º</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">mock_llm_function_call</span>(<span class="hljs-params">user_query</span>):
    <span class="hljs-string">"""æ¨¡æ‹Ÿå¤§æ¨¡å‹åˆ†æç”¨æˆ·æ„å›¾å¹¶å†³å®šè°ƒç”¨å“ªä¸ªå‡½æ•°ã€‚"""</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">"å¤©æ°”"</span> <span class="hljs-keyword">in</span> user_query:
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"reasoning"</span>: <span class="hljs-string">"ç”¨æˆ·è¯¢é—®å¤©æ°”ï¼Œéœ€è¦è°ƒç”¨å¤©æ°”æŸ¥è¯¢å‡½æ•°ã€‚"</span>,
            <span class="hljs-string">"function_name"</span>: <span class="hljs-string">"get_weather"</span>,
            <span class="hljs-string">"parameters"</span>: {<span class="hljs-string">"city"</span>: <span class="hljs-string">"åŒ—äº¬"</span>} <span class="hljs-comment"># ç®€å•èµ·è§ï¼Œè¿™é‡Œå›ºå®šåŸå¸‚ï¼Œå®é™…åº”ç”±æ¨¡å‹æå–</span>
        }
    <span class="hljs-keyword">elif</span> <span class="hljs-string">"è®¡ç®—"</span> <span class="hljs-keyword">in</span> user_query <span class="hljs-keyword">or</span> <span class="hljs-string">"+"</span> <span class="hljs-keyword">in</span> user_query <span class="hljs-keyword">or</span> <span class="hljs-string">"-"</span> <span class="hljs-keyword">in</span> user_query:
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"reasoning"</span>: <span class="hljs-string">"ç”¨æˆ·éœ€è¦æ•°å­¦è®¡ç®—ï¼Œè°ƒç”¨è®¡ç®—å™¨å‡½æ•°ã€‚"</span>,
            <span class="hljs-string">"function_name"</span>: <span class="hljs-string">"calculator"</span>,
            <span class="hljs-string">"parameters"</span>: {<span class="hljs-string">"expression"</span>: <span class="hljs-string">"3 + 5 * 2"</span>}
        }
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"reasoning"</span>: <span class="hljs-string">"æ— éœ€è°ƒç”¨å‡½æ•°ï¼Œç›´æ¥å›ç­”ã€‚"</span>, <span class="hljs-string">"action"</span>: <span class="hljs-string">"direct_response"</span>}

<span class="hljs-comment"># AI Agent æ‰§è¡Œå¾ªç¯</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_ai_agent</span>(<span class="hljs-params">user_input</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç”¨æˆ·: <span class="hljs-subst">{user_input}</span>"</span>)
    
    <span class="hljs-comment"># 1. å¤§æ¨¡å‹åˆ†ææ„å›¾ï¼Œå†³å®šè¡ŒåŠ¨</span>
    decision = mock_llm_function_call(user_input)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"AIå†³ç­–: <span class="hljs-subst">{decision[<span class="hljs-string">'reasoning'</span>]}</span>"</span>)
    
    <span class="hljs-comment"># 2. å¦‚æœå†³å®šè°ƒç”¨å‡½æ•°</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">'function_name'</span> <span class="hljs-keyword">in</span> decision:
        func_name = decision[<span class="hljs-string">'function_name'</span>]
        params = decision[<span class="hljs-string">'parameters'</span>]
        func = available_functions[func_name]
        
        <span class="hljs-comment"># æ‰§è¡Œå‡½æ•°</span>
        result = func(**params)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ‰§è¡Œå·¥å…· `<span class="hljs-subst">{func_name}</span>`: è¾“å…¥ <span class="hljs-subst">{params}</span>, è¾“å‡º <span class="hljs-subst">{result}</span>"</span>)
        
        <span class="hljs-comment"># 3. ï¼ˆå¯é€‰ï¼‰å°†å‡½æ•°æ‰§è¡Œç»“æœè¿”å›ç»™å¤§æ¨¡å‹ï¼Œè®©å…¶ç”Ÿæˆæœ€ç»ˆçš„è‡ªç„¶è¯­è¨€å›ç­”</span>
        final_response = <span class="hljs-string">f"æ ¹æ®æŸ¥è¯¢ï¼Œç»“æœæ˜¯ï¼š<span class="hljs-subst">{result}</span>"</span>
        <span class="hljs-keyword">return</span> final_response
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># ç›´æ¥å›ç­”çš„é€»è¾‘</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"è¿™æ˜¯ä¸€ä¸ªéœ€è¦æˆ‘ç›´æ¥å›ç­”çš„é—®é¢˜ã€‚"</span>

<span class="hljs-comment"># è¿è¡ŒAgent</span>
response = run_ai_agent(<span class="hljs-string">"ä»Šå¤©åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Agent: <span class="hljs-subst">{response}</span>"</span>)

response = run_ai_agent(<span class="hljs-string">"å¸®æˆ‘ç®—ä¸€ä¸‹3åŠ 5ä¹˜ä»¥2ç­‰äºå¤šå°‘ï¼Ÿ"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Agent: <span class="hljs-subst">{response}</span>"</span>)
</code></pre>
<p><strong>è¯¾ç¨‹ä»·å€¼</strong>ï¼šæ­¤ä»£ç æ„å»ºäº†ä¸€ä¸ªç®€æ˜“AI Agentçš„æ ¸å¿ƒå¾ªç¯ã€‚å­¦å‘˜å°†å­¦ä¼šå¦‚ä½•å°†å¤§æ¨¡å‹çš„æ¨ç†èƒ½åŠ›ä¸å¤–éƒ¨å·¥å…·/APIç›¸ç»“åˆï¼Œåˆ›é€ å‡ºèƒ½è§£å†³å®é™…é—®é¢˜çš„åº”ç”¨ï¼Œè¿™æ˜¯å½“å‰AIåº”ç”¨å¼€å‘çš„æœ€å‰æ²¿ã€‚</p>
<hr/>
<h3 data-id="heading-5"><strong>æ€»ç»“</strong></h3>
<p>â€œ51CTO-AIå¤§æ¨¡å‹æŠ€æœ¯ä½“ç³»è¯¾â€çš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºï¼Œå®ƒ<strong>ä¸æ˜¯çŸ¥è¯†çš„ç½—åˆ—ï¼Œè€Œæ˜¯é€šè¿‡å±‚å±‚é€’è¿›çš„ä»£ç å®è·µï¼Œå°†Transformerã€é¢„è®­ç»ƒã€å¾®è°ƒã€å¯¹é½ã€AgentåŒ–ç­‰å®å¤§æ¦‚å¿µï¼Œé€ä¸€æ‹†è§£ä¸ºå¯è¿è¡Œã€å¯è°ƒè¯•ã€å¯æ‰©å±•çš„å·¥ç¨‹æ¨¡å—</strong>ã€‚ ä»ä¸€è¡Œè¡Œä»£ç ä¸­ï¼Œæ‚¨å°†çœŸæ­£<strong>æ„å»º</strong>å‡ºå¯¹å¤§æ¨¡å‹æŠ€æœ¯çš„æ·±åˆ»ç›´è§‰å’Œå·¥ç¨‹èƒ½åŠ›ï¼Œè€Œä¸ä»…ä»…æ˜¯åœç•™åœ¨ç†è®ºå±‚é¢ã€‚è¿™æ­£æ˜¯æˆä¸ºä¸€ååˆæ ¼çš„AIå·¥ç¨‹å¸ˆæˆ–ç ”ç©¶å‘˜æ‰€å¿…éœ€çš„ç¡¬æ ¸è®­ç»ƒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RBACæ¨¡å‹ï¼šåƒç”µå½±é™¢é€‰åº§ä¸€æ ·ç®¡ç†æƒé™ï¼Œå‘Šåˆ«"ä¸€ä¸ªç”¨æˆ·é…ä¸€ä¸ªæƒé™"çš„å™©æ¢¦]]></title>    <link>https://juejin.cn/post/7577242285197344795</link>    <guid>https://juejin.cn/post/7577242285197344795</guid>    <pubDate>2025-11-27T14:34:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577242285197344795" data-draft-id="7577226119105658907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RBACæ¨¡å‹ï¼šåƒç”µå½±é™¢é€‰åº§ä¸€æ ·ç®¡ç†æƒé™ï¼Œå‘Šåˆ«&quot;ä¸€ä¸ªç”¨æˆ·é…ä¸€ä¸ªæƒé™&quot;çš„å™©æ¢¦"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-27T14:34:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ— é™å¤§6"/> <meta itemprop="url" content="https://juejin.cn/user/2865758605422890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RBACæ¨¡å‹ï¼šåƒç”µå½±é™¢é€‰åº§ä¸€æ ·ç®¡ç†æƒé™ï¼Œå‘Šåˆ«"ä¸€ä¸ªç”¨æˆ·é…ä¸€ä¸ªæƒé™"çš„å™©æ¢¦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2865758605422890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ— é™å¤§6
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T14:34:08.000Z" title="Thu Nov 27 2025 14:34:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ­ RBACæ¨¡å‹ï¼šåƒç”µå½±é™¢é€‰åº§ä¸€æ ·ç®¡ç†æƒé™ï¼Œå‘Šåˆ«"ä¸€ä¸ªç”¨æˆ·é…ä¸€ä¸ªæƒé™"çš„å™©æ¢¦ï¼</h2>
<blockquote>
<p>æ¬¢è¿æ¥åˆ°æ— é™å¤§çš„é¢‘é“ï¼Œæœ‰æ®µæ—¥å­æ²¡æ›´æ–°äº†ï¼Œå› ä¸ºæ‹¿äº†ä¸€ä¸ªæ¯”è¾ƒæ»¡æ„çš„offerï¼Œç»™è‡ªå·±æ”¾äº†ä¸ªå‡ï¼Œä¹‹åå°±æ…¢æ…¢æ¢å¤æ›´æ–°äº†</p>
</blockquote>
<h3 data-id="heading-1">ğŸ¬ å¼•è¨€ï¼šå½“ä½ çš„ç³»ç»Ÿæƒé™ç®¡ç†å˜æˆäº†"æ•£ç¥¨é»„ç‰›"...</h3>
<blockquote>
<p>æƒ³è±¡ä¸€ä¸‹ï¼šä½ æ£ç€çˆ†ç±³èŠ±ğŸ¿ï¼Œå“¼ç€ä¸»é¢˜æ›²ğŸ¶ï¼Œå…´å†²å†²è·‘åˆ°ç”µå½±é™¢æƒ³çœ‹ã€Šå¤è”5ã€‹ï¼Œç»“æœå”®ç¥¨å‘˜é¢æ— è¡¨æƒ…åœ°è¯´ï¼š"ä¸å¥½æ„æ€ï¼Œæˆ‘ä»¬è¿™é‡Œæ²¡æœ‰åº§ä½åˆ†åŒºï¼Œæƒ³çœ‹ç”µå½±å¾—å•ç‹¬ä¹°æ¯ä¸ªåº§ä½çš„ç¥¨ğŸ«"ã€‚</p>
<p>ä½ å½“åœºçŸ³åŒ–â€”â€”è¿™å“ªæ˜¯çœ‹ç”µå½±ï¼Ÿè¿™åˆ†æ˜æ˜¯åœ¨ä¹°ç”µå½±å…çš„é©¬èµ›å…‹åœ°ç –å•Šï¼ğŸ˜±</p>
<p>ç°å®ä¸­ï¼Œ90%çš„ç³»ç»Ÿæƒé™ç®¡ç†å°±åƒè¿™ä¸ª"è„‘å›è·¯æ¸…å¥‡çš„ç”µå½±é™¢"ï¼š</p>
<ul>
<li>ç»™æ¯ä¸ªç”¨æˆ·å•ç‹¬åˆ†é…æƒé™ï¼Ÿæ”¹ä¸€æ¬¡æƒé™è¦æ”¹500ä¸ªç”¨æˆ·é…ç½®ğŸ™„</li>
<li>æ–°å‘˜å·¥å…¥èŒè¦å¡«8å¼ æƒé™ç”³è¯·è¡¨ï¼ŸHRå°å§å§éƒ½å¿«å“­äº†ğŸ˜­</li>
<li>ä¸´æ—¶è°ƒå²—ï¼Ÿæƒé™äº¤æ¥å ªæ¯”äºŒæ‰‹æˆ¿è¿‡æˆ·ğŸ“‹</li>
</ul>
<p>ç›´åˆ°RBACæ¨¡å‹æ¨ªç©ºå‡ºä¸–ï¼Œæ‰æŠŠæˆ‘ä»¬ä»è¿™ç§"æ‰‹å·¥ä½œåŠ"å¼çš„æƒé™ç®¡ç†é‡Œè§£æ”¾å‡ºæ¥â€”â€”
<strong>è¿™å°±åƒæ˜¯ç»™ç”µå½±é™¢è£…äº†ä¸ªæ™ºèƒ½åˆ†åŒºå”®ç¥¨ç³»ç»Ÿï¼</strong> ğŸš€</p>
</blockquote>
<h3 data-id="heading-2">â±ï¸ 3åˆ†é’Ÿææ‡‚RBACï¼šä»"æ•£ç¥¨é»„ç‰›"åˆ°"æ™ºèƒ½å½±é™¢å”®ç¥¨ç³»ç»Ÿ"çš„é€†è¢­ï¼</h3>
<p>RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰åˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿè¯´äººè¯å°±æ˜¯â€”â€”<strong>æƒé™ç®¡ç†ç•Œçš„"æ™ºèƒ½åˆ†åŒºå”®ç¥¨ç³»ç»Ÿ"ï¼</strong> ğŸ«</p>
<p>è®©æˆ‘ä»¬ç”¨çœ‹ç”µå½±çš„ä¾‹å­æ¥æ‹†è§£è¿™ä¸ªç¥å¥‡æ¨¡å‹ï¼š</p>

























<table><thead><tr><th>RBACæœ¯è¯­</th><th>ç”µå½±é™¢ç±»æ¯”</th><th>ç°å®ä¸­çš„ä¾‹å­</th></tr></thead><tbody><tr><td><strong>ç”¨æˆ·ï¼ˆUserï¼‰</strong></td><td>è§‚ä¼—</td><td>ä½ çš„ç³»ç»Ÿé‡Œçš„å¼ ä¸‰ã€æå››ã€ç‹äº”</td></tr><tr><td><strong>è§’è‰²ï¼ˆRoleï¼‰</strong></td><td>åº§ä½åŒºåŸŸ</td><td>æ™®é€šå…ã€IMAXå…ã€VIPå…</td></tr><tr><td><strong>æƒé™ï¼ˆPermissionï¼‰</strong></td><td>å…·ä½“åº§ä½+æœåŠ¡</td><td>3æ’5åº§çš„åº§ä½+å…è´¹çˆ†ç±³èŠ±ğŸ¿+é¥®æ–™ğŸ¥¤</td></tr></tbody></table>
<p>å°±åƒä½ ä¹°äº†IMAXå…çš„ç¥¨ï¼Œè‡ªç„¶å°±èƒ½äº«å—"å·¨å¹•ä½“éªŒ+æœæ¯”éŸ³æ•ˆ"ï¼Œè€Œä¸ç”¨å†å•ç‹¬ä¸ºéŸ³æ•ˆä¹°å¼ ç¥¨â€”â€”RBACçš„æ ¸å¿ƒå°±æ˜¯è¿™ä¸ª**"ç”¨æˆ·â†’è§’è‰²â†’æƒé™"çš„ä¸‰å±‚æ˜ å°„å…³ç³»**ï¼</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œä¸ç®¡æœ‰å¤šå°‘ç”¨æˆ·ï¼Œåªè¦æŠŠä»–ä»¬åˆ†åˆ°ä¸åŒçš„"å½±å…"ï¼ˆè§’è‰²ï¼‰ï¼Œä»–ä»¬è‡ªç„¶å°±èƒ½è·å¾—ç›¸åº”çš„"è§‚å½±ä½“éªŒ"ï¼ˆæƒé™ï¼‰ã€‚</p>
<p><strong>å½»åº•å‘Šåˆ«"ä¸€äººä¸€æƒé™"çš„å™©æ¢¦ï¼</strong> ğŸ‘»</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    subgraph "ğŸ¬ ç”¨æˆ·å±‚ (è§‚å½±è€…)"
        A1["å°æ˜ ğŸ‘¦\næ™®é€šç”¨æˆ·"] --&gt; B1["åˆ†é…è§’è‰²"]
        A2["å°çº¢ ğŸ’\nVIPå®¢æˆ·"] --&gt; B2["åˆ†é…è§’è‰²"]
        A3["è€ç‹ ğŸ§”\nç®¡ç†å‘˜"] --&gt; B3["åˆ†é…è§’è‰²"]
        A4["å°æ ğŸ‘¤\næ–°ç”¨æˆ·"] --&gt; B4["åˆ†é…è§’è‰²"]
    end
  
    subgraph "ğŸ« è§’è‰²å±‚ (ç¥¨ç§)"
        B1 --&gt; C1["æ™®é€šä¼šå‘˜ ğŸ‘¥"]
        B2 --&gt; C2["VIPå®¢æˆ· ğŸ’«"]
        B3 --&gt; C3["ç®¡ç†å‘˜ ğŸ› ï¸"]
        B4 --&gt; C1
    end
  
    subgraph "ğŸ¿ æƒé™å±‚ (å½±é™¢æœåŠ¡)"
        C1 --&gt; D1["æŸ¥çœ‹ç”µå½±ä¿¡æ¯ ğŸ“½ï¸"]
        C1 --&gt; D2["è´­ä¹°ç”µå½±ç¥¨ ğŸŸï¸"]
        C1 --&gt; D3["åŸºç¡€è§‚å½±ä½“éªŒ ğŸ¥"]
    
        C2 --&gt; D1
        C2 --&gt; D2
        C2 --&gt; D3
        C2 --&gt; D4["å…è´¹çˆ†ç±³èŠ± ğŸ¿"]
        C2 --&gt; D5["VIPä¼‘æ¯å®¤ ğŸ "]
        C2 --&gt; D6["ä¼˜å…ˆé€‰åº§ ğŸ’º"]
    
        C3 --&gt; D1
        C3 --&gt; D2
        C3 --&gt; D3
        C3 --&gt; D7["æ·»åŠ ç”µå½± ğŸ¬"]
        C3 --&gt; D8["ç®¡ç†ä¼šå‘˜ ğŸ’¼"]
        C3 --&gt; D9["ä¿®æ”¹ç¥¨ä»· ğŸ’°"]
    
        D1 --&gt; E["è®¿é—®èµ„æº"]
        D2 --&gt; E
        D3 --&gt; E
        D4 --&gt; E
        D5 --&gt; E
        D6 --&gt; E
        D7 --&gt; E
        D8 --&gt; E
        D9 --&gt; E
    end
  
    style A1 fill:#f9f,stroke:#333,stroke-width:2px
    style A2 fill:#bbf,stroke:#333,stroke-width:2px
    style A3 fill:#bfb,stroke:#333,stroke-width:2px
    style A4 fill:#fdd,stroke:#333,stroke-width:2px
  
    style C1 fill:#ddd,stroke:#333,stroke-width:2px
    style C2 fill:#aaf,stroke:#333,stroke-width:2px
    style C3 fill:#afa,stroke:#333,stroke-width:2px
</code></pre>
<h3 data-id="heading-3">ğŸ” Javaç‰ˆï¼šç»™ç”µå½±é™¢è£…ä¸ªæ™ºèƒ½å®‰æ£€ç³»ç»Ÿ</h3>
<p>å¦‚æœä½ ç”¨Javaå¼€å‘ï¼ŒSpring Securityæ—©å°±ç»™ä½ å‡†å¤‡å¥½äº†"ç°æˆçš„æƒé™ç®¡ç†å®‰æ£€é—¨"ï¼ç›´æ¥é…ç½®è§’è‰²æƒé™å°±è¡Œï¼Œç®€å•åˆ°å“­â€”â€”</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CinemaSecurityConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> SecurityFilterChain <span class="hljs-title function_">securityFilterChain</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception {
        http.authorizeHttpRequests()
            <span class="hljs-comment">// VIPå…åªæœ‰VIPè§’è‰²èƒ½è¿›ï¼ˆå°±åƒVIPé€šé“ï¼Œæ™®é€šè§‚ä¼—è¿›ä¸å»ï¼‰</span>
            .antMatchers(<span class="hljs-string">"/cinema/vip/**"</span>).hasRole(<span class="hljs-string">"VIP"</span>)
            <span class="hljs-comment">// IMAXå…æ™®é€šè§‚ä¼—å’ŒVIPéƒ½èƒ½è¿›ï¼ˆIMAXå…æ¯”è¾ƒè´µï¼Œä½†å¤§å®¶éƒ½èƒ½ä¹°ï¼‰</span>
            .antMatchers(<span class="hljs-string">"/cinema/imax/**"</span>).hasAnyRole(<span class="hljs-string">"VIP"</span>, <span class="hljs-string">"NORMAL"</span>)
            <span class="hljs-comment">// å…¬å…±åŒºåŸŸéšä¾¿è¿›ï¼ˆçˆ†ç±³èŠ±æŸœå°ã€æ´—æ‰‹é—´ä¸éœ€è¦æƒé™ï¼‰</span>
            .antMatchers(<span class="hljs-string">"/cinema/public/**"</span>).permitAll()
            <span class="hljs-comment">// å…¶ä»–æ‰€æœ‰åŒºåŸŸéƒ½éœ€è¦è®¤è¯</span>
            .anyRequest().authenticated()
            .and()
            <span class="hljs-comment">// é…ç½®ç™»å½•é¡µé¢</span>
            .formLogin();

        <span class="hljs-keyword">return</span> http.build();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> UserDetailsService <span class="hljs-title function_">userDetailsService</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// åˆ›å»ºç”¨æˆ·å’Œè§’è‰²ï¼ˆç›¸å½“äºç”µå½±ç¥¨æ•°æ®åº“ï¼‰</span>
        <span class="hljs-type">UserDetails</span> <span class="hljs-variable">vipUser</span> <span class="hljs-operator">=</span> User.withUsername(<span class="hljs-string">"xiaoming"</span>)
            .password(<span class="hljs-string">"{bcrypt}$2a$10$dxj3sw6g7p50lgmmkkmwe.20cqqubk3.hzwzg3yb1tlry.fqvm/bg"</span>) <span class="hljs-comment">// å¯†ç å·²åŠ å¯†</span>
            .roles(<span class="hljs-string">"VIP"</span>)  <span class="hljs-comment">// å°æ˜æ˜¯VIPè§‚ä¼—</span>
            .build();

        <span class="hljs-type">UserDetails</span> <span class="hljs-variable">normalUser</span> <span class="hljs-operator">=</span> User.withUsername(<span class="hljs-string">"laowang"</span>)
            .password(<span class="hljs-string">"{bcrypt}$2a$10$dxj3sw6g7p50lgmmkkmwe.20cqqubk3.hzwzg3yb1tlry.fqvm/bg"</span>) <span class="hljs-comment">// å¯†ç å·²åŠ å¯†</span>
            .roles(<span class="hljs-string">"NORMAL"</span>)  <span class="hljs-comment">// è€ç‹æ˜¯æ™®é€šè§‚ä¼—</span>
            .build();

        <span class="hljs-comment">// å†…å­˜ç”¨æˆ·ç®¡ç†å™¨ï¼ˆå®é™…é¡¹ç›®ä¸­åº”è¯¥è¿æ¥æ•°æ®åº“ï¼‰</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryUserDetailsManager</span>(vipUser, normalUser);
    }
}
</code></pre>
<p><strong>è¿™æ®µä»£ç åˆ°åº•å¹²äº†ä»€ä¹ˆï¼Ÿ</strong> ğŸ¤”</p>
<ol>
<li>å®šä¹‰äº†ä¸åŒ"å½±å…"ï¼ˆURLè·¯å¾„ï¼‰çš„è®¿é—®è§„åˆ™</li>
<li>åˆ›å»ºäº†ä¸¤ä¸ª"è§‚ä¼—"ï¼ˆç”¨æˆ·ï¼‰å¹¶åˆ†é…äº†ä¸åŒçš„"ç¥¨ç§"ï¼ˆè§’è‰²ï¼‰</li>
<li>å½“ç”¨æˆ·è®¿é—®ç³»ç»Ÿæ—¶ï¼ŒSpring Securityä¼šè‡ªåŠ¨æ£€æŸ¥ä»–ä»¬çš„è§’è‰²ï¼Œå†³å®šä»–ä»¬èƒ½è¿›å“ªäº›åŒºåŸŸ</li>
</ol>
<p>å°±åƒç”µå½±é™¢é—¨å£çš„æ™ºèƒ½å®‰æ£€ç³»ç»Ÿï¼Œåˆ·ä¸€ä¸‹ç¥¨å°±çŸ¥é“ä½ èƒ½è¿›å“ªä¸ªå…ï¼ğŸšª</p>
<h3 data-id="heading-4">ğŸ­ RBACçš„å››ç§"è±ªåå½±å…"ï¼šä»ç»æµèˆ±åˆ°ç§äººå½±é™¢</h3>
<p>RBACå®¶æ—ä¸€å…±æœ‰å››ä¸ªæˆå‘˜ï¼Œå°±åƒç”µå½±é™¢é‡Œçš„å››ç§ä¸åŒæ¡£æ¬¡çš„å½±å…ï¼Œå„æœ‰å„çš„ç‰¹ç‚¹ï¼Œæ»¡è¶³ä¸åŒè§„æ¨¡ç³»ç»Ÿçš„éœ€æ±‚ï¼š</p>
<h4 data-id="heading-5">ğŸ›« RBAC0ï¼šç»æµèˆ±åŸºç¡€æ¬¾ - å°å½±é™¢é¦–é€‰ï¼</h4>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼šæœ€ç®€å•çš„"ç”¨æˆ·-è§’è‰²-æƒé™"ä¸‰å±‚æ˜ å°„</p>
<ul>
<li>å°±åƒé£æœºçš„ç»æµèˆ±ï¼Œè™½ç„¶ç®€å•ï¼Œä½†èƒ½æ»¡è¶³åŸºæœ¬éœ€æ±‚âœˆï¸</li>
<li>80%çš„ä¸­å°å‹ç³»ç»Ÿç”¨å®ƒå°±å¤Ÿäº†ï¼</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå°å‹é¡¹ç›®ã€åˆåˆ›å…¬å¸ã€å†…éƒ¨ç®¡ç†ç³»ç»Ÿ</li>
</ul>
<h4 data-id="heading-6">ğŸ‘‘ RBAC1ï¼šVIPå…å‡çº§æ¬¾ - å¸¦ç»§æ‰¿åŠŸèƒ½çš„é«˜çº§è´§ï¼</h4>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼šåœ¨RBAC0åŸºç¡€ä¸Šå¢åŠ äº†"è§’è‰²ç»§æ‰¿"åŠŸèƒ½</p>
<ul>
<li>å°±åƒä¹°äº†VIPå…çš„ç¥¨ï¼Œè‡ªç„¶ä¹Ÿèƒ½å»æ™®é€šå…ï¼ˆæƒé™å‘ä¸‹ç»§æ‰¿ï¼‰</li>
<li>ä½†æ™®é€šå…è§‚ä¼—ç»å¯¹è¿›ä¸å»VIPåŒºï¼ˆæƒé™ä¸èƒ½å‘ä¸Šç»§æ‰¿ï¼‰</li>
<li>é€‚åˆæœ‰æ˜ç¡®èŒçº§ä½“ç³»çš„ä¼ä¸š</li>
</ul>
<p>è§’è‰²ç»§æ‰¿å…³ç³»å›¾ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b73499f39ab410a9826947490946cd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764858848&amp;x-signature=GuH6Yoz%2Bqt7EABv24P0uFoGR45g%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">ğŸ« RBAC2ï¼šå¸¦ä¸¥æ ¼æ£€ç¥¨å‘˜çš„å®‰å…¨å‡çº§ç‰ˆ</h4>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼šå¢åŠ äº†å„ç§é™åˆ¶è§„åˆ™ï¼Œå°±åƒç”µå½±é™¢æœ‰äº†ä¸¥æ ¼çš„æ£€ç¥¨å‘˜</p>





























<table><thead><tr><th>çº¦æŸç±»å‹</th><th>ç”µå½±é™¢ä¾‹å­</th><th>ç³»ç»Ÿä¸­çš„åº”ç”¨</th><th>å®‰å…¨çº§åˆ«</th></tr></thead><tbody><tr><td><strong>è§’è‰²äº’æ–¥</strong></td><td>ä¸èƒ½åŒæ—¶ä¹°"æ™®é€šå…"å’Œ"VIPå…"çš„ç¥¨</td><td>ä¸€ä¸ªç”¨æˆ·ä¸èƒ½åŒæ—¶æ‹¥æœ‰"è´¢åŠ¡å®¡æ ¸"å’Œ"è´¢åŠ¡ä»˜æ¬¾"æƒé™</td><td>ğŸ”ğŸ”ğŸ”ğŸ”ğŸ”</td></tr><tr><td><strong>åŸºæ•°çº¦æŸ</strong></td><td>VIPå…æœ€å¤šå–20å¼ ç¥¨</td><td>ç®¡ç†å‘˜è§’è‰²æœ€å¤šåªèƒ½åˆ†é…ç»™5ä¸ªç”¨æˆ·</td><td>ğŸ”ğŸ”ğŸ”</td></tr><tr><td><strong>å…ˆå†³æ¡ä»¶</strong></td><td>ä¹°IMAXç¥¨å¿…é¡»å…ˆä¹°è¿‡æ™®é€šç¥¨</td><td>è¦è·å¾—"ç»ç†"è§’è‰²å¿…é¡»å…ˆæœ‰"æ™®é€šå‘˜å·¥"è§’è‰²</td><td>ğŸ”ğŸ”ğŸ”ğŸ”</td></tr></tbody></table>
<p>å°±åƒç”µå½±é™¢è§„å®š"1ç±³2ä»¥ä¸‹å„¿ç«¥ä¸èƒ½çœ‹Rçº§ç‰‡"ï¼ŒRBAC2è®©ä½ çš„æƒé™ç®¡ç†æ›´å®‰å…¨ğŸ”’</p>
<h4 data-id="heading-8">ğŸ† RBAC3ï¼šç§äººå®šåˆ¶å½±é™¢ - ä¼ä¸šçº§è±ªåå¥—é¤ï¼</h4>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼šRBAC1 + RBAC2 = å®‡å®™æ— æ•Œè±ªåç‰ˆ</p>
<ul>
<li>æ—¢æœ‰è§’è‰²ç»§æ‰¿çš„ä¾¿åˆ©æ€§ï¼Œåˆæœ‰ä¸¥æ ¼çš„æƒé™çº¦æŸ</li>
<li>å°±åƒç§äººå®šåˆ¶å½±é™¢ï¼Œæ—¢èƒ½äº«å—æ‰€æœ‰æ”¾æ˜ æŠ€æœ¯ï¼Œåˆèƒ½ä¸¥æ ¼æ§åˆ¶å…¥åœºäººæ•°</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤§å‹ä¼ä¸šã€é‡‘èç³»ç»Ÿã€éœ€è¦ä¸¥æ ¼æƒé™æ§åˆ¶çš„å¤æ‚åº”ç”¨</li>
</ul>
<h3 data-id="heading-9">ğŸ“Š RBACå››ç§æ¨¡å‹è¯¦ç»†å¯¹æ¯”è¡¨</h3>


















































<table><thead><tr><th align="left"><strong>æ¨¡å‹ç‰ˆæœ¬</strong></th><th align="left"><strong>æ ¸å¿ƒç‰¹ç‚¹</strong></th><th align="left"><strong>å¤æ‚åº¦</strong></th><th align="left"><strong>é€‚ç”¨åœºæ™¯</strong></th><th align="left"><strong>å¼€å‘éš¾åº¦</strong></th><th align="left"><strong>ç”µå½±é™¢ç±»æ¯”</strong></th><th align="left"><strong>æ¨èæŒ‡æ•°</strong></th></tr></thead><tbody><tr><td align="left"><strong>RBAC0</strong></td><td align="left">ç”¨æˆ·-è§’è‰²-æƒé™ä¸‰å±‚æ˜ å°„</td><td align="left">â­â­</td><td align="left">å°å‹é¡¹ç›®ã€åˆåˆ›å…¬å¸ã€å†…éƒ¨ç®¡ç†ç³»ç»Ÿ</td><td align="left">ğŸ’»</td><td align="left">ç»æµèˆ±/æ™®é€šå½±å…</td><td align="left">ğŸŒŸğŸŒŸğŸŒŸ</td></tr><tr><td align="left"><strong>RBAC1</strong></td><td align="left">RBAC0 + è§’è‰²ç»§æ‰¿åŠŸèƒ½</td><td align="left">â­â­â­</td><td align="left">æœ‰èŒçº§ä½“ç³»çš„ä¼ä¸š</td><td align="left">ğŸ’»ğŸ’»</td><td align="left">VIPå…</td><td align="left">ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</td></tr><tr><td align="left"><strong>RBAC2</strong></td><td align="left">RBAC0 + çº¦æŸè§„åˆ™</td><td align="left">â­â­â­</td><td align="left">å®‰å…¨è¦æ±‚é«˜çš„ç³»ç»Ÿ</td><td align="left">ğŸ’»ğŸ’»ğŸ’»</td><td align="left">å¸¦ä¸¥æ ¼æ£€ç¥¨å‘˜çš„å½±å…</td><td align="left">ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ</td></tr><tr><td align="left"><strong>RBAC3</strong></td><td align="left">RBAC1 + RBAC2</td><td align="left">â­â­â­â­â­</td><td align="left">å¤§å‹å¤æ‚ä¼ä¸šç³»ç»Ÿ</td><td align="left">ğŸ’»ğŸ’»ğŸ’»ğŸ’»ğŸ’»</td><td align="left">ç§äººå®šåˆ¶å½±é™¢</td><td align="left">ğŸŒŸğŸŒŸğŸŒŸ</td></tr></tbody></table>
<p><strong>é€‰æ‹©å»ºè®®</strong>ï¼š</p>
<ul>
<li>åˆåˆ›é¡¹ç›®/å°å›¢é˜Ÿï¼šä»RBAC0å¼€å§‹ï¼ŒåæœŸæ ¹æ®éœ€æ±‚å‡çº§åˆ°RBAC1</li>
<li>ä¸­å¤§å‹ä¼ä¸šï¼šRBAC1æˆ–RBAC2æ˜¯å¹³è¡¡å®‰å…¨æ€§å’Œå¤æ‚åº¦çš„æœ€ä½³é€‰æ‹©</li>
<li>é‡‘è/åŒ»ç–—ç­‰æ•æ„Ÿè¡Œä¸šï¼šå»ºè®®ä½¿ç”¨RBAC2ä»¥æ»¡è¶³åˆè§„è¦æ±‚</li>
<li>è¶…å¤§ç³»ç»Ÿï¼šRBAC3è™½ç„¶åŠŸèƒ½æœ€å…¨ï¼Œä½†å¼€å‘ç»´æŠ¤æˆæœ¬é«˜ï¼Œéœ€è°¨æ…é€‰æ‹©</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/251b4cf15880403b82cd7755b968e824~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764858848&amp;x-signature=AMpU%2FOSy%2B3M6EZ6sb33LKWOeQHE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-10">âš ï¸ é¿å‘æŒ‡å—ï¼šåˆ«è®©ä½ çš„RBACå˜æˆ"çƒ‚ç‰‡"ï¼</h3>
<h4 data-id="heading-11">ğŸš¨ å‘ä¸€ï¼šè§’è‰²çˆ†ç‚¸ - ä½ çš„ç³»ç»Ÿé‡Œæœ‰1000ä¸ªè§’è‰²å—ï¼Ÿ</h4>
<p>æŸé“¶è¡Œç³»ç»Ÿçš„å·¥ç¨‹å¸ˆçªå‘å¥‡æƒ³ï¼š"æŠŠæ¯ä¸ªå²—ä½éƒ½è®¾æˆç‹¬ç«‹è§’è‰²å§ï¼"ç»“æœâ€”â€”</p>
<ul>
<li>"ä¸Šæµ·å¾æ±‡åŒºå®¢æˆ·ç»ç†"</li>
<li>"åŒ—äº¬æœé˜³åŒºå®¢æˆ·ç»ç†"</li>
<li>"å¹¿å·å¤©æ²³åŒºå®¢æˆ·ç»ç†"</li>
<li>...</li>
</ul>
<p>ç³»ç»Ÿé‡Œå‡ºç°äº†200å¤šä¸ªç±»ä¼¼è§’è‰²ï¼Œç®¡ç†å‘˜éƒ½å¿«è¢«é€¼ç–¯äº†ï¼ğŸ˜µâ€ğŸ’«</p>
<p><strong>æ­£ç¡®å§¿åŠ¿</strong>ï¼šè§’è‰²æŒ‰èŒè´£åˆ’åˆ†ï¼ŒåŒºåŸŸä½œä¸ºæ•°æ®æƒé™æ§åˆ¶ï¼ğŸŒ</p>
<h4 data-id="heading-12">ğŸš¨ å‘äºŒï¼šæƒé™ç²’åº¦è¿‡ç²— - "è¦ä¹ˆå…¨æœ‰è¦ä¹ˆå…¨æ— "çš„å™©æ¢¦</h4>
<p>å°±åƒç”µå½±é™¢åªå–"è§‚å½±æƒ"ï¼Œå´ä¸ç»†åˆ†"3Dçœ¼é•œç§Ÿèµæƒ"ã€"ä¸­é€”ç¦»åœºå†å…¥åœºæƒ"...</p>
<p><strong>æƒé™è®¾è®¡åº”è¯¥ç²¾ç»†åˆ°æŒ‰é’®çº§åˆ«</strong>ï¼š</p>
<ul>
<li>"æŸ¥çœ‹è®¢å•"å’Œ"å¯¼å‡ºè®¢å•"æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æƒé™</li>
<li>"ç¼–è¾‘ä¸ªäººèµ„æ–™"å’Œ"ä¿®æ”¹è–ªèµ„æ•°æ®"æ›´æ˜¯å¤©å£¤ä¹‹åˆ«</li>
</ul>
<h4 data-id="heading-13">ğŸš¨ å‘ä¸‰ï¼šå¿½è§†å®¡è®¡ - "è°åŠ¨äº†æˆ‘çš„æƒé™è›‹ç³•ï¼Ÿ"</h4>
<p>æ²¡æœ‰æ—¥å¿—è®°å½•çš„RBACå°±åƒæ²¡æœ‰ç›‘æ§çš„å½±é™¢ï¼Œå‡ºäº†é—®é¢˜æ‰¾ä¸åˆ°è´£ä»»äººï¼</p>
<p><strong>ä¸€å®šè¦è®°å½•</strong>ï¼š<strong>è°åœ¨ä»€ä¹ˆæ—¶å€™ç”¨äº†ä»€ä¹ˆæƒé™</strong> ğŸ•µï¸â€â™‚ï¸</p>
<h3 data-id="heading-14">ğŸ† å¤§å‚éƒ½æ˜¯æ€ä¹ˆè®¾è®¡æƒé™çš„ï¼Ÿ</h3>
<h4 data-id="heading-15">ğŸ’° SAPç³»ç»Ÿï¼šè´¢åŠ¡æƒé™çš„"åˆ†çº§å”®ç¥¨çª—å£"</h4>
<p>SAPæŠŠè´¢åŠ¡ç³»ç»Ÿåˆ†æˆäº†ç²¾ç»†çš„æƒé™å±‚çº§ï¼š</p>
<ul>
<li>"ä¼šè®¡"è§’è‰²åªèƒ½"å½•å‡­è¯"</li>
<li>"è´¢åŠ¡ç»ç†"è§’è‰²èƒ½"å½•å‡­è¯+å®¡æ‰¹"</li>
<li>"è´¢åŠ¡æ€»ç›‘"è§’è‰²æ‹¥æœ‰å…¨éƒ¨æƒé™</li>
</ul>
<p>å°±åƒç”µå½±é™¢çš„å”®ç¥¨çª—å£åˆ†"æ™®é€šç¥¨çª—å£"å’Œ"VIPä¸“å±çª—å£"ï¼Œæ—¢é¿å…è¶Šæƒæ“ä½œï¼Œåˆä¿è¯å·¥ä½œæµé¡ºç•…ã€‚</p>
<h4 data-id="heading-16">â˜ï¸ AWS IAMï¼šäº‘èµ„æºçš„"åŠ¨æ€åº§ä½å›¾"</h4>
<p>AWSçš„æƒé™ç³»ç»Ÿç²¾ç»†åˆ°è®©äººæƒŠå¹ï¼š</p>
<ul>
<li>ç®¡ç†å‘˜/å¼€å‘/åªè¯»è§’è‰²æ˜ç¡®åˆ†ç¦»</li>
<li>EC2å®ä¾‹çš„"å¯åŠ¨/åœæ­¢/æŸ¥çœ‹"æƒé™ç²¾ç¡®åˆ°APIçº§åˆ«</li>
<li>S3å­˜å‚¨æ¡¶çš„"ä¸Šä¼ /ä¸‹è½½/åˆ é™¤"æƒé™å¯æŒ‰æ–‡ä»¶å¤¹è®¾ç½®</li>
</ul>
<p>è¿™å¥½æ¯”IMAXå…ä¸ä»…åˆ†åº§ä½ï¼Œè¿˜æŒ‰åº§ä½æä¾›ä¸åŒæœåŠ¡ï¼ˆå‰æ’é€è€³æœºï¼Œåæ’é€é å«ï¼‰ï¼Œå®ç°äº†çœŸæ­£çš„ç²¾ç»†åŒ–æƒé™ç®¡æ§ï¼</p>
<h4 data-id="heading-17">ğŸš¢ Kubernetesï¼šå®¹å™¨é›†ç¾¤çš„"å½±å…åˆ†åŒºç³»ç»Ÿ"</h4>
<p>K8sçš„æƒé™æ§åˆ¶å ªç§°æ•™ç§‘ä¹¦çº§åˆ«ï¼š</p>
<ul>
<li>ClusterRoleå®šä¹‰"pod-reader"è§’è‰²ï¼Œå…è®¸å¼€å‘äººå‘˜æŸ¥çœ‹ä½†ä¸èƒ½åˆ é™¤å®¹å™¨</li>
<li>é€šè¿‡RoleBindingç»‘å®šåˆ°ç‰¹å®šå‘½åç©ºé—´</li>
<li>å³ä½¿éƒ½æ˜¯"è§‚ä¼—"ï¼Œä¹Ÿä¸¥æ ¼é™åˆ¶åœ¨è‡ªå·±çš„"å½±å…"é‡Œ</li>
</ul>
<p>å°±åƒç”µå½±é™¢æŠŠ"IMAXå…"å’Œ"æ™®é€šå…"ç‰©ç†éš”ç¦»ï¼Œé˜²æ­¢æœ‰äººä¸²å…æäº‹æƒ…ï¼ğŸ”’</p>
<p><strong>åˆ’é‡ç‚¹</strong>ï¼šå°±ç®—æ˜¯å¥½æ¨¡å‹ï¼Œç”¨ä¸å¥½ä¹Ÿä¼šç¿»è½¦ã€‚ä¸Šé¢è¿™ä¸‰ä¸ªå‘ï¼Œä¸€å®šè¦é¿å¼€ï¼</p>
<h3 data-id="heading-18">ğŸš€ ç»“è¯­ï¼šä»"æ‰‹å·¥ä½œåŠ"åˆ°"æ™ºèƒ½å½±é™¢"çš„æƒé™ç®¡ç†è¿›åŒ–ï¼</h3>
<p>RBACæ¨¡å‹çš„ä¼Ÿå¤§ä¹‹å¤„ï¼Œåœ¨äºå®ƒæŠŠæƒé™ç®¡ç†ä»"å–æ•£è£…åº§ä½"å˜æˆäº†"åˆ†åŒºå”®ç¥¨ç³»ç»Ÿ"ã€‚å½“ä½ ä¸‹æ¬¡å†ä¸ºæƒé™é…ç½®æŠ“ç‹‚æ—¶ï¼Œæƒ³æƒ³ç”µå½±é™¢çš„ä¾‹å­ï¼š<strong>ç”¨æˆ·æ˜¯è§‚ä¼—ï¼Œè§’è‰²æ˜¯ç¥¨ç§ï¼Œæƒé™æ˜¯åº§ä½å’ŒæœåŠ¡</strong>ã€‚</p>
<p>æœ€åé€å¤§å®¶ä¸€ä¸ªRBACå®æ–½ Checklistï¼š</p>
<p>âœ… <strong>å…ˆæ¢³ç†å…¬å¸çš„ç»„ç»‡æ¶æ„</strong>ï¼ˆç›¸å½“äºå½±é™¢å¹³é¢å›¾ï¼‰
âœ… <strong>æŒ‰èŒè´£åˆ’åˆ†è§’è‰²</strong>ï¼ˆè®¾è®¡ç¥¨ç§ï¼‰
âœ… <strong>ç»™è§’è‰²åˆ†é…æœ€å°å¿…è¦æƒé™</strong>ï¼ˆé¿å…è¿‡åº¦æˆæƒï¼‰
âœ… <strong>å®šæœŸå®¡è®¡è§’è‰²å’Œæƒé™</strong>ï¼ˆæŸ¥ç¥¨æ ¹ï¼‰</p>
<p>ç°åœ¨ï¼Œæ˜¯æ—¶å€™æŠŠä½ çš„ç³»ç»Ÿæƒé™ç®¡ç†ä»"é»„ç‰›ç¥¨æ—¶ä»£"å‡çº§åˆ°"æ™ºèƒ½å½±é™¢æ—¶ä»£"äº†ï¼ğŸ¬ äº«å—è¿™ç§å¦‚ä¸èˆ¬é¡ºæ»‘çš„æƒé™ç®¡ç†ä½“éªŒå§ï¼</p>
<blockquote>
<p>ğŸ’¡ <strong>æ€è€ƒé¢˜</strong>ï¼šå¦‚æœæŠŠABACæ¨¡å‹ï¼ˆåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼‰æ¯”ä½œ"åŠ¨æ€ç¥¨ä»·ç³»ç»Ÿ"ï¼ˆå¦‚å‘¨äºŒåŠä»·ã€å­¦ç”ŸæŠ˜æ‰£ï¼‰ï¼Œå®ƒå’ŒRBACä¼šæ“¦å‡ºä»€ä¹ˆç«èŠ±ï¼Ÿè¯„è®ºåŒºè¯´è¯´ä½ çš„æƒ³æ³•ï¼ğŸ‘‡ è¯´ä¸å®šä½ çš„æƒ³æ³•ä¼šå¯å‘ä¸‹ä¸€ç¯‡ç²¾å½©æ–‡ç« å“¦ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Transporter åœ¨ iOS ä¸Šæ¶æµç¨‹ä¸­çš„è§’è‰²å˜åŒ– æœ¬åœ°ä¸Šä¼ å·¥å…·çš„å®šä½ã€å±€é™ä¸å¤šå·¥å…·åä½œè¶‹åŠ¿åˆ†æ]]></title>    <link>https://juejin.cn/post/7577430671947841562</link>    <guid>https://juejin.cn/post/7577430671947841562</guid>    <pubDate>2025-11-28T08:38:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577430671947841562" data-draft-id="7577438119558692915" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Transporter åœ¨ iOS ä¸Šæ¶æµç¨‹ä¸­çš„è§’è‰²å˜åŒ– æœ¬åœ°ä¸Šä¼ å·¥å…·çš„å®šä½ã€å±€é™ä¸å¤šå·¥å…·åä½œè¶‹åŠ¿åˆ†æ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-28T08:38:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç–¯ç‹‚çš„ç¨‹åºçŒ´"/> <meta itemprop="url" content="https://juejin.cn/user/2760245749234147"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Transporter åœ¨ iOS ä¸Šæ¶æµç¨‹ä¸­çš„è§’è‰²å˜åŒ– æœ¬åœ°ä¸Šä¼ å·¥å…·çš„å®šä½ã€å±€é™ä¸å¤šå·¥å…·åä½œè¶‹åŠ¿åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2760245749234147/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç–¯ç‹‚çš„ç¨‹åºçŒ´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T08:38:40.000Z" title="Fri Nov 28 2025 08:38:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨è‹¹æœçš„ç”Ÿæ€ä½“ç³»é‡Œï¼ŒTransporter é•¿æœŸè¢«è§†ä¸ºå¼€å‘è€…å°† IPA ä¸ App å…ƒæ•°æ®ä¸Šä¼ è‡³ App Store çš„æ ¸å¿ƒå·¥å…·ä¹‹ä¸€ã€‚å®ƒæœ€åˆè¢«è®¾è®¡ç”¨äºæ›¿ä»£ Application Loaderï¼Œä¸ºéå¼€å‘äººå‘˜ï¼ˆå¦‚è¿è¥ã€å†…å®¹å›¢é˜Ÿï¼‰æä¾›ç›¸å¯¹ç›´è§‚çš„å¯è§†åŒ–ä¸Šä¼ èƒ½åŠ›ã€‚
ç„¶è€Œéšç€å¼€å‘å›¢é˜Ÿå·¥ä½œç¯å¢ƒçš„å¤šå…ƒåŒ–ï¼ˆè·¨å¹³å°æ„å»ºã€äº‘ç«¯ CIã€Windows ä¸»åŠ›ç ”å‘æœºç­‰ï¼‰ï¼ŒTransporter çš„åœ°ä½æ­£åœ¨æ‚„ç„¶å‘ç”Ÿå˜åŒ–ï¼šå®ƒä»ç„¶é‡è¦ï¼Œä½†ä¸å†æ˜¯â€œå”¯ä¸€æ­£é€”â€ã€‚</p>
<p>æœ¬æ–‡è¯•å›¾ä»å·¥ç¨‹ç»„ç»‡ä¸å·¥å…·é“¾åä½œçš„è§’åº¦ï¼Œé‡æ–°å®¡è§† Transporter åœ¨ç°ä»£ iOS ä¸Šæ¶æµç¨‹ä¸­çš„å®šä½ï¼ŒåŒæ—¶æ‹†è§£å…¶å±€é™ã€é€‚ç”¨åœºæ™¯ä¸ä¸å…¶ä»–å·¥å…·çš„åä½œæ–¹å¼ã€‚</p>
<hr/>
<h2 data-id="heading-0"><strong>ä¸€ã€Transporter çš„è®¾è®¡åˆè¡·ï¼šå¼¥è¡¥ Xcode Organizer çš„ä¸è¶³</strong></h2>
<p>Xcode Organizer ä¸€ç›´æ˜¯å®˜æ–¹æ¨èçš„ä¸Šä¼ æ–¹å¼ï¼Œä½†å®ƒå­˜åœ¨ä¸‰ä¸ªæ˜¾è‘—å±€é™ï¼š</p>
<ol>
<li>å¿…é¡»ä½¿ç”¨ Mac</li>
<li>å¿…é¡»å®‰è£… Xcode</li>
<li>æ›´åå‘å¼€å‘è€…ï¼Œè€Œéè¿è¥å›¢é˜Ÿ</li>
</ol>
<p>Transporter ä½œä¸ºç‹¬ç«‹ Mac åº”ç”¨ï¼Œä½¿å‘½æ˜¯ï¼š</p>
<ul>
<li><strong>è®©ä¸Šä¼ ä¸ä¾èµ– Xcode</strong></li>
<li><strong>è®©è¿è¥äººå‘˜ä¹Ÿèƒ½æ‰§è¡Œä¸Šä¼ </strong></li>
<li><strong>æ”¯æŒæ‹–æ‹½ IPA ä¸å…ƒæ•°æ®</strong></li>
<li><strong>æ˜¾ç¤ºæ›´ç›´è§‚çš„ä¸Šä¼ æ—¥å¿—</strong></li>
</ul>
<p>åœ¨ä¼ä¸šå·¥ä½œæµä¸­ï¼ŒTransporter çš„å‡ºç°æ„ä¹‰åœ¨äºï¼š
<strong>å®ƒæŠŠâ€œä¸Šä¼ â€ä»å¼€å‘å²—è§£æ”¾äº†å‡ºæ¥ã€‚</strong></p>
<hr/>
<h2 data-id="heading-1"><strong>äºŒã€Transporter çš„ä¼˜åŠ¿ï¼šæ¸…æ™°ã€ç¨³å®šã€å®˜æ–¹ã€é€‚åˆæ‰‹å·¥æäº¤</strong></h2>
<p>Transporter çš„å¼ºé¡¹å¾ˆæ˜ç¡®ï¼š</p>
<h3 data-id="heading-2"><strong>1. æ“ä½œæ¸…æ™°</strong></h3>
<ul>
<li>æ‹–æ‹½ ipa</li>
<li>å¡«å†™ Apple ID</li>
<li>ç­‰å¾…ä¸Šä¼ å®Œæˆ</li>
</ul>
<p>é€‚åˆä¸ç†Ÿæ‚‰å‘½ä»¤è¡Œçš„äººã€‚</p>
<hr/>
<h3 data-id="heading-3"><strong>2. å®˜æ–¹æ”¯æŒï¼Œé”™è¯¯æ—¥å¿—æ¯”è¾ƒè§„èŒƒ</strong></h3>
<p>ä¸Šä¼ å¤±è´¥æ—¶å¸¸è§ï¼š</p>
<ul>
<li>è¯ä¹¦é—®é¢˜</li>
<li>å…ƒæ•°æ®é—®é¢˜</li>
<li>é€šé“é—®é¢˜</li>
<li>åŒ…æ ¼å¼å¼‚å¸¸</li>
</ul>
<p>Transporter çš„æŠ¥é”™é€šå¸¸èƒ½å‡†ç¡®æŒ‡å‘é—®é¢˜æ¥æºã€‚</p>
<hr/>
<h3 data-id="heading-4"><strong>3. ç¨³å®šé€‚åˆä½œä¸ºâ€œæœ€ç»ˆä¸Šä¼ ç¯èŠ‚â€</strong></h3>
<p>è®¸å¤šå›¢é˜Ÿåœ¨æ„å»ºè‡ªåŠ¨åŒ–ä¹‹åï¼š</p>
<ul>
<li>æ„å»º â†’ è‡ªåŠ¨æµ‹è¯•</li>
<li>ä¸Šä¼  â†’ æ‰‹å·¥ç”¨ Transporter</li>
</ul>
<p>å°†ä¸Šä¼ ä¸å‘å¸ƒè¿™ä¸€ç¯èŠ‚ç•™ç»™æ›´å¯é ã€äººå·¥ç¡®è®¤çš„å·¥å…·ã€‚</p>
<hr/>
<h2 data-id="heading-5"><strong>ä¸‰ã€Transporter çš„å±€é™ä¹Ÿæ˜æ˜¾ï¼šMac å•å¹³å°æ˜¯æœ€å¤§é™åˆ¶</strong></h2>
<p>éšç€å›¢é˜Ÿè§„æ¨¡æ‰©å¤§ã€è·¨å¹³å°æŠ€æœ¯å¢å¼ºã€CI/CD æ™®åŠï¼Œæœ¬åœ° Mac å·¥å…·çš„é™åˆ¶è¶Šå‘æ˜æ˜¾ï¼š</p>
<hr/>
<h3 data-id="heading-6"><strong>1. å¼ºä¾èµ– Mac</strong></h3>
<p>è¿™æ˜¯ Transporter æœ€å¤§çš„ç»“æ„æ€§é—®é¢˜ã€‚</p>
<ul>
<li>Windows æ— æ³•è¿è¡Œ</li>
<li>Linux æ— æ³•è¿è¡Œ</li>
<li>æœåŠ¡å™¨ç¯å¢ƒæ— æ³•è¿è¡Œ</li>
</ul>
<p>è¿™è®© Transporter æ— æ³•èå…¥è‡ªåŠ¨åŒ–æµæ°´çº¿ã€‚</p>
<hr/>
<h3 data-id="heading-7"><strong>2. ä¸é€‚åˆé«˜é¢‘å‘å¸ƒæˆ– TF è¿­ä»£</strong></h3>
<p>TestFlight æµ‹è¯•é€šå¸¸éœ€è¦é«˜é¢‘ä¸Šä¼ ï¼š</p>
<ul>
<li>Bug ä¿®å¤ä¸€å¤©å‘æ•°æ¬¡</li>
<li>å°ç‰ˆæœ¬æŒç»­è¿­ä»£</li>
<li>æ„å»ºæµæ°´çº¿è‡ªåŠ¨è§¦å‘ä¸Šä¼ </li>
</ul>
<p>Transporter çš„æ‹–æ‹½æ¨¡å¼å¹¶ä¸é€‚ç”¨ã€‚</p>
<hr/>
<h3 data-id="heading-8"><strong>3. å¤šäººåä½œå›°éš¾</strong></h3>
<p>å› ä¸º Transporter è¿è¡Œåœ¨æœ¬åœ°ï¼š</p>
<ul>
<li>æ— æ³•ä¿æŒä¸Šä¼ å†å²ç»Ÿä¸€</li>
<li>å¤šå°æœºå™¨éœ€è¦é‡å¤é…ç½®</li>
<li>ä¸èƒ½è¿›è¡Œé›†ä¸­åŒ–çš„å‘å¸ƒç®¡ç†</li>
</ul>
<p>è¿™åœ¨å¤§å‹å›¢é˜Ÿä¸­æ˜¯æ˜æ˜¾çŸ­æ¿ã€‚</p>
<hr/>
<h2 data-id="heading-9"><strong>å››ã€ç°ä»£å›¢é˜Ÿçš„ä¸Šä¼ ç­–ç•¥ï¼šTransporter + è·¨å¹³å° CLI çš„åˆ†å·¥åä½œ</strong></h2>
<p>Transporter å¹¶æœªè¢«å–ä»£ï¼Œä½†å®ƒçš„å®šä½å˜å¾—æ›´åŠ æ˜ç¡®ï¼š</p>
<h3 data-id="heading-10"><strong>Transporter çš„é€‚ç”¨åœºæ™¯ï¼š</strong></h3>
<ul>
<li>æœ¬åœ°è°ƒè¯•æ„å»ºä¸Šä¼ </li>
<li>è¿è¥äººå‘˜å¤„ç†å•æ¬¡æäº¤</li>
<li>ç‰ˆæœ¬å‘å¸ƒå‰çš„äººå·¥ç¡®è®¤</li>
<li>å°å›¢é˜Ÿä½é¢‘å‘å¸ƒ</li>
</ul>
<h3 data-id="heading-11"><strong>å¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰è·¨å¹³å°å‘½ä»¤è¡Œå·¥å…·çš„é€‚ç”¨åœºæ™¯ï¼š</strong></h3>
<ul>
<li>Windows / Linux ä¸Šæ¶</li>
<li>CI/CD è‡ªåŠ¨ä¸Šä¼ </li>
<li>é«˜é¢‘ TF æ„å»ºæäº¤</li>
<li>å…¨çƒå›¢é˜Ÿåä½œ</li>
<li>æ—  Mac ç¯å¢ƒ</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli \
  -u ios@team.com \
  -p xxx-xxx-xxx-xxx \
  -c 1 \
  -f build/app.ipa
</code></pre>
<p>è¿™ç§åˆ†å·¥ç»“æ„å·²æˆä¸ºè®¸å¤šè·¨ç«¯å›¢é˜Ÿçš„ä¸»æµæ¨¡å‹ã€‚</p>
<p>å›¾å½¢åŒ–ç•Œé¢ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aceb4b9904534862a210a89351bcc7e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC55qE56iL5bqP54y0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764923919&amp;x-signature=FQD6IGq8tHl4sGR2rZ8k7MoeDO4%3D" alt="ipaä¸Šä¼ " loading="lazy"/></p>
<hr/>
<h2 data-id="heading-12"><strong>äº”ã€å…¸å‹å›¢é˜Ÿçš„â€œä¸‰æ®µå¼ä¸Šä¼ é“¾è·¯â€ï¼šTransporter ä¸å†å­¤ç«‹å­˜åœ¨</strong></h2>
<p>ä¸€ä¸ªæˆç†Ÿçš„ iOS ä¸Šæ¶é“¾è·¯é€šå¸¸ä¼šæ‹†æˆä¸‰æ®µï¼š</p>
<hr/>
<h3 data-id="heading-13"><strong>ç¬¬ä¸€æ®µï¼šæ„å»ºï¼ˆBuildï¼‰</strong></h3>
<ul>
<li>æœ¬åœ° Xcode</li>
<li>CIï¼ˆGitHub Actions / Codemagicï¼‰</li>
<li>Hybrid / uni-app äº‘æ‰“åŒ…</li>
<li>Unity / Cocos Windows æ„å»º + äº‘æ„å»º</li>
</ul>
<p>æœ€ç»ˆå¾—åˆ° ipaã€‚</p>
<hr/>
<h3 data-id="heading-14"><strong>ç¬¬äºŒæ®µï¼šä¸Šä¼ ï¼ˆUploadï¼‰</strong></h3>
<p>æ ¹æ®å›¢é˜Ÿç¯å¢ƒï¼Œæœ‰ä¸‰ç§é€‰æ‹©ï¼š</p>
<ol>
<li><strong>Transporterï¼ˆMacï¼‰</strong></li>
<li><strong>Xcode Organizerï¼ˆMacï¼‰</strong></li>
<li><strong>å¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰è·¨å¹³å° CLIï¼ˆWindows / Linux / Macï¼‰</strong></li>
</ol>
<p>è¿™ä¸‰è€…å¹¶ä¸æ˜¯äº’æ–¥ï¼Œè€Œæ˜¯å¹¶å­˜ã€‚</p>
<hr/>
<h3 data-id="heading-15"><strong>ç¬¬ä¸‰æ®µï¼šå‘å¸ƒï¼ˆReleaseï¼‰</strong></h3>
<p>åœ¨ App Store Connect å®Œæˆï¼š</p>
<ul>
<li>æˆªå›¾</li>
<li>ç‰ˆæœ¬è¯´æ˜</li>
<li>éšç§æ ‡ç­¾</li>
<li>WWDR é…ç½®</li>
<li>æäº¤å®¡æ ¸</li>
</ul>
<p>Transporter ä»…è´Ÿè´£ç¬¬äºŒæ®µã€‚</p>
<hr/>
<h2 data-id="heading-16"><strong>å…­ã€Transporter çš„â€œæœªæ¥ä»·å€¼â€ï¼šä»æ ¸å¿ƒå·¥å…·è½¬å‘è¡¥ä½å·¥å…·</strong></h2>
<p>Transporter ä»ç„¶é‡è¦ï¼Œä½†å…¶è§’è‰²æ­£åœ¨å˜åŒ–ï¼š</p>
<h3 data-id="heading-17"><strong>ä»å¿…éœ€å·¥å…· â†’ å¯é€‰å·¥å…·</strong></h3>
<p>ä¸Šä¼ é€šé“ä¸å†ä»…æœ‰ Mac Appï¼Œç°ä»£ CLI å·¥å…·å·²è¦†ç›–å…¨å¹³å°ã€‚</p>
<hr/>
<h3 data-id="heading-18"><strong>ä»å¼€å‘è€…å·¥å…· â†’ è¿è¥å·¥å…·</strong></h3>
<p>è¿è¥ã€äº§å“ã€æµ‹è¯•æˆå‘˜å¸¸ä½¿ç”¨å®ƒå®Œæˆï¼š</p>
<ul>
<li>æ„å»ºä¸Šè½½</li>
<li>å…ƒæ•°æ®æ ¡éªŒ</li>
<li>äººå·¥ç¡®è®¤ç¯èŠ‚</li>
</ul>
<p>å¼€å‘è€…æ›´å¸¸ä½¿ç”¨è‡ªåŠ¨åŒ–æ–¹å¼ä¸Šä¼ ã€‚</p>
<hr/>
<h3 data-id="heading-19"><strong>ä»ä¸»åŠ›å·¥å…· â†’ å®¡æ ¸å‰çš„äººä¸ºå¤æ ¸èŠ‚ç‚¹</strong></h3>
<p>ä¸Šä¼ æµç¨‹è‡ªåŠ¨åŒ–ä¹‹åï¼ŒTransporter æˆä¸ºè¡¥ä½å·¥å…·ï¼Œç”¨äºï¼š</p>
<ul>
<li>æ‰‹åŠ¨æ ¡éªŒæ„å»º</li>
<li>å¤„ç†ä¸€æ¬¡æ€§ä¸´æ—¶ç‰ˆæœ¬</li>
<li>ç¡®è®¤è‡ªåŠ¨åŒ–é€šé“å¼‚å¸¸æ—¶çš„ fallback</li>
</ul>
<p>å®ƒåƒæœºåœºå¤‡ç”¨è·‘é“ï¼š
<strong>ä¸æ˜¯ä¸»è·‘é“ï¼Œä½†éå¸¸é‡è¦ã€‚</strong></p>
<hr/>
<h2 data-id="heading-20"><strong>Transporter åœ¨ç°ä»£ iOS ä¸Šæ¶æµç¨‹ä¸­çš„å®šä½æ›´æ¸…æ™°ï¼Œè€Œéè¢«æ›¿ä»£</strong></h2>
<p>Transporter çš„æ ¸å¿ƒä»·å€¼ä¾ç„¶å­˜åœ¨ï¼š</p>
<ul>
<li>å¯é </li>
<li>æ—¥å¿—è§„èŒƒ</li>
<li>é€‚åˆäººå·¥å®¡æŸ¥</li>
<li>æ˜¯ App Store å®˜æ–¹æ”¯æŒé“¾çš„ä¸€éƒ¨åˆ†</li>
</ul>
<p>ä½†åœ¨å¤šå¹³å°å›¢é˜Ÿä¸è‡ªåŠ¨åŒ–è¶‹åŠ¿ä¸‹ï¼Œå®ƒä¸å†æ‰¿æ‹…å”¯ä¸€èŒè´£ï¼Œè€Œæ˜¯æˆä¸ºæ•´ä¸ªä¸Šæ¶ä½“ç³»ä¸­çš„ <strong>â€œäººå·¥å¯æ§èŠ‚ç‚¹â€</strong>ï¼Œä¸è‡ªåŠ¨åŒ–ä¸Šä¼ å·¥å…·ã€CI æ„å»ºæµç¨‹å…±åŒç»„æˆå®Œæ•´çš„å·¥å…·é“¾ã€‚</p>
<p>è¿™æ˜¯ä¸€ç§æ›´åŠ æˆç†Ÿã€å·¥ç¨‹åŒ–çš„ç”Ÿæ€å‘å±•æ–¹å‘ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day 17ï¼š03. åŸºäº Tauri 2.0 å¼€å‘åå°ç®¡ç†ç³»ç»Ÿ-ç™»å½•é¡µé¢å¼€å‘]]></title>    <link>https://juejin.cn/post/7577587651893919785</link>    <guid>https://juejin.cn/post/7577587651893919785</guid>    <pubDate>2025-11-28T08:54:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577587651893919785" data-draft-id="7577563004481830966" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day 17ï¼š03. åŸºäº Tauri 2.0 å¼€å‘åå°ç®¡ç†ç³»ç»Ÿ-ç™»å½•é¡µé¢å¼€å‘"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-11-28T08:54:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”³é˜³"/> <meta itemprop="url" content="https://juejin.cn/user/4353721775165486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day 17ï¼š03. åŸºäº Tauri 2.0 å¼€å‘åå°ç®¡ç†ç³»ç»Ÿ-ç™»å½•é¡µé¢å¼€å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4353721775165486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”³é˜³
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T08:54:59.000Z" title="Fri Nov 28 2025 08:54:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/562fd52a738540aa908c891ad0b636ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764924898&amp;x-signature=511go3L9BU%2FZlSGF7p55LMRr%2FAU%3D" alt="image-20251128163616981" loading="lazy"/></p>
<h2 data-id="heading-0">ä¸€ã€å‰è¨€</h2>
<p>å‰é¢æˆ‘ä»¬å·²ç»å®Œæˆäº†åŸºç¡€çš„æ•´åˆå·¥ä½œï¼Œæ¥ä¸‹æ¥å¼€å§‹å…·ä½“ä¸šåŠ¡çš„å¼€å‘äº†ï¼Œå› ä¸ºæ˜¯ä¸ªäººé¡¹ç›®ï¼Œå…¨å¹²å·¥ç¨‹å¸ˆï¼Œæ‰€ä»¥æ— è®ºä½ ä»å“ªé‡Œå¼€å§‹éƒ½å¯ä»¥ï¼Œæˆ‘ä¹ æƒ¯ä»ç™»å½•å¼€å§‹ï¼Œå‰åç«¯ä¸€èµ·ï¼Œå…ˆå†™é¡µé¢ï¼Œå†å†™æ¥å£ï¼Œç„¶åè°ƒè¯•ï¼Œä¸€ä¸ªåŠŸèƒ½åšå®Œå†å¼€å§‹ä¸‹ä¸€ä¸ªã€‚è¿™åªæ˜¯æˆ‘ä¸ªäººä¹ æƒ¯ï¼Œä½ å®Œå…¨å¯ä»¥éšæ€§ä¸€ç‚¹ï¼Œå…ˆå†™åç«¯å†å†™å‰ç«¯ï¼Œæˆ–è€…å‰ç«¯å…¨éƒ¨ç”¨é™æ€æ•°æ®ï¼Œå†™å®Œå†å†™åç«¯å¯¹æ¥æ¥å£ã€‚</p>
<h2 data-id="heading-1">äºŒã€ç™»å½•ç•Œé¢å¼€å‘</h2>
<p>æ¯æ¬¡å¼€å§‹å†™å‰ç«¯çš„æ—¶å€™éƒ½ä¼šå¾ˆçº ç»“ï¼Œè„‘å­é‡Œå…¨æ˜¯æƒ³æ³•ï¼Œä½†æ˜¯è½å®åˆ°å…·ä½“é¡µé¢åˆä¸çŸ¥é“ä»å“ªä¸‹æ‰‹ã€‚é¦–å…ˆ <code>UI</code> ä»ä½•è€Œæ¥å°±è®©äººå¤´å¤§ã€‚ç»è¿‡è¿™ä¹ˆå¤šå¹´çš„æŠ˜è…¾ï¼Œæœ‰äº†ä¸€äº›å°çš„ç»éªŒï¼Œåˆ†äº«ç»™å¤§å®¶ã€‚</p>
<ul>
<li><strong>æ‰¾ä¸ªç±»ä¼¼äº§å“ï¼Œç›´æ¥ç…§æŠ„ï¼ŒæŠ„çš„è‚¯å®šæ¯”ä½ ä¸€è¾¹åšä¸€è¾¹æƒ³è¦å¥½çš„å¤šï¼Œæœ€ç»ˆæˆå“ä¹Ÿæ›´åƒä¸€ä¸ªäº§å“</strong></li>
</ul>
<blockquote>
<p>æ—©å¹´çš„æ—¶å€™ï¼Œæˆ‘ä¼šæœ‰ä¸€ç‚¹å¿ƒç†è´Ÿæ‹…ï¼Œè§‰å¾—è¿™æ ·ä¸å¤ªé“å¾·ï¼Œä¹Ÿä¸å±‘äºè¿™ä¹ˆåšï¼Œè§‰å¾—é è‡ªå·±è®¾è®¡å‡ºæ¥çš„æ‰æ˜¯æœ€å®Œç¾ã€‚å…¶å®ä¸ç„¶ï¼Œæœ¯ä¸šæœ‰ä¸“æ”»ï¼Œæˆ‘ä»¬çš„æ€æƒ³æ—©å·²ç»è¢«åŒè´¨åŒ–ï¼Œå¦‚æœå‡­å€Ÿæˆ‘ä»¬è‡ªå·±å‘æŒ¥ï¼Œæœ€ç»ˆä¹Ÿè¿˜æ˜¯ä¼šå’Œæˆ‘ä»¬è§è¿‡çš„ <code>UI</code> è´´è¿‘ï¼Œå·¦è¾¹èœå•ï¼Œå³è¾¹å±•ç¤ºé¡µé¢ï¼Œåœ¨ä¸€äº›å°æ ·å¼ä¸ŠæŒ£æ‰ï¼Œæœ€åèŠ±è´¹å¤§é‡æ—¶é—´ã€‚æ‰€ä»¥è¿˜ä¸å¦‚ç›´æ¥æ”¾ä¸‹å¿ƒç†åŒ…è¢±ï¼Œç›´æ¥å€Ÿé‰´ï¼Œç­‰å®Œæ•´äº§å“å‡ºæ¥åï¼Œå†å»æ‰“ç£¨ï¼Œè°ƒæ•´å‡ºè‡ªå·±çš„é£æ ¼ã€‚</p>
</blockquote>
<ul>
<li><strong>å¯»æ‰¾ä¸“ä¸šçš„UIè®¾è®¡å¸ˆè®¾è®¡</strong></li>
</ul>
<blockquote>
<p>å½“ç„¶ä¸ªäººå¼€å‘æœ€ç†æƒ³çš„æƒ…å†µæ˜¯æ‰¾åˆ°å¿—åŒé“åˆçš„è®¾è®¡å¸ˆæœ‹å‹ä¸€èµ·åˆä½œï¼Œæˆ–è€…ç›´æ¥å»æŸå¹³å°èŠ±é’±ä¹°è®¾è®¡</p>
</blockquote>
<ul>
<li><strong>åœ¨ä¸€äº›è®¾è®¡å¹³å°æ‰¾ä¸€äº›å…¬å¼€çš„è®¾è®¡ä½œå“</strong></li>
</ul>
<blockquote>
<p>è¿™é‡Œæˆ‘ç›®å‰ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯ <strong>å³æ—¶è®¾è®¡</strong>ï¼Œè¿™ä¸ªé¡¹ç›®æˆ‘ä¹Ÿæ‰“ç®—åœ¨è¿™ä¸ªä¸Šé¢æ‰¾ä¸€æ‰¾ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fjs.design%2F" target="_blank" title="https://js.design/" ref="nofollow noopener noreferrer">js.design/</a></p>
</blockquote>
<p>åœ¨èµ„æºå¹¿åœºæœç´¢å³å¯ï¼Œæ‰¾åˆ°è‡ªå·±ä¸­æ„çš„å³å¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/817a99083f1146e7ab39eec7160e3f9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764924898&amp;x-signature=lBAJi%2FgfZxbxWtuBj1rGb17GFPk%3D" alt="image-20251127134431837" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a13f8169d444234b68e695a8fa0fa13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764924898&amp;x-signature=RVhHKr52mQypMCxTCmK99NEEA94%3D" alt="image-20251127134441968" loading="lazy"/></p>
<h3 data-id="heading-2">2.1. é¡µé¢ç¼–å†™</h3>
<p>è¿™ä¸ªå…·ä½“æ€ä¹ˆå®ç°æˆ‘å°±ä¸èµ˜è¿°äº†ï¼Œç…§ç€ <code>UI</code> ç•Œé¢æ¨¡ä»¿å³å¯ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<p>ç¬¬ä¸€ï¼šç™»å½•çš„çª—å£åº”è¯¥å°ä¸€ç‚¹ï¼Œç™»å½•æˆåŠŸä¹‹åè·³è½¬åˆ°ä¸»é¡µé¢ï¼Œçª—å£å˜å¤§ã€‚</p>
<p>ç¬¬äºŒï¼šç™»å½•çª—å£åº”è¯¥é”æ­»ä¸å…è®¸æ”¶ç¼©ï¼Œå…¨å±ç­‰æ“ä½œï¼Œä¸»ç•Œé¢å¯ä»¥æ‹–åŠ¨æ”¾å¤§ç¼©å°ï¼Œå¹¶ä¸”å¯ä»¥å…¨å±ã€‚</p>
<p>å¸¦ç€è¿™ä¸¤ä¸ªé—®é¢˜æˆ‘ç»“åˆ <code>AI</code>ï¼Œå»å®˜æ–¹æ–‡æ¡£æ‰¾äº†ä¸€ä¸‹è§£å†³æ–¹æ¡ˆã€‚</p>
<p>å¦‚æœä½ æ—¶é—´æ¯”è¾ƒå……è£•ï¼Œæˆ‘å¸Œæœ›ä½ å¯ä»¥è‡ªå·±å…ˆæ¢ç´¢ç ”ç©¶ä¸€ä¸‹ï¼Œè¿‡ç¨‹å¾ˆæœ‰è¶£ã€‚</p>
<p>ä¸‹é¢ä»‹ç»å…·ä½“å®ç°æ–¹å¼ï¼š</p>
<blockquote>
<p>å¼€å‘å¼€å‘å‰ï¼Œå…ˆå°†ä¹‹å‰çš„æµ‹è¯•ä»£ç å…¨éƒ¨æ¸…é™¤ã€‚
é¡ºä¾¿å¼•å…¥ä¸€ä¸‹ <code>tailwindcss</code>ï¼Œå‚è€ƒæ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftailwind.nodejs.cn%2Fdocs%2Finstallation%2Fusing-vite" target="_blank" title="https://tailwind.nodejs.cn/docs/installation/using-vite" ref="nofollow noopener noreferrer">tailwind.nodejs.cn/docs/instalâ€¦</a></p>
</blockquote>
<blockquote>
<p>â—ï¸<strong>æ³¨æ„ï¼š</strong> åœ¨æˆ‘å¼€å‘å®Œç™»å½•æ¨¡å—åï¼Œæˆ‘å‘ç° <strong>Ant Design Vue</strong> ä½¿ç”¨èµ·æ¥å¾ˆä¸é¡ºæ‰‹ï¼Œå¯èƒ½æ˜¯åŠŸèƒ½å¤ªå¼ºå¤§äº†ï¼Œåšçš„å¤ªçµæ´»äº†ï¼Œæˆ‘å†³å®šæ¢æˆ <strong>Naive UI</strong> , æˆ‘å¹³æ—¶ç”¨çš„æ¯”è¾ƒå¤šçš„å…¶å®è¿˜æ˜¯ <strong>Element Plus</strong> ï¼Œä½†æ˜¯æˆ‘æƒ³è¦å°è¯•ä¸€ä¸‹å…¶ä»–çš„ã€‚å¦‚æœä½ ä¹ æƒ¯äº  <strong>Ant Design Vue</strong>  é‚£å°±æ¥ç€ä½¿ç”¨å³å¯ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.naiveui.com%2F" target="_blank" title="https://www.naiveui.com/" ref="nofollow noopener noreferrer">www.naiveui.com/</a></p>
</blockquote>
<h3 data-id="heading-3">2.2. åˆ‡æ¢ Naive UI ç»„ä»¶åº“</h3>
<ul>
<li><strong>å®‰è£…ä¾èµ–</strong></li>
</ul>
<pre><code class="hljs language-bash" lang="bash">pnpm i -D naive-ui
</code></pre>
<ul>
<li><strong>å­—ä½“</strong></li>
</ul>
<pre><code class="hljs language-bash" lang="bash">pnpm i -D vfonts
</code></pre>
<ul>
<li><strong>å›¾æ ‡åº“/å›¾æ ‡åŒ…è£…ç»„ä»¶</strong></li>
</ul>
<pre><code class="hljs language-bash" lang="bash">npm i -D @vicons/antd @vicons/utils
</code></pre>
<ul>
<li><strong>é…ç½®æŒ‰éœ€è‡ªåŠ¨å¯¼å…¥</strong></li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">AutoImport</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-auto-import/vite'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NaiveUiResolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/resolvers'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/vite'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">// ...</span>
     <span class="hljs-title class_">AutoImport</span>({ 
      <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">NaiveUiResolver</span>()],
    }),
    <span class="hljs-title class_">Components</span>({ 
      <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">NaiveUiResolver</span>()],
    }),
  ],
})
</code></pre>
<ul>
<li><strong>ä¿®æ”¹ request ä¸­çš„ message æ–¹æ³•</strong></li>
</ul>
<blockquote>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œ<strong>Naive UI</strong> çš„ <code>message</code>  å¦‚æœè¦åœ¨ <code>setup</code> å¤–ä½¿ç”¨éœ€è¦éœ€è¦é¢å¤–å¤„ç†ä¸€ä¸‹ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.naiveui.com%2Fzh-CN%2Fos-theme%2Fcomponents%2Fmessage%23%25E5%259C%25A8-setup-%25E5%25A4%2596%25E4%25BD%25BF%25E7%2594%25A8" target="_blank" title="https://www.naiveui.com/zh-CN/os-theme/components/message#%E5%9C%A8-setup-%E5%A4%96%E4%BD%BF%E7%94%A8" ref="nofollow noopener noreferrer">www.naiveui.com/zh-CN/os-thâ€¦</a></p>
</blockquote>
<p>åˆ›å»º <code>src/hooks/useMessagehook.ts</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createDiscreteApi } <span class="hljs-keyword">from</span> <span class="hljs-string">'naive-ui'</span>


<span class="hljs-keyword">const</span> { message, notification, dialog, loadingBar, modal } = <span class="hljs-title function_">createDiscreteApi</span>(
    [<span class="hljs-string">'message'</span>, <span class="hljs-string">'dialog'</span>, <span class="hljs-string">'notification'</span>, <span class="hljs-string">'loadingBar'</span>, <span class="hljs-string">'modal'</span>]
)

<span class="hljs-keyword">export</span> { message, notification, dialog, loadingBar, modal }
</code></pre>
<p><code>request</code> ä¸­æ”¹ä¸ºä½¿ç”¨ <code>hooks</code> æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { message } <span class="hljs-keyword">from</span> <span class="hljs-string">'../hooks/useMessagehook'</span>
...
message.<span class="hljs-title function_">error</span>(msg)
</code></pre>
<h3 data-id="heading-4">2.3. é¦–é¡µå¼€å‘</h3>
<p>åˆ›å»º <code>src/view/login/LoginPage.vue</code></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useUserInfoStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../stores/modules/user'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UserOutlined</span>, <span class="hljs-title class_">LockOutlined</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vicons/antd'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'../../router'</span>

interface <span class="hljs-title class_">LoginFormData</span> {
  <span class="hljs-attr">username</span>: string
  <span class="hljs-attr">password</span>: string
}

<span class="hljs-comment">// ç™»å½•è¡¨å•æ•°æ®</span>
<span class="hljs-keyword">const</span> loginFormData = reactive&lt;<span class="hljs-title class_">LoginFormData</span>&gt;({
  <span class="hljs-attr">username</span>: <span class="hljs-string">'admin'</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">'admin123456'</span>,
})

<span class="hljs-comment">// ç™»å½•è¡¨å•ref</span>
<span class="hljs-keyword">const</span> loginFormRef = <span class="hljs-title function_">ref</span>()
<span class="hljs-comment">// åŠ è½½åŠ¨ç”»</span>
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-comment">// è·å–ç”¨æˆ·ä¿¡æ¯ç¼“å­˜ä»“åº“</span>
<span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserInfoStore</span>()

<span class="hljs-comment">// è¡¨å•éªŒè¯è§„åˆ™</span>
<span class="hljs-keyword">const</span> rules = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">username</span>: [{ <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·è¾“å…¥ç”¨æˆ·å'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> }],
  <span class="hljs-attr">password</span>: [{ <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·è¾“å…¥å¯†ç '</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> }],
})

<span class="hljs-comment">// ç™»å½•</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// è¡¨å•éªŒè¯</span>
  <span class="hljs-keyword">const</span> valid = <span class="hljs-keyword">await</span> loginFormRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">validate</span>()
  <span class="hljs-comment">// æ ¡éªŒä¸æˆåŠŸç›´æ¥ return</span>
  <span class="hljs-keyword">if</span> (!valid) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  }
  <span class="hljs-comment">// æ ¡éªŒæˆåŠŸè¿›è¡Œåç»­æ“ä½œ</span>
  <span class="hljs-comment">// 1.åŠ è½½ loading</span>
  loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  <span class="hljs-comment">// 2.ç™»å½•è¯·æ±‚ è·å–token</span>
  userStore
    .<span class="hljs-title function_">login</span>()
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// è·³è½¬</span>
      router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/'</span>)
    })
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// éªŒè¯å¤±è´¥ï¼Œé‡æ–°åŠ è½½éªŒè¯ç </span>
    })
    .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// éªŒè¯ç»“æŸï¼Œéšè—loading</span>
      loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    })
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"h-screen"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">n-grid</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"h-full"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">n-gi</span> <span class="hljs-attr">span</span>=<span class="hljs-string">"14"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relative h-full bg-[url('../../images/login_bg.webp')] bg-center bg-cover bg-no-repeat"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"absolute top-5 left-5 text-2xl font-bold text-white"</span>&gt;</span> EZ-ADMIN <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"absolute bottom-30 left-1/2 -translate-x-1/2 text-xl text-nowrap text-white"</span>&gt;</span>
            ç›¸ä¿¡è‡ªå·±æˆ‘èƒ½è¡Œï¼Œ è€å¤©ä¸ä¼šè¾œè´Ÿä½ æ‰€ä»˜å‡ºçš„åŠªåŠ›ï¼
          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">n-gi</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">n-gi</span> <span class="hljs-attr">span</span>=<span class="hljs-string">"10"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"h-full flex flex-col items-center justify-center px-15"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-3xl font-bold text-black text-center"</span>&gt;</span>æ¬¢è¿ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-full flex items-center justify-center flex-nowrap gap-1 my-5"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- åˆ†å‰²çº¿ï¼šæ›´ç»†è…»çš„è®¾è®¡ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-16 h-px bg-slate-400"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-nowrap text-slate-400"</span>&gt;</span>è´¦å·å¯†ç ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-16 h-px bg-slate-400"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-comment">&lt;!-- è¡¨å• --&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">n-form</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"w-50 sm:w-50 md:w-75 lg:w-90"</span>
            <span class="hljs-attr">:show-label</span>=<span class="hljs-string">"false"</span>
            <span class="hljs-attr">ref</span>=<span class="hljs-string">"loginFormRef"</span>
            <span class="hljs-attr">:model</span>=<span class="hljs-string">"loginFormData"</span>
            <span class="hljs-attr">:rules</span>=<span class="hljs-string">"rules"</span>
            <span class="hljs-attr">size</span>=<span class="hljs-string">"large"</span>
          &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">n-form-item</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"username"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">n-input</span> <span class="hljs-attr">v-model:value</span>=<span class="hljs-string">"loginFormData.username"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¯·è¾“å…¥ç”¨æˆ·å"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">prefix</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">n-icon</span> <span class="hljs-attr">:component</span>=<span class="hljs-string">"UserOutlined"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-slate-400"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">n-input</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">n-form-item</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">n-form-item</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"password"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">n-input</span>
                <span class="hljs-attr">v-model:value</span>=<span class="hljs-string">"loginFormData.password"</span>
                <span class="hljs-attr">show-password-on</span>=<span class="hljs-string">"mousedown"</span>
                <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span>
                <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¯·è¾“å…¥å¯†ç "</span>
              &gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">prefix</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">n-icon</span> <span class="hljs-attr">:component</span>=<span class="hljs-string">"LockOutlined"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-slate-400"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">n-input</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">n-form-item</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">n-form-item</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">n-button</span> <span class="hljs-attr">block</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"large"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleLogin"</span>&gt;</span>ç™» å½•<span class="hljs-tag">&lt;/<span class="hljs-name">n-button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">n-form-item</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">n-form</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">n-gi</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">n-grid</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"less"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/407c27b853b84505a886388c7b89d7ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764924898&amp;x-signature=ePbxcacOCgGmpEYKs9cx8ZAmt7Y%3D" alt="image-20251128163616981" loading="lazy"/></p>
<blockquote>
<p>è¿™é‡Œç®€å•æä¸€ä¸‹ï¼Œé¡µé¢å†™å¥½åè¦é…ç½®å¥½è·¯ç”±ï¼Œä»¥åŠè·¯ç”±å‡ºå£ã€‚</p>
<p>åœ¨ <code>tauri.conf.json</code> ä¸­å®šä¹‰åˆå§‹æ‰“å¼€çª—å£çš„å¤§å°ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-string">"app"</span>: {
    <span class="hljs-string">"windows"</span>: [
      {
        <span class="hljs-string">"title"</span>: <span class="hljs-string">"tauri-app"</span>,
        <span class="hljs-string">"width"</span>: <span class="hljs-number">800</span>,
        <span class="hljs-string">"height"</span>: <span class="hljs-number">600</span>
      }
    ],
    <span class="hljs-string">"security"</span>: {
      <span class="hljs-string">"csp"</span>: <span class="hljs-literal">null</span>
    }
  },
</code></pre>
</blockquote>
<h2 data-id="heading-5">ä¸‰ã€æ€»ç»“</h2>
<p>å› ä¸ºå…¶å®æœ€ç»ˆè¿˜æ˜¯ <code>web</code> é‚£ä¸€å¥—ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥æ²¿ç”¨äº†ä¹‹å‰å¼€å‘çš„ä¸€å¥—è„šæ‰‹æ¶é¡¹ç›®ï¼Œä¸è¿‡ä¸ºäº†å¯»æ±‚ä¸€äº›å˜åŒ–ï¼Œæˆ‘è¿™æ¬¡ä½¿ç”¨äº† <strong>Tailwindcss</strong> å’Œ <strong>Naive UI</strong> ã€‚ åŸé¡¹ç›®åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoshenyang%2Fez-admin-vue" target="_blank" title="https://github.com/Caoshenyang/ez-admin-vue" ref="nofollow noopener noreferrer">github.com/Caoshenyangâ€¦</a></p>
<p><strong>åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹ã€‚ä½ çš„â€œä¸ªäººå…¬å¸â€ä»è¿™ç¬¬ä¸€ä¸ª2å°æ—¶å¼€å§‹ã€‚æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„è¿›å±•æˆ–é‡åˆ°çš„å¡ç‚¹ï¼Œæˆ‘ä¼šé€ä¸€æŸ¥çœ‹ï¼Œå°½å¯èƒ½çš„å¸®åŠ©è§£å†³ã€‚æˆ‘ä»¬ä¸‹ä¸€ç¯‡æ–‡ç« è§ï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æºç è§£æï¼šRustFSå¦‚ä½•ç”¨â€œé›¶æ‹·è´â€æŠ€æœ¯ç¢¾å‹ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿï¼Ÿ]]></title>    <link>https://juejin.cn/post/7577321767347372078</link>    <guid>https://juejin.cn/post/7577321767347372078</guid>    <pubDate>2025-11-28T06:56:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577321767347372078" data-draft-id="7577395040592723978" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æºç è§£æï¼šRustFSå¦‚ä½•ç”¨â€œé›¶æ‹·è´â€æŠ€æœ¯ç¢¾å‹ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿï¼Ÿ"/> <!----> <meta itemprop="datePublished" content="2025-11-28T06:56:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¯¹è±¡å­˜å‚¨ä¸RustFS"/> <meta itemprop="url" content="https://juejin.cn/user/652466093570057"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æºç è§£æï¼šRustFSå¦‚ä½•ç”¨â€œé›¶æ‹·è´â€æŠ€æœ¯ç¢¾å‹ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/652466093570057/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¯¹è±¡å­˜å‚¨ä¸RustFS
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T06:56:40.000Z" title="Fri Nov 28 2025 06:56:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æºç è§£æï¼šRustFSå¦‚ä½•ç”¨â€œé›¶æ‹·è´â€æŠ€æœ¯ç¢¾å‹ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿï¼Ÿ</h2>
<blockquote>
<p>2025å¹´ï¼Œå½“RustFSåœ¨GitHubä¸Šæ–©è·â€‹<strong>10k+ Star</strong>â€‹ï¼Œå…¶<strong>4Kéšæœºè¯»1,580K IOPS</strong>çš„æ€§èƒ½è¡¨ç°æ¯”MinIOå¿«â€‹<strong>42%</strong> â€‹ï¼Œè¿™ä¸€åˆ‡çš„å¥¥ç§˜éƒ½æºäºå…¶é©å‘½æ€§çš„â€‹<strong>é›¶æ‹·è´æŠ€æœ¯</strong>ã€‚æœ¬æ–‡å°†æ·±å…¥æºç å±‚é¢ï¼Œæ­ç§˜RustFSå¦‚ä½•é‡æ„å­˜å‚¨æ€§èƒ½è¾¹ç•Œã€‚</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€é›¶æ‹·è´æŠ€æœ¯ï¼šå­˜å‚¨æ€§èƒ½çš„é©å‘½æ€§çªç ´</h3>
<p>åœ¨ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ•°æ®ä»å­˜å‚¨è®¾å¤‡åˆ°åº”ç”¨ç¨‹åºéœ€è¦ç»å†å¤šæ¬¡æ‹·è´ï¼šâ€‹<strong>ç¡¬ç›˜â†’å†…æ ¸ç¼“å†²åŒºâ†’ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºâ†’ç½‘ç»œå †æ ˆ</strong>â€‹ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡æ‹·è´éƒ½æ„å‘³ç€CPUå‘¨æœŸå’Œå†…å­˜å¸¦å®½çš„æ¶ˆè€—ã€‚å®æµ‹è¡¨æ˜ï¼Œåœ¨10Gç½‘ç»œç¯å¢ƒä¸‹ï¼Œä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿæœ‰å¤šè¾¾<strong>70%</strong> çš„CPUæ—¶é—´æ¶ˆè€—åœ¨æ•°æ®æ‹·è´ä¸Šã€‚</p>
<p>RustFSé€šè¿‡â€‹<strong>io_uringå¼‚æ­¥I/O</strong>â€‹ã€<strong>å†…å­˜æ˜ å°„</strong>å’Œ<strong>RDMAç›´æ¥æ•°æ®æ”¾ç½®</strong>ä¸‰é¡¹æ ¸å¿ƒæŠ€æœ¯ï¼Œå®ç°äº†çœŸæ­£çš„é›¶æ‹·è´æ¶æ„ã€‚åœ¨NVMe SSDæµ‹è¯•ä¸­ï¼ŒRustFSçš„é›¶æ‹·è´è®¾è®¡å°†IOPSä»ä¼ ç»Ÿçš„<strong>300K</strong>æå‡è‡³â€‹<strong>1,580K</strong>â€‹ï¼Œæ€§èƒ½æå‡è¾¾â€‹<strong>426%</strong> ã€‚</p>
<h4 data-id="heading-2">1.1 ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿçš„æ‹·è´å¼€é”€</h4>
<p>ä¼ ç»ŸLinuxæ–‡ä»¶ç³»ç»Ÿä½¿ç”¨read/writeç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œæ•°æ®æµå‘å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ä¼ ç»Ÿè¯»å†™çš„æ•°æ®æµå‘ï¼ˆ4æ¬¡æ‹·è´ï¼‰</span>
ç£ç›˜ â†’ å†…æ ¸ç¼“å†²åŒº â†’ ç”¨æˆ·ç©ºé—´ç¼“å†²åŒº â†’ ç½‘ç»œå †æ ˆ â†’ ç½‘å¡
   â†“         â†“           â†“           â†“
 DMAæ‹·è´    CPUæ‹·è´      CPUæ‹·è´     DMAæ‹·è´
</code></pre>
<p>è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠ<strong>2æ¬¡CPUæ‹·è´</strong>å’Œâ€‹<strong>2æ¬¡DMAæ‹·è´</strong>â€‹ï¼Œåœ¨å¤„ç†å°æ–‡ä»¶æ—¶å°¤å…¶ä½æ•ˆã€‚æ¯æ¬¡æ‹·è´éƒ½å¢åŠ <strong>1-3Î¼s</strong>çš„å»¶è¿Ÿï¼Œåœ¨é«˜é€Ÿå­˜å‚¨è®¾å¤‡ä¸Šï¼Œè¿™ç§å¼€é”€å°¤ä¸ºæ˜æ˜¾ã€‚</p>
<h3 data-id="heading-3">äºŒã€RustFSçš„é›¶æ‹·è´æ¶æ„è®¾è®¡</h3>
<h4 data-id="heading-4">2.1 io_uringçš„å¼‚æ­¥I/Oé©å‘½</h4>
<p>RustFSä½¿ç”¨Linuxå†…æ ¸çš„<strong>io_uring</strong>æ¥å£æ›¿ä»£ä¼ ç»ŸåŒæ­¥I/Oï¼Œå®ç°äº†çœŸæ­£çš„å¼‚æ­¥é›¶æ‹·è´ã€‚å…¶æ ¸å¿ƒåˆ›æ–°åœ¨äº<strong>æäº¤é˜Ÿåˆ—(SQ)</strong> å’Œ<strong>å®Œæˆé˜Ÿåˆ—(CQ)</strong> çš„åŒç¯ç¼“å†²åŒºè®¾è®¡ã€‚</p>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-comment">// RustFSä¸­io_uringåˆå§‹åŒ–çš„æ ¸å¿ƒæºç </span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">IoUringRuntime</span> {
    submit_queue: Arc&lt;Mutex&lt;SubmissionQueue&gt;&gt;,
    complete_queue: Arc&lt;Mutex&lt;CompletionQueue&gt;&gt;,
    ring_fd: RawFd,  <span class="hljs-comment">// æŒ‡å‘å†…æ ¸çš„io_uringå®ä¾‹</span>
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">IoUringRuntime</span> {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(entries: <span class="hljs-type">u32</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-keyword">Self</span>&gt; {
        <span class="hljs-comment">// åˆ›å»ºio_uringå®ä¾‹</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">params</span> = io_uring_params::<span class="hljs-title function_ invoke__">default</span>();
        params.flags |= IORING_SETUP_SQPOLL;  <span class="hljs-comment">// å¯ç”¨å†…æ ¸è½®è¯¢æ¨¡å¼</span>
        
        <span class="hljs-keyword">unsafe</span> {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ring_fd</span> = <span class="hljs-title function_ invoke__">io_uring_setup</span>(entries, &amp;<span class="hljs-keyword">mut</span> params);
            <span class="hljs-keyword">if</span> ring_fd &lt; <span class="hljs-number">0</span> { <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(Error::<span class="hljs-title function_ invoke__">last_os_error</span>()); }
            
            <span class="hljs-comment">// å†…å­˜æ˜ å°„é˜Ÿåˆ—åŒºåŸŸ</span>
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">sq_ptr</span> = <span class="hljs-title function_ invoke__">mmap</span>(
                ptr::<span class="hljs-title function_ invoke__">null_mut</span>(),
                params.sq_off <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span> + params.sq_entries <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span> * size_of::&lt;io_uring_sqe&gt;(),
                PROT_READ | PROT_WRITE,
                MAP_SHARED | MAP_POPULATE,
                ring_fd,
                IORING_OFF_SQ_RING.<span class="hljs-title function_ invoke__">into</span>(),
            );
            
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">cq_ptr</span> = <span class="hljs-title function_ invoke__">mmap</span>(<span class="hljs-comment">/* å®Œæˆé˜Ÿåˆ—ç±»ä¼¼æ˜ å°„ */</span>);
            
            <span class="hljs-title function_ invoke__">Ok</span>(IoUringRuntime {
                submit_queue: Arc::<span class="hljs-title function_ invoke__">new</span>(Mutex::<span class="hljs-title function_ invoke__">new</span>(SubmissionQueue::<span class="hljs-title function_ invoke__">new</span>(sq_ptr))),
                complete_queue: Arc::<span class="hljs-title function_ invoke__">new</span>(Mutex::<span class="hljs-title function_ invoke__">new</span>(CompletionQueue::<span class="hljs-title function_ invoke__">new</span>(cq_ptr))),
                ring_fd,
            })
        }
    }
}
</code></pre>
<p>è¿™ç§è®¾è®¡ä½¿å¾—I/Oè¯·æ±‚çš„æäº¤å’Œå®Œæˆå®Œå…¨åœ¨ç”¨æˆ·ç©ºé—´è¿›è¡Œï¼Œâ€‹<strong>ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°å‡å°‘85%</strong> ï¼Œç‰¹åˆ«é€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚</p>
<h4 data-id="heading-5">2.2 å†…å­˜æ˜ å°„ä¸é›¶æ‹·è´æ–‡ä»¶è®¿é—®</h4>
<p>RustFSä½¿ç”¨å†…å­˜æ˜ å°„æŠ€æœ¯å°†æ–‡ä»¶ç›´æ¥æ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ï¼Œé¿å…äº†ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´çš„æ•°æ®æ‹·è´ï¼š</p>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-comment">// å†…å­˜æ˜ å°„å®ç°é›¶æ‹·è´æ–‡ä»¶è®¿é—®</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">MappedFile</span> {
    mapping: *<span class="hljs-keyword">mut</span> libc::c_void,
    len: <span class="hljs-type">usize</span>,
    file: File,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">MappedFile</span> {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">open</span>(path: &amp;Path) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-keyword">Self</span>&gt; {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">file</span> = OpenOptions::<span class="hljs-title function_ invoke__">new</span>().<span class="hljs-title function_ invoke__">read</span>(<span class="hljs-literal">true</span>).<span class="hljs-title function_ invoke__">open</span>(path)?;
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">metadata</span> = file.<span class="hljs-title function_ invoke__">metadata</span>()?;
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">len</span> = metadata.<span class="hljs-title function_ invoke__">len</span>() <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>;
        
        <span class="hljs-keyword">unsafe</span> {
            <span class="hljs-comment">// åˆ›å»ºå†…å­˜æ˜ å°„</span>
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mapping</span> = libc::<span class="hljs-title function_ invoke__">mmap</span>(
                ptr::<span class="hljs-title function_ invoke__">null_mut</span>(),
                len,
                PROT_READ,
                MAP_PRIVATE,
                file.<span class="hljs-title function_ invoke__">as_raw_fd</span>(),
                <span class="hljs-number">0</span>,
            );
            
            <span class="hljs-keyword">if</span> mapping == MAP_FAILED {
                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(Error::<span class="hljs-title function_ invoke__">last_os_error</span>());
            }
            
            <span class="hljs-comment">// å»ºè®®å†…æ ¸é¢„è¯»ä¼˜åŒ–</span>
            libc::<span class="hljs-title function_ invoke__">madvise</span>(mapping, len, libc::MADV_SEQUENTIAL);
            
            <span class="hljs-title function_ invoke__">Ok</span>(MappedFile { mapping, len, file })
        }
    }
    
    <span class="hljs-comment">// é›¶æ‹·è´æ•°æ®è®¿é—®</span>
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">as_slice</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> &amp;[<span class="hljs-type">u8</span>] {
        <span class="hljs-keyword">unsafe</span> { std::slice::<span class="hljs-title function_ invoke__">from_raw_parts</span>(<span class="hljs-keyword">self</span>.mapping <span class="hljs-keyword">as</span> *<span class="hljs-keyword">const</span> <span class="hljs-type">u8</span>, <span class="hljs-keyword">self</span>.len) }
    }
}
</code></pre>
<p>å†…å­˜æ˜ å°„å°†æ–‡ä»¶I/Oè½¬åŒ–ä¸ºå†…å­˜è®¿é—®ï¼Œåœ¨å¤§æ–‡ä»¶è¯»å–åœºæ™¯ä¸‹ï¼Œæ€§èƒ½æå‡å¯è¾¾â€‹<strong>300%</strong> ã€‚</p>
<h3 data-id="heading-6">ä¸‰ã€æ ¸å¿ƒæºç è§£æï¼šé›¶æ‹·è´çš„å®ç°æœºç†</h3>
<h4 data-id="heading-7">3.1 é›¶æ‹·è´å‘é€æµç¨‹</h4>
<p>RustFSé€šè¿‡ç½‘ç»œå‘é€æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨<strong>sendfile</strong>ç³»ç»Ÿè°ƒç”¨å®ç°é›¶æ‹·è´ä¼ è¾“ï¼š</p>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-comment">// é›¶æ‹·è´æ–‡ä»¶å‘é€å®ç°</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">send_file_zero_copy</span>(
    source_fd: RawFd, 
    target_fd: RawFd,
    offset: <span class="hljs-type">i64</span>,
    <span class="hljs-keyword">mut</span> count: <span class="hljs-type">usize</span>
) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-type">usize</span>&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">total_sent</span> = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">while</span> count &gt; <span class="hljs-number">0</span> {
        <span class="hljs-comment">// ä½¿ç”¨sendfileç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨å†…æ ¸å±‚é¢ç›´æ¥ä¼ è¾“</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">sent</span> = <span class="hljs-keyword">unsafe</span> {
            libc::<span class="hljs-title function_ invoke__">sendfile</span>(
                target_fd,    <span class="hljs-comment">// ç›®æ ‡socketæ–‡ä»¶æè¿°ç¬¦</span>
                source_fd,    <span class="hljs-comment">// æºæ–‡ä»¶æè¿°ç¬¦</span>
                &amp;<span class="hljs-keyword">mut</span> offset <span class="hljs-keyword">as</span> *<span class="hljs-keyword">const</span> <span class="hljs-type">i64</span> <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> <span class="hljs-type">i64</span>,
                count.<span class="hljs-title function_ invoke__">min</span>(libc::MAX_TRANSFER_UNIT) <span class="hljs-keyword">as</span> libc::size_t,
            )
        };
        
        <span class="hljs-keyword">if</span> sent &lt;= <span class="hljs-number">0</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> total_sent &gt; <span class="hljs-number">0</span> { <span class="hljs-title function_ invoke__">Ok</span>(total_sent) } 
                   <span class="hljs-keyword">else</span> { <span class="hljs-title function_ invoke__">Err</span>(Error::<span class="hljs-title function_ invoke__">last_os_error</span>()) };
        }
        
        total_sent += sent <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>;
        count -= sent <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>;
    }
    
    <span class="hljs-title function_ invoke__">Ok</span>(total_sent)
}
</code></pre>
<p><strong>sendfile</strong>ç³»ç»Ÿè°ƒç”¨å…è®¸æ•°æ®ç›´æ¥ä»æ–‡ä»¶æè¿°ç¬¦ä¼ è¾“åˆ°socketæè¿°ç¬¦ï¼Œå®Œå…¨ç»•è¿‡ç”¨æˆ·ç©ºé—´ï¼Œå‡å°‘â€‹<strong>2æ¬¡æ•°æ®æ‹·è´</strong>ã€‚</p>
<h4 data-id="heading-8">3.2 æ™ºèƒ½ç¼“å†²åŒºç®¡ç†</h4>
<p>RustFSé€šè¿‡æ™ºèƒ½ç¼“å†²åŒºå¤ç”¨æœºåˆ¶ï¼Œè¿›ä¸€æ­¥å‡å°‘å†…å­˜åˆ†é…å¼€é”€ï¼š</p>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-comment">// é›¶æ‹·è´ç¼“å†²åŒºæ± </span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ZeroCopyBufferPool</span> {
    buffers: <span class="hljs-type">Vec</span>&lt;Arc&lt;Buffer&gt;&gt;,
    buffer_size: <span class="hljs-type">usize</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">ZeroCopyBufferPool</span> {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(buffer_size: <span class="hljs-type">usize</span>, initial_count: <span class="hljs-type">usize</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">buffers</span> = <span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">with_capacity</span>(initial_count);
        <span class="hljs-keyword">for</span> <span class="hljs-variable">_</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..initial_count {
            buffers.<span class="hljs-title function_ invoke__">push</span>(Arc::<span class="hljs-title function_ invoke__">new</span>(Buffer::<span class="hljs-title function_ invoke__">new</span>(buffer_size)));
        }
        
        ZeroCopyBufferPool { buffers, buffer_size }
    }
    
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_buffer</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> Arc&lt;Buffer&gt; {
        <span class="hljs-keyword">self</span>.buffers.<span class="hljs-title function_ invoke__">pop</span>()
            .<span class="hljs-title function_ invoke__">unwrap_or_else</span>(|| Arc::<span class="hljs-title function_ invoke__">new</span>(Buffer::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-keyword">self</span>.buffer_size)))
    }
    
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">return_buffer</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, buffer: Arc&lt;Buffer&gt;) {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.buffers.<span class="hljs-title function_ invoke__">len</span>() &lt; MAX_POOL_SIZE {
            <span class="hljs-keyword">self</span>.buffers.<span class="hljs-title function_ invoke__">push</span>(buffer);
        }
        <span class="hljs-comment">// è¶…è¿‡å¤§å°æ—¶è‡ªåŠ¨ä¸¢å¼ƒï¼Œç”±Arcè‡ªåŠ¨å›æ”¶</span>
    }
}

<span class="hljs-comment">// ä½¿ç”¨DMAå‹å¥½çš„å†…å­˜å¯¹é½ç¼“å†²åŒº</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Buffer</span> {
    data: *<span class="hljs-keyword">mut</span> <span class="hljs-type">u8</span>,
    size: <span class="hljs-type">usize</span>,
    dma_ready: <span class="hljs-type">bool</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Buffer</span> {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(size: <span class="hljs-type">usize</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">unsafe</span> {
            <span class="hljs-comment">// åˆ†é…é¡µå¯¹é½å†…å­˜ï¼Œä¾¿äºDMAæ“ä½œ</span>
            <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">data</span> = ptr::<span class="hljs-title function_ invoke__">null_mut</span>();
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">page_size</span> = libc::<span class="hljs-title function_ invoke__">sysconf</span>(libc::_SC_PAGESIZE) <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>;
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">aligned_size</span> = (size + page_size - <span class="hljs-number">1</span>) &amp; !(page_size - <span class="hljs-number">1</span>);
            
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span> = libc::<span class="hljs-title function_ invoke__">posix_memalign</span>(
                &amp;<span class="hljs-keyword">mut</span> data, 
                page_size, 
                aligned_size
            );
            
            <span class="hljs-keyword">if</span> result != <span class="hljs-number">0</span> {
                <span class="hljs-built_in">panic!</span>(<span class="hljs-string">"Failed to allocate aligned memory"</span>);
            }
            
            <span class="hljs-comment">// å»ºè®®å†…æ ¸æ­¤å†…å­˜å°†ç”¨äºDMA</span>
            libc::<span class="hljs-title function_ invoke__">madvise</span>(data, aligned_size, libc::MADV_SEQUENTIAL);
            
            Buffer { data, size: aligned_size, dma_ready: <span class="hljs-literal">true</span> }
        }
    }
}
</code></pre>
<p>ç¼“å†²åŒºæ± æŠ€æœ¯å‡å°‘<strong>60%</strong> çš„å†…å­˜åˆ†é…å¼€é”€ï¼Œé¡µå¯¹é½å†…å­˜ä½¿DMAæ•ˆç‡æå‡â€‹<strong>25%</strong> ã€‚</p>
<h3 data-id="heading-9">å››ã€RDMAä¸é›¶æ‹·è´çš„å®Œç¾ç»“åˆ</h3>
<h4 data-id="heading-10">4.1 è¿œç¨‹ç›´æ¥å†…å­˜è®¿é—®</h4>
<p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼ŒRustFSåˆ©ç”¨RDMAæŠ€æœ¯å®ç°ç½‘ç»œé›¶æ‹·è´ï¼š</p>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-comment">// RDMAé›¶æ‹·è´ä¼ è¾“å®ç°</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">RDMATransport</span> {
    queue_pair: QueuePair,
    memory_region: MemoryRegion,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">RDMATransport</span> {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">post_rdma_write</span>(
        &amp;<span class="hljs-keyword">self</span>,
        remote_addr: <span class="hljs-type">u64</span>,
        local_buffer: &amp;Buffer,
        length: <span class="hljs-type">usize</span>
    ) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;()&gt; {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">work_request</span> = WorkRequest {
            opcode: Opcode::RdmaWrite,
            send_flags: SendFlags::SIGNALED,
            <span class="hljs-comment">// æºï¼šæœ¬åœ°ç¼“å†²åŒºï¼ˆå·²æ³¨å†Œçš„MRï¼‰</span>
            <span class="hljs-comment">// ç›®æ ‡ï¼šè¿œç¨‹å†…å­˜åœ°å€</span>
            <span class="hljs-comment">// æ•°æ®ç›´æ¥ä»æœ¬åœ°å†…å­˜DMAåˆ°è¿œç¨‹å†…å­˜ï¼Œé›¶æ‹·è´</span>
        };
        
        <span class="hljs-keyword">self</span>.queue_pair.<span class="hljs-title function_ invoke__">post_send</span>(work_request)?;
        <span class="hljs-title function_ invoke__">Ok</span>(())
    }
    
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">register_memory</span>(&amp;<span class="hljs-keyword">self</span>, buffer: &amp;[<span class="hljs-type">u8</span>]) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;MemoryRegion&gt; {
        <span class="hljs-comment">// æ³¨å†Œå†…å­˜åŒºåŸŸï¼Œä½¿å…¶å¯ç”¨äºRDMAæ“ä½œ</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">mr</span> = <span class="hljs-keyword">self</span>.protection_domain.<span class="hljs-title function_ invoke__">register_memory</span>(
            buffer.<span class="hljs-title function_ invoke__">as_ptr</span>() <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> _,
            buffer.<span class="hljs-title function_ invoke__">len</span>(),
            AccessFlags::LOCAL_WRITE | AccessFlags::REMOTE_READ,
        )?;
        
        <span class="hljs-title function_ invoke__">Ok</span>(mr)
    }
}
</code></pre>
<p>RDMAå…è®¸ç½‘å¡ç›´æ¥è®¿é—®åº”ç”¨å†…å­˜ï¼Œå®Œå…¨ç»•è¿‡CPUï¼Œå°†ç½‘ç»œå»¶è¿Ÿä»<strong>20Î¼s</strong>é™è‡³â€‹<strong>1Î¼s</strong>ã€‚</p>
<h4 data-id="heading-11">4.2 å†…æ ¸æ—è·¯æŠ€æœ¯</h4>
<p>RustFSé€šè¿‡å†…æ ¸æ—è·¯è¿›ä¸€æ­¥å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š</p>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-comment">// ç”¨æˆ·æ€IOè°ƒåº¦å™¨</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">UserspaceIOScheduler</span> {
    ring_buffer: *<span class="hljs-keyword">mut</span> io_ring,
    completion_poller: std::thread::JoinHandle&lt;()&gt;,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">UserspaceIOScheduler</span> {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ring_buffer</span> = <span class="hljs-keyword">unsafe</span> { <span class="hljs-title function_ invoke__">setup_io_ring</span>() };
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">poller</span> = std::thread::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">move</span> || {
            <span class="hljs-comment">// ä¸“ç”¨çº¿ç¨‹è½®è¯¢å®Œæˆé˜Ÿåˆ—ï¼Œå®Œå…¨åœ¨å†…æ ¸å¤–</span>
            <span class="hljs-keyword">loop</span> {
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">completed</span> = <span class="hljs-keyword">unsafe</span> { <span class="hljs-title function_ invoke__">check_completions</span>(ring_buffer) };
                <span class="hljs-keyword">if</span> completed &gt; <span class="hljs-number">0</span> {
                    <span class="hljs-title function_ invoke__">wake_waiting_tasks</span>(completed);
                } <span class="hljs-keyword">else</span> {
                    std::thread::<span class="hljs-title function_ invoke__">yield_now</span>();
                }
            }
        });
        
        UserspaceIOScheduler { ring_buffer, completion_poller: poller }
    }
}
</code></pre>
<p>å†…æ ¸æ—è·¯æŠ€æœ¯å‡å°‘<strong>85%</strong> çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ŒCPUåˆ©ç”¨ç‡æå‡â€‹<strong>40%</strong> ã€‚</p>
<h3 data-id="heading-12">äº”ã€æ€§èƒ½å¯¹æ¯”å®æµ‹</h3>
<h4 data-id="heading-13">5.1 é›¶æ‹·è´ä¸ä¼ ç»Ÿæ–¹å¼æ€§èƒ½å¯¹æ¯”</h4>
<p>åœ¨ä¸åŒå·¥ä½œè´Ÿè½½ä¸‹ï¼ŒRustFSçš„é›¶æ‹·è´æŠ€æœ¯å±•ç°å‡ºæ˜¾è‘—ä¼˜åŠ¿ï¼š</p>



































<table><thead><tr><th><strong>æµ‹è¯•åœºæ™¯</strong></th><th><strong>ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿ</strong></th><th><strong>RustFSé›¶æ‹·è´</strong></th><th><strong>æ€§èƒ½æå‡</strong></th></tr></thead><tbody><tr><td><strong>1GBé¡ºåºè¯»</strong></td><td>320ms</td><td>80ms</td><td><strong>300%</strong></td></tr><tr><td><strong>4Kéšæœºè¯»</strong></td><td>280K IOPS</td><td>1,580K IOPS</td><td><strong>464%</strong></td></tr><tr><td><strong>ç½‘ç»œä¼ è¾“</strong></td><td>3.2Gbps</td><td>9.8Gbps</td><td><strong>206%</strong></td></tr><tr><td><strong>CPUå ç”¨</strong></td><td>70%</td><td>15%</td><td><strong>é™ä½78%</strong></td></tr></tbody></table>
<p>æ•°æ®æ¥æºï¼š2025å¹´å­˜å‚¨æ€§èƒ½åŸºå‡†æµ‹è¯•</p>
<h4 data-id="heading-14">5.2 å†…å­˜æ•ˆç‡æå‡</h4>
<p>é›¶æ‹·è´æŠ€æœ¯å¤§å¹…é™ä½äº†å†…å­˜å¸¦å®½éœ€æ±‚ï¼š</p>





























<table><thead><tr><th><strong>æ“ä½œç±»å‹</strong></th><th><strong>ä¼ ç»Ÿæ–¹å¼å†…å­˜å¸¦å®½</strong></th><th><strong>é›¶æ‹·è´å†…å­˜å¸¦å®½</strong></th><th><strong>èŠ‚çœå¹…åº¦</strong></th></tr></thead><tbody><tr><td><strong>æ–‡ä»¶è¯»å–</strong></td><td>2.1GB/s</td><td>0.7GB/s</td><td><strong>67%</strong></td></tr><tr><td><strong>ç½‘ç»œå‘é€</strong></td><td>1.8GB/s</td><td>0.3GB/s</td><td><strong>83%</strong></td></tr><tr><td><strong>æ•°æ®å¤„ç†</strong></td><td>3.2GB/s</td><td>1.1GB/s</td><td><strong>66%</strong></td></tr></tbody></table>
<p>æ›´ä½çš„å†…å­˜å¸¦å®½æ¶ˆè€—æ„å‘³ç€æ›´ä½çš„åŠŸè€—å’Œæ›´é«˜çš„ç³»ç»Ÿæ•´ä½“æ•ˆç‡ã€‚</p>
<h3 data-id="heading-15">å…­ã€å®é™…åº”ç”¨åœºæ™¯ä¸ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-16">6.1 é€‚åˆé›¶æ‹·è´çš„åœºæ™¯</h4>
<p>â€‹<strong>å¤§æ•°æ®ä¼ è¾“</strong>ï¼šå¤„ç†å¤§å‹åª’ä½“æ–‡ä»¶ã€ç§‘å­¦æ•°æ®é›†æ—¶ï¼Œé›¶æ‹·è´ä¼˜åŠ¿æ˜æ˜¾</p>
<p>â€‹<strong>é«˜å¹¶å‘æœåŠ¡</strong>ï¼šWebæœåŠ¡å™¨ã€æ–‡ä»¶æœåŠ¡å™¨éœ€è¦åŒæ—¶å¤„ç†å¤§é‡å®¢æˆ·ç«¯è¯·æ±‚</p>
<p>â€‹<strong>ä½å»¶è¿Ÿåº”ç”¨</strong>ï¼šå®æ—¶æ•°æ®å¤„ç†ã€é‡‘èäº¤æ˜“ç³»ç»Ÿå¯¹å»¶è¿Ÿæ•æ„Ÿçš„åœºæ™¯</p>
<h4 data-id="heading-17">6.2 ä¼˜åŒ–é…ç½®å»ºè®®</h4>
<pre><code class="hljs language-Rust" lang="Rust"><span class="hljs-comment">// RustFSæ€§èƒ½è°ƒä¼˜å‚æ•°ç¤ºä¾‹</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">PerformanceTuning</span> {
    <span class="hljs-keyword">pub</span> io_uring_entries: <span class="hljs-type">u32</span>,      <span class="hljs-comment">// æ¨èï¼š4096ï¼Œæé«˜å¹¶å‘èƒ½åŠ›</span>
    <span class="hljs-keyword">pub</span> buffer_pool_size: <span class="hljs-type">usize</span>,    <span class="hljs-comment">// æ¨èï¼š1024ï¼Œå‡å°‘åˆ†é…å¼€é”€</span>
    <span class="hljs-keyword">pub</span> rdma_queue_depth: <span class="hljs-type">u32</span>,      <span class="hljs-comment">// æ¨èï¼š256ï¼Œä¼˜åŒ–ç½‘ç»œä¼ è¾“</span>
    <span class="hljs-keyword">pub</span> enable_huge_pages: <span class="hljs-type">bool</span>,    <span class="hljs-comment">// æ¨èï¼štrueï¼Œå‡å°‘TLBç¼ºå¤±</span>
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Default</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">PerformanceTuning</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">default</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        PerformanceTuning {
            io_uring_entries: <span class="hljs-number">4096</span>,
            buffer_pool_size: <span class="hljs-number">1024</span>,
            rdma_queue_depth: <span class="hljs-number">256</span>,
            enable_huge_pages: <span class="hljs-literal">true</span>,
        }
    }
}
</code></pre>
<p>æ­£ç¡®é…ç½®åï¼ŒRustFSåœ¨NVMeå­˜å‚¨ä¸Šå¯è¾¾åˆ°â€‹<strong>1.58M IOPS</strong>â€‹ï¼Œå»¶è¿Ÿä½äºâ€‹<strong>1ms</strong>ã€‚</p>
<h3 data-id="heading-18">ä¸ƒã€æœªæ¥å±•æœ›</h3>
<p>é›¶æ‹·è´æŠ€æœ¯æ­£åœ¨æˆä¸ºé«˜æ€§èƒ½å­˜å‚¨ç³»ç»Ÿçš„æ ‡é…ã€‚éšç€ç¡¬ä»¶å‘å±•ï¼Œæˆ‘ä»¬é¢„è§ä»¥ä¸‹è¶‹åŠ¿ï¼š</p>
<p>â€‹<strong>computational storage</strong>ï¼šè®¡ç®—å­˜å‚¨è®¾å¤‡ç›´æ¥åœ¨å­˜å‚¨å±‚å¤„ç†æ•°æ®ï¼Œè¿›ä¸€æ­¥å‡å°‘æ•°æ®ç§»åŠ¨</p>
<p>â€‹<strong>æ™ºèƒ½ç½‘å¡</strong>ï¼šæ›´å¼ºå¤§çš„æ™ºèƒ½ç½‘å¡å¯å¤„ç†æ›´å¤æ‚çš„ç½‘ç»œåè®®ï¼Œå‡è½»CPUè´Ÿæ‹…</p>
<p>â€‹<strong>æŒä¹…å†…å­˜</strong>ï¼šæŒä¹…å†…å­˜ä¸é›¶æ‹·è´ç»“åˆï¼Œå°†é‡æ–°å®šä¹‰å­˜å‚¨å±‚æ¬¡ç»“æ„</p>
<p>RustFSå›¢é˜Ÿæ­£åœ¨æ¢ç´¢è¿™äº›æ–°æŠ€æœ¯ï¼Œè®¡åˆ’åœ¨ä¸‹ä¸€ç‰ˆæœ¬ä¸­å®ç°æ›´æ·±åº¦çš„é›¶æ‹·è´ä¼˜åŒ–ã€‚</p>
<h3 data-id="heading-19">ç»“è¯­</h3>
<p>é€šè¿‡æ·±å…¥åˆ†æRustFSçš„æºç ï¼Œæˆ‘ä»¬çœ‹åˆ°é›¶æ‹·è´æŠ€æœ¯å¦‚ä½•ä»æ ¹æœ¬ä¸Šé‡æ„å­˜å‚¨æ€§èƒ½è¾¹ç•Œã€‚ä»<strong>io_uringå¼‚æ­¥I/O</strong>åˆ°â€‹<strong>RDMAç½‘ç»œä¼ è¾“</strong>ï¼ŒRustFSåœ¨å„ä¸ªç¯èŠ‚æ¶ˆé™¤ä¸å¿…è¦çš„æ•°æ®æ‹·è´ï¼Œå®ç°äº†è¿‘ä¹æè‡´çš„æ€§èƒ½è¡¨ç°ã€‚</p>
<p>å¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œç†è§£è¿™äº›åº•å±‚æŠ€æœ¯åŸç†è‡³å…³é‡è¦ã€‚è™½ç„¶æ—¥å¸¸å¼€å‘ä¸­å¯èƒ½ä¸ä¼šç›´æ¥æ“ä½œè¿™äº›åº•å±‚APIï¼Œä½†ç†è§£å…¶å·¥ä½œåŸç†æœ‰åŠ©äºè®¾è®¡å‡ºæ›´é«˜æ•ˆçš„ç³»ç»Ÿæ¶æ„ã€‚</p>
<hr/>
<p>ä»¥ä¸‹æ˜¯æ·±å…¥å­¦ä¹  RustFS çš„æ¨èèµ„æºï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frustfs%2Frustfs" target="_blank" title="https://github.com/rustfs/rustfs" ref="nofollow noopener noreferrer">RustFS</a></p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fdocs.rustfs.com%2F" target="_blank" title="https://link.zhihu.com/?target=https%3A//docs.rustfs.com/" ref="nofollow noopener noreferrer">RustFS å®˜æ–¹æ–‡æ¡£</a>- æä¾›æ¶æ„ã€å®‰è£…æŒ‡å—å’Œ API å‚è€ƒã€‚</p>
<p>GitHub ä»“åº“ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fdocs.rustfs.com%2F" target="_blank" title="https://link.zhihu.com/?target=https%3A//docs.rustfs.com/" ref="nofollow noopener noreferrer">GitHub ä»“åº“</a> - è·å–æºä»£ç ã€æäº¤é—®é¢˜æˆ–è´¡çŒ®ä»£ç ã€‚</p>
<p>ç¤¾åŒºæ”¯æŒï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fgithub.com%2Forgs%2Frustfs%2Fdiscussions" target="_blank" title="https://link.zhihu.com/?target=https%3A//github.com/orgs/rustfs/discussions" ref="nofollow noopener noreferrer">GitHub Discussions</a>- ä¸å¼€å‘è€…äº¤æµç»éªŒå’Œè§£å†³æ–¹æ¡ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <!----></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ¢ç§˜æ–°ä¸€ä»£å‘é‡å­˜å‚¨æ ¼å¼Lance-format (äºŒåäºŒ) è¡¨è¾¾å¼ä¸æŠ•å½±]]></title>    <link>https://juejin.cn/post/7577439614953422900</link>    <guid>https://juejin.cn/post/7577439614953422900</guid>    <pubDate>2025-11-28T07:27:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577439614953422900" data-draft-id="7577378514401755171" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ¢ç§˜æ–°ä¸€ä»£å‘é‡å­˜å‚¨æ ¼å¼Lance-format (äºŒåäºŒ) è¡¨è¾¾å¼ä¸æŠ•å½±"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-28T07:27:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¯­è½å¿ƒç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/2875978147955741"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ¢ç§˜æ–°ä¸€ä»£å‘é‡å­˜å‚¨æ ¼å¼Lance-format (äºŒåäºŒ) è¡¨è¾¾å¼ä¸æŠ•å½±
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978147955741/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¯­è½å¿ƒç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T07:27:41.000Z" title="Fri Nov 28 2025 07:27:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬22ç« ï¼šè¡¨è¾¾å¼ä¸æŠ•å½±</h2>
<h3 data-id="heading-1">ğŸ¯ æ ¸å¿ƒæ¦‚è§ˆ</h3>
<p>è¡¨è¾¾å¼å’ŒæŠ•å½±æ˜¯æŸ¥è¯¢æ‰§è¡Œçš„åŸºç¡€ã€‚è¡¨è¾¾å¼ç”¨äºè®¡ç®—ç»“æœåˆ—çš„å€¼ï¼ˆå¦‚å‡½æ•°è°ƒç”¨ã€ç®—æœ¯è¿ç®—ã€æ¡ä»¶åˆ¤æ–­ï¼‰ï¼ŒæŠ•å½±ç”¨äºé€‰æ‹©å’Œè½¬æ¢è¾“å‡ºçš„åˆ—ã€‚Lance å®ç°äº†ä¸€å¥—é«˜æ•ˆçš„è¡¨è¾¾å¼æ±‚å€¼å’ŒæŠ•å½±ä¸‹æ¨æœºåˆ¶ï¼Œä½¿æŸ¥è¯¢æ€§èƒ½è·å¾—æ•°å€æå‡ã€‚</p>
<p><strong>èƒ½åŠ›</strong>ï¼šä»ä»»æ„è¡¨è¾¾å¼é«˜æ•ˆè®¡ç®—ç»“æœï¼Œæ”¯æŒ<strong>æŠ•å½±ä¸‹æ¨</strong>å‡å°‘ IOã€‚</p>
<hr/>
<h3 data-id="heading-2">ğŸ“ è¡¨è¾¾å¼ç±»å‹ä¸æ±‚å€¼</h3>
<h4 data-id="heading-3">è¡¨è¾¾å¼ä½“ç³»</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Expr</span> {
    <span class="hljs-comment">// å­—é¢å€¼</span>
    <span class="hljs-title function_ invoke__">Literal</span>(ScalarValue),
    
    <span class="hljs-comment">// åˆ—å¼•ç”¨</span>
    Column {
        name: <span class="hljs-type">String</span>,
        index: <span class="hljs-type">usize</span>,  <span class="hljs-comment">// åœ¨ RecordBatch ä¸­çš„åˆ—ç´¢å¼•</span>
    },
    
    <span class="hljs-comment">// ä¸€å…ƒæ“ä½œ</span>
    UnaryOp {
        op: UnaryOperator,    <span class="hljs-comment">// NOT, -, ç­‰</span>
        operand: <span class="hljs-type">Box</span>&lt;Expr&gt;,
    },
    
    <span class="hljs-comment">// äºŒå…ƒæ“ä½œ</span>
    BinaryOp {
        left: <span class="hljs-type">Box</span>&lt;Expr&gt;,
        op: BinaryOperator,   <span class="hljs-comment">// +, -, *, /, &lt;, &gt;, ==, AND, OR ç­‰</span>
        right: <span class="hljs-type">Box</span>&lt;Expr&gt;,
    },
    
    <span class="hljs-comment">// å‡½æ•°è°ƒç”¨</span>
    Function {
        name: <span class="hljs-type">String</span>,
        args: <span class="hljs-type">Vec</span>&lt;Expr&gt;,
        return_type: DataType,
    },
    
    <span class="hljs-comment">// æ¡ä»¶è¡¨è¾¾å¼ï¼ˆCASE WHENï¼‰</span>
    Case {
        operand: <span class="hljs-type">Option</span>&lt;<span class="hljs-type">Box</span>&lt;Expr&gt;&gt;,
        when_then_expr: <span class="hljs-type">Vec</span>&lt;(<span class="hljs-type">Box</span>&lt;Expr&gt;, <span class="hljs-type">Box</span>&lt;Expr&gt;)&gt;,
        else_expr: <span class="hljs-type">Option</span>&lt;<span class="hljs-type">Box</span>&lt;Expr&gt;&gt;,
    },
    
    <span class="hljs-comment">// æŠ•å½±ï¼ˆé€‰æ‹©åˆ—ï¼‰</span>
    <span class="hljs-title function_ invoke__">Project</span>(<span class="hljs-type">Vec</span>&lt;<span class="hljs-type">usize</span>&gt;),
    
    <span class="hljs-comment">// å‘é‡æœç´¢</span>
    VectorSearch {
        column: <span class="hljs-type">String</span>,
        query: <span class="hljs-type">Box</span>&lt;Expr&gt;,
        k: <span class="hljs-type">usize</span>,
    },
    
    <span class="hljs-comment">// å‘é‡è·ç¦»</span>
    VectorDistance {
        left: <span class="hljs-type">Box</span>&lt;Expr&gt;,
        right: <span class="hljs-type">Box</span>&lt;Expr&gt;,
        metric: <span class="hljs-type">String</span>,  <span class="hljs-comment">// "l2", "cosine", "dot"</span>
    },
}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">UnaryOperator</span> {
    Not,           <span class="hljs-comment">// !</span>
    Neg,           <span class="hljs-comment">// -</span>
    IsNull,        <span class="hljs-comment">// IS NULL</span>
    IsNotNull,     <span class="hljs-comment">// IS NOT NULL</span>
}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">BinaryOperator</span> {
    <span class="hljs-comment">// ç®—æœ¯</span>
    Add, Sub, Mul, Div, Rem,
    <span class="hljs-comment">// æ¯”è¾ƒ</span>
    <span class="hljs-built_in">Eq</span>, Lt, Gt, LtEq, GtEq, NotEq,
    <span class="hljs-comment">// é€»è¾‘</span>
    And, Or,
    <span class="hljs-comment">// å­—ç¬¦ä¸²</span>
    Concat,
}
</code></pre>
<h4 data-id="heading-4">è¡¨è¾¾å¼æ±‚å€¼</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title class_">Evaluator</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">evaluate</span>(&amp;<span class="hljs-keyword">self</span>, batch: &amp;RecordBatch) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;ArrayRef&gt;;
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Evaluator</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Expr</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">evaluate</span>(&amp;<span class="hljs-keyword">self</span>, batch: &amp;RecordBatch) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;ArrayRef&gt; {
        <span class="hljs-keyword">match</span> <span class="hljs-keyword">self</span> {
            <span class="hljs-comment">// å­—é¢å€¼ï¼šå¹¿æ’­åˆ°æ•°ç»„</span>
            Expr::<span class="hljs-title function_ invoke__">Literal</span>(val) =&gt; {
                <span class="hljs-title function_ invoke__">Ok</span>(Arc::<span class="hljs-title function_ invoke__">new</span>(val.<span class="hljs-title function_ invoke__">to_array</span>(batch.<span class="hljs-title function_ invoke__">num_rows</span>())))
            }
            
            <span class="hljs-comment">// åˆ—å¼•ç”¨ï¼šç›´æ¥è¿”å›åˆ—</span>
            Expr::Column { name, index } =&gt; {
                <span class="hljs-title function_ invoke__">Ok</span>(batch.<span class="hljs-title function_ invoke__">column</span>(*index).<span class="hljs-title function_ invoke__">clone</span>())
            }
            
            <span class="hljs-comment">// ä¸€å…ƒæ“ä½œ</span>
            Expr::UnaryOp { op, operand } =&gt; {
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">operand_val</span> = operand.<span class="hljs-title function_ invoke__">evaluate</span>(batch)?;
                <span class="hljs-keyword">match</span> op {
                    UnaryOperator::Not =&gt; {
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">bool_array</span> = operand_val.<span class="hljs-title function_ invoke__">as_boolean</span>();
                        <span class="hljs-title function_ invoke__">Ok</span>(Arc::<span class="hljs-title function_ invoke__">new</span>(compute::<span class="hljs-title function_ invoke__">not</span>(bool_array)?))
                    }
                    UnaryOperator::Neg =&gt; {
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">num_array</span> = operand_val.as_primitive::&lt;Float32Type&gt;();
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">neg</span> = num_array.<span class="hljs-title function_ invoke__">iter</span>()
                            .<span class="hljs-title function_ invoke__">map</span>(|v| <span class="hljs-title function_ invoke__">Some</span>(-v))
                            .collect::&lt;<span class="hljs-type">Vec</span>&lt;_&gt;&gt;();
                        <span class="hljs-title function_ invoke__">Ok</span>(Arc::<span class="hljs-title function_ invoke__">new</span>(Float32Array::<span class="hljs-title function_ invoke__">from</span>(neg)))
                    }
                    UnaryOperator::IsNull =&gt; {
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">is_null</span> = operand_val.<span class="hljs-title function_ invoke__">iter</span>()
                            .<span class="hljs-title function_ invoke__">map</span>(|v| <span class="hljs-title function_ invoke__">Some</span>(v.<span class="hljs-title function_ invoke__">is_none</span>()))
                            .collect::&lt;<span class="hljs-type">Vec</span>&lt;_&gt;&gt;();
                        <span class="hljs-title function_ invoke__">Ok</span>(Arc::<span class="hljs-title function_ invoke__">new</span>(BooleanArray::<span class="hljs-title function_ invoke__">from</span>(is_null)))
                    }
                    _ =&gt; <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Unsupported unary op"</span>.<span class="hljs-title function_ invoke__">into</span>()),
                }
            }
            
            <span class="hljs-comment">// äºŒå…ƒæ“ä½œ</span>
            Expr::BinaryOp { left, op, right } =&gt; {
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">left_val</span> = left.<span class="hljs-title function_ invoke__">evaluate</span>(batch)?;
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">right_val</span> = right.<span class="hljs-title function_ invoke__">evaluate</span>(batch)?;
                
                <span class="hljs-keyword">match</span> op {
                    <span class="hljs-comment">// ç®—æœ¯æ“ä½œ</span>
                    BinaryOperator::Add =&gt; {
                        <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">binary_arithmetic</span>(&amp;left_val, &amp;right_val, |a, b| a + b)
                    }
                    BinaryOperator::Sub =&gt; {
                        <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">binary_arithmetic</span>(&amp;left_val, &amp;right_val, |a, b| a - b)
                    }
                    BinaryOperator::Mul =&gt; {
                        <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">binary_arithmetic</span>(&amp;left_val, &amp;right_val, |a, b| a * b)
                    }
                    
                    <span class="hljs-comment">// æ¯”è¾ƒæ“ä½œ</span>
                    BinaryOperator::Lt =&gt; {
                        <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">binary_comparison</span>(&amp;left_val, &amp;right_val, |a, b| a &lt; b)
                    }
                    BinaryOperator::<span class="hljs-built_in">Eq</span> =&gt; {
                        <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">binary_comparison</span>(&amp;left_val, &amp;right_val, |a, b| a == b)
                    }
                    
                    <span class="hljs-comment">// é€»è¾‘æ“ä½œ</span>
                    BinaryOperator::And =&gt; {
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">left_bool</span> = left_val.<span class="hljs-title function_ invoke__">as_boolean</span>();
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">right_bool</span> = right_val.<span class="hljs-title function_ invoke__">as_boolean</span>();
                        <span class="hljs-title function_ invoke__">Ok</span>(Arc::<span class="hljs-title function_ invoke__">new</span>(compute::<span class="hljs-title function_ invoke__">and</span>(left_bool, right_bool)?))
                    }
                    BinaryOperator::Or =&gt; {
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">left_bool</span> = left_val.<span class="hljs-title function_ invoke__">as_boolean</span>();
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">right_bool</span> = right_val.<span class="hljs-title function_ invoke__">as_boolean</span>();
                        <span class="hljs-title function_ invoke__">Ok</span>(Arc::<span class="hljs-title function_ invoke__">new</span>(compute::<span class="hljs-title function_ invoke__">or</span>(left_bool, right_bool)?))
                    }
                    
                    _ =&gt; <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Unsupported binary op"</span>.<span class="hljs-title function_ invoke__">into</span>()),
                }
            }
            
            <span class="hljs-comment">// å‡½æ•°è°ƒç”¨</span>
            Expr::Function { name, args, .. } =&gt; {
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">arg_values</span>: <span class="hljs-type">Result</span>&lt;<span class="hljs-type">Vec</span>&lt;_&gt;&gt; = args.<span class="hljs-title function_ invoke__">iter</span>()
                    .<span class="hljs-title function_ invoke__">map</span>(|arg| arg.<span class="hljs-title function_ invoke__">evaluate</span>(batch))
                    .<span class="hljs-title function_ invoke__">collect</span>();
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">arg_values</span> = arg_values?;
                
                <span class="hljs-comment">// è°ƒç”¨å¯¹åº”çš„å‡½æ•°</span>
                <span class="hljs-keyword">match</span> name.<span class="hljs-title function_ invoke__">as_str</span>() {
                    <span class="hljs-string">"LENGTH"</span> =&gt; <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">function_length</span>(&amp;arg_values[<span class="hljs-number">0</span>]),
                    <span class="hljs-string">"UPPER"</span> =&gt; <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">function_upper</span>(&amp;arg_values[<span class="hljs-number">0</span>]),
                    <span class="hljs-string">"LOWER"</span> =&gt; <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">function_lower</span>(&amp;arg_values[<span class="hljs-number">0</span>]),
                    <span class="hljs-string">"ROUND"</span> =&gt; <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">function_round</span>(&amp;arg_values[<span class="hljs-number">0</span>], &amp;arg_values[<span class="hljs-number">1</span>]),
                    <span class="hljs-string">"ABS"</span> =&gt; <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">function_abs</span>(&amp;arg_values[<span class="hljs-number">0</span>]),
                    _ =&gt; <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-built_in">format!</span>(<span class="hljs-string">"Unknown function: {}"</span>, name).<span class="hljs-title function_ invoke__">into</span>()),
                }
            }
            
            <span class="hljs-comment">// CASE WHEN è¡¨è¾¾å¼</span>
            Expr::Case { operand, when_then_expr, else_expr } =&gt; {
                <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">evaluate_case</span>(batch, operand, when_then_expr, else_expr)
            }
            
            <span class="hljs-comment">// å‘é‡æœç´¢</span>
            Expr::VectorSearch { column, query, k } =&gt; {
                <span class="hljs-comment">// ç‰¹æ®Šå¤„ç†ï¼šè¿”å›æœç´¢ç»“æœçš„è¡Œå·</span>
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">query_vec</span> = query.<span class="hljs-title function_ invoke__">evaluate</span>(batch)?;
                <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">vector_search</span>(batch, column, &amp;query_vec, *k)
            }
            
            <span class="hljs-comment">// å‘é‡è·ç¦»</span>
            Expr::VectorDistance { left, right, metric } =&gt; {
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">left_vec</span> = left.<span class="hljs-title function_ invoke__">evaluate</span>(batch)?;
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">right_vec</span> = right.<span class="hljs-title function_ invoke__">evaluate</span>(batch)?;
                <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">vector_distance</span>(&amp;left_vec, &amp;right_vec, metric)
            }
            
            _ =&gt; <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Unknown expression type"</span>.<span class="hljs-title function_ invoke__">into</span>()),
        }
    }
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Expr</span> {
    <span class="hljs-comment">// äºŒå…ƒç®—æœ¯æ“ä½œçš„é€šç”¨å®ç°</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">binary_arithmetic</span>&lt;F&gt;(
        &amp;<span class="hljs-keyword">self</span>,
        left: &amp;ArrayRef,
        right: &amp;ArrayRef,
        op: F,
    ) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;ArrayRef&gt;
    <span class="hljs-keyword">where</span>
        F: <span class="hljs-title function_ invoke__">Fn</span>(<span class="hljs-type">f32</span>, <span class="hljs-type">f32</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">f32</span>,
    {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">left_arr</span> = left.as_primitive::&lt;Float32Type&gt;();
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">right_arr</span> = right.as_primitive::&lt;Float32Type&gt;();
        
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span>: <span class="hljs-type">Vec</span>&lt;_&gt; = left_arr.<span class="hljs-title function_ invoke__">iter</span>()
            .<span class="hljs-title function_ invoke__">zip</span>(right_arr.<span class="hljs-title function_ invoke__">iter</span>())
            .<span class="hljs-title function_ invoke__">map</span>(|(a, b)| {
                <span class="hljs-title function_ invoke__">match</span> (a, b) {
                    (<span class="hljs-title function_ invoke__">Some</span>(&amp;av), <span class="hljs-title function_ invoke__">Some</span>(&amp;bv)) =&gt; <span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-title function_ invoke__">op</span>(av, bv)),
                    _ =&gt; <span class="hljs-literal">None</span>,
                }
            })
            .<span class="hljs-title function_ invoke__">collect</span>();
        
        <span class="hljs-title function_ invoke__">Ok</span>(Arc::<span class="hljs-title function_ invoke__">new</span>(Float32Array::<span class="hljs-title function_ invoke__">from</span>(result)))
    }
    
    <span class="hljs-comment">// å‘é‡è·ç¦»è®¡ç®—</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">vector_distance</span>(
        &amp;<span class="hljs-keyword">self</span>,
        left: &amp;ArrayRef,
        right: &amp;ArrayRef,
        metric: &amp;<span class="hljs-type">str</span>,
    ) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;ArrayRef&gt; {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">left_fsl</span> = left.<span class="hljs-title function_ invoke__">as_fixed_size_list</span>();
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">right_fsl</span> = right.<span class="hljs-title function_ invoke__">as_fixed_size_list</span>();
        
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">distances</span>: <span class="hljs-type">Vec</span>&lt;_&gt; = (<span class="hljs-number">0</span>..left_fsl.<span class="hljs-title function_ invoke__">len</span>())
            .<span class="hljs-title function_ invoke__">map</span>(|i| {
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">left_vec</span> = left_fsl.<span class="hljs-title function_ invoke__">value</span>(i);
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">right_vec</span> = right_fsl.<span class="hljs-title function_ invoke__">value</span>(i);
                
                <span class="hljs-keyword">match</span> metric {
                    <span class="hljs-string">"l2"</span> =&gt; {
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">left_arr</span> = left_vec.as_primitive::&lt;Float32Type&gt;();
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">right_arr</span> = right_vec.as_primitive::&lt;Float32Type&gt;();
                        
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">dist</span>: <span class="hljs-type">f32</span> = left_arr.<span class="hljs-title function_ invoke__">iter</span>()
                            .<span class="hljs-title function_ invoke__">zip</span>(right_arr.<span class="hljs-title function_ invoke__">iter</span>())
                            .<span class="hljs-title function_ invoke__">map</span>(|(a, b)| <span class="hljs-title function_ invoke__">match</span> (a, b) {
                                (<span class="hljs-title function_ invoke__">Some</span>(&amp;av), <span class="hljs-title function_ invoke__">Some</span>(&amp;bv)) =&gt; (av - bv).<span class="hljs-title function_ invoke__">powi</span>(<span class="hljs-number">2</span>),
                                _ =&gt; <span class="hljs-number">0.0</span>,
                            })
                            .<span class="hljs-title function_ invoke__">sum</span>();
                        
                        <span class="hljs-title function_ invoke__">Some</span>(dist.<span class="hljs-title function_ invoke__">sqrt</span>())
                    }
                    
                    <span class="hljs-string">"cosine"</span> =&gt; {
                        <span class="hljs-comment">// ä½™å¼¦ç›¸ä¼¼åº¦å®ç°</span>
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">left_arr</span> = left_vec.as_primitive::&lt;Float32Type&gt;();
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">right_arr</span> = right_vec.as_primitive::&lt;Float32Type&gt;();
                        
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">dot</span>: <span class="hljs-type">f32</span> = left_arr.<span class="hljs-title function_ invoke__">iter</span>()
                            .<span class="hljs-title function_ invoke__">zip</span>(right_arr.<span class="hljs-title function_ invoke__">iter</span>())
                            .<span class="hljs-title function_ invoke__">map</span>(|(a, b)| <span class="hljs-title function_ invoke__">match</span> (a, b) {
                                (<span class="hljs-title function_ invoke__">Some</span>(&amp;av), <span class="hljs-title function_ invoke__">Some</span>(&amp;bv)) =&gt; av * bv,
                                _ =&gt; <span class="hljs-number">0.0</span>,
                            })
                            .<span class="hljs-title function_ invoke__">sum</span>();
                        
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">left_norm</span>: <span class="hljs-type">f32</span> = left_arr.<span class="hljs-title function_ invoke__">iter</span>()
                            .<span class="hljs-title function_ invoke__">map</span>(|a| <span class="hljs-keyword">match</span> a {
                                <span class="hljs-title function_ invoke__">Some</span>(&amp;v) =&gt; v.<span class="hljs-title function_ invoke__">powi</span>(<span class="hljs-number">2</span>),
                                <span class="hljs-literal">None</span> =&gt; <span class="hljs-number">0.0</span>,
                            })
                            .sum::&lt;<span class="hljs-type">f32</span>&gt;()
                            .<span class="hljs-title function_ invoke__">sqrt</span>();
                        
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">right_norm</span>: <span class="hljs-type">f32</span> = right_arr.<span class="hljs-title function_ invoke__">iter</span>()
                            .<span class="hljs-title function_ invoke__">map</span>(|b| <span class="hljs-keyword">match</span> b {
                                <span class="hljs-title function_ invoke__">Some</span>(&amp;v) =&gt; v.<span class="hljs-title function_ invoke__">powi</span>(<span class="hljs-number">2</span>),
                                <span class="hljs-literal">None</span> =&gt; <span class="hljs-number">0.0</span>,
                            })
                            .sum::&lt;<span class="hljs-type">f32</span>&gt;()
                            .<span class="hljs-title function_ invoke__">sqrt</span>();
                        
                        <span class="hljs-keyword">if</span> left_norm &gt; <span class="hljs-number">0.0</span> &amp;&amp; right_norm &gt; <span class="hljs-number">0.0</span> {
                            <span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">1.0</span> - dot / (left_norm * right_norm))
                        } <span class="hljs-keyword">else</span> {
                            <span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-type">f32</span>::MAX)
                        }
                    }
                    
                    _ =&gt; <span class="hljs-literal">None</span>,
                }
            })
            .<span class="hljs-title function_ invoke__">collect</span>();
        
        <span class="hljs-title function_ invoke__">Ok</span>(Arc::<span class="hljs-title function_ invoke__">new</span>(Float32Array::<span class="hljs-title function_ invoke__">from</span>(distances)))
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-5">ğŸ¯ æŠ•å½±ä¸åˆ—é€‰æ‹©</h3>
<h4 data-id="heading-6">æŠ•å½±çš„ä½œç”¨</h4>
<p>æŠ•å½±æ“ä½œç”¨äºï¼š</p>
<ol>
<li><strong>é€‰æ‹©åˆ—</strong>ï¼šä»å¤šåˆ—ä¸­é€‰å‡ºéœ€è¦çš„åˆ—</li>
<li><strong>åˆ—é‡æ’</strong>ï¼šæ”¹å˜åˆ—çš„é¡ºåº</li>
<li><strong>åˆ—è½¬æ¢</strong>ï¼šåº”ç”¨è¡¨è¾¾å¼è½¬æ¢åˆ—å€¼</li>
<li><strong>å»é‡</strong>ï¼š<code>SELECT DISTINCT</code></li>
</ol>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ProjectionPlan</span> {
    <span class="hljs-keyword">pub</span> input: Arc&lt;<span class="hljs-keyword">dyn</span> ExecutionPlan&gt;,
    <span class="hljs-keyword">pub</span> expressions: <span class="hljs-type">Vec</span>&lt;Expr&gt;,  <span class="hljs-comment">// æŠ•å½±è¡¨è¾¾å¼</span>
    <span class="hljs-keyword">pub</span> output_names: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">String</span>&gt;,  <span class="hljs-comment">// è¾“å‡ºåˆ—å</span>
}

<span class="hljs-meta">#[async_trait]</span>
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">ExecutionPlan</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">ProjectionPlan</span> {
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">execute</span>(
        &amp;<span class="hljs-keyword">self</span>,
        partition: <span class="hljs-type">usize</span>,
        state: Arc&lt;TaskContext&gt;,
    ) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;SendableRecordBatchStream&gt; {
        <span class="hljs-comment">// 1. æ‰§è¡Œè¾“å…¥è®¡åˆ’</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">input_stream</span> = <span class="hljs-keyword">self</span>.input.<span class="hljs-title function_ invoke__">execute</span>(partition, state).<span class="hljs-keyword">await</span>?;
        
        <span class="hljs-comment">// 2. å¯¹æ¯ä¸ª batch åº”ç”¨æŠ•å½±</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">output_stream</span> = input_stream.<span class="hljs-title function_ invoke__">map</span>(|batch| {
            <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">project_batch</span>(&amp;batch)
        });
        
        <span class="hljs-title function_ invoke__">Ok</span>(<span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">pin</span>(output_stream))
    }
    
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">schema</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> SchemaRef {
        <span class="hljs-comment">// æ„å»ºæŠ•å½±åçš„ schema</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">fields</span>: <span class="hljs-type">Vec</span>&lt;_&gt; = <span class="hljs-keyword">self</span>.output_names.<span class="hljs-title function_ invoke__">iter</span>()
            .<span class="hljs-title function_ invoke__">zip</span>(&amp;<span class="hljs-keyword">self</span>.expressions)
            .<span class="hljs-title function_ invoke__">map</span>(|(name, expr)| {
                Field::<span class="hljs-title function_ invoke__">new</span>(name.<span class="hljs-title function_ invoke__">clone</span>(), expr.<span class="hljs-title function_ invoke__">return_type</span>(), <span class="hljs-literal">true</span>)
            })
            .<span class="hljs-title function_ invoke__">collect</span>();
        Arc::<span class="hljs-title function_ invoke__">new</span>(Schema::<span class="hljs-title function_ invoke__">new</span>(fields))
    }
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">ProjectionPlan</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">project_batch</span>(&amp;<span class="hljs-keyword">self</span>, batch: &amp;RecordBatch) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;RecordBatch&gt; {
        <span class="hljs-comment">// å¯¹ batch ä¸­çš„æ¯ä¸ªè¡¨è¾¾å¼æ±‚å€¼</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">columns</span> = <span class="hljs-built_in">vec!</span>[];
        
        <span class="hljs-keyword">for</span> <span class="hljs-variable">expr</span> <span class="hljs-keyword">in</span> &amp;<span class="hljs-keyword">self</span>.expressions {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">col_array</span> = expr.<span class="hljs-title function_ invoke__">evaluate</span>(batch)?;
            columns.<span class="hljs-title function_ invoke__">push</span>(col_array);
        }
        
        <span class="hljs-comment">// æ„å»ºæ–°çš„ batch</span>
        <span class="hljs-title function_ invoke__">Ok</span>(RecordBatch::<span class="hljs-title function_ invoke__">try_new</span>(<span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">schema</span>(), columns)?)
    }
}
</code></pre>
<h4 data-id="heading-7">æŠ•å½±ä¸‹æ¨ä¼˜åŒ–</h4>
<p>æŠ•å½±ä¸‹æ¨çš„ç›®æ ‡æ˜¯<strong>å°½æ—©å‡å°‘åˆ—</strong>ï¼Œå‡å°‘ IO å’Œå†…å­˜æ¶ˆè€—ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ProjectionPushdown</span>;

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">ProjectionPushdown</span> {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">optimize</span>(&amp;<span class="hljs-keyword">self</span>, plan: &amp;ExecutionPlan) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;Arc&lt;<span class="hljs-keyword">dyn</span> ExecutionPlan&gt;&gt; {
        <span class="hljs-keyword">match</span> plan {
            <span class="hljs-comment">// æŠ•å½± - æ‰«æï¼šä¸‹æ¨åˆ°æ‰«æ</span>
            ProjectionPlan {
                input: <span class="hljs-keyword">box</span> ScanPlan { table, .. },
                expressions,
                ..
            } =&gt; {
                <span class="hljs-comment">// åˆ†ææŠ•å½±è¡¨è¾¾å¼ä¸­å¼•ç”¨çš„åˆ—</span>
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">required_columns</span> = <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">extract_columns</span>(expressions);
                
                <span class="hljs-comment">// åˆ›å»ºåªæ‰«æè¿™äº›åˆ—çš„æ–° ScanPlan</span>
                <span class="hljs-title function_ invoke__">Ok</span>(Arc::<span class="hljs-title function_ invoke__">new</span>(ScanPlan {
                    table: table.<span class="hljs-title function_ invoke__">clone</span>(),
                    projection: <span class="hljs-title function_ invoke__">Some</span>(required_columns),
                    <span class="hljs-comment">// ...</span>
                }))
            }
            
            <span class="hljs-comment">// æŠ•å½± - è¿‡æ»¤ï¼šåˆ†æè¿‡æ»¤ä¸­çš„åˆ—</span>
            ProjectionPlan {
                input: <span class="hljs-keyword">box</span> FilterPlan { predicate, .. },
                expressions,
                ..
            } =&gt; {
                <span class="hljs-comment">// éœ€è¦çš„åˆ— = æŠ•å½±åˆ— + è¿‡æ»¤åˆ—</span>
                <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">required</span> = <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">extract_columns</span>(expressions);
                required.<span class="hljs-title function_ invoke__">extend</span>(<span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">extract_columns_from_expr</span>(predicate));
                required.<span class="hljs-title function_ invoke__">sort</span>();
                required.<span class="hljs-title function_ invoke__">dedup</span>();
                
                <span class="hljs-comment">// ... ä¸‹æ¨</span>
                <span class="hljs-title function_ invoke__">Ok</span>(Arc::<span class="hljs-title function_ invoke__">new</span>(...))
            }
            
            _ =&gt; <span class="hljs-title function_ invoke__">Ok</span>(Arc::<span class="hljs-title function_ invoke__">new</span>(plan.<span class="hljs-title function_ invoke__">clone</span>())),
        }
    }
    
    <span class="hljs-comment">// ä»è¡¨è¾¾å¼ä¸­æå–å¼•ç”¨çš„åˆ—ç´¢å¼•</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">extract_columns</span>(&amp;<span class="hljs-keyword">self</span>, expressions: &amp;[Expr]) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">usize</span>&gt; {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">columns</span> = <span class="hljs-built_in">vec!</span>[];
        <span class="hljs-keyword">for</span> <span class="hljs-variable">expr</span> <span class="hljs-keyword">in</span> expressions {
            <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">extract_columns_from_expr_into</span>(expr, &amp;<span class="hljs-keyword">mut</span> columns);
        }
        columns
    }
    
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">extract_columns_from_expr_into</span>(&amp;<span class="hljs-keyword">self</span>, expr: &amp;Expr, columns: &amp;<span class="hljs-keyword">mut</span> <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">usize</span>&gt;) {
        <span class="hljs-keyword">match</span> expr {
            Expr::Column { index, .. } =&gt; {
                columns.<span class="hljs-title function_ invoke__">push</span>(*index);
            }
            Expr::BinaryOp { left, right, .. } =&gt; {
                <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">extract_columns_from_expr_into</span>(left, columns);
                <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">extract_columns_from_expr_into</span>(right, columns);
            }
            Expr::UnaryOp { operand, .. } =&gt; {
                <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">extract_columns_from_expr_into</span>(operand, columns);
            }
            Expr::Function { args, .. } =&gt; {
                <span class="hljs-keyword">for</span> <span class="hljs-variable">arg</span> <span class="hljs-keyword">in</span> args {
                    <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">extract_columns_from_expr_into</span>(arg, columns);
                }
            }
            _ =&gt; {}
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-8">ğŸ” è°“è¯åˆ†æä¸ä¸‹æ¨</h3>
<h4 data-id="heading-9">è°“è¯åˆ†æ</h4>
<p>è°“è¯åˆ†æç”¨äºè¯†åˆ«å“ªäº›æ¡ä»¶å¯ä»¥åœ¨ç´¢å¼•å±‚é¢å¤„ç†ï¼Œä»¥å‡å°‘æ•°æ®æ‰«æã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">PredicateAnalyzer</span> {
    schema: SchemaRef,
    index_info: IndexInfo,  <span class="hljs-comment">// ç´¢å¼•ä¿¡æ¯</span>
}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">PredicatePushdownSupport</span> {
    Unsupported,   <span class="hljs-comment">// æ— æ³•ä¸‹æ¨</span>
    Partial,       <span class="hljs-comment">// éƒ¨åˆ†æ”¯æŒï¼ˆå¦‚éœ€è¦é¢å¤–è¿‡æ»¤ï¼‰</span>
    Full,          <span class="hljs-comment">// å®Œå…¨æ”¯æŒ</span>
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">PredicateAnalyzer</span> {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">analyze_pushdown</span>(&amp;<span class="hljs-keyword">self</span>, predicate: &amp;Expr) <span class="hljs-punctuation">-&gt;</span> PredicatePushdownSupport {
        <span class="hljs-keyword">match</span> predicate {
            <span class="hljs-comment">// ç­‰å€¼æŸ¥è¯¢ï¼šcolumn = value</span>
            Expr::BinaryOp {
                left: <span class="hljs-keyword">box</span> Expr::Column { name, .. },
                op: BinaryOperator::<span class="hljs-built_in">Eq</span>,
                right: <span class="hljs-keyword">box</span> Expr::<span class="hljs-title function_ invoke__">Literal</span>(_),
            } =&gt; {
                <span class="hljs-comment">// æ£€æŸ¥åˆ—æ˜¯å¦æœ‰ç´¢å¼•</span>
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.index_info.<span class="hljs-title function_ invoke__">has_index</span>(name) {
                    PredicatePushdownSupport::Full
                } <span class="hljs-keyword">else</span> {
                    PredicatePushdownSupport::Partial
                }
            }
            
            <span class="hljs-comment">// èŒƒå›´æŸ¥è¯¢ï¼šcolumn &gt; value AND column &lt; value</span>
            Expr::BinaryOp {
                left,
                op: BinaryOperator::And,
                right,
            } =&gt; {
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">left_support</span> = <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">analyze_pushdown</span>(left);
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">right_support</span> = <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">analyze_pushdown</span>(right);
                
                <span class="hljs-title function_ invoke__">match</span> (left_support, right_support) {
                    (PredicatePushdownSupport::Full, PredicatePushdownSupport::Full) =&gt; {
                        PredicatePushdownSupport::Full
                    }
                    (PredicatePushdownSupport::Unsupported, _) | (_, PredicatePushdownSupport::Unsupported) =&gt; {
                        PredicatePushdownSupport::Unsupported
                    }
                    _ =&gt; PredicatePushdownSupport::Partial,
                }
            }
            
            <span class="hljs-comment">// å‘é‡æœç´¢ï¼šç‰¹æ®Šå¤„ç†ï¼Œä¸èƒ½æ™®é€šä¸‹æ¨</span>
            Expr::VectorSearch { .. } =&gt; {
                PredicatePushdownSupport::Unsupported
            }
            
            _ =&gt; PredicatePushdownSupport::Partial,
        }
    }
    
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">split_predicate</span>(&amp;<span class="hljs-keyword">self</span>, predicate: &amp;Expr) <span class="hljs-punctuation">-&gt;</span> (<span class="hljs-type">Option</span>&lt;Expr&gt;, <span class="hljs-type">Option</span>&lt;Expr&gt;) {
        <span class="hljs-comment">// å°†è°“è¯åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</span>
        <span class="hljs-comment">// 1. å¯ä»¥ä¸‹æ¨çš„ï¼ˆåœ¨ç´¢å¼•å±‚å¤„ç†ï¼‰</span>
        <span class="hljs-comment">// 2. æ— æ³•ä¸‹æ¨çš„ï¼ˆåœ¨æ‰§è¡Œå™¨å¤„ç†ï¼‰</span>
        
        <span class="hljs-keyword">match</span> predicate {
            Expr::BinaryOp {
                left,
                op: BinaryOperator::And,
                right,
            } =&gt; {
                <span class="hljs-keyword">let</span> (push_left, no_push_left) = <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">split_predicate</span>(left);
                <span class="hljs-keyword">let</span> (push_right, no_push_right) = <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">split_predicate</span>(right);
                
                <span class="hljs-comment">// åˆå¹¶å¯æ¨çš„æ¡ä»¶</span>
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">pushdown</span> = <span class="hljs-title function_ invoke__">match</span> (push_left, push_right) {
                    (<span class="hljs-title function_ invoke__">Some</span>(l), <span class="hljs-title function_ invoke__">Some</span>(r)) =&gt; <span class="hljs-title function_ invoke__">Some</span>(Expr::BinaryOp {
                        left: <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(l),
                        op: BinaryOperator::And,
                        right: <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(r),
                    }),
                    (<span class="hljs-title function_ invoke__">Some</span>(e), <span class="hljs-literal">None</span>) | (<span class="hljs-literal">None</span>, <span class="hljs-title function_ invoke__">Some</span>(e)) =&gt; <span class="hljs-title function_ invoke__">Some</span>(e),
                    (<span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>) =&gt; <span class="hljs-literal">None</span>,
                };
                
                <span class="hljs-comment">// åˆå¹¶æ— æ³•æ¨çš„æ¡ä»¶</span>
                <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">no_pushdown</span> = <span class="hljs-title function_ invoke__">match</span> (no_push_left, no_push_right) {
                    (<span class="hljs-title function_ invoke__">Some</span>(l), <span class="hljs-title function_ invoke__">Some</span>(r)) =&gt; <span class="hljs-title function_ invoke__">Some</span>(Expr::BinaryOp {
                        left: <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(l),
                        op: BinaryOperator::And,
                        right: <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(r),
                    }),
                    (<span class="hljs-title function_ invoke__">Some</span>(e), <span class="hljs-literal">None</span>) | (<span class="hljs-literal">None</span>, <span class="hljs-title function_ invoke__">Some</span>(e)) =&gt; <span class="hljs-title function_ invoke__">Some</span>(e),
                    (<span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>) =&gt; <span class="hljs-literal">None</span>,
                };
                
                (pushdown, no_pushdown)
            }
            
            _ =&gt; {
                <span class="hljs-comment">// å•ä¸ªè°“è¯ï¼šåˆ¤æ–­æ˜¯å¦å¯æ¨</span>
                <span class="hljs-keyword">if</span> matches!(<span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">analyze_pushdown</span>(predicate), PredicatePushdownSupport::Full) {
                    (<span class="hljs-title function_ invoke__">Some</span>(predicate.<span class="hljs-title function_ invoke__">clone</span>()), <span class="hljs-literal">None</span>)
                } <span class="hljs-keyword">else</span> {
                    (<span class="hljs-literal">None</span>, <span class="hljs-title function_ invoke__">Some</span>(predicate.<span class="hljs-title function_ invoke__">clone</span>()))
                }
            }
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-10">ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹</h3>
<h4 data-id="heading-11">CASE WHEN ä¼˜åŒ–</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> lance
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># åˆ›å»ºç¤ºä¾‹æ•°æ®</span>
data = {
    <span class="hljs-string">"id"</span>: np.arange(<span class="hljs-number">1000</span>),
    <span class="hljs-string">"price"</span>: np.random.randint(<span class="hljs-number">10</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>),
    <span class="hljs-string">"category"</span>: np.random.choice([<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>], <span class="hljs-number">1000</span>),
}

table = lance.write_table(data, uri=<span class="hljs-string">"data.lance"</span>)

<span class="hljs-comment"># SQL æŸ¥è¯¢ï¼šä½¿ç”¨ CASE WHEN è¿›è¡Œåˆ†ç±»</span>
result = table.search_sql(<span class="hljs-string">"""
    SELECT 
        id,
        price,
        CASE 
            WHEN price &lt; 100 THEN 'cheap'
            WHEN price &lt; 500 THEN 'medium'
            ELSE 'expensive'
        END as price_tier,
        CASE category
            WHEN 'A' THEN 1
            WHEN 'B' THEN 2
            WHEN 'C' THEN 3
            ELSE 0
        END as category_code
    FROM data
    WHERE price &gt; 50
"""</span>)

<span class="hljs-comment"># è½¬æ¢ä¸º Pandas</span>
df = result.to_pandas()
<span class="hljs-built_in">print</span>(df)
</code></pre>
<h4 data-id="heading-12">åˆ—æŠ•å½±ä¼˜åŒ–</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¼˜åŒ–å‰ï¼šæ‰«ææ‰€æœ‰åˆ—</span>
result = table.search_sql(<span class="hljs-string">"""
    SELECT * FROM data WHERE price &gt; 100
"""</span>)

<span class="hljs-comment"># ä¼˜åŒ–åï¼šåªæ‰«æéœ€è¦çš„åˆ—ï¼ˆæŠ•å½±ä¸‹æ¨ï¼‰</span>
result = table.search_sql(<span class="hljs-string">"""
    SELECT id, price FROM data WHERE price &gt; 100
"""</span>)

<span class="hljs-comment"># æ€§èƒ½æå‡ï¼šå‡è®¾è¡¨æœ‰ 100 åˆ—ï¼Œåªéœ€è¦ 2 åˆ—</span>
<span class="hljs-comment"># æ€§èƒ½æå‡æ¯”ä¾‹ â‰ˆ 100 / 2 = 50x</span>
</code></pre>
<hr/>
<h3 data-id="heading-13">ğŸ“š æ€»ç»“</h3>
<p>è¡¨è¾¾å¼ä¸æŠ•å½±æ˜¯æŸ¥è¯¢æ‰§è¡Œçš„æ ¸å¿ƒï¼š</p>
<ol>
<li><strong>è¡¨è¾¾å¼æ±‚å€¼</strong>ï¼šæ”¯æŒæ‰€æœ‰å¸¸è§çš„è¿ç®—å’Œå‡½æ•°</li>
<li><strong>æŠ•å½±ä¸‹æ¨</strong>ï¼šå°½æ—©å‡å°‘åˆ—ï¼Œå‡å°‘ IO</li>
<li><strong>è°“è¯åˆ†æ</strong>ï¼šåˆ¤æ–­æ¡ä»¶æ˜¯å¦å¯åœ¨ç´¢å¼•å±‚å¤„ç†</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé€šè¿‡ä¸‹æ¨å’Œèåˆå¤§å¹…é™ä½æˆæœ¬</li>
</ol>
<p>è¿™äº›æœºåˆ¶å…±åŒä½œç”¨ï¼Œä½¿ Lance èƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†å¤æ‚çš„åˆ†ææŸ¥è¯¢ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäºC++ä»0åˆ°1æ‰‹å†™Linuxé«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹æ¡†æ¶(è¶…æ¸…)]]></title>    <link>https://juejin.cn/post/7577668116500283430</link>    <guid>https://juejin.cn/post/7577668116500283430</guid>    <pubDate>2025-11-28T07:42:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577668116500283430" data-draft-id="7577431644068773939" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäºC++ä»0åˆ°1æ‰‹å†™Linuxé«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹æ¡†æ¶(è¶…æ¸…)"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-28T07:42:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¯¾ç¨‹xingkeitä¸top"/> <meta itemprop="url" content="https://juejin.cn/user/1910275039560096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäºC++ä»0åˆ°1æ‰‹å†™Linuxé«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹æ¡†æ¶(è¶…æ¸…)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1910275039560096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¯¾ç¨‹xingkeitä¸top
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T07:42:09.000Z" title="Fri Nov 28 2025 07:42:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨Linuxç¯å¢ƒä¸‹ï¼Œé«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹çš„æ ¸å¿ƒåœ¨äº<strong>é«˜æ•ˆåˆ©ç”¨ç³»ç»Ÿèµ„æºã€å‡å°‘æ‹·è´ã€ä¼˜åŒ–äº‹ä»¶å¤„ç†æœºåˆ¶</strong>ã€‚æœ¬æ•™ç¨‹å°†å¸¦ä½ ä»é›¶å®ç°ä¸€ä¸ªåŸºäº<strong>Reactoræ¨¡å¼+Epoll</strong>çš„C++ç½‘ç»œæ¡†æ¶ï¼Œæ”¯æŒé«˜å¹¶å‘ï¼ˆç™¾ä¸‡çº§è¿æ¥ï¼‰ã€ä½å»¶è¿Ÿï¼ˆå¾®ç§’çº§å“åº”ï¼‰ï¼Œå¹¶åŒ…å«å…³é”®ä»£ç è§£æä¸å®Œæ•´å®ç°æ­¥éª¤ã€‚</p>
<hr/>
<h3 data-id="heading-0"><strong>ä¸€ã€æ¡†æ¶è®¾è®¡æ ¸å¿ƒæ€æƒ³</strong></h3>
<ol>
<li>
<p><strong>Reactoræ¨¡å¼</strong>ï¼š</p>
<ul>
<li>ä¸»çº¿ç¨‹ï¼ˆReactorï¼‰ç›‘å¬æ‰€æœ‰äº‹ä»¶ï¼ˆå¦‚è¿æ¥ã€è¯»å†™ï¼‰ï¼Œé€šè¿‡å›è°ƒå‡½æ•°å°†äº‹ä»¶åˆ†å‘ç»™å·¥ä½œçº¿ç¨‹å¤„ç†ã€‚</li>
<li>é¿å…å¤šçº¿ç¨‹ç«äº‰ï¼Œå‡å°‘é”å¼€é”€ã€‚</li>
</ul>
</li>
<li>
<p><strong>Epollè¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰</strong> ï¼š</p>
<ul>
<li>ç›¸æ¯”æ°´å¹³è§¦å‘ï¼ˆLTï¼‰ï¼ŒETæ¨¡å¼ä»…åœ¨æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥ï¼Œå‡å°‘é‡å¤äº‹ä»¶å¤„ç†ã€‚</li>
<li>éœ€é…åˆéé˜»å¡IOï¼ˆ<code>fcntl(fd, F_SETFL, O_NONBLOCK)</code>ï¼‰ä½¿ç”¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜æ± ä¸é›¶æ‹·è´</strong>ï¼š</p>
<ul>
<li>è‡ªå®šä¹‰å†…å­˜æ± å‡å°‘åŠ¨æ€å†…å­˜åˆ†é…å¼€é”€ã€‚</li>
<li>ä½¿ç”¨<code>sendfile</code>ç³»ç»Ÿè°ƒç”¨å®ç°æ–‡ä»¶ä¼ è¾“é›¶æ‹·è´ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-1"><strong>äºŒã€å…³é”®ç»„ä»¶å®ç°</strong></h3>
<h4 data-id="heading-2"><strong>1. åŸºç¡€ç»“æ„å®šä¹‰</strong></h4>
<pre><code class="hljs language-arduino" lang="arduino">cpp
<span class="hljs-number">1</span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/epoll.h&gt;</span></span>
<span class="hljs-number">2</span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-number">3</span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unordered_map&gt;</span></span>
<span class="hljs-number">4</span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;functional&gt;</span></span>
<span class="hljs-number">5</span>
<span class="hljs-number">6</span><span class="hljs-comment">// äº‹ä»¶å›è°ƒç±»å‹å®šä¹‰</span>
<span class="hljs-number">7u</span>sing EventCallback = std::function&lt;<span class="hljs-built_in">void</span>(<span class="hljs-type">int</span> fd)&gt;;
<span class="hljs-number">8</span>
<span class="hljs-number">9</span><span class="hljs-comment">// è¿æ¥å¯¹è±¡ï¼ˆå°è£…socketæè¿°ç¬¦ä¸å›è°ƒï¼‰</span>
<span class="hljs-number">10</span><span class="hljs-keyword">struct</span> Connection {
<span class="hljs-number">11</span>    <span class="hljs-type">int</span> fd;
<span class="hljs-number">12</span>    EventCallback onRead;
<span class="hljs-number">13</span>    EventCallback onWrite;
<span class="hljs-number">14</span>    <span class="hljs-comment">// å…¶ä»–ä¸šåŠ¡æ•°æ®ï¼ˆå¦‚ç¼“å†²åŒºã€çŠ¶æ€ç­‰ï¼‰</span>
<span class="hljs-number">15</span>};
<span class="hljs-number">16</span>
<span class="hljs-number">17</span><span class="hljs-comment">// Reactoræ ¸å¿ƒç±»</span>
<span class="hljs-number">18</span><span class="hljs-keyword">class</span> Reactor {
<span class="hljs-number">19</span><span class="hljs-keyword">private</span>:
<span class="hljs-number">20</span>    <span class="hljs-type">int</span> epoll_fd;
<span class="hljs-number">21</span>    std::unordered_map&lt;<span class="hljs-type">int</span>, Connection&gt; connections; <span class="hljs-comment">// fdåˆ°è¿æ¥çš„æ˜ å°„</span>
<span class="hljs-number">22</span>
<span class="hljs-number">23</span><span class="hljs-keyword">public</span>:
<span class="hljs-number">24</span>    <span class="hljs-built_in">Reactor</span>() {
<span class="hljs-number">25</span>        epoll_fd = <span class="hljs-built_in">epoll_create1</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// åˆ›å»ºepollå®ä¾‹</span>
<span class="hljs-number">26</span>        <span class="hljs-keyword">if</span> (epoll_fd == <span class="hljs-number">-1</span>) {
<span class="hljs-number">27</span>            <span class="hljs-built_in">perror</span>(<span class="hljs-string">"epoll_create1 failed"</span>);
<span class="hljs-number">28</span>            <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
<span class="hljs-number">29</span>        }
<span class="hljs-number">30</span>    }
<span class="hljs-number">31</span>
<span class="hljs-number">32</span>    ~<span class="hljs-built_in">Reactor</span>() { <span class="hljs-built_in">close</span>(epoll_fd); }
<span class="hljs-number">33</span>
<span class="hljs-number">34</span>    <span class="hljs-comment">// æ·»åŠ äº‹ä»¶ç›‘å¬</span>
<span class="hljs-number">35</span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addEvent</span><span class="hljs-params">(<span class="hljs-type">int</span> fd, <span class="hljs-type">uint32_t</span> events, EventCallback onRead, EventCallback onWrite)</span></span>;
<span class="hljs-number">36</span>    
<span class="hljs-number">37</span>    <span class="hljs-comment">// äº‹ä»¶å¾ªç¯</span>
<span class="hljs-number">38</span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span>;
<span class="hljs-number">39</span>};
</code></pre>
<h4 data-id="heading-3"><strong>2. Epolläº‹ä»¶ç®¡ç†</strong></h4>
<pre><code class="hljs language-ini" lang="ini">cpp
1void Reactor::addEvent(int fd, uint32_t events, EventCallback onRead, EventCallback onWrite) {
2    // è®¾ç½®socketä¸ºéé˜»å¡
3    int <span class="hljs-attr">flags</span> = fcntl(fd, F_GETFL, <span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
4    fcntl(fd, F_SETFL, flags | O_NONBLOCK)<span class="hljs-comment">;</span>
5
6    // æ³¨å†Œäº‹ä»¶åˆ°epoll
7    struct epoll_event ev<span class="hljs-comment">;</span>
8    <span class="hljs-attr">ev.events</span> = events | EPOLLET<span class="hljs-comment">; // è¾¹ç¼˜è§¦å‘</span>
9    <span class="hljs-attr">ev.data.fd</span> = fd<span class="hljs-comment">;</span>
10
11    if (epoll_ctl(epoll_fd, EPOLL_CTL_ADD, fd, &amp;ev) == -1) {
12        perror("epoll_ctl add failed")<span class="hljs-comment">;</span>
13        close(fd)<span class="hljs-comment">;</span>
14        return<span class="hljs-comment">;</span>
15    }
16
17    // ä¿å­˜è¿æ¥ä¿¡æ¯
18    connections<span class="hljs-section">[fd]</span> = {fd, onRead, onWrite}<span class="hljs-comment">;</span>
19}
</code></pre>
<h4 data-id="heading-4"><strong>3. äº‹ä»¶å¾ªç¯ä¸å›è°ƒåˆ†å‘</strong></h4>
<pre><code class="hljs language-ini" lang="ini">cpp
1void Reactor::run() {
2    const int <span class="hljs-attr">MAX_EVENTS</span> = <span class="hljs-number">1024</span><span class="hljs-comment">;</span>
3    struct epoll_event events<span class="hljs-section">[MAX_EVENTS]</span><span class="hljs-comment">;</span>
4
5    while (true) {
6        int <span class="hljs-attr">n</span> = epoll_wait(epoll_fd, events, MAX_EVENTS, -<span class="hljs-number">1</span>)<span class="hljs-comment">; // é˜»å¡ç­‰å¾…äº‹ä»¶</span>
7        if (<span class="hljs-attr">n</span> == -<span class="hljs-number">1</span>) {
8            perror("epoll_wait failed")<span class="hljs-comment">;</span>
9            break<span class="hljs-comment">;</span>
10        }
11
12        for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; n; ++i) {</span>
13            int <span class="hljs-attr">fd</span> = events[i].data.fd<span class="hljs-comment">;</span>
14            auto&amp; <span class="hljs-attr">conn</span> = connections[fd]<span class="hljs-comment">;</span>
15
16            if (events<span class="hljs-section">[i]</span>.events &amp; EPOLLIN) { // å¯è¯»äº‹ä»¶
17                if (conn.onRead) conn.onRead(fd)<span class="hljs-comment">;</span>
18            }
19
20            if (events<span class="hljs-section">[i]</span>.events &amp; EPOLLOUT) { // å¯å†™äº‹ä»¶
21                if (conn.onWrite) conn.onWrite(fd)<span class="hljs-comment">;</span>
22            }
23
24            // å¤„ç†é”™è¯¯æˆ–æŒ‚æ–­äº‹ä»¶
25            if (events<span class="hljs-section">[i]</span>.events &amp; (EPOLLERR | EPOLLHUP)) {
26                close(fd)<span class="hljs-comment">;</span>
27                connections.erase(fd)<span class="hljs-comment">;</span>
28            }
29        }
30    }
31}
</code></pre>
<hr/>
<h3 data-id="heading-5"><strong>ä¸‰ã€å®Œæ•´æœåŠ¡ç«¯å®ç°</strong></h3>
<h4 data-id="heading-6"><strong>1. åˆå§‹åŒ–ä¸å¯åŠ¨æœåŠ¡</strong></h4>
<pre><code class="hljs language-c" lang="c">cpp
<span class="hljs-number">1</span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-number">2</span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span>
<span class="hljs-number">3</span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-number">4</span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span>
<span class="hljs-number">5</span>
<span class="hljs-number">6</span><span class="hljs-comment">// ç®€å•çš„è¯»å›è°ƒï¼šå›æ˜¾æ•°æ®</span>
<span class="hljs-number">7</span><span class="hljs-type">void</span> <span class="hljs-title function_">onRead</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span> {
<span class="hljs-number">8</span>    <span class="hljs-type">char</span> buf[<span class="hljs-number">1024</span>];
<span class="hljs-number">9</span>    <span class="hljs-type">ssize_t</span> n = recv(fd, buf, <span class="hljs-keyword">sizeof</span>(buf), <span class="hljs-number">0</span>);
<span class="hljs-number">10</span>    <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">0</span>) {
<span class="hljs-number">11</span>        send(fd, buf, n, <span class="hljs-number">0</span>); <span class="hljs-comment">// å›æ˜¾</span>
<span class="hljs-number">12</span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) { <span class="hljs-comment">// å®¢æˆ·ç«¯å…³é—­è¿æ¥</span>
<span class="hljs-number">13</span>        close(fd);
<span class="hljs-number">14</span>    }
<span class="hljs-number">15</span>}
<span class="hljs-number">16</span>
<span class="hljs-number">17</span><span class="hljs-comment">// ç®€å•çš„å†™å›è°ƒï¼ˆç¤ºä¾‹ä¸­æœªä½¿ç”¨ï¼‰</span>
<span class="hljs-number">18</span><span class="hljs-type">void</span> <span class="hljs-title function_">onWrite</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span> { <span class="hljs-comment">/* ... */</span> }
<span class="hljs-number">19</span>
<span class="hljs-number">20</span><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
<span class="hljs-number">21</span>    Reactor reactor;
<span class="hljs-number">22</span>
<span class="hljs-number">23</span>    <span class="hljs-comment">// åˆ›å»ºç›‘å¬socket</span>
<span class="hljs-number">24</span>    <span class="hljs-type">int</span> listen_fd = socket(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);
<span class="hljs-number">25</span>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr_in</span> <span class="hljs-title">addr</span>;</span>
<span class="hljs-number">26</span>    <span class="hljs-built_in">memset</span>(&amp;addr, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(addr));
<span class="hljs-number">27</span>    addr.sin_family = AF_INET;
<span class="hljs-number">28</span>    addr.sin_port = htons(<span class="hljs-number">8080</span>);
<span class="hljs-number">29</span>    addr.sin_addr.s_addr = INADDR_ANY;
<span class="hljs-number">30</span>
<span class="hljs-number">31</span>    bind(listen_fd, (<span class="hljs-keyword">struct</span> sockaddr*)&amp;addr, <span class="hljs-keyword">sizeof</span>(addr));
<span class="hljs-number">32</span>    listen(listen_fd, SOMAXCONN);
<span class="hljs-number">33</span>
<span class="hljs-number">34</span>    <span class="hljs-comment">// å°†ç›‘å¬socketè®¾ä¸ºéé˜»å¡å¹¶æ·»åŠ åˆ°Reactor</span>
<span class="hljs-number">35</span>    <span class="hljs-type">int</span> flags = fcntl(listen_fd, F_GETFL, <span class="hljs-number">0</span>);
<span class="hljs-number">36</span>    fcntl(listen_fd, F_SETFL, flags | O_NONBLOCK);
<span class="hljs-number">37</span>
<span class="hljs-number">38</span>    <span class="hljs-comment">// ç›‘å¬å¯è¯»äº‹ä»¶ï¼ˆæ–°è¿æ¥åˆ°è¾¾ï¼‰</span>
<span class="hljs-number">39</span>    reactor.addEvent(listen_fd, EPOLLIN, [](<span class="hljs-type">int</span> fd) {
<span class="hljs-number">40</span>        <span class="hljs-keyword">struct</span> sockaddr_in client_addr;
<span class="hljs-number">41</span>        <span class="hljs-type">socklen_t</span> len = <span class="hljs-keyword">sizeof</span>(client_addr);
<span class="hljs-number">42</span>        <span class="hljs-type">int</span> client_fd = accept(fd, (<span class="hljs-keyword">struct</span> sockaddr*)&amp;client_addr, &amp;len);
<span class="hljs-number">43</span>        <span class="hljs-keyword">if</span> (client_fd &gt; <span class="hljs-number">0</span>) {
<span class="hljs-number">44</span>            <span class="hljs-comment">// ä¸ºæ–°è¿æ¥æ³¨å†Œè¯»äº‹ä»¶ï¼ˆå›æ˜¾ä¸šåŠ¡ï¼‰</span>
<span class="hljs-number">45</span>            Reactor* reactor = Reactor::getInstance(); <span class="hljs-comment">// å‡è®¾Reactorä¸ºå•ä¾‹</span>
<span class="hljs-number">46</span>            reactor-&gt;addEvent(client_fd, EPOLLIN, onRead, onWrite);
<span class="hljs-number">47</span>        }
<span class="hljs-number">48</span>    }, nullptr);
<span class="hljs-number">49</span>
<span class="hljs-number">50</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Server started on port 8080..."</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
<span class="hljs-number">51</span>    reactor.run(); <span class="hljs-comment">// å¯åŠ¨äº‹ä»¶å¾ªç¯</span>
<span class="hljs-number">52</span>
<span class="hljs-number">53</span>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
<span class="hljs-number">54</span>}
</code></pre>
<h4 data-id="heading-7"><strong>2. æ€§èƒ½ä¼˜åŒ–æŠ€å·§</strong></h4>
<ol>
<li>
<p><strong>SO_REUSEPORT</strong>ï¼šå…è®¸å¤šçº¿ç¨‹ç»‘å®šåŒä¸€ç«¯å£ï¼ŒåŠ é€Ÿè¿æ¥å»ºç«‹ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">cpp
1int <span class="hljs-attr">opt</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
2setsockopt(listen_fd, SOL_SOCKET, SO_REUSEPORT, &amp;opt, sizeof(opt))<span class="hljs-comment">;</span>
</code></pre>
</li>
<li>
<p><strong>TCP_FASTOPEN</strong>ï¼šå‡å°‘TCPæ¡æ‰‹å»¶è¿Ÿï¼ˆéœ€å†…æ ¸æ”¯æŒï¼‰ã€‚</p>
<pre><code class="hljs language-scss" lang="scss">cpp
<span class="hljs-number">1s</span><span class="hljs-built_in">etsockopt</span>(listen_fd, IPPROTO_TCP, TCP_FASTOPEN, &amp;opt, sizeof(opt));
</code></pre>
</li>
<li>
<p><strong>å†…å­˜æ± ä¼˜åŒ–</strong>ï¼šé¢„åˆ†é…ç¼“å†²åŒºæ± ï¼Œé¿å…é¢‘ç¹<code>malloc/free</code>ã€‚</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-8"><strong>å››ã€æµ‹è¯•ä¸éªŒè¯</strong></h3>
<ol>
<li>
<p><strong>ä½¿ç”¨<code>wrk</code>å‹æµ‹</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">bash
<span class="hljs-number">1</span>wrk -t4 -c1000 -d30s http:<span class="hljs-comment">//localhost:8080</span>
</code></pre>
<ul>
<li><code>-t4</code>ï¼š4ä¸ªçº¿ç¨‹</li>
<li><code>-c1000</code>ï¼š1000ä¸ªå¹¶å‘è¿æ¥</li>
<li><code>-d30s</code>ï¼šæŒç»­30ç§’</li>
</ul>
</li>
<li>
<p><strong>ç›‘æ§ç³»ç»ŸæŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><code>netstat -anp | grep 8080</code>ï¼šæŸ¥çœ‹è¿æ¥æ•°</li>
<li><code>top -p &lt;pid&gt;</code>ï¼šè§‚å¯ŸCPUå ç”¨</li>
<li><code>strace -p &lt;pid&gt;</code>ï¼šè·Ÿè¸ªç³»ç»Ÿè°ƒç”¨</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-9"><strong>äº”ã€æ‰©å±•åŠŸèƒ½å»ºè®®</strong></h3>
<ol>
<li><strong>å®šæ—¶å™¨æ”¯æŒ</strong>ï¼šé›†æˆ<code>timerfd</code>å®ç°å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚å¿ƒè·³æ£€æµ‹ï¼‰ã€‚</li>
<li><strong>çº¿ç¨‹æ± </strong>ï¼šå°†è€—æ—¶ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢ï¼‰æ”¾åˆ°å·¥ä½œçº¿ç¨‹æ± å¤„ç†ã€‚</li>
<li><strong>SSL/TLSåŠ å¯†</strong>ï¼šé›†æˆOpenSSLæ”¯æŒHTTPSã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-10"><strong>å…­ã€æ€»ç»“</strong></h3>
<p>æœ¬æ•™ç¨‹å®ç°äº†<strong>åŸºäºReactor+Epollçš„C++é«˜æ€§èƒ½ç½‘ç»œæ¡†æ¶</strong>ï¼Œæ ¸å¿ƒä»£ç ä»…200ä½™è¡Œï¼Œå´å…·å¤‡ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li><strong>ç™¾ä¸‡çº§è¿æ¥</strong>ï¼šé€šè¿‡Epollè¾¹ç¼˜è§¦å‘ä¸éé˜»å¡IOå®ç°ã€‚</li>
<li><strong>ä½å»¶è¿Ÿ</strong>ï¼šå‡å°‘äº‹ä»¶å¤„ç†ä¸­çš„å†—ä½™æ‹·è´ä¸ç³»ç»Ÿè°ƒç”¨ã€‚</li>
<li><strong>æ˜“æ‰©å±•</strong>ï¼šé€šè¿‡å›è°ƒæœºåˆ¶åˆ†ç¦»äº‹ä»¶å¤„ç†ä¸ä¸šåŠ¡é€»è¾‘ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ†å¸ƒå¼è®¢å•ç³»ç»Ÿï¼šè®¢å•å·ç¼–ç è®¾è®¡å®æˆ˜]]></title>    <link>https://juejin.cn/post/7577438119558086707</link>    <guid>https://juejin.cn/post/7577438119558086707</guid>    <pubDate>2025-11-28T07:02:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577438119558086707" data-draft-id="7577307100130836530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ†å¸ƒå¼è®¢å•ç³»ç»Ÿï¼šè®¢å•å·ç¼–ç è®¾è®¡å®æˆ˜"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-11-28T07:02:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Carve_the_Code"/> <meta itemprop="url" content="https://juejin.cn/user/624178336105997"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ†å¸ƒå¼è®¢å•ç³»ç»Ÿï¼šè®¢å•å·ç¼–ç è®¾è®¡å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/624178336105997/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Carve_the_Code
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T07:02:15.000Z" title="Fri Nov 28 2025 07:02:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åˆ†å¸ƒå¼è®¢å•ç³»ç»Ÿï¼šè®¢å•å·ç¼–ç è®¾è®¡å®æˆ˜</h2>
<blockquote>
<p><strong>ä½œè€…</strong>: Carve_the_Code
<strong>æ ‡ç­¾</strong>: #åˆ†å¸ƒå¼ç³»ç»Ÿ #æ•°æ®åº“åˆ†ç‰‡ #æ€§èƒ½ä¼˜åŒ– #æ¶æ„è®¾è®¡</p>
</blockquote>
<blockquote>
<p><strong>å£°æ˜</strong>ï¼šæœ¬æ–‡åŸºäºé€šç”¨åˆ†å¸ƒå¼ç³»ç»Ÿå®è·µæ€»ç»“ï¼Œä»£ç ä¸ºç®€åŒ–ç¤ºä¾‹ï¼Œæ€§èƒ½æ•°æ®ä¸ºå…¸å‹åœºæ™¯å‚è€ƒå€¼ã€‚</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€èƒŒæ™¯ï¼šåˆ†åº“åˆ†è¡¨åçš„è·¯ç”±å›°å¢ƒ</h3>
<h4 data-id="heading-2">1.1 ä¸šåŠ¡åœºæ™¯</h4>
<p>æŸå¤§å‹ OTA å¹³å°çš„è®¢å•ç³»ç»Ÿæ”¯æŒå¤šå›½å®¶ã€å¤šæ¸ é“ä¸šåŠ¡ï¼Œä¸»è¦æœåŠ¡äºï¼š</p>
<ul>
<li><strong>EU_CHANNEL</strong>: æ¬§æ´²å¤šå›½ä¸šåŠ¡</li>
<li><strong>GLOBAL_CHANNEL</strong>: å›½é™…ç«™ä¸šåŠ¡</li>
<li><strong>CN_CHANNEL</strong>: å›½å†…ç«™å›½é™…ä¸šåŠ¡</li>
</ul>
<p>ä½œä¸ºæ ¸å¿ƒæœåŠ¡ï¼Œè®¢å•è¯¦æƒ…æŸ¥è¯¢æ˜¯æœ€é«˜é¢‘çš„æ“ä½œä¹‹ä¸€ï¼Œæ¯å¤©å¤„ç†åƒä¸‡çº§æŸ¥è¯¢è¯·æ±‚ã€‚</p>
<h3 data-id="heading-3">äºŒã€æ¶æ„æ¼”è¿›</h3>
<h4 data-id="heading-4">2.1 å•åº“æ—¶ä»£</h4>
<p><strong>è®¢å•å·è®¾è®¡</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨å…¬å¸ç»Ÿä¸€çš„åˆ†å¸ƒå¼ ID æœåŠ¡ï¼ˆåŸºäº Snowflakeï¼‰</li>
<li>orderId ä¸º 64 ä½ Longï¼Œå…¨å±€å”¯ä¸€ã€è¶‹åŠ¿é€’å¢</li>
<li><strong>ä¸åŒ…å«ä»»ä½•ä¸šåŠ¡è·¯ç”±ä¿¡æ¯</strong></li>
</ul>
<p><strong>æŸ¥è¯¢æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_order <span class="hljs-keyword">WHERE</span> order_id <span class="hljs-operator">=</span> ?
</code></pre>
<p>ç®€å•é«˜æ•ˆï¼Œå•åº“è¶³ä»¥æ”¯æ’‘åˆæœŸä¸šåŠ¡é‡ã€‚</p>
<h4 data-id="heading-5">2.2 åˆ†åº“åˆ†è¡¨ï¼ˆè·¯ç”±å›°å¢ƒæµ®ç°ï¼‰</h4>
<p><strong>æ”¹é€ èƒŒæ™¯</strong>ï¼šè®¢å•é‡æŒç»­å¢é•¿ï¼Œå•åº“æ€§èƒ½ç“¶é¢ˆï¼Œå¿…é¡»åˆ†åº“åˆ†è¡¨ã€‚</p>
<p><strong>åˆ†ç‰‡æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>æŒ‰ channel + orderId % 4 æ‹†åˆ†</li>
<li>ä¸åŒæ¸ é“çš„æ•°æ®ç‰©ç†éš”ç¦»</li>
</ul>
<p><strong>é—®é¢˜æ¥äº†</strong>ï¼šè®¢å•å·ä»ç„¶æ˜¯æ™®é€š Snowflake IDï¼Œ<strong>ä¸åŒ…å«è·¯ç”±ä¿¡æ¯</strong>ï¼</p>
<p>æŸ¥è¯¢è®¢å•æ—¶çš„å›°å¢ƒï¼š</p>
<ol>
<li>æ‹¿åˆ° orderIdï¼Œä½†ä¸çŸ¥é“å±äºå“ªä¸ªæ¸ é“</li>
<li>å¿…é¡»å…ˆæŸ¥è¯¢è®¢å•ç´¢å¼•è¡¨ï¼Œè·å–æ¸ é“ä¿¡æ¯</li>
<li>å†æ ¹æ®æ¸ é“ä¿¡æ¯å®šä½åˆ°å…·ä½“åˆ†ç‰‡</li>
</ol>
<p><strong>æ€§èƒ½å½±å“</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">æŸ¥è¯¢è€—æ—¶ï¼šä»å‡ åæ¯«ç§’ â†’ æ•°ç™¾æ¯«ç§’
P99 å»¶è¿Ÿï¼šè¶…è¿‡ <span class="hljs-number">1</span> ç§’
åŸå› ï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½è¦å…ˆ<span class="hljs-string">"æ‰¾åˆ†ç‰‡"</span>
</code></pre>
<h4 data-id="heading-6">2.3 è®¢å•å·ç¼–ç ä¼˜åŒ–ï¼ˆè§£å†³è·¯ç”±é—®é¢˜ï¼‰</h4>
<p><strong>æ ¸å¿ƒæ€è·¯</strong>ï¼šæ”¹é€  ID ç”Ÿæˆé€»è¾‘ï¼Œå°†è·¯ç”±ä¿¡æ¯ç¼–ç åˆ°è®¢å•å·ä¸­ã€‚</p>
<p><strong>çµæ„Ÿæ¥æº</strong>ï¼šèº«ä»½è¯å·</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">èº«ä»½è¯å·:</span> <span class="hljs-number">110101</span> <span class="hljs-number">1990 </span><span class="hljs-number">0101 </span><span class="hljs-string">001X</span>
          <span class="hljs-string">â””â”€â”€â”¬â”€â”˜</span> <span class="hljs-string">â””â”€â”€â”€â”¬â”€â”€â”˜</span> <span class="hljs-string">â””â”¬â”˜</span>
           <span class="hljs-string">åœ°åŒº</span>  <span class="hljs-string">å‡ºç”Ÿæ—¥æœŸ</span>  <span class="hljs-string">åºåˆ—å·</span>
          <span class="hljs-string">(åŒ—äº¬)</span> <span class="hljs-string">(1990.01.01)</span>
</code></pre>
<p>çœ‹åˆ°èº«ä»½è¯å·å‰ 6 ä½ï¼Œå°±çŸ¥é“æ˜¯å“ªä¸ªåœ°åŒºçš„äººï¼Œ<strong>æ— éœ€æŸ¥åº“</strong>ï¼</p>
<p><strong>æ–¹æ¡ˆ</strong>ï¼šåœ¨ 64 ä½è®¢å•å·ä¸­åµŒå…¥ 4 ä½ routeKeyï¼ŒæŸ¥è¯¢æ—¶ç›´æ¥è§£æï¼Œæ— éœ€æŸ¥åº“ã€‚</p>
<p><strong>æ ¸å¿ƒæ”¶ç›Š</strong>ï¼š</p>
<ul>
<li>95% çš„æŸ¥è¯¢æ— éœ€æŸ¥åº“è·å–è·¯ç”±ä¿¡æ¯</li>
<li>æŸ¥è¯¢æ€§èƒ½æ˜¾è‘—æå‡ï¼ˆ<strong>æ•°åå€æå‡</strong>ï¼‰</li>
<li>æ•°æ®åº“è´Ÿè½½é™ä½ 80%</li>
</ul>
<p><strong>å…¼å®¹ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>æ–°è®¢å•ï¼šç¼–ç äº† routeKeyï¼Œå¯ç›´æ¥è§£æ</li>
<li>è€è®¢å•ï¼šæ²¡æœ‰ç¼–ç ä¿¡æ¯ï¼Œèµ°å…œåº•æŸ¥åº“</li>
<li>å¼‚å¸¸æƒ…å†µï¼šä¸‰å±‚é™çº§ç­–ç•¥ä¿è¯å¯ç”¨æ€§</li>
</ul>
<h3 data-id="heading-7">ä¸‰ã€æŠ€æœ¯å®ç°ï¼šè®¢å•å·ç¼–ç </h3>
<h4 data-id="heading-8">3.1 ä½ç»“æ„è®¾è®¡</h4>
<blockquote>
<p>æ–¹æ¡ˆå‚è€ƒäº†ä¸šç•Œæˆç†Ÿçš„åˆ†å¸ƒå¼ ID å®è·µï¼ˆå¦‚ç¾å›¢ Leafï¼‰ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ äº†è·¯ç”±ä¿¡æ¯ç¼–ç ã€‚</p>
</blockquote>
<p>åŸæœ‰ Snowflake ç»“æ„ï¼ˆ64 ä½ï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¶é—´æˆ³(<span class="hljs-number">41</span>ä½) â”‚ æ•°æ®ä¸­å¿ƒ(<span class="hljs-number">5</span>ä½) â”‚ æœºå™¨<span class="hljs-built_in">ID</span>(<span class="hljs-number">5</span>ä½)   â”‚ åºåˆ—å·(<span class="hljs-number">12</span>ä½)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æ”¹é€ å</strong>ï¼šå‹ç¼©æœºå™¨IDï¼Œè…¾å‡º 4 ä½ç»™ routeKey</p>
<p><strong>64 ä½è®¢å•å·ç»“æ„</strong>ï¼š</p>
<pre><code class="hljs language-swift" lang="swift">block<span class="hljs-operator">-</span>beta
    columns <span class="hljs-number">4</span>
    block:timestamp[<span class="hljs-string">"æ—¶é—´æˆ³<span class="hljs-subst">\n</span>41ä½<span class="hljs-subst">\n</span>bit63-23"</span>]
    end
    block:dc[<span class="hljs-string">"æ•°æ®ä¸­å¿ƒ<span class="hljs-subst">\n</span>5ä½<span class="hljs-subst">\n</span>bit22-18"</span>]
    end
    block:routeKey[<span class="hljs-string">"routeKey<span class="hljs-subst">\n</span>4ä½<span class="hljs-subst">\n</span>bit17-14"</span>]
    end
    block:seq[<span class="hljs-string">"åºåˆ—å·<span class="hljs-subst">\n</span>14ä½<span class="hljs-subst">\n</span>bit13-0"</span>]
    end
</code></pre>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ—¶é—´æˆ³(<span class="hljs-number">41</span>ä½)  â”‚ æ•°æ®ä¸­å¿ƒ(<span class="hljs-number">5</span>ä½) â”‚ <span class="hljs-built_in">routeKey</span>(<span class="hljs-number">4</span>ä½) â”‚  åºåˆ—å·(<span class="hljs-number">14</span>ä½)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   bit <span class="hljs-number">63</span>-<span class="hljs-number">23</span>   â”‚   bit <span class="hljs-number">22</span>-<span class="hljs-number">18</span>  â”‚   bit <span class="hljs-number">17</span>-<span class="hljs-number">14</span>  â”‚   bit <span class="hljs-number">13</span>-<span class="hljs-number">0</span>   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  é«˜ä½ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ä½ä½
</code></pre>
<p><strong>å…³é”®è®¾è®¡ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>routeKey å  4 ä½ï¼ˆ4 bitsï¼‰</strong>ï¼šå¯ä»¥è¡¨ç¤º 16 ç§æ¸ é“ï¼ˆ2^4 = 16ï¼‰</li>
<li><strong>ä½ç½®é€‰æ‹©</strong>ï¼šæ”¾åœ¨åºåˆ—å·ä¹‹å‰ï¼ˆbit 17-14ï¼Œä»é«˜åˆ°ä½ï¼‰ï¼Œä¾¿äºä½è¿ç®—æå–</li>
<li><strong>ç¼–ç æ˜ å°„</strong>ï¼šEU_CHANNEL â†’ 5, GLOBAL_CHANNEL â†’ 2, CN_CHANNEL â†’ 1</li>
</ul>
<h4 data-id="heading-9">3.2 ä¸ºä»€ä¹ˆæ˜¯ 4 ä½ï¼Ÿ</h4>
<p><strong>å®¹é‡è®¡ç®—</strong>ï¼š</p>
<ul>
<li>å½“å‰ä¸šåŠ¡æœ‰ 3 ä¸ªä¸»è¦æ¸ é“</li>
<li>æœªæ¥å¯èƒ½å¢åŠ æ›´å¤šæ¸ é“</li>
<li>4 ä½å¯ä»¥è¡¨ç¤º 16 ç§æ¸ é“ï¼Œ<strong>é¢„ç•™ 13 ç§æ‰©å±•ç©ºé—´</strong></li>
</ul>
<p><strong>ä½æ•°æƒè¡¡</strong>ï¼š</p>
<ul>
<li>å¤ªå°‘ï¼ˆ2 ä½ï¼‰ï¼šåªèƒ½è¡¨ç¤º 4 ç§æ¸ é“ï¼Œæ‰©å±•æ€§ä¸è¶³</li>
<li>å¤ªå¤šï¼ˆ8 ä½ï¼‰ï¼šæµªè´¹ç©ºé—´ï¼ŒæŒ¤å‹åºåˆ—å·ä½æ•°ï¼Œå½±å“å¹¶å‘æ€§èƒ½</li>
<li><strong>4 ä½åˆšå¥½</strong>ï¼šæ»¡è¶³å½“å‰éœ€æ±‚ + æœªæ¥æ‰©å±•</li>
</ul>
<h4 data-id="heading-10">3.3 ç¼–ç è¿‡ç¨‹ï¼ˆå®Œæ•´æµç¨‹ï¼‰</h4>
<p><strong>è®¢å•å·ç”Ÿæˆæ—¶åºå›¾</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant OrderService as è®¢å•æœåŠ¡
    participant IdGenerator as IDç”Ÿæˆå™¨
    participant UserDataService as ç”¨æˆ·æ•°æ®æœåŠ¡
    
    Client-&gt;&gt;OrderService: ä¸‹å•è¯·æ±‚(region=GB)
    OrderService-&gt;&gt;UserDataService: æŸ¥è¯¢ routeKey(region)
    UserDataService--&gt;&gt;OrderService: EU_CHANNEL
    OrderService-&gt;&gt;IdGenerator: ç”Ÿæˆè®¢å•å·(routeKey)
    Note over IdGenerator: ä½è¿ç®—ç¼–ç  routeKey
    IdGenerator--&gt;&gt;OrderService: orderId(å«è·¯ç”±ä¿¡æ¯)
    OrderService--&gt;&gt;Client: è®¢å•åˆ›å»ºæˆåŠŸ
</code></pre>
<p><strong>æ­¥éª¤ 1</strong>ï¼šç”¨æˆ·ä¼ å…¥ <code>region</code>ï¼ˆç”¨æˆ·åœ°åŒºï¼Œå›½å®¶ä»£ç ï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·ä¸‹å•æ—¶ä¼ å…¥ region</span>
<span class="hljs-type">GenerateOrderIdRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenerateOrderIdRequest</span>();
request.setRegion(<span class="hljs-string">"GB"</span>);  <span class="hljs-comment">// è‹±å›½</span>
request.setUid(<span class="hljs-string">"user123"</span>);
</code></pre>
<p><strong>æ­¥éª¤ 2</strong>ï¼šregion â†’ routeKey æ˜ å°„</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è®¢å•å·ç”ŸæˆæœåŠ¡å†…éƒ¨ä¼šå°† region æ˜ å°„ä¸º routeKey</span>
<span class="hljs-comment">// GB (è‹±å›½) â†’ EU_CHANNEL</span>
<span class="hljs-comment">// ES (è¥¿ç­ç‰™) â†’ EU_CHANNEL</span>
<span class="hljs-comment">// CN (ä¸­å›½) â†’ CN_CHANNEL</span>
<span class="hljs-comment">// è¿™ä¸ªæ˜ å°„å…³ç³»ç”±ç”¨æˆ·æ•°æ®æœåŠ¡ç»´æŠ¤</span>

<span class="hljs-type">GenerateOrderIdRequest</span> <span class="hljs-variable">generateOrderIdRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenerateOrderIdRequest</span>();
generateOrderIdRequest.setUid(request.getUid());
generateOrderIdRequest.setRegion(request.getRegion());

<span class="hljs-comment">// è°ƒç”¨è®¢å•å·ç”ŸæˆæœåŠ¡</span>
<span class="hljs-type">Long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> idGeneratorService.generateId(generateOrderIdRequest).getOrderId();
</code></pre>
<p><strong>æ­¥éª¤ 3</strong>ï¼šrouteKey â†’ 4 ä½ç¼–ç </p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è®¢å•å·ç”ŸæˆæœåŠ¡å†…éƒ¨å®ç°ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderIdEncoder</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">encodeRouteKey</span><span class="hljs-params">(String routeKey)</span> {
        <span class="hljs-comment">// routeKey æ˜ å°„ä¸º 4 ä½æ•´æ•°</span>
        <span class="hljs-keyword">switch</span> (routeKey) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"EU_CHANNEL"</span>:     <span class="hljs-keyword">return</span> <span class="hljs-number">5</span>;   <span class="hljs-comment">// 0101</span>
            <span class="hljs-keyword">case</span> <span class="hljs-string">"GLOBAL_CHANNEL"</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;   <span class="hljs-comment">// 0010</span>
            <span class="hljs-keyword">case</span> <span class="hljs-string">"BIZ_CHANNEL"</span>:    <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;   <span class="hljs-comment">// 0011</span>
            <span class="hljs-keyword">case</span> <span class="hljs-string">"CN_CHANNEL"</span>:     <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;   <span class="hljs-comment">// 0001</span>
            <span class="hljs-keyword">case</span> <span class="hljs-string">"CORP_CHANNEL"</span>:   <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>;   <span class="hljs-comment">// 0100</span>
            <span class="hljs-keyword">default</span>:               <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;   <span class="hljs-comment">// 0000 (å¼‚å¸¸æƒ…å†µ)</span>
        }
    }
}
</code></pre>
<p><strong>æ­¥éª¤ 4</strong>ï¼šæ‹¼æ¥åˆ° orderIdï¼ˆä½è¿ç®—ï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Snowflake æ”¹é€ ç‰ˆæœ¬ï¼ˆä¼ªä»£ç ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">generateOrderId</span><span class="hljs-params">(String routeKey)</span> {
    <span class="hljs-comment">// 1. è·å–å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - EPOCH;  <span class="hljs-comment">// ç›¸å¯¹æ—¶é—´æˆ³</span>

    <span class="hljs-comment">// 2. è·å–æ•°æ®ä¸­å¿ƒ ID</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">datacenter</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;  <span class="hljs-comment">// å‡è®¾å½“å‰æ•°æ®ä¸­å¿ƒ ID ä¸º 3</span>

    <span class="hljs-comment">// 3. ç¼–ç  routeKey</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">routeKeyBits</span> <span class="hljs-operator">=</span> encodeRouteKey(routeKey);  <span class="hljs-comment">// 5 (EU_CHANNEL)</span>

    <span class="hljs-comment">// 4. è·å–åºåˆ—å·ï¼ˆåŒä¸€æ¯«ç§’å†…é€’å¢ï¼‰</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">sequence</span> <span class="hljs-operator">=</span> getSequence();  <span class="hljs-comment">// å‡è®¾å½“å‰åºåˆ—å·ä¸º 123</span>

    <span class="hljs-comment">// 5. ä½æ‹¼æ¥ï¼šå°†å„æ®µä¿¡æ¯æ‹¼æ¥æˆ 64 ä½ Long</span>
    <span class="hljs-comment">//    æ—¶é—´æˆ³(41ä½) | æ•°æ®ä¸­å¿ƒ(5ä½) | routeKey(4ä½) | åºåˆ—å·(14ä½)</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    orderId |= (timestamp &lt;&lt; <span class="hljs-number">23</span>);        <span class="hljs-comment">// æ—¶é—´æˆ³å·¦ç§» 23 ä½ï¼ˆ5+4+14ï¼‰</span>
    orderId |= (datacenter &lt;&lt; <span class="hljs-number">18</span>);       <span class="hljs-comment">// æ•°æ®ä¸­å¿ƒå·¦ç§» 18 ä½ï¼ˆ4+14ï¼‰</span>
    orderId |= (routeKeyBits &lt;&lt; <span class="hljs-number">14</span>);     <span class="hljs-comment">// routeKey å·¦ç§» 14 ä½ â¬…ï¸ å…³é”®ï¼</span>
    orderId |= sequence;                  <span class="hljs-comment">// åºåˆ—å·å æ®ä½ 14 ä½</span>

    <span class="hljs-keyword">return</span> orderId;
}
</code></pre>
<p><strong>ç”Ÿæˆçš„è®¢å•å·ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">åè¿›åˆ¶:</span> <span class="hljs-number">1234567890123456789</span>
<span class="hljs-string">äºŒè¿›åˆ¶:</span> <span class="hljs-number">0001 </span><span class="hljs-number">0001 </span><span class="hljs-number">0010 </span><span class="hljs-number">0011 </span><span class="hljs-number">0100 </span><span class="hljs-number">0101 </span><span class="hljs-number">0110 </span><span class="hljs-number">0111</span>
        <span class="hljs-number">1000 </span><span class="hljs-number">1001 </span><span class="hljs-number">0000 </span><span class="hljs-number">0001 </span><span class="hljs-number">0010 </span><span class="hljs-number">0011 </span><span class="hljs-number">0100 </span><span class="hljs-number">0101</span>
                                 <span class="hljs-string">â†‘</span> <span class="hljs-string">(bit</span> <span class="hljs-number">17</span><span class="hljs-number">-14</span><span class="hljs-string">)</span>
                           <span class="hljs-string">routeKey</span> <span class="hljs-string">=</span> <span class="hljs-number">0101</span>
                           <span class="hljs-string">(å€¼</span> <span class="hljs-number">5</span> <span class="hljs-string">â†’</span> <span class="hljs-string">EU_CHANNEL)</span>
</code></pre>
<p><strong>å…³é”®æŠ€æœ¯</strong>ï¼š</p>
<ul>
<li><strong>å·¦ç§»è¿ç®—ï¼ˆ&lt;&lt;ï¼‰</strong>ï¼šå°†æ•°æ®ç§»åˆ°æŒ‡å®šä½ç½®</li>
<li><strong>æˆ–è¿ç®—ï¼ˆ|ï¼‰</strong>ï¼šæ‹¼æ¥å¤šæ®µæ•°æ®</li>
<li><strong>æ— æŸç¼–ç </strong>ï¼šæ‰€æœ‰ä¿¡æ¯éƒ½ä¿ç•™åœ¨ 64 ä½ Long ä¸­</li>
</ul>
<h4 data-id="heading-11">3.4 è§£ç è¿‡ç¨‹ï¼ˆåå‘æå–ï¼‰</h4>
<p><strong>å®Œæ•´çš„ getRouteKey æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getRouteKey</span><span class="hljs-params">(Long orderId)</span> {
    <span class="hljs-type">OrderIdDecoder</span> <span class="hljs-variable">orderIdDecoder</span> <span class="hljs-operator">=</span> OrderIdFactory.getOrderIdDecoder();

    <span class="hljs-comment">// ã€ç¬¬ä¸€å±‚ã€‘ä¼˜å…ˆä» orderId è§£æ</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">routeKey</span> <span class="hljs-operator">=</span> orderIdDecoder.decodeRouteKey(orderId);
    <span class="hljs-keyword">if</span> (StringUtils.isEmpty(routeKey)) {
        <span class="hljs-comment">// ã€ç¬¬äºŒå±‚ã€‘å…¶æ¬¡ä»è¯·æ±‚ä¸Šä¸‹æ–‡è·å–</span>
        routeKey = RequestContext.get(<span class="hljs-string">"routeKey"</span>);
    }

    <span class="hljs-keyword">if</span> (StringUtils.isEmpty(routeKey)) {
        <span class="hljs-comment">// ã€ç¬¬ä¸‰å±‚ã€‘æœ€åä» region æ¨æ–­</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">region</span> <span class="hljs-operator">=</span> RequestContext.get(<span class="hljs-string">"region"</span>);
        Optional&lt;String&gt; routeKeyByRegion = DataMappingService.getRouteKey(region);
        routeKey = routeKeyByRegion.orElse(<span class="hljs-string">""</span>);
    }

    <span class="hljs-keyword">return</span> routeKey;
}
</code></pre>
<p><strong>OrderIdDecoder å†…éƒ¨å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderIdDecoder</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">ROUTE_KEY_OFFSET</span> <span class="hljs-operator">=</span> <span class="hljs-number">14</span>;   <span class="hljs-comment">// å³ç§» 14 ä½</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">ROUTE_KEY_MASK</span> <span class="hljs-operator">=</span> <span class="hljs-number">0xF</span>;   <span class="hljs-comment">// ä½ 4 ä½æ©ç ï¼ˆ0b1111ï¼‰</span>

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">decodeRouteKey</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-keyword">if</span> (orderId == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä½è¿ç®—æå– routeKeyï¼ˆbit14-17ï¼Œå³ç§» 14 ä½åå–ä½ 4 ä½ï¼‰</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">routeKeyBits</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)((orderId &gt;&gt; ROUTE_KEY_OFFSET) &amp; ROUTE_KEY_MASK);

            <span class="hljs-comment">// è§£ç ä¸ºå­—ç¬¦ä¸²</span>
            <span class="hljs-keyword">return</span> decodeRouteKeyBits(routeKeyBits);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"è§£æ orderId å¤±è´¥: {}"</span>, orderId, e);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">decodeRouteKeyBits</span><span class="hljs-params">(<span class="hljs-type">int</span> bits)</span> {
        <span class="hljs-keyword">switch</span> (bits) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"EU_CHANNEL"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"GLOBAL_CHANNEL"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"BIZ_CHANNEL"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"CN_CHANNEL"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"CORP_CHANNEL"</span>;
            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <span class="hljs-comment">// è§£æå¤±è´¥</span>
        }
    }
}
</code></pre>
<p><strong>è§£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¤ºä¾‹è®¢å•å·</span>
<span class="hljs-type">Long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> <span class="hljs-number">1234567890123456789L</span>;

<span class="hljs-comment">// ä½è¿ç®—è¿‡ç¨‹ï¼š</span>
<span class="hljs-comment">// 1. å³ç§» 14 ä½ï¼šorderId &gt;&gt; 14</span>
<span class="hljs-comment">// 2. å–ä½ 4 ä½ï¼š&amp; 0xF (0b1111)</span>

<span class="hljs-type">int</span> <span class="hljs-variable">routeKeyBits</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)((orderId &gt;&gt; <span class="hljs-number">14</span>) &amp; <span class="hljs-number">0xF</span>);  <span class="hljs-comment">// æå– routeKey</span>
<span class="hljs-type">String</span> <span class="hljs-variable">routeKey</span> <span class="hljs-operator">=</span> decodeRouteKeyBits(routeKeyBits);  <span class="hljs-comment">// æ˜ å°„ä¸ºæ¸ é“åç§°</span>
</code></pre>
<h3 data-id="heading-12">å››ã€ä¸‰å±‚è·¯ç”±ç­–ç•¥</h3>
<h4 data-id="heading-13">4.1 è®¾è®¡ç†å¿µ</h4>
<p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼šä¸æ˜¯æ‰€æœ‰è®¢å•éƒ½èƒ½è§£ææˆåŠŸ</p>
<ul>
<li>æ–°è®¢å•ï¼šç¼–ç äº† routeKeyï¼Œå¯ä»¥ç›´æ¥è§£æ</li>
<li>è€è®¢å•ï¼šæ²¡æœ‰ç¼–ç ä¿¡æ¯ï¼Œæ— æ³•è§£æ</li>
<li>å¼‚å¸¸æƒ…å†µï¼šè§£æå¤±è´¥ã€æ•°æ®å¼‚å¸¸ç­‰</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä¸‰å±‚è·¯ç”±ç­–ç•¥ï¼ˆé€å±‚é™çº§ï¼‰</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[æŸ¥è¯¢è¯·æ±‚ orderId] --&gt; B{Layer 0: ç¼“å­˜}
    B --&gt;|å‘½ä¸­| C[è¿”å›åˆ†ç‰‡ç´¢å¼•]
    B --&gt;|æœªå‘½ä¸­| D{Layer 1: orderId è§£æ}
    D --&gt;|è§£ææˆåŠŸ| E[è®¡ç®—åˆ†ç‰‡ç´¢å¼•]
    E --&gt; F[å†™å…¥ç¼“å­˜]
    F --&gt; C
    D --&gt;|è§£æå¤±è´¥| G{Layer 2: è¯·æ±‚ä¸Šä¸‹æ–‡}
    G --&gt;|è·å–æˆåŠŸ| E
    G --&gt;|è·å–å¤±è´¥| H{Layer 3: æŸ¥åº“å…œåº•}
    H --&gt;|æŸ¥è¯¢æˆåŠŸ| E
    H --&gt;|æŸ¥è¯¢å¤±è´¥| I[è¿”å›é»˜è®¤åˆ†ç‰‡]
</code></pre>
<p><strong>å„å±‚èŒè´£</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æŸ¥è¯¢è¯·æ±‚ï¼ˆorderIdï¼‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€Layer 0ã€‘ç¼“å­˜å±‚                                            â”‚
â”‚ å‘½ä¸­ â†’ ç›´æ¥è¿”å›åˆ†ç‰‡ç´¢å¼•                                        â”‚
â”‚ æœªå‘½ä¸­ â†’ è¿›å…¥ Layer 1                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€Layer 1ã€‘orderId è§£æå±‚                                     â”‚
â”‚ ä» orderId ä½è¿ç®—æå– routeKey                             â”‚
â”‚ æˆåŠŸ â†’ è®¡ç®—åˆ†ç‰‡ç´¢å¼•ï¼Œå†™å…¥ç¼“å­˜ï¼Œè¿”å›                              â”‚
â”‚ å¤±è´¥ â†’ è¿›å…¥ Layer 2                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€Layer 2ã€‘ä¸Šä¸‹æ–‡è·å–å±‚                                        â”‚
â”‚ ä»è¯·æ±‚ä¸Šä¸‹æ–‡è·å– routeKey / region                             â”‚
â”‚ æˆåŠŸ â†’ è®¡ç®—åˆ†ç‰‡ç´¢å¼•ï¼Œå†™å…¥ç¼“å­˜ï¼Œè¿”å›                              â”‚
â”‚ å¤±è´¥ â†’ è¿›å…¥ Layer 3                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€Layer 3ã€‘æŸ¥åº“å…œåº•å±‚                                         â”‚
â”‚ æŸ¥è¯¢è®¢å•ç´¢å¼•è¡¨è·å–æ¸ é“å­—æ®µ                                      â”‚
â”‚ æˆåŠŸ â†’ è®¡ç®—åˆ†ç‰‡ç´¢å¼•ï¼Œå†™å…¥ç¼“å­˜ï¼Œè¿”å›                              â”‚
â”‚ å¤±è´¥ â†’ è¿”å›é»˜è®¤åˆ†ç‰‡ï¼ˆå…œåº•ï¼‰                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre>
<h4 data-id="heading-14">4.2 å„å±‚å æ¯”ï¼ˆå®é™…æ•°æ®ï¼‰</h4>






























<table><thead><tr><th>è·¯ç”±å±‚</th><th>å æ¯”</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Layer 0ï¼ˆç¼“å­˜ï¼‰</strong></td><td>95%+</td><td>ç»å¤§éƒ¨åˆ†è¯·æ±‚å‘½ä¸­ç¼“å­˜</td></tr><tr><td><strong>Layer 1ï¼ˆorderId è§£æï¼‰</strong></td><td>70-80%</td><td>æ–°è®¢å•ç›´æ¥è§£æ</td></tr><tr><td><strong>Layer 2ï¼ˆä¸Šä¸‹æ–‡ï¼‰</strong></td><td>5-10%</td><td>é“¾è·¯ä¸­æºå¸¦ä¿¡æ¯</td></tr><tr><td><strong>Layer 3ï¼ˆæŸ¥åº“å…œåº•ï¼‰</strong></td><td>15-25%</td><td>è€è®¢å• + å¼‚å¸¸æƒ…å†µ</td></tr></tbody></table>
<p><strong>ç›®æ ‡</strong>ï¼šé€æ­¥é™ä½ Layer 3 å æ¯”ï¼Œæœ€ç»ˆ &lt; 5%</p>
<h3 data-id="heading-15">äº”ã€æ ¸å¿ƒä»£ç å®ç°</h3>
<h4 data-id="heading-16">5.1 ç¼“å­˜å±‚å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShardingCacheHelper</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CACHE_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"shard:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CACHE_EXPIRE_SECONDS</span> <span class="hljs-operator">=</span> <span class="hljs-number">24</span> * <span class="hljs-number">3600</span>;  <span class="hljs-comment">// 24å°æ—¶</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CacheService cacheService;

    <span class="hljs-comment">/**
     * è·å–åˆ†ç‰‡ç´¢å¼•ï¼ˆå¸¦ç¼“å­˜ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getShardIndex</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">cacheKey</span> <span class="hljs-operator">=</span> CACHE_PREFIX + orderId;

        <span class="hljs-comment">// 1. å…ˆæŸ¥ç¼“å­˜</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">cachedValue</span> <span class="hljs-operator">=</span> cacheService.get(cacheKey);
        <span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(cachedValue)) {
            <span class="hljs-keyword">return</span> Integer.parseInt(cachedValue);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <span class="hljs-comment">// ç¼“å­˜æœªå‘½ä¸­</span>
    }

    <span class="hljs-comment">/**
     * å†™å…¥ç¼“å­˜
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setShardIndex</span><span class="hljs-params">(Long orderId, <span class="hljs-type">int</span> shardIndex)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">cacheKey</span> <span class="hljs-operator">=</span> CACHE_PREFIX + orderId;
        cacheService.setEx(cacheKey, String.valueOf(shardIndex), CACHE_EXPIRE_SECONDS);
    }
}
</code></pre>
<h4 data-id="heading-17">5.2 åˆ†ç‰‡å®šä½å™¨å®Œæ•´å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShardingRouter</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SHARD_COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;  <span class="hljs-comment">// æ¯ä¸ªæ¸ é“çš„åˆ†ç‰‡æ•°é‡</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ShardingCacheHelper cacheHelper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderDao orderDao;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChannelShardConfig channelShardConfig;  <span class="hljs-comment">// æ¸ é“åˆ†ç‰‡é…ç½®</span>

    <span class="hljs-comment">/**
     * å®šä½è®¢å•æ‰€åœ¨åˆ†ç‰‡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">locate</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-comment">// ã€Layer 0ã€‘ç¼“å­˜å±‚</span>
        <span class="hljs-type">Integer</span> <span class="hljs-variable">cachedIndex</span> <span class="hljs-operator">=</span> cacheHelper.getShardIndex(orderId);
        <span class="hljs-keyword">if</span> (cachedIndex != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> cachedIndex;
        }

        <span class="hljs-comment">// ã€Layer 1ã€‘orderId è§£æå±‚</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">routeKey</span> <span class="hljs-operator">=</span> getRouteKey(orderId);
        <span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(routeKey)) {
            <span class="hljs-type">int</span> <span class="hljs-variable">shardIndex</span> <span class="hljs-operator">=</span> calculateShardIndex(routeKey, orderId);
            cacheHelper.setShardIndex(orderId, shardIndex);
            <span class="hljs-keyword">return</span> shardIndex;
        }

        <span class="hljs-comment">// ã€Layer 2 &amp; 3ã€‘ä¸Šä¸‹æ–‡ + æŸ¥åº“å…œåº•</span>
        <span class="hljs-keyword">return</span> fallbackLocate(orderId);
    }

    <span class="hljs-comment">/**
     * è®¡ç®—åˆ†ç‰‡ç´¢å¼•
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculateShardIndex</span><span class="hljs-params">(String routeKey, Long orderId)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">baseIndex</span> <span class="hljs-operator">=</span> getBaseIndex(routeKey);
        <span class="hljs-type">int</span> <span class="hljs-variable">offset</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)(orderId % SHARD_COUNT);  <span class="hljs-comment">// åˆ†ç‰‡æ•°é‡</span>
        <span class="hljs-keyword">return</span> baseIndex + offset;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getBaseIndex</span><span class="hljs-params">(String routeKey)</span> {
        <span class="hljs-comment">// ä¸åŒæ¸ é“å¯¹åº”ä¸åŒçš„åˆ†ç‰‡åŸºç¡€ç´¢å¼•</span>
        <span class="hljs-comment">// å…·ä½“æ˜ å°„å…³ç³»æ ¹æ®ä¸šåŠ¡é…ç½®</span>
        <span class="hljs-keyword">return</span> channelShardConfig.getBaseIndex(routeKey);
    }

    <span class="hljs-comment">/**
     * å…œåº•å®šä½ï¼ˆæŸ¥åº“ï¼‰
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">fallbackLocate</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-comment">// 1. æŸ¥è¯¢è®¢å•ç´¢å¼•è¡¨</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderDao.queryById(orderId);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> ShardIndex.OTHER.getIndex();  <span class="hljs-comment">// é»˜è®¤åˆ†ç‰‡</span>
        }

        <span class="hljs-comment">// 2. æ ¹æ®æ¸ é“å­—æ®µè®¡ç®—åˆ†ç‰‡ç´¢å¼•</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> order.getChannel();
        <span class="hljs-type">int</span> <span class="hljs-variable">shardIndex</span> <span class="hljs-operator">=</span> calculateShardIndex(channel, orderId);

        <span class="hljs-comment">// 3. å†™å…¥ç¼“å­˜ï¼ˆé¿å…é‡å¤æŸ¥åº“ï¼‰</span>
        cacheHelper.setShardIndex(orderId, shardIndex);

        <span class="hljs-keyword">return</span> shardIndex;
    }
}
</code></pre>
<h3 data-id="heading-18">å…­ã€è¸©å‘ä¸ç»éªŒ</h3>
<h4 data-id="heading-19">6.1 å®é™…é‡åˆ°çš„é—®é¢˜</h4>
<p><strong>é—®é¢˜ 1ï¼šè°ƒç”¨æ–¹æœªä¼  region å‚æ•°</strong></p>
<p><strong>ç°è±¡</strong>ï¼š</p>
<ul>
<li>ä¸Šçº¿åå‘ç°å…œåº•æŸ¥åº“æ¯”ä¾‹é«˜è¾¾ 25%+</li>
<li>ç›‘æ§æ˜¾ç¤ºå¤§é‡è®¢å•å·è§£æå¤±è´¥</li>
</ul>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li>ID ç”ŸæˆæœåŠ¡å‡çº§åï¼Œéœ€è¦è°ƒç”¨æ–¹ä¼ å…¥ region å‚æ•°</li>
<li>éƒ¨åˆ†è€æ¥å£ã€å®šæ—¶ä»»åŠ¡ã€æ¶ˆæ¯æ¶ˆè´¹è€…æœªåŠæ—¶æ”¹é€ </li>
<li>ç”Ÿæˆçš„è®¢å•å·ä¸­ routeKey ä½æ®µä¸º 0ï¼Œæ— æ³•è§£æ</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. åœ¨ ID ç”ŸæˆæœåŠ¡å¢åŠ ç›‘æ§åŸ‹ç‚¹</span>
<span class="hljs-keyword">if</span> (StringUtils.isEmpty(request.getRegion())) {
    <span class="hljs-comment">// è®°å½•è°ƒç”¨æ¥æºï¼Œä¾¿äºæ¨åŠ¨æ”¹é€ </span>
    metric(<span class="hljs-string">"id_gen_no_region"</span>, getCallerService());
}

<span class="hljs-comment">// 2. è¾“å‡º Top N æœªä¼  region çš„æœåŠ¡ï¼Œé€ä¸ªæ¨åŠ¨æ”¹é€ </span>
<span class="hljs-comment">// 3. è®¾ç½® deadlineï¼Œæœªæ”¹é€ çš„æœåŠ¡é™ä½ä¼˜å…ˆçº§</span>
</code></pre>
<p><strong>é—®é¢˜ 2ï¼šå†å²è®¢å•å…¼å®¹</strong></p>
<p><strong>ç°è±¡</strong>ï¼š</p>
<ul>
<li>æ”¹é€ å‰å·²å­˜åœ¨çš„è®¢å•ï¼ˆç™¾ä¸‡çº§ï¼‰æ— æ³•è§£æ routeKey</li>
<li>è¿™äº›è®¢å•ä»ç„¶æœ‰æŸ¥è¯¢éœ€æ±‚ï¼ˆå”®åã€å¯¹è´¦ç­‰ï¼‰</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>è®¾è®¡ä¸‰å±‚é™çº§ç­–ç•¥ï¼ˆè§ç¬¬å››ç« ï¼‰</li>
<li>å†å²è®¢å•èµ°å…œåº•æŸ¥åº“ + ç¼“å­˜</li>
<li>éšç€æ—¶é—´æ¨ç§»ï¼Œå†å²è®¢å•æŸ¥è¯¢å æ¯”è‡ªç„¶ä¸‹é™</li>
</ul>
<p><strong>é—®é¢˜ 3ï¼šç°åº¦å‘å¸ƒæ—¶çš„æ•°æ®ä¸€è‡´æ€§</strong></p>
<p><strong>ç°è±¡</strong>ï¼š</p>
<ul>
<li>ç°åº¦æœŸé—´ï¼Œéƒ¨åˆ†æœºå™¨ç”¨æ–°ç‰ˆ ID ç”Ÿæˆé€»è¾‘ï¼Œéƒ¨åˆ†ç”¨æ—§ç‰ˆ</li>
<li>åŒä¸€æ¸ é“çš„è®¢å•ï¼Œæœ‰çš„èƒ½è§£æï¼Œæœ‰çš„ä¸èƒ½</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æŒ‰æ¸ é“ç°åº¦ï¼Œè€Œä¸æ˜¯æŒ‰æœºå™¨ç°åº¦</span>
<span class="hljs-comment">// ç¡®ä¿åŒä¸€æ¸ é“çš„è®¢å•è¦ä¹ˆå…¨éƒ¨æ–°ç‰ˆï¼Œè¦ä¹ˆå…¨éƒ¨æ—§ç‰ˆ</span>
<span class="hljs-keyword">if</span> (grayConfig.isNewVersionEnabled(routeKey)) {
    <span class="hljs-keyword">return</span> newIdGenerator.generate(request);
} <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> oldIdGenerator.generate(request);
}
</code></pre>
<h4 data-id="heading-20">6.2 è®¾è®¡æƒè¡¡</h4>
<p><strong>æƒè¡¡ 1ï¼šä¸ºä»€ä¹ˆä¸ç”¨ UUIDï¼Ÿ</strong></p>























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>ç»“è®º</th></tr></thead><tbody><tr><td><strong>UUID</strong></td><td>â€¢ å…¨å±€å”¯ä¸€<br/>â€¢ æ— éœ€åè°ƒ</td><td>â€¢ 128 ä½å¤ªé•¿<br/>â€¢ æ— åºï¼Œå½±å“ B+ æ ‘æ€§èƒ½<br/>â€¢ æ— æ³•ç¼–ç ä¸šåŠ¡ä¿¡æ¯</td><td>âŒ ä¸é‡‡ç”¨</td></tr><tr><td><strong>Snowflake</strong></td><td>â€¢ 64 ä½ç´§å‡‘<br/>â€¢ å•è°ƒé€’å¢<br/>â€¢ å¯ç¼–ç ä¸šåŠ¡ä¿¡æ¯</td><td>â€¢ éœ€è¦åè°ƒæœºå™¨ ID</td><td>âœ… <strong>é‡‡ç”¨</strong></td></tr></tbody></table>
<p><strong>æƒè¡¡ 2ï¼šä¸ºä»€ä¹ˆåªç¼–ç  routeKeyï¼Ÿ</strong></p>
<p><strong>è€ƒè™‘è¿‡çš„æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>æ–¹æ¡ˆ 1ï¼šç¼–ç æ›´å¤šä¿¡æ¯ï¼ˆå›½å®¶ã€ç”¨æˆ·ç±»å‹ã€ä¸šåŠ¡çº¿ç­‰ï¼‰</li>
<li>æ–¹æ¡ˆ 2ï¼šåªç¼–ç æœ€å…³é”®çš„è·¯ç”±ä¿¡æ¯ï¼ˆrouteKeyï¼‰</li>
</ul>
<p><strong>æœ€ç»ˆé€‰æ‹©æ–¹æ¡ˆ 2</strong>ï¼š</p>
<ul>
<li>64 ä½ç©ºé—´æœ‰é™ï¼Œæ¯å¢åŠ  1 ä½ç¼–ç ï¼Œåºåˆ—å·å°±å‡å°‘ 1 ä½</li>
<li>åºåˆ—å·è¶Šå°‘ï¼Œå¹¶å‘æ€§èƒ½è¶Šå·®ï¼ˆåŒä¸€æ¯«ç§’å†…å¯ç”Ÿæˆçš„ ID æ•°é‡ï¼‰</li>
<li>routeKey æ˜¯åˆ†ç‰‡è·¯ç”±çš„å”¯ä¸€ä¾æ®ï¼Œä¼˜å…ˆä¿è¯è·¯ç”±æ€§èƒ½</li>
<li>å…¶ä»–ä¿¡æ¯å¯ä»¥é€šè¿‡æŸ¥è¯¢è®¢å•ç´¢å¼•è¡¨è·å–</li>
</ul>
<p><strong>æƒè¡¡ 3ï¼šä¸ºä»€ä¹ˆä¿ç•™å…œåº•æŸ¥åº“ï¼Ÿ</strong></p>
<p><strong>ç†æƒ³çŠ¶æ€</strong>ï¼š100% è§£ææˆåŠŸï¼Œå®Œå…¨ä¸æŸ¥åº“</p>
<p><strong>ç°å®æƒ…å†µ</strong>ï¼š</p>
<ul>
<li>è€è®¢å•ï¼ˆ10-20%ï¼‰æ— æ³•é¿å…</li>
<li>è€ä»£ç å‡çº§éœ€è¦æ—¶é—´ï¼ˆ5-10%ï¼‰</li>
<li>å¼‚å¸¸æƒ…å†µéš¾ä»¥æœç»ï¼ˆ1-2%ï¼‰</li>
</ul>
<p><strong>æƒè¡¡ç»“æœ</strong>ï¼š</p>
<ul>
<li>âœ… ä¿ç•™å…œåº•æŸ¥åº“ï¼Œç¡®ä¿ç³»ç»Ÿ 100% å¯ç”¨</li>
<li>âœ… é€šè¿‡ç›‘æ§æ¨åŠ¨è§£ææˆåŠŸç‡é€æ­¥æå‡</li>
<li>âœ… ç›®æ ‡ï¼šLayer 3 å æ¯”ä» 25% â†’ 10% â†’ 5% â†’ 1%</li>
</ul>
<h4 data-id="heading-21">6.3 ç›‘æ§ä¸ä¼˜åŒ–</h4>
<p><strong>å…³é”®ç›‘æ§æŒ‡æ ‡</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. è®°å½•è§£æå¤±è´¥çš„è®¢å•å·</span>
metricError(<span class="hljs-string">"orderId_decode_failed"</span>, orderId);

<span class="hljs-comment">// 2. ç»Ÿè®¡å„å±‚è·¯ç”±å æ¯”</span>
metric(<span class="hljs-string">"route_cache_hit"</span>, count);       <span class="hljs-comment">// ç¼“å­˜å‘½ä¸­</span>
metric(<span class="hljs-string">"route_layer_1"</span>, count);         <span class="hljs-comment">// orderId è§£æ</span>
metric(<span class="hljs-string">"route_layer_2"</span>, count);         <span class="hljs-comment">// ä¸Šä¸‹æ–‡è·å–</span>
metric(<span class="hljs-string">"route_layer_3"</span>, count);         <span class="hljs-comment">// æŸ¥åº“å…œåº•</span>

<span class="hljs-comment">// 3. ç»Ÿè®¡è§£æå¤±è´¥åŸå› </span>
metric(<span class="hljs-string">"decode_fail_no_region"</span>, count);    <span class="hljs-comment">// æ²¡ä¼  region</span>
metric(<span class="hljs-string">"decode_fail_old_order"</span>, count); <span class="hljs-comment">// è€è®¢å•</span>
metric(<span class="hljs-string">"decode_fail_exception"</span>, count); <span class="hljs-comment">// è§£æå¼‚å¸¸</span>
</code></pre>
<p><strong>ç›‘æ§é¢æ¿ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">è®¢å•å·è§£ææˆåŠŸç‡ï¼ˆå®æ—¶ï¼‰</span>
<span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">æ€»è¯·æ±‚æ•°:</span> <span class="hljs-number">1</span><span class="hljs-string">,000,000</span>                     <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">ç¼“å­˜å‘½ä¸­:</span> <span class="hljs-number">950</span><span class="hljs-string">,000</span> <span class="hljs-string">(95%)</span>  <span class="hljs-string">âœ…</span>             <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Layer 1:</span>  <span class="hljs-number">750</span><span class="hljs-string">,000</span> <span class="hljs-string">(75%)</span>  <span class="hljs-string">âœ…</span>             <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Layer 2:</span>   <span class="hljs-number">50</span><span class="hljs-string">,000</span> <span class="hljs-string">(5%)</span>   <span class="hljs-string">âœ…</span>             <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Layer 3:</span>  <span class="hljs-number">200</span><span class="hljs-string">,000</span> <span class="hljs-string">(20%)</span>  <span class="hljs-string">âš ï¸</span>             <span class="hljs-string">â”‚</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>

<span class="hljs-string">è§£æå¤±è´¥åŸå› åˆ†å¸ƒ</span>
<span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">æ²¡ä¼ </span> <span class="hljs-attr">region:</span>     <span class="hljs-number">80</span><span class="hljs-string">,000</span> <span class="hljs-string">(8%)</span>   <span class="hljs-string">â¬…ï¸</span> <span class="hljs-string">é‡ç‚¹ä¼˜åŒ–</span> <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">è€è®¢å•:</span>      <span class="hljs-number">110</span><span class="hljs-string">,000</span> <span class="hljs-string">(11%)</span>  <span class="hljs-string">â¬…ï¸</span> <span class="hljs-string">å†å²åŒ…è¢±</span> <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">è§£æå¼‚å¸¸:</span>     <span class="hljs-number">10</span><span class="hljs-string">,000</span> <span class="hljs-string">(1%)</span>   <span class="hljs-string">â¬…ï¸</span> <span class="hljs-string">å¼‚å¸¸æƒ…å†µ</span> <span class="hljs-string">â”‚</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>

<span class="hljs-string">Top</span> <span class="hljs-number">10</span> <span class="hljs-string">æœªä¼ </span> <span class="hljs-string">region</span> <span class="hljs-string">çš„æœåŠ¡</span>
<span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">1. xxx-refund-service:</span>  <span class="hljs-number">25</span><span class="hljs-string">,000</span> <span class="hljs-string">æ¬¡</span>      <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">2. xxx-cancel-job:</span>      <span class="hljs-number">18</span><span class="hljs-string">,000</span> <span class="hljs-string">æ¬¡</span>      <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">3. xxx-sync-task:</span>       <span class="hljs-number">15</span><span class="hljs-string">,000</span> <span class="hljs-string">æ¬¡</span>      <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">...</span>                                    <span class="hljs-string">â”‚</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre>
<p><strong>æŒç»­ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li><strong>é˜¶æ®µ 1</strong>ï¼ˆå½“å‰ï¼‰ï¼šè¯†åˆ«é—®é¢˜ä»£ç ï¼Œåˆ¶å®šè¿ç§»è®¡åˆ’</li>
<li><strong>é˜¶æ®µ 2</strong>ï¼ˆ1-3 ä¸ªæœˆï¼‰ï¼šé€æ­¥å‡çº§è€ä»£ç ï¼ŒLayer 3 å æ¯”é™åˆ° 10%</li>
<li><strong>é˜¶æ®µ 3</strong>ï¼ˆ3-6 ä¸ªæœˆï¼‰ï¼šç»§ç»­ä¼˜åŒ–ï¼ŒLayer 3 å æ¯”é™åˆ° 5%</li>
<li><strong>é˜¶æ®µ 4</strong>ï¼ˆ6-12 ä¸ªæœˆï¼‰ï¼šæœ€ç»ˆç›®æ ‡ï¼ŒLayer 3 å æ¯”é™åˆ° 1% ä»¥ä¸‹</li>
</ul>
<h3 data-id="heading-22">ä¸ƒã€æ€»ç»“</h3>
<h4 data-id="heading-23">æ ¸å¿ƒæ”¶ç›Š</h4>

























<table><thead><tr><th>æŒ‡æ ‡</th><th>ä¼˜åŒ–å‰</th><th>ä¼˜åŒ–å</th></tr></thead><tbody><tr><td>æŸ¥è¯¢è€—æ—¶</td><td>æ•°ç™¾æ¯«ç§’</td><td>ä¸ªä½æ•°æ¯«ç§’</td></tr><tr><td>P99 å»¶è¿Ÿ</td><td>è¶…è¿‡ 1 ç§’</td><td>ç™¾æ¯«ç§’ä»¥å†…</td></tr><tr><td>å…æŸ¥åº“æ¯”ä¾‹</td><td>0%</td><td>95%</td></tr></tbody></table>
<h4 data-id="heading-24">é€‚ç”¨åœºæ™¯</h4>
<p><strong>é€‚åˆ</strong>ï¼šåˆ†åº“åˆ†è¡¨ç³»ç»Ÿã€æœ‰æ˜ç¡®è·¯ç”±ç»´åº¦ã€å¯æ§åˆ¶ ID ç”Ÿæˆé€»è¾‘</p>
<p><strong>ä¸é€‚åˆ</strong>ï¼šå°æ•°æ®é‡ã€è·¯ç”±ç»´åº¦é¢‘ç¹å˜åŒ–ã€ä½¿ç”¨ç¬¬ä¸‰æ–¹ ID æœåŠ¡</p>
<h3 data-id="heading-25">å…«ã€å‚è€ƒèµ„æ–™</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftwitter-archive%2Fsnowflake" target="_blank" title="https://github.com/twitter-archive/snowflake" ref="nofollow noopener noreferrer">Snowflake ç®—æ³• - Twitter</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftech.meituan.com%2F2017%2F04%2F21%2Fmt-leaf.html" target="_blank" title="https://tech.meituan.com/2017/04/21/mt-leaf.html" ref="nofollow noopener noreferrer">åˆ†å¸ƒå¼ ID ç”Ÿæˆæ–¹æ¡ˆ - ç¾å›¢ Leaf</a></li>
</ul>
<hr/>
<p><strong>Carve_the_Code</strong> - å¤§å‹ OTA å¹³å°è®¢å•ç³»ç»Ÿå¼€å‘</p>
<p>æ¬¢è¿ç•™è¨€äº¤æµï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é«˜æ€§èƒ½å¤šçº§ç½‘å…³ä¸å¤šçº§ç¼“å­˜æ¶æ„è½åœ°å®æˆ˜(è¶…æ¸…å®Œç»“)]]></title>    <link>https://juejin.cn/post/7577430671947366426</link>    <guid>https://juejin.cn/post/7577430671947366426</guid>    <pubDate>2025-11-28T07:43:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577430671947366426" data-draft-id="7577430671947350042" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é«˜æ€§èƒ½å¤šçº§ç½‘å…³ä¸å¤šçº§ç¼“å­˜æ¶æ„è½åœ°å®æˆ˜(è¶…æ¸…å®Œç»“)"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-28T07:43:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¯¾ç¨‹xingkeitä¸top"/> <meta itemprop="url" content="https://juejin.cn/user/1910275039560096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é«˜æ€§èƒ½å¤šçº§ç½‘å…³ä¸å¤šçº§ç¼“å­˜æ¶æ„è½åœ°å®æˆ˜(è¶…æ¸…å®Œç»“)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1910275039560096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¯¾ç¨‹xingkeitä¸top
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T07:43:07.000Z" title="Fri Nov 28 2025 07:43:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨äº¿çº§æµé‡ã€æ¯«ç§’çº§å“åº”ã€å…¨çƒåŒ–éƒ¨ç½²æˆä¸ºå¸¸æ€çš„ä»Šå¤©ï¼Œå•ç‚¹æ¶æ„æ—©å·²æ— æ³•æ”¯æ’‘ç°ä»£äº’è”ç½‘ç³»ç»Ÿçš„æ€§èƒ½ä¸å¯ç”¨æ€§è¦æ±‚ã€‚é¢å¯¹çªå‘æµé‡æ´ªå³°ã€åœ°åŸŸè®¿é—®å»¶è¿Ÿã€æœåŠ¡é›ªå´©ç­‰å¤æ‚æŒ‘æˆ˜ï¼Œ<strong>å¤šçº§ç½‘å…³ + å¤šçº§ç¼“å­˜</strong>å·²æˆä¸ºæ„å»ºé«˜å¹¶å‘ã€é«˜å¯ç”¨ç³»ç»Ÿçš„æ ¸å¿ƒæ¶æ„èŒƒå¼ã€‚</p>
<p>æœ¬æ–‡å°†ç³»ç»Ÿæ€§åœ°æ‹†è§£è¿™ä¸€é«˜æ€§èƒ½æ¶æ„ä»<strong>ç†è®ºè®¾è®¡ã€å®æˆ˜è½åœ°åˆ°ç”Ÿäº§ä¼˜åŒ–</strong>çš„å®Œæ•´è·¯å¾„ï¼Œç»“åˆçœŸå®ä¸šåŠ¡åœºæ™¯ï¼Œè¾…ä»¥å°‘é‡å…³é”®ä»£ç ä¸é…ç½®ç¤ºä¾‹ï¼Œå¸®åŠ©æ¶æ„å¸ˆä¸é«˜çº§å·¥ç¨‹å¸ˆæŒæ¡å¯å¤ç”¨çš„å·¥ç¨‹æ–¹æ³•è®ºã€‚</p>
<hr/>
<h3 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦â€œå¤šçº§â€ï¼Ÿâ€”â€” å•ç‚¹æ¶æ„çš„ä¸‰å¤§ç“¶é¢ˆ</h3>
<ol>
<li><strong>æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šå•ä¸ª Nginx æˆ– Redis åœ¨é«˜å¹¶å‘ä¸‹ CPU/å†…å­˜æ‰“æ»¡ï¼›</li>
<li><strong>å®¹ç¾è–„å¼±</strong>ï¼šä»»ä¸€ç»„ä»¶å®•æœºå³å¼•å‘å…¨ç«™ä¸å¯ç”¨ï¼›</li>
<li><strong>ä½“éªŒå‰²è£‚</strong>ï¼šæµ·å¤–ç”¨æˆ·è®¿é—®å›½å†…ä¸­å¿ƒèŠ‚ç‚¹ï¼Œé¦–å±åŠ è½½è¶… 2 ç§’ã€‚</li>
</ol>
<p>â€œå¤šçº§â€ä¸æ˜¯å †ç ŒæŠ€æœ¯ï¼Œè€Œæ˜¯é€šè¿‡<strong>åˆ†å±‚å¸è½½ã€å°±è¿‘å¤„ç†ã€å†—ä½™å®¹é”™</strong>ï¼Œå®ç°æ€§èƒ½ã€å¯ç”¨æ€§ä¸æˆæœ¬çš„æœ€ä¼˜å¹³è¡¡ã€‚</p>
<hr/>
<h3 data-id="heading-1">äºŒã€å¤šçº§ç½‘å…³ï¼šä¸‰å±‚æµé‡æ²»ç†æ¨¡å‹</h3>
<h4 data-id="heading-2">1.Â <strong>L1ï¼šè¾¹ç¼˜ç½‘å…³ï¼ˆEdge Gatewayï¼‰</strong></h4>
<p>éƒ¨ç½²äº CDN è¾¹ç¼˜ï¼ˆå¦‚ Cloudflareã€é˜¿é‡Œäº‘ EdgeScriptï¼‰ï¼Œå¤„ç†é™æ€èµ„æºä¸å®‰å…¨é˜²æŠ¤ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">nginx
ç¼–è¾‘
1<span class="hljs-comment"># ç¤ºä¾‹ï¼šè¾¹ç¼˜ç¼“å­˜é™æ€èµ„æº 1 å¹´</span>
2location ~* .(js|css|png|jpg|woff2)$ {
3    expires 1y<span class="hljs-comment">;</span>
4    add_header Cache-Control "public, immutable"<span class="hljs-comment">;</span>
5}
</code></pre>
<ul>
<li>ç»ˆç»“ 90% é™æ€è¯·æ±‚ï¼Œä¸å›æºï¼›</li>
<li>WAF è§„åˆ™æ‹¦æˆªæ¶æ„çˆ¬è™«ï¼›</li>
<li>æŒ‰ç”¨æˆ· IP è‡ªåŠ¨è·¯ç”±è‡³æœ€è¿‘åŒºåŸŸä¸­å¿ƒã€‚</li>
</ul>
<h4 data-id="heading-3">2.Â <strong>L2ï¼šåŒºåŸŸç½‘å…³ï¼ˆRegional Gatewayï¼‰</strong></h4>
<p>æ¯ä¸ªå¯ç”¨åŒºéƒ¨ç½² Spring Cloud Gatewayï¼Œè´Ÿè´£è®¤è¯ä¸æœ¬åœ°è·¯ç”±ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">yaml</span>
<span class="hljs-string">ç¼–è¾‘</span>
<span class="hljs-number">1</span><span class="hljs-comment"># Spring Cloud Gateway è·¯ç”±é…ç½®</span>
<span class="hljs-attr">2spring:</span>
<span class="hljs-attr">3  cloud:</span>
<span class="hljs-attr">4    gateway:</span>
<span class="hljs-attr">5      routes:</span>
<span class="hljs-attr">6        - id:</span> <span class="hljs-string">video-service</span>
<span class="hljs-attr">7          uri:</span> <span class="hljs-string">lb://video-service</span>
<span class="hljs-attr">8          predicates:</span>
<span class="hljs-number">9</span>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/api/video/**</span>
<span class="hljs-attr">10          filters:</span>
<span class="hljs-number">11</span>            <span class="hljs-bullet">-</span> <span class="hljs-string">TokenAuthFilter</span>  <span class="hljs-comment"># è‡ªå®šä¹‰ JWT æ ¡éªŒ</span>
</code></pre>
<ul>
<li>åŒºåŸŸå†…æœåŠ¡è°ƒç”¨ï¼Œé¿å…è·¨åŒºå»¶è¿Ÿï¼›</li>
<li>ç†”æ–­é™æµï¼ˆé›†æˆ Sentinelï¼‰ï¼›</li>
<li>æ³¨å…¥ TraceIDï¼Œæ”¯æŒå…¨é“¾è·¯è¿½è¸ªã€‚</li>
</ul>
<h4 data-id="heading-4">3.Â <strong>L3ï¼šæ ¸å¿ƒç½‘å…³ï¼ˆBFF Gatewayï¼‰</strong></h4>
<p>èšåˆå¤šä¸ªå¾®æœåŠ¡æ¥å£ï¼Œä¸ºå‰ç«¯æä¾›å®šåˆ¶åŒ–æ•°æ®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">java
ç¼–è¾‘
1// BFF èšåˆç¤ºä¾‹
2public VideoDetailDTO getVideoDetail(Long videoId) {
3    VideoMeta <span class="hljs-attr">meta</span> = videoService.getMeta(videoId)<span class="hljs-comment">;</span>
4    List&lt;Comment&gt; <span class="hljs-attr">comments</span> = commentService.getTopComments(videoId)<span class="hljs-comment">;</span>
5    boolean <span class="hljs-attr">liked</span> = likeService.isLiked(currentUser(), videoId)<span class="hljs-comment">;</span>
6    return new VideoDetailDTO(meta, comments, liked)<span class="hljs-comment">;</span>
7}
</code></pre>
<blockquote>
<p>âœ… ä¼˜åŠ¿ï¼šå‰ç«¯åªéœ€ä¸€æ¬¡è¯·æ±‚ï¼Œåç«¯å¹¶è¡Œè°ƒç”¨ï¼Œé™ä½äº¤äº’æ¬¡æ•°ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">ä¸‰ã€å¤šçº§ç¼“å­˜ï¼šä¸‰å±‚åŠ é€Ÿä½“ç³»</h3>
<h4 data-id="heading-6">1.Â <strong>L1ï¼šæœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰â€”â€” çº³ç§’çº§å“åº”</strong></h4>
<p>é€‚ç”¨äºé«˜é¢‘è¯»ã€ä½å˜æ›´æ•°æ®ï¼ˆå¦‚å­—å…¸ã€é…ç½®ï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">java
ç¼–è¾‘
<span class="hljs-number">1</span>LoadingCache&lt;String, <span class="hljs-selector-tag">Object</span>&gt; localCache = Caffeine<span class="hljs-selector-class">.newBuilder</span>()
<span class="hljs-number">2</span>    <span class="hljs-selector-class">.maximumSize</span>(<span class="hljs-number">1000</span>)
<span class="hljs-number">3</span>    <span class="hljs-selector-class">.expireAfterWrite</span>(<span class="hljs-number">10</span>, TimeUnit.MINUTES)
<span class="hljs-number">4</span>    <span class="hljs-selector-class">.build</span>(key -&gt; loadFromRedis(key));
</code></pre>
<ul>
<li>é›¶ç½‘ç»œå¼€é”€ï¼Œè®¿é—®é€Ÿåº¦è¾¾çº³ç§’çº§ï¼›</li>
<li>éœ€é…åˆä¸»åŠ¨å¤±æ•ˆæœºåˆ¶ï¼ˆå¦‚ç›‘å¬ Redis Pub/Subï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-7">2.Â <strong>L2ï¼šåˆ†å¸ƒå¼ç¼“å­˜ï¼ˆRedis Clusterï¼‰â€”â€” æ¯«ç§’çº§å…±äº«</strong></h4>
<p>å­˜å‚¨ç”¨æˆ·ä¼šè¯ã€è§†é¢‘å…ƒæ•°æ®ã€æ’è¡Œæ¦œç­‰ï¼š</p>
<pre><code class="hljs language-python" lang="python">bash
ç¼–è¾‘
<span class="hljs-number">1</span><span class="hljs-comment"># Redis Sorted Set å­˜å‚¨å¼¹å¹•ï¼ˆæŒ‰æ’­æ”¾æ—¶é—´æ’åºï¼‰</span>
2ZADD danmaku:video_123 <span class="hljs-number">15.234</span> <span class="hljs-string">"{"</span>text<span class="hljs-string">":"</span><span class="hljs-number">666</span><span class="hljs-string">","</span>colo<span class="hljs-string">r":"</span><span class="hljs-comment">#ff0000"}"</span>
</code></pre>
<ul>
<li>æ”¯æŒé«˜ååã€æŒä¹…åŒ–ã€ä¸»ä»é«˜å¯ç”¨ï¼›</li>
<li>å…³é”®ï¼šåˆç†è®¾ç½® TTLï¼Œé¿å…ç¼“å­˜é›ªå´©ã€‚</li>
</ul>
<h4 data-id="heading-8">3.Â <strong>L3ï¼šæŒä¹…å±‚ç¼“å­˜ï¼ˆElasticsearch / ClickHouseï¼‰</strong></h4>
<p>ç”¨äºå¤æ‚æŸ¥è¯¢ç»“æœç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®—ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">sql</span>
ç¼–è¾‘
<span class="hljs-number">1</span><span class="hljs-comment">-- ClickHouse ç‰©åŒ–è§†å›¾é¢„èšåˆæ—¥æ´»</span>
<span class="hljs-number">2</span><span class="hljs-keyword">CREATE</span> MATERIALIZED <span class="hljs-keyword">VIEW</span> daily_active_user
<span class="hljs-number">3</span>ENGINE <span class="hljs-operator">=</span> AggregatingMergeTree()
<span class="hljs-number">4</span><span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span> toDate(event_time) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">day</span>, uniqState(user_id) <span class="hljs-keyword">AS</span> uv
<span class="hljs-number">5</span><span class="hljs-keyword">FROM</span> user_events <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">day</span>;
</code></pre>
<hr/>
<h3 data-id="heading-9">å››ã€ç½‘å…³ä¸ç¼“å­˜çš„æ·±åº¦ååŒ</h3>
<ul>
<li><strong>è¾¹ç¼˜ç½‘å…³ + æµè§ˆå™¨ç¼“å­˜</strong>ï¼šé™æ€èµ„æºä½¿ç”¨Â <code>immutable</code>Â + æ–‡ä»¶å“ˆå¸Œï¼Œå®ç°é«˜æ•ˆæ›´æ–°ï¼›</li>
<li><strong>åŒºåŸŸç½‘å…³ + æœ¬åœ°ç¼“å­˜</strong>ï¼šè®¤è¯åé¢„åŠ è½½ç”¨æˆ·åŸºæœ¬ä¿¡æ¯è‡³ Caffeineï¼›</li>
<li><strong>æ ¸å¿ƒç½‘å…³ + Redis</strong>ï¼šBFF æ¥å£ä¼˜å…ˆæŸ¥ Redisï¼Œå‘½ä¸­åˆ™ç›´æ¥è¿”å›ï¼›</li>
<li><strong>ç¼“å­˜ç©¿é€é˜²æŠ¤</strong>ï¼šç½‘å…³å±‚æ‹¦æˆªéæ³• IDï¼ˆå¦‚Â <code>id=-1</code>ï¼‰ï¼Œç»“åˆå¸ƒéš†è¿‡æ»¤å™¨æå‰è¿‡æ»¤ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-10">äº”ã€ç”Ÿäº§éƒ¨ç½²ä¸å¯è§‚æµ‹æ€§</h3>
<h4 data-id="heading-11">1.Â <strong>å®¹å™¨åŒ–éƒ¨ç½²</strong></h4>
<p>ä½¿ç”¨ Docker Compose ç¼–æ’æ ¸å¿ƒç»„ä»¶ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">yaml</span>
<span class="hljs-string">ç¼–è¾‘</span>
<span class="hljs-attr">1services:</span>
<span class="hljs-attr">2  regional-gateway:</span>
<span class="hljs-attr">3    image:</span> <span class="hljs-string">gateway:latest</span>
<span class="hljs-attr">4    ports:</span> [<span class="hljs-string">"8080:8080"</span>]
<span class="hljs-attr">5    environment:</span>
<span class="hljs-number">6</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">SPRING_PROFILES_ACTIVE=prod</span>
<span class="hljs-attr">7  redis-cluster:</span>
<span class="hljs-attr">8    image:</span> <span class="hljs-string">redis:7</span>
<span class="hljs-attr">9    command:</span> [<span class="hljs-string">"redis-server"</span>, <span class="hljs-string">"--cluster-enabled"</span>, <span class="hljs-string">"yes"</span>]
</code></pre>
<h4 data-id="heading-12">2.Â <strong>å…¨é“¾è·¯ç›‘æ§</strong></h4>
<ul>
<li>Prometheus é‡‡é›†æŒ‡æ ‡ï¼šQPSã€å»¶è¿Ÿã€ç¼“å­˜å‘½ä¸­ç‡ï¼›</li>
<li>Grafana å¯è§†åŒ–ä»ªè¡¨ç›˜ï¼›</li>
<li>ELK æ”¶é›†æ—¥å¿—ï¼Œæ”¯æŒå…³é”®è¯å‘Šè­¦ã€‚</li>
</ul>
<h4 data-id="heading-13">3.Â <strong>æ··æ²Œå·¥ç¨‹éªŒè¯</strong></h4>
<p>å®šæœŸæ¨¡æ‹Ÿ Redis å®•æœºã€ç½‘å…³è¿‡è½½ï¼ŒéªŒè¯ç³»ç»Ÿæ˜¯å¦å…·å¤‡ï¼š</p>
<ul>
<li>è‡ªåŠ¨åˆ‡æ¢ï¼ˆå“¨å…µ/Clusterï¼‰</li>
<li>ä¼˜é›…é™çº§ï¼ˆè¿”å›å…œåº•æ•°æ®ï¼‰</li>
<li>å¿«é€Ÿæ¢å¤ï¼ˆè‡ªåŠ¨é‡å¯ + å¥åº·æ£€æŸ¥ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-14">å…­ã€ä¼˜åŒ–æŠ€å·§æ€»ç»“</h3>





























<table><thead><tr><th>åœºæ™¯</th><th>æŠ€å·§</th></tr></thead><tbody><tr><td><strong>ç¼“å­˜é›ªå´©</strong></td><td>è®¾ç½®éšæœº TTLï¼ˆå¦‚åŸºç¡€å€¼ Â± 10%ï¼‰</td></tr><tr><td><strong>ç¼“å­˜ç©¿é€</strong></td><td>å¸ƒéš†è¿‡æ»¤å™¨ + ç©ºå€¼ç¼“å­˜ï¼ˆTTL çŸ­ï¼‰</td></tr><tr><td><strong>çƒ­ç‚¹ Key</strong></td><td>æœ¬åœ°ç¼“å­˜ + å¤šå‰¯æœ¬åˆ†æ•£å‹åŠ›</td></tr><tr><td><strong>å¤§ Value</strong></td><td>å‹ç¼©å­˜å‚¨ï¼ˆå¦‚ Snappyï¼‰æˆ–æ‹†åˆ†ä¸ºå¤šä¸ª Key</td></tr><tr><td><strong>ç½‘å…³æ€§èƒ½</strong></td><td>å¼‚æ­¥éé˜»å¡ï¼ˆReactor æ¨¡å‹ï¼‰ã€è¿æ¥æ± å¤ç”¨</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-15">ä¸ƒã€ç»“è¯­ï¼šæ¶æ„å³å–èˆï¼Œå¤šçº§å³å¹³è¡¡</h3>
<p>å¤šçº§ç½‘å…³ä¸å¤šçº§ç¼“å­˜å¹¶éâ€œé“¶å¼¹â€ï¼Œå…¶æˆåŠŸä¾èµ–ä¸‰å¤§åŸåˆ™ï¼š</p>
<ol>
<li><strong>æŒ‰éœ€åˆ†å±‚</strong>ï¼šå°å‹ç³»ç»Ÿå¯èƒ½åªéœ€ä¸€çº§ï¼›</li>
<li><strong>ä¸€è‡´æ€§åˆ†çº§</strong>ï¼šæ˜ç¡®å“ªäº›æ•°æ®å¯å®¹å¿çŸ­æš‚ä¸ä¸€è‡´ï¼›</li>
<li><strong>è¿ç»´å…ˆè¡Œ</strong>ï¼šæ¶æ„è¶Šå¤æ‚ï¼Œå¯¹ç›‘æ§ã€å‘Šè­¦ã€è‡ªæ„ˆèƒ½åŠ›è¦æ±‚è¶Šé«˜ã€‚</li>
</ol>
<p>æŒæ¡è¿™å¥—ä»ç†è®ºåˆ°éƒ¨ç½²çš„å®Œæ•´æ–¹æ³•è®ºï¼Œä½ ä¾¿æ‹¥æœ‰äº†æ„å»ºä¸‹ä¸€ä»£é«˜å¯ç”¨ç³»ç»Ÿçš„â€œæ¶æ„ç½—ç›˜â€ã€‚<br/>
<strong>è¶…æ¸…å®Œç»“ï¼Œä½†æ¢ç´¢ä¸æ­¢â€”â€”è¿™ä¸ä»…æ˜¯ä¸€ä¸ªæ–¹æ¡ˆçš„ç»ˆç‚¹ï¼Œæ›´æ˜¯ä½ é©¾é©­äº¿çº§æµé‡çš„æ–°èµ·ç‚¹ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot2 ä»¿Bç«™é«˜æ€§èƒ½å‰ç«¯+åç«¯é¡¹ç›®(å®Œç»“)]]></title>    <link>https://juejin.cn/post/7577438119558332467</link>    <guid>https://juejin.cn/post/7577438119558332467</guid>    <pubDate>2025-11-28T07:34:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577438119558332467" data-draft-id="7577438119558316083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot2 ä»¿Bç«™é«˜æ€§èƒ½å‰ç«¯+åç«¯é¡¹ç›®(å®Œç»“)"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-28T07:34:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¯¾ç¨‹xingkeitä¸top"/> <meta itemprop="url" content="https://juejin.cn/user/1910275039560096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot2 ä»¿Bç«™é«˜æ€§èƒ½å‰ç«¯+åç«¯é¡¹ç›®(å®Œç»“)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1910275039560096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¯¾ç¨‹xingkeitä¸top
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T07:34:41.000Z" title="Fri Nov 28 2025 07:34:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å…¨æ ˆå¼€å‘èƒ½åŠ›æ—¥ç›Šæˆä¸ºå·¥ç¨‹å¸ˆæ ¸å¿ƒç«äº‰åŠ›çš„ä»Šå¤©ï¼Œä¸€ä¸ªè´´è¿‘çœŸå®ä¸šåŠ¡ã€æ¶µç›–é«˜å¹¶å‘ä¸å¼ºäº¤äº’åœºæ™¯çš„ç»¼åˆæ€§é¡¹ç›®ï¼Œæ— ç–‘æ˜¯æŠ€æœ¯æˆé•¿çš„æœ€ä½³è½½ä½“ã€‚Bilibiliï¼ˆBç«™ï¼‰ä½œä¸ºé›†è§†é¢‘æ’­æ”¾ã€å¼¹å¹•äº’åŠ¨ã€ç¤¾åŒºç¤¾äº¤äºä¸€ä½“çš„å¤æ‚å¹³å°ï¼Œå…¶äº§å“å½¢æ€å’ŒæŠ€æœ¯æŒ‘æˆ˜æå…·ä»£è¡¨æ€§ã€‚</p>
<p>æœ¬æ–‡å°†ç³»ç»Ÿæ¢³ç†ä¸€ä¸ªåŸºäº <strong>Spring Boot 2 + Vue 3</strong> çš„ä»¿ B ç«™é¡¹ç›®ï¼Œä»<strong>éœ€æ±‚åˆ†æã€æ¶æ„è®¾è®¡ã€æ ¸å¿ƒåŠŸèƒ½å®ç°åˆ°éƒ¨ç½²ä¸Šçº¿</strong>çš„å®Œæ•´é—­ç¯ã€‚å…¨æ–‡ä»¥å·¥ç¨‹å®è·µä¸ºå¯¼å‘ï¼Œè¾…ä»¥å°‘é‡å…³é”®ä»£ç ç‰‡æ®µï¼Œå¸®åŠ©å¼€å‘è€…ç†è§£â€œå¦‚ä½•æŠŠæƒ³æ³•å˜æˆå¯è¿è¡Œã€å¯ç»´æŠ¤ã€å¯æ‰©å±•çš„äº§å“â€ã€‚</p>
<hr/>
<h3 data-id="heading-0">ä¸€ã€éœ€æ±‚æ‹†è§£ï¼šèšç„¦ MVP æ ¸å¿ƒä½“éªŒ</h3>
<p>é¡¹ç›®åˆæœŸæ˜ç¡®æœ€å°å¯è¡Œäº§å“ï¼ˆMVPï¼‰èŒƒå›´ï¼Œé¿å…è¿‡åº¦è®¾è®¡ï¼š</p>
<ul>
<li>ç”¨æˆ·æ³¨å†Œ/ç™»å½•ï¼ˆå« JWT é‰´æƒï¼‰</li>
<li>è§†é¢‘ä¸Šä¼ ã€è½¬ç ã€å¤šæ¸…æ™°åº¦æ’­æ”¾</li>
<li>å®æ—¶å¼¹å¹•äº’åŠ¨</li>
<li>ç‚¹èµã€æŠ•å¸ã€æ”¶è—ã€è¯„è®º</li>
<li>é¦–é¡µæ¨è + åˆ†åŒºæµè§ˆ + æœç´¢</li>
<li>ä¸ªäººä¸­å¿ƒä¸ UP ä¸»ä¸»é¡µ</li>
</ul>
<p>è¿™äº›æ¨¡å—è¦†ç›–äº†å†…å®¹ç”Ÿäº§ã€æ¶ˆè´¹ã€äº’åŠ¨ä¸‰å¤§æ ¸å¿ƒé“¾è·¯ï¼Œæ„æˆå®Œæ•´çš„ç”¨æˆ·é—­ç¯ã€‚</p>
<hr/>
<h3 data-id="heading-1">äºŒã€æ•´ä½“æ¶æ„ï¼šå‰åç«¯åˆ†ç¦» + æ¨¡å—åŒ–è®¾è®¡</h3>
<p>åç«¯é‡‡ç”¨ Spring Boot 2ï¼Œæ•´åˆä¸»æµä¸­é—´ä»¶ï¼›å‰ç«¯åŸºäº Vue 3 + TypeScript + Vite æ„å»º SPAã€‚è™½æœªå®Œå…¨å¾®æœåŠ¡åŒ–ï¼Œä½†æŒ‰ä¸šåŠ¡åŸŸåˆ’åˆ†ä¸ºæ¸…æ™°æ¨¡å—ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">text
ç¼–è¾‘
<span class="hljs-number">1b</span>ackend/
<span class="hljs-number">2</span>â”œâ”€â”€ user-service      <span class="hljs-comment">// ç”¨æˆ·ä¸­å¿ƒ</span>
<span class="hljs-number">3</span>â”œâ”€â”€ video-service     <span class="hljs-comment">// è§†é¢‘ç®¡ç†</span>
<span class="hljs-number">4</span>â”œâ”€â”€ interact-service  <span class="hljs-comment">// äº’åŠ¨è¡Œä¸º</span>
<span class="hljs-number">5</span>â”œâ”€â”€ search-service    <span class="hljs-comment">// æœç´¢ä¸æ¨è</span>
<span class="hljs-number">6</span>â””â”€â”€ gateway           <span class="hljs-comment">// ç»Ÿä¸€ç½‘å…³ï¼ˆè·¯ç”± + è®¤è¯ï¼‰</span>
<span class="hljs-number">7</span>
<span class="hljs-number">8f</span>rontend/
<span class="hljs-number">9</span>â”œâ”€â”€ views/
<span class="hljs-number">10</span>â”‚   â”œâ”€â”€ Home.vue
<span class="hljs-number">11</span>â”‚   â”œâ”€â”€ VideoDetail.vue
<span class="hljs-number">12</span>â”‚   â””â”€â”€ UserCenter.vue
<span class="hljs-number">13</span>â”œâ”€â”€ api/              <span class="hljs-comment">// æ¥å£å°è£…</span>
<span class="hljs-number">14</span>â””â”€â”€ store/            <span class="hljs-comment">// Pinia çŠ¶æ€ç®¡ç†</span>
</code></pre>
<p>è¿™ç§ç»“æ„ä¾¿äºå›¢é˜Ÿåä½œï¼Œä¹Ÿä¸ºæœªæ¥æ¼”è¿›é¢„ç•™ç©ºé—´ã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸‰ã€å…³é”®åŠŸèƒ½å®ç°é€»è¾‘ï¼ˆé™„å°‘é‡ä»£ç ï¼‰</h3>
<h4 data-id="heading-3">1.Â <strong>JWT æ— çŠ¶æ€è®¤è¯</strong></h4>
<p>åç«¯ç”Ÿæˆ Tokenï¼Œå‰ç«¯æ‹¦æˆªå™¨è‡ªåŠ¨æºå¸¦ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">java
ç¼–è¾‘
<span class="hljs-number">1</span><span class="hljs-comment">// åç«¯ï¼šç”Ÿæˆ Token</span>
<span class="hljs-number">2S</span>tring token = Jwts<span class="hljs-selector-class">.builder</span>()
<span class="hljs-number">3</span>    <span class="hljs-selector-class">.setSubject</span>(userId.toString())
<span class="hljs-number">4</span>    <span class="hljs-selector-class">.setExpiration</span>(new Date(System.currentTimeMillis() + <span class="hljs-number">86400000</span>))
<span class="hljs-number">5</span>    <span class="hljs-selector-class">.signWith</span>(SignatureAlgorithm.HS512, "secret-key")
<span class="hljs-number">6</span>    <span class="hljs-selector-class">.compact</span>();
</code></pre>
<pre><code class="hljs language-ini" lang="ini">javascript
ç¼–è¾‘
1// å‰ç«¯ Axios æ‹¦æˆªå™¨
2axios.interceptors.request.use(<span class="hljs-attr">config</span> =&gt; {
3  const <span class="hljs-attr">token</span> = localStorage.getItem(<span class="hljs-string">'token'</span>)<span class="hljs-comment">;</span>
4  if (token) <span class="hljs-attr">config.headers.Authorization</span> = `Bearer <span class="hljs-variable">${token}</span>`<span class="hljs-comment">;</span>
5  return config<span class="hljs-comment">;</span>
6})<span class="hljs-comment">;</span>
</code></pre>
<blockquote>
<p>âœ… ä¼˜åŠ¿ï¼šæ—  Session çŠ¶æ€ï¼Œå¤©ç„¶æ”¯æŒæ°´å¹³æ‰©å±•ã€‚</p>
</blockquote>
<h4 data-id="heading-4">2.Â <strong>åˆ†ç‰‡ä¸Šä¼  + æ–­ç‚¹ç»­ä¼ </strong></h4>
<p>å‰ç«¯è®¡ç®—æ–‡ä»¶ hashï¼ŒæŒ‰ 5MB åˆ†ç‰‡ä¸Šä¼ ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">javascript
ç¼–è¾‘
1const <span class="hljs-attr">chunkSize</span> = <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span><span class="hljs-comment">;</span>
2for (let <span class="hljs-attr">start</span> = <span class="hljs-number">0</span><span class="hljs-comment">; start &lt; file.size; start += chunkSize) {</span>
3  const <span class="hljs-attr">chunk</span> = file.slice(start, start + chunkSize)<span class="hljs-comment">;</span>
4  await uploadChunk(chunk, index++, fileHash)<span class="hljs-comment">;</span>
5}
</code></pre>
<p>åç«¯åˆå¹¶åˆ†ç‰‡å¹¶è§¦å‘å¼‚æ­¥è½¬ç ä»»åŠ¡ï¼ˆé€šè¿‡ RabbitMQ è§£è€¦ï¼‰ã€‚</p>
<h4 data-id="heading-5">3.Â <strong>å®æ—¶å¼¹å¹•ï¼ˆWebSocket + Redisï¼‰</strong></h4>
<p>åç«¯ä½¿ç”¨ <code>@ServerEndpoint</code> å»ºç«‹è¿æ¥ï¼Œå¼¹å¹•å­˜å…¥ Redis Sorted Setï¼ˆæŒ‰è§†é¢‘æ—¶é—´æˆ³æ’åºï¼‰ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">java
ç¼–è¾‘
<span class="hljs-number">1</span><span class="hljs-comment">// å¼¹å¹•å­˜å‚¨ï¼švideoId ä¸º keyï¼Œtime ä¸º score</span>
<span class="hljs-number">2</span>redisTemplate.opsForZSet().<span class="hljs-keyword">add</span>(<span class="hljs-string">"danmaku:"</span> + videoId, danmakuJson, playTime);
</code></pre>
<p>å‰ç«¯é€šè¿‡ WebSocket æ¥æ”¶å¹¶æ¸²æŸ“ï¼Œç¡®ä¿ä½å»¶è¿Ÿå±•ç¤ºã€‚</p>
<h4 data-id="heading-6">4.Â <strong>äº’åŠ¨æ“ä½œçš„ä¹è§‚æ›´æ–°</strong></h4>
<p>ç”¨æˆ·ç‚¹å‡»â€œç‚¹èµâ€åï¼Œå‰ç«¯ç«‹å³æ›´æ–° UI å¹¶å‘é€è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">javascript
ç¼–è¾‘
1// å‰ç«¯ä¹è§‚æ›´æ–°
2video.likeCount++<span class="hljs-comment">;</span>
<span class="hljs-attr">3video.liked</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
4
5// å‘é€è¯·æ±‚ï¼Œå¤±è´¥åˆ™å›æ»š
6api.like(video.id).catch(() =&gt; {
7  video.likeCount--<span class="hljs-comment">;</span>
8  <span class="hljs-attr">video.liked</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
9})<span class="hljs-comment">;</span>
</code></pre>
<p>åç«¯é‡‡ç”¨ Redis è®¡æ•°å™¨ + å¼‚æ­¥æŒä¹…åŒ–ï¼Œä¿éšœé«˜æ€§èƒ½ã€‚</p>
<hr/>
<h3 data-id="heading-7">å››ã€æ€§èƒ½ä¸ä½“éªŒä¼˜åŒ–</h3>
<ul>
<li><strong>å¤šçº§ç¼“å­˜</strong>ï¼šCaffeineï¼ˆæœ¬åœ°ï¼‰ + Redisï¼ˆåˆ†å¸ƒå¼ï¼‰ + æµè§ˆå™¨ç¼“å­˜ï¼›</li>
<li><strong>é™æ€èµ„æº CDN</strong>ï¼šJS/CSS/å›¾ç‰‡éƒ¨ç½²è‡³ CDNï¼Œè§†é¢‘é€šè¿‡å¯¹è±¡å­˜å‚¨ + CDN åŠ é€Ÿï¼›</li>
<li><strong>æ¥å£èšåˆ</strong>ï¼šæ ¸å¿ƒç½‘å…³æä¾› BFF æ¥å£ï¼Œå‡å°‘å‰ç«¯å¤šæ¬¡è¯·æ±‚ï¼›</li>
<li><strong>è™šæ‹Ÿæ»šåŠ¨</strong>ï¼šé•¿è¯„è®ºåˆ—è¡¨ä»…æ¸²æŸ“å¯è§†åŒºåŸŸï¼Œæå‡æµç•…åº¦ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-8">äº”ã€éƒ¨ç½²ä¸è¿ç»´ï¼šä»æœ¬åœ°åˆ°ç”Ÿäº§</h3>
<ul>
<li><strong>å®¹å™¨åŒ–</strong>ï¼šDocker æ‰“åŒ… Spring Boot åº”ç”¨ä¸ Vue å‰ç«¯ï¼›</li>
<li><strong>ç¼–æ’</strong>ï¼šdocker-compose ç®¡ç† MySQLã€Redisã€RabbitMQã€Nginxï¼›</li>
<li><strong>CI/CD</strong>ï¼šGit æäº¤ â†’ Jenkins è‡ªåŠ¨æ„å»º â†’ é•œåƒæ¨é€ â†’ å®¹å™¨é‡å¯ï¼›</li>
<li><strong>ç›‘æ§</strong>ï¼šPrometheus + Grafana ç›‘æ§ JVMã€HTTP å»¶è¿Ÿã€é˜Ÿåˆ—å †ç§¯ã€‚</li>
</ul>
<p>Nginx é…ç½®ç¤ºä¾‹ï¼ˆåå‘ä»£ç† + é™æ€èµ„æºï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">nginx
ç¼–è¾‘
1location /api {
2    proxy_pass http://backend:8080;
3}
4
5location / {
6    root /usr/share/nginx/html;
7    try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;
8}
</code></pre>
<hr/>
<h3 data-id="heading-9">å…­ã€æ€»ç»“ï¼šå…¨æ ˆä¸ä»…æ˜¯â€œä¼šå†™â€ï¼Œæ›´æ˜¯â€œä¼šæƒ³â€</h3>
<p>è¿™ä¸ªä»¿ B ç«™é¡¹ç›®çš„ä»·å€¼ï¼Œè¿œä¸æ­¢äºå¤åˆ»ä¸€ä¸ªè§†é¢‘å¹³å°ã€‚å®ƒè®­ç»ƒçš„æ˜¯<strong>ç«¯åˆ°ç«¯çš„ç³»ç»Ÿæ€ç»´</strong>ï¼š</p>
<ul>
<li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ—¢å®‰å…¨åˆæ˜“ç”¨çš„ APIï¼Ÿ</li>
<li>å¦‚ä½•åœ¨ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„åŒæ—¶æå‡ç”¨æˆ·ä½“éªŒï¼Ÿ</li>
<li>å¦‚ä½•è®©å‰åç«¯åœ¨é«˜é€Ÿè¿­ä»£ä¸­ä¿æŒåŒæ­¥è€Œä¸äº’ç›¸é˜»å¡ï¼Ÿ</li>
</ul>
<p>çœŸæ­£çš„å…¨æ ˆå·¥ç¨‹å¸ˆï¼Œä¸æ˜¯å‰åç«¯éƒ½ä¼šå†™ï¼Œè€Œæ˜¯<strong>ç†è§£æ•°æ®å¦‚ä½•æµåŠ¨ã€ç”¨æˆ·å¦‚ä½•æ„ŸçŸ¥ã€ç³»ç»Ÿå¦‚ä½•æ¼”è¿›</strong>ã€‚</p>
<hr/>
<p><strong>ç»“è¯­</strong><br/>
é¡¹ç›®å®Œç»“ï¼Œä½†æˆé•¿ä¸æ­¢ã€‚ä»ä¸€è¡Œéœ€æ±‚åˆ°çº¿ä¸ŠæœåŠ¡ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯å·¥ç¨‹èƒ½åŠ›çš„é”¤ç‚¼ã€‚æ”¶è—æœ¬æ–‡ï¼Œä¸ä»…æ˜¯æ”¶è—ä¸€ä¸ªå®æˆ˜æ¡ˆä¾‹ï¼Œæ›´æ˜¯æ”¶è—ä¸€å¥—ä»æƒ³æ³•åˆ°äº§å“çš„å®Œæ•´æ–¹æ³•è®ºâ€”â€”è¿™ï¼Œæ‰æ˜¯å¼€å‘è€…æœ€å®è´µçš„èµ„äº§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[viteè”é‚¦å®ç°å¾®å‰ç«¯ï¼ˆvite-plugin-federationï¼‰]]></title>    <link>https://juejin.cn/post/7577563004481470518</link>    <guid>https://juejin.cn/post/7577563004481470518</guid>    <pubDate>2025-11-28T07:18:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577563004481470518" data-draft-id="7577411657393094698" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="viteè”é‚¦å®ç°å¾®å‰ç«¯ï¼ˆvite-plugin-federationï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2025-11-28T07:18:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸åŠªåŠ›ä¹Ÿä¸ä¼šæ··"/> <meta itemprop="url" content="https://juejin.cn/user/1869583715670808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            viteè”é‚¦å®ç°å¾®å‰ç«¯ï¼ˆvite-plugin-federationï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1869583715670808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸åŠªåŠ›ä¹Ÿä¸ä¼šæ··
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T07:18:15.000Z" title="Fri Nov 28 2025 07:18:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä½¿ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foriginjs%2Fvite-plugin-federation" target="_blank" title="https://github.com/originjs/vite-plugin-federation" ref="nofollow noopener noreferrer">vite-plugin-federation</a>å®ç°å¾®å‰ç«¯çš„æ­å»ºå¼€å‘</h2>
<h3 data-id="heading-1">ä½¿ç”¨èƒŒæ™¯</h3>
<blockquote>
<p>è€æ¿è¯´äº†ï¼Œé¡¹ç›®æ¯”è¾ƒå¤§ï¼Œä¸å¥½ç»´æŠ¤è¦æ‹†åˆ†æˆå¤šä¸ªå­é¡¹ç›®ï¼Œè¿™æ ·æ¯æ¬¡ç»´æŠ¤å‘åŒ…æ—¶å€™åŠæ—¶æŠ¥é”™äº†ä¹Ÿä¸ä¼šå½±å“å…¶ä»–çš„é¡¹ç›®(æˆ‘ç°åœ¨ç”¨çš„æ˜¯microappï¼Œå› ä¸ºä¹‹å‰ä»–ä»¬ç”¨çš„iframeæ‹†åˆ†äº†ï¼Œåªæœ‰å¼¹æ¡†é—®é¢˜ä¸å¥½è§£å†³ï¼Œç”¨microappæ”¹é€ ä¸‹æ˜¯æœ€å¿«çš„ï¼Œæ’ä»¶é‚£å—microappåµŒå¥—æŠ¥é”™ç”¨äº†è”é‚¦å®ç°äº†)ã€‚</p>
</blockquote>
<p>æ³¨æ„ï¼šè”é‚¦æ­å»ºå¾®å‰ç«¯é€‚åˆæ–°é¡¹ç›®ï¼Œå¦‚æœå·²ç»æœ‰ç”¨iframeæ‹†åˆ†å®ç°å¾®å‰ç«¯è¿‡çš„è€é¡¹ç›®è¿˜æ˜¯ç”¨microappæ¯”è¾ƒå¥½ï¼Œå•¥éƒ½ä¸ç”¨æ”¹ç›´æ¥å¼•å…¥å°±èƒ½å®ç°å¾®å‰ç«¯ã€‚</p>
<ul>
<li>å®˜æ–¹æè¿°çš„æ˜¯å»ä¸­å¿ƒç”»ï¼Œæˆ‘è¿˜æ˜¯æŒ‰ç…§è€æ¿ç°åœ¨æƒ³æ³•å®ç°1+n+nï¼Œ</li>
</ul>
<ol>
<li>1ä¸ªæ¡†æ¶ï¼ˆç™»å½•ï¼Œæ¥å£å°è£…ï¼Œlayoutå¸ƒå±€ç­‰ï¼‰åªè¦æ­å»ºå¥½åŸºæœ¬ä¸Šä¸ä¼šåœ¨æ”¹çš„ï¼ˆæ–°å¼€é¡¹ç›®è¿™ä¸ªä¹Ÿç›´æ¥èƒ½æ‹¿å»ç”¨ï¼‰</li>
<li>nä¸ªåº”ç”¨ï¼ˆå¤§å±ï¼Œå¤šä¸ªåå°ç®¡ç†æ¨¡å—ï¼‰å°±æ˜¯æ”¹åŠ¨ç›¸å¯¹è¾ƒå°‘çš„</li>
<li>nä¸ªæ’ä»¶ï¼ˆè¦ç»™ä¸åŒå®¢æˆ·éƒ¨ç½²ï¼Œä»–ä»¬éƒ½ä¼šæè‡ªå·±éœ€æ±‚ï¼Œä¾‹å¦‚å¤§å±çš„æŸå—å±•ç¤ºï¼Œå®¢æˆ·ä¸ææˆ‘ä»¬å°±å±•ç¤ºé»˜è®¤çš„ï¼Œå®¢æˆ·æäº†å°±æ¸²æŸ“ä»–ä»¬ä¸ªæ€§åŒ–çš„å†…å®¹ï¼‰</li>
</ol>
<h3 data-id="heading-2">ä½¿ç”¨æ–¹æ³•</h3>
<ol>
<li>é¦–å…ˆåˆ›å»ºä¸¤ä¸ªé¡¹ç›®ï¼šbaseï¼Œè¿è¥ç®¡ç† å…¨æ˜¯vite+vue3 <code>pnpm create vue</code></li>
<li>å®‰è£…è”é‚¦<code>pnpm add @originjs/vite-plugin-federation --save-dev</code></li>
<li>å®˜æ–¹ä½¿ç”¨æ–¹æ³•</li>
<li>
<div>baseé¡¹ç›®å¯ä»¥devå¯åŠ¨ï¼Œè¿è¥ç®¡ç†å¿…é¡»buildä¹‹åç”¨previewé¢„è§ˆ</div>
</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.js è¿è¥ç®¡ç†</span>
<span class="hljs-keyword">import</span> federation <span class="hljs-keyword">from</span> <span class="hljs-string">"@originjs/vite-plugin-federation"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-title function_">federation</span>({
            <span class="hljs-attr">name</span>: <span class="hljs-string">'remote-app'</span>,
            <span class="hljs-attr">filename</span>: <span class="hljs-string">'remoteEntry.js'</span>,
            <span class="hljs-comment">// Modules to expose</span>
            <span class="hljs-attr">exposes</span>: {
                <span class="hljs-string">'./Button'</span>: <span class="hljs-string">'./src/Button.vue'</span>,
            },
            <span class="hljs-attr">shared</span>: [<span class="hljs-string">'vue'</span>]
        })
    ]
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.js baseé¡¹ç›®</span>
<span class="hljs-keyword">import</span> federation <span class="hljs-keyword">from</span> <span class="hljs-string">"@originjs/vite-plugin-federation"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-title function_">federation</span>({
            <span class="hljs-attr">name</span>: <span class="hljs-string">'host-app'</span>,
            <span class="hljs-attr">remotes</span>: {
                <span class="hljs-attr">remote_app</span>: <span class="hljs-string">"http://localhost:5001/assets/remoteEntry.js"</span>,
            },
            <span class="hljs-attr">shared</span>: [<span class="hljs-string">'vue'</span>]
        })
    ]
}
</code></pre>
<pre><code class="hljs language-vue" lang="vue">// é¡µé¢ä½¿ç”¨
const RemoteButton = defineAsyncComponent(() =&gt; import("remote_app/Button"));
&lt;template&gt;
    &lt;div&gt;
        &lt;RemoteButton /&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-3">æ¨èä½¿ç”¨æ–¹æ³•ï¼ˆè¶…çº§å‘ï¼šä»–ä»¬ä¸­æ–‡æ–‡æ¡£æ²¡æœ‰ä»‹ç»ï¼Œæ‰¾äº†å¥½ä¹…å‘ç°å†™åœ¨äº†è‹±æ–‡æ–‡æ¡£çš„æœ€ä¸‹é¢ï¼‰</h3>
<p>ç”¨ä¸Šé¢è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨åšå®šåˆ¶åŒ–æ—¶å€™ï¼Œä¸å¥½ç”¨ï¼Œä¾‹å¦‚åå°é…ç½®ä¸ªæ€§åŒ–æ¥å£æ—¶å€™ï¼Œå‰ç«¯è‡ªåŠ¨é€šè¿‡æ¥å£å±•ç¤ºå¯¹åº”çš„ä¸ªæ€§åŒ–ã€‚æ‰€ä»¥éœ€è¦æœ‰ä¸ªèƒ½å¤ŸåŠ¨æ€åŠ è½½ç»„ä»¶æ–¹æ³•ã€‚</p>
<p>è¿è¥ç®¡ç†é‚£å—å¯¼å‡ºä¸ç”¨ä¿®æ”¹ï¼Œbaseçš„å¯¼å…¥æ–¹å¼éœ€è¦ä¿®æ”¹ä¸‹</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.js baseé¡¹ç›®</span>
<span class="hljs-title function_">federation</span>({
  <span class="hljs-attr">remotes</span>:{
    <span class="hljs-string">"None"</span>: <span class="hljs-string">""</span> <span class="hljs-comment">//è¿™ä¸ªä¸åŠ å°±æŠ¥é”™ï¼Œä»–ä»¬issuesé‡Œæ‰¾åˆ°çš„åˆ«äººçš„è§£å†³åŠæ³•</span>
  },
  <span class="hljs-attr">shared</span>: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'pinia'</span>, <span class="hljs-string">'vue-router'</span>],
}),

</code></pre>
<p>å…ˆå®šä¸€ä¸ªå…¬å…±çš„utilæ–¹æ³•è·å–åŠ¨æ€ç»„ä»¶å’Œæ–¹æ³•</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//util.ts</span>
<span class="hljs-keyword">import</span> {
  __federation_method_getRemote <span class="hljs-keyword">as</span> getRemote,
  __federation_method_setRemote <span class="hljs-keyword">as</span> setRemote,
  __federation_method_unwrapDefault <span class="hljs-keyword">as</span> unwrap,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'virtual:__federation__'</span>

interface <span class="hljs-title class_">RemoteOptions</span> {
  <span class="hljs-attr">url</span>: string
  <span class="hljs-attr">moduleName</span>: string,
  type?: <span class="hljs-string">'ts'</span> | <span class="hljs-string">'component'</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getRemoteComponent = <span class="hljs-keyword">async</span> (<span class="hljs-attr">options</span>: <span class="hljs-title class_">RemoteOptions</span>): <span class="hljs-title class_">Promise</span>&lt;any&gt; =&gt; {
  <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> { url, moduleName, type = <span class="hljs-string">'component'</span> } = options
      <span class="hljs-keyword">const</span> remoteName = <span class="hljs-string">`remote_<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random().toString(<span class="hljs-number">36</span>).slice(<span class="hljs-number">2</span>)}</span>`</span>
      <span class="hljs-comment">// 1. æ³¨å†Œ remote ä¿¡æ¯</span>
      <span class="hljs-title function_">setRemote</span>(remoteName, {
        <span class="hljs-attr">url</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(url),
        <span class="hljs-attr">format</span>: <span class="hljs-string">'esm'</span>,
        <span class="hljs-attr">from</span>: <span class="hljs-string">'vite'</span>,
      })

      <span class="hljs-comment">// 2. åŠ è½½æ¨¡å—</span>
      <span class="hljs-keyword">const</span> mod = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getRemote</span>(remoteName, <span class="hljs-string">`./<span class="hljs-subst">${moduleName}</span>`</span>)
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'======'</span>, type)
      <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'ts'</span>) <span class="hljs-keyword">return</span> mod
      <span class="hljs-comment">// 3. è§£åŒ…æ¨¡å—</span>
      <span class="hljs-keyword">const</span> <span class="hljs-title class_">Comp</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">unwrap</span>(mod)

      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Comp</span>
  } <span class="hljs-keyword">catch</span> (error) {

  }
}

</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//ä½¿ç”¨å¯¼å‡ºçš„æ–¹æ³•</span>
<span class="hljs-keyword">const</span> util = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getRemoteComponent</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'http://localhost:20001/assets/remoteEntry.js'</span>, 
    <span class="hljs-attr">moduleName</span>: <span class="hljs-string">'Util'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'ts'</span>
})
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'util'</span>, util?.<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>))
<span class="hljs-comment">//å¼•å…¥ç»„ä»¶</span>
<span class="hljs-keyword">const</span> remoteButton = <span class="hljs-title function_">getRemoteComponent</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">'http://localhost:5001/assets/remoteEntry.js'</span>,
  <span class="hljs-attr">moduleName</span>: <span class="hljs-string">"Button"</span>
})
&lt;template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- å…·æœ‰æ·±å±‚å¼‚æ­¥ä¾èµ–çš„ç»„ä»¶ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">remoteButton</span> /&gt;</span>

  <span class="hljs-comment">&lt;!-- åœ¨ #fallback æ’æ§½ä¸­æ˜¾ç¤º â€œæ­£åœ¨åŠ è½½ä¸­â€ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">fallback</span>&gt;</span>
    Loading...
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>
&lt;/template&gt;
</code></pre>
<p>è¿™æ ·å°±å¯ä»¥é€šè¿‡baseé‡Œé¢è®¾ç½®åŠ¨æ€è·¯ç”±æ¥åŠ è½½ä¸åŒå­é¡¹ç›®çš„ç»„ä»¶äº†</p>
<h3 data-id="heading-4">æˆ‘çš„ç¤ºä¾‹</h3>
<h4 data-id="heading-5">baseé¡¹ç›®å†…å®¹</h4>
<ol>
<li>ç™»å½•é¡µé¢</li>
<li>layoutå¸ƒå±€</li>
<li>è·å–ç”¨æˆ·èœå•åŠ¨æ€åŠ è½½èœå•è·¯ç”±</li>
<li>ä¸€äº›ä»–è‡ªå·±çš„é¡µé¢ï¼Œç”¨æˆ·ç®¡ç†ï¼Œè§’è‰²ç®¡ç†ç­‰</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//æ¨¡æ‹Ÿçš„ç”¨æˆ·èœå•</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getMenuList</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>([
        {
          <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">title</span>:<span class="hljs-string">'è¿è¥ç®¡ç†'</span>,
          <span class="hljs-attr">children</span>:[
            {
              <span class="hljs-attr">id</span>: <span class="hljs-number">11</span>,
              <span class="hljs-attr">title</span>:<span class="hljs-string">'è½¦è¾†ç®¡ç†'</span>,
              <span class="hljs-attr">name</span>: <span class="hljs-string">'CarManage'</span>,
              <span class="hljs-attr">path</span>: <span class="hljs-string">'/business/CarManage'</span>,
              <span class="hljs-attr">component</span>: <span class="hljs-string">'CarManage'</span>,
              <span class="hljs-attr">source</span>: <span class="hljs-string">'http://localhost:20001/assets/remoteEntry.js'</span>
            },
            {
              <span class="hljs-attr">id</span>: <span class="hljs-number">12</span>,
              <span class="hljs-attr">title</span>:<span class="hljs-string">'è½¦è¾†è¯¦æƒ…'</span>,
              <span class="hljs-attr">name</span>: <span class="hljs-string">'CarDetail'</span>,
              <span class="hljs-attr">path</span>: <span class="hljs-string">'/business/CarDetail'</span>,
              <span class="hljs-attr">component</span>: <span class="hljs-string">'CarDetail'</span>,
              <span class="hljs-attr">source</span>: <span class="hljs-string">'http://localhost:20001/assets/remoteEntry.js'</span>
            }
          ]
        },
        {
          <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
          <span class="hljs-attr">title</span>:<span class="hljs-string">'ç”¨æˆ·ç®¡ç†'</span>,
          <span class="hljs-attr">children</span>:[
            {
              <span class="hljs-attr">id</span>: <span class="hljs-number">21</span>,
              <span class="hljs-attr">title</span>:<span class="hljs-string">'ç”¨æˆ·åˆ—è¡¨'</span>,
              <span class="hljs-attr">name</span>: <span class="hljs-string">'UserList'</span>,
              <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/UserList'</span>,
              <span class="hljs-attr">component</span>: <span class="hljs-string">'/user/UserListView'</span>,
            },
            {
              <span class="hljs-attr">id</span>: <span class="hljs-number">22</span>,
              <span class="hljs-attr">title</span>:<span class="hljs-string">'ç”¨æˆ·è§’è‰²'</span>,
              <span class="hljs-attr">name</span>: <span class="hljs-string">'UserRole'</span>,
              <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/UserRole'</span>,
              <span class="hljs-attr">component</span>: <span class="hljs-string">'/user/UserRoleView'</span>,
            }
          ]
        }
      ])
    }, <span class="hljs-number">1000</span>)
  })
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * åŠ¨æ€åŠ è½½ç»„ä»¶ï¼ˆæ”¯æŒæœ¬åœ°å’Œè¿œç¨‹ç»„ä»¶ï¼‰
 */</span>
<span class="hljs-keyword">const</span> modules = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-title function_">glob</span>(<span class="hljs-string">"../views/**/*.vue"</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadDynamicComponent</span>(<span class="hljs-params">menu: MenuType</span>) {
  <span class="hljs-keyword">if</span> (menu.<span class="hljs-property">source</span> &amp;&amp; menu.<span class="hljs-property">component</span>) {
    <span class="hljs-comment">// è¿œç¨‹ç»„ä»¶åŠ è½½</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">getRemoteComponent</span>({
      <span class="hljs-attr">url</span>: menu.<span class="hljs-property">source</span> <span class="hljs-keyword">as</span> string,
      <span class="hljs-attr">moduleName</span>: menu.<span class="hljs-property">component</span>
    })
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (menu.<span class="hljs-property">component</span>) {
    <span class="hljs-comment">// æœ¬åœ°ç»„ä»¶åŠ è½½ - ä½¿ç”¨ import.meta.glob</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">componentPath</span>: string

    <span class="hljs-keyword">if</span> (menu.<span class="hljs-property">component</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'/'</span>)) {
      <span class="hljs-comment">// å¦‚æœæ˜¯è·¯å¾„æ ¼å¼ (å¦‚ /user/UserList)ï¼Œè½¬æ¢ä¸ºç›¸å¯¹è·¯å¾„</span>
      componentPath = <span class="hljs-string">`../views<span class="hljs-subst">${menu.component}</span>.vue`</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// å¦‚æœæ˜¯ç»„ä»¶åæ ¼å¼ (å¦‚ UserList)ï¼Œæ·»åŠ è·¯å¾„å‰ç¼€</span>
      componentPath = <span class="hljs-string">`../views/<span class="hljs-subst">${menu.component}</span>.vue`</span>
    }

    <span class="hljs-keyword">const</span> moduleLoader = modules[componentPath]

    <span class="hljs-keyword">if</span> (moduleLoader) {
      <span class="hljs-keyword">return</span> moduleLoader
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`ç»„ä»¶æœªæ‰¾åˆ°: <span class="hljs-subst">${componentPath}</span>ï¼Œå¯ç”¨ç»„ä»¶:`</span>, <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(modules))
      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>({
        <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div&gt;ç»„ä»¶æœªæ‰¾åˆ°&lt;/div&gt;'</span>
      })
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>
}
</code></pre>
<h4 data-id="heading-6">è¿è¥ç®¡ç†å†…å®¹</h4>
<p>åªéœ€è¦æŠŠè¦å¯¼å‡ºçš„ä¸œè¥¿éƒ½å¯¼å‡ºå°±è¡Œ</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> remoteExport = {
  <span class="hljs-title class_">CarManage</span>: <span class="hljs-string">'src/views/CarManage/CarManage.vue'</span>,
  <span class="hljs-title class_">CarDetail</span>: <span class="hljs-string">'src/views/CarManage/CarDetail.vue'</span>,
  <span class="hljs-title class_">Util</span>: <span class="hljs-string">'src/utils/index.ts'</span>
}
<span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-title function_">federation</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'remote-business'</span>,
  <span class="hljs-attr">filename</span>: <span class="hljs-string">'remoteEntry.js'</span>,
  <span class="hljs-attr">exposes</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(remoteExport).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> [<span class="hljs-string">`./<span class="hljs-subst">${key}</span>`</span>, value])
  ),
  <span class="hljs-attr">shared</span>: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'pinia'</span>, <span class="hljs-string">'vue-router'</span>]
}),
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d5b01249cea42128eaf5e8a7ee97e7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Yqq5Yqb5Lmf5LiN5Lya5re3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764919094&amp;x-signature=4BHl%2F1ROu1Wl68ZH%2BjZVj8TNMNI%3D" alt="image.png" loading="lazy"/></p>
<p>åˆ°ç°åœ¨å·²ç»å®ç°äº†å¾®å‰ç«¯äº†</p>
<h3 data-id="heading-7">å¼€å‘æ—¶å€™çš„ä¼˜åŒ–</h3>
<p>ç°åœ¨å­é¡¹ç›®å¿…é¡»buildä¹‹åæ‰èƒ½ç”ŸæˆremoteEntryï¼Œä¹Ÿå°±æ²¡åŠæ³•çƒ­æ›´æ–°ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨é€šçŸ¥ï¼Œbaseé¡¹ç›®å…¨å±€åˆ·æ–°ï¼Œå®ç°ä¼ªçƒ­æ›´æ–°æ•ˆæœ</p>
<p>å‚è€ƒä¸‹ä¸‹é¢çš„æ’ä»¶</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Options</span> {
  <span class="hljs-attr">role</span>: <span class="hljs-string">'remote'</span> | <span class="hljs-string">'host'</span>;
  host?: <span class="hljs-built_in">string</span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">syncReloadPlugin</span>(<span class="hljs-params">options: Options</span>) {
  <span class="hljs-keyword">const</span> role = options.<span class="hljs-property">role</span>;
  <span class="hljs-keyword">const</span> hostUrl = options.<span class="hljs-property">host</span>;

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'vite-plugin-sync-reload'</span>,

    <span class="hljs-title function_">apply</span>(<span class="hljs-params">config: <span class="hljs-built_in">any</span>, { command }: <span class="hljs-built_in">any</span></span>) {
      <span class="hljs-keyword">if</span> (role !== <span class="hljs-string">'remote'</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'dev'</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Boolean</span>(command === <span class="hljs-string">'build'</span> &amp;&amp; config.<span class="hljs-property">build</span>?.<span class="hljs-property">watch</span>);
    },

    <span class="hljs-keyword">async</span> <span class="hljs-title function_">buildEnd</span>(<span class="hljs-params">error: <span class="hljs-built_in">any</span></span>) {
      <span class="hljs-keyword">if</span> (role !== <span class="hljs-string">'remote'</span>) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">return</span>;

      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${hostUrl}</span>/__fullReload`</span>);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[remote] å·²é€šçŸ¥ host åˆ·æ–°`</span>);
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[remote] é€šçŸ¥ host å¤±è´¥ï¼ˆå¯èƒ½ host æœªå¯åŠ¨ï¼‰`</span>);
      }
    },

    <span class="hljs-title function_">configureServer</span>(<span class="hljs-params">server: <span class="hljs-built_in">any</span></span>) {

      <span class="hljs-keyword">if</span> (role !== <span class="hljs-string">'host'</span>) <span class="hljs-keyword">return</span>;

      server.<span class="hljs-property">middlewares</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req: <span class="hljs-built_in">any</span>, res: <span class="hljs-built_in">any</span>, next: <span class="hljs-built_in">any</span></span>) =&gt;</span> {

          <span class="hljs-comment">// remote build åä¼šè®¿é—®è¿™é‡Œ</span>
          <span class="hljs-keyword">if</span> (req.<span class="hljs-property">url</span> === <span class="hljs-string">'/__fullReload'</span>) {

            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[host] æ”¶åˆ° remote é€šçŸ¥ï¼Œå³å°†åˆ·æ–°é¡µé¢'</span>);

            <span class="hljs-comment">// è§¦å‘æµè§ˆå™¨åˆ·æ–°</span>
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span>{
              server.<span class="hljs-property">hot</span>.<span class="hljs-title function_">send</span>({
                <span class="hljs-attr">type</span>: <span class="hljs-string">'full-reload'</span>
              });
            },<span class="hljs-number">100</span>)

            res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Full reload triggered'</span>);
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_">next</span>(); <span class="hljs-comment">// ç»§ç»­ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</span>
          }
        });
    }
  };
}

<span class="hljs-title function_">syncReloadPlugin</span>({ <span class="hljs-attr">role</span>: <span class="hljs-string">'host'</span> }),
<span class="hljs-title function_">syncReloadPlugin</span>({
  <span class="hljs-attr">role</span>: <span class="hljs-string">'remote'</span>,
  <span class="hljs-attr">host</span>: <span class="hljs-string">'http://localhost:20000'</span>
})
</code></pre>
<h3 data-id="heading-8">æˆ‘çš„ç¤ºä¾‹ä»£ç </h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F5563%2Ffederation-microapp" target="_blank" title="https://github.com/5563/federation-microapp" ref="nofollow noopener noreferrer">ä¸€ä¸ªè”é‚¦å®ç°å¾®å‰ç«¯çš„ç¤ºä¾‹ä»£ç </a> : <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F5563%2Ffederation-microapp" target="_blank" title="https://github.com/5563/federation-microapp" ref="nofollow noopener noreferrer">github.com/5563/federaâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ­å»ºç®€æ˜“ç‰ˆmonorepo + turborepo]]></title>    <link>https://juejin.cn/post/7577298871005364258</link>    <guid>https://juejin.cn/post/7577298871005364258</guid>    <pubDate>2025-11-28T07:24:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577298871005364258" data-draft-id="7577378514401706019" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ­å»ºç®€æ˜“ç‰ˆmonorepo + turborepo"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-28T07:24:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‡¡äººç¨‹åºå‘˜"/> <meta itemprop="url" content="https://juejin.cn/user/3237375877059565"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ­å»ºç®€æ˜“ç‰ˆmonorepo + turborepo
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3237375877059565/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‡¡äººç¨‹åºå‘˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T07:24:00.000Z" title="Fri Nov 28 2025 07:24:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<ul>
<li>é¡¹ç›®ç»“æ„ï¼špnpm Monorepo</li>
</ul>

<ul>
<li>
<ul>
<li><code>packages/ui</code>ï¼šReact ç»„ä»¶åº“ï¼ˆä½¿ç”¨ Vite + TS æ‰“åŒ…ï¼‰</li>
<li><code>apps/react-demo</code>ï¼šReact åº”ç”¨ï¼Œä¾èµ– <code>@my-org/ui</code></li>
</ul>
</li>
</ul>

<ul>
<li>ç›®æ ‡ï¼š</li>
</ul>

<ul>
<li>
<ul>
<li>âœ… å¼€å‘ç¯å¢ƒï¼šä¿®æ”¹ <code>ui</code> æºç  â†’ è‡ªåŠ¨çƒ­æ›´æ–°åˆ° <code>react-demo</code></li>
<li>âœ… ç”Ÿäº§æ„å»ºï¼š<code>react-demo</code> èƒ½æ­£ç¡®æ‰“åŒ… <code>@my-org/ui</code></li>
</ul>
</li>
</ul>
<h2 data-id="heading-1">é‡åˆ°çš„é—®é¢˜ &amp; è§£å†³æ–¹æ¡ˆ</h2>
<h2 data-id="heading-2">âŒ é—®é¢˜ 1ï¼šç”Ÿäº§æ„å»ºæ—¶æŠ¥é”™ â€”â€” <code>@my-org/ui</code> æ— æ³•è§£æ</h2>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// é”™è¯¯ä¿¡æ¯</span>
[vite]: Rolldown failed to resolve <span class="hljs-keyword">import</span> <span class="hljs-string">"@my-org/ui"</span> ...
</code></pre>
<h3 data-id="heading-3">ğŸ” æ ¹æœ¬åŸå› ï¼š</h3>
<ul>
<li><code>react-demo</code> çš„ <code>node_modules/@my-org/ui/</code> ä¸­ <strong>æ²¡æœ‰</strong> ****<code>dist/ </code>****<strong>ç›®å½•</strong></li>
<li>å¯¼è‡´ Vite æ‰¾ä¸åˆ° JS å…¥å£æ–‡ä»¶ï¼ˆå¦‚ <code>ui.js</code>ï¼‰</li>
</ul>
<h3 data-id="heading-4">âœ… è§£å†³æ­¥éª¤ï¼š</h3>
<ol>
<li><strong>ç¡®è®¤</strong> ****<code>packages/ui/package.json</code> ****<strong>åŒ…å«</strong> ****<code>"files": ["dist"]</code><br/>
â†’ å¦åˆ™ pnpm ä¸ä¼šæŠŠ <code>dist</code> é“¾æ¥åˆ° consumer çš„ <code>node_modules</code></li>
<li><strong>å…ˆæ„å»º UI åº“</strong></li>
</ol>
<pre><code class="hljs language-css" lang="css">
pnpm <span class="hljs-attr">--filter</span> <span class="hljs-keyword">@my-org</span>/ui build
</code></pre>
<ol start="3">
<li><strong>ç¡®ä¿</strong> ****<code>react-demo</code> ****<strong>å£°æ˜äº†ä¾èµ–</strong></li>
</ol>
<pre><code class="hljs language-sql" lang="sql">
pnpm <span class="hljs-keyword">add</span> <span class="hljs-variable">@my</span><span class="hljs-operator">-</span>org<span class="hljs-operator">/</span>ui<span class="hljs-variable">@workspace</span>:<span class="hljs-operator">*</span> <span class="hljs-comment">--filter react-demo</span>
</code></pre>
<ol start="4">
<li><strong>å¼ºåˆ¶åˆ·æ–°é“¾æ¥</strong></li>
</ol>
<pre><code class="hljs language-css" lang="css">
pnpm install <span class="hljs-attr">--force</span>
</code></pre>
<p>ğŸ’¡ å…³é”®è®¤çŸ¥ï¼š<strong>pnpm workspace é“¾æ¥ â‰  å®æ—¶ç›®å½•æ˜ å°„</strong>ï¼Œå®ƒåªé“¾æ¥ <code>package.json</code> ä¸­å£°æ˜çš„æ–‡ä»¶ï¼ˆé€šè¿‡ <code>files</code>ï¼‰ï¼Œä¸”éœ€åœ¨ <code>dist</code> å­˜åœ¨åæ‰§è¡Œ <code>install</code>ã€‚</p>
<h2 data-id="heading-5">âŒ é—®é¢˜ 2ï¼š<code>package.json</code> å…¥å£æ–‡ä»¶åä¸å®é™…è¾“å‡ºä¸ä¸€è‡´</h2>
<ul>
<li>é…ç½®å†™çš„æ˜¯ï¼š</li>
</ul>
<pre><code class="hljs language-json" lang="json">
<span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.js"</span>
</code></pre>
<ul>
<li>ä½† Vite é»˜è®¤è¾“å‡ºï¼š</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">
dist/ui.js
dist/ui.mjs
</code></pre>
<h3 data-id="heading-6">ğŸ” åæœï¼š</h3>
<ul>
<li>å³ä½¿ <code>dist</code> è¢«é“¾æ¥ï¼ŒVite ä»å°è¯•åŠ è½½ä¸å­˜åœ¨çš„ <code>index.js</code> â†’ æ¨¡å—è§£æå¤±è´¥</li>
</ul>
<h3 data-id="heading-7">âœ… è§£å†³æ–¹æ¡ˆï¼ˆäºŒé€‰ä¸€ï¼‰ï¼š</h3>

















<table><thead><tr><th>æ–¹æ¡ˆ</th><th>æ“ä½œ</th></tr></thead><tbody><tr><td><strong>Aï¼ˆæ¨èï¼‰</strong></td><td>ä¿®æ”¹ <code>package.json</code>æŒ‡å‘çœŸå®æ–‡ä»¶ï¼š <code>"main": "./dist/ui.js"</code></td></tr><tr><td><strong>B</strong></td><td>ä¿®æ”¹ <code>vite.config.ts</code>å¼ºåˆ¶è¾“å‡º <code>index.js</code>ï¼š <code>fileName: (format) =&gt; </code>index.${format === 'es' ? 'mjs' : 'js'}``</td></tr></tbody></table>
<p>âœ… æœ€ç»ˆé€‰æ‹© <strong>æ–¹æ¡ˆ A</strong>ï¼Œé¿å…æ”¹æ„å»ºé…ç½®ï¼Œæ›´ç®€å•ç›´æ¥ã€‚</p>
<h2 data-id="heading-8">âŒ é—®é¢˜ 3ï¼šå³ä½¿ <code>files</code> æ­£ç¡®ï¼Œ<code>dist</code> ä»ä¸å‡ºç°</h2>
<p>è¿è¡Œ <code>pnpm install --force</code> åï¼Œ<code>node_modules/@my-org/ui/dist</code> ä¾ç„¶ä¸å­˜åœ¨ã€‚</p>
<h3 data-id="heading-9">ğŸ” æ·±å±‚åŸå› ï¼š</h3>
<ul>
<li><code>react-demo/package.json</code> <strong>æœªå£°æ˜å¯¹</strong> ****<code>@my-org/ui</code> ****<strong>çš„ä¾èµ–</strong></li>
<li>pnpm <strong>ä¸ä¼šè‡ªåŠ¨é“¾æ¥æœªå£°æ˜çš„ workspace åŒ…</strong></li>
</ul>
<h3 data-id="heading-10">âœ… è§£å†³ï¼š</h3>
<pre><code class="hljs language-sql" lang="sql">
pnpm <span class="hljs-keyword">add</span> <span class="hljs-variable">@my</span><span class="hljs-operator">-</span>org<span class="hljs-operator">/</span>ui<span class="hljs-variable">@workspace</span>:<span class="hljs-operator">*</span> <span class="hljs-comment">--filter react-demo</span>
</code></pre>
<p>â†’ æ˜¾å¼å»ºç«‹ä¾èµ–å…³ç³»ï¼Œpnpm æ‰ä¼šåˆ›å»º symlink å¹¶åŒ…å« <code>dist/</code>ã€‚</p>
<p>ğŸ“Œ è¿™æ˜¯ Monorepo çš„æ ¸å¿ƒè§„åˆ™ï¼š <strong>â€œæœªå£°æ˜ = ä¸å­˜åœ¨â€</strong></p>
<h2 data-id="heading-11">âœ… é—®é¢˜ 4ï¼šå¼€å‘ç¯å¢ƒå¦‚ä½•å®ç°çƒ­æ›´æ–°ï¼Ÿ</h2>
<p>ç”Ÿäº§æ„å»ºæˆåŠŸåï¼Œéœ€æ”¯æŒå¼€å‘æ—¶å®æ—¶ç¼–è¾‘ <code>ui</code> ç»„ä»¶ã€‚</p>
<h3 data-id="heading-12">âœ… è§£å†³æ–¹æ¡ˆï¼š</h3>
<ol>
<li><strong>åœ¨</strong> ****<code>react-demo/vite.config.ts</code> ****<strong>ä¸­æ·»åŠ  alias</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-css" lang="css">
resolve: {
  alias: {
    '<span class="hljs-keyword">@my-org</span>/ui': path.resolve(__dirname, <span class="hljs-string">'../../packages/ui/src'</span>)
  }
}
</code></pre>
<ol start="2">
<li><strong>å¯åŠ¨å¼€å‘æœåŠ¡å™¨</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-css" lang="css">
pnpm <span class="hljs-attr">--filter</span> react-demo dev
</code></pre>
<p>ğŸ’¡ åŸç†ï¼šVite ç›´æ¥ç¼–è¯‘ <code>ui/src</code> æºç ï¼ˆè€Œé <code>dist</code>ï¼‰ï¼Œå¤©ç„¶æ”¯æŒ HMR å’Œ TSXã€‚</p>
<hr/>
<h2 data-id="heading-13">ğŸ§ª éªŒè¯æ¸…å•ï¼ˆæœ€ç»ˆçŠ¶æ€ï¼‰</h2>



































<table><thead><tr><th>æ£€æŸ¥é¡¹</th><th>å‘½ä»¤</th><th>é¢„æœŸç»“æœ</th></tr></thead><tbody><tr><td>UI åº“å·²æ„å»º</td><td><code>ls packages/ui/dist</code></td><td>æœ‰ <code>ui.js</code>, <code>ui.mjs</code>, <code>*.d.ts</code></td></tr><tr><td>ä¾èµ–å·²å£°æ˜</td><td><code>grep "@my-org/ui" apps/react-demo/package.json</code></td><td>æœ‰ <code>"@my-org/ui": "workspace:*"</code></td></tr><tr><td>é“¾æ¥å·²åŒæ­¥</td><td><code>ls apps/react-demo/node_modules/@my-org/ui/dist</code></td><td>æ–‡ä»¶å­˜åœ¨</td></tr><tr><td>ç”Ÿäº§æ„å»ºæˆåŠŸ</td><td><code>pnpm --filter react-demo build</code></td><td>æ— æŠ¥é”™ï¼Œç”Ÿæˆ <code>dist/</code></td></tr><tr><td>å¼€å‘çƒ­æ›´æ–°</td><td>ä¿®æ”¹ <code>ui/src/Button.tsx</code>â†’ æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°</td><td>âœ… å®æ—¶ç”Ÿæ•ˆ</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-14">ğŸ“š ç»éªŒæ€»ç»“</h2>

























<table><thead><tr><th>åœºæ™¯</th><th>å…³é”®é…ç½®</th></tr></thead><tbody><tr><td><strong>ç”Ÿäº§æ„å»º</strong></td><td><code>package.json</code>çš„ <code>main</code>/<code>module</code>å¿…é¡»åŒ¹é…çœŸå®æ–‡ä»¶å + <code>"files": ["dist"]</code></td></tr><tr><td><strong>ä¾èµ–é“¾æ¥</strong></td><td>Consumer å¿…é¡»åœ¨ <code>package.json</code>ä¸­æ˜¾å¼å£°æ˜ <code>workspace:*</code>ä¾èµ–</td></tr><tr><td><strong>å¼€å‘ä½“éªŒ</strong></td><td>é€šè¿‡ Vite <code>alias</code>æŒ‡å‘ <code>src</code>ï¼Œç»•è¿‡ <code>dist</code>ï¼Œå®ç° HMR</td></tr><tr><td><strong>æ„å»ºé¡ºåº</strong></td><td>å…ˆ <code>build ui</code>â†’ å† <code>pnpm install</code>â†’ æœ€å <code>build app</code></td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Uptime Kumaä¿®æ”¹ä½œä¸ºå†…åµŒé¡µé¢çš„è‡ªé€‚åº”]]></title>    <link>https://juejin.cn/post/7577294037717909538</link>    <guid>https://juejin.cn/post/7577294037717909538</guid>    <pubDate>2025-11-28T06:05:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577294037717909538" data-draft-id="7577284968923627520" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Uptime Kumaä¿®æ”¹ä½œä¸ºå†…åµŒé¡µé¢çš„è‡ªé€‚åº”"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-28T06:05:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¼äº¿ä¼åƒä¸‡"/> <meta itemprop="url" content="https://juejin.cn/user/3651901500169884"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Uptime Kumaä¿®æ”¹ä½œä¸ºå†…åµŒé¡µé¢çš„è‡ªé€‚åº”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3651901500169884/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¼äº¿ä¼åƒä¸‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T06:05:05.000Z" title="Fri Nov 28 2025 06:05:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="http://openwrite.cn/uploads/19960/56785/d9298a17-80c5-4259-8024-6ecef5b8c0ea.png" alt="8bd3c9d3a7ce456aa6cdd4d140de4d67.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html">/* ==================================
1. åŸºç¡€æ ·å¼é‡ç½®ï¼ˆæ¶ˆé™¤é»˜è®¤è¾¹è·/æº¢å‡ºï¼‰
================================== */
/* é‡ç½® html/body é»˜è®¤è¾¹è·ï¼Œç¦æ­¢é¡µé¢è‡ªèº«æ»šåŠ¨ï¼ˆç”± iframe æ§åˆ¶æ»šåŠ¨ï¼‰ */
html,
body {
  margin: 0;
  padding: 0;
  overflow: hidden;
}


/* ==================================
2. iframe é€‚é…æ ¸å¿ƒæ ·å¼ï¼ˆé¡µé¢ç¼©æ”¾é€»è¾‘ï¼‰
================================== */
/* é¡µé¢æœ€å¤–å±‚å®¹å™¨ç¼©æ”¾é…ç½®ï¼ˆé€‚é… iframe å¤§å°ï¼‰
   æ³¨ï¼šè‹¥å®é™…å¤–å±‚å®¹å™¨ä¸æ˜¯ .appï¼Œéœ€æ›¿æ¢ä¸ºçœŸå®ç±»åï¼ˆå¦‚ .containerã€.status-page ç­‰ï¼‰ */
.app {
  /* 1. åŸºå‡†å°ºå¯¸ï¼ˆéœ€æ ¹æ®é¡µé¢å®é™…è®¾è®¡ç¨¿è°ƒæ•´ï¼Œæ­¤å¤„ä¸ºç¤ºä¾‹å€¼ï¼‰ */
  width: 1000px;  /* é¡µé¢ç†æƒ³å®½åº¦ï¼ˆåŸºå‡†ï¼‰ */
  height: 600px;  /* é¡µé¢ç†æƒ³é«˜åº¦ï¼ˆåŸºå‡†ï¼‰ */
  margin: 0 auto; /* å¯é€‰ï¼šè®©å®¹å™¨æ°´å¹³å±…ä¸­ï¼ˆè‹¥ iframe å®½åº¦å¤§äºåŸºå‡†å®½åº¦æ—¶ç”Ÿæ•ˆï¼‰ */

  /* 2. æŒ‰ iframe å®½åº¦è‡ªåŠ¨ç¼©æ”¾ï¼ˆæ ¸å¿ƒé€‚é…é€»è¾‘ï¼‰ */
  transform-origin: top left; /* ç¼©æ”¾åŸç‚¹ï¼šå·¦ä¸Šè§’ï¼ˆé¿å…ç¼©æ”¾åç§»ï¼‰ */
  transform: scale(calc(100vw / 1000)); /* ç¼©æ”¾æ¯”ä¾‹ = iframe å®½åº¦ Ã· åŸºå‡†å®½åº¦ */

  /* 3. åŒæ­¥ç¼©æ”¾é«˜åº¦ï¼ˆä¿è¯é¡µé¢æ¯”ä¾‹ä¸å˜å½¢ï¼‰ */
  height: calc(600 * (100vw / 1000) * 1px);
}


/* ==================================
3. å…ƒç´ éšè—ï¼ˆæŒ‰éœ€éšè—æŒ‡å®šæ ‡ç­¾/å®¹å™¨ï¼‰
================================== */
/* éšè—æ‰€æœ‰ h1 æ ‡ç­¾ï¼ˆå…¨å±€ï¼‰ */
h1 {
  display: none !important;
}

/* éšè—å«â€œæœåŠ¡â€æ–‡æœ¬çš„ç›®æ ‡ h2 æ ‡ç­¾ï¼ˆç²¾å‡†åŒ¹é… data-v å±æ€§å’Œç±»åï¼‰ */
h2.group-title[data-v-f71ca08e] {
  display: none !important;
}

/* éšè—æŒ‡å®š alert å®¹å™¨ï¼ˆåŒ¹é… data-v å±æ€§å’Œç±»åï¼‰ */
div.alert-heading.p-2[data-v-b8247e57] {
  display: none !important;
}

/* éšè—é¡µé¢åº•éƒ¨ footer åŒºåŸŸï¼ˆå…¨å±€ï¼‰ */
footer {
  display: none !important;
}


/* ==================================
4. é—´è·è°ƒæ•´ï¼ˆè¦†ç›–é»˜è®¤ padding/marginï¼‰
================================== */
/* æ¸…é™¤ .p-4 ç±»çš„æ‰€æœ‰å†…è¾¹è·ï¼ˆä¸Šä¸‹å·¦å³å‡ä¸º 0ï¼‰ */
.p-4 {
  padding: 0 !important;
}

/* æ¸…é™¤ .mb-4 ç±»çš„åº•éƒ¨å¤–è¾¹è·ï¼ˆè®¾ä¸º 0ï¼‰ */
.mb-4 {
  margin-bottom: 0 !important;
}

/* è°ƒæ•´ .mt-4 ç±»çš„é¡¶éƒ¨å¤–è¾¹è·ï¼ˆä» 1.5rem æ”¹ä¸º 0.5remï¼‰ */
.mt-4 {
  margin-top: 0.5rem !important;
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MCPç†è®ºå’Œå®æˆ˜ï¼Œç„¶ååšä¸ªMCPè„šæ‰‹æ¶å§]]></title>    <link>https://juejin.cn/post/7577461079598055443</link>    <guid>https://juejin.cn/post/7577461079598055443</guid>    <pubDate>2025-11-28T07:42:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577461079598055443" data-draft-id="7577461079597940755" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MCPç†è®ºå’Œå®æˆ˜ï¼Œç„¶ååšä¸ªMCPè„šæ‰‹æ¶å§"/> <meta itemprop="keywords" content="å‰ç«¯,MCP,Node.js"/> <meta itemprop="datePublished" content="2025-11-28T07:42:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç–¯ç‹‚è¸©å‘äºº"/> <meta itemprop="url" content="https://juejin.cn/user/1011206430698574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MCPç†è®ºå’Œå®æˆ˜ï¼Œç„¶ååšä¸ªMCPè„šæ‰‹æ¶å§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1011206430698574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç–¯ç‹‚è¸©å‘äºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T07:42:00.000Z" title="Fri Nov 28 2025 07:42:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å¼•è¨€:  æœ¬æ–‡ä»‹ç»äº†ç›®å‰MCP Serverçš„å¼€å‘æ–¹å¼å’ŒåŸç†ï¼ŒåŒ…æ‹¬streamable HTTPå’ŒSTDIOä¸¤ç§ã€‚å¹¶æä¾›äº†ä¸€ä¸ªnpmè„šæ‰‹æ¶å·¥å…·å¸®ä½ åˆ›å»ºé¡¹ç›®ï¼Œæ¯ä¸ªæ¨¡æ¿é¡¹ç›®éƒ½æ˜¯å¯è¿è¡Œçš„ã€‚</p>
</blockquote>
<h2 data-id="heading-0">streamable HTTP</h2>
<h3 data-id="heading-1">åŸç†åˆ†æ</h3>
<h4 data-id="heading-2">æŠ“åŒ…ã€Œæ¡æ‰‹ã€</h4>
<p>MCP Clientæ€»å…±å‘äº†ä¸‰æ¬¡è¯·æ±‚ï¼ŒMCP Serverå“åº”2æ¬¡ã€‚å®é™…çš„æ¡æ‰‹æµç¨‹æ˜¯4æ¬¡æ¡æ‰‹ï¼Œç¬¬5æ¬¡è¯·æ±‚æ˜¯ä¸ºäº†é€šçŸ¥åç»­çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚è¿›åº¦ï¼Œæ—¥å¿—ç­‰ã€‚ ç›®å‰è§„èŒƒå®ç°æ¥çœ‹ï¼Œç¬¬5æ¬¡æ¡æ‰‹ä¸å½±å“æ­£å¸¸åŠŸèƒ½ï¼‰</p>
<p>ä½¿ç”¨<code>wiresshark</code>æŠ“åŒ…ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/062da5b0a9fa41b1aa37038f0b9b2c25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764920520&amp;x-signature=FcUNFYf9H2TEZ9ACI4D7GoG4lp4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eea2aecc794d4e738caa3175ffc0a78b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764920520&amp;x-signature=dhqJ6uz5suXZf4RNVb20XCknWao%3D" alt="image.png" loading="lazy"/></p>
<p>ä»å®˜ç½‘çš„ã€Œinitializationã€æµç¨‹æ¥çœ‹ï¼Œä¹Ÿå°±æ˜¯4æ¬¡ï¼ˆç¬¬5æ¬¡æœªæ¥åº”è¯¥ä¼šè¢«æ™®éå®ç°ï¼‰</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b8856cf742f4926a58a2cbfe8ef0b32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764920520&amp;x-signature=pdqDqQREOaxHG4PgjxFbLBTVBUI%3D" alt="image.png" loading="lazy"/></p>
<p><strong>ç¬¬1æ¬¡</strong> Postè¯·æ±‚ï¼Œ<code>initialize</code> æ–¹æ³•</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"initialize"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"protocolVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-18"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"capabilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"sampling"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"elicitation"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"roots"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"listChanged"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"clientInfo"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"inspector-client"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.17.2"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ç¬¬2æ¬¡</strong> ï¼š200 OKï¼Œå“åº”ä½“å¦‚ä¸‹</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"protocolVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-18"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"capabilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"listChanged"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"serverInfo"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"weather"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.1"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ç¬¬3æ¬¡</strong> ï¼šPostè¯·æ±‚ï¼Œ<code>notifications/initialized</code>æ–¹æ³•</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"notifications/initialized"</span><span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ç¬¬4æ¬¡</strong> ï¼š202 Acceptedï¼Œæ— å“åº”ä½“</p>
<p><strong>ç¬¬5æ¬¡</strong> ï¼šGetè¯·æ±‚ï¼Œæ­¤æ—¶è¦æ±‚æœåŠ¡ç«¯ä¸€å®šæ˜¯SSEä¼ è¾“äº†-<code>accept: text/event-stream</code></p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">GET</span> /mcp HTTP/<span class="hljs-number">1.1</span>
<span class="hljs-symbol">accept:</span> <span class="hljs-keyword">text</span>/<span class="hljs-keyword">event</span>-stream
</code></pre>
<h4 data-id="heading-3">æ€»ç»“ã€Œæ¡æ‰‹ã€æµç¨‹</h4>
<ol>
<li>
<p><strong>POST /mcp (initialize)</strong></p>
<ul>
<li>å®¢æˆ·ç«¯ï¼šä½ å¥½ï¼Œæˆ‘æ˜¯ Inspector Clientï¼Œæˆ‘æƒ³åˆå§‹åŒ–ã€‚</li>
<li>æœåŠ¡å™¨ï¼šæ”¶åˆ°ï¼Œè¿™æ˜¯æˆ‘çš„èƒ½åŠ›åˆ—è¡¨ï¼ˆ200 OKï¼‰ã€‚</li>
<li>çŠ¶æ€ï¼šJSON-RPC ä¼šè¯å¼€å§‹ã€‚</li>
</ul>
</li>
<li>
<p><strong>POST /mcp (notifications/initialized)</strong></p>
<ul>
<li>å®¢æˆ·ç«¯ï¼šæˆ‘å·²ç»æ”¶åˆ°ä½ çš„èƒ½åŠ›äº†ï¼Œåˆå§‹åŒ–å®Œæˆã€‚</li>
<li>æœåŠ¡å™¨ï¼šæ”¶åˆ° (202 Accepted)ã€‚</li>
<li>çŠ¶æ€ï¼šé€»è¾‘æ¡æ‰‹å®Œæˆã€‚</li>
</ul>
</li>
<li>
<p><strong>GET /mcp (Header: accept: text/event-stream)</strong></p>
<ul>
<li><strong>ç›®çš„</strong>ï¼šå®¢æˆ·ç«¯ç°åœ¨è¯•å›¾å»ºç«‹<strong>é•¿è¿æ¥é€šé“</strong>ï¼Œä»¥ä¾¿åœ¨æœªæ¥èƒ½æ”¶åˆ°æœåŠ¡å™¨å‘æ¥çš„é€šçŸ¥ï¼ˆæ¯”å¦‚ notifications/message æˆ– roots/listChangedï¼‰ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªé€šé“ï¼ŒæœåŠ¡å™¨å°±å˜æˆäº†â€œå“‘å·´â€ï¼Œæ— æ³•ä¸»åŠ¨è”ç³»å®¢æˆ·ç«¯ã€‚</li>
</ul>
</li>
</ol>
<h4 data-id="heading-4">åç»­é€šä¿¡</h4>
<h5 data-id="heading-5">tools/list (åˆ—å‡ºå·¥å…·)</h5>
<p><strong>client-&gt;server è¯·æ±‚</strong></p>
<p>è¯·æ±‚å¤´ï¼š</p>
<pre><code class="hljs language-http" lang="http">POST /mcp HTTP/1.1
accept: application/json, text/event-stream
accept-encoding: gzip, deflate, br
content-length: 85
content-type: application/json
mcp-protocol-version: 2025-06-18
user-agent: node-fetch
Host: localhost:3000
Connection: keep-alive
</code></pre>
<p>è¯·æ±‚æ•°æ®ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tools/list"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"_meta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"progressToken"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>P.S. <code>params</code>ä¸­çš„<code>progressToken</code>æ˜¯å¯ä»¥ç”¨äºåç»­çš„è¿›åº¦é€šçŸ¥çš„ï¼ˆé€šè¿‡SSEï¼‰</p>
<p><strong>server-&gt;client å“åº”</strong></p>
<p>å“åº”å¤´ï¼š</p>
<pre><code class="hljs language-http" lang="http">HTTP/1.1 200 OK
X-Powered-By: Express
Content-Type: application/json
Date: Thu, 27 Nov 2025 11:52:31 GMT
Connection: keep-alive
Keep-Alive: timeout=5
Transfer-Encoding: chunked
</code></pre>
<p>å“åº”ä½“ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"get_weather_now"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Get Weather Now"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Get current weather for a location (city name)"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"inputSchema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"$schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://json-schema.org/draft-07/schema#"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"location"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Location name or city (e.g. beijing, shanghai, new york, tokyo)"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-string">"location"</span>
          <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™é‡Œåˆ—å‡ºä¸€ä¸ªå·¥å…·ï¼š</p>
<ul>
<li><code>get_weather_now</code>ï¼Œæˆ‘ä»¬è‡ªå·±å®šä¹‰/æ³¨å†Œçš„å·¥å…·ã€‚æˆ‘ä»¬å¯ä»¥æ‹¿åˆ°å®ƒçš„<code>title</code>ï¼Œ<code>description</code>å’Œ<code>inputSchema</code>ï¼Œè¿™äº›è¯­ä¹‰ä¿¡æ¯å¯ä»¥å¸®åŠ©LLMç†è§£è¿™ä¸ªå·¥å…·ã€‚</li>
</ul>
<h5 data-id="heading-6">tools/call (è°ƒç”¨tool)</h5>
<p>è¿™é‡Œé€šè¿‡ mcp inspector å·¥å…·è°ƒç”¨äº†<code>get_weather_now</code>ï¼Œè¯·æ±‚ä½“å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tools/call"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"_meta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"progressToken"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"get_weather_now"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"arguments"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"location"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"åŒ—äº¬"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å“åº”ä½“ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Weather for åŒ—äº¬, CN:\nCondition: æ™´\nTemperature: 3Â°C\nLast Update: 2025-11-27T19:50:14+08:00"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-7">æ–¹æ³•å°æ€»ç»“</h5>
<p>ä¸Šé¢æˆ‘ä»¬åˆ—å‡ºäº†ä¸¤ç§å¸¸è§çš„æ–¹æ³•</p>
<ul>
<li><code>tools/list</code>ã€‚MCP Clientåœ¨å‘LLMå‘è¯·æ±‚æºå¸¦åˆ—å‡ºçš„toolï¼ŒLLMä¼šå‘Šè¯‰å®¢æˆ·ç«¯è°ƒç”¨çš„tool nameï¼Œç„¶åç”±MCP clientæ¥è§¦å‘toolè°ƒç”¨ã€‚</li>
<li><code>tools/call</code>ã€‚MCP Clientå‘Šè¯‰MCP Server è°ƒç”¨å“ªä¸ªtoolã€‚</li>
</ul>
<p>å¯ä»¥ç»“åˆå®˜ç½‘çš„è¿™å¼ ç¤ºæ„å›¾ï¼Œè°ƒç”¨toolå°±æ˜¯ä¸€æ¬¡request/responseã€‚å¦‚æœæ˜¯é•¿ä»»åŠ¡ï¼Œå¯ä»¥é€šè¿‡<code>_meta.progressToken</code>ä½œä¸ºå…³è”ï¼Œé€šè¿‡SSEæŒç»­é€šçŸ¥è¿›åº¦ï¼ˆè¿˜è®°å¾—ã€Œæ¡æ‰‹ã€æµç¨‹çš„ç¬¬5æ¬¡æ¡æ‰‹å—ï¼‰</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b405223577d459a88ed0224fae26823~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764920520&amp;x-signature=8xuD9HU4MNNXfBcgP9QQBVvzcH0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">ä»£ç å®æˆ˜ - å¤©æ°”å·¥å…·</h3>
<h4 data-id="heading-9">å‡†å¤‡å¤©æ°”API</h4>
<p>è¿™é‡Œæˆ‘ä½¿ç”¨äº†<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.seniverse.com%2F" target="_blank" title="https://www.seniverse.com/" ref="nofollow noopener noreferrer">å¿ƒçŸ¥å¤©æ°”</a>çš„APIï¼Œç„¶åè‡ªå·±å°è£…ä¸€ä¸ªnode APIã€‚
<code>src/core/seniverse.ts</code></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> crypto <span class="hljs-keyword">from</span> <span class="hljs-string">'node:crypto'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> querystring <span class="hljs-keyword">from</span> <span class="hljs-string">'node:querystring'</span>;
<span class="hljs-comment">/**
 * æŸ¥è¯¢å¤©æ°”æ¥å£
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API_URL</span> = <span class="hljs-string">'https://api.seniverse.com/v3/'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeniverseApi</span> {
    publicKey;
    secretKey;
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">publicKey, secretKey</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">publicKey</span> = publicKey;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">secretKey</span> = secretKey;
    }
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">getWeatherNow</span>(<span class="hljs-params">location</span>) {
        <span class="hljs-keyword">const</span> params = {
            <span class="hljs-attr">ts</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() / <span class="hljs-number">1000</span>), <span class="hljs-comment">// Current timestamp (seconds)</span>
            <span class="hljs-attr">ttl</span>: <span class="hljs-number">300</span>, <span class="hljs-comment">// Expiration time</span>
            <span class="hljs-attr">public_key</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">publicKey</span>,
            <span class="hljs-attr">location</span>: location
        };
        <span class="hljs-comment">// Step 2: Sort keys and construct the string for signature</span>
        <span class="hljs-comment">// "key=value" joined by "&amp;", sorted by key</span>
        <span class="hljs-keyword">const</span> sortedKeys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(params).<span class="hljs-title function_">sort</span>();
        <span class="hljs-keyword">const</span> str = sortedKeys.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${key}</span>=<span class="hljs-subst">${params[key]}</span>`</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">'&amp;'</span>);
        <span class="hljs-comment">// Step 3: HMAC-SHA1 signature</span>
        <span class="hljs-keyword">const</span> signature = crypto
            .<span class="hljs-title function_">createHmac</span>(<span class="hljs-string">'sha1'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">secretKey</span>)
            .<span class="hljs-title function_">update</span>(str)
            .<span class="hljs-title function_">digest</span>(<span class="hljs-string">'base64'</span>);
        <span class="hljs-comment">// Step 4 &amp; 5: Add sig to params and encode for URL</span>
        <span class="hljs-comment">// querystring.encode will handle URL encoding of the signature and other params</span>
        params.<span class="hljs-property">sig</span> = signature;
        <span class="hljs-keyword">const</span> queryString = querystring.<span class="hljs-title function_">encode</span>(params);
        <span class="hljs-keyword">const</span> url = <span class="hljs-string">`<span class="hljs-subst">${API_URL}</span>weather/now.json?<span class="hljs-subst">${queryString}</span>`</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);
            <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP error! status: <span class="hljs-subst">${response.status}</span>`</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
        }
        <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error making Seniverse request:"</span>, error);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }
}
</code></pre>
<p><code>src/core/index.ts</code></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">SeniverseApi</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./seniverse.js'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> seniverseApi = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SeniverseApi</span>(
  process.<span class="hljs-property">env</span>.<span class="hljs-property">SENIVERSE_PUBLIC_KEY</span> || <span class="hljs-string">''</span>,
  process.<span class="hljs-property">env</span>.<span class="hljs-property">SENIVERSE_SECRET_KEY</span> || <span class="hljs-string">''</span>,
);
</code></pre>
<h4 data-id="heading-10">æ­å»ºstreamable HTTPç±»å‹çš„MCP</h4>
<p>1.ä½¿ç”¨<code>express</code>æä¾›åç«¯æœåŠ¡ï¼Œç„¶åè®¾ç½®<code>/mcp</code> endpointï¼ˆä¸€èˆ¬æ¥è¯´MCP clienté»˜è®¤å°±æ˜¯è®¿é—®è¿™ä¸ªendpointï¼‰.
2.åœ¨MCPåè®®ä¸­ï¼Œæ¡æ‰‹/å·¥å…·è°ƒç”¨ç­‰éƒ½æ˜¯é€šè¿‡è¿™ä¸ªä¸€ä¸ªendpointæ¥å®Œæˆçš„ã€‚</p>
<p>3.å°è£…é€»è¾‘
å°è£…äº†ä¸€ä¸ª<code>MyServer</code>ç±»</p>
<ul>
<li><code>run</code>æ–¹æ³•å¯åŠ¨HTTPæœåŠ¡</li>
<li><code>init</code>æ–¹æ³•æ³¨å†Œå·¥å…·</li>
</ul>
<p>4.æ ¸å¿ƒæ˜¯<code>McpServer</code>å’Œ<code>StreamableHTTPServerTransport</code>ä¸¤ä¸ªAPI</p>
<ul>
<li><code>McpServer</code>ï¼š è´Ÿè´£æ³¨å†Œtool.</li>
<li><code>StreamableHTTPServerTransport</code>ï¼š æ¥ç®¡äº†<code>/mcp</code> endpointçš„é€šä¿¡é€»è¾‘</li>
</ul>
<pre><code class="hljs language-json" lang="json">import <span class="hljs-punctuation">{</span> McpServer <span class="hljs-punctuation">}</span> from <span class="hljs-string">"@modelcontextprotocol/sdk/server/mcp.js"</span>;
import <span class="hljs-punctuation">{</span> StreamableHTTPServerTransport <span class="hljs-punctuation">}</span> from <span class="hljs-string">"@modelcontextprotocol/sdk/server/streamableHttp.js"</span>;
import express from <span class="hljs-string">"express"</span>;
import <span class="hljs-punctuation">{</span> z <span class="hljs-punctuation">}</span> from <span class="hljs-string">"zod"</span>;
import <span class="hljs-string">"dotenv/config"</span>;
import <span class="hljs-punctuation">{</span> seniverseApi <span class="hljs-punctuation">}</span> from <span class="hljs-string">"./core/index.js"</span>;

export class MyServer <span class="hljs-punctuation">{</span>
  private mcpServer<span class="hljs-punctuation">:</span> McpServer;
  private app<span class="hljs-punctuation">:</span> express.Express
  constructor() <span class="hljs-punctuation">{</span>
    this.mcpServer = new McpServer(<span class="hljs-punctuation">{</span>
      name<span class="hljs-punctuation">:</span> <span class="hljs-string">"weather"</span><span class="hljs-punctuation">,</span>
      version<span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">}</span>);

    <span class="hljs-comment">// Set up Express and HTTP transport</span>
    this.app = express();
    this.app.use(express.json());

    this.app.use('/mcp'<span class="hljs-punctuation">,</span> async (req<span class="hljs-punctuation">:</span> express.Request<span class="hljs-punctuation">,</span> res<span class="hljs-punctuation">:</span> express.Response) =&gt; <span class="hljs-punctuation">{</span>
        <span class="hljs-comment">// Create a new transport for each request to prevent request ID collisions</span>
        const transport = new StreamableHTTPServerTransport(<span class="hljs-punctuation">{</span>
            sessionIdGenerator<span class="hljs-punctuation">:</span> undefined<span class="hljs-punctuation">,</span>
            enableJsonResponse<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
        <span class="hljs-punctuation">}</span>);

        res.on('close'<span class="hljs-punctuation">,</span> () =&gt; <span class="hljs-punctuation">{</span>
            transport.close();
        <span class="hljs-punctuation">}</span>);

        await this.mcpServer.connect(transport);
        await transport.handleRequest(req<span class="hljs-punctuation">,</span> res<span class="hljs-punctuation">,</span> req.body);
    <span class="hljs-punctuation">}</span>);

  <span class="hljs-punctuation">}</span>

  <span class="hljs-comment">/**
   * åœ¨ç«¯å£è¿è¡ŒServer, é€šè¿‡HTTP streamä¼ è¾“æ•°æ®
   */</span>
  async run()<span class="hljs-punctuation">:</span> Promise&lt;void&gt; <span class="hljs-punctuation">{</span>
    const port = parseInt(process.env.PORT || '<span class="hljs-number">3000</span>');
    this.app.listen(port<span class="hljs-punctuation">,</span> () =&gt; <span class="hljs-punctuation">{</span>
        console.log(`Demo MCP Server running on http<span class="hljs-punctuation">:</span><span class="hljs-comment">//localhost:${port}/mcp`);</span>
    <span class="hljs-punctuation">}</span>).on('error'<span class="hljs-punctuation">,</span> error =&gt; <span class="hljs-punctuation">{</span>
        console.error('Server error<span class="hljs-punctuation">:</span>'<span class="hljs-punctuation">,</span> error);
        process.exit(<span class="hljs-number">1</span>);
    <span class="hljs-punctuation">}</span>);
    
  <span class="hljs-punctuation">}</span>

  <span class="hljs-comment">/**
   * åˆå§‹åŒ–ï¼Œæ³¨å†Œå·¥å…·
   */</span>
  async init()<span class="hljs-punctuation">:</span> Promise&lt;void&gt; <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// Register weather tool</span>
    this.mcpServer.registerTool(
      <span class="hljs-string">"get_weather_now"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        title<span class="hljs-punctuation">:</span> <span class="hljs-string">"Get Weather Now"</span><span class="hljs-punctuation">,</span>
        description<span class="hljs-punctuation">:</span> <span class="hljs-string">"Get current weather for a location (city name)"</span><span class="hljs-punctuation">,</span>
        inputSchema<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          location<span class="hljs-punctuation">:</span> z.string().describe(<span class="hljs-string">"Location name or city (e.g. beijing, shanghai, new york, tokyo)"</span>)
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      async (<span class="hljs-punctuation">{</span> location <span class="hljs-punctuation">}</span>) =&gt; <span class="hljs-punctuation">{</span>
        
        const weatherData = await seniverseApi.getWeatherNow(location);
        if (!weatherData || !weatherData.results || weatherData.results.length === <span class="hljs-number">0</span>) <span class="hljs-punctuation">{</span>
          return <span class="hljs-punctuation">{</span>
            content<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
              <span class="hljs-punctuation">{</span>
                type<span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
                text<span class="hljs-punctuation">:</span> `Failed to retrieve weather data for location<span class="hljs-punctuation">:</span> $<span class="hljs-punctuation">{</span>location<span class="hljs-punctuation">}</span>. Please check the location name and try again.`<span class="hljs-punctuation">,</span>
              <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
          <span class="hljs-punctuation">}</span>;
        <span class="hljs-punctuation">}</span>

        const result = weatherData.results<span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-punctuation">]</span>;
        const weatherText = `Weather for $<span class="hljs-punctuation">{</span>result.location.name<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> $<span class="hljs-punctuation">{</span>result.location.country<span class="hljs-punctuation">}</span><span class="hljs-punctuation">:</span>\n` +
                            `Condition<span class="hljs-punctuation">:</span> $<span class="hljs-punctuation">{</span>result.now.text<span class="hljs-punctuation">}</span>\n` +
                            `Temperature<span class="hljs-punctuation">:</span> $<span class="hljs-punctuation">{</span>result.now.temperature<span class="hljs-punctuation">}</span>Â°C\n` +
                            `Last Update<span class="hljs-punctuation">:</span> $<span class="hljs-punctuation">{</span>result.last_update<span class="hljs-punctuation">}</span>`;
        return <span class="hljs-punctuation">{</span>
          content<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-punctuation">{</span>
              type<span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
              text<span class="hljs-punctuation">:</span> weatherText<span class="hljs-punctuation">,</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">}</span>;
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    );
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c1dc8ceb9ec40ed88b23abbcf3cbe8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764920520&amp;x-signature=kB563xB3UNi%2FYV8vgmILjmPnIto%3D" alt="image.png" loading="lazy"/></p>
<p>æ³¨æ„å·¦ä¾§ä¾§è¾¹æ ï¼š</p>
<ul>
<li>Transport Typeé€‰æ‹©<code>Streamable HTTP</code></li>
<li>URL å¡«å†™ä½ çš„express æœåŠ¡åœ°å€å’Œendpointã€‚</li>
</ul>
<h2 data-id="heading-11">stdio</h2>
<h3 data-id="heading-12">åŸç†åˆ†æ</h3>
<p>æˆ‘åœ¨é¡¹ç›®ä¸­ï¼Œé€šè¿‡ç›‘å¬<code>process.stdin</code>ï¼ŒæŸ¥çœ‹é€šä¿¡Message</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// ç›‘å¬ stdin è¾“å…¥ï¼Œå¯ä»¥åœ¨inspectoré¢æ¿çš„"notifications/message"ä¸­çœ‹åˆ°ï¼ˆä½œä¸ºdebugç”¨ï¼‰</span>
    process.<span class="hljs-property">stdin</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">"data"</span>, <span class="hljs-keyword">async</span> (data) =&gt; {
      <span class="hljs-keyword">const</span> input = data.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">trim</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(input);
    });
</code></pre>
<p>é€šè¿‡<code>mcp-inspector</code>å·¥å…·å°±å¯ä»¥è§‚å¯Ÿåˆ°é€šä¿¡ä¿¡æ¯äº†ï¼Œå¾€ä¸‹çœ‹ğŸ‘</p>
<p><code>tools/list</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03c3662dbeca4b2497d2dc409e1f4800~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764920520&amp;x-signature=HweaG98Bbk0GCpR7RcUfYAeHdMo%3D" alt="image.png" loading="lazy"/></p>
<p><code>tools/call</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a76cddae7bc241f1b5962cec39dbefb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764920520&amp;x-signature=FfQgmUV4ZGHcPKaZh9rejWYagq4%3D" alt="image.png" loading="lazy"/></p>
<p>ç»“åˆå®˜ç½‘çš„<code>stdio</code>é€šä¿¡åŸç†å›¾</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa8e88a4187e40d083e70a067b8aef40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764920520&amp;x-signature=ZFWgTteVrgQu2A6u%2FY3ZcYGAjMY%3D" alt="image.png" loading="lazy"/></p>
<p>å¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ul>
<li>è¿æ¥ä¸€ä¸ªstdio MCPæœåŠ¡ï¼Œä¸åŒäºstreamable HTTP MCPæœåŠ¡éœ€è¦è¿›è¡Œã€Œæ¡æ‰‹ã€ï¼Œåªè¦å¼€å¯ä¸€ä¸ªå­è¿›ç¨‹ï¼ˆsubprocessï¼‰ï¼Œå°±è¡¨ç¤ºè¿æ¥æˆåŠŸã€‚</li>
<li>åç»­çš„é€šä¿¡çš„ä¿¡æ¯æ ¼å¼éµå¾ª<code>json-rpc:2.0</code>ï¼Œé€šè¿‡è¯»å†™<code>process.stdin</code>å’Œ<code>process.stdout</code>å®Œæˆé€šä¿¡ã€‚</li>
</ul>
<h3 data-id="heading-13">ä»£ç å®æˆ˜ - ç»Ÿè®¡æ–‡ä»¶æ•°</h3>
<p>æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡åšå®¢ <a href="https://juejin.cn/post/7576482238461001770" target="_blank" title="https://juejin.cn/post/7576482238461001770">Nodeå†™MCPå…¥é—¨æ•™ç¨‹</a>ï¼ŒåŸºäº<code>StdioServerTransport</code>å®ç°çš„ç»Ÿè®¡ç›®å½•ä¸‹æ–‡ä»¶å¤¹çš„MCP Serverï¼Œå¹¶ä¸”ä»‹ç»äº†<code>mcp inspector</code>çš„è°ƒè¯•å’ŒTraeå®‰è£…ä½¿ç”¨ã€‚</p>
<h2 data-id="heading-14">åˆ›å»ºMCPé¡¹ç›®çš„è„šæ‰‹æ¶</h2>
<p>æ¯æ¬¡å†™ä¸ªæ–°MCP Serveréƒ½è¦æ­å»ºé¡¹ç›®æ¨¡æ¿ï¼Œè¿™ç§é‡å¤çš„å·¥ä½œå½“ç„¶è¯¥åšæˆå·¥å…·è¾£ï¼
æˆ‘è‡ªå·±å†™äº†ä¸€ä¸ª<code>create-mcp</code>è„šæ‰‹æ¶ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffkcaikengren%2Fcreate-mcp" target="_blank" title="https://github.com/fkcaikengren/create-mcp" ref="nofollow noopener noreferrer">Github</a>ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40caikengren-cli%2Fcreate-mcp" target="_blank" title="https://www.npmjs.com/package/@caikengren-cli/create-mcp" ref="nofollow noopener noreferrer">create-mcp</a> cliå·¥å…·å·²ç»å‘å¸ƒåœ¨npmä¸Šäº†ï¼Œå¯ä»¥npmå®‰è£…ä½¿ç”¨ã€‚</p>
<h3 data-id="heading-15">cli åŸç†</h3>
<p>1.è„šæ‰‹æ¶åŸç†ï¼Œé¦–å…ˆå‡†å¤‡ä¸¤ä¸ªæ¨¡æ¿é¡¹ç›®</p>
<ul>
<li><code>template-stdio</code> æ¨¡æ¿</li>
<li><code>template-streamable</code> æ¨¡æ¿</li>
</ul>
<p>2.ç„¶åç”¨Nodeå†™ä¸€ä¸ªcliå·¥å…·ï¼Œä½¿ç”¨äº†ä»¥ä¸‹ä¾èµ–ï¼Œé€šè¿‡å‘½ä»¤è¡Œäº¤äº’çš„æ–¹å¼åˆ›å»ºé¡¹ç›®</p>
<pre><code class="hljs language-bash" lang="bash">pnpm i minimist prompts fs-extra chalk
</code></pre>
<p>3.æ ¹æ®ä½ é€‰æ‹©çš„é¡¹ç›®åç§°å’Œæ¨¡æ¿ï¼Œå¸®ä½ æ‹·è´æ¨¡æ¿ï¼Œä¿®æ”¹ä¸ºä½ çš„ã€Œé¡¹ç›®åç§°ã€</p>
<p>è§‰å¾—è¿™ä¸ªclié¡¹ç›®ä¸é”™çš„è¯ï¼Œç»™ä¸ªå…è´¹çš„starå§~  ğŸ‘‰  <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffkcaikengren%2Fcreate-mcp" target="_blank" title="https://github.com/fkcaikengren/create-mcp" ref="nofollow noopener noreferrer">Github</a></p>
<h3 data-id="heading-16">ä½¿ç”¨ cli</h3>
<p>ä½¿ç”¨<code>@caikengren-cli/create-mcp</code>åˆ›å»ºé¡¹ç›®</p>
<pre><code class="hljs language-bash" lang="bash">npx @caikengren-cli/create-mcp
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10a36b6fd13f411da881200c3d5aabeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764920520&amp;x-signature=P90Jfb0v9dheVQkHCeWYnEeDkNM%3D" alt="image.png" loading="lazy"/></p>
<p>ç„¶åä¾æ¬¡åˆ†åˆ«è¿è¡Œä¸‹é¢ä¸¤ä¸ªå‘½ä»¤</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¼–è¯‘ts/è¿è¡Œnode</span>
pnpm dev

<span class="hljs-comment"># æ‰“å¼€ mcp-inspectorå·¥å…·è°ƒè¯•</span>
pnpm inspect
</code></pre>
<h2 data-id="heading-17">å‚è€ƒ</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2Fspecification%2F2025-11-25" target="_blank" title="https://modelcontextprotocol.io/specification/2025-11-25" ref="nofollow noopener noreferrer">mcpå®˜ç½‘</a><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.info%2Fzh-tw%2F" target="_blank" title="https://modelcontextprotocol.info/zh-tw/" ref="nofollow noopener noreferrer">mcpä¸­æ–‡ç½‘</a><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelcontextprotocol%2Ftypescript-sdk" target="_blank" title="https://github.com/modelcontextprotocol/typescript-sdk" ref="nofollow noopener noreferrer">mcp: typescript-sdk</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸæ¥Webpackåœ¨å¤§å‚ä¸­è¿™æ ·è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼]]></title>    <link>https://juejin.cn/post/7577356848337764387</link>    <guid>https://juejin.cn/post/7577356848337764387</guid>    <pubDate>2025-11-28T07:46:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577356848337764387" data-draft-id="7577417823341985827" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸæ¥Webpackåœ¨å¤§å‚ä¸­è¿™æ ·è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-11-28T07:46:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç§€ç§€ä¸åªä¼šå‰ç«¯"/> <meta itemprop="url" content="https://juejin.cn/user/1410009035452887"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸæ¥Webpackåœ¨å¤§å‚ä¸­è¿™æ ·è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1410009035452887/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç§€ç§€ä¸åªä¼šå‰ç«¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T07:46:17.000Z" title="Fri Nov 28 2025 07:46:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ</h2>
<p>ä¼˜åŒ–åˆ†ç±»ï¼š</p>
<ol>
<li>ä¼˜åŒ–æ‰“åŒ…åçš„ç»“æœï¼ˆåˆ†åŒ…ã€å‡å°åŒ…ä½“ç§¯ã€CDN æœåŠ¡å™¨ï¼‰ ==&gt; æ›´é‡è¦</li>
<li>ä¼˜åŒ–æ‰“åŒ…é€Ÿåº¦ï¼ˆexcludeã€cache-loaderï¼‰</li>
</ol>
<h3 data-id="heading-1">ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰</h3>
<h4 data-id="heading-2">ä¸€ã€ä¸»è¦ç›®çš„</h4>
<ul>
<li>â€‹<strong>å‡å°‘é¦–å±åŠ è½½ä½“ç§¯</strong>â€‹ï¼šé¿å…ä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨ä»£ç </li>
<li>â€‹<strong>åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜</strong>â€‹ï¼šç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ Reactã€Lodashï¼‰å˜åŠ¨å°‘ï¼Œå¯å•ç‹¬ç¼“å­˜</li>
<li>â€‹<strong>æŒ‰éœ€åŠ è½½/å¹¶è¡Œè¯·æ±‚</strong>â€‹ï¼šè·¯ç”±ã€ç»„ä»¶ã€åŠŸèƒ½æ¨¡å—åªåœ¨éœ€è¦æ—¶åŠ è½½ï¼ˆæŒ‰éœ€åŠ è½½æˆ–è€…å¹¶è¡ŒåŠ è½½æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰ä»£ç ï¼‰</li>
</ul>
<h4 data-id="heading-3">äºŒã€ä¸‰ç§ä¸»è¦çš„ä»£ç åˆ†å‰²æ–¹å¼</h4>
<h5 data-id="heading-4">1. <strong>å…¥å£èµ·ç‚¹ï¼ˆEntry Pointsï¼‰æ‰‹åŠ¨åˆ†å‰²</strong></h5>
<p>é€šè¿‡é…ç½®å¤šä¸ª entry å®ç°ã€‚</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// webpack.config.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: {
    <span class="hljs-attr">main</span>: <span class="hljs-string">'./src/main.js'</span>,
    <span class="hljs-attr">vendor</span>: <span class="hljs-string">'./src/vendor.js'</span>, <span class="hljs-comment">// æ‰‹åŠ¨å¼•å…¥å…¬å…±ä¾èµ–</span>
  },
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'[name].[contenthash].js'</span>,
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>),
  },
};
</code></pre>
<blockquote>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>æ— æ³•è‡ªåŠ¨æå–å…¬å…±ä¾èµ–ï¼ˆæ¯”å¦‚ <code>main</code> å’Œ <code>vendor</code> éƒ½ç”¨äº† Lodashï¼Œä¼šé‡å¤æ‰“åŒ…ï¼‰</li>
<li>ç»´æŠ¤æˆæœ¬é«˜</li>
</ul>
</blockquote>
<p>ä¸Šé¢å†™çš„æ˜¯é€šç”¨é…ç½®ï¼Œä½†æˆ‘ä»¬åœ¨å…¬å¸ä¸€èˆ¬ä¼šåˆ†åˆ«é…ç½®å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®ã€‚å¤§å¤šæ•°é¡¹ç›®ä¸­ï¼Œ<code>entry</code> åœ¨ dev å’Œ prod åŸºæœ¬ä¸€è‡´ï¼Œæ— éœ€å·®å¼‚åŒ–é…ç½®ã€‚å·®å¼‚ä¸»è¦ä½“ç°åœ¨ <code>output</code> å’Œå…¶ä»–æ’ä»¶/åŠ è½½å™¨è¡Œä¸ºä¸Šã€‚</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// webpack.config.prod.js</span>
<span class="hljs-keyword">module</span>.<span class="hljs-keyword">exports</span> = {
  mode: <span class="hljs-string">'production'</span>,
  entry: <span class="hljs-string">'./src/index.js'</span>,
  output: {
    filename: <span class="hljs-string">'js/[name].[contenthash:8].js'</span>, <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒç”¨ [contenthash]ï¼ˆè€Œé [hash] æˆ– [chunkhash]ï¼‰ï¼Œç¡®ä¿ç²¾å‡†ç¼“å­˜</span>
    chunkFilename: <span class="hljs-string">'js/[name].[contenthash:8].js'</span>,
    path: path.resolve(__dirname, <span class="hljs-string">'dist'</span>), <span class="hljs-comment">// å¿…é¡»è¾“å‡ºåˆ°ç£ç›˜ç”¨äºéƒ¨ç½²</span>
    publicPath: <span class="hljs-string">'/static/'</span>, <span class="hljs-comment">// ç”¨äº CDN æˆ–é™æ€èµ„æºæœåŠ¡å™¨</span>
    clean: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ¸…ç†æ—§æ–‡ä»¶</span>
  },
};
<span class="hljs-comment">// webpack.config.dev.js</span>
<span class="hljs-keyword">module</span>.<span class="hljs-keyword">exports</span> = {
  mode: <span class="hljs-string">'development'</span>,
  entry: <span class="hljs-string">'./src/index.js'</span>,
  output: {
    filename: <span class="hljs-string">'js/[name].js'</span>,  <span class="hljs-comment">// å¼€å‘ç¯å¢ƒè‹¥åŠ  hashï¼Œæ¯æ¬¡ä¿å­˜éƒ½ä¼šç”Ÿæˆæ–°æ–‡ä»¶ï¼Œå¯èƒ½å¹²æ‰°çƒ­æ›´æ–°æˆ–è€…devtoolsæ··ä¹±</span>
    chunkFilename: <span class="hljs-string">'js/[name].js'</span>,
    path: path.resolve(__dirname, <span class="hljs-string">'dist'</span>), <span class="hljs-comment">// é€šå¸¸ä»å†™ distï¼Œä½†å®é™…ä¸å†™å…¥ç£ç›˜ï¼ˆwebpack-dev-server é»˜è®¤å†…å­˜å­˜å‚¨ï¼‰ï¼ŒèŠ‚çœIOï¼Œæé«˜ç¼–è¯‘é€Ÿåº¦</span>
    publicPath: <span class="hljs-string">'/'</span>, <span class="hljs-comment">// ä¸ devServer ä¸€è‡´</span>
    <span class="hljs-comment">// clean: false (é»˜è®¤)</span>
  },
};
</code></pre>
<h5 data-id="heading-5">2. <strong>SplitChunksPluginï¼ˆæ¨èï¼è‡ªåŠ¨ä»£ç åˆ†å‰²ï¼‰</strong></h5>
<p>è‡ªåŠ¨æå–å…¬å…±æ¨¡å—å’Œç¬¬ä¸‰æ–¹åº“ã€‚webpack å·²é»˜è®¤å®‰è£…ç›¸å…³æ’ä»¶ã€‚</p>
<p>é»˜è®¤è¡Œä¸ºï¼ˆä»…åœ¨ production æ¨¡å¼ç”Ÿæ•ˆï¼‰ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// webpack.config.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">splitChunks</span>: {
      <span class="hljs-attr">chunks</span>: <span class="hljs-string">'async'</span>, <span class="hljs-comment">// é»˜è®¤åªåˆ†å‰²å¼‚æ­¥æ¨¡å—</span>
    },
  },
};
</code></pre>
<p>å¸¸ç”¨é…ç½®ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// webpack.config.prod.js</span>
<span class="hljs-attr">optimization</span>: { 
  <span class="hljs-comment">// è‡ªåŠ¨åˆ†å‰²</span>
â€‹  â€‹<span class="hljs-comment">// https://twitter.com/wSokra/status/969633336732905474</span>
  <span class="hljs-comment">// https://medium.com/webpack/webpack-4-code-splitting-chunk-graph-and-the-splitchunks-optimization-be739a861366    </span>
  <span class="hljs-attr">splitChunks</span>: {
    <span class="hljs-comment">// chunks: async | initial(å¯¹é€šè¿‡çš„ä»£ç å¤„ç†) | all(åŒæ­¥+å¼‚æ­¥éƒ½å¤„ç†)</span>
    <span class="hljs-attr">chunks</span>: <span class="hljs-string">'initial'</span>,
    <span class="hljs-attr">minSize</span>: <span class="hljs-number">20000</span>, <span class="hljs-comment">// æ¨¡å—å¤§äº 20KB æ‰åˆ†å‰²ï¼ˆWebpack 5 é»˜è®¤å€¼ï¼‰</span>
    <span class="hljs-attr">maxSize</span>: <span class="hljs-number">244000</span>, <span class="hljs-comment">// å•ä¸ª chunk æœ€å¤§ä¸è¶…è¿‡ 244KBï¼ˆå¯é€‰ï¼‰</span>
    <span class="hljs-attr">cacheGroups</span>: { <span class="hljs-comment">// æ‹†åˆ†åˆ†ç»„è§„åˆ™</span>
      <span class="hljs-comment">// æå– node_modules ä¸­çš„ç¬¬ä¸‰æ–¹åº“</span>
      <span class="hljs-attr">vendor</span>: {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>, <span class="hljs-comment">// åŒ¹é…ç¬¦åˆè§„åˆ™çš„åŒ…</span>
        <span class="hljs-attr">name</span>: <span class="hljs-string">'vendors'</span>, <span class="hljs-comment">// æ‹†åˆ†åŒ…çš„name å±æ€§</span>
        <span class="hljs-attr">chunks</span>: <span class="hljs-string">'initial'</span>,
        <span class="hljs-attr">priority</span>: <span class="hljs-number">10</span>, <span class="hljs-comment">// ä¼˜å…ˆçº§é«˜äº default</span>
        <span class="hljs-attr">enforce</span>: <span class="hljs-literal">true</span>,
      },
      <span class="hljs-comment">// æå–å¤šä¸ª chunk å…¬å…±ä»£ç </span>
      <span class="hljs-attr">default</span>: {
        <span class="hljs-attr">minChunks</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// è‡³å°‘è¢« 2 ä¸ª chunk å¼•ç”¨</span>
        <span class="hljs-attr">priority</span>: -<span class="hljs-number">20</span>,
        <span class="hljs-attr">reuseExistingChunk</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¤ç”¨å·²å­˜åœ¨çš„ chunk</span>
        <span class="hljs-attr">maxInitialRequests</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// é»˜è®¤é™åˆ¶å¤ªå°ï¼Œæ— æ³•æ˜¾ç¤ºæ•ˆæœ</span>
        <span class="hljs-attr">minSize</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// è¿™ä¸ªç¤ºä¾‹å¤ªå°ï¼Œæ— æ³•åˆ›å»ºå…¬å…±å—</span>
      },
    },
  },
  <span class="hljs-comment">// runtimeç›¸å…³çš„ä»£ç æ˜¯å¦æŠ½å–åˆ°ä¸€ä¸ªå•ç‹¬çš„chunkä¸­ï¼Œæ¯”å¦‚importåŠ¨æ€åŠ è½½çš„ä»£ç å°±æ˜¯é€šè¿‡runtime ä»£ç å®Œæˆçš„</span>
  <span class="hljs-comment">// æŠ½ç¦»å‡ºæ¥åˆ©äºæµè§ˆå™¨ç¼“å­˜ï¼Œæ¯”å¦‚ä¿®æ”¹äº†ä¸šåŠ¡ä»£ç ï¼Œé‚£ä¹ˆruntimeåŠ è½½çš„chunkæ— éœ€é‡æ–°åŠ è½½</span>
  <span class="hljs-attr">runtimeChunk</span>: <span class="hljs-literal">true</span>,
}
</code></pre>
<p>åœ¨å¼€å‘ç¯å¢ƒä¸‹ <code>splitChunks: false,</code> å³å¯ã€‚</p>
<blockquote>
<p>ç”Ÿäº§ç¯å¢ƒï¼š</p>
<ul>
<li>ç”Ÿæˆ <code>vendors.xxxx.js</code>ï¼ˆç¬¬ä¸‰æ–¹åº“ï¼‰</li>
<li>ç”Ÿæˆ <code>default.xxxx.js</code>ï¼ˆé¡¹ç›®å…¬å…±ä»£ç ï¼‰</li>
<li>ä¸» bundle ä½“ç§¯æ˜¾è‘—å‡å°</li>
</ul>
</blockquote>
<h5 data-id="heading-6">3. <strong>åŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importsï¼‰â€”â€” æŒ‰éœ€åŠ è½½</strong></h5>
<p>ä½¿ç”¨ <code>import()</code> è¯­æ³•ï¼ˆç¬¦åˆ ES Module è§„èŒƒï¼‰ï¼Œå®ç°æ‡’åŠ è½½ã€‚</p>
<blockquote>
<p>Webpack ä¼šä¸ºæ¯ä¸ª <code>import()</code> åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ chunkï¼Œå¹¶è‡ªåŠ¨å¤„ç†åŠ è½½é€»è¾‘ã€‚</p>
</blockquote>
<h4 data-id="heading-7">ä¸‰ã€é­”æ³•æ³¨é‡Šï¼ˆMagic Commentsï¼‰â€”â€” æ§åˆ¶ chunk åç§°ç­‰è¡Œä¸º</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// è‡ªå®šä¹‰ chunk åç§°ï¼ˆä¾¿äºè°ƒè¯•å’Œé•¿æœŸç¼“å­˜ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(
  <span class="hljs-comment">/* webpackChunkName: "my-module" */</span>
  <span class="hljs-string">'./my-module'</span>
);
</code></pre>
<p>å…¶ä»–å¸¸è§æ³¨é‡Šï¼š</p>
<ul>
<li><code>/* webpackPrefetch: true */</code>ï¼šç©ºé—²æ—¶é¢„åŠ è½½ï¼ˆæå‡åç»­è®¿é—®é€Ÿåº¦ï¼‰</li>
<li><code>/* webpackPreload: true */</code>ï¼šå½“å‰å¯¼èˆªå…³é”®èµ„æºé¢„åŠ è½½ï¼ˆæ…ç”¨ï¼‰</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// é¢„åŠ è½½â€œä¸‹ä¸€ä¸ªå¯èƒ½è®¿é—®â€çš„é¡µé¢</span>
<span class="hljs-keyword">import</span>(
  <span class="hljs-comment">/* webpackChunkName: "login-page" */</span>
  <span class="hljs-comment">/* webpackPrefetch: true */</span>
  <span class="hljs-string">'./LoginPage'</span>
);
</code></pre>
<p>è¯¦ç»†æ¯”è¾ƒï¼š</p>
<ul>
<li>preload chunk ä¼šåœ¨çˆ¶ chunk åŠ è½½æ—¶ï¼Œä»¥å¹¶è¡Œæ–¹å¼å¼€å§‹åŠ è½½ã€‚prefetch chunk ä¼šåœ¨çˆ¶ chunk åŠ è½½ç»“æŸåå¼€å§‹åŠ è½½ã€‚</li>
<li>preload chunk å…·æœ‰ä¸­ç­‰ä¼˜å…ˆçº§ï¼Œå¹¶ç«‹å³ä¸‹è½½ã€‚prefetch chunk åœ¨æµè§ˆå™¨é—²ç½®æ—¶ä¸‹è½½ã€‚</li>
</ul>
<h3 data-id="heading-8">CND</h3>
<p>å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆContent Delivery Network æˆ– Content Distribution Networkï¼‰</p>
<p>å®ƒæ˜¯æŒ‡é€šè¿‡ç›¸äº’è¿æ¥çš„ç½‘ç»œç³»ç»Ÿï¼Œåˆ©ç”¨æœ€é è¿‘æ¯ä¸ªç”¨æˆ·çš„æœåŠ¡å™¨ï¼›æ›´å¿«ã€æ›´å¯é åœ°å°†éŸ³ä¹ã€å›¾ç‰‡ã€è§†é¢‘ã€åº”ç”¨ç¨‹åºåŠå…¶ä»–æ–‡ä»¶å‘é€ç»™ç”¨æˆ·ï¼›æä¾›é«˜æ€§èƒ½ã€å¯æ‰©å±•æ€§åŠä½æˆæœ¬çš„ç½‘ç»œå†…å®¹ä¼ é€’ã€‚</p>
<p>å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ CDN çš„ä¸»è¦æ–¹å¼æœ‰ä¸¤ç§ï¼š</p>
<ol>
<li>æ‰“åŒ…æ‰€æœ‰é™æ€èµ„æºï¼Œæ”¾åˆ° CDN æœåŠ¡å™¨ï¼Œç”¨æˆ·æ‰€æœ‰èµ„æºéƒ½æ˜¯é€šè¿‡ CND æœåŠ¡å™¨åŠ è½½çš„
<ol>
<li>é€šè¿‡ <code>output.publicPath</code> æ”¹ä¸ºè‡ªå·±çš„çš„ CDN æœåŠ¡å™¨ï¼Œæ‰“åŒ…åå°±å¯ä»¥ä»ä¸Šé¢è·å–èµ„æº</li>
<li>å¦‚æœæ˜¯è‡ªå·±çš„è¯ï¼Œä¸€èˆ¬ä¼šä»é˜¿é‡Œã€è…¾è®¯ç­‰ä¹° CDN æœåŠ¡å™¨ã€‚</li>
</ol>
</li>
<li>ä¸€äº›ç¬¬ä¸‰æ–¹èµ„æºæ”¾åœ¨ CDN æœåŠ¡å™¨ä¸Š
<ol>
<li>ä¸€äº›åº“/æ¡†æ¶ä¼šå°†æ‰“åŒ…åçš„æºç æ”¾åˆ°ä¸€äº›å…è´¹çš„ CDN ä¸Šï¼Œæ¯”å¦‚ JSDeliverã€bootcdn ç­‰</li>
<li>è¿™æ ·çš„è¯ï¼Œæ‰“åŒ…çš„æ—¶å€™å°±ä¸éœ€è¦å¯¹è¿™äº›åº“è¿›è¡Œæ‰“åŒ…ï¼Œç›´æ¥ä½¿ç”¨ CDN æœåŠ¡å™¨ä¸­çš„æºç ï¼ˆé€šè¿‡ externals é…ç½®æ’é™¤æŸäº›åŒ…ï¼‰</li>
</ol>
</li>
</ol>
<h3 data-id="heading-9">CSS æå–</h3>
<p>å°† css æå–åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ css æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-Plain" lang="Plain">npm install mini-css-extract-plugin -D
</code></pre>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// webpack.config.prod.js</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MiniCssExtractPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mini-css-extract-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'production'</span>,
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨ MiniCssExtractPlugin.loader</span>
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/i</span>,
        <span class="hljs-attr">use</span>: [
          <span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>, <span class="hljs-comment">// æ›¿æ¢ style-loader</span>
          <span class="hljs-string">'css-loader'</span>,
          <span class="hljs-string">'postcss-loader'</span>,
        ],
      },
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.s[ac]ss$/i</span>,
        <span class="hljs-attr">use</span>: [
          <span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>,
          <span class="hljs-string">'css-loader'</span>,
          <span class="hljs-string">'postcss-loader'</span>,
          <span class="hljs-string">'sass-loader'</span>,
        ],
      },
    ],
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>({
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'css/[name].[contenthash:8].css'</span>,
      <span class="hljs-attr">chunkFilename</span>: <span class="hljs-string">'css/[name].[contenthash:8].css'</span>,
    }),
  ],
};
</code></pre>
<h3 data-id="heading-10">Terser ä»£ç å‹ç¼©</h3>
<p>Terser å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‹ç¼©ã€ä¸‘åŒ–(æ··æ·†)æˆ‘ä»¬çš„ä»£ç ï¼Œè®©æˆ‘ä»¬çš„ bundle å˜å¾—æ›´å°ã€‚</p>
<blockquote>
<p>Terser æ˜¯ä¸€ä¸ªå•ç‹¬çš„å·¥å…·ï¼Œæ‹¥æœ‰éå¸¸å¤šçš„é…ç½®ï¼Œè¿™é‡Œæˆ‘ä»¬åªè®²å·¥ä½œä¸­å¦‚ä½•ä½¿ç”¨ï¼Œä»¥ä¸€ä¸ªå·¥ç¨‹çš„è§’åº¦å­¦ä¹ è¿™ä¸ªå·¥å…·ã€‚</p>
</blockquote>
<p>çœŸå®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨çš„é€šè¿‡ terser æ¥å¤„ç†æˆ‘ä»¬çš„ä»£ç ã€‚webpack ä¸­ minimizer å±æ€§ï¼Œåœ¨ production æ¨¡å¼ä¸‹ï¼Œé»˜è®¤å°±æ˜¯ä½¿ç”¨çš„ TerserPlugin æ¥å¤„ç†æˆ‘ä»¬ä»£ç çš„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»º TerserPlugin å®ä¾‹è¦†ç›–é»˜è®¤é…ç½®ã€‚</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// webpack.prod.js </span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">TerserPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'terser-webpack-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'production'</span>,
  <span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">minimizer</span>: [
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>({
        <span class="hljs-attr">parallel</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¤šæ ¸ CPU å¹¶è¡Œå‹ç¼©ï¼Œé»˜è®¤ä¸ºtrueï¼Œå¹¶å‘æ•°é»˜è®¤ä¸ºos.cpus().length-1</span>
        <span class="hljs-attr">terserOptions</span>: {
          <span class="hljs-attr">compress</span>: { <span class="hljs-comment">// å‹ç¼©é…ç½®</span>
            <span class="hljs-attr">drop_console</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">drop_debugger</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// åˆ é™¤debugger</span>
            <span class="hljs-attr">pure_funcs</span>: [<span class="hljs-string">'console.info'</span>, <span class="hljs-string">'console.debug'</span>], <span class="hljs-comment">// åªåˆ é™¤ç‰¹å®šçš„å‡½æ•°è°ƒç”¨</span>
          },
          <span class="hljs-attr">mangle</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ˜¯å¦ä¸‘åŒ–ä»£ç ï¼ˆå˜é‡ï¼‰</span>
          <span class="hljs-attr">toplevel</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// é¡¶å±‚å˜é‡æ˜¯å¦è¿›è¡Œè½¬æ¢</span>
          <span class="hljs-attr">keep_classnames</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ˜¯å¦ä¿ç•™ç±»çš„åç§°</span>
          <span class="hljs-attr">keep_fnames</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ˜¯å¦ä¿ç•™å‡½æ•°çš„åç§°</span>
          <span class="hljs-attr">format</span>: {
            <span class="hljs-attr">comments</span>: <span class="hljs-regexp">/@license|@preserve/i</span>, <span class="hljs-comment">// ä¿ç•™å« license/preserve çš„æ³¨é‡Šï¼ˆæŸäº›å¼€æºåº“è¦æ±‚ä¿ç•™ç‰ˆæƒæ³¨é‡Šï¼‰</span>
          },
        },
        <span class="hljs-attr">extractComments</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// é»˜è®¤ä¸ºtrueä¼šå°†æ³¨é‡Šæå–åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼ˆè¿™é‡Œç”¨äºä¿ç•™ç‰ˆæƒæ³¨é‡Šï¼‰ï¼Œfalseè¡¨ç¤ºä¸å¸Œæœ›ä¿ç•™æ³¨é‡Š</span>
        <span class="hljs-attr">sourceMap</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// éœ€è¦ webpack é…ç½® devtool ç”Ÿæˆ source map</span>
      }),
    ],
  },
};
</code></pre>
<blockquote>
<p>ä¸è¦åœ¨å¼€å‘ç¯å¢ƒå¯åŠ¨ terserï¼Œå› ä¸ºï¼š</p>
<ul>
<li>å‹ç¼©ä¼šæ‹–æ…¢æ„å»ºé€Ÿåº¦</li>
<li>æ··æ·†åçš„ä»£ç æ— æ³•è°ƒè¯•</li>
<li>hmr å’Œ source-map ä¼šå¤±æ•ˆ</li>
</ul>
</blockquote>
<h3 data-id="heading-11">CSS å‹ç¼©</h3>
<p>CSS å‹ç¼©é€šå¸¸æ˜¯å»é™¤æ— ç”¨çš„ç©ºæ ¼ç­‰ï¼Œå› ä¸ºå¾ˆéš¾å»ä¿®æ”¹é€‰æ‹©å™¨ã€å±æ€§çš„åç§°ã€å€¼ç­‰ï¼›æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨æ’ä»¶ <code>css-minimizer-webpack-plugin</code>ï¼›ä»–çš„åº•å±‚æ˜¯ä½¿ç”¨ cssnano å·¥å…·æ¥ä¼˜åŒ–ã€å‹ç¼© CSSï¼ˆä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨ï¼‰ã€‚</p>
<p>ä½¿ç”¨ä¹Ÿæ˜¯éå¸¸ç®€å•ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-attr">minimizer</span>: [
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">CssMiniMizerPlugin</span>()({
    <span class="hljs-attr">parallel</span>: <span class="hljs-literal">true</span>
  })
]
</code></pre>
<h3 data-id="heading-12">Tree Shaking æ‘‡æ ‘</h3>
<p>è¯¦æƒ…è§ä¹‹å‰æ–‡ç« ï¼šã€Šç®€å•èŠèŠ webpack æ‘‡æ ‘çš„åŸç†ã€‹</p>
<h3 data-id="heading-13">HTTP å‹ç¼©</h3>
<p>HTTP å‹ç¼©ï¼ˆHTTP Compressionï¼‰æ˜¯ä¸€ç§ <strong>åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´ä¼ è¾“æ•°æ®æ—¶å‡å°å“åº”ä½“ä½“ç§¯ â€‹</strong>çš„æŠ€æœ¯ï¼Œé€šè¿‡å‹ç¼© HTMLã€CSSã€JavaScriptã€JSON ç­‰æ–‡æœ¬èµ„æºï¼Œæ˜¾è‘—æå‡ç½‘é¡µåŠ è½½é€Ÿåº¦ã€èŠ‚çœå¸¦å®½ã€‚</p>
<h4 data-id="heading-14">ä¸€ã€ä¸»æµå‹ç¼©ç®—æ³•</h4>

































<table><thead><tr><th>ç®—æ³•</th><th>å…¼å®¹æ€§</th><th>å‹ç¼©ç‡</th><th>é€Ÿåº¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>gzip</strong></td><td>âœ… å‡ ä¹æ‰€æœ‰æµè§ˆå™¨ï¼ˆIE6+ï¼‰</td><td>é«˜</td><td>å¿«</td><td>â€‹<strong>æœ€å¹¿æ³›ä½¿ç”¨</strong>â€‹ï¼ŒWeb æ ‡å‡†æ¨è</td></tr><tr><td><strong>Brotli (br)</strong></td><td>âœ… ç°ä»£æµè§ˆå™¨ï¼ˆChrome 49+, Firefox 44+, Safari 11+ï¼‰</td><td>â­ æ›´é«˜ï¼ˆæ¯” gzip é«˜ 15%~30%ï¼‰</td><td>è¾ƒæ…¢ï¼ˆå‹ç¼©ï¼‰ï¼Œè§£å‹å¿«</td><td><strong>æ¨èç”¨äºé™æ€èµ„æº</strong></td></tr><tr><td><strong>deflate</strong></td><td>âš ï¸ æ”¯æŒä¸ä¸€è‡´ï¼ˆéƒ¨åˆ†æµè§ˆå™¨å®ç°æœ‰é—®é¢˜ï¼‰</td><td>ä¸­</td><td>ä¸­</td><td><strong>å·²åŸºæœ¬æ·˜æ±°ï¼Œä¸æ¨èä½¿ç”¨</strong></td></tr></tbody></table>
<h4 data-id="heading-15">äºŒã€å·¥ä½œåŸç†ï¼ˆåå•†å‹ç¼©ï¼‰</h4>
<p>HTTP å‹ç¼©åŸºäº è¯·æ±‚å¤´ â†” å“åº”å¤´åå•†æœºåˆ¶ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆè¡¨æ˜æ”¯æŒçš„å‹ç¼©æ ¼å¼ï¼‰</li>
</ol>
<pre><code class="hljs language-HTTP" lang="HTTP">GET /app.js HTTP/1.1
Host: example.com
Accept-Encoding: gzip, deflate, br // å®¢æˆ·ç«¯æ”¯æŒçš„å‹ç¼©ç®—æ³•åˆ—è¡¨
</code></pre>
<ol start="2">
<li>æœåŠ¡ç«¯å“åº”ï¼ˆè¿”å›å‹ç¼©åçš„å†…å®¹ï¼‰</li>
</ol>
<pre><code class="hljs language-HTTP" lang="HTTP">HTTP/1.1 200 OK
Content-Encoding: br  // æœåŠ¡ç«¯ä½¿ç”¨çš„å‹ç¼©ç®—æ³•
Content-Type: application/javascript
Content-Length: 102400  // æ³¨æ„ï¼šè¿™æ˜¯å‹ç¼©åçš„å¤§å°ï¼

...ï¼ˆäºŒè¿›åˆ¶å‹ç¼©æ•°æ®ï¼‰...
</code></pre>
<blockquote>
<ul>
<li>æµè§ˆå™¨è‡ªåŠ¨è§£å‹ï¼Œå¼€å‘è€…æ— æ„ŸçŸ¥</li>
</ul>
</blockquote>
<h4 data-id="heading-16">ä¸‰ã€å¦‚ä½•å¯ç”¨ HTTP å‹ç¼©ï¼Ÿ</h4>
<p>æˆ‘ä»¬ä¸€èˆ¬ä¼šä¼˜å…ˆä½¿ç”¨ Nginx é…ç½®åšå‹ç¼©ï¼ˆç”Ÿäº§ç¯å¢ƒæœ€å¸¸ç”¨ï¼‰ï¼Œè¿™æ ·å°±æ— éœ€åº”ç”¨å±‚å¤„ç†ã€‚</p>
<p><strong>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä¼šè¿›è¡Œé¢„å‹ç¼© + é™æ€æ–‡ä»¶æœåŠ¡ï¼Œè¿™ä¸»è¦å°±æ˜¯ webpack è¦åšçš„å·¥ä½œã€‚</strong></p>
<p>åœ¨æ„å»ºé˜¶æ®µï¼ˆWebpack/Viteï¼‰å°±ç”Ÿæˆ <code>.gz</code> å’Œ <code>.br</code> æ–‡ä»¶ï¼Œéƒ¨ç½²åˆ° CDN æˆ–é™æ€æœåŠ¡å™¨ã€‚</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// webpack.config.js</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CompressionPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'compression-webpack-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">// ç”Ÿæˆ .gz æ–‡ä»¶</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompressionPlugin</span>({
      <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'gzip'</span>,
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(js|css|html|svg)$/</span>,
      <span class="hljs-attr">threshold</span>: <span class="hljs-number">8192</span>, <span class="hljs-comment">// å¤§äº 8KB æ‰å‹ç¼©</span>
      <span class="hljs-attr">minRatio</span>: <span class="hljs-number">0.8</span>,  <span class="hljs-comment">// è‡³å°‘çš„å‹ç¼©æ¯”ä¾‹</span>
    }),
    <span class="hljs-comment">// ç”Ÿæˆ .br æ–‡ä»¶ï¼ˆéœ€é¢å¤–å®‰è£…ï¼‰</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompressionPlugin</span>({
      <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'brotliCompress'</span>,
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(js|css|html|svg)$/</span>,
      <span class="hljs-attr">compressionOptions</span>: { <span class="hljs-attr">level</span>: <span class="hljs-number">11</span> }, <span class="hljs-comment">// æœ€é«˜å‹ç¼©ç‡</span>
    }),
  ],
};
</code></pre>
<p>Nginx é…åˆé¢„å‹ç¼©æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-Nginx" lang="Nginx">gzip_static on;    # ä¼˜å…ˆè¿”å› .gz æ–‡ä»¶
brotli_static on;  # ä¼˜å…ˆè¿”å› .br æ–‡ä»¶
</code></pre>
<h3 data-id="heading-17">æ‰“åŒ…åˆ†æ</h3>
<h4 data-id="heading-18">æ‰“åŒ…æ—¶é—´åˆ†æ</h4>
<p>æˆ‘ä»¬éœ€è¦å€ŸåŠ©ä¸€ä¸ªæ’ä»¶ <code>speed-measure-webpack-plugin</code>ï¼Œå³å¯çœ‹åˆ°æ¯ä¸ª loaderã€æ¯ä¸ª plugin æ¶ˆè€—çš„æ‰“åŒ…æ—¶é—´ã€‚</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// webpack.config.js</span>
<span class="hljs-type">const</span> <span class="hljs-variable">SpeedMeasurePlugin</span> <span class="hljs-operator">=</span> require(<span class="hljs-string">'speed-measure-webpack-plugin'</span>);

<span class="hljs-type">const</span> <span class="hljs-variable">smp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpeedMeasurePlugin</span>();

<span class="hljs-type">const</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> {
  <span class="hljs-comment">// ä½ çš„æ­£å¸¸ Webpack é…ç½®</span>
  entry: <span class="hljs-string">'./src/index.js'</span>,
  <span class="hljs-keyword">module</span>: { <span class="hljs-comment">/* ... */</span> },
  plugins: [ <span class="hljs-comment">/* ... */</span> ],
};

<span class="hljs-comment">// ä»…å½“ç¯å¢ƒå˜é‡ ANALYZE_SPEED=1 æ—¶åŒ…è£¹é…ç½®</span>
<span class="hljs-keyword">module</span>.<span class="hljs-keyword">exports</span> = process.env.ANALYZE_SPEED ? smp.wrap(config) : config;
</code></pre>
<h4 data-id="heading-19">æ‰“åŒ…æ–‡ä»¶åˆ†æ</h4>
<h5 data-id="heading-20">æ–¹æ³•ä¸€ã€ç”Ÿæˆ stats.json æ–‡ä»¶</h5>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-string">"build:stats"</span>: <span class="hljs-string">"w--config ./config/webpack.common.js --env production --profile --json=stats.json"</span>,
</code></pre>
<p>è¿è¡Œ <code>npm run build:stats</code>ï¼Œå¯ä»¥è·å–åˆ°ä¸€ä¸ª stats.json æ–‡ä»¶ï¼Œç„¶åæ”¾åˆ°åˆ° <a href="https://link.juejin.cn?target=http%3A%2F%2Fwebpack.github.com%2Fanalyse" target="_blank" title="http://webpack.github.com/analyse" ref="nofollow noopener noreferrer">webpack.github.com/analyse</a> è¿›è¡Œåˆ†æã€‚</p>
<h5 data-id="heading-21">æ–¹æ³•äºŒã€webpack-bundle-analyzer</h5>
<p>æ›´å¸¸ç”¨çš„æ–¹å¼æ˜¯ä½¿ç”¨ webpack-bundle-analyzer æ’ä»¶åˆ†æã€‚</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// webpack.prod.js</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">BundleAnalyzerPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-bundle-analyzer'</span>).<span class="hljs-property">BundleAnalyzerPlugin</span>;

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'production'</span>,
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">// å…¶ä»–æ’ä»¶...</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">BundleAnalyzerPlugin</span>({
      <span class="hljs-attr">analyzerMode</span>: <span class="hljs-string">'static'</span>, <span class="hljs-comment">// ç”Ÿæˆé™æ€ HTML æŠ¥å‘Šï¼ˆé»˜è®¤ï¼‰</span>
      <span class="hljs-attr">openAnalyzer</span>: <span class="hljs-literal">false</span>,    <span class="hljs-comment">// ä¸è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨</span>
      <span class="hljs-attr">reportFilename</span>: <span class="hljs-string">'bundle-report.html'</span>,
      <span class="hljs-attr">generateStatsFile</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¯é€‰ï¼šåŒæ—¶ç”Ÿæˆ stats.json</span>
      <span class="hljs-attr">statsFilename</span>: <span class="hljs-string">'stats.json'</span>,
    }),
  ],
};
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¼šè®®é€é•œï¼ˆMeeting Lensï¼‰ï¼šåŸºäº Rokid CXR-M çš„ AI ä¼šè®®çºªè¦å®æˆ˜]]></title>    <link>https://juejin.cn/post/7577461079597826067</link>    <guid>https://juejin.cn/post/7577461079597826067</guid>    <pubDate>2025-11-28T07:14:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577461079597826067" data-draft-id="7577394906161610806" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¼šè®®é€é•œï¼ˆMeeting Lensï¼‰ï¼šåŸºäº Rokid CXR-M çš„ AI ä¼šè®®çºªè¦å®æˆ˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-28T07:14:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LibSept24_"/> <meta itemprop="url" content="https://juejin.cn/user/537031153027213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¼šè®®é€é•œï¼ˆMeeting Lensï¼‰ï¼šåŸºäº Rokid CXR-M çš„ AI ä¼šè®®çºªè¦å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/537031153027213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LibSept24_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T07:14:27.000Z" title="Fri Nov 28 2025 07:14:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘æƒ³åˆ†äº«ä¸€ä¸ªåŸºäº Rokid CXR-M SDK + å¤§æ¨¡å‹ï¼ˆASR <strong>+</strong> LLMï¼‰ æ‰“é€ çš„å®éªŒé¡¹ç›®â€”â€”ã€Œä¼šè®®é€é•œï¼ˆMeeting Lensï¼‰ã€ã€‚</p>
<p>ä½©æˆ´ Rokid AI çœ¼é•œè¿›å…¥ä¼šè®®å®¤ï¼Œä½ åªéœ€è¦æ­£å¸¸å‘è¨€ã€è®¨è®ºã€ä¸¾æ‰‹ã€ç‚¹å¤´ï¼›</p>
<p>ä¼šè®®ç»“æŸæ—¶ï¼š</p>
<ul>
<li>ç»“æ„åŒ–çºªè¦ï¼ˆè®®é¢˜ã€ç»“è®ºã€è¡ŒåŠ¨é¡¹ï¼‰å·²ç»ç”Ÿæˆ</li>
<li>å…³é”®å†³ç­–ç‰‡æ®µè‡ªåŠ¨é«˜äº®</li>
<li>ä¸‹ä¸€æ­¥ To-do ç›´æ¥æ¨é€åˆ°ä½ çš„æ‰‹æœº / åä½œå·¥å…·</li>
</ul>
<p>ç”šè‡³åœ¨ä¼šè®®è¿›è¡Œä¸­ï¼Œçœ¼é•œå·²ç»å®æ—¶æŠŠã€Œå½“å‰è®®é¢˜ã€ã€Œå¾…ç¡®è®¤äº‹é¡¹ã€æµ®ç°åœ¨ä½ çœ¼å‰ã€‚</p>
<p>ä¸‹é¢æˆ‘ä¼šå›´ç»• CXR-M SDK çš„çœŸå®èƒ½åŠ›ä¸æ¥å£*å±•å¼€ï¼Œä»ç¯å¢ƒé…ç½®ã€è®¾å¤‡è¿æ¥ã€éŸ³é¢‘æµé‡‡é›†ï¼Œåˆ°ç«¯äº‘ååŒçš„ AI å·¥ä½œæµï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ æè¯å™¨åœºæ™¯ + è‡ªå®šä¹‰é¡µé¢ï¼ˆCustom Viewï¼‰ï¼ŒæŠŠå®æ—¶è¦ç‚¹å’Œæœ€ç»ˆçºªè¦å›ä¼ åˆ°çœ¼é•œç«¯æ˜¾ç¤ºã€‚</p>
<h2 data-id="heading-0">ä»â€œåšç¬”è®°â€åˆ°â€œåªå¼€å£â€ï¼šä¼šè®®çºªè¦çš„é‡æ„</h2>
<h3 data-id="heading-1">1.1 ä¼ ç»Ÿä¼šè®®çºªè¦çš„ç“¶é¢ˆ</h3>
<p>å¤§å¤šæ•°äººçš„ä¼šè®®ä½“éªŒå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>ä¸€è¾¹å¬ï¼Œä¸€è¾¹è®°ï¼Œé”™è¿‡åˆ«äººè¯´äº†ä»€ä¹ˆ</li>
<li>ä¼šè®®ç»“æŸå †æ»¡è¯­éŸ³ã€ç…§ç‰‡ã€é›¶æ•£æ–‡æ¡£</li>
<li>çœŸæ­£æœ‰ç”¨çš„æ˜¯é‚£å‡ æ¡ï¼š<strong>å†³è®® &amp; è¡ŒåŠ¨é¡¹</strong> â€”â€” å´ååæœ€éš¾å®Œæ•´è®°å½•</li>
<li>è¿œç¨‹ / ç°åœºæ··åˆå¼€ä¼šæ—¶ï¼Œå¤šäººåŒæ—¶è¯´è¯ï¼Œå›æ”¾å’Œæ ‡æ³¨ååˆ†ç—›è‹¦</li>
</ul>
<p>ã€Œä¼šè®®é€é•œã€æƒ³æ”¹å˜çš„æ˜¯ï¼š</p>
<blockquote>
<p>è®©â€œä¼šè®®çºªè¦â€ä¸å†æ˜¯äººçš„è´Ÿæ‹…ï¼Œè€Œæ˜¯ AI çš„èŒè´£ã€‚ äººåªè´Ÿè´£ <strong>è¡¨è¾¾</strong> å’Œ <strong>å†³ç­–</strong>ï¼Œè®°å½•ã€æ•´ç†ã€åˆ†å‘å…¨éƒ¨è‡ªåŠ¨å®Œæˆã€‚</p>
</blockquote>
<h3 data-id="heading-2">1.2 ä¸ºä»€ä¹ˆé€‰æ‹© Rokid + CXR-M SDK æ¥åšä¼šè®®åŠ©æ‰‹</h3>
<p>è¦åšä¸€ä¸ªã€Œåªè¦æˆ´ä¸Šå°±èƒ½è‡ªåŠ¨åšçºªè¦ã€çš„ç³»ç»Ÿï¼Œéœ€è¦åŒæ—¶æ»¡è¶³ï¼š</p>
<ol>
<li>
<p><strong>ç¬¬ä¸€è§†è§’ &amp; å…æ‰‹æŒ</strong></p>
<ol>
<li>çœ¼é•œè‡ªå¸¦éº¦å…‹é£ï¼Œå¤©ç„¶è´´è¿‘å‘è¨€è€…</li>
<li>å±å¹•å°±åœ¨è§†é‡é‡Œï¼Œé€‚åˆå®æ—¶å±•ç¤ºè¦ç‚¹ã€æé†’ã€Œè¿˜æœ‰ä¸€ä¸ªè¡ŒåŠ¨é¡¹æ²¡ç¡®è®¤ã€</li>
</ol>
</li>
<li>
<p><strong>ç«¯äº‘ååŒèƒ½åŠ›</strong></p>
<ol>
<li>çœ¼é•œé€šè¿‡ <strong>è“ç‰™ / Wi-Fi</strong> ä¸æ‰‹æœºå»ºç«‹ç¨³å®šé“¾è·¯</li>
<li>æ‰‹æœºæœ‰å……è¶³ç®—åŠ›è·‘æœ¬åœ° ASR / å™ªå£°å¤„ç†</li>
<li>äº‘ç«¯å¤§æ¨¡å‹è´Ÿè´£é•¿æœŸè®°å¿†ã€å¤šè½®æ¨ç†ã€ç»“æ„åŒ–è¾“å‡º</li>
</ol>
</li>
</ol>
<p>Rokid çš„ <strong>CXR-Mï¼ˆMobile SDKï¼‰</strong> æ­£å¥½æä¾›äº†è¿™ä¸€æ•´å¥—åŸºç¡€è®¾æ–½ï¼š</p>
<ul>
<li>è“ç‰™æ‰«æä¸è¿æ¥ã€çŠ¶æ€ç®¡ç†</li>
<li>Wi-Fi P2P é«˜é€Ÿé“¾è·¯ï¼ˆé€‚åˆåŒæ­¥å½•éŸ³æ–‡ä»¶ã€ä¼šè®®å¤šåª’ä½“ï¼‰</li>
<li>çœ¼é•œç«¯éŸ³é¢‘æµé‡‡é›†ï¼ˆ<code>openAudioRecord</code> / <code>setAudioStreamListener</code>ï¼‰</li>
<li>AI åœºæ™¯äº‹ä»¶ç›‘å¬ï¼ˆ<code>AiEventListener</code>ï¼‰</li>
<li>æè¯å™¨ / ç¿»è¯‘ / è‡ªå®šä¹‰é¡µé¢ç­‰åœºæ™¯ï¼Œç”¨äºåœ¨çœ¼é•œä¸Šå±•ç¤ºæ–‡å­—ä¸ UI</li>
</ul>
<p>å¯¹ã€Œä¼šè®®é€é•œã€è¿™æ ·çš„é¡¹ç›®æ¥è¯´ï¼Œæœ€è‡ªç„¶çš„æ¶æ„æ˜¯ï¼š</p>
<ul>
<li><strong>çœ¼é•œï¼š</strong> é‡‡é›† &amp; æ˜¾ç¤º</li>
<li><strong>æ‰‹æœºï¼š</strong> é€šä¿¡ + AI å·¥ä½œæµï¼ˆASR + LLMï¼‰</li>
<li><strong>äº‘ç«¯ï¼š</strong> å¤§è§„æ¨¡æ¨¡å‹æ¨ç† &amp; é•¿æœŸå­˜å‚¨</li>
</ul>
<h2 data-id="heading-3">æ•´ä½“æ¶æ„ï¼šç«¯ â€“ äº‘ååŒçš„ã€Œä¼šè®®é€é•œã€</h2>
<p>å…ˆçœ‹ä¸€çœ¼ Meeting Lens çš„æ•°æ®æµï¼ˆåŠ ä¸€å¼ ç®€æ˜“æµç¨‹å›¾æ–¹ä¾¿è¯»è€…ç†è§£æ•´ä½“é“¾è·¯ï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[ç”¨æˆ·ä½©æˆ´ Rokid çœ¼é•œ]</span>
 Â  Â  Â   â”‚  <span class="hljs-number">1</span>. è®²è¯ / è®¨è®º
 Â  Â  Â   â–¼
<span class="hljs-selector-attr">[çœ¼é•œéº¦å…‹é£]</span>
 Â  Â  Â   â”‚  <span class="hljs-number">2</span>. éŸ³é¢‘æµï¼ˆè“ç‰™ï¼‰
 Â  Â  Â   â–¼
<span class="hljs-selector-attr">[CXR-M SDK @ æ‰‹æœº]</span>
 Â  Â  Â   â”‚  <span class="hljs-number">3</span>. AudioStreamListener æ¥æ”¶éŸ³é¢‘
 Â  Â  Â   â”‚ Â  Â  åˆ†æ®µ / é¢„å¤„ç†
 Â  Â  Â   â–¼
<span class="hljs-selector-attr">[MeetingLensManager @ æ‰‹æœº]</span>
 Â  Â  Â   â”‚  <span class="hljs-number">4</span>. è°ƒç”¨åç«¯ /asr/stream åšå®æ—¶è½¬å†™
 Â  Â  Â   â”‚ Â  Â  ç´¯ç§¯ transcript
 Â  Â  Â   â”‚  <span class="hljs-number">5</span>. å®šæ—¶è°ƒç”¨ /meeting/summarize åšä¸­é—´ &amp; æœ€ç»ˆçºªè¦
 Â  Â  Â   â–¼
<span class="hljs-selector-attr">[åç«¯ AI æœåŠ¡]</span>
 Â  Â  Â   â”‚  <span class="hljs-built_in">ASR</span>(Whisper/è®¯é£â€¦) + <span class="hljs-built_in">LLM</span>(å¤§æ¨¡å‹)
 Â  Â  Â   â”‚  è¾“å‡ºï¼š<span class="hljs-selector-tag">summary</span> / å†³ç­– / To-do
 Â  Â  Â   â–¼
<span class="hljs-selector-attr">[MeetingLensManager]</span>
 Â  Â  Â   â”‚  <span class="hljs-number">6</span>. é€šè¿‡ Custom View / æè¯å™¨
 Â  Â  Â   â”‚ Â  Â  æŠŠçºªè¦ &amp; TODO æ¨å›çœ¼é•œ
 Â  Â  Â   â–¼
<span class="hljs-selector-attr">[çœ¼é•œæ˜¾ç¤ºå±‚ï¼šMeeting View]</span>
 Â  Â  Â   â†’ å®æ—¶å±•ç¤ºè®®é¢˜ / ç»“è®º / è¡ŒåŠ¨é¡¹
</code></pre>
<h3 data-id="heading-4">2.1 ä¼šè®®ç°åœºé‡‡é›†</h3>
<ul>
<li>ä½©æˆ´ Rokid çœ¼é•œï¼Œå¯åŠ¨ã€Œä¼šè®®åŠ©æ‰‹ã€AI åœºæ™¯</li>
<li>çœ¼é•œç«¯éº¦å…‹é£å¯åŠ¨å½•éŸ³ï¼ŒéŸ³é¢‘æµé€šè¿‡ CXR-M å›ä¼ æ‰‹æœº</li>
</ul>
<h3 data-id="heading-5">2.2 ç«¯ä¾§é¢„å¤„ç†</h3>
<ul>
<li>æ‰‹æœºç«¯å¯¹éŸ³é¢‘åšé™å™ªã€VADï¼ˆåˆ†æ®µï¼‰ã€å¯èƒ½çš„è¯´è¯äººåˆ†ç¦»</li>
<li>åˆ†æ®µéŸ³é¢‘é€å¾€æœ¬åœ° / äº‘ç«¯ ASR æœåŠ¡ï¼ˆè‹±æ–‡ã€ä¸­æ–‡æˆ–å¤šè¯­ç§ï¼‰</li>
</ul>
<h3 data-id="heading-6">2.3 äº‘ç«¯ AI çºªè¦å¼•æ“</h3>
<ul>
<li>
<p>åŸºäº ASR æ–‡æœ¬ + è¯´è¯äººæ ‡ç­¾</p>
</li>
<li>
<p>ä½¿ç”¨ LLM åšï¼šé€æ®µæ€»ç»“ + ä¼šè®®ä¸­æœŸå°ç»“ + ä¼šåå…¨å±€æ€»ç»“</p>
</li>
<li>
<p>è¾“å‡ºç»“æ„åŒ–ç»“æœï¼š</p>
<ul>
<li>è®®é¢˜åˆ—è¡¨</li>
<li>è®¨è®ºè¿‡ç¨‹æ‘˜è¦</li>
<li>å†³ç­–</li>
<li>å¾…åŠï¼ˆOwner + æˆªæ­¢æ—¶é—´ï¼‰</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">2.4 ç»“æœå›ä¼  &amp; å®æ—¶æç¤º</h3>
<ul>
<li>
<p>ä¼šè®®è¿›è¡Œä¸­ï¼š</p>
<ul>
<li>å½“å‰è®®é¢˜ / åˆšåˆšè¯´çš„å…³é”®å¥è¢«é«˜äº®ä¸ºã€Œå€™é€‰å†³è®®ã€</li>
<li>ç»æ‰‹åŠ¨ç¡®è®¤åå›ºåŒ–ä¸ºå†³è®®</li>
<li>é€šè¿‡ <strong>æè¯å™¨</strong> <strong>/ Custom View</strong> å›ä¼ åˆ°çœ¼é•œæ˜¾ç¤º</li>
</ul>
</li>
<li>
<p>ä¼šè®®ç»“æŸï¼š</p>
<ul>
<li>æœ€ç»ˆçºªè¦å‘é€æ‰‹æœº App / é‚®ä»¶ / IM ç¾¤</li>
<li>çœ¼é•œå±å¹•å±•ç¤ºã€Œæœ¬æ¬¡ä¼šè®® X é¡¹å…³é”®å†³ç­– + Y ä¸ªè¡ŒåŠ¨é¡¹ã€</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">2.5 å¾ªç¯åˆ·æ–°</h3>
<ul>
<li>æ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªã€Œæ–°çš„è®®é¢˜å—ã€å¼€å§‹ï¼ˆé€šè¿‡ä¸»æŒäººè¯­å¥ã€å…³é”®è¯æˆ– UI äº¤äº’ï¼‰ï¼Œé‡å¯ä¸€è½® ASR + æ‘˜è¦ï¼Œä¿è¯ç»“æ„æ¸…æ™°ã€‚</li>
</ul>
<h2 data-id="heading-9">å¼€å‘ç¯å¢ƒä¸ CXR-M é›†æˆ</h2>
<h3 data-id="heading-10">3.1 åŸºç¡€ç¯å¢ƒ</h3>
<ul>
<li>Android Studio 2023.1+</li>
<li>Android æ‰‹æœºï¼ˆAndroid 9.0+ï¼‰</li>
<li>Rokid AR çœ¼é•œï¼ˆå¼€å¯å¼€å‘è€…æ¨¡å¼ï¼‰</li>
<li>JDK 8+</li>
<li>Kotlin 1.8+/1.9+ï¼ˆæœ¬æ–‡ä»£ç ä»¥ Kotlin ä¸ºä¸»ï¼‰</li>
</ul>
<h3 data-id="heading-11">3.2 æ·»åŠ  Rokid Maven ä»“åº“ä¸ CXR-M ä¾èµ–</h3>
<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼ŒCXR-M SDK å‘å¸ƒåœ¨ Rokid è‡ªæœ‰ Maven ä»“åº“ï¼Œéœ€è¦åœ¨ <code>settings.gradle.kts</code> é‡Œæ·»åŠ ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// settings.gradle.kts</span>
dependencyResolutionManagement {
 Â  Â repositoriesMode<span class="hljs-selector-class">.set</span>(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
 Â  Â repositories {
 Â  Â  Â  Â maven { url = <span class="hljs-built_in">uri</span>("https://maven.rokid.com/repository/maven-public/") }
 Â  Â  Â  Â <span class="hljs-built_in">google</span>()
 Â  Â  Â  Â <span class="hljs-built_in">mavenCentral</span>()
 Â   }
}
</code></pre>
<p>åœ¨ <code>app/build.gradle.kts</code> ä¸­å¼•å…¥ SDKï¼š</p>
<pre><code class="hljs language-ini" lang="ini">android {
 Â  Â <span class="hljs-attr">compileSdk</span> = <span class="hljs-number">34</span>
 Â  Â defaultConfig {
 Â  Â  Â  Â <span class="hljs-attr">applicationId</span> = <span class="hljs-string">"com.example.meetinglens"</span>
 Â  Â  Â  Â <span class="hljs-attr">minSdk</span> = <span class="hljs-number">28</span> Â  Â  Â  Â // CXR-M è¦æ±‚çš„æœ€å°ç‰ˆæœ¬
 Â  Â  Â  Â <span class="hljs-attr">targetSdk</span> = <span class="hljs-number">34</span>
 Â  Â  Â  Â <span class="hljs-attr">versionCode</span> = <span class="hljs-number">1</span>
 Â  Â  Â  Â <span class="hljs-attr">versionName</span> = <span class="hljs-string">"1.0"</span>
 Â   }
}
â€‹
dependencies {
 Â  Â implementation("com.rokid.cxr:client-m:1.0.1-20250812.080117-2")
 Â  Â // Retrofit / OkHttp / Gson ç­‰ç½‘ç»œä¾èµ–æŒ‰éœ€æ·»åŠ 
}
</code></pre>
<h3 data-id="heading-12">3.3 æƒé™ä¸åŠ¨æ€ç”³è¯·</h3>
<p>CXR-M æ¶‰åŠçš„æœ€å°æƒé™é›†åŒ…æ‹¬ï¼šè“ç‰™ã€Wi-Fiã€ç½‘ç»œç­‰ï¼Œå…¸å‹é…ç½®ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- AndroidManifest.xmlï¼ˆèŠ‚é€‰ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_COARSE_LOCATION"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_FINE_LOCATION"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.BLUETOOTH"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.BLUETOOTH_ADMIN"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.BLUETOOTH_CONNECT"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.BLUETOOTH_SCAN"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.CHANGE_NETWORK_STATE"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_WIFI_STATE"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.CHANGE_WIFI_STATE"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.INTERNET"</span> /&gt;</span>
<span class="hljs-comment">&lt;!-- å½•éŸ³æƒé™ï¼Œç”¨äºä¼šè®®éŸ³é¢‘é‡‡é›† --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.RECORD_AUDIO"</span> /&gt;</span>
</code></pre>
<p>è¿è¡Œæ—¶å»ºè®®ä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰å¿…è¦æƒé™ï¼ˆåŒ…æ‹¬ Android 12+ çš„ <code>BLUETOOTH_SCAN</code> / <code>BLUETOOTH_CONNECT</code>ï¼‰ï¼Œå†åˆå§‹åŒ– CXRï¼Œå¦åˆ™ SDK ä¼šç›´æ¥ä¸å¯ç”¨ã€‚</p>
<h2 data-id="heading-13">è®¾å¤‡æ¥å…¥ï¼šç”¨ CXR-M æ‰“é€šçœ¼é•œä¸æ‰‹æœº</h2>
<h3 data-id="heading-14">4.1 è“ç‰™æ‰«æä¸è¿æ¥</h3>
<p>å®˜æ–¹é€šå¸¸ä¼šæä¾›ä¸€ä¸ªè¾ƒå®Œæ•´çš„ <code>BluetoothHelper</code> ç¤ºä¾‹ï¼Œç”¨äºï¼š</p>
<ul>
<li>åŠ¨æ€ç”³è¯·è“ç‰™ç›¸å…³æƒé™</li>
<li>æ£€æµ‹è“ç‰™å¼€å…³çŠ¶æ€</li>
<li>æ‰«æ Rokid çœ¼é•œï¼ˆé€šè¿‡ç‰¹å®š Service UUID è¿‡æ»¤ï¼‰</li>
<li>ç»´æŠ¤å·²é…å¯¹ / å·²è¿æ¥è®¾å¤‡åˆ—è¡¨</li>
</ul>
<p>åœ¨ Meeting Lens ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¤ç”¨è¿™ä¸€å¥—é€»è¾‘ï¼Œæ‰«æä¸­é€šè¿‡ Service UUID è¿‡æ»¤ Rokid è®¾å¤‡ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ‰«ææ—¶ä½¿ç”¨ Rokid Glasses çš„ Service UUID è¿‡æ»¤</span>
ScanFilter<span class="hljs-selector-class">.Builder</span>()
 Â   <span class="hljs-selector-class">.setServiceUuid</span>(
 Â  Â  Â  Â ParcelUuid.fromString("<span class="hljs-number">00009100</span>-<span class="hljs-number">0000</span>-<span class="hljs-number">1000</span>-<span class="hljs-number">8000</span>-<span class="hljs-number">00805</span>f9b34fb")
 Â   )
 Â   <span class="hljs-selector-class">.build</span>()
</code></pre>
<p>æ‰¾åˆ°ç›®æ ‡è®¾å¤‡åï¼Œè°ƒç”¨ï¼š</p>
<ul>
<li><code>initBluetooth(context, device, callback)</code> å®Œæˆåˆå§‹åŒ–</li>
<li>åœ¨ <code>onConnectionInfo</code> è·å¾— <code>socketUuid</code> å’Œ <code>macAddress</code>ï¼Œå†è°ƒç”¨ <code>connectBluetooth()</code> å»ºç«‹é€šä¿¡</li>
</ul>
<h3 data-id="heading-15">4.2 Wi-Fi P2Pï¼šä¸ºå½•éŸ³æ–‡ä»¶å’Œé™„ä»¶ç•™å‡ºé€šé“</h3>
<p>ä¼šè®®ä¸­å¦‚æœéœ€è¦åŒæ­¥å®Œæ•´å½•éŸ³æ–‡ä»¶ã€æ¼”ç¤ºèµ„æ–™ã€æˆªå›¾ç­‰ï¼Œå¯ä»¥ä½¿ç”¨ Wi-Fi P2P æ¨¡å—ï¼š</p>
<ul>
<li>åˆå§‹åŒ–ï¼š<code>initWifiP2P(callback)</code></li>
<li>è·å–çŠ¶æ€ï¼š<code>isWifiP2PConnected</code></li>
<li>ååˆå§‹åŒ–ï¼š<code>deinitWifiP2P()</code></li>
</ul>
<p>ç­–ç•¥ä¸Šï¼š</p>
<ul>
<li>å®æ—¶ ASRï¼šèµ°è“ç‰™éŸ³é¢‘æµ</li>
<li>ä¼šåä¸Šä¼ å®Œæ•´å½•éŸ³ / åª’ä½“ï¼šèµ° Wi-Fi P2P + æ–‡ä»¶åŒæ­¥æ¥å£ï¼ˆå¦‚ <code>startSync</code> / <code>syncSingleFile</code>ï¼‰</li>
</ul>
<h2 data-id="heading-16">æ ¸å¿ƒé“¾è·¯ï¼šä»éŸ³é¢‘æµåˆ°ç»“æ„åŒ–ä¼šè®®çºªè¦</h2>
<h3 data-id="heading-17">5.1 è·å–çœ¼é•œç«¯éŸ³é¢‘æµï¼š<code>AudioStreamListener</code></h3>
<p>CXR-M æä¾›äº†ä¸€å¥—å®Œæ•´çš„å½•éŸ³æ¥å£ï¼š</p>
<ul>
<li>å¼€å¯å½•éŸ³ï¼š<code>openAudioRecord(codecType, streamType)</code></li>
<li>å…³é—­å½•éŸ³ï¼š<code>closeAudioRecord(streamType)</code></li>
<li>è®¾ç½®ç›‘å¬ï¼š<code>setAudioStreamListener(callback)</code></li>
</ul>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. è®¾ç½®éŸ³é¢‘æµç›‘å¬</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> audioStreamListener = <span class="hljs-keyword">object</span> : AudioStreamListener {
 Â  Â <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStartAudioStream</span><span class="hljs-params">(codecType: <span class="hljs-type">Int</span>, streamType: <span class="hljs-type">String</span>?)</span></span> {
 Â  Â  Â  Â <span class="hljs-comment">// ä¾‹å¦‚ streamType = "meeting"</span>
 Â  Â  Â  Â <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œé‡ç½®ç¼“å†²åŒºã€æ—¶é—´æˆ³ç­‰</span>
 Â   }
â€‹
 Â  Â <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onAudioStream</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">ByteArray</span>?, offset: <span class="hljs-type">Int</span>, length: <span class="hljs-type">Int</span>)</span></span> {
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-keyword">data</span> == <span class="hljs-literal">null</span> || length &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>
 Â  Â  Â  Â <span class="hljs-comment">// å°† PCM / Opus æ•°æ®æ¨å…¥æœ¬åœ° ASR Engine / å‘é€åˆ°äº‘ç«¯</span>
 Â  Â  Â  Â asrEngine.feed(<span class="hljs-keyword">data</span>, offset, length)
 Â   }
}
â€‹
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startMeetingAudioStream</span><span class="hljs-params">()</span></span> {
 Â  Â <span class="hljs-comment">// æ³¨å†Œç›‘å¬</span>
 Â  Â CxrApi.getInstance().setAudioStreamListener(audioStreamListener)
â€‹
 Â  Â <span class="hljs-comment">// å¼€å¯å½•éŸ³ï¼šcodecType: 1=PCM, 2=OPUSï¼ˆæŒ‰æ–‡æ¡£çº¦å®šï¼‰</span>
 Â  Â CxrApi.getInstance().openAudioRecord(
 Â  Â  Â  Â codecType = <span class="hljs-number">2</span>,
 Â  Â  Â  Â streamType = <span class="hljs-string">"meeting_assistant"</span>
 Â   )
}
â€‹
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">stopMeetingAudioStream</span><span class="hljs-params">()</span></span> {
 Â  Â CxrApi.getInstance().closeAudioRecord(<span class="hljs-string">"meeting_assistant"</span>)
 Â  Â CxrApi.getInstance().setAudioStreamListener(<span class="hljs-literal">null</span>)
}
</code></pre>
<p>è¿™ä¸€æ­¥å®Œæˆåï¼Œæˆ‘ä»¬å°±æŠŠã€Œçœ¼é•œä¸Šçš„éº¦å…‹é£ã€å˜æˆäº†ã€ŒAI ä¼šè®®çºªè¦ç³»ç»Ÿçš„è€³æœµã€ã€‚</p>
<h3 data-id="heading-18">5.2 ASR + è¯´è¯äººåˆ†ç¦»ï¼šæŠŠâ€œå£°â€å˜æˆâ€œè°è¯´äº†ä»€ä¹ˆâ€</h3>
<p>åœ¨ç«¯ / äº‘ä¾§ï¼Œå¯ä»¥ä½¿ç”¨ä½ ç†Ÿæ‚‰çš„ ASR å¼•æ“ï¼ˆå¦‚ Whisperã€è®¯é£ç­‰ï¼‰ï¼š</p>
<ul>
<li>å°† <code>onAudioStream</code> ä¸­çš„éŸ³é¢‘åˆ‡æˆ 1ï½2 ç§’ç‰‡æ®µ</li>
<li>é€å…¥æµå¼ ASR</li>
<li>å¯¹æ¯æ®µæ‰“ä¸Šæ—¶é—´æˆ³ï¼Œå¹¶ç»“åˆéº¦å…‹é£é˜µåˆ— / å¤–éƒ¨éº¦ / ä¼šè®®å®¤éº¦å…‹é£åš<strong>è¯´è¯äººåˆ†ç¦»</strong></li>
</ul>
<p>å¾—åˆ°çš„æ•°æ®ç»“æ„å¤§è‡´æ˜¯ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
 Â <span class="hljs-attr">"segments"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
 Â   <span class="hljs-punctuation">{</span>
 Â  Â  Â <span class="hljs-attr">"speaker"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Alice"</span><span class="hljs-punctuation">,</span>
 Â  Â  Â <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12.3</span><span class="hljs-punctuation">,</span>
 Â  Â  Â <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">18.7</span><span class="hljs-punctuation">,</span>
 Â  Â  Â <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æˆ‘ä»¬è¿™å­£åº¦çš„æ ¸å¿ƒç›®æ ‡æ˜¯æŠŠç•™å­˜æå‡åˆ° 35%ã€‚"</span>
 Â   <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-19">5.3 LLM çºªè¦å¼•æ“ï¼šä»æ–‡æœ¬åˆ°ç»“æ„åŒ–ç»“è®º</h3>
<p>åŸºäºä¸Šè¿° <code>segments</code>ï¼Œä½ å¯ä»¥è®¾è®¡å¤šå±‚æ¬¡æ€»ç»“æµç¨‹ï¼š</p>
<ol>
<li>
<p><strong>åˆ†æ®µæ‘˜è¦</strong></p>
<ol>
<li>æ¯ 2ï½3 åˆ†é’Ÿåšä¸€æ¬¡å°èŠ‚ï¼Œå¾—åˆ°â€œå½“å‰è®®é¢˜çš„å°ç»“â€</li>
</ol>
</li>
<li>
<p><strong>ä¼šè®®ä¸­æœŸå°ç»“</strong></p>
<ol>
<li>å½“ä¸»æŒäººåˆ‡æ¢è®®é¢˜æ—¶ï¼ˆâ€œé‚£ä¸‹é¢è®¨è®ºç¬¬äºŒä¸ªé—®é¢˜â€ï¼‰ï¼Œè§¦å‘ä¸€æ¬¡è‡ªç„¶æ®µæ€»ç»“</li>
</ol>
</li>
<li>
<p><strong>ä¼šåæ€»æ€»ç»“</strong></p>
<ol>
<li>
<p>èšåˆæ‰€æœ‰æ–‡æœ¬ + ä¸­é—´å°ç»“</p>
</li>
<li>
<p>æŒ‰å¦‚ä¸‹ç»“æ„è¾“å‡ºï¼š</p>
<ul>
<li>ä¼šè®®æ—¶é—´ / åœ°ç‚¹ / å‚ä¸è€…</li>
<li>è®®é¢˜åˆ—è¡¨</li>
<li>æ¯ä¸ªè®®é¢˜çš„ï¼šèƒŒæ™¯ / è®¨è®ºè¿‡ç¨‹ / ç»“è®º</li>
<li>å¾…åŠäº‹é¡¹ï¼ˆOwner + Deadline + çŠ¶æ€ï¼‰</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 data-id="heading-20">5.4 æŠŠå…³é”®è¦ç‚¹å›ä¼ åˆ°çœ¼é•œï¼šæè¯å™¨ + è‡ªå®šä¹‰é¡µé¢</h3>
<p>æ–¹å¼ä¸€ï¼šç”¨æè¯å™¨åœºæ™¯åšã€Œä¼šè®® TODO æ»šåŠ¨æ¡ã€</p>
<p>CXR-M æä¾›äº† æè¯å™¨ï¼ˆWord Tipsï¼‰åœºæ™¯ï¼Œå¯ä»¥ï¼š</p>
<ul>
<li>æ‰“å¼€ / å…³é—­åœºæ™¯ï¼š<code>controlScene(ValueUtil.CxrSceneType.WORD_TIPS, toOpen, null)</code></li>
<li>ç”¨ <code>sendStream(ValueUtil.CxrStreamType.WORD_TIPS, ...)</code> å‘é€æè¯å†…å®¹</li>
</ul>
<p>ä¾‹å¦‚ï¼ŒæŠŠå·²ç»ç¡®è®¤çš„è¡ŒåŠ¨é¡¹è½¬æˆä¸€æ®µæ¸…å•æ–‡æœ¬æ¨é€åˆ°çœ¼é•œï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">openTodosOnGlasses</span><span class="hljs-params">(text: <span class="hljs-type">String</span>, fileName: <span class="hljs-type">String</span> = <span class="hljs-string">"meeting_todos.txt"</span>)</span></span> {
 Â  Â <span class="hljs-comment">// æ‰“å¼€æè¯å™¨åœºæ™¯</span>
 Â  Â CxrApi.getInstance().controlScene(
 Â  Â  Â  Â ValueUtil.CxrSceneType.WORD_TIPS,
 Â  Â  Â  Â <span class="hljs-literal">true</span>,
 Â  Â  Â  Â <span class="hljs-literal">null</span>
 Â   )
â€‹
 Â  Â <span class="hljs-comment">// å‘é€æ–‡å­—å†…å®¹</span>
 Â  Â CxrApi.getInstance().sendStream(
 Â  Â  Â  Â ValueUtil.CxrStreamType.WORD_TIPS,
 Â  Â  Â  Â text.toByteArray(),
 Â  Â  Â  Â fileName,
 Â  Â  Â  Â <span class="hljs-keyword">object</span> : SendStatusCallback {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSendSucceed</span><span class="hljs-params">()</span></span> { }
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSendFailed</span><span class="hljs-params">(code: <span class="hljs-type">ValueUtil</span>.<span class="hljs-type">CxrSendErrorCode</span>?)</span></span> { }
 Â  Â  Â   }
 Â   )
}
</code></pre>
<p>å†é…åˆ <code>configWordTipsText</code> è°ƒæ•´å­—å·ã€è¡Œè·ã€æ˜¾ç¤ºåŒºåŸŸï¼Œå¯ä»¥æŠŠã€Œå…³é”® TODOã€åƒå­—å¹•ä¸€æ ·æ»šåŠ¨åœ¨è§†é‡è¾¹ç¼˜ã€‚</p>
<p><strong>æ–¹å¼äºŒï¼šç”¨ Custom View åšã€Œå®æ—¶ä¼šè®®çŠ¶æ€å¡ç‰‡ã€</strong></p>
<p>è‡ªå®šä¹‰é¡µé¢ï¼ˆCustom Viewï¼‰å…è®¸ç”¨ JSON æè¿°ä¸€ä¸ªç•Œé¢ï¼ŒåŒ…å« <code>TextView</code> / <code>ImageView</code> / <code>LinearLayout</code> / <code>RelativeLayout</code> ç­‰æ§ä»¶ï¼Œçœ¼é•œç«¯ä¼šæ ¹æ® JSON æ¸²æŸ“ã€‚</p>
<p>å…¸å‹ç”¨æ³•ï¼š</p>
<ol>
<li>æ‰“å¼€ç•Œé¢ï¼š<code>openCustomView(content)</code></li>
<li>æ›´æ–°ï¼š<code>updateCustomView(content)</code></li>
<li>ç›‘å¬çŠ¶æ€ï¼š<code>setCustomViewListener(listener)</code></li>
</ol>
<p>ä¾‹å¦‚æ„å»ºä¸€ä¸ªç®€å•çš„ã€Œä¼šè®®çŠ¶æ€å¡ç‰‡ã€ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"LinearLayout"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"props"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"layout_width"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"match_parent"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"layout_height"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"wrap_content"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"orientation"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vertical"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"backgroundColor"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#80000000"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"paddingTop"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8dp"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"paddingBottom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8dp"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"TextView"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"props"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tv_topic"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å½“å‰è®®é¢˜ï¼šQ3 ç•™å­˜ç›®æ ‡"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"textSize"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"14sp"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"textColor"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#FFFFFFFF"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"textStyle"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bold"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"TextView"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"props"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tv_highlight"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Aliceï¼šæˆ‘ä»¬éœ€è¦æŠŠäº§å“å†…æ¨èä½“ç³»é‡æ„ä¸€éã€‚"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"textSize"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"12sp"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"textColor"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#FFDDDDDD"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"marginTop"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4dp"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"TextView"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"props"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tv_todos"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¡ŒåŠ¨é¡¹ï¼š3 æ¡ï¼ˆç‚¹å¤´ç¡®è®¤å¯è®°ä¸ºå·²è®¤é¢†ï¼‰"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"textSize"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"12sp"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"textColor"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#FF00FF00"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"marginTop"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4dp"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç”¨ <code>openCustomView()</code> æ¨é€ä¸€æ¬¡ï¼Œåç»­åªéœ€ç”¨ <code>updateCustomView()</code> æ”¹ <code>tv_topic</code> / <code>tv_highlight</code> / <code>tv_todos</code> çš„ <code>text</code> å³å¯ã€‚</p>
<h2 data-id="heading-21">å®æˆ˜ï¼šåŸºäº CXR-M çš„ Meeting Lens å¼€å‘å®è·µï¼ˆå«å®Œæ•´ä»£ç ï¼‰</h2>
<h3 data-id="heading-22">6.1 å®æˆ˜ç›®æ ‡</h3>
<p>å®ç°ä¸€ä¸ª <code>MeetingLensManager</code>ï¼š</p>
<ul>
<li>
<p><code>startMeeting()</code>ï¼š</p>
<ul>
<li>å¼€å¯çœ¼é•œç«¯å½•éŸ³ï¼ˆ<code>openAudioRecord</code>ï¼‰</li>
<li>æ³¨å†Œ <code>AudioStreamListener</code> æ¥æ”¶éŸ³é¢‘æµ</li>
<li>æ‰“å¼€ Custom Viewï¼Œåœ¨çœ¼é•œä¸Šæ˜¾ç¤ºã€Œä¼šè®®çºªè¦ç”Ÿæˆä¸­ã€</li>
<li>å¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš” N ç§’æŠŠå½“å‰æ–‡æœ¬å‘ç»™åç«¯åšä¸­é—´æ€»ç»“</li>
</ul>
</li>
<li>
<p><code>stopMeeting()</code>ï¼š</p>
<ul>
<li>å…³é—­å½•éŸ³</li>
<li>åœæ­¢å®šæ—¶ä»»åŠ¡</li>
<li>æŠŠå®Œæ•´ transcript å‘é€ç»™åç«¯ï¼Œç”Ÿæˆæœ€ç»ˆçºªè¦</li>
<li>æŠŠæœ€ç»ˆçºªè¦å›ä¼ çœ¼é•œæ˜¾ç¤º</li>
</ul>
</li>
</ul>
<h3 data-id="heading-23">6.2 MeetingLensManager æ ¸å¿ƒç±»ï¼ˆå®Œæ•´ä»£ç ï¼‰</h3>
<blockquote>
<p>ä¸‹é¢è¿™æ®µ Kotlin ä»£ç å¯ä»¥ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼Œè®°å¾—æŠŠ <code>https://your.backend.com/...</code> æ¢æˆä½ è‡ªå·±çš„æœåŠ¡åœ°å€ã€‚</p>
</blockquote>
<pre><code class="hljs language-scss" lang="scss">package com<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.meetinglens</span>

import android<span class="hljs-selector-class">.content</span><span class="hljs-selector-class">.Context</span>
import android<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Base64</span>
import android<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Log</span>
import androidx<span class="hljs-selector-class">.lifecycle</span><span class="hljs-selector-class">.LifecycleOwner</span>
import androidx<span class="hljs-selector-class">.lifecycle</span><span class="hljs-selector-class">.lifecycleScope</span>
import com<span class="hljs-selector-class">.rokid</span><span class="hljs-selector-class">.cxr</span><span class="hljs-selector-class">.client</span><span class="hljs-selector-class">.m</span><span class="hljs-selector-class">.CxrApi</span>
import com<span class="hljs-selector-class">.rokid</span><span class="hljs-selector-class">.cxr</span><span class="hljs-selector-class">.client</span><span class="hljs-selector-class">.m</span><span class="hljs-selector-class">.callback</span><span class="hljs-selector-class">.AudioStreamListener</span>
import com<span class="hljs-selector-class">.rokid</span><span class="hljs-selector-class">.cxr</span><span class="hljs-selector-class">.client</span><span class="hljs-selector-class">.m</span><span class="hljs-selector-class">.callback</span><span class="hljs-selector-class">.CustomViewListener</span>
import com<span class="hljs-selector-class">.rokid</span><span class="hljs-selector-class">.cxr</span><span class="hljs-selector-class">.client</span><span class="hljs-selector-class">.m</span><span class="hljs-selector-class">.utils</span><span class="hljs-selector-class">.ValueUtil</span>
import kotlinx<span class="hljs-selector-class">.coroutines</span>.*
import okhttp3<span class="hljs-selector-class">.MediaType</span><span class="hljs-selector-class">.Companion</span><span class="hljs-selector-class">.toMediaType</span>
import okhttp3<span class="hljs-selector-class">.OkHttpClient</span>
import okhttp3<span class="hljs-selector-class">.Request</span>
import okhttp3<span class="hljs-selector-class">.RequestBody</span><span class="hljs-selector-class">.Companion</span><span class="hljs-selector-class">.toRequestBody</span>
import org<span class="hljs-selector-class">.json</span><span class="hljs-selector-class">.JSONObject</span>

<span class="hljs-comment">/**
 * MeetingLensManagerï¼šä¼šè®®é€é•œæ ¸å¿ƒæ§åˆ¶ç±»
 * - æ§åˆ¶å½•éŸ³
 * - è°ƒç”¨åç«¯ ASR / LLM
 * - å°†çºªè¦ç»“æœé€šè¿‡ Custom View æ˜¾ç¤ºåœ¨çœ¼é•œä¸Š
 */</span>
class <span class="hljs-built_in">MeetingLensManager</span>(
    private val context: Context,
    private val owner: LifecycleOwner
) {

    companion <span class="hljs-selector-tag">object</span> {
        private const val TAG = "MeetingLens"
        private const val STREAM_TYPE = "meeting_assistant"
    }

    private val httpClient = <span class="hljs-built_in">OkHttpClient</span>()
    private val transcriptBuffer = <span class="hljs-built_in">StringBuilder</span>()
    private <span class="hljs-selector-tag">var</span> running = false
    private <span class="hljs-selector-tag">var</span> summaryJob: Job? = null

    // <span class="hljs-number">1</span>. éŸ³é¢‘æµç›‘å¬å™¨
    private val audioStreamListener = object : AudioStreamListener {
        override fun <span class="hljs-built_in">onStartAudioStream</span>(codecType: Int, streamType: String?) {
            Log<span class="hljs-selector-class">.d</span>(TAG, "Audio stream started: codec=$codecType, type=$streamType")
            transcriptBuffer<span class="hljs-selector-class">.clear</span>()
        }

        override fun <span class="hljs-built_in">onAudioStream</span>(data: ByteArray?, offset: Int, length: Int) {
            if (data == null || length &lt;= <span class="hljs-number">0</span>) return
            val chunk = data<span class="hljs-selector-class">.copyOfRange</span>(offset, offset + length)
            owner<span class="hljs-selector-class">.lifecycleScope</span><span class="hljs-selector-class">.launch</span>(Dispatchers.IO) {
                <span class="hljs-built_in">sendAudioChunkToAsr</span>(chunk)
            }
        }
    }

    <span class="hljs-comment">// 2. Custom View çŠ¶æ€ç›‘å¬ï¼ˆå¯é€‰ï¼‰</span>
    private val customViewListener = <span class="hljs-selector-tag">object</span> : CustomViewListener {
        override fun <span class="hljs-built_in">onOpened</span>() {
            Log<span class="hljs-selector-class">.d</span>(TAG, "CustomView opened")
        }

        override fun <span class="hljs-built_in">onClosed</span>() {
            Log<span class="hljs-selector-class">.d</span>(TAG, "CustomView closed")
        }

        override fun <span class="hljs-built_in">onOpenFailed</span>(code: Int) {
            Log<span class="hljs-selector-class">.e</span>(TAG, "CustomView open failed: $code")
        }

        override fun <span class="hljs-built_in">onIconsSent</span>() {}
        override fun <span class="hljs-built_in">onUpdated</span>() {}
    }

    <span class="hljs-comment">// ====================== å¤–éƒ¨è°ƒç”¨æ¥å£ ======================</span>

    <span class="hljs-comment">/** å¼€å§‹ä¸€åœºä¼šè®® */</span>
    fun <span class="hljs-built_in">startMeeting</span>() {
        if (running) return
        running = true
        Log<span class="hljs-selector-class">.i</span>(TAG, "startMeeting()")

        <span class="hljs-comment">// 1. è®¾ç½®éŸ³é¢‘ç›‘å¬</span>
        CxrApi<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.setAudioStreamListener</span>(audioStreamListener)

        <span class="hljs-comment">// 2. å¼€å¯å½•éŸ³ï¼š2 = OPUS ç¼–ç </span>
        CxrApi<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.openAudioRecord</span>(<span class="hljs-number">2</span>, STREAM_TYPE)

        <span class="hljs-comment">// 3. æ‰“å¼€çœ¼é•œç«¯ä¼šè®®é¡µé¢</span>
        <span class="hljs-built_in">openMeetingView</span>()

        <span class="hljs-comment">// 4. è®¾ç½® Custom View ç›‘å¬ï¼ˆè°ƒè¯•ç”¨ï¼‰</span>
        CxrApi<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.setCustomViewListener</span>(customViewListener)

        <span class="hljs-comment">// 5. å®šæ—¶è¿›è¡Œä¸­é—´æ€»ç»“</span>
        summaryJob = owner<span class="hljs-selector-class">.lifecycleScope</span><span class="hljs-selector-class">.launch</span>(Dispatchers.IO) {
            while (running) {
                <span class="hljs-built_in">delay</span>(<span class="hljs-number">15</span>_000L) <span class="hljs-comment">// æ¯ 15 ç§’æ€»ç»“ä¸€æ¬¡</span>
                val text = transcriptBuffer<span class="hljs-selector-class">.toString</span>()
                if (text.isBlank()) continue
                val midSummary = <span class="hljs-built_in">summarizeOnBackend</span>(text, final = false)
                if (midSummary.isNotBlank()) {
                    <span class="hljs-built_in">updateSummaryOnGlasses</span>("ä¸­é—´å°ç»“ï¼š\n$midSummary")
                }
            }
        }

        <span class="hljs-built_in">updateSummaryOnGlasses</span>("çºªè¦ç”Ÿæˆä¸­ï¼Œè¯·è‡ªç„¶å‘è¨€â€¦")
    }

    <span class="hljs-comment">/** ç»“æŸä¼šè®® */</span>
    fun <span class="hljs-built_in">stopMeeting</span>() {
        if (!running) return
        running = false
        Log<span class="hljs-selector-class">.i</span>(TAG, "stopMeeting()")

        <span class="hljs-comment">// 1. åœæ­¢å½•éŸ³</span>
        CxrApi<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.closeAudioRecord</span>(STREAM_TYPE)
        CxrApi<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.setAudioStreamListener</span>(null)

        <span class="hljs-comment">// 2. åœæ­¢ä¸­é—´æ€»ç»“ä»»åŠ¡</span>
        summaryJob?<span class="hljs-selector-class">.cancel</span>()
        summaryJob = null

        <span class="hljs-comment">// 3. è°ƒç”¨åç«¯ç”Ÿæˆæœ€ç»ˆçºªè¦</span>
        owner<span class="hljs-selector-class">.lifecycleScope</span><span class="hljs-selector-class">.launch</span>(Dispatchers.IO) {
            val finalText = transcriptBuffer<span class="hljs-selector-class">.toString</span>()
            val finalSummary = <span class="hljs-built_in">summarizeOnBackend</span>(finalText, final = true)
            if (finalSummary.isNotBlank()) {
                <span class="hljs-built_in">updateSummaryOnGlasses</span>("ã€æœ¬æ¬¡ä¼šè®®æœ€ç»ˆçºªè¦ã€‘\n$finalSummary")
            } else {
                <span class="hljs-built_in">updateSummaryOnGlasses</span>("æœ¬æ¬¡ä¼šè®®çºªè¦ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–åç«¯æœåŠ¡")
            }
        }
    }

    <span class="hljs-comment">// ====================== ä¸åç«¯äº¤äº’ ======================</span>

    <span class="hljs-comment">/** å°†éŸ³é¢‘åˆ‡ç‰‡å‘é€åˆ° ASR åç«¯ï¼Œè·å– partial_text */</span>
    private fun <span class="hljs-built_in">sendAudioChunkToAsr</span>(chunk: ByteArray) {
        try {
            val base64 = Base64<span class="hljs-selector-class">.encodeToString</span>(chunk, Base64.NO_WRAP)
            val json = <span class="hljs-built_in">JSONObject</span>()<span class="hljs-selector-class">.apply</span> {
                <span class="hljs-built_in">put</span>("audio_base64", base64)
                <span class="hljs-built_in">put</span>("stream_type", STREAM_TYPE)
            }<span class="hljs-selector-class">.toString</span>()

            val request = Request<span class="hljs-selector-class">.Builder</span>()
                <span class="hljs-selector-class">.url</span>("https://your.backend.com/asr/stream") <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> æ›¿æ¢ä¸ºä½ çš„ ASR æ¥å£</span>
                <span class="hljs-selector-class">.post</span>(json.toRequestBody("application/json".toMediaType()))
                <span class="hljs-selector-class">.build</span>()

            httpClient<span class="hljs-selector-class">.newCall</span>(request)<span class="hljs-selector-class">.execute</span>()<span class="hljs-selector-class">.use</span> { resp -&gt;
                if (!resp.isSuccessful) return
                val <span class="hljs-selector-tag">body</span> = resp<span class="hljs-selector-class">.body</span>?<span class="hljs-selector-class">.string</span>()<span class="hljs-selector-class">.orEmpty</span>()
                if (body.isBlank()) return
                val obj = <span class="hljs-built_in">JSONObject</span>(body)
                val partial = obj<span class="hljs-selector-class">.optString</span>("partial_text", "")
                if (partial.isNotBlank()) {
                    transcriptBuffer<span class="hljs-selector-class">.append</span>(partial)<span class="hljs-selector-class">.append</span>('\n')
                }
            }
        } catch (e: Exception) {
            Log<span class="hljs-selector-class">.e</span>(TAG, "sendAudioChunkToAsr error: ${e.message}", e)
        }
    }

    <span class="hljs-comment">/** è°ƒç”¨ LLM åç«¯è¿›è¡Œçºªè¦æ€»ç»“ */</span>
    private fun <span class="hljs-built_in">summarizeOnBackend</span>(text: String, final: Boolean): String {
        if (text.isBlank()) return ""
        return try {
            val json = <span class="hljs-built_in">JSONObject</span>()<span class="hljs-selector-class">.apply</span> {
                <span class="hljs-built_in">put</span>("transcript", text)
                <span class="hljs-built_in">put</span>("final", final) <span class="hljs-comment">// final=true ä½¿ç”¨æ›´é‡æ¨¡å‹</span>
            }<span class="hljs-selector-class">.toString</span>()

            val request = Request<span class="hljs-selector-class">.Builder</span>()
                <span class="hljs-selector-class">.url</span>("https://your.backend.com/meeting/summarize") <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> æ›¿æ¢ä¸ºä½ çš„ Summary æ¥å£</span>
                <span class="hljs-selector-class">.post</span>(json.toRequestBody("application/json".toMediaType()))
                <span class="hljs-selector-class">.build</span>()

            httpClient<span class="hljs-selector-class">.newCall</span>(request)<span class="hljs-selector-class">.execute</span>()<span class="hljs-selector-class">.use</span> { resp -&gt;
                if (!resp.isSuccessful) return ""
                val <span class="hljs-selector-tag">body</span> = resp<span class="hljs-selector-class">.body</span>?<span class="hljs-selector-class">.string</span>()<span class="hljs-selector-class">.orEmpty</span>()
                if (body.isBlank()) return ""
                val obj = <span class="hljs-built_in">JSONObject</span>(body)
                obj<span class="hljs-selector-class">.optString</span>("summary", "")
            }
        } catch (e: Exception) {
            Log<span class="hljs-selector-class">.e</span>(TAG, "summarizeOnBackend error: ${e.message}", e)
            ""
        }
    }

    <span class="hljs-comment">// ====================== çœ¼é•œç«¯ UIï¼šCustom View ======================</span>

    <span class="hljs-comment">/** æ‰“å¼€ä¼šè®®é€é•œçš„åŸºç¡€é¡µé¢ */</span>
    private fun <span class="hljs-built_in">openMeetingView</span>() {
        val pageJson = """
        {
          "type": <span class="hljs-string">"LinearLayout"</span>,
          <span class="hljs-string">"props"</span>: {
            "id": <span class="hljs-string">"root_layout"</span>,
            <span class="hljs-string">"layout_width"</span>: <span class="hljs-string">"match_parent"</span>,
            <span class="hljs-string">"layout_height"</span>: <span class="hljs-string">"match_parent"</span>,
            <span class="hljs-string">"orientation"</span>: <span class="hljs-string">"vertical"</span>,
            <span class="hljs-string">"gravity"</span>: <span class="hljs-string">"top"</span>,
            <span class="hljs-string">"paddingTop"</span>: <span class="hljs-string">"40dp"</span>,
            <span class="hljs-string">"paddingStart"</span>: <span class="hljs-string">"12dp"</span>,
            <span class="hljs-string">"paddingEnd"</span>: <span class="hljs-string">"12dp"</span>,
            <span class="hljs-string">"backgroundColor"</span>: <span class="hljs-string">"#80000000"</span>
          },
          "children": [
            {
              "type": <span class="hljs-string">"TextView"</span>,
              <span class="hljs-string">"props"</span>: {
                "id": <span class="hljs-string">"tv_title"</span>,
                <span class="hljs-string">"layout_width"</span>: <span class="hljs-string">"wrap_content"</span>,
                <span class="hljs-string">"layout_height"</span>: <span class="hljs-string">"wrap_content"</span>,
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"ä¼šè®®é€é•œ Â· Meeting Lens"</span>,
                <span class="hljs-string">"textSize"</span>: <span class="hljs-string">"16sp"</span>,
                <span class="hljs-string">"textColor"</span>: <span class="hljs-string">"#FFFFFFFF"</span>,
                <span class="hljs-string">"textStyle"</span>: <span class="hljs-string">"bold"</span>,
                <span class="hljs-string">"marginBottom"</span>: <span class="hljs-string">"8dp"</span>
              }
            },
            {
              "type": <span class="hljs-string">"TextView"</span>,
              <span class="hljs-string">"props"</span>: {
                "id": <span class="hljs-string">"tv_summary"</span>,
                <span class="hljs-string">"layout_width"</span>: <span class="hljs-string">"match_parent"</span>,
                <span class="hljs-string">"layout_height"</span>: <span class="hljs-string">"wrap_content"</span>,
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"çºªè¦ç”Ÿæˆä¸­ï¼Œè¯·è‡ªç„¶å‘è¨€â€¦"</span>,
                <span class="hljs-string">"textSize"</span>: <span class="hljs-string">"12sp"</span>,
                <span class="hljs-string">"textColor"</span>: <span class="hljs-string">"#FFDDDDDD"</span>
              }
            },
            {
              "type": <span class="hljs-string">"TextView"</span>,
              <span class="hljs-string">"props"</span>: {
                "id": <span class="hljs-string">"tv_hint"</span>,
                <span class="hljs-string">"layout_width"</span>: <span class="hljs-string">"wrap_content"</span>,
                <span class="hljs-string">"layout_height"</span>: <span class="hljs-string">"wrap_content"</span>,
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"æç¤ºï¼šç»“æŸå‰å¯å£å¤´ç¡®è®¤å…³é”®å†³ç­–"</span>,
                <span class="hljs-string">"textSize"</span>: <span class="hljs-string">"10sp"</span>,
                <span class="hljs-string">"textColor"</span>: <span class="hljs-string">"#FF00FF00"</span>,
                <span class="hljs-string">"marginTop"</span>: <span class="hljs-string">"8dp"</span>
              }
            }
          ]
        }
        """<span class="hljs-selector-class">.trimIndent</span>()

        CxrApi<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.openCustomView</span>(pageJson)
    }

    <span class="hljs-comment">/** æ›´æ–°çœ¼é•œä¸Šçš„çºªè¦å†…å®¹ï¼ˆåªæ”¹ tv_summaryï¼‰ */</span>
    private fun <span class="hljs-built_in">updateSummaryOnGlasses</span>(summary: String) {
        val <span class="hljs-attribute">display</span> = if (summary.length &gt; <span class="hljs-number">400</span>) {
            <span class="hljs-selector-tag">summary</span><span class="hljs-selector-class">.substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">400</span>) + "..."
        } else <span class="hljs-selector-tag">summary</span>

        val updateJson = """
        <span class="hljs-selector-attr">[          {            <span class="hljs-string">"action"</span>: <span class="hljs-string">"update"</span>,            <span class="hljs-string">"id"</span>: <span class="hljs-string">"tv_summary"</span>,            <span class="hljs-string">"props"</span>: {              <span class="hljs-string">"text"</span>: ${JSONObject.quote(display)}            }          }        ]</span>
        """<span class="hljs-selector-class">.trimIndent</span>()

        CxrApi<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.updateCustomView</span>(updateJson)
    }
}
</code></pre>
<h3 data-id="heading-24">6.3 åœ¨ Activity ä¸­è°ƒç”¨</h3>
<p>åœ¨ä½ çš„ Activity é‡Œï¼Œåªéœ€è¦å®ä¾‹åŒ–å¹¶è°ƒç”¨å³å¯ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MeetingActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> meetingLensManager: MeetingLensManager

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_meeting)

        meetingLensManager = MeetingLensManager(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>)

        findViewById&lt;Button&gt;(R.id.btnStart).setOnClickListener {
            meetingLensManager.startMeeting()
        }

        findViewById&lt;Button&gt;(R.id.btnStop).setOnClickListener {
            meetingLensManager.stopMeeting()
        }
    }
}
</code></pre>
<p>å‰æï¼š</p>
<ul>
<li>å·²ç»ç”¨ CXR-M è¿æ¥ä¸Šçœ¼é•œï¼ˆè“ç‰™å·²è¿ï¼‰</li>
<li>æƒé™å·²ç»ç”³è¯·å®Œæˆ</li>
<li>åç«¯çš„ <code>/asr/stream</code> å’Œ <code>/meeting/summarize</code> æ¥å£å¯ç”¨</li>
</ul>
<h3 data-id="heading-25">6.4 åç«¯æ¥å£çš„æœ€å°çº¦å®šï¼ˆæ–¹ä¾¿ä½ è‡ªå·±å®ç°ï¼‰</h3>
<p>ä½ å¯ä»¥å…ˆå®šä¹‰ä¸€ä¸ª<strong>éå¸¸ç®€å•</strong>çš„åè®®ï¼š</p>
<ul>
<li>
<p><code>POST /asr/stream</code></p>
<ul>
<li>è¯·æ±‚ï¼š<code>{ "audio_base64": "..." }</code></li>
<li>å“åº”ï¼š<code>{ "partial_text": "æˆ‘ä»¬è¿™å­£åº¦çš„æ ¸å¿ƒç›®æ ‡æ˜¯..." }</code></li>
</ul>
</li>
<li>
<p><code>POST /meeting/summarize</code></p>
<ul>
<li>è¯·æ±‚ï¼š<code>{ "transcript": "...é•¿æ–‡æœ¬...", "final": true/false }</code></li>
<li>å“åº”ï¼š<code>{ "summary": "æœ¬æ¬¡ä¼šè®®å›´ç»• X å±•å¼€ï¼Œå½¢æˆ 3 ä¸ªå†³ç­–ï¼Œåˆ†åˆ«æ˜¯..." }</code></li>
</ul>
</li>
</ul>
<p>åç«¯å¯ä»¥ç”¨ï¼š</p>
<ul>
<li>Python + FastAPI + Whisper + ä»»æ„å¤§æ¨¡å‹</li>
<li>æˆ–è€…ç›´æ¥æ¥äº‘ä¸Šçš„ ASR / LLM æœåŠ¡ï¼ˆçœäº‹ä½†èŠ±é’±ï¼‰</li>
</ul>
<h2 data-id="heading-26">è¸©å‘ä¸å·¥ç¨‹ç»éªŒ</h2>
<h3 data-id="heading-27">7.1 æƒé™ä¸å…¨å¯¼è‡´ SDK é™é»˜å¤±è´¥</h3>
<ul>
<li>è“ç‰™ç›¸å…³æƒé™å¿…é¡»ä¸€æ¬¡æ€§ç”³è¯·ï¼š<code>BLUETOOTH</code> / <code>BLUETOOTH_ADMIN</code> / <code>BLUETOOTH_SCAN</code> / <code>BLUETOOTH_CONNECT</code> / <code>FINE_LOCATION</code></li>
<li>æœªæˆæƒæ—¶ CXR-M å¾ˆå¤šæ¥å£ç›´æ¥ä¸å¯ç”¨ï¼Œå»ºè®®åœ¨åˆå§‹åŒ–å‰åŠ ä¸€å±‚å®Œæ•´æ£€æŸ¥</li>
</ul>
<h3 data-id="heading-28">7.2 éŸ³é¢‘æµä¸ ASR çš„è¾¹ç•Œå¯¹é½</h3>
<ul>
<li><code>AudioStreamListener</code> æ¨æ¥çš„æ•°æ®æ˜¯<strong>è¿ç»­æµ</strong>ï¼Œéœ€è¦è‡ªå·±åˆ‡ç‰‡ + æ—¶é—´æˆ³ç®¡ç†</li>
<li>è®°å¾—åœ¨ <code>onStartAudioStream</code> é‡ç½®ç¼“å†²åŒº</li>
<li>å»ºè®®ä½¿ç”¨ 10ï½20ms å¸§é•¿çš„å†…éƒ¨é˜Ÿåˆ—ï¼Œå¯¹æ¥å¤§å¤šæ•° ASR å¼•æ“æ›´å‹å¥½</li>
</ul>
<h3 data-id="heading-29">7.3 Wi-Fi P2P å…¼å®¹ä¸é™çº§ç­–ç•¥</h3>
<ul>
<li>
<p>éƒ¨åˆ†æœºå‹å¯¹ Wi-Fi Direct æ”¯æŒä¸å¥½ï¼ŒCXR å›è°ƒé‡Œå¯èƒ½è¿”å› <code>WIFI_CONNECT_FAILED</code></p>
</li>
<li>
<p>å»ºè®®ï¼š</p>
<ul>
<li>å®æ—¶çºªè¦å…¨éƒ¨èµ°éŸ³é¢‘æµ + æ–‡æœ¬ï¼Œä¸ä¾èµ– Wi-Fi</li>
<li>ä¼šåå½•éŸ³å¤‡ä»½ / å¤šåª’ä½“é™„ä»¶å†å°è¯• Wi-Fiï¼ŒåŒæ­¥å¤±è´¥åˆ™æç¤ºç”¨æˆ·æ”¹ä¸ºæ‰‹æœºæœ¬åœ°ä¿å­˜</li>
</ul>
</li>
</ul>
<h3 data-id="heading-30">7.4 Custom View å¤æ‚åº¦ä¸æ€§èƒ½</h3>
<ul>
<li>å›¾ç‰‡ä¸è¶…è¿‡ 128Ã—128 pxï¼Œæ•°é‡ä¸è¦å¤ªå¤šï¼ˆ&lt; 10 å¼ ï¼‰</li>
<li>å¸ƒå±€æ ‘ä¸è¦å¤ªæ·±ï¼Œå¤šç”¨ <code>LinearLayout</code> / <code>RelativeLayout</code> åšç®€å•æ’ç‰ˆ</li>
<li>æ›´æ–°æ—¶å°½é‡ç”¨ <code>updateCustomView</code> åšå±€éƒ¨æ›´æ–°ï¼Œé¿å…é¢‘ç¹ reopen</li>
</ul>
<p>ä¼šè®®åŠ©æ‰‹åœºæ™¯ä¸‹ï¼Œæœ€å¥½åªåœ¨è§†é‡è¾¹ç¼˜æ”¾ä¸€ä¸ªå°å¡ç‰‡ï¼Œä¸è¦é“ºæ»¡å±å¹•ï¼Œä»¥å…å½±å“ç”¨æˆ·çœ‹äºº / çœ‹ PPTã€‚</p>
<h3 data-id="heading-31">7.5 ç”µé‡ä¸äº®åº¦ã€éŸ³é‡ç®¡ç†</h3>
<p>CXR-M æä¾›äº†ï¼š</p>
<ul>
<li>äº®åº¦ç›‘å¬ä¸è®¾ç½®ï¼š<code>setGlassBrightness</code> / <code>BrightnessUpdateListener</code></li>
<li>éŸ³é‡ç›‘å¬ä¸è®¾ç½®ï¼š<code>setGlassVolume</code> / <code>VolumeUpdateListener</code></li>
<li>ç”µé‡ç›‘å¬ï¼š<code>setBatteryLevelUpdateListener</code></li>
</ul>
<p>å¯ä»¥åšä¸€äº›è‡ªåŠ¨ä¼˜åŒ–ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>è¿›å…¥ä¼šè®®åè‡ªåŠ¨æŠŠäº®åº¦è°ƒåˆ°ä¸­æ¡£ï¼Œå‡å°‘å¹²æ‰°</li>
<li>ç”µé‡ä½äº 20% æ—¶ï¼Œåœ¨çœ¼é•œç«¯å¼¹å‡ºå°æç¤º</li>
</ul>
<h2 data-id="heading-32">å°ç»“ï¼šä»ã€Œè®°å½•ä¼šè®®ã€åˆ°ã€Œä¸ºå†³ç­–æœåŠ¡ã€</h2>
<p>ã€Œä¼šè®®é€é•œï¼ˆMeeting Lensï¼‰ã€æœ¬è´¨ä¸Šåšäº†ä¸‰ä»¶äº‹ï¼š</p>
<ol start="0">
<li>ç”¨ <strong>CXR-M SDK</strong> æŠŠ <strong>çœ¼é•œçš„éº¦å…‹é£ + æ˜¾ç¤ºå±</strong> æ¥å…¥åˆ°æ‰‹æœºçš„ AI å·¥ä½œæµä¸­ï¼›</li>
<li>ç”¨ <strong>ASR</strong> <strong>+</strong> <strong>LLM</strong>ï¼ŒæŠŠâ€œè°åœ¨ä»€ä¹ˆæ—¶é—´è¯´äº†ä»€ä¹ˆâ€å˜æˆâ€œæœ‰å“ªäº›è®®é¢˜ã€ç»“è®ºå’Œè¡ŒåŠ¨é¡¹â€ï¼›</li>
<li>ç”¨ <strong>æè¯å™¨</strong> <strong>/ è‡ªå®šä¹‰é¡µé¢</strong>ï¼ŒæŠŠçœŸæ­£é‡è¦çš„ä¿¡æ¯é€‚æ—¶åœ°æµ®ç°åˆ°ç”¨æˆ·çœ¼å‰ã€‚</li>
</ol>
<p>ä»å·¥ç¨‹è§’åº¦çœ‹ï¼Œå®ƒéªŒè¯äº†ï¼š</p>
<ul>
<li>æ‰‹æœº + çœ¼é•œ å¯ä»¥åƒä¸€ä¸ªç»Ÿä¸€çš„ã€Œä¼šè®®ç»ˆç«¯ã€ï¼šçœ¼é•œè´Ÿè´£æ„ŸçŸ¥ &amp; æ˜¾ç¤ºï¼Œæ‰‹æœºè´Ÿè´£è®¡ç®—ä¸è”ç½‘ã€‚</li>
<li>CXR æä¾›çš„åœºæ™¯èƒ½åŠ›ï¼ˆAI åœºæ™¯ã€æè¯å™¨ã€ç¿»è¯‘ã€è‡ªå®šä¹‰é¡µé¢ï¼‰å¯ä»¥å¾ˆå¥½åœ°æ‰¿è½½ã€Œå®æ—¶ä¼šè®®çŠ¶æ€ã€è¿™ç±»ä¿¡æ¯ã€‚</li>
</ul>
<p>ä»ä½“éªŒè§’åº¦çœ‹ï¼Œå®ƒæŠŠå¼€ä¼šè¿™ä»¶äº‹ä»ï¼š</p>
<blockquote>
<p>ã€Œæˆ‘å¾—è¾¹å¬è¾¹è®°ï¼Œç”Ÿæ€•æ¼æ‰ä¸€ä¸ªæ•°å­—ã€</p>
</blockquote>
<p>å˜æˆï¼š</p>
<blockquote>
<p>ã€Œæˆ‘åªéœ€è¦å¥½å¥½è®¨è®ºï¼Œå‰©ä¸‹çš„äº¤ç»™ AI å’Œçœ¼é•œã€‚ã€</p>
</blockquote>
<p>å¦‚æœä½ å·²ç»æœ‰ä¸€å° Rokid çœ¼é•œå’Œä¸€å° Android æ‰‹æœºï¼Œé‚£ä¹ˆä½ ç¦»è‡ªå·±çš„ã€Œä¼šè®®é€é•œã€å…¶å®åªå·®å‡ æ­¥ï¼š</p>
<ol start="0">
<li>ç”¨ CXR-M æŠŠçœ¼é•œè¿åˆ°æ‰‹æœºï¼›</li>
<li>æ‰“å¼€éŸ³é¢‘æµï¼Œæ¥å…¥ä½ ç†Ÿæ‚‰çš„ ASR æœåŠ¡ï¼›</li>
<li>è®¾è®¡ä¸€å¥—é€‚åˆä½ å›¢é˜Ÿçš„ LLM çºªè¦ Promptï¼›</li>
<li>ç”¨æè¯å™¨æˆ– Custom Viewï¼ŒæŠŠå®æ—¶è¦ç‚¹å’Œæœ€åçºªè¦æ¨å›çœ¼é•œã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäº DeepSeek + MateChat çš„è¯åˆ¸æ™ºèƒ½æŠ•é¡¾æŠ€æœ¯å®è·µï¼šæ‰“é€ é‡‘èé¢†åŸŸçš„ä¸“å±å¤§Qæ¨¡å‹åŠ©æ‰‹]]></title>    <link>https://juejin.cn/post/7577321767347355694</link>    <guid>https://juejin.cn/post/7577321767347355694</guid>    <pubDate>2025-11-28T06:53:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577321767347355694" data-draft-id="7577321767347339310" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäº DeepSeek + MateChat çš„è¯åˆ¸æ™ºèƒ½æŠ•é¡¾æŠ€æœ¯å®è·µï¼šæ‰“é€ é‡‘èé¢†åŸŸçš„ä¸“å±å¤§Qæ¨¡å‹åŠ©æ‰‹"/> <meta itemprop="keywords" content="å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-28T06:53:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸­æ¯å¯ä¹å¤šåŠ å†°"/> <meta itemprop="url" content="https://juejin.cn/user/3435306702347432"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäº DeepSeek + MateChat çš„è¯åˆ¸æ™ºèƒ½æŠ•é¡¾æŠ€æœ¯å®è·µï¼šæ‰“é€ é‡‘èé¢†åŸŸçš„ä¸“å±å¤§Qæ¨¡å‹åŠ©æ‰‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3435306702347432/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸­æ¯å¯ä¹å¤šåŠ å†°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-28T06:53:46.000Z" title="Fri Nov 28 2025 06:53:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>éšç€AIå¤§æ¨¡å‹æŠ€æœ¯çš„çªç ´æ€§å‘å±•ï¼Œè¯åˆ¸è¡Œä¸šæ­£ç»å†ä»ä¼ ç»Ÿ"äººæµ·æˆ˜æœ¯"å‘"äººæœºååŒ"çš„æ·±åˆ»è½¬å‹ã€‚æ®IDCæŠ¥å‘Šæ˜¾ç¤ºï¼Œ2024å¹´ä¸­å›½é‡‘èä¸šå¯¹AIåŠç”Ÿæˆå¼AIçš„æŠ•å…¥è§„æ¨¡è¾¾196.94äº¿å…ƒï¼Œé¢„è®¡åˆ°2027å¹´å°†å¢é•¿è‡³415.48äº¿å…ƒã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e116e0a7fd2c409ea7cf96497a5eccba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764917626&amp;x-signature=4MQBn7EcZTsMNBdmUKLk7uM8Um4%3D" alt="" loading="lazy"/></p>
<p>ç„¶è€Œï¼Œä¼ ç»ŸæŠ•é¡¾æœåŠ¡æ•ˆç‡ä½ï¼Œæ ‡å‡†åŒ–ä¸é«˜ï¼Œä¸ªæ€§åŒ–èƒ½åŠ›æœ‰é™ï¼Œå¦‚ä½•åŸºäºé‡‘èé¢†åŸŸæ•°æ®æ„å»ºå®‰å…¨å¯é çš„æ™ºèƒ½æŠ•é¡¾ç³»ç»Ÿï¼Œæˆä¸ºè¯åˆ¸è¡Œä¸šæ•°å­—åŒ–è½¬å‹çš„å…³é”®è¯¾é¢˜ã€‚åœ¨è¿™ä¸€èƒŒæ™¯ä¸‹ï¼Œ MateChat æ¡†æ¶ä¸ºè¯åˆ¸æ™ºèƒ½æŠ•é¡¾ç³»ç»Ÿçš„å¿«é€Ÿæ„å»ºæä¾›äº†ç†æƒ³çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æœ¬æ–‡å°†æ¢ç´¢å¹¶å®è·µåŸºäº MateChat æ¡†æ¶çš„è¯åˆ¸æ™ºèƒ½æŠ•é¡¾æŠ€æœ¯æ–¹æ¡ˆï¼Œè¯¦ç»†é˜è¿°å…¶æ¶æ„è®¾è®¡ã€è®­ç»ƒæµç¨‹å’Œéƒ¨ç½²ç­–ç•¥ï¼Œä¸ºé‡‘èç§‘æŠ€å¼€å‘è€…æä¾›ä¸€å¥—å¯è½åœ°çš„æŠ€æœ¯è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æ¶æ„è§£æ</h2>
<h4 data-id="heading-1">1.1ã€MateChat æ¡†æ¶æ¦‚è§ˆ</h4>
<p>MateChat æ˜¯ä¸€æ¬¾ç”Ÿæˆå¼äººå·¥æ™ºèƒ½ä½“éªŒè®¾è®¡ç³»ç»Ÿï¼Œä»¥åŠä¼ä¸šçº§å‰ç«¯è§£å†³æ–¹æ¡ˆã€‚å…¶åŸºäºOpenAIã€Midjourneyã€Googleã€Claudeç­‰ä¸šç•Œé¢†å…ˆçš„AIå¤§æ¨¡å‹å‚å•†æä¾›çš„APIï¼Œå®ç°äº†ä¸€ç«™å¼å¤šæ¨¡å‹AIåº”ç”¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d758f0456e540eb8a0dde396461f65f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764917626&amp;x-signature=iMqtC7QN43ukaYZ2TSTXYYie%2FLI%3D" alt="" loading="lazy"/></p>
<p>å®ƒä»¥Vue3å’ŒTypeScriptä¸ºåŸºç¡€ï¼Œç»“åˆäº†ç»„ä»¶åŒ–è®¾è®¡ç†å¿µï¼Œæä¾›äº†å¦‚McBubbleï¼ˆæ¶ˆæ¯æ°”æ³¡ç»„ä»¶ï¼‰ã€McLayoutï¼ˆå¯¹è¯å¸ƒå±€å®¹å™¨ï¼‰ã€McInputï¼ˆè¾“å…¥ç»„ä»¶ï¼‰ç­‰ä¸€ç³»åˆ—ä¸å¯¹è¯äº¤äº’ç›¸å…³çš„ç»„ä»¶ã€‚ä¸ä»…æ”¯æŒMarkdownè¯­æ³•ï¼Œè¿˜æä¾›äº†ä»£ç é«˜äº®ã€å¤åˆ¶ã€æŠ˜å ç­‰åŠŸèƒ½ï¼Œæå¤§åœ°ä¸°å¯Œäº†å¯¹è¯å†…å®¹çš„è¡¨ç°å½¢å¼ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0c6c0f14e6c4d7888469c74309906d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764917626&amp;x-signature=QwzhSDZUUcSrNCPp0AqxLpUHtFM%3D" alt="" loading="lazy"/></p>
<p>æ­¤å¤–ï¼ŒMateChatè¿˜å…·å¤‡ä¸»é¢˜å®šåˆ¶èƒ½åŠ›ï¼Œæ”¯æŒæ˜æš—è‰²æ¨¡å¼åˆ‡æ¢ä»¥åŠé€šè¿‡CSSå˜é‡è¿›è¡Œæ‰©å±•ï¼Œæ»¡è¶³ä¸åŒç”¨æˆ·å¯¹äºç•Œé¢é£æ ¼çš„éœ€æ±‚ã€‚è¿™äº›ç‰¹æ€§ä½¿å¾—MateChatåœ¨æ„å»ºæ™ºèƒ½å¯¹è¯ç•Œé¢æ—¶å…·æœ‰é«˜åº¦çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä¸ºè¯åˆ¸æ™ºèƒ½æŠ•é¡¾ç³»ç»Ÿçš„å‰ç«¯å¼€å‘æä¾›äº†æœ‰åŠ›æ”¯æŒã€‚</p>
<h4 data-id="heading-2">1.2ã€è¯åˆ¸æ™ºèƒ½æŠ•é¡¾å¹³å°å®šä½</h4>
<p>æ„å»ºè¯åˆ¸æ™ºèƒ½æŠ•é¡¾ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œå°†æ•´ä¸ªç³»ç»Ÿåˆ†ä¸ºæ•°æ®å±‚ã€æœåŠ¡å±‚å’Œåº”ç”¨å±‚ã€‚æ•°æ®å±‚ä¸»è¦è´Ÿè´£å®æ—¶è¡Œæƒ…æ•°æ®çš„æ¥å…¥ã€ç”¨æˆ·è¡Œä¸ºæ•°æ®çš„æ”¶é›†ã€çŸ¥è¯†å›¾è°±çš„æ„å»ºä»¥åŠå†å²æ•°æ®çš„å­˜å‚¨ï¼Œä¸ºç³»ç»Ÿæä¾›ä¸°å¯Œçš„æ•°æ®æ”¯æŒã€‚æœåŠ¡å±‚åˆ™æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒï¼Œé›†æˆäº†NLPè¯­ä¹‰ç†è§£ã€é£é™©è¯„ä¼°æ¨¡å‹ã€æŠ•èµ„ç»„åˆä¼˜åŒ–ä»¥åŠåˆè§„é£æ§å¼•æ“ç­‰åŠŸèƒ½æ¨¡å—ï¼Œé€šè¿‡å¯¹æ•°æ®å±‚æä¾›çš„æ•°æ®è¿›è¡Œåˆ†æå’Œå¤„ç†ï¼Œç”Ÿæˆæ™ºèƒ½æŠ•é¡¾æ‰€éœ€çš„å„ç±»æœåŠ¡ã€‚åº”ç”¨å±‚åˆ™ä¸»è¦é¢å‘ç”¨æˆ·ï¼Œæä¾›äº†MateChatå¯¹è¯ç•Œé¢ï¼Œå®ç°äº†å¤šè½®å¯¹è¯ç®¡ç†ã€ä¸ªæ€§åŒ–æ¨èä»¥åŠå®æ—¶ç›‘æ§é¢æ¿ç­‰åŠŸèƒ½ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¾¿æ·ã€é«˜æ•ˆçš„æ™ºèƒ½æŠ•é¡¾ä½“éªŒã€‚</p>
<h4 data-id="heading-3">1.3ã€MateChatç»„ä»¶æ¶æ„</h4>
<p>åœ¨å‰ç«¯å®ç°æ–¹é¢ï¼ŒMateChatçš„ç»„ä»¶æ¶æ„å‘æŒ¥äº†å…³é”®ä½œç”¨ã€‚é€šè¿‡McLayoutç»„ä»¶ï¼Œæˆ‘ä»¬æ­å»ºäº†ä¸€ä¸ªç®€æ´ã€æ¸…æ™°çš„å¯¹è¯å¸ƒå±€å®¹å™¨ï¼Œä¸ºç”¨æˆ·ä¸ç³»ç»Ÿä¹‹é—´çš„å¯¹è¯æä¾›äº†ä¸€ä¸ªè‰¯å¥½çš„äº¤äº’ç¯å¢ƒã€‚McBubbleç»„ä»¶åˆ™è´Ÿè´£ä»¥æ°”æ³¡å½¢å¼å±•ç¤ºå¯¹è¯å†…å®¹ï¼Œä½¿å¾—å¯¹è¯ä¿¡æ¯æ›´åŠ ç›´è§‚æ˜“è¯»ã€‚McInputç»„ä»¶ä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªä¾¿æ·çš„è¾“å…¥æ¡†ï¼Œæ”¯æŒç”¨æˆ·è¾“å…¥å„ç§å½¢å¼çš„é—®é¢˜æˆ–æŒ‡ä»¤ã€‚æ­¤å¤–ï¼ŒMcPromptç»„ä»¶æä¾›äº†å¿«æ·æç¤ºåŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿè§¦å‘ä¸€äº›å¸¸ç”¨çš„æ“ä½œæˆ–æŸ¥è¯¢ã€‚è€ŒMcMarkdownCardç»„ä»¶åˆ™èƒ½å¤Ÿå°†Markdownæ ¼å¼çš„å†…å®¹è¿›è¡Œæ¸²æŸ“ï¼Œä½¿å¾—ç³»ç»Ÿå›å¤çš„å†…å®¹å¯ä»¥åŒ…å«ä¸°å¯Œçš„æ ¼å¼å’Œæ’ç‰ˆæ•ˆæœï¼Œå¦‚å›¾è¡¨ã€ä»£ç ç­‰ï¼Œè¿›ä¸€æ­¥æå‡äº†ç”¨æˆ·ä½“éªŒã€‚è¿™äº›ç»„ä»¶ç›¸äº’é…åˆï¼Œæ„å»ºäº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”å…·æœ‰é«˜åº¦å¯å®šåˆ¶æ€§çš„æ™ºèƒ½æŠ•é¡¾å¯¹è¯ç•Œé¢ã€‚</p>
<h2 data-id="heading-4">äºŒã€æ‰“é€ é‡‘èé¢†åŸŸçš„ä¸“å±å¤§æ¨¡å‹åŠ©æ‰‹</h2>
<h3 data-id="heading-5">2.1ã€ç¯å¢ƒå‡†å¤‡</h3>
<p>é¦–å…ˆè¿›å…¥æ§åˆ¶å°ï¼Œè¾“å…¥<code>npm create vite@latest</code>ä½¿ç”¨viteé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª<code>vue+ts</code>é¡¹ç›®ï¼Œé€‰æ‹©Vueå’ŒJSï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c452ed76bad64491897e7cf4f29ce53a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764917626&amp;x-signature=7zJjLAXVgw6KdFPoeGkEQ551Esw%3D" alt="" loading="lazy"/></p>
<p>ç„¶åè¾“å…¥ï¼š<code>npm i vue-devui @matechat/core @devui-design/icons</code> ï¼Œå®‰è£…æ‰€éœ€çš„ä¾èµ–æ–‡ä»¶ï¼Œè¿™é‡Œè¦æ³¨æ„ä½¿ç”¨node 20.19+æˆ–è€… 22.12+çš„ç‰ˆæœ¬ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨viteã€‚</p>
<p>ç„¶åï¼Œåœ¨<code>main.ts</code>æ–‡ä»¶ä¸­å¼•å…¥<code>matechat</code>, <code>å›¾æ ‡åº“</code> æ ·å¼æ–‡ä»¶</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-title class_">MateChat</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@matechat/core'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">'@devui-design/icons/icomoon/devui-icon.css'</span>;

<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">use</span>(<span class="hljs-title class_">MateChat</span>).<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>);
</code></pre>
<p>ä¹‹åï¼Œå°±å¯ä»¥åœ¨ä»»æ„æ–‡ä»¶ä¸­ä½¿ç”¨ MateChat ç»„ä»¶äº†ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">McLayout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">McHeader</span> <span class="hljs-attr">:title</span>=<span class="hljs-string">"'MateChat'"</span> <span class="hljs-attr">:logoImg</span>=<span class="hljs-string">"'https://matechat.gitcode.com/logo.svg'"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">operationArea</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"operations"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon-helping"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">McHeader</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">McLayoutContent</span>
      <span class="hljs-attr">v-if</span>=<span class="hljs-string">"startPage"</span>
      <span class="hljs-attr">style</span>=<span class="hljs-string">"display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px"</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">McIntroduction</span>
        <span class="hljs-attr">:logoImg</span>=<span class="hljs-string">"'https://matechat.gitcode.com/logo2x.svg'"</span>
        <span class="hljs-attr">:title</span>=<span class="hljs-string">"'MateChat'"</span>
        <span class="hljs-attr">:subTitle</span>=<span class="hljs-string">"'Hiï¼Œæ¬¢è¿ä½¿ç”¨ MateChat'"</span>
        <span class="hljs-attr">:description</span>=<span class="hljs-string">"description"</span>
      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">McIntroduction</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">McPrompt</span>
        <span class="hljs-attr">:list</span>=<span class="hljs-string">"introPrompt.list"</span>
        <span class="hljs-attr">:direction</span>=<span class="hljs-string">"introPrompt.direction"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"intro-prompt"</span>
        @<span class="hljs-attr">itemClick</span>=<span class="hljs-string">"onSubmit($event.label)"</span>
      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">McPrompt</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">McLayoutContent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">McLayoutContent</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content-container"</span> <span class="hljs-attr">v-else</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(msg, idx) in messages"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"idx"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">McBubble</span>
          <span class="hljs-attr">v-if</span>=<span class="hljs-string">"msg.from === 'user'"</span>
          <span class="hljs-attr">:content</span>=<span class="hljs-string">"msg.content"</span>
          <span class="hljs-attr">:align</span>=<span class="hljs-string">"'right'"</span>
          <span class="hljs-attr">:avatarConfig</span>=<span class="hljs-string">"{ imgSrc: 'https://matechat.gitcode.com/png/demo/userAvatar.svg' }"</span>
        &gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">McBubble</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">McBubble</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">:content</span>=<span class="hljs-string">"msg.content"</span> <span class="hljs-attr">:avatarConfig</span>=<span class="hljs-string">"{ imgSrc: 'https://matechat.gitcode.com/logo.svg' }"</span> <span class="hljs-attr">:loading</span>=<span class="hljs-string">"msg.loading"</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">McBubble</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">McLayoutContent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"shortcut"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"display: flex; align-items: center; gap: 8px"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">McPrompt</span>
        <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!startPage"</span>
        <span class="hljs-attr">:list</span>=<span class="hljs-string">"simplePrompt"</span>
        <span class="hljs-attr">:direction</span>=<span class="hljs-string">"'horizontal'"</span>
        <span class="hljs-attr">style</span>=<span class="hljs-string">"flex: 1"</span>
        @<span class="hljs-attr">itemClick</span>=<span class="hljs-string">"onSubmit($event.label)"</span>
      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">McPrompt</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
        <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-left: auto"</span>
        <span class="hljs-attr">icon</span>=<span class="hljs-string">"add"</span>
        <span class="hljs-attr">shape</span>=<span class="hljs-string">"circle"</span>
        <span class="hljs-attr">title</span>=<span class="hljs-string">"æ–°å»ºå¯¹è¯"</span>
        <span class="hljs-attr">size</span>=<span class="hljs-string">"md"</span>
        @<span class="hljs-attr">click</span>=<span class="hljs-string">"newConversation"</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">McLayoutSender</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">McInput</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"inputValue"</span> <span class="hljs-attr">:maxLength</span>=<span class="hljs-string">"2000"</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"(e) =&gt; (inputValue = e)"</span> @<span class="hljs-attr">submit</span>=<span class="hljs-string">"onSubmit"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">extra</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-foot-wrapper"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-foot-left"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in inputFootIcons"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"item.icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                {{ item.text }}
              <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-foot-dividing-line"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-foot-maxlength"</span>&gt;</span>{{ inputValue.length }}/2000<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-foot-right"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">"op-clearup"</span> <span class="hljs-attr">shape</span>=<span class="hljs-string">"round"</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"!inputValue"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"inputValue = ''"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"demo-button-content"</span>&gt;</span>æ¸…ç©ºè¾“å…¥<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">McInput</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">McLayoutSender</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">McLayout</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-devui/button'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'vue-devui/button/style.css'</span>;

<span class="hljs-keyword">const</span> description = [
  <span class="hljs-string">'MateChat å¯ä»¥è¾…åŠ©ç ”å‘äººå‘˜ç¼–ç ã€æŸ¥è¯¢çŸ¥è¯†å’Œç›¸å…³ä½œä¸šä¿¡æ¯ã€ç¼–å†™æ–‡æ¡£ç­‰ã€‚'</span>,
  <span class="hljs-string">'ä½œä¸ºAIæ¨¡å‹ï¼ŒMateChat æä¾›çš„ç­”æ¡ˆå¯èƒ½ä¸æ€»æ˜¯ç¡®å®šæˆ–å‡†ç¡®çš„ï¼Œä½†æ‚¨çš„åé¦ˆå¯ä»¥å¸®åŠ© MateChat åšçš„æ›´å¥½ã€‚'</span>,
];
<span class="hljs-keyword">const</span> introPrompt = {
  <span class="hljs-attr">direction</span>: <span class="hljs-string">'horizontal'</span>,
  <span class="hljs-attr">list</span>: [
    {
      <span class="hljs-attr">value</span>: <span class="hljs-string">'quickSort'</span>,
      <span class="hljs-attr">label</span>: <span class="hljs-string">'å¸®æˆ‘å†™ä¸€ä¸ªå¿«é€Ÿæ’åº'</span>,
      <span class="hljs-attr">iconConfig</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'icon-info-o'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#5e7ce0'</span> },
      <span class="hljs-attr">desc</span>: <span class="hljs-string">'ä½¿ç”¨ js å®ç°ä¸€ä¸ªå¿«é€Ÿæ’åº'</span>,
    },
    {
      <span class="hljs-attr">value</span>: <span class="hljs-string">'helpMd'</span>,
      <span class="hljs-attr">label</span>: <span class="hljs-string">'ä½ å¯ä»¥å¸®æˆ‘åšäº›ä»€ä¹ˆï¼Ÿ'</span>,
      <span class="hljs-attr">iconConfig</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'icon-star'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'rgb(255, 215, 0)'</span> },
      <span class="hljs-attr">desc</span>: <span class="hljs-string">'äº†è§£å½“å‰å¤§æ¨¡å‹å¯ä»¥å¸®ä½ åšçš„äº‹'</span>,
    },
    {
      <span class="hljs-attr">value</span>: <span class="hljs-string">'bindProjectSpace'</span>,
      <span class="hljs-attr">label</span>: <span class="hljs-string">'æ€ä¹ˆç»‘å®šé¡¹ç›®ç©ºé—´'</span>,
      <span class="hljs-attr">iconConfig</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'icon-priority'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#3ac295'</span> },
      <span class="hljs-attr">desc</span>: <span class="hljs-string">'å¦‚ä½•ç»‘å®šäº‘ç©ºé—´ä¸­çš„é¡¹ç›®'</span>,
    },
  ],
};
<span class="hljs-keyword">const</span> simplePrompt = [
  {
    <span class="hljs-attr">value</span>: <span class="hljs-string">'quickSort'</span>,
    <span class="hljs-attr">iconConfig</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'icon-info-o'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#5e7ce0'</span> },
    <span class="hljs-attr">label</span>: <span class="hljs-string">'å¸®æˆ‘å†™ä¸€ä¸ªå¿«é€Ÿæ’åº'</span>,
  },
  {
    <span class="hljs-attr">value</span>: <span class="hljs-string">'helpMd'</span>,
    <span class="hljs-attr">iconConfig</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'icon-star'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'rgb(255, 215, 0)'</span> },
    <span class="hljs-attr">label</span>: <span class="hljs-string">'ä½ å¯ä»¥å¸®æˆ‘åšäº›ä»€ä¹ˆï¼Ÿ'</span>,
  },
];
<span class="hljs-keyword">const</span> startPage = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">true</span>);
<span class="hljs-keyword">const</span> inputValue = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> inputFootIcons = [
  { <span class="hljs-attr">icon</span>: <span class="hljs-string">'icon-at'</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'æ™ºèƒ½ä½“'</span> },
  { <span class="hljs-attr">icon</span>: <span class="hljs-string">'icon-standard'</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'è¯åº“'</span> },
  { <span class="hljs-attr">icon</span>: <span class="hljs-string">'icon-add'</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'é™„ä»¶'</span> },
];

<span class="hljs-keyword">const</span> messages = ref&lt;any[]&gt;([]);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">newConversation</span> = (<span class="hljs-params"/>) =&gt; {
  startPage.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  messages.<span class="hljs-property">value</span> = [];
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">onSubmit</span> = (<span class="hljs-params">evt</span>) =&gt; {
  inputValue.<span class="hljs-property">value</span>=<span class="hljs-string">''</span>;
  startPage.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-comment">// ç”¨æˆ·å‘é€æ¶ˆæ¯</span>
  messages.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>({
    <span class="hljs-attr">from</span>: <span class="hljs-string">'user'</span>,
    <span class="hljs-attr">content</span>: evt,
  });
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// æ¨¡å‹è¿”å›æ¶ˆæ¯</span>
    messages.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">from</span>: <span class="hljs-string">'model'</span>,
      <span class="hljs-attr">content</span>: evt,
    });
  }, <span class="hljs-number">200</span>);
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">1000px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span> auto;
  <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100vh</span> - <span class="hljs-number">82px</span>);
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">16px</span>;
}

<span class="hljs-selector-class">.content-container</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">overflow</span>: auto;
}

<span class="hljs-selector-class">.input-foot-wrapper</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">8px</span>;

  <span class="hljs-selector-class">.input-foot-left</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;

    <span class="hljs-selector-tag">span</span> {
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">18px</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#252b3a</span>;
      <span class="hljs-attribute">cursor</span>: pointer;
    }

    <span class="hljs-selector-class">.input-foot-dividing-line</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">1px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">14px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#d7d8da</span>;
    }

    <span class="hljs-selector-class">.input-foot-maxlength</span> {
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#71757f</span>;
    }
  }

  <span class="hljs-selector-class">.input-foot-right</span> {
    <span class="hljs-selector-class">.demo-button-content</span> {
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
    }

    &amp; &gt; *<span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-pseudo">:first</span>-child) {
      <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">8px</span>;
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>æ˜¾ç¤ºå‡ºHelloï¼ŒMateChatè¿™æ ·ï¼Œå³ä¸ºå®‰è£…æˆåŠŸï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/903e2f880b1c49b2850ef1c13a5b726b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764917626&amp;x-signature=8W%2ByGnUFwhKKtC%2FLB%2BRT9ChRtOE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">2.2ã€å¯¹æ¥DeepSeek API</h3>
<p>é¦–å…ˆè¦å®‰è£…OpenAIæ”¯æŒï¼Œç›´æ¥ç»ˆç«¯è¾“å…¥npm install openaiå®‰è£…ä¾èµ–</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dee98992fc12463dbc62106f6d35aa7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764917626&amp;x-signature=IU9A%2BjndTcU%2BKZl5qBoVI8UmzQE%3D" alt="" loading="lazy"/></p>
<p>ç„¶åéœ€è¦å¯¹æ¥APIï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥DeepSeekä¸ºä¾‹ï¼ŒDeepSeek API ä½¿ç”¨ä¸ OpenAI å…¼å®¹çš„ API æ ¼å¼ï¼Œé¦–å…ˆï¼Œå‰å¾€DeepSeekå¼€å‘å¹³å°ï¼Œåˆ›å»ºAPI Keyï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4c87c83082c4a14916daaf4542c1701~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764917626&amp;x-signature=h%2Fycna71wIlrTWH9QTlTOMuGjNE%3D" alt="" loading="lazy"/></p>
<p>ç„¶åå°†ä»£ç ä¸­onSubmitæ–¹æ³•æ›¿æ¢æˆæ¥å…¥DeepSeekçš„ä»£ç ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df8d0ddf1f0841b9b70da4fc21bece28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764917626&amp;x-signature=L18xjaHvdBMJ0%2FAg75w08nG%2F%2Bmw%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">client</span> = ref&lt;OpenAI&gt;()<span class="hljs-comment">;</span>

<span class="hljs-attr">client.value</span> = new OpenAI({
  apiKey: '', // æ¨¡å‹APIKey
  baseURL: '', // æ¨¡å‹APIåœ°å€
  dangerouslyAllowBrowser: true, // æµè§ˆå™¨ç¯å¢ƒä½¿ç”¨éœ€è¦å¼€å¯
})<span class="hljs-comment">;</span>

const <span class="hljs-attr">onSubmit</span> = (evt) =&gt; {
  <span class="hljs-attr">inputValue.value</span> = <span class="hljs-string">''</span><span class="hljs-comment">;</span>
  <span class="hljs-attr">startPage.value</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
  // ç”¨æˆ·å‘é€æ¶ˆæ¯
  messages.value.push({
    from: 'user',
    content: evt,
    avatarConfig: { name: 'user' },
  })<span class="hljs-comment">;</span>

  fetchData(evt)<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">fetchData</span> = async (ques) =&gt; {
  messages.value.push({
    from: 'model',
    content: '',
    avatarConfig: { name: 'model' },
    id: '',
    loading: true,
  })<span class="hljs-comment">;</span>
  const <span class="hljs-attr">completion</span> = await client.value!.chat.completions.create({
    model: 'deepseek-reasoner', // æ ¹æ®deepseekæ¨¡å‹åˆ—è¡¨è¿›è¡Œæ›¿æ¢
    messages: <span class="hljs-section">[{ role: 'user', content: ques }]</span>,
    stream: true, // ä¸º true åˆ™å¼€å¯æ¥å£çš„æµå¼è¿”å›
  })<span class="hljs-comment">;</span>
  messages.value<span class="hljs-section">[messages.value.length - 1]</span>.<span class="hljs-attr">loading</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
  for await (const chunk of completion) {
    const <span class="hljs-attr">content</span> = chunk.choices[<span class="hljs-number">0</span>]?.delta?.content || <span class="hljs-string">''</span><span class="hljs-comment">;</span>
    const <span class="hljs-attr">chatId</span> = chunk.id<span class="hljs-comment">;</span>
    messages.value<span class="hljs-section">[messages.value.length - 1]</span>.content += content<span class="hljs-comment">;</span>
    messages.value<span class="hljs-section">[messages.value.length - 1]</span>.<span class="hljs-attr">id</span> = chatId<span class="hljs-comment">;</span>
  }
}<span class="hljs-comment">;</span>
</code></pre>
<p>å¹¶ä¸”å¡«å…¥åˆšåˆšå¤åˆ¶çš„API keyï¼ŒbaseURLå°±å¡«<a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.deepseek.com%2Fv1%25E5%258D%25B3%25E5%258F%25AF%25E6%2588%2590%25E5%258A%259F%25E8%25B0%2583%25E7%2594%25A8deepseek" target="_blank" title="https://api.deepseek.com/v1%E5%8D%B3%E5%8F%AF%E6%88%90%E5%8A%9F%E8%B0%83%E7%94%A8deepseek" ref="nofollow noopener noreferrer">api.deepseek.com/v1å³å¯æˆåŠŸè°ƒç”¨deeâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d05db67b3c44a548affdc91cd6c122f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764917626&amp;x-signature=lxhv6zSmHdApfZ4%2B5U4gzuZZsZQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">2.3ã€å¼€å§‹æ”¹é€ </h3>
<p>åœ¨å®ŒæˆåŸºç¡€APIå¯¹æ¥åï¼Œå‚è€ƒé‡‘èé¢†åŸŸçš„ç‰¹ç‚¹ï¼Œå€Ÿé‰´MateChatåœ¨æ™ºèƒ½å¯¹è¯å’Œä¸šåŠ¡é›†æˆæ–¹é¢çš„è®¾è®¡ç†å¿µï¼Œå¯¹é‡‘èåŠ©æ‰‹è¿›è¡Œå…¨é¢çš„åŠŸèƒ½å¢å¼ºå’Œä¸šåŠ¡é€»è¾‘ä¼˜åŒ–ï¼š</p>
<p>é¦–å…ˆé’ˆå¯¹é‡‘èé¢†åŸŸæ„å»ºå¯¹åº”çš„æç¤ºè¯ï¼Œè®©æ¨¡å‹åœ¨åˆ†æå½“å‰å¯¹è¯ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ ¹æ®é‡‘èè¯é¢˜ç±»å‹ï¼ˆå¦‚è‚¡ç¥¨åˆ†æã€é£é™©è¯„ä¼°ã€è´¢åŠ¡è§„åˆ’ï¼‰ï¼Œè‡ªåŠ¨æ„å»ºé¢†åŸŸç‰¹å®šçš„æç¤ºè¯æ¨¡æ¿ï¼Œæç¤ºè¯åº“å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">// æç¤ºè¯åº“
export const PROMPT_TEMPLATES: Record&lt;FinancialTopic, FinancialPromptTemplate&gt; = {
  <span class="hljs-selector-attr">[FinancialTopic.STOCK_ANALYSIS]</span>: {
    topic: <span class="hljs-string">'è‚¡ç¥¨åˆ†æ'</span>,
    template: `ä½œä¸ºä¸“ä¸šé‡‘èåˆ†æå¸ˆï¼Œè¯·å¯¹{stockName}è¿›è¡Œå…¨é¢çš„æŠ•èµ„ä»·å€¼åˆ†æã€‚

è¯·æŒ‰ç…§ä»¥ä¸‹æ¡†æ¶è¿›è¡Œåˆ†æï¼š
<span class="hljs-number">1</span>. åŸºæœ¬é¢åˆ†æï¼šåŒ…æ‹¬è´¢åŠ¡æŒ‡æ ‡ï¼ˆå¸‚ç›ˆç‡ã€å¸‚å‡€ç‡ã€ROEç­‰ï¼‰ã€ç›ˆåˆ©èƒ½åŠ›ã€æˆé•¿æ€§
<span class="hljs-number">2</span>. æŠ€æœ¯é¢åˆ†æï¼šä»·æ ¼èµ°åŠ¿ã€æˆäº¤é‡ã€æŠ€æœ¯æŒ‡æ ‡
<span class="hljs-number">3</span>. è¡Œä¸šåˆ†æï¼šè¡Œä¸šåœ°ä½ã€ç«äº‰æ ¼å±€ã€å‘å±•å‰æ™¯
<span class="hljs-number">4</span>. ä¼°å€¼åˆ†æï¼šåˆç†ä¼°å€¼åŒºé—´ã€æŠ•èµ„å»ºè®®

è¦æ±‚ï¼š
- æä¾›å…·ä½“æ•°æ®æ”¯æ’‘
- åˆ†æè¦å®¢è§‚å…¨é¢
- ç»™å‡ºæ˜ç¡®çš„é£é™©æç¤º
- å»ºè®®è¦å…·æœ‰å¯æ“ä½œæ€§`,
    requiredMetrics: [<span class="hljs-string">'å¸‚ç›ˆç‡'</span>, <span class="hljs-string">'å¸‚å‡€ç‡'</span>, <span class="hljs-string">'ROE'</span>, <span class="hljs-string">'è¥æ”¶å¢é•¿ç‡'</span>, <span class="hljs-string">'å‡€åˆ©æ¶¦å¢é•¿ç‡'</span>],
    qualityCriteria: [<span class="hljs-string">'æ•°æ®å‡†ç¡®æ€§'</span>, <span class="hljs-string">'åˆ†ææ·±åº¦'</span>, <span class="hljs-string">'é£é™©æç¤º'</span>, <span class="hljs-string">'å¯æ“ä½œæ€§'</span>]
  },
  <span class="hljs-selector-attr">[FinancialTopic.INVESTMENT_STRATEGY]</span>: {
    topic: <span class="hljs-string">'æŠ•èµ„ç­–ç•¥'</span>,
    template: `ä½œä¸ºä¸“ä¸šæŠ•èµ„é¡¾é—®ï¼Œè¯·ä¸º{riskProfile}é£é™©åå¥½çš„æŠ•èµ„è€…åˆ¶å®šæŠ•èµ„ç­–ç•¥ã€‚

æŠ•èµ„ç›®æ ‡ï¼š{investmentGoal}
æŠ•èµ„æœŸé™ï¼š{timeHorizon}

è¯·æä¾›ï¼š
<span class="hljs-number">1</span>. èµ„äº§é…ç½®å»ºè®®ï¼ˆè‚¡ç¥¨ã€å€ºåˆ¸ã€ç°é‡‘ç­‰æ¯”ä¾‹ï¼‰
<span class="hljs-number">2</span>. å…·ä½“æŠ•èµ„æ ‡çš„æ¨è
<span class="hljs-number">3</span>. é£é™©ç®¡ç†æªæ–½
<span class="hljs-number">4</span>. å®šæœŸè°ƒæ•´ç­–ç•¥

è¦æ±‚ï¼š
- ç­–ç•¥è¦ç¬¦åˆé£é™©åå¥½
- æä¾›å†å²å›æµ‹æ•°æ®
- è€ƒè™‘å¸‚åœºç¯å¢ƒå› ç´ 
- ç»™å‡ºæ˜ç¡®çš„æ‰§è¡Œæ­¥éª¤`,
    requiredMetrics: [<span class="hljs-string">'é¢„æœŸæ”¶ç›Šç‡'</span>, <span class="hljs-string">'æœ€å¤§å›æ’¤'</span>, <span class="hljs-string">'å¤æ™®æ¯”ç‡'</span>, <span class="hljs-string">'èµ„äº§ç›¸å…³æ€§'</span>],
    qualityCriteria: [<span class="hljs-string">'é£é™©åŒ¹é…åº¦'</span>, <span class="hljs-string">'å†å²è¡¨ç°'</span>, <span class="hljs-string">'é€‚åº”æ€§'</span>, <span class="hljs-string">'æ‰§è¡Œå¯è¡Œæ€§'</span>]
  },
  <span class="hljs-selector-attr">[FinancialTopic.RISK_ASSESSMENT]</span>: {
    topic: <span class="hljs-string">'é£é™©è¯„ä¼°'</span>,
    template: `ä½œä¸ºä¸“ä¸šé£é™©è¯„ä¼°å¸ˆï¼Œè¯·å¯¹{investmentTarget}è¿›è¡Œå…¨é¢çš„é£é™©è¯„ä¼°ã€‚

è¯„ä¼°ç»´åº¦ï¼š
<span class="hljs-number">1</span>. å¸‚åœºé£é™©ï¼šä»·æ ¼æ³¢åŠ¨ã€ç³»ç»Ÿæ€§é£é™©
<span class="hljs-number">2</span>. ä¿¡ç”¨é£é™©ï¼šè¿çº¦æ¦‚ç‡ã€ä¿¡ç”¨è¯„çº§
<span class="hljs-number">3</span>. æµåŠ¨æ€§é£é™©ï¼šå˜ç°èƒ½åŠ›ã€äº¤æ˜“æˆæœ¬
<span class="hljs-number">4</span>. æ“ä½œé£é™©ï¼šç®¡ç†é£é™©ã€æŠ€æœ¯é£é™©

è¦æ±‚ï¼š
- ä½¿ç”¨é‡åŒ–é£é™©è¯„ä¼°æ–¹æ³•
- æä¾›é£é™©ç­‰çº§è¯„åˆ†
- ç»™å‡ºé£é™©æ§åˆ¶å»ºè®®
- è€ƒè™‘æç«¯å¸‚åœºæƒ…å†µ`,
    requiredMetrics: [<span class="hljs-string">'æ³¢åŠ¨ç‡'</span>, <span class="hljs-string">'VARå€¼'</span>, <span class="hljs-string">'æœ€å¤§å›æ’¤'</span>, <span class="hljs-string">'ä¿¡ç”¨è¯„çº§'</span>],
    qualityCriteria: [<span class="hljs-string">'é‡åŒ–ç¨‹åº¦'</span>, <span class="hljs-string">'å…¨é¢æ€§'</span>, <span class="hljs-string">'å®ç”¨æ€§'</span>, <span class="hljs-string">'å‰ç»æ€§'</span>]
  },
  <span class="hljs-selector-attr">[FinancialTopic.FINANCIAL_PLANNING]</span>: {
    topic: <span class="hljs-string">'è´¢åŠ¡è§„åˆ’'</span>,
    template: `ä½œä¸ºä¸“ä¸šè´¢åŠ¡è§„åˆ’å¸ˆï¼Œè¯·ä¸º{clientProfile}åˆ¶å®šä¸ªæ€§åŒ–çš„è´¢åŠ¡è§„åˆ’æ–¹æ¡ˆã€‚

å½“å‰è´¢åŠ¡çŠ¶å†µï¼š{currentSituation}
è´¢åŠ¡ç›®æ ‡ï¼š{financialGoals}

è§„åˆ’å†…å®¹ï¼š
<span class="hljs-number">1</span>. ç°é‡‘æµç®¡ç†ï¼šæ”¶å…¥æ”¯å‡ºä¼˜åŒ–
<span class="hljs-number">2</span>. èµ„äº§é…ç½®ï¼šæŠ•èµ„ç»„åˆå»ºè®®
<span class="hljs-number">3</span>. é£é™©ç®¡ç†ï¼šä¿é™©è§„åˆ’
<span class="hljs-number">4</span>. ç¨åŠ¡ä¼˜åŒ–ï¼šåˆç†é¿ç¨ç­–ç•¥

è¦æ±‚ï¼š
- æ–¹æ¡ˆè¦ä¸ªæ€§åŒ–å®šåˆ¶
- è€ƒè™‘ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ
- æä¾›å…·ä½“æ‰§è¡Œè®¡åˆ’
- åŒ…å«å®šæœŸè¯„ä¼°æœºåˆ¶`,
    requiredMetrics: [<span class="hljs-string">'ç°é‡‘æµ'</span>, <span class="hljs-string">'èµ„äº§è´Ÿå€ºç‡'</span>, <span class="hljs-string">'å‚¨è“„ç‡'</span>, <span class="hljs-string">'æŠ•èµ„å›æŠ¥ç‡'</span>],
    qualityCriteria: [<span class="hljs-string">'ä¸ªæ€§åŒ–ç¨‹åº¦'</span>, <span class="hljs-string">'å…¨é¢æ€§'</span>, <span class="hljs-string">'å¯æ‰§è¡Œæ€§'</span>, <span class="hljs-string">'é•¿æœŸæ€§'</span>]
  }
};
</code></pre>
<p>å…¶æ¬¡ï¼Œé€šè¿‡é¢„è®¾çš„é‡‘èä¸“ä¸šçŸ¥è¯†å›¾è°±å’Œå…³é”®æŒ‡æ ‡æ£€æŸ¥æ¸…å•ï¼Œå¯¹AIè¿”å›çš„å†…å®¹è¿›è¡Œè‡ªåŠ¨è´¨é‡è¯„åˆ†ã€‚å½“æ£€æµ‹åˆ°å›ç­”è¿‡äºç¬¼ç»Ÿæˆ–ç¼ºä¹å…·ä½“æ•°æ®æ”¯æ’‘æ—¶ï¼Œç³»ç»Ÿä¼šè§¦å‘è‡ªåŠ¨è¿½é—®æœºåˆ¶ï¼Œè¦æ±‚è¡¥å……å…·ä½“æ¡ˆä¾‹æˆ–æ•°æ®ä¾æ®ï¼Œç¡®ä¿è¾“å‡ºå†…å®¹è¾¾åˆ°é‡‘èä¸“ä¸šæ ‡å‡†éƒ¨åˆ†æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼›</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è¯é¢˜æ£€æµ‹å‡½æ•°</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">detectFinancialTopic</span>(<span class="hljs-params">userInput: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">FinancialTopic</span> | <span class="hljs-literal">null</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">topicKeywords</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">FinancialTopic</span>, <span class="hljs-built_in">string</span>[]&gt; = {
    [<span class="hljs-title class_">FinancialTopic</span>.<span class="hljs-property">STOCK_ANALYSIS</span>]: [<span class="hljs-string">'è‚¡ç¥¨'</span>, <span class="hljs-string">'è‚¡ä»·'</span>, <span class="hljs-string">'å¸‚ç›ˆç‡'</span>, <span class="hljs-string">'å¸‚å‡€ç‡'</span>, <span class="hljs-string">'è´¢æŠ¥'</span>, <span class="hljs-string">'ä¼°å€¼'</span>],
    [<span class="hljs-title class_">FinancialTopic</span>.<span class="hljs-property">INVESTMENT_STRATEGY</span>]: [<span class="hljs-string">'æŠ•èµ„'</span>, <span class="hljs-string">'ç­–ç•¥'</span>, <span class="hljs-string">'ç»„åˆ'</span>, <span class="hljs-string">'é…ç½®'</span>, <span class="hljs-string">'èµ„äº§'</span>, <span class="hljs-string">'æ”¶ç›Š'</span>],
    [<span class="hljs-title class_">FinancialTopic</span>.<span class="hljs-property">RISK_ASSESSMENT</span>]: [<span class="hljs-string">'é£é™©'</span>, <span class="hljs-string">'è¯„ä¼°'</span>, <span class="hljs-string">'æ³¢åŠ¨'</span>, <span class="hljs-string">'å›æ’¤'</span>, <span class="hljs-string">'å®‰å…¨'</span>, <span class="hljs-string">'ç¨³å¥'</span>],
    [<span class="hljs-title class_">FinancialTopic</span>.<span class="hljs-property">FINANCIAL_PLANNING</span>]: [<span class="hljs-string">'è´¢åŠ¡'</span>, <span class="hljs-string">'è§„åˆ’'</span>, <span class="hljs-string">'ç†è´¢'</span>, <span class="hljs-string">'å‚¨è“„'</span>, <span class="hljs-string">'é€€ä¼‘'</span>, <span class="hljs-string">'ç¨åŠ¡'</span>],
    [<span class="hljs-title class_">FinancialTopic</span>.<span class="hljs-property">MARKET_TREND</span>]: [<span class="hljs-string">'å¸‚åœº'</span>, <span class="hljs-string">'è¶‹åŠ¿'</span>, <span class="hljs-string">'è¡Œæƒ…'</span>, <span class="hljs-string">'é¢„æµ‹'</span>, <span class="hljs-string">'å®è§‚'</span>, <span class="hljs-string">'ç»æµ'</span>],
    [<span class="hljs-title class_">FinancialTopic</span>.<span class="hljs-property">PORTFOLIO_MANAGEMENT</span>]: [<span class="hljs-string">'ç»„åˆ'</span>, <span class="hljs-string">'ç®¡ç†'</span>, <span class="hljs-string">'ä¼˜åŒ–'</span>, <span class="hljs-string">'å†å¹³è¡¡'</span>, <span class="hljs-string">'åˆ†æ•£'</span>]
  };

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [topic, keywords] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(topicKeywords)) {
    <span class="hljs-keyword">if</span> (keywords.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">keyword</span> =&gt;</span> userInput.<span class="hljs-title function_">includes</span>(keyword))) {
      <span class="hljs-keyword">return</span> topic <span class="hljs-keyword">as</span> <span class="hljs-title class_">FinancialTopic</span>;
    }
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">// æç¤ºè¯ç”Ÿæˆå™¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateFinancialPrompt</span>(<span class="hljs-params">topic: FinancialTopic, context: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {}</span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">const</span> template = <span class="hljs-variable constant_">PROMPT_TEMPLATES</span>[topic];
  <span class="hljs-keyword">if</span> (!template) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;

  <span class="hljs-keyword">let</span> prompt = template.<span class="hljs-property">template</span>;

  <span class="hljs-comment">// æ›¿æ¢æ¨¡æ¿ä¸­çš„å˜é‡</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(context).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {
    prompt = prompt.<span class="hljs-title function_">replace</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`{<span class="hljs-subst">${key}</span>}`</span>, <span class="hljs-string">'g'</span>), value);
  });

  <span class="hljs-keyword">return</span> prompt;
}

<span class="hljs-comment">// è´¨é‡è¯„åˆ†å‡½æ•°</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">assessAnswerQuality</span>(<span class="hljs-params">answer: <span class="hljs-built_in">string</span>, topic: FinancialTopic</span>): {
  <span class="hljs-attr">score</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">feedback</span>: <span class="hljs-built_in">string</span>[];
  <span class="hljs-attr">needsFollowUp</span>: <span class="hljs-built_in">boolean</span>;
} {
  <span class="hljs-keyword">const</span> template = <span class="hljs-variable constant_">PROMPT_TEMPLATES</span>[topic];
  <span class="hljs-keyword">if</span> (!template) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">score</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">feedback</span>: [<span class="hljs-string">'æ— æ³•è¯„ä¼°è¯¥è¯é¢˜çš„å›ç­”è´¨é‡'</span>], <span class="hljs-attr">needsFollowUp</span>: <span class="hljs-literal">false</span> };
  }

  <span class="hljs-keyword">const</span> <span class="hljs-attr">feedback</span>: <span class="hljs-built_in">string</span>[] = [];
  <span class="hljs-keyword">let</span> score = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> criteriaMet = <span class="hljs-number">0</span>;

  <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦åŒ…å«å¿…è¦æŒ‡æ ‡</span>
  template.<span class="hljs-property">requiredMetrics</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">metric</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (answer.<span class="hljs-title function_">includes</span>(metric)) {
      criteriaMet++;
      score += <span class="hljs-number">20</span>;
    } <span class="hljs-keyword">else</span> {
      feedback.<span class="hljs-title function_">push</span>(<span class="hljs-string">`ç¼ºå°‘<span class="hljs-subst">${metric}</span>ç›¸å…³åˆ†æ`</span>);
    }
  });

  <span class="hljs-comment">// æ£€æŸ¥æ•°æ®æ”¯æ’‘</span>
  <span class="hljs-keyword">const</span> hasDataSupport = <span class="hljs-regexp">/\d+(.\d+)?%?/</span>.<span class="hljs-title function_">test</span>(answer) ||
    answer.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'æ•°æ®'</span>) ||
    answer.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'ç»Ÿè®¡'</span>) ||
    answer.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'æŠ¥å‘Š'</span>);

  <span class="hljs-keyword">if</span> (hasDataSupport) {
    criteriaMet++;
    score += <span class="hljs-number">20</span>;
  } <span class="hljs-keyword">else</span> {
    feedback.<span class="hljs-title function_">push</span>(<span class="hljs-string">'å›ç­”ç¼ºä¹å…·ä½“æ•°æ®æ”¯æ’‘'</span>);
  }

  <span class="hljs-comment">// æ£€æŸ¥åˆ†ææ·±åº¦</span>
  <span class="hljs-keyword">const</span> analysisDepth = (answer.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\n/g</span>) || []).<span class="hljs-property">length</span> &gt; <span class="hljs-number">5</span>;
  <span class="hljs-keyword">if</span> (analysisDepth) {
    criteriaMet++;
    score += <span class="hljs-number">20</span>;
  } <span class="hljs-keyword">else</span> {
    feedback.<span class="hljs-title function_">push</span>(<span class="hljs-string">'åˆ†ææ·±åº¦ä¸è¶³ï¼Œå»ºè®®æä¾›æ›´è¯¦ç»†çš„åˆ†æ'</span>);
  }

  <span class="hljs-keyword">const</span> needsFollowUp = criteriaMet &lt; template.<span class="hljs-property">requiredMetrics</span>.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>;

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">score</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">100</span>, score),
    feedback,
    needsFollowUp
  };
}

<span class="hljs-comment">// è‡ªåŠ¨è¿½é—®ç”Ÿæˆå™¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateFollowUpQuestion</span>(<span class="hljs-params">topic: FinancialTopic, missingMetrics: <span class="hljs-built_in">string</span>[]</span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">const</span> knowledge = <span class="hljs-variable constant_">FINANCIAL_KNOWLEDGE_GRAPH</span>[topic];
  <span class="hljs-keyword">if</span> (!knowledge) <span class="hljs-keyword">return</span> <span class="hljs-string">'è¯·æä¾›æ›´è¯¦ç»†çš„ä¿¡æ¯ä»¥ä¾¿è¿›è¡Œä¸“ä¸šåˆ†æã€‚'</span>;

  <span class="hljs-keyword">if</span> (missingMetrics.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`ä¸ºäº†æ›´å¥½åœ°è¿›è¡Œ<span class="hljs-subst">${PROMPT_TEMPLATES[topic]?.topic || <span class="hljs-string">'ä¸“ä¸š'</span>}</span>åˆ†æï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š<span class="hljs-subst">${missingMetrics.join(<span class="hljs-string">'ã€'</span>)}</span>ç›¸å…³çš„å…·ä½“æ•°æ®æˆ–æƒ…å†µã€‚`</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-string">`ä¸ºäº†æä¾›æ›´ç²¾å‡†çš„åˆ†æï¼Œèƒ½å¦åˆ†äº«æ›´å¤šå…³äº<span class="hljs-subst">${knowledge.keyMetrics.slice(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>).join(<span class="hljs-string">'ã€'</span>)}</span>çš„ä¿¡æ¯ï¼Ÿ`</span>;
}
</code></pre>
<p>æœ€åï¼Œåœ¨äº¤äº’è®¾è®¡ä¸Šï¼Œå‚è€ƒåä¸ºMateChatçš„å·¥å…·é›†æˆæ€è·¯ï¼Œåœ¨å¯¹è¯æµä¸­æ— ç¼åµŒå…¥é‡‘èå·¥å…·æ¨¡å—ã€‚ç”¨æˆ·å¯ä»¥åœ¨ä¸ä¸­æ–­å¯¹è¯çš„æƒ…å†µä¸‹ï¼Œç›´æ¥è°ƒç”¨å¤åˆ©è®¡ç®—å™¨è¿›è¡Œæ”¶ç›Šæµ‹ç®—ï¼Œä½¿ç”¨é£é™©è¯„ä¼°é—®å·è¿›è¡Œé£é™©æ‰¿å—èƒ½åŠ›è¯„ä¼°ï¼Œæˆ–è€…å¯åŠ¨æ”¶ç›Šæ¨¡æ‹Ÿå™¨è¿›è¡ŒæŠ•èµ„æƒ…æ™¯åˆ†æã€‚è¿™ç§æ·±åº¦é›†æˆçš„è®¾è®¡å¤§å¤§æå‡äº†ç”¨æˆ·ä½“éªŒå’Œæ“ä½œæ•ˆç‡ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52e15c94f8564173b4d27f27e1ac8b7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764917626&amp;x-signature=OjzurRLJWxkPJCBh%2FWSL9jtG4zY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49ff42d240d44f568096df8a29096705~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764917626&amp;x-signature=uaVTItrrPyfUcjcsVB1kXIlMSts%3D" alt="" loading="lazy"/></p>
<p>å½“ç„¶ï¼Œè¿˜å¯ä»¥è¿›ä¸€æ­¥åŸºäºç°æœ‰æ¶æ„è¿›è¡Œæ¨¡å—åŒ–æ‰©å±•ï¼Œæå‡é‡‘èåŠ©æ‰‹çš„ä¸“ä¸šæœåŠ¡èƒ½åŠ›ï¼š</p>
<ul>
<li>å®æ—¶è¡Œæƒ…ç›‘æ§åŠŸèƒ½ - é›†æˆè‚¡ç¥¨ã€åŸºé‡‘ã€æŒ‡æ•°çš„å®æ—¶ä»·æ ¼æ•°æ®ï¼Œæ”¯æŒè®¾ç½®ä»·æ ¼é¢„è­¦é˜ˆå€¼ï¼Œå½“æ ‡çš„è¾¾åˆ°ç›®æ ‡ä»·ä½æ—¶ä¸»åŠ¨æ¨é€æé†’ã€‚</li>
<li>è´¢æŠ¥æ™ºèƒ½è§£è¯»åŠŸèƒ½ - è‡ªåŠ¨è§£æä¸Šå¸‚å…¬å¸è´¢åŠ¡æŠ¥è¡¨ï¼Œæå–å…³é”®è´¢åŠ¡æ¯”ç‡ï¼Œè¿›è¡ŒåŒä¸šå¯¹æ¯”åˆ†æï¼Œç”Ÿæˆé€šä¿—æ˜“æ‡‚çš„è´¢åŠ¡å¥åº·åº¦æŠ¥å‘Šã€‚</li>
<li>å¸‚åœºæƒ…ç»ªåˆ†æåŠŸèƒ½ - æ•´åˆç½‘ç»œèˆ†æƒ…æ•°æ®ï¼Œè¿ç”¨è‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯åˆ†æå¸‚åœºæƒ…ç»ªæŒ‡æ•°ï¼Œä¸ºæŠ•èµ„å†³ç­–æä¾›å‚è€ƒä¾æ®ã€‚</li>
</ul>
<h2 data-id="heading-8">ä¸‰ã€æ€»ç»“</h2>
<p>åœ¨AIå¤§æ¨¡å‹æŠ€æœ¯è¿…çŒ›å‘å±•çš„èƒŒæ™¯ä¸‹ï¼Œè¯åˆ¸è¡Œä¸šæ­£ç»å†ç€ä»ä¼ ç»ŸæœåŠ¡æ¨¡å¼å‘æ™ºèƒ½åŒ–ã€ä¸ªæ€§åŒ–æœåŠ¡çš„æ·±åˆ»è½¬å‹ã€‚åä¸ºMateChatä½œä¸ºä¸šç•Œé¢†å…ˆçš„AIå¯¹è¯ç»„ä»¶åº“ï¼Œä»¥å…¶å®Œå–„çš„æŠ€æœ¯æ¶æ„å’Œçµæ´»çš„ç»„ä»¶åŒ–è®¾è®¡ï¼Œä¸ºè¯åˆ¸æ™ºèƒ½æŠ•é¡¾ç³»ç»Ÿçš„å¿«é€Ÿæ„å»ºæä¾›äº†ç†æƒ³çš„æŠ€æœ¯åŸºç¡€ã€‚</p>
<p>å…¶ä¸“ä¸ºGenAIå¯¹è¯æ‰“é€ çš„è¾“å…¥åŒºåŸŸæ”¯æŒå¤šæ¨¡æ€å†…å®¹è¾“å…¥å’Œä¸°å¯Œçš„æ‰©å±•åŠŸèƒ½ã€‚å¯é…ç½®çš„å¿«æ·æŒ‡ä»¤ã€æ¨¡æ¿åŒ–è¾“å…¥å’Œæ™ºèƒ½è¡¥å…¨èƒ½åŠ›ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿè‡ªç”±ã€å‡†ç¡®åœ°è¡¨è¾¾å¤æ‚éœ€æ±‚ã€‚è¾“å…¥åŒºåŸŸçš„æ¨¡å—åŒ–è®¾è®¡ä¾¿äºå¿«é€Ÿé€‚é…ä¸åŒä¸šåŠ¡çš„ç‰¹å®šéœ€æ±‚ï¼Œä¿æŒæ ¸å¿ƒä½“éªŒä¸€è‡´çš„åŒæ—¶æ”¯æŒçµæ´»æ‰©å±•ã€‚</p>
<p>åœ¨æ¢ç´¢è¿™ä¸€æŠ€æœ¯çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå‘ç°DevUIè®¾è®¡ç³»ç»Ÿä¸ºæ„å»ºé«˜è´¨é‡çš„ç”¨æˆ·ç•Œé¢æä¾›äº†å¼ºå¤§çš„æ”¯æŒã€‚DevUIä¸ä»…æä¾›äº†ä¸°å¯Œçš„ç»„ä»¶å’Œçµæ´»çš„å®šåˆ¶èƒ½åŠ›ï¼Œè¿˜æ³¨é‡è®¾è®¡çš„ä¸€è‡´æ€§å’Œç”¨æˆ·ä½“éªŒï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°å®ç°é‡‘èé¢†åŸŸçš„å¤æ‚äº¤äº’éœ€æ±‚ã€‚å¦‚æœä½ å¯¹MateChatæ¡†æ¶çš„æ·±åº¦åº”ç”¨æ„Ÿå…´è¶£ï¼Œæˆ–è€…æƒ³äº†è§£å¦‚ä½•é€šè¿‡DevUIæ‰“é€ æ›´ä¼˜è´¨çš„ç”¨æˆ·äº¤äº’ä½“éªŒï¼Œæ·±å…¥äº†è§£DevUIçš„ä¸°å¯Œç»„ä»¶å’Œè®¾è®¡ç†å¿µï¼Œä¸å¦¨å…³æ³¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fmatechat.gitcode.com%2F" target="_blank" title="https://matechat.gitcode.com/" ref="nofollow noopener noreferrer">MateChatå®˜ç½‘</a>å’Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevui.design%2F" target="_blank" title="https://devui.design/" ref="nofollow noopener noreferrer">DevUIå®˜ç½‘</a>ï¼Œè·å–æ›´å¤šå®ç”¨ä¿¡æ¯å’ŒæŠ€æœ¯æ”¯æŒï¼Œå…±åŒæ¨åŠ¨é‡‘èç§‘æŠ€çš„åˆ›æ–°ä¸å‘å±•ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e348041bbb5482992d97d9356949f02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lit5p2v5Y-v5LmQ5aSa5Yqg5Yaw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764917626&amp;x-signature=WRWzO2dn3s%2FqxOpjqJn6IlU0754%3D" alt="" loading="lazy"/></p>
<p>å±•æœ›æœªæ¥ï¼Œéšç€å¤šæ¨¡æ€äº¤äº’ã€å®æ—¶æ•°æ®å¤„ç†ç­‰æŠ€æœ¯çš„æŒç»­æ¼”è¿›ï¼ŒMateChatå°†åœ¨æ™ºèƒ½æŠ•é¡¾é¢†åŸŸå±•ç°å‡ºæ›´å¤§æ½œåŠ›ï¼Œåä¸ºMateChatæœ‰æœ›æˆä¸ºè¿æ¥AIæŠ€æœ¯ä¸é‡‘èæœåŠ¡çš„é‡è¦æ¡¥æ¢ï¼Œæ¨åŠ¨æ•´ä¸ªè¡Œä¸šå‘æ™ºèƒ½åŒ–ã€ä¸ªæ€§åŒ–æœåŠ¡çš„æ–°é˜¶æ®µè¿ˆè¿›ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>