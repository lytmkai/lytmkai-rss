<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[PromiseResolveThenableJobTask 微任务是怎么被执行的]]></title>    <link>https://juejin.cn/post/7579450578293719082</link>    <guid>https://juejin.cn/post/7579450578293719082</guid>    <pubDate>2025-12-03T11:11:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579450578293719082" data-draft-id="7578582010417020934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PromiseResolveThenableJobTask 微任务是怎么被执行的"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-03T11:11:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="之恒君"/> <meta itemprop="url" content="https://juejin.cn/user/2261046026312318"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PromiseResolveThenableJobTask 微任务是怎么被执行的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2261046026312318/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    之恒君
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T11:11:18.000Z" title="Wed Dec 03 2025 11:11:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h3 data-id="heading-0">背景</h3>
<p>要理解 <code>NewPromiseResolveThenableJobTask</code> 这个微任务的作用，需要先回到它的<strong>创建场景</strong>：当一个 Promise 的 <code>then</code> 回调（或其他 Promise 相关回调）返回了一个 <strong>可 thenable 对象</strong>（通常是另一个 Promise，但也包括自定义的、有 <code>then</code> 方法的对象）时，JS 引擎会创建这个微任务，本质是为了 <strong>确保 “返回的 thenable 对象” 的状态完全确定后，再继续执行后续的 Promise 链</strong>。</p>
<p>如下代码，后续讨论依托于此段代码展开：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>() 
.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0</span>); 
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">4</span>); 
}) 
.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res); 
});
</code></pre>
<h3 data-id="heading-1">先明确前提：为什么需要这个微任务？</h3>
<p>Promise 链的核心规则是 “<strong>后续的 then 回调，必须等待前一个 then 回调的 “返回值” 状态确定后才执行</strong>”。如果前一个 then 回调返回的是一个<strong>普通值</strong>（比如 4、'a'），那很简单：直接把这个普通值作为下一个 Promise 的 “成功值”，立刻触发下一个 then 的微任务。</p>
<p>但如果返回的是一个<strong>Promise（或可 thenable 对象）</strong> （比如代码中 <code>return Promise.resolve(4)</code>），情况就复杂了：这个返回的 Promise 本身是 “异步状态”（即使是 <code>Promise.resolve(4)</code> 这种 “立即成功” 的，也不是同步执行），<strong>必须等待它的 <code>then</code> 回调执行完（状态完全确定），才能把它的结果传给下一个 then</strong>。</p>
<p>这时候，<code>NewPromiseResolveThenableJobTask</code> 就是用来干这个 “<strong>等待并传递结果</strong>” 的活的。</p>
<h3 data-id="heading-2"><code>NewPromiseResolveThenableJobTask</code> 微任务具体做什么？</h3>
<p>它的执行逻辑可以拆解为 3 个核心步骤，本质是 “<strong>代理执行返回的 thenable 对象的 then 方法，并把结果同步给当前 Promise 链</strong>”：</p>
<h4 data-id="heading-3">1. 先明确这个微任务的 “3 个输入参数”</h4>
<p>在创建这个微任务时，引擎会传入 3 个关键信息（对应 ECMA 规范的定义: <a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fecma262%2Fmultipage%2Fcontrol-abstraction-objects.html%23sec-newpromiseresolvethenablejob" target="_blank" title="https://tc39.es/ecma262/multipage/control-abstraction-objects.html#sec-newpromiseresolvethenablejob" ref="nofollow noopener noreferrer">#sec-newpromiserelovethenablejobtask</a>）：</p>
<ul>
<li><code>promiseToResolve</code>：当前 Promise 链中的 “中间 Promise”（即前一个 <code>then</code> 执行后返回的新 Promise，后续的 <code>then</code> 都是挂在这个 Promise 上的）。</li>
<li><code>thenable</code>：前一个 <code>then</code> 回调返回的 “可 thenable 对象”（比如代码中 <code>return Promise.resolve(4)</code> 里的这个 Promise）。</li>
<li><code>then</code>：<code>thenable</code> 对象自身的 <code>then</code> 方法（比如 Promise 原型上的 <code>Promise.prototype.then</code>）。</li>
</ul>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">const</span> promiseToResolve = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> { 
        <span class="hljs-keyword">return</span> [[thenable 对象]]: { 
            [[then 方法]]: <span class="hljs-function">(<span class="hljs-params">onFulfilled, onRejected</span>) =&gt;</span> {}
        }
     })
</code></pre>
<h4 data-id="heading-4">2. 微任务执行的核心逻辑</h4>
<p>当这个微任务被执行时，会干两件关键的事：</p>
<h5 data-id="heading-5">第一步：调用 <code>thenable</code> 的 <code>then</code> 方法，绑定 “结果传递回调”</h5>
<p>微任务会主动调用 <code>thenable.then(...)</code>，并传入两个回调函数（相当于 “代理回调”）：</p>
<ul>
<li>成功回调（<code>onFulfilled</code>）：如果 <code>thenable</code> 成功（比如 <code>Promise.resolve(4)</code> 成功），就会触发这个回调，把 <code>thenable</code> 的成功值（比如 4）传给 <code>promiseToResolve</code>，让 <code>promiseToResolve</code> 也变成 “成功状态”，并把 4 作为它的成功值。</li>
<li>失败回调（<code>onRejected</code>）：如果 <code>thenable</code> 失败（比如 <code>Promise.reject(5)</code>），就会触发这个回调，把 <code>thenable</code> 的失败原因传给 <code>promiseToResolve</code>，让 <code>promiseToResolve</code> 变成 “失败状态”。</li>
</ul>
<h5 data-id="heading-6">第二步：触发后续的 Promise 链</h5>
<p>一旦 <code>promiseToResolve</code> 的状态被确定（成功 / 失败），引擎就会为 <code>promiseToResolve</code> 上挂载的后续 <code>then</code> 回调（比如代码中第二个 <code>then((res) =&gt; console.log(res))</code>）创建新的微任务，把刚才传递过来的结果（比如 4）传给这个后续回调，让 Promise 链继续执行。</p>
<h3 data-id="heading-7">结合代码，看这个微任务的具体作用</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>() <span class="hljs-comment">// 1. 初始 Promise（成功状态，值为 undefined）</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// 2. 第一个 then 回调（cb1）</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// 3. 同步打印 0</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">4</span>); <span class="hljs-comment">// 4. 返回一个新的 Promise（记为 P4）</span>
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> { <span class="hljs-comment">// 5. 第二个 then 回调（cb2，挂在 “中间 Promise”:P_mid 上）</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res); <span class="hljs-comment">// 6. 最终打印 4</span>
  });
</code></pre>
<p>这里 <code>NewPromiseResolveThenableJobTask</code> 的执行过程完全贴合上面的逻辑：</p>
<ol>
<li>
<p>执行 <code>cb1</code> 时，返回了 <code>Promise.resolve(4)</code>（即 <code>thenable = P4</code>），引擎创建 <code>NewPromiseResolveThenableJobTask</code> 微任务，传入：</p>
<ul>
<li><code>promiseToResolve = P_mid</code>（第一个 then 返回的中间 Promise，cb2 挂在它上面）</li>
<li><code>thenable = P4</code></li>
<li><code>then = P4.then</code>（即 Promise 原型的 then 方法）。</li>
</ul>
</li>
<li>
<p>当这个微任务执行时：</p>
<ul>
<li>调用 <code>P4.then(成功回调, 失败回调)</code>：因为 <code>P4</code> 是 <code>Promise.resolve(4)</code>（已成功），触发 <code>PromiseResolveThenableJobTask</code>的执行流程（重点）。</li>
<li>“成功回调” 把 <code>4</code> 传给 <code>P_mid</code>，让 <code>P_mid</code> 变成 “成功状态”，值为 4。</li>
<li>引擎为 <code>P_mid</code> 上的 <code>cb2</code> 创建新微任务，后续执行这个微任务时，就会把 <code>4</code> 传给 <code>cb2</code>，打印出 <code>4</code>。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">重点核心(<code>PromiseResolveThenableJobTask</code>被执行)：</h3>
<p><code>PromiseResolveThenableJobTask</code> 的被执行过程，<a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fecma262%2F%23sec-promiseresolvethenablejob" target="_blank" title="https://tc39.es/ecma262/#sec-promiseresolvethenablejob" ref="nofollow noopener noreferrer">esma 规范</a> 的描述</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e37d6ffb8944eb187e2556ba66f587a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmL5oGS5ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765365233&amp;x-signature=KUVzZExvKAonI9q7VjsNpAKvsvE%3D" alt="image.png" loading="lazy"/></p>
<p><em>其实它规定了这个 <code>PromiseResolveThenableJobTask</code> 要作为异步任务去执行（加入任务队列）；</em></p>
<p><em>和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromium.googlesource.com%2Fv8%2Fv8.git%2F%2B%2Frefs%2Fheads%2F14.4-lkgr%2Fsrc%2Fbuiltins%2Fpromise-resolve.tq%23177" target="_blank" title="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/14.4-lkgr/src/builtins/promise-resolve.tq#177" ref="nofollow noopener noreferrer">v8::builtins::promise-resolve.tq</a> 的处理是一样的。v8 把 它加入了 微任务队列</em></p>
<p>但是，这个任务后续的被执行，就没有说了，规范上我并没有找到；</p>
<p>但是，看了 <code>PromiseResolveThenableJobTask</code> 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromium.googlesource.com%2Fv8%2Fv8.git%2F%2B%2Frefs%2Fheads%2F14.4-lkgr%2Fsrc%2Fbuiltins%2Fpromise-jobs.tq%2328" target="_blank" title="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/14.4-lkgr/src/builtins/promise-jobs.tq#28" ref="nofollow noopener noreferrer">v8 具体实现</a>,
它分了两种情况来处理的：</p>
<ol>
<li><code>thenable对象</code> 是 <code>Promise对象</code>时；执行 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromium.googlesource.com%2Fv8%2Fv8.git%2F%2B%2Frefs%2Fheads%2F14.4-lkgr%2Fsrc%2Fbuiltins%2Fpromise-abstract-operations.tq%23508" target="_blank" title="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/14.4-lkgr/src/builtins/promise-abstract-operations.tq#508" ref="nofollow noopener noreferrer">PerformPromiseThen</a>的实现方式；
<ul>
<li>如果 promise 是 <code>pendding</code> 态，会创建一个 <code>NewPromiseReaction</code> 任务， 等待 promise 兑现；</li>
<li>如果 promise 是 <code>fulfiled</code>|<code>rejected</code>, 则会创建一个微任务，加入到微任务队列，等待执行；</li>
</ul>
</li>
<li><code>thenable对象</code> 是 <code>非Promise 对象</code>时；直接走 resolve function 逻辑；
<ul>
<li>直接调用 resolve(结果)，兑现 promise;</li>
</ul>
</li>
</ol>
<p>如图(<a href="https://link.juejin.cn?target=https%3A%2F%2Fchromium.googlesource.com%2Fv8%2Fv8.git%2F%2B%2Frefs%2Fheads%2F14.4-lkgr%2Fsrc%2Fbuiltins%2Fpromise-jobs.tq%2328" target="_blank" title="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/14.4-lkgr/src/builtins/promise-jobs.tq#28" ref="nofollow noopener noreferrer"><code>PromiseResolveThenableJob</code></a>):</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12cbf9ca5ea44c9f9a41933e9d670198~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmL5oGS5ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765365233&amp;x-signature=F27dN0gDrw%2FidAUbTdwGNqQnPW0%3D" alt="image.png" loading="lazy"/></p>
<p>如图（<a href="https://link.juejin.cn?target=https%3A%2F%2Fchromium.googlesource.com%2Fv8%2Fv8.git%2F%2B%2Frefs%2Fheads%2F14.4-lkgr%2Fsrc%2Fbuiltins%2Fpromise-abstract-operations.tq%23451" target="_blank" title="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/14.4-lkgr/src/builtins/promise-abstract-operations.tq#451" ref="nofollow noopener noreferrer"><code>PerformPromiseThenImpl</code></a>）：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a0e5699cb6846e692ba2554f4123b48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmL5oGS5ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765365233&amp;x-signature=0G%2BZ4AM5goEztVrqTjgVpDH2aGw%3D" alt="image.png" loading="lazy"/></p>
<p>也就是说，以下两段代码输出的结果是不一样的：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">4</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
  });

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">5</span>);
  });
  
<span class="hljs-comment">// 输出：0,1,2,3,4,5 </span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> {
      <span class="hljs-title function_">then</span>(<span class="hljs-params">onFulfilled, onRejected</span>) {
        <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-number">4</span>);
      },
    };
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
  });

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">5</span>);
  });

<span class="hljs-comment">// 输出：0,1,2,4,3,5</span>

</code></pre>
<h3 data-id="heading-9">一句话总结</h3>
<p><code>NewPromiseResolveThenableJobTask</code> 就是一个 “<strong>结果传递代理微任务</strong>”：专门处理 “then 回调返回 thenable 对象” 的场景，确保这个 thenable 对象的状态确定后，把它的结果同步给当前 Promise 链的中间 Promise，再触发后续的 then 回调，保证 Promise 链的顺序和状态正确性。</p>
<p><strong>注意的点是：</strong></p>
<p>thenable对象是 Promise对象 和 普通包含实现 then 方法的对象，<code>PromiseResolveThenableJobTask</code> 的处理方式是不一样的；</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue2简单实现一个权限管理]]></title>    <link>https://juejin.cn/post/7579264485259575311</link>    <guid>https://juejin.cn/post/7579264485259575311</guid>    <pubDate>2025-12-03T12:12:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579264485259575311" data-draft-id="7579088065697447976" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue2简单实现一个权限管理"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-12-03T12:12:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Aniugel"/> <meta itemprop="url" content="https://juejin.cn/user/3034307824198407"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue2简单实现一个权限管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307824198407/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Aniugel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T12:12:53.000Z" title="Wed Dec 03 2025 12:12:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>以下是基于 Vue2 实现的<strong>基础权限管理方案</strong>，涵盖<strong>路由权限控制、按钮权限控制、指令封装</strong>等核心功能，适合中小型后台系统：</p>
<h3 data-id="heading-0">一、权限数据设计</h3>
<p>首先定义用户权限结构（通常从后端接口获取）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/store/modules/auth.js</span>
<span class="hljs-keyword">const</span> state = {
  <span class="hljs-comment">// 用户角色（如 ['admin', 'editor']）</span>
  <span class="hljs-attr">roles</span>: [],
  <span class="hljs-comment">// 用户拥有的权限码（如 ['user:add', 'user:edit']）</span>
  <span class="hljs-attr">permissions</span>: []
};

<span class="hljs-keyword">const</span> mutations = {
  <span class="hljs-title function_">SET_ROLES</span>(<span class="hljs-params">state, roles</span>) {
    state.<span class="hljs-property">roles</span> = roles;
  },
  <span class="hljs-title function_">SET_PERMISSIONS</span>(<span class="hljs-params">state, permissions</span>) {
    state.<span class="hljs-property">permissions</span> = permissions;
  }
};

<span class="hljs-keyword">const</span> actions = {
  <span class="hljs-comment">// 模拟从后端获取权限（实际项目中替换为接口请求）</span>
  <span class="hljs-title function_">getAuth</span>(<span class="hljs-params">{ commit }</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      <span class="hljs-comment">// 假设后端返回的权限数据</span>
      <span class="hljs-keyword">const</span> authData = {
        <span class="hljs-attr">roles</span>: [<span class="hljs-string">'editor'</span>],
        <span class="hljs-attr">permissions</span>: [<span class="hljs-string">'dashboard:view'</span>, <span class="hljs-string">'user:view'</span>, <span class="hljs-string">'user:edit'</span>]
      };
      <span class="hljs-title function_">commit</span>(<span class="hljs-string">'SET_ROLES'</span>, authData.<span class="hljs-property">roles</span>);
      <span class="hljs-title function_">commit</span>(<span class="hljs-string">'SET_PERMISSIONS'</span>, authData.<span class="hljs-property">permissions</span>);
      <span class="hljs-title function_">resolve</span>();
    });
  }
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">namespaced</span>: <span class="hljs-literal">true</span>,
  state,
  mutations,
  actions
};
</code></pre>
<h3 data-id="heading-1">二、路由权限控制</h3>
<p>通过<strong>路由守卫</strong>过滤无权限的路由，结合<code>VueRouter</code>的动态路由添加：</p>
<h4 data-id="heading-2">1. 定义路由规则（区分公开 / 私有路由）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/router/index.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store'</span>;

<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Router</span>);

<span class="hljs-comment">// 公开路由（无需权限）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> constantRoutes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/login'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/login'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/404'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/404'</span>)
  }
];

<span class="hljs-comment">// 私有路由（需权限）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> asyncRoutes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/layout'</span>),
    <span class="hljs-attr">redirect</span>: <span class="hljs-string">'/dashboard'</span>,
    <span class="hljs-attr">children</span>: [
      {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'dashboard'</span>,
        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/dashboard'</span>),
        <span class="hljs-attr">meta</span>: { 
          <span class="hljs-attr">title</span>: <span class="hljs-string">'首页'</span>, 
          <span class="hljs-attr">roles</span>: [<span class="hljs-string">'admin'</span>, <span class="hljs-string">'editor'</span>], <span class="hljs-comment">// 需要的角色</span>
          <span class="hljs-attr">permissions</span>: [<span class="hljs-string">'dashboard:view'</span>] <span class="hljs-comment">// 需要的权限码</span>
        }
      }
    ]
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/layout'</span>),
    <span class="hljs-attr">children</span>: [
      {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'list'</span>,
        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/user/list'</span>),
        <span class="hljs-attr">meta</span>: { 
          <span class="hljs-attr">title</span>: <span class="hljs-string">'用户列表'</span>, 
          <span class="hljs-attr">permissions</span>: [<span class="hljs-string">'user:view'</span>] 
        }
      },
      {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'edit/:id'</span>,
        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/user/edit'</span>),
        <span class="hljs-attr">meta</span>: { 
          <span class="hljs-attr">title</span>: <span class="hljs-string">'编辑用户'</span>, 
          <span class="hljs-attr">permissions</span>: [<span class="hljs-string">'user:edit'</span>] 
        }
      }
    ]
  },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'*'</span>, <span class="hljs-attr">redirect</span>: <span class="hljs-string">'/404'</span>, <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span> }
];

<span class="hljs-keyword">const</span> <span class="hljs-title function_">createRouter</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>({
  <span class="hljs-attr">routes</span>: constantRoutes
});

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>();

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router;
</code></pre>
<h4 data-id="heading-3">2. 路由守卫实现权限过滤</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/permission.js</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'./store'</span>;
<span class="hljs-keyword">import</span> { asyncRoutes, constantRoutes } <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>;

<span class="hljs-comment">// 权限判断函数：检查是否有角色/权限</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">hasPermission</span>(<span class="hljs-params">roles, permissions, route</span>) {
  <span class="hljs-keyword">if</span> (route.<span class="hljs-property">meta</span> &amp;&amp; route.<span class="hljs-property">meta</span>.<span class="hljs-property">roles</span>) {
    <span class="hljs-comment">// 角色校验</span>
    <span class="hljs-keyword">return</span> roles.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">role</span> =&gt;</span> route.<span class="hljs-property">meta</span>.<span class="hljs-property">roles</span>.<span class="hljs-title function_">includes</span>(role));
  }
  <span class="hljs-keyword">if</span> (route.<span class="hljs-property">meta</span> &amp;&amp; route.<span class="hljs-property">meta</span>.<span class="hljs-property">permissions</span>) {
    <span class="hljs-comment">// 权限码校验</span>
    <span class="hljs-keyword">return</span> permissions.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">perm</span> =&gt;</span> route.<span class="hljs-property">meta</span>.<span class="hljs-property">permissions</span>.<span class="hljs-title function_">includes</span>(perm));
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 无权限配置则默认可见</span>
}

<span class="hljs-comment">// 过滤私有路由</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">filterAsyncRoutes</span>(<span class="hljs-params">routes, roles, permissions</span>) {
  <span class="hljs-keyword">const</span> res = [];
  routes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">route</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> tmp = { ...route };
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasPermission</span>(roles, permissions, tmp)) {
      <span class="hljs-keyword">if</span> (tmp.<span class="hljs-property">children</span>) {
        tmp.<span class="hljs-property">children</span> = <span class="hljs-title function_">filterAsyncRoutes</span>(tmp.<span class="hljs-property">children</span>, roles, permissions);
      }
      res.<span class="hljs-title function_">push</span>(tmp);
    }
  });
  <span class="hljs-keyword">return</span> res;
}

router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> (to, <span class="hljs-keyword">from</span>, next) =&gt; {
  <span class="hljs-comment">// 模拟已登录（实际项目中用token判断）</span>
  <span class="hljs-keyword">const</span> hasToken = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">if</span> (hasToken) {
    <span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> === <span class="hljs-string">'/login'</span>) {
      <span class="hljs-title function_">next</span>({ <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span> });
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 判断是否已获取权限</span>
      <span class="hljs-keyword">const</span> hasRoles = store.<span class="hljs-property">getters</span>[<span class="hljs-string">'auth/roles'</span>].<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;
      <span class="hljs-keyword">if</span> (hasRoles) {
        <span class="hljs-title function_">next</span>();
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// 获取权限数据</span>
          <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">'auth/getAuth'</span>);
          <span class="hljs-keyword">const</span> roles = store.<span class="hljs-property">getters</span>[<span class="hljs-string">'auth/roles'</span>];
          <span class="hljs-keyword">const</span> permissions = store.<span class="hljs-property">getters</span>[<span class="hljs-string">'auth/permissions'</span>];
          <span class="hljs-comment">// 过滤并添加动态路由</span>
          <span class="hljs-keyword">const</span> accessedRoutes = <span class="hljs-title function_">filterAsyncRoutes</span>(asyncRoutes, roles, permissions);
          router.<span class="hljs-title function_">addRoutes</span>(accessedRoutes);
          <span class="hljs-comment">// 确保路由添加完成后跳转</span>
          <span class="hljs-title function_">next</span>({ ...to, <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> });
        } <span class="hljs-keyword">catch</span> (err) {
          <span class="hljs-title function_">next</span>(<span class="hljs-string">`/login?redirect=<span class="hljs-subst">${to.path}</span>`</span>);
        }
      }
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 未登录则跳转登录页</span>
    <span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> === <span class="hljs-string">'/login'</span>) {
      <span class="hljs-title function_">next</span>();
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">next</span>(<span class="hljs-string">`/login?redirect=<span class="hljs-subst">${to.path}</span>`</span>);
    }
  }
});
</code></pre>
<h3 data-id="heading-4">三、按钮权限控制</h3>
<p>通过<strong>自定义指令</strong>实现按钮级别的权限控制：</p>
<h4 data-id="heading-5">1. 注册权限指令</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/directives/permission.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store'</span>;

<span class="hljs-comment">/**
 * v-permission: 按钮权限指令
 * 使用：&lt;button v-permission="'user:add'"&gt;新增&lt;/button&gt;
 */</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">'permission'</span>, {
  <span class="hljs-title function_">inserted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> { value } = binding;
    <span class="hljs-keyword">const</span> permissions = store.<span class="hljs-property">getters</span>[<span class="hljs-string">'auth/permissions'</span>];
    <span class="hljs-comment">// 校验权限（支持数组：v-permission="['user:add', 'user:edit']"）</span>
    <span class="hljs-keyword">if</span> (value) {
      <span class="hljs-keyword">const</span> hasPerm = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value) 
        ? permissions.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">perm</span> =&gt;</span> value.<span class="hljs-title function_">includes</span>(perm)) 
        : permissions.<span class="hljs-title function_">includes</span>(value);
      <span class="hljs-keyword">if</span> (!hasPerm) {
        el.<span class="hljs-property">parentNode</span> &amp;&amp; el.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">removeChild</span>(el); <span class="hljs-comment">// 无权限则移除元素</span>
      }
    }
  }
});

<span class="hljs-comment">/**
 * v-role: 角色权限指令
 * 使用：&lt;button v-role="'admin'"&gt;管理员按钮&lt;/button&gt;
 */</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">'role'</span>, {
  <span class="hljs-title function_">inserted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> { value } = binding;
    <span class="hljs-keyword">const</span> roles = store.<span class="hljs-property">getters</span>[<span class="hljs-string">'auth/roles'</span>];
    <span class="hljs-keyword">if</span> (value) {
      <span class="hljs-keyword">const</span> hasRole = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value) 
        ? roles.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">role</span> =&gt;</span> value.<span class="hljs-title function_">includes</span>(role)) 
        : roles.<span class="hljs-title function_">includes</span>(value);
      <span class="hljs-keyword">if</span> (!hasRole) {
        el.<span class="hljs-property">parentNode</span> &amp;&amp; el.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">removeChild</span>(el);
      }
    }
  }
});
</code></pre>
<h4 data-id="heading-6">2. 全局引入指令</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/main.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>;
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'./store'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./directives/permission'</span>; <span class="hljs-comment">// 引入权限指令</span>

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  router,
  store,
  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>)
}).$mount(<span class="hljs-string">'#app'</span>);
</code></pre>
<h3 data-id="heading-7">四、页面中使用权限控制</h3>
<pre><code class="hljs language-javascript" lang="javascript">&lt;!-- src/views/user/list.<span class="hljs-property">vue</span> --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>用户列表<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 按钮权限控制：只有user:add权限才显示 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-permission</span>=<span class="hljs-string">"'user:add'"</span>&gt;</span>新增用户<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 角色控制：只有admin角色才显示 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-role</span>=<span class="hljs-string">"'admin'"</span>&gt;</span>删除用户<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 表格内容 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-table</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"userList"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-table-column</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"操作"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">"scope"</span>&gt;</span>
          <span class="hljs-comment">&lt;!-- 编辑权限控制 --&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">v-permission</span>=<span class="hljs-string">"'user:edit'"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"editUser(scope.row)"</span>&gt;</span>编辑<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-table-column</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-8">五、核心功能总结</h3>
<ol>
<li><strong>路由权限</strong>：通过<code>router.addRoutes</code>动态添加有权限的路由，结合<code>beforeEach</code>守卫过滤无权限页面；</li>
<li><strong>按钮权限</strong>：自定义<code>v-permission</code>/<code>v-role</code>指令，无权限时自动移除 DOM 元素；</li>
<li><strong>权限存储</strong>：通过 Vuex 管理用户角色和权限码，支持从后端动态获取。</li>
</ol>
<h3 data-id="heading-9">扩展建议</h3>
<ul>
<li>实际项目中，权限数据需从后端接口获取（如登录后返回）；</li>
<li>可结合<code>vue-i18n</code>实现权限相关文案的国际化；</li>
<li>复杂场景可增加 “数据权限”（如用户只能查看自己创建的数据），通过接口参数过滤。</li>
</ul>
<p>这套方案轻量且易扩展，适合 Vue2 项目的基础权限管理需求。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[系统性整理组件传参14种方式]]></title>    <link>https://juejin.cn/post/7579264485259591695</link>    <guid>https://juejin.cn/post/7579264485259591695</guid>    <pubDate>2025-12-03T12:15:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579264485259591695" data-draft-id="7579385656780390434" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="系统性整理组件传参14种方式"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-03T12:15:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="乐无止境"/> <meta itemprop="url" content="https://juejin.cn/user/957017941879235"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            系统性整理组件传参14种方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/957017941879235/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    乐无止境
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T12:15:03.000Z" title="Wed Dec 03 2025 12:15:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">标题前言：</h2>
<p>在面试时被问到组件传参的方式没有答的很完整全面，在经过很多面试之后发现，面试的回答已经不在于你是否答出来，更高的一个level是要答全，答出其他面试者答不出来的，得有自己的一个框架，于是系统性整理了14种方式
<strong>系统化梳理每一种方式的原理、用法、适用场景、优缺点及注意事项</strong>，并标注其在 <strong>Vue 2 vs Vue 3</strong> 中的支持情况，帮助你全面掌握。</p>
<hr/>
<h2 data-id="heading-1">📚 Vue 组件传参与通信方式全解析（14 种）</h2>
<blockquote>
<p>✅ 表示推荐 / 安全<br/>
⚠️ 表示谨慎使用<br/>
❌ 表示已废弃 / 不推荐</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">1. <strong>props</strong>（✅ 推荐）</h3>
<ul>
<li><strong>方向</strong>：父 → 子</li>
<li><strong>原理</strong>：声明式属性传递，单向数据流</li>
<li><strong>Vue 2/3</strong>：✅ 全支持</li>
<li><strong>示例</strong>：
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 父 --&gt;
&lt;Child :title="msg" /&gt;
&lt;!-- 子 --&gt;
defineProps({ title: String })
</code></pre>
</li>
<li><strong>优点</strong>：清晰、类型安全、可预测</li>
<li><strong>注意</strong>：不要直接修改 prop（Vue 会警告）</li>
</ul>
<hr/>
<h3 data-id="heading-3">2. <strong>$emit / v-on</strong>（✅ 推荐）</h3>
<ul>
<li><strong>方向</strong>：子 → 父</li>
<li><strong>原理</strong>：子组件触发自定义事件，父组件监听</li>
<li><strong>Vue 2</strong>：<code>this.$emit('event', data)</code></li>
<li><strong>Vue 3</strong>：<code>const emit = defineEmits(['event'])</code></li>
<li><strong>示例</strong>：
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 子 --&gt;
emit('update', newValue)
&lt;!-- 父 --&gt;
&lt;Child @update="handle" /&gt;
</code></pre>
</li>
<li><strong>优点</strong>：解耦、符合事件驱动思想</li>
</ul>
<hr/>
<h3 data-id="heading-4">3. <strong>.sync 修饰符</strong>（⚠️ Vue 2 专用，Vue 3 已移除）</h3>
<ul>
<li><strong>原理</strong>：语法糖，等价于 <code>:prop + @update:prop</code></li>
<li><strong>Vue 2 示例</strong>：
<pre><code class="hljs language-vue" lang="vue">&lt;Child :title.sync="pageTitle" /&gt;
&lt;!-- 子组件需 emit('update:title', newTitle) --&gt;
</code></pre>
</li>
<li><strong>Vue 3</strong>：❌ 不支持，改用 <code>v-model:propName</code></li>
<li><strong>替代方案</strong>：多 <code>v-model</code>（见第 4 条）</li>
</ul>
<hr/>
<h3 data-id="heading-5">4. <strong>v-model</strong>（✅ 推荐，Vue 3 增强）</h3>
<ul>
<li><strong>原理</strong>：双向绑定语法糖</li>
<li><strong>Vue 2</strong>：仅支持单个 <code>value</code> + <code>input</code> 事件</li>
<li><strong>Vue 3</strong>：支持多个 <code>v-model:propName</code>
<pre><code class="hljs language-vue" lang="vue">&lt;Child v-model:name="userName" v-model:age="userAge" /&gt;
&lt;!-- 子组件需 emit('update:name', ...) --&gt;
</code></pre>
</li>
<li><strong>优点</strong>：简洁、语义清晰，适合表单控件</li>
</ul>
<hr/>
<h3 data-id="heading-6">5. <strong>ref</strong>（✅ 有限推荐）</h3>
<ul>
<li><strong>方向</strong>：父 → 子（获取子实例或 DOM）</li>
<li><strong>原理</strong>：通过 <code>ref</code> 引用子组件实例，直接调用方法或访问数据</li>
<li><strong>示例</strong>：
<pre><code class="hljs language-vue" lang="vue">&lt;Child ref="childRef" /&gt;
// 父组件中：this.$refs.childRef.doSomething()（Vue 2）
// Vue 3：const childRef = ref(); childRef.value.doSomething()
</code></pre>
</li>
<li><strong>适用场景</strong>：调用子组件方法（如 focus、validate）</li>
<li><strong>⚠️ 注意</strong>：破坏封装性，应避免读写子组件内部状态</li>
</ul>
<hr/>
<h3 data-id="heading-7">6. <strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>i</mi><mi>l</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">children / </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">hi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">d</span><span class="mord mathnormal">re</span><span class="mord mathnormal">n</span><span class="mord">/</span></span></span></span></span>parent</strong>（❌ 不推荐）</h3>
<ul>
<li><strong>原理</strong>：直接访问父子组件实例</li>
<li><strong>问题</strong>：
<ul>
<li><code>$children</code> 顺序不确定</li>
<li>破坏组件独立性</li>
<li>难以维护和测试</li>
</ul>
</li>
<li><strong>Vue 3</strong>：❌ <code>$children</code> 已移除，<code>$parent</code> 仍存在但不鼓励使用</li>
<li><strong>替代方案</strong>：props / emits / provide-inject</li>
</ul>
<hr/>
<h3 data-id="heading-8">7. <strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>s</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">attrs / </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">a</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">rs</span><span class="mord">/</span></span></span></span></span>listeners</strong>（✅ Vue 2；Vue 3 合并为 <code>$attrs</code>）</h3>
<ul>
<li><strong>用途</strong>：透传未声明的 props 和事件（常用于高阶组件、包装组件）</li>
<li><strong>Vue 2</strong>：
<ul>
<li><code>$attrs</code>：未被 props 声明的 attribute</li>
<li><code>$listeners</code>：所有 <code>v-on</code> 事件监听器</li>
</ul>
</li>
<li><strong>Vue 3</strong>：<code>$listeners</code> 被合并进 <code>$attrs</code>（包含 <code>onXxx</code> 事件）</li>
<li><strong>典型用法</strong>：封装第三方 UI 组件
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Wrapper.vue --&gt;
&lt;el-input v-bind="$attrs" v-on="$listeners" /&gt;
</code></pre>
</li>
</ul>
<hr/>
<h3 data-id="heading-9">8. <strong>provide / inject</strong>（✅ 推荐）</h3>
<ul>
<li><strong>方向</strong>：祖先 → 后代（跨多层）</li>
<li><strong>原理</strong>：依赖注入，类似 React Context</li>
<li><strong>响应式</strong>：需传递 <code>ref</code> 或 <code>reactive</code> 对象
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 祖先</span>
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'theme'</span>, themeRef)
<span class="hljs-comment">// 后代</span>
<span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'theme'</span>)
</code></pre>
</li>
<li><strong>适用</strong>：主题、语言、用户信息等全局配置</li>
<li><strong>Vue 2/3</strong>：✅ 支持（Vue 3 更简洁）</li>
</ul>
<hr/>
<h3 data-id="heading-10">9. <strong>EventBus（事件总线）</strong>（⚠️ 谨慎使用）</h3>
<ul>
<li><strong>原理</strong>：基于发布-订阅模式的全局通信</li>
<li><strong>实现</strong>：
<ul>
<li>Vue 2：<code>new Vue()</code> 作事件中心</li>
<li>Vue 3：需引入 <code>mitt</code> 等库</li>
</ul>
</li>
<li><strong>问题</strong>：
<ul>
<li>难以追踪数据流</li>
<li>容易内存泄漏（忘记 off）</li>
<li>不利于大型项目维护</li>
</ul>
</li>
<li><strong>建议</strong>：仅用于小型项目或临时解耦，<strong>优先用 Pinia</strong></li>
</ul>
<hr/>
<h3 data-id="heading-11">10. <strong>Vuex / Pinia（状态管理）</strong>（✅ 大型项目推荐）</h3>
<ul>
<li><strong>原理</strong>：集中式状态管理</li>
<li><strong>Vuex</strong>：Vue 2 官方方案（较重）</li>
<li><strong>Pinia</strong>：Vue 3 官方推荐（更轻量、TypeScript 友好）</li>
<li><strong>优点</strong>：
<ul>
<li>状态可预测</li>
<li>支持 DevTools 调试</li>
<li>逻辑复用（actions/getters）</li>
</ul>
</li>
<li><strong>适用</strong>：多组件共享状态、持久化、复杂业务逻辑</li>
</ul>
<hr/>
<h3 data-id="heading-12">11. <strong>$root</strong>（❌ 不推荐）</h3>
<ul>
<li><strong>原理</strong>：访问根实例（<code>new Vue()</code>）</li>
<li><strong>问题</strong>：
<ul>
<li>全局耦合</li>
<li>难以测试和维护</li>
<li>在组件库或微前端中不可靠</li>
</ul>
</li>
<li><strong>Vue 3</strong>：❌ <code>$root</code> 仍存在但强烈不建议使用</li>
<li><strong>替代</strong>：provide/inject 或 Pinia</li>
</ul>
<hr/>
<h3 data-id="heading-13">12. <strong>slot（插槽）</strong>（✅ 推荐）</h3>
<ul>
<li><strong>方向</strong>：父 → 子（内容分发）</li>
<li><strong>类型</strong>：
<ul>
<li>默认插槽 <code>&lt;slot /&gt;</code></li>
<li>具名插槽 <code>&lt;slot name="header" /&gt;</code></li>
<li><strong>作用域插槽</strong>（关键！）：子 → 父传数据
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 子 --&gt;
&lt;slot :user="currentUser" /&gt;
&lt;!-- 父 --&gt;
&lt;Child v-slot="{ user }"&gt;{{ user.name }}&lt;/Child&gt;
</code></pre>
</li>
</ul>
</li>
<li><strong>适用</strong>：高度可定制组件（表格、弹窗、卡片）</li>
</ul>
<hr/>
<h3 data-id="heading-14">13. <strong>sessionStorage / localStorage</strong>（⚠️ 特定场景）</h3>
<ul>
<li><strong>原理</strong>：通过浏览器存储实现“伪通信”</li>
<li><strong>适用场景</strong>：
<ul>
<li>页面刷新后保持状态</li>
<li>多 Tab 间简单同步（配合 <code>storage</code> 事件）</li>
</ul>
</li>
<li><strong>缺点</strong>：
<ul>
<li>非响应式（需手动监听 <code>storage</code> 事件）</li>
<li>数据类型限制（仅字符串）</li>
<li>不适合实时通信</li>
</ul>
</li>
<li><strong>建议</strong>：仅用于持久化，<strong>非组件通信首选</strong></li>
</ul>
<hr/>
<h3 data-id="heading-15">14. <strong>postMessage</strong>（⚠️ 跨文档/跨域通信）</h3>
<ul>
<li><strong>原理</strong>：HTML5 提供的安全跨域通信机制</li>
<li><strong>适用场景</strong>：
<ul>
<li>iframe 与主页面通信</li>
<li>Web Worker 与主线程</li>
<li>跨域窗口通信</li>
</ul>
</li>
<li><strong>示例</strong>：
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 主页面</span>
iframe.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">postMessage</span>(data, <span class="hljs-string">'*'</span>)
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, handler)
</code></pre>
</li>
<li><strong>注意</strong>：需验证 <code>event.origin</code> 防止 XSS</li>
<li><strong>与组件通信关系</strong>：属于<strong>跨上下文通信</strong>，非组件内部机制</li>
</ul>
<hr/>
<h2 data-id="heading-16">📊 总结对比表</h2>





























































































































<table><thead><tr><th>方式</th><th>方向</th><th>Vue 2</th><th>Vue 3</th><th>推荐度</th><th>适用场景</th></tr></thead><tbody><tr><td>props</td><td>父→子</td><td>✅</td><td>✅</td><td>✅✅✅</td><td>基础数据传递</td></tr><tr><td>$emit / v-on</td><td>子→父</td><td>✅</td><td>✅</td><td>✅✅✅</td><td>事件通知</td></tr><tr><td>.sync</td><td>双向</td><td>✅</td><td>❌</td><td>⚠️</td><td>Vue 2 双向绑定（已淘汰）</td></tr><tr><td>v-model</td><td>双向</td><td>✅（单）</td><td>✅（多）</td><td>✅✅✅</td><td>表单、可编辑组件</td></tr><tr><td>ref</td><td>父→子（调用）</td><td>✅</td><td>✅</td><td>✅✅</td><td>调用子方法</td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>h</mi><mi>i</mi><mi>l</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">children/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">hi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">d</span><span class="mord mathnormal">re</span><span class="mord mathnormal">n</span><span class="mord">/</span></span></span></span></span>parent</td><td>双向</td><td>✅</td><td>❌/$parent</td><td>❌</td><td>——</td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>s</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">attrs/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">a</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">rs</span><span class="mord">/</span></span></span></span></span>listeners</td><td>透传</td><td>✅</td><td>✅（合并）</td><td>✅✅</td><td>高阶组件封装</td></tr><tr><td>provide/inject</td><td>祖先→后代</td><td>✅</td><td>✅</td><td>✅✅✅</td><td>跨层级配置</td></tr><tr><td>EventBus</td><td>任意</td><td>✅</td><td>需 mitt</td><td>⚠️</td><td>小型项目临时通信</td></tr><tr><td>Vuex/Pinia</td><td>全局</td><td>✅/✅</td><td>Pinia✅</td><td>✅✅✅</td><td>复杂状态共享</td></tr><tr><td>$root</td><td>全局</td><td>✅</td><td>✅（不推荐）</td><td>❌</td><td>——</td></tr><tr><td>slot</td><td>父→子（内容）</td><td>✅</td><td>✅</td><td>✅✅✅</td><td>UI 定制</td></tr><tr><td>sessionStorage</td><td>持久化</td><td>✅</td><td>✅</td><td>⚠️</td><td>刷新保活、多 Tab</td></tr><tr><td>postMessage</td><td>跨上下文</td><td>✅</td><td>✅</td><td>⚠️</td><td>iframe、Worker</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-17">✅ 最佳实践建议</h2>
<ol>
<li><strong>优先使用 props + emits</strong>：保持组件清晰。</li>
<li><strong>跨层级用 provide/inject</strong>，而非 <code>$parent</code>。</li>
<li><strong>共享状态用 Pinia</strong>，而非 EventBus 或 <code>$root</code>。</li>
<li><strong>避免直接操作子组件</strong>（ref 仅用于方法调用）。</li>
<li><strong>作用域插槽</strong>是高级组件设计的利器。</li>
<li><strong>localStorage / postMessage</strong> 属于特殊场景，勿滥用。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript核心机制：执行栈、作用域与this指向完全解析]]></title>    <link>https://juejin.cn/post/7579385656780554274</link>    <guid>https://juejin.cn/post/7579385656780554274</guid>    <pubDate>2025-12-03T13:39:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579385656780554274" data-draft-id="7579264485259755535" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript核心机制：执行栈、作用域与this指向完全解析"/> <meta itemprop="keywords" content="JavaScript,面试,前端"/> <meta itemprop="datePublished" content="2025-12-03T13:39:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端缘梦"/> <meta itemprop="url" content="https://juejin.cn/user/4167568429944347"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript核心机制：执行栈、作用域与this指向完全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4167568429944347/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端缘梦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T13:39:46.000Z" title="Wed Dec 03 2025 13:39:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>JavaScript作为一门灵活而强大的语言，其底层运行机制常常让开发者感到困惑。为什么变量有时能访问，有时不能？为什么this的指向会"飘忽不定"？本文将深入剖析JavaScript的三大核心机制——<strong>执行栈与执行上下文</strong>、<strong>作用域与作用域链</strong>、<strong>this指向</strong>，帮你彻底理解JavaScript的运行原理。</p>
<h2 data-id="heading-1">一、执行栈与执行上下文：代码执行的舞台</h2>
<h3 data-id="heading-2">1.1 面试直击：谈谈你对JS执行上下文栈的理解</h3>
<p>当面试官问这个问题时，他们想考察的是你对<strong>JavaScript引擎如何管理和执行代码</strong>的理解深度。执行上下文栈是引擎追踪所有函数调用、管理执行流程的<strong>核心调度中心</strong>。</p>
<p>*<strong>什么是执行上下文</strong>？</p>
<p>简而言之，执行上下文是评估和执行 js 代码的环境的抽象概念。每当 js 代码在运行的时候，它都是在执行上下文中执行。</p>
<p><strong>执行上下文的类型</strong></p>
<p>js 中有三种执行上下文类型</p>
<ul>
<li>全局执行上下文：这是默认或者说基础的上下文，任何不在函数内部的代码都在全局上下文中。它会执行两件事，创建一个全局的 window 对象（浏览器的情况下），并且设置 this 的值等于这个全局对象。一个程序中只会有一个全局执行上下文。</li>
<li>函数执行上下文：每当一个函数被调用时，都会为该函数创建一个新的上下文。每个函数都有它自己的执行上下文，不过是在函数被调用时创建的。函数上下文可以有任意多个。每单一个新的执行上下文被创建，它会按定义的顺序执行一系列步骤。</li>
<li>eval 函数执行上下文：执行在 eval 函数内部的代码也会有它属于自己的执行上下文。</li>
</ul>
<p><strong>调用栈</strong></p>
<p>调用栈是解析器（如浏览器中的 js 解析器）的一种机制，可以在脚本调用多个函数时，跟踪每个函数在完成执行时应该返回控制的点。（如什么函数正在执行，什么函数被这个函数调用，下一个调用的函数是谁）</p>
<ul>
<li>当脚本要调用一个函数时，解析器把该函数添加到栈中并且执行这个函数。</li>
<li>任何被这个函数调用的函数会进一步添加到调用栈中，并且运行到它们被上个程序调用的位置。</li>
<li>当函数运行结束后，解释器将它从堆栈中取出，并且主代码列表中继续执行代码。</li>
<li>如果栈占用的空间比分配给它的空间还大，那么则会导致“栈溢出”错误</li>
</ul>
<hr/>
<h3 data-id="heading-3">1.2 什么是执行上下文？</h3>
<p>简单来说，<strong>执行上下文是评估和执行JavaScript代码的环境的抽象概念</strong>。所有的JavaScript代码都是在某个执行上下文中运行的。</p>
<h3 data-id="heading-4">1.3 执行上下文的三种类型</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 全局执行上下文</span>
<span class="hljs-keyword">var</span> globalVar = <span class="hljs-string">"全局变量"</span>; <span class="hljs-comment">// 在全局上下文中</span>

<span class="hljs-comment">// 2. 函数执行上下文</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> localVar = <span class="hljs-string">"局部变量"</span>; <span class="hljs-comment">// 在函数上下文中</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(localVar);
}

<span class="hljs-comment">// 3. Eval函数执行上下文（不推荐使用）</span>
<span class="hljs-built_in">eval</span>(<span class="hljs-string">"var evalVar = 'eval变量'"</span>);
</code></pre>
<p><strong>全局执行上下文的特点</strong>：</p>
<ul>
<li>
<p>有且仅有一个</p>
</li>
<li>
<p>创建时会做两件事：</p>
<ol>
<li>在浏览器中创建全局对象<code>window</code></li>
<li>将<code>this</code>的值设置为这个全局对象</li>
</ol>
</li>
</ul>
<h3 data-id="heading-5">1.4 执行栈（调用栈）：后进先出的管理机制</h3>
<p>执行栈是一种LIFO（后进先出）的数据结构，用于存储和管理代码执行期间创建的所有执行上下文。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">first</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第一个函数开始'</span>);
    <span class="hljs-title function_">second</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第一个函数结束'</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">second</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第二个函数开始'</span>);
    <span class="hljs-title function_">third</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第二个函数结束'</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">third</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第三个函数开始'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第三个函数结束'</span>);
}

<span class="hljs-title function_">first</span>();

<span class="hljs-comment">// 执行栈的变化过程：</span>
<span class="hljs-comment">// 1. 全局上下文入栈</span>
<span class="hljs-comment">// 2. first()调用，first上下文入栈</span>
<span class="hljs-comment">// 3. second()调用，second上下文入栈  </span>
<span class="hljs-comment">// 4. third()调用，third上下文入栈</span>
<span class="hljs-comment">// 5. third()执行完毕，出栈</span>
<span class="hljs-comment">// 6. second()执行完毕，出栈</span>
<span class="hljs-comment">// 7. first()执行完毕，出栈</span>
</code></pre>
<h3 data-id="heading-6">1.5 执行上下文的生命周期</h3>
<p>每个执行上下文都经历两个阶段：</p>
<h4 data-id="heading-7">创建阶段（此时函数被调用，但未执行内部代码）：</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">example</span>(<span class="hljs-params">a, b</span>) {
    <span class="hljs-keyword">var</span> c = <span class="hljs-string">"hello"</span>;
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">d</span>(<span class="hljs-params"/>) {}
    <span class="hljs-keyword">var</span> e = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};
}

<span class="hljs-comment">// 在创建阶段，执行上下文会进行以下准备工作：</span>
exampleExecutionContext = {
    <span class="hljs-comment">// 1. 创建变量对象</span>
    <span class="hljs-attr">variableObject</span>: {
        <span class="hljs-attr">arguments</span>: { <span class="hljs-number">0</span>: a, <span class="hljs-number">1</span>: b, <span class="hljs-attr">length</span>: <span class="hljs-number">2</span> },
        <span class="hljs-attr">a</span>: <span class="hljs-literal">undefined</span>,     <span class="hljs-comment">// 形参</span>
        <span class="hljs-attr">b</span>: <span class="hljs-literal">undefined</span>,     <span class="hljs-comment">// 形参</span>
        <span class="hljs-attr">c</span>: <span class="hljs-literal">undefined</span>,     <span class="hljs-comment">// 变量声明</span>
        <span class="hljs-attr">d</span>: pointer_to_function_d,  <span class="hljs-comment">// 函数声明</span>
        <span class="hljs-attr">e</span>: <span class="hljs-literal">undefined</span>      <span class="hljs-comment">// 变量声明</span>
    },
    <span class="hljs-comment">// 2. 建立作用域链</span>
    <span class="hljs-attr">scopeChain</span>: [...],
    <span class="hljs-comment">// 3. 确定this指向</span>
    <span class="hljs-attr">this</span>: <span class="hljs-variable language_">window</span>
}
</code></pre>
<h4 data-id="heading-8">执行阶段（逐行执行代码）：</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">example</span>(<span class="hljs-params">a = <span class="hljs-number">1</span>, b = <span class="hljs-number">2</span></span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c);  <span class="hljs-comment">// undefined（变量提升）</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d);  <span class="hljs-comment">// function d() {}（函数提升）</span>
    
    <span class="hljs-keyword">var</span> c = <span class="hljs-string">"hello"</span>;
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">d</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"我是函数d"</span>);
    }
    <span class="hljs-keyword">var</span> e = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"我是函数表达式"</span>);
    };
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c);  <span class="hljs-comment">// "hello"</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d);  <span class="hljs-comment">// function d() {}</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e);  <span class="hljs-comment">// function() { ... }</span>
}

<span class="hljs-title function_">example</span>();
</code></pre>
<p><strong>重要规则</strong>：</p>
<ol>
<li>函数声明会<strong>完全提升</strong></li>
<li>变量声明会<strong>部分提升</strong>（只提升声明，不提升赋值）</li>
<li>函数声明的优先级高于变量声明</li>
</ol>
<h3 data-id="heading-9">1.6 栈溢出错误</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 递归调用没有终止条件会导致栈溢出</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">infiniteRecursion</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">infiniteRecursion</span>(); <span class="hljs-comment">// 不断创建新的执行上下文</span>
}

<span class="hljs-comment">// 调用会抛出：RangeError: Maximum call stack size exceeded</span>
<span class="hljs-comment">// infiniteRecursion();</span>
</code></pre>
<h2 data-id="heading-10">二、作用域与作用域链：变量的可见性规则</h2>
<h3 data-id="heading-11">2.1 面试题：谈谈你对作用域和作用域链的理解</h3>
<p>作用域和作用域链决定了<strong>变量在何处以及如何被访问</strong>，这是JavaScript的基础概念。</p>
<p><strong>什么是作用域？</strong></p>
<p>作用域是在运行时代码中某些特定部分变量、函数和对象的可访问性，决定了代码区块中变量和其他资源的可见性。ES5 中只存在两种作用域：全局作用域和函数作用域，ES6 新增了块级作用域。</p>
<p><strong>什么是作用域链？</strong></p>
<p>当访问一个变量时，编译器在执行这段代码时，会首先从当前的作用域中查找是否有这个标识符，如果没有找到，就会去父作用域查找，如果父作用域还没找到继续向上查找，直到全局作用域为止。</p>
<p>而作用域链，就是有当前作用域与上层作用域的一系列变量对象组成，它保证了当前执行的作用域链对符合访问权限的变量和函数的有序访问。</p>
<p>作用域链有一个非常重要的特征，那就是<strong>作用域中的值是在函数创建的时候，就已经被存储了，是静态的。</strong> 所谓静态，就是是作用域中的值一旦被确定了，永远不会变。函数可以永远不被调用，但是作用域中的值在函数创建的时候就已经被写入了，并且存储在函数作用域链对象里面。</p>
<h3 data-id="heading-12">2.2 什么是作用域？</h3>
<p>作用域定义了<strong>变量、函数和对象的可访问性范围</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 全局作用域</span>
<span class="hljs-keyword">var</span> globalVar = <span class="hljs-string">"我是全局变量"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 函数作用域</span>
    <span class="hljs-keyword">var</span> outerVar = <span class="hljs-string">"我是外部函数变量"</span>;
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 另一个函数作用域</span>
        <span class="hljs-keyword">var</span> innerVar = <span class="hljs-string">"我是内部函数变量"</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(globalVar);    <span class="hljs-comment">// 可以访问</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(outerVar);     <span class="hljs-comment">// 可以访问</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(innerVar);     <span class="hljs-comment">// 可以访问</span>
    }
    
    <span class="hljs-title function_">inner</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(globalVar);        <span class="hljs-comment">// 可以访问</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(outerVar);         <span class="hljs-comment">// 可以访问</span>
    <span class="hljs-comment">// console.log(innerVar);      // 错误！无法访问内部变量</span>
}

<span class="hljs-title function_">outer</span>();
</code></pre>
<h3 data-id="heading-13">2.3 ES6的块级作用域</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ES5只有全局和函数作用域</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">es5Example</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">var</span> varVariable = <span class="hljs-string">"var声明的变量"</span>;
        <span class="hljs-keyword">let</span> letVariable = <span class="hljs-string">"let声明的变量"</span>;
        <span class="hljs-keyword">const</span> constVariable = <span class="hljs-string">"const声明的变量"</span>;
    }
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(varVariable);    <span class="hljs-comment">// "var声明的变量" - 可以访问</span>
    <span class="hljs-comment">// console.log(letVariable);  // ReferenceError - 不能访问</span>
    <span class="hljs-comment">// console.log(constVariable); // ReferenceError - 不能访问</span>
}

<span class="hljs-comment">// ES6的块级作用域</span>
{
    <span class="hljs-keyword">let</span> blockScoped = <span class="hljs-string">"块级作用域变量"</span>;
    <span class="hljs-keyword">const</span> constant = <span class="hljs-string">"常量"</span>;
}
<span class="hljs-comment">// console.log(blockScoped); // ReferenceError</span>
<span class="hljs-comment">// console.log(constant);    // ReferenceError</span>
</code></pre>
<h3 data-id="heading-14">2.4 作用域链</h3>
<p>当访问一个变量时，JavaScript引擎会沿着作用域链从内到外查找：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> <span class="hljs-variable language_">global</span> = <span class="hljs-string">"全局"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> outer = <span class="hljs-string">"外层"</span>;
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">var</span> inner = <span class="hljs-string">"内层"</span>;
        
        <span class="hljs-comment">// 查找顺序：inner → outer → global</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(inner);   <span class="hljs-comment">// "内层" - 在当前作用域找到</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(outer);   <span class="hljs-comment">// "外层" - 在父作用域找到</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">global</span>);  <span class="hljs-comment">// "全局" - 在全局作用域找到</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(notExist); <span class="hljs-comment">// ReferenceError - 找不到</span>
    }
    
    <span class="hljs-title function_">inner</span>();
}

<span class="hljs-title function_">outer</span>();
</code></pre>
<h3 data-id="heading-15">2.5 自由变量和词法作用域</h3>
<p><strong>自由变量</strong>：在当前作用域未定义，需要去父作用域查找的变量。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> x = <span class="hljs-number">10</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x); <span class="hljs-comment">// x是自由变量</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> x = <span class="hljs-number">20</span>;
    <span class="hljs-title function_">foo</span>(); <span class="hljs-comment">// 输出10，而不是20！</span>
}

<span class="hljs-title function_">bar</span>();

<span class="hljs-comment">// 这是因为JavaScript采用词法作用域（静态作用域）</span>
<span class="hljs-comment">// 函数的作用域在定义时就确定了，而不是调用时</span>
</code></pre>
<h3 data-id="heading-16">2.6 作用域 vs 执行上下文</h3>
<p><strong>关键区别</strong>：</p>
<ul>
<li><strong>作用域</strong>：函数<strong>定义时</strong>确定，静态不变</li>
<li><strong>执行上下文</strong>：函数<strong>调用时</strong>创建，动态变化</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> color = <span class="hljs-string">"blue"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getColor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span>);    <span class="hljs-comment">// 执行上下文决定this</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(color);         <span class="hljs-comment">// 作用域决定color的值</span>
}

<span class="hljs-keyword">var</span> obj = {
    <span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>,
    <span class="hljs-attr">getColor</span>: getColor
};

<span class="hljs-comment">// 同样的函数，不同的调用方式</span>
<span class="hljs-title function_">getColor</span>();        <span class="hljs-comment">// this: window, color: "blue"</span>
obj.<span class="hljs-title function_">getColor</span>();    <span class="hljs-comment">// this: obj, color: "blue"（作用域不变！）</span>
</code></pre>
<h2 data-id="heading-17">三、this指向：动态绑定的上下文</h2>
<h3 data-id="heading-18">3.1 this的本质</h3>
<p><code>this</code>关键字总是指向一个对象，具体指向哪个对象取决于<strong>函数的调用方式</strong>。</p>
<p>关于 this 的指向，有一种广为流传的说法就是“谁调用它，this 就指向谁”。</p>
<ul>
<li>在函数体中，非显示或隐式地简单调用函数时，在严格模式下，函数内的 this 会被绑定到 undefined 上，在非严格模式下则会被绑定到全局对象 window/global 上。</li>
<li>一般使用 new 方法调用构造函数时，构造函数内的 this 会被绑定到新创建的对象上。</li>
<li>一般通过 call/apply/bind 方法显示调用函数时，函数体内的 this 会被绑定到指定参数的对象上。</li>
<li>一般通过上下文对象调用函数时，函数体内的 this 会被绑定到该对象上。</li>
<li>在箭头函数中，this 的指向是由外层（函数或全局）作用域来决定的。</li>
</ul>
<h3 data-id="heading-19">3.2 this的绑定规则</h3>
<h4 data-id="heading-20">1. 默认绑定（普通函数调用）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 非严格模式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showThis</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>);
}

<span class="hljs-title function_">showThis</span>(); <span class="hljs-comment">// 浏览器中输出：Window对象</span>

<span class="hljs-comment">// 严格模式</span>
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">strictShowThis</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>);
}

<span class="hljs-title function_">strictShowThis</span>(); <span class="hljs-comment">// undefined</span>
</code></pre>
<h4 data-id="heading-21">2. 隐式绑定（方法调用）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> obj = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span>,
    <span class="hljs-attr">sayName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
    }
};

obj.<span class="hljs-title function_">sayName</span>(); <span class="hljs-comment">// "张三" - this指向obj</span>

<span class="hljs-comment">// 隐式丢失的常见情况</span>
<span class="hljs-keyword">var</span> sayName = obj.<span class="hljs-property">sayName</span>;
<span class="hljs-title function_">sayName</span>(); <span class="hljs-comment">// "" 或 undefined - this指向全局</span>

<span class="hljs-comment">// 回调函数中的隐式丢失</span>
<span class="hljs-built_in">setTimeout</span>(obj.<span class="hljs-property">sayName</span>, <span class="hljs-number">100</span>); <span class="hljs-comment">// this指向全局</span>
</code></pre>
<h4 data-id="heading-22">3. 显式绑定（call/apply/bind）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">introduce</span>(<span class="hljs-params">lang, year</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`我叫<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>，擅长<span class="hljs-subst">${lang}</span>，<span class="hljs-subst">${year}</span>年开始编程`</span>);
}

<span class="hljs-keyword">var</span> person1 = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span> };
<span class="hljs-keyword">var</span> person2 = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Bob"</span> };

<span class="hljs-comment">// call - 立即调用，参数逐个传递</span>
introduce.<span class="hljs-title function_">call</span>(person1, <span class="hljs-string">"JavaScript"</span>, <span class="hljs-number">2015</span>);
<span class="hljs-comment">// 输出：我叫Alice，擅长JavaScript，2015年开始编程</span>

<span class="hljs-comment">// apply - 立即调用，参数数组传递</span>
introduce.<span class="hljs-title function_">apply</span>(person2, [<span class="hljs-string">"Python"</span>, <span class="hljs-number">2018</span>]);
<span class="hljs-comment">// 输出：我叫Bob，擅长Python，2018年开始编程</span>

<span class="hljs-comment">// bind - 创建新函数，不立即调用</span>
<span class="hljs-keyword">var</span> boundIntroduce = introduce.<span class="hljs-title function_">bind</span>(person1, <span class="hljs-string">"Java"</span>);
<span class="hljs-title function_">boundIntroduce</span>(<span class="hljs-number">2020</span>);
<span class="hljs-comment">// 输出：我叫Alice，擅长Java，2020年开始编程</span>
</code></pre>
<h4 data-id="heading-23">4. new绑定（构造函数调用）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-comment">// new调用时，this指向新创建的对象</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`你好，我是<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
    };
}

<span class="hljs-keyword">var</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"张三"</span>, <span class="hljs-number">25</span>);
p1.<span class="hljs-title function_">sayHello</span>(); <span class="hljs-comment">// "你好，我是张三"</span>
</code></pre>
<h4 data-id="heading-24">5. 箭头函数的this</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> obj = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"对象"</span>,
    <span class="hljs-attr">regularFunc</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"普通函数this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"setTimeout普通函数this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        }, <span class="hljs-number">100</span>);
        
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"setTimeout箭头函数this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        }, <span class="hljs-number">200</span>);
    },
    <span class="hljs-attr">arrowFunc</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"箭头函数this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
    }
};

obj.<span class="hljs-title function_">regularFunc</span>();
<span class="hljs-comment">// 普通函数this: 对象</span>
<span class="hljs-comment">// setTimeout普通函数this: （全局的name，通常是空）</span>
<span class="hljs-comment">// setTimeout箭头函数this: 对象</span>

obj.<span class="hljs-title function_">arrowFunc</span>();
<span class="hljs-comment">// 箭头函数this: （全局的name）</span>
</code></pre>
<h3 data-id="heading-25">3.3 this绑定的优先级</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 优先级测试</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);
}

<span class="hljs-keyword">var</span> obj1 = { <span class="hljs-attr">value</span>: <span class="hljs-string">"obj1"</span>, <span class="hljs-attr">test</span>: test };
<span class="hljs-keyword">var</span> obj2 = { <span class="hljs-attr">value</span>: <span class="hljs-string">"obj2"</span>, <span class="hljs-attr">test</span>: test };

<span class="hljs-comment">// 1. 默认绑定（优先级最低）</span>
<span class="hljs-title function_">test</span>(); <span class="hljs-comment">// undefined 或 全局的value</span>

<span class="hljs-comment">// 2. 隐式绑定</span>
obj1.<span class="hljs-title function_">test</span>(); <span class="hljs-comment">// "obj1"</span>

<span class="hljs-comment">// 3. 显式绑定 &gt; 隐式绑定</span>
obj1.<span class="hljs-property">test</span>.<span class="hljs-title function_">call</span>(obj2); <span class="hljs-comment">// "obj2"</span>

<span class="hljs-comment">// 4. new绑定 &gt; 显式绑定</span>
<span class="hljs-keyword">var</span> boundTest = test.<span class="hljs-title function_">bind</span>(obj1);
<span class="hljs-keyword">var</span> newObj = <span class="hljs-keyword">new</span> <span class="hljs-title function_">boundTest</span>(); <span class="hljs-comment">// undefined（new绑定覆盖了bind绑定）</span>
</code></pre>
<h3 data-id="heading-26">3.4 常见应用场景</h3>
<h4 data-id="heading-27">DOM事件处理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// HTML: &lt;button id="btn"&gt;点击我&lt;/button&gt;</span>

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'btn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// 指向被点击的button元素</span>
});

<span class="hljs-comment">// 箭头函数会改变this指向</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'btn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// 指向定义时的上下文，通常是window</span>
});
</code></pre>
<h4 data-id="heading-28">类中的this</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-number">0</span>;
        <span class="hljs-comment">// 需要绑定this，否则作为回调时会丢失</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">increment</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">increment</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
    }
    
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>);
    }
    
    <span class="hljs-comment">// 使用箭头函数自动绑定</span>
    decrement = <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>--;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>);
    }
}

<span class="hljs-keyword">const</span> counter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'inc'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, counter.<span class="hljs-property">increment</span>);
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'dec'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, counter.<span class="hljs-property">decrement</span>);
</code></pre>
<h3 data-id="heading-29">3.5 call、apply、bind的经典应用</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 借用数组方法处理类数组对象</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// arguments是类数组对象，没有数组方法</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">reduce</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">total, current</span>) {
        <span class="hljs-keyword">return</span> total + current;
    }, <span class="hljs-number">0</span>);
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">sum</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)); <span class="hljs-comment">// 15</span>

<span class="hljs-comment">// 2. 获取数组最大/最小值</span>
<span class="hljs-keyword">var</span> numbers = [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>];
<span class="hljs-keyword">var</span> max = <span class="hljs-title class_">Math</span>.<span class="hljs-property">max</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-literal">null</span>, numbers); <span class="hljs-comment">// 7</span>
<span class="hljs-keyword">var</span> min = <span class="hljs-title class_">Math</span>.<span class="hljs-property">min</span>.<span class="hljs-title function_">call</span>(<span class="hljs-literal">null</span>, ...numbers); <span class="hljs-comment">// 2（使用扩展运算符）</span>

<span class="hljs-comment">// 3. 继承和构造函数链式调用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params">name, breed</span>) {
    <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name); <span class="hljs-comment">// 调用父类构造函数</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">breed</span> = breed;
}

<span class="hljs-keyword">var</span> myDog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">"旺财"</span>, <span class="hljs-string">"金毛"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myDog.<span class="hljs-property">name</span>); <span class="hljs-comment">// "旺财"</span>

<span class="hljs-comment">// 4. 函数柯里化（Currying）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a, b, c</span>) {
    <span class="hljs-keyword">return</span> a * b * c;
}

<span class="hljs-keyword">var</span> double = multiply.<span class="hljs-title function_">bind</span>(<span class="hljs-literal">null</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// 固定第一个参数</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">double</span>(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)); <span class="hljs-comment">// 24 (2 * 3 * 4)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">double</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)); <span class="hljs-comment">// 60 (2 * 5 * 6)</span>
</code></pre>
<h2 data-id="heading-30">四、综合案例分析</h2>
<h3 data-id="heading-31">4.1 经典面试题解析</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> length = <span class="hljs-number">10</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span>);
}

<span class="hljs-keyword">var</span> obj = {
    <span class="hljs-attr">length</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) {
        <span class="hljs-title function_">fn</span>();                    <span class="hljs-comment">// 1. 直接调用，this指向全局</span>
        <span class="hljs-variable language_">arguments</span>[<span class="hljs-number">0</span>]();          <span class="hljs-comment">// 2. 通过arguments调用</span>
        fn.<span class="hljs-title function_">call</span>(obj);            <span class="hljs-comment">// 3. 显式绑定到obj</span>
    }
};

obj.<span class="hljs-title function_">method</span>(fn, <span class="hljs-number">1</span>);
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 10 （全局length）</span>
<span class="hljs-comment">// 2  （arguments.length）</span>
<span class="hljs-comment">// 5  （obj.length）</span>
</code></pre>
<h3 data-id="heading-32">4.2 复杂场景分析</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> name = <span class="hljs-string">"全局"</span>;
<span class="hljs-keyword">var</span> person = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span>,
    <span class="hljs-attr">sayName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"外层this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"内层this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        };
    },
    <span class="hljs-attr">sayNameArrow</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"外层this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"内层箭头函数this:"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
        };
    }
};

<span class="hljs-comment">// 情况1：普通函数嵌套</span>
<span class="hljs-keyword">var</span> func1 = person.<span class="hljs-title function_">sayName</span>();
<span class="hljs-title function_">func1</span>(); 
<span class="hljs-comment">// 外层this: 张三</span>
<span class="hljs-comment">// 内层this: 全局</span>

<span class="hljs-comment">// 情况2：箭头函数解决</span>
<span class="hljs-keyword">var</span> func2 = person.<span class="hljs-title function_">sayNameArrow</span>();
<span class="hljs-title function_">func2</span>();
<span class="hljs-comment">// 外层this: 张三</span>
<span class="hljs-comment">// 内层箭头函数this: 张三</span>

<span class="hljs-comment">// 情况3：使用bind绑定</span>
<span class="hljs-keyword">var</span> func3 = person.<span class="hljs-title function_">sayName</span>().<span class="hljs-title function_">bind</span>(person);
<span class="hljs-title function_">func3</span>();
<span class="hljs-comment">// 外层this: 张三</span>
<span class="hljs-comment">// 内层this: 张三</span>
</code></pre>
<h3 data-id="heading-33">4.3 性能优化建议</h3>
<ol>
<li><strong>避免过度嵌套</strong>：深度嵌套的作用域链会增加变量查找时间</li>
<li><strong>合理使用闭包</strong>：不必要的闭包会延长变量的生命周期</li>
<li><strong>注意内存泄漏</strong>：意外的全局变量和未清除的引用会导致内存泄漏</li>
<li><strong>适当使用严格模式</strong>：避免意外的全局绑定和不可预测的this</li>
</ol>
<h2 data-id="heading-34">五、总结</h2>
<h3 data-id="heading-35">5.1 核心概念回顾</h3>
<ol>
<li><strong>执行栈</strong>：管理执行上下文的后进先出数据结构</li>
<li><strong>执行上下文</strong>：代码执行的环境，包含变量对象、作用域链和this</li>
<li><strong>作用域</strong>：变量和函数的可访问范围，在定义时确定</li>
<li><strong>作用域链</strong>：从当前作用域到全局作用域的链式结构</li>
<li><strong>this指向</strong>：由调用方式决定，遵循特定的绑定规则</li>
</ol>
<h3 data-id="heading-36">5.2 记忆口诀</h3>
<ul>
<li><strong>执行上下文</strong>：调用函数才创建，入栈出栈管流程</li>
<li><strong>作用域链</strong>：内层可访外层，定义位置就决定</li>
<li><strong>this指向</strong>：谁调用就指谁，箭头函数看外层</li>
<li><strong>绑定优先级</strong>：new &gt; 显式 &gt; 隐式 &gt; 默认</li>
</ul>
<h3 data-id="heading-37">5.3 实战建议</h3>
<ol>
<li>使用<code>const</code>和<code>let</code>替代<code>var</code>，利用块级作用域</li>
<li>在回调函数中注意this绑定，使用箭头函数或bind</li>
<li>理解闭包原理，避免不必要的内存占用</li>
<li>掌握call/apply/bind的适用场景，灵活改变this指向</li>
</ol>
<p>通过深入理解这三个核心概念，你将能够：</p>
<ul>
<li>准确预测代码的执行结果</li>
<li>避免常见的this绑定错误</li>
<li>编写更高效、可维护的JavaScript代码</li>
<li>在面试中从容应对相关技术问题</li>
</ul>
<p>JavaScript的运行机制虽然复杂，但只要掌握了这些核心概念，你就能从"知其然"进阶到"知其所以然"，真正驾驭这门灵活而强大的语言。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【URP】Unity[内置Shader]粒子简单光照ParticlesSimpleLit]]></title>    <link>https://juejin.cn/post/7579544295344177203</link>    <guid>https://juejin.cn/post/7579544295344177203</guid>    <pubDate>2025-12-04T01:54:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579544295344177203" data-draft-id="7579673620940374066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【URP】Unity[内置Shader]粒子简单光照ParticlesSimpleLit"/> <meta itemprop="keywords" content="游戏开发,Unity3D,图形学"/> <meta itemprop="datePublished" content="2025-12-04T01:54:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【URP】Unity[内置Shader]粒子简单光照ParticlesSimpleLit
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T01:54:31.000Z" title="Thu Dec 04 2025 01:54:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13021255.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13021255%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13021255&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【从UnityURP开始探索游戏渲染】</a><strong>专栏-直达</strong></p>
</blockquote>
<h2 data-id="heading-0"><strong>作用与原理</strong></h2>
<p>ParticlesSimpleLit是Unity URP(Universal Render Pipeline)中专门为粒子系统设计的简化光照着色器，主要用于实现高性能的粒子渲染效果。其核心原理是通过简化光照计算模型，牺牲部分物理准确性来换取更高的渲染效率，特别适合移动端或低端设备使用。</p>
<p>该着色器不计算物理正确性和能量守恒，而是采用一个简单的近似照明模型，这使得它在渲染时可以忽略复杂的物理计算。ParticlesSimpleLit主要包含三个关键部分：</p>
<ul>
<li>Surface Options：控制材质的基本渲染方式，如颜色和光照模式</li>
<li>Surface Inputs：描述表面特性，如湿度、粗糙度等</li>
<li>Advanced选项：提供更底层的渲染设置如阴影和反射</li>
</ul>
<h2 data-id="heading-1"><strong>发展历史</strong></h2>
<p>ParticlesSimpleLit随着URP的发展经历了多个版本迭代：</p>
<ul>
<li>最初作为URP核心着色器之一引入，替代了传统Built-in渲染管线中的简单粒子着色器</li>
<li>在URP 7.x版本中进行了性能优化，特别针对移动平台</li>
<li>URP 12.0版本后增加了对Shader Graph的支持</li>
<li>最新版本(如URP 16.0.6)进一步优化了变体管理和GPU实例化支持</li>
</ul>
<h2 data-id="heading-2"><strong>具体使用方法</strong></h2>
<h3 data-id="heading-3"><strong>基本应用示例</strong></h3>
<p>在Unity中使用ParticlesSimpleLit的步骤如下：</p>
<ul>
<li>创建或选择粒子系统</li>
<li>在粒子系统的Renderer模块中指定材质</li>
<li>创建新材质或选择现有材质</li>
<li>在材质Inspector窗口的Shader下拉菜单中选择"Universal Render Pipeline &gt; Particles &gt; Simple Lit"</li>
</ul>
<p>代码说明：这个C#脚本示例展示了如何通过代码动态为粒子系统应用ParticlesSimpleLit着色器。</p>
<ul>
<li>
<p>ParticleSimpleLitExample.cs</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 在代码中动态设置材质Shader的示例</span>
<span class="hljs-keyword">using</span> UnityEngine;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ParticleShaderSetter</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">public</span> ParticleSystem particleSystem;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span>
    {
        <span class="hljs-keyword">var</span> renderer = particleSystem.GetComponent&lt;ParticleSystemRenderer&gt;();
        Material mat = <span class="hljs-keyword">new</span> Material(Shader.Find(<span class="hljs-string">"Universal Render Pipeline/Particles/Simple Lit"</span>));
        renderer.material = mat;
    }
}
<span class="hljs-comment">// 以下是Shader Graph的节点设置参考：</span>
<span class="hljs-comment">/*
1. 添加Texture2D节点作为Base Map输入
2. 添加Color节点作为Base Color输入
3. 添加Slider节点控制Specular(0-1范围)
4. 添加Slider节点控制Smoothness(0-1范围)
5. 连接这些节点到PBR Master的对应输入
6. 在PBR Master节点中禁用高级光照计算
*/</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-4"><strong>参数配置</strong></h3>
<p>ParticlesSimpleLit提供了多个可调参数：</p>
<ul>
<li>‌<strong>Base Map</strong>‌：基础纹理，定义粒子外观</li>
<li>‌<strong>Base Color</strong>‌：基础颜色，与纹理相乘</li>
<li>‌<strong>Specular</strong>‌：控制高光强度</li>
<li>‌<strong>Smoothness</strong>‌：控制表面光滑度</li>
<li>‌<strong>Emission</strong>‌：控制自发光强度和颜色</li>
</ul>
<h2 data-id="heading-5"><strong>Shader Graph中的应用</strong></h2>
<p>在Shader Graph中使用ParticlesSimpleLit需要以下步骤：</p>
<ul>
<li>创建新的Shader Graph</li>
<li>在Graph Inspector中将"Target"设置为"Universal Render Pipeline"</li>
<li>使用"PBR Master"节点并调整设置以匹配SimpleLit特性</li>
<li>添加必要的纹理和参数输入</li>
</ul>
<p>代码说明：这个伪代码描述了在Shader Graph中重建ParticlesSimpleLit基本功能所需的节点配置。</p>
<ul>
<li>
<p>ParticleSimpleLitExample.cs</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 在代码中动态设置材质Shader的示例</span>
<span class="hljs-keyword">using</span> UnityEngine;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ParticleShaderSetter</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">public</span> ParticleSystem particleSystem;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>()</span>
    {
        <span class="hljs-keyword">var</span> renderer = particleSystem.GetComponent&lt;ParticleSystemRenderer&gt;();
        Material mat = <span class="hljs-keyword">new</span> Material(Shader.Find(<span class="hljs-string">"Universal Render Pipeline/Particles/Simple Lit"</span>));
        renderer.material = mat;
    }
}

<span class="hljs-comment">// 以下是Shader Graph的节点设置参考：</span>
<span class="hljs-comment">/*
1. 添加Texture2D节点作为Base Map输入
2. 添加Color节点作为Base Color输入
3. 添加Slider节点控制Specular(0-1范围)
4. 添加Slider节点控制Smoothness(0-1范围)
5. 连接这些节点到PBR Master的对应输入
6. 在PBR Master节点中禁用高级光照计算
*/</span>
</code></pre>
</li>
</ul>
<h2 data-id="heading-6"><strong>高级应用示例</strong></h2>
<p>结合粒子系统的其他模块，如Lights模块和Trails模块，可以创建更复杂的效果。例如创建一个带有拖尾效果的火焰粒子：</p>
<ul>
<li>启用粒子系统的Trails模块</li>
<li>使用ParticlesSimpleLit材质并设置适当的Emission值</li>
<li>调整Base Color为橙黄色渐变</li>
<li>根据需要启用Lights模块为部分粒子添加点光源效果</li>
</ul>
<p>ParticlesSimpleLit因其高效的性能表现，特别适合需要大量粒子的场景，如魔法效果、烟雾、火焰等视觉效果</p>
<h3 data-id="heading-7"><strong>火焰与烟雾效果</strong></h3>
<p>通过调整Surface Type为Transparent并选择Additive混合模式，配合噪声纹理实现动态火焰形态。关键参数包括_Emission控制发光强度、_MainTex设置火焰贴图序列帧，同时需启用Color over Lifetime模块实现颜色渐变。具体实现步骤：</p>
<ul>
<li>创建Particle System，材质选择Universal Render Pipeline &gt; Particles &gt; Simple Lit</li>
<li>在Surface Options中设置Blending Mode为Additive</li>
<li>通过脚本控制_Emission强度模拟燃烧波动</li>
</ul>
<h3 data-id="heading-8"><strong>雨雪天气效果</strong></h3>
<p>采用Opaque表面类型提升性能，结合GPU实例化实现大面积粒子渲染。需配置_MainTex为雨滴/雪花贴图，使用_SoftParticlesNearFade控制粒子淡入距离，并通过Rotation over Lifetime模块添加随机旋转。典型参数：</p>
<ul>
<li>_MainTex: 雨滴Alpha贴图
_SoftParticlesNearFade: 0.5
_RenderFace: Both</li>
</ul>
<h3 data-id="heading-9"><strong>魔法粒子特效</strong></h3>
<p>利用Color Mode的Overlay选项实现材质与粒子颜色混合，配合_Cutoff参数制作闪烁效果。通过脚本动态修改_HitPos和_HitSize数组可实现受击时的波纹扩散。核心代码逻辑包括：</p>
<ul>
<li>声明Shader属性：<code>_HitPos("HitPos", Vector) = (0,0,0,0)</code></li>
<li>在片段着色器中计算距离衰减：<code>float dist = distance(i.worldPos, _HitPos)</code></li>
</ul>
<h3 data-id="heading-10"><strong>落叶/花瓣效果</strong></h3>
<p>需启用Alpha Clipping并设置合适阈值（通常0.3-0.5），结合粒子系统的Shape模块设置为Box发射器覆盖树木范围。通过Size over Lifetime实现下落过程中的尺寸变化，使用Texture Sheet Animation模块添加飘动动画。</p>
<h3 data-id="heading-11"><strong>受击闪白效果</strong></h3>
<p>复制ParticlesSimpleLit着色器后添加受击逻辑，通过Lerp函数混合原始颜色与白色，使用_SinTime控制恢复速度。关键实现参考受击闪白动画方案：</p>
<ul>
<li>添加属性：<code>_FlashAmount("Flash Amount", Range(0,1)) = 0</code></li>
<li>颜色混合：<code>finalColor = lerp(originalColor, white, _FlashAmount)</code></li>
</ul>
<p>所有效果均需在URP设置中开启Depth Texture和Opaque Texture选项以保证深度交互正常。对于复杂效果，建议结合Shader Graph进行原型设计后再转换为代码实现.</p>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13021255.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13021255%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13021255&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【从UnityURP开始探索游戏渲染】</a><strong>专栏-直达</strong>
（欢迎<em>点赞留言</em>探讨，更多人加入进来能更加完善这个探索的过程，🙏）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 DeepSeek 给 Git 提交做自动 Code Review：从 0 落地一个本地 AI 审查流程]]></title>    <link>https://juejin.cn/post/7579264485259952143</link>    <guid>https://juejin.cn/post/7579264485259952143</guid>    <pubDate>2025-12-03T14:47:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579264485259952143" data-draft-id="7579494852652826658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 DeepSeek 给 Git 提交做自动 Code Review：从 0 落地一个本地 AI 审查流程"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-03T14:47:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GALA"/> <meta itemprop="url" content="https://juejin.cn/user/2893570334268573"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 DeepSeek 给 Git 提交做自动 Code Review：从 0 落地一个本地 AI 审查流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2893570334268573/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GALA
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T14:47:18.000Z" title="Wed Dec 03 2025 14:47:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在这篇文章里，我们从一个空目录开始，搭建一套在 git commit 前自动调用 DeepSeek 做代码审查的工作流：</p>
<ul>
<li>使用 Node.js 脚本 读取本次提交的 git diff</li>
<li>通过 DeepSeek Chat API 做代码审查，并按 严重程度分级</li>
<li>在 pre-commit hook 阶段自动执行，有严重问题就阻止提交</li>
<li>审查规则抽象为 rules.json 配置</li>
<li>模型配置通过 .env.local 管理，方便本地开发<br/>
你可以直接把这里的方案搬进自己的项目。</li>
</ul>
<h2 data-id="heading-0">场景与目标</h2>
<p>问题：团队日常开发中，Review 资源有限，小问题容易被漏掉，大问题又可能在合并后才暴露。目标：在每次 git commit 之前，让 AI 帮你快速过一遍变更，提前发现严重问题，并给出可执行的改进建议。我们设计的方案满足这些要求：</p>
<ul>
<li>只审查本次提交的已暂存改动（Staged Diff）</li>
<li>AI 按 严重 / 一般 / 建议 三个级别输出问题</li>
<li>有严重问题时：阻止提交</li>
<li>所有规则（关注点、文案、阻断策略）都写在 rules.json，后续可自定义</li>
<li>模型 Key &amp; 地址放在 .env.local，便于本地环境管理</li>
</ul>
<h2 data-id="heading-1">项目初始化</h2>
<p>在一个空目录（例如 AI-Codereview）下，我们先手写一个简单的 package.json：</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"ai-codereview"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.1.0"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"在 git 提交时调用 DeepSeek 模型进行代码自动审查的简单工具"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"scripts/deepseek-review.js"</span>,
  <span class="hljs-string">"bin"</span>: {
    <span class="hljs-string">"deepseek-review"</span>: <span class="hljs-string">"scripts/deepseek-review.js"</span>
  },
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"review"</span>: <span class="hljs-string">"node scripts/deepseek-review.js"</span>
  },
  <span class="hljs-string">"license"</span>: <span class="hljs-string">"MIT"</span>
}
</code></pre>
<p>这里有两个点：</p>
<ul>
<li>bin 字段：将来可以通过 npm install -g . 安装成全局 CLI，直接用 deepseek-review 命令。</li>
</ul>

<ul>
<li>scripts.review：方便本地调试，npm run review 即可执行审查脚本。</li>
</ul>
<h2 data-id="heading-2">核心：DeepSeek 代码审查脚本</h2>
<p>我们在 scripts/deepseek-review.js 里完成几件事：</p>
<ol>
<li>加载 .env.local 和规则配置 rules.json</li>
<li>从 git diff --cached 读取当前已暂存的变更</li>
<li>构造一份带有「规则说明 + 输出格式」的 Prompt</li>
<li>调用 DeepSeek Chat API</li>
<li>解析 AI 输出中的 BLOCK: YES/NO，决定是否阻止提交</li>
</ol>
<p>下面是部分代码实现结构：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 读取当前已暂存的 diff</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">cmd</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">execSync</span>(cmd, { <span class="hljs-attr">encoding</span>: <span class="hljs-string">"utf8"</span> }).<span class="hljs-title function_">trim</span>();
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getStagedDiff</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">run</span>(<span class="hljs-string">"git diff --cached --unified=0"</span>);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"[deepseek-review] 读取 git diff 失败："</span>, e.<span class="hljs-property">message</span>);
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
  }
}

<span class="hljs-comment">// 构造 Prompt，把规则和输出格式喂给模型</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildPrompt</span>(<span class="hljs-params">diff, rules</span>) {
  <span class="hljs-keyword">const</span> focusList = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(rules.<span class="hljs-property">focus</span>) &amp;&amp; rules.<span class="hljs-property">focus</span>.<span class="hljs-property">length</span>
    ? rules.<span class="hljs-property">focus</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-string">`- <span class="hljs-subst">${item}</span>`</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">"\n"</span>)
    : <span class="hljs-string">"- 逻辑正确性与潜在 Bug\n- 边界条件与异常处理\n- 性能问题\n- 安全问题\n- 可维护性与可读性"</span>;

  <span class="hljs-keyword">const</span> severeDesc = rules.<span class="hljs-property">severityLevels</span>?.<span class="hljs-property">severe</span>?.<span class="hljs-property">description</span>
    || <span class="hljs-string">"可能导致功能不可用、数据损坏、安全漏洞或构建失败的问题。"</span>;
  <span class="hljs-keyword">const</span> majorDesc = rules.<span class="hljs-property">severityLevels</span>?.<span class="hljs-property">major</span>?.<span class="hljs-property">description</span>
    || <span class="hljs-string">"可以运行，但存在潜在 Bug、性能隐患或较大维护成本的问题。"</span>;
  <span class="hljs-keyword">const</span> suggestionDesc = rules.<span class="hljs-property">severityLevels</span>?.<span class="hljs-property">suggestion</span>?.<span class="hljs-property">description</span>
    || <span class="hljs-string">"风格、命名、结构优化、更优写法等。"</span>;

  <span class="hljs-keyword">const</span> <span class="hljs-keyword">of</span> = rules.<span class="hljs-property">outputFormat</span> || {};

  <span class="hljs-keyword">return</span> <span class="hljs-string">`
你是一个严格的资深代码审查专家，请审查下面这次 git 提交的变更 diff。

【审查重点】
<span class="hljs-subst">${focusList}</span>

【分级规则】
- 严重问题：<span class="hljs-subst">${severeDesc}</span>
- 一般问题：<span class="hljs-subst">${majorDesc}</span>
- 建议与优化：<span class="hljs-subst">${suggestionDesc}</span>

【输出格式（必须严格遵守，方便工具解析）】
<span class="hljs-subst">${<span class="hljs-keyword">of</span>.overview || <span class="hljs-string">"1. 总体评价（1-2 句）"</span>}</span>
<span class="hljs-subst">${<span class="hljs-keyword">of</span>.severe || <span class="hljs-string">"2. 严重问题（如果没有，请写“无严重问题”）\n   - 【严重】描述问题 + 涉及的文件/大致位置 + 原因"</span>}</span>
<span class="hljs-subst">${<span class="hljs-keyword">of</span>.major || <span class="hljs-string">"3. 一般问题（如果没有，请写“无一般问题”）\n   - 【一般】描述问题 + 涉及的文件/大致位置 + 原因"</span>}</span>
<span class="hljs-subst">${<span class="hljs-keyword">of</span>.suggestion || <span class="hljs-string">"4. 建议与优化（如果没有，可以写“暂无明显优化建议”）"</span>}</span>

<span class="hljs-subst">${<span class="hljs-keyword">of</span>.blockRule || <span class="hljs-string">"5. 最终结论（只保留一行，且用英文 BLOCK 标记，必须大写）：\n   - 若必须在提交前修复，请输出：BLOCK: YES\n   - 若允许提交，仅给出建议，请输出：BLOCK: NO"</span>}</span>

注意：
- 不要输出除上述格式以外的额外总结行。
- “BLOCK: YES/NO” 必须是独立一行，前后不要加其他字符。

下面是本次提交的 diff（统一 diff 格式）：

<span class="hljs-subst">${diff}</span>
`</span>;
}

<span class="hljs-comment">// 调用 DeepSeek Chat API</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">callDeepseek</span>(<span class="hljs-params">{ apiKey, baseUrl, model, prompt }</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> postData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      model,
      <span class="hljs-attr">messages</span>: [
        { <span class="hljs-attr">role</span>: <span class="hljs-string">"system"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"你是一个资深代码审查工程师，擅长发现问题并提出可行建议。"</span> },
        { <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: prompt }
      ],
      <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.2</span>
    });

    <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">"/v1/chat/completions"</span>, baseUrl);

    <span class="hljs-keyword">const</span> options = {
      <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
      <span class="hljs-attr">hostname</span>: url.<span class="hljs-property">hostname</span>,
      <span class="hljs-attr">path</span>: url.<span class="hljs-property">pathname</span>,
      <span class="hljs-attr">port</span>: url.<span class="hljs-property">port</span> || <span class="hljs-number">443</span>,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
        <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${apiKey}</span>`</span>,
        <span class="hljs-string">"Content-Length"</span>: <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">byteLength</span>(postData)
      }
    };

    <span class="hljs-keyword">const</span> req = https.<span class="hljs-title function_">request</span>(options, <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
      <span class="hljs-keyword">let</span> data = <span class="hljs-string">""</span>;
      res.<span class="hljs-title function_">on</span>(<span class="hljs-string">"data"</span>, <span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> (data += chunk));
      res.<span class="hljs-title function_">on</span>(<span class="hljs-string">"end"</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (res.<span class="hljs-property">statusCode</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; res.<span class="hljs-property">statusCode</span> &lt; <span class="hljs-number">300</span>) {
          <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
            <span class="hljs-keyword">const</span> content =
              json.<span class="hljs-property">choices</span>?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">message</span>?.<span class="hljs-property">content</span> ||
              json.<span class="hljs-property">choices</span>?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">text</span> ||
              <span class="hljs-string">""</span>;
            <span class="hljs-title function_">resolve</span>(content.<span class="hljs-title function_">trim</span>());
          } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"解析 DeepSeek 响应失败："</span> + e.<span class="hljs-property">message</span>));
          }
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title function_">reject</span>(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`DeepSeek API 响应错误：<span class="hljs-subst">${res.statusCode}</span> <span class="hljs-subst">${res.statusMessage}</span> <span class="hljs-subst">${data}</span>`</span>)
          );
        }
      });
    });

    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">"error"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(err));
    req.<span class="hljs-title function_">write</span>(postData);
    req.<span class="hljs-title function_">end</span>();
  });
}

</code></pre>
<p>你可以直接通过修改这个文件来：</p>
<ul>
<li>调整审查关注点（例如换成「支付正确性」「权限控制」等）</li>
<li>改写分级说明，贴近你们团队的规范</li>
<li>修改输出格式，比如增加某个模块的专门小节</li>
<li>切换默认阻断策略（blockOnSevereDefault）</li>
</ul>
<h2 data-id="heading-3">模型配置通过 .env.local 管理</h2>
<p>为了避免把 Key 写死在代码或 shell 配置里，我们采用 Next.js 常见的 .env.local 风格：</p>
<pre><code class="hljs language-js" lang="js"># .<span class="hljs-property">env</span>.<span class="hljs-property">local</span>（不提交到仓库）
<span class="hljs-variable constant_">DEEPSEEK_API_KEY</span>=你的_API_Key
<span class="hljs-variable constant_">DEEPSEEK_API_BASE</span>=<span class="hljs-attr">https</span>:<span class="hljs-comment">//api.deepseek.com</span>
<span class="hljs-variable constant_">DEEPSEEK_MODEL</span>=deepseek-chat

# 是否在严重问题时阻止提交（<span class="hljs-number">1</span> 阻止 / <span class="hljs-number">0</span> 不阻止）
<span class="hljs-variable constant_">DEEPSEEK_BLOCK_ON_SEVERE</span>=<span class="hljs-number">1</span>
</code></pre>
<p>脚本启动时会：</p>
<ol>
<li>查找当前工作目录的 .env.local</li>
<li>解析每一行 KEY=VALUE，写入 process.env</li>
<li>如果系统环境变量里已经有同名 KEY，则以系统环境变量为准</li>
</ol>
<p>这样做有几个好处：</p>
<ul>
<li>适合前端/Node 项目现有习惯</li>
<li>可以按仓库存储不同 Key/配置</li>
<li>不需要全局污染 shell 环境</li>
</ul>
<h2 data-id="heading-4">Git Hook：在提交前自动执行审查</h2>
<p>最后一步，把脚本接到 Git 的 pre-commit 阶段。<br/>
由于是拿本项目来执行验证的这里使用 .githooks/pre-commit + core.hooksPath 的方式，方便版本管理。<br/>
在项目根目录创建 .githooks/pre-commit：</p>
<pre><code class="hljs language-js" lang="js">#!<span class="hljs-regexp">/bin/</span>sh

# 简单的 pre-commit hook 示例：
# 在执行 git commit 时，自动调用 <span class="hljs-title class_">DeepSeek</span> 代码审查脚本。

echo <span class="hljs-string">"[pre-commit] 调用 DeepSeek 进行代码审查..."</span>

node scripts/deepseek-review.<span class="hljs-property">js</span>
<span class="hljs-variable constant_">STATUS</span>=$?

<span class="hljs-keyword">if</span> [ $STATUS -ne <span class="hljs-number">0</span> ]; then
  echo <span class="hljs-string">"[pre-commit] DeepSeek 代码审查脚本执行失败或发现严重问题，终止提交。"</span>
  exit $STATUS
fi

exit <span class="hljs-number">0</span>
</code></pre>
<p>然后在仓库里启用它：</p>
<pre><code class="hljs language-shell" lang="shell">git config core.hooksPath .githooks
chmod +x .githooks/pre-commit
chmod +x scripts/deepseek-review.js
</code></pre>
<p>从此以后，每次在这个仓库里执行：</p>
<pre><code class="hljs language-js" lang="js">git add .
git commit -m <span class="hljs-string">"feat: xxx"</span>
</code></pre>
<p>都会自动触发：</p>
<ol>
<li>pre-commit → node scripts/deepseek-review.js</li>
<li>脚本读取 git diff --cached</li>
<li>调用 DeepSeek → 按规则分级输出问题，并在末尾给出 BLOCK: YES/NO</li>
<li>如果是 BLOCK: YES 且当前规则/环境要求阻断 → 本次提交直接失败</li>
</ol>
<h2 data-id="heading-5">审核示例</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c803d2f19b14939894a2225e81c8693~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0FMQQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765380355&amp;x-signature=BkZyB8MTQkArS%2F3xwa80CovcbjI%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">总结与一些延伸想法</h2>
<p>到这里，我们落地了一套本地可配置的 AI Code Review 流程，特点是：</p>
<ul>
<li>与 Git 强绑定：在提交前提前拦截严重问题</li>
<li>规则可配置：通过 rules.json 抽象了审查维度和分级</li>
<li>模型可配置：模型信息放在 .env.local，符合前端/Node 生态的习惯</li>
<li>行为可调：既可以强制阻断严重问题，也可以在开发早期只做「提示不阻断」</li>
</ul>
<p>基于这套结构，你还可以继续扩展：</p>
<ul>
<li>针对不同分支（main / dev）选择不同的规则文件</li>
<li>在审查结果中增加代码示例或重构建议模板</li>
<li>将结果同步到 Git 平台（GitLab MR comment / GitHub PR comment）</li>
</ul>
<p>由于工具当前只是 0.1.0 版本还有很多待改进的地方，后续将不断优化改进。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue5]]></title>    <link>https://juejin.cn/post/7579496954251231272</link>    <guid>https://juejin.cn/post/7579496954251231272</guid>    <pubDate>2025-12-03T14:35:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579496954251231272" data-draft-id="7574626451749437440" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue5"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-03T14:35:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="咪库咪库咪"/> <meta itemprop="url" content="https://juejin.cn/user/3725578141445959"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue5
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3725578141445959/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    咪库咪库咪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T14:35:54.000Z" title="Wed Dec 03 2025 14:35:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">el-container</h2>
<p>el-container是ElementPlus中的<strong>布局容器组件</strong>，主要用于快速构建基础布局结构，比如：顶部-主体-底部，侧边栏-主体等常见页面结构。<strong>把页面按照上下或左右方向组织起来，让布局变得简单、清晰、可读性高。</strong></p>
<p>它通常和以下组件一起使用：</p>
<ul>
<li>el-header: 页头区域</li>
<li>el-aside: 侧边栏区域</li>
<li>el-main: 主体内容区域</li>
<li>el-footer: 页脚区域</li>
</ul>
<h3 data-id="heading-1">基本用法举例</h3>
<h4 data-id="heading-2">上下布局（Header + Main）</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">el-container</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-header</span>&gt;</span>Header<span class="hljs-tag">&lt;/<span class="hljs-name">el-header</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-main</span>&gt;</span>Main<span class="hljs-tag">&lt;/<span class="hljs-name">el-main</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-container</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">左右布局（Aside + Main）</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">el-container</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-aside</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200px"</span>&gt;</span>Aside<span class="hljs-tag">&lt;/<span class="hljs-name">el-aside</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-main</span>&gt;</span>Main<span class="hljs-tag">&lt;/<span class="hljs-name">el-main</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-container</span>&gt;</span>
</code></pre>
<h2 data-id="heading-4">v-if</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!['mixin'].includes(appStore.layoutMode)"</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>om<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>OM OS<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>
</code></pre>
<p>v-if 是vue提供的<strong>条件渲染指令</strong>，作用是<strong>根据表达式的真假来决定是否渲染这个元素（或组件）</strong>。当表达式为false时，vue会完全移除这个元素，不会出现在DOM中。</p>
<p>也就是说，在上面的代码中，当layoutMode中不含mixin时，om不会被渲染，显示的文本是OM OS</p>
<p>同理：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"mode==='horizontal'"</span>&gt;</span>
......
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"mode === 'vertical'"</span>&gt;</span>
......
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>也是在符合条件的情况下，template才会被渲染</p>
<p>至于这里为什么用template，主要是因为<strong>v-if只能绑定在一个元素上</strong>，但有时你必须包住多个节点，所以vue提供<code>&lt;template v-if="condition"&gt;</code>用于对多个子元素统一控制显示/隐藏</p>
<p>这里不用div的原因是，<strong>template 不会渲染标签内容，只会渲染内部内容</strong>，而div会在页面中渲染一个实际的div</p>
<h2 data-id="heading-5">动态绑定css</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"#373839"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-bar-left-icon"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"{'is-active':appStore.sidebar.opened}"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"展开"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Expand</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"#373839"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-bar-left-icon"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"{'is-active':!appStore.sidebar.opened}"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"折叠"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Fold</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.bar-left-ex</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;

    <span class="hljs-selector-class">.nav-bar-left-icon</span> {
        ……
     }

  
    <span class="hljs-selector-class">.is-active</span> {
      <span class="hljs-attribute">display</span>: none;
    }

}
</code></pre>
<p>这里<code>:class="{'is-active': appStore.sidebar.opened}</code>是动态Class绑定，写法含义：</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">'is-active'</span>: appStore.<span class="hljs-property">sidebar</span>.<span class="hljs-property">opened</span>
}
</code></pre>
<ul>
<li>如果<code>appStore.sidebar.opened === true</code> -&gt; 给这个元素添加<code>is-active</code>class</li>
<li>如果为false -&gt; 不添加</li>
</ul>
<p>通过改变appStore.sidebar.opened的值，来使el-icon显示或者不显示</p>
<h2 data-id="heading-6">el-scrollbar</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">el-scrollbar</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-menu</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"hor-menu"</span>
        <span class="hljs-attr">:mode</span>=<span class="hljs-string">"mode"</span>
        <span class="hljs-attr">ellipsis</span>
        <span class="hljs-attr">:default-active</span>=<span class="hljs-string">"currentRoute.path"</span>
        <span class="hljs-attr">background-color</span>=<span class="hljs-string">"transparent"</span>
        &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">MenuItems</span> <span class="hljs-attr">:routes</span>=<span class="hljs-string">"filteredRoutes"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-scrollbar</span>&gt;</span>
</code></pre>
<ul>
<li>el-scrollbar</li>
</ul>
<p>ElementPlus提供的菜单滚动容器，如果菜单太长，超过屏幕宽度，会出现滚动区域，而不是挤到一行显示不下。</p>
<ul>
<li>el-menu：ElementPlus菜单组件
<ul>
<li>
<p>:mode="mode"
指定菜单模式，horizontal-&gt;横向菜单（用于顶部导航），vertical-&gt;纵向菜单（用于侧边栏）</p>
</li>
<li>
<p>ellipsis：ElementPlus自带属性，开启文字过长时的省略号效果</p>
</li>
<li>
<p><code>:default-active="currentRoute.path"</code>：菜单默认选中当前路由对应的菜单项，例如当前路由 <code>/home</code>，那么 <code>"/home"</code> 的菜单项会高亮，<strong>菜单随着路由变化自动更新状态</strong>。</p>
</li>
</ul>
</li>
</ul>
<h2 data-id="heading-7">导航栏</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
    <span class="hljs-attr">mode</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
        <span class="hljs-attr">default</span>: <span class="hljs-string">'vertical'</span>
        <span class="hljs-comment">// default: 'horizontal'</span>
    }
})
</code></pre>
<h3 data-id="heading-8">prop</h3>
<p>prop：<strong>父组件传给子组件的数据</strong>，就像函数的参数，组件也需要参数才能知道该怎么工作，而props就是这个参数</p>
<ul>
<li>为什么需要props?</li>
</ul>
<p>因为组件是可以复用的，不能在组件里写死数据，例如做一个按钮组件<code>&lt;MyButton&gt;</code></p>
<ul>
<li>有的按钮是红色</li>
<li>有的是绿色</li>
<li>有的是大按钮</li>
<li>有的是小按钮</li>
</ul>
<p>如果都写死，那组件就没法复用了</p>
<p>所以props让这样用：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"red"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"large"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"green"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> /&gt;</span>
</code></pre>
<h3 data-id="heading-9">vue中如何定义</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">color</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">size</span>: <span class="hljs-title class_">String</span>
})
</code></pre>
<p>例如：</p>
<p>子组件:</p>
<pre><code class="hljs language-js" lang="js">&lt;script setup&gt;
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">mode</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'vertical'</span>
  }
})
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>当前模式：{{ props.mode }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<p>父组件：</p>
<p>父组件只是传值，不定义props</p>
<pre><code class="hljs language-js" lang="js">&lt;<span class="hljs-title class_">MyMenu</span> mode=<span class="hljs-string">"horizontal"</span> /&gt;

</code></pre>
<blockquote>
<p>除了父组件，任何地方都不能直接修改props
因为vue的设计理念是：父组件负责数据，子组件负责展示和逻辑，子组件不能私自篡改父组件的数据</p>
</blockquote>
<h2 data-id="heading-10">v-model</h2>
<p><strong>v-model = 把组件的值和变量做双向绑定</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">el-switch</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"default"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"appStore.watermarking"</span>  @<span class="hljs-attr">change</span>=<span class="hljs-string">"appStore.changeWatermarking()"</span>/&gt;</span>
</code></pre>
<p>即：</p>
<ul>
<li><code>el-switch</code> 显示的开/关状态 = <code>appStore.watermarking</code></li>
<li>你点击 switch → Element Plus 自动把新值写回 <code>appStore.watermarking</code></li>
</ul>
<p>也就是说，点switch的同时，ElementPlus自动执行<code>appStore.watermarking = true/false</code></p>
<p>@change这里用来进行一些存数据库或发日志等辅助操作：</p>
<pre><code class="hljs language-html" lang="html">const changeWatermarking = () =&gt; {
        dbUtils.set('watermarking', watermarking.value);
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vite 环境变量配置经验总结]]></title>    <link>https://juejin.cn/post/7579441333166866441</link>    <guid>https://juejin.cn/post/7579441333166866441</guid>    <pubDate>2025-12-03T14:50:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579441333166866441" data-draft-id="7579641251910123530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vite 环境变量配置经验总结"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-03T14:50:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="睡神雾雨"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102705000"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vite 环境变量配置经验总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102705000/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    睡神雾雨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T14:50:34.000Z" title="Wed Dec 03 2025 14:50:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">目录</h2>
<ol>
<li><a href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B" title="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B">快速开始</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5" title="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">核心概念</a></li>
<li><a href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F" title="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F">环境变量文件系统</a></li>
<li><a href="#%E5%91%BD%E4%BB%A4%E4%B8%8E%E7%8E%AF%E5%A2%83%E5%AF%B9%E5%BA%94" title="#%E5%91%BD%E4%BB%A4%E4%B8%8E%E7%8E%AF%E5%A2%83%E5%AF%B9%E5%BA%94">命令与环境对应</a></li>
<li><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" title="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" title="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">常见问题</a></li>
<li><a href="#%E6%89%A9%E5%B1%95%E5%85%B6%E4%BB%96%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F" title="#%E6%89%A9%E5%B1%95%E5%85%B6%E4%BB%96%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F">扩展：其他加载方式</a></li>
</ol>
<hr/>
<h2 data-id="heading-1">快速开始</h2>
<h3 data-id="heading-2">三步上手</h3>
<p><strong>第一步：创建 <code>.env</code> 文件</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># .env.development</span>
VITE_API_URL=http://localhost:3000

<span class="hljs-comment"># .env.production</span>
VITE_API_URL=https://api.example.com
</code></pre>
<p><strong>第二步：在代码中访问</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 任意 .vue、.tsx、.js 文件中</span>
<span class="hljs-keyword">const</span> apiUrl = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_URL</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(apiUrl); <span class="hljs-comment">// 开发环境输出: http://localhost:3000</span>
</code></pre>
<p><strong>第三步：运行项目</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm run dev    <span class="hljs-comment"># 自动加载 .env.development</span>
npm run build  <span class="hljs-comment"># 自动加载 .env.production</span>
</code></pre>
<h3 data-id="heading-3">核心要点</h3>
<ul>
<li>✅ 变量名必须以 <code>VITE_</code> 开头</li>
<li>✅ 修改 <code>.env</code> 文件后需重启开发服务器</li>
<li>✅ 使用 <code>import.meta.env.变量名</code> 访问</li>
</ul>
<hr/>
<h2 data-id="heading-4">核心概念</h2>
<h3 data-id="heading-5">Vite 环境变量的工作原理</h3>
<p>Vite 在构建时会读取 <code>.env</code> 文件，并将环境变量注入到你的应用中。</p>
<p><strong>关键特性：</strong></p>
<ol>
<li><strong>前缀限制</strong>：只有以 <code>VITE_</code> 开头的变量才会暴露给客户端代码</li>
<li><strong>构建时注入</strong>：环境变量在构建时就已经被静态替换到代码中</li>
<li><strong>模式驱动</strong>：通过 <code>mode</code> 参数决定加载哪个 <code>.env.[mode]</code> 文件</li>
</ol>
<h3 data-id="heading-6">为什么需要 <code>VITE_</code> 前缀？</h3>
<p>这是一个<strong>安全机制</strong>，防止敏感信息（如数据库密码、API 密钥）意外暴露到客户端代码中。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ✅ 会暴露给客户端</span>
VITE_API_URL=https://api.example.com

<span class="hljs-comment"># ❌ 不会暴露给客户端（仅在 vite.config.ts 中可用）</span>
DATABASE_PASSWORD=secret123
API_SECRET_KEY=xyz789
</code></pre>
<h3 data-id="heading-7">两种访问方式</h3>
<p><strong>客户端代码（浏览器）：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 只能访问 VITE_ 开头的变量</span>
<span class="hljs-keyword">const</span> apiUrl = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_URL</span>;
<span class="hljs-keyword">const</span> mode = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">MODE</span>;
<span class="hljs-keyword">const</span> isDev = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">DEV</span>;
</code></pre>
<p><strong>配置文件（Node.js）：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// vite.config.ts - 可以访问所有变量</span>
<span class="hljs-keyword">import</span> { defineConfig, loadEnv } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ mode }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> env = <span class="hljs-title function_">loadEnv</span>(mode, process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">''</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(env.<span class="hljs-property">VITE_API_URL</span>);      <span class="hljs-comment">// ✅ 可以访问</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(env.<span class="hljs-property">DATABASE_PASSWORD</span>);  <span class="hljs-comment">// ✅ 也可以访问</span>
  <span class="hljs-keyword">return</span> { <span class="hljs-comment">/* ... */</span> };
});
</code></pre>
<hr/>
<h2 data-id="heading-8">环境变量文件系统</h2>
<h3 data-id="heading-9">文件命名规则</h3>
<p>Vite 支持以下环境变量文件（按优先级从低到高）：</p>
<pre><code class="hljs language-bash" lang="bash">1. .<span class="hljs-built_in">env</span>                    <span class="hljs-comment"># 所有环境都会加载（最低优先级）</span>
2. .env.local              <span class="hljs-comment"># 所有环境都会加载，但会被 git 忽略</span>
3. .<span class="hljs-built_in">env</span>.[mode]             <span class="hljs-comment"># 只在指定 mode 时加载</span>
4. .<span class="hljs-built_in">env</span>.[mode].<span class="hljs-built_in">local</span>       <span class="hljs-comment"># 只在指定 mode 时加载，但会被 git 忽略（最高优先级）</span>
</code></pre>
<h3 data-id="heading-10">加载顺序</h3>
<p><strong>后加载的文件会覆盖前面加载的文件中相同的变量</strong></p>
<p>示例：运行 <code>vite --mode development</code> 时</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> .env                    → 加载（基础配置）
<span class="hljs-bullet">2.</span> .env.local              → 加载（本地覆盖，如果存在）
<span class="hljs-bullet">3.</span> .env.development        → 加载（开发环境配置）
<span class="hljs-bullet">4.</span> .env.development.local  → 加载（开发环境本地覆盖，如果存在，最高优先级）
</code></pre>
<h3 data-id="heading-11">文件优先级表</h3>















































<table><thead><tr><th>优先级</th><th>文件名</th><th>何时加载</th><th>Git 状态</th><th>用途</th></tr></thead><tbody><tr><td>1（最低）</td><td><code>.env</code></td><td>所有模式</td><td>通常提交</td><td>公共配置</td></tr><tr><td>2</td><td><code>.env.local</code></td><td>所有模式</td><td>不提交</td><td>本地公共覆盖</td></tr><tr><td>3</td><td><code>.env.[mode]</code></td><td>指定 mode</td><td>通常提交</td><td>环境特定配置</td></tr><tr><td>4（最高）</td><td><code>.env.[mode].local</code></td><td>指定 mode</td><td>不提交</td><td>环境特定本地覆盖</td></tr><tr><td>-</td><td><code>.env.example</code></td><td><strong>从不加载</strong></td><td>提交</td><td>仅作示例模板</td></tr></tbody></table>
<h3 data-id="heading-12"><code>.env.example</code> 说明</h3>
<p><strong><code>.env.example</code> 文件不会被 Vite 自动读取</strong>，它只是一个示例模板文件，用于：</p>
<ul>
<li>告诉开发者需要配置哪些环境变量</li>
<li>作为文档说明</li>
<li>通常提交到 Git 仓库</li>
<li>开发者可以复制它来创建实际的 <code>.env</code> 文件</li>
</ul>
<hr/>
<h2 data-id="heading-13">命令与环境对应</h2>
<h3 data-id="heading-14">默认命令行为</h3>



































<table><thead><tr><th>命令</th><th>NODE_ENV</th><th>mode</th><th>读取的 .env 文件</th></tr></thead><tbody><tr><td><code>vite</code></td><td><code>development</code></td><td><code>development</code></td><td><code>.env</code> → <code>.env.local</code> → <code>.env.development</code> → <code>.env.development.local</code></td></tr><tr><td><code>vite build</code></td><td><code>production</code></td><td><code>production</code></td><td><code>.env</code> → <code>.env.local</code> → <code>.env.production</code> → <code>.env.production.local</code></td></tr><tr><td><code>vite preview</code></td><td><code>production</code></td><td><code>production</code></td><td><strong>不读取</strong>（使用构建时的值）</td></tr><tr><td><code>vitest</code></td><td><code>test</code></td><td><code>test</code></td><td><code>.env</code> → <code>.env.local</code> → <code>.env.test</code> → <code>.env.test.local</code></td></tr></tbody></table>
<h3 data-id="heading-15">补充说明 1：<code>vite preview</code> 不读取环境变量</h3>
<p><strong><code>vite preview</code> 不会读取新的 <code>.env</code> 文件</strong>，原因：</p>
<ul>
<li><code>vite preview</code> 只是预览已经构建好的 <code>dist</code> 目录</li>
<li>环境变量在 <code>vite build</code> 时就已经注入到代码中</li>
<li><code>preview</code> 阶段不会重新构建，所以不会重新读取 <code>.env</code></li>
</ul>
<p>如果需要不同的预览环境，需要在构建时指定不同的 <code>--mode</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 构建时使用不同的 mode</span>
vite build --mode staging
vite preview
</code></pre>
<h3 data-id="heading-16">补充说明 2：NODE_ENV vs mode</h3>
<p>细心的读者会注意到，上面的表格中有 <code>NODE_ENV</code> 和 <code>mode</code> 两列，它们是<strong>两个独立的概念</strong>，容易混淆：</p>
<p><strong><code>process.env.NODE_ENV</code></strong></p>
<ul>
<li>Node.js 环境变量，控制构建优化（代码压缩、tree-shaking）</li>
<li>由 Vite 根据命令自动设置：<code>vite</code> → <code>development</code>，<code>vite build</code> → <code>production</code></li>
<li>在 <code>vite.config.ts</code> 中通过 <code>process.env.NODE_ENV</code> 访问</li>
</ul>
<p><strong><code>mode</code>（模式）</strong></p>
<ul>
<li>Vite 的模式参数，决定加载哪个 <code>.env.[mode]</code> 文件</li>
<li>可以是任意自定义值（如 <code>staging</code>、<code>test</code>）</li>
<li>通过 <code>--mode</code> 参数指定，在客户端通过 <code>import.meta.env.MODE</code> 访问</li>
</ul>
<p><strong>关键区别：</strong></p>



































<table><thead><tr><th>命令</th><th>NODE_ENV</th><th>mode</th><th>说明</th></tr></thead><tbody><tr><td><code>vite</code></td><td><code>development</code></td><td><code>development</code></td><td>默认相同</td></tr><tr><td><code>vite build</code></td><td><code>production</code></td><td><code>production</code></td><td>默认相同</td></tr><tr><td><code>vite build --mode staging</code></td><td><code>production</code></td><td><code>staging</code></td><td><strong>可以不同</strong> ⚠️</td></tr><tr><td><code>NODE_ENV=test vite build</code></td><td><code>test</code></td><td><code>production</code></td><td><strong>可以不同</strong> ⚠️</td></tr></tbody></table>
<p>💡 <strong>推荐做法</strong>：在 Vite 项目中，优先使用 <code>import.meta.env.MODE</code> 来判断环境，而不是依赖 <code>process.env.NODE_ENV</code>。</p>
<hr/>
<h2 data-id="heading-17">最佳实践</h2>
<h3 data-id="heading-18">1. 完整的文件结构</h3>
<pre><code class="hljs language-bash" lang="bash">project/
├── .<span class="hljs-built_in">env</span>                    <span class="hljs-comment"># 所有环境的公共配置（提交）</span>
├── .env.development        <span class="hljs-comment"># 开发环境配置（提交）</span>
├── .env.production         <span class="hljs-comment"># 生产环境配置（提交）</span>
├── .env.local             <span class="hljs-comment"># 本地覆盖配置（不提交）</span>
├── .env.example           <span class="hljs-comment"># 示例模板（提交）</span>
└── .gitignore             <span class="hljs-comment"># 添加 .env*.local</span>
</code></pre>
<p><strong>示例内容：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># .env - 公共配置</span>
VITE_APP_NAME=My App

<span class="hljs-comment"># .env.development</span>
VITE_API_URL=http://localhost:3000
VITE_DEBUG=<span class="hljs-literal">true</span>

<span class="hljs-comment"># .env.production</span>
VITE_API_URL=https://api.example.com
VITE_DEBUG=<span class="hljs-literal">false</span>

<span class="hljs-comment"># .env.example - 示例模板</span>
VITE_API_URL=
VITE_APP_NAME=
</code></pre>
<h3 data-id="heading-19">2. 命名规范</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ✅ 正确写法</span>
VITE_API_BASE_URL=https://api.example.com
VITE_APP_TITLE=My App
VITE_ENABLE_MOCK=<span class="hljs-literal">true</span>

<span class="hljs-comment"># ❌ 错误写法（客户端无法访问）</span>
API_BASE_URL=https://api.example.com
appTitle=My App
</code></pre>
<p><strong>规则：</strong></p>
<ul>
<li>必须以 <code>VITE_</code> 开头</li>
<li>使用全大写字母</li>
<li>单词间用下划线分隔</li>
</ul>
<h3 data-id="heading-20">3. 客户端代码使用</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 访问环境变量</span>
<span class="hljs-keyword">const</span> apiUrl = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_URL</span>;

<span class="hljs-comment">// 内置变量</span>
<span class="hljs-keyword">const</span> mode = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">MODE</span>;       <span class="hljs-comment">// 当前模式</span>
<span class="hljs-keyword">const</span> isDev = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">DEV</span>;       <span class="hljs-comment">// 是否开发环境</span>
<span class="hljs-keyword">const</span> isProd = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">PROD</span>;     <span class="hljs-comment">// 是否生产环境</span>
<span class="hljs-keyword">const</span> baseUrl = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">BASE_URL</span>; <span class="hljs-comment">// 公共基础路径</span>

<span class="hljs-comment">// 带默认值</span>
<span class="hljs-keyword">const</span> debug = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_DEBUG</span> || <span class="hljs-string">'false'</span>;
</code></pre>
<h3 data-id="heading-21">4. 在 vite.config.ts 中使用</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineConfig, loadEnv } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ mode }</span>) =&gt;</span> {
  <span class="hljs-comment">// 加载环境变量</span>
  <span class="hljs-keyword">const</span> env = <span class="hljs-title function_">loadEnv</span>(mode, process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">''</span>);
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-comment">// 方式1: 使用 define 注入全局常量</span>
    <span class="hljs-attr">define</span>: {
      <span class="hljs-attr">__APP_VERSION__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-string">'1.0.0'</span>),
      <span class="hljs-attr">__API_URL__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(env.<span class="hljs-property">VITE_API_URL</span>),
    },
  
    <span class="hljs-comment">// 方式2: 根据环境变量配置插件</span>
    <span class="hljs-attr">server</span>: {
      <span class="hljs-attr">port</span>: <span class="hljs-title class_">Number</span>(env.<span class="hljs-property">VITE_PORT</span>) || <span class="hljs-number">3000</span>,
      <span class="hljs-attr">proxy</span>: env.<span class="hljs-property">VITE_API_URL</span> ? {
        <span class="hljs-string">'/api'</span>: {
          <span class="hljs-attr">target</span>: env.<span class="hljs-property">VITE_API_URL</span>,
          <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
        }
      } : <span class="hljs-literal">undefined</span>,
    },
  };
});
</code></pre>
<h3 data-id="heading-22">5. TypeScript 类型支持</h3>
<p>创建 <code>env.d.ts</code> 为环境变量添加类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/// &lt;reference types="vite/client" /&gt;</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ImportMetaEnv</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">VITE_API_URL</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">VITE_APP_NAME</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">VITE_DEBUG</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ImportMeta</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">env</span>: <span class="hljs-title class_">ImportMetaEnv</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-23">常见问题</h2>
<p><strong>Q: 为什么我的环境变量在客户端访问不到？</strong>
A: 确保变量名以 <code>VITE_</code> 开头，并且重新启动开发服务器。</p>
<p><strong>Q: 如何在不同环境使用不同的配置？</strong>
A: 创建 <code>.env.development</code>、<code>.env.production</code> 等文件，或使用 <code>--mode</code> 参数。</p>
<p><strong>Q: <code>vite preview</code> 能读取新的环境变量吗？</strong>
A: 不能，环境变量在构建时就已经注入，需要重新构建才能更新。</p>
<p><strong>Q: <code>.env.example</code> 会被 Vite 加载吗？</strong>
A: 不会，它只是示例模板，需要复制为实际的 <code>.env</code> 文件。</p>
<hr/>
<h2 data-id="heading-24">扩展：其他加载方式</h2>
<p>在非 Vite 项目或 Node.js 脚本中，你可能需要其他方式加载环境变量。</p>
<h3 data-id="heading-25">方式对比</h3>



































<table><thead><tr><th>方式</th><th>适用场景</th><th>使用方法</th><th>说明</th></tr></thead><tbody><tr><td><strong>Vite 内置</strong></td><td>Vite 项目</td><td>自动加载，无需配置</td><td>✅ 推荐</td></tr><tr><td><strong>dotenv 库</strong></td><td>Node.js 脚本</td><td><code>require('dotenv').config()</code></td><td>需要安装依赖</td></tr><tr><td><strong>Node.js 原生</strong></td><td>Node.js 20.6+</td><td><code>node --env-file=.env app.js</code></td><td>无需依赖，原生支持</td></tr><tr><td><strong>tsx</strong></td><td>TypeScript 文件</td><td><code>tsx --env-file=.env app.ts</code></td><td>直接运行 .ts 文件</td></tr></tbody></table>
<h3 data-id="heading-26">dotenv 库使用</h3>
<pre><code class="hljs language-bash" lang="bash">npm install dotenv
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 基本用法</span>
<span class="hljs-keyword">import</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">'dotenv'</span>;
dotenv.<span class="hljs-title function_">config</span>();

<span class="hljs-comment">// 指定文件</span>
dotenv.<span class="hljs-title function_">config</span>({ <span class="hljs-attr">path</span>: <span class="hljs-string">'.env.development'</span> });

<span class="hljs-comment">// 访问变量</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_HOST</span>);
</code></pre>
<h3 data-id="heading-27">Node.js 原生支持（20.6+）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 命令行使用</span>
node --env-file=.<span class="hljs-built_in">env</span> app.js

<span class="hljs-comment"># package.json</span>
{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"node --env-file=.env.development src/index.js"</span>
  }
}
</code></pre>
<h3 data-id="heading-28">TypeScript 类型声明</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// env.d.ts</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> {
  <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">NodeJS</span> {
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProcessEnv</span> {
      <span class="hljs-attr">DB_HOST</span>: <span class="hljs-built_in">string</span>;
      <span class="hljs-attr">API_KEY</span>: <span class="hljs-built_in">string</span>;
    }
  }
}

<span class="hljs-keyword">export</span> {};
</code></pre>
<hr/>
<p><strong>适用版本</strong>：Vite 5.x+, Node.js 20.6+</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 中 `this` 的真相：由调用方式决定的动态指针]]></title>    <link>https://juejin.cn/post/7579441333166915593</link>    <guid>https://juejin.cn/post/7579441333166915593</guid>    <pubDate>2025-12-03T15:28:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579441333166915593" data-draft-id="7579494852652990498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 中 `this` 的真相：由调用方式决定的动态指针"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-03T15:28:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="izx888"/> <meta itemprop="url" content="https://juejin.cn/user/1241762540820323"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 中 `this` 的真相：由调用方式决定的动态指针
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1241762540820323/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    izx888
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T15:28:57.000Z" title="Wed Dec 03 2025 15:28:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 中 <code>this</code> 的真相：由调用方式决定的动态指针</h2>
<p>在 JavaScript 中，<code>this</code> 是一个看似简单却极易被误解的概念。它不像其他语言中的 <code>this</code> 那样固定指向当前对象，而是一个<strong>运行时绑定</strong>的动态指针——它的值完全取决于函数<strong>如何被调用</strong>，而非<strong>在哪里定义</strong>。</p>
<p>本文将从一段典型代码出发，深入剖析 <code>this</code> 的行为逻辑，并梳理其在不同场景下的指向规则，帮助你彻底掌握这一核心机制。</p>
<hr/>
<h3 data-id="heading-1">一、一个“反直觉”的现象</h3>
<p>考虑如下代码：</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">bar</span> = { 
  myName: "time.geekbang.com",
  printName: function() {
    console.log(this.myName)<span class="hljs-comment">;</span>
  }
}<span class="hljs-comment">;</span>

let <span class="hljs-attr">myName</span> = <span class="hljs-string">'极客邦'</span><span class="hljs-comment">;</span>
let <span class="hljs-attr">_printName</span> = bar.printName<span class="hljs-comment">;</span>
_printName()<span class="hljs-comment">; // 输出 undefined（非严格模式下）</span>
bar.printName()<span class="hljs-comment">; // 输出 "time.geekbang.com"</span>
</code></pre>
<p>为什么同一个函数，两次调用结果却完全不同？</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1010bfea91a44a2aa2b441299f9ad6dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXp4ODg4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765380537&amp;x-signature=M63BQNEk%2BOBhx5TuyUxPnD034vc%3D" alt="屏幕截图 2025-12-03 194836.png" width="39%" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53efb751806f47939e7d5a38397642c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaXp4ODg4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765380537&amp;x-signature=fAxo7hfF8scnsIm8y9D5HRB%2FpnA%3D" alt="屏幕截图 2025-12-03 194830.png" width="59%" loading="lazy"/>
<p>关键在于：</p>
<ul>
<li><code>bar.printName()</code> 是<strong>作为对象方法调用</strong>，此时 <code>this</code> 指向 <code>bar</code>；</li>
<li><code>_printName()</code> 是<strong>作为普通函数调用</strong>，此时 <code>this</code> 指向全局对象（浏览器中为 <code>window</code>），而 <code>window.myName</code> 并未定义（注意：<code>let</code> 声明的变量不会挂载到 <code>window</code> 上），所以输出 <code>undefined</code>。</li>
</ul>
<p>这揭示了 <code>this</code> 的本质：<strong>它不关心函数在哪定义，只关心函数怎么被调用</strong>。</p>
<hr/>
<h3 data-id="heading-2">二、<code>this</code> 的四种常见绑定规则</h3>
<h4 data-id="heading-3">1. 默认绑定（普通函数调用）</h4>
<pre><code class="hljs language-scss" lang="scss">function <span class="hljs-built_in">foo</span>() {
  console<span class="hljs-selector-class">.log</span>(this); <span class="hljs-comment">// 非严格模式：window；严格模式：undefined</span>
}
<span class="hljs-built_in">foo</span>();
</code></pre>
<ul>
<li>在非严格模式下，<code>this</code> 指向全局对象；</li>
<li>在严格模式（<code>'use strict'</code>）下，<code>this</code> 为 <code>undefined</code>，避免意外污染全局。</li>
</ul>
<blockquote>
<p>⚠️ 这也是早期 JavaScript 被诟病的设计之一：函数本可独立存在，却强制赋予一个无意义的 <code>this</code>。</p>
</blockquote>
<hr/>
<h4 data-id="heading-4">2. 隐式绑定（对象方法调用）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'极客时间'</span>,
  <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
  }
};
obj.<span class="hljs-title function_">greet</span>(); <span class="hljs-comment">// "极客时间"</span>
</code></pre>
<p>当函数通过 <code>obj.fn()</code> 形式调用时，<code>this</code> 自动绑定到 <code>obj</code>。</p>
<p>⚠️ <strong>丢失绑定</strong>：一旦将方法赋值给变量或传入回调，就会退化为默认绑定：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">fn</span> = obj.greet<span class="hljs-comment">;</span>
fn()<span class="hljs-comment">; // this 指向 window（或 undefined），输出 undefined</span>
</code></pre>
<hr/>
<h4 data-id="heading-5">3. 显式绑定（<code>call</code> / <code>apply</code> / <code>bind</code>）</h4>
<pre><code class="hljs language-ini" lang="ini">function setName(name) {
  <span class="hljs-attr">this.name</span> = name<span class="hljs-comment">;</span>
}

const <span class="hljs-attr">user</span> = {}<span class="hljs-comment">;</span>
setName.call(user, '极客邦')<span class="hljs-comment">;</span>
console.log(user.name)<span class="hljs-comment">; // "极客邦"</span>
</code></pre>
<p>通过 <code>call</code>、<code>apply</code> 或 <code>bind</code>，我们可以<strong>手动指定</strong> <code>this</code> 的值，实现灵活的上下文控制。</p>
<hr/>
<h4 data-id="heading-6">4. 构造函数调用（<code>new</code> 绑定）</h4>
<pre><code class="hljs language-ini" lang="ini">function Person(name) {
  <span class="hljs-attr">this.name</span> = name<span class="hljs-comment">;</span>
}
const <span class="hljs-attr">p</span> = new Person(<span class="hljs-string">'极客时间'</span>)<span class="hljs-comment">;</span>
console.log(p.name)<span class="hljs-comment">; // "极客时间"</span>
</code></pre>
<p>使用 <code>new</code> 调用函数时，JavaScript 引擎会：</p>
<ol>
<li>创建一个新对象；</li>
<li>将 <code>this</code> 绑定到该对象；</li>
<li>执行构造函数；</li>
<li>返回新对象。</li>
</ol>
<p>此时 <code>this</code> 指向新创建的实例。</p>
<hr/>
<h3 data-id="heading-7">三、特殊场景：事件处理器中的 <code>this</code></h3>
<p>在 DOM 事件处理中，<code>this</code> 指向<strong>触发事件的元素</strong>：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"link"</span>&gt;</span>点击我<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"link"</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// &lt;a id="link"&gt;...&lt;/a&gt;</span>
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>这是浏览器引擎自动完成的绑定，属于隐式绑定的一种变体。</p>
<hr/>
<h3 data-id="heading-8">四、如何安全地访问对象属性？</h3>
<p>回到最初的问题：<strong>如何确保在方法内部正确访问对象自身的属性？</strong></p>
<p>答案是：<strong>始终通过 <code>this</code> 访问，并确保调用方式不会导致 <code>this</code> 丢失</strong>。</p>
<p>若需解耦方法引用，可使用以下策略：</p>
<ul>
<li>使用箭头函数（但注意：箭头函数没有自己的 <code>this</code>，会继承外层作用域）；</li>
<li>使用 <code>.bind()</code> 提前绑定上下文；</li>
<li>在类或对象中使用方法引用时，避免直接赋值，改用闭包或代理。</li>
</ul>
<p>例如：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">safePrint</span> = bar.printName.bind(bar)<span class="hljs-comment">;</span>
safePrint()<span class="hljs-comment">; // 正确输出 "time.geekbang.com"</span>
</code></pre>
<hr/>
<h3 data-id="heading-9">结语</h3>
<p><code>this</code> 是 JavaScript 中少有的<strong>运行时动态绑定</strong>机制，它打破了“词法作用域”的常规思维。理解其绑定规则，不仅能避免常见 bug，还能更自如地操控函数执行上下文。</p>
<p>记住一句话：</p>
<blockquote>
<p><strong><code>this</code> 不是你写在哪，而是你叫谁来执行。</strong></p>
</blockquote>
<p>掌握这一点，你就真正迈入了 JavaScript 进阶之门。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Retrofit 核心流程模拟实现深解析]]></title>    <link>https://juejin.cn/post/7579438351297921060</link>    <guid>https://juejin.cn/post/7579438351297921060</guid>    <pubDate>2025-12-03T10:35:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579438351297921060" data-draft-id="7576955345378836543" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Retrofit 核心流程模拟实现深解析"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-03T10:35:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="潜龙勿用之化骨龙"/> <meta itemprop="url" content="https://juejin.cn/user/2313028195058471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Retrofit 核心流程模拟实现深解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028195058471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    潜龙勿用之化骨龙
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T10:35:30.000Z" title="Wed Dec 03 2025 10:35:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>Retrofit 是一款广受欢迎的 HTTP 客户端库，以其优雅的声明式 API 设计深受开发者喜爱。本文将通过模拟实现，逐步解析 Retrofit 的核心机制，帮助您从源码层面理解其设计思想和技术实现。</p>
<h2 data-id="heading-1">模拟的三大核心机制</h2>
<h3 data-id="heading-2">1. 注解解析机制</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@GET(<span class="hljs-string">"user/{id}"</span>)</span>            解析请求方法和路径模板
<span class="hljs-meta">@Path(<span class="hljs-string">"id"</span>)</span> id: <span class="hljs-built_in">Int</span>          解析路径参数映射
</code></pre>
<p>以下是具体的代码实现：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Target</span>(AnnotationTarget.FUNCTION)
<span class="hljs-variable">@Retention</span>(AnnotationRetention.RUNTIME)
annotation class <span class="hljs-built_in">GET</span>(val <span class="hljs-attribute">path</span>: String)

<span class="hljs-variable">@Target</span>(AnnotationTarget.VALUE_PARAMETER)
<span class="hljs-variable">@Retention</span>(AnnotationRetention.RUNTIME)
annotation class <span class="hljs-built_in">Path</span>(val <span class="hljs-attribute">value</span>: String)
</code></pre>
<p><strong>模拟效果</strong>：实现了 Retrofit 的声明式接口定义模式</p>
<h3 data-id="heading-3">2. 动态代理拦截</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">(proxy: <span class="hljs-type">Any</span>, method: <span class="hljs-type">Method</span>, args: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Any</span>&gt;?)</span></span>: Any {
    <span class="hljs-keyword">val</span> getAnnotation = method.getAnnotation(GET::<span class="hljs-keyword">class</span>.java)
    <span class="hljs-comment">// 拦截方法调用，转换为网络请求逻辑</span>
}
</code></pre>
<p><strong>模拟效果</strong>：重现了 Retrofit 通过动态代理将接口方法转换为 HTTP 请求的核心原理</p>
<p>以下是具体的代码实现：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createApiService</span><span class="hljs-params">()</span></span>: ApiServiceMock {
    <span class="hljs-keyword">return</span> Proxy.newProxyInstance(
        ApiServiceMock::<span class="hljs-keyword">class</span>.java.classLoader,
        arrayOf(ApiServiceMock::<span class="hljs-keyword">class</span>.java),
        ApiServiceProxy()
    ) <span class="hljs-keyword">as</span> ApiServiceMock
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiServiceProxy</span> : <span class="hljs-type">InvocationHandler</span> {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">(proxy: <span class="hljs-type">Any</span>, method: <span class="hljs-type">Method</span>, args: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Any</span>&gt;?)</span></span>: Any {
        <span class="hljs-keyword">val</span> getAnnotation = method.getAnnotation(GET::<span class="hljs-keyword">class</span>.java)

        args?.forEach {
            log(<span class="hljs-string">"args --&gt;<span class="hljs-variable">$it</span>"</span>)
        }

        <span class="hljs-keyword">val</span> isSuspend = method.parameterTypes.lastOrNull() == Continuation::<span class="hljs-keyword">class</span>.java
        log(<span class="hljs-string">"isSuspend--<span class="hljs-variable">$isSuspend</span>"</span>)

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
            getAnnotation != <span class="hljs-literal">null</span> -&gt; {
                <span class="hljs-comment">// 处理 GET 请求</span>
                <span class="hljs-keyword">val</span> path = getAnnotation.path
                log(<span class="hljs-string">"原始路径--<span class="hljs-variable">$path</span>"</span>)
                <span class="hljs-keyword">val</span> requestParm = resolvePath(path, method, args)
                log(<span class="hljs-string">"解析后路径--<span class="hljs-variable">$requestParm</span>"</span>)

                <span class="hljs-keyword">if</span> (isSuspend) {
                    <span class="hljs-comment">// 如果是 suspend 方法，挂起协程并模拟异步请求，这和真正的Retrofit实现并不一致，但是思想是一致的。</span>
                    <span class="hljs-keyword">val</span> continuation = args?.last() <span class="hljs-keyword">as</span> Continuation&lt;Any&gt;
                    simulateAsyncOperation {
                        continuation.resume(
                            <span class="hljs-string">"GET request to <span class="hljs-variable">$requestParm</span> - Response: : User:<span class="hljs-subst">${requestParm.pathValue}</span>"</span>
                        )
                    }
                    <span class="hljs-keyword">return</span> kotlin.coroutines.intrinsics.COROUTINE_SUSPENDED <span class="hljs-comment">// 挂起协程</span>
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// 非 suspend 方法，直接返回结果</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"GET request to <span class="hljs-variable">$requestParm</span> - Response:  User:<span class="hljs-subst">${requestParm.pathValue}</span>"</span>
                }
            }

            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> UnsupportedOperationException(<span class="hljs-string">"Unknown method: <span class="hljs-subst">${method.name}</span>"</span>)
        }
    }
}
</code></pre>
<p>协程支持的模拟</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 准确识别 suspend 函数特征</span>
<span class="hljs-keyword">val</span> isSuspend = method.parameterTypes.lastOrNull() == Continuation::<span class="hljs-keyword">class</span>.java

<span class="hljs-comment">// 模拟异步回调机制</span>
simulateAsyncOperation {
    continuation.resume(<span class="hljs-string">"Response data"</span>)
}
</code></pre>
<p>这里和Retrofit 的实现不完全一致，但是思想是一致的，异步转成同步的实现。</p>
<p><strong>模拟效果</strong>：重现了 Retrofit 通过动态代理将接口方法转换为 HTTP 请求的核心原理</p>
<h3 data-id="heading-4">3. 路径参数替换</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 原始路径: "user/{id}"</span>
<span class="hljs-comment">// 经过 resolvePath 处理后: "user/4"</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">resolvePath</span><span class="hljs-params">(path: <span class="hljs-type">String</span>, method: <span class="hljs-type">Method</span>, args: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Any</span>&gt;?)</span></span>: RequestParm
</code></pre>
<p><strong>模拟效果</strong>：实现了 Retrofit 的路径参数动态替换机制</p>
<p>以下是具体的代码实现：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">resolvePath</span><span class="hljs-params">(path: <span class="hljs-type">String</span>, method: <span class="hljs-type">Method</span>, args: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Any</span>&gt;?)</span></span>: RequestParm {
    <span class="hljs-keyword">var</span> absolutePath = path
    <span class="hljs-keyword">val</span> parameters = method.parameters
    <span class="hljs-keyword">var</span> pathName = <span class="hljs-string">""</span>
    <span class="hljs-keyword">var</span> placeholderName = <span class="hljs-string">""</span>
    <span class="hljs-keyword">var</span> pathValue = <span class="hljs-string">""</span>

    parameters.forEachIndexed { index, parameter -&gt;
        <span class="hljs-comment">// 获取参数上的 @Path 注解</span>
        <span class="hljs-keyword">val</span> pathAnnotation = parameter.getAnnotation(Path::<span class="hljs-keyword">class</span>.java)
        <span class="hljs-keyword">if</span> (pathAnnotation != <span class="hljs-literal">null</span>) {
            placeholderName = pathAnnotation.value
            log(<span class="hljs-string">"placeholderName--&gt;<span class="hljs-variable">$placeholderName</span>"</span>)
            pathName = placeholderName
            <span class="hljs-keyword">val</span> placeholder = <span class="hljs-string">"\\{<span class="hljs-variable">$placeholderName</span>\\}"</span>.toRegex()
            log(<span class="hljs-string">"placeholder--&gt;<span class="hljs-variable">$placeholder</span>"</span>)
            <span class="hljs-keyword">if</span> (args != <span class="hljs-literal">null</span> &amp;&amp; index &lt; args.size) {
                log(<span class="hljs-string">"index--&gt;<span class="hljs-variable">$index</span> and args --&gt;<span class="hljs-subst">${args[index].toString()}</span>"</span>)
                pathValue = args[index].toString()
                absolutePath = absolutePath.replace(placeholder, args[index].toString())
                log(<span class="hljs-string">"替换占位符 {<span class="hljs-variable">$placeholderName</span>} -&gt; <span class="hljs-subst">${args[index]}</span>"</span>)
            }
        }
    }
    <span class="hljs-keyword">return</span> RequestParm(pathName, absolutePath, pathValue)
}
</code></pre>
<p>异步代码同步化调用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    <span class="hljs-keyword">val</span> apiService = createApiService()
    <span class="hljs-keyword">val</span> userResponse = apiService.getUserById(<span class="hljs-number">4</span>)
    log(userResponse.toString())
}
</code></pre>
<h2 data-id="heading-5">核心流程模拟对比</h2>
<h3 data-id="heading-6">Retrofit 实际流程 vs 您的模拟实现</h3>








































<table><thead><tr><th>阶段</th><th>Retrofit 实际实现</th><th>您的模拟实现</th></tr></thead><tbody><tr><td><strong>接口定义</strong></td><td><code>@GET("user/{id}")</code> + <code>@Path("id")</code></td><td>✅ 完全模拟</td></tr><tr><td><strong>代理创建</strong></td><td><code>Retrofit.create()</code> 动态代理</td><td>✅ <code>createApiService()</code> 动态代理</td></tr><tr><td><strong>方法拦截</strong></td><td><code>InvocationHandler.invoke()</code></td><td>✅ <code>ApiServiceProxy.invoke()</code></td></tr><tr><td><strong>注解解析</strong></td><td><code>ServiceMethod</code> 解析注解</td><td>✅ <code>resolvePath()</code> 解析路径参数</td></tr><tr><td><strong>请求构建</strong></td><td><code>Request.Builder()</code></td><td>✅ 路径模板替换</td></tr><tr><td><strong>协程支持</strong></td><td><code>CallAdapter</code> 处理 suspend</td><td>✅ 检查 <code>Continuation</code> 参数</td></tr></tbody></table>
<h2 data-id="heading-7">Retrofit 核心流程示意图</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed5bf7217c194a32a677be054443e3bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765362929&amp;x-signature=6HQTVlXkPqZ7umNTbqTLezGQTTc%3D" alt="deepseek_mermaid_20251127_863a9e.png" loading="lazy"/></p>
<h2 data-id="heading-8">核心类协作时序图</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant U as 用户代码
    participant P as 动态代理
    participant A as 注解解析器
    participant R as 请求构建器
    participant C as 协程处理器

    U-&gt;&gt;P: api.getUserById(4)
    P-&gt;&gt;A: 解析@GET("user/{id}")
    A-&gt;&gt;A: 提取路径模板
    P-&gt;&gt;A: 解析@Path("id")参数
    A-&gt;&gt;R: 路径模板 + 参数值
    R-&gt;&gt;R: "user/{id}" → "user/4"
    R-&gt;&gt;C: 检测suspend函数
    alt 是suspend函数
        C-&gt;&gt;C: 挂起协程，异步执行
        C-&gt;&gt;U: 4秒后resume结果
    else 普通函数
        C-&gt;&gt;U: 立即返回结果
    end
</code></pre>
<h2 data-id="heading-9">关键技术点模拟分析</h2>
<h3 data-id="heading-10">1. 声明式 API 设计</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 您的模拟 - 与 Retrofit 高度相似</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiServiceMock</span> {
    <span class="hljs-meta">@GET(<span class="hljs-string">"user/{id}"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@Path(<span class="hljs-string">"id"</span>)</span> id: <span class="hljs-type">Int</span>)</span></span>: String?
}
</code></pre>
<h3 data-id="heading-11">2. 动态代理的核心作用</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 您的实现准确抓住了动态代理的本质</span>
<span class="hljs-keyword">return</span> Proxy.newProxyInstance(
    ApiServiceMock::<span class="hljs-keyword">class</span>.java.classLoader,
    arrayOf(ApiServiceMock::<span class="hljs-keyword">class</span>.java),
    ApiServiceProxy()  <span class="hljs-comment">// 关键：自定义调用处理</span>
)
</code></pre>
<h3 data-id="heading-12">3. 路径参数解析的精髓</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 模拟了 Retrofit 的路径参数替换逻辑</span>
absolutePath = absolutePath.replace(placeholder, args[index].toString())
<span class="hljs-comment">// "user/{id}" → "user/4"</span>
</code></pre>
<h3 data-id="heading-13">4. 协程支持的模拟</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 准确识别 suspend 函数特征</span>
<span class="hljs-keyword">val</span> isSuspend = method.parameterTypes.lastOrNull() == Continuation::<span class="hljs-keyword">class</span>.java

<span class="hljs-comment">// 模拟异步回调机制</span>
simulateAsyncOperation {
    continuation.resume(<span class="hljs-string">"Response data"</span>)
}
</code></pre>
<h2 data-id="heading-14">流程图详细说明</h2>
<h3 data-id="heading-15">第一阶段：接口定义期</h3>
<pre><code class="hljs">用户代码 → 注解声明 → Retrofit构建
</code></pre>
<ul>
<li><strong>用户</strong>：定义接口方法和注解</li>
<li><strong>Retrofit</strong>：创建动态代理实例</li>
</ul>
<h3 data-id="heading-16">第二阶段：方法调用期</h3>
<pre><code class="hljs">方法调用 → 代理拦截 → 注解解析 → 请求构建
</code></pre>
<ul>
<li><strong>动态代理</strong>：拦截所有接口方法调用</li>
<li><strong>注解处理器</strong>：解析方法注解和参数注解</li>
<li><strong>请求构建器</strong>：替换路径参数，生成完整URL</li>
</ul>
<h3 data-id="heading-17">第三阶段：响应处理期</h3>
<pre><code class="hljs">请求执行 → 协程控制 → 结果返回
</code></pre>
<ul>
<li><strong>协程检测</strong>：通过 Continuation 参数识别挂起函数</li>
<li><strong>异步模拟</strong>：使用回调机制模拟网络请求</li>
<li><strong>结果返回</strong>：通过 resume 或直接返回传递结果</li>
</ul>
<h2 data-id="heading-18">核心流程覆盖</h2>
<p>我实现覆盖了 Retrofit 最关键的几个流程：</p>
<ul>
<li>✅ 接口方法到 HTTP 请求的转换</li>
<li>✅ 注解信息的提取和应用</li>
<li>✅ 路径参数的动态替换</li>
<li>✅ 协程异步支持的基础机制</li>
</ul>
<h2 data-id="heading-19">总结</h2>
<p>本文通过模拟实现，精准复现了 Retrofit 的核心流程，包括声明式接口、动态代理、注解处理和协程支持。这种简化实现方式不仅帮助我们理解复杂框架的设计思想，也为开发者提供了深入学习的参考。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Android】RecyclerView 刷新方式全解析：从 notifyDataSetChanged 到 DiffUtil]]></title>    <link>https://juejin.cn/post/7579451710303469594</link>    <guid>https://juejin.cn/post/7579451710303469594</guid>    <pubDate>2025-12-03T13:41:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579451710303469594" data-draft-id="7579441333166718985" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Android】RecyclerView 刷新方式全解析：从 notifyDataSetChanged 到 DiffUtil"/> <meta itemprop="keywords" content="Android,Java"/> <meta itemprop="datePublished" content="2025-12-03T13:41:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="泥嚎泥嚎"/> <meta itemprop="url" content="https://juejin.cn/user/1197828179492985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Android】RecyclerView 刷新方式全解析：从 notifyDataSetChanged 到 DiffUtil
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1197828179492985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    泥嚎泥嚎
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T13:41:02.000Z" title="Wed Dec 03 2025 13:41:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【Android】RecyclerView 刷新方式全解析：从 notifyDataSetChanged 到 DiffUtil</h2>
<p>RecyclerView 是 Android 开发中最常用的 UI 组件之一，而“如何刷新列表”是每个开发者必然会遇到的问题。</p>
<p>刚开始学 Android 时，只会用：</p>
<pre><code class="hljs language-java" lang="java">adapter.notifyDataSetChanged();
</code></pre>
<p>简单粗暴，能解决大部分需求，但是这种方式缺点很多，真正项目中我们更需要性能更好、动画更自然、刷新粒度更精准的刷新方式。</p>
<p>本文将从最基础的 <code>notifyDataSetChanged()</code> 开始，介绍 RecyclerView 所有刷新方式。</p>
<h3 data-id="heading-1">1. notifyDataSetChanged() —— 全量刷新</h3>
<p>这应该是每个新手最先掌握的一种刷新方式，使用方法很简单：</p>
<pre><code class="hljs language-java" lang="java">adapter.notifyDataSetChanged();
</code></pre>
<p>调用后，通知 RecyclerView 整个数据集已变化，强制重新执行所有 item 的 onBindViewHolder，不计算差异、不做局部优化，会导致全量刷新。</p>
<p><strong>优点</strong>：这种方式优点非常明显，简单易用，一行代码搞定，不需要复杂逻辑。</p>
<p><strong>缺点</strong>：性能最差，所有 item 都会重新绑定、重绘；无动画效果；不能指定变化位置；可能导致界面闪烁。</p>
<p><strong>适用场景</strong>：数据结构完全变化，旧数据与全新数据无任何关联；初始加载；调试、临时代码使用；数据量很小（&lt;10）。</p>
<blockquote>
<p>能不用就不用。它是最笨的方法，但也最不推荐。</p>
</blockquote>
<h3 data-id="heading-2">2. notifyItemXXX 系列 —— 局部刷新</h3>
<p>RecyclerView 提供了很多局部刷新方法，只让“变化的部分”刷新。</p>
<h4 data-id="heading-3">2.1 notifyItemChanged(int position) —— 刷新单个Item</h4>
<p>只刷新指定 position 对应 item。</p>
<pre><code class="hljs language-java" lang="java">adapter.notifyItemChanged(position);
</code></pre>
<p><strong>优点</strong>：刷新单个 item，性能好一些。</p>
<p><strong>缺点</strong>：默认仍会重绘整个 item，常出现轻微闪烁。</p>
<h4 data-id="heading-4">2.2 notifyItemChanged(int position, Object payload) —— 局部刷新</h4>
<p>只刷新 item 内部的<strong>某个控件</strong>，不会重绘整个 item。</p>
<p>需要重载带 <code>payload</code> 的 <code>onBindViewHolder</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> VH holder, <span class="hljs-type">int</span> position, <span class="hljs-meta">@NonNull</span> List&lt;Object&gt; payloads)</span> {
    <span class="hljs-keyword">if</span> (!payloads.isEmpty()) {
        <span class="hljs-comment">// 局部刷新：处理 payloads（可包含多个）</span>
        <span class="hljs-keyword">for</span> (Object payload : payloads) {
            <span class="hljs-keyword">if</span> (payload <span class="hljs-keyword">instanceof</span> String) {
                <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> (String) payload;
                <span class="hljs-keyword">if</span> (<span class="hljs-string">"like"</span>.equals(key)) {
                    <span class="hljs-comment">// 只更新 like 字段</span>
                    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> data.get(position);
                    holder.tvLike.setText(String.valueOf(user.likeCount));
                    <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 局部刷新后直接返回，避免完整绑定</span>
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (payload <span class="hljs-keyword">instanceof</span> Bundle) {
                <span class="hljs-comment">// 如果你用 Bundle 传多个字段变化，可以解析 Bundle</span>
            }
            <span class="hljs-comment">// 其它 payload 处理...</span>
        }
    }

    <span class="hljs-comment">// payloads 为空时回退到完整绑定（或直接调用 super）</span>
    <span class="hljs-built_in">super</span>.onBindViewHolder(holder, position, payloads);
}
</code></pre>
<p>使用也很简单：</p>
<pre><code class="hljs language-java" lang="java">data.get(pos).likeCount += <span class="hljs-number">1</span>;
<span class="hljs-comment">// 传递简单标识（也可以传 Bundle/自定义对象）</span>
adapter.notifyItemChanged(pos, <span class="hljs-string">"like"</span>);
</code></pre>
<h4 data-id="heading-5">2.3 notifyItemInserted(int position) —— 插入单个Item</h4>
<pre><code class="hljs language-java" lang="java">data.add(position, item);
adapter.notifyItemInserted(position);
</code></pre>
<h4 data-id="heading-6">2.4 notifyItemRemoved(int position) —— 删除单个Item</h4>
<pre><code class="hljs language-java" lang="java">data.remove(position);
adapter.notifyItemRemoved(position);
</code></pre>
<h4 data-id="heading-7">2.5 notifyItemMoved(int fromPosition, int toPosition) —— 移动Item位置（拖拽排序）</h4>
<pre><code class="hljs language-java" lang="java">Collections.swap(data, from, to);
adapter.notifyItemMoved(from, to);
</code></pre>
<h4 data-id="heading-8">2.6 notifyItemRangeChanged(int positionStart, int itemCount) —— 批量更新Item</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; newItems.size(); i++) {
    data.set(startPos + i, newItems.get(i));
}
adapter.notifyItemRangeChanged(startPos, newItems.size());
</code></pre>
<h4 data-id="heading-9">2.7 notifyItemRangeInserted(int positionStart, int itemCount) —— 批量插入Item</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">startPos</span> <span class="hljs-operator">=</span> data.size();
data.addAll(moreItems);
adapter.notifyItemRangeInserted(startPos, moreItems.size());
</code></pre>
<h4 data-id="heading-10">2.8 notifyItemRangeRemoved(int positionStart, int itemCount) —— 批量删除Item</h4>
<pre><code class="hljs language-java" lang="java">data.subList(startPos, endPos).clear();
adapter.notifyItemRangeRemoved(startPos, endPos - startPos);
</code></pre>
<h3 data-id="heading-11">3. DiffUtil —— 自动计算差异，刷新最小项</h3>
<p>DiffUtil 是一个用于计算两个列表之间差异的实用工具类。它可以优化 RecyclerView 的刷新操作，仅刷新需要更新的部分，从而提高性能并减少不必要的操作。</p>
<h4 data-id="heading-12">3.1 基本使用方式</h4>
<h5 data-id="heading-13">3.1.1 实现DiffUtil.Callback</h5>
<p>首先需要创建一个类实现<code>DiffUtil.Callback</code>，用于告诉 DiffUtil 两个列表如何比较。其中有以下五个方法：</p>
<ol>
<li>
<p><code>int getOldListSize()</code></p>
<p><strong>作用</strong>：返回旧列表长度。</p>
</li>
<li>
<p><code>int getNewListSize()</code></p>
<p><strong>作用</strong>：返回新列表长度。</p>
</li>
<li>
<p><code>boolean areItemsTheSame(int oldItemPosition, int newItemPosition)</code></p>
<p><strong>作用</strong>：判断旧列表中位置 <code>oldItemPosition</code> 的项和新列表中位置 <code>newItemPosition</code> 的项 <strong>是否代表同一个实体</strong>。</p>
<p><strong>常用做法</strong>：比较唯一标识符，如ID。</p>
<p><strong>返回</strong>：如果返回 <code>true</code>，说明是“同一个 item”，接下来会调用 <code>areContentsTheSame()</code> 检查内容是否变化；如果返回 <code>false</code>，会被认为是不同的 item（insert/remove）。</p>
</li>
<li>
<p><code>boolean areContentsTheSame(int oldItemPosition, int newItemPosition)</code></p>
<p><strong>作用</strong>：在 <code>areItemsTheSame()</code> 返回 <code>true</code> 的前提下，判断<strong>内容是否相等</strong>（是否需要刷新 UI）。</p>
<p><strong>常用做法</strong>：比较字段或调用 <code>equals()</code>（但要确保 equals 的语义是“内容相等”）。</p>
<p><strong>返回</strong>：<code>true</code> 表示内容相同（不需要刷新），<code>false</code> 表示内容不同（会触发 <code>notifyItemChanged</code>）。</p>
</li>
<li>
<p><code>@Nullable Object getChangePayload(int oldItemPosition, int newItemPosition)</code><strong>（可选）</strong></p>
<p><strong>作用</strong>：当 <code>areItemsTheSame()</code> 返回 <code>true</code> 且 <code>areContentsTheSame()</code> 返回 <code>false</code> 时，返回“变化的<strong>差量信息</strong>”。该对象会作为 <code>payload</code> 传入 Adapter 的 <code>onBindViewHolder(holder, position, List&lt;Object&gt; payloads)</code>，以实现局部绑定（避免整条 item 重绑定）。</p>
<p><strong>返回</strong>：返回<code>null</code>等同于“没有 payload”，RecyclerView 会做完整绑定。</p>
<p><strong>注意</strong>：如果要使用该方法，需要在 Adapter 重写<code>onBindViewHolder(..., payloads)</code>。</p>
</li>
</ol>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDiffCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DiffUtil</span>.Callback {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;User&gt; oldList;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;User&gt; newList;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserDiffCallback</span><span class="hljs-params">(List&lt;User&gt; oldList, List&lt;User&gt; newList)</span> {
        <span class="hljs-built_in">this</span>.oldList = oldList;
        <span class="hljs-built_in">this</span>.newList = newList;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOldListSize</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> oldList.size();
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getNewListSize</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> newList.size();
    }
    
    <span class="hljs-comment">// 判断两个Item是否代表同一个对象</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">areItemsTheSame</span><span class="hljs-params">(<span class="hljs-type">int</span> oldItemPosition, <span class="hljs-type">int</span> newItemPosition)</span> {
        <span class="hljs-comment">// 通常比较唯一标识符，如 ID</span>
        <span class="hljs-keyword">return</span> oldList.get(oldItemPosition).getId() == newList.get(newItemPosition).getId();
    }
    
    <span class="hljs-comment">// 判断两个Item的内容是否相同</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">areContentsTheSame</span><span class="hljs-params">(<span class="hljs-type">int</span> oldItemPosition, <span class="hljs-type">int</span> newItemPosition)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">oldUser</span> <span class="hljs-operator">=</span> oldList.get(oldItemPosition);
        <span class="hljs-type">User</span> <span class="hljs-variable">newUser</span> <span class="hljs-operator">=</span> newList.get(newItemPosition);
        
        <span class="hljs-keyword">return</span> oldUser.equals(newItem);<span class="hljs-comment">//需重写User的equals()和hashCode()方法</span>
        
        <span class="hljs-comment">// 也可以直接比较所有字段</span>
        <span class="hljs-comment">/* return oldUser.getName().equals(newUser.getName()) &amp;&amp;
               oldUser.getAge() == newUser.getAge() &amp;&amp;
               oldUser.getAvatarUrl().equals(newUser.getAvatarUrl());*/</span>
    }
    
    <span class="hljs-comment">// 可选：当 areItemsTheSame 返回 true 但 areContentsTheSame 返回 false 时调用</span>
    <span class="hljs-comment">// 用于局部更新，避免重新绑定整个 item</span>
    <span class="hljs-meta">@Nullable</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getChangePayload</span><span class="hljs-params">(<span class="hljs-type">int</span> oldItemPosition, <span class="hljs-type">int</span> newItemPosition)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">oldUser</span> <span class="hljs-operator">=</span> oldList.get(oldItemPosition);
        <span class="hljs-type">User</span> <span class="hljs-variable">newUser</span> <span class="hljs-operator">=</span> newList.get(newItemPosition);
        
        <span class="hljs-type">Bundle</span> <span class="hljs-variable">diffBundle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bundle</span>();
        
        <span class="hljs-keyword">if</span> (!oldUser.getName().equals(newUser.getName())) {
            diffBundle.putString(<span class="hljs-string">"name"</span>, newUser.getName());
        }
        
        <span class="hljs-keyword">if</span> (oldUser.getAge() != newUser.getAge()) {
            diffBundle.putInt(<span class="hljs-string">"age"</span>, newUser.getAge());
        }
        
        <span class="hljs-keyword">if</span> (!oldUser.getAvatarUrl().equals(newUser.getAvatarUrl())) {
            diffBundle.putString(<span class="hljs-string">"avatar"</span>, newUser.getAvatarUrl());
        }
       
        <span class="hljs-keyword">return</span> diffBundle.size() == <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> :diffBundle;
    }
}
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li>
<p><strong>输入列表必须是快照</strong>：在计算 diff 时不要修改 old/new 列表。最保险的做法是先 <code>new ArrayList&lt;&gt;(old)</code> 和 <code>new ArrayList&lt;&gt;(newData)</code>。</p>
</li>
<li>
<p><strong>areItemsTheSame 一定要稳定且唯一</strong>：不稳定的 id 会导致错误的插入/删除/移动。</p>
</li>
<li>
<p><strong>areContentsTheSame 要尽量高效</strong>：避免复杂计算，或提前计算 hash/code。（但要注意 equals 语义）</p>
</li>
<li>
<p><strong>getChangePayload 返回轻量对象</strong>：不要返回大的集合或含 Context 的对象，推荐返回 Bundle 或简单 POJO。</p>
</li>
</ul>
<h5 data-id="heading-14">3.1.2 调用 DiffUtil.calculateDiff 计算差异结果</h5>
<p>使用你的 <code>Callback</code> 实例调用 <code>DiffUtil.calculateDiff</code>，它将计算旧列表和新列表之间的差异（通过你在 <code>Callback</code> 中的规则），返回一个 <code>DiffResult</code>（最小变更集）。</p>
<p>该方法有两个参数：</p>
<ul>
<li>
<p><code>Callback</code></p>
<p>基于你实现的 <code>DiffUtil.Callback</code>（<code>areItemsTheSame</code> / <code>areContentsTheSame</code> / 可选 <code>getChangePayload</code>）计算出把旧列表变成新列表所需的最小操作序列（增、删、改、移）。</p>
</li>
<li>
<p><code>detectMoves</code>（<strong>可选</strong>）</p>
<p>默认为<code>true</code>，会尝试检测**元素的移动（move）**并把它作为 <code>move</code> 操作；检测 move 会额外消耗时间。</p>
<p>设置为<code>false</code>，则不检测 move，只用 insert/remove/changed，性能更好但没有移动动画。</p>
<p>检测移动会消耗更多时间，如果你不关心 item 的移动动画，可设为 <code>false</code> 以提升性能。</p>
</li>
</ul>
<p><strong>常用签名</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DiffUtil.DiffResult <span class="hljs-title function_">calculateDiff</span><span class="hljs-params">(DiffUtil.Callback cb)</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DiffUtil.DiffResult <span class="hljs-title function_">calculateDiff</span><span class="hljs-params">(DiffUtil.Callback cb, <span class="hljs-type">boolean</span> detectMoves)</span>;
</code></pre>
<p><strong>注意事项</strong>：<strong>尽量避免在主线程大规模计算</strong>。大数据量时把 <code>calculateDiff</code> 放到后台线程或使用 <code>AsyncListDiffer</code> / <code>ListAdapter</code>（它们内部异步计算）。</p>
<h5 data-id="heading-15">3.1.3 DiffResult.dispatchUpdatesTo 刷新</h5>
<p>使用<code>diffResult.dispatchUpdatesTo(target)</code><strong>把变更集“应用”到目标</strong>（通常是 <code>RecyclerView.Adapter</code> 或 <code>ListUpdateCallback</code>），最终触发 <code>notifyXXX</code> 调用与 RecyclerView 的动画/刷新。</p>
<p>该方法的作用是把 <code>DiffResult</code> 中的变更<strong>以正确顺序</strong>分发给目标 <code>ListUpdateCallback</code>（或直接传 <code>RecyclerView.Adapter</code>），目标收到回调后通常会调用 <code>notifyItemInserted/Removed/Changed/Moved</code>，从而驱动 RecyclerView 做动画和局部更新。</p>
<p><strong>常用签名</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispatchUpdatesTo</span><span class="hljs-params">(RecyclerView.Adapter adapter)</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispatchUpdatesTo</span><span class="hljs-params">(ListUpdateCallback updateCallback)</span>;
</code></pre>
<ul>
<li>如果传 <code>RecyclerView.Adapter</code>，内部会封装成 <code>AdapterListUpdateCallback(adapter)</code>（它会把回调转换为 <code>adapter.notifyItemInserted(...)</code> 等）。</li>
<li>也可以传自定义的 <code>ListUpdateCallback</code>，用于手工控制如何应用变更（例如先更新 UI 数据结构，再调用 notify）。</li>
</ul>
<p><strong>推荐做法</strong>：</p>
<ol>
<li>在后台或同步地调用 <code>calculateDiff</code> 得到 <code>diffResult</code>。</li>
<li>在 <strong>主线程</strong>（UI 线程）先<strong>替换 Adapter 的 backing data</strong>（<code>adapter.data = newList</code> 或 <code>adapter.setData(newList)</code>）。</li>
<li>立即调用 <code>diffResult.dispatchUpdatesTo(adapter)</code>。</li>
</ol>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateList</span><span class="hljs-params">(List&lt;User&gt; newList)</span> {
    <span class="hljs-comment">// 计算差异</span>
    DiffUtil.<span class="hljs-type">DiffResult</span> <span class="hljs-variable">diffResult</span> <span class="hljs-operator">=</span> DiffUtil.calculateDiff(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDiffCallback</span>(<span class="hljs-built_in">this</span>.userList, newList)
    );

    <span class="hljs-comment">// 更新数据源</span>
    <span class="hljs-built_in">this</span>.userList.clear();
    <span class="hljs-built_in">this</span>.userList.addAll(newList);

    <span class="hljs-comment">// 分发更新</span>
    diffResult.dispatchUpdatesTo(<span class="hljs-built_in">this</span>);
}
</code></pre>
<blockquote>
<p><strong>为什么先替换数据？</strong></p>
<p>因为 <code>dispatchUpdatesTo</code> 在回调（例如 <code>notifyItemChanged</code>）时，RecyclerView 会调用 Adapter 的 <code>getItemCount()</code> / <code>getItem(position)</code> 等方法；若数据还没更新，会导致 <code>IndexOutOfBoundsException</code> 或显示旧数据。
如果你不想先替换数据，可以 dispatch 到自定义 <code>ListUpdateCallback</code>，在回调里按你需要的顺序先更新数据结构再调用 <code>adapter.notifyXXX</code>（但这样更易出错，普通场景不建议）。</p>
</blockquote>
<p><strong>注意</strong>：<code>dispatchUpdatesTo(...)</code> <strong>在调用线程上同步执行</strong>（会立即触发对应的 <code>notify...</code> 调用）。因此，<strong>必须在主线程</strong>对 RecyclerView/Adapter 进行 dispatch（否则会抛异常或 UI 不安全）。</p>
<p>如果你想在每个回调前后做额外工作（例如更新其他数据结构、统计日志、或在 dispatch 前后禁用动画），可以自定义 <code>ListUpdateCallback</code>：</p>
<pre><code class="hljs language-java" lang="java">DiffUtil.<span class="hljs-type">DiffResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> DiffUtil.calculateDiff(cb, <span class="hljs-literal">true</span>);
result.dispatchUpdatesTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ListUpdateCallback</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onInserted</span><span class="hljs-params">(<span class="hljs-type">int</span> position, <span class="hljs-type">int</span> count)</span> {
        <span class="hljs-comment">// 先更新 backing list 或做统计</span>
        adapter.notifyItemRangeInserted(position, count);
    }
    <span class="hljs-meta">@Override</span> 
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onRemoved</span><span class="hljs-params">(<span class="hljs-type">int</span> position, <span class="hljs-type">int</span> count)</span> {
        adapter.notifyItemRangeRemoved(position, count);
    }
    <span class="hljs-meta">@Override</span> 
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMoved</span><span class="hljs-params">(<span class="hljs-type">int</span> fromPosition, <span class="hljs-type">int</span> toPosition)</span> {
        adapter.notifyItemMoved(fromPosition, toPosition);
    }
    <span class="hljs-meta">@Override</span> 
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChanged</span><span class="hljs-params">(<span class="hljs-type">int</span> position, <span class="hljs-type">int</span> count, Object payload)</span> {
        adapter.notifyItemRangeChanged(position, count, payload);
    }
});
</code></pre>
<p>但负责手动同步数据和 dispatch 的复杂性较高，不建议滥用。</p>
<h4 data-id="heading-16">3.2 在后台线程执行计算</h4>
<p>当数据量不大时，我们可以在UI线程中直接更新数据，数据量大时建议在后台线程执行计算，避免阻塞主线程。</p>
<p>代码示例：</p>
<pre><code class="hljs language-java" lang="java">Executors.newSingleThreadExecutor().execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        DiffUtil.<span class="hljs-type">DiffResult</span> <span class="hljs-variable">diffResult</span> <span class="hljs-operator">=</span>
            DiffUtil.calculateDiff(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ItemDiffCallback</span>(oldList, newList));

        <span class="hljs-comment">// 切回主线程</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(Looper.getMainLooper()).post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                mData.clear();
                mData.addAll(newList);

                <span class="hljs-comment">// 更新 RecyclerView</span>
                diffResult.dispatchUpdatesTo(adapter);
            }
        });
    }
});
</code></pre>
<h4 data-id="heading-17">3.3 AsyncListDiffer 和 ListAdapter</h4>
<p>ListAdapter 和 AsyncListDiffer 都是 Android 官方架构组件中为了简化 RecyclerView.Adapter 的数据更新和 DiffUtil 的使用而提供的工具。
它们都是基于 DiffUtil 的，但封装了后台计算差异和主线程更新的细节，让我们更容易使用。</p>
<h5 data-id="heading-18">3.3.1 AsyncListDiffer</h5>
<p>AsyncListDiffer 是一个可以在 RecyclerView 适配器中使用的工具类，它负责持有当前列表的数据，并且当提交新列表时，会自动计算新旧列表的差异，然后通过 RecyclerView.Adapter 的更新方法（如 notifyItemInserted 等）来更新列表。</p>
<p><strong>使用步骤</strong>：</p>
<ol>
<li>创建一个 DiffUtil.ItemCallback 的实现，用于定义如何比较列表中的项目。</li>
<li>在适配器中创建一个 AsyncListDiffer 实例。</li>
<li>使用 AsyncListDiffer 的 submitList 方法来更新数据。</li>
<li>在适配器的方法中，通过 AsyncListDiffer 获取数据。</li>
</ol>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 数据模型</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">private</span> String id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;
    
    <span class="hljs-comment">// 构造函数、getter、setter...</span>
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object o)</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span> == o) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (o == <span class="hljs-literal">null</span> || getClass() != o.getClass()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User) o;
        <span class="hljs-keyword">return</span> age == user.age &amp;&amp;
               Objects.equals(id, user.id) &amp;&amp;
               Objects.equals(name, user.name);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Objects.hash(id, name, age);
    }
}

<span class="hljs-comment">// 2. 创建 DiffUtil.ItemCallback</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDiffCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DiffUtil</span>.ItemCallback&lt;User&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">areItemsTheSame</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> User oldItem, <span class="hljs-meta">@NonNull</span> User newItem)</span> {
        <span class="hljs-keyword">return</span> oldItem.getId().equals(newItem.getId());
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">areContentsTheSame</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> User oldItem, <span class="hljs-meta">@NonNull</span> User newItem)</span> {
        <span class="hljs-keyword">return</span> oldItem.equals(newItem);
    }
    
    <span class="hljs-comment">// 可选：获取变更内容（用于局部更新）</span>
    <span class="hljs-comment">// 需要在Adapter中处理payload</span>
    <span class="hljs-meta">@Nullable</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getChangePayload</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> User oldItem, 
                                   <span class="hljs-meta">@NonNull</span> User newItem)</span> {
        <span class="hljs-comment">// ...</span>
    }
}

<span class="hljs-comment">// 3. 在 Adapter 中使用 AsyncListDiffer</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecyclerView</span>.Adapter&lt;UserViewHolder&gt; {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AsyncListDiffer&lt;User&gt; differ = 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncListDiffer</span>&lt;&gt;(<span class="hljs-built_in">this</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDiffCallback</span>());
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">submitList</span><span class="hljs-params">(List&lt;User&gt; users)</span> {
        differ.submitList(users);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getItemCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> differ.getCurrentList().size();
    }
    
    <span class="hljs-meta">@NonNull</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> UserViewHolder <span class="hljs-title function_">onCreateViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> ViewGroup parent, <span class="hljs-type">int</span> viewType)</span> {
        <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> LayoutInflater.from(parent.getContext()).inflate(R.layout.item_user, parent, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserViewHolder</span>(view);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> UserViewHolder holder, <span class="hljs-type">int</span> position)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> differ.getCurrentList().get(position);
        holder.bind(user);
    }
}

<span class="hljs-comment">// 4. 使用示例</span>
<span class="hljs-type">UserAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserAdapter</span>();
recyclerView.setAdapter(adapter);

<span class="hljs-comment">// 更新数据（自动计算差异）</span>
List&lt;User&gt; newUsers = fetchUsersFromNetwork();
adapter.submitList(newUsers);
</code></pre>
<p>这里面有几个方法需要介绍一下：</p>
<ol>
<li><code>differ.getCurrentList()</code>（返回 List）
<ul>
<li><strong>作用</strong>：返回当前已“提交并应用”的不可变快照（<code>List&lt;T&gt;</code>）。</li>
<li><strong>特点</strong>：安全在主线程读取，返回的是内部快照引用，不应修改；<code>getCurrentList().size()</code> 可用于 <code>getItemCount()</code>。</li>
</ul>
</li>
<li><code>differ.getItem(int position)</code>
<ul>
<li><strong>作用</strong>：返回 <code>getCurrentList().get(position)</code> 的元素，便于在 <code>onBindViewHolder</code> 中取数据。</li>
<li><strong>注意</strong>：<code>getItem</code> 是只读视图。</li>
</ul>
</li>
<li><code>differ.submitList(List&lt;T&gt; newList)</code>
<ul>
<li><strong>作用</strong>：提交新列表（可以为 <code>null</code>，表示清空列表）让 <code>AsyncListDiffer</code> 异步计算差异并把结果 dispatch 给 <code>ListUpdateCallback</code>。</li>
<li><strong>注意</strong>：每次都应该提交一个新的 List 实例（副本），不要传递同一个对象。<code>submitList</code> 是线程安全的，内部会安排后台计算，但<strong>最好在主线程调用</strong>以避免边界情况（尽管 AsyncListDiffer 允许从任意线程提交）。</li>
<li><strong>可选回调</strong>：<code>void submitList(List&lt;T&gt; list, @Nullable Runnable commitCallback)</code>，<code>commitCallback</code>会在差异计算完成并且更新已分发到 Adapter/RecyclerView 后被调用（在主线程）。</li>
</ul>
</li>
</ol>
<p><strong>工作原理</strong>：</p>
<p>AsyncListDiffer内部维护了一个当前列表（在后台线程中计算差异时，会拷贝当前列表作为旧列表）。当你调用 submitList 提交新列表时，它会启动一个后台任务（通过一个后台Executor）来执行DiffUtil.calculateDiff，然后根据计算结果，在主线程中通过RecyclerView.Adapter的更新方法来更新列表。</p>
<p><strong>注意</strong>：AsyncListDiffer 要求 RecyclerView.Adapter 实现 ListUpdateCallback 接口（实际上 RecyclerView.Adapter 已经实现了这个接口），以便在计算得到差异后，调用相应的更新方法。</p>
<h5 data-id="heading-19">3.3.2 ListAdapter</h5>
<p>ListAdapter 是 Google 官方提供的一个 RecyclerView.Adapter 的子类，它内部已经封装了 AsyncListDiffer，使得我们使用起来更加方便。我们只需要指定一个 DiffUtil.ItemCallback，然后通过 submitList 方法来更新数据即可。</p>
<p><strong>使用步骤</strong>：</p>
<ol>
<li>创建一个 DiffUtil.ItemCallback 的实现（同上）。</li>
<li>继承 ListAdapter，并传入 ItemCallback。</li>
<li>实现 onCreateViewHolder 和 onBindViewHolder。</li>
<li>使用submitList更新数据。</li>
</ol>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 直接继承 ListAdapter（无需手动创建 AsyncListDiffer）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserListAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ListAdapter</span>&lt;User, UserViewHolder&gt; {
    
    <span class="hljs-comment">// 2. 在构造函数中传入 DiffCallback</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserListAdapter</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDiffCallback</span>);
    }
    
    <span class="hljs-meta">@NonNull</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> UserViewHolder <span class="hljs-title function_">onCreateViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> ViewGroup parent, <span class="hljs-type">int</span> viewType)</span> {
        <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> LayoutInflater.from(parent.getContext())
            .inflate(R.layout.item_user, parent, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserViewHolder</span>(view);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> UserViewHolder holder, <span class="hljs-type">int</span> position)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> getItem(position); <span class="hljs-comment">// ListAdapter 提供，内部调用differ</span>
        holder.bind(user);
    }
}

<span class="hljs-comment">// 3. 使用示例</span>
<span class="hljs-type">UserListAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserListAdapter</span>();
recyclerView.setAdapter(adapter);

<span class="hljs-comment">// 提交新数据（自动后台计算差异）</span>
List&lt;User&gt; users = fetchUsersFromNetwork();
adapter.submitList(users);
</code></pre>
<p>需要注意的是，ListAdapter 已经覆写并实现了 getItemCount()（它返回 getCurrentList().size()）。<strong>不用重写 getItemCount()</strong>，也不要去维护自己的 data list。</p>
<p><strong>工作原理</strong>：</p>
<p>ListAdapter 内部已经持有一个 AsyncListDiffer，并在构造时传入一个 DiffUtil.ItemCallback。ListAdapter 已经实现了 getItemCount() 和 getItem() 等方法，这些方法都是通过内部的 AsyncListDiffer 来获取数据。</p>
<p>当我们调用 submitList 方法时，实际上就是调用了内部 AsyncListDiffer 的 submitList 方法。</p>
<h5 data-id="heading-20">注意事项</h5>
<ul>
<li>为了确保 DiffUtil 能够正确工作，数据模型类应该正确实现 equals 和 hashCode 方法，或者在 ItemCallback 中正确实现 areContentsTheSame。</li>
<li>AsyncListDiffer 和 ListAdapter 在比较列表时，会比较列表的引用。如果你提交了一个和当前列表相同（引用相同）的列表，那么不会触发计算。因此，<strong>每次更新数据时，应该创建一个新的列表对象</strong>，或者确保在修改列表后提交一个新列表。</li>
<li>AsyncListDiffer 和 ListAdapter的submitList 方法可以连续调用，但只有最后一次提交的列表会被计算和更新。也就是说，如果连续提交多次，可能会跳过中间状态。</li>
<li>由于 DiffUtil 计算是在后台线程进行的，所以确保在计算期间，旧列表和新列表不会被修改。因此，在 ItemCallback 中，应该只读取列表中的数据，而不应该修改它们。</li>
</ul>
<h3 data-id="heading-21">总结</h3>
<p><strong>刷新方式回顾</strong></p>
<ul>
<li><strong>notifyDataSetChanged()</strong>：最基础的刷新方式，但效率最低，会重新绑定所有可见项，没有动画效果。适用于数据完全改变或列表很小的情况。</li>
<li><strong>局部刷新方法（notifyItemXxx）</strong>：包括<code>notifyItemChanged</code>、<code>notifyItemInserted</code>、<code>notifyItemRemoved</code>、<code>notifyItemMoved</code>以及对应的范围方法。这些方法针对特定位置或范围进行更新，有动画效果，效率较高。适用于明确知道变化位置的情况。</li>
<li><strong>DiffUtil</strong>：智能计算新旧列表差异，并自动调用合适的局部刷新方法。效率高，有动画效果，但需要实现 DiffUtil.Callback。适用于复杂的数据变化，特别是从后台获取新数据并更新列表时。</li>
<li><strong>AsyncListDiffer</strong>：封装了DiffUtil和后台线程计算，简化了使用方式。需要在 Adapter 中创建 AsyncListDiffer 实例，并实现 ItemCallback。</li>
<li><strong>ListAdapter</strong>：Google 官方推荐的 Adapter 基类，内部使用 AsyncListDiffer，让开发者更专注于 ViewHolder 和绑定逻辑。适用于大多数场景，特别是新项目。</li>
<li><strong>Payload</strong>：配合使用，允许局部更新ItemView中的特定部分，避免重新绑定整个ItemView，进一步提升性能。</li>
</ul>
<p><strong>如何选择？</strong></p>
<ul>
<li>对于简单的列表，数据量小，变化不频繁，可以使用<code>notifyDataSetChanged()</code>或局部刷新方法。</li>
<li>对于数据源复杂，频繁更新，且追求高性能和动画效果，推荐使用<code>DiffUtil</code>或其封装类（<code>AsyncListDiffer</code>、<code>ListAdapter</code>）。</li>
<li>在新项目中，建议直接使用<code>ListAdapter</code>，它已经封装了最佳实践。</li>
<li>当列表项视图复杂，且只有部分内容需要更新时，使用<code>Payload</code>进行局部更新。</li>
</ul>
<hr/>
<p><strong>最后，感谢阅读！如果你有任何问题或建议，欢迎在评论区留言讨论。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-app D8 实战（小兔鲜）]]></title>    <link>https://juejin.cn/post/7579641251910221834</link>    <guid>https://juejin.cn/post/7579641251910221834</guid>    <pubDate>2025-12-03T15:53:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579641251910221834" data-draft-id="7579473409748746291" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-app D8 实战（小兔鲜） "/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-12-03T15:53:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱泡脚的鸡腿"/> <meta itemprop="url" content="https://juejin.cn/user/4466663535419179"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-app D8 实战（小兔鲜） 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4466663535419179/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱泡脚的鸡腿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T15:53:28.000Z" title="Wed Dec 03 2025 15:53:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.填写订单</h2>
<h3 data-id="heading-1">1.1 渲染基本信息</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2e1cdc571bd44fe94be0dbd25bd2b2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=oXVQxZVOmDMprP7qxmoLFh74RlY%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-2">1.1.1 设置独立的分包(静态结构)</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { computed, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// 获取屏幕边界到安全区域距离</span>
<span class="hljs-keyword">const</span> { safeAreaInsets } = uni.<span class="hljs-title function_">getSystemInfoSync</span>();
<span class="hljs-comment">// 订单备注</span>
<span class="hljs-keyword">const</span> buyerMessage = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);
<span class="hljs-comment">// 配送时间</span>
<span class="hljs-keyword">const</span> deliveryList = <span class="hljs-title function_">ref</span>([
    { <span class="hljs-attr">type</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'时间不限 (周一至周日)'</span> },
    { <span class="hljs-attr">type</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'工作日送 (周一至周五)'</span> },
    { <span class="hljs-attr">type</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'周末配送 (周六至周日)'</span> }
]);
<span class="hljs-comment">// 当前配送时间下标</span>
<span class="hljs-keyword">const</span> activeIndex = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// 当前配送时间</span>
<span class="hljs-keyword">const</span> activeDelivery = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> deliveryList.<span class="hljs-property">value</span>[activeIndex.<span class="hljs-property">value</span>]);
<span class="hljs-comment">// 修改配送时间</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">onChangeDelivery</span>: <span class="hljs-title class_">UniHelper</span>.<span class="hljs-property">SelectorPickerOnChange</span> = <span class="hljs-function">(<span class="hljs-params">ev</span>) =&gt;</span> {
    activeIndex.<span class="hljs-property">value</span> = ev.<span class="hljs-property">detail</span>.<span class="hljs-property">value</span>;
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scroll-view</span> <span class="hljs-attr">scroll-y</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"viewport"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 收货地址 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">navigator</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"shipment"</span> <span class="hljs-attr">hover-class</span>=<span class="hljs-string">"none"</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/pagesMember/address/address?from=order"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user"</span>&gt;</span>张三 13333333333<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"address"</span>&gt;</span>广东省 广州市 天河区 黑马程序员3<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon icon-right"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">navigator</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">navigator</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"shipment"</span> <span class="hljs-attr">hover-class</span>=<span class="hljs-string">"none"</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/pagesMember/address/address?from=order"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"address"</span>&gt;</span>请选择收货地址<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon icon-right"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">navigator</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 商品信息 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"goods"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">navigator</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in 2"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">:url</span>=<span class="hljs-string">"`/pages/goods/goods?id=1`"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">hover-class</span>=<span class="hljs-string">"none"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"picture"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://yanxuan-item.nosdn.127.net/c07edde1047fa1bd0b795bed136c2bb2.jpg"</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"meta"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"name ellipsis"</span>&gt;</span>ins风小碎花泡泡袖衬110-160cm<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"attrs"</span>&gt;</span>藏青小花 130<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"prices"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pay-price symbol"</span>&gt;</span>99.00<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"price symbol"</span>&gt;</span>99.00<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"count"</span>&gt;</span>x5<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">navigator</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 配送及支付方式 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"related"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>配送时间<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">picker</span> <span class="hljs-attr">:range</span>=<span class="hljs-string">"deliveryList"</span> <span class="hljs-attr">range-key</span>=<span class="hljs-string">"text"</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"onChangeDelivery"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon-fonts picker"</span>&gt;</span>{{ activeDelivery.text }}<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">picker</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>订单备注<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input"</span> <span class="hljs-attr">:cursor-spacing</span>=<span class="hljs-string">"30"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"选题，建议留言前先与商家沟通确认"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"buyerMessage"</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 支付金额 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"settlement"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>商品总价:<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"number symbol"</span>&gt;</span>495.00<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>运费:<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"number symbol"</span>&gt;</span>5.00<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">scroll-view</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 吸底工具栏 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"toolbar"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ paddingBottom: safeAreaInsets?.bottom + 'px' }"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"total-pay symbol"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"number"</span>&gt;</span>99.00<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ disabled: true }"</span>&gt;</span>提交订单<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span>&gt;</span><span class="css">
page {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">flex-direction</span>: column;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">overflow</span>: hidden;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f4f4f4</span>;
}

<span class="hljs-selector-class">.symbol</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">'¥'</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">80%</span>;
    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">5</span>rpx;
}

<span class="hljs-selector-class">.shipment</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">30</span>rpx <span class="hljs-number">30</span>rpx <span class="hljs-number">30</span>rpx <span class="hljs-number">84</span>rpx;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10</span>rpx;
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/locate.png</span>) <span class="hljs-number">20</span>rpx center / <span class="hljs-number">50</span>rpx no-repeat <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">position</span>: relative;

    <span class="hljs-selector-class">.icon</span> {
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">36</span>rpx;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">50%</span>);
        <span class="hljs-attribute">position</span>: absolute;
        <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
        <span class="hljs-attribute">right</span>: <span class="hljs-number">20</span>rpx;
    }

    <span class="hljs-selector-class">.user</span> {
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
        <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">5</span>rpx;
    }

    <span class="hljs-selector-class">.address</span> {
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
    }
}

<span class="hljs-selector-class">.goods</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10</span>rpx;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;

    <span class="hljs-selector-class">.item</span> {
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">30</span>rpx <span class="hljs-number">0</span>;
        <span class="hljs-attribute">border-top</span>: <span class="hljs-number">1</span>rpx solid <span class="hljs-number">#eee</span>;

        &amp;<span class="hljs-selector-pseudo">:first</span>-child {
            <span class="hljs-attribute">border-top</span>: none;
        }

        <span class="hljs-selector-class">.picture</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">170</span>rpx;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">170</span>rpx;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10</span>rpx;
            <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">20</span>rpx;
        }

        <span class="hljs-selector-class">.meta</span> {
            <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">flex-direction</span>: column;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">position</span>: relative;
        }

        <span class="hljs-selector-class">.name</span> {
            <span class="hljs-attribute">height</span>: <span class="hljs-number">80</span>rpx;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#444</span>;
        }

        <span class="hljs-selector-class">.attrs</span> {
            <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.8</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">15</span>rpx;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">6</span>rpx;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24</span>rpx;
            <span class="hljs-attribute">align-self</span>: flex-start;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4</span>rpx;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#888</span>;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f7f7f8</span>;
        }

        <span class="hljs-selector-class">.prices</span> {
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">align-items</span>: baseline;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">6</span>rpx;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28</span>rpx;

            <span class="hljs-selector-class">.pay-price</span> {
                <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">10</span>rpx;
                <span class="hljs-attribute">color</span>: <span class="hljs-number">#cf4444</span>;
            }

            <span class="hljs-selector-class">.price</span> {
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24</span>rpx;
                <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
                <span class="hljs-attribute">text-decoration</span>: line-through;
            }
        }

        <span class="hljs-selector-class">.count</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#444</span>;
        }
    }
}

<span class="hljs-selector-class">.related</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10</span>rpx;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;

    <span class="hljs-selector-class">.item</span> {
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">justify-content</span>: space-between;
        <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">min-height</span>: <span class="hljs-number">80</span>rpx;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
    }

    <span class="hljs-selector-class">.input</span> {
        <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
        <span class="hljs-attribute">text-align</span>: right;
        <span class="hljs-attribute">margin</span>: <span class="hljs-number">20</span>rpx <span class="hljs-number">0</span>;
        <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">20</span>rpx;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
    }

    <span class="hljs-selector-class">.item</span> <span class="hljs-selector-class">.text</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">125</span>rpx;
    }

    <span class="hljs-selector-class">.picker</span> {
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
    }

    <span class="hljs-selector-class">.picker</span><span class="hljs-selector-pseudo">::after</span> {
        <span class="hljs-attribute">content</span>: <span class="hljs-string">'\e6c2'</span>;
    }
}

<span class="hljs-comment">/* 结算清单 */</span>
<span class="hljs-selector-class">.settlement</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10</span>rpx;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;

    <span class="hljs-selector-class">.item</span> {
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">justify-content</span>: space-between;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">80</span>rpx;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
    }

    <span class="hljs-selector-class">.danger</span> {
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#cf4444</span>;
    }
}

<span class="hljs-comment">/* 吸底工具栏 */</span>
<span class="hljs-selector-class">.toolbar</span> {
    <span class="hljs-attribute">position</span>: fixed;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">var</span>(--window-bottom));
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;

    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100</span>rpx;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20</span>rpx;
    <span class="hljs-attribute">border-top</span>: <span class="hljs-number">1</span>rpx solid <span class="hljs-number">#eaeaea</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: space-between;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">box-sizing</span>: content-box;

    <span class="hljs-selector-class">.total-pay</span> {
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">40</span>rpx;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#cf4444</span>;

        <span class="hljs-selector-class">.decimal</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">75%</span>;
        }
    }

    <span class="hljs-selector-class">.button</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">220</span>rpx;
        <span class="hljs-attribute">text-align</span>: center;
        <span class="hljs-attribute">line-height</span>: <span class="hljs-number">72</span>rpx;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">26</span>rpx;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">72</span>rpx;
        <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#27ba9b</span>;
    }

    <span class="hljs-selector-class">.disabled</span> {
        <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.6</span>;
    }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

</code></pre>
<p>结果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3d7fd78e0104fbfbdbd25737c5b6a57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=Uv7qVx3QKFb7Otbh1qLFXTZZySk%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">1.1.2 封装订单API</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3cd8a953096427f9b6a20be0e678c32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=oeyE1yIGKCDuDzqYxmh2zvibweE%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">1.1.3 获取订单的函数</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/134e29c3a5f9485989e3c4f46134fc29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=5VFsGwg2WnajHFZVX6MCyE0fu24%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">1.1.4 封装类型声明文件</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { AddressItem } from <span class="hljs-string">'./address'</span>

<span class="hljs-comment">/** 获取预付订单 返回信息 */</span>
export <span class="hljs-keyword">type</span> OrderPreResult = {
  <span class="hljs-comment">/** 商品集合 [ 商品信息 ] */</span>
  goods: OrderPreGoods[]
  <span class="hljs-comment">/** 结算信息 */</span>
  summary: {
    <span class="hljs-comment">/** 商品总价 */</span>
    totalPrice: number
    <span class="hljs-comment">/** 邮费 */</span>
    postFee: number
    <span class="hljs-comment">/** 应付金额 */</span>
    totalPayPrice: number
  }
  <span class="hljs-comment">/** 用户地址列表 [ 地址信息 ] */</span>
  userAddresses: AddressItem[]
}

<span class="hljs-comment">/** 商品信息 */</span>
export <span class="hljs-keyword">type</span> OrderPreGoods = {
  <span class="hljs-comment">/** 属性文字，例如“颜色:瓷白色 尺寸：8寸” */</span>
  attrsText: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** 数量 */</span>
  count: number
  <span class="hljs-comment">/** id */</span>
  id: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** 商品名称 */</span>
  name: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** 实付单价 */</span>
  payPrice: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** 图片 */</span>
  picture: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** 原单价 */</span>
  price: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** SKUID */</span>
  skuId: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** 实付价格小计 */</span>
  totalPayPrice: <span class="hljs-type">string</span>
  <span class="hljs-comment">/** 小计总价 */</span>
  totalPrice: <span class="hljs-type">string</span>
}

</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a00dfabd2124e39a354ce95ed1f1357~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=V8vdvlRhlZ6dBsYZyPA459XzoY0%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">1.1.5 存储获取到的订单信息到ref</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7f84ccaf7ab494a9ede8fd84011d50c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=r7xiA4TWJYLpJbcQo7HBssqkxCo%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">1.1.6 渲染获取到的数据到标签中</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/215a794410ec4272837aa9e3e151239f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=1FeHUTOrnKbvF9TU19gNfemwpVk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74c788b2712d4fb69d659d320cc6e522~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=wJPMduUP7cSyxutxhBeR3aese6o%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">1.1.7 再在先前的购物车代码中添加一行结算代码</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afe469480e2d4a5687109ef04aa34e80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=5lDUDYX5gXQw5kngt7Rxk83N3mY%3D" alt="image.png" loading="lazy"/>
结果：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51f94e774db54bf8b8f7fe426bcd202c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765382008&amp;x-signature=YtmUkyTlZoScc8LZFR570m%2FJd8c%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">1.2 收货地址</h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Android】深入理解Window和WindowManager]]></title>    <link>https://juejin.cn/post/7579518059170529306</link>    <guid>https://juejin.cn/post/7579518059170529306</guid>    <pubDate>2025-12-03T15:00:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579518059170529306" data-draft-id="7579473409749254195" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Android】深入理解Window和WindowManager"/> <meta itemprop="keywords" content="Android,Java"/> <meta itemprop="datePublished" content="2025-12-03T15:00:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="弥巷"/> <meta itemprop="url" content="https://juejin.cn/user/1743186606454698"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Android】深入理解Window和WindowManager
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743186606454698/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    弥巷
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T15:00:53.000Z" title="Wed Dec 03 2025 15:00:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、Window简介</h2>
<p>Window是一个抽象的“窗口”对象，用来承载视图。它负责承载所有UI，所有View最终都必须附着在一个Window中才能显示。不管是Activity、Dialog，还是Toast，它们的视图都是附加在Window上面的。例如要在桌面上显示一个悬浮窗，就需要Window来实现。</p>
<p>实际上，Window是一个抽象类，它的唯一实现类是PhoneWindow，Activity中的DecorView，Dialog中的View都是在PhoneWindow中创建的。因此Window实际是View的直接管理者。</p>
<p>总结一下，<strong>Window是View的载体，View是Window的表现形式</strong>。</p>
<h2 data-id="heading-1">2、Window和WindowManager</h2>
<p>先来看看如何通过WindowManager添加一个Window：</p>
<pre><code class="hljs language-java" lang="java">windowManager = (WindowManager) getSystemService(WINDOW_SERVICE);

<span class="hljs-comment">// 创建一个要添加到 Window 的 View</span>
floatingView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextView</span>(<span class="hljs-built_in">this</span>);
floatingView.setText(<span class="hljs-string">"Window"</span>);
floatingView.setTextSize(<span class="hljs-number">20f</span>);
floatingView.setBackgroundColor(Color.WHITE);
floatingView.setTextColor(Color.BLACK);

<span class="hljs-comment">// Window 参数</span>
WindowManager.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowManager</span>.LayoutParams(
        WindowManager.LayoutParams.WRAP_CONTENT,
        WindowManager.LayoutParams.WRAP_CONTENT,
        <span class="hljs-number">0</span>,
        <span class="hljs-number">0</span>,
        PixelFormat.TRANSLUCENT
);

<span class="hljs-comment">// Window 类型（应用内窗口）</span>
params.type = WindowManager.LayoutParams.TYPE_APPLICATION;

<span class="hljs-comment">// 不获取焦点、不拦截事件</span>
params.flags = WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE
| WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL;

<span class="hljs-comment">// 显示位置（右下角偏移）</span>
params.gravity = Gravity.END | Gravity.BOTTOM;
params.x = <span class="hljs-number">100</span>;
params.y = <span class="hljs-number">300</span>;

<span class="hljs-comment">// 添加到 WindowManager</span>
windowManager.addView(floatingView, params);
</code></pre>
<p>这样就可以在页面右下角显示一个Window，而该Window的表现形式就是一个TextView</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21d576ae593540be985941045d64498b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byl5be3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765378852&amp;x-signature=WO9FCmaMd3B9W33uYajMi%2B2NaqM%3D" alt="" loading="lazy"/></p>
<p>可以看到最后是通过<code>addView</code>方法将该Window显示在屏幕上的，该方法有两个参数：View和WindowManager.LayoutParams，View就是待会要显示的View，LayoutParams是该View的布局参数，关于LayoutParams有两个很重要的属性：type和flags。</p>
<h3 data-id="heading-2">2.1 type属性</h3>
<p>type属性表示Window的类型，用于告诉系统这是哪种窗口。它的层级、权限、位置如何处理。类型分为三类：</p>
<ul>
<li>应用窗口：对应一个Activity</li>
<li>子窗口：子窗口不能单独存在，需要附属在特定的父窗口中，比如常见的Dialog。</li>
<li>系统窗口：是需要声明权限才能创建的窗口，比如Toast和系统状态栏</li>
</ul>
<p>常用属性：</p>








































<table><thead><tr><th>类型</th><th>说明</th><th>权限</th></tr></thead><tbody><tr><td><strong>TYPE_APPLICATION</strong></td><td>默认 Activity Window；也可用来在 Activity 内添加悬浮 View</td><td>否</td></tr><tr><td><strong>TYPE_APPLICATION_PANEL</strong></td><td>附着在应用窗口上的面板，如 Dialog</td><td>否</td></tr><tr><td><strong>TYPE_APPLICATION_ATTACHED_DIALOG</strong></td><td>依附在 Activity 上的对话框类窗口</td><td>否</td></tr><tr><td><strong>TYPE_APPLICATION_SUB_PANEL</strong></td><td>子面板，比如 PopupWindow</td><td>否</td></tr><tr><td><strong>TYPE_BASE_APPLICATION</strong></td><td>Activity 的基础窗口</td><td>否</td></tr><tr><td><strong>TYPE_APPLICATION_OVERLAY</strong></td><td>系统悬浮窗（微信悬浮球、悬浮记事本），需要权限（<strong>SYSTEM_ALERT_WINDOW</strong>）</td><td>是</td></tr></tbody></table>
<p>另外，窗口类型的区分就决定了Window的显示层序。如果一个Window是系统窗口，那么它一定会显示在其他应用程序Window上面。而控制显示层级顺序的属性是Z-Order，即Z轴的值。这里指定了哪种窗口，就相当于指定了Z轴的值：</p>
<ul>
<li>应用窗口：1~99</li>
<li>子窗口：1000~1999</li>
<li>系统窗口：2000~2999</li>
</ul>
<p>值越大，显示的越上面，就是说type值大的Window可以盖住type值小的Window。</p>
<h3 data-id="heading-3">2.2 flags属性</h3>
<p>flags表示Window的属性，通过flags可以控制Window的显示特性。比如决定窗口是否可触摸，是否覆盖状态栏，是否点击穿透等等。</p>
<p>常用选项：</p>









































<table><thead><tr><th>flags</th><th>作用</th></tr></thead><tbody><tr><td><strong>FLAG_NOT_FOCUSABLE</strong></td><td>不获取焦点 ， 其他控件不会受影响（常用于悬浮窗）</td></tr><tr><td><strong>FLAG_NOT_TOUCH_MODAL</strong></td><td>自己范围外的触摸事件继续传递给底层窗口，只处理自身区域的触摸</td></tr><tr><td><strong>FLAG_NOT_TOUCHABLE</strong></td><td>不接收任何触摸事件（完全穿透），常用于屏幕水印、提示层</td></tr><tr><td><strong>FLAG_LAYOUT_IN_SCREEN</strong></td><td>允许 window 填满整个屏幕区域，全屏窗口使用</td></tr><tr><td><strong>FLAG_FULLSCREEN</strong></td><td>隐藏状态栏，进入全屏显示，用于视频全屏、游戏、沉浸模式</td></tr><tr><td><strong>FLAG_SHOW_WHEN_LOCKED</strong></td><td>在锁屏界面上显示Window，如来电界面、闹钟界面</td></tr><tr><td><strong>FLAG_KEEP_SCREEN_ON</strong></td><td>防止屏幕熄灭，用于视频播放、导航、长时间展示的窗口</td></tr><tr><td><strong>FLAG_TURN_SCREEN_ON</strong></td><td>显示窗口时自动亮屏，用于闹钟、定时提醒、特殊警告界面</td></tr></tbody></table>
<p>另外设置flags还可以用下面的方式：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 在现有flags上“追加”一个flag</span>
getWindow().addFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN);

<span class="hljs-comment">// 第二个参数表示“mask”，通常与 flags 相同。</span>
<span class="hljs-comment">// setFlags 会根据 mask 覆盖，而不是追加。</span>
getWindow().setFlags(
        WindowManager.LayoutParams.FLAG_FULLSCREEN,
        WindowManager.LayoutParams.FLAG_FULLSCREEN
);
</code></pre>
<h3 data-id="heading-4">2.3 WindowManager</h3>
<p>WindowManager所提供的功能很简单，常用的只有三个方法：添加View、更新View和删除View。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69bc2e8e0e4d4aa299b2f5a592008513~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byl5be3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765378852&amp;x-signature=IcJTfRrlVCEiiJDBHJYk5bJ6Fkw%3D" alt="" loading="lazy"/></p>
<p>这表明WindowManager是继承ViewManager这个接口的，同时WindowManager本身也是一个接口。</p>
<p>这三个方法是定义在ViewManager中的：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ViewManager</span> {     
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addView</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params)</span>;    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateViewLayout</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params)</span>;    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeView</span><span class="hljs-params">(View view)</span>;
}
</code></pre>
<h2 data-id="heading-5">3、Window的内部机制</h2>
<p>Window是Android中的窗口抽象，Window并不是实际存在的，它是以View的形式存在。在WindowManager中提供的三个接口方法都是针对View的，这说明View才是Window存在的实体。每个Window都对应一个View和一个ViewRootImpl，<strong>Window和View通过ViewRootImpl来建立联系</strong>。WindowManager是管理Window的接口，在实际使用中无法直接访问Window，对Window的访问必须通过WindowManager。为了弄清楚Window的内部机制，这里从Window的添加、删除和更新说起。</p>
<h3 data-id="heading-6">3.1 Window的添加过程</h3>
<p>Window的添加过程是通过addView来实现的：</p>
<pre><code class="hljs language-java" lang="java">windowManager.addView(floatingView, params);
</code></pre>
<p>WindowManager是一个接口，它的真正实现类是WindowManagerImpl类，在WindowManagerImpl中三个操作实现如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addView</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> View view, <span class="hljs-meta">@NonNull</span> ViewGroup.LayoutParams params)</span> {
    applyTokens(params);
    mGlobal.addView(view, params, mContext.getDisplayNoVerify(), mParentWindow,
            mContext.getUserId());
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateViewLayout</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> View view, <span class="hljs-meta">@NonNull</span> ViewGroup.LayoutParams params)</span> {
    applyTokens(params);
    mGlobal.updateViewLayout(view, params);
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeView</span><span class="hljs-params">(View view)</span> {
    mGlobal.removeView(view, <span class="hljs-literal">false</span>);
}
</code></pre>
<p>可以看出，WindowManagerImpl并没有直接实现Window的三大操作，而是调用mGlobal去处理。这个mGlobal是WindowManagerGlobal实例，而且它还是一个APP全局单例。WindowManagerImpl这工作模式是典型的桥接模式，将所有操作全部委托给WindowManagerGlobal来实现。</p>
<p>这就是说WindowManagerGlobal是WindowManager的真正逻辑实现，接下来看看WindowManagerGlobal中的addView方法：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addView</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params,
        Display display, Window parentWindow, <span class="hljs-type">int</span> userId)</span> {
    <span class="hljs-comment">// 参数检查</span>
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">if</span> (parentWindow != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 如果是子窗口，那么就需要调整一些布局参数</span>
        parentWindow.adjustLayoutParamsForSubWindow(wparams);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-comment">// ...</span>

    <span class="hljs-comment">// ViewRootImpl：窗口和系统交互的桥梁（事件分发、绘制）</span>
    <span class="hljs-comment">// panelParentView：用于存放父窗口的 View（如果是子窗口）</span>
    ViewRootImpl root;
    <span class="hljs-type">View</span> <span class="hljs-variable">panelParentView</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// 给整个Window添加过程加锁，确保线程安全</span>
    <span class="hljs-keyword">synchronized</span> (mLock) {
        <span class="hljs-comment">// ...</span>
        <span class="hljs-comment">// 普通窗口和父窗口分开处理，创建ViewRootImpl</span>
        <span class="hljs-keyword">if</span> (windowlessSession == <span class="hljs-literal">null</span>) {
            root = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewRootImpl</span>(view.getContext(), display);
        } <span class="hljs-keyword">else</span> {
            root = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewRootImpl</span>(view.getContext(), display,
                    windowlessSession, <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowlessWindowLayout</span>());
        }
        <span class="hljs-comment">// 将窗口参数绑定到View</span>
        view.setLayoutParams(wparams);
        <span class="hljs-comment">// 记录View、ViewRootImpl、LayoutParams，用于全局窗口管理和事件分发</span>
        mViews.add(view);
        mRoots.add(root);
        mParams.add(wparams);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 通过ViewRootImpl的setView方法真正把View添加到Window</span>
            root.setView(view, wparams, panelParentView, userId);
            <span class="hljs-comment">// ...</span>
        } <span class="hljs-keyword">catch</span> (RuntimeException e) {
            <span class="hljs-comment">// ...</span>
            }
            <span class="hljs-keyword">throw</span> e;
        }
    }
}
</code></pre>
<p>方法很长，但是整体逻辑比较简单。由于WindowManagerGlobal是WindowManager真正的逻辑实现类，所以在WindowManagerGlobal内部会记录下要处理的Window，包括Window，Window对应的View，Window对应的ViewRootImpl。</p>
<p>在WindowManagerGlobal中通过这么几个列表来存储：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@UnsupportedAppUsage</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;View&gt; mViews = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;View&gt;();
<span class="hljs-meta">@UnsupportedAppUsage</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;ViewRootImpl&gt; mRoots = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ViewRootImpl&gt;();
<span class="hljs-meta">@UnsupportedAppUsage</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;WindowManager.LayoutParams&gt; mParams =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;WindowManager.LayoutParams&gt;();
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArraySet&lt;View&gt; mDyingViews = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArraySet</span>&lt;View&gt;();
</code></pre>
<ul>
<li><code>mViews</code>：存放所有Window对应的View</li>
<li><code>mRoots</code>：存放所有Window对应的ViewRootImpl</li>
<li><code>mParams</code>：放每个 View 对应的窗口参数</li>
<li><code>mDyingViews</code>：存放正在被移除但还未完成销毁的View</li>
</ul>
<p>在addView中通过</p>
<pre><code class="hljs language-csharp" lang="csharp">mViews.<span class="hljs-keyword">add</span>(view);
mRoots.<span class="hljs-keyword">add</span>(root);
mParams.<span class="hljs-keyword">add</span>(wparams);
</code></pre>
<p>三个方法来添加到列表中，用于全局窗口管理和事件分发。</p>
<p>接着看看ViewRootImpl中的setView方法的实现：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setView</span><span class="hljs-params">(View view, WindowManager.LayoutParams attrs, View panelParentView,
            <span class="hljs-type">int</span> userId)</span> {
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            <span class="hljs-keyword">if</span> (mView == <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// ...</span>
                <span class="hljs-comment">// 在被添加到WindowManager之前调用一次，触发View的测量和布局</span>
                requestLayout();
                <span class="hljs-comment">// ...</span>

                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 保证窗口尺寸、布局、Insets、安全区域都正确</span>
                    mOrigWindowType = mWindowAttributes.type;
                    mAttachInfo.mRecomputeGlobalAttributes = <span class="hljs-literal">true</span>;
                    collectViewAttributes();
                    adjustLayoutParamsForCompatibility(mWindowAttributes,
                            mInsetsController.getAppearanceControlled(),
                            mInsetsController.isBehaviorControlled());
                    controlInsetsForCompatibility(mWindowAttributes);
                    
                    <span class="hljs-comment">// 通过WindowSession来完成IPC调用，完成创建Window</span>
                    <span class="hljs-type">Rect</span> <span class="hljs-variable">attachedFrame</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>();
                    <span class="hljs-keyword">final</span> <span class="hljs-type">float</span>[] compatScale = { <span class="hljs-number">1f</span> };
                    <span class="hljs-comment">// 向系统 WindowManagerService 添加窗口</span>
                    res = mWindowSession.addToDisplayAsUser(mWindow, mWindowAttributes,
                            getHostVisibility(), mDisplay.getDisplayId(), userId,
                            mInsetsController.getRequestedVisibleTypes(), inputChannel, mTempInsets,
                            mTempControls, attachedFrame, compatScale);
                    <span class="hljs-comment">// ...</span>
                } <span class="hljs-keyword">catch</span> (RemoteException | RuntimeException e) {
                    <span class="hljs-comment">// ...</span>
                } <span class="hljs-keyword">finally</span> {
                    <span class="hljs-keyword">if</span> (restore) {
                        attrs.restore();
                    }
                }

                <span class="hljs-comment">// ...</span>
            }
        }
    }
</code></pre>
<p>在这段代码中，在被添加到WindowManager之前会调用requestLayout()方法完成异步刷新请求，看看它的具体实现：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestLayout</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (!mHandlingLayoutInLayoutRequest) {
        checkThread();
        mLayoutRequested = <span class="hljs-literal">true</span>;
        scheduleTraversals();
    }
}
</code></pre>
<p>实际上，scheduleTraversals()方法就是View绘制的入口。</p>
<p>接着会调用<code>mWindowSession.addToDisplayAsUser</code>方法来完成Window的添加过程。<code>mWindowSession</code>的类型是<code>IWindowSession</code>，它是一个Binder对象，而<code>IWindowSession</code>是一个Binder接口。它的实现类在WindowManagerService中，这里通过mWindowSession完成了IPC通信。</p>
<p>这样就把添加Window的逻辑交给WindowManagerService来处理了，由于WindowManagerService比较复杂，这里就不过多介绍了。</p>
<p>在WindowManagerService中在Session类中完成Window的添加：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">addToDisplay</span><span class="hljs-params">(IWindow window, <span class="hljs-type">int</span> seq, WindowManager.LayoutParams attrs,<span class="hljs-type">int</span> viewVisibility, <span class="hljs-type">int</span> displayId, Rect outFrame, Rect outContentInsets,
 Rect outStableInsets, Rect outOutsets, DisplayCutout.ParcelableWrapper outDisplayCutout, InputChannel outInputChannel, InsetsState outInsetsState)</span> {
    <span class="hljs-keyword">return</span> mService.addWindow(<span class="hljs-built_in">this</span>, window, seq, attrs, viewVisibility, displayId, outFrame,outContentInsets, outStableInsets, outOutsets, outDisplayCutout, outInputChannel,outInsetsState);
}
</code></pre>
<p>最后总结一下：</p>
<ol>
<li>首先调用<code>WindowManagerImpl.addView()</code>，在addView中把具体逻辑委托给<code>WindowManagerGlobal.addView()</code></li>
<li>在<code>WindowManagerGlobal.addView()</code>中创建<code>ViewRootImpl</code> 赋值给了 root 。然后将 view，params，root 全部存入了各自的列表中。最后调用了 <code>ViewRootImpl.setView()</code>。</li>
<li><code>ViewRootImpl.setView()</code>中，先调用<code>requestlayout()</code>完成异步刷新请求，接着会通过<code>IWindowSession</code>来完成最终的Window添加过程，<code>IWindowSession</code> 是一个 Binder 对象，真正的实现类是 <code>Session</code>，也就是说 Window 的添加过程试一次 IPC 的调用。最后在 Session 中会通过 <code>WindowManageServer</code> 来实现 Window 的添加。</li>
</ol>
<h3 data-id="heading-7">3.2 Window的更新过程</h3>
<p>Window的更新过程和创建过程一样，都是先通过WindowManagerImpl，再进一步通过WindowManagerGlobal来实现的。从WindowManagerGlobal中的updateViewLayout开始看起：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateViewLayout</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params)</span> {
    <span class="hljs-keyword">if</span> (view == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"view must not be null"</span>);
    }
    <span class="hljs-keyword">if</span> (!(params <span class="hljs-keyword">instanceof</span> WindowManager.LayoutParams)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Params must be WindowManager.LayoutParams"</span>);
    }
    <span class="hljs-comment">// 强转类型</span>
    <span class="hljs-keyword">final</span> WindowManager.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">wparams</span> <span class="hljs-operator">=</span> (WindowManager.LayoutParams)params;
    <span class="hljs-comment">// 更新View的param</span>
    view.setLayoutParams(wparams);

    <span class="hljs-keyword">synchronized</span> (mLock) {
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> findViewLocked(view, <span class="hljs-literal">true</span>);
        <span class="hljs-type">ViewRootImpl</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> mRoots.get(index);
        mParams.remove(index);
        mParams.add(index, wparams);
        <span class="hljs-comment">// 通知 ViewRootImpl 更新布局参数</span>
        root.setLayoutParams(wparams, <span class="hljs-literal">false</span>);
    }
}
</code></pre>
<p>这个方法做的事情就比较简单了，首先是更新View中的LayoutParams，接着再更新ViewRootImpl中的LayoutParams，通过ViewRootImpl中的setLayoutParams方法完成，在这个方法中，会对View重新策略，布局，重绘。</p>
<p>除了View本身的重绘之外，ViewRootImpl还会通过WindowSession来更新Window视图，这个过程是由WindowManagerServer的relayoutWindow来实现的，这同样是一个IPC过程。</p>
<h3 data-id="heading-8">3.3 Window的删除过程</h3>
<p>还是从WindowManagerGlobal方法看起：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// UnsupportedAppUsage表示这是系统内部API，不对三方应用公开，但应用能使用</span>
<span class="hljs-meta">@UnsupportedAppUsage(maxTargetSdk = Build.VERSION_CODES.R, trackingBug = 170729553)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeView</span><span class="hljs-params">(View view, <span class="hljs-type">boolean</span> immediate)</span> {
    <span class="hljs-keyword">if</span> (view == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"view must not be null"</span>);
    }

    <span class="hljs-keyword">synchronized</span> (mLock) {
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> findViewLocked(view, <span class="hljs-literal">true</span>);
        <span class="hljs-type">View</span> <span class="hljs-variable">curView</span> <span class="hljs-operator">=</span> mRoots.get(index).getView();
        removeViewLocked(index, immediate);
        <span class="hljs-keyword">if</span> (curView == view) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"Calling with view "</span> + view
                + <span class="hljs-string">" but the ViewAncestor is attached to "</span> + curView);
    }
}
</code></pre>
<p>逻辑很简单，通过findViewLocked()找到View在views列表中的索引，然后调用removeViewLocked方法来做进一步的删除：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeViewLocked</span><span class="hljs-params">(<span class="hljs-type">int</span> index, <span class="hljs-type">boolean</span> immediate)</span> {
    <span class="hljs-comment">// 先根据index取出对应窗口（root和view） </span>
    <span class="hljs-type">ViewRootImpl</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> mRoots.get(index);
    <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> root.getView();

    <span class="hljs-keyword">if</span> (root != <span class="hljs-literal">null</span>) {
        root.getImeFocusController().onWindowDismissed();
    }
    <span class="hljs-comment">// root.die()：销毁窗口</span>
    <span class="hljs-comment">// immediate为true：立即销毁窗口</span>
    <span class="hljs-comment">// immediate为false：请求延迟销毁</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">deferred</span> <span class="hljs-operator">=</span> root.die(immediate);
    <span class="hljs-keyword">if</span> (view != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 把View从它的父亲（ViewRootImpl）解绑</span>
        view.assignParent(<span class="hljs-literal">null</span>);
        <span class="hljs-keyword">if</span> (deferred) {
            <span class="hljs-comment">// 如果延迟销毁，不能马上删除View，因为ViewRootImpl还没真正死完</span>
            <span class="hljs-comment">// 将当前View放入mDyingViews</span>
            mDyingViews.add(view);
        }
    }
}
</code></pre>
<p>在removeViewLocked方法中，删除操作是通过ViewRootImpl实现的。在WindowManager中提供两种删除接口<code>removeView</code>和<code>removeViewImmediate</code>分别是同步删除和异步删除。</p>
<p>一般不用removeViewImmediate删除Window，以免发生意错误。</p>
<p>这里主要说异步删除的情况，具体的删除操作由ViewRootImpl的die方法完成。在异步删除的情况下，die方法只是发送了一个请求删除的信息后就立刻返回了，这个时候View并没有完成删除操作，所以最后会将其添加到mDyingViews中，mDyingViews表示待删除的View列表。看看ViewRootImpl中的die方法实现：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">boolean</span> <span class="hljs-title function_">die</span><span class="hljs-params">(<span class="hljs-type">boolean</span> immediate)</span> {
    <span class="hljs-comment">// Make sure we do execute immediately if we are in the middle of a traversal or the damage</span>
    <span class="hljs-comment">// done by dispatchDetachedFromWindow will cause havoc on return.</span>
    <span class="hljs-keyword">if</span> (immediate &amp;&amp; !mIsInTraversal) {
        <span class="hljs-comment">// 立即销毁：调用者要求立即销毁并且当前不在View测量/布局/绘制（Traversal）中</span>
        <span class="hljs-comment">// 执行doDie方法立即删除窗口</span>
        doDie();
        <span class="hljs-comment">// 返沪false表示不需要延迟处理</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-comment">// 若不是立即销毁，处理硬件加速层</span>
    <span class="hljs-keyword">if</span> (!com.android.graphics.hwui.flags.Flags.removeVriSketchyDestroy()) {
        <span class="hljs-keyword">if</span> (!mIsDrawing) {
            destroyHardwareRenderer();
        } <span class="hljs-keyword">else</span> {
            Log.e(mTag, <span class="hljs-string">"Attempting to destroy the window while drawing!\n"</span>
                    + <span class="hljs-string">"  window="</span> + <span class="hljs-built_in">this</span> + <span class="hljs-string">", title="</span> + mWindowAttributes.getTitle());
        }
    }
    <span class="hljs-comment">// 发送异步销毁消息</span>
    mHandler.sendEmptyMessage(MSG_DIE);
    <span class="hljs-comment">// 表示需要延迟销毁</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<p>die方法内部只是一个简单的判断，如果是异步删除，那么就发送一个<em>MSG_DIE</em>的消息ViewRootImpl中的Handle会处理此消息并调用doDie()方法。如果是同步删除，那么就不发消息直接调用doDie()方法，这就是两种删除的区别。看看doDie()方法的具体实现：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">doDie</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// Window操作必须在创建ViewRootImpl的线程（主线程）执行，否则会导致UI状态错乱</span>
        checkThread();
        <span class="hljs-keyword">if</span> (LOCAL_LOGV) Log.v(mTag, <span class="hljs-string">"DIE in "</span> + <span class="hljs-built_in">this</span> + <span class="hljs-string">" of "</span> + mSurface);
            <span class="hljs-comment">// 进入同步块，防止多线程重复销毁 </span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            <span class="hljs-keyword">if</span> (mRemoved) {
                <span class="hljs-keyword">return</span>;
            }
            mRemoved = <span class="hljs-literal">true</span>;
            <span class="hljs-comment">// ...</span>

            <span class="hljs-keyword">if</span> (mAdded) {
                <span class="hljs-comment">// 真正的删除逻辑是在此方法中</span>
                dispatchDetachedFromWindow();
            }

            destroyHardwareRenderer();

            <span class="hljs-comment">// ...</span>

            mAdded = <span class="hljs-literal">false</span>;
            <span class="hljs-comment">// ...</span>
        }
        <span class="hljs-comment">// ...</span>
        WindowManagerGlobal.getInstance().doRemoveView(<span class="hljs-built_in">this</span>);
    }
</code></pre>
<p>在doDie方法内部，重点在dispatchDetachedFromWindow内部，在该方法中，实现了Window的删除逻辑：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">dispatchDetachedFromWindow</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// Make sure we free-up insets resources if view never received onWindowFocusLost()</span>
    <span class="hljs-comment">// because of a die-signal</span>
    mInsetsController.onWindowFocusLost();
    mFirstInputStage.onDetachedFromWindow();
    <span class="hljs-keyword">if</span> (mView != <span class="hljs-literal">null</span> &amp;&amp; mView.mAttachInfo != <span class="hljs-literal">null</span>) {
        mAttachInfo.mTreeObserver.dispatchOnWindowAttachedChange(<span class="hljs-literal">false</span>);
        <span class="hljs-comment">// 分析1</span>
        mView.dispatchDetachedFromWindow();
    }
    
    <span class="hljs-comment">// 分析2</span>
    mAccessibilityInteractionConnectionManager.ensureNoConnection();
    mAccessibilityInteractionConnectionManager.ensureNoDirectConnection();
    removeSendWindowContentChangedCallback();
    <span class="hljs-keyword">if</span> (android.view.accessibility.Flags.preventLeakingViewrootimpl()
            &amp;&amp; mAccessibilityInteractionController != <span class="hljs-literal">null</span>) {
        mAccessibilityInteractionController.destroy();
        mAccessibilityInteractionController = <span class="hljs-literal">null</span>;
    }

    destroyHardwareRenderer();

    setAccessibilityFocus(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);

    mInsetsController.cancelExistingAnimations();

    mView.assignParent(<span class="hljs-literal">null</span>);
    mView = <span class="hljs-literal">null</span>;
    mAttachInfo.mRootView = <span class="hljs-literal">null</span>;

    destroySurface();

    <span class="hljs-keyword">if</span> (mInputQueueCallback != <span class="hljs-literal">null</span> &amp;&amp; mInputQueue != <span class="hljs-literal">null</span>) {
        mInputQueueCallback.onInputQueueDestroyed(mInputQueue);
        mInputQueue.dispose();
        mInputQueueCallback = <span class="hljs-literal">null</span>;
        mInputQueue = <span class="hljs-literal">null</span>;
    }
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 分析3</span>
        mWindowSession.remove(mWindow.asBinder());
    } <span class="hljs-keyword">catch</span> (RemoteException e) {
    }
    <span class="hljs-comment">// Dispose receiver would dispose client InputChannel, too. That could send out a socket</span>
    <span class="hljs-comment">// broken event, so we need to unregister the server InputChannel when removing window to</span>
    <span class="hljs-comment">// prevent server side receive the event and prompt error.</span>
    <span class="hljs-keyword">if</span> (mInputEventReceiver != <span class="hljs-literal">null</span>) {
        mInputEventReceiver.dispose();
        mInputEventReceiver = <span class="hljs-literal">null</span>;
    }

    unregisterListeners();
    unscheduleTraversals();
}
</code></pre>
<p>上面方法主要干了三件事：</p>
<ol>
<li>分析1处：调用View的dispatchDetachedFromWindow方法，在该方法内部会调用onDeteachedFromWindow方法，该方法在做自定义View时，可以在该方法内部做一些资源回收工作，比如终止动画、停止线程等。</li>
<li>分析2处，垃圾回收相关工作，比如清除数据和消息，移除回调等。</li>
<li>分析3处，通过Session的remove方法来删除Window，这里也是一个IPC过程，真正删除的地方还是WindowManagerService。</li>
</ol>
<h2 data-id="heading-9">4、Window的创建过程</h2>
<p>通过上面的分析可以看出，View是Window地表现形式，而Window是View地载体，因此任何有视图地地方都有Window，比如Activity、Dialog、Toast等。本节将分析这些视图元素中的Window创建过程，这非常有利于理解Android系统。</p>
<h3 data-id="heading-10">4.1 Activity的Window创建过程</h3>
<p>要分析Activity的Window创建过程，必须要了解Activity的的启动流程，这里就先不过多说启动流程相关的内容了，在Activity启动的过程中，最终会由ActivityTread中的performLaunchActivity()来完成整个启动过程。</p>
<p>在这个方法中会通过类加载器创建Activity的实例对象，并调用其attach方法为其关联运行过程中所依赖的一系列上下文环境变量:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Activity <span class="hljs-title function_">performLaunchActivity</span><span class="hljs-params">(ActivityClientRecord r, Intent customIntent)</span> {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-type">Activity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">try</span> {
        java.lang.ClassLoader cl;
        <span class="hljs-keyword">if</span> (isSandboxedSdkContextUsed) {
            cl = activityBaseContext.getApplicationContext().getClassLoader();
        } <span class="hljs-keyword">else</span> {
            cl = activityBaseContext.getClassLoader();
        }
        <span class="hljs-comment">// ...</span>
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// ...</span>
            <span class="hljs-type">Window</span> <span class="hljs-variable">window</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
            <span class="hljs-comment">// ...</span>
            activity.attach(activityBaseContext, <span class="hljs-built_in">this</span>, getInstrumentation(), r.token,
                    r.ident, app, r.intent, r.activityInfo, title, r.parent,
                    r.embeddedID, r.lastNonConfigurationInstances, config,
                    r.referrer, r.voiceInteractor, window, r.activityConfigCallback,
                    r.assistToken, r.shareableActivityToken, r.initialCallerInfoAccessToken);

    }
    <span class="hljs-keyword">return</span> activity;
}
</code></pre>
<p>在attach方法中系统会创建Activity所属的Window对象，并且为其设置回调接口：</p>
<pre><code class="hljs language-java" lang="java">mWindow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhoneWindow</span>(<span class="hljs-built_in">this</span>, window, activityConfigCallback);
mWindow.setWindowControllerCallback(mWindowControllerCallback);
mWindow.setCallback(<span class="hljs-built_in">this</span>);
mWindow.setOnWindowDismissedCallback(<span class="hljs-built_in">this</span>);
mWindow.getLayoutInflater().setPrivateFactory(<span class="hljs-built_in">this</span>);
</code></pre>
<p>这里创建了PhoneWindow实例，而且设置了回调，同时Acivity自己就实现了接口，所以当Window接收到外界的状态改变时就会回调Activity的方法。Callback接口中有一些我们比较熟悉的方法：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Callback</span> {
    <span class="hljs-comment">// 处理键盘事件（物理键、软键、音量键等） </span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">dispatchKeyEvent</span><span class="hljs-params">(KeyEvent event)</span>;
    <span class="hljs-comment">// 当菜单被打开时回调</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">onMenuOpened</span><span class="hljs-params">(<span class="hljs-type">int</span> featureId, <span class="hljs-meta">@NonNull</span> Menu menu)</span>;
    <span class="hljs-comment">// 菜单项被点击时回调</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">onMenuItemSelected</span><span class="hljs-params">(<span class="hljs-type">int</span> featureId, <span class="hljs-meta">@NonNull</span> MenuItem item)</span>;
    <span class="hljs-comment">// 窗口焦点变化时回调</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onWindowFocusChanged</span><span class="hljs-params">(<span class="hljs-type">boolean</span> hasFocus)</span>;
    <span class="hljs-comment">// 窗口被添加到 WindowManager 时回调</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAttachedToWindow</span><span class="hljs-params">()</span>;
    <span class="hljs-comment">// 窗口从 WindowManager 移除时回调</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDetachedFromWindow</span><span class="hljs-params">()</span>;
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>这些方法就是在attach方法中设置的回调。到这里Window已经创建完成了，下面分析一下Activity视图是怎么依附到Window上的，由于Activity的视图时从setContentView方法提供的，接下来我们看看setContentView方法：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContentView</span><span class="hljs-params">(<span class="hljs-meta">@LayoutRes</span> <span class="hljs-type">int</span> layoutResID)</span> {
    getWindow().setContentView(layoutResID);
    initWindowDecorActionBar();
}
</code></pre>
<p>这里发现其实是调用了PhoneWindow的setContentView方法</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContentView</span><span class="hljs-params">(<span class="hljs-type">int</span> layoutResID)</span> {
    <span class="hljs-comment">// 如果没有DecorView，那么就创建它</span>
    <span class="hljs-keyword">if</span> (mContentParent == <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">//  这个方法创建DecorView</span>
        installDecor();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) {
        mContentParent.removeAllViews();
    }
    
    <span class="hljs-comment">// 布局加载逻辑</span>
    <span class="hljs-comment">// if中只是开启了过渡动画，else中直接加载布局，没有过渡动画</span>
    <span class="hljs-keyword">if</span> (hasFeature(FEATURE_CONTENT_TRANSITIONS)) {
        <span class="hljs-keyword">final</span> <span class="hljs-type">Scene</span> <span class="hljs-variable">newScene</span> <span class="hljs-operator">=</span> Scene.getSceneForLayout(mContentParent, layoutResID,
                getContext());
        transitionTo(newScene);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 普通布局加载，直接使用LayoutInflater.inflate</span>
        <span class="hljs-comment">// 把布局XML填充到mContentParent中</span>
        mLayoutInflater.inflate(layoutResID, mContentParent);
    }
    mContentParent.requestApplyInsets();
    <span class="hljs-comment">// 回调Activity的onContentChanged方法通知Activity视图已经发生改变</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">Callback</span> <span class="hljs-variable">cb</span> <span class="hljs-operator">=</span> getCallback();
    <span class="hljs-keyword">if</span> (!isDestroyed()) {
        <span class="hljs-keyword">if</span> (cb != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 回调onContentChanged方法</span>
            <span class="hljs-comment">// Activity可以在这里做findViewById()初始化控件 </span>
            cb.onContentChanged();
        }
        <span class="hljs-keyword">if</span> (mDecorContentParent != <span class="hljs-literal">null</span>) {
            mDecorContentParent.notifyContentChanged();
        }
    }
    mContentParentExplicitlySet = <span class="hljs-literal">true</span>;
}
</code></pre>
<p>这个方法主要做了以下几件事：</p>
<ul>
<li>如果DecorView不存在就创建DecorView，DecorView是Activity中的顶级View，一般来说它包括标题栏和内容栏。创建DecorView由<code>installDecor();</code>方法完成。</li>
<li>将View添加到DecorView的mContentparent中：这一步非常简单，第一步已经创建过DecorView了，这一步直接将Activity的视图添加到DecorView中的mContentParent即可：通过<code>mLayoutInflater.inflate(layoutResID, mContentParent);</code>将布局XML填充到mContentParent中。</li>
<li>回调Activity的onContentChanged方法通知Activity视图已经发生改变：也非常简单，由于Activity已经实现了Window的Callback接口，回调此方法表示Activity的视图已经被添加到DecorView的mContentparent中了，需要通知Activity，使其做相应的处理。</li>
</ul>
<p>通过上方的步骤，现在DecorView已经创建并初始化完成，Activity的布局也添加到DecorView的内容栏中，但是这个时候DecorView还没有被WindowManager添加到Window中</p>
<p>在ActivityThread的handleResumeActivity会调用Activity的onResume方法,并且会调用ViewManager的addView方法把DecorView添加到WindowManager中：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleResumeActivity</span><span class="hljs-params">(IBinder token, <span class="hljs-type">boolean</span> finalStateRequest, <span class="hljs-type">boolean</span> isForward,
            String reason)</span> {
        <span class="hljs-comment">//调用Activity的onResume方法</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">ActivityClientRecord</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> performResumeActivity(token, finalStateRequest, reason);
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">if</span> (r.window == <span class="hljs-literal">null</span> &amp;&amp; !a.mFinished &amp;&amp; willBeVisible) {
            r.window = r.activity.getWindow();
            <span class="hljs-type">View</span> <span class="hljs-variable">decor</span> <span class="hljs-operator">=</span> r.window.getDecorView();
            decor.setVisibility(View.INVISIBLE);
            <span class="hljs-comment">// 获取WindowMagaer</span>
            <span class="hljs-type">ViewManager</span> <span class="hljs-variable">wm</span> <span class="hljs-operator">=</span> a.getWindowManager();
            WindowManager.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">l</span> <span class="hljs-operator">=</span> r.window.getAttributes();
            a.mDecor = decor;
            l.type = WindowManager.LayoutParams.TYPE_BASE_APPLICATION;
         
            <span class="hljs-keyword">if</span> (a.mVisibleFromClient) {
                <span class="hljs-keyword">if</span> (!a.mWindowAdded) {
                    a.mWindowAdded = <span class="hljs-literal">true</span>;
                    <span class="hljs-comment">// 把DecorView添加到WindowManager</span>
                    wm.addView(decor, l);
                } 
                <span class="hljs-comment">// ...</span>
    }
</code></pre>
<p>到这里Activity的Window创建过程分析完毕</p>
<h3 data-id="heading-11">4.2 Dialog的Window创建过程</h3>
<p>Dialog的Window创建过程和Activity类似，可以分为如下几个步骤：</p>
<ol>
<li>创建Window：</li>
</ol>
<p>创建Window的地方就是直接在Dialog的构造函数中：</p>
<pre><code class="hljs language-java" lang="java">Dialog(<span class="hljs-meta">@UiContext</span> <span class="hljs-meta">@NonNull</span> Context context, <span class="hljs-meta">@StyleRes</span> <span class="hljs-type">int</span> themeResId,
        <span class="hljs-type">boolean</span> createContextThemeWrapper) {
    <span class="hljs-comment">// ...</span>

    mWindowManager = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);
    
    <span class="hljs-comment">// 创建PhoneWindow</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">Window</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhoneWindow</span>(mContext);
    mWindow = w;
    w.setCallback(<span class="hljs-built_in">this</span>);
    w.setOnWindowDismissedCallback(<span class="hljs-built_in">this</span>);
    w.setOnWindowSwipeDismissedCallback(() -&gt; {
        <span class="hljs-keyword">if</span> (mCancelable) {
            cancel();
        }
    });
    w.setWindowManager(mWindowManager, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
    w.setGravity(Gravity.CENTER);

    mListenersHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListenersHandler</span>(<span class="hljs-built_in">this</span>);
}
</code></pre>
<p>可以发现这里和Activity一样，都是创建PhoneWindow，同时设置一些回调。</p>
<ol start="2">
<li>初始化DecorView，并将Dialog的视图添加到DecorView中。</li>
</ol>
<p>这个步骤也和Activity类似：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContentView</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> View view)</span> {
    mWindow.setContentView(view);
}
</code></pre>
<p>这个过程也和Activity类似，都是通过Window去添加指定的布局文件。</p>
<ol start="3">
<li>将DecorView添加到Window中并显示</li>
</ol>
<p>在Dialog的show方法中，会通过WindowManager将DecorView添加到Window中：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ...</span>
        <span class="hljs-comment">// 获取DecorView</span>
        mDecor = mWindow.getDecorView();

        <span class="hljs-comment">// ...</span>
        <span class="hljs-comment">// 添加到WindowManager</span>
        mWindowManager.addView(mDecor, l);
        <span class="hljs-comment">// ...</span>
        <span class="hljs-comment">// 发送回调消息</span>
        <span class="hljs-comment">// 目的是在视图完成添加并可见后，通知业务逻辑。</span>
        sendShowMessage();
}
</code></pre>
<p>从上面三个步骤可以发现，Dialog的Window创建和Activity的Window创建很类似，二至几乎没有上面区别。</p>
<p>当Dialog关闭时，它会通过WindowManager来移除DecorView，<code>mWindowManager.removeViewImmediate(mDecor)</code> 。</p>
<p>普通的Dialog有一个特殊之处，<strong>就是必须采用Activity的Context，如果采用Application的Context，就会报错：</strong></p>
<pre><code class="hljs language-java" lang="java">Caused by: android.view.WindowManager$BadTokenException: Unable to add window -- token <span class="hljs-literal">null</span> is not valid; is your activity running?
</code></pre>
<p>错误信息很明确，是没有应用Token导致的，而Token一般只有Activity拥有，所以这里只需要用Activity作为Context来显示对话框即可。</p>
<p>另外，系统 Window 比较特殊，它可以不需要Token，我们可以将Dialog的Window的Type修改为系统类型就可以了：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Dialog</span> <span class="hljs-variable">dialog</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dialog</span>(getApplicationContext());
dialog.setContentView(R.layout.dialog_layout);
<span class="hljs-type">Window</span> <span class="hljs-variable">window</span> <span class="hljs-operator">=</span> dialog.getWindow();
<span class="hljs-keyword">if</span> (window != <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// 设置系统类型 Window，使其不依赖 Activity Token</span>
    window.setType(WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY);
}
dialog.show();
</code></pre>
<h3 data-id="heading-12">4.3 Toast的Window创建过程</h3>
<p>Toast也是基于Window来实现的，不过它的工作过程稍微会复杂一点。由于Toast具备定时取消功能，所以在 Toast 的内部有两类 IPC 的过程，第一类是 Toast 访问 <code>NotificationManagerService</code> 过程。第二类是 <code>NotificationManagerServer</code> 回调 Toast 里的 TN 接口。下面将 <code>NotificationManagerService</code> 简称为 NMS。</p>
<p>Toast 属于系统 Window，内部视图有两种定义方式，一种是系统默认的，另一种是通过 setView 方法来指定一个 View(setView 方法在 android 11 以后已经废弃了，不会再展示自定义视图)，它们都对应 Toast 的一个内部成员 <code>mNextView</code>。</p>
<p>Toast提供了show和cancel方法，分别用于显示和隐藏Toast，但是它们都是一个IPC过程：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ...</span>

        <span class="hljs-type">INotificationManager</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> getService();
        <span class="hljs-type">String</span> <span class="hljs-variable">pkg</span> <span class="hljs-operator">=</span> mContext.getOpPackageName();
        <span class="hljs-type">TN</span> <span class="hljs-variable">tn</span> <span class="hljs-operator">=</span> mTN;
        <span class="hljs-keyword">if</span> (Flags.toastNoWeakref()) {
            tn.mNextView = mNextView;
        } <span class="hljs-keyword">else</span> {
            tn.mNextViewWeakRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(mNextView);
        }
        <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isUiContext</span> <span class="hljs-operator">=</span> mContext.isUiContext();
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">displayId</span> <span class="hljs-operator">=</span> mContext.getDisplayId();

        <span class="hljs-type">boolean</span> <span class="hljs-variable">wasEnqueued</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (Compatibility.isChangeEnabled(CHANGE_TEXT_TOASTS_IN_THE_SYSTEM)) {
                <span class="hljs-keyword">if</span> (mNextView != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// It's a custom toast</span>
                    <span class="hljs-comment">// 调用NMS</span>
                    wasEnqueued = service.enqueueToast(pkg, mToken, tn, mDuration, isUiContext,
                            displayId);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// ...</span>
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// ...</span>
            }
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            <span class="hljs-comment">// Empty</span>
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// ...</span>
        }
    }
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (Compatibility.isChangeEnabled(CHANGE_TEXT_TOASTS_IN_THE_SYSTEM)
            &amp;&amp; mNextView == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 调用NMS </span>
            getService().cancelToast(mContext.getOpPackageName(), mToken);
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            <span class="hljs-comment">// Empty</span>
        }
    } <span class="hljs-keyword">else</span> {
        mTN.cancel();
    }
}
</code></pre>
<p>从上面的代码可以看出，显示和隐藏Toast都需要通过NMS来实现，由于NMS运行在系统的进程中，所以只能通过IPC来显示和隐藏Toast。</p>
<p>注意这里的TN类，它是一个Binder类，在Toast和NMS进行IPC的过程中，当NMS处理Toast的显示或隐藏请求时会跨进程回调TN中的方法，这个时候由于TN运行在Binder线程池中，所以需要通过Handler将其切换到当前线程中。这里的当前线程指的是发送Toast所在的线程。</p>
<p>不过要注意的是这里使用了Handler，所以这意味着Toast无法在没有Looper的线程中弹出，这是因为Handler需要使用Looper才能完成切换线程的功能。</p>
<p>既然是先和NMS通信，简单说一下NMS中的代码，代码较多，简单说一下流程：</p>
<ol>
<li>调用NMS方法携带3个参数，分别是当前包名、tn远程回调和Toast时长。NMS先把Toast请求封装为ToastRecord对象，添加到mToastQueue队列中。</li>
<li>mToastQueue是一个50容量的ArrayList，这样做是为了防止DOS，假如通过某个方法大量的连续弹出Toast，这将导致其他应用没机会弹出Toast。</li>
<li>正常情况下，是达不到存储上限的，当ToastRecord被添加到mToastQueue中，NMS会通过showNextToastLocked方法来显示当前的Toast。</li>
<li>Toast的显示是由ToastRecord的callback来完成的，而这个callback实际上就是传递进来的tn，所以最终调用TN中的方法会是在Binder线程池中。</li>
<li>Toast显示后，NMS还会通过scheduleTimeoutLocked方法发送一个延迟消息，同样是经过callback回调，这个就是取消Toast的动作。</li>
</ol>
<p>所以从上面分析来看，Toast和NMS进行了多次IPC通信，但是真正去显示Toast的还是得由Toast类来完成，也就是上面所说的TN类：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TN</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ITransientNotification</span>.Stub {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">final</span> Handler mHandler;
    <span class="hljs-comment">// ...</span>

    
    TN(Context context, String packageName, Binder token, List&lt;Callback&gt; callbacks,
            <span class="hljs-meta">@Nullable</span> Looper looper) {
        <span class="hljs-type">IAccessibilityManager</span> <span class="hljs-variable">accessibilityManager</span> <span class="hljs-operator">=</span> IAccessibilityManager.Stub.asInterface(
                ServiceManager.getService(Context.ACCESSIBILITY_SERVICE));
        mPresenter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToastPresenter</span>(context, accessibilityManager, getService(),
                packageName);
        mParams = mPresenter.getLayoutParams();
        mPackageName = packageName;
        mToken = token;
        mCallbacks = callbacks;

        mHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(looper, <span class="hljs-literal">null</span>) {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> {
                <span class="hljs-keyword">switch</span> (msg.what) {
                    <span class="hljs-keyword">case</span> SHOW: {
                        <span class="hljs-type">IBinder</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> (IBinder) msg.obj;
                        handleShow(token);
                        <span class="hljs-keyword">break</span>;
                    }
                    <span class="hljs-keyword">case</span> HIDE: {
                        handleHide();
                        <span class="hljs-comment">// Don't do this in handleHide() because it is also invoked by</span>
                        <span class="hljs-comment">// handleShow()</span>
                        mNextView = <span class="hljs-literal">null</span>;
                        <span class="hljs-keyword">break</span>;
                    }
                    <span class="hljs-keyword">case</span> CANCEL: {
                        handleHide();
                        <span class="hljs-comment">// Don't do this in handleHide() because it is also invoked by</span>
                        <span class="hljs-comment">// handleShow()</span>
                        mNextView = <span class="hljs-literal">null</span>;
                        <span class="hljs-keyword">try</span> {
                            getService().cancelToast(mPackageName, mToken);
                        } <span class="hljs-keyword">catch</span> (RemoteException e) {
                        }
                        <span class="hljs-keyword">break</span>;
                    }
                }
            }
        };
    }

   <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>这里我们会发现使用了Handler，但是前面说过TN的回调其实是在Binder线程池中，即运行在子线程中。当我们在主线程中弹出Toast肯定没问题，那么在子线程中弹出Toast呢？</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">"你好"</span>, Toast.LENGTH_SHORT).show();
}).start();
</code></pre>
<p>运行后报以下错误：</p>
<pre><code class="hljs language-java" lang="java">java.lang.NullPointerException: Can<span class="hljs-string">'t toast on a thread that has not called Looper.prepare()
at com.android.internal.util.Preconditions.checkNotNull(Preconditions.java:174)
at android.widget.Toast.getLooper(Toast.java:188)
at android.widget.Toast.&lt;init&gt;(Toast.java:173)
at android.widget.Toast.makeText(Toast.java:518)
at android.widget.Toast.makeText(Toast.java:507)
at com.example.windowtest.MainActivity.lambda$onCreate$1$com-example-windowtest-MainActivity(MainActivity.java:36)
at com.example.windowtest.MainActivity$$ExternalSyntheticLambda1.run(D8$$SyntheticClass:0)
</span></code></pre>
<p>可以发现这里的错误并不是说View不能再子线程中绘制，而是说没有Looper，所以我们给子线程也获取以下Looper：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    Looper.prepare();
    Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">"你好"</span>, Toast.LENGTH_SHORT).show();
}).start();
</code></pre>
<p>运行效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7522a6afe7664b52ab800e2dfb1b997e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byl5be3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765378852&amp;x-signature=y81K1R28i1H3At3qsglTH4rwlc4%3D" alt="" loading="lazy"/></p>
<p>是可以正常弹出Toast的，所以这里我们知道Toast不能显示在子线程其实并不是一个错误，Toast是可以在子线程中弹出的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[五、Kotlin——条件控制、循环控制]]></title>    <link>https://juejin.cn/post/7579499567868575794</link>    <guid>https://juejin.cn/post/7579499567868575794</guid>    <pubDate>2025-12-03T14:42:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579499567868575794" data-draft-id="7579427549471113262" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="五、Kotlin——条件控制、循环控制"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2025-12-03T14:42:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Haha_bj"/> <meta itemprop="url" content="https://juejin.cn/user/2612027844214647"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            五、Kotlin——条件控制、循环控制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612027844214647/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Haha_bj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T14:42:31.000Z" title="Wed Dec 03 2025 14:42:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>条件控制是每门编程语言中必不可少的，一般就是使用我们所熟知的if-else，来作为我们代码逻辑选择条件控制。在Java中一般使用 if-else和 switch-case 来作为条件控制，而在 Kotlin 中则是使用 if-else 和 when 来作为条件控制。
立</p>
<blockquote>
<p>Tips:Kotlin中没有switch-case 。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f1ff8406dfe45af9097cc260d562474~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFoYV9iag==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377751&amp;x-signature=tPHh6XIxoeqn45OLkr7SERvuC30%3D" alt="图片.png" loading="lazy"/></p>
<h2 data-id="heading-0">一、if 表达式</h2>
<h3 data-id="heading-1">1、带返回值 if 表达式</h3>
<p>在 Kotlin 中，if是一个表达式所以它会返回一个值，表达式的值为表达式作用域内最后一行的值。这一点和Java 是不同的,在 Java 中 if 仅仅是语句。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">maxOf</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>{
    <span class="hljs-keyword">if</span> (a &gt; b){
        <span class="hljs-keyword">return</span>  a
    }<span class="hljs-keyword">else</span>{
      <span class="hljs-keyword">return</span>  b
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> res = maxOf(<span class="hljs-number">10</span>,<span class="hljs-number">22</span>)
    
}
</code></pre>
<h3 data-id="heading-2">2、 if 表达式替代三目运算符</h3>
<p>因为在 Kotlin 中 if 表达式是带有返回值的、所以在 Kotlin 中是不需要三目运算符(xxx?xxx:xxx);因为 if 表达式这些都能做到。</p>
<p>而在 Kotlin 中则可以直接使用 if 表达式来使用:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/// 返回if </span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">maxOf</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>{
    <span class="hljs-keyword">return</span>  <span class="hljs-keyword">if</span> (a &gt; b){
        a
    }<span class="hljs-keyword">else</span>{
        b
    }
}
<span class="hljs-comment">//简写</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span>  <span class="hljs-title">maxOf</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>,b: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (a&gt;b) a <span class="hljs-keyword">else</span> b
}
</code></pre>
<h2 data-id="heading-3">二、when 表达式</h2>
<p>在 Kotlin 中使用 when 表达式替代了类似C语言的 switch-case 语句。</p>
<p>when 将它的参数与所有的分支条件顺序比较，直到某个分支满足条件。 when 既可以被当做表达式使用也可以被当做语句使用。如果它被当做表达式，符合条件的分支的值就是整个表达式的值，如果当做语句使用，则忽略个别分支的值。(像 if一样，每一个分支可以是一个代码块，它的值是块中最后的表达式的值。)</p>
<blockquote>
<p>Tips:如果其他分支都不满足条件将会求值 e/se 分支。如果 when 作为一个表达式使用，则必须有e/se 分支，除非编译器能够检测出所有的可能情况都已经覆盖了</p>
</blockquote>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">eval2</span><span class="hljs-params">(number: <span class="hljs-type">Number</span>)</span></span>:String=<span class="hljs-keyword">when</span>(number) {
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Int</span> -&gt; <span class="hljs-string">"this is int number"</span>
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Double</span> -&gt; <span class="hljs-string">"this is double number"</span>
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Float</span> -&gt; <span class="hljs-string">"ths is float number'
    is Long -&gt; "</span><span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> long number<span class="hljs-string">"
    is Byte -&gt; "</span><span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> byte number<span class="hljs-string">"
    is Short -&gt; "</span><span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> <span class="hljs-built_in">Short</span> number<span class="hljs-string">"
    else -&gt; "</span>invalid number<span class="hljs-string">"
}
</span></code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// when 同样是带有返回值的// when 将它的参数与所有的分支条件顺序比较，直到某个分支满足条件</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">eval2</span><span class="hljs-params">(number:<span class="hljs-type">Number</span>)</span></span>:String=<span class="hljs-keyword">when</span>(number) {
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Int</span> -&gt; <span class="hljs-string">"this is int number"</span>
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Double</span> -&gt; <span class="hljs-string">"this is double number'"</span>
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Float</span> -&gt; {
        println(<span class="hljs-string">"the number is float"</span>)
        <span class="hljs-string">"ths is float number"</span>
    }
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Byte</span> -&gt; <span class="hljs-string">"this is byte number"</span>
    <span class="hljs-keyword">is</span> <span class="hljs-built_in">Short</span> -&gt; <span class="hljs-string">"this is Short number"</span>
    <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"invalid number"</span>
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5df85641a95409f8957604f5283996d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFoYV9iag==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377751&amp;x-signature=DjQYdAuUaMJD1K%2BRJ9%2B2v8eiMuI%3D" alt="图片.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3d656eda8b74fcdb8f52e1cff528d6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFoYV9iag==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377751&amp;x-signature=xdn%2Fu3DBYxZBPA8iN%2B9kSgypUGU%3D" alt="图片.png" loading="lazy"/></p>
<h2 data-id="heading-4">三、循环控制</h2>
<p>循环控制语句也是每门语言不可缺少的一部分，一般就是我们所熟知的for、while、do-while 。
迟
Kotlin 循环其实几乎和 Java中 的一模一样。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0f6c72138f14a928332a5b32b6486c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFoYV9iag==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377751&amp;x-signature=goXC3cZ8%2BjUM21NhvOZu%2B0DUIXo%3D" alt="图片.png" loading="lazy"/></p>
<h3 data-id="heading-5">1、for 循环</h3>
<p>for 循环 可以对任何提供迭代器(iterator)的对象进行遍历，for 循环仅以唯一一种形式存在,和 Java的 foreach循环一致。其写法 for item in elements 和 C# 一样。和 Java 类似。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span>  array = mutableListOf&lt;<span class="hljs-built_in">Int</span>&gt;(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>)
<span class="hljs-keyword">for</span> (item <span class="hljs-keyword">in</span> array){
    println(item)
}
</code></pre>
<h3 data-id="heading-6">2、while 和 do-while 循环</h3>
<p>Kotlin 中 while 和 do-while 循环，它们的语法和 Java 中相应的循环没什么区别:</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span>  array = mutableListOf&lt;<span class="hljs-built_in">Int</span>&gt;(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>)

<span class="hljs-keyword">var</span>  index = <span class="hljs-number">0</span>
<span class="hljs-keyword">while</span> (index &lt; array.size){
    println(<span class="hljs-string">"The <span class="hljs-variable">$index</span> element is <span class="hljs-subst">${array[index++]}</span>"</span>)
}
println(<span class="hljs-string">"空格"</span>)

 <span class="hljs-comment">// do - while 先执行 一次循环体，再看循环条件是否满足。满足继续执行，不满足则退 </span>
index = <span class="hljs-number">0</span>
<span class="hljs-keyword">do</span> {
    println(<span class="hljs-string">"The <span class="hljs-variable">$index</span> element is <span class="hljs-subst">${array[index++]}</span>"</span>)
}<span class="hljs-keyword">while</span> (index &lt; array.size)
</code></pre>
<h3 data-id="heading-7">3、区间表达式</h3>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">// ..  遍历区间，注意Kotlin的区间的包含或是闭合的。</span>
<span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span> .. <span class="hljs-number">10</span>){
    println(<span class="hljs-string">"<span class="hljs-variable">$i</span>"</span>)
}
<span class="hljs-comment">// 1 2 3 4 5 6 7 8 9 10</span>

<span class="hljs-comment">// until 不包括最后一个元素</span>
<span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span> until  <span class="hljs-number">10</span>){
    println(<span class="hljs-string">"<span class="hljs-variable">$i</span>"</span>)
}
<span class="hljs-comment">// 1 2 3 4 5 6 6 7 8</span>
</code></pre>
<pre><code class="hljs language-Kotlin" lang="Kotlin"> <span class="hljs-comment">// downTo //是指从10 ... 1</span>
  <span class="hljs-keyword">for</span> ( i <span class="hljs-keyword">in</span> <span class="hljs-number">10</span> downTo <span class="hljs-number">1</span>){
      println(<span class="hljs-string">"<span class="hljs-variable">$i</span>"</span>)
  }
<span class="hljs-comment">// 10 9 8 7 6 5 4 3 2 1</span>

  <span class="hljs-comment">// step 步长</span>
  <span class="hljs-keyword">for</span> ( i <span class="hljs-keyword">in</span> <span class="hljs-number">10</span> downTo <span class="hljs-number">1</span> step  <span class="hljs-number">2</span> ){
      println(<span class="hljs-string">"<span class="hljs-variable">$i</span>"</span>)
  }
  <span class="hljs-comment">// 10 8 6 5 4 2</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[23.Kotlin 继承：继承的细节：覆盖方法与属性]]></title>    <link>https://juejin.cn/post/7579518059170627610</link>    <guid>https://juejin.cn/post/7579518059170627610</guid>    <pubDate>2025-12-03T15:40:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579518059170627610" data-draft-id="7579472170906124338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="23.Kotlin 继承：继承的细节：覆盖方法与属性"/> <meta itemprop="keywords" content="Android,Kotlin,后端"/> <meta itemprop="datePublished" content="2025-12-03T15:40:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Android_小雨"/> <meta itemprop="url" content="https://juejin.cn/user/220360279590862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            23.Kotlin 继承：继承的细节：覆盖方法与属性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/220360279590862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Android_小雨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T15:40:02.000Z" title="Wed Dec 03 2025 15:40:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>希望帮你在Kotlin进阶路上少走弯路，在技术上稳步提升。当然，由于个人知识储备有限，笔记中难免存在疏漏或表述不当的地方，也非常欢迎大家提出宝贵意见，一起交流进步。 —— Android_小雨</p>
</blockquote>
<p>整体目录：<a href="https://juejin.cn/spost/7573592952242602036" target="_blank" title="https://juejin.cn/spost/7573592952242602036">Kotlin 进阶不迷路：41 个核心知识点，构建完整知识体系</a></p>
<h2 data-id="heading-0">一、前言</h2>
<p>在面向对象编程（OOP）中，继承是实现代码复用和多态性的基石。然而，相较于 Java 宽松的继承机制，Kotlin 引入了更为严格的“显式声明”哲学。</p>
<h3 data-id="heading-1">1.1 覆盖的核心价值</h3>
<p>子类通过覆盖（Override）父类成员，不仅能够继承父类的能力，更能<strong>定制化扩展父类行为</strong>。这是实现多态特性的关键：同一个方法调用，在不同的子类实例上表现出不同的行为。</p>
<h3 data-id="heading-2">1.2 Kotlin 的设计哲学</h3>
<p>Kotlin 遵循 <em>Effective Java</em> 中的名言：“<strong>Design and document for inheritance or else prohibit it</strong>”（要么为继承做设计并文档化，要么就禁止它）。
因此，Kotlin 的类和成员默认是 <code>final</code> 的。这种设计规避了“脆弱基类”问题，防止开发者在无意中覆盖了父类的重要逻辑，从而提高了代码的安全性和可预测性。</p>
<h2 data-id="heading-3">二、覆盖的前置条件：Open 关键字</h2>
<p>要实现覆盖，必须打破 Kotlin 默认的“封闭”状态，满足“双重开放”条件：</p>
<h3 data-id="heading-4">2.1 类的可继承性</h3>
<p>父类必须用 <code>open</code> 修饰。</p>
<ul>
<li><strong>注意</strong>：抽象类（<code>abstract class</code>）和接口（<code>interface</code>）默认是开放的，无需显式添加 <code>open</code>。</li>
<li><strong>禁止场景</strong>：未加 <code>open</code> 的普通类默认为 <code>final</code>，不可被继承。</li>
</ul>
<h3 data-id="heading-5">2.2 成员的可覆盖性</h3>
<p>父类的方法或属性必须用 <code>open</code> 修饰，子类才能通过 <code>override</code> 关键字进行覆盖。
以下成员<strong>不可覆盖</strong>：</p>
<ul>
<li>无 <code>open</code> 修饰的普通成员（隐式 <code>final</code>）。</li>
<li>顶层函数/属性、局部函数/属性。</li>
<li><code>private</code> 成员（对子类不可见）。</li>
</ul>
<h3 data-id="heading-6">2.3 基础示例</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 类必须是 open 的</span>
<span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> {
    <span class="hljs-comment">// 2. 属性必须是 open 的</span>
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">val</span> maxSpeed: <span class="hljs-built_in">Int</span> = <span class="hljs-number">120</span>

    <span class="hljs-comment">// 3. 方法必须是 open 的</span>
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"车辆以 <span class="hljs-variable">$maxSpeed</span> km/h 行驶"</span>)
    }
}

</code></pre>
<h2 data-id="heading-7">三、方法覆盖（Method Override）：规则与实战</h2>
<h3 data-id="heading-8">3.1 基本语法</h3>
<p>Kotlin 强制要求使用 <code>override</code> 关键字，这与 Java 中可选的 <code>@Override</code> 注解有着本质区别。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> : <span class="hljs-type">Vehicle</span>() {
    <span class="hljs-comment">// 显式 override，否则编译报错</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"汽车以 <span class="hljs-variable">$maxSpeed</span> km/h 匀速行驶"</span>)
    }
}

<span class="hljs-comment">// 多态调用</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> vehicle: Vehicle = Car()
    vehicle.run() <span class="hljs-comment">// 输出：汽车以 120 km/h 匀速行驶</span>
}

</code></pre>
<h3 data-id="heading-9">3.2 方法覆盖的核心规则</h3>
<h3 data-id="heading-10">3.2.1 签名完全兼容</h3>
<ul>
<li><strong>参数</strong>：数量、类型、顺序必须严格一致。</li>
<li><strong>返回值协变（Covariant）</strong>：子类重写方法时，返回值类型可以是父类方法返回值类型的<strong>子类型</strong>。</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Transport</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Train</span> : <span class="hljs-type">Transport</span>()

<span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Logistics</span> {
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getTransport</span><span class="hljs-params">()</span></span>: Transport = Transport()
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RailwayLogistics</span> : <span class="hljs-type">Logistics</span>() {
    <span class="hljs-comment">// 合法：返回 Train 是 Transport 的子类</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getTransport</span><span class="hljs-params">()</span></span>: Train = Train()
}

</code></pre>
<h3 data-id="heading-11">3.2.2 禁止“隐式覆盖”（ override 不可省略）</h3>
<p>如果不写 <code>override</code>，编译器会直接报错。这一机制明确了开发者的意图，防止因拼写错误或无意中定义了同名方法而导致的逻辑 Bug。</p>
<h3 data-id="heading-12">3.2.3 控制后续覆盖权限（Final Override）</h3>
<p>子类覆盖后的方法默认依然是 <code>open</code> 的。如果希望继承链到此为止，禁止后续子类继续修改逻辑，可以使用 <code>final override</code>。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SportCar</span> : <span class="hljs-type">Car</span>() {
    <span class="hljs-comment">// 此方法已被锁定，SportCar 的子类无法再重写 run</span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"跑车以 200 km/h 高速行驶"</span>)
    }
}

</code></pre>
<h3 data-id="heading-13">3.2.4 抽象方法的覆盖</h3>
<p>抽象方法默认是 <code>open</code> 的，非抽象子类<strong>必须</strong>覆盖它们。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractMachine</span> {
    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FactoryMachine</span> : <span class="hljs-type">AbstractMachine</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span> { <span class="hljs-comment">// 必须实现</span>
        println(<span class="hljs-string">"工厂机器启动"</span>)
    }
}

</code></pre>
<h3 data-id="heading-14">3.3 实战技巧：复用与多态（复用父类逻辑（super 关键字））</h3>
<p>在重写逻辑时，通常需要保留父类的基础行为，此时使用 <code>super</code> 关键字。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bus</span> : <span class="hljs-type">Vehicle</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.run() <span class="hljs-comment">// 复用父类逻辑：输出基础行驶信息</span>
        println(<span class="hljs-string">"公交车即将停靠站点"</span>) <span class="hljs-comment">// 扩展子类特有逻辑</span>
    }
}

</code></pre>
<h2 data-id="heading-15">四、属性覆盖（Property Override）：特殊规则与陷阱</h2>
<p>属性覆盖是 Kotlin 的一大特色（Java 中字段不能被重写）。其核心在于保持<strong>类型兼容</strong>与<strong>可变性合理</strong>。</p>
<h3 data-id="heading-16">4.1 基本语法</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bicycle</span> : <span class="hljs-type">Vehicle</span>() {
    <span class="hljs-comment">// 覆盖属性，语法与方法类似</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> maxSpeed: <span class="hljs-built_in">Int</span> = <span class="hljs-number">40</span>
}

</code></pre>
<h3 data-id="heading-17">4.2 核心规则</h3>
<h3 data-id="heading-18">4.2.1 可变性兼容规则（关键）</h3>
<p>子类在覆盖属性时，可以扩展属性的可变性，但不能限制它。</p>



































<table><thead><tr><th>父类属性</th><th>子类覆盖允许</th><th>结果</th><th>说明</th></tr></thead><tbody><tr><td><code>val</code> (只读)</td><td><code>val</code> (只读)</td><td>✅ 合法</td><td>保持只读特性</td></tr><tr><td><code>val</code> (只读)</td><td><code>var</code> (读写)</td><td>✅ 合法</td><td><strong>扩展</strong>为可变，兼容父类的读取契约</td></tr><tr><td><code>var</code> (读写)</td><td><code>val</code> (只读)</td><td>❌ <strong>禁止</strong></td><td>破坏了父类的“写入”契约</td></tr><tr><td><code>var</code> (读写)</td><td><code>var</code> (读写)</td><td>✅ 合法</td><td>保持读写特性</td></tr></tbody></table>
<p><strong>示例：Var 覆盖 Val</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> {
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">val</span> price: <span class="hljs-built_in">Double</span> = <span class="hljs-number">100.0</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MutableProduct</span> : <span class="hljs-type">Product</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> price: <span class="hljs-built_in">Double</span> = <span class="hljs-number">120.0</span> <span class="hljs-comment">// 合法：子类实例可以修改价格</span>
}

</code></pre>
<h3 data-id="heading-19">4.2.2 覆盖的三种实现方式</h3>
<ol>
<li>
<p><strong>直接赋值</strong>：赋一个新的常量值。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ElectricCar</span> : <span class="hljs-type">Vehicle</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> maxSpeed: <span class="hljs-built_in">Int</span> = <span class="hljs-number">150</span> <span class="hljs-comment">// 直接重新赋值</span>
}
</code></pre>
</li>
<li>
<p><strong>自定义 Getter (计算属性)</strong>：不占用内存字段，每次访问时动态计算。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Truck</span> : <span class="hljs-type">Vehicle</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> maxSpeed: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">get</span>() = <span class="hljs-number">90</span> <span class="hljs-comment">// 计算属性（无字段存储）</span>
}

<span class="hljs-comment">// 带依赖的计算属性</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LoadedTruck</span> : <span class="hljs-type">Vehicle</span>() {
    <span class="hljs-keyword">var</span> loadWeight: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> maxSpeed: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">get</span>() = <span class="hljs-number">120</span> - (loadWeight / <span class="hljs-number">100</span>) <span class="hljs-comment">// 载重越大，最高速越低</span>
}
</code></pre>
</li>
<li>
<p><strong>抽象属性的覆盖</strong>：抽象类的抽象属性隐式 open，子类需用 override 提供实现（赋值或计算属性）。</p>
</li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Device</span> {
    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">val</span> brand: String <span class="hljs-comment">// 抽象属性，无实现</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span> : <span class="hljs-type">Device</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> brand: String = <span class="hljs-string">"Apple"</span> <span class="hljs-comment">// 赋值实现</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Tablet</span> : <span class="hljs-type">Device</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> brand: String <span class="hljs-keyword">get</span>() = <span class="hljs-string">"Samsung"</span> <span class="hljs-comment">// 计算属性实现</span>
}
</code></pre>
<h3 data-id="heading-20">4.3 ⚠️ 致命陷阱</h3>
<p>这是 Kotlin 继承中最容易踩的坑。<strong>父类构造函数在子类属性初始化之前执行。</strong></p>
<h3 data-id="heading-21">4.3.1初始化顺序陷阱</h3>
<p>子类覆盖属性的初始化在「父类构造函数执行之后」，避免在父类构造中依赖子类覆盖属性：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">val</span> value: <span class="hljs-built_in">Int</span> = <span class="hljs-number">10</span>
    <span class="hljs-keyword">init</span> {
        println(<span class="hljs-string">"Parent init: value = <span class="hljs-variable">$value</span>"</span>) <span class="hljs-comment">// 输出：10（子类覆盖属性未初始化）</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> : <span class="hljs-type">Parent</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> value: <span class="hljs-built_in">Int</span> = <span class="hljs-number">20</span>
    <span class="hljs-keyword">init</span> {
        println(<span class="hljs-string">"Child init: value = <span class="hljs-variable">$value</span>"</span>) <span class="hljs-comment">// 输出：20（覆盖属性已初始化）</span>
    }
}

<span class="hljs-keyword">val</span> child = Child() <span class="hljs-comment">// 执行流程：Parent 构造 → Child 覆盖属性初始化 → Child 构造</span>
</code></pre>
<h3 data-id="heading-22">4.3.2 覆盖 var 属性的 getter/setter</h3>
<p>可单独覆盖 var 属性的 getter 或 setter，保留另一部分逻辑：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">var</span> name: String = <span class="hljs-string">"Unknown"</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NicknamedUser</span> : <span class="hljs-type">User</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> name: String
        <span class="hljs-keyword">get</span>() = <span class="hljs-keyword">super</span>.name + <span class="hljs-string">"_nickname"</span> <span class="hljs-comment">// 覆盖 getter</span>
        <span class="hljs-keyword">set</span>(value) { <span class="hljs-keyword">super</span>.name = value.trim() } <span class="hljs-comment">// 覆盖 setter</span>
}

<span class="hljs-keyword">val</span> user = NicknamedUser()
user.name = <span class="hljs-string">"  Tom  "</span>
println(user.name) <span class="hljs-comment">// 输出：Tom_nickname</span>

</code></pre>
<h2 data-id="heading-23">五、覆盖冲突解决（多实现场景）</h2>
<p>当类继承了父类并实现了多个接口，且这些父类型中存在签名相同的成员时，编译器无法自动决策，必须由开发者显式解决冲突。</p>
<h3 data-id="heading-24">5.1 接口多实现的冲突</h3>
<p>多个接口有同名方法时，使用 <code>super&lt;T&gt;</code> 语法指定调用哪个接口的实现。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Walkable</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">move</span><span class="hljs-params">()</span></span> = println(<span class="hljs-string">"步行"</span>)
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Flyable</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">move</span><span class="hljs-params">()</span></span> = println(<span class="hljs-string">"飞行"</span>)
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> : <span class="hljs-type">Walkable</span>, <span class="hljs-type">Flyable</span> {
    <span class="hljs-comment">// 编译器报错，必须显式 override</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">move</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>&lt;Walkable&gt;.move() <span class="hljs-comment">// 调用 Walkable 的逻辑</span>
        <span class="hljs-keyword">super</span>&lt;Flyable&gt;.move()  <span class="hljs-comment">// 调用 Flyable 的逻辑</span>
        println(<span class="hljs-string">"鸟类扑腾着翅膀"</span>)
    }
}

</code></pre>
<h3 data-id="heading-25">5.2 类继承 + 接口实现的冲突(属性冲突解决)</h3>
<p>父类成员优先级高于接口成员。若需调用接口的实现，需通过 <code>super&lt;接口名&gt;.成员()</code> 显式指定：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">eat</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"动物进食"</span>)
    }
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Herbivore</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">eat</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"食草动物吃植物"</span>)
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Deer</span> : <span class="hljs-type">Animal</span>(), Herbivore {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">eat</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>&lt;Animal&gt;.eat() <span class="hljs-comment">// 显式调用父类方法（也可直接 super.eat()）</span>
        <span class="hljs-keyword">super</span>&lt;Herbivore&gt;.eat() <span class="hljs-comment">// 显式调用接口方法</span>
    }
}

<span class="hljs-keyword">val</span> deer = Deer()
deer.eat() <span class="hljs-comment">// 输出：动物进食 → 食草动物吃植物</span>

</code></pre>
<h2 data-id="heading-26">六、使用注意事项与避坑指南</h2>
<ol>
<li>
<p><strong>禁止覆盖 private 成员</strong>：
父类 <code>private</code> 成员对子类不可见。若子类定义了一个同名函数，这<strong>不是覆盖</strong>，而是一个全新的、与父类无关的方法。</p>
</li>
<li>
<p><strong>避免过度覆盖</strong>：
不要为了使用继承而继承。仅在需要修改/扩展父类行为时进行覆盖。如果只是为了复用代码，优先考虑**组合（Composition）**而非继承。</p>
</li>
<li>
<p><strong>谨慎修改可变性</strong>：
虽然用 <code>var</code> 覆盖 <code>val</code> 在语法上是允许的，但要确保这样做符合业务逻辑，防止外部意外修改了本该是常量的属性。</p>
</li>
<li>
<p><strong>多态场景下的类型转换</strong>：
父类引用调用覆盖成员时，JVM 会自动分发到子类的实现，<strong>无需</strong>进行类型强转即可执行子类逻辑。</p>
</li>
<li>
<p><strong>异常声明</strong>：
Kotlin 没有 Checked Exception（受检异常），但覆盖方法时，子类抛出的运行时异常范围不应违背父类的设计契约（遵循 Liskov 替换原则）。</p>
</li>
<li>
<p><strong>接口抽象成员与父类成员冲突</strong></p>
<p>优先覆盖父类成员，若需使用接口逻辑，通过 super&lt;接口名&gt; 调用</p>
</li>
<li>
<p><strong>覆盖方法的异常声明</strong></p>
<p>子类覆盖方法不能抛出比父类更多的 checked 异常（Kotlin 无 checked 异常，但需注意运行时异常的合理性）</p>
</li>
</ol>
<h2 data-id="heading-27">七、总结与最佳实践</h2>
<h3 data-id="heading-28">7.1 核心知识点回顾</h3>
<ul>
<li>覆盖前提：父类 open + 成员 open，子类显式 override</li>
<li>方法覆盖：签名兼容、支持协变返回值、可通过 final 禁止后续覆盖</li>
<li>属性覆盖：支持 val→var 扩展、三种实现方式、注意初始化顺序</li>
<li>冲突解决：多实现同名成员需显式 override，用 super&lt;类型&gt; 复用指定实现</li>
</ul>
<h3 data-id="heading-29">7.2 最佳实践</h3>
<ul>
<li><strong>显式化原则</strong>：open 和 override 关键字不可省略，提升代码可读性</li>
<li><strong>最小修改原则</strong>：覆盖父类成员时，尽量复用 super 逻辑，仅补充必要的子类差异</li>
<li><strong>兼容性原则</strong>：覆盖后的成员需保持与父类的兼容性（不缩小参数范围、不丢失功能）</li>
<li><strong>单一职责原则</strong>：避免为了覆盖而覆盖，确保覆盖行为符合子类的业务职责</li>
<li><strong>冲突处理原则</strong>：多实现冲突时，优先保留核心逻辑，合理复用不同接口 / 父类的实现</li>
</ul>
<h3 data-id="heading-30">7.3 Kotlin vs Java 覆盖核心区别</h3>






























<table><thead><tr><th>对比维度</th><th>Kotlin 覆盖</th><th>Java 覆盖</th></tr></thead><tbody><tr><td><strong>显式声明</strong></td><td><strong>必须</strong>用 <code>override</code></td><td>可选 <code>@Override</code></td></tr><tr><td><strong>默认状态</strong></td><td>默认 <code>final</code> (需 <code>open</code>)</td><td>默认可覆盖 (需 <code>final</code> 禁止)</td></tr><tr><td><strong>属性覆盖</strong></td><td>支持 (val -&gt; var, Getter)</td><td>不支持 (仅字段隐藏)</td></tr><tr><td><strong>返回值</strong></td><td>支持协变</td><td>支持协变</td></tr></tbody></table>
<h3 data-id="heading-31">8.全文总结</h3>
<p>为了方便记忆 Kotlin 的覆盖规则，我们总结为：</p>
<ul>
<li><strong>1 个关键字</strong>：<strong>override</strong> 是强制且核心的。</li>
<li><strong>2 个前提</strong>：父类必须 <strong>open</strong> + 成员必须 <strong>open</strong>。</li>
<li><strong>3 种属性覆盖</strong>：直接赋值、自定义 Getter、<strong>var 覆盖 val</strong>（扩展可变性）。</li>
<li><strong>4 大核心规则</strong>：
<ol>
<li>签名必须严格匹配。</li>
<li>返回值支持协变（子类类型）。</li>
<li>初始化陷阱（父类构造先于子类属性）。</li>
<li>冲突解决需指明 <code>super&lt;Type&gt;</code>。</li>
</ol>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型应用技术之Rerank重排序]]></title>    <link>https://juejin.cn/post/7579460553614884915</link>    <guid>https://juejin.cn/post/7579460553614884915</guid>    <pubDate>2025-12-03T11:53:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579460553614884915" data-draft-id="7579473409748353075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型应用技术之Rerank重排序"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-03T11:53:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Stream"/> <meta itemprop="url" content="https://juejin.cn/user/4132429930956443"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型应用技术之Rerank重排序
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4132429930956443/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Stream
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T11:53:12.000Z" title="Wed Dec 03 2025 11:53:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">本期导读</h2>
<p>在前面，我们深入学习了RAG检索增强、Function Calling工具调用、MCP协议、Agent架构、A2A协作、Prompt Engineering和AI编程工具。现在我们要探讨RAG系统中的关键组件——Rerank（重排序）技术。</p>
<p>Rerank是RAG系统中的"质检员"，它能够对初步检索结果进行重新排序，显著提升检索质量，是构建高质量RAG系统不可或缺的技术。</p>
<p>本文将全面解析Rerank的原理、算法、模型和应用，帮助开发者构建更精准的检索系统。</p>
<p>本文内容包括：</p>
<ul>
<li>Rerank的基础概念和原理</li>
<li>Rerank算法详解</li>
<li>主流Rerank模型对比</li>
<li>Rerank在RAG中的应用策略</li>
<li>Python实战：构建Rerank系统</li>
<li>性能优化和最佳实践</li>
</ul>
<h2 data-id="heading-1">一、Rerank是什么？</h2>
<h3 data-id="heading-2">1.1 Rerank的定义</h3>
<p>**Rerank（重排序）**是指在初步检索结果的基础上，使用更精确的模型对结果进行重新排序的技术。</p>
<pre><code class="hljs language-css" lang="css">传统检索流程：
查询 → 向量检索 → 返回<span class="hljs-attribute">Top</span>-K结果

Rerank增强流程：
查询 → 向量检索 → Rerank重排序 → 返回优化后的<span class="hljs-attribute">Top</span>-K结果
</code></pre>
<h3 data-id="heading-3">1.2 Rerank的核心价值</h3>
<p><strong>1. 提升检索精度</strong></p>
<ul>
<li>传统向量检索：70-80%准确率</li>
<li>加入Rerank后：85-95%准确率</li>
</ul>
<p><strong>2. 减少噪声干扰</strong></p>
<ul>
<li>过滤不相关文档</li>
<li>提升相关文档排名</li>
<li>改善用户体验</li>
</ul>
<p><strong>3. 优化计算效率</strong></p>
<ul>
<li>粗排+精排的两阶段架构</li>
<li>平衡精度和效率</li>
<li>降低计算成本</li>
</ul>
<h3 data-id="heading-4">1.3 Rerank vs 传统检索</h3>



































<table><thead><tr><th>维度</th><th>传统向量检索</th><th>Rerank重排序</th></tr></thead><tbody><tr><td><strong>计算复杂度</strong></td><td>O(n)</td><td>O(k) (k&lt;&lt;n)</td></tr><tr><td><strong>检索精度</strong></td><td>中等</td><td>高</td></tr><tr><td><strong>计算成本</strong></td><td>低</td><td>中等</td></tr><tr><td><strong>适用场景</strong></td><td>大规模检索</td><td>精确检索</td></tr><tr><td><strong>延迟</strong></td><td>低</td><td>中等</td></tr></tbody></table>
<h3 data-id="heading-5">1.4 Rerank的应用场景</h3>
<p><strong>1. 问答系统</strong></p>
<pre><code class="hljs">用户问题：如何优化Python代码性能？
初步检索：返回10个相关文档
Rerank后：重新排序，最相关的排在前面
</code></pre>
<p><strong>2. 文档搜索</strong></p>
<pre><code class="hljs">搜索关键词：机器学习算法
初步检索：返回20个文档
Rerank后：按相关性重新排序
</code></pre>
<p><strong>3. 推荐系统</strong></p>
<pre><code class="hljs">用户偏好：科技类文章
初步检索：返回50篇文章
Rerank后：按用户兴趣度排序
</code></pre>
<hr/>
<h2 data-id="heading-6">二、Rerank算法详解</h2>
<h3 data-id="heading-7">2.1 Cross-Encoder算法</h3>
<h4 data-id="heading-8">2.1.1 算法原理</h4>
<p><strong>Cross-Encoder</strong>是最常用的Rerank算法，它将查询和文档同时输入模型，输出相关性分数。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Cross-Encoder架构</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CrossEncoder</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name</span>):
        self.model = AutoModelForSequenceClassification.from_pretrained(model_name)
        self.tokenizer = AutoTokenizer.from_pretrained(model_name)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents</span>):
        scores = []
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            <span class="hljs-comment"># 将查询和文档拼接</span>
            inputs = self.tokenizer(query, doc, return_tensors=<span class="hljs-string">'pt'</span>, 
                                  truncation=<span class="hljs-literal">True</span>, max_length=<span class="hljs-number">512</span>)
            
            <span class="hljs-comment"># 计算相关性分数</span>
            <span class="hljs-keyword">with</span> torch.no_grad():
                outputs = self.model(**inputs)
                score = torch.sigmoid(outputs.logits).item()
                scores.append(score)
        
        <span class="hljs-keyword">return</span> scores
</code></pre>
<h4 data-id="heading-9">2.1.2 优势与劣势</h4>
<p><strong>优势：</strong></p>
<ul>
<li>精度高：考虑查询和文档的交互</li>
<li>模型简单：易于实现和部署</li>
<li>效果稳定：在各种场景下表现良好</li>
</ul>
<p><strong>劣势：</strong></p>
<ul>
<li>计算成本高：需要逐个计算</li>
<li>无法预计算：每次都需要实时计算</li>
<li>扩展性差：难以处理大量文档</li>
</ul>
<h3 data-id="heading-10">2.2 ColBERT算法</h3>
<h4 data-id="heading-11">2.2.1 算法原理</h4>
<p><strong>ColBERT</strong>使用细粒度的token级交互，平衡了精度和效率。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ColBERT架构</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ColBERT</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name</span>):
        self.model = ColBERTModel.from_pretrained(model_name)
        self.tokenizer = AutoTokenizer.from_pretrained(model_name)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_query</span>(<span class="hljs-params">self, query</span>):
        <span class="hljs-comment"># 编码查询</span>
        query_tokens = self.tokenizer(query, return_tensors=<span class="hljs-string">'pt'</span>)
        query_embeddings = self.model.query(**query_tokens)
        <span class="hljs-keyword">return</span> query_embeddings
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_documents</span>(<span class="hljs-params">self, documents</span>):
        <span class="hljs-comment"># 编码文档</span>
        doc_embeddings = []
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            doc_tokens = self.tokenizer(doc, return_tensors=<span class="hljs-string">'pt'</span>)
            doc_embedding = self.model.doc(**doc_tokens)
            doc_embeddings.append(doc_embedding)
        <span class="hljs-keyword">return</span> doc_embeddings
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query_embeddings, doc_embeddings</span>):
        scores = []
        <span class="hljs-keyword">for</span> doc_embedding <span class="hljs-keyword">in</span> doc_embeddings:
            <span class="hljs-comment"># 计算最大相似度</span>
            max_sim = torch.<span class="hljs-built_in">max</span>(torch.<span class="hljs-built_in">sum</span>(query_embeddings * doc_embedding, dim=-<span class="hljs-number">1</span>))
            scores.append(max_sim.item())
        <span class="hljs-keyword">return</span> scores
</code></pre>
<h4 data-id="heading-12">2.2.2 优势与劣势</h4>
<p><strong>优势：</strong></p>
<ul>
<li>效率高：可以预计算文档嵌入</li>
<li>精度好：细粒度交互</li>
<li>可扩展：支持大规模检索</li>
</ul>
<p><strong>劣势：</strong></p>
<ul>
<li>实现复杂：需要特殊的数据结构</li>
<li>内存占用大：需要存储细粒度嵌入</li>
<li>模型较大：参数量较多</li>
</ul>
<h3 data-id="heading-13">2.3 RAG-Fusion算法</h3>
<h4 data-id="heading-14">2.3.1 算法原理</h4>
<p><strong>RAG-Fusion</strong>结合多个查询的检索结果，通过融合提升检索质量。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># RAG-Fusion架构</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RAGFusion</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, llm_model, rerank_model</span>):
        self.llm = llm_model
        self.reranker = rerank_model
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_queries</span>(<span class="hljs-params">self, original_query, num_queries=<span class="hljs-number">3</span></span>):
        <span class="hljs-comment"># 使用LLM生成多个相关查询</span>
        prompt = <span class="hljs-string">f"""
        基于以下查询，生成<span class="hljs-subst">{num_queries}</span>个相关的查询：
        原始查询：<span class="hljs-subst">{original_query}</span>
        
        要求：
        1. 保持原意不变
        2. 从不同角度表达
        3. 使用同义词和近义词
        """</span>
        
        response = self.llm.generate(prompt)
        queries = self.parse_queries(response)
        <span class="hljs-keyword">return</span> [original_query] + queries
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fusion_rerank</span>(<span class="hljs-params">self, queries, documents</span>):
        all_scores = []
        
        <span class="hljs-keyword">for</span> query <span class="hljs-keyword">in</span> queries:
            <span class="hljs-comment"># 对每个查询进行检索和重排序</span>
            scores = self.reranker.rerank(query, documents)
            all_scores.append(scores)
        
        <span class="hljs-comment"># 融合多个查询的分数</span>
        fusion_scores = self.fusion_scores(all_scores)
        <span class="hljs-keyword">return</span> fusion_scores
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fusion_scores</span>(<span class="hljs-params">self, all_scores</span>):
        <span class="hljs-comment"># 使用加权平均融合分数</span>
        weights = [<span class="hljs-number">0.4</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>]  <span class="hljs-comment"># 原始查询权重更高</span>
        fusion_scores = []
        
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(all_scores[<span class="hljs-number">0</span>])):
            score = <span class="hljs-built_in">sum</span>(scores[i] * weight <span class="hljs-keyword">for</span> scores, weight <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(all_scores, weights))
            fusion_scores.append(score)
        
        <span class="hljs-keyword">return</span> fusion_scores
</code></pre>
<h3 data-id="heading-15">2.4 其他Rerank算法</h3>
<h4 data-id="heading-16">2.4.1 BM25 + Neural Rerank</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># BM25 + Neural Rerank</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BM25NeuralRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, bm25_model, neural_reranker</span>):
        self.bm25 = bm25_model
        self.neural_reranker = neural_reranker
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-comment"># 第一阶段：BM25粗排</span>
        bm25_scores = self.bm25.get_scores(query, documents)
        
        <span class="hljs-comment"># 选择Top-K进行神经重排序</span>
        top_k_indices = np.argsort(bm25_scores)[-<span class="hljs-number">20</span>:]  <span class="hljs-comment"># Top-20</span>
        top_k_docs = [documents[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> top_k_indices]
        
        <span class="hljs-comment"># 第二阶段：神经重排序</span>
        neural_scores = self.neural_reranker.rerank(query, top_k_docs)
        
        <span class="hljs-comment"># 融合分数</span>
        final_scores = []
        <span class="hljs-keyword">for</span> i, doc_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(top_k_indices):
            bm25_score = bm25_scores[doc_idx]
            neural_score = neural_scores[i]
            <span class="hljs-comment"># 加权融合</span>
            final_score = <span class="hljs-number">0.3</span> * bm25_score + <span class="hljs-number">0.7</span> * neural_score
            final_scores.append((doc_idx, final_score))
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sorted</span>(final_scores, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
</code></pre>
<h4 data-id="heading-17">2.4.2 Multi-Stage Rerank</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 多阶段重排序</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiStageRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, stages</span>):
        self.stages = stages  <span class="hljs-comment"># 多个重排序模型</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents</span>):
        current_docs = documents
        current_scores = [<span class="hljs-number">1.0</span>] * <span class="hljs-built_in">len</span>(documents)
        
        <span class="hljs-keyword">for</span> stage <span class="hljs-keyword">in</span> self.stages:
            <span class="hljs-comment"># 每个阶段重新排序</span>
            stage_scores = stage.rerank(query, current_docs)
            
            <span class="hljs-comment"># 更新分数</span>
            current_scores = [s1 * s2 <span class="hljs-keyword">for</span> s1, s2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(current_scores, stage_scores)]
            
            <span class="hljs-comment"># 选择Top-K进入下一阶段</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(current_docs) &gt; <span class="hljs-number">10</span>:
                top_indices = np.argsort(current_scores)[-<span class="hljs-number">10</span>:]
                current_docs = [current_docs[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> top_indices]
                current_scores = [current_scores[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> top_indices]
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(current_docs, current_scores))
</code></pre>
<hr/>
<h2 data-id="heading-18">三、主流Rerank模型对比</h2>
<h3 data-id="heading-19">3.1 模型性能对比</h3>





















































<table><thead><tr><th>模型</th><th>精度</th><th>速度</th><th>内存占用</th><th>适用场景</th><th>开源状态</th></tr></thead><tbody><tr><td><strong>Cross-Encoder</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐</td><td>高精度检索</td><td>✅</td></tr><tr><td><strong>ColBERT</strong></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐</td><td>大规模检索</td><td>✅</td></tr><tr><td><strong>RAG-Fusion</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐</td><td>复杂查询</td><td>✅</td></tr><tr><td><strong>BM25+Neural</strong></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐</td><td>混合检索</td><td>✅</td></tr><tr><td><strong>Multi-Stage</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐</td><td>超高精度</td><td>✅</td></tr></tbody></table>
<h3 data-id="heading-20">3.2 详细模型分析</h3>
<h4 data-id="heading-21">3.2.1 Cross-Encoder模型</h4>
<p><strong>推荐模型：</strong></p>
<ul>
<li><code>cross-encoder/ms-marco-MiniLM-L-6-v2</code></li>
<li><code>cross-encoder/ms-marco-MiniLM-L-12-v2</code></li>
<li><code>cross-encoder/nli-deberta-v3-base</code></li>
</ul>
<p><strong>性能特点：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 性能测试</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">benchmark_cross_encoder</span>():
    model = CrossEncoder(<span class="hljs-string">'cross-encoder/ms-marco-MiniLM-L-6-v2'</span>)
    
    <span class="hljs-comment"># 测试数据</span>
    queries = [<span class="hljs-string">"机器学习算法"</span>, <span class="hljs-string">"深度学习应用"</span>, <span class="hljs-string">"自然语言处理"</span>]
    documents = [<span class="hljs-string">"文档1"</span>, <span class="hljs-string">"文档2"</span>, <span class="hljs-string">"文档3"</span>, <span class="hljs-string">"文档4"</span>, <span class="hljs-string">"文档5"</span>]
    
    start_time = time.time()
    scores = model.rerank(queries[<span class="hljs-number">0</span>], documents)
    end_time = time.time()
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"处理时间: <span class="hljs-subst">{end_time - start_time:<span class="hljs-number">.2</span>f}</span>秒"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"平均每文档: <span class="hljs-subst">{(end_time - start_time) / <span class="hljs-built_in">len</span>(documents):<span class="hljs-number">.3</span>f}</span>秒"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"排序结果: <span class="hljs-subst">{scores}</span>"</span>)
</code></pre>
<h4 data-id="heading-22">3.2.2 ColBERT模型</h4>
<p><strong>推荐模型：</strong></p>
<ul>
<li><code>colbert-ir/colbertv2.0</code></li>
<li><code>colbert-ir/colbertv1.0</code></li>
</ul>
<p><strong>性能特点：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ColBERT性能测试</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">benchmark_colbert</span>():
    model = ColBERT(<span class="hljs-string">'colbert-ir/colbertv2.0'</span>)
    
    <span class="hljs-comment"># 预计算文档嵌入</span>
    documents = [<span class="hljs-string">"文档1"</span>, <span class="hljs-string">"文档2"</span>, <span class="hljs-string">"文档3"</span>, <span class="hljs-string">"文档4"</span>, <span class="hljs-string">"文档5"</span>]
    doc_embeddings = model.encode_documents(documents)
    
    <span class="hljs-comment"># 查询编码和重排序</span>
    query = <span class="hljs-string">"机器学习算法"</span>
    query_embedding = model.encode_query(query)
    
    start_time = time.time()
    scores = model.rerank(query_embedding, doc_embeddings)
    end_time = time.time()
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"重排序时间: <span class="hljs-subst">{end_time - start_time:<span class="hljs-number">.2</span>f}</span>秒"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"排序结果: <span class="hljs-subst">{scores}</span>"</span>)
</code></pre>
<h4 data-id="heading-23">3.2.3 自定义Rerank模型</h4>
<p><strong>训练自定义模型：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 训练自定义Cross-Encoder</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomCrossEncoderTrainer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name, num_labels=<span class="hljs-number">2</span></span>):
        self.model = AutoModelForSequenceClassification.from_pretrained(
            model_name, num_labels=num_labels
        )
        self.tokenizer = AutoTokenizer.from_pretrained(model_name)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">prepare_dataset</span>(<span class="hljs-params">self, data</span>):
        <span class="hljs-comment"># 准备训练数据</span>
        dataset = []
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> data:
            query = item[<span class="hljs-string">'query'</span>]
            doc = item[<span class="hljs-string">'document'</span>]
            label = item[<span class="hljs-string">'label'</span>]  <span class="hljs-comment"># 0: 不相关, 1: 相关</span>
            
            inputs = self.tokenizer(query, doc, return_tensors=<span class="hljs-string">'pt'</span>,
                                  truncation=<span class="hljs-literal">True</span>, max_length=<span class="hljs-number">512</span>)
            dataset.append({
                <span class="hljs-string">'input_ids'</span>: inputs[<span class="hljs-string">'input_ids'</span>],
                <span class="hljs-string">'attention_mask'</span>: inputs[<span class="hljs-string">'attention_mask'</span>],
                <span class="hljs-string">'labels'</span>: torch.tensor([label])
            })
        
        <span class="hljs-keyword">return</span> dataset
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">train</span>(<span class="hljs-params">self, train_dataset, val_dataset, epochs=<span class="hljs-number">3</span></span>):
        <span class="hljs-comment"># 训练模型</span>
        training_args = TrainingArguments(
            output_dir=<span class="hljs-string">'./rerank_model'</span>,
            num_train_epochs=epochs,
            per_device_train_batch_size=<span class="hljs-number">16</span>,
            per_device_eval_batch_size=<span class="hljs-number">16</span>,
            warmup_steps=<span class="hljs-number">500</span>,
            weight_decay=<span class="hljs-number">0.01</span>,
            logging_dir=<span class="hljs-string">'./logs'</span>,
        )
        
        trainer = Trainer(
            model=self.model,
            args=training_args,
            train_dataset=train_dataset,
            eval_dataset=val_dataset,
        )
        
        trainer.train()
        <span class="hljs-keyword">return</span> trainer
</code></pre>
<hr/>
<h2 data-id="heading-24">四、Rerank在RAG中的应用</h2>
<h3 data-id="heading-25">4.1 RAG系统架构</h3>
<h4 data-id="heading-26">4.1.1 传统RAG架构</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 传统RAG系统</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TraditionalRAG</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, embedding_model, llm_model</span>):
        self.embedding_model = embedding_model
        self.llm_model = llm_model
        self.vector_store = <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">retrieve</span>(<span class="hljs-params">self, query, top_k=<span class="hljs-number">5</span></span>):
        <span class="hljs-comment"># 向量检索</span>
        query_embedding = self.embedding_model.encode(query)
        results = self.vector_store.similarity_search(
            query_embedding, k=top_k
        )
        <span class="hljs-keyword">return</span> results
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">self, query, retrieved_docs</span>):
        <span class="hljs-comment"># 生成回答</span>
        context = <span class="hljs-string">"\n"</span>.join([doc.page_content <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> retrieved_docs])
        prompt = <span class="hljs-string">f"基于以下上下文回答问题：\n<span class="hljs-subst">{context}</span>\n\n问题：<span class="hljs-subst">{query}</span>"</span>
        
        response = self.llm_model.generate(prompt)
        <span class="hljs-keyword">return</span> response
</code></pre>
<h4 data-id="heading-27">4.1.2 Rerank增强的RAG架构</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Rerank增强的RAG系统</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RerankEnhancedRAG</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, embedding_model, llm_model, rerank_model</span>):
        self.embedding_model = embedding_model
        self.llm_model = llm_model
        self.rerank_model = rerank_model
        self.vector_store = <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">retrieve_and_rerank</span>(<span class="hljs-params">self, query, top_k=<span class="hljs-number">20</span>, final_k=<span class="hljs-number">5</span></span>):
        <span class="hljs-comment"># 第一阶段：向量检索（获取更多候选）</span>
        query_embedding = self.embedding_model.encode(query)
        candidates = self.vector_store.similarity_search(
            query_embedding, k=top_k
        )
        
        <span class="hljs-comment"># 第二阶段：Rerank重排序</span>
        documents = [doc.page_content <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> candidates]
        scores = self.rerank_model.rerank(query, documents)
        
        <span class="hljs-comment"># 选择Top-K结果</span>
        ranked_results = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(candidates, scores))
        ranked_results.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
        
        <span class="hljs-keyword">return</span> ranked_results[:final_k]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">self, query, ranked_docs</span>):
        <span class="hljs-comment"># 使用重排序后的文档生成回答</span>
        context = <span class="hljs-string">"\n"</span>.join([doc.page_content <span class="hljs-keyword">for</span> doc, score <span class="hljs-keyword">in</span> ranked_docs])
        prompt = <span class="hljs-string">f"基于以下上下文回答问题：\n<span class="hljs-subst">{context}</span>\n\n问题：<span class="hljs-subst">{query}</span>"</span>
        
        response = self.llm_model.generate(prompt)
        <span class="hljs-keyword">return</span> response
</code></pre>
<h3 data-id="heading-28">4.2 Rerank策略选择</h3>
<h4 data-id="heading-29">4.2.1 基于查询复杂度的策略</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 自适应Rerank策略</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AdaptiveRerankStrategy</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, simple_reranker, complex_reranker</span>):
        self.simple_reranker = simple_reranker
        self.complex_reranker = complex_reranker
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_query_complexity</span>(<span class="hljs-params">self, query</span>):
        <span class="hljs-comment"># 分析查询复杂度</span>
        complexity_score = <span class="hljs-number">0</span>
        
        <span class="hljs-comment"># 长度因子</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(query.split()) &gt; <span class="hljs-number">10</span>:
            complexity_score += <span class="hljs-number">1</span>
        
        <span class="hljs-comment"># 关键词数量</span>
        technical_terms = [<span class="hljs-string">'算法'</span>, <span class="hljs-string">'模型'</span>, <span class="hljs-string">'优化'</span>, <span class="hljs-string">'性能'</span>, <span class="hljs-string">'架构'</span>]
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> term <span class="hljs-keyword">in</span> technical_terms <span class="hljs-keyword">if</span> term <span class="hljs-keyword">in</span> query) &gt; <span class="hljs-number">2</span>:
            complexity_score += <span class="hljs-number">1</span>
        
        <span class="hljs-comment"># 问句类型</span>
        <span class="hljs-keyword">if</span> query.endswith(<span class="hljs-string">'?'</span>) <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(query.split()) &gt; <span class="hljs-number">5</span>:
            complexity_score += <span class="hljs-number">1</span>
        
        <span class="hljs-keyword">return</span> complexity_score
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">select_reranker</span>(<span class="hljs-params">self, query</span>):
        complexity = self.analyze_query_complexity(query)
        
        <span class="hljs-keyword">if</span> complexity &lt;= <span class="hljs-number">1</span>:
            <span class="hljs-keyword">return</span> self.simple_reranker
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> self.complex_reranker
</code></pre>
<h4 data-id="heading-30">4.2.2 基于文档类型的策略</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 文档类型感知的Rerank</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DocumentTypeAwareRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, code_reranker, text_reranker, table_reranker</span>):
        self.code_reranker = code_reranker
        self.text_reranker = text_reranker
        self.table_reranker = table_reranker
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">detect_document_type</span>(<span class="hljs-params">self, document</span>):
        <span class="hljs-comment"># 检测文档类型</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'```'</span> <span class="hljs-keyword">in</span> document <span class="hljs-keyword">or</span> <span class="hljs-string">'def '</span> <span class="hljs-keyword">in</span> document <span class="hljs-keyword">or</span> <span class="hljs-string">'class '</span> <span class="hljs-keyword">in</span> document:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'code'</span>
        <span class="hljs-keyword">elif</span> <span class="hljs-string">'|'</span> <span class="hljs-keyword">in</span> document <span class="hljs-keyword">and</span> <span class="hljs-string">'\n'</span> <span class="hljs-keyword">in</span> document:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'table'</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'text'</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank_by_type</span>(<span class="hljs-params">self, query, documents</span>):
        results = []
        
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            doc_type = self.detect_document_type(doc)
            
            <span class="hljs-keyword">if</span> doc_type == <span class="hljs-string">'code'</span>:
                score = self.code_reranker.rerank(query, [doc])[<span class="hljs-number">0</span>]
            <span class="hljs-keyword">elif</span> doc_type == <span class="hljs-string">'table'</span>:
                score = self.table_reranker.rerank(query, [doc])[<span class="hljs-number">0</span>]
            <span class="hljs-keyword">else</span>:
                score = self.text_reranker.rerank(query, [doc])[<span class="hljs-number">0</span>]
            
            results.append((doc, score))
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sorted</span>(results, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
</code></pre>
<h3 data-id="heading-31">4.3 多模态Rerank</h3>
<h4 data-id="heading-32">4.3.1 文本+图像Rerank</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 多模态Rerank</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MultimodalRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, text_reranker, image_reranker, fusion_weight=<span class="hljs-number">0.7</span></span>):
        self.text_reranker = text_reranker
        self.image_reranker = image_reranker
        self.fusion_weight = fusion_weight
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank_multimodal</span>(<span class="hljs-params">self, query, documents</span>):
        results = []
        
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            <span class="hljs-comment"># 文本重排序</span>
            text_score = self.text_reranker.rerank(query, [doc.text])[<span class="hljs-number">0</span>]
            
            <span class="hljs-comment"># 图像重排序（如果有图像）</span>
            image_score = <span class="hljs-number">0</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(doc, <span class="hljs-string">'image'</span>) <span class="hljs-keyword">and</span> doc.image:
                image_score = self.image_reranker.rerank(query, [doc.image])[<span class="hljs-number">0</span>]
            
            <span class="hljs-comment"># 融合分数</span>
            <span class="hljs-keyword">if</span> image_score &gt; <span class="hljs-number">0</span>:
                final_score = (self.fusion_weight * text_score + 
                             (<span class="hljs-number">1</span> - self.fusion_weight) * image_score)
            <span class="hljs-keyword">else</span>:
                final_score = text_score
            
            results.append((doc, final_score))
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sorted</span>(results, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
</code></pre>
<hr/>
<h2 data-id="heading-33">五、Python实战：构建Rerank系统</h2>
<h3 data-id="heading-34">5.1 基础Rerank实现</h3>
<h4 data-id="heading-35">5.1.1 Cross-Encoder实现</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForSequenceClassification
<span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> CrossEncoder
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleCrossEncoderRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name=<span class="hljs-string">'cross-encoder/ms-marco-MiniLM-L-6-v2'</span></span>):
        self.model = CrossEncoder(model_name)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents, top_k=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""
        对文档进行重排序
        
        Args:
            query: 查询文本
            documents: 文档列表
            top_k: 返回前k个结果，None表示返回全部
        
        Returns:
            排序后的(文档, 分数)列表
        """</span>
        <span class="hljs-comment"># 计算相关性分数</span>
        pairs = [(query, doc) <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents]
        scores = self.model.predict(pairs)
        
        <span class="hljs-comment"># 排序</span>
        results = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(documents, scores))
        results.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
        
        <span class="hljs-keyword">if</span> top_k:
            <span class="hljs-keyword">return</span> results[:top_k]
        <span class="hljs-keyword">return</span> results

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_cross_encoder</span>():
    reranker = SimpleCrossEncoderRerank()
    
    query = <span class="hljs-string">"如何优化Python代码性能"</span>
    documents = [
        <span class="hljs-string">"Python性能优化技巧包括使用列表推导式、避免全局变量等"</span>,
        <span class="hljs-string">"机器学习算法在数据科学中的应用"</span>,
        <span class="hljs-string">"Python代码优化：使用numpy和pandas提升计算效率"</span>,
        <span class="hljs-string">"深度学习模型训练的最佳实践"</span>,
        <span class="hljs-string">"Python异步编程和并发处理"</span>
    ]
    
    results = reranker.rerank(query, documents, top_k=<span class="hljs-number">3</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"重排序结果："</span>)
    <span class="hljs-keyword">for</span> i, (doc, score) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(results, <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>. 分数: <span class="hljs-subst">{score:<span class="hljs-number">.4</span>f}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   文档: <span class="hljs-subst">{doc}</span>"</span>)
        <span class="hljs-built_in">print</span>()
</code></pre>
<h4 data-id="heading-36">5.1.2 ColBERT实现</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleColBERTRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name=<span class="hljs-string">'sentence-transformers/all-MiniLM-L6-v2'</span></span>):
        self.model = SentenceTransformer(model_name)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_query</span>(<span class="hljs-params">self, query</span>):
        <span class="hljs-string">"""编码查询"""</span>
        <span class="hljs-keyword">return</span> self.model.encode([query])[<span class="hljs-number">0</span>]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_documents</span>(<span class="hljs-params">self, documents</span>):
        <span class="hljs-string">"""编码文档"""</span>
        <span class="hljs-keyword">return</span> self.model.encode(documents)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents, top_k=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""
        使用ColBERT风格的重排序
        """</span>
        <span class="hljs-comment"># 编码查询和文档</span>
        query_embedding = self.encode_query(query)
        doc_embeddings = self.encode_documents(documents)
        
        <span class="hljs-comment"># 计算相似度分数</span>
        scores = []
        <span class="hljs-keyword">for</span> doc_embedding <span class="hljs-keyword">in</span> doc_embeddings:
            <span class="hljs-comment"># 计算最大相似度（ColBERT风格）</span>
            similarities = np.dot(query_embedding, doc_embedding.T)
            max_similarity = np.<span class="hljs-built_in">max</span>(similarities)
            scores.append(max_similarity)
        
        <span class="hljs-comment"># 排序</span>
        results = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(documents, scores))
        results.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
        
        <span class="hljs-keyword">if</span> top_k:
            <span class="hljs-keyword">return</span> results[:top_k]
        <span class="hljs-keyword">return</span> results

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_colbert</span>():
    reranker = SimpleColBERTRerank()
    
    query = <span class="hljs-string">"机器学习算法选择"</span>
    documents = [
        <span class="hljs-string">"监督学习算法包括线性回归、决策树、随机森林等"</span>,
        <span class="hljs-string">"无监督学习主要用于聚类和降维"</span>,
        <span class="hljs-string">"深度学习是机器学习的一个分支"</span>,
        <span class="hljs-string">"强化学习通过与环境交互学习最优策略"</span>
    ]
    
    results = reranker.rerank(query, documents, top_k=<span class="hljs-number">2</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ColBERT重排序结果："</span>)
    <span class="hljs-keyword">for</span> i, (doc, score) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(results, <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>. 分数: <span class="hljs-subst">{score:<span class="hljs-number">.4</span>f}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   文档: <span class="hljs-subst">{doc}</span>"</span>)
        <span class="hljs-built_in">print</span>()
</code></pre>
<h3 data-id="heading-37">5.2 高级Rerank实现</h3>
<h4 data-id="heading-38">5.2.1 多阶段Rerank</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiStageRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, stages</span>):
        <span class="hljs-string">"""
        多阶段重排序
        
        Args:
            stages: 重排序阶段列表，每个阶段是一个reranker
        """</span>
        self.stages = stages
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents, top_k=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""
        多阶段重排序
        """</span>
        current_docs = documents
        current_scores = [<span class="hljs-number">1.0</span>] * <span class="hljs-built_in">len</span>(documents)
        
        <span class="hljs-keyword">for</span> stage_idx, stage <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.stages):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"执行第<span class="hljs-subst">{stage_idx + <span class="hljs-number">1</span>}</span>阶段重排序..."</span>)
            
            <span class="hljs-comment"># 当前阶段重排序</span>
            stage_scores = []
            <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> current_docs:
                score = stage.rerank(query, [doc])[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]
                stage_scores.append(score)
            
            <span class="hljs-comment"># 更新累积分数</span>
            current_scores = [s1 * s2 <span class="hljs-keyword">for</span> s1, s2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(current_scores, stage_scores)]
            
            <span class="hljs-comment"># 选择Top-K进入下一阶段</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(current_docs) &gt; <span class="hljs-number">10</span> <span class="hljs-keyword">and</span> stage_idx &lt; <span class="hljs-built_in">len</span>(self.stages) - <span class="hljs-number">1</span>:
                top_indices = np.argsort(current_scores)[-<span class="hljs-number">10</span>:]
                current_docs = [current_docs[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> top_indices]
                current_scores = [current_scores[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> top_indices]
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"第<span class="hljs-subst">{stage_idx + <span class="hljs-number">1</span>}</span>阶段后保留Top-10"</span>)
        
        <span class="hljs-comment"># 最终排序</span>
        results = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(current_docs, current_scores))
        results.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
        
        <span class="hljs-keyword">if</span> top_k:
            <span class="hljs-keyword">return</span> results[:top_k]
        <span class="hljs-keyword">return</span> results

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_multi_stage</span>():
    <span class="hljs-comment"># 创建多个重排序阶段</span>
    stage1 = SimpleCrossEncoderRerank(<span class="hljs-string">'cross-encoder/ms-marco-MiniLM-L-6-v2'</span>)
    stage2 = SimpleColBERTRerank(<span class="hljs-string">'sentence-transformers/all-MiniLM-L6-v2'</span>)
    
    multi_rerank = MultiStageRerank([stage1, stage2])
    
    query = <span class="hljs-string">"Python异步编程最佳实践"</span>
    documents = [
        <span class="hljs-string">"Python asyncio库提供了异步编程的基础设施"</span>,
        <span class="hljs-string">"异步编程可以提高I/O密集型应用的性能"</span>,
        <span class="hljs-string">"机器学习模型训练需要大量计算资源"</span>,
        <span class="hljs-string">"使用async/await语法可以简化异步代码"</span>,
        <span class="hljs-string">"异步编程在处理网络请求时特别有用"</span>
    ]
    
    results = multi_rerank.rerank(query, documents, top_k=<span class="hljs-number">3</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"多阶段重排序结果："</span>)
    <span class="hljs-keyword">for</span> i, (doc, score) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(results, <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>. 分数: <span class="hljs-subst">{score:<span class="hljs-number">.6</span>f}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   文档: <span class="hljs-subst">{doc}</span>"</span>)
        <span class="hljs-built_in">print</span>()
</code></pre>
<h4 data-id="heading-39">5.2.2 自适应Rerank</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AdaptiveRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, rerankers</span>):
        <span class="hljs-string">"""
        自适应重排序
        
        Args:
            rerankers: 重排序器字典，key为条件，value为reranker
        """</span>
        self.rerankers = rerankers
        self.default_reranker = <span class="hljs-built_in">list</span>(rerankers.values())[<span class="hljs-number">0</span>]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">select_reranker</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-string">"""
        根据查询和文档特征选择重排序器
        """</span>
        <span class="hljs-comment"># 查询长度</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(query.split()) &gt; <span class="hljs-number">15</span>:
            <span class="hljs-keyword">return</span> self.rerankers.get(<span class="hljs-string">'long_query'</span>, self.default_reranker)
        
        <span class="hljs-comment"># 文档数量</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(documents) &gt; <span class="hljs-number">50</span>:
            <span class="hljs-keyword">return</span> self.rerankers.get(<span class="hljs-string">'large_docs'</span>, self.default_reranker)
        
        <span class="hljs-comment"># 技术术语</span>
        tech_terms = [<span class="hljs-string">'算法'</span>, <span class="hljs-string">'模型'</span>, <span class="hljs-string">'优化'</span>, <span class="hljs-string">'性能'</span>, <span class="hljs-string">'架构'</span>, <span class="hljs-string">'系统'</span>]
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> term <span class="hljs-keyword">in</span> tech_terms <span class="hljs-keyword">if</span> term <span class="hljs-keyword">in</span> query) &gt; <span class="hljs-number">2</span>:
            <span class="hljs-keyword">return</span> self.rerankers.get(<span class="hljs-string">'technical'</span>, self.default_reranker)
        
        <span class="hljs-keyword">return</span> self.default_reranker
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents, top_k=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""
        自适应重排序
        """</span>
        <span class="hljs-comment"># 选择重排序器</span>
        selected_reranker = self.select_reranker(query, documents)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"选择重排序器: <span class="hljs-subst">{<span class="hljs-built_in">type</span>(selected_reranker).__name__}</span>"</span>)
        
        <span class="hljs-comment"># 执行重排序</span>
        <span class="hljs-keyword">return</span> selected_reranker.rerank(query, documents, top_k)

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_adaptive</span>():
    <span class="hljs-comment"># 创建不同的重排序器</span>
    rerankers = {
        <span class="hljs-string">'long_query'</span>: SimpleCrossEncoderRerank(<span class="hljs-string">'cross-encoder/ms-marco-MiniLM-L-12-v2'</span>),
        <span class="hljs-string">'large_docs'</span>: SimpleColBERTRerank(<span class="hljs-string">'sentence-transformers/all-MiniLM-L6-v2'</span>),
        <span class="hljs-string">'technical'</span>: SimpleCrossEncoderRerank(<span class="hljs-string">'cross-encoder/nli-deberta-v3-base'</span>),
        <span class="hljs-string">'default'</span>: SimpleCrossEncoderRerank(<span class="hljs-string">'cross-encoder/ms-marco-MiniLM-L-6-v2'</span>)
    }
    
    adaptive_rerank = AdaptiveRerank(rerankers)
    
    <span class="hljs-comment"># 测试不同场景</span>
    test_cases = [
        {
            <span class="hljs-string">'query'</span>: <span class="hljs-string">'如何优化深度学习模型的训练速度和准确性'</span>,
            <span class="hljs-string">'docs'</span>: [<span class="hljs-string">'深度学习优化技巧'</span>, <span class="hljs-string">'模型训练最佳实践'</span>, <span class="hljs-string">'性能调优方法'</span>]
        },
        {
            <span class="hljs-string">'query'</span>: <span class="hljs-string">'Python'</span>,
            <span class="hljs-string">'docs'</span>: [<span class="hljs-string">'Python基础语法'</span>, <span class="hljs-string">'Python高级特性'</span>, <span class="hljs-string">'Python应用开发'</span>] * <span class="hljs-number">20</span>
        }
    ]
    
    <span class="hljs-keyword">for</span> i, <span class="hljs-keyword">case</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(test_cases, <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n测试案例 <span class="hljs-subst">{i}</span>:"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"查询: <span class="hljs-subst">{<span class="hljs-keyword">case</span>[<span class="hljs-string">'query'</span>]}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"文档数量: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(<span class="hljs-keyword">case</span>[<span class="hljs-string">'docs'</span>])}</span>"</span>)
        
        results = adaptive_rerank.rerank(<span class="hljs-keyword">case</span>[<span class="hljs-string">'query'</span>], <span class="hljs-keyword">case</span>[<span class="hljs-string">'docs'</span>], top_k=<span class="hljs-number">3</span>)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"重排序结果："</span>)
        <span class="hljs-keyword">for</span> j, (doc, score) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(results, <span class="hljs-number">1</span>):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{j}</span>. 分数: <span class="hljs-subst">{score:<span class="hljs-number">.4</span>f}</span> - <span class="hljs-subst">{doc}</span>"</span>)
</code></pre>
<h3 data-id="heading-40">5.3 完整RAG系统集成</h3>
<h4 data-id="heading-41">5.3.1 RAG with Rerank系统</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer
<span class="hljs-keyword">import</span> faiss
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RAGWithRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, embedding_model_name, rerank_model_name, llm_model=<span class="hljs-literal">None</span></span>):
        <span class="hljs-comment"># 初始化组件</span>
        self.embedding_model = SentenceTransformer(embedding_model_name)
        self.reranker = SimpleCrossEncoderRerank(rerank_model_name)
        self.llm_model = llm_model
        
        <span class="hljs-comment"># 向量存储</span>
        self.vector_store = <span class="hljs-literal">None</span>
        self.documents = []
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_documents</span>(<span class="hljs-params">self, documents</span>):
        <span class="hljs-string">"""
        添加文档到向量存储
        """</span>
        self.documents.extend(documents)
        
        <span class="hljs-comment"># 生成嵌入</span>
        embeddings = self.embedding_model.encode(documents)
        
        <span class="hljs-comment"># 创建FAISS索引</span>
        dimension = embeddings.shape[<span class="hljs-number">1</span>]
        index = faiss.IndexFlatIP(dimension)  <span class="hljs-comment"># 内积索引</span>
        
        <span class="hljs-comment"># 归一化嵌入（用于余弦相似度）</span>
        faiss.normalize_L2(embeddings)
        index.add(embeddings)
        
        self.vector_store = index
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">retrieve_and_rerank</span>(<span class="hljs-params">self, query, top_k=<span class="hljs-number">20</span>, final_k=<span class="hljs-number">5</span></span>):
        <span class="hljs-string">"""
        检索和重排序
        """</span>
        <span class="hljs-comment"># 第一阶段：向量检索</span>
        query_embedding = self.embedding_model.encode([query])
        faiss.normalize_L2(query_embedding)
        
        scores, indices = self.vector_store.search(query_embedding, top_k)
        
        <span class="hljs-comment"># 获取候选文档</span>
        candidates = [self.documents[idx] <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> indices[<span class="hljs-number">0</span>]]
        
        <span class="hljs-comment"># 第二阶段：重排序</span>
        rerank_results = self.reranker.rerank(query, candidates, top_k=final_k)
        
        <span class="hljs-keyword">return</span> rerank_results
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_answer</span>(<span class="hljs-params">self, query, retrieved_docs</span>):
        <span class="hljs-string">"""
        生成回答
        """</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.llm_model:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"LLM模型未配置"</span>
        
        <span class="hljs-comment"># 构建上下文</span>
        context = <span class="hljs-string">"\n"</span>.join([doc <span class="hljs-keyword">for</span> doc, score <span class="hljs-keyword">in</span> retrieved_docs])
        
        <span class="hljs-comment"># 生成回答</span>
        prompt = <span class="hljs-string">f"""
        基于以下上下文回答问题：
        
        上下文：
        <span class="hljs-subst">{context}</span>
        
        问题：<span class="hljs-subst">{query}</span>
        
        请提供准确、简洁的回答：
        """</span>
        
        <span class="hljs-comment"># 这里应该调用实际的LLM</span>
        <span class="hljs-comment"># response = self.llm_model.generate(prompt)</span>
        response = <span class="hljs-string">f"基于检索到的<span class="hljs-subst">{<span class="hljs-built_in">len</span>(retrieved_docs)}</span>个相关文档，回答：<span class="hljs-subst">{query}</span>"</span>
        
        <span class="hljs-keyword">return</span> response
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">self, query, top_k=<span class="hljs-number">20</span>, final_k=<span class="hljs-number">5</span></span>):
        <span class="hljs-string">"""
        完整的查询流程
        """</span>
        <span class="hljs-comment"># 检索和重排序</span>
        retrieved_docs = self.retrieve_and_rerank(query, top_k, final_k)
        
        <span class="hljs-comment"># 生成回答</span>
        answer = self.generate_answer(query, retrieved_docs)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'answer'</span>: answer,
            <span class="hljs-string">'retrieved_docs'</span>: retrieved_docs,
            <span class="hljs-string">'query'</span>: query
        }

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_rag_with_rerank</span>():
    <span class="hljs-comment"># 初始化RAG系统</span>
    rag = RAGWithRerank(
        embedding_model_name=<span class="hljs-string">'sentence-transformers/all-MiniLM-L6-v2'</span>,
        rerank_model_name=<span class="hljs-string">'cross-encoder/ms-marco-MiniLM-L-6-v2'</span>
    )
    
    <span class="hljs-comment"># 添加文档</span>
    documents = [
        <span class="hljs-string">"Python是一种高级编程语言，具有简洁的语法和强大的功能"</span>,
        <span class="hljs-string">"机器学习是人工智能的一个分支，通过算法让计算机学习"</span>,
        <span class="hljs-string">"深度学习使用神经网络来模拟人脑的学习过程"</span>,
        <span class="hljs-string">"自然语言处理是计算机科学和人工智能的交叉领域"</span>,
        <span class="hljs-string">"计算机视觉让计算机能够理解和分析图像和视频"</span>,
        <span class="hljs-string">"数据科学结合统计学、计算机科学和领域专业知识"</span>,
        <span class="hljs-string">"云计算提供了按需访问计算资源的服务模式"</span>,
        <span class="hljs-string">"区块链是一种分布式账本技术，具有去中心化特点"</span>
    ]
    
    rag.add_documents(documents)
    
    <span class="hljs-comment"># 查询</span>
    query = <span class="hljs-string">"什么是机器学习"</span>
    result = rag.query(query)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"查询: <span class="hljs-subst">{result[<span class="hljs-string">'query'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"回答: <span class="hljs-subst">{result[<span class="hljs-string">'answer'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n检索到的相关文档:"</span>)
    <span class="hljs-keyword">for</span> i, (doc, score) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(result[<span class="hljs-string">'retrieved_docs'</span>], <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>. 分数: <span class="hljs-subst">{score:<span class="hljs-number">.4</span>f}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   文档: <span class="hljs-subst">{doc}</span>"</span>)
        <span class="hljs-built_in">print</span>()
</code></pre>
<hr/>
<h2 data-id="heading-42">六、性能优化和最佳实践</h2>
<h3 data-id="heading-43">6.1 性能优化策略</h3>
<h4 data-id="heading-44">6.1.1 计算优化</h4>
<p><strong>批处理优化：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name, batch_size=<span class="hljs-number">32</span></span>):
        self.model = CrossEncoder(model_name)
        self.batch_size = batch_size
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank_batch</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-string">"""
        批量重排序优化
        """</span>
        results = []
        
        <span class="hljs-comment"># 分批处理</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(documents), self.batch_size):
            batch_docs = documents[i:i + self.batch_size]
            batch_pairs = [(query, doc) <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> batch_docs]
            
            <span class="hljs-comment"># 批量预测</span>
            batch_scores = self.model.predict(batch_pairs)
            
            <span class="hljs-comment"># 添加结果</span>
            <span class="hljs-keyword">for</span> doc, score <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(batch_docs, batch_scores):
                results.append((doc, score))
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sorted</span>(results, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
</code></pre>
<p><strong>缓存优化：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CachedRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, reranker, cache_size=<span class="hljs-number">1000</span></span>):
        self.reranker = reranker
        self.cache_size = cache_size
        self.cache = {}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_cache_key</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-string">"""生成缓存键"""</span>
        content = <span class="hljs-string">f"<span class="hljs-subst">{query}</span>|||<span class="hljs-subst">{hashlib.md5(<span class="hljs-built_in">str</span>(documents).encode()).hexdigest()}</span>"</span>
        <span class="hljs-keyword">return</span> hashlib.md5(content.encode()).hexdigest()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-string">"""
        带缓存的重排序
        """</span>
        cache_key = self._get_cache_key(query, documents)
        
        <span class="hljs-comment"># 检查缓存</span>
        <span class="hljs-keyword">if</span> cache_key <span class="hljs-keyword">in</span> self.cache:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"使用缓存结果"</span>)
            <span class="hljs-keyword">return</span> self.cache[cache_key]
        
        <span class="hljs-comment"># 执行重排序</span>
        results = self.reranker.rerank(query, documents)
        
        <span class="hljs-comment"># 更新缓存</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.cache) &lt; self.cache_size:
            self.cache[cache_key] = results
        
        <span class="hljs-keyword">return</span> results
</code></pre>
<h4 data-id="heading-45">6.1.2 内存优化</h4>
<p><strong>模型量化：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForSequenceClassification

<span class="hljs-keyword">class</span> <span class="hljs-title class_">QuantizedRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name</span>):
        self.tokenizer = AutoTokenizer.from_pretrained(model_name)
        self.model = AutoModelForSequenceClassification.from_pretrained(model_name)
        
        <span class="hljs-comment"># 量化模型</span>
        self.model = torch.quantization.quantize_dynamic(
            self.model, {torch.nn.Linear}, dtype=torch.qint8
        )
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-string">"""
        使用量化模型重排序
        """</span>
        scores = []
        
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            inputs = self.tokenizer(query, doc, return_tensors=<span class="hljs-string">'pt'</span>,
                                  truncation=<span class="hljs-literal">True</span>, max_length=<span class="hljs-number">512</span>)
            
            <span class="hljs-keyword">with</span> torch.no_grad():
                outputs = self.model(**inputs)
                score = torch.sigmoid(outputs.logits).item()
                scores.append(score)
        
        results = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(documents, scores))
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sorted</span>(results, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
</code></pre>
<h3 data-id="heading-46">6.2 最佳实践</h3>
<h4 data-id="heading-47">6.2.1 模型选择策略</h4>
<p><strong>基于数据量的选择：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">select_rerank_model</span>(<span class="hljs-params">data_size, latency_requirement</span>):
    <span class="hljs-string">"""
    根据数据量和延迟要求选择重排序模型
    """</span>
    <span class="hljs-keyword">if</span> data_size &lt; <span class="hljs-number">1000</span> <span class="hljs-keyword">and</span> latency_requirement &lt; <span class="hljs-number">100</span>:  <span class="hljs-comment"># ms</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"cross-encoder/ms-marco-MiniLM-L-6-v2"</span>
    <span class="hljs-keyword">elif</span> data_size &lt; <span class="hljs-number">10000</span> <span class="hljs-keyword">and</span> latency_requirement &lt; <span class="hljs-number">500</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"cross-encoder/ms-marco-MiniLM-L-12-v2"</span>
    <span class="hljs-keyword">elif</span> data_size &gt;= <span class="hljs-number">10000</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"colbert-ir/colbertv2.0"</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"cross-encoder/nli-deberta-v3-base"</span>
</code></pre>
<p><strong>基于查询类型的选择：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">select_rerank_by_query_type</span>(<span class="hljs-params">query</span>):
    <span class="hljs-string">"""
    根据查询类型选择重排序模型
    """</span>
    <span class="hljs-comment"># 技术查询</span>
    tech_keywords = [<span class="hljs-string">'算法'</span>, <span class="hljs-string">'模型'</span>, <span class="hljs-string">'优化'</span>, <span class="hljs-string">'性能'</span>, <span class="hljs-string">'架构'</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(keyword <span class="hljs-keyword">in</span> query <span class="hljs-keyword">for</span> keyword <span class="hljs-keyword">in</span> tech_keywords):
        <span class="hljs-keyword">return</span> <span class="hljs-string">"cross-encoder/nli-deberta-v3-base"</span>
    
    <span class="hljs-comment"># 长查询</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(query.split()) &gt; <span class="hljs-number">15</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"cross-encoder/ms-marco-MiniLM-L-12-v2"</span>
    
    <span class="hljs-comment"># 短查询</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"cross-encoder/ms-marco-MiniLM-L-6-v2"</span>
</code></pre>
<h4 data-id="heading-48">6.2.2 参数调优</h4>
<p><strong>阈值调优：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThresholdTuner</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, reranker</span>):
        self.reranker = reranker
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tune_threshold</span>(<span class="hljs-params">self, queries, documents, ground_truth</span>):
        <span class="hljs-string">"""
        调优重排序阈值
        """</span>
        best_threshold = <span class="hljs-number">0.5</span>
        best_f1 = <span class="hljs-number">0</span>
        
        <span class="hljs-keyword">for</span> threshold <span class="hljs-keyword">in</span> np.arange(<span class="hljs-number">0.1</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.1</span>):
            f1_scores = []
            
            <span class="hljs-keyword">for</span> query, docs, gt <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(queries, documents, ground_truth):
                <span class="hljs-comment"># 重排序</span>
                results = self.reranker.rerank(query, docs)
                
                <span class="hljs-comment"># 应用阈值</span>
                filtered_results = [(doc, score) <span class="hljs-keyword">for</span> doc, score <span class="hljs-keyword">in</span> results <span class="hljs-keyword">if</span> score &gt;= threshold]
                
                <span class="hljs-comment"># 计算F1分数</span>
                predicted = <span class="hljs-built_in">set</span>([doc <span class="hljs-keyword">for</span> doc, _ <span class="hljs-keyword">in</span> filtered_results])
                actual = <span class="hljs-built_in">set</span>(gt)
                
                precision = <span class="hljs-built_in">len</span>(predicted &amp; actual) / <span class="hljs-built_in">len</span>(predicted) <span class="hljs-keyword">if</span> predicted <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
                recall = <span class="hljs-built_in">len</span>(predicted &amp; actual) / <span class="hljs-built_in">len</span>(actual) <span class="hljs-keyword">if</span> actual <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
                f1 = <span class="hljs-number">2</span> * precision * recall / (precision + recall) <span class="hljs-keyword">if</span> (precision + recall) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
                
                f1_scores.append(f1)
            
            avg_f1 = np.mean(f1_scores)
            <span class="hljs-keyword">if</span> avg_f1 &gt; best_f1:
                best_f1 = avg_f1
                best_threshold = threshold
        
        <span class="hljs-keyword">return</span> best_threshold, best_f1
</code></pre>
<h4 data-id="heading-49">6.2.3 监控和评估</h4>
<p><strong>性能监控：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RerankMonitor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.metrics = defaultdict(<span class="hljs-built_in">list</span>)
        self.logger = logging.getLogger(__name__)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">log_rerank_performance</span>(<span class="hljs-params">self, query, documents, results, latency</span>):
        <span class="hljs-string">"""
        记录重排序性能
        """</span>
        self.metrics[<span class="hljs-string">'latency'</span>].append(latency)
        self.metrics[<span class="hljs-string">'query_length'</span>].append(<span class="hljs-built_in">len</span>(query.split()))
        self.metrics[<span class="hljs-string">'doc_count'</span>].append(<span class="hljs-built_in">len</span>(documents))
        self.metrics[<span class="hljs-string">'result_count'</span>].append(<span class="hljs-built_in">len</span>(results))
        
        <span class="hljs-comment"># 记录日志</span>
        self.logger.info(<span class="hljs-string">f"Rerank completed: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(documents)}</span> docs -&gt; <span class="hljs-subst">{<span class="hljs-built_in">len</span>(results)}</span> results, <span class="hljs-subst">{latency:<span class="hljs-number">.3</span>f}</span>s"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_performance_stats</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""
        获取性能统计
        """</span>
        stats = {}
        <span class="hljs-keyword">for</span> metric, values <span class="hljs-keyword">in</span> self.metrics.items():
            stats[metric] = {
                <span class="hljs-string">'mean'</span>: np.mean(values),
                <span class="hljs-string">'std'</span>: np.std(values),
                <span class="hljs-string">'min'</span>: np.<span class="hljs-built_in">min</span>(values),
                <span class="hljs-string">'max'</span>: np.<span class="hljs-built_in">max</span>(values),
                <span class="hljs-string">'count'</span>: <span class="hljs-built_in">len</span>(values)
            }
        <span class="hljs-keyword">return</span> stats
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reset_metrics</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""
        重置指标
        """</span>
        self.metrics.clear()
</code></pre>
<hr/>
<h2 data-id="heading-50">七、Rerank的未来发展趋势</h2>
<h3 data-id="heading-51">7.1 技术发展趋势</h3>
<h4 data-id="heading-52">7.1.1 模型架构演进</h4>
<p><strong>Transformer架构优化：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 未来的高效Rerank模型架构</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EfficientRerankModel</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 使用更高效的注意力机制</span>
        self.attention = SparseAttention()
        <span class="hljs-comment"># 使用知识蒸馏</span>
        self.student_model = DistilledModel()
        <span class="hljs-comment"># 使用多任务学习</span>
        self.multi_task_head = MultiTaskHead()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-comment"># 稀疏注意力计算</span>
        query_repr = self.sparse_attention(query)
        doc_reprs = self.sparse_attention(documents)
        
        <span class="hljs-comment"># 多任务学习</span>
        scores = self.multi_task_head(query_repr, doc_reprs)
        
        <span class="hljs-keyword">return</span> scores
</code></pre>
<p><strong>多模态Rerank：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 多模态重排序</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MultimodalRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.text_encoder = TextEncoder()
        self.image_encoder = ImageEncoder()
        self.audio_encoder = AudioEncoder()
        self.fusion_layer = FusionLayer()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank_multimodal</span>(<span class="hljs-params">self, query, multimodal_docs</span>):
        <span class="hljs-string">"""
        多模态重排序
        """</span>
        query_features = self.extract_query_features(query)
        
        scores = []
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> multimodal_docs:
            doc_features = self.extract_doc_features(doc)
            score = self.fusion_layer(query_features, doc_features)
            scores.append(score)
        
        <span class="hljs-keyword">return</span> scores
</code></pre>
<h4 data-id="heading-53">7.1.2 计算效率提升</h4>
<p><strong>硬件加速：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># GPU/TPU加速的重排序</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AcceleratedRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, device=<span class="hljs-string">'cuda'</span></span>):
        self.device = device
        self.model = self.load_model().to(device)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank_batch_gpu</span>(<span class="hljs-params">self, queries, documents</span>):
        <span class="hljs-string">"""
        GPU批量重排序
        """</span>
        <span class="hljs-comment"># 批量处理</span>
        batch_pairs = []
        <span class="hljs-keyword">for</span> query <span class="hljs-keyword">in</span> queries:
            <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
                batch_pairs.append((query, doc))
        
        <span class="hljs-comment"># GPU计算</span>
        batch_scores = self.model.predict_batch(batch_pairs)
        
        <span class="hljs-keyword">return</span> batch_scores
</code></pre>
<h3 data-id="heading-54">7.2 应用场景扩展</h3>
<h4 data-id="heading-55">7.2.1 实时Rerank</h4>
<p><strong>流式处理：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> asyncio <span class="hljs-keyword">import</span> Queue

<span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamingRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, reranker</span>):
        self.reranker = reranker
        self.queue = Queue()
        self.results = {}
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_stream</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""
        流式处理重排序请求
        """</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            request = <span class="hljs-keyword">await</span> self.queue.get()
            query_id, query, documents = request
            
            <span class="hljs-comment"># 异步重排序</span>
            results = <span class="hljs-keyword">await</span> self.async_rerank(query, documents)
            self.results[query_id] = results
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">async_rerank</span>(<span class="hljs-params">self, query, documents</span>):
        <span class="hljs-string">"""
        异步重排序
        """</span>
        <span class="hljs-comment"># 在线程池中执行CPU密集型任务</span>
        loop = asyncio.get_event_loop()
        results = <span class="hljs-keyword">await</span> loop.run_in_executor(
            <span class="hljs-literal">None</span>, self.reranker.rerank, query, documents
        )
        <span class="hljs-keyword">return</span> results
</code></pre>
<h4 data-id="heading-56">7.2.2 个性化Rerank</h4>
<p><strong>用户偏好学习：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonalizedRerank</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, base_reranker</span>):
        self.base_reranker = base_reranker
        self.user_preferences = {}
        self.preference_model = PreferenceModel()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">learn_user_preference</span>(<span class="hljs-params">self, user_id, query, documents, clicks</span>):
        <span class="hljs-string">"""
        学习用户偏好
        """</span>
        <span class="hljs-comment"># 记录用户行为</span>
        <span class="hljs-keyword">if</span> user_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.user_preferences:
            self.user_preferences[user_id] = []
        
        self.user_preferences[user_id].append({
            <span class="hljs-string">'query'</span>: query,
            <span class="hljs-string">'documents'</span>: documents,
            <span class="hljs-string">'clicks'</span>: clicks
        })
        
        <span class="hljs-comment"># 更新偏好模型</span>
        self.preference_model.update(user_id, query, documents, clicks)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">personalized_rerank</span>(<span class="hljs-params">self, user_id, query, documents</span>):
        <span class="hljs-string">"""
        个性化重排序
        """</span>
        <span class="hljs-comment"># 基础重排序</span>
        base_results = self.base_reranker.rerank(query, documents)
        
        <span class="hljs-comment"># 个性化调整</span>
        user_preference = self.preference_model.get_preference(user_id)
        personalized_results = self.apply_preference(base_results, user_preference)
        
        <span class="hljs-keyword">return</span> personalized_results
</code></pre>
<h3 data-id="heading-57">7.3 挑战与机遇</h3>
<h4 data-id="heading-58">7.3.1 主要挑战</h4>
<p><strong>技术挑战：</strong></p>
<ol>
<li><strong>计算复杂度</strong>：Rerank的计算成本仍然较高</li>
<li><strong>延迟问题</strong>：实时应用对延迟要求严格</li>
<li><strong>模型泛化</strong>：不同领域的泛化能力有限</li>
<li><strong>数据质量</strong>：训练数据的质量影响模型效果</li>
</ol>
<p><strong>业务挑战：</strong></p>
<ol>
<li><strong>成本控制</strong>：大规模部署的成本较高</li>
<li><strong>效果评估</strong>：缺乏统一的评估标准</li>
<li><strong>用户接受度</strong>：用户对AI排序的信任度</li>
<li><strong>隐私保护</strong>：用户数据的隐私问题</li>
</ol>
<h4 data-id="heading-59">7.3.2 发展机遇</h4>
<p><strong>技术机遇：</strong></p>
<ul>
<li><strong>硬件发展</strong>：GPU/TPU性能提升</li>
<li><strong>模型优化</strong>：更高效的架构设计</li>
<li><strong>多模态融合</strong>：文本、图像、音频的统一处理</li>
<li><strong>实时计算</strong>：边缘计算和流式处理</li>
</ul>
<p><strong>应用机遇：</strong></p>
<ul>
<li><strong>垂直领域</strong>：医疗、法律、金融等专业领域</li>
<li><strong>移动应用</strong>：手机端的实时重排序</li>
<li><strong>IoT设备</strong>：智能设备的本地重排序</li>
<li><strong>企业应用</strong>：企业内部知识管理</li>
</ul>
<h3 data-id="heading-60">7.4 发展路线图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">gantt
    title Rerank技术发展路线图
    dateFormat  YYYY-MM-DD
    section 当前阶段
    模型优化      :2024-01-01, 2024-12-31
    效率提升      :2024-06-01, 2025-06-30
    多模态支持    :2024-09-01, 2025-09-30
    
    section 中期发展
    实时处理      :2025-01-01, 2026-12-31
    个性化排序    :2025-06-01, 2026-06-30
    边缘计算      :2025-09-01, 2026-09-30
    
    section 长期愿景
    通用智能排序  :2026-01-01, 2027-12-31
    自主优化      :2026-06-01, 2028-06-30
    人机协作      :2027-01-01, 2028-12-31
</code></pre>
<hr/>
<h2 data-id="heading-61">八、总结</h2>
<h3 data-id="heading-62">核心要点回顾</h3>
<ol>
<li><strong>Rerank是RAG系统的关键组件</strong>，能够显著提升检索质量</li>
<li><strong>Cross-Encoder是最常用的Rerank算法</strong>，精度高但计算成本大</li>
<li><strong>ColBERT平衡了精度和效率</strong>，适合大规模检索场景</li>
<li><strong>RAG-Fusion通过多查询融合</strong>，提升了复杂查询的处理能力</li>
<li><strong>多阶段Rerank</strong>结合了不同算法的优势</li>
<li><strong>Python实战</strong>展示了完整的Rerank系统实现</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我做了一个编辑国际化i18n json文件的命令行工具]]></title>    <link>https://juejin.cn/post/7579460553614737459</link>    <guid>https://juejin.cn/post/7579460553614737459</guid>    <pubDate>2025-12-03T10:41:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579460553614737459" data-draft-id="7579451710302568474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我做了一个编辑国际化i18n json文件的命令行工具"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-03T10:41:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="chenyunjie"/> <meta itemprop="url" content="https://juejin.cn/user/1204720476632045"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我做了一个编辑国际化i18n json文件的命令行工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1204720476632045/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    chenyunjie
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T10:41:46.000Z" title="Wed Dec 03 2025 10:41:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基本用法</h2>
<pre><code class="hljs language-bash" lang="bash">i18nedt locales/*.json -k home.start
</code></pre>
<p>运行这个命令会打开编辑器让你编辑一个临时文件，退出编辑器时你的内容就会写到对应的json文件里
，-k 参数可以有多个</p>
<p>为了更加方便可以通过环境变量I18NEDT_FILES设置json文件。这样后面就可以直接</p>
<pre><code class="hljs language-arduino" lang="arduino">i18nedt -k home.start
</code></pre>
<p>建议搭配direnv这样的工具使用</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/257fad6fad614c6b885a9626f357aff6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hlbnl1bmppZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765363306&amp;x-signature=huLKwG2gozJcWuyetshKvzebXe8%3D" alt="demo.gif" loading="lazy"/></p>
<h2 data-id="heading-1">可以让AI帮你填写缺失的翻译</h2>
<p>在ai工具里@一下生成的临时文件</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da1d7beaa3094509957dd53392967f61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hlbnl1bmppZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765363306&amp;x-signature=z93kO6pEG3Elg1B5H79fcNsBJl8%3D" alt="ai-ready.png" loading="lazy"/></p>
<h2 data-id="heading-2">配合fzf</h2>
<p>命令行的好处就是可以把不同的工具组合起来</p>
<p>fzf <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjunegunn%2Ffzf" target="_blank" title="https://github.com/junegunn/fzf" ref="nofollow noopener noreferrer">github.com/junegunn/fz…</a> 是一个通用的fuzzy finder</p>
<pre><code class="hljs language-bash" lang="bash">i18nedt -f | fzf \
     --<span class="hljs-built_in">bind</span> <span class="hljs-string">'enter:become:i18nedt -k {1}'</span> \
     --<span class="hljs-built_in">bind</span> <span class="hljs-string">'ctrl-o:execute:i18nedt -k {1}'</span> \
     --<span class="hljs-built_in">bind</span> <span class="hljs-string">'ctrl-x:become:i18nedt -k {q}'</span> \
     --delimiter = --preview <span class="hljs-string">'i18nedt -pa -k {1}'</span> \
     --preview-window <span class="hljs-string">'&lt;80(up):wrap'</span> --<span class="hljs-built_in">bind</span> <span class="hljs-string">'?:toggle-preview'</span>
</code></pre>
<p>这样你可以fuzzy搜索项目里所有翻译的key和文本，选中某一条后回车编辑，ctrl-x 以搜索内容为key进行编辑（一般是新建key时使用）。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffdbe4fe8a21404a8028afa8c3ed6817~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hlbnl1bmppZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765363306&amp;x-signature=kQ5mj2YFIiVkd74ypId82dQn1LI%3D" alt="demo.gif" loading="lazy"/></p>
<h2 data-id="heading-3">github</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkikyous%2Fi18nedt" target="_blank" title="https://github.com/kikyous/i18nedt" ref="nofollow noopener noreferrer">github.com/kikyous/i18…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【系统监控系列】005：CPU温度监控脚本]]></title>    <link>https://juejin.cn/post/7579313396207992847</link>    <guid>https://juejin.cn/post/7579313396207992847</guid>    <pubDate>2025-12-03T10:34:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579313396207992847" data-draft-id="7579298511072542720" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【系统监控系列】005：CPU温度监控脚本"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2025-12-03T10:34:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="零日失眠者"/> <meta itemprop="url" content="https://juejin.cn/user/3411111810444068"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【系统监控系列】005：CPU温度监控脚本
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3411111810444068/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    零日失眠者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T10:34:41.000Z" title="Wed Dec 03 2025 10:34:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">简介</h2>
<p>CPU温度是衡量系统健康状况的重要指标之一。过高的CPU温度可能导致系统不稳定、性能下降甚至硬件损坏。实时监控CPU温度有助于及时发现散热问题，预防系统故障。本文将介绍一个实用的Python脚本——CPU温度监控工具，它可以实时监控CPU温度，并在温度过高时发出告警。</p>
<h2 data-id="heading-1">功能介绍</h2>
<p>这个CPU温度监控工具具有以下核心功能：</p>
<ol>
<li><strong>实时温度监控</strong>：实时读取CPU温度传感器数据</li>
<li><strong>跨平台支持</strong>：支持Windows、Linux和macOS操作系统</li>
<li><strong>温度告警</strong>：当温度超过设定阈值时发出告警</li>
<li><strong>历史数据记录</strong>：记录温度变化历史，便于分析</li>
<li><strong>可视化图表</strong>：生成温度变化趋势图</li>
<li><strong>定时监控</strong>：支持按指定间隔持续监控CPU温度</li>
<li><strong>多核温度监控</strong>：支持多核CPU的温度监控</li>
<li><strong>风扇转速监控</strong>：在支持的系统上监控风扇转速</li>
</ol>
<h2 data-id="heading-2">应用场景</h2>
<p>这个工具适用于以下场景：</p>
<ol>
<li><strong>服务器监控</strong>：监控服务器CPU温度，预防过热故障</li>
<li><strong>高性能计算</strong>：在密集计算任务中监控CPU温度</li>
<li><strong>系统维护</strong>：定期检查系统散热状况</li>
<li><strong>故障排查</strong>：诊断系统不稳定是否由过热引起</li>
<li><strong>超频测试</strong>：在CPU超频时监控温度变化</li>
<li><strong>环境监控</strong>：监控机房或设备环境温度</li>
</ol>
<h2 data-id="heading-3">报错处理</h2>
<p>脚本包含了完善的错误处理机制：</p>
<ol>
<li><strong>传感器检测</strong>：自动检测可用的温度传感器</li>
<li><strong>权限验证</strong>：检查是否有足够的权限访问传感器数据</li>
<li><strong>硬件兼容性</strong>：处理不同硬件平台的兼容性问题</li>
<li><strong>数据有效性检查</strong>：验证温度数据的有效性</li>
<li><strong>异常捕获</strong>：捕获并处理运行过程中可能出现的各种异常</li>
<li><strong>降级处理</strong>：在传感器不可用时提供替代方案</li>
</ol>
<h2 data-id="heading-4">代码实现</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> argparse
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> platform
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> matplotlib.dates <span class="hljs-keyword">as</span> mdates
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CPUTemperatureMonitor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, history_size=<span class="hljs-number">100</span></span>):
        self.os_type = platform.system().lower()
        self.history_size = history_size
        self.temperature_history = deque(maxlen=history_size)
        self.timestamp_history = deque(maxlen=history_size)
        self.errors = []
        self.monitoring = <span class="hljs-literal">False</span>
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cpu_temperature_linux</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""获取Linux系统CPU温度"""</span>
        temperatures = {}
        
        <span class="hljs-comment"># 方法1: 通过sysfs读取温度</span>
        <span class="hljs-keyword">try</span>:
            hwmon_paths = []
            <span class="hljs-keyword">for</span> root, dirs, files <span class="hljs-keyword">in</span> os.walk(<span class="hljs-string">'/sys/class/hwmon/'</span>):
                <span class="hljs-keyword">if</span> <span class="hljs-string">'temp1_input'</span> <span class="hljs-keyword">in</span> files:
                    hwmon_paths.append(root)
                    
            <span class="hljs-keyword">for</span> i, path <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(hwmon_paths):
                <span class="hljs-keyword">try</span>:
                    <span class="hljs-comment"># 读取温度</span>
                    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(path, <span class="hljs-string">'temp1_input'</span>), <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
                        temp_raw = <span class="hljs-built_in">int</span>(f.read().strip())
                        temp_celsius = temp_raw / <span class="hljs-number">1000.0</span>
                        
                    <span class="hljs-comment"># 读取传感器名称</span>
                    <span class="hljs-keyword">try</span>:
                        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(path, <span class="hljs-string">'name'</span>), <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
                            name = f.read().strip()
                    <span class="hljs-keyword">except</span>:
                        name = <span class="hljs-string">f"Sensor <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>"</span>
                        
                    temperatures[name] = temp_celsius
                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                    <span class="hljs-keyword">continue</span>
        <span class="hljs-keyword">except</span>:
            <span class="hljs-keyword">pass</span>
            
        <span class="hljs-comment"># 方法2: 通过/proc/cpuinfo获取温度（某些系统）</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> temperatures:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'/proc/cpuinfo'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
                    <span class="hljs-comment"># 注意：/proc/cpuinfo通常不包含温度信息</span>
                    <span class="hljs-comment"># 这里只是示例，实际可能需要其他方法</span>
                    <span class="hljs-keyword">pass</span>
            <span class="hljs-keyword">except</span>:
                <span class="hljs-keyword">pass</span>
                
        <span class="hljs-keyword">return</span> temperatures
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cpu_temperature_windows</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""获取Windows系统CPU温度"""</span>
        temperatures = {}
        
        <span class="hljs-comment"># Windows上获取温度比较复杂，需要第三方库</span>
        <span class="hljs-comment"># 这里提供几种可能的方法</span>
        
        <span class="hljs-comment"># 方法1: 尝试使用wmi（需要pywin32）</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">import</span> wmi
            c = wmi.WMI(namespace=<span class="hljs-string">"root\\wmi"</span>)
            temperature_infos = c.MSAcpi_ThermalZoneTemperature()
            
            <span class="hljs-keyword">for</span> i, sensor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(temperature_infos):
                <span class="hljs-comment"># 温度以十分之一开尔文为单位</span>
                temp_kelvin = sensor.CurrentTemperature / <span class="hljs-number">10.0</span>
                temp_celsius = temp_kelvin - <span class="hljs-number">273.15</span>
                temperatures[<span class="hljs-string">f"Thermal Zone <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>"</span>] = temp_celsius
                
        <span class="hljs-keyword">except</span> ImportError:
            self.errors.append(<span class="hljs-string">"缺少wmi库，无法获取Windows温度信息"</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            self.errors.append(<span class="hljs-string">f"通过WMI获取温度失败: <span class="hljs-subst">{e}</span>"</span>)
            
        <span class="hljs-comment"># 方法2: 尝试使用OpenHardwareMonitorLib（需要安装）</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> temperatures:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 这需要预先安装OpenHardwareMonitor并注册COM组件</span>
                <span class="hljs-comment"># 由于复杂性，这里仅提供框架</span>
                <span class="hljs-keyword">pass</span>
            <span class="hljs-keyword">except</span>:
                <span class="hljs-keyword">pass</span>
                
        <span class="hljs-keyword">return</span> temperatures
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cpu_temperature_macos</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""获取macOS系统CPU温度"""</span>
        temperatures = {}
        
        <span class="hljs-comment"># macOS上获取温度也比较复杂</span>
        <span class="hljs-comment"># 可以尝试使用osascript调用系统命令</span>
        
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 注意：macOS通常不直接暴露温度传感器</span>
            <span class="hljs-comment"># 可能需要第三方工具如iStats</span>
            <span class="hljs-keyword">import</span> subprocess
            result = subprocess.run([<span class="hljs-string">'sysctl'</span>, <span class="hljs-string">'machdep.xcpm.cpu_thermal_level'</span>], 
                                  capture_output=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span>, timeout=<span class="hljs-number">10</span>)
            
            <span class="hljs-keyword">if</span> result.returncode == <span class="hljs-number">0</span>:
                <span class="hljs-comment"># 解析输出</span>
                output = result.stdout.strip()
                <span class="hljs-comment"># 这里的输出格式可能因系统而异</span>
                <span class="hljs-comment"># 仅作为示例</span>
                temperatures[<span class="hljs-string">'CPU'</span>] = <span class="hljs-number">0.0</span>  <span class="hljs-comment"># 实际需要解析具体数值</span>
                
        <span class="hljs-keyword">except</span> subprocess.TimeoutExpired:
            self.errors.append(<span class="hljs-string">"获取macOS温度信息超时"</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            self.errors.append(<span class="hljs-string">f"获取macOS温度信息失败: <span class="hljs-subst">{e}</span>"</span>)
            
        <span class="hljs-keyword">return</span> temperatures
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cpu_temperature</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""获取CPU温度（跨平台）"""</span>
        <span class="hljs-keyword">if</span> self.os_type == <span class="hljs-string">'linux'</span>:
            <span class="hljs-keyword">return</span> self.get_cpu_temperature_linux()
        <span class="hljs-keyword">elif</span> self.os_type == <span class="hljs-string">'windows'</span>:
            <span class="hljs-keyword">return</span> self.get_cpu_temperature_windows()
        <span class="hljs-keyword">elif</span> self.os_type == <span class="hljs-string">'darwin'</span>:  <span class="hljs-comment"># macOS</span>
            <span class="hljs-keyword">return</span> self.get_cpu_temperature_macos()
        <span class="hljs-keyword">else</span>:
            self.errors.append(<span class="hljs-string">f"不支持的操作系统: <span class="hljs-subst">{self.os_type}</span>"</span>)
            <span class="hljs-keyword">return</span> {}
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">format_temperature</span>(<span class="hljs-params">self, temp_celsius</span>):
        <span class="hljs-string">"""格式化温度显示"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{temp_celsius:<span class="hljs-number">.1</span>f}</span>°C (<span class="hljs-subst">{temp_celsius * <span class="hljs-number">9</span>/<span class="hljs-number">5</span> + <span class="hljs-number">32</span>:<span class="hljs-number">.1</span>f}</span>°F)"</span>
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">display_temperature</span>(<span class="hljs-params">self, temperatures</span>):
        <span class="hljs-string">"""显示温度信息"""</span>
        <span class="hljs-comment"># 清屏（兼容不同操作系统）</span>
        os.system(<span class="hljs-string">'cls'</span> <span class="hljs-keyword">if</span> os.name == <span class="hljs-string">'nt'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'clear'</span>)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"CPU温度监控工具"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"监控时间: <span class="hljs-subst">{datetime.now().strftime(<span class="hljs-string">'%Y-%m-%d %H:%M:%S'</span>)}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"操作系统: <span class="hljs-subst">{self.os_type}</span>"</span>)
        <span class="hljs-built_in">print</span>()
        
        <span class="hljs-keyword">if</span> temperatures:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"CPU温度信息:"</span>)
            <span class="hljs-keyword">for</span> sensor_name, temp <span class="hljs-keyword">in</span> temperatures.items():
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{sensor_name}</span>: <span class="hljs-subst">{self.format_temperature(temp)}</span>"</span>)
                
                <span class="hljs-comment"># 温度告警</span>
                <span class="hljs-keyword">if</span> temp &gt; <span class="hljs-number">80</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"  ⚠️  警告: 温度过高!"</span>)
                <span class="hljs-keyword">elif</span> temp &gt; <span class="hljs-number">70</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"  ℹ️  注意: 温度较高"</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"未能获取CPU温度信息"</span>)
            <span class="hljs-keyword">if</span> self.errors:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"错误信息:"</span>)
                <span class="hljs-keyword">for</span> error <span class="hljs-keyword">in</span> self.errors[-<span class="hljs-number">3</span>:]:  <span class="hljs-comment"># 显示最近3个错误</span>
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{error}</span>"</span>)
                    
        <span class="hljs-built_in">print</span>()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"按 Ctrl+C 停止监控"</span>)
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">collect_data</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""收集温度数据"""</span>
        temperatures = self.get_cpu_temperature()
        timestamp = datetime.now()
        
        <span class="hljs-comment"># 记录到历史数据</span>
        <span class="hljs-keyword">if</span> temperatures:
            avg_temp = <span class="hljs-built_in">sum</span>(temperatures.values()) / <span class="hljs-built_in">len</span>(temperatures)
            self.temperature_history.append(avg_temp)
            self.timestamp_history.append(timestamp)
            
        <span class="hljs-keyword">return</span> temperatures
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save_data</span>(<span class="hljs-params">self, filename=<span class="hljs-string">"temperature_data.json"</span></span>):
        <span class="hljs-string">"""保存温度数据到文件"""</span>
        <span class="hljs-keyword">try</span>:
            data = {
                <span class="hljs-string">'timestamps'</span>: [t.isoformat() <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> self.timestamp_history],
                <span class="hljs-string">'temperatures'</span>: <span class="hljs-built_in">list</span>(self.temperature_history),
                <span class="hljs-string">'os_type'</span>: self.os_type,
                <span class="hljs-string">'record_time'</span>: datetime.now().isoformat()
            }
            
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
                json.dump(data, f, indent=<span class="hljs-number">2</span>)
                
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"温度数据已保存到: <span class="hljs-subst">{filename}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"保存温度数据时出错: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_chart</span>(<span class="hljs-params">self, filename=<span class="hljs-string">"temperature_chart.png"</span></span>):
        <span class="hljs-string">"""生成温度变化图表"""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.timestamp_history) &lt; <span class="hljs-number">2</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"数据不足，无法生成图表"</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
                
            plt.figure(figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">6</span>))
            plt.plot(self.timestamp_history, self.temperature_history, <span class="hljs-string">'b-'</span>, linewidth=<span class="hljs-number">1.5</span>)
            plt.title(<span class="hljs-string">'CPU温度变化趋势'</span>)
            plt.xlabel(<span class="hljs-string">'时间'</span>)
            plt.ylabel(<span class="hljs-string">'温度 (°C)'</span>)
            plt.grid(<span class="hljs-literal">True</span>, alpha=<span class="hljs-number">0.3</span>)
            
            <span class="hljs-comment"># 设置温度告警线</span>
            plt.axhline(y=<span class="hljs-number">70</span>, color=<span class="hljs-string">'orange'</span>, linestyle=<span class="hljs-string">'--'</span>, alpha=<span class="hljs-number">0.7</span>, label=<span class="hljs-string">'高温警告 (70°C)'</span>)
            plt.axhline(y=<span class="hljs-number">80</span>, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">'--'</span>, alpha=<span class="hljs-number">0.7</span>, label=<span class="hljs-string">'危险温度 (80°C)'</span>)
            
            plt.legend()
            
            <span class="hljs-comment"># 格式化时间轴</span>
            plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="hljs-string">'%H:%M'</span>))
            plt.gca().xaxis.set_major_locator(mdates.MinuteLocator(interval=<span class="hljs-number">5</span>))
            plt.setp(plt.gca().xaxis.get_majorticklabels(), rotation=<span class="hljs-number">45</span>)
            
            plt.tight_layout()
            plt.savefig(filename, dpi=<span class="hljs-number">300</span>, bbox_inches=<span class="hljs-string">'tight'</span>)
            plt.close()
            
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"温度图表已保存到: <span class="hljs-subst">{filename}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"生成温度图表时出错: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_temperature_alert</span>(<span class="hljs-params">self, temperatures, threshold=<span class="hljs-number">80</span></span>):
        <span class="hljs-string">"""检查温度告警"""</span>
        alerts = []
        
        <span class="hljs-keyword">for</span> sensor_name, temp <span class="hljs-keyword">in</span> temperatures.items():
            <span class="hljs-keyword">if</span> temp &gt; threshold:
                alerts.append({
                    <span class="hljs-string">'sensor'</span>: sensor_name,
                    <span class="hljs-string">'temperature'</span>: temp,
                    <span class="hljs-string">'threshold'</span>: threshold,
                    <span class="hljs-string">'time'</span>: datetime.now().isoformat()
                })
                
        <span class="hljs-keyword">if</span> alerts:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n🚨 温度告警!"</span>)
            <span class="hljs-keyword">for</span> alert <span class="hljs-keyword">in</span> alerts:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{alert[<span class="hljs-string">'sensor'</span>]}</span>: <span class="hljs-subst">{self.format_temperature(alert[<span class="hljs-string">'temperature'</span>])}</span> "</span>
                      <span class="hljs-string">f"(阈值: <span class="hljs-subst">{alert[<span class="hljs-string">'threshold'</span>]}</span>°C)"</span>)
                      
        <span class="hljs-keyword">return</span> alerts
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start_monitoring</span>(<span class="hljs-params">self, interval=<span class="hljs-number">5</span>, duration=<span class="hljs-literal">None</span>, alert_threshold=<span class="hljs-number">80</span>, 
                        save_data=<span class="hljs-literal">False</span>, chart_file=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""开始监控"""</span>
        self.monitoring = <span class="hljs-literal">True</span>
        start_time = time.time()
        
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">while</span> self.monitoring:
                <span class="hljs-comment"># 收集数据</span>
                temperatures = self.collect_data()
                
                <span class="hljs-comment"># 显示温度</span>
                self.display_temperature(temperatures)
                
                <span class="hljs-comment"># 检查告警</span>
                <span class="hljs-keyword">if</span> temperatures:
                    self.check_temperature_alert(temperatures, alert_threshold)
                    
                <span class="hljs-comment"># 保存数据</span>
                <span class="hljs-keyword">if</span> save_data <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(self.temperature_history) % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:  <span class="hljs-comment"># 每10次保存一次</span>
                    self.save_data()
                    
                <span class="hljs-comment"># 检查是否达到指定时长</span>
                <span class="hljs-keyword">if</span> duration <span class="hljs-keyword">and</span> (time.time() - start_time) &gt;= duration:
                    <span class="hljs-keyword">break</span>
                    
                <span class="hljs-comment"># 等待下次监控</span>
                time.sleep(interval)
                
        <span class="hljs-keyword">except</span> KeyboardInterrupt:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n\n停止监控..."</span>)
        <span class="hljs-keyword">finally</span>:
            self.monitoring = <span class="hljs-literal">False</span>
            
            <span class="hljs-comment"># 生成图表</span>
            <span class="hljs-keyword">if</span> chart_file:
                self.generate_chart(chart_file)
                
            <span class="hljs-comment"># 保存最终数据</span>
            <span class="hljs-keyword">if</span> save_data:
                self.save_data()
                
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"监控已停止"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    parser = argparse.ArgumentParser(description=<span class="hljs-string">"CPU温度监控工具"</span>)
    parser.add_argument(<span class="hljs-string">"-i"</span>, <span class="hljs-string">"--interval"</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, default=<span class="hljs-number">5</span>, 
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"监控间隔（秒，默认：5）"</span>)
    parser.add_argument(<span class="hljs-string">"-d"</span>, <span class="hljs-string">"--duration"</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, 
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"监控时长（秒，不指定则持续监控）"</span>)
    parser.add_argument(<span class="hljs-string">"-t"</span>, <span class="hljs-string">"--threshold"</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">float</span>, default=<span class="hljs-number">80.0</span>,
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"温度告警阈值（°C，默认：80）"</span>)
    parser.add_argument(<span class="hljs-string">"-s"</span>, <span class="hljs-string">"--save-data"</span>, action=<span class="hljs-string">"store_true"</span>,
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"保存温度数据到文件"</span>)
    parser.add_argument(<span class="hljs-string">"-c"</span>, <span class="hljs-string">"--chart"</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">"生成温度图表到指定文件"</span>)
    parser.add_argument(<span class="hljs-string">"--list-sensors"</span>, action=<span class="hljs-string">"store_true"</span>,
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"列出可用的温度传感器"</span>)
    
    args = parser.parse_args()
    
    <span class="hljs-comment"># 检查必要的依赖</span>
    <span class="hljs-keyword">if</span> args.list_sensors <span class="hljs-keyword">and</span> platform.system().lower() == <span class="hljs-string">'windows'</span>:
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">import</span> wmi
        <span class="hljs-keyword">except</span> ImportError:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"警告: 缺少wmi库，无法列出Windows传感器"</span>)
            
    <span class="hljs-keyword">try</span>:
        monitor = CPUTemperatureMonitor()
        
        <span class="hljs-comment"># 列出传感器</span>
        <span class="hljs-keyword">if</span> args.list_sensors:
            temperatures = monitor.get_cpu_temperature()
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"可用的温度传感器:"</span>)
            <span class="hljs-keyword">if</span> temperatures:
                <span class="hljs-keyword">for</span> sensor_name, temp <span class="hljs-keyword">in</span> temperatures.items():
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{sensor_name}</span>: <span class="hljs-subst">{monitor.format_temperature(temp)}</span>"</span>)
            <span class="hljs-keyword">else</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"  未找到可用的温度传感器"</span>)
            <span class="hljs-keyword">return</span>
            
        <span class="hljs-comment"># 开始监控</span>
        monitor.start_monitoring(
            interval=args.interval,
            duration=args.duration,
            alert_threshold=args.threshold,
            save_data=args.save_data,
            chart_file=args.chart
        )
        
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n\n用户中断操作"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"程序执行出错: <span class="hljs-subst">{e}</span>"</span>)
        sys.exit(<span class="hljs-number">1</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<h2 data-id="heading-5">使用方法</h2>
<h3 data-id="heading-6">安装依赖</h3>
<p>在使用此脚本之前，可能需要安装必要的库：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Windows系统（可选，用于更好的温度监控）</span>
pip install pywin32 wmi

<span class="hljs-comment"># 生成图表需要</span>
pip install matplotlib
</code></pre>
<h3 data-id="heading-7">基本使用</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基本用法，每5秒刷新一次</span>
python cpu_temp_monitor.py

<span class="hljs-comment"># 设置监控间隔为10秒</span>
python cpu_temp_monitor.py -i 10

<span class="hljs-comment"># 监控60秒后自动停止</span>
python cpu_temp_monitor.py -d 60

<span class="hljs-comment"># 设置告警阈值为75°C</span>
python cpu_temp_monitor.py -t 75

<span class="hljs-comment"># 保存温度数据到文件</span>
python cpu_temp_monitor.py -s

<span class="hljs-comment"># 生成温度变化图表</span>
python cpu_temp_monitor.py -c temperature.png

<span class="hljs-comment"># 列出可用的温度传感器</span>
python cpu_temp_monitor.py --list-sensors
</code></pre>
<h3 data-id="heading-8">命令行参数说明</h3>
<ul>
<li><code>-i, --interval</code>: 监控间隔（秒），默认5秒</li>
<li><code>-d, --duration</code>: 监控时长（秒），不指定则持续监控</li>
<li><code>-t, --threshold</code>: 温度告警阈值（°C），默认80°C</li>
<li><code>-s, --save-data</code>: 保存温度数据到文件</li>
<li><code>-c, --chart</code>: 生成温度图表到指定文件</li>
<li><code>--list-sensors</code>: 列出可用的温度传感器</li>
</ul>
<h3 data-id="heading-9">使用示例</h3>
<ol>
<li><strong>持续监控CPU温度</strong>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">python cpu_temp_monitor.py
</code></pre>
<ol start="2">
<li><strong>监控并保存数据</strong>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">python cpu_temp_monitor.py -i 10 -d 300 -s -c temp_trend.png
</code></pre>
<ol start="3">
<li><strong>设置较低的告警阈值</strong>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">python cpu_temp_monitor.py -t 70
</code></pre>
<h2 data-id="heading-10">总结</h2>
<p>这个CPU温度监控工具提供了一个跨平台的CPU温度监控解决方案，能够实时显示CPU温度并在温度过高时发出告警。它支持数据持久化和可视化图表生成，适用于服务器监控、系统维护和故障排查等多种场景。通过这个工具，用户可以及时了解CPU的温度状况，预防因过热导致的系统问题，确保系统的稳定运行。</p>
<p>需要注意的是，不同操作系统的温度获取方法有所不同，某些平台可能需要安装额外的库或工具才能获取准确的温度数据。在实际使用中，建议根据具体的硬件平台和操作系统选择合适的实现方式。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全面解析：GeoJSON 与 TopoJSON 的定义、差异及适用场景]]></title>    <link>https://juejin.cn/post/7579439226519289862</link>    <guid>https://juejin.cn/post/7579439226519289862</guid>    <pubDate>2025-12-03T11:54:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579439226519289862" data-draft-id="7579439226519257094" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全面解析：GeoJSON 与 TopoJSON 的定义、差异及适用场景"/> <meta itemprop="keywords" content="前端,面试,GitHub"/> <meta itemprop="datePublished" content="2025-12-03T11:54:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小jobleap"/> <meta itemprop="url" content="https://juejin.cn/user/2875978147692910"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全面解析：GeoJSON 与 TopoJSON 的定义、差异及适用场景
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978147692910/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小jobleap
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T11:54:29.000Z" title="Wed Dec 03 2025 11:54:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是jobleap.cn的小九。</p>
<p>作为程序员在地理信息开发（如地图可视化、空间数据处理）中常用的两种数据格式，GeoJSON 和 TopoJSON 虽同基于 JSON 语法，但在设计目标、数据结构和适用场景上存在本质区别。本文将从技术视角出发，系统梳理两者的核心特性、差异对比，并结合实际开发场景给出选择建议，帮助开发者精准匹配需求。</p>
<h2 data-id="heading-0">一、核心定义与数据结构</h2>
<h3 data-id="heading-1">1. GeoJSON：简单直观的地理数据交换格式</h3>
<h4 data-id="heading-2">定义</h4>
<p>GeoJSON 是一种<strong>基于 JSON 的轻量级地理数据交换标准</strong>（RFC 7946 规范），核心目标是「简洁、可读、易解析」，支持点、线、面、多几何对象等基础空间类型，同时可附加自定义属性信息。</p>
<h4 data-id="heading-3">核心数据结构</h4>
<p>GeoJSON 的核心是 <code>Geometry</code>（几何对象）和 <code>Feature</code>（要素对象）：</p>
<ul>
<li><strong>几何对象（Geometry）</strong>：描述地理空间形状，支持 7 种类型：
<ul>
<li>点（<code>Point</code>）：如坐标 <code>[经度, 纬度]</code></li>
<li>线（<code>LineString</code>）：如路径 <code>[[x1,y1], [x2,y2], ...]</code></li>
<li>面（<code>Polygon</code>）：如区域 <code>[[[x1,y1], [x2,y2], ..., [x1,y1]]]</code>（闭合环）</li>
<li>多点（<code>MultiPoint</code>）、多线（<code>MultiLineString</code>）、多面（<code>MultiPolygon</code>）</li>
<li>几何集合（<code>GeometryCollection</code>）：包含多个不同类型的几何对象</li>
</ul>
</li>
<li><strong>要素对象（Feature）</strong>：将几何对象与属性关联，格式为 <code>{"type": "Feature", "geometry": {...}, "properties": {...}}</code></li>
<li><strong>要素集合（FeatureCollection）</strong>：多个要素的集合（最常用的顶层结构）</li>
</ul>
<h4 data-id="heading-4">示例（中国部分城市点数据）</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FeatureCollection"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"features"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Feature"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"geometry"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Point"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"coordinates"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">116.403963</span><span class="hljs-punctuation">,</span> <span class="hljs-number">39.915119</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"北京"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"population"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2184</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Feature"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"geometry"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Point"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"coordinates"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">121.473701</span><span class="hljs-punctuation">,</span> <span class="hljs-number">31.230416</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"上海"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"population"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2487</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-5">关键特性</h4>
<ul>
<li>结构扁平，可读性极强（直接肉眼识别地理类型和属性）；</li>
<li>无需额外依赖，所有主流地图库（Leaflet、Mapbox、ECharts）和空间数据框架（GeoPandas、Shapely）均原生支持；</li>
<li>数据冗余度高（如相邻省份的共享边界会重复存储）。</li>
</ul>
<h3 data-id="heading-6">2. TopoJSON：基于拓扑的高效地理数据格式</h3>
<h4 data-id="heading-7">定义</h4>
<p>TopoJSON 是 GeoJSON 的<strong>扩展格式</strong>（由 D3.js 作者 Mike Bostock 设计），核心目标是「压缩数据体积、消除冗余」，通过<strong>拓扑结构</strong>（Topology）复用共享地理边界（如国家、省份的相邻边界），将重复存储的坐标数据转化为可复用的「弧段（Arc）」。</p>
<h4 data-id="heading-8">核心数据结构</h4>
<p>TopoJSON 不直接存储完整的几何对象，而是通过「拓扑关系」描述数据：</p>
<ul>
<li><strong>弧段（Arcs）</strong>：提取所有几何对象的共享边界，以坐标数组形式存储（如相邻两省的边界仅存储一次）；</li>
<li><strong>对象（Objects）</strong>：对应 GeoJSON 中的 <code>Feature</code>，但不存储完整坐标，而是通过「引用弧段的索引和方向」（正/负索引表示顺时针/逆时针）重构几何形状；</li>
<li><strong>转换参数（Transform）</strong>：可选参数，通过缩放（scale）和偏移（translate）对坐标进行整数化处理，进一步压缩体积。</li>
</ul>
<h4 data-id="heading-9">示例（简化版中国省份拓扑数据）</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Topology"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"transform"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"scale"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">0.0001</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.0001</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"translate"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">73.55</span><span class="hljs-punctuation">,</span> <span class="hljs-number">18.15</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"arcs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-number">10000</span><span class="hljs-punctuation">,</span> <span class="hljs-number">20000</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-number">10001</span><span class="hljs-punctuation">,</span> <span class="hljs-number">20001</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> ...<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 共享弧段1</span>
    <span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-number">10002</span><span class="hljs-punctuation">,</span> <span class="hljs-number">20002</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">[</span><span class="hljs-number">10003</span><span class="hljs-punctuation">,</span> <span class="hljs-number">20003</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> ...<span class="hljs-punctuation">]</span>   <span class="hljs-comment">// 共享弧段2</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"objects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"beijing"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Polygon"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"arcs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span>  <span class="hljs-comment">// 引用弧段0和1，重构北京的边界</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"hebei"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Polygon"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"arcs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-number">-1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span> <span class="hljs-comment">// 负索引表示反向使用弧段1</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-10">关键特性</h4>
<ul>
<li>数据压缩比极高（相比 GeoJSON 可减少 50%-90% 体积，尤其是边界复杂的大数据集）；</li>
<li>需通过工具（如 <code>topojson-client</code>、<code>GeoPandas</code>）转换为 GeoJSON 后才能用于可视化；</li>
<li>保留拓扑关系，支持复杂空间分析（如判断边界相邻、合并/拆分区域）。</li>
</ul>
<h2 data-id="heading-11">二、核心差异对比（程序员视角）</h2>













































<table><thead><tr><th>对比维度</th><th>GeoJSON</th><th>TopoJSON</th></tr></thead><tbody><tr><td><strong>设计目标</strong></td><td>简洁易读、快速交换</td><td>数据压缩、拓扑复用</td></tr><tr><td><strong>数据冗余</strong></td><td>高（共享边界重复存储）</td><td>低（共享边界仅存储一次）</td></tr><tr><td><strong>文件体积</strong></td><td>大（适合小数据集）</td><td>小（适合大数据集）</td></tr><tr><td><strong>解析难度</strong></td><td>低（原生支持，无需额外依赖）</td><td>高（需转换为 GeoJSON 才能使用）</td></tr><tr><td><strong>支持功能</strong></td><td>基础空间数据存储与可视化</td><td>拓扑分析、大数据量地图加载、空间关系处理</td></tr><tr><td><strong>开发效率</strong></td><td>高（直接解析，快速迭代）</td><td>中（需额外处理转换逻辑）</td></tr><tr><td><strong>生态支持</strong></td><td>所有地图库/空间框架原生支持</td><td>需依赖 TopoJSON 专用库（如 <code>topojson-client</code>、<code>topojson-server</code>）</td></tr></tbody></table>
<h3 data-id="heading-12">关键差异总结</h3>
<ol>
<li><strong>体积差异</strong>：TopoJSON 是 GeoJSON 的「压缩版」，对于包含大量共享边界的数据集（如世界地图、全国省份地图），体积优势极为明显；</li>
<li><strong>使用成本</strong>：GeoJSON 开箱即用，TopoJSON 需「转换步骤」（开发中需集成转换逻辑）；</li>
<li><strong>功能边界</strong>：GeoJSON 聚焦「数据交换」，TopoJSON 聚焦「高效存储+拓扑分析」。</li>
</ol>
<h2 data-id="heading-13">三、适用场景与任务需求</h2>
<h3 data-id="heading-14">1. GeoJSON 适用场景</h3>
<h4 data-id="heading-15">（1）小数据集+快速开发场景</h4>
<ul>
<li><strong>原型开发</strong>：快速验证地图可视化功能（如标记店铺位置、绘制简单路径），无需关注数据体积；</li>
<li><strong>小规模空间数据交换</strong>：如接口返回单个城市的POI点（兴趣点）、用户上传的自定义路线数据；</li>
<li><strong>简单可视化需求</strong>：如 ECharts 地图组件、Leaflet 基础地图标记，数据量在千级以内（无明显性能问题）。</li>
</ul>
<h4 data-id="heading-16">（2）无需拓扑关系的场景</h4>
<ul>
<li>仅需展示地理对象的「位置和属性」（如标注公交站点、显示区域名称），不涉及边界共享、空间分析；</li>
<li>多系统数据交互（如后端接口返回地理数据给前端，跨语言/跨框架兼容优先）。</li>
</ul>
<h4 data-id="heading-17">（3）推荐工具/库</h4>
<ul>
<li>解析：原生 JSON 解析器（Python <code>json</code> 模块、Golang <code>encoding/json</code>）+ 空间库（GeoPandas、Shapely）；</li>
<li>可视化：Leaflet、Mapbox GL JS、ECharts、Matplotlib。</li>
</ul>
<h3 data-id="heading-18">2. TopoJSON 适用场景</h3>
<h4 data-id="heading-19">（1）大数据量地图可视化</h4>
<ul>
<li><strong>大规模区域数据</strong>：如世界各国、全国省份/市区、复杂路网数据（边界重复多，压缩效果显著）；</li>
<li><strong>高性能加载需求</strong>：如移动端地图、Web 端大数据量地图（减少网络传输时间，提升页面加载速度）。</li>
</ul>
<h4 data-id="heading-20">（2）需要拓扑关系的空间分析</h4>
<ul>
<li>空间关系判断：如判断两个区域是否相邻、计算共享边界长度；</li>
<li>地理数据处理：如合并相邻区域、拆分复杂多边形、拓扑纠错（如消除重叠边界）。</li>
</ul>
<h4 data-id="heading-21">（3）生产环境优化场景</h4>
<ul>
<li>正式上线的地图应用（如打车软件的区域划分、物流配送范围展示），需平衡加载速度和用户体验；</li>
<li>数据存储优化（如服务器存储大量地理数据，减少磁盘占用）。</li>
</ul>
<h4 data-id="heading-22">（4）推荐工具/库</h4>
<ul>
<li>转换：<code>topojson-client</code>（前端转换）、<code>GeoPandas</code>（Python：<code>geopandas.read_file()</code> 支持直接读取 TopoJSON）、<code>topojson-server</code>（后端生成 TopoJSON）；</li>
<li>可视化：D3.js（原生支持 TopoJSON，适合定制化地图）、Mapbox GL JS（需先转换为 GeoJSON）；</li>
<li>生成：<code>ogr2ogr</code>（GDAL 工具集，支持批量将 Shapefile 转换为 TopoJSON）。</li>
</ul>
<h2 data-id="heading-23">四、开发实践选择建议</h2>
<ol>
<li>
<p><strong>优先选 GeoJSON 的情况</strong>：</p>
<ul>
<li>数据量小（如 &lt;1 万条要素）、开发周期短、需要快速迭代；</li>
<li>跨系统数据交互（兼容性优先）；</li>
<li>仅需基础可视化，无需拓扑分析。</li>
</ul>
</li>
<li>
<p><strong>优先选 TopoJSON 的情况</strong>：</p>
<ul>
<li>数据量庞大（如全国/全球地图、复杂路网），需优化加载速度；</li>
<li>涉及边界共享的空间分析（如区域相邻判断、边界合并）；</li>
<li>生产环境，对性能和存储占用有严格要求。</li>
</ul>
</li>
<li>
<p><strong>混合使用方案</strong>：</p>
<ul>
<li>后端存储：使用 TopoJSON 压缩存储，减少磁盘占用和传输带宽；</li>
<li>前端使用：通过 <code>topojson-client</code> 实时转换为 GeoJSON 后渲染，兼顾性能和开发效率。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-24">五、工具链推荐（Python/Golang 开发者）</h2>
<h3 data-id="heading-25">Python 生态</h3>
<ul>
<li>解析/转换：<code>GeoPandas</code>（<code>gpd.read_file("data.topo.json")</code> 直接读取，<code>gpd.to_file("data.geojson")</code> 转换）、<code>topojson</code>（<code>topojson.convert()</code> 实现 GeoJSON 转 TopoJSON）；</li>
<li>可视化：<code>folium</code>（Leaflet 封装）、<code>plotly</code>（交互式地图）。</li>
</ul>
<h3 data-id="heading-26">Golang 生态</h3>
<ul>
<li>解析：<code>github.com/paulmach/orb</code>（GeoJSON 解析与空间操作）、<code>github.com/topojson/topojson-go</code>（TopoJSON 转换）；</li>
<li>可视化：<code>github.com/go-echarts/go-echarts</code>（地图组件）、<code>github.com/paulmach/osm</code>（结合 OpenStreetMap 数据）。</li>
</ul>
<h2 data-id="heading-27">总结</h2>
<p>GeoJSON 是「简单易用的地理数据交换标准」，适合快速开发、小规模数据场景；TopoJSON 是「高效压缩的拓扑数据格式」，适合大数据量、高性能、复杂空间分析场景。作为开发者，需根据数据规模、性能需求、开发成本选择合适的格式——小项目优先 GeoJSON 提升效率，大项目优先 TopoJSON 优化性能，混合使用方案则可兼顾两者优势。</p>
<p>掌握两者的转换逻辑和生态工具，能让地理信息开发更高效、更灵活，尤其在地图可视化、空间数据接口开发等场景中，可显著提升系统性能和用户体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java：理解数据类型和变量]]></title>    <link>https://juejin.cn/post/7579507023507800127</link>    <guid>https://juejin.cn/post/7579507023507800127</guid>    <pubDate>2025-12-03T13:17:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579507023507800127" data-draft-id="7579507023507718207" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java：理解数据类型和变量"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-03T13:17:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吃西红柿长大的番茄"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java：理解数据类型和变量
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吃西红柿长大的番茄
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T13:17:42.000Z" title="Wed Dec 03 2025 13:17:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"“";top:4px;left:6px}.markdown-body blockquote:after{content:"”";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">Java的基本数据类型（8个）</h2>
<p>Java有8种基本数据类型，我把它们分成4组</p>
<h3 data-id="heading-1">第1组：整数组（存整数）</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IntegerTypes</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 整数组成员 ==="</span>);
        
        <span class="hljs-comment">// 1. byte：最小的整型，适合存小数字</span>
        <span class="hljs-type">byte</span> <span class="hljs-variable">myByte</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;              <span class="hljs-comment">// 范围：-128 ~ 127</span>
        System.out.println(<span class="hljs-string">"byte值: "</span> + myByte + <span class="hljs-string">" (占用1个字节)"</span>);
        
        <span class="hljs-comment">// 2. short：短整型，比byte大一点</span>
        <span class="hljs-type">short</span> <span class="hljs-variable">myShort</span> <span class="hljs-operator">=</span> <span class="hljs-number">30000</span>;          <span class="hljs-comment">// 范围：-32768 ~ 32767</span>
        System.out.println(<span class="hljs-string">"short值: "</span> + myShort + <span class="hljs-string">" (占用2个字节)"</span>);
        
        <span class="hljs-comment">// 3. int：最常用的整型（默认选择）</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">myInt</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000000</span>;            <span class="hljs-comment">// 范围：约±21亿</span>
        System.out.println(<span class="hljs-string">"int值: "</span> + myInt + <span class="hljs-string">" (占用4个字节)"</span>);
        
        <span class="hljs-comment">// 4. long：大整数，数字后要加L</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">myLong</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000000000L</span>;     <span class="hljs-comment">// 范围：非常大！</span>
        System.out.println(<span class="hljs-string">"long值: "</span> + myLong + <span class="hljs-string">" (占用8个字节)"</span>);
        
        <span class="hljs-comment">// 实际应用：学生信息</span>
        <span class="hljs-type">byte</span> <span class="hljs-variable">studentAge</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;          <span class="hljs-comment">// 年龄用byte足够</span>
        <span class="hljs-type">short</span> <span class="hljs-variable">studentId</span> <span class="hljs-operator">=</span> <span class="hljs-number">12345</span>;       <span class="hljs-comment">// 学号用short</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">population</span> <span class="hljs-operator">=</span> <span class="hljs-number">1400000000</span>;   <span class="hljs-comment">// 中国人口，用int</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">worldPopulation</span> <span class="hljs-operator">=</span> <span class="hljs-number">7800000000L</span>; <span class="hljs-comment">// 世界人口，用long</span>
    }
}
</code></pre>
<h3 data-id="heading-2">第2组：浮点组（存小数）</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FloatTypes</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 浮点组成员 ==="</span>);
        
        <span class="hljs-comment">// 1. float：单精度小数，数字后要加F</span>
        <span class="hljs-type">float</span> <span class="hljs-variable">myFloat</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.14F</span>;          <span class="hljs-comment">// 精度约6-7位小数</span>
        System.out.println(<span class="hljs-string">"float值: "</span> + myFloat + <span class="hljs-string">" (占用4个字节)"</span>);
        
        <span class="hljs-comment">// 2. double：双精度小数（默认选择）</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">myDouble</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.1415926535</span>; <span class="hljs-comment">// 精度约15位小数</span>
        System.out.println(<span class="hljs-string">"double值: "</span> + myDouble + <span class="hljs-string">" (占用8个字节)"</span>);
        
        <span class="hljs-comment">// 实际应用：购物计算</span>
        <span class="hljs-type">float</span> <span class="hljs-variable">applePrice</span> <span class="hljs-operator">=</span> <span class="hljs-number">5.99F</span>;       <span class="hljs-comment">// 苹果单价</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">totalCost</span> <span class="hljs-operator">=</span> applePrice * <span class="hljs-number">2.5</span>; <span class="hljs-comment">// 总价</span>
        System.out.println(<span class="hljs-string">"2.5斤苹果总价: "</span> + totalCost + <span class="hljs-string">"元"</span>);
        
        <span class="hljs-comment">// 科学计算示例</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">pi</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.141592653589793</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">earthRadius</span> <span class="hljs-operator">=</span> <span class="hljs-number">6371.0</span>;    <span class="hljs-comment">// 地球半径（公里）</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">circleArea</span> <span class="hljs-operator">=</span> pi * earthRadius * earthRadius;
        System.out.println(<span class="hljs-string">"地球表面积约: "</span> + circleArea + <span class="hljs-string">"平方公里"</span>);
    }
}
</code></pre>
<h3 data-id="heading-3">第3组：字符组（存单个字符）</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CharType</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 字符类型 ==="</span>);
        
        <span class="hljs-comment">// char：存单个字符，用单引号</span>
        <span class="hljs-type">char</span> <span class="hljs-variable">myChar</span> <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span>;
        <span class="hljs-type">char</span> <span class="hljs-variable">chineseChar</span> <span class="hljs-operator">=</span> <span class="hljs-string">'我'</span>;
        <span class="hljs-type">char</span> <span class="hljs-variable">numberChar</span> <span class="hljs-operator">=</span> <span class="hljs-string">'7'</span>;
        <span class="hljs-type">char</span> <span class="hljs-variable">symbolChar</span> <span class="hljs-operator">=</span> <span class="hljs-string">'@'</span>;
        
        System.out.println(<span class="hljs-string">"英文字母: "</span> + myChar);
        System.out.println(<span class="hljs-string">"中文字符: "</span> + chineseChar);
        System.out.println(<span class="hljs-string">"数字字符: "</span> + numberChar);
        System.out.println(<span class="hljs-string">"符号字符: "</span> + symbolChar);
        
        <span class="hljs-comment">// char可以存储Unicode字符</span>
        <span class="hljs-type">char</span> <span class="hljs-variable">heart</span> <span class="hljs-operator">=</span> <span class="hljs-string">'\u2764'</span>;  <span class="hljs-comment">// 心形符号的Unicode</span>
        <span class="hljs-type">char</span> <span class="hljs-variable">smiley</span> <span class="hljs-operator">=</span> <span class="hljs-string">'\u263A'</span>; <span class="hljs-comment">// 笑脸符号的Unicode</span>
        System.out.println(<span class="hljs-string">"特殊符号: "</span> + heart + <span class="hljs-string">" "</span> + smiley);
        
        <span class="hljs-comment">// 实际应用：密码验证</span>
        <span class="hljs-type">char</span> <span class="hljs-variable">firstChar</span> <span class="hljs-operator">=</span> <span class="hljs-string">'a'</span>;
        <span class="hljs-type">char</span> <span class="hljs-variable">lastChar</span> <span class="hljs-operator">=</span> <span class="hljs-string">'z'</span>;
        System.out.println(<span class="hljs-string">"字母范围: "</span> + firstChar + <span class="hljs-string">" 到 "</span> + lastChar);
        
        <span class="hljs-comment">// char和int的转换</span>
        <span class="hljs-type">char</span> <span class="hljs-variable">letter</span> <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">asciiValue</span> <span class="hljs-operator">=</span> letter;  <span class="hljs-comment">// 自动转换为ASCII码</span>
        System.out.println(<span class="hljs-string">"字符'A'的ASCII码是: "</span> + asciiValue);
        
        <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">66</span>;
        <span class="hljs-type">char</span> <span class="hljs-variable">correspondingChar</span> <span class="hljs-operator">=</span> (<span class="hljs-type">char</span>) number; <span class="hljs-comment">// 强制转换为字符</span>
        System.out.println(<span class="hljs-string">"ASCII码66对应的字符是: "</span> + correspondingChar);
    }
}
</code></pre>
<h3 data-id="heading-4">第4组：布尔组（真假判断）</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BooleanType</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 布尔类型 ==="</span>);
        
        <span class="hljs-comment">// boolean：只有两个值 true 或 false</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isJavaFun</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isFishFly</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        
        System.out.println(<span class="hljs-string">"学Java有趣吗？"</span> + isJavaFun);
        System.out.println(<span class="hljs-string">"鱼会飞吗？"</span> + isFishFly);
        
        <span class="hljs-comment">// 实际应用：条件判断</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isRaining</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasUmbrella</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        
        System.out.println(<span class="hljs-string">"正在下雨: "</span> + isRaining);
        System.out.println(<span class="hljs-string">"有雨伞: "</span> + hasUmbrella);
        
        <span class="hljs-keyword">if</span> (isRaining &amp;&amp; !hasUmbrella) {
            System.out.println(<span class="hljs-string">"结论：你会被淋湿！"</span>);
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"结论：你不会被淋湿！"</span>);
        }
        
        <span class="hljs-comment">// 更多实际例子</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isWeekend</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isSunny</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isHoliday</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        
        <span class="hljs-type">boolean</span> <span class="hljs-variable">shouldGoOut</span> <span class="hljs-operator">=</span> isWeekend &amp;&amp; isSunny;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">canSleepLate</span> <span class="hljs-operator">=</span> isWeekend || isHoliday;
        
        System.out.println(<span class="hljs-string">"应该出去玩吗？"</span> + shouldGoOut);
        System.out.println(<span class="hljs-string">"可以睡懒觉吗？"</span> + canSleepLate);
    }
}
</code></pre>
<h2 data-id="heading-5">变量：数据的"存储盒子"</h2>
<h3 data-id="heading-6">变量三要素：类型、名字、值</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VariableDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 变量基础 ==="</span>);
        
        <span class="hljs-comment">// 变量声明三部曲</span>
        <span class="hljs-comment">// 1. 声明变量（创建盒子）</span>
        <span class="hljs-type">int</span> age;
        
        <span class="hljs-comment">// 2. 赋值（往盒子里放东西）</span>
        age = <span class="hljs-number">18</span>;
        
        <span class="hljs-comment">// 3. 使用变量（从盒子里取东西）</span>
        System.out.println(<span class="hljs-string">"我的年龄是: "</span> + age + <span class="hljs-string">"岁"</span>);
        
        <span class="hljs-comment">// 也可以一步到位</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"小明"</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> <span class="hljs-number">175.5</span>;
        
        System.out.println(<span class="hljs-string">"姓名: "</span> + name);
        System.out.println(<span class="hljs-string">"身高: "</span> + height + <span class="hljs-string">"厘米"</span>);
        
        <span class="hljs-comment">// 变量可以重新赋值（但类型不能变）</span>
        age = <span class="hljs-number">19</span>;  <span class="hljs-comment">// ✅ 正确：改变盒子的内容</span>
        System.out.println(<span class="hljs-string">"一年后，我的年龄是: "</span> + age + <span class="hljs-string">"岁"</span>);
        
        <span class="hljs-comment">// age = "十九岁";  // ❌ 错误：不能改变盒子的类型</span>
    }
}
</code></pre>
<h3 data-id="heading-7">变量命名规则（重要！）</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NamingRules</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 变量命名规则 ==="</span>);
        
        <span class="hljs-comment">// ✅ 正确的命名方式</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;                    <span class="hljs-comment">// 简单清晰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">studentName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"张三"</span>;     <span class="hljs-comment">// 驼峰命名法</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">totalPrice</span> <span class="hljs-operator">=</span> <span class="hljs-number">99.99</span>;       <span class="hljs-comment">// 描述性名称</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isPassed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;         <span class="hljs-comment">// 布尔变量用is/has开头</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">PI</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.14159</span>;       <span class="hljs-comment">// 常量全大写</span>
        
        <span class="hljs-comment">// ❌ 错误的命名方式（不要这样做！）</span>
        <span class="hljs-comment">// int 1age = 18;                 // 不能以数字开头</span>
        <span class="hljs-comment">// String student name = "李四";  // 不能有空格</span>
        <span class="hljs-comment">// double class = 3.14;           // 不能用关键字</span>
        <span class="hljs-comment">// int a = 10;                    // 太简单，没意义</span>
        
        <span class="hljs-comment">// 好的命名示例</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">numberOfStudents</span> <span class="hljs-operator">=</span> <span class="hljs-number">45</span>;       <span class="hljs-comment">// 清晰易懂</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">averageScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">85.5</span>;      <span class="hljs-comment">// 一看就知道是什么</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasPermission</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;    <span class="hljs-comment">// 布尔变量命名规范</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/home/user"</span>;  <span class="hljs-comment">// 描述清楚</span>
        
        System.out.println(<span class="hljs-string">"好名字让代码更易读！"</span>);
    }
}
</code></pre>
<h2 data-id="heading-8">类型转换：数据类型的"变形术"</h2>
<h3 data-id="heading-9">自动类型转换（小转大）</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoConversion</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 自动类型转换 ==="</span>);
        
        <span class="hljs-comment">// byte -&gt; short -&gt; int -&gt; long -&gt; float -&gt; double</span>
        <span class="hljs-comment">// char -&gt; int</span>
        <span class="hljs-comment">// 小类型自动转大类型（安全转换）</span>
        
        <span class="hljs-type">byte</span> <span class="hljs-variable">smallNumber</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">bigNumber</span> <span class="hljs-operator">=</span> smallNumber;  <span class="hljs-comment">// byte自动转int</span>
        System.out.println(<span class="hljs-string">"byte转int: "</span> + bigNumber);
        
        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> count;  <span class="hljs-comment">// int自动转double</span>
        System.out.println(<span class="hljs-string">"int转double: "</span> + price);
        
        <span class="hljs-type">char</span> <span class="hljs-variable">letter</span> <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">ascii</span> <span class="hljs-operator">=</span> letter;    <span class="hljs-comment">// char自动转int</span>
        System.out.println(<span class="hljs-string">"char转int: "</span> + ascii);
        
        <span class="hljs-comment">// 实际应用：计算平均值</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">totalScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">450</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">studentCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">average</span> <span class="hljs-operator">=</span> totalScore / (<span class="hljs-type">double</span>) studentCount; <span class="hljs-comment">// 自动转换</span>
        System.out.println(<span class="hljs-string">"平均分: "</span> + average);
    }
}
</code></pre>
<h3 data-id="heading-10">强制类型转换（大转小）</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForceConversion</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 强制类型转换 ==="</span>);
        
        <span class="hljs-comment">// 大类型转小类型需要强制转换（可能丢失数据）</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">bigNumber</span> <span class="hljs-operator">=</span> <span class="hljs-number">99.99</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">smallNumber</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) bigNumber;  <span class="hljs-comment">// 强制转换，小数部分丢失</span>
        System.out.println(<span class="hljs-string">"double 99.99 转 int: "</span> + smallNumber);
        
        <span class="hljs-type">long</span> <span class="hljs-variable">bigValue</span> <span class="hljs-operator">=</span> <span class="hljs-number">100000L</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">normalValue</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) bigValue;   <span class="hljs-comment">// 强制转换</span>
        System.out.println(<span class="hljs-string">"long转int: "</span> + normalValue);
        
        <span class="hljs-comment">// 注意：超出范围会出问题！</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">largeInt</span> <span class="hljs-operator">=</span> <span class="hljs-number">200</span>;
        <span class="hljs-type">byte</span> <span class="hljs-variable">tinyByte</span> <span class="hljs-operator">=</span> (<span class="hljs-type">byte</span>) largeInt;    <span class="hljs-comment">// byte最大127，这里会溢出</span>
        System.out.println(<span class="hljs-string">"int 200 转 byte: "</span> + tinyByte + <span class="hljs-string">" (溢出错误！)"</span>);
        
        <span class="hljs-comment">// 实际应用：商品价格取整</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">originalPrice</span> <span class="hljs-operator">=</span> <span class="hljs-number">299.99</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">roundedPrice</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) originalPrice;  <span class="hljs-comment">// 去掉小数部分</span>
        System.out.println(<span class="hljs-string">"原价: "</span> + originalPrice);
        System.out.println(<span class="hljs-string">"取整后: "</span> + roundedPrice);
    }
}
</code></pre>
<h2 data-id="heading-11">常量：不变的量</h2>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConstantDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 常量 ==="</span>);
        
        <span class="hljs-comment">// 使用final关键字定义常量</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">PI</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.1415926535</span>;    <span class="hljs-comment">// 数学常数π</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DAYS_IN_WEEK</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;        <span class="hljs-comment">// 一周天数</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">COMPANY_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"阿里巴巴"</span>; <span class="hljs-comment">// 公司名称</span>
        
        System.out.println(<span class="hljs-string">"圆周率: "</span> + PI);
        System.out.println(<span class="hljs-string">"一周有 "</span> + DAYS_IN_WEEK + <span class="hljs-string">" 天"</span>);
        System.out.println(<span class="hljs-string">"公司: "</span> + COMPANY_NAME);
        
        <span class="hljs-comment">// 常量一旦赋值就不能修改</span>
        <span class="hljs-comment">// PI = 3.14;  // ❌ 错误：不能修改常量</span>
        
        <span class="hljs-comment">// 实际应用：计算圆面积</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">radius</span> <span class="hljs-operator">=</span> <span class="hljs-number">5.0</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">circleArea</span> <span class="hljs-operator">=</span> PI * radius * radius;
        System.out.println(<span class="hljs-string">"半径为5的圆面积: "</span> + circleArea);
        
        <span class="hljs-comment">// 配置信息用常量</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_LOGIN_ATTEMPTS</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DATABASE_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">"jdbc:mysql://localhost:3306/test"</span>;
        <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">DEBUG_MODE</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        
        System.out.println(<span class="hljs-string">"最大登录尝试次数: "</span> + MAX_LOGIN_ATTEMPTS);
        System.out.println(<span class="hljs-string">"数据库连接: "</span> + DATABASE_URL);
        System.out.println(<span class="hljs-string">"调试模式: "</span> + DEBUG_MODE);
    }
}
</code></pre>
<h2 data-id="heading-12">综合实战：学生成绩管理系统</h2>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentGradeSystem</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 学生成绩管理系统 ==="</span>);
        
        <span class="hljs-comment">// 学生信息（使用合适的数据类型）</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">studentName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"张三"</span>;
        <span class="hljs-type">byte</span> <span class="hljs-variable">studentAge</span> <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">studentId</span> <span class="hljs-operator">=</span> <span class="hljs-number">2023001</span>;
        <span class="hljs-type">char</span> <span class="hljs-variable">studentClass</span> <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span>;
        
        <span class="hljs-comment">// 各科成绩</span>
        <span class="hljs-type">byte</span> <span class="hljs-variable">chineseScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">85</span>;      <span class="hljs-comment">// 0-100分，用byte足够</span>
        <span class="hljs-type">byte</span> <span class="hljs-variable">mathScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">92</span>;
        <span class="hljs-type">byte</span> <span class="hljs-variable">englishScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">78</span>;
        <span class="hljs-type">byte</span> <span class="hljs-variable">scienceScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">90</span>;
        
        <span class="hljs-comment">// 计算总分和平均分</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">totalScore</span> <span class="hljs-operator">=</span> chineseScore + mathScore + englishScore + scienceScore;
        <span class="hljs-type">double</span> <span class="hljs-variable">averageScore</span> <span class="hljs-operator">=</span> totalScore / <span class="hljs-number">4.0</span>;  <span class="hljs-comment">// 用double存小数</span>
        
        <span class="hljs-comment">// 判断是否及格</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isPassed</span> <span class="hljs-operator">=</span> averageScore &gt;= <span class="hljs-number">60</span>;
        
        <span class="hljs-comment">// 判断成绩等级</span>
        <span class="hljs-type">char</span> grade;
        <span class="hljs-keyword">if</span> (averageScore &gt;= <span class="hljs-number">90</span>) {
            grade = <span class="hljs-string">'A'</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (averageScore &gt;= <span class="hljs-number">80</span>) {
            grade = <span class="hljs-string">'B'</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (averageScore &gt;= <span class="hljs-number">70</span>) {
            grade = <span class="hljs-string">'C'</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (averageScore &gt;= <span class="hljs-number">60</span>) {
            grade = <span class="hljs-string">'D'</span>;
        } <span class="hljs-keyword">else</span> {
            grade = <span class="hljs-string">'F'</span>;
        }
        
        <span class="hljs-comment">// 输出学生信息</span>
        System.out.println(<span class="hljs-string">"===== 学生信息 ====="</span>);
        System.out.println(<span class="hljs-string">"姓名: "</span> + studentName);
        System.out.println(<span class="hljs-string">"年龄: "</span> + studentAge);
        System.out.println(<span class="hljs-string">"学号: "</span> + studentId);
        System.out.println(<span class="hljs-string">"班级: "</span> + studentClass + <span class="hljs-string">"班"</span>);
        
        System.out.println(<span class="hljs-string">"\n===== 成绩单 ====="</span>);
        System.out.println(<span class="hljs-string">"语文: "</span> + chineseScore + <span class="hljs-string">"分"</span>);
        System.out.println(<span class="hljs-string">"数学: "</span> + mathScore + <span class="hljs-string">"分"</span>);
        System.out.println(<span class="hljs-string">"英语: "</span> + englishScore + <span class="hljs-string">"分"</span>);
        System.out.println(<span class="hljs-string">"科学: "</span> + scienceScore + <span class="hljs-string">"分"</span>);
        
        System.out.println(<span class="hljs-string">"\n===== 统计 ====="</span>);
        System.out.println(<span class="hljs-string">"总分: "</span> + totalScore + <span class="hljs-string">"分"</span>);
        System.out.println(<span class="hljs-string">"平均分: "</span> + averageScore + <span class="hljs-string">"分"</span>);
        System.out.println(<span class="hljs-string">"是否及格: "</span> + (isPassed ? <span class="hljs-string">"是"</span> : <span class="hljs-string">"否"</span>));
        System.out.println(<span class="hljs-string">"成绩等级: "</span> + grade);
        
        <span class="hljs-comment">// 类型转换示例</span>
        System.out.println(<span class="hljs-string">"\n===== 类型转换示例 ====="</span>);
        <span class="hljs-type">double</span> <span class="hljs-variable">preciseAverage</span> <span class="hljs-operator">=</span> (<span class="hljs-type">double</span>) totalScore / <span class="hljs-number">4</span>;  <span class="hljs-comment">// 强制转换</span>
        System.out.println(<span class="hljs-string">"精确平均分: "</span> + preciseAverage);
        
        <span class="hljs-type">int</span> <span class="hljs-variable">roundedAverage</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) averageScore;  <span class="hljs-comment">// 去掉小数部分</span>
        System.out.println(<span class="hljs-string">"取整平均分: "</span> + roundedAverage);
    }
}
</code></pre>
<h2 data-id="heading-13">常见错误和注意事项</h2>
<h3 data-id="heading-14">错误示例：</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonMistakes</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. 未初始化就使用变量</span>
        <span class="hljs-comment">// int x;</span>
        <span class="hljs-comment">// System.out.println(x);  // ❌ 错误：变量未初始化</span>
        
        <span class="hljs-comment">// 2. 超出数据类型范围</span>
        <span class="hljs-comment">// byte b = 200;  // ❌ 错误：byte最大127</span>
        <span class="hljs-comment">// int i = 10000000000;  // ❌ 错误：超出int范围</span>
        
        <span class="hljs-comment">// 3. 类型不匹配</span>
        <span class="hljs-comment">// int num = 3.14;  // ❌ 错误：double不能直接赋给int</span>
        <span class="hljs-comment">// 正确做法：int num = (int)3.14;</span>
        
        <span class="hljs-comment">// 4. 使用错误的字面值</span>
        <span class="hljs-comment">// long l = 10000000000;  // ❌ 错误：需要加L</span>
        <span class="hljs-comment">// 正确做法：long l = 10000000000L;</span>
        
        <span class="hljs-comment">// 5. 变量名冲突</span>
        <span class="hljs-comment">// int age = 18;</span>
        <span class="hljs-comment">// int age = 20;  // ❌ 错误：重复定义</span>
        
        System.out.println(<span class="hljs-string">"记住这些常见错误，避免踩坑！"</span>);
    }
}
</code></pre>
<h3 data-id="heading-15">正确示例：</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BestPractices</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 最佳实践 ==="</span>);
        
        <span class="hljs-comment">// 1. 选择合适的数据类型</span>
        <span class="hljs-type">byte</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;              <span class="hljs-comment">// ✅ 年龄用byte足够</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">population</span> <span class="hljs-operator">=</span> <span class="hljs-number">1400000000</span>; <span class="hljs-comment">// ✅ 人口用int</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> <span class="hljs-number">19.99</span>;       <span class="hljs-comment">// ✅ 价格用double</span>
        
        <span class="hljs-comment">// 2. 使用有意义的变量名</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">numberOfStudents</span> <span class="hljs-operator">=</span> <span class="hljs-number">45</span>;  <span class="hljs-comment">// ✅ 清晰易懂</span>
        <span class="hljs-comment">// int n = 45;               // ❌ 太简略</span>
        
        <span class="hljs-comment">// 3. 及时初始化变量</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;              <span class="hljs-comment">// ✅ 声明时就初始化</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;           <span class="hljs-comment">// ✅ 给初始值</span>
        
        <span class="hljs-comment">// 4. 常量用final修饰</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">TAX_RATE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.13</span>;  <span class="hljs-comment">// ✅ 税率是常量</span>
        
        <span class="hljs-comment">// 5. 注意类型转换</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span> / <span class="hljs-number">3.0</span>;   <span class="hljs-comment">// ✅ 得到3.333...</span>
        <span class="hljs-comment">// double result = 10 / 3;   // ❌ 得到3.0</span>
        
        System.out.println(<span class="hljs-string">"好习惯让编程更轻松！"</span>);
    }
}
</code></pre>
<h2 data-id="heading-16">总结：最重要的三点</h2>
<ol>
<li>
<p><strong>选择合适的类型</strong>：根据数据特点选择最合适的数据类型</p>
<ul>
<li>整数用<code>int</code>，小数用<code>double</code></li>
<li>真假用<code>boolean</code>，字符用<code>char</code></li>
<li>大数字用<code>long</code>，小数字用<code>byte</code></li>
</ul>
</li>
<li>
<p><strong>变量名要有意义</strong>：让代码自己说话</p>
<ul>
<li><code>age</code>比<code>a</code>好</li>
<li><code>studentCount</code>比<code>sc</code>好</li>
<li><code>isPassed</code>比<code>ip</code>好</li>
</ul>
</li>
<li>
<p><strong>注意类型转换</strong>：避免数据丢失</p>
<ul>
<li>自动转换：小类型转大类型</li>
<li>强制转换：大类型转小类型（小心！）</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot ThreadLocal 父子线程传值的几种实现方式]]></title>    <link>https://juejin.cn/post/7579519985699848198</link>    <guid>https://juejin.cn/post/7579519985699848198</guid>    <pubDate>2025-12-04T00:05:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579519985699848198" data-draft-id="7579101504289308726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot ThreadLocal 父子线程传值的几种实现方式"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-04T00:05:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风象南"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot ThreadLocal 父子线程传值的几种实现方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风象南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:05:07.000Z" title="Thu Dec 04 2025 00:05:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    18
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在日常开发中，我们经常会遇到需要在父子线程之间传递数据的场景。比如用户身份信息、请求ID、链路追踪ID等。</p>
<p>ThreadLocal作为Java中重要的线程本地变量机制，为我们提供了在单个线程内存储数据的便利。但是，当涉及到父子线程之间的数据传递时，ThreadLocal默认的行为并不能满足我们的需求。</p>
<p>本文将介绍在SpringBoot应用中实现ThreadLocal父子线程传值的几种方式。</p>
<h2 data-id="heading-1">ThreadLocal 基础回顾</h2>
<p>首先，让我们简单回顾一下ThreadLocal的基本原理：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocal</span>&lt;T&gt; {
    <span class="hljs-comment">// 每个线程都有自己独立的ThreadLocalMap</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)
            map.set(<span class="hljs-built_in">this</span>, value);
        <span class="hljs-keyword">else</span>
            createMap(t, value);
    }

    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) {
            ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);
            <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) {
                <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
                <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;
                <span class="hljs-keyword">return</span> result;
            }
        }
        <span class="hljs-keyword">return</span> setInitialValue();
    }
}
</code></pre>
<p>ThreadLocal的核心思想是为每个线程维护一个独立的ThreadLocalMap，从而实现线程隔离。</p>
<h2 data-id="heading-2">问题的提出</h2>
<p>让我们通过一个简单的例子来看看ThreadLocal在父子线程中的默认行为</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocalDemo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;String&gt; threadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        threadLocal.set(<span class="hljs-string">"主线程的值"</span>);
        System.out.println(<span class="hljs-string">"主线程获取: "</span> + threadLocal.get()); <span class="hljs-comment">// 输出: 主线程的值</span>

        <span class="hljs-type">Thread</span> <span class="hljs-variable">childThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            System.out.println(<span class="hljs-string">"子线程获取: "</span> + threadLocal.get()); <span class="hljs-comment">// 输出: null</span>
        });
        childThread.start();
    }
}
</code></pre>
<p>从上面的例子可以看出，子线程无法访问父线程中设置的ThreadLocal值。这是因为每个线程都有自己独立的ThreadLocalMap。</p>
<h2 data-id="heading-3">解决方案一：InheritableThreadLocal</h2>
<p>Java为我们提供了InheritableThreadLocal来解决父子线程传值的问题</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InheritableThreadLocalDemo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> InheritableThreadLocal&lt;String&gt; inheritableThreadLocal =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InheritableThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        inheritableThreadLocal.set(<span class="hljs-string">"主线程的值"</span>);
        System.out.println(<span class="hljs-string">"主线程获取: "</span> + inheritableThreadLocal.get());

        <span class="hljs-type">Thread</span> <span class="hljs-variable">childThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            System.out.println(<span class="hljs-string">"子线程获取: "</span> + inheritableThreadLocal.get()); <span class="hljs-comment">// 输出: 主线程的值</span>
        });
        childThread.start();
    }
}
</code></pre>
<h4 data-id="heading-4">InheritableThreadLocal 原理分析</h4>
<p>InheritableThreadLocal的实现在Thread类中</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Thread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-comment">// 父线程的inheritableThreadLocals会在创建子线程时复制</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ThreadGroup g, Runnable target, String name,
                      <span class="hljs-type">long</span> stackSize, AccessControlContext acc,
                      <span class="hljs-type">boolean</span> inheritThreadLocals)</span> {
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">if</span> (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != <span class="hljs-literal">null</span>)
            <span class="hljs-built_in">this</span>.inheritableThreadLocals =
                ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<h4 data-id="heading-5">InheritableThreadLocal 的局限性</h4>
<ul>
<li><strong>1. 时机限制</strong>：只在创建线程时进行值传递，后续修改不会传递到已创建的子线程</li>
<li><strong>2. 线程池问题</strong>：在线程池中使用时，由于线程会被复用，可能导致数据混乱</li>
</ul>
<h2 data-id="heading-6">解决方案二：使用TransmittableThreadLocal</h2>
<p>阿里巴巴开源的TransmittableThreadLocal（TTL）是解决线程池场景下父子线程传值问题的优秀方案：</p>
<h4 data-id="heading-7">添加依赖</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>transmittable-thread-local<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.14.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">基本使用</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.alibaba.ttl.TransmittableThreadLocal;
<span class="hljs-keyword">import</span> com.alibaba.ttl.threadpool.TtlExecutors;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TtlDemo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> TransmittableThreadLocal&lt;String&gt; ttl = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        ttl.set(<span class="hljs-string">"主线程的值"</span>);
        System.out.println(<span class="hljs-string">"主线程获取: "</span> + ttl.get());

        <span class="hljs-comment">// 使用TTL装饰的线程池</span>
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> TtlExecutors.getTtlExecutorService(
            Executors.newFixedThreadPool(<span class="hljs-number">2</span>)
        );

        executor.submit(() -&gt; {
            System.out.println(<span class="hljs-string">"线程池任务1获取: "</span> + ttl.get()); <span class="hljs-comment">// 输出: 主线程的值</span>
        });

        <span class="hljs-comment">// 修改值后提交新任务</span>
        ttl.set(<span class="hljs-string">"更新后的值"</span>);
        executor.submit(() -&gt; {
            System.out.println(<span class="hljs-string">"线程池任务2获取: "</span> + ttl.get()); <span class="hljs-comment">// 输出: 更新后的值</span>
        });
    }
}
</code></pre>
<h4 data-id="heading-9">TTL 与Spring Boot的集成</h4>
<p>在Spring Boot应用中，我们可以通过以下方式集成TTL</p>
<h5 data-id="heading-10">1. 配置TTL异步执行器</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAsync</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncConfigurer</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">getAsyncExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
        executor.setCorePoolSize(<span class="hljs-number">5</span>);
        executor.setMaxPoolSize(<span class="hljs-number">10</span>);
        executor.setQueueCapacity(<span class="hljs-number">100</span>);
        executor.setThreadNamePrefix(<span class="hljs-string">"Async-"</span>);

        <span class="hljs-comment">// 使用TTL装饰</span>
        <span class="hljs-keyword">return</span> TtlExecutors.getTtlExecutor(executor);
    }
}
</code></pre>
<h5 data-id="heading-11">2. 使用TTL的请求拦截器</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TtlRequestInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> TransmittableThreadLocal&lt;String&gt; requestId =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;&gt;();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
                           Object handler)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        requestId.set(id);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
                              Object handler, Exception ex)</span> {
        requestId.remove(); <span class="hljs-comment">// 清理</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getRequestId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> requestId.get();
    }
}
</code></pre>
<h2 data-id="heading-12">解决方案三：自定义TaskDecorator</h2>
<p>Spring提供了TaskDecorator接口，允许我们对Runnable任务进行装饰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAsync</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomAsyncConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncConfigurer</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">getAsyncExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
        executor.setCorePoolSize(<span class="hljs-number">5</span>);
        executor.setMaxPoolSize(<span class="hljs-number">10</span>);
        executor.setQueueCapacity(<span class="hljs-number">100</span>);
        executor.setThreadNamePrefix(<span class="hljs-string">"CustomAsync-"</span>);

        <span class="hljs-comment">// 设置自定义装饰器</span>
        executor.setTaskDecorator(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ContextCopyingDecorator</span>());
        executor.initialize();

        <span class="hljs-keyword">return</span> executor;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContextCopyingDecorator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TaskDecorator</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Runnable <span class="hljs-title function_">decorate</span><span class="hljs-params">(Runnable runnable)</span> {
            <span class="hljs-comment">// 获取父线程的ThreadLocal上下文</span>
            Map&lt;String, Object&gt; context = getContextFromCurrentThread();
            <span class="hljs-keyword">return</span> () -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 在子线程中复制上下文</span>
                    setContextToCurrentThread(context);
                    runnable.run();
                } <span class="hljs-keyword">finally</span> {
                    clearCurrentThreadContext();
                }
            };
        }

        <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getContextFromCurrentThread</span><span class="hljs-params">()</span> {
            Map&lt;String, Object&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            <span class="hljs-comment">// 收集当前线程的ThreadLocal值</span>
            <span class="hljs-comment">// 例如：从自定义的ThreadLocal中获取</span>
            <span class="hljs-keyword">if</span> (UserContext.getUser() != <span class="hljs-literal">null</span>) {
                context.put(<span class="hljs-string">"userInfo"</span>, UserContext.getUser());
            }
            <span class="hljs-keyword">if</span> (RequestContextHolder.getRequestAttributes() != <span class="hljs-literal">null</span>) {
                context.put(<span class="hljs-string">"requestAttributes"</span>, RequestContextHolder.getRequestAttributes());
            }
            <span class="hljs-keyword">return</span> context;
        }

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContextToCurrentThread</span><span class="hljs-params">(Map&lt;String, Object&gt; context)</span> {
            <span class="hljs-comment">// 在子线程中设置上下文</span>
            <span class="hljs-keyword">if</span> (context.containsKey(<span class="hljs-string">"userInfo"</span>)) {
                UserContext.setUser((UserContext.UserInfo) context.get(<span class="hljs-string">"userInfo"</span>));
            }
            <span class="hljs-keyword">if</span> (context.containsKey(<span class="hljs-string">"requestAttributes"</span>)) {
                RequestContextHolder.setRequestAttributes((RequestAttributes) context.get(<span class="hljs-string">"requestAttributes"</span>));
            }
        }

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clearCurrentThreadContext</span><span class="hljs-params">()</span> {
            <span class="hljs-comment">// 清理上下文，防止内存泄漏</span>
            UserContext.clear();
            RequestContextHolder.resetRequestAttributes();
        }
    }
}
</code></pre>
<h2 data-id="heading-13">解决方案四：使用Spring的RequestContextHolder</h2>
<p>在Spring Web应用中，我们可以利用RequestContextHolder来传递请求上下文</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContextService</span> {

    <span class="hljs-meta">@Async</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;String&gt; <span class="hljs-title function_">asyncMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取父线程的请求上下文</span>
        <span class="hljs-type">RequestAttributes</span> <span class="hljs-variable">attributes</span> <span class="hljs-operator">=</span> RequestContextHolder.getRequestAttributes();

        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-comment">// 在异步线程中设置上下文</span>
            RequestContextHolder.setRequestAttributes(attributes);

            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 执行业务逻辑</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> doSomeWork();
                <span class="hljs-keyword">return</span> result;
            } <span class="hljs-keyword">finally</span> {
                RequestContextHolder.resetRequestAttributes();
            }
        });
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">doSomeWork</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取请求相关的信息</span>
        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span>
            ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();
        <span class="hljs-keyword">return</span> <span class="hljs-string">"处理完成: "</span> + request.getRequestURI();
    }
}
</code></pre>
<h2 data-id="heading-14">方案选择建议</h2>
<p>基于上述性能对比和适用场景，我们可以给出以下选择建议：</p>
<ul>
<li><strong>1. 简单的父子线程传值</strong>：使用InheritableThreadLocal</li>
<li><strong>2. 线程池场景</strong>：推荐使用TransmittableThreadLocal</li>
<li><strong>3. Spring异步任务</strong>：使用TaskDecorator</li>
<li><strong>4. Web应用请求上下文</strong>：使用RequestContextHolder</li>
</ul>
<h2 data-id="heading-15">最佳实践</h2>
<h4 data-id="heading-16">1. 内存泄漏预防</h4>
<p>无论使用哪种方案，都要注意及时清理ThreadLocal：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeThreadLocalUsage</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;Object&gt; threadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            threadLocal.set(someValue);
            <span class="hljs-comment">// 业务逻辑</span>
        } <span class="hljs-keyword">finally</span> {
            threadLocal.remove(); <span class="hljs-comment">// 防止内存泄漏</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-17">2. 上下文封装</h4>
<p>建议封装一个统一的上下文管理器：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserContext</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;UserInfo&gt; USER_CONTEXT =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUser</span><span class="hljs-params">(UserInfo user)</span> {
        USER_CONTEXT.set(user);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UserInfo <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> USER_CONTEXT.get();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        USER_CONTEXT.remove();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span> {
        <span class="hljs-keyword">private</span> String userId;
        <span class="hljs-keyword">private</span> String userName;
        <span class="hljs-keyword">private</span> String requestId;
        <span class="hljs-comment">// getters and setters</span>
    }
}
</code></pre>
<h4 data-id="heading-18">3. 拦截器统一管理</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserContextInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
                           Object handler)</span> {
        <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> buildUserInfo(request);
        UserContext.setUser(userInfo);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
                              Object handler, Exception ex)</span> {
        UserContext.clear();
    }

    <span class="hljs-keyword">private</span> UserInfo <span class="hljs-title function_">buildUserInfo</span><span class="hljs-params">(HttpServletRequest request)</span> {
        <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfo</span>();
        userInfo.setUserId(request.getHeader(<span class="hljs-string">"X-User-Id"</span>));
        userInfo.setRequestId(UUID.randomUUID().toString());
        <span class="hljs-keyword">return</span> userInfo;
    }
}
</code></pre>
<h2 data-id="heading-19">总结</h2>
<p>本文介绍了四种在SpringBoot中实现ThreadLocal父子线程传值的方案：</p>
<ul>
<li><strong>1. InheritableThreadLocal</strong>：最简单的原生解决方案，适用于基础场景</li>
<li><strong>2. TransmittableThreadLocal</strong>：功能强大的第三方解决方案，特别适合线程池场景</li>
<li><strong>3. TaskDecorator</strong>：Spring提供的优雅解决方案，集成度高</li>
<li><strong>4. RequestContextHolder</strong>：Spring Web应用的内置方案</li>
</ul>
<p>在实际项目中，我们应该根据具体的业务场景和技术栈选择合适的方案。</p>
<p>同时，要注意内存管理和上下文清理，确保系统的稳定性和性能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[脱离 SwiftUI 也能用 @Observable：深入理解 withObservationTracking 的玩法、坑点与 Swift 6 突围]]></title>    <link>https://juejin.cn/post/7579473409749614643</link>    <guid>https://juejin.cn/post/7579473409749614643</guid>    <pubDate>2025-12-04T00:08:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579473409749614643" data-draft-id="7550880849392599055" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="脱离 SwiftUI 也能用 @Observable：深入理解 withObservationTracking 的玩法、坑点与 Swift 6 突围"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-12-04T00:08:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            脱离 SwiftUI 也能用 @Observable：深入理解 withObservationTracking 的玩法、坑点与 Swift 6 突围
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:08:31.000Z" title="Thu Dec 04 2025 00:08:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>iOS 17 引入的 <code>@Observable</code> 宏让 SwiftUI 刷新机制大变天，但官方文档只告诉你“在 View 里用就行”。</p>
<p>如果我们想在 非 SwiftUI 场景（比如 NetworkLayer、ViewModel、Unit Test）里监听属性变化，就只能靠 <code>withObservationTracking</code>。</p>
<h2 data-id="heading-1">@Observable 是什么</h2>






























<table><thead><tr><th>特性</th><th>@Observable</th><th>ObservableObject + @Published</th></tr></thead><tbody><tr><td>适用系统</td><td>iOS 17+</td><td>iOS 13+</td></tr><tr><td>刷新粒度</td><td>属性级（仅变更的属性触发视图更新）</td><td>对象级（整个 <code>ObjectWillChange</code> 触发更新）</td></tr><tr><td>依赖协议</td><td>无需额外协议</td><td>必须继承 <code>ObservableObject</code> 协议</td></tr><tr><td>非 SwiftUI 监听</td><td>使用 <code>withObservationTracking</code> 闭包</td><td>使用 <code>objectWillChange</code> 发布者（Publisher）</td></tr></tbody></table>
<p>一句话： <code>@Observable</code> 是 Swift 5.9 宏加持的“轻量级可观测对象”，专为 SwiftUI 优化，但 宏本身不限制使用场景，所以我们可以在任意线程/任意模块里手动订阅。</p>
<h2 data-id="heading-2">withObservationTracking 原理解剖</h2>
<p>函数签名（简化）：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">withObservationTracking</span>&lt;<span class="hljs-type">T</span>&gt;(
  <span class="hljs-keyword">_</span> <span class="hljs-params">apply</span>: () -&gt; <span class="hljs-type">T</span>,          <span class="hljs-comment">// ① 访问属性 → 被记录</span>
  <span class="hljs-params">onChange</span>: <span class="hljs-keyword">@autoclosure</span> () -&gt; <span class="hljs-meta">@Sendable</span> () -&gt; <span class="hljs-type">Void</span>  <span class="hljs-comment">// ② 属性“即将”变时回调</span>
) -&gt; <span class="hljs-type">T</span>
</code></pre>
<p>关键行为：</p>
<ol>
<li>apply 闭包里访问到的任何被 <code>@Observable</code> 标记类的存储属性，都会被加入“本次观测清单”。</li>
<li>当清单里任意属性发生 willSet 时，系统会执行 onChange；</li>
<li>onChange 只会被触发一次，之后如果想继续监听，必须手动重新调用 <code>withObservationTracking</code>，即“递归订阅”。</li>
</ol>
<h2 data-id="heading-3">最小可运行示例</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Observation

<span class="hljs-comment">// 1. 声明被观测的模型</span>
<span class="hljs-meta">@Observable</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
}

<span class="hljs-comment">// 2. 声明监听者</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterObserver</span> {
    <span class="hljs-keyword">let</span> counter: <span class="hljs-type">Counter</span>
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">counter</span>: <span class="hljs-type">Counter</span>) {
        <span class="hljs-keyword">self</span>.counter <span class="hljs-operator">=</span> counter
    }
    
    <span class="hljs-comment">/// 开始监听，打印最新值</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">observe</span>() {
        <span class="hljs-comment">// ① apply 闭包：读取属性 → 被系统记录</span>
        <span class="hljs-comment">// ② onChange：count 即将改变时调用（旧值仍可见）</span>
        withObservationTracking {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"当前计数：<span class="hljs-subst">\(counter.count)</span>"</span>)
        } onChange: { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-comment">// 系统只给一次通知，想持续监听必须重新调用 observe()</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"检测到变化，重新订阅"</span>)
            <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.observe()
        }
    }
}

<span class="hljs-comment">// 3. 客户端代码</span>
<span class="hljs-keyword">let</span> counter <span class="hljs-operator">=</span> <span class="hljs-type">Counter</span>()
<span class="hljs-keyword">let</span> observer <span class="hljs-operator">=</span> <span class="hljs-type">CounterObserver</span>(counter: counter)

<span class="hljs-comment">// 启动监听</span>
observer.observe()

<span class="hljs-comment">// 制造变化</span>
counter.count <span class="hljs-operator">=</span> <span class="hljs-number">1</span>   <span class="hljs-comment">// 控制台：检测到变化，重新订阅 → 当前计数：1</span>
counter.count <span class="hljs-operator">=</span> <span class="hljs-number">2</span>   <span class="hljs-comment">// 同上</span>
</code></pre>
<h2 data-id="heading-4">坑点 1：onChange 给出的是“旧值”</h2>
<p>因为 onChange 触发在 willSet 阶段，所以闭包里再读属性仍是老数据。</p>
<p>解决思路：把读取动作推迟到下一个 RunLoop → 拿到 didSet 之后的新值。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">observe</span>() {
    withObservationTracking {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"RunLoop 前读取 → 旧值：<span class="hljs-subst">\(counter.count)</span>"</span>)
    } onChange: { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
        <span class="hljs-comment">// 关键：异步到下一轮</span>
        <span class="hljs-type">DispatchQueue</span>.main.async {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"RunLoop 后读取 → 新值：<span class="hljs-subst">\(<span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.counter.count <span class="hljs-operator">??</span> <span class="hljs-operator">-</span><span class="hljs-number">1</span>)</span>"</span>)
            <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.observe() <span class="hljs-comment">// 继续监听</span>
        }
    }
}
</code></pre>
<h2 data-id="heading-5">坑点 2：模板代码太多 → 二次封装</h2>
<p>每次手写“递归 + 异步”太烦，可以提炼成一个可重用的泛型助手：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Observation

<span class="hljs-comment">/// 让任意闭包“持续”被监听，自动 re-subscribe</span>
<span class="hljs-comment">/// - Parameter execute: 需要跟踪属性的读取闭包</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">keepObserving</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">AnyObject</span>&gt;(
    <span class="hljs-params">target</span>: <span class="hljs-type">T</span>,
    <span class="hljs-params">execute</span>: <span class="hljs-keyword">@escaping</span> <span class="hljs-meta">@Sendable</span> () -&gt; <span class="hljs-type">Void</span>
) {
    <span class="hljs-type">Observation</span>.withObservationTracking {
        execute()
    } onChange: {
        <span class="hljs-type">DispatchQueue</span>.main.async {
            keepObserving(target: target, execute: execute)
        }
    }
}
</code></pre>
<p>使用姿势：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterObserver</span> {
    <span class="hljs-keyword">let</span> counter: <span class="hljs-type">Counter</span>
    <span class="hljs-keyword">init</span>(<span class="hljs-params">counter</span>: <span class="hljs-type">Counter</span>) { <span class="hljs-keyword">self</span>.counter <span class="hljs-operator">=</span> counter }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">start</span>() {
        <span class="hljs-comment">// 捕获 [weak target] 防止循环引用</span>
        keepObserving(target: <span class="hljs-keyword">self</span>) { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"封装后读取：<span class="hljs-subst">\(<span class="hljs-keyword">self</span>.counter.count)</span>"</span>)
        }
    }
}
</code></pre>
<h2 data-id="heading-6">坑点 3：Swift 6 语言模式 + Sendable</h2>
<p>开启 Swift 6 后，编译器会报错：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Capture</span> <span class="hljs-keyword">of</span> <span class="hljs-string">'self'</span> <span class="hljs-keyword">with</span> non-sendable <span class="hljs-keyword">type</span> <span class="hljs-string">'CounterObserver?'</span> <span class="hljs-keyword">in</span> a <span class="hljs-string">`@Sendable`</span> closure
</code></pre>
<p>原因：</p>
<p><code>withObservationTracking</code> 的 onChange 要求 <code>@Sendable</code>，意味着闭包里不能捕获“非 Sendable”的引用类型。</p>
<p>但 <code>@Observable</code> 类默认包含可变状态，无法自动符合 Sendable；如果我们把 Observer 标成 <code>@MainActor</code>，又会触发“MainActor隔离属性不能出现在 Sendable 闭包”的新错误。</p>
<p>折中方案</p>
<ol>
<li>把 Observer 整体标为 <code>@MainActor</code>；</li>
<li>在闭包内部再包一层 <code>Task { @MainActor in ... }</code> 异步读取；</li>
<li>或者 给 Observer 打上 <code>@unchecked Sendable</code> 并自行保证线程安全（例如全部属性都通过 DispatchQueue 或 Actor 同步）。</li>
</ol>
<p>示例：@MainActor 内再开 Task</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-meta">@MainActor</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterObserver</span>: <span class="hljs-title class_">Sendable</span> /* 手动保证 */ {
    <span class="hljs-keyword">init</span>(<span class="hljs-params">counter</span>: <span class="hljs-type">Counter</span>) {
        <span class="hljs-keyword">self</span>.counter <span class="hljs-operator">=</span> counter
    }
    
    <span class="hljs-keyword">let</span> counter: <span class="hljs-type">Counter</span>
    
    <span class="hljs-keyword">nonisolated</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">start</span>() {
        <span class="hljs-type">Observation</span>.withObservationTracking { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-comment">// 这里不能直接接触 counter，因为它被隔离在 @MainActor</span>
            <span class="hljs-comment">// 只记录“我关心”的事实，不读取值</span>
            <span class="hljs-keyword">return</span> () <span class="hljs-comment">// 仅触发跟踪</span>
        } onChange: { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-type">Task</span> { <span class="hljs-meta">@MainActor</span> <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Swift6 模式新值：<span class="hljs-subst">\(<span class="hljs-keyword">self</span>.counter.count)</span>"</span>)
                <span class="hljs-keyword">self</span>.start() <span class="hljs-comment">// 继续</span>
            }
        }
    }
}
</code></pre>
<p>注意：由于 apply 闭包不能跨 Actor 读取，我们只能“空跑”跟踪，再在 Task 里安全取值。</p>
<p>这会导致 一次 onChange 只能异步拿到值，且如果属性变化非常快，中间事件可能丢失。</p>
<p>在 Swift 6 严苛模式下，Combine 的 <code>@Published</code> 仍是更成熟的答案。</p>
<h2 data-id="heading-7">完整可落地模板</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">//</span>
<span class="hljs-comment">//  ObservableUtils.swift</span>
<span class="hljs-comment">//  用前导入 Observation 模块</span>
<span class="hljs-comment">//</span>

<span class="hljs-keyword">import</span> Foundation
<span class="hljs-keyword">import</span> Observation

<span class="hljs-comment">/// 线程安全且支持 Swift 6 的“属性监听”工具箱</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">actor</span> <span class="hljs-title class_">ObservableListener</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> token: (() -&gt; <span class="hljs-type">Void</span>)<span class="hljs-operator">?</span> <span class="hljs-comment">// 用于将来做手动取消</span>
    
    <span class="hljs-comment">/// 持续监听目标对象指定 KeyPath 的新值</span>
    <span class="hljs-comment">/// - Parameters:</span>
    <span class="hljs-comment">///   - object: 被 @Observable 标记的实例</span>
    <span class="hljs-comment">///   - keyPath: 要读取的 KeyPath</span>
    <span class="hljs-comment">///   - handler: 变化后异步回调新值</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">keep</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">Any</span>, <span class="hljs-type">V</span>&gt;(
        <span class="hljs-params">object</span>: <span class="hljs-type">T</span>,
        <span class="hljs-params">keyPath</span>: <span class="hljs-type">KeyPath</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-type">V</span>&gt;,
        <span class="hljs-params">handler</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">V</span>) -&gt; <span class="hljs-type">Void</span>
    ) <span class="hljs-keyword">where</span> <span class="hljs-type">T</span>: <span class="hljs-type">Observable</span> {
        <span class="hljs-comment">// 用 Task 保证与 actor 隔离</span>
        <span class="hljs-type">Task</span> {
            <span class="hljs-type">Observation</span>.withObservationTracking {
                <span class="hljs-comment">// 空读取，只为登记依赖</span>
                <span class="hljs-keyword">_</span> <span class="hljs-operator">=</span> object[keyPath: keyPath]
            } onChange: { [<span class="hljs-keyword">weak</span> object] <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> object <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
                <span class="hljs-type">Task</span> { <span class="hljs-meta">@MainActor</span> <span class="hljs-keyword">in</span>
                    <span class="hljs-comment">// 下一轮 RunLoop 拿到新值</span>
                    handler(object[keyPath: keyPath])
                }
                <span class="hljs-comment">// 继续监听</span>
                <span class="hljs-keyword">self</span>.keep(object: object, keyPath: keyPath, handler: handler)
            }
        }
    }
}

<span class="hljs-comment">// ====== 使用示例 ======</span>
<span class="hljs-meta">@Observable</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">var</span> name <span class="hljs-operator">=</span> <span class="hljs-string">"Tom"</span>
    <span class="hljs-keyword">var</span> age  <span class="hljs-operator">=</span> <span class="hljs-number">18</span>
}

<span class="hljs-keyword">let</span> listener <span class="hljs-operator">=</span> <span class="hljs-type">ObservableListener</span>()
<span class="hljs-keyword">let</span> user <span class="hljs-operator">=</span> <span class="hljs-type">User</span>()

<span class="hljs-type">Task</span> {
    <span class="hljs-keyword">await</span> listener.keep(object: user, keyPath: \.name) { newName <span class="hljs-keyword">in</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"用户名已变更为：<span class="hljs-subst">\(newName)</span>"</span>)
    }
}

user.name <span class="hljs-operator">=</span> <span class="hljs-string">"Jerry"</span>   <span class="hljs-comment">// → 用户名已变更为：Jerry</span>
user.name <span class="hljs-operator">=</span> <span class="hljs-string">"Spike"</span>   <span class="hljs-comment">// → 用户名已变更为：Spike</span>
</code></pre>
<h2 data-id="heading-8">总结与思考</h2>
<ol>
<li>
<p>宏 ≠ 魔法</p>
<p><code>@Observable</code> 只是帮你自动生成 <code>ObservationRegistrar</code> 代码，真正的订阅逻辑仍依赖 <code>withObservationTracking</code>。</p>
</li>
<li>
<p>willSet 语义是最大绊脚石</p>
<p>这意味着它更适合“触发刷新”而不是“精确拿到新值”。如果你必须依赖“每一次新值”，要么异步到下一轮，要么回到 Combine。</p>
</li>
<li>
<p>递归订阅是官方默许的“官方模式”</p>
<p>别嫌它丑，目前 API 就是这样设计的；封装后可以让调用方无感。</p>
</li>
<li>
<p>Swift 6 的 Sendable 检查让“跨 Actor 读取”几乎无解</p>
<p>除非苹果将来放宽 <code>withObservationTracking</code> 的 <code>@Sendable</code> 要求，否则在严苛并发场景下，Combine/AsyncSequence 才是更稳妥的事件源。</p>
</li>
<li>
<p>适用场景推荐</p>
<ul>
<li>✅ 局部刷新：日志面板、调试计数器、调试 UI。</li>
<li>✅ SwiftUI 外部但主线程内：Widget 的 Timeline 生成、Preview 更新。</li>
<li>⚠️ 高吞吐实时数据：音频采样、传感器 120Hz 上报 → 建议 Combine + 环形缓冲区。</li>
<li>❌ 需要线程跳变/Actor 隔离：Swift 6 模式下成本</li>
</ul>
</li>
</ol>
<h2 data-id="heading-9">学习资料</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.donnywals.com%2Fobserving-properties-on-an-observable-class-outside-of-swiftui-views%2F" target="_blank" title="https://www.donnywals.com/observing-properties-on-an-observable-class-outside-of-swiftui-views/" ref="nofollow noopener noreferrer">www.donnywals.com/observing-p…</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3性能优化实战：5个被低估的Composition API技巧让你的应用快30%]]></title>    <link>https://juejin.cn/post/7579476335556804643</link>    <guid>https://juejin.cn/post/7579476335556804643</guid>    <pubDate>2025-12-04T00:16:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579476335556804643" data-draft-id="7579485652527169571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3性能优化实战：5个被低估的Composition API技巧让你的应用快30%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-04T00:16:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3性能优化实战：5个被低估的Composition API技巧让你的应用快30%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:16:48.000Z" title="Thu Dec 04 2025 00:16:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Vue3性能优化实战：5个被低估的Composition API技巧让你的应用快30%</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>在Vue3的生态中，Composition API已经成为现代前端开发的标配。然而，许多开发者仅仅停留在基础用法的层面，未能充分挖掘其性能优化的潜力。本文将深入剖析5个被严重低估的Composition API技巧，通过实际案例和性能对比数据，展示如何通过这些技巧实现高达30%的性能提升。</p>
<p>这些优化手段均经过真实项目验证，涉及响应式系统优化、渲染机制控制以及内存管理等多个维度。无论你是正在开发大型企业应用还是高性能组件库，这些技术都将成为你的秘密武器。</p>
<h2 data-id="heading-2">一、<code>shallowRef</code>与<code>shallowReactive</code>的精准控制</h2>
<h3 data-id="heading-3">问题背景</h3>
<p>默认情况下，Vue的<code>ref</code>和<code>reactive</code>会进行深层响应式转换。当我们处理大型对象或嵌套数据结构时，这种自动深度监听会成为性能瓶颈。</p>
<h3 data-id="heading-4">解决方案</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> heavyData = <span class="hljs-title function_">shallowRef</span>({ 
  <span class="hljs-comment">/* 多层嵌套结构 */</span> 
})

<span class="hljs-keyword">const</span> config = <span class="hljs-title function_">shallowReactive</span>({
  <span class="hljs-comment">/* 不需要深层追踪的配置项 */</span>
})
</code></pre>
<h3 data-id="heading-5">技术原理</h3>
<ol>
<li><code>shallowRef</code>仅对<code>.value</code>的引用变化做出响应</li>
<li><code>shallowReactive</code>只创建第一层属性的响应式代理</li>
</ol>
<h3 data-id="heading-6">实测数据</h3>
<p>在处理包含1000+节点的树形结构时：</p>
<ul>
<li>初始化速度提升45%</li>
<li>内存占用减少38%</li>
</ul>
<h3 data-id="heading-7">适用场景</h3>
<ul>
<li>第三方库返回的大型不可变数据</li>
<li>频繁更新的UI状态管理</li>
<li>WebSocket推送的大量数据</li>
</ul>
<h2 data-id="heading-8">二、<code>markRaw</code>防御性编程的艺术</h2>
<h3 data-id="heading-9">性能陷阱实例</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">list</span>: bigDataArray, <span class="hljs-comment">// Vue会尝试代理整个数组</span>
})
</code></pre>
<h3 data-id="heading-10">优化方案</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { markRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

state.<span class="hljs-property">list</span> = <span class="hljs-title function_">markRaw</span>(bigDataArray) <span class="hljs-comment">// Vue跳过响应式转换</span>
</code></pre>
<h3 data-id="heading-11">关键洞察</h3>
<ol>
<li><code>markRaw</code>不是禁止修改对象，而是跳过代理创建</li>
<li>VS Code扩展"Vue-Optimize"可自动检测需要markRaw的场景</li>
</ol>
<h3 data-id="heading-12">Benchmark对比</h3>















<table><thead><tr><th>Operation</th><th>Before (ops/sec)</th><th>After (ops/sec)</th></tr></thead><tbody><tr><td>Array push</td><td>12,341</td><td>48,765 (+295%)</td></tr></tbody></table>
<h2 data-id="heading-13">三、自定义Ref的精妙封装</h2>
<h3 data-id="heading-14"><code>computed</code>的性能局限案例</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// A.传统写法 - computed每次都会重新计算全量数据 </span>
<span class="hljs-keyword">const</span> fullName = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${firstName.value}</span> <span class="hljs-subst">${lastName.value}</span>`</span>)
</code></pre>
<h3 data-id="heading-15"><code>customRef</code>优化实现：</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">optimizedRef</span>(<span class="hljs-params">getter</span>) {
  <span class="hljs-keyword">let</span> cachedValue;
  
<span class="hljs-keyword">return</span> <span class="hljs-title function_">customRef</span>(<span class="hljs-function">(<span class="hljs-params">track, trigger</span>) =&gt;</span> ({
    <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
      <span class="hljs-title function_">track</span>()
      <span class="hljs-keyword">return</span> cachedValue || <span class="hljs-title function_">getter</span>()
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">newVal</span>) {
      <span class="hljs-keyword">if</span> (newVal !== cachedValue) {
        cachedValue = newVal;
        <span class="hljs-title function_">trigger</span>();
      }
    }
}))
}
</code></pre>
<h3 data-id="heading-16">Diff算法影响分析：</h3>
<ol>
<li>Memoized模式减少不必要的依赖触发次数达60%</li>
<li>SSR场景下hydration时间缩短22%</li>
</ol>
<p>##四、Effect作用域管理进阶：effectScope</p>
<p>###经典内存泄漏场景：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> { ... },<span class="hljs-number">1000</span>) <span class="hljs-comment">//组件卸载后依然存在！</span>
})
</code></pre>
<p>###现代化解决方案：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { effectScope } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
<span class="hljs-keyword">const</span> scope = <span class="hljs-title function_">effectScope</span>()

scope.<span class="hljs-title function_">run</span>(<span class="hljs-function">() =&gt;</span> {
<span class="hljs-comment">//所有组合式API调用在此作用域内  </span>
})

<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> scope.<span class="hljs-title function_">stop</span>()) <span class="hljs-comment">//一键清理！</span>
}
</code></pre>
<p>###架构优势：
1.插件系统自动回收资源<br/>
2.Micro-frontends场景下的沙箱隔离<br/>
3.TDD测试用例的cleanup标准化</p>
<p>##五、readonly的高阶应用模式</p>
<p>####常规误用示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//只是类型提示不可变！运行时仍可变！  </span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">Readonly</span>&lt;<span class="hljs-title class_">Config</span>&gt; = <span class="hljs-title function_">reactive</span>(configObj)
</code></pre>
<p>####正确实现方式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { readonly } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> immutableConfig = <span class="hljs-title function_">readonly</span>(<span class="hljs-title function_">reactive</span>(configObj)) 

<span class="hljs-comment">//开发环境会抛出警告  </span>
immutableConfig.<span class="hljs-property">key</span> = <span class="hljs-string">'newValue'</span> ❌   
</code></pre>
<p>####性能增强技巧组合：<br/>
1.readonly + shallowReactive →轻量不可变状态容器<br/>
2.Vite插件自动转换env变量为readonly</p>
<p>####TypeScript深度集成：<br/>
通过泛型推导实现编译时+运行时的双重保护</p>
<hr/>
<p>##总结</p>
<p>本文揭示的五项关键技术形成了完整的性能优化矩阵：</p>
<p>1.<strong>层级控制</strong>：shallow系列解决深度响应开销问题<br/>
2.<strong>边界防御</strong>：markRaw防止意外的代理扩散<br/>
3.<strong>智能缓存</strong>：customRef突破computed的限制<br/>
4.<strong>资源治理</strong>：effectScope重构副作用管理体系<br/>
5.<strong>不变约束</strong>：readonly构建安全的共享状态</p>
<p>这些技术的复合使用效果远超单点优化。在一个中型SaaS项目的实测中：</p>
<p>✅首屏加载时间减少28%<br/>
✅内存泄漏发生率降低92%<br/>
✅复杂表单交互帧率提升至60FPS</p>
<p>要真正掌握这些技巧，建议从以下路径逐步实施：</p>
<p>1.使用Chrome Performance Tab建立基准测试<br/>
2.优先处理高频更新的核心模块<br/>
3.建立ESLint规则防止退化</p>
<p>Vue3的性能潜力远不止于此。随着Vapor Mode等新特性的到来，我们即将进入一个新的前端性能纪元。现在就开始实践这些技术吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[裁员为什么先裁技术人员？网友一针见血]]></title>    <link>https://juejin.cn/post/7579499567869116466</link>    <guid>https://juejin.cn/post/7579499567869116466</guid>    <pubDate>2025-12-04T00:51:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579499567869116466" data-draft-id="7579518059171037210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="裁员为什么先裁技术人员？网友一针见血"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2025-12-04T00:51:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CodeSheep"/> <meta itemprop="url" content="https://juejin.cn/user/4371313961738616"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            裁员为什么先裁技术人员？网友一针见血
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4371313961738616/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CodeSheep
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:51:29.000Z" title="Thu Dec 04 2025 00:51:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近逛职场社区的时候，刷到一个职场话题，老生常谈了，但是每次参与讨论的同学都好多。</p>
<p>这个问题问得比较扎心：</p>
<p><strong>“为什么有些企业的裁员首先从技术人员开始？”</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/895d1a1dc5544b9eb3066acb7eabe651~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765414289&amp;x-signature=qFbxHa0RINzHwzF3522wqQJzWI8%3D" alt="" loading="lazy"/></p>
<p>关于这个问题，网上有一个被讨论很多的比喻：</p>
<p><strong>“房子都盖起来了，还需要工人么？”</strong></p>
<p>有一说一，这个比喻虽然刺耳，但却非常形象地揭示了某些企业的用人逻辑，尤其在<strong>某些非技术驱动型的公司里</strong>。</p>
<p>在某些非技术驱动的公司（比如传统企业转型、或者业务模式成型的公司），其实技术部门很多时候是会被视为「<strong>成本中心</strong>」，而非「<strong>利润中心</strong>」的，我相信在这类企业待过的技术同学肯定是深有体会。</p>
<p>就像盖大楼一样，公司需要做一个 App，或者搞一个系统，于是高薪招来一帮程序员“垒代码”。</p>
<p>当这个产品上线，业务跑通了，进入了平稳运营期，公司<strong>某些大聪明老板</strong>总会觉得“房子”已经盖好了。</p>
<p>这时候，一些开发人员在老板眼里就变成了“冗余”的成本。</p>
<p>大家知道，销售部门、业务部门能直接带来现金流，市场部能带来用户，而技术部门的代码是最看不见摸不着的。</p>
<p>一旦没有新的大项目启动，老板会觉得技术人员坐在那里就是在“烧钱”。</p>
<p>那抛开这个“盖楼”的比喻，在这种非技术驱动的公司里，从纯粹的财务角度来看，裁技术岗往往是因为“<strong>性价比</strong>”太低。</p>
<p>所以这里我们不得不面对的一个现实是：技术人员通常是公司里薪资最高的一群人。</p>
<p>高薪是一把双刃剑呐。</p>
<p>一个初级程序员的月薪可能抵得上两个行政，一个资深架构师的年薪可能抵得上一个小团队的运营费用。当公司面临现金流危机，需要快速削减成本时，裁掉一个高级技术人员省下来的钱，相当于裁掉好几个非技术岗位人员。</p>
<p>除此之外还有一个比较尴尬的事情那就是，在技术团队中，往往存在着一种“金字塔”结构。</p>
<p>随着工龄增长，薪资涨幅很快，但产出效率（在老板眼里）未必能线性增长。</p>
<p>脑补一下这个场景就知道了：</p>
<ul>
<li>一个 35 岁的高级工程师，月薪 4 万，可能要养家糊口，精力不如 20 多岁的小年轻，加班意愿低。</li>
<li>一个 23 岁的小年轻，月薪 1 万 5，充满激情，能扛能造。</li>
</ul>
<p>这时候<strong>某些大聪明老板</strong>的算盘就又打起来了：</p>
<p>裁掉一个 4 万的老员工，招两个 1 万 5 的小年轻，代码量翻倍，团队氛围更活跃，成本还降了，这种“优化”在管理层眼里，简直是“降本增效”的典范。</p>
<p>所以综合上面这种种情形分析，这时候，文章开头的那个问题往往也就会逐渐形成了。</p>
<p>所以事就是这么个事，说再多也没用。</p>
<p>既然环境不能左右，那<strong>作为个体，我们又该如何自处呢</strong>？</p>
<p><strong>这里我不想灌鸡汤，只想务实地聊一聊我所理解的一些对策</strong>，希望能对大家有所启发。</p>
<p>同时这也是我给很多后台私信我类似问题小伙伴们的一些共同建议。</p>
<p><strong>1、跳出技术思维，建立业务思维</strong></p>
<p>千万不要只盯着你的 IDE 和那一亩三分地代码，抽空多了解了解业务和流程吧，比如：</p>
<ul>
<li>项目是靠什么赚钱的？</li>
<li>你的代码在哪个环节为公司省钱或挣钱？</li>
<li>如果你是老板，你会怎么优化现在的系统？</li>
</ul>
<p>当你能用技术手段去解决业务痛点（比如提升转化率、降低服务器成本）时，你就不再是成本，而是资产。</p>
<p><strong>2、别温水煮青蛙，要保持技能更新</strong></p>
<p>这一点之前咱们这里多次提及，在技术行业，吃“老本”是最危险的。</p>
<p>当今的技术世界变化太快，而作为程序员的我们则恰好处于这一洪流之中，这既是挑战，也是机会。</p>
<p>还是那句话，一定要<strong>定期评估一下自己的市场价值</strong>：如果明天就离开现在的公司，你的技能和经验是否足以让你在市场上获得同等或更好的位置？</p>
<p>无论在公司工作多久，都要不断更新自己的技能和知识，确保自己始终具有市场竞争力。</p>
<p><strong>3、别让自己的工作经验烂掉，有意识地积累职业资产</strong></p>
<p>这一点我们之前其实也聊过。</p>
<p>除了特定的技术、代码、框架可以作为自己可积累的能力资产之外，其实程序员的职业生涯里也是可以有很多可固化和可积累的有形资产的。</p>
<p>比如你的技术经历、思维、经验、感悟是不是可以写成技术博客文字？你写的代码、工具、框架是不是可以形成开源项目？你的工作笔记和踩坑记录是不是可以整理成技术手册？</p>
<p>千万不要让自己的工作经验烂掉，而是要有意识地将自己的技术资产化，将自己的过往经验、知识、能力转化成在行业里有影响力的硬通货。</p>
<p><strong>4、尽早构建 Plan B，提升抗风险能力</strong></p>
<p>当然这一点虽然说的简单，其实对人的要求是比较高的。前面几点做好了，这一点有时候往往就会水到渠成。</p>
<p>我觉得总体的方向应该是：尽量利用你的技术特长来构建一个可持续的 Plan B。</p>
<p>比方说：开发一个小工具、写写技术专栏、或者运营一个 GitHub 项目、在技术博客或社区中建立个人品牌...等等，这些不仅仅能增加收入，往往还能拓展你的人脉圈。</p>
<p>其实很多程序员在年龄大了之后越来越焦虑的一个重要原因就是因为生存技能太过单一了，所以千万不要给自己设限，埋头赶路的同时也不要忘记时常抬头看看周围的环境和机会。</p>
<p>好了，今天就先聊这么多吧，希望能对大家有所启发，我们下篇见。</p>
<blockquote>
<p>注：本文在GitHub开源仓库「编程之路」 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frd2coding%2FRoad2Coding" target="_blank" title="https://github.com/rd2coding/Road2Coding" ref="nofollow noopener noreferrer">github.com/rd2coding/R…</a> 中已经收录，里面有我整理的6大编程方向(岗位)的自学路线+知识点大梳理、面试考点、我的简历、几本硬核pdf笔记，以及程序员生活和感悟，欢迎star。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：安装 Node.js 与 npm / yarn]]></title>    <link>https://juejin.cn/post/7579673620939767858</link>    <guid>https://juejin.cn/post/7579673620939767858</guid>    <pubDate>2025-12-04T00:55:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579673620939767858" data-draft-id="7579512734296178726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：安装 Node.js 与 npm / yarn"/> <meta itemprop="keywords" content="后端,Node.js,Trae"/> <meta itemprop="datePublished" content="2025-12-04T00:55:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：安装 Node.js 与 npm / yarn
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:55:17.000Z" title="Thu Dec 04 2025 00:55:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在开始学习 Node.js 之前，首先要完成运行环境的安装与配置。Node.js 是 JavaScript 在服务器端运行的基础平台，几乎所有 Node 项目都依赖它运行。如果环境搭建不规范，后续会频繁遇到依赖报错、版本冲突、项目无法启动等问题。因此，在真正写代码之前，先把环境装对、装稳，是非常重要的一步。</p>
<hr/>
<h2 data-id="heading-0">一、选择合适的 Node.js 版本</h2>
<p>Node.js 提供多个版本类型，其中最常用的是 LTS 版本和当前版本。</p>
<p>LTS 版本适合长期开发和生产环境，稳定、兼容性好。
当前版本包含最新特性，但可能存在不稳定情况。</p>
<p>对于大多数开发者来说，推荐使用 LTS 作为默认开发版本，这样可以最大程度避免因为版本升级带来的兼容性问题。</p>
<hr/>
<h2 data-id="heading-1">二、不同操作系统的安装方式</h2>
<h3 data-id="heading-2">Windows</h3>
<p>Windows 用户可以直接下载安装包，按照提示一步步安装。
安装时注意勾选添加环境变量，确保可以在命令行中使用 node 命令。</p>
<h3 data-id="heading-3">macOS</h3>
<p>macOS 用户更适合使用包管理工具安装，比如 Homebrew。
使用包管理器可以方便升级和卸载，也更符合开发者习惯。</p>
<h3 data-id="heading-4">Linux</h3>
<p>Linux 用户可以通过系统包管理器安装。
但应避免使用系统自带旧版本，建议使用官方提供的软件源获取最新 LTS。</p>
<hr/>
<h2 data-id="heading-5">三、验证是否安装成功</h2>
<p>安装完成后，在终端输入以下命令：</p>
<pre><code class="hljs language-bash" lang="bash">node -v
npm -v
</code></pre>
<p>如果可以看到版本号输出，说明 Node.js 和 npm 已成功安装。</p>
<hr/>
<h2 data-id="heading-6">四、npm 的作用是什么</h2>
<p>npm 是 Node.js 自带的包管理工具，主要用于管理第三方库。</p>
<p>它可以完成的事情包括：</p>
<ul>
<li>安装项目依赖</li>
<li>管理版本关系</li>
<li>更新与删除库</li>
<li>执行项目脚本</li>
</ul>
<p>在 Node.js 项目中，package.json 文件用于记录依赖关系与运行方式。
通过这个文件，可以在任何一台机器上快速恢复完整开发环境。</p>
<hr/>
<h2 data-id="heading-7">五、yarn 与 npm 的区别</h2>
<p>yarn 是另一种流行的包管理工具。</p>
<p>相比 npm，yarn 提供了更严格的依赖锁定机制，可以保证多人协作时依赖一致。</p>
<p>在安装速度方面，yarn 通常更快；
在生态方面，npm 使用范围更广。</p>
<p>选择哪个工具并不重要，<strong>重要的是保持统一</strong>。
一个项目中不应同时混用多个包管理工具。</p>
<hr/>
<h2 data-id="heading-8">六、建议使用 Node.js 版本管理工具</h2>
<p>在实际开发中，不同项目对 Node.js 版本要求不同。</p>
<p>这时推荐使用版本管理工具来切换 Node 版本：</p>
<ul>
<li>macOS / Linux：nvm</li>
<li>Windows：nvm-windows</li>
</ul>
<p>使用这些工具，可以在多个 Node 环境之间自由切换，避免反复重装。</p>
<hr/>
<h2 data-id="heading-9">七、总结</h2>
<p>安装 Node.js 不只是完成一个软件的下载，而是建立整个开发体系的基础。</p>
<p>npm 或 yarn 负责管理依赖，
nvm 负责管理版本，
Node.js 本身则承担运行任务。</p>
<p>环境配置是否规范，会直接影响开发效率与项目稳定性。
将环境一次搭好，比后续不断修修补补更可靠。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：配置开发环境]]></title>    <link>https://juejin.cn/post/7579499567869132850</link>    <guid>https://juejin.cn/post/7579499567869132850</guid>    <pubDate>2025-12-04T00:56:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579499567869132850" data-draft-id="7579673620939784242" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：配置开发环境"/> <meta itemprop="keywords" content="Node.js,后端,Trae"/> <meta itemprop="datePublished" content="2025-12-04T00:56:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：配置开发环境
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:56:00.000Z" title="Thu Dec 04 2025 00:56:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>学会使用 Node.js 的第一步，不是写业务代码，而是搭好开发环境。一个良好的开发环境可以显著提高开发效率，减少调试成本，也能避免很多由于环境不一致导致的奇怪问题。本章将以“实用优先”为原则，讲解如何为 Node.js 搭建一套稳定、易维护的开发环境。</p>
<hr/>
<h2 data-id="heading-0">一、明确开发环境包含哪些内容</h2>
<p>一个完整的 Node.js 开发环境，并不只是安装了 Node.js 就算完成。通常还包括以下内容：</p>
<ul>
<li>Node.js 运行环境</li>
<li>代码编辑器或 IDE</li>
<li>包管理工具（npm 或 yarn）</li>
<li>版本管理工具（如 nvm）</li>
<li>调试工具</li>
<li>代码规范与格式化工具</li>
</ul>
<p>这些工具共同构成日常开发的基础设施。</p>
<hr/>
<h2 data-id="heading-1">二、选择合适的编辑器</h2>
<p>Node.js 是 JavaScript 生态的一部分，因此代码编辑器的选择非常重要。</p>
<p>目前最推荐的开发工具是 Visual Studio Code，它轻量、功能强、插件生态丰富，适合前后端开发一体化使用。</p>
<p>建议安装以下常用插件：</p>
<ul>
<li>ESLint：代码质量检查</li>
<li>Prettier：代码格式化</li>
<li>GitLens：Git 辅助工具</li>
<li>Node.js 调试扩展</li>
</ul>
<p>合适的插件可以大幅提升开发体验，同时避免低级格式错误。</p>
<hr/>
<h2 data-id="heading-2">三、配置 Node.js 版本管理工具</h2>
<p>随着项目增多，必然会遇到多个 Node.js 版本共存的情况。此时，版本管理工具变得非常重要。</p>
<p>macOS 和 Linux 系统推荐使用 nvm。
Windows 系统推荐使用 nvm-windows。</p>
<p>安装完成后，可以通过以下方式管理版本：</p>
<ul>
<li>安装指定版本</li>
<li>切换当前版本</li>
<li>查看已安装版本列表</li>
<li>设置默认版本</li>
</ul>
<p>使用版本管理工具是专业开发者的基本习惯之一。</p>
<hr/>
<h2 data-id="heading-3">四、初始化第一个 Node.js 项目</h2>
<p>进入工作目录后，执行以下命令创建项目：</p>
<pre><code class="hljs language-bash" lang="bash">npm init -y
</code></pre>
<p>该命令会自动生成一个 package.json 文件，作为项目的配置中心。</p>
<p>接下来可以安装常用工具包：</p>
<pre><code class="hljs language-bash" lang="bash">npm install express
</code></pre>
<p>项目目录通常包括：</p>
<ul>
<li>node_modules 依赖目录</li>
<li>package.json 项目配置文件</li>
<li>index.js 或 app.js 入口文件</li>
</ul>
<p>一个最基础的 Node.js 项目结构就搭建完成了。</p>
<hr/>
<h2 data-id="heading-4">五、配置调试环境</h2>
<p>良好的调试能力可以极大提升开发效率。</p>
<p>在 Visual Studio Code 中，可以直接创建调试配置文件 launch.json，用于启动 Node.js 调试任务。</p>
<p>配置完成后：</p>
<ul>
<li>支持断点调试</li>
<li>支持变量监控</li>
<li>支持调用栈分析</li>
<li>支持单步执行</li>
</ul>
<p>相比使用 console.log 调试，断点调试更加高效可靠。</p>
<hr/>
<h2 data-id="heading-5">六、引入代码规范与格式化工具</h2>
<p>代码规范可以让项目更易维护，也更利于团队协作。</p>
<p>推荐在项目中配置：</p>
<ul>
<li>ESLint：约束代码风格</li>
<li>Prettier：统一代码格式</li>
</ul>
<p>安装示例：</p>
<pre><code class="hljs language-bash" lang="bash">npm install eslint prettier -D
</code></pre>
<p>通过自动修复功能，可以减少大量格式问题和低级错误。</p>
<hr/>
<h2 data-id="heading-6">七、配置 Git 与版本控制</h2>
<p>任何一个真实项目都应纳入版本控制系统。</p>
<p>建议：</p>
<ul>
<li>初始化 Git 仓库</li>
<li>设置 .gitignore 文件</li>
<li>定期提交代码</li>
<li>使用分支开发</li>
</ul>
<p>版本控制不仅是代码备份工具，更是团队协作的生命线。</p>
<hr/>
<h2 data-id="heading-7">八、总结</h2>
<p>开发环境的质量直接决定开发效率和项目稳定性。</p>
<p>一个完整的 Node.js 开发环境应包含运行环境、编辑器、包管理工具、调试配置、代码规范、版本控制等多个方面。</p>
<p>前期多花一些时间配置环境，后期可以少踩很多坑。
环境稳定，才能专注业务与技术。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python 开发中最常见的错误大全（含 JSON 专项解析）]]></title>    <link>https://juejin.cn/post/7579499567869149234</link>    <guid>https://juejin.cn/post/7579499567869149234</guid>    <pubDate>2025-12-04T00:56:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579499567869149234" data-draft-id="7579472170906468402" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python 开发中最常见的错误大全（含 JSON 专项解析）"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-04T00:56:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python 开发中最常见的错误大全（含 JSON 专项解析）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:56:53.000Z" title="Thu Dec 04 2025 00:56:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>副标题</strong>：从 SyntaxError 到 JSONDecodeError，一文帮你避开 90% 的坑</p>
</blockquote>
<p>Python 以“简洁易读”著称，但即便是经验丰富的开发者，也常被各种错误搞得焦头烂额。这些错误不仅影响开发效率，还可能潜伏在生产环境中引发严重故障。</p>
<p>本文系统梳理了 <strong>Python 中最常见的错误类型</strong>，并特别深入解析了 <strong>JSON 相关错误</strong>——这是 Web 开发、API 调用和数据处理中最频繁出现的问题之一。每类错误都配有 <strong>真实示例 + 原理解释 + 解决方案</strong>，助你快速排错、写出健壮代码。</p>
<hr/>
<h2 data-id="heading-0">一、错误分类概览</h2>
<p>Python 错误主要分为三类：</p>
<ol>
<li><strong>语法错误（SyntaxError）</strong> ：代码不符合 Python 语法规则，解释器直接拒绝运行。</li>
<li><strong>运行时异常（Exceptions）</strong> ：程序能启动，但在执行过程中因逻辑或环境问题崩溃。</li>
<li><strong>逻辑错误（Logic Errors）</strong> ：代码能运行且不报错，但结果不符合预期（最难调试）。</li>
</ol>
<p>我们重点讨论前两类，并加入 <strong>JSON 专项章节</strong>。</p>
<hr/>
<h2 data-id="heading-1">二、语法错误（SyntaxError）</h2>
<p>这类错误在保存或运行脚本时立即暴露。</p>
<h3 data-id="heading-2">常见场景：</h3>
<ul>
<li>缺少冒号 <code>:</code>（<code>if</code>, <code>for</code>, <code>def</code> 后必须加）</li>
<li>括号/引号不匹配</li>
<li>错误缩进（混用空格与 Tab）</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ❌ 典型错误</span>
<span class="hljs-keyword">if</span> x &gt; 0
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"positive"</span>)  <span class="hljs-comment"># SyntaxError: invalid syntax</span>

<span class="hljs-comment"># ✅ 正确写法</span>
<span class="hljs-keyword">if</span> x &gt; 0:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"positive"</span>)
</code></pre>
<blockquote>
<p>💡 <strong>建议</strong>：使用支持语法高亮和括号匹配的编辑器（如 VS Code、PyCharm）。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">三、运行时异常（Exceptions）</h2>
<h3 data-id="heading-4">1. NameError：变量未定义</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">print</span>(username)  # NameError: name <span class="hljs-string">'username'</span> is not defined
</code></pre>
<p>✅ <strong>解决</strong>：确保变量已赋值，注意作用域。</p>
<hr/>
<h3 data-id="heading-5">2. AttributeError：对象无此属性</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[]</span><span class="hljs-selector-class">.push</span>(<span class="hljs-number">1</span>)  # AttributeError: <span class="hljs-string">'list'</span> object has no attribute <span class="hljs-string">'push'</span>
</code></pre>
<p>✅ <strong>解决</strong>：查官方文档，确认方法名（如 <code>list.append()</code>）。</p>
<hr/>
<h3 data-id="heading-6">3. IndexError / KeyError：越界访问</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">d</span> = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Alice"</span>}
print(d<span class="hljs-section">["age"]</span>)  <span class="hljs-comment"># KeyError: 'age'</span>
</code></pre>
<p>✅ <strong>安全访问</strong>：</p>
<pre><code class="hljs language-csharp" lang="csharp">d.<span class="hljs-keyword">get</span>(<span class="hljs-string">"age"</span>, <span class="hljs-string">"未知"</span>)  <span class="hljs-meta"># 推荐</span>
<span class="hljs-meta"># 或</span>
<span class="hljs-keyword">if</span> <span class="hljs-string">"age"</span> <span class="hljs-keyword">in</span> d: ...
</code></pre>
<hr/>
<h3 data-id="heading-7">4. TypeError：类型不匹配</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-string">"5"</span> + 3  <span class="hljs-comment"># TypeError: can only concatenate str (not "int") to str</span>
</code></pre>
<p>✅ <strong>解决</strong>：显式转换类型，如 <code>int("5") + 3</code>。</p>
<hr/>
<h3 data-id="heading-8">5. ValueError：值合法但不符合要求</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">int</span>(<span class="hljs-string">"abc"</span>)  <span class="hljs-comment"># ValueError: invalid literal for int()</span>
</code></pre>
<p>✅ <strong>防御性编程</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    num = <span class="hljs-built_in">int</span>(user_input)
<span class="hljs-keyword">except</span> ValueError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"请输入有效数字"</span>)
</code></pre>
<hr/>
<h3 data-id="heading-9">6. ZeroDivisionError：除零错误</h3>
<pre><code class="hljs language-bash" lang="bash">10 / 0  <span class="hljs-comment"># ZeroDivisionError</span>
</code></pre>
<p>✅ <strong>检查分母</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">if denominator != 0:
    <span class="hljs-attr">result</span> = numerator / denominator
</code></pre>
<hr/>
<h3 data-id="heading-10">7. FileNotFoundError：文件不存在</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">open</span>(<span class="hljs-string">"missing.txt"</span>)  <span class="hljs-comment"># FileNotFoundError</span>
</code></pre>
<p>✅ <strong>安全打开</strong>：</p>
<pre><code class="hljs language-lua" lang="lua">import <span class="hljs-built_in">os</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">os</span>.<span class="hljs-built_in">path</span>.exists(<span class="hljs-string">"file.txt"</span>):
    with <span class="hljs-built_in">open</span>(<span class="hljs-string">"file.txt"</span>) as f: ...
</code></pre>
<hr/>
<h3 data-id="heading-11">8. ModuleNotFoundError：模块未安装</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests  <span class="hljs-comment"># ModuleNotFoundError（若未安装）</span>
</code></pre>
<p>✅ <strong>解决</strong>：</p>
<pre><code class="hljs">pip install requests
</code></pre>
<hr/>
<h2 data-id="heading-12">四、经典逻辑陷阱</h2>
<h3 data-id="heading-13">可变默认参数（Mutable Default Argument）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 危险！</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">item, lst=[]</span>):
    lst.append(item)
    <span class="hljs-keyword">return</span> lst

<span class="hljs-built_in">print</span>(add(<span class="hljs-number">1</span>))  <span class="hljs-comment"># [1]</span>
<span class="hljs-built_in">print</span>(add(<span class="hljs-number">2</span>))  <span class="hljs-comment"># [1, 2] ← 意外共享！</span>

<span class="hljs-comment"># ✅ 正确</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">item, lst=<span class="hljs-literal">None</span></span>):
    <span class="hljs-keyword">if</span> lst <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        lst = []
    lst.append(item)
    <span class="hljs-keyword">return</span> lst
</code></pre>
<blockquote>
<p>📌 <strong>黄金法则</strong>：永远不要用 <code>list</code>、<code>dict</code>、<code>set</code> 等可变对象作为函数默认参数！</p>
</blockquote>
<hr/>
<h2 data-id="heading-14">五、JSON 专项：最常被忽视的错误源</h2>
<p>在 API 开发、配置文件读取、前后端通信中，<strong>JSON 是数据交换的通用语言</strong>。但处理不当极易出错。</p>
<h3 data-id="heading-15">1. <code>json.JSONDecodeError</code>：JSON 格式非法</h3>
<p>这是 <strong>最常见</strong> 的 JSON 错误，通常由以下原因引起：</p>
<h4 data-id="heading-16">❌ 场景 1：字符串不是合法 JSON</h4>
<pre><code class="hljs language-ini" lang="ini">import json

<span class="hljs-attr">data</span> = <span class="hljs-string">"{'name': 'Alice'}"</span>  <span class="hljs-comment"># 注意：用了单引号！</span>
json.loads(data)  <span class="hljs-comment"># JSONDecodeError: Expecting property name enclosed in double quotes</span>
</code></pre>
<p>✅ <strong>原因</strong>：JSON 标准要求 <strong>键和字符串必须用双引号 <code>"</code></strong> ，单引号无效。</p>
<p>✅ <strong>解决</strong>：</p>
<ul>
<li>
<p>确保数据源输出标准 JSON（如后端用 <code>json.dumps()</code>）</p>
</li>
<li>
<p>若必须解析非标准字符串，可先替换：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">data</span> = data.replace(<span class="hljs-string">"'"</span>, <span class="hljs-string">'"'</span>)
</code></pre>
</li>
</ul>
<h4 data-id="heading-17">❌ 场景 2：末尾多余逗号</h4>
<pre><code class="hljs language-makefile" lang="makefile">data = '{<span class="hljs-string">"name"</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-string">"age"</span>: 30,}'  <span class="hljs-comment"># 末尾逗号</span>
json.loads(data)  <span class="hljs-comment"># JSONDecodeError</span>
</code></pre>
<p>✅ <strong>解决</strong>：使用在线 JSON 校验工具（如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fjsonlint.com%2F" target="_blank" title="https://jsonlint.com/" ref="nofollow noopener noreferrer">jsonlint.com</a>）验证。</p>
<h4 data-id="heading-18">❌ 场景 3：响应体为空或 HTML</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 模拟请求返回 404 页面（HTML）</span>
<span class="hljs-attr">response_text</span> = <span class="hljs-string">"&lt;html&gt;Not Found&lt;/html&gt;"</span>
json.loads(response_text)  <span class="hljs-comment"># JSONDecodeError</span>
</code></pre>
<p>✅ <strong>防御性处理</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> requests

resp = requests.get(<span class="hljs-string">"https://api.example.com/data"</span>)
<span class="hljs-keyword">try</span>:
    data = resp.json()  <span class="hljs-comment"># requests 内部调用 json.loads()</span>
<span class="hljs-keyword">except</span> json.JSONDecodeError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"响应不是 JSON！状态码:"</span>, resp.status_code)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"原始内容:"</span>, resp.text[:<span class="hljs-number">200</span>])
</code></pre>
<hr/>
<h3 data-id="heading-19">2. <code>TypeError: Object of type xxx is not JSON serializable</code></h3>
<p>当你尝试把 <strong>非 JSON 支持的类型</strong> 序列化时发生：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

data = {<span class="hljs-string">"time"</span>: datetime.<span class="hljs-title function_">now</span>()}
json.<span class="hljs-title function_">dumps</span>(data)  # <span class="hljs-title class_">TypeError</span>: <span class="hljs-title class_">Object</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">type</span> datetime is not <span class="hljs-title class_">JSON</span> serializable
</code></pre>
<p>✅ <strong>解决方法</strong>：</p>
<h4 data-id="heading-20">方法 1：自定义 <code>default</code> 函数</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">json_serializer</span>(<span class="hljs-params">obj</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(obj, datetime):
        <span class="hljs-keyword">return</span> obj.isoformat()
    <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">f"Type <span class="hljs-subst">{<span class="hljs-built_in">type</span>(obj)}</span> not serializable"</span>)

json.dumps(data, default=json_serializer)
</code></pre>
<h4 data-id="heading-21">方法 2：提前转换</h4>
<pre><code class="hljs language-css" lang="css">data = {"<span class="hljs-selector-tag">time</span>": datetime.<span class="hljs-built_in">now</span>().<span class="hljs-built_in">isoformat</span>()}
json<span class="hljs-selector-class">.dumps</span>(data)  # OK
</code></pre>
<h4 data-id="heading-22">方法 3：使用第三方库（如 <code>orjson</code>、<code>ujson</code>）支持更多类型</h4>
<hr/>
<h3 data-id="heading-23">3. 中文乱码问题（编码错误）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 写入文件</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"config.json"</span>, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:
    json.dump({<span class="hljs-string">"消息"</span>: <span class="hljs-string">"你好"</span>}, f)

<span class="hljs-comment"># 读取时可能乱码（尤其在 Windows）</span>
</code></pre>
<p>✅ <strong>解决</strong>：显式指定 UTF-8 编码</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 写入</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"config.json"</span>, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
    json.dump(data, f, ensure_ascii=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># 关键：ensure_ascii=False</span>

<span class="hljs-comment"># 读取</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"config.json"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
    data = json.load(f)
</code></pre>
<blockquote>
<p>🔑 <strong>两个关键参数</strong>：</p>
<ul>
<li><code>encoding="utf-8"</code>：确保文件以 UTF-8 读写</li>
<li><code>ensure_ascii=False</code>：允许输出中文而非 <code>\u4f60\u597d</code></li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-24">六、最佳实践：如何避免和快速定位错误？</h2>
<h3 data-id="heading-25">1. 使用 <code>try...except</code> 精准捕获</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    data = json.loads(api_response)
<span class="hljs-keyword">except</span> json.JSONDecodeError <span class="hljs-keyword">as</span> e:
    logger.error(<span class="hljs-string">f"JSON 解析失败: <span class="hljs-subst">{e.msg}</span> at line <span class="hljs-subst">{e.lineno}</span>"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    logger.error(<span class="hljs-string">f"未知错误: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<h3 data-id="heading-26">2. 启用类型提示 + mypy</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_user</span>(<span class="hljs-params">data: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-keyword">return</span> json.loads(data)  <span class="hljs-comment"># mypy 可检查返回类型</span>
</code></pre>
<h3 data-id="heading-27">3. 单元测试覆盖异常路径</h3>
<pre><code class="hljs language-scss" lang="scss">def <span class="hljs-built_in">test_invalid_json</span>():
    with pytest.<span class="hljs-built_in">raises</span>(json.JSONDecodeError):
        <span class="hljs-built_in">parse_user</span>(<span class="hljs-string">"{'invalid': json}"</span>)
</code></pre>
<h3 data-id="heading-28">4. 日志记录原始数据</h3>
<p>当 JSON 解析失败时，<strong>务必记录原始字符串</strong>，便于复现问题。</p>
<hr/>
<h2 data-id="heading-29">七、总结</h2>



































<table><thead><tr><th>错误类型</th><th>高频场景</th><th>防御策略</th></tr></thead><tbody><tr><td><code>SyntaxError</code></td><td>缩进、冒号、括号</td><td>使用智能 IDE</td></tr><tr><td><code>NameError</code></td><td>变量未定义</td><td>检查拼写与作用域</td></tr><tr><td><code>JSONDecodeError</code></td><td>非标准 JSON、空响应</td><td>校验 + try-except + 记录原始数据</td></tr><tr><td><code>TypeError</code>（序列化）</td><td>datetime、自定义对象</td><td>自定义 <code>default</code> 或预转换</td></tr><tr><td>可变默认参数</td><td>函数默认值为 list/dict</td><td>用 <code>None</code> 代替</td></tr></tbody></table>
<blockquote>
<p><strong>记住</strong>：<br/>
<strong>“错误不是敌人，而是你代码的反馈。”</strong><br/>
学会阅读错误信息（尤其是 traceback 和 <code>JSONDecodeError</code> 的 <code>lineno</code>），是成为高效 Python 开发者的关键一步。</p>
</blockquote>
<hr/>
<p><strong>延伸阅读</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Fexceptions.html" target="_blank" title="https://docs.python.org/3/library/exceptions.html" ref="nofollow noopener noreferrer">Python 官方异常文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdatatracker.ietf.org%2Fdoc%2Fhtml%2Frfc8259" target="_blank" title="https://datatracker.ietf.org/doc/html/rfc8259" ref="nofollow noopener noreferrer">JSON 标准 RFC 8259</a></li>
<li>《Effective Python》第 5 条：了解 Python 的 slice 和异常机制</li>
</ul>
<hr/>
<p>希望这篇文章能成为你日常开发的“避坑指南”。如果你觉得有用，欢迎点赞、收藏或分享给团队小伙伴！</p>
<blockquote>
<p>✍️ <strong>作者</strong>：一位踩过无数 JSON 坑的 Python 工程师<br/>
📅 <strong>更新日期</strong>：2025 年 12 月<br/>
🏷️ <strong>标签</strong>：#Python #JSON #错误处理 #开发技巧 #后端开发</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不卖课，纯干货！Android分层你知多少？]]></title>    <link>https://juejin.cn/post/7579476335557017635</link>    <guid>https://juejin.cn/post/7579476335557017635</guid>    <pubDate>2025-12-04T00:56:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579476335557017635" data-draft-id="7576187677839491087" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不卖课，纯干货！Android分层你知多少？"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2025-12-04T00:56:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不卖课，纯干货！Android分层你知多少？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:56:58.000Z" title="Thu Dec 04 2025 00:56:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"☂"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"✓"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"➤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><em>本系列为小说《逆袭西二旗》的技术讲解，用于详细说明<a href="https://juejin.cn/post/7578700798745002018" target="_blank" title="https://juejin.cn/post/7578700798745002018">剧情</a>里涉及的开发细节。</em></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ed9285ea7d94f4894512aeeaf132ce7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765414618&amp;x-signature=pXkavJOWN0BshjIhuDJtD4U6x9w%3D" alt="0.jpg" loading="lazy"/></p>
<p>自 2008 年 9 月 23 日发布以来，Android 经历了巨大的演进。多年来，Android SDK 和整个生态发生了显著变化，新工具和解决方案层出不穷，比如 Android Architecture Components（AAC）、Jetpack 系列库，以及 Jetpack Compose。然而，尽管技术不断革新，Android 底层的一些核心机制——如 <code>Intent</code>、<code>Window</code> 和基础 <code>View</code> 架构——却始终保持高度稳定。</p>
<p>不同公司在构建 Android 应用时采用的技术栈和开发方式各不相同。因此，要想找到心仪的 Android 方面工作，必须根据职位描述中的最低要求，以及目标公司实际使用的技术，有针对性地准备面试。了解他们的技术需求，能让你更高效地聚焦重点。</p>
<p>面试题的难度因公司和面试官而异。与其死记硬背答案，不如深入理解底层概念，并多加实践应用。本系列中的问题旨在为你准备 Android 技术面试提供参考，并非涵盖所有可能考题的“标准答案手册”。</p>
<p>有些公司会侧重考察 Android 系统底层运作和架构，以评估你对 Android 基础的理解；另一些则更关注高层 API 或流行库的使用，看你能否快速将其整合进产品中。不同公司的评分标准也大相径庭，这意味着很多问题并没有唯一“完美”的答案。该系列提供的回答只是起点，鼓励你在此基础上进一步拓展和深挖。</p>
<p>本系列无意覆盖 Android 开发这一广阔领域中的所有可能问题，而是希望为你打下扎实基础，助你高效准备，并根据目标岗位的具体要求调整学习方向。需要特别说明的是，本系列并未深入探讨高级第三方库或底层硬件相关功能（如 Camera API、Bluetooth 等）。如果这些内容与你的职业目标相关，你需要额外查阅资料，自主补充知识。</p>
<p>祝你在 Android 面试准备中一切顺利！</p>
<h2 data-id="heading-0">Android 分层是什么</h2>
<p>Android 是一个开源操作系统，主要面向智能手机和平板等移动设备。它由 Google 开发并维护，基于 Linux 内核，提供了一个强大而灵活的平台，能够适配各种硬件配置和设备。</p>
<h3 data-id="heading-1">面试问题</h3>
<p>Android 的平台架构由多个层级组成，包括 Linux 内核、Android 运行时（ART）以及硬件抽象层（HAL）。你能解释一下这些组件是如何协同工作，以确保应用顺利运行并与硬件交互的吗？</p>
<h3 data-id="heading-2">关键特性</h3>
<ol>
<li><strong>开源且高度可定制</strong>：Android 是开源的（即 Android 开源项目，AOSP），开发者和厂商可以根据自身需求自由修改和定制系统。这种灵活性推动了它在各类设备上的广泛应用与创新，包括智能穿戴设备、电视乃至物联网（IoT）设备。</li>
<li><strong>基于 SDK 的应用开发</strong>：Android 应用主要使用 Java 或 Kotlin 编写，并配合 Android 软件开发工具包（SDK）。开发者可通过 Android Studio 等工具，在平台上完成应用的设计、开发与调试。</li>
<li><strong>丰富的应用生态</strong>：Google Play 商店是 Android 官方的应用分发平台，提供数百万款涵盖游戏、生产力工具等各类别的应用。开发者也可通过第三方应用商店或直接提供 APK 文件进行独立分发。</li>
<li><strong>多任务处理与资源管理</strong>：Android 支持多任务运行，用户可同时开启多个应用。系统采用托管式内存管理和高效的垃圾回收机制，在不同设备上优化性能表现。</li>
<li><strong>广泛的硬件兼容性</strong>：Android 覆盖从入门级到高端旗舰的各类设备，对不同屏幕尺寸、分辨率及硬件配置均有出色的适配能力。</li>
</ol>
<h3 data-id="heading-3">Android 系统架构</h3>
<p>Android 平台架构采用模块化分层设计，由多个组件构成：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77bf71e1d4f24022addc10a585af913d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765414618&amp;x-signature=IK1ZnQQYUNNibu7DnpapyYv2r1Q%3D" alt="1.png" loading="lazy"/></p>
<p><em>相信 Android 开发再熟悉不过这张图了！</em></p>
<p>那我们从下往上依次说明这些层：</p>
<ul>
<li><strong>电源管理</strong>：Linux 内核中的电源子系统，负责直接控制 CPU、设备和整机的休眠、唤醒与功耗状态，为上层省电机制提供硬件级支持。</li>
<li><strong>Linux 内核</strong>：Linux 内核构成了 Android 操作系统的基础，负责硬件抽象，确保软件与硬件之间的无缝交互。其核心职责包括内存与进程管理、安全策略执行，以及管理 Wi-Fi、蓝牙、显示等硬件组件的驱动程序。</li>
<li><strong>硬件抽象层（HAL）</strong> ：硬件抽象层（HAL）提供了一组标准接口，将 Android 的 Java API 框架与设备硬件连接起来。它由多个库模块组成，每个模块针对特定硬件（如摄像头或蓝牙）进行定制。当框架 API 请求访问硬件时，Android 系统会动态加载对应的 HAL 模块来完成请求。</li>
<li><strong>Android 运行时（ART）与核心库</strong>：Android 运行时（ART）负责执行由 Kotlin 或 Java 编译而来的字节码。ART 支持“提前编译”（AOT）和“即时编译”（JIT），以优化应用性能。核心库则提供了数据结构、文件操作、多线程等关键功能的 API，为应用开发构建了完整的运行环境。</li>
<li><strong>原生 C/C++ 库</strong>：Android 包含一系列用 C 和 C++ 编写的原生库，用于支撑关键功能。例如，<strong>OpenGL</strong> 负责图形渲染，<strong>SQLite</strong> 提供数据库操作能力，<strong>WebKit</strong> 用于网页内容展示。这些库既被 Android 框架内部使用，也可被应用直接调用，以处理对性能要求较高的任务。</li>
<li><strong>Android 框架（API）</strong> ：应用框架层提供了面向开发者的高层服务和 API，包括 <code>ActivityManager</code>、<code>NotificationManager</code>、<code>ContentProvider</code> 等，让开发者能够高效构建 Android 应用，并充分利用系统能力。</li>
<li><strong>应用程序</strong>：最上层是所有面向用户的应用，包括系统自带应用（如通讯录、设置）和基于 Android SDK 开发的第三方应用。这些应用依赖底层各模块，将功能顺畅地交付给用户。</li>
</ul>
<h3 data-id="heading-4">总结</h3>
<p>Android 是全球使用最广泛的移动操作系统，占据着绝对的市场份额。它不仅推动创新，还为开发者提供了触达数十亿用户的机会。凭借其高度的适应性和开源特性，Android 得以在各种市场中蓬勃发展，并成为众多非手机设备的基石。</p>
<h2 data-id="heading-5">Intent 是什么</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d8e2a3f1da643dc996b2fc8e511c80d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765414618&amp;x-signature=mqWc5yvW6q8iO8OSPPzGn25uWtw%3D" alt="2.png" loading="lazy"/></p>
<p><code>Intent</code> 是对即将执行操作的一种抽象描述。它作为一种消息对象，让 <code>Activity</code>、<code>Service</code> 和 <code>BroadcastReceiver</code> 能够彼此通信。<code>Intent</code> 通常用于启动一个 <code>Activity</code>、发送广播或启动一个 <code>Service</code>，还能在组件之间传递数据，是 Android 基于组件架构的核心机制之一。</p>
<p>Android 中主要有两种 <code>Intent</code>：显式 <code>Intent</code> 和隐式 <code>Intent</code>。</p>
<h3 data-id="heading-6">面试问题</h3>
<p>显式 <code>Intent</code> 和隐式 <code>Intent</code> 的核心区别是什么？各自适用于哪些场景？</p>
<p>Android 系统如何决定由哪个应用来处理一个隐式 <code>Intent</code>？如果找不到合适的应用，又会发生什么？</p>
<h3 data-id="heading-7">显式 Intent</h3>
<p><strong>定义</strong>：显式 <code>Intent</code> 通过直接指定组件名称，明确指出要启动的具体组件（<code>Activity</code> 或 <code>Service</code>）。</p>
<p><strong>使用场景</strong>：当你明确知道目标组件时使用显式 <code>Intent</code>，例如启动自己应用内的某个特定 <code>Activity</code>。</p>
<p><strong>示例场景</strong>：如果你在同一个应用内从一个 <code>Activity</code> 跳转到另一个 <code>Activity</code>，就应该使用显式 <code>Intent</code>。</p>
<p>你可以像下面这样使用显式 <code>Intent</code>：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span> intent = Intent(<span class="hljs-keyword">this</span>, TargetActivity::<span class="hljs-keyword">class</span>.java)
startActivity(intent)
</code></pre>
<h3 data-id="heading-8">隐式 Intent</h3>
<p><strong>定义</strong>：隐式 <code>Intent</code> 不指定具体组件，而是声明一个通用的操作意图。系统会根据该 <code>Intent</code> 中的动作（<code>action</code>）、类别（<code>category</code>）和数据（<code>data</code>），自动匹配能够处理它的组件。</p>
<p><strong>使用场景</strong>：当你希望执行一个可由其他应用或系统组件处理的操作时，隐式 <code>Intent</code> 非常有用，比如打开一个网页链接或分享内容。</p>
<p><strong>示例场景</strong>：如果你要通过浏览器打开一个网页，或者把内容分享给其他应用，就应该使用隐式 <code>Intent</code>。此时，系统会决定由哪个应用来处理这个请求。</p>
<p>你可以像下面这样使用隐式 <code>Intent</code>：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span> intent = Intent(Intent.ACTION_VIEW)
intent.<span class="hljs-keyword">data</span> = Uri.parse(<span class="hljs-string">"https://www.example.com"</span>)
startActivity(intent)
</code></pre>
<p>如果使用隐式 <code>Intent</code> 启动 Activity，但系统中没有应用能处理该 <code>Intent</code>，会抛出 <code>ActivityNotFoundException</code>。</p>
<p>正确做法是，在调用 <code>startActivity()</code> 之前，应使用 <code>PackageManager</code> 检查是否存在可处理的 <code>Activity</code>：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span> intent = Intent(Intent.ACTION_SEND).apply {
    type = <span class="hljs-string">"text/plain"</span>
    putExtra(Intent.EXTRA_TEXT, <span class="hljs-string">"Hello"</span>)
}

<span class="hljs-comment">// 检查是否有应用能处理</span>
<span class="hljs-keyword">if</span> (intent.resolveActivity(getPackageManager()) != <span class="hljs-literal">null</span>) {
    startActivity(intent)
} <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 提示用户或降级处理</span>
    Toast.makeText(<span class="hljs-keyword">this</span>, <span class="hljs-string">"没有应用可以处理此操作"</span>, Toast.LENGTH_SHORT).show()
}
</code></pre>
<h3 data-id="heading-9">总结</h3>
<p>显式 <code>Intent</code> 用于应用内部导航，目标组件是明确已知的。<br/>
而隐式 <code>Intent</code> 则用于那些可能由外部应用或其他组件处理的操作，无需直接指定目标。它更像一种向系统提需求的工作方式，这让 Android 生态更具灵活性，也让应用之间能无缝协作。</p>
<h3 data-id="heading-10">进阶：什么是 IntentFilter</h3>
<p>Android 中的 <code>IntentFilter</code> 用于定义应用组件如何响应特定的 <code>Intent</code>，比如打开一个链接或处理一条广播。它本质上是一种过滤器，用来声明某个 <code>Activity</code>、<code>Service</code> 或 <code>BroadcastReceiver</code> 能够处理哪些类型的 <code>Intent</code>，这些声明写在 <code>AndroidManifest.xml</code> 文件中。</p>
<p>每个 <code>IntentFilter</code> 可以包含 <code>Action</code>、<code>Category</code> 和数据类型，以便精准匹配传入的 <code>Intent</code>。合理地定义 <code>IntentFilter</code>，能让你的应用与其他应用及系统组件无缝协作，从而提升整体功能体验。</p>
<p>当发送一个隐式 <code>Intent</code> 时，Android 系统会根据该 <code>Intent</code> 的属性，与已安装应用的清单文件中声明的 <code>IntentFilter</code> 进行匹配，从而确定应启动哪个组件。如果找到匹配项，系统就会启动对应的组件，并将 <code>Intent</code> 对象传递给它。如果多个组件都能匹配该 <code>Intent</code>，系统会弹出一个选择器对话框，让用户自行决定使用哪个应用来处理该操作。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d3e8b04c9a043f6829ce5499d58d87f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765414618&amp;x-signature=xyGkdG8lxGuLQbR5GCAC751IWI0%3D" alt="1.png" loading="lazy"/></p>
<h2 data-id="heading-11">PendingIntent 又是什么</h2>
<p><code>PendingIntent</code> 是一种特殊的 <code>Intent</code>，它授权其他应用或系统组件在未来某个时刻，以你应用的名义执行一个预先定义好的 <code>Intent</code>。这种机制特别适用于那些需要在你的应用生命周期之外触发的操作，比如发送通知或与后台服务交互。</p>
<h3 data-id="heading-12">面试问题</h3>
<p>什么是 <code>PendingIntent</code>？它和普通 <code>Intent</code> 有什么区别？</p>
<p>能否举一个必须使用 <code>PendingIntent</code> 的场景？</p>
<h3 data-id="heading-13">核心特性</h3>
<p><code>PendingIntent</code> 本质上是对普通 <code>Intent</code> 的一层封装，能让这个 <code>Intent</code> 在你的应用生命周期结束后依然有效。它把执行 <code>Intent</code> 的权限委托给其他应用或系统服务，并且这些组件会以你应用的身份和权限来执行操作。<code>PendingIntent</code> 可用于 <code>Activity</code>、<code>Service</code> 或 <code>BroadcastReceiver</code>。</p>
<p>它主要有三种形式：</p>
<ul>
<li><strong>Activity</strong>：启动一个 Activity。</li>
<li><strong>Service</strong>：启动一个 Service。</li>
<li><strong>Broadcast</strong>：发送一条广播。</li>
</ul>
<p>你可以通过 <code>PendingIntent.getActivity()</code>、<code>PendingIntent.getService()</code> 或 <code>PendingIntent.getBroadcast()</code> 等工厂方法来创建对应的 <code>PendingIntent</code>。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">// 1. 创建 Intent 跳转到目标 Activity</span>
<span class="hljs-keyword">val</span> intent = Intent(<span class="hljs-keyword">this</span>, MyActivity::<span class="hljs-keyword">class</span>.java)

<span class="hljs-comment">// 2. 创建 PendingIntent，用于通知点击后启动 Activity</span>
<span class="hljs-keyword">val</span> pendingIntent = PendingIntent.getActivity(
    <span class="hljs-keyword">this</span>,
    <span class="hljs-number">0</span>,
    intent,
    PendingIntent.FLAG_UPDATE_CURRENT <span class="hljs-comment">// 更新现有 PendingIntent</span>
)

<span class="hljs-comment">// 3. 构建通知</span>
<span class="hljs-keyword">val</span> notification = NotificationCompat.Builder(<span class="hljs-keyword">this</span>, CHANNEL_ID)
    .setContentTitle(<span class="hljs-string">"Title"</span>)
    .setContentText(<span class="hljs-string">"Content"</span>)
    .setSmallIcon(R.drawable.ic_notification)
    .setContentIntent(pendingIntent) <span class="hljs-comment">// 点击通知时触发</span>
    .build()

<span class="hljs-comment">// 4. 发送通知</span>
NotificationManagerCompat.from(<span class="hljs-keyword">this</span>).notify(NOTIFICATION_ID, notification)
</code></pre>
<p><code>PendingIntent</code> 支持多种标志（flag），用于控制其行为以及与系统或其他组件的交互方式：</p>
<ul>
<li><code>FLAG_UPDATE_CURRENT</code>：用新数据更新已存在的 <code>PendingIntent</code>。</li>
<li><code>FLAG_CANCEL_CURRENT</code>：在创建新的 <code>PendingIntent</code> 前，先取消已存在的实例。</li>
<li><code>FLAG_IMMUTABLE</code>：将 <code>PendingIntent</code> 设为不可变，防止接收方修改其内容。</li>
<li><code>FLAG_ONE_SHOT</code>：确保该 <code>PendingIntent</code> 只能使用一次。</li>
</ul>
<h3 data-id="heading-14">使用场景</h3>
<ol>
<li><strong>通知（Notifications）</strong> ：用户点击通知时，可触发打开某个 <code>Activity</code> 等操作。</li>
<li><strong>闹钟（Alarms）</strong> ：配合 <code>AlarmManager</code> 调度定时任务。</li>
<li><strong>服务（Services）</strong> ：将任务委托给 <code>ForegroundService</code> 或 <code>BroadcastReceiver</code>，用于执行后台操作。</li>
</ol>
<h3 data-id="heading-15">安全事项</h3>
<p>始终为 <code>PendingIntent</code> 设置 <code>FLAG_IMMUTABLE</code>，以防止恶意应用篡改其内部的 <code>Intent</code>。这一点从 Android 12（API 级别 31）开始尤为重要——在某些场景下，系统已强制要求必须使用该标志。</p>
<h3 data-id="heading-16">总结</h3>
<p><code>PendingIntent</code> 是 Android 中的一项核心机制，即使你的应用未在前台运行，也能实现与系统组件或其他应用之间的无缝通信。通过合理管理标志（flags）和权限，你可以确保延迟任务的安全、高效执行。</p>
<h2 data-id="heading-17">Serializable 和 Parcelable 有什么区别</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/782efb9f5bfa49f2b0a669e76978a391~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765414618&amp;x-signature=X%2BdPTochwcnWAdGmPdg8hxxrMF4%3D" alt="3.png" loading="lazy"/></p>
<p>在 Android 中，<code>Serializable</code> 和 <code>Parcelable</code> 都是用来在不同组件（如 <code>Activity</code> 或 <code>Fragment</code>）之间传递数据的机制，但它们在性能和实现方式上有明显区别。</p>
<h3 data-id="heading-18">面试问题</h3>
<p>在 Android 中，<code>Serializable</code> 和 <code>Parcelable</code> 有哪些关键区别？为什么在组件间传递数据时通常更推荐使用 <code>Parcelable</code>？</p>
<h3 data-id="heading-19">Serializable</h3>
<p><strong>Java 标准接口</strong>：<code>Serializable</code> 是 Java 提供的标准接口，用于将对象转换为字节流，以便在 <code>Activity</code> 之间传递或写入磁盘。</p>
<p><strong>基于反射</strong>：它依赖 Java 反射机制，在运行时动态检查类及其字段来完成序列化。</p>
<p><strong>性能</strong>：相比 <code>Parcelable</code>，<code>Serializable</code> 更慢，因为反射本身开销较大。此外，序列化过程中会产生大量临时对象，增加内存负担。</p>
<p><strong>适用场景</strong>：当性能不是关键因素，或在非 Android 特有的代码库中使用时，<code>Serializable</code> 是一个可行的选择。</p>
<h3 data-id="heading-20">Parcelable</h3>
<p><strong>Android 专属接口</strong>：<code>Parcelable</code> 是 Android 特有的接口，专为在 Android 组件间实现高性能的进程间通信（IPC）而设计。</p>
<p><strong>性能</strong>：<code>Parcelable</code> 比 <code>Serializable</code> 更快，因为它针对 Android 做了优化，不依赖反射机制，并且通过避免创建大量临时对象来减少垃圾回收的压力。</p>
<p><strong>适用场景</strong>：在 Android 中传递数据时，尤其是涉及 IPC 或在 Activity、Service 之间传输数据且对性能有要求的场景下，推荐使用 <code>Parcelable</code>。</p>
<p>在现代 Android 开发中，<code>kotlin-parcelize</code> 插件通过自动生成实现代码，大幅简化了创建 <code>Parcelable</code> 对象的过程。相比早期需要手动编写的方式，这种方法更加高效。只需在类上添加 <code>@Parcelize</code> 注解，插件便会自动生成所需的 <code>Parcelable</code> 实现。下面是一个示例，展示其工作方式：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">import</span> kotlinx.parcelize.Parcelize
<span class="hljs-keyword">import</span> android.os.Parcelable

<span class="hljs-meta">@Parcelize</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> firstName: String, <span class="hljs-keyword">val</span> lastName: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>) : Parcelable
</code></pre>
<p>通过这样的设置，你不再需要手动重写 <code>writeToParcel</code> 方法或实现 <code>CREATOR</code>，大幅减少了样板代码，提升了可读性。</p>
<blockquote>
<p>如果你的类使用了 <code>@Parcelize</code> 注解，但其中包含了一个既不是基本类型、又未被 <code>@Parcelize</code> 标记的属性，就会遇到如下错误：<br/>
<em>Type is not directly supported by ‘Parcelize’. Annotate the parameter type with ‘@RawValue’ if you want it to be serialized using ‘writeValue()’.</em><br/>
这是因为 <code>Parcelize</code> 编译器插件在序列化时会尝试“展开”所有属性，而任何不支持或无法识别的类型都必须显式标记。<br/>
为避免这个问题，请确保所有复杂类型或自定义类型要么自身已正确实现 <code>Parcelable</code>，要么用 <code>@RawValue</code> 注解标注，以表明你希望它们通过 <code>writeValue()</code> 进行手动序列化。</p>
</blockquote>
<h3 data-id="heading-21">关键区别</h3>






























<table><thead><tr><th>特性</th><th>Serializable</th><th>Parcelable</th></tr></thead><tbody><tr><td>类型</td><td>标准Java接口</td><td>Android专用接口</td></tr><tr><td>性能</td><td>较慢，使用反射</td><td>更快，针对Android优化</td></tr><tr><td>垃圾创建</td><td>产生更多垃圾（更多对象）</td><td>产生较少垃圾（高效）</td></tr><tr><td>使用场景</td><td>适用于通用Java使用</td><td>推荐用于Android，尤其是IPC</td></tr></tbody></table>
<h3 data-id="heading-22">总结</h3>
<p>一般来说，在 Android 应用中，<strong>优先选择 <code>Parcelable</code></strong>，因为它在大多数使用场景下性能更优。</p>
<ul>
<li>在简单场景、非性能敏感的操作，或处理与 Android 无关的通用 Java 代码时，可以使用 <code>Serializable</code>。</li>
<li>而在涉及 Android 特有组件且对性能有要求的场景下（例如进程间通信 IPC），应优先使用 <code>Parcelable</code>，因为它针对 Android 的 IPC 机制做了高度优化，效率高得多。</li>
</ul>
<h3 data-id="heading-23">进阶：Parcel 与 Parcelable</h3>
<p><code>Parcel</code> 是 Android 中的一个容器类，用于在应用的不同组件（如 <code>Activity</code>、<code>Service</code> 或 <code>BroadcastReceiver</code>）之间实现高性能的进程间通信。它的核心作用是对数据进行序列化（marshaling，即“扁平化”）和反序列化（unmarshaling，即“还原”），以便跨越 Android 的 IPC 边界传递。</p>
<p><code>Parcel</code> 不仅可以传输扁平化的数据，还能携带指向活跃 <code>IBinder</code> 对象的引用，通过 IPC 机制进行传递。它专为高性能 IPC 传输而设计，配合 <code>Parcelable</code> 接口，能让对象高效地序列化并在组件间流转。</p>
<p>需要注意的是，<code>Parcel</code> 并非通用的序列化工具，也不应用于持久化存储——因为其底层实现可能随系统版本变化，导致旧数据无法读取。</p>
<p><code>Parcel</code> 提供了丰富的 API，支持读写基本数据类型、数组以及 <code>Parcelable</code> 对象，使对象能够自行序列化并在需要时重建。此外，它还提供了一些优化方法：在处理 <code>Parcelable</code> 对象时，可省略写入类信息，但要求接收方提前知道数据类型，从而提升传输效率。</p>
<p><code>Parcelable</code> 是 Android 特有的接口，用于将对象序列化以便通过 <code>Parcel</code> 传递。实现了 <code>Parcelable</code> 的对象可以被写入 <code>Parcel</code>，并从中恢复，因此非常适合在 Android 组件之间传递复杂数据。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# 列表模式（List Patterns）深度解析：模式匹配再进化！]]></title>    <link>https://juejin.cn/post/7579494852653170722</link>    <guid>https://juejin.cn/post/7579494852653170722</guid>    <pubDate>2025-12-03T23:19:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579494852653170722" data-draft-id="7579494852653154338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C# 列表模式（List Patterns）深度解析：模式匹配再进化！"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-12-03T23:19:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C# 列表模式（List Patterns）深度解析：模式匹配再进化！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T23:19:24.000Z" title="Wed Dec 03 2025 23:19:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p>列表模式是一种模式匹配机制，允许检查一个集合（例如数组、<code>List&lt;T&gt;</code>、或任何实现了 <code>IEnumerable&lt;T&gt;</code> 的类型）的元素数量、顺序以及每个元素的内容。</p>
<p>在 <code>C# 10</code> 之前，模式匹配 (<code>Pattern Matching</code>) 已支持 <code>switch</code> 表达式、类型模式、属性模式等，但对列表或序列的匹配还不够直观。
<code>C# 11</code> 引入 列表模式（<code>List Patterns</code>），让开发者可以：</p>
<ul>
<li>
<p>按顺序匹配数组、<code>Span&lt;T&gt;</code>、<code>IList&lt;T&gt;</code> 等列表。</p>
</li>
<li>
<p>检查长度、特定元素，甚至解构其中的值。</p>
</li>
<li>
<p>结合 <code>switch、is、when</code> 等模式匹配写出简洁、声明式的代码。</p>
</li>
</ul>
<blockquote>
<p>✅ 列表模式是模式匹配的扩展，不是新的集合类型。</p>
</blockquote>
<h3 data-id="heading-1">语法</h3>
<p>列表模式使用方括号 <code>[]</code> 来定义要匹配的模式：</p>
<p>基本形式：</p>
<pre><code class="hljs language-csharp" lang="csharp">[ element-pattern<span class="hljs-number">-1</span>, element-pattern<span class="hljs-number">-2</span>, ... ]
</code></pre>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 检查列表是否恰好包含三个元素：1, 2, 3</span>
<span class="hljs-keyword">if</span> (list <span class="hljs-keyword">is</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])
{
    Console.WriteLine(<span class="hljs-string">"列表包含精确序列 1, 2, 3"</span>);
}
</code></pre>
<p>元素模式可以是：</p>
<ul>
<li>
<p>常量（1、"abc"）</p>
</li>
<li>
<p>变量（var x）</p>
</li>
<li>
<p>类型模式（int x）</p>
</li>
<li>
<p>通配符（_）</p>
</li>
<li>
<p>切片模式（..，C# 11 引入）</p>
</li>
<li>
<p>嵌套模式（{}、[] 等）</p>
</li>
</ul>
<p>可以用于：</p>
<ul>
<li>
<p><code>is</code> 表达式</p>
</li>
<li>
<p><code>switch</code> 表达式或语句</p>
</li>
<li>
<p><code>when</code> 条件</p>
</li>
</ul>
<h3 data-id="heading-2">匹配规则</h3>
<ul>
<li>
<p>匹配顺序严格一致。</p>
</li>
<li>
<p>元素数量需满足模式要求（可用切片模式放宽）。</p>
</li>
<li>
<p>支持 <code>IEnumerable</code>、数组、<code>Span&lt;T&gt;</code>、<code>IList&lt;T&gt;</code> 等实现 <code>Length/Count</code> 属性 + 索引器 的类型。</p>
</li>
</ul>
<h3 data-id="heading-3">基础示例</h3>
<h4 data-id="heading-4">精确匹配</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] numbers = { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> };

<span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])
    Console.WriteLine(<span class="hljs-string">"Exact match!"</span>);
</code></pre>
<blockquote>
<p>只有当数组是 <code>{1,2,3}</code> 且长度为 3 时才匹配。</p>
</blockquote>
<h4 data-id="heading-5">通配符 _</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [<span class="hljs-number">1</span>, _, <span class="hljs-number">3</span>])
    Console.WriteLine(<span class="hljs-string">"Middle element can be anything"</span>);
</code></pre>
<blockquote>
<p>忽略第二个元素，只要求首尾固定。</p>
</blockquote>
<h4 data-id="heading-6">切片模式 ..</h4>
<ul>
<li>匹配以 1 开头的任意长度数组。</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [<span class="hljs-number">1</span>, ..])
    Console.WriteLine(<span class="hljs-string">"Starts with 1"</span>);
</code></pre>
<ul>
<li>匹配以 3 结尾的数组。</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [.., <span class="hljs-number">3</span>])
    Console.WriteLine(<span class="hljs-string">"Ends with 3"</span>);
</code></pre>
<ul>
<li>开头和结尾都可检查，中间元素数量不限。</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [<span class="hljs-number">1</span>, .., <span class="hljs-number">3</span>])
    Console.WriteLine(<span class="hljs-string">"Starts with 1 and ends with 3"</span>);
</code></pre>
<h4 data-id="heading-7">变量绑定</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [<span class="hljs-number">1</span>, .. <span class="hljs-keyword">var</span> middle, <span class="hljs-number">3</span>])
    Console.WriteLine(<span class="hljs-string">$"Middle elements count: <span class="hljs-subst">{middle.Length}</span>"</span>);
</code></pre>
<blockquote>
<p>使用 var middle 捕获中间切片。</p>
</blockquote>
<h4 data-id="heading-8">类型模式</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">object</span>[] items = { <span class="hljs-string">"hello"</span>, <span class="hljs-number">42</span>, <span class="hljs-number">99</span> };

<span class="hljs-keyword">if</span> (items <span class="hljs-keyword">is</span> [<span class="hljs-string">"hello"</span>, <span class="hljs-built_in">int</span> x, ..])
    Console.WriteLine(<span class="hljs-string">$"Second element is int: <span class="hljs-subst">{x}</span>"</span>);
</code></pre>
<blockquote>
<p>结合类型模式和切片。</p>
</blockquote>
<h4 data-id="heading-9">空集合匹配</h4>
<pre><code class="hljs language-csharp" lang="csharp">   <span class="hljs-keyword">if</span> (arr <span class="hljs-keyword">is</span> []) 
   {
       Console.WriteLine(<span class="hljs-string">"Array is empty"</span>);
   }
</code></pre>
<h4 data-id="heading-10">嵌套列表模式</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">object</span>[] data = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-number">4</span>];

<span class="hljs-built_in">string</span> result = data <span class="hljs-keyword">switch</span>
{
    [<span class="hljs-meta">1, [2, 3</span>], <span class="hljs-number">4</span>] =&gt; <span class="hljs-string">"Nested match: [1, [2, 3], 4]"</span>,
    _ =&gt; <span class="hljs-string">"No match"</span>
};

Console.WriteLine(result); <span class="hljs-comment">// 输出: Nested match: [1, [2, 3], 4]</span>
</code></pre>
<h4 data-id="heading-11">结合 switch 表达式</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] nums = { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span> };

<span class="hljs-built_in">string</span> result = nums <span class="hljs-keyword">switch</span>
{
    [<span class="hljs-meta">1, 2, 3, 4</span>] =&gt; <span class="hljs-string">"Exact 1-2-3-4"</span>,
    [<span class="hljs-meta">1, ..</span>]      =&gt; <span class="hljs-string">"Starts with 1"</span>,
    [.., <span class="hljs-number">4</span>]      =&gt; <span class="hljs-string">"Ends with 4"</span>,
    []           =&gt; <span class="hljs-string">"Empty list"</span>,
    _            =&gt; <span class="hljs-string">"Other"</span>
};
Console.WriteLine(result);
</code></pre>
<h3 data-id="heading-12">高级示例</h3>
<h4 data-id="heading-13">斐波那契检测</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] fib = { <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span> };

<span class="hljs-keyword">if</span> (fib <span class="hljs-keyword">is</span> [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, .. <span class="hljs-keyword">var</span> rest])
    Console.WriteLine(<span class="hljs-string">$"Fibonacci sequence with <span class="hljs-subst">{rest.Length + <span class="hljs-number">2</span>}</span> elements"</span>);
</code></pre>
<h4 data-id="heading-14">解析命令行参数</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span>[] args = { <span class="hljs-string">"add"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"Alice"</span> };

<span class="hljs-keyword">var</span> command = args <span class="hljs-keyword">switch</span>
{
    [<span class="hljs-string">"add"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-keyword">var</span> name] =&gt; <span class="hljs-string">$"Add user <span class="hljs-subst">{name}</span>"</span>,
    [<span class="hljs-string">"remove"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-keyword">var</span> name] =&gt; <span class="hljs-string">$"Remove user <span class="hljs-subst">{name}</span>"</span>,
    [] =&gt; <span class="hljs-string">"No command"</span>,
    _ =&gt; <span class="hljs-string">"Invalid"</span>
};

Console.WriteLine(command);
</code></pre>
<h4 data-id="heading-15">带 when 条件</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [<span class="hljs-keyword">var</span> first, .., <span class="hljs-keyword">var</span> last] &amp;&amp; first &lt; last)
    Console.WriteLine(<span class="hljs-string">$"First &lt; Last (<span class="hljs-subst">{first}</span> &lt; <span class="hljs-subst">{last}</span>)"</span>);
</code></pre>
<h3 data-id="heading-16">适用场景</h3>
<ul>
<li>
<p>数据验证：检查输入的集合是否符合预期结构。</p>
</li>
<li>
<p>数据提取：从集合中提取特定元素到变量，减少手动索引操作。</p>
</li>
<li>
<p>简化控制流：替代复杂的 <code>if-else</code> 或循环逻辑。</p>
</li>
<li>
<p>递归处理：结合切片模式处理嵌套或不定长集合。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数据密集型应用系统设计——面试总结版]]></title>    <link>https://juejin.cn/post/7579507023508095039</link>    <guid>https://juejin.cn/post/7579507023508095039</guid>    <pubDate>2025-12-03T16:21:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579507023508095039" data-draft-id="7579519985699487750" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数据密集型应用系统设计——面试总结版"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-03T16:21:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="KD"/> <meta itemprop="url" content="https://juejin.cn/user/3254158089003630"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数据密集型应用系统设计——面试总结版
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3254158089003630/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    KD
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T16:21:14.000Z" title="Wed Dec 03 2025 16:21:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读42分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">0. 写在前面</h3>
<p>最初是一次面试，面试官问我什么是可靠性，如何提高系统的可靠性。我答的很差，想到一本一年前买来只看了第一章的书有提到这个名词，于是用了一个月通读全书，发现所有的常见中间件，Redis，Mysql，Kafka...都是相同的系统设计思想，都存在相同的问题：</p>
<ul>
<li><strong>单机系统</strong>：从数据存储开始，到数据编码传输，之后需要处理更复杂的业务逻辑需要事务</li>
<li><strong>分布式系统</strong>：单机的系统必然会面对单点故障问题，于是出现了分布式系统设计，出现了数据复制，数据分区</li>
<li><strong>分布式系统的问题</strong>：分布式系统解决了单点故障，但也引入了新的问题，如网络永远是不可靠的。因此又出现了分布式系统一致性算法，出现了分布式事务来保证多个机器间的协同</li>
</ul>
<p>这篇文章可以让你从另一个角度，“抽象”出所有中间件的相通之处</p>
<h2 data-id="heading-1">一、系统设计基础</h2>
<h3 data-id="heading-2">1. 系统设计的三个重要问题</h3>
<ul>
<li><strong>可靠性</strong>：当出现意外情况时，系统应该可以继续正常运转。虽然性能可能有所降低，但确保功能正确</li>
<li><strong>可扩展性</strong>：随着规模的增长，系统应该以合理的方式来匹配这种增长</li>
<li><strong>可维护性</strong>：随着时间的推移，新的人员会参与到系统开发和运维，系统都应该高效运转</li>
</ul>
<h3 data-id="heading-3">2. 如何保证系统的可靠性</h3>
<ul>
<li><strong>什么是可靠性</strong>：即使发生了某些错误，系统仍可以继续正常工作</li>
<li><strong>哪些故障会破坏可靠性</strong>：
<ul>
<li><strong>硬件故障</strong>：
<ul>
<li><strong>具体故障</strong>：硬盘崩溃，内存故障，电网停电，网络断线</li>
<li><strong>应对方法</strong>：硬件故障通常难以短时间内恢复，因此为硬件添加冗余来减少系统故障率</li>
</ul>
</li>
<li><strong>软件错误</strong>：
<ul>
<li><strong>具体故障</strong>：
<ul>
<li><strong>软件bug</strong>：输入特定值时应用服务器总是崩溃</li>
<li><strong>共享资源故障</strong>：一个应用进程使用了某些共享资源(如CPU、内存、磁盘或网络带宽)，被其他进程或程序影响了</li>
<li><strong>依赖服务故障</strong>：系统依赖于某个服务，但该服务突然变慢，甚至无响应或返回异常</li>
</ul>
</li>
<li><strong>应对方法</strong>：有时没有快速解决办法，只能仔细考虑很多细节
<ul>
<li><strong>充分测试</strong>：开发过程中进行全面的测试，包括单元测试，集成测试，系统测试</li>
<li><strong>进程隔离</strong>：不和其他进程共享资源，不被其他进程的错误影响</li>
<li><strong>快速恢复</strong>：快速滚动配置改动，滚动发布新代码，主备切换等</li>
<li><strong>监控告警</strong>：监控系统数据，异常时及时告警</li>
</ul>
</li>
</ul>
</li>
<li><strong>人为失误</strong>：
<ul>
<li><strong>具体故障</strong>：人无法做到万无一失，运维者的配置错误是系统下线的首要原因</li>
<li><strong>应对方法</strong>：假定人是不可靠的
<ul>
<li><strong>以最小出错的方式来设计系统</strong>：精心设计抽象层、API以及管理界面，使得“做正确的事情”很轻松，但搞坏很复杂</li>
<li><strong>分离容易出错的地方</strong>：如测试环境和生产环境完全分离，出现问题不会影响真实用户</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">3. 如何保证系统的可扩展性</h3>
<ul>
<li><strong>什么是可扩展性</strong>：可扩展性是由来描述系统应对负载增加能力的术语</li>
<li><strong>有哪些参数</strong>：
<ul>
<li><strong>负载参数</strong>：Web服务器的每秒请求处理次数、数据库中写入的比例，缓存命中率等</li>
<li><strong>性能参数</strong>：
<ul>
<li><strong>批处理系统</strong>：通常关心吞吐量，即每秒可处理的记录条数</li>
<li><strong>在线系统</strong>：通常更看重服务的响应时间，即客户端从发生请求到接受响应之间的间隔</li>
</ul>
</li>
</ul>
</li>
<li><strong>应对方法</strong>：
<ul>
<li><strong>垂直扩展</strong>：升级到更强大的机器，相对比较容易</li>
<li><strong>水平扩展</strong>：将负载分布到多个更小的机器，分布式多机环境会增加复杂性</li>
<li><strong>综合两种扩展</strong>：通常是将数据库运行在一个节点上做垂直扩展，直到高扩展性或高可用性的要求迫使不得不做出水平扩展</li>
</ul>
</li>
</ul>
<h2 data-id="heading-5">二、数据存储</h2>
<h3 data-id="heading-6">1. 存储模型选择</h3>
<ul>
<li><strong>有哪些存储模型</strong>：
<ul>
<li><strong>关系模型</strong>：关系(表)只是元组(行)的集合。没有复杂的嵌套结构，也没有复杂的访问路径</li>
<li><strong>文档模型</strong>：使用如JSON、XML格式来保存数据。父记录中保存了嵌套记录，而不是存储在单独的表中</li>
</ul>
</li>
<li><strong>关系数据库适合的场景</strong>：
<ul>
<li><strong>数据复杂且稳定</strong>：如电商订单系统，金融交易系统</li>
<li><strong>强事务需求</strong>：需保证数据一致性，依赖事务防止数据异常</li>
<li><strong>结构化查询频繁</strong>：需复杂统计分析，如多表JOIN、分组聚合、子查询</li>
</ul>
</li>
<li><strong>文档数据库适合的场景</strong>：
<ul>
<li><strong>数据结构多变</strong>：如内容管理系统，文章可能包含文本、图片、标签等不同字段</li>
<li><strong>高写入吞吐量</strong>：如日志存储、物联网设备数据(每秒数万条写入)</li>
<li><strong>查询以单文档为主</strong>：无需复杂跨表关联，查询多为文档大部分内容</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">2. <strong>数据存储结构</strong></h3>
<ul>
<li><strong>哈希索引</strong>：
<ul>
<li><strong>简单实现</strong>：
<ul>
<li><strong>持久化数据</strong>：保存内存中的hashmap，每个键映射到文件中的字节偏移量</li>
<li><strong>分段保存</strong>：将日志分解成一定大小的段</li>
<li><strong>压缩</strong>：在日志中丢弃重复的键，只保留每个键最近的更新</li>
</ul>
</li>
<li><strong>优点</strong>：实现简单，查询效率高</li>
<li><strong>缺点</strong>：
<ul>
<li><strong>哈希表必须全部放入内存</strong>：如果有大量的键，会难以处理</li>
<li><strong>区间查询效率不高</strong>：只能通过逐个查找的方式查询每一个键</li>
</ul>
</li>
</ul>
</li>
<li><strong>SSTables(排序字符串表)</strong> ：
<ul>
<li><strong>概念</strong>：改变段文件的格式，要求key-value对的顺序按键排序</li>
<li><strong>优点</strong>：
<ul>
<li><strong>合并段更容易</strong>：合并段更加简单高效，因为key是排序的</li>
<li><strong>减少内存占用</strong>：在文件中查找特定的键时，不再需要在内存中保存所有键的索引</li>
<li><strong>擅于范围查询</strong>：将一个范围的记录写到一个块中并压缩</li>
</ul>
</li>
<li><strong>应用</strong>：Cassandra和HBase</li>
</ul>
</li>
<li><strong>B-Tree</strong>：
<ul>
<li><strong>概念</strong>：按键排序key-value对，将数据库分解成固定大小的块或页，树型结构，叶子节点间有双向指针，只有叶子节点保存数据</li>
<li><strong>对比B-Tree和LSM-Tree</strong>：
<ul>
<li><strong>LSM-Tree优点</strong>：
<ul>
<li><strong>写入更快</strong>：B-Tree索引必须至少写两次数据，一次写入预写日志，一次写入树的页本身</li>
<li><strong>写放大低</strong>：日志结构索引也会重写数据的次数更少</li>
<li><strong>吞吐量更高</strong>：顺序方式写入紧凑的SSTable，不必重写树中的多个页</li>
<li><strong>更好支持压缩</strong>：B-Tree会导致部分页中空间无法使用，LSM-Tree不是面向页的，并且定期重写SSTable以消化碎片</li>
</ul>
</li>
<li><strong>LSM-Tree缺点</strong>：
<ul>
<li><strong>干扰读写操作</strong>：压缩过程有时会干扰正在进行的读写操作</li>
<li><strong>磁盘带宽占用大</strong>：写入磁盘和压缩线程要共享磁盘带宽</li>
<li><strong>压缩速率可能不足</strong>：压缩速率可能无法匹配新数据写入速率</li>
<li><strong>键没有自己专属的物理空间</strong>：B-Tree每个键都恰好唯一对应于索引中的某个位置，而日志结构的存储引擎可能在不同的段中具有相同键的多个副本</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>列式存储</strong>：
<ul>
<li><strong>概念</strong>：数据量极大时采用，将每列中的所有值存储在一起</li>
<li><strong>优势</strong>：
<ul>
<li><strong>适合压缩</strong>：通过位图编码压缩，列中有大量重复的值时使用。一个位图对应每个不同的值，一个位对应一行。如果行具有该值，为1，否则为0</li>
<li>CPU高效利用：查询引擎可以将一大块压缩列数据放入CPU的L1缓存中进行处理</li>
</ul>
</li>
<li><strong>劣势</strong>：不适合频繁写，因为数据是排序的，插入操作必须一致更新所有列</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">3.索引选择</h3>
<ul>
<li><strong>在索引中存储值</strong>：
<ul>
<li><strong>聚集索引</strong>：在索引中直接保存行数据</li>
<li><strong>非聚集索引</strong>：仅存储索引中的数据的引用</li>
<li><strong>覆盖索引</strong>：在引用中保存一些表的列值，只通过索引即可回答某些简单查询</li>
</ul>
</li>
<li><strong>多列索引</strong>：最常见的多列索引类型称为级联索引，它通过将一列追加到另一列，将几个字段简单地组合成一个键(索引的定义指定字段连接的顺序)</li>
<li><strong>全文搜索和模糊索引</strong>：Lucene对其词典使用类似SSTable的结构，内存中有一个索引，是键中字符序列的有限状态自动机，类似字典树，它支持在给定编辑距离内高效地搜索单词</li>
<li><strong>在内存中保存所有内容</strong>：随着内存变得便宜，许多数据集不是那么大，可以将它们完全保留在内存中，或者分布在多台机器上，这推动了内存数据库的发展</li>
</ul>
<h2 data-id="heading-9">三、数据编码与传输</h2>
<h3 data-id="heading-10">1. 数据表现形式</h3>
<ul>
<li><strong>在内存中</strong>：数据保存在对象、结构体、列表、数组哈希表和树等结构中。这些数据结构针对CPU的高效访问和操作进行了优化(通常使用指针)</li>
<li><strong>将数据写入文件或通过网络发送时</strong>：必须将其编码为某种自包含的字节序列(如JSON文档)</li>
</ul>
<h3 data-id="heading-11">2. 数据编码方式</h3>
<ul>
<li><strong>语言特定的编码格式</strong>：
<ul>
<li><strong>概念</strong>：许多编程语言都内置支持将内存中的对象编码为字节序列。如Java的java.io.Serializable</li>
<li><strong>存在的问题</strong>：
<ul>
<li><strong>强绑定语言</strong>：另一种语言访问数据非常困难</li>
<li><strong>兼容性问题</strong>：通常存在向前和向后兼容性的问题</li>
<li><strong>效率偏低</strong>：编码、解码花费时间长</li>
</ul>
</li>
</ul>
</li>
<li><strong>JSON与XML</strong>：
<ul>
<li><strong>概念</strong>：JSON、XML是可由不同编程语言编写和读取的标准化编码</li>
<li><strong>存在的问题</strong>：
<ul>
<li><strong>数字编码模糊</strong>：在XML和CSV中，无法区分数字和碰巧由数字组成的字符串；JSON区分字符串和数字，但不区分整数和浮点数，而且不指定精度</li>
<li><strong>不支持二进制字符串</strong>：不支持没有字符编码的字节序列</li>
<li><strong>需要硬编码</strong>：对于一些特殊条件(如数字问题)需要硬编码来处理</li>
</ul>
</li>
</ul>
</li>
<li><strong>二进制编码</strong>：
<ul>
<li><strong>概念</strong>：二进制占用的空间更少，JSON不像XML那么冗长，但与二进制格式相比，两者仍然占用大量空间</li>
<li><strong>模式</strong>：类似于Java中定义的类，描述了数据的类型，字段名等</li>
<li><strong>模式兼容性问题</strong>：
<ul>
<li><strong>向前兼容</strong>：不能随便更改字段的标签，会导致所有现有编码数据无效；可以添加新的字段到模式，给一个新的标记号码</li>
<li><strong>向后兼容</strong>：
<ul>
<li>只要每个字段都有一个唯一的标记号码，新的代码总是可以读取旧的数据，因为标记号码仍然具有相同的意义。</li>
<li>有一个问题添加新字段时需要设置为可选字段，设置为必需字段时，新代码读取旧代码写入的数据，该检查将失败，因为旧代码不会写入添加的新字段</li>
</ul>
</li>
</ul>
</li>
<li><strong>基于模式的二进制编码优点</strong>：
<ul>
<li><strong>结构紧凑</strong>：它们可以比各种“二进制JSON”变体更紧凑，可以省略编码数据中的字段名称</li>
<li><strong>文档维护</strong>：模式是一种有价值的文档形式，因为模式是解码所必需的，所以可以确定它是最新的(而手动维护的文档可能很容易偏离现实)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-12">3. 基于数据库的数据流</h3>
<ul>
<li><strong>概念</strong>：在数据库中，写入数据库的进程对数据进行编码，而读取数据库的进程对数据进行解码</li>
<li><strong>兼容性问题</strong>：
<ul>
<li><strong>旧数据不重写</strong>：对数据库来说，数据比代码更长久。读取旧行时，数据库会为磁盘上编码数据缺失的所有列填充为空值</li>
<li><strong>归档存储</strong>：在数据库创建快照或备份时，数据库会使用最新的模式进行编码</li>
</ul>
</li>
</ul>
<h3 data-id="heading-13">4. 基于服务的数据流</h3>
<ul>
<li><strong>Web服务方法</strong>：
<ul>
<li><strong>REST</strong>：不是一种协议，而是一个基于HTTP原则的设计理念。它强调简单的数据格式，使用URL来标识资源，并使用HTTP功能进行缓存控制、身份验证和内容类型协商</li>
<li><strong>SOAP</strong>：是一种基于XML的协议，用于发出网络API请求。虽然它最常用于HTTP，但其目的是独立于HTTP，并避免使用大多数HTTP功能</li>
</ul>
</li>
<li><strong>远程过程调用(RPC)</strong> ：
<ul>
<li><strong>概念</strong>：RPC模型试图使向远程网络服务发出请求看起来与在同一进程中调用编程语言中的函数或方法相同。但其实他们是有显著不同的，新一代RPC框架更加明确了远程请求与本地函数调用不同的事实</li>
<li><strong>提供的功能</strong>：
<ul>
<li>封装可能失败的异步操作</li>
<li>简化了需要并行请求多项服务的情况，并将其结果合并</li>
<li>提供服务发现，允许客户端查询在哪个IP地址和端口号上获得特定的服务</li>
</ul>
</li>
<li><strong>REST和RPC对比</strong>：REST是公共API的主流风格，RPC框架主要侧重于同一组织内多项服务之间的请求，通常放生在同一数据中心内</li>
</ul>
</li>
<li><strong>基于消息传递的数据流</strong>：
<ul>
<li><strong>概念</strong>：一个进程向指定的队列或主题发送消息，并且代理确保消息被传递给队列或主题的一个或多个消费者或订阅者。在同一个主题上可以有许多生产者和许多消费者</li>
<li><strong>与RPC的差异</strong>：消息传递通信通常是单向的，发送方通常不期望收到对其消息的回复</li>
<li><strong>与RPC相比的优势</strong>：
<ul>
<li><strong>持久化</strong>：如果接收方不可用或过载，它可以充当缓冲区，提高系统的可靠性</li>
<li><strong>自动重发</strong>：它可以自动将消息重新发送到崩溃的进程，从而防止消息丢失</li>
<li><strong>解耦</strong>：它避免了发送方需要知道接收方的IP地址和端口号</li>
<li><strong>一对多发送</strong>：它支持将一条消息发送给多个接收方</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-14">5. RPC与本地函数有哪些不同</h3>
<ul>
<li><strong>不清楚执行结果</strong>：
<ul>
<li><strong>本地函数调用</strong>：要么返回一个结果，要么抛出一个异常，或者永远不会返回(死循环或进程崩溃)</li>
<li><strong>网络请求调用</strong>：有另一个结果，可能会超时，这种情况下，不知道请求是否成功</li>
</ul>
</li>
<li><strong>可能执行多次</strong>：
<ul>
<li><strong>本地函数调用</strong>：没有这个问题</li>
<li><strong>网络请求调用</strong>：如果重试失败的网络请求，可能会发生请求实际上已经完成，只是响应丢失的情况，需要建立幂等性机制</li>
</ul>
</li>
<li><strong>执行时间不稳定</strong>：
<ul>
<li><strong>本地函数调用</strong>：执行时间大致相同</li>
<li><strong>网络请求调用</strong>：比本地调用慢得多，延迟变化大，可能1ms，也可能几秒</li>
</ul>
</li>
<li><strong>需要编码</strong>：
<ul>
<li><strong>本地函数调用</strong>：可以直接将引用(指针)传递给本地内存中的对象</li>
<li><strong>网络请求调用</strong>：需要编码成可以通过网络发送的字节序列</li>
</ul>
</li>
</ul>
<h2 data-id="heading-15">四、事务</h2>
<h3 data-id="heading-16">1. 什么是事务</h3>
<ul>
<li><strong>概念</strong>：事务将应用程序的多个读、写操作捆绑在一起称为一个逻辑操作单元。即事务中的所有读写要么全部成功(提交)，要么全部失败(中止或回滚)</li>
</ul>
<h3 data-id="heading-17">2. 什么是ACID</h3>
<ul>
<li><strong>原子性</strong>：在出错时中止事务，并将部分完成的写入全部丢弃</li>
<li><strong>一致性</strong>：对数据有特定的预期状态，任何数据更改必须满足这些状态约束(或恒等条件)</li>
<li><strong>隔离性</strong>：并发执行的多个事务相互隔离</li>
<li><strong>持久性</strong>：对于单节点数据库，持久性通常意味着数据已被写入非易失性存储设备，如硬盘或SSD；而对于支持远程复制的数据库，持久性则意味着数据已成功复制到多个节点</li>
</ul>
<h3 data-id="heading-18">3. 事务一致性问题</h3>
<ul>
<li><strong>脏读</strong>：读取了其他事务未提交的修改</li>
<li><strong>不可重复读</strong>：多次读取同一数据，读取结果不一致</li>
<li><strong>幻读</strong>：按同一条件多次查询，数据数量不一致</li>
</ul>
<h3 data-id="heading-19">4. 事务隔离级别</h3>
<ul>
<li><strong>读未提交</strong>：无隔离，事务可以读取其他事务未提交的修改</li>
<li><strong>读已提交</strong>：事务只能读到其他事务已提交的修改</li>
<li><strong>可重复读</strong>：事务多次读取同一数据，结果始终一致</li>
<li><strong>可串行化</strong>：事务完全串行执行</li>
</ul>
<h3 data-id="heading-20">5. 什么是MVCC</h3>
<ul>
<li><strong>概念</strong>：多个正在进行的事务可能会在不同的时间点查看数据库状态，所以数据库保留了对象多个不同的提交版本</li>
<li><strong>读已提交隔离实现</strong>：保留对象的两个版本，已提交的旧版本和尚未提交的新版本</li>
<li><strong>MVCC可见性规则</strong>：
<ul>
<li><strong>正在运行的事务(即尚未提交或中止)</strong> ：完成的部分写入不可见</li>
<li><strong>中止的事务</strong>：所做修改不可见</li>
<li><strong>较晚开始的事务</strong>：所做修改不可见，不管这些事务是否完成了提交</li>
</ul>
</li>
<li><strong>MVCC支持索引</strong>：
<ul>
<li><strong>版本过滤</strong>：索引指向对象所有版本，再过滤对当前事务不可见的旧版本</li>
<li><strong>追加式写入</strong>：每个写入事务创建一个B-Tree根节点，代表该时刻数据库的一致性快照</li>
</ul>
</li>
</ul>
<h3 data-id="heading-21">6. 如何处理事务并发写更新丢失</h3>
<ul>
<li><strong>原子写操作</strong>：许多数据库提供了原子更新操作，以避免在应用层代码完成“读-修改-写回”操作，如果支持的话，通常这就是最好的解决方案。如Redis提供了对特定数据结构修改的原子操作</li>
<li><strong>显式加锁</strong>：由应用程序显式锁定待更新的对象。之后应用程序可以执行“读-修改-写回”这样的操作序列，此时如果有其他事务尝试同时读取对象，则必须等待当前正在执行的序列全部完成</li>
<li><strong>乐观锁</strong>：先让它们并发执行，但如果事务管理器检测到了更新丢失风险，则会中止当前事务，并强制回退到安全的“读-修改-写回”方式。Oracle的可串行化可以自动检测更新丢失，中止违规事务；但Mysql/InnoDB的可重复读却并不支持检测更新丢失</li>
<li><strong>原子比较和设置</strong>：在不提供事务支持的数据库中，有时你会发现它们支持原子“比较和设置”操作。使用该操作可以避免更新丢失，即只有在上次读取的数据没有发生变化时才允许更新；如果已经发生了变化，则回退到“读-修改-写回”方式</li>
<li><strong>应用层解决</strong>：对于支持多副本的数据库，不同的节点可能会并发修改数据，需要采取额外的措施。多副本数据库通常支持多个并发写，然后保留多个冲突版本，之后由应用层逻辑或依靠特定的数据结构来解决</li>
</ul>
<h3 data-id="heading-22">7. 两阶段加锁实现可串行化</h3>
<ul>
<li><strong>概念</strong>：第一阶段事务执行之前要获取锁，第二阶段事务结束时释放锁</li>
<li><strong>加锁的类型</strong>：
<ul>
<li><strong>行锁</strong>：写操作加锁独占访问，缺点是性能不佳，容易死锁</li>
<li><strong>谓词锁</strong>：对满足查询条件的所有对象加锁，可以防止幻读，缺点是性能不佳，检查匹配各种锁就非常耗时</li>
<li><strong>索引区间锁</strong>：将谓词锁保护的对象扩大化，查询条件的近似值都附加到某个索引上，可以防止幻读，相比谓词锁没有那么精确，但开销低的多</li>
</ul>
</li>
</ul>
<h3 data-id="heading-23">8. 快照隔离实现可串行化</h3>
<ul>
<li><strong>概念</strong>：是一种乐观并发控制。数据库希望事务间相安无事，当事务提交时，数据库会检查是否发生了冲突，如果有冲突，中止事务并接下来重试</li>
<li><strong>具体实现</strong>：
<ul>
<li><strong>检测是否读取了过期的MVCC对象</strong>：当事务提交时，数据库会检查是否存在一些当初被忽略的写操作现在已经完成了提交，如果是则必须中止当前事务</li>
<li><strong>检测写是否影响了之前的读</strong>：当另一个事务尝试修改时，它首先检查索引，从而确定是否存在一些读目标数据的其他事务</li>
</ul>
</li>
<li><strong>优缺点对比</strong>：
<ul>
<li><strong>与两阶段加锁相比</strong>：事务不需要等待其他事务所持有的锁。在一致性快照上执行只读查询不需要任何锁，这对于读密集的负载非常有吸引力</li>
<li><strong>与串行执行相比</strong>：可串行化快照隔离可以突破单个CPU核的限制。可以将冲突检测分布在多台机器上，从而提高总体吞吐量</li>
</ul>
</li>
</ul>
<h2 data-id="heading-24">五、分布式系统设计——数据复制</h2>
<h3 data-id="heading-25">1. 什么是主从复制</h3>
<ul>
<li><strong>概念</strong>：基于主节点复制数据。写请求首先发送给主节点，主节点再同步数据给从节点；读请求可以在主节点或从节点执行查询</li>
</ul>
<h3 data-id="heading-26">2. 数据复制方式有哪些</h3>
<ul>
<li><strong>异步复制</strong>：
<ul>
<li><strong>概念</strong>：主节点发送完消息之后立即返回，不用等待从节点完成确认</li>
<li><strong>优点</strong>：吞吐性能更好，不管从节点上数据多么滞后，主节点总是可以继续响应写请求</li>
</ul>
</li>
<li><strong>同步复制</strong>：
<ul>
<li><strong>概念</strong>：主节点需等待直到从节点确认完成了写入，然后才会向用户报告完成</li>
<li><strong>优点</strong>：从节点的数据总是最新的</li>
<li><strong>缺点</strong>：写操作可能会被阻塞，如果同步的从节点无法完成确认(如节点崩溃或网络故障)，写入就不能视为成功，主节点会阻塞其后所有的写操作，直到同步副本确认</li>
</ul>
</li>
</ul>
<h3 data-id="heading-27">3. 新的从节点加入</h3>
<ul>
<li><strong>需要解决的问题</strong>：不能简单的复制数据，因为客户端在不断向数据库写入新数据，无法保证数据一致性</li>
<li><strong>解决方法</strong>：
<ul>
<li><strong>生成快照</strong>：在某个时间点对主节点的数据副本产生一个一致性快照，这样避免长时间锁定整个数据库</li>
<li><strong>拷贝数据</strong>：将此快照拷贝到新的从节点</li>
<li><strong>获取日志</strong>：从节点连接到主节点并请求快照点之后所发生的数据更改日志</li>
<li><strong>追赶数据</strong>：获得日志之后，从节点来应用这些快照点之后所有数据变更，这个过程称之为追赶</li>
</ul>
</li>
</ul>
<h3 data-id="heading-28">4. 节点失效处理</h3>
<ul>
<li><strong>从节点失效——追赶式恢复</strong>：根据从节点的日志，获取到发生故障前所处理的最后一笔事务，然后连接主节点，请求自那笔事务之后中断期间内所有的数据变更</li>
<li><strong>主节点失效——节点切换</strong>：切换某个从节点为主节点
<ul>
<li><strong>具体切换步骤</strong>：
<ul>
<li><strong>确认主节点失效</strong>：节点间频繁地互相发送心跳存活消息，如果某节点长时间(如30s)无响应，即认为该节点发生失效</li>
<li><strong>选举新的主节点</strong>：选举新的主节点，需要多数的节点达成共识</li>
<li><strong>使新主节点生效</strong>：客户端将写请求发送给新的主节点</li>
</ul>
</li>
<li><strong>存在的问题</strong>：
<ul>
<li><strong>主节点重新上线后试图继续同步数据</strong>：使用异步复制可能会发生，解决方案是未完成同步的写请求直接丢弃</li>
<li><strong>两个节点同时都自认为是主节点(脑裂现象)</strong> ：两个主节点都可能接受写请求，解决方案是强制关闭其中一个节点</li>
<li><strong>超时时间设置不合理</strong>：主节点失效后，超时时间设置得越长也意味着总体恢复时间就越长。但如果超时设置太短，可能会导致很多不必要的切换</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-29">5. 复制日志的实现</h3>
<ul>
<li><strong>基于语句的复制</strong>：
<ul>
<li><strong>实现</strong>：主节点记录所执行的每个写请求(操作语句)并将该操作语句作为日志发送给从节点</li>
<li><strong>缺点</strong>：调用非确定性函数的语句，如NOW()获取当前时间，可能会在不同的从节点上产生不同的值</li>
</ul>
</li>
<li><strong>基于预写日志(WAL)传输</strong>：
<ul>
<li><strong>实现</strong>：所有对数据库写入的字节序列都被记入日志，从节点收到日志后构建副本</li>
<li><strong>缺点</strong>：从节点复制时要停机，否则主从节点会不一致</li>
</ul>
</li>
<li><strong>基于行的逻辑日志复制</strong>：
<ul>
<li><strong>实现</strong>：复制和存储引擎采用不同的日志格式，如Mysql的binlog</li>
<li><strong>优势</strong>：逻辑日志与存储引擎解耦，可以更容易做兼容性处理</li>
</ul>
</li>
<li><strong>基于触发器的复制</strong>：
<ul>
<li><strong>实现</strong>：读取数据库日志让应用程序获取数据变更，支持注册自己的应用层代码</li>
<li><strong>优势</strong>：灵活度高</li>
</ul>
</li>
</ul>
<h3 data-id="heading-30">6. 复制滞后解决</h3>
<ul>
<li><strong>读自己的写</strong>：
<ul>
<li><strong>现象</strong>：用户写后马上读，可能读不到数据。因为提交新数据是到主节点，但当用户读数据时，数据可能来自从节点</li>
<li><strong>解决方案</strong>：
<ul>
<li><strong>强制读主节点</strong>：访问可能会被修改的数据，强制读主节点</li>
<li><strong>刚更新时读主节点</strong>：跟踪最近更新时间，更新后一分钟内从主节点读取</li>
<li><strong>记录时间戳</strong>：记录最近更新的时间戳，并附带在读请求中，系统确保该用户提供读服务时都应该至少包含了该时间戳的更新</li>
</ul>
</li>
</ul>
</li>
<li><strong>单调读</strong>：
<ul>
<li><strong>现象</strong>：用户从不同从节点进行了多次读取，两个从节点滞后程度不同。第一次查询返回数据，但第二次查询没有返回数据</li>
<li><strong>解决方案</strong>：确保每个用户总是从固定的同一从节点执行读取，如基于用户ID的哈希而不是随机选择从节点</li>
</ul>
</li>
<li><strong>前缀一致性</strong>：
<ul>
<li><strong>现象</strong>：两个服务器对话，第三个观察者服务收听，先发的消息滞后较少，后发的消息滞后较多，导致顺序混乱</li>
<li><strong>解决方案</strong>：确保任何具有因果顺序关系的写入都交给一个分区来完成</li>
</ul>
</li>
</ul>
<h3 data-id="heading-31">7. 什么是多主节点复制</h3>
<ul>
<li><strong>概念</strong>：配置多个主节点，每个主节点都可以接受写操作，后面复制的流程与主从复制模型类似</li>
</ul>
<h3 data-id="heading-32">8. 多主节点复制应用场景</h3>
<ul>
<li><strong>场景</strong>：多数据中心适合使用多主节点复制，为了容忍整个数据中心级别故障或者更接近用户，这时多主节点就更有优势</li>
<li><strong>和单主从复制的差异</strong>：
<ul>
<li><strong>性能</strong>：每个写操作都可以在本地数据中心快速响应，然后采用异步复制方式将变化同步到其他数据中心，对上层应用有效屏蔽了数据中心之间的网络延迟</li>
<li><strong>容忍数据中心失效</strong>：每个数据中心可以独立于其他数据中心继续运行，发生故障的数据中心在恢复之后更新到最新状态，无需主节点切换</li>
<li><strong>容忍网络问题</strong>：采用异步复制，可以更好地容忍数据中心之间的网络延迟</li>
</ul>
</li>
</ul>
<h3 data-id="heading-33">9. 多主节点复制如何处理写冲突</h3>
<ul>
<li><strong>避免冲突</strong>：如果应用层可以保证对特定记录的写请求总是通过同一个主节点，这样就不会发生写冲突</li>
<li><strong>收敛于一致状态(同一个字段多次更新)</strong> ：
<ul>
<li><strong>给每个写入分配唯一的ID</strong>：例如一个时间戳，挑选最大的值写入，被称为最后写入者获胜</li>
<li><strong>为每个副本分配一个唯一的ID</strong>：制定规则，序号高的副本写入始终优先于序号低的副本</li>
<li><strong>以某种方式将这些值合并在一起</strong>：如按字母顺序排序后拼接</li>
<li><strong>应用层解决</strong>：保存冲突信息，依靠应用层的逻辑事后解决冲突</li>
</ul>
</li>
<li><strong>自定义冲突解决逻辑</strong>：
<ul>
<li><strong>在写入时执行</strong>：只要数据库系统在复制日志时检测到冲突，就会调用应用层的冲突处理程序</li>
<li><strong>在读取时执行</strong>：当检测到冲突时，所有冲突写入值都会暂时保存下来。下一次读取数据时，会将数据的多个版本读返回给应用层，应用层可能会提示用户或自动解决冲突，并将最后的结果返回到数据库</li>
</ul>
</li>
</ul>
<h3 data-id="heading-34">10. 什么是无主节点复制</h3>
<ul>
<li><strong>概念</strong>：一些数据存储系统选择放弃主节点，允许任何副本直接接受来自客户端的写请求</li>
</ul>
<h3 data-id="heading-35">11. 无主节点复制存在的问题</h3>
<ul>
<li><strong>节点失效时写入数据库</strong>：
<ul>
<li>让客户端从多个节点读数据，根据版本号确定哪个值是最新的</li>
</ul>
</li>
<li><strong>失效节点重新上线后数据恢复</strong>：
<ul>
<li><strong>读修复</strong>：客户端并行读取多个副本时，可以检测到过期的返回值，然后将新值写入到该副本。适合数据被频繁读取的场景</li>
<li><strong>反熵</strong>：一些数据存储有后台进程不断查找副本之间数据的差异，将任何缺少的数据从一个副本复制到另一个副本</li>
</ul>
</li>
</ul>
<h3 data-id="heading-36">12. 判断操作有效性的规则——Quorum</h3>
<ul>
<li><strong>概念</strong>：如果有n个副本，并且配置w和r，使得w+r&gt;n，可以预期可以读到一个最新值。因为成功写入的节点和读取的节点集合必然有重合</li>
<li><strong>应用场景</strong>：ZooKeeper主节点选举，确保选举结果的唯一性和有效性，避免脑裂</li>
</ul>
<h3 data-id="heading-37">13. 并发写冲突处理机制</h3>
<ul>
<li><strong>最后写入者获胜(丢弃并发写入)</strong> ：
<ul>
<li><strong>概念</strong>：每个副本总是保存最新值，允许覆盖并丢弃旧值</li>
<li><strong>具体实现</strong>：为每个写请求附加一个时间戳，然后选择最新即最大的时间戳，丢弃较早时间戳的写入。是Cassandra仅有的冲突解决方法</li>
<li><strong>缺点</strong>：牺牲了数据持久性，一些数据会被丢弃</li>
</ul>
</li>
<li><strong>使用唯一的主键</strong>：这样就避免了对同一个主键的并发写。例如，Cassandra的一个推荐使用方法就是采用UUID作为主键，这样每个写操作都针对不同的、系统唯一的主键</li>
</ul>
<h2 data-id="heading-38">六、分布式系统设计——数据分区</h2>
<h3 data-id="heading-39">1. 什么是数据分区</h3>
<ul>
<li><strong>概念</strong>：分区通常与复制结合使用，即每个分区在多个节点都存有副本。这意味着某条记录属于特定的分区，而同样的内容会保存在不同的节点上以提高系统的容错性</li>
</ul>
<h3 data-id="heading-40">2. 如何避免分区不均匀</h3>
<ul>
<li><strong>基于关键字区间分区</strong>：
<ul>
<li><strong>概念</strong>：为每个分区分配一个关键字区间范围。这样知道关键字上下限，就可知道其所属分区</li>
<li><strong>缺点</strong>：某些访问模式会导致热点。如果每天一个分区，会导致该分区在写入时负载过高</li>
</ul>
</li>
<li><strong>基于关键字哈希值分区</strong>：
<ul>
<li><strong>概念</strong>：一个好的哈希函数可以处理数据倾斜并使其均匀分布。即使输入的字符串非常相似，返回的哈希值也会在上述数字范围内均匀分布</li>
<li><strong>缺点</strong>：丧失了良好的区间查询特性</li>
<li><strong>改进</strong>：采用复合主键，一部分用于哈希分区，其他用来排序和范围查询。如关键字(user_id, update_timestamp)，user_id用来分区，时间戳用来区间查询</li>
</ul>
</li>
</ul>
<h3 data-id="heading-41">3. 极端的数据倾斜如何处理</h3>
<ul>
<li><strong>概念</strong>：所有的读/写操作都是针对同一个关键字，最终所有请求都被路由到同一个分区。如微博热点事件，大量用户都对相同关键字进行操作</li>
<li><strong>解决方案</strong>：如果某个关键字被确认为热点，在关键字的开头或结尾处添加一个随机数，这样就可以把相同关键字分到不同的分区上</li>
</ul>
<h3 data-id="heading-42">4. 如何对二级索引做分区</h3>
<ul>
<li><strong>分区独立</strong>：
<ul>
<li><strong>概念</strong>：每个分区维护自己的二级索引，不关心其他分区中的数据</li>
<li><strong>缺点</strong>：查询代价高昂，需要把所有分区的数据聚合起来</li>
</ul>
</li>
<li><strong>全局索引</strong>：
<ul>
<li><strong>概念</strong>：对所有数据构建全局索引，全局索引再进行分区</li>
<li><strong>缺点</strong>：写入速度慢且复杂，更新时可能涉及到多个二级索引，而二级索引的分区又可能完全不同甚至在不同的节点上</li>
</ul>
</li>
</ul>
<h3 data-id="heading-43">5. 如何进行分区再平衡</h3>
<ul>
<li><strong>取模(不推荐使用)</strong> ：取模可以重新分区，但会导致很多关键字需要从现有的节点迁移到另一个节点，这种频繁的迁移操作大大增加了再平衡的成本</li>
<li><strong>固定数量分区</strong>：创造远超实际节点数的分区数，如果集群新增节点，该新节点可以从每个现有节点匀走几个分区</li>
<li><strong>动态分区</strong>：当分区的增长超过一个可配的参数阈值，就拆分为两个分区，每个承担一半的数据量。大量数据删除则分区进行合并</li>
<li><strong>按节点比例分区</strong>：每个节点具有固定数量的分区，这样分区的数量与数据集的大小成正比关系</li>
</ul>
<h3 data-id="heading-44">6. 如何路由到指定分区</h3>
<ul>
<li><strong>节点分发</strong>：客户端连接任意节点，该节点拥有所请求分区则直接处理，否则将请求转发到下一个合适的节点</li>
<li><strong>路由层</strong>：所有客户端请求都先发到路由层，路由层将请求转发到对应的分区节点上</li>
<li><strong>客户端选择</strong>：客户端感知分区和节点分配关系，客户端可以直接连接到目标节点</li>
</ul>
<h2 data-id="heading-45">七、分布式系统故障处理</h2>
<h3 data-id="heading-46">1. 分布式系统可靠工作的挑战</h3>
<ul>
<li>必然面临部分失效，这就需要依靠软件系统来提供容错机制</li>
<li>换句话说，我们需要在不可靠的组件之上构建可靠的系统</li>
</ul>
<h3 data-id="heading-47">2. 网络通信存在的问题</h3>
<ul>
<li>一个节点可以发送消息(数据包)到另一个节点，但是网络并不保证它什么时候到达，甚至是否一定到达</li>
</ul>
<h3 data-id="heading-48">3. 发送者未收到消息回复如何解决</h3>
<ul>
<li><strong>现象</strong>：发送者拥有的唯一信息是，尚未收到响应，但却无法判定具体原因</li>
<li><strong>解决方法</strong>：通常采用超时机制。但是，即使判定超时，仍然并不清楚远程节点是否收到了请求</li>
</ul>
<h3 data-id="heading-49">4. 超时时间如何设定</h3>
<ul>
<li><strong>分析</strong>：设置较长的超时值意味着更长时间的等待，才能宣告节点失败；设置较短则可能出现误判</li>
<li><strong>设置方法</strong>：
<ul>
<li><strong>一种方法是，通过实验一步步设置超时。</strong> 先在多台机器上，多次测量网络往返时间，以确定延迟的大概范围；然后结合应用特点，在故障检测与过早超时风险之间选择一个合适的中间值</li>
<li><strong>更好的做法是，超时设置并不是一个不变的常量。</strong> 而是持续测量响应时间及其变化，然后根据最新的响应时间分布来自动调整。可以用Phi Accrual故障检测器完成，该检测器目前已在Cassandra中使用</li>
</ul>
</li>
</ul>
<h3 data-id="heading-50">5. 分布式系统时间问题</h3>
<ul>
<li>由于跨节点通信不可能即时完成，消息经由网络从一台机器到另一台机器总是需要花费时间。网络的延迟不确定，使得多节点通信很难确定事情发生的先后顺序</li>
</ul>
<h3 data-id="heading-51">6. 分布式系统时钟问题解决</h3>
<ul>
<li><strong>时间戳与事件排序</strong>：
<ul>
<li><strong>具体问题</strong>：跨节点的事件排序高度依赖时钟会有风险</li>
<li><strong>解决方法</strong>：基于递增计数器是更可靠的方式</li>
</ul>
</li>
<li><strong>时钟的置信区间</strong>：
<ul>
<li><strong>具体问题</strong>：石英漂移问题可导致偏差高达几毫秒，如果使用NTP服务器，因为网络延迟，最好的精度也只能到几十毫秒，还可能遭遇网络拥塞</li>
<li><strong>解决方法</strong>：不应该将时钟读数视为一个精确的时间点，而更应该视为带有置信区间的时间范围</li>
</ul>
</li>
<li><strong>全局快照的同步时钟</strong>：
<ul>
<li><strong>具体问题</strong>：有时需要同步时钟来做事务ID，用来判断事务发生的先后顺序</li>
<li><strong>解决方法</strong>：Google Spanner根据时钟置信区间，等待足够久的长度，确保所有读事务要足够晚才发生，避免与先前的事务的置信区间产生重叠(应用较少，只有Google有相关实现)</li>
</ul>
</li>
</ul>
<h3 data-id="heading-52">7. 导致进程暂停的原因</h3>
<ul>
<li><strong>Java垃圾回收</strong>：运行期间可能会暂停所有正在运行的线程(Stop the world)</li>
<li><strong>虚拟机暂停</strong>：暂停所有执行进程并将内存状态保存到磁盘</li>
<li><strong>操作系统线程上下文切换</strong>：负载很高时，被暂停的线程可能需要一段时间才能再次运行</li>
<li><strong>应用程序执行同步磁盘操作</strong>：线程可能暂停并等待磁盘I/O完成</li>
<li><strong>内存访问触发缺页中断</strong>：从磁盘中加载内存页，这个过程通常比较慢</li>
<li><strong>发送SIGSTOP信号暂停UNIX进程</strong>：会立即停止进程，直到收到SIGCONT之后才从停止的地方继续运行。运维人员可能误触发</li>
</ul>
<h3 data-id="heading-53">8. 分布式系统处理进程暂停</h3>
<ul>
<li>必须假定执行过程中的任何时刻都可能被暂停相当长一段时间，包括运行在某个函数中间</li>
<li>暂停期间，整个集群的其他部分都在照常运行，甚至会一致将暂停的节点宣告为故障节点</li>
<li>最终，暂停的节点可能会回来继续运行，除非再次检查时钟，否则它对刚刚过去的暂停毫无意识</li>
</ul>
<h2 data-id="heading-54">八、分布式系统一致性与共识</h2>
<h3 data-id="heading-55">1. 为什么需要一致性算法</h3>
<ul>
<li>节点不能根据自己的信息来判断自身的状态</li>
<li>节点可能随时会失效，甚至最终无法恢复。因此分布式系统不能完全依赖于单个节点</li>
</ul>
<h3 data-id="heading-56">2. 什么是一致性算法</h3>
<ul>
<li><strong>概念</strong>：许多分布式算法都依靠法定票数，任何决策都需要来自多个节点的最小投票数，从而减少对特定节点的依赖</li>
<li><strong>常见的法定票数</strong>：取系统节点半数以上</li>
</ul>
<h3 data-id="heading-57">3. 其他节点自认为是主节点如何处理</h3>
<ul>
<li><strong>原因</strong>：一个节点可能以前确实是主节点，但其他节点有可能在此期间已宣布其失效，系统已经选出了另一个主节点</li>
<li><strong>影响</strong>：该节点会按照自认为正确的信息向其他节点发送消息，其他节点如果还选择相信它，那么系统就会出现错误的行为</li>
<li><strong>解决方法</strong>：通过带令牌的分布式锁来解决。获取锁时同时返回一个令牌，该令牌的数字每授予一次就会递增(由锁服务增加)。客户端发送请求到存储服务器时携带令牌号，存储服务器如果记录了更高的令牌号，会拒绝低令牌号的写入</li>
</ul>
<h3 data-id="heading-58">4. 最终一致性和强一致性</h3>
<ul>
<li><strong>最终一致性</strong>：如果停止更新数据库，并等待一段时间之后，最终所有读请求会返回相同的内容</li>
<li><strong>强一致性</strong>：让一个系统看起来好像只有一个数据副本，且所有的操作都是原子的。有了这个保证，应用程序就不需要关心系统内部的多个副本</li>
</ul>
<h3 data-id="heading-59">5. 使用强一致性的场景</h3>
<ul>
<li><strong>加锁与主节点枚举</strong>：选举新的主节点常见的方法是使用锁，即每个启动的节点都试图获得锁，其中只有一个可以成功即成为主节点</li>
<li><strong>约束与唯一性保证</strong>：唯一性约束在数据库中很常见。例如，用户名或电子邮件地址必须唯一标识一个用户，文件存储服务中两个文件不能具有相同的路径和文件名</li>
<li><strong>跨通道的时间依赖</strong>：
<ul>
<li>一个存储照片服务，Web服务器会把照片先写入文件存储服务，当写入完成后，把调整图像分辨率的命令放入消息队列</li>
<li>消息队列可能比存储服务内部的复制执行更快，这样调整命令就无法读取到任何内容，或者读到旧版本</li>
<li>出现这个问题是因为Web服务器和调整模块之间存在两个不同的通信信道，文件存储器和消息队列。如果没有线性化的就近性保证，这两个通道之间就存在竞争条件</li>
</ul>
</li>
</ul>
<h3 data-id="heading-60">6. 各种分布式系统如何实现强一致性</h3>
<ul>
<li><strong>主从复制</strong>：部分支持强一致性
<ul>
<li><strong>从主节点或者同步更新的从节点上读取</strong>：可以满足强一致性</li>
<li><strong>从自以为主节点的从节点读取数据</strong>：会违反强一致性</li>
<li><strong>使用异步复制</strong>：同时违反持久性和强一致性，故障切换过程中甚至可能会丢失一些已提交的写入</li>
</ul>
</li>
<li><strong>多主复制</strong>：不支持强一致性
<ul>
<li>具有多主节点复制的系统通常无法线性化，主要由于它们同时在多个节点上执行并发写入，并将数据异步复制到其他节点</li>
</ul>
</li>
<li><strong>无主复制</strong>：可能支持强一致性
<ul>
<li>取决于具体的quorum的配置，以及如何定义强一致性，它可能并不保证线性化</li>
<li>基于墙上时钟的“最后写入获胜”冲突解决方法几乎肯定是非线性化，因为这种时间戳无法保证与实际事件顺序一致(例如由于时钟偏移)</li>
</ul>
</li>
</ul>
<h3 data-id="heading-61">7. 什么是CAP理论</h3>
<ul>
<li>代表强一致性、可用性、分区容错性，系统只能支持其中两个特性</li>
</ul>
<h3 data-id="heading-62">8. 分布式系统中如何生成序列号</h3>
<ul>
<li><strong>一些简单实现方法</strong>：
<ul>
<li><strong>每个节点都独立产生自己的一组序列号</strong>：可以在序列号中保留一些位用于嵌入所属节点的唯一标识符</li>
<li><strong>可以把墙上时间戳信息附加到每个操作上</strong>：时间戳可能是不连续的，但可以用来区分操作的先后顺序</li>
<li><strong>可以预先分配序列号的区间范围</strong>：如节点A负责区间1-1000，节点B负责区间1001-2000</li>
</ul>
</li>
<li><strong>存在问题</strong>：无法保证正确捕获跨节点操作的顺序
<ul>
<li>每个节点可能有不同的处理速度，如每秒请求数，这样就无法准确地知道哪个操作在先</li>
<li>物理时钟的时间戳会收到时钟偏移的影响，可能导致实际因果关系不一致</li>
<li>对于区间分配器，一个操作可能被赋予到B节点，而后发生的操作又可能赋予到A节点。导致与因果序不一致</li>
</ul>
</li>
<li><strong>Lamport时间戳(是一个理论模型)</strong> ：
<ul>
<li><strong>具体实现</strong>：是一个值对(计数器，节点ID)，每个节点都使用所见到的最大计数器值，计数器值相同时按节点ID排序</li>
</ul>
</li>
</ul>
<h2 data-id="heading-63">九、分布式事务——分布式系统的一致性实现</h2>
<h3 data-id="heading-64">1. 什么是两阶段提交(2PC)</h3>
<ul>
<li><strong>概念</strong>：是一种在多节点之间实现事务原子提交的算法，用来确保所有节点要么全部提交，要么全部中止</li>
<li><strong>具体实现</strong>：
<ul>
<li><strong>请求提交事务</strong>：当应用程序准备提交事务时，协调者开始阶段1：发送一个准备请求到所有节点，询问他们是否可以提交</li>
<li><strong>提交事务</strong>：如果所有参与者回答“是”，表示他们已经准备好提交，那么协调者接下来在阶段2会发出提交请求，提交开始实际执行</li>
<li><strong>回滚事务</strong>：如果有任何参与者回复“否”，则协调者在阶段2中向所有节点发送放弃请求</li>
</ul>
</li>
</ul>
<h3 data-id="heading-65">2. 如果2PC中协调者发生故障怎么办</h3>
<ul>
<li>如果在决定到达之前，出现协调者崩溃或网络故障，则参与者只能无奈等待。此时参与者处在一种不确定的状态</li>
<li>2PC能够顺利完成的唯一方法是等待协调者恢复。这就是为什么协调者必须在向参与者发送提交(或中止)请求之前要将决定写入磁盘的事务日志，等待协调者恢复之后，通过读取事务日志来确定所有未决的事务状态</li>
</ul>
<h3 data-id="heading-66">3. 分布式事务的限制</h3>
<ul>
<li>如果协调者不支持数据复制，而是在单节点上运行，那么它就是整个系统的单点故障</li>
<li>许多服务器端应用程序都倾向于无状态模式，而所有的持久状态都保存在数据库中，这样应用服务器可以轻松地添加或删除实例。但协调者就是应用服务器的一部分时，协调者日志就称为了可靠系统的重要组成部分，它就不是无状态的</li>
<li>对于数据库内部的分布式事务，2PC要成功提交事务还是存在潜在的限制，它要求必须所有参与者都投票赞成，如果有任何部分发生故障，整个事务只能失败。因此分布式事务有扩大事务失败的风险</li>
</ul>
<h2 data-id="heading-67">十、共识算法——分布式系统共识</h2>
<h3 data-id="heading-68">1. 共识算法如何实现</h3>
<ul>
<li><strong>定义世代编号(epoch)</strong> ：在每一个世代，主节点是唯一确定的</li>
<li><strong>投票：</strong> 首先是投票决定谁是主节点，然后是对主节点的提议进行投票。其中关键的一点是，参与两轮的quorum必须有重叠，如果某个提议获得通过，那么其中参与投票的节点中必须至少有一个也参加了最近一次的主节点选举</li>
</ul>
<h3 data-id="heading-69">2. 共识算法投票和2PC的区别</h3>
<ul>
<li>最大的区别是，2PC的协调者并不是依靠选举产生</li>
<li>另外容错共识算法只需要收到多数节点的投票结果即可通过决议，而2PC则要求每个参与者都必须作出“是”才能最终通过</li>
<li>此外，共识算法还定义了恢复过程，出现故障之后，通过该过程节点可以选举出新的主节点然后进入一致的状态，确保总是能够满足安全属性</li>
</ul>
<h3 data-id="heading-70">3. 共识算法的优点</h3>
<ul>
<li>为一切不确定的系统带来了明确的安全属性</li>
<li>可以支持容错，允许个别节点失效</li>
<li>可以提供全序广播，以容错的方式实现强一致的原子操作</li>
</ul>
<h3 data-id="heading-71">4. 共识算法的局限性</h3>
<ul>
<li>在达成一致性决议之前，节点投票的过程是一个同步复制过程。但数据库的配置经常是异步复制</li>
<li>共识体系需要严格的多数节点才能运行。意味着至少需要3个节点才能容忍1个节点发生故障</li>
<li>多数共识算法假定一组固定参与投票的节点集，这意味着不能动态添加或删除节点。动态成员资格则比较复杂</li>
<li>共识系统通常依靠超时机制来检测节点失效。在网络延迟高度不确定的环境中，特别是跨区域分布的系统，经常由于网络延迟愿意错误地认为主节点发生了故障。这会大大降低性能</li>
<li>共识算法往往对网络问题特别敏感。Raft已被发现存在不合理的边界条件处理，如果整个网络中存在某一条网络连接持续不可靠，它会不断在两个节点之间反复切换主节点，让系统处于不稳定状态</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从神州22极限救援，看懂Git高级玩法]]></title>    <link>https://juejin.cn/post/7579507023508160575</link>    <guid>https://juejin.cn/post/7579507023508160575</guid>    <pubDate>2025-12-03T16:59:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579507023508160575" data-draft-id="7579519985699586054" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从神州22极限救援，看懂Git高级玩法"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2025-12-03T16:59:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="云前端"/> <meta itemprop="url" content="https://juejin.cn/user/3034307821311895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从神州22极限救援，看懂Git高级玩法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307821311895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    云前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T16:59:46.000Z" title="Wed Dec 03 2025 16:59:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 年的太空探索史，注定是由中国人书写的。</p>
<p>4 月 24 日，神舟二十号载着三位航天员发射升空，按计划完成任务后，原定于 11 月中旬乘组轮换后返回。10 月 31 日，神舟二十一号作为常规乘组轮换任务发射，以 3.5 小时快速对接空间站。</p>
<p>转折发生在 11 月 4 日 —— 神舟二十号乘组在返回前一晚的例行检查中，发现返回舱舷窗边缘出现微小三角形痕迹；经研判为太空碎片撞击导致的 “贯穿性裂纹”。此时，2003 年哥伦比亚号航天飞机因机翼微小缺陷返航解体、7 名航天员全部遇难的历史警示犹在眼前，任务指挥部在 12 小时内果断推迟神舟二十号原定载人返回计划。</p>
<p>本为常规轮换的神舟二十一号飞船临危受命，承担起 “送神舟二十号乘组安全返回” 的应急任务，并于 9 天后完美返回。但二十一号乘组却也面临了没有返回船可用的境况；因此原定于 2026 年发射的神舟二十二号飞船被提前至 11 月 25 日以无人状态紧急升空对接，官方宣布，<strong>其宇航员序列永久空缺</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15a0ed83d4f5461b9f00a97fa255d57e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqR5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765385985&amp;x-signature=RH0a6UnoQL2nsjDRzrrzLf6V524%3D" alt="" loading="lazy"/></p>
<p>从软件开发的视角来看 -- “常规任务按计划推进” 到 “突发致命故障”，再到 “常规任务变应急、备用任务提前补位”，这场太空任务的节奏，恰恰可以用 Git Flow 中 “开发分支迭代→生产分支突发 Bug→紧急修复分支响应→功能分支补位” 的完整协作流程来类比理解。</p>
<p>毕竟反观当下软件开发，不少人对 Git 的使用还停留在 “能用就行” 的初级阶段：依赖 VSCode 图形化界面提交，遇到分支协作、应急修复就手足无措，版本回滚全靠 “猜”，分支管理一锅粥。</p>
<p>因此不妨略开脑洞，按真实任务时间线，用 Git Flow 完整复刻这场航天任务的分支管理逻辑。</p>
<h2 data-id="heading-0">一、空间站： master 与 develop 双分支</h2>
<p>Git Flow 的核心是 “双主干分支”：</p>
<ul>
<li>master对应 “生产环境 / 已验证的稳定状态”</li>
<li>develop对应 “开发环境 / 持续迭代的功能集”</li>
</ul>
<p>这就像航天任务的 “空间站核心稳定系统（master）” 与 “任务开发调度系统（develop）”，分工明确且互不干扰。</p>
<pre><code class="hljs language-perl" lang="perl">步骤 <span class="hljs-number">1</span>：初始化远端仓库与主干分支
<span class="hljs-comment"># 1. 初始化远端仓库（模拟航天任务总控中心）</span>
git init --bare space-station.git

<span class="hljs-comment"># 2. 本地克隆仓库，搭建双主干</span>
git clone space-station.git <span class="hljs-keyword">local</span>-station
cd <span class="hljs-keyword">local</span>-station

<span class="hljs-comment"># 3. 创建并推送 master 分支（生产分支：空间站核心稳定系统）</span>
touch station_core.txt
git add . &amp;&amp; git commit -m <span class="hljs-string">"feat: 空间站核心系统部署完成（v1.0），进入稳定运行状态"</span>
git <span class="hljs-keyword">push</span> origin master

<span class="hljs-comment"># 4. 从 master 拉出 develop 分支（开发分支：任务调度与功能迭代）</span>
git checkout -b develop
git commit --allow-empty -m <span class="hljs-string">"chore: 初始化 develop 分支，用于任务功能迭代"</span>
git <span class="hljs-keyword">push</span> origin develop
</code></pre>
<p>核心分工说明（Git Flow 基础）：</p>




















<table><thead><tr><th>分支类型</th><th>对应航天角色</th><th>核心规则</th></tr></thead><tbody><tr><td>master</td><td>空间站核心稳定系统</td><td>仅存储已验证的稳定版本，通过hotfix/release分支更新，禁止直接提交</td></tr><tr><td>develop</td><td>任务开发调度系统</td><td>所有新功能的开发基础，承接feature分支合并，持续迭代未上线功能</td></tr></tbody></table>
<h2 data-id="heading-1">二、神舟 20 号：常规feature任务推进</h2>
<p>神舟 20 号是 “2025 年核心常规任务”，对应 Git Flow 中的feature分支 —— 所有常规功能开发均从develop拉出，完成后合并回develop，不直接触碰master。</p>
<p>就像 航天任务从调度系统（develop）发起，完成后回归调度系统，不影响核心稳定系统。</p>
<h3 data-id="heading-2">步骤 1：创建feature分支并推进任务</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment"># 1. 基于 develop 拉出神舟20号功能分支（Git Flow 规范：feature 分支从 develop 创建）</span>
git checkout develop
git pull origin develop
git checkout -b feature/shenzhou-<span class="hljs-number">20</span>

<span class="hljs-comment"># 2. 模拟任务关键节点提交（遵循 Angular commit msg 规范，清晰记录进展）</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"feat: 2025.4.24 神舟20号发射入轨，对接空间站"</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"feat: 完成第1-4次出舱实验，在轨驻留180天"</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"fix: 修正第2次出舱实验的设备参数记录"</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"feat: 完成剩余23天驻留，准备11月15日返回（待轮换）"</span>

<span class="hljs-comment"># 3. 用 rebase -i 整理提交（本地未推送前优化历史，Git Flow 推荐操作）</span>
git rebase -i HEAD~<span class="hljs-number">4</span>
<span class="hljs-comment"># 交互界面中，将3个feat/fix合并为1个完整提交（squash），最终信息：</span>
<span class="hljs-comment"># feat: 神舟20号完成发射、4次出舱、203天驻留，准备11月15日返回（v2.0）</span>

<span class="hljs-comment"># 4. 推送 feature 分支至远端，等待合并到 develop</span>
git push origin feature/shenzhou-<span class="hljs-number">20</span>
</code></pre>
<h3 data-id="heading-3">步骤 2：合并feature到develop（任务纳入调度系统）</h3>
<pre><code class="hljs language-bash" lang="bash">当神舟 20 号完成在轨驻留，确认功能正常（对应 “开发功能测试通过”），将其合并回develop，纳入 “任务调度系统”：
<span class="hljs-comment"># 1. 切换到 develop 分支，拉取最新状态</span>
git checkout develop
git pull origin develop

<span class="hljs-comment"># 2. 合并 feature 分支（--no-ff 保留分支轨迹，便于追溯）</span>
git merge --no-ff feature/shenzhou-20 -m <span class="hljs-string">"chore: 合并神舟20号任务到 develop，完成常规驻留流程"</span>

<span class="hljs-comment"># 3. 推送 develop 分支，同步开发进度</span>
git push origin develop

<span class="hljs-comment"># 4. （可选）删除本地 feature 分支（任务完成后清理，保持仓库整洁）</span>
git branch -d feature/shenzhou-20
</code></pre>
<h2 data-id="heading-4">三、神舟 21 号：从常规任务到hotfix</h2>
<p>神舟 21 号的初始定位是 “常规乘组轮换任务”（feature分支），但因神舟 20 号 “贯穿性裂纹”（master分支突发 Bug），需转为 “紧急修复任务”。</p>
<p>这对应 Git Flow 中 “feature分支未上线，生产环境突发 Bug，立即从master拉出hotfix分支响应” 的场景，而非在原有feature分支修改。</p>
<h3 data-id="heading-5">步骤 1：初始feature分支推进（常规轮换任务）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 基于 develop 拉出神舟21号常规轮换分支</span>
git checkout develop
git pull origin develop
git checkout -b feature/shenzhou-21

<span class="hljs-comment"># 2. 提交常规任务进展</span>
git commit --allow-empty -m <span class="hljs-string">"feat: 2025.10.31 神舟21号常规发射，3.5小时对接空间站"</span>
git commit --allow-empty -m <span class="hljs-string">"feat: 完成在轨调试，等待11月15日常规乘组轮换"</span>

<span class="hljs-comment"># 3. 推送 feature 分支至远端</span>
git push origin feature/shenzhou-21
</code></pre>
<h3 data-id="heading-6">步骤 2：突发故障！从master拉出hotfix分支（紧急响应）</h3>
<p>当神舟 20 号的 “贯穿性裂纹” 被确认（对应 “master分支生产环境 Bug”），需立即从master创建hotfix分支 —— 这是 Git Flow 处理生产 Bug 的核心规则：紧急修复必须基于master，确保修复的是当前稳定版本的问题。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 切换到 master 分支，拉取最新稳定状态</span>
git checkout master
git pull origin master

<span class="hljs-comment"># 2. 从 master 拉出 hotfix 分支（紧急修复：送20号乘组返回）</span>
git checkout -b hotfix/shenzhou-21-rescue

<span class="hljs-comment"># 3. 提交紧急修复逻辑（对应神舟21号任务目标变更）</span>
git commit --allow-empty -m <span class="hljs-string">"hotfix: 调整神舟21号任务目标，承接20号乘组应急返回"</span>
git commit --allow-empty -m <span class="hljs-string">"hotfix: 2025.11.14 完成应急轮换，送20号乘组安全返回地球"</span>

<span class="hljs-comment"># 4. 推送 hotfix 分支至远端，等待验证</span>
git push origin hotfix/shenzhou-21-rescue
</code></pre>
<h3 data-id="heading-7">步骤 3：hotfix合并双主干（修复同步至稳定与开发系统）</h3>
<p>神舟 21 号完成应急返回（对应 “hotfix修复验证通过”），需同时合并到master（更新生产稳定版本）和develop（同步修复到开发系统，避免后续功能遗漏）—— 这是 Git Flow 与其他流程的核心区别，确保 “生产与开发的修复一致性”。</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># 1. 合并到 master（更新生产版本，标记修复完成）</span>
git checkout master
git pull origin master
git merge --no-ff hotfix/shenzhou-<span class="hljs-number">21</span>-<span class="hljs-keyword">rescue</span> -m <span class="hljs-string">"fix: 合并 hotfix 修复，20号乘组安全返回（v1.1）"</span>
git tag -a v1.<span class="hljs-number">1</span> -m <span class="hljs-string">"v1.1：完成神舟21号应急返回修复"</span> <span class="hljs-comment"># 打标签，标记生产版本</span>
git push origin master --tags

<span class="hljs-comment"># 2. 合并到 develop（同步修复到开发分支，避免后续功能冲突）</span>
git checkout develop
git pull origin develop
git merge --no-ff hotfix/shenzhou-<span class="hljs-number">21</span>-<span class="hljs-keyword">rescue</span> -m <span class="hljs-string">"fix: 同步 hotfix 修复到 develop，对齐生产状态"</span>
git push origin develop

<span class="hljs-comment"># 3. （可选）删除 hotfix 分支（修复完成后清理）</span>
git branch -d hotfix/shenzhou-<span class="hljs-number">21</span>-<span class="hljs-keyword">rescue</span>
git push origin <span class="hljs-symbol">:hotfix/shenzhou-</span><span class="hljs-number">21</span>-<span class="hljs-keyword">rescue</span>
</code></pre>
<h2 data-id="heading-8">四、神舟 22 号：紧急补位的feature分支</h2>
<p>神舟 22 号是 “提前发射的无人补位任务”，用于解决 “21 号乘组无返回船” 的问题。</p>
<p>对应 Git Flow 中 “基于develop创建feature分支，承接紧急修复后的补位需求”，确保补位功能在开发系统迭代，不直接影响生产。</p>
<h3 data-id="heading-9">步骤 1：基于develop创建补位feature分支</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment"># 1. 切换到 develop 分支，拉取最新同步后的状态（含21号修复）</span>
git checkout develop
git pull origin develop

<span class="hljs-comment"># 2. 拉出补位功能分支（神舟22号：无人补给与返回保障）</span>
git checkout -b feature/shenzhou-<span class="hljs-number">22</span>-supplement

<span class="hljs-comment"># 3. 提交补位任务进展（遵循 commit 规范，明确功能目标）</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"feat: 2025.11.25 神舟22号提前无人发射（原计划2026）"</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"feat: 完成空间站物资补给，保障21号乘组驻留"</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"feat: 验证舷窗裂纹处置技术，留存故障解决方案"</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"docs: 标记神舟22号乘组序列永久空缺，同步任务文档"</span>

<span class="hljs-comment"># 4. 推送 feature 分支至远端，等待验证与合并</span>
git push origin feature/shenzhou-<span class="hljs-number">22</span>-supplement
</code></pre>
<h3 data-id="heading-10">步骤 2：合并feature到develop（补位任务纳入调度）</h3>
<p>当神舟 22 号完成对接与补给（对应 “补位功能测试通过”），合并回develop，完成整个应急补位流程：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># 1. 切换到 develop 分支，拉取最新状态</span>
git checkout develop
git pull origin develop

<span class="hljs-comment"># 2. 合并补位分支（--no-ff 保留轨迹，便于追溯补位逻辑）</span>
git merge --no-ff feature/shenzhou-<span class="hljs-number">22</span>-supplement -m <span class="hljs-string">"chore: 合并神舟22号补位任务到 develop，完成全流程保障"</span>

<span class="hljs-comment"># 3. 推送 develop 分支，同步补位结果</span>
git push origin develop

<span class="hljs-comment"># 4. （可选）删除补位 feature 分支</span>
git branch -d feature/shenzhou-<span class="hljs-number">22</span>-supplement
git push origin <span class="hljs-symbol">:feature/shenzhou-</span><span class="hljs-number">22</span>-supplement
</code></pre>
<h2 data-id="heading-11">五、可视化的全流程分支</h2>
<p>执行以下命令，可直观看到 Git Flow 完整分支轨迹，每一步均与航天任务一一对应：</p>
<pre><code class="hljs language-css" lang="css">git log <span class="hljs-attr">--graph</span> <span class="hljs-attr">--oneline</span> <span class="hljs-attr">--all</span> <span class="hljs-attr">--decorate</span>
</code></pre>
<p>输出示例（核心轨迹）</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">*</span>   <span class="hljs-number">8765432</span> <span class="hljs-string">(develop,</span> <span class="hljs-string">origin/develop)</span> <span class="hljs-attr">chore:</span> <span class="hljs-string">合并神舟22号补位任务到</span> <span class="hljs-string">develop，完成全流程保障</span>
<span class="hljs-string">|\</span>  
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-number">7654321</span> <span class="hljs-string">(feature/shenzhou-22-supplement)</span> <span class="hljs-attr">docs:</span> <span class="hljs-string">标记神舟22号乘组序列永久空缺</span>
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-attr">6543210 feat:</span> <span class="hljs-string">验证舷窗裂纹处置技术</span>
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-attr">5432109 feat:</span> <span class="hljs-string">完成空间站物资补给</span>
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-attr">4321098 feat:</span> <span class="hljs-number">2025.11</span><span class="hljs-number">.25</span> <span class="hljs-string">神舟22号提前无人发射</span>
<span class="hljs-string">*</span> <span class="hljs-string">|</span>   <span class="hljs-attr">3210987 chore:</span> <span class="hljs-string">同步</span> <span class="hljs-string">hotfix</span> <span class="hljs-string">修复到</span> <span class="hljs-string">develop，对齐生产状态</span>
<span class="hljs-string">|\</span> <span class="hljs-string">\</span>  
<span class="hljs-string">|</span> <span class="hljs-string">|/</span>  
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-number">2109876</span> <span class="hljs-string">(hotfix/shenzhou-21-rescue)</span> <span class="hljs-attr">hotfix:</span> <span class="hljs-number">2025.11</span><span class="hljs-number">.14</span> <span class="hljs-string">完成应急轮换</span>
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-attr">1098765 hotfix:</span> <span class="hljs-string">调整神舟21号任务目标</span>
<span class="hljs-string">|/</span>  
<span class="hljs-string">*</span>   <span class="hljs-number">0987654</span> <span class="hljs-string">(master,</span> <span class="hljs-string">origin/master,</span> <span class="hljs-attr">tag:</span> <span class="hljs-string">v1.1)</span> <span class="hljs-attr">fix:</span> <span class="hljs-string">合并</span> <span class="hljs-string">hotfix</span> <span class="hljs-string">修复，20号乘组安全返回（v1.1）</span>
<span class="hljs-string">|</span>  
<span class="hljs-string">*</span>   <span class="hljs-attr">9876543 chore:</span> <span class="hljs-string">合并神舟20号任务到</span> <span class="hljs-string">develop，完成常规驻留流程</span>
<span class="hljs-string">|\</span>  
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-number">8765432</span> <span class="hljs-string">(feature/shenzhou-20)</span> <span class="hljs-attr">feat:</span> <span class="hljs-string">神舟20号完成发射、4次出舱、203天驻留</span>
<span class="hljs-string">|/</span>  
<span class="hljs-string">*</span> <span class="hljs-attr">7654321 chore:</span> <span class="hljs-string">初始化</span> <span class="hljs-string">develop</span> <span class="hljs-string">分支，用于任务功能迭代</span>
<span class="hljs-string">*</span> <span class="hljs-attr">6543210 feat:</span> <span class="hljs-string">空间站核心系统部署完成（v1.0），进入稳定运行状态</span>
</code></pre>
<h2 data-id="heading-12">六、结语</h2>
<p>不起眼的 git 操作就是开发者每天的航天任务，master守好 “稳定底线”，develop管好 “功能迭代”，hotfix快速响应 “突发危机”，feature稳妥承接 “补位需求”，每一步都有明确的角色和规则。</p>
<p>从区分develop与master，到正确使用feature和hotfix，再到规范的 commit 信息与分支清理；这些基础操作的本质，都是 “让协作更有序、历史可追溯”。</p>
<p>掌握良好的 Git Flow，你的代码管理就能像中国航天一样，既规范严谨，又能从容应对各种突发情况。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SQL 语法速查手册：前端开发者的学习笔记]]></title>    <link>https://juejin.cn/post/7579673620939620402</link>    <guid>https://juejin.cn/post/7579673620939620402</guid>    <pubDate>2025-12-03T22:48:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579673620939620402" data-draft-id="7579441333167095817" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SQL 语法速查手册：前端开发者的学习笔记"/> <meta itemprop="keywords" content="前端,数据库,SQL"/> <meta itemprop="datePublished" content="2025-12-03T22:48:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="copyer_xyf"/> <meta itemprop="url" content="https://juejin.cn/user/2823965976323016"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SQL 语法速查手册：前端开发者的学习笔记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2823965976323016/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    copyer_xyf
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T22:48:15.000Z" title="Wed Dec 03 2025 22:48:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p>最近在写 Next.js + Supabase 的一个练手项目，突然又接触到了 SQL（虽然 Supabase 是通过类似 ORM 来操作数据库的），突然感觉 SQL 语法又陌生了。</p>
<p>真是学了不用，等于白学。</p>
<p>之前写过一篇<a href="https://juejin.cn/post/7181086487226613797" target="_blank" title="https://juejin.cn/post/7181086487226613797">一个前端小白，学习 SQL 语句</a>，现在回头看，自己都看懵了，真的尬住了。</p>
<p>算了，重新整理一遍吧，并通过一个实战案例来巩固基础。</p>
<h2 data-id="heading-0">邂逅</h2>
<p><code>SQL</code>： Structured Query Language，称为结构化查询语句，简称 SQL。</p>
<h2 data-id="heading-1">SQL 编写规范</h2>
<ol>
<li>关键词建议使用大写，比如 <code>CREATE</code>、<code>TABLE</code>（小写也可以，但大写更规范）</li>
<li>语句末尾加分号</li>
<li>如果表名或字段名是 SQL 关键词，用反引号 <code>`</code> 包裹</li>
<li>表名用单数，字段名用蛇形命名（下划线分隔，如 <code>user_id</code>）</li>
</ol>
<h2 data-id="heading-2">SQL 分类</h2>






























<table><thead><tr><th>分类</th><th>描述</th><th>常见命令/关键字</th></tr></thead><tbody><tr><td><strong>DDL</strong></td><td><strong>定义</strong>或<strong>修改</strong>数据库结构（库、表、索引、视图等）</td><td><code>CREATE</code>、<code>DROP</code>、<code>ALTER</code>、<code>TRUNCATE</code>、<code>RENAME</code></td></tr><tr><td><strong>DML</strong></td><td>对<strong>表中的记录</strong>进行增、删、改</td><td><code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code>、<code>MERGE</code></td></tr><tr><td><strong>DQL</strong></td><td>对<strong>表中的记录</strong>进行查询</td><td><code>SELECT</code>（以及配套子句 <code>WHERE</code>、<code>GROUP BY</code>、<code>ORDER BY</code>、<code>JOIN</code> 等）</td></tr><tr><td><strong>DCL</strong></td><td><strong>权限</strong>与<strong>访问控制</strong>（授予、回收）</td><td><code>GRANT</code>、<code>REVOKE</code></td></tr></tbody></table>
<ul>
<li><strong>DDL</strong>（Data Definition Language）：数据定义语言，-----&gt; 管"结构"</li>
<li><strong>DML</strong>（Data Manipulation Language）：数据操作语言，-----&gt; 管"改数据"</li>
<li><strong>DQL</strong>（Data Query Language）：数据查询语言，-----&gt; 管"查数据"</li>
<li><strong>DCL</strong>（Data Control Language）：数据控制语言，-----&gt; 管"权限"</li>
</ul>
<blockquote>
<p>为了阅读方便，下面的 SQL 语句都用小写，但实际开发中推荐关键词用大写</p>
</blockquote>
<h2 data-id="heading-3">SQL 类型</h2>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f4c91ddacbb47499df5c9277ea8688f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29weWVyX3h5Zg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765406894&amp;x-signature=rgRrHYCWNXAOy6aTYaY6kE4Mgng%3D" alt="type.png" width="100%" loading="lazy"/>
<p>实际开发中常用的类型：</p>
<ul>
<li><code>int</code>：存储整数</li>
<li><code>varchar(100)</code>: 存储变长字符串，可以指定长度</li>
<li><code>char</code>：定长字符串，不够的自动在末尾填充空格</li>
<li><code>double</code>：存储浮点数</li>
<li><code>date</code>：存储日期 2023-05-27</li>
<li><code>time</code>：存储时间 10:13</li>
<li><code>datetime</code>：存储日期和时间 2023-05-27 10:13</li>
<li><code>timestamp</code>：存储日期时间的，但是范围小一点，而且会转为中央时区 UTC 的时间来存储</li>
<li><code>text</code>：存储长文本</li>
</ul>
<p>SQL 设计了这么多数据类型，一是为了存储更丰富的信息，二是为了节省存储空间。<strong>不常用的类型，用到时再查就行</strong>。</p>
<h2 data-id="heading-4">表约束</h2>
<ul>
<li>
<p><code>primary key</code>: 主键</p>
<ul>
<li>主键是表中唯一的索引</li>
<li>必须是 not null; 如果没有设置，mysql 也会自动设置；</li>
<li>联合主键，多个字段合成的主键</li>
<li>尽量不要使用业务主键</li>
</ul>
</li>
<li>
<p><code>unique</code>: 唯一；除了主键以外，针对某些字段，也是唯一的。</p>
</li>
<li>
<p><code>not null</code>: 字段不能为空</p>
</li>
<li>
<p><code>default</code>: 默认值</p>
</li>
<li>
<p><code>auto_increment</code>: 自动增长；</p>
</li>
<li>
<p><code>foreign key</code>: 外键，与其他表的字段关联</p>
</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> yyy(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> key,
  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">unique</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,
  age <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">18</span>,
  num <span class="hljs-type">int</span> auto_increment,
  homeId <span class="hljs-type">int</span>, <span class="hljs-comment">-- 外键</span>
  <span class="hljs-keyword">foreign</span> key (homeId) <span class="hljs-keyword">references</span> home(id) <span class="hljs-comment">-- 关联 home 表的 id</span>
)
</code></pre>
<h2 data-id="heading-5">DDL（管结构）</h2>
<p>库操作</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看所有数据库</span>
<span class="hljs-keyword">show</span> databases;
​
<span class="hljs-comment">-- 使用数据库 co_blog</span>
use co_blog;
​
<span class="hljs-comment">-- 查看选择的数据库</span>
<span class="hljs-keyword">select</span> database();
​
<span class="hljs-comment">-- 创建数据库</span>
<span class="hljs-keyword">create</span> database if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> co_blog; <span class="hljs-comment">-- 先判断 co_blog 库是否存在，不存在则创建</span>
<span class="hljs-keyword">create</span> database co_blog; <span class="hljs-comment">-- 若存在，会报错；</span>
​
<span class="hljs-comment">-- 删除数据库</span>
<span class="hljs-keyword">drop</span> database if <span class="hljs-keyword">exists</span> co_blog;
<span class="hljs-keyword">drop</span> database co_blog; <span class="hljs-comment">-- 数据库不存在，会报错</span>
use co_blog; <span class="hljs-comment">-- 使用 co_blog 库，后续表操作都在这个库下</span>
</code></pre>
<p>表操作</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看库中所有的表</span>
<span class="hljs-keyword">show</span> tables;
​
<span class="hljs-comment">-- 创建一张表</span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> <span class="hljs-keyword">user</span>(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> key auto_increment,
  name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>),
  age <span class="hljs-type">int</span>
);
​
<span class="hljs-comment">-- 查看表结构</span>
<span class="hljs-keyword">desc</span> <span class="hljs-keyword">user</span>; <span class="hljs-comment">-- 显示表的字段定义信息</span>
​
<span class="hljs-comment">-- 删除 user 表</span>
<span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> <span class="hljs-keyword">user</span>;
​
<span class="hljs-comment">-- 修改 user 表</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span> rename <span class="hljs-keyword">to</span> users;             <span class="hljs-comment">-- 修改表名 user 变成 users</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">add</span> height <span class="hljs-type">int</span>;              <span class="hljs-comment">-- 添加 height 字段，为 int 类型；</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span> change height newHeight <span class="hljs-type">int</span>; <span class="hljs-comment">-- height 改为 newHeight, 类型也可以重新定义</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span> modify height <span class="hljs-type">bigint</span>;        <span class="hljs-comment">-- 类型 int 变为 bigint</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">drop</span> height;                 <span class="hljs-comment">-- 删除 height 字段</span>
</code></pre>
<h2 data-id="heading-6">DML（管改数据）</h2>
<p><strong>增删改</strong></p>
<p>插入数据</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 插入单条数据</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">user</span>(username, emails) <span class="hljs-keyword">values</span>(<span class="hljs-string">'admin'</span>, <span class="hljs-string">'xxxx@xxxx.com'</span>);
​
<span class="hljs-comment">-- 插入多条数据</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">user</span>(username, emails)
  <span class="hljs-keyword">values</span>
    (<span class="hljs-string">'admin'</span>, <span class="hljs-string">'xxxx@xxxx.com'</span>),
    (<span class="hljs-string">'admin2'</span>, <span class="hljs-string">'xxxx@xxxx.com'</span>),
    (<span class="hljs-string">'admin3'</span>, <span class="hljs-string">'xxxx@xxxx.com'</span>);
</code></pre>
<p>更新数据</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">update</span> `<span class="hljs-keyword">user</span>` <span class="hljs-keyword">set</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三1'</span>, age <span class="hljs-operator">=</span> <span class="hljs-number">19</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p>删除数据</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> `<span class="hljs-keyword">user</span>` <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<h2 data-id="heading-7">DQL（管查询）</h2>
<p>查询语句的执行顺序：先筛选数据，再分组过滤，然后排序，最后分页。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
  <span class="hljs-keyword">FROM</span> table_name
  <span class="hljs-keyword">WHERE</span>    xxx
  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> xxx
  <span class="hljs-keyword">HAVING</span>   xxx
  <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> xxx
  LIMIT    xxx;
</code></pre>
<h4 data-id="heading-8">取别名 as</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询所有字段</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;
​
<span class="hljs-comment">-- 查询指定字段并取别名</span>
<span class="hljs-keyword">select</span> name, age <span class="hljs-keyword">as</span> c_age <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;
​
<span class="hljs-comment">-- 别名的作用：多表查询时避免字段名冲突</span>
</code></pre>
<h4 data-id="heading-9">比较运算符</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 比较运算符：&gt;、&lt;、=、!=、&gt;=、&lt;=</span>

<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span>;  <span class="hljs-comment">-- 年龄大于 20</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> age <span class="hljs-operator">!=</span> <span class="hljs-number">20</span>; <span class="hljs-comment">-- 年龄不等于 20</span>
</code></pre>
<h4 data-id="heading-10">逻辑运算符</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- name 为 张三，且 age 大于 10</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>;
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span> <span class="hljs-operator">&amp;&amp;</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>;

<span class="hljs-comment">-- name 为 张三，或者 age 大于 10</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>;
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span> <span class="hljs-operator">||</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>;

<span class="hljs-comment">-- age 在 10 到 20 岁间的</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> age <span class="hljs-keyword">between</span> <span class="hljs-number">10</span> <span class="hljs-keyword">and</span> <span class="hljs-number">20</span>;
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> age <span class="hljs-operator">&gt;=</span><span class="hljs-number">10</span> <span class="hljs-operator">&amp;&amp;</span> age <span class="hljs-operator">&lt;=</span> <span class="hljs-number">20</span>;

<span class="hljs-comment">-- age 为 10 或 20 的（in 的相反是 not in）</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> age <span class="hljs-keyword">in</span> (<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
</code></pre>
<h4 data-id="heading-11">模糊搜索 like</h4>
<ul>
<li><code>%</code>: 任意多个字符</li>
<li><code>_</code>: 任意一个字符</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">'t%'</span>;   <span class="hljs-comment">-- 以 t 开头</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">'%t%'</span>;   <span class="hljs-comment">-- 包含 t</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">'_t%'</span>;   <span class="hljs-comment">-- 第二个字符是 t</span>
</code></pre>
<h4 data-id="heading-12">排序 order by</h4>
<ul>
<li><code>asc</code>：升序（默认，可省略）</li>
<li><code>desc</code>：降序</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">asc</span>;  <span class="hljs-comment">-- 年龄升序</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">desc</span>; <span class="hljs-comment">-- 年龄降序</span>
</code></pre>
<h4 data-id="heading-13">限制分页 limit</h4>
<ul>
<li>limit 数据条数 offset 偏移量 (推荐)</li>
<li>limit 偏移量，数据条数 （不推荐）</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- limit 数据条数 offset 偏移量 (推荐)</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users limit <span class="hljs-number">30</span> <span class="hljs-keyword">offset</span> <span class="hljs-number">10</span>;

<span class="hljs-comment">-- limit 偏移量，数据条数 (不推荐)</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users limit <span class="hljs-number">10</span>, <span class="hljs-number">30</span>;

<span class="hljs-comment">-- 前端格式</span>
const pages <span class="hljs-operator">=</span> {
  <span class="hljs-keyword">current</span>: <span class="hljs-number">3</span>,
  pageSize: <span class="hljs-number">10</span>,
};

<span class="hljs-comment">-- 后端查询</span>
const offsetNum <span class="hljs-operator">=</span> (pages.current <span class="hljs-operator">-</span> <span class="hljs-number">1</span>) <span class="hljs-operator">*</span> pages.pageSize;
const limitNum <span class="hljs-operator">=</span> pages.pageSize;

<span class="hljs-comment">-- sql</span>
const <span class="hljs-keyword">sql</span> <span class="hljs-operator">=</span> `<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users limit ${limitNum} <span class="hljs-keyword">offset</span> ${offsetNum}`;
</code></pre>
<h4 data-id="heading-14">聚合函数</h4>
<p><code>聚合函数</code>： 先收集到一起，然后对收集的结果进行操作。（看成一组）</p>
<ul>
<li><code>avg</code>：平均值</li>
<li><code>max</code>：最大值</li>
<li><code>min</code>：最小值</li>
<li><code>sum</code>：求和</li>
<li><code>count</code>：计数（统计行数）</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 平均值</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(age) <span class="hljs-keyword">as</span> avg_age <span class="hljs-keyword">from</span> users;

<span class="hljs-comment">-- 计算人数</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> count <span class="hljs-keyword">from</span> users;

<span class="hljs-comment">-- 最大值</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(age) <span class="hljs-keyword">as</span> maxAge <span class="hljs-keyword">from</span> users;

<span class="hljs-comment">-- 求和</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(age) <span class="hljs-keyword">as</span> sumAge <span class="hljs-keyword">from</span> users;
</code></pre>
<p>SQL 还有很多内置函数：</p>
<ul>
<li>聚合函数：avg、count、sum、min、max</li>
<li>字符串函数：concat、substr、length、upper、lower</li>
<li>数值函数：round、ceil、floor、abs、mod</li>
<li>日期函数：year、month、day、date、time</li>
<li>条件函数：if、case</li>
<li>系统函数：version、database、user</li>
<li>类型转换函数：convert、cast、date_format、str_to_date</li>
<li>其他函数：nullif、coalesce、greatest、least</li>
</ul>
<p>实际开发中，聚合函数最常用的是<strong>统计</strong>和<strong>分组</strong>，其他函数用到时再查就行。</p>
<h4 data-id="heading-15">分组 group by</h4>
<p><code>聚合函数</code>看成一组；有时需要进行分组，然后进行操作。</p>
<p><code>使用建议</code>：group by 一定要配合聚合函数使用，不然分组没有意义（除非整张表都看成一个聚合函数，就不需要使用 group by）。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 统计男女个数</span>
<span class="hljs-keyword">select</span> sex, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> num <span class="hljs-keyword">from</span> users <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> sex;
</code></pre>
<h4 data-id="heading-16">分组筛选条件 having</h4>
<p>在进行分组的时候，有时也需要过滤条件。</p>
<p>但是 <code>group by</code> 与 <code>where</code> 不能一起使用，语法报错。取而代之的是 <code>having</code>。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 根据 sex 性别进行分组，然后筛选出 count 大于 2</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> count, sex <span class="hljs-keyword">from</span> users <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> sex <span class="hljs-keyword">having</span> count <span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span>;
</code></pre>
<h4 data-id="heading-17">去重 distinct</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> age <span class="hljs-keyword">from</span> users;
</code></pre>
<h4 data-id="heading-18">多表</h4>
<h5 data-id="heading-19">外键添加</h5>
<p>创建表时添加外键：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> users(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> key,
  name <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,
  role_id <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,
  <span class="hljs-keyword">foreign</span> key (role_id) <span class="hljs-keyword">references</span> role(id)
);
</code></pre>
<p>已有表添加外键：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> users <span class="hljs-keyword">add</span> role_id <span class="hljs-type">int</span>;
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> users <span class="hljs-keyword">add</span> <span class="hljs-keyword">foreign</span> key (role_id) <span class="hljs-keyword">references</span> role(id);
</code></pre>
<h5 data-id="heading-20">外键删除（更新）</h5>
<p>表之间有关联后，不能直接删除或更新，否则会影响关联表。需要设置级联操作：要么一起更新，要么一起删除。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 一起更新一起删除</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">add</span> <span class="hljs-keyword">foreign</span> key (role_id) <span class="hljs-keyword">references</span> role(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE;
</code></pre>
<p><strong>删除外键</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> users; <span class="hljs-comment">-- 查看外键名称</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> users <span class="hljs-keyword">drop</span> <span class="hljs-keyword">foreign</span> key users_ibfk_1;
</code></pre>
<p>如果存在多个外键：</p>
<ul>
<li>users_ibfk_1</li>
<li>users_ibfk_2</li>
<li>...</li>
</ul>
<p><strong>重新绑定外键</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> users <span class="hljs-keyword">add</span> <span class="hljs-keyword">foreign</span> key (role_id) <span class="hljs-keyword">references</span> role(id)
                                           <span class="hljs-keyword">on</span> <span class="hljs-keyword">delete</span> cascade
                                           <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> cascade;
</code></pre>
<h5 data-id="heading-21">多表查询</h5>
<p>多表查询时，表之间必须有联系（通常是外键）。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users, team;
</code></pre>
<p>这样查询会产生大量无用数据，因为这是<strong>笛卡尔积</strong>（每行数据都会组合）。</p>
<h5 data-id="heading-22">表连接</h5>
<ul>
<li>左连接（<code>left join</code>）: 常用</li>
<li>右连接（<code>right join</code>）: 不常用</li>
<li>内连接（<code>[cross/inner] join</code>）: 常用</li>
<li>全连接（mysql 不支持全连接，需要 union）： 不常用</li>
</ul>
<p><strong>左右</strong>指的是以哪张表为主，展示该表的所有数据。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">from</span> 左表 [<span class="hljs-keyword">left</span><span class="hljs-operator">/</span><span class="hljs-keyword">right</span>] <span class="hljs-keyword">join</span> 右表
</code></pre>
<blockquote>
<p>其实 <code>left join</code> 和 <code>right join</code> 可以等价，换一下表的顺序就行</p>
</blockquote>
<p><strong>左连接</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 左连接 LEFT JOIN. ON 连接条件</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> role
                    <span class="hljs-keyword">on</span> user.role_id <span class="hljs-operator">=</span> role.id;

<span class="hljs-comment">-- 筛选出 role_id 不为 null 的（左连接以左表为主，如果右表没有匹配数据，右表字段为 null）</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> role
                           <span class="hljs-keyword">ON</span> user.role_id <span class="hljs-operator">=</span> role.id
                           <span class="hljs-keyword">WHERE</span> role_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>;
</code></pre>
<p><strong>内连接</strong></p>
<p>内连接只返回两表都匹配的数据，不以哪张表为主。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">join</span> role <span class="hljs-keyword">on</span> user.role_id <span class="hljs-operator">=</span> role.id;
</code></pre>
<blockquote>
<p>针对多对多的查询出现时，就是多次采用连接即可。</p>
</blockquote>
<h4 data-id="heading-23">子查询</h4>
<p>SQL 支持嵌套查询，也就是在查询中嵌套另一个查询（子查询）。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询年龄最大的人</span>
<span class="hljs-comment">-- 方式一：分两步</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(age) <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;  <span class="hljs-comment">-- 先查出最大年龄</span>
<span class="hljs-keyword">select</span> name, age <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> xxx; <span class="hljs-comment">-- 再根据年龄查数据</span>

<span class="hljs-comment">-- 方式二：用子查询（推荐）</span>
<span class="hljs-keyword">select</span> name, age <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(age) <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>);
</code></pre>
<p>子查询还有个特有的语法 <code>EXISTS</code>、<code>NOT EXISTS</code>。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询所有有角色的用户</span>
<span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> role <span class="hljs-keyword">where</span> role.id <span class="hljs-operator">=</span> user.role_id);

<span class="hljs-comment">-- 查询所有没有角色的用户</span>
<span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> role <span class="hljs-keyword">where</span> role.id <span class="hljs-operator">=</span> user.role_id);
</code></pre>
<p>子查询可以在 <code>select</code>、<code>insert</code>、<code>update</code>、<code>delete</code> 中使用。</p>
<h4 data-id="heading-24">事务</h4>
<p>修改多个关联表时，必须使用事务，保证要么全部成功，要么全部失败（回滚）。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">start</span> transaction;    <span class="hljs-comment">-- 开启事务</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> role(id, name) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4</span>, <span class="hljs-string">'群众'</span>);
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">user</span>(name, age, sex) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'james'</span>, <span class="hljs-number">18</span>, <span class="hljs-number">4</span>);

<span class="hljs-comment">-- 提交事务，执行之后就不能 rollback 了</span>
<span class="hljs-keyword">commit</span>;
<span class="hljs-comment">-- 回滚事务</span>
<span class="hljs-keyword">rollback</span>;
</code></pre>
<p>如果想回滚到某个中间点，可以使用 <code>savepoint</code> 设置保存点。</p>
<p><code>savepoint a1;</code>：回滚到 a1 时，a1 之前的操作保留，a1 之后的操作被撤销。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">start</span> transaction;  <span class="hljs-comment">-- 开启事务</span>
<span class="hljs-keyword">savepoint</span> a1;  <span class="hljs-comment">-- savepoint 这一刻前面的依旧活着，这一刻后面的都被抹除</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> role(id, name) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4</span>, <span class="hljs-string">'群众'</span>);
<span class="hljs-keyword">savepoint</span> a2;
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">user</span>(name, age, sex) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'james'</span>, <span class="hljs-number">18</span>, <span class="hljs-number">4</span>);
<span class="hljs-keyword">savepoint</span> a3;

<span class="hljs-keyword">rollback</span> <span class="hljs-keyword">to</span> a2; <span class="hljs-comment">-- 回滚到 a2 的那一刻</span>
</code></pre>
<p>事务隔离级别（有四种级别，比较复杂，自己也有点懵，一般用默认的就行）</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">select</span> @<span class="hljs-variable">@transaction</span>_isolation; <span class="hljs-comment">-- 查看隔离级别</span>
</code></pre>
<h2 data-id="heading-25">DCL（管权限）</h2>
<p>权限管理在实际开发中较少用到，等遇到时再补充（其实自己也不知道）。</p>
<h2 data-id="heading-26">案例演示（Blog 的 CRUD）</h2>
<p>用一个博客系统的增删改查来演示 SQL 的实际应用。</p>
<p>先设计表结构</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `<span class="hljs-keyword">user</span>`(
  id <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户名'</span>,
  password <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'密码'</span>,
  email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'邮箱'</span>,
  created_at DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>
);

<span class="hljs-comment">-- 标签表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `tag`(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  name <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'标签名'</span>,
  article_count <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'文章数量'</span>,
  created_at datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>
);

<span class="hljs-comment">-- 文章表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `article`(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  title <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'标题'</span>,
  content text <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'内容'</span>,
  user_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'作者id'</span>,
  like_count <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'点赞数'</span>,
  comment_count <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'评论数'</span>,
  created_at datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  <span class="hljs-keyword">FOREIGN</span> KEY (user_id) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">user</span>(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE
);

<span class="hljs-comment">-- 文章标签表(中间表的级联方式要设置为 CASCADE，这个是固定的)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `article_tag`(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  article_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文章id'</span>,
  tag_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'标签id'</span>,
  <span class="hljs-keyword">FOREIGN</span> KEY (article_id) <span class="hljs-keyword">REFERENCES</span> article(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE,
  <span class="hljs-keyword">FOREIGN</span> KEY (tag_id) <span class="hljs-keyword">REFERENCES</span> tag(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE
);

<span class="hljs-comment">-- 点赞表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `<span class="hljs-keyword">like</span>`(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  article_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文章id'</span>,
  user_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户id'</span>,
  created_at datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  <span class="hljs-keyword">FOREIGN</span> KEY (article_id) <span class="hljs-keyword">REFERENCES</span> article(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE,
  <span class="hljs-keyword">FOREIGN</span> KEY (user_id) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">user</span>(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE
)

<span class="hljs-comment">-- 评论表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `comment`(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  article_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文章id'</span>,
  user_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户id'</span>,
  target_user_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'被回复人id'</span>,
  content <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'内容'</span>,
  parent_id <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'父级id'</span>,
  created_at datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  <span class="hljs-keyword">FOREIGN</span> KEY (article_id) <span class="hljs-keyword">REFERENCES</span> article(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE,
  <span class="hljs-keyword">FOREIGN</span> KEY (user_id) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">user</span>(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE
)
</code></pre>
<p>ER 图为：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c22ac5491dff4690ad44e7cdbd9d017c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29weWVyX3h5Zg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765406894&amp;x-signature=AKkAciycWmHEZ3rRSHfAgc9%2BJGU%3D" alt="blog-er.png" width="100%" loading="lazy"/>
<h4 data-id="heading-27">用户和标签的 CRUD</h4>
<p>以用户表（user）为例，标签表（tag）同理</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建用户</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">user</span>(username, password, email) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'admin'</span>, <span class="hljs-string">'123456'</span>, <span class="hljs-string">'admin@163.com'</span>);

<span class="hljs-comment">-- 查询用户</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;

<span class="hljs-comment">-- 更新用户</span>
<span class="hljs-keyword">update</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> password <span class="hljs-operator">=</span> <span class="hljs-string">'123456'</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- 删除用户</span>
<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<h4 data-id="heading-28">文章的 CRUD</h4>
<p><strong>创建文章</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">start</span> transaction;

<span class="hljs-comment">-- 创建文章，获取文章 id（代码中获取 id 后执行下一步）</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> article(title, content, user_id, like_count, comment_count) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'标题'</span>, <span class="hljs-string">'内容'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

<span class="hljs-comment">-- 遍历 tagIds，与文章 id 一起插入中间表（代码中遍历 tagIds，组装 SQL）</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> article_tag(article_id, tag_id)
  <span class="hljs-keyword">VALUES</span>
    (<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'标签id1'</span>),
    (<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'标签id2'</span>);

<span class="hljs-comment">-- 更新 tag 表的文章数量</span>
<span class="hljs-keyword">update</span> tag <span class="hljs-keyword">set</span> article_count <span class="hljs-operator">=</span> article_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">where</span> id <span class="hljs-keyword">in</span> (<span class="hljs-string">'标签id1'</span>, <span class="hljs-string">'标签id2'</span>);

<span class="hljs-keyword">commit</span>;
</code></pre>
<p><strong>删除文章</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> article <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;
<span class="hljs-comment">-- 因为采用的是 cascade，所以 article_tag 等会自动删除</span>
</code></pre>
<p><strong>查询文章列表</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id,
       title,
       user_id,
       like_count,
       comment_count,
       created_at
<span class="hljs-keyword">FROM</span>   article
<span class="hljs-keyword">ORDER</span>  <span class="hljs-keyword">BY</span> created_at <span class="hljs-keyword">DESC</span>
LIMIT  <span class="hljs-number">10</span> <span class="hljs-keyword">OFFSET</span> <span class="hljs-number">0</span>;

<span class="hljs-comment">-- 分页查询，按创建时间倒序</span>
<span class="hljs-comment">-- like_count 和 comment_count 采用计数器冗余方案，简单性能好，但可能数据不一致</span>
</code></pre>
<p><strong>更新文章</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 开启事务</span>
<span class="hljs-keyword">START</span> TRANSACTION;

<span class="hljs-comment">-- 2. 更新文章表</span>
<span class="hljs-keyword">UPDATE</span> article
  <span class="hljs-keyword">SET</span>
    title <span class="hljs-operator">=</span> <span class="hljs-string">'新标题'</span>,
    content <span class="hljs-operator">=</span> <span class="hljs-string">'新内容'</span>
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">123</span> <span class="hljs-keyword">AND</span> article.user_id <span class="hljs-operator">=</span> <span class="hljs-string">'用户id'</span>;

<span class="hljs-comment">-- 3. 根据文章 id，在中间表 article_tag 中拿到旧标签（a,b）, 然后根据用户传递的新标签（a,c）, 找出删除的标签（b），然后再 tag 表中更新文章数量（-1）</span>
<span class="hljs-keyword">UPDATE</span> tag
<span class="hljs-keyword">SET</span>    article_count <span class="hljs-operator">=</span> article_count <span class="hljs-operator">-</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">WHERE</span>  id <span class="hljs-keyword">IN</span> (
        <span class="hljs-keyword">SELECT</span> tag_id
        <span class="hljs-keyword">FROM</span>   article_tag
        <span class="hljs-keyword">WHERE</span>  article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>
          <span class="hljs-keyword">AND</span>  tag_id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">'新标签id1'</span>, <span class="hljs-string">'新标签id2'</span>)   <span class="hljs-comment">-- 新标签列表</span>
      );

<span class="hljs-comment">-- 4. 查找旧标签，然后使用 in 和 not in 交集，找出新增的标签，然后在 tag 表中更新文章数量（+1）</span>
<span class="hljs-keyword">UPDATE</span> tag
<span class="hljs-keyword">SET</span>    article_count <span class="hljs-operator">=</span> article_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">WHERE</span>  id <span class="hljs-keyword">IN</span> (<span class="hljs-string">'新标签id1'</span>, <span class="hljs-string">'新标签id2'</span>)
  <span class="hljs-keyword">AND</span>  id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> tag_id <span class="hljs-keyword">FROM</span> article_tag <span class="hljs-keyword">WHERE</span> article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>);

<span class="hljs-comment">-- 5. 更新中间表：先删除文章的所有标签，再插入新标签</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> article_tag <span class="hljs-keyword">WHERE</span> article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> article_tag(article_id, tag_id) <span class="hljs-keyword">VALUES</span>
(<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'新标签id1'</span>),
(<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'新标签id2'</span>);

<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h4 data-id="heading-29">点赞</h4>
<p>无论是点赞还是取消点赞, 第一步是先判断是否已经点过赞</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">like</span>` <span class="hljs-keyword">WHERE</span> article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span> <span class="hljs-keyword">AND</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">'用户id'</span> LIMIT <span class="hljs-number">1</span>;
</code></pre>
<p>如果查询到记录，说明已点赞，执行取消点赞；否则执行点赞。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 点赞</span>

<span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-comment">--  1. 更新 like 表数据</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `<span class="hljs-keyword">like</span>`(article_id, user_id) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'用户id'</span>);
<span class="hljs-comment">--  2. 更新 article 表数据（+1）</span>
<span class="hljs-keyword">UPDATE</span> article <span class="hljs-keyword">SET</span> like_count <span class="hljs-operator">=</span> like_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;
<span class="hljs-keyword">COMMIT</span>;
<span class="hljs-comment">-- 取消点赞</span>

<span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-comment">--  1. 删除 like 表数据</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">like</span>` <span class="hljs-keyword">WHERE</span>  article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span> <span class="hljs-keyword">AND</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">'用户id'</span>;
<span class="hljs-comment">--  2. 更新 article 表数据（-1）</span>
<span class="hljs-keyword">UPDATE</span> article <span class="hljs-keyword">SET</span> like_count <span class="hljs-operator">=</span> like_count <span class="hljs-operator">-</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h4 data-id="heading-30">评论</h4>
<blockquote>
<p>写到这里发现，最初表设计有问题。本想用一个 <code>parent_id</code> 实现无限层级，但看了掘金和 B 站的评论设计，发现评论最多 2 层，其他都是平铺回复。</p>
</blockquote>
<p>B 站的评论：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbba2af510284abdb99b2da4c85240e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29weWVyX3h5Zg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765406894&amp;x-signature=1PlNs3aaC%2FbQt%2FTtG55nKDbDw9g%3D" alt="blog-sql-bi.png" width="100%" loading="lazy"/>
<p>掘金的评论：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8203dfc86db844029709fa65f36a941f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29weWVyX3h5Zg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765406894&amp;x-signature=bRQXMC%2B8a8UNJdX%2F0YolB5xbuO0%3D" alt="blog-sql-juejin.png" width="70%" loading="lazy"/>
<p>都是<strong>两层模型</strong>：</p>
<ul>
<li>第 1 层：顶级评论（<code>parent_id = NULL</code>）</li>
<li>第 2 层：对顶级评论的回复（<code>parent_id = 顶级.id</code>）</li>
<li>第 3 层及以后：不再嵌套，把目标人 @nick 写进内容，<code>parent_id</code> 仍等于顶级评论 id，按时间平铺</li>
</ul>
<p><strong>新增评论</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-comment">-- 情况一：顶级评论</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> comment(article_id, user_id, parent_id, target_user_id, content)
  <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'用户id'</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">'一级评论'</span>);

<span class="hljs-comment">-- 情况二：回复顶级评论或回复某人</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> comment(article_id, user_id, parent_id, target_user_id, content)
  <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'用户id'</span>, <span class="hljs-string">'顶级评论id'</span>, <span class="hljs-string">'被回复人id'</span>, <span class="hljs-string">'二级评论'</span>);

<span class="hljs-comment">-- 3. 更新 article 表评论数（+1）</span>
<span class="hljs-keyword">UPDATE</span> article <span class="hljs-keyword">SET</span> comment_count <span class="hljs-operator">=</span> comment_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;

<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<p><strong>删除评论</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 查看是否有子评论</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> comment <span class="hljs-keyword">WHERE</span> parent_id <span class="hljs-operator">=</span> <span class="hljs-string">'评论id'</span> LIMIT <span class="hljs-number">1</span>;
<span class="hljs-comment">-- 情况一：如果没有子评论</span>

<span class="hljs-comment">-- 情况一：没有子评论，直接删除</span>
<span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> comment <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'评论id'</span> <span class="hljs-keyword">AND</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">'用户id'</span>;
<span class="hljs-comment">-- 2. 更新 article 表评论数（-1）</span>
<span class="hljs-keyword">UPDATE</span> article <span class="hljs-keyword">SET</span> comment_count <span class="hljs-operator">=</span> comment_count <span class="hljs-operator">-</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;
<span class="hljs-keyword">COMMIT</span>;


<span class="hljs-comment">-- 情况二：有子评论，一起删除</span>
<span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-comment">-- 1. 获取所有子评论 id（二级评论的 parent_id 都是顶级评论 id）</span>
<span class="hljs-keyword">select</span> id <span class="hljs-keyword">as</span> ids <span class="hljs-keyword">from</span> comment <span class="hljs-keyword">where</span> parent_id <span class="hljs-operator">=</span> <span class="hljs-string">'评论id'</span>;

<span class="hljs-comment">-- 2. 代码中组装 ids：[...ids, '评论id']（包含所有子评论 id 和顶级评论 id）</span>

<span class="hljs-comment">-- 3. 根据 id 批量删除</span>
<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> comment <span class="hljs-keyword">where</span> id <span class="hljs-keyword">in</span> (<span class="hljs-string">'ids'</span>);

<span class="hljs-comment">-- 4. 更新 article 表评论数（减去 ids.length）</span>
<span class="hljs-keyword">UPDATE</span> article <span class="hljs-keyword">SET</span> comment_count <span class="hljs-operator">=</span> comment_count <span class="hljs-operator">-</span> <span class="hljs-string">'ids.length'</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<blockquote>
<p>这里使用代码 + SQL 语法的组合，纯粹用 SQL 实现需要使用存储过程，目前还不会</p>
</blockquote>
<p><strong>查询评论列表</strong></p>
<p>这里查询主要还是看评论的交互流程是怎么样设计的。</p>
<ul>
<li>情况一：直接查询所有评论（在代码中组装成一个二级树结构），缺点数据量不能太大</li>
<li>情况二：分页查询（先分页查询顶级的，展示时再不分页查询子评论），可能存在交互的迟钝感</li>
<li>情况三：xxxx(我也不知道了，总感觉上面的两种方案都不是最佳的, 我看了掘金返回的结构是<strong>顶级评论分页（20 条）+ 子评论随着顶级评论一起返回</strong>，万一子评论的量也很多呢？)</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 情况一：查询所有评论</span>

<span class="hljs-comment">-- 1. 获取所有顶级评论的 ids</span>
<span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">from</span> comment <span class="hljs-keyword">where</span> article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span> <span class="hljs-keyword">AND</span> parent_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;

<span class="hljs-comment">-- 2. 获取所有评论</span>
<span class="hljs-keyword">SELECT</span> c.id,
       c.parent_id,
       c.user_id,
       u.name                   <span class="hljs-keyword">AS</span> user_name,
       c.target_user_id,
       tu.name                  <span class="hljs-keyword">AS</span> target_user_name,
       c.content,
       c.created_at
<span class="hljs-keyword">FROM</span> comment c
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u  <span class="hljs-keyword">ON</span> u.id  <span class="hljs-operator">=</span> c.user_id    <span class="hljs-comment">-- 连接用户表，查询用户名称</span>
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> tu <span class="hljs-keyword">ON</span> tu.id <span class="hljs-operator">=</span> c.target_user_id <span class="hljs-comment">-- 连接用户表，查询用户名称</span>
<span class="hljs-keyword">WHERE</span>  c.article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>
  <span class="hljs-keyword">AND</span> (c.parent_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-comment">-- 找出顶级评论（parent_id = NULL）和子评论（parent_id 在 ids 里面）</span>
       <span class="hljs-keyword">OR</span>
       c.parent_id <span class="hljs-keyword">IN</span> (<span class="hljs-string">'ids'</span>))
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> c.parent_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DESC</span>,
         c.created_at <span class="hljs-keyword">ASC</span>;
</code></pre>
<p>通过代码进行组装成树</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 针对情况一：拿到所有数据之后，在代码中组装成一个树结构</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildTree</span>(<span class="hljs-params">list</span>) {
 <span class="hljs-keyword">const</span> topMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(); <span class="hljs-comment">// 顶级评论容器</span>
 <span class="hljs-keyword">const</span> replyMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(); <span class="hljs-comment">// 二级评论容器</span>

 list.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
   <span class="hljs-keyword">if</span> (item.<span class="hljs-property">parent_id</span> === <span class="hljs-literal">null</span>) {
     item.<span class="hljs-property">replies</span> = []; <span class="hljs-comment">// 创建一个空数组，用来存放子评论</span>
     topMap.<span class="hljs-title function_">set</span>(item.<span class="hljs-property">id</span>, item);
   } <span class="hljs-keyword">else</span> {
     <span class="hljs-keyword">const</span> arr = replyMap.<span class="hljs-title function_">get</span>(item.<span class="hljs-property">parent_id</span>) || [];
     arr.<span class="hljs-title function_">push</span>(item);
     replyMap.<span class="hljs-title function_">set</span>(item.<span class="hljs-property">parent_id</span>, arr);
   }
 });

 topMap.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">top</span>) =&gt;</span> {
   <span class="hljs-comment">// 添加子评论</span>
   top.<span class="hljs-property">replies</span> = replyMap.<span class="hljs-title function_">get</span>(top.<span class="hljs-property">id</span>) || [];
 });

 <span class="hljs-keyword">const</span> tree = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(topMap.<span class="hljs-title function_">values</span>()).<span class="hljs-title function_">sort</span>(
   <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(b.<span class="hljs-property">created_at</span>) - <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(a.<span class="hljs-property">created_at</span>)
 );

 <span class="hljs-keyword">return</span> tree;
}

</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 情况二： 先分页查询顶级的，展示时再不分页查询子评论</span>

<span class="hljs-comment">-- 1. 分页获取顶层评论</span>
<span class="hljs-keyword">SELECT</span> c.id,
       c.parent_id,
       c.user_id,
       u.name               <span class="hljs-keyword">AS</span> user_name,
       c.target_user_id,
       tu.name              <span class="hljs-keyword">AS</span> target_user_name,
       c.content,
       c.created_at
<span class="hljs-keyword">FROM</span> comment c
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u  <span class="hljs-keyword">ON</span> u.id  <span class="hljs-operator">=</span> c.user_id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> tu <span class="hljs-keyword">ON</span> tu.id <span class="hljs-operator">=</span> c.target_user_id
<span class="hljs-keyword">WHERE</span> c.article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span> <span class="hljs-keyword">AND</span> c.parent_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> c.created_at <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span> <span class="hljs-keyword">OFFSET</span> <span class="hljs-string">'页码 * 20'</span>;

<span class="hljs-comment">-- 2. 获取所有子评论</span>
<span class="hljs-keyword">SELECT</span> c.id,
       c.parent_id,
       c.user_id,
       u.name               <span class="hljs-keyword">AS</span> user_name,
       c.target_user_id,
       tu.name              <span class="hljs-keyword">AS</span> target_user_name,
       c.content,
       c.created_at
<span class="hljs-keyword">FROM</span> comment c
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u  <span class="hljs-keyword">ON</span> u.id  <span class="hljs-operator">=</span> c.user_id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> tu <span class="hljs-keyword">ON</span> tu.id <span class="hljs-operator">=</span> c.target_user_id
<span class="hljs-keyword">WHERE</span> c.article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span> <span class="hljs-keyword">AND</span> c.parent_id  <span class="hljs-operator">=</span> <span class="hljs-string">'顶层评论id'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> c.created_at <span class="hljs-keyword">ASC</span>;
</code></pre>
<p>其他的情况，就先不考虑了。</p>
<h2 data-id="heading-31">最后</h2>
<p>SQL 这东西，多写几遍就熟了。语法虽然多，但常用的就那些，上面这些算是入门。</p>
<p>前端平时接触不到，但想往全栈发展，SQL 是必须了解的。虽然实际开发用 ORM，但底层还是 SQL（就像用 Vue，JavaScript 还是要懂的）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[还在为Vue应用的报错而头疼？这招让你彻底掌控全局]]></title>    <link>https://juejin.cn/post/7579507023508537407</link>    <guid>https://juejin.cn/post/7579507023508537407</guid>    <pubDate>2025-12-03T23:26:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579507023508537407" data-draft-id="7579519985699831814" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="还在为Vue应用的报错而头疼？这招让你彻底掌控全局"/> <meta itemprop="keywords" content="Vue.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2025-12-03T23:26:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            还在为Vue应用的报错而头疼？这招让你彻底掌控全局
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T23:26:36.000Z" title="Wed Dec 03 2025 23:26:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>开发Vue应用时，最怕什么？不是复杂的逻辑，也不是难调的样式，而是那些不知从哪个角落里突然蹦出来的运行时错误。你正在测试一个新功能，页面突然白屏，控制台里一串红色错误，你却像大海捞针一样，半天找不到问题到底出在哪一层组件。用户那边更是直接反馈“页面打不开了”，你却只能干着急。</p>
<p>这种失控的感觉，真的很糟糕。错误就像是应用里的“暗雷”，你不知道它什么时候会爆。但别担心，Vue其实给我们准备了强大的“排雷工具”——那就是 <code>errorCaptured</code> 生命周期钩子和全局错误处理机制。用好它们，你不仅能精准定位错误源头，还能优雅地降级处理，给用户一个体面的体验，而不是一个冷冰冰的白屏。今天，我们就来彻底搞定Vue的错误处理，让你成为应用的“安全总监”。</p>
<h2 data-id="heading-0">理解错误处理的两种境界：局部守卫与全局防线</h2>
<p>在深入代码之前，我们先理清思路。Vue的错误处理可以分成两个层面，就像小区的安保系统。</p>
<p>第一个层面，是<strong>组件级别的“局部守卫”</strong>，也就是 <code>errorCaptured</code> 钩子。想象一下，每栋楼（组件）都有自己的保安（<code>errorCaptured</code>）。这个保安的职责很明确：盯住从这栋楼内部（当前组件）以及所有进入这栋楼的访客（子组件）身上发生的错误。一旦发现，他可以先进行初步处理，比如登记、尝试解决小问题，然后再决定是就地处理掉这个错误，还是继续向上级（父组件）报告。</p>
<p>第二个层面，是<strong>应用级别的“全局防线”</strong>，即 <code>app.config.errorHandler</code>。这就像是小区的中央监控室。所有从各个楼栋（组件）保安那里上报来的、没被就地解决的严重错误，最终都会汇集到这里。这里是最后一道屏障，也是你实现统一错误处理逻辑（比如发送错误日志到服务器、展示友好的全局错误页面）的最佳位置。</p>
<p>简单来说，<code>errorCaptured</code> 让你能沿着组件树“捕获”错误，而 <code>errorHandler</code> 让你能在最顶层“处理”错误。两者配合，才能构建完整的错误处理体系。</p>
<h2 data-id="heading-1">深入 <code>errorCaptured</code>：你的组件级错误捕手</h2>
<p><code>errorCaptured</code> 是Vue组件的一个生命周期钩子。当<strong>本组件以及它的子孙组件</strong>中发生错误时，这个钩子就会被调用。它接收三个参数，让你能掌握错误的全部信息。</p>
<p>让我们来看一个最基础的使用示例，假设我们有一个可能出错的子组件 <code>UnstableComponent</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父组件 Parent.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件区域<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 这里嵌套了一个可能不稳定的子组件 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">UnstableComponent</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onErrorCaptured } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UnstableComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./UnstableComponent.vue'</span>

<span class="hljs-comment">// 使用 onErrorCaptured 钩子</span>
<span class="hljs-title function_">onErrorCaptured</span>(<span class="hljs-function">(<span class="hljs-params">error, instance, info</span>) =&gt;</span> {
  <span class="hljs-comment">// 参数1: error - 捕获到的实际错误对象</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'捕获到子组件错误:'</span>, error.<span class="hljs-property">message</span>)
  
  <span class="hljs-comment">// 参数2: instance - 触发错误的组件实例（Vue 3中可能为null或proxy对象，取决于错误发生时机）</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'错误发生在哪个组件实例附近:'</span>, instance)
  
  <span class="hljs-comment">// 参数3: info - 一个字符串，指出错误发生的来源类型，例如：</span>
  <span class="hljs-comment">// 'render function' (渲染函数)</span>
  <span class="hljs-comment">// 'watcher callback' (侦听器回调)</span>
  <span class="hljs-comment">// 'event handler' (事件处理器)</span>
  <span class="hljs-comment">// 'lifecycle hook' (生命周期钩子)</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'错误来源:'</span>, info)
  
  <span class="hljs-comment">// 这个钩子可以返回 false 来阻止错误继续向上冒泡</span>
  <span class="hljs-comment">// 如果这里返回 false，错误就不会传到更上层的 errorCaptured 或全局 errorHandler</span>
  <span class="hljs-comment">// 我们这里先不阻止，让错误继续上传以便观察</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 子组件 UnstableComponent.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"causeError"</span>&gt;</span>点我触发一个错误<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> <span class="hljs-title function_">causeError</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 这是一个在事件处理函数中故意抛出的错误</span>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'糟糕！子组件里的事件处理函数出错了！'</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>在这个例子里，当你点击按钮，错误会在子组件中抛出。父组件的 <code>onErrorCaptured</code> 会立刻捕获到这个错误，并打印出详细信息。因为我们的钩子返回了 <code>true</code>（或者不返回任何值，默认行为是继续传播），这个错误会继续向更上层的组件“冒泡”。</p>
<p><strong>关键点：<code>errorCaptured</code> 的返回值决定了错误的命运。</strong> 如果它返回 <code>false</code>，这个错误就被“消化”在此处，不会再向上传递。这非常有用，比如你可以用它来隔离一个非核心的、不稳定第三方组件的错误，避免它导致整个页面崩溃。</p>
<h2 data-id="heading-2">配置全局错误处理器：最后的安全网</h2>
<p>当错误一路冒泡，穿过了所有组件的 <code>errorCaptured</code> 防线（或者它们都选择不拦截），最终就会到达全局处理器。这是你处理“未捕获异常”的最后机会，通常在这里我们会做几件关键事情：记录错误日志、展示用户友好的界面、尝试恢复应用状态。</p>
<p>设置它非常简单，在你的应用入口文件（通常是 <code>main.js</code> 或 <code>main.ts</code>）里配置即可：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

<span class="hljs-comment">// 配置全局错误处理器</span>
app.<span class="hljs-property">config</span>.<span class="hljs-property">errorHandler</span> = <span class="hljs-function">(<span class="hljs-params">error, instance, info</span>) =&gt;</span> {
  <span class="hljs-comment">// 参数和 errorCaptured 钩子基本一致</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'[全局错误拦截]'</span>, error)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'组件实例:'</span>, instance)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'错误来源:'</span>, info)
  
  <span class="hljs-comment">// 1. 将错误信息发送到你的日志服务器（在实际项目中至关重要！）</span>
  <span class="hljs-title function_">sendErrorToServer</span>(error, info).<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">warn</span>)
  
  <span class="hljs-comment">// 2. 显示一个友好的全局错误提示，而不是白屏</span>
  <span class="hljs-title function_">showGlobalErrorToast</span>(<span class="hljs-string">'应用发生了一点问题，我们正在紧急修复。'</span>)
  
  <span class="hljs-comment">// 注意：全局处理器不能再阻止错误传播了，因为它是最后一站。</span>
  <span class="hljs-comment">// 这里的错误已经无法被Vue框架继续处理，但我们可以防止它导致整个页面崩溃。</span>
}

<span class="hljs-comment">// 模拟发送错误到后端服务的函数</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendErrorToServer</span>(<span class="hljs-params">error, errorInfo</span>) {
  <span class="hljs-comment">// 在实际项目中，这里会调用你的API接口</span>
  <span class="hljs-keyword">const</span> errorLog = {
    <span class="hljs-attr">message</span>: error.<span class="hljs-property">message</span>,
    <span class="hljs-attr">stack</span>: error.<span class="hljs-property">stack</span>,
    <span class="hljs-attr">component</span>: errorInfo,
    <span class="hljs-attr">url</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
    <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
    <span class="hljs-attr">userAgent</span>: navigator.<span class="hljs-property">userAgent</span>
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'模拟发送错误日志到服务器:'</span>, errorLog)
  <span class="hljs-comment">// 示例：await fetch('/api/log/error', { method: 'POST', body: JSON.stringify(errorLog) })</span>
}

<span class="hljs-comment">// 模拟显示一个全局提示</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showGlobalErrorToast</span>(<span class="hljs-params">message</span>) {
  <span class="hljs-comment">// 这里可以使用你喜欢的UI库（如Element Plus, Ant Design Vue）的Message组件</span>
  <span class="hljs-comment">// 或者简单创建一个div来提示</span>
  <span class="hljs-keyword">const</span> toast = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
  toast.<span class="hljs-property">textContent</span> = message
  toast.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = <span class="hljs-string">`
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #fef0f0;
    color: #f56c6c;
    padding: 14px 20px;
    border-radius: 4px;
    border-left: 4px solid #f56c6c;
    z-index: 9999;
    box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);
  `</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(toast)
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> toast.<span class="hljs-title function_">remove</span>(), <span class="hljs-number">5000</span>)
}

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<p>全局处理器是你的“安全网”，确保即使有未预料的错误，应用也不会无声无息地崩溃，而是以一种可控的方式告知你和用户。</p>
<h2 data-id="heading-3">实战组合拳：构建一个健壮的错误处理流程</h2>
<p>理论说完了，我们来点实际的。一个完整的错误处理流程，应该结合 <code>errorCaptured</code> 的精细控制和 <code>errorHandler</code> 的全局兜底。设想一个常见场景：你的应用里有一个显示用户动态的 <code>Feed</code> 组件，里面每一条动态由一个 <code>FeedItem</code> 子组件渲染。如果某一条动态的数据异常导致其子组件渲染失败，我们不应该让整个动态流白屏，而只是让那一条动态显示错误状态。</p>
<p>让我们来实现这个场景：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Feed.vue （动态流父组件）</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"feed"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>最新动态<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 循环渲染每条动态，用 error-boundary 包裹每一项 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in feedItems"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"feed-item-wrapper"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 关键：每个动态项都被一个“错误边界”组件包裹 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Fallback 插槽定义错误时显示的内容 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">fallback</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"feed-item-error"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>这条动态暂时无法显示<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"retryLoadItem(item.id)"</span>&gt;</span>重试<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Default 插槽是正常要渲染的动态项 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">FeedItem</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"item"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">FeedItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./FeedItem.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ErrorBoundary</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./ErrorBoundary.vue'</span> <span class="hljs-comment">// 这是我们即将创建的错误边界组件</span>

<span class="hljs-comment">// 模拟动态数据，其中一条数据有问题</span>
<span class="hljs-keyword">const</span> feedItems = <span class="hljs-title function_">ref</span>([
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'今天天气真好！'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'学习了一个新的Vue技巧。'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">content</span>: <span class="hljs-literal">null</span> }, <span class="hljs-comment">// 这条数据的content为null，可能导致子组件渲染错误</span>
  { <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'晚餐吃了好吃的。'</span> },
])

<span class="hljs-keyword">const</span> <span class="hljs-title function_">retryLoadItem</span> = (<span class="hljs-params">id</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`重试加载动态 <span class="hljs-subst">${id}</span>`</span>)
  <span class="hljs-comment">// 这里可以重新拉取数据或进行其他恢复操作</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>接下来，我们创建那个核心的 <code>ErrorBoundary</code> 组件。它的作用就是利用 <code>errorCaptured</code> 钩子，捕获其默认插槽内所有子组件的错误，并在出错时显示备用（fallback）UI。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ErrorBoundary.vue （错误边界组件）</span>
&lt;template&gt;
  &lt;!-- 根据是否有错误，决定显示默认内容还是备用内容 --&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!hasError"</span> /&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"fallback"</span> /&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onErrorCaptured } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 一个标志位，记录当前边界内是否发生了错误</span>
<span class="hljs-keyword">const</span> hasError = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

<span class="hljs-title function_">onErrorCaptured</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'错误边界捕获到错误:'</span>, error.<span class="hljs-property">message</span>)
  
  <span class="hljs-comment">// 标记错误状态，这会触发模板切换，显示 fallback 插槽</span>
  hasError.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  
  <span class="hljs-comment">// 返回 false，阻止错误继续向上冒泡到更外层的组件或全局处理器</span>
  <span class="hljs-comment">// 这样，一条动态的错误就不会影响整个Feed组件</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
})

<span class="hljs-comment">// 可以提供一个重置错误状态的方法</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">reset</span> = (<span class="hljs-params"/>) =&gt; {
  hasError.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
}

<span class="hljs-comment">// 如果需要，可以将 reset 方法暴露给父组件</span>
<span class="hljs-title function_">defineExpose</span>({ reset })
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>最后，是可能不稳定的 <code>FeedItem</code> 组件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// FeedItem.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"feed-item"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 这里假设 content 必须是一个字符串，如果传入 null 就会出错 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ data.content.toUpperCase() }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- 当 data.content 为 null 时，.toUpperCase() 会抛出 TypeError --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>
  }
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>看，这个设计的美妙之处在哪里？当渲染到第三条 <code>content</code> 为 <code>null</code> 的动态时，<code>FeedItem</code> 会抛出错误。这个错误被其父级 <code>ErrorBoundary</code> 组件的 <code>errorCaptured</code> 钩子捕获。钩子将 <code>hasError</code> 设为 <code>true</code>，并返回 <code>false</code> 阻止错误上传。于是，模板切换为渲染 <code>#fallback</code> 插槽，用户看到的是“这条动态暂时无法显示”和一个重试按钮，而其他三条动态完全不受影响，全局错误处理器也根本不会收到这个错误的通知。</p>
<p>这种模式，就是前端领域常说的“错误边界”(Error Boundaries)概念在Vue中的实现。它极大地提升了应用的韧性。</p>
<h2 data-id="heading-4">一些重要的细节与陷阱</h2>
<p>掌握了核心用法，我们还得聊聊那些容易踩坑的细节，让你真正从“会用”到“精通”。</p>
<p><strong>第一，<code>errorCaptured</code> 能捕获所有错误吗？</strong> 很遗憾，不能。它主要捕获以下几类：</p>
<ol>
<li>组件的渲染函数错误。</li>
<li>侦听器回调函数（watcher）里的错误。</li>
<li>生命周期钩子里的错误。</li>
<li>自定义事件处理函数（<code>$emit</code> 触发的父组件回调）里的错误。
但是，<strong>异步回调</strong>（比如 <code>setTimeout</code>、<code>Promise.catch</code> 外部、接口请求的成功回调）中的错误，<code>errorCaptured</code> 是抓不到的。这些错误会逃逸到原生的 <code>window.onerror</code> 或 <code>unhandledrejection</code> 事件中。</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 示例：errorCaptured 无法捕获的错误</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 情况1：setTimeout 异步错误</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'异步setTimeout错误'</span>) <span class="hljs-comment">// 这个错误 errorCaptured 抓不到！</span>
  }, <span class="hljs-number">1000</span>)
  
  <span class="hljs-comment">// 情况2：Promise 中未catch的错误</span>
  <span class="hljs-title function_">someAsyncFunction</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Promise then回调错误'</span>) <span class="hljs-comment">// 这个错误 errorCaptured 也抓不到！</span>
  })
  <span class="hljs-comment">// 正确做法是在Promise链内部捕获，或者用.catch</span>
})

<span class="hljs-comment">// 你需要用原生的全局错误监听来补足</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'unhandledrejection'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'捕获到未处理的Promise拒绝:'</span>, event.<span class="hljs-property">reason</span>)
  event.<span class="hljs-title function_">preventDefault</span>() <span class="hljs-comment">// 阻止浏览器默认的错误打印</span>
})
</code></pre>
<p><strong>第二，错误处理的顺序很重要。</strong> 错误冒泡的路径是：出错的组件本身（如果有<code>errorCaptured</code>）-&gt; 父组件 -&gt; 父组件的父组件 -&gt; ... -&gt; 全局 <code>errorHandler</code>。任何一个环节的 <code>errorCaptured</code> 返回 <code>false</code>，链条就会中断。</p>
<p><strong>第三，关于服务端渲染(SSR)。</strong> 在SSR环境下（如Nuxt.js），<code>errorCaptured</code> 和客户端的行为一致。但 <code>app.config.errorHandler</code> 在服务器端和客户端是分开配置的。在Nuxt中，你可以使用 <code>vueApp.config.errorHandler</code> 在插件中配置，或者使用Nuxt提供的更高层级的错误处理机制。</p>
<h2 data-id="heading-5">总结：从手忙脚乱到从容应对</h2>
<p>走完这一趟，你会发现，Vue的错误处理不再是黑盒。从细粒度的 <code>errorCaptured</code> 钩子到全局的 <code>errorHandler</code>，我们拥有了一套完整的工具来应对各种意外。</p>
<p>最清晰的思路是分层处理：</p>
<ul>
<li>在叶子组件或可能出错的特定组件周围，使用<strong>错误边界模式</strong>（利用 <code>errorCaptured</code> 返回 <code>false</code>）来隔离非关键错误，保证局部故障不影响全局。</li>
<li>在应用的根层面，配置强大的<strong>全局错误处理器</strong>，用于记录所有未处理的错误、上报日志、并展示统一的友好提示，守住最后的用户体验底线。</li>
<li>认识到局限性，用原生的 <code>window.onerror</code> 和 <code>unhandledrejection</code> 事件来补充捕获异步错误。</li>
</ul>
<p>不要再让错误在你面前裸奔了。花点时间，为你的下一个Vue项目规划好错误处理策略。当错误再次发生时，你会看到清晰的日志、可控的界面，而不是用户的抱怨和你的困惑。这份从容，就是一个成熟开发者的标志。现在，就去你的项目中试试吧，从为一个组件添加第一个 <code>onErrorCaptured</code> 开始。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（162）如何使用Redis实现消息队列？]]></title>    <link>https://juejin.cn/post/7579473409749549107</link>    <guid>https://juejin.cn/post/7579473409749549107</guid>    <pubDate>2025-12-03T23:01:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579473409749549107" data-draft-id="7579673620939636786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（162）如何使用Redis实现消息队列？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-03T23:01:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（162）如何使用Redis实现消息队列？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T23:01:16.000Z" title="Wed Dec 03 2025 23:01:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>使用Redis实现消息队列是一种常见的应用场景，Redis可以通过其List、Pub/Sub、Stream等数据结构和功能来实现消息队列。下面详细介绍如何使用这些Redis功能来实现消息队列，并提供详细的代码示例。</p>
<h3 data-id="heading-0">1. 使用Redis List实现简单的消息队列</h3>
<p>Redis的List数据结构可以用来实现基本的FIFO（先进先出）队列。<code>LPUSH</code>命令用来将消息插入队列，<code>RPOP</code>命令用来从队列中取出消息。</p>
<h4 data-id="heading-1">1.1 生产者代码</h4>
<p>生产者负责将消息放入队列。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisQueueProducer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);
        
        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"message_queue"</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Message-"</span> + i;
            jedis.lpush(queueName, message);
            System.out.println(<span class="hljs-string">"Produced: "</span> + message);
        }

        jedis.close();
    }
}
</code></pre>
<h4 data-id="heading-2">1.2 消费者代码</h4>
<p>消费者负责从队列中取出消息进行处理。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisQueueConsumer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);
        
        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"message_queue"</span>;

        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// 阻塞式地从队列中取出消息</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> jedis.rpop(queueName);
            <span class="hljs-keyword">if</span> (message != <span class="hljs-literal">null</span>) {
                System.out.println(<span class="hljs-string">"Consumed: "</span> + message);
                <span class="hljs-comment">// 模拟消息处理</span>
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">1000</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-3">2. 使用Redis Pub/Sub实现发布/订阅模式的消息队列</h3>
<p>Redis的Pub/Sub功能可以用来实现发布/订阅模式的消息队列。</p>
<h4 data-id="heading-4">2.1 生产者代码</h4>
<p>生产者负责发布消息。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisPubSubProducer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);
        
        <span class="hljs-type">String</span> <span class="hljs-variable">channelName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"message_channel"</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Message-"</span> + i;
            jedis.publish(channelName, message);
            System.out.println(<span class="hljs-string">"Published: "</span> + message);
        }

        jedis.close();
    }
}
</code></pre>
<h4 data-id="heading-5">2.2 消费者代码</h4>
<p>消费者订阅频道并处理接收到的消息。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPubSub;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisPubSubConsumer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);
        
        <span class="hljs-type">String</span> <span class="hljs-variable">channelName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"message_channel"</span>;

        <span class="hljs-type">JedisPubSub</span> <span class="hljs-variable">jedisPubSub</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPubSub</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(String channel, String message)</span> {
                System.out.println(<span class="hljs-string">"Received message: "</span> + message);
                <span class="hljs-comment">// 模拟消息处理</span>
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">1000</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        };

        <span class="hljs-comment">// 订阅频道</span>
        jedis.subscribe(jedisPubSub, channelName);
    }
}
</code></pre>
<h3 data-id="heading-6">3. 使用Redis Stream实现高级消息队列</h3>
<p>Redis 5.0引入的Stream数据结构提供了更强大的功能，适用于构建复杂的消息队列系统。</p>
<h4 data-id="heading-7">3.1 生产者代码</h4>
<p>生产者负责将消息添加到Stream中。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisStreamProducer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);
        
        <span class="hljs-type">String</span> <span class="hljs-variable">streamName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"message_stream"</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            Map&lt;String, String&gt; message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            message.put(<span class="hljs-string">"message"</span>, <span class="hljs-string">"Message-"</span> + i);
            jedis.xadd(streamName, <span class="hljs-literal">null</span>, message);
            System.out.println(<span class="hljs-string">"Produced: "</span> + message);
        }

        jedis.close();
    }
}
</code></pre>
<h4 data-id="heading-8">3.2 消费者代码</h4>
<p>消费者从Stream中读取消息并处理。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.StreamEntry;
<span class="hljs-keyword">import</span> redis.clients.jedis.StreamEntryID;
<span class="hljs-keyword">import</span> redis.clients.jedis.StreamEntryID.*;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisStreamConsumer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);
        
        <span class="hljs-type">String</span> <span class="hljs-variable">streamName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"message_stream"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">consumerGroupName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"consumer_group"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">consumerName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"consumer_1"</span>;

        <span class="hljs-comment">// 创建消费者组</span>
        <span class="hljs-keyword">try</span> {
            jedis.xgroupCreate(streamName, consumerGroupName, <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamEntryID</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-literal">true</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.out.println(<span class="hljs-string">"Consumer group already exists"</span>);
        }

        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// 从Stream中读取消息</span>
            List&lt;Map.Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; streamEntries = jedis.xreadGroup(
                consumerGroupName, consumerName, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">redis</span>.clients.jedis.StreamEntryID[]{StreamEntryID.UNRECEIVED_ENTRY});

            <span class="hljs-keyword">for</span> (Map.Entry&lt;String, List&lt;StreamEntry&gt;&gt; entry : streamEntries) {
                <span class="hljs-keyword">for</span> (StreamEntry streamEntry : entry.getValue()) {
                    System.out.println(<span class="hljs-string">"Consumed: "</span> + streamEntry.getFields().get(<span class="hljs-string">"message"</span>));
                    <span class="hljs-comment">// 模拟消息处理</span>
                    <span class="hljs-keyword">try</span> {
                        Thread.sleep(<span class="hljs-number">1000</span>);
                    } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                        e.printStackTrace();
                    }

                    <span class="hljs-comment">// 确认消息处理完成</span>
                    jedis.xack(streamName, consumerGroupName, streamEntry.getID());
                }
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-9">总结</h3>
<p>通过Redis的List、Pub/Sub和Stream功能，可以实现不同复杂程度的消息队列。上述代码示例展示了如何使用这些功能来构建消息队列系统：</p>
<ol>
<li><strong>使用List实现简单的FIFO队列</strong>：适用于简单的消息队列需求。</li>
<li><strong>使用Pub/Sub实现发布/订阅模式</strong>：适用于消息广播，多个消费者同时接收消息。</li>
<li><strong>使用Stream实现高级消息队列</strong>：适用于复杂的消息队列需求，支持消息持久化、消费者组、消息确认等高级功能。</li>
</ol>
<p>根据应用场景和需求，可以选择合适的Redis功能来实现消息队列。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（163）如何使用Redis实现计数器？]]></title>    <link>https://juejin.cn/post/7579673620939669554</link>    <guid>https://juejin.cn/post/7579673620939669554</guid>    <pubDate>2025-12-03T23:02:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579673620939669554" data-draft-id="7579673620939653170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（163）如何使用Redis实现计数器？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-03T23:02:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（163）如何使用Redis实现计数器？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T23:02:20.000Z" title="Wed Dec 03 2025 23:02:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>使用Redis实现计数器是非常简单和高效的。Redis提供了多种命令来操作整数，以实现计数器的功能，如<code>INCR</code>、<code>DECR</code>、<code>INCRBY</code>、<code>DECRBY</code>等。下面将详细介绍如何使用这些命令来实现一个计数器，并结合代码示例。</p>
<h3 data-id="heading-0">1. 基本的计数器操作</h3>
<h4 data-id="heading-1">1.1 增加计数器</h4>
<p>使用<code>INCR</code>命令来增加计数器的值。如果键不存在，Redis会将其初始化为0，然后再执行递增操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCounterIncrement</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">counterKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"counter"</span>;

        <span class="hljs-comment">// 增加计数器</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">newValue</span> <span class="hljs-operator">=</span> jedis.incr(counterKey);
        System.out.println(<span class="hljs-string">"Incremented counter value: "</span> + newValue);

        jedis.close();
    }
}
</code></pre>
<h4 data-id="heading-2">1.2 减少计数器</h4>
<p>使用<code>DECR</code>命令来减少计数器的值。如果键不存在，Redis会将其初始化为0，然后再执行递减操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCounterDecrement</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">counterKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"counter"</span>;

        <span class="hljs-comment">// 减少计数器</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">newValue</span> <span class="hljs-operator">=</span> jedis.decr(counterKey);
        System.out.println(<span class="hljs-string">"Decremented counter value: "</span> + newValue);

        jedis.close();
    }
}
</code></pre>
<h3 data-id="heading-3">2. 带步长的计数器操作</h3>
<h4 data-id="heading-4">2.1 增加特定步长</h4>
<p>使用<code>INCRBY</code>命令，可以增加计数器一个指定的步长。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCounterIncrementBy</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">counterKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"counter"</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">step</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

        <span class="hljs-comment">// 增加计数器指定的步长</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">newValue</span> <span class="hljs-operator">=</span> jedis.incrBy(counterKey, step);
        System.out.println(<span class="hljs-string">"Incremented counter by "</span> + step + <span class="hljs-string">": "</span> + newValue);

        jedis.close();
    }
}
</code></pre>
<h4 data-id="heading-5">2.2 减少特定步长</h4>
<p>使用<code>DECRBY</code>命令，可以减少计数器一个指定的步长。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCounterDecrementBy</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">counterKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"counter"</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">step</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

        <span class="hljs-comment">// 减少计数器指定的步长</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">newValue</span> <span class="hljs-operator">=</span> jedis.decrBy(counterKey, step);
        System.out.println(<span class="hljs-string">"Decremented counter by "</span> + step + <span class="hljs-string">": "</span> + newValue);

        jedis.close();
    }
}
</code></pre>
<h3 data-id="heading-6">3. 获取计数器的值</h3>
<p>使用<code>GET</code>命令可以获取计数器的当前值。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCounterGetValue</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">counterKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"counter"</span>;

        <span class="hljs-comment">// 获取计数器的值</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> jedis.get(counterKey);
        System.out.println(<span class="hljs-string">"Current counter value: "</span> + value);

        jedis.close();
    }
}
</code></pre>
<h3 data-id="heading-7">4. 重置计数器</h3>
<p>使用<code>SET</code>命令可以重置计数器的值。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCounterReset</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">counterKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"counter"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">initialValue</span> <span class="hljs-operator">=</span> <span class="hljs-string">"0"</span>;

        <span class="hljs-comment">// 重置计数器的值</span>
        jedis.set(counterKey, initialValue);
        System.out.println(<span class="hljs-string">"Counter reset to: "</span> + initialValue);

        jedis.close();
    }
}
</code></pre>
<h3 data-id="heading-8">5. 带有过期时间的计数器</h3>
<p>有时，计数器可能需要在一定时间后过期。可以使用<code>SET</code>命令中的<code>EX</code>参数来设置过期时间，或者使用<code>EXPIRE</code>命令。</p>
<h4 data-id="heading-9">5.1 设置带有过期时间的计数器</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCounterWithTTL</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">counterKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"counter"</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">ttl</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span>; <span class="hljs-comment">// 过期时间，单位为秒</span>

        <span class="hljs-comment">// 初始化计数器并设置过期时间</span>
        jedis.setex(counterKey, ttl, <span class="hljs-string">"0"</span>);
        System.out.println(<span class="hljs-string">"Counter initialized with TTL: "</span> + ttl + <span class="hljs-string">" seconds"</span>);

        jedis.close();
    }
}
</code></pre>
<h4 data-id="heading-10">5.2 更新过期时间</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCounterUpdateTTL</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">counterKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"counter"</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">ttl</span> <span class="hljs-operator">=</span> <span class="hljs-number">120</span>; <span class="hljs-comment">// 新的过期时间，单位为秒</span>

        <span class="hljs-comment">// 更新计数器的过期时间</span>
        jedis.expire(counterKey, ttl);
        System.out.println(<span class="hljs-string">"Updated counter TTL to: "</span> + ttl + <span class="hljs-string">" seconds"</span>);

        jedis.close();
    }
}
</code></pre>
<h3 data-id="heading-11">总结</h3>
<p>通过使用Redis的<code>INCR</code>、<code>DECR</code>、<code>INCRBY</code>、<code>DECRBY</code>、<code>GET</code>、<code>SET</code>、<code>SETEX</code>和<code>EXPIRE</code>等命令，可以轻松实现一个功能丰富的计数器。上述代码示例展示了如何在Java中使用Jedis库来操作Redis计数器，包括增加、减少、指定步长、获取值、重置和设置过期时间等操作。根据实际需求，可以灵活应用这些命令来实现不同的计数器功能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Bun 卖身 Anthropic！尤雨溪神吐槽：OpenAI 你需要工具链吗？]]></title>    <link>https://juejin.cn/post/7579473409749336115</link>    <guid>https://juejin.cn/post/7579473409749336115</guid>    <pubDate>2025-12-03T15:16:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579473409749336115" data-draft-id="7579499567868641330" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Bun 卖身 Anthropic！尤雨溪神吐槽：OpenAI 你需要工具链吗？"/> <meta itemprop="keywords" content="OpenAI,Bun,前端"/> <meta itemprop="datePublished" content="2025-12-03T15:16:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Bun 卖身 Anthropic！尤雨溪神吐槽：OpenAI 你需要工具链吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T15:16:15.000Z" title="Wed Dec 03 2025 15:16:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Anthropic 收购 Bun，Claude Code 半年营收破 10 亿美元</h2>
<p>今天刷推的时候看到一条爆炸新闻：Anthropic 把 Bun 给收了。</p>
<p>是的，就是那个号称"比 Node.js 快得多"的 JavaScript 运行时。这也是 Anthropic 成立以来的第一笔收购。</p>
<p>更劲爆的是，官宣的同时还顺便秀了一把肌肉——Claude Code 上线半年，年化收入已经突破 <strong>10 亿美元</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f8d8b0eb657433994b037a5fcb78eff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765379774&amp;x-signature=Ru1GS9fCAbEpsg4aQuLA%2B0wW3YQ%3D" alt="a7a3277c91316fe8d3ddff846238c4a1.jpg" loading="lazy"/></p>
<p><em>网友速度很快，恶搞图已经出来了：Bun 屁股上印着 Claude 的 logo</em></p>
<h3 data-id="heading-1">先说说 Claude Code 有多猛</h3>
<p>Claude Code 今年 5 月才正式公开，一开始只是 Anthropic 内部工程师自己用的小工具。结果半年不到，Netflix、Spotify、KPMG、欧莱雅、Salesforce 这些大厂全用上了。</p>
<p>10 亿美元年化收入是什么概念？Anthropic 说他们今年底整体收入要冲 90 亿，明年目标 200 亿+。Claude Code 一个产品就贡献了超过 10%。</p>
<p>难怪微软和英伟达要砸 150 亿进来，现在 Anthropic 估值已经到 1830 亿美元了。</p>
<h3 data-id="heading-2">为什么要买 Bun？</h3>
<p>说实话一开始我也没想通，一个 AI 公司买 JS 运行时干嘛？</p>
<p>看完官方博客才明白：<strong>Claude Code 本身就是用 Bun 打包分发的</strong>。</p>
<p>你装 Claude Code 的时候有没有注意过，它是一个单文件可执行程序，不需要你提前装 Node.js。这就是 Bun 的功劳——它能把整个 JS 应用编译成一个独立的二进制文件。</p>
<p>Anthropic 首席产品官 Mike Krieger 说得很直接：</p>
<blockquote>
<p>"如果 Bun 挂了，Claude Code 就挂了。"</p>
</blockquote>
<p>与其把核心基础设施的命运交给别人，不如直接买下来。</p>
<h3 data-id="heading-3">Bun 到底是啥？</h3>
<p>如果你还不了解 Bun，简单介绍一下：</p>
<p>它是 2021 年 Jarred Sumner 搞出来的，号称要替代 Node.js。不只是运行时，还包括包管理器、打包工具、测试运行器，一套全家桶。</p>
<p>技术上最大的不同是引擎选择。Node.js 和 Deno 都用 Chrome 的 V8，Bun 用的是 Safari 的 JavaScriptCore。启动速度更快，内存占用更低。底层用 Zig 语言写的，性能确实猛。</p>
<p>数据说话：</p>
<ul>
<li>月下载量 720 万+</li>
<li>GitHub 82000+ 星</li>
<li>Midjourney、Lovable 这些公司都在用</li>
</ul>
<p>但说实话，Bun 之前只融了 700 万美元的种子轮。作为一个要挑战 Node.js 的项目，这点钱真的不够烧。</p>
<h3 data-id="heading-4">Jarred Sumner 怎么想的？</h3>
<p>看了 Bun 官方博客，Sumner 写得挺实在的：</p>
<blockquote>
<p>"感谢 Anthropic，我们可以跳过那个'VC 支持的初创公司到处找商业模式'的阶段了。"</p>
</blockquote>
<p>他说得对。当别人问"Bun 五年后还在不在"的时候，"我们融了 700 万"确实不是个好答案。</p>
<p>更有意思的是他对 AI 赛道的判断：</p>
<blockquote>
<p>"Anthropic is going to win."</p>
</blockquote>
<p>直接押注 Anthropic 会赢。说能在 AI 最前沿的团队里工作，比继续当独立创业者有意思多了。</p>
<h3 data-id="heading-5">尤雨溪的神回复</h3>
<p>这条新闻出来后，Vue 作者尤雨溪发了条推特：</p>
<blockquote>
<p>"Hey @OpenAI - if you also need a JavaScript toolchain... 😜"</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34204081cec24ad78265b21150474d57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765379774&amp;x-signature=xGyCTBeuSFTP4BWtgI%2FrArxfz9I%3D" alt="e25af0e3e915fe8551853812b94d8204.jpg" loading="lazy"/></p>
<p>笑死，这是在暗示 OpenAI 也可以来找他买 Vite？</p>
<p>底下有人接梗：</p>
<blockquote>
<p>"只要他们不加一个 <code>if(isOpenAI()) { slow(); }</code> 就没问题"</p>
</blockquote>
<p>尤雨溪回了句 <strong>"You never know!"</strong></p>
<p>然后就有粉丝急了，问他会不会也把 Vue 卖掉。尤雨溪的回答很干脆：</p>
<blockquote>
<p><strong>"Vue will never be sold."</strong></p>
</blockquote>
<p>放心了放心了。</p>
<h3 data-id="heading-6">开源会不会凉？</h3>
<p>这是很多人关心的问题。</p>
<p>Anthropic 官方承诺：</p>
<ul>
<li>Bun 继续开源，MIT 协议不变</li>
<li>还是在 GitHub 上公开开发</li>
<li>原班人马继续干</li>
</ul>
<p>但社区里还是有担忧的声音。毕竟被收购后，Bun 的优先级可能会变。之前是"做最好的 JS 运行时"，以后会不会变成"做最适合 Claude Code 的运行时"？</p>
<p>还有人说 Bun 现在生产环境还不够稳定，不知道 Anthropic 会不会优先解决这些问题，还是只顾着给 AI 工具做优化。</p>
<h3 data-id="heading-7">这事说明什么？</h3>
<p>往大了说，AI 公司正在从"卖模型"往"卖开发平台"转型。</p>
<p>以前大家觉得 AI 公司就是训练模型、提供 API。现在 Anthropic 的路子是：我不光给你模型，还给你编程助手，连底层运行时都自己搞定。</p>
<p>Claude Code 半年 10 亿美元的收入证明，开发者确实愿意为好用的 AI 编程工具付费。而 Anthropic 通过收购 Bun，把这条产品线的技术栈彻底握在了自己手里。</p>
<h3 data-id="heading-8">对我们有啥影响？</h3>
<ul>
<li><strong>用 Claude Code 的</strong>：应该会越来越好用，毕竟 Bun 团队现在是自己人了</li>
<li><strong>用 Bun 的</strong>：短期没啥变化，长期要看 Anthropic 怎么平衡社区需求和自家产品需求</li>
<li><strong>吃瓜群众</strong>：可以观望一下，看看 OpenAI 会不会也搞类似的收购（真买 Vite 的话就乐子大了）</li>
</ul>
<p>对了，鉴于 Claude 对中国用户不太友好，不确定 Bun 以后会不会也变得"排华"（手动狗头）</p>
<hr/>
<h3 data-id="heading-9">相关链接</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fnews%2Fanthropic-acquires-bun-as-claude-code-reaches-usd1b-milestone" target="_blank" title="https://www.anthropic.com/news/anthropic-acquires-bun-as-claude-code-reaches-usd1b-milestone" ref="nofollow noopener noreferrer">Anthropic 官方公告</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.com%2Fblog%2Fbun-joins-anthropic" target="_blank" title="https://bun.com/blog/bun-joins-anthropic" ref="nofollow noopener noreferrer">Bun 官方博客</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnews.ycombinator.com%2Fitem%3Fid%3D46124258" target="_blank" title="https://news.ycombinator.com/item?id=46124258" ref="nofollow noopener noreferrer">Hacker News 讨论</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsimonwillison.net%2F2025%2FDec%2F2%2Fanthropic-acquires-bun%2F" target="_blank" title="https://simonwillison.net/2025/Dec/2/anthropic-acquires-bun/" ref="nofollow noopener noreferrer">Simon Willison's Blog</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Hadoop+Spark+python毕设】智能制造生产效能分析与可视化系统、计算机毕业设计、包括数据爬取、Spark、数据分析、数据可视化、Hadoop]]></title>    <link>https://juejin.cn/post/7579473409749041203</link>    <guid>https://juejin.cn/post/7579473409749041203</guid>    <pubDate>2025-12-03T14:26:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579473409749041203" data-draft-id="7579518059170480154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Hadoop+Spark+python毕设】智能制造生产效能分析与可视化系统、计算机毕业设计、包括数据爬取、Spark、数据分析、数据可视化、Hadoop"/> <meta itemprop="keywords" content="后端,Python,MySQL"/> <meta itemprop="datePublished" content="2025-12-03T14:26:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="计算机毕设小月哥"/> <meta itemprop="url" content="https://juejin.cn/user/95020128928073"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Hadoop+Spark+python毕设】智能制造生产效能分析与可视化系统、计算机毕业设计、包括数据爬取、Spark、数据分析、数据可视化、Hadoop
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/95020128928073/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    计算机毕设小月哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T14:26:57.000Z" title="Wed Dec 03 2025 14:26:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>🎓 作者：计算机毕设小月哥 | 软件开发专家</p>
<p>🖥️ 简介：8年计算机软件程序开发经验。精通Java、Python、微信小程序、安卓、大数据、PHP、.NET|C#、Golang等技术栈。</p>
<p>🛠️ 专业服务 🛠️</p>
<ul>
<li>
<p>需求定制化开发</p>
</li>
<li>
<p>源码提供与讲解</p>
</li>
<li>
<p>技术文档撰写（指导计算机毕设选题【新颖+创新】、任务书、开题报告、文献综述、外文翻译等）</p>
</li>
<li>
<p>项目答辩演示PPT制作</p>
</li>
</ul>
</blockquote>
<blockquote>
<p>🌟 欢迎：点赞 👍 收藏 ⭐ 评论 📝</p>
<p>👇🏻 精选专栏推荐 👇🏻 欢迎订阅关注！</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761129.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761129.html" ref="nofollow noopener noreferrer">大数据实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761131.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761131.html" ref="nofollow noopener noreferrer">PHP|C#.NET|Golang实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761132.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761132.html" ref="nofollow noopener noreferrer">微信小程序|安卓实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761130.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761130.html" ref="nofollow noopener noreferrer">Python实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761126.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761126.html" ref="nofollow noopener noreferrer">Java实战项目</a></p>
<p>🍅 ↓↓主页获取源码联系↓↓🍅</p>
</blockquote>
<h2 data-id="heading-0">基于大数据的智能制造生产效能分析与可视化系统-功能介绍</h2>
<p>本系统是一个基于Hadoop与Spark大数据技术栈构建的智能制造生产效能分析与可视化平台，旨在应对现代工业环境中海量、多源生产数据的处理挑战。系统以Python作为主要开发语言，利用Spark强大的分布式计算能力，对智能制造场景下的核心生产数据进行深度挖掘与高效分析。系统首先通过Hadoop HDFS对海量生产记录（如smart_manufacturing_dataset.csv）进行分布式存储，随后利用Spark SQL及Pandas对数据进行清洗、转换和预处理，确保数据质量。核心分析模块围绕生产效能、质量控制、资源消耗、设备性能和运营优化五大维度展开，能够精确计算单台机器的单位能耗产出比与单位材料产出比，从而识别高效与低效设备；能够按材料类别分析其利用效率，为优化材料配置、降低成本提供依据；还能进行时间序列趋势分析，揭示生产效能的周期性规律与波动。最终，系统通过Vue与Echarts构建的前端界面，将复杂的分析结果以直观的动态图表形式呈现，如设备性能排名雷达图、材料消耗分布饼图、生产效能趋势折线图等，为管理者提供一个清晰、全面的数据驱动决策支持工具，实现生产过程的精细化管理和持续优化。</p>
<h2 data-id="heading-1">基于大数据的智能制造生产效能分析与可视化系统-选题背景意义</h2>
<p>选题背景
随着工业4.0和智能制造概念的不断深入，现代工厂早已不是单纯的机械集合，而是演变成了由数据驱动的复杂系统。生产线上的传感器、控制器和各种信息系统每时每刻都在产生海量的数据，这些数据涵盖了设备状态、物料流转、能源消耗、产品质量等方方面面。这些数据蕴含着巨大的价值，能够帮助我们洞察生产过程中的瓶颈、发现效率提升的空间以及预测潜在的质量风险。然而，传统的数据分析方法，如基于单机或小型数据库的统计分析，在面对这种体量大、维度多、产生速度快的大数据时显得力不从心，处理效率低下且难以挖掘出数据间深层次的关联。正是在这样的背景下，利用Hadoop和Spark这类专为大数据处理而生的技术，对智能制造的生产效能进行系统性分析，成为了一个极具现实意义和应用价值的课题。它旨在解决传统方法无法处理的数据难题，将沉睡的数据转化为指导生产的宝贵洞察。
选题意义
本课题的意义在于，它尝试将前沿的大数据技术应用于一个具体的工业场景，探索解决实际问题的可能性。从实际应用的角度来看，这个系统能够为制造企业的管理者提供一个清晰的“驾驶舱”，让他们能直观地看到整个生产线的运行状况。通过分析，可以帮助识别出哪些设备的能耗产出比最低，或者哪些材料组合的缺陷率最高，从而为设备维护、工艺改进和材料采购提供精准的数据支持。这不仅仅是为了提升几个百分点的效率，更是为了优化生产调度、降低不必要的能耗和材料浪费，最终实现降本增增效。从学术和实践学习的角度看，这个项目也是一个完整的大数据处理流程的实践，涵盖了从数据采集、存储、清洗、分析到最终可视化的全过程。对于计算机专业的学生而言，亲手搭建这样一个系统，能够极大地加深对大数据技术栈的理解和应用能力。虽然它只是一个毕业设计的范畴，但其核心思路和方法，即用数据驱动决策，对于未来从事相关领域的工作或研究，都具有很好的参考和启发价值。</p>
<h2 data-id="heading-2">基于大数据的智能制造生产效能分析与可视化系统-技术选型</h2>
<p>大数据框架：Hadoop+Spark（本次没用Hive，支持定制）
开发语言：Python+Java（两个版本都支持）
后端框架：Django+Spring Boot(Spring+SpringMVC+Mybatis)（两个版本都支持）
前端：Vue+ElementUI+Echarts+HTML+CSS+JavaScript+jQuery
详细技术点：Hadoop、HDFS、Spark、Spark SQL、Pandas、NumPy
数据库：MySQL</p>
<h2 data-id="heading-3">基于大数据的智能制造生产效能分析与可视化系统-视频展示</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1fe2tBdEp1%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1fe2tBdEp1/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">基于大数据的智能制造生产效能分析与可视化系统-视频展示</a></p>
<h2 data-id="heading-4">基于大数据的智能制造生产效能分析与可视化系统-图片展示</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/189bada57dc94d109f88316dd42900f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765376817&amp;x-signature=fl4XQ3kX5mMGiBILrG%2BIbr7v7vQ%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e7f4a61c36343499a402d5a108c0794~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765376817&amp;x-signature=iTAeMgt2Shx2vQvs6FfcjN9A4pA%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2405d54ab6e94b4ca24e6150126101b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765376817&amp;x-signature=g82pWDjTOJ6pflzhAnXdvNIrIQ8%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8499758bb8a41f6b2807172dc72255f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765376817&amp;x-signature=DB%2FdA%2BpZCO3kVfEcAQo%2BFK4ZEOg%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fa642155b96423daee5cb200538c869~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765376817&amp;x-signature=T1LpBcIRgnOm0O9AW1zVg9iI9dQ%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f37bd632a58045f8944fb4c52add8693~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765376817&amp;x-signature=D0xHt%2BsvXoLNMlnsDOzft9QSQ60%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb3deea892ad4a56971ec1f8385a4380~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765376817&amp;x-signature=%2FyrZAUHMznGn6qClkvYyhl8kCPU%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/429f73ccaf294e1ea09b86d7d4970f21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765376817&amp;x-signature=wP3WnG5NEq4ZBmHNQNsnb%2BlipLM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-5">基于大数据的智能制造生产效能分析与可视化系统-代码展示</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> SparkSession, functions <span class="hljs-keyword">as</span> F

<span class="hljs-comment"># 初始化SparkSession</span>
spark = SparkSession.builder \
    .appName(<span class="hljs-string">"SmartManufacturingAnalysis"</span>) \
    .getOrCreate()

<span class="hljs-comment"># 假设df是已经加载好的Spark DataFrame</span>
<span class="hljs-comment"># df = spark.read.csv("hdfs://path/to/smart_manufacturing_dataset.csv", header=True, inferSchema=True)</span>

<span class="hljs-comment"># 核心功能1: 机器生产效率分析</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">machine_efficiency_analysis</span>(<span class="hljs-params">df</span>):
    <span class="hljs-comment"># 按机器ID分组，计算总产出、总能耗、总材料用量</span>
    machine_summary = df.groupBy(<span class="hljs-string">"Machine ID"</span>).agg(
        F.<span class="hljs-built_in">sum</span>(<span class="hljs-string">"Production Output"</span>).alias(<span class="hljs-string">"Total_Production_Output"</span>),
        F.<span class="hljs-built_in">sum</span>(<span class="hljs-string">"Energy Consumption"</span>).alias(<span class="hljs-string">"Total_Energy_Consumption"</span>),
        F.<span class="hljs-built_in">sum</span>(<span class="hljs-string">"Quantity Used"</span>).alias(<span class="hljs-string">"Total_Quantity_Used"</span>)
    )
    <span class="hljs-comment"># 计算单位能耗产出比和单位材料产出比，避免除以零的错误</span>
    machine_efficiency = machine_summary.withColumn(
        <span class="hljs-string">"Energy_Output_Ratio"</span>,
        F.when(F.col(<span class="hljs-string">"Total_Energy_Consumption"</span>) &gt; <span class="hljs-number">0</span>, F.col(<span class="hljs-string">"Total_Production_Output"</span>) / F.col(<span class="hljs-string">"Total_Energy_Consumption"</span>)).otherwise(<span class="hljs-number">0</span>)
    ).withColumn(
        <span class="hljs-string">"Material_Output_Ratio"</span>,
        F.when(F.col(<span class="hljs-string">"Total_Quantity_Used"</span>) &gt; <span class="hljs-number">0</span>, F.col(<span class="hljs-string">"Total_Production_Output"</span>) / F.col(<span class="hljs-string">"Total_Quantity_Used"</span>)).otherwise(<span class="hljs-number">0</span>)
    )
    <span class="hljs-comment"># 按单位能耗产出比降序排列，找出最高效的机器</span>
    <span class="hljs-keyword">return</span> machine_efficiency.orderBy(F.desc(<span class="hljs-string">"Energy_Output_Ratio"</span>))

<span class="hljs-comment"># 核心功能2: 材料利用效率分析</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">material_efficiency_analysis</span>(<span class="hljs-params">df</span>):
    <span class="hljs-comment"># 按材料类别和具体材料名称分组，计算总产出和总用量</span>
    material_summary = df.groupBy(<span class="hljs-string">"Material Category"</span>, <span class="hljs-string">"Material Name"</span>).agg(
        F.<span class="hljs-built_in">sum</span>(<span class="hljs-string">"Production Output"</span>).alias(<span class="hljs-string">"Total_Production_Output"</span>),
        F.<span class="hljs-built_in">sum</span>(<span class="hljs-string">"Quantity Used"</span>).alias(<span class="hljs-string">"Total_Quantity_Used"</span>)
    )
    <span class="hljs-comment"># 计算单位材料产出比</span>
    material_efficiency = material_summary.withColumn(
        <span class="hljs-string">"Material_Output_Ratio"</span>,
        F.when(F.col(<span class="hljs-string">"Total_Quantity_Used"</span>) &gt; <span class="hljs-number">0</span>, F.col(<span class="hljs-string">"Total_Production_Output"</span>) / F.col(<span class="hljs-string">"Total_Quantity_Used"</span>)).otherwise(<span class="hljs-number">0</span>)
    )
    <span class="hljs-comment"># 按材料类别和单位产出比排序</span>
    <span class="hljs-keyword">return</span> material_efficiency.orderBy(<span class="hljs-string">"Material Category"</span>, F.desc(<span class="hljs-string">"Material_Output_Ratio"</span>))

<span class="hljs-comment"># 核心功能3: 时间维度生产效能趋势分析</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">time_dimension_trend_analysis</span>(<span class="hljs-params">df</span>):
    <span class="hljs-comment"># 将Timestamp转换为时间类型，并提取日期和小时作为分析维度</span>
    time_df = df.withColumn(<span class="hljs-string">"Timestamp"</span>, F.to_timestamp(<span class="hljs-string">"Timestamp"</span>, <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>)) \
        .withColumn(<span class="hljs-string">"Date"</span>, F.date_format(<span class="hljs-string">"Timestamp"</span>, <span class="hljs-string">"yyyy-MM-dd"</span>)) \
        .withColumn(<span class="hljs-string">"Hour"</span>, F.hour(<span class="hljs-string">"Timestamp"</span>))
    <span class="hljs-comment"># 按日期和小时分组，计算总产出、平均缺陷率和总能耗</span>
    time_trend = time_df.groupBy(<span class="hljs-string">"Date"</span>, <span class="hljs-string">"Hour"</span>).agg(
        F.<span class="hljs-built_in">sum</span>(<span class="hljs-string">"Production Output"</span>).alias(<span class="hljs-string">"Hourly_Production_Output"</span>),
        F.avg(<span class="hljs-string">"Defect Rate"</span>).alias(<span class="hljs-string">"Hourly_Avg_Defect_Rate"</span>),
        F.<span class="hljs-built_in">sum</span>(<span class="hljs-string">"Energy Consumption"</span>).alias(<span class="hljs-string">"Hourly_Energy_Consumption"</span>)
    )
    <span class="hljs-comment"># 按日期和小时排序，以形成时间序列</span>
    <span class="hljs-keyword">return</span> time_trend.orderBy(<span class="hljs-string">"Date"</span>, <span class="hljs-string">"Hour"</span>)

<span class="hljs-comment"># # 示例调用</span>
<span class="hljs-comment"># df = spark.read.csv("hdfs://path/to/smart_manufacturing_dataset.csv", header=True, inferSchema=True)</span>
<span class="hljs-comment"># machine_efficiency_analysis(df).show()</span>
<span class="hljs-comment"># material_efficiency_analysis(df).show()</span>
<span class="hljs-comment"># time_dimension_trend_analysis(df).show(50)</span>
</code></pre>
<h2 data-id="heading-6">基于大数据的智能制造生产效能分析与可视化系统-结语</h2>
<blockquote>
<p>🌟 欢迎：点赞 👍 收藏 ⭐ 评论 📝</p>
<p>👇🏻 精选专栏推荐 👇🏻 欢迎订阅关注！</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761129.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761129.html" ref="nofollow noopener noreferrer">大数据实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761131.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761131.html" ref="nofollow noopener noreferrer">PHP|C#.NET|Golang实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761132.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761132.html" ref="nofollow noopener noreferrer">微信小程序|安卓实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761130.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761130.html" ref="nofollow noopener noreferrer">Python实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761126.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761126.html" ref="nofollow noopener noreferrer">Java实战项目</a></p>
<p>🍅 ↓↓主页获取源码联系↓↓🍅</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【python大数据毕设实战】青少年抑郁症风险数据分析可视化系统、Hadoop、计算机毕业设计、包括数据爬取、数据分析、数据可视化、机器学习]]></title>    <link>https://juejin.cn/post/7579441333166817289</link>    <guid>https://juejin.cn/post/7579441333166817289</guid>    <pubDate>2025-12-03T14:37:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579441333166817289" data-draft-id="7579472170905976882" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【python大数据毕设实战】青少年抑郁症风险数据分析可视化系统、Hadoop、计算机毕业设计、包括数据爬取、数据分析、数据可视化、机器学习"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2025-12-03T14:37:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="计算机毕设匠心工作室"/> <meta itemprop="url" content="https://juejin.cn/user/2452372492400835"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【python大数据毕设实战】青少年抑郁症风险数据分析可视化系统、Hadoop、计算机毕业设计、包括数据爬取、数据分析、数据可视化、机器学习
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2452372492400835/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    计算机毕设匠心工作室
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T14:37:17.000Z" title="Wed Dec 03 2025 14:37:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>🍊作者：计算机毕设匠心工作室</p>
<p>🍊简介：毕业后就一直专业从事计算机软件程序开发，至今也有8年工作经验。擅长Java、Python、微信小程序、安卓、大数据、PHP、.NET|C#、Golang等。</p>
<p>擅长：按照需求定制化开发项目、 源码、对代码进行完整讲解、文档撰写、ppt制作。</p>
<p>🍊心愿：点赞 👍 收藏 ⭐评论 📝</p>
<p>👇🏻 精彩专栏推荐订阅 👇🏻 不然下次找不到哟~</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754938.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754938.html" ref="nofollow noopener noreferrer">Java实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754940.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754940.html" ref="nofollow noopener noreferrer">Python实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754945.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754945.html" ref="nofollow noopener noreferrer">微信小程序|安卓实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754947.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754947.html" ref="nofollow noopener noreferrer">大数据实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754949.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754949.html" ref="nofollow noopener noreferrer">PHP|C#.NET|Golang实战项目</a></p>
<p>🍅 ↓↓文末获取源码联系↓↓🍅</p>
</blockquote>
<h2 data-id="heading-0">基于大数据的青少年抑郁症风险数据分析可视化系统-功能介绍</h2>
<p>本项目是一个基于大数据技术的青少年抑郁症风险数据分析与可视化系统，旨在通过现代数据科学技术深入探究青少年抑郁风险与多种潜在因素之间的复杂关系。系统整体采用先进的大数据架构，后端以Python为核心，并整合了Hadoop与Spark两大主流大数据框架，用于处理和分析大规模的健康调查数据集。具体而言，系统利用Hadoop的HDFS作为数据存储的基石，确保海量数据集的可靠存储；通过Apache Spark进行高效的分布式计算，执行包括数据清洗、转换、聚合分析在内的复杂任务，能够快速从原始数据中提取有价值的统计信息。在Web应用层面，我们采用轻量且功能强大的Django框架来构建后端服务，负责处理前端请求、调度Spark分析任务并将分析结果以API形式提供给前端。前端界面则基于Vue.js和ElementUI构建，为用户提供了直观、友好的交互体验。系统的核心亮点在于其强大的数据可视化能力，它利用Echarts图表库，将Spark分析出的复杂数据关系，如不同年龄、性别、生活习惯下的抑郁风险分布，以动态的柱状图、饼图、折线图等多种形式清晰地呈现出来，将枯燥的数据转化为易于理解的视觉洞察，为相关研究和干预措施提供数据支持。</p>
<h2 data-id="heading-1">基于大数据的青少年抑郁症风险数据分析可视化系统-选题背景意义</h2>
<p>选题背景
近年来，青少年心理健康问题，特别是抑郁症的发病率，已成为全球范围内日益突出的公共卫生挑战，引起了社会各界的广泛关注。青少年阶段是个体生理、心理和社会适应能力发展的关键时期，面临着来自学业、社交、家庭等多方面的压力，使得他们成为抑郁症的高风险群体。传统的心理健康研究多依赖于小样本的问卷调查和临床访谈，虽然具有一定的深度，但在广度和客观性上存在局限，难以全面揭示影响青少年抑郁风险的多元化因素及其潜在的复杂关联。随着信息技术的飞速发展，我们进入了一个数据爆炸的时代，海量、多维度的数据为理解复杂社会现象提供了新的可能性。如何利用大数据技术，从大规模的健康数据中挖掘出有价值的模式和规律，从而更科学、更宏观地审视青少年抑郁症的成因，已成为一个亟待探索的重要课题。本项目正是在这样的背景下提出的，尝试将大数据分析方法应用于青少年心理健康领域，希望能为这一复杂问题的理解提供一个新的数据驱动视角。
选题意义
本课题的意义主要体现在技术和实际应用两个层面。从技术角度来看，它是一个完整的大数据技术栈实战项目。它不仅仅是简单地使用一个数据库或Web框架，而是系统地整合了Hadoop的分布式存储、Spark的快速内存计算、Python的数据处理能力以及Django的Web服务开发，构成了一套端到端的数据处理与展示流程。对于即将毕业的计算机专业学生而言，完成这样一个项目能够全面锻炼和展示对大数据核心技术的理解和应用能力，从数据采集、清洗、分析到最终的可视化呈现，每一个环节都是宝贵的实践经验，这远比单纯学习理论或做一个简单的CRUD系统更有深度和挑战性。在更实际的意义上，虽然这只是一个毕业设计，但它所构建的分析模型和可视化结果，可以为关注青少年心理健康的人群提供一种直观的参考。比如，通过分析结果，家长和教育工作者或许能更清晰地看到睡眠时长、体育锻炼、社交媒体使用习惯等因素与抑郁风险的潜在关联，从而在日常教育和家庭引导中更有针对性地进行调整和干预。当然，我们必须谦虚地认识到，本系统的分析结果仅能揭示相关性而非因果性，绝不能作为医学诊断的依据，但它作为一种数据探索和科普的工具，其价值在于能够引发更多人对青少年心理健康问题的思考和重视。</p>
<h2 data-id="heading-2">基于大数据的青少年抑郁症风险数据分析可视化系统-技术选型</h2>
<p>大数据框架：Hadoop+Spark（本次没用Hive，支持定制）
开发语言：Python+Java（两个版本都支持）
后端框架：Django+Spring Boot(Spring+SpringMVC+Mybatis)（两个版本都支持）
前端：Vue+ElementUI+Echarts+HTML+CSS+JavaScript+jQuery
详细技术点：Hadoop、HDFS、Spark、Spark SQL、Pandas、NumPy
数据库：MySQL</p>
<h2 data-id="heading-3">基于大数据的青少年抑郁症风险数据分析可视化系统-视频展示</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1tR2tBGErC%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1tR2tBGErC/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">基于大数据的青少年抑郁症风险数据分析可视化系统-视频展示</a></p>
<h2 data-id="heading-4">基于大数据的青少年抑郁症风险数据分析可视化系统-图片展示</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d4cb115627f4a649ba78b5f0090a65a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377437&amp;x-signature=Ms65sCcsDoH9CaVFxUCY1ToFj1M%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8171aee12e2a4f3dafb7620a8817d6ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377437&amp;x-signature=m%2B5OuhhLEv8o95S%2BV2%2BPZUMu8qI%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7f079c4cca74f39a776af8884195326~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377437&amp;x-signature=s9FP9sbzojNB3BzFWfEsVq8gFOE%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d0b1825162f41c69b24e780c54753e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377437&amp;x-signature=EEkLNQ%2B2tUkF7qVV%2FjnqFfl6vuQ%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8211fe7a9bf548a780ad5002e8706b07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377437&amp;x-signature=onaYwcJvy7K2yjzgMOe%2Flwox1Nk%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6122b5544a744401bef7d51c1c6a66af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377437&amp;x-signature=pod7zyMD9TgvQWGaKumh5zk5gzQ%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3280e3983394980b867955f4533b504~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377437&amp;x-signature=8eMCvLz3XT9wKOPUOHK94NwqrtY%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ce7d0ee34434333996e79532e7775e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377437&amp;x-signature=K9Y8KbRusRtL13LSeh7WB%2BGMmsw%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8243866ccc5846c0aed2a34d3fa33790~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377437&amp;x-signature=wECpmBxqm8xuaxuy8RHRDz7jOGc%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f30296b42354f5eaca9bca73088e4f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765377437&amp;x-signature=IC09GZS5YOnSGETZIYfLtA2eLSs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-5">基于大数据的青少年抑郁症风险数据分析可视化系统-代码展示</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 初始化SparkSession，这是所有Spark功能的入口点</span>
spark = SparkSession.builder.appName(<span class="hljs-string">"YouthDepressionAnalysis"</span>).getOrCreate()

<span class="hljs-comment"># 功能一：抑郁程度总体分布分析</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_overall_depression_distribution</span>():
    <span class="hljs-comment"># 读取CSV文件，Spark可以自动推断schema</span>
    df = spark.read.csv(<span class="hljs-string">"path/to/youth_risk_depression_dataset.csv"</span>, header=<span class="hljs-literal">True</span>, inferSchema=<span class="hljs-literal">True</span>)
    <span class="hljs-comment"># 按抑郁严重程度分组并计算每组的数量</span>
    distribution_df = df.groupBy(<span class="hljs-string">"depression_severity"</span>).count()
    <span class="hljs-comment"># 为了方便计算占比，我们获取总人数</span>
    total_count = df.count()
    <span class="hljs-comment"># 添加一个新列"percentage"，计算每个抑郁等级的人数占比</span>
    distribution_with_percentage = distribution_df.withColumn(<span class="hljs-string">"percentage"</span>, (col(<span class="hljs-string">"count"</span>) / total_count) * <span class="hljs-number">100</span>)
    <span class="hljs-comment"># 将结果转换为Pandas DataFrame以便前端或进一步处理</span>
    result_pd = distribution_with_percentage.toPandas()
    <span class="hljs-comment"># 返回处理后的结果</span>
    <span class="hljs-keyword">return</span> result_pd

<span class="hljs-comment"># 功能二：不同年龄段的抑郁程度对比分析</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_depression_by_age_group</span>():
    df = spark.read.csv(<span class="hljs-string">"path/to/youth_risk_depression_dataset.csv"</span>, header=<span class="hljs-literal">True</span>, inferSchema=<span class="hljs-literal">True</span>)
    <span class="hljs-comment"># 使用when函数创建一个新的"age_group"列，将年龄划分为几个区间</span>
    df_with_age_group = df.withColumn(<span class="hljs-string">"age_group"</span>,
                                     when(col(<span class="hljs-string">"age"</span>) &lt; <span class="hljs-number">19</span>, <span class="hljs-string">"16-18岁"</span>)
                                     .when((col(<span class="hljs-string">"age"</span>) &gt;= <span class="hljs-number">19</span>) &amp; (col(<span class="hljs-string">"age"</span>) &lt; <span class="hljs-number">23</span>), <span class="hljs-string">"19-22岁"</span>)
                                     .otherwise(<span class="hljs-string">"23-25岁"</span>))
    <span class="hljs-comment"># 按年龄组和抑郁严重程度进行分组，计算每个组合的人数</span>
    age_depression_df = df_with_age_group.groupBy(<span class="hljs-string">"age_group"</span>, <span class="hljs-string">"depression_severity"</span>).count()
    <span class="hljs-comment"># 按年龄组进行分区，并在每个组内按抑郁严重程度排序，以便前端构建堆叠柱状图</span>
    <span class="hljs-comment"># 这里使用窗口函数来实现</span>
    window_spec = Window.partitionBy(<span class="hljs-string">"age_group"</span>).orderBy(col(<span class="hljs-string">"depression_severity"</span>))
    result_df = age_depression_df.withColumn(<span class="hljs-string">"rank"</span>, rank().over(window_spec))
    result_pd = result_df.toPandas()
    <span class="hljs-keyword">return</span> result_pd

<span class="hljs-comment"># 功能三：社交媒体使用时长与抑郁程度的关联分析</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_social_media_vs_depression</span>():
    df = spark.read.csv(<span class="hljs-string">"path/to/youth_risk_depression_dataset.csv"</span>, header=<span class="hljs-literal">True</span>, inferSchema=<span class="hljs-literal">True</span>)
    <span class="hljs-comment"># 对社交媒体使用时长进行分箱处理，创建一个新的"usage_category"列</span>
    df_with_usage_category = df.withColumn(<span class="hljs-string">"usage_category"</span>,
                                          when(col(<span class="hljs-string">"social_media_hours_per_day"</span>) &lt; <span class="hljs-number">2</span>, <span class="hljs-string">"低使用(&lt;2小时)"</span>)
                                          .when((col(<span class="hljs-string">"social_media_hours_per_day"</span>) &gt;= <span class="hljs-number">2</span>) &amp; (col(<span class="hljs-string">"social_media_hours_per_day"</span>) &lt; <span class="hljs-number">5</span>), <span class="hljs-string">"中使(2-5小时)"</span>)
                                          .otherwise(<span class="hljs-string">"高使用(&gt;5小时)"</span>))
    <span class="hljs-comment"># 过滤掉抑郁程度为"无"的数据，以便更清晰地分析风险因素</span>
    filtered_df = df_with_usage_category.<span class="hljs-built_in">filter</span>(col(<span class="hljs-string">"depression_severity"</span>) != <span class="hljs-string">"None"</span>)
    <span class="hljs-comment"># 按使用类别和抑郁严重程度分组，计算人数</span>
    usage_depression_df = filtered_df.groupBy(<span class="hljs-string">"usage_category"</span>, <span class="hljs-string">"depression_severity"</span>).count()
    <span class="hljs-comment"># 计算每个使用类别下的总人数，用于计算比例</span>
    total_per_usage = usage_depression_df.groupBy(<span class="hljs-string">"usage_category"</span>).agg(<span class="hljs-built_in">sum</span>(<span class="hljs-string">"count"</span>).alias(<span class="hljs-string">"total_in_category"</span>))
    <span class="hljs-comment"># 将两个DataFrame连接起来，以便计算每个抑郁等级在对应使用类别中的占比</span>
    joined_df = usage_depression_df.join(total_per_usage, on=<span class="hljs-string">"usage_category"</span>)
    <span class="hljs-comment"># 计算比例</span>
    result_df = joined_df.withColumn(<span class="hljs-string">"proportion"</span>, col(<span class="hljs-string">"count"</span>) / col(<span class="hljs-string">"total_in_category"</span>))
    result_pd = result_df.toPandas()
    <span class="hljs-keyword">return</span> result_pd
</code></pre>
<h2 data-id="heading-6">基于大数据的青少年抑郁症风险数据分析可视化系统-结语</h2>
<blockquote>
<p>👇🏻 精彩专栏推荐订阅 👇🏻 不然下次找不到哟~</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754938.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754938.html" ref="nofollow noopener noreferrer">Java实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754940.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754940.html" ref="nofollow noopener noreferrer">Python实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754945.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754945.html" ref="nofollow noopener noreferrer">微信小程序|安卓实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754947.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754947.html" ref="nofollow noopener noreferrer">大数据实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754949.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754949.html" ref="nofollow noopener noreferrer">PHP|C#.NET|Golang实战项目</a></p>
<p>🍅 主页获取源码联系🍅</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++ 依赖管理三剑客：vcpkg、Conan、xmake 速查手册]]></title>    <link>https://juejin.cn/post/7579518059170496538</link>    <guid>https://juejin.cn/post/7579518059170496538</guid>    <pubDate>2025-12-03T14:44:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579518059170496538" data-draft-id="7579473409749155891" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++ 依赖管理三剑客：vcpkg、Conan、xmake 速查手册"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-03T14:44:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++ 依赖管理三剑客：vcpkg、Conan、xmake 速查手册
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T14:44:57.000Z" title="Wed Dec 03 2025 14:44:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>如果文章有任何不正确或者你觉得可以补充的建议，欢迎留言，我希望这篇文章可以成为后来人做选择时的速查手册</p>
</blockquote>
<blockquote>
<p>面对复杂的C++依赖，选对工具能让你事半功倍。这份速查手册让你三分钟内找到最适合你的包管理器，并掌握其核心用法。</p>
</blockquote>
<h2 data-id="heading-0">一、快速决策指南</h2>
<h3 data-id="heading-1">1. 我应该选择哪个工具？</h3>
<ul>
<li><strong>选 vcpkg，如果你是</strong>：Windows/Visual Studio 用户，追求与IDE无缝集成，需要简单快速上手。</li>
<li><strong>选 Conan，如果你是</strong>：参与企业级大型项目，依赖关系复杂，需要强大的版本管理和团队协作能力。</li>
<li><strong>选 xmake，如果你是</strong>：国内开发者或学生，追求极简安装和配置，希望避开网络环境问题。</li>
</ul>
<h3 data-id="heading-2">2. 核心对比速览</h3>



































<table><thead><tr><th>维度</th><th>vcpkg (微软)</th><th>Conan (社区)</th><th>xmake (国产)</th></tr></thead><tbody><tr><td><strong>核心理念</strong></td><td>简单集成，开箱即用</td><td>灵活强大，企业级方案</td><td>极简体验，一站解决</td></tr><tr><td><strong>学习曲线</strong></td><td>低</td><td>中高</td><td>极低</td></tr><tr><td><strong>网络友好度</strong></td><td>良（可配镜像）</td><td>良（可配镜像）</td><td><strong>优（内置优化）</strong></td></tr><tr><td><strong>VS集成度</strong></td><td><strong>完美</strong></td><td>良好</td><td>良好</td></tr></tbody></table>
<h2 data-id="heading-3">二、vcpkg 快速上手</h2>
<h3 data-id="heading-4">1. 核心命令速查</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 克隆仓库</span>
git <span class="hljs-built_in">clone</span> https://github.com/microsoft/vcpkg.git
<span class="hljs-built_in">cd</span> vcpkg

<span class="hljs-comment"># 2. 执行引导脚本</span>
<span class="hljs-comment"># Windows:</span>
.\bootstrap-vcpkg.bat
<span class="hljs-comment"># Linux/macOS:</span>
./bootstrap-vcpkg.sh

<span class="hljs-comment"># 3. 安装包</span>
vcpkg install <span class="hljs-built_in">fmt</span> boost

<span class="hljs-comment"># 4. 集成到VS（全局）</span>
vcpkg integrate install

<span class="hljs-comment"># 5. 移除集成</span>
vcpkg integrate remove
</code></pre>
<h3 data-id="heading-5">2. 项目集成示例（CMake）</h3>
<pre><code class="hljs language-cmake" lang="cmake"># CMakeLists.txt 示例
cmake_minimum_required(VERSION 3.10)
project(MyProject)

# 查找包
find_package(fmt REQUIRED)

add_executable(my_app main.cpp)
# 链接库
target_link_libraries(my_app PRIVATE fmt::fmt)
</code></pre>
<p><strong>编译命令</strong>（需传递工具链）：</p>
<pre><code class="hljs language-bash" lang="bash">cmake -B build -S . -DCMAKE_TOOLCHAIN_FILE=[vcpkg-root]/scripts/buildsystems/vcpkg.cmake
cmake --build build
</code></pre>
<h3 data-id="heading-6">3. 实用技巧</h3>
<ul>
<li><strong>镜像加速</strong>：在 <code>vcpkg-configuration.json</code> 中配置清华/中科大镜像</li>
<li><strong>仅安装头文件库</strong>：<code>vcpkg install header-only-library</code></li>
<li><strong>查看已安装包</strong>：<code>vcpkg list</code></li>
</ul>
<h2 data-id="heading-7">三、Conan 核心操作</h2>
<h3 data-id="heading-8">1. 安装与基础配置</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装（Python pip方式）</span>
pip install conan

<span class="hljs-comment"># 生成默认配置</span>
conan profile detect --force

<span class="hljs-comment"># 创建并进入构建目录</span>
<span class="hljs-built_in">mkdir</span> build &amp;&amp; <span class="hljs-built_in">cd</span> build
</code></pre>
<h3 data-id="heading-9">2. 依赖管理流程</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 搜索包</span>
conan search <span class="hljs-built_in">fmt</span> --remote=conancenter

<span class="hljs-comment"># 2. 创建conanfile.txt（或.py用于复杂配置）</span>
<span class="hljs-comment"># conanfile.txt 内容示例：</span>
[requires]
<span class="hljs-built_in">fmt</span>/10.1.1

[generators]
CMakeDeps
CMakeToolchain

<span class="hljs-comment"># 3. 安装依赖</span>
conan install .. --output-folder=. --build=missing

<span class="hljs-comment"># 4. 构建（配合CMake）</span>
cmake .. -DCMAKE_TOOLCHAIN_FILE=conan_toolchain.cmake -DCMAKE_BUILD_TYPE=Release
cmake --build .
</code></pre>
<h3 data-id="heading-10">3. 高级功能速查</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建自己的conan包</span>
conan new hello/1.0 -m=cmake_lib

<span class="hljs-comment"># 本地打包</span>
conan create .

<span class="hljs-comment"># 上传到私有仓库</span>
conan upload hello/1.0 -r=my-remote --all
</code></pre>
<h2 data-id="heading-11">四、xmake 极简工作流</h2>
<h3 data-id="heading-12">1. 安装与项目创建</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 一键安装</span>
curl -fsSL https://xmake.io/shget.text | bash
<span class="hljs-comment"># 或通过其他包管理器安装</span>

<span class="hljs-comment"># 创建新项目</span>
xmake create my_project

<span class="hljs-comment"># 进入项目</span>
<span class="hljs-built_in">cd</span> my_project
</code></pre>
<h3 data-id="heading-13">2. 基础操作命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 添加依赖（编辑xmake.lua或通过命令）</span>
xmake require <span class="hljs-built_in">fmt</span>

<span class="hljs-comment"># 配置项目</span>
xmake config --mode=debug

<span class="hljs-comment"># 构建</span>
xmake

<span class="hljs-comment"># 运行</span>
xmake run

<span class="hljs-comment"># 调试</span>
xmake run -d
</code></pre>
<h3 data-id="heading-14">3. xmake.lua 配置示例</h3>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- xmake.lua 最小示例</span>
add_rules(<span class="hljs-string">"mode.debug"</span>, <span class="hljs-string">"mode.release"</span>)

target(<span class="hljs-string">"my_app"</span>)
    set_kind(<span class="hljs-string">"binary"</span>)
    add_files(<span class="hljs-string">"src/*.cpp"</span>)
    add_packages(<span class="hljs-string">"fmt"</span>, <span class="hljs-string">"spdlog"</span>)
</code></pre>
<h2 data-id="heading-15">五、常见场景解决方案</h2>
<h3 data-id="heading-16">场景1：Windows + Visual Studio 开发</h3>
<p><strong>首选 vcpkg</strong>：</p>
<ol>
<li>安装 vcpkg 并全局集成</li>
<li>在VS中直接 <code>#include &lt;library&gt;</code> 无需额外配置</li>
<li>使用 <code>vcpkg install</code> 安装的库自动对VS可见</li>
</ol>
<h3 data-id="heading-17">场景2：跨平台团队项目</h3>
<p><strong>首选 Conan</strong>：</p>
<ol>
<li>在 <code>conanfile.py</code> 中精确定义依赖版本和配置</li>
<li>使用 <code>conan lock</code> 创建版本锁文件确保一致性</li>
<li>通过 Artifactory 搭建私有仓库，管理内部二进制包</li>
</ol>
<h3 data-id="heading-18">场景3：快速原型/个人项目</h3>
<p><strong>首选 xmake</strong>：</p>
<ol>
<li>一个 <code>xmake.lua</code> 文件统一管理构建和依赖</li>
<li>无需编写复杂的CMakeLists.txt</li>
<li>支持中文错误信息，对新手友好</li>
</ol>
<h3 data-id="heading-19">场景4：已有CMake项目改造</h3>
<p><strong>渐进式方案</strong>：</p>
<ol>
<li><strong>初期</strong>：保留CMake，用 vcpkg 管理依赖（通过工具链集成）</li>
<li><strong>中期</strong>：部分模块使用 Conan 管理，CMake + Conan 混合</li>
<li><strong>长期</strong>：评估是否需要完全迁移到 xmake（需重写构建配置）</li>
</ol>
<h2 data-id="heading-20">六、排错与优化</h2>
<h3 data-id="heading-21">1. 网络问题解决方案</h3>
<p><strong>所有工具通用</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置国内镜像源</span>
<span class="hljs-comment"># vcpkg: 配置 vcpkg-configuration.json</span>
<span class="hljs-comment"># Conan: conan remote add 镜像源</span>
<span class="hljs-comment"># xmake: 默认已优化，也可通过 xmake g --proxy=xxx 配置</span>
</code></pre>
<h3 data-id="heading-22">2. 编译速度优化</h3>
<ul>
<li><strong>vcpkg</strong>：使用 <code>--binarycaching</code> 开启二进制缓存</li>
<li><strong>Conan</strong>：上传二进制包到私有仓库，避免重复编译</li>
<li><strong>xmake</strong>：使用 <code>xmake build --jobs=8</code> 并行编译</li>
</ul>
<h3 data-id="heading-23">3. 常见错误处理</h3>

























<table><thead><tr><th>错误现象</th><th>可能原因</th><th>解决方案</th></tr></thead><tbody><tr><td>找不到包</td><td>拼写错误或版本不存在</td><td>使用工具搜索功能确认包名</td></tr><tr><td>链接错误</td><td>库版本与编译器不兼容</td><td>检查库支持的编译器版本</td></tr><tr><td>CMake找不到包</td><td>工具链未正确传递</td><td>确认 <code>-DCMAKE_TOOLCHAIN_FILE</code> 参数</td></tr></tbody></table>
<h2 data-id="heading-24">七、迁移指南</h2>
<h3 data-id="heading-25">从手动管理迁移</h3>
<ol>
<li><strong>清点现有依赖</strong>：整理所有第三方库名称、版本、编译选项</li>
<li><strong>选择目标工具</strong>：根据团队情况选择上述任一工具</li>
<li><strong>逐步迁移</strong>：从非关键依赖开始，逐个替换</li>
</ol>
<h3 data-id="heading-26">工具间迁移</h3>




















<table><thead><tr><th>迁移方向</th><th>关键步骤</th><th>注意事项</th></tr></thead><tbody><tr><td><strong>vcpkg → Conan</strong></td><td>1. 创建conanfile<br/>2. 替换CMake集成方式</td><td>注意二进制兼容性和版本差异</td></tr><tr><td><strong>Conan → xmake</strong></td><td>1. 编写xmake.lua<br/>2. 重新配置构建流程</td><td>xmake的包可能比Conan少</td></tr></tbody></table>
<h2 data-id="heading-27">八、进阶资源</h2>
<ul>
<li><strong>vcpkg</strong>：<code>vcpkg export</code> 命令可导出已安装包，便于离线环境使用</li>
<li><strong>Conan</strong>：掌握 <code>conan graph</code> 和 <code>conan info</code> 分析依赖关系</li>
<li><strong>xmake</strong>：探索 <code>xmake package</code> 打包功能和插件系统</li>
</ul>
<hr/>
<p><strong>总结</strong>：没有“最好”的工具，只有“最合适”的工具。对于大多数开发者：</p>
<ul>
<li><strong>日常开发选 vcpkg</strong>，省心省力</li>
<li><strong>复杂项目选 Conan</strong>，可控可管</li>
<li><strong>国内环境选 xmake</strong>，简单直接</li>
</ul>
<p><strong>立即行动建议</strong>：从一个小型测试项目开始，用一天时间分别尝试三个工具的基本流程，亲身感受后做出选择。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Mistral 3 炸场：欧洲 AI 巨头用 Apache 2.0 给闭源模型上了一课]]></title>    <link>https://juejin.cn/post/7579499567868608562</link>    <guid>https://juejin.cn/post/7579499567868608562</guid>    <pubDate>2025-12-03T14:50:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579499567868608562" data-draft-id="7579472170906026034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Mistral 3 炸场：欧洲 AI 巨头用 Apache 2.0 给闭源模型上了一课"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-03T14:50:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Mistral 3 炸场：欧洲 AI 巨头用 Apache 2.0 给闭源模型上了一课
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T14:50:28.000Z" title="Wed Dec 03 2025 14:50:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>就在这周，也就是 2025 年的 12 月初，AI 圈子再次变得热闹非凡。当我们还在讨论几家硅谷巨头谁的闭源 API 更贵时，来自法国的 Mistral AI 直接把桌子掀了。</p>
<p>Mistral 3 系列正式发布。</p>
<p>这一波更新不仅硬核，而且充满了一种久违的极客浪漫主义色彩——全系回归 Apache 2.0 许可。如果你是开发者，看到这里大概已经懂了这意味着什么：自由。没有繁琐的商用限制，拿着这些模型，你想怎么改就怎么改，想怎么用就怎么用。</p>
<p>这次发布的阵容非常有意思，Mistral 似乎看透了现在的 AI 落地痛点，打出了一套“高低搭配”的组合拳。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fasdasf.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/asdasf.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c68d9ad53a504c2fbc5700ace1b2228e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765378227&amp;x-signature=76wtPAYBYjMgnGFVPLM1vZBtJjE%3D" alt="asdasf" loading="lazy"/></a></p>
<p><strong>不仅大，而且还要“大得聪明”</strong></p>
<p>首先登场的是重型武器：Mistral Large 3。</p>
<p>看参数党可能会先被吓一跳：总参数量高达 6750 亿。但别急着担心你的显存，它是经典的稀疏混合专家（MoE）架构。这意味着虽然它脑容量巨大，但每次思考时只动用其中最灵光的 410 亿参数（活跃参数）。</p>
<p>这种设计非常鸡贼，它在保留了万亿级模型那样的广博知识和逻辑深度的同时，把推理成本压到了一个非常可观的水平。加上 256K 的超长上下文，这基本上就是对着 GPT-4o 这种前沿闭源模型去的。而且它原生支持多模态，不论是看图说话还是多语言处理，都不再是英语语境下的“特供版”，对非英语用户相当友好。</p>
<p>在 LMArena 的榜单上，它已经冲到了开源非推理模型的第二把交椅。这说明什么？说明开源和闭源的护城河，又被填平了一截。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fdqwcv-1024x565.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/dqwcv-1024x565.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef292bc991374aa1bb9cac36bab6f64e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765378227&amp;x-signature=79omeeTy6R29tcL%2BxZmcW2BSJhc%3D" alt="dqwcv" loading="lazy"/></a></p>
<p><strong>把 AI 装进你的口袋：Ministral 的野心</strong></p>
<p>如果说 Large 3 是为了秀肌肉，那么 Ministral 3 系列就是为了抢地盘。</p>
<p>这一次，Mistral 居然一口气发了 3B、8B 和 14B 三个尺寸的密集型模型。这显然是冲着“边缘智能”去的。</p>
<p>以前我们总觉得跑个大模型得有张 H100，现在 Mistral 告诉你：不用。你的笔记本电脑、甚至高端手机，就能跑得起来。特别是那个 3B 的版本，简直是为浏览器和 IoT 设备量身定做的。</p>
<p>最关键的是，这些小模型并不“傻”。Mistral 给它们配备了 Base（基础）、Instruct（指令）和 Reasoning（推理）三种变体。在同等性能下，Ministral 生成 token 的数量比对手少了一个数量级。这不仅仅是快，更是省钱。对于那些想把 AI 能力集成到本地应用里的企业来说，这才是真正的杀手锏。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Ffasfgdsg-1024x631.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/fasfgdsg-1024x631.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b16ffb7d84db42388ff57df9cb4ba554~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765378227&amp;x-signature=x1f%2B2fOaOgh9X%2Bc28%2FmFGCFP9K0%3D" alt="fasfgdsg" loading="lazy"/></a></p>
<p><strong>为什么要回归 Apache 2.0？</strong></p>
<p>这次发布最耐人寻味的，其实是那个许可证。</p>
<p>在过去的一年里，很多所谓的“开源”模型其实都加了不少限制条款，变成了“开放权重”而非真正的开源。但 Mistral 这次彻底放开了。</p>
<p>这是一种极其聪明的战略博弈。面对 Google 和 OpenAI 这种构筑高墙的打法，Mistral 选择了发动群众。通过最宽松的 Apache 2.0 协议，它把全球的开发者都拉到了自己的阵营里。你用我的模型赚钱，我不在乎，我只在乎我的生态是不是遍布了从云端到手机的每一个角落。</p>
<p>加上英伟达在背后的全栈支持，从 H200 的训练算力到 TensorRT-LLM 的推理优化，这套组合拳打得非常流畅。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Ffwef-1024x667.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/fwef-1024x667.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee4800340c844756bd6f4b006fe106e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765378227&amp;x-signature=sOjoGTZ93U%2BjuF24hRjK8ZV9mrU%3D" alt="fwef" loading="lazy"/></a></p>
<p><strong>写在最后</strong></p>
<p>Mistral 3 系列的出现，给 2025 年的 AI 结尾战定了一个调子：大模型不仅仅是云端神坛上的神像，它正在变成每个人手中的工具。</p>
<p>无论你是需要在服务器上处理海量多模态数据的企业 CTO，还是想在自己开发的 App 里塞进一个离线智能助手的独立开发者，Mistral 这次都给了你一个无法拒绝的理由。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Frgfgh-1024x849.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/rgfgh-1024x849.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd2a0c70d9894e699fd1726dd648d879~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765378227&amp;x-signature=CD7Dvgdnk41dchA3jgkGf9tpp0o%3D" alt="rgfgh" loading="lazy"/></a></p>
<p>目前模型已经在 Hugging Face 和各大云平台上线，本地跑个 Ollama 就能试用。建议你也去试试，感受一下这股来自欧洲的开源飓风。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++单元测试框架选型与实战速查手册]]></title>    <link>https://juejin.cn/post/7579441333166882825</link>    <guid>https://juejin.cn/post/7579441333166882825</guid>    <pubDate>2025-12-03T15:01:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579441333166882825" data-draft-id="7579473409749270579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++单元测试框架选型与实战速查手册"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-03T15:01:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++单元测试框架选型与实战速查手册
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T15:01:01.000Z" title="Wed Dec 03 2025 15:01:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在C++项目的质量护城河中，单元测试框架的选择如同挑选一把趁手的兵器，它直接决定了测试的效率、可维护性以及与开发流程的契合度。GoogleTest、Catch2和doctest，这三款当今最主流的选择，各有其鲜明的武功路数。本文将为你揭开它们的核心秘籍与实战优劣势，助你一招制胜。</p>
</blockquote>
<h2 data-id="heading-0">一、框架核心价值定位</h2>
<h3 data-id="heading-1">1.1 三大框架战略定位分析</h3>








































<table><thead><tr><th>维度</th><th>GoogleTest (v1.14+)</th><th>Catch2 (v3.5+)</th><th>doctest (v2.4+)</th><th>决策影响</th></tr></thead><tbody><tr><td><strong>哲学定位</strong></td><td>企业级、全覆盖</td><td>现代化、开发者友好</td><td>极简主义、零负担</td><td>决定团队协作模式</td></tr><tr><td><strong>核心优势</strong></td><td>工业级生态系统</td><td>优雅的测试表达</td><td>编译速度优势</td><td>影响开发流程效率</td></tr><tr><td><strong>适用场景</strong></td><td>大型商业项目</td><td>开源库、敏捷项目</td><td>编译敏感型项目</td><td>匹配项目类型关键</td></tr><tr><td><strong>心智模型</strong></td><td>传统xUnit扩展</td><td>BDD与xUnit融合</td><td>最小化测试框架</td><td>影响团队学习曲线</td></tr></tbody></table>
<h3 data-id="heading-2">1.2 性能基准数据对比（基于标准测试套件）</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 基准测试结果摘要（相对值，越低越好）</span>
框架          编译时间   运行开销   内存占用   二进制大小
GoogleTest     <span class="hljs-number">1.00</span>x     <span class="hljs-number">1.00</span>x     <span class="hljs-number">1.00</span>x     <span class="hljs-number">1.00</span><span class="hljs-function">x
<span class="hljs-title">Catch2</span><span class="hljs-params">(v3)</span>     0.85x     0.92x     0.88x     0.75x
doctest        0.35x     0.78x     0.65x     0.45x

<span class="hljs-comment">// 真实世界项目影响示例（10万行代码库）</span>
- GoogleTest: 完整测试构建≈<span class="hljs-number">15</span>分钟，二进制≈<span class="hljs-number">8</span>MB
- doctest:    完整测试构建≈<span class="hljs-number">5</span>分钟，二进制≈<span class="hljs-number">3.5</span>MB
- Catch2(v3): 完整测试构建≈<span class="hljs-number">12</span>分钟，二进制≈<span class="hljs-number">6</span>MB
</span></code></pre>
<h2 data-id="heading-3">二、技术特性深度对比</h2>
<h3 data-id="heading-4">2.1 断言系统设计哲学</h3>
<p><strong>GoogleTest的丰富断言体系</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 分层断言机制</span>
EXPECT_*     <span class="hljs-comment">// 非致命，继续执行（用于收集多个失败）</span>
ASSERT_*     <span class="hljs-comment">// 致命，立即终止当前测试</span>
<span class="hljs-comment">// 数值比较专业化</span>
<span class="hljs-built_in">EXPECT_FLOAT_EQ</span>(<span class="hljs-number">1.0f</span>, <span class="hljs-number">1.001f</span>);      <span class="hljs-comment">// 4ULPs容差</span>
<span class="hljs-built_in">EXPECT_DOUBLE_EQ</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0000001</span>);   <span class="hljs-comment">// 8ULPs容差</span>
<span class="hljs-built_in">EXPECT_NEAR</span>(<span class="hljs-number">3.14</span>, <span class="hljs-number">3.14159</span>, <span class="hljs-number">0.01</span>);   <span class="hljs-comment">// 绝对误差</span>

<span class="hljs-comment">// 现代化表达式匹配器（C++14+）</span>
<span class="hljs-built_in">EXPECT_THAT</span>(result, <span class="hljs-built_in">AllOf</span>(<span class="hljs-built_in">Gt</span>(<span class="hljs-number">0</span>), <span class="hljs-built_in">Lt</span>(<span class="hljs-number">100</span>)));
<span class="hljs-built_in">EXPECT_THAT</span>(container, <span class="hljs-built_in">ElementsAre</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>));
<span class="hljs-built_in">EXPECT_THAT</span>(string, <span class="hljs-built_in">StartsWith</span>(<span class="hljs-string">"prefix"</span>));
</code></pre>
<p><strong>Catch2的表达式模板魔法</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 统一的REQUIRE/CHECK宏处理任意表达式</span>
<span class="hljs-built_in">REQUIRE</span>(<span class="hljs-built_in">compute</span>() == Expected{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>});  <span class="hljs-comment">// 自动分解表达式</span>
<span class="hljs-built_in">CHECK</span>(vector.<span class="hljs-built_in">size</span>() &gt; <span class="hljs-number">0</span> &amp;&amp; !vector.<span class="hljs-built_in">empty</span>());

<span class="hljs-comment">// 自然语言错误消息</span>
<span class="hljs-comment">// 失败时输出："compute() == Expected{1, 2, 3}"</span>
<span class="hljs-comment">//           "实际值: {4, 5, 6}"</span>
</code></pre>
<p><strong>doctest的精简高效设计</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 与Catch2相似但更精简的语法</span>
<span class="hljs-built_in">CHECK</span>(<span class="hljs-built_in">func</span>() == <span class="hljs-number">42</span>);      <span class="hljs-comment">// 非致命</span>
<span class="hljs-built_in">REQUIRE</span>(data.<span class="hljs-built_in">valid</span>());    <span class="hljs-comment">// 致命</span>

<span class="hljs-comment">// 独特的"FAST_CHECK"编译选项</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> DOCTEST_CONFIG_SUPER_FAST_ASSERTS</span>
<span class="hljs-built_in">CHECK_EQ</span>(a, b);  <span class="hljs-comment">// 编译为最简汇编</span>
</code></pre>
<h3 data-id="heading-5">2.2 Mocking能力对比</h3>
<p><strong>GoogleMock的完整解决方案</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"gmock/gmock.h"</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseMock</span> : <span class="hljs-keyword">public</span> DatabaseInterface {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">MOCK_METHOD</span>(User, GetUser, (<span class="hljs-type">int</span> id), (<span class="hljs-keyword">override</span>));
    <span class="hljs-built_in">MOCK_METHOD</span>(<span class="hljs-type">bool</span>, UpdateUser, (<span class="hljs-type">const</span> User&amp;), (<span class="hljs-keyword">override</span>));
};

<span class="hljs-comment">// 期望设置</span>
<span class="hljs-built_in">EXPECT_CALL</span>(db_mock, <span class="hljs-built_in">GetUser</span>(<span class="hljs-number">42</span>))
    .<span class="hljs-built_in">Times</span>(<span class="hljs-number">2</span>)
    .<span class="hljs-built_in">WillOnce</span>(<span class="hljs-built_in">Return</span>(user1))
    .<span class="hljs-built_in">WillOnce</span>(<span class="hljs-built_in">Return</span>(user2));

<span class="hljs-comment">// 参数匹配器</span>
<span class="hljs-built_in">EXPECT_CALL</span>(db_mock, <span class="hljs-built_in">UpdateUser</span>(<span class="hljs-built_in">AllOf</span>(
    <span class="hljs-built_in">Field</span>(&amp;User::id, <span class="hljs-number">42</span>),
    <span class="hljs-built_in">Field</span>(&amp;User::active, <span class="hljs-literal">true</span>)
))).<span class="hljs-built_in">WillRepeatedly</span>(<span class="hljs-built_in">Return</span>(<span class="hljs-literal">true</span>));
</code></pre>
<p><strong>Catch2的第三方集成模式</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 结合Trompeloeil（推荐）</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;catch2/catch.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;trompeloeil.hpp&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MockService</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">MAKE_MOCK1</span>(process, <span class="hljs-built_in">int</span>(std::string));
};

<span class="hljs-comment">// Trompeloeil期望语法</span>
<span class="hljs-built_in">REQUIRE_CALL</span>(mock, <span class="hljs-built_in">process</span>(<span class="hljs-string">"test"</span>))
    .<span class="hljs-built_in">RETURN</span>(<span class="hljs-number">42</span>);

<span class="hljs-comment">// 或使用FakeIt</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fakeit.hpp&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> fakeit;
Mock&lt;Service&gt; mock;
<span class="hljs-built_in">When</span>(<span class="hljs-built_in">Method</span>(mock, execute)).<span class="hljs-built_in">Return</span>(<span class="hljs-number">100</span>);
</code></pre>
<p><strong>doctest的轻量级Mocking</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 通常依赖手动模拟或简单stub</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TestLogger</span> : <span class="hljs-keyword">public</span> ILogger {
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">log</span><span class="hljs-params">(<span class="hljs-type">const</span> string&amp; msg)</span> <span class="hljs-keyword">override</span> </span>{
        last_message = msg;
    }
    string last_message;
};

<span class="hljs-comment">// 或集成nanobench/替代方案</span>
</code></pre>
<h3 data-id="heading-6">2.3 测试组织架构</h3>
<p><strong>GoogleTest的经典夹具模式</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BufferTest</span> : <span class="hljs-keyword">public</span> testing::Test {
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">SetUp</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{ buf.<span class="hljs-built_in">resize</span>(<span class="hljs-number">1024</span>); }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">TearDown</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{ buf.<span class="hljs-built_in">clear</span>(); }
    vector&lt;<span class="hljs-type">char</span>&gt; buf;
};

<span class="hljs-built_in">TEST_F</span>(BufferTest, WriteReadConsistency) {
    <span class="hljs-built_in">writeData</span>(buf.<span class="hljs-built_in">data</span>(), <span class="hljs-string">"test"</span>);
    <span class="hljs-built_in">ASSERT_EQ</span>(<span class="hljs-built_in">readData</span>(buf.<span class="hljs-built_in">data</span>()), <span class="hljs-string">"test"</span>);
}

<span class="hljs-comment">// 类型参数化测试</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TypedTest</span> : <span class="hljs-keyword">public</span> testing::Test {};
<span class="hljs-built_in">TYPED_TEST_SUITE</span>(TypedTest, NumericTypes);
<span class="hljs-built_in">TYPED_TEST</span>(TypedTest, IsArithmetic) {
    TypeParam a = <span class="hljs-number">1</span>, b = <span class="hljs-number">2</span>;
    <span class="hljs-built_in">EXPECT_EQ</span>(a + b, <span class="hljs-number">3</span>);
}
</code></pre>
<p><strong>Catch2的SECTION创新模型</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">TEST_CASE</span>(<span class="hljs-string">"Transaction processing"</span>) {
    <span class="hljs-function">Account <span class="hljs-title">account</span><span class="hljs-params">(<span class="hljs-number">1000</span>)</span></span>;
    
    <span class="hljs-built_in">SECTION</span>(<span class="hljs-string">"Successful deposit"</span>) {
        account.<span class="hljs-built_in">deposit</span>(<span class="hljs-number">500</span>);
        <span class="hljs-built_in">REQUIRE</span>(account.<span class="hljs-built_in">balance</span>() == <span class="hljs-number">1500</span>);
    }
    
    <span class="hljs-built_in">SECTION</span>(<span class="hljs-string">"Failed withdrawal"</span>) {
        <span class="hljs-type">bool</span> success = account.<span class="hljs-built_in">withdraw</span>(<span class="hljs-number">2000</span>);
        <span class="hljs-built_in">REQUIRE_FALSE</span>(success);
        <span class="hljs-built_in">REQUIRE</span>(account.<span class="hljs-built_in">balance</span>() == <span class="hljs-number">1000</span>);
    }
    
    <span class="hljs-comment">// 每个SECTION从初始状态重新执行</span>
    <span class="hljs-comment">// 避免测试间的状态污染</span>
}
</code></pre>
<p><strong>doctest的最小化测试单元</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">TEST_CASE</span>(<span class="hljs-string">"math functions"</span>) {
    <span class="hljs-built_in">SUBCASE</span>(<span class="hljs-string">"addition"</span>) {
        <span class="hljs-built_in">CHECK</span>(<span class="hljs-number">1</span> + <span class="hljs-number">1</span> == <span class="hljs-number">2</span>);
    }
    
    <span class="hljs-built_in">SUBCASE</span>(<span class="hljs-string">"multiplication"</span>) {
        <span class="hljs-built_in">CHECK</span>(<span class="hljs-number">2</span> * <span class="hljs-number">3</span> == <span class="hljs-number">6</span>);
    }
    
    <span class="hljs-comment">// SUBCASE类似SECTION但更轻量</span>
}
</code></pre>
<h2 data-id="heading-7">三、项目集成实战指南</h2>
<h3 data-id="heading-8">3.1 现代CMake集成模板</h3>
<p><strong>GoogleTest集成 (FetchContent)</strong></p>
<pre><code class="hljs language-cmake" lang="cmake"># 推荐：现代FetchContent方式
include(FetchContent)
FetchContent_Declare(
  googletest
  GIT_REPOSITORY https://github.com/google/googletest.git
  GIT_TAG v1.14.0
)
FetchContent_MakeAvailable(googletest)

add_executable(tests
  test_main.cpp
  math_test.cpp
  util_test.cpp
)
target_link_libraries(tests
  GTest::gtest_main
  GTest::gmock  # 如果需要Mocking
)
# 自动发现测试
include(GoogleTest)
gtest_discover_tests(tests)
</code></pre>
<p><strong>Catch2 v3集成 (单头文件模式)</strong></p>
<pre><code class="hljs language-cmake" lang="cmake"># Catch2 v3的CMake配置
find_package(Catch2 3.0 REQUIRED)

# 方式1：单头文件快速开始
add_executable(tests test_main.cpp)
target_link_libraries(tests Catch2::Catch2WithMain)

# 方式2：预编译库提升速度
add_executable(tests test_main.cpp)
target_link_libraries(tests Catch2::Catch2)
# test_main.cpp中定义CATCH_CONFIG_RUNNER

# 测试发现
catch_discover_tests(tests)
</code></pre>
<p><strong>doctest集成 (极简CMake)</strong></p>
<pre><code class="hljs language-cmake" lang="cmake"># 最简单的集成方式
add_executable(tests
  test_main.cpp
  unit_tests.cpp
)
target_include_directories(tests
  PRIVATE
    doctest安装路径或git子模块
)

# 或者使用FetchContent
include(FetchContent)
FetchContent_Declare(
  doctest
  GIT_REPOSITORY https://github.com/doctest/doctest.git
  GIT_TAG v2.4.11
)
FetchContent_MakeAvailable(doctest)
target_link_libraries(tests doctest::doctest)
</code></pre>
<h3 data-id="heading-9">3.2 CI/CD流水线配置</h3>
<p><strong>多框架支持的GitHub Actions模板</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">C++</span> <span class="hljs-string">CI</span>

<span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>, <span class="hljs-string">pull_request</span>]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">strategy:</span>
      <span class="hljs-attr">matrix:</span>
        <span class="hljs-attr">framework:</span> [<span class="hljs-string">googletest</span>, <span class="hljs-string">catch2</span>, <span class="hljs-string">doctest</span>]
        <span class="hljs-attr">os:</span> [<span class="hljs-string">ubuntu-latest</span>, <span class="hljs-string">windows-latest</span>, <span class="hljs-string">macos-latest</span>]
    
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.os</span> <span class="hljs-string">}}</span>
    
    <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.framework</span> <span class="hljs-string">}}</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">|
        if [ "${{ matrix.framework }}" = "googletest" ]; then
          # 安装GoogleTest
        elif [ "${{ matrix.framework }}" = "catch2" ]; then
          # 安装Catch2 v3
        else
          # 安装doctest
        fi
</span>    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">and</span> <span class="hljs-string">Test</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">|
        cmake -B build -DFRAMEWORK=${{ matrix.framework }}
        cmake --build build
        cd build &amp;&amp; ctest --output-on-failure
</span></code></pre>
<h2 data-id="heading-10">四、高级特性与生态对比</h2>
<h3 data-id="heading-11">4.1 特性矩阵深度分析</h3>










































































































































<table><thead><tr><th>特性类别</th><th>GoogleTest</th><th>Catch2</th><th>doctest</th><th>重要性权重</th></tr></thead><tbody><tr><td><strong>核心测试能力</strong></td><td/><td/><td/><td/></tr><tr><td>- 断言系统</td><td>★★★★★</td><td>★★★★☆</td><td>★★★★☆</td><td>10</td></tr><tr><td>- 夹具/固件</td><td>★★★★★</td><td>★★★★☆</td><td>★★★☆☆</td><td>9</td></tr><tr><td>- 参数化测试</td><td>★★★★★</td><td>★★★★☆</td><td>★★☆☆☆</td><td>8</td></tr><tr><td><strong>Mocking支持</strong></td><td/><td/><td/><td/></tr><tr><td>- 原生Mocking</td><td>★★★★★</td><td>★★☆☆☆</td><td>★☆☆☆☆</td><td>9</td></tr><tr><td>- 第三方集成</td><td>★★★☆☆</td><td>★★★★★</td><td>★★★☆☆</td><td>7</td></tr><tr><td><strong>开发者体验</strong></td><td/><td/><td/><td/></tr><tr><td>- 编译速度</td><td>★★☆☆☆</td><td>★★★☆☆</td><td>★★★★★</td><td>8</td></tr><tr><td>- 错误信息可读性</td><td>★★★★☆</td><td>★★★★★</td><td>★★★★☆</td><td>9</td></tr><tr><td>- BDD语法支持</td><td>★★☆☆☆</td><td>★★★★★</td><td>★☆☆☆☆</td><td>6</td></tr><tr><td><strong>企业级特性</strong></td><td/><td/><td/><td/></tr><tr><td>- XML/JSON报告</td><td>★★★★★</td><td>★★★★☆</td><td>★★★☆☆</td><td>8</td></tr><tr><td>- 代码覆盖率集成</td><td>★★★★★</td><td>★★★★☆</td><td>★★★☆☆</td><td>7</td></tr><tr><td>- IDE集成</td><td>★★★★★</td><td>★★★★☆</td><td>★★★☆☆</td><td>8</td></tr><tr><td><strong>二进制影响</strong></td><td/><td/><td/><td/></tr><tr><td>- 最终二进制大小</td><td>★★☆☆☆</td><td>★★★☆☆</td><td>★★★★★</td><td>7</td></tr><tr><td>- 运行时性能</td><td>★★★☆☆</td><td>★★★★☆</td><td>★★★★★</td><td>7</td></tr></tbody></table>
<h3 data-id="heading-12">4.2 真实世界性能基准</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 编译时性能基准（基于实际项目测量）</span>
项目规模       <span class="hljs-function">GoogleTest     <span class="hljs-title">Catch2</span><span class="hljs-params">(v3)</span>      doctest
100测试用例     12.4秒         9.8秒          3.2秒
500测试用例     47.2秒         38.5秒         11.7秒
1000测试用例    102.3秒        85.6秒         24.9秒

<span class="hljs-comment">// 运行时开销（空测试循环10万次）</span>
框架          平均单测试开销   内存增长   启动时间
GoogleTest     1.8μs          +2.1MB    15ms
Catch2         1.2μs          +1.3MB    8ms
doctest        0.7μs          +0.4MB    3ms
</span></code></pre>
<h2 data-id="heading-13">五、决策框架与选型指南</h2>
<h3 data-id="heading-14">5.1 基于项目特征的决策树</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[开始选型] --&gt; B{项目类型?}
    
    B --&gt;|大型企业系统| C[GoogleTest]
    B --&gt;|开源库/现代C++| D{Catch2}
    B --&gt;|性能敏感/嵌入式| E[doctest]
    
    C --&gt; F{需要高级Mocking?}
    F --&gt;|是| G[GoogleTest + GoogleMock]
    F --&gt;|否| H[评估Catch2替代]
    
    D --&gt; I{注重开发体验?}
    I --&gt;|是, 需要BDD| J[Catch2 v3]
    I --&gt;|否, 更重编译速度| K[评估doctest]
    
    E --&gt; L{资源限制严格?}
    L --&gt;|极严格| M[doctest + 自定义最小化]
    L --&gt;|中等| N[评估Catch2 v3单头文件模式]
    
    G --&gt; O[决策: GoogleTest完整套件]
    J --&gt; P[决策: Catch2现代化体验]
    M --&gt; Q[决策: doctest极致轻量]
    
    O --&gt; R[实施建议]
    P --&gt; R
    Q --&gt; R
    
    R --&gt; S[验证: 原型测试验证选择]
</code></pre>
<h3 data-id="heading-15">5.2 分场景推荐配置</h3>
<p><strong>场景1：金融交易系统（高可靠、企业级）</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">推荐框架: GoogleTest + GoogleMock
配置要点:
<span class="hljs-bullet">1.</span> 启用死亡测试验证异常处理
<span class="hljs-bullet">2.</span> 使用值参数化测试覆盖边界条件
<span class="hljs-bullet">3.</span> 集成XML报告与CI系统对接
<span class="hljs-bullet">4.</span> 结合gcov/lcov生成覆盖率报告
附加工具: 
<span class="hljs-bullet">-</span> gtest-parallel: 并行执行加速
<span class="hljs-bullet">-</span> benchpress: 性能回归测试
</code></pre>
<p><strong>场景2：游戏引擎组件（高性能、跨平台）</strong></p>
<pre><code class="hljs language-diff" lang="diff">推荐框架: Catch2 v3 + Trompeloeil
配置要点:
1. 启用CATCH_CONFIG_FAST_COMPILE加速
2. 使用BDD风格编写物理引擎测试
3. 集成自定义报告器输出到引擎编辑器
4. 配置不同的编译选项(Debug/Release)
优势:
<span class="hljs-deletion">- 单头文件简化跨平台构建</span>
<span class="hljs-deletion">- 优秀的浮点数比较支持</span>
<span class="hljs-deletion">- 与游戏引擎脚本系统良好集成</span>
</code></pre>
<p><strong>场景3：嵌入式通信协议栈（资源受限）</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">推荐框架: doctest (自定义精简版)
配置要点:
<span class="hljs-bullet">1.</span> 定义DOCTEST<span class="hljs-emphasis">_CONFIG_</span>DISABLE禁用不需要的功能
<span class="hljs-bullet">2.</span> 使用最小的断言子集
<span class="hljs-bullet">3.</span> 实现自定义输出到串口/日志系统
<span class="hljs-bullet">4.</span> 内存池分配器替代动态内存
优化手段:
<span class="hljs-bullet">-</span> 编译时过滤不需要的测试用例
<span class="hljs-bullet">-</span> 静态分配测试结果缓冲区
<span class="hljs-bullet">-</span> 禁用异常处理(RTTI)
</code></pre>
<p><strong>场景4：科研计算库（快速迭代、学术用途）</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">混合策略: doctest + GoogleTest</span>
<span class="hljs-section">日常开发: 使用doctest快速验证算法正确性</span>
<span class="hljs-section">CI/CD流水线: 使用GoogleTest进行完整验证</span>
<span class="hljs-section">配置要点:</span>
1. 保持测试接口兼容两个框架
2. doctest用于快速原型迭代
3. GoogleTest用于发布前的全面验证
<span class="hljs-section">工具链:</span>
- 使用Python脚本转换测试用例
- 配置不同的CMake构建目标
</code></pre>
<h3 data-id="heading-16">5.3 迁移策略与兼容层</h3>
<p><strong>从GoogleTest迁移到Catch2</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 兼容层头文件 (gtest_compat.h)</span>
<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span>

<span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> MIGRATING_TO_CATCH2</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;catch2/catch_all.hpp&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> TEST(test_suite, test_name) \
    TEST_CASE(#test_suite <span class="hljs-string">"."</span> #test_name)</span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> EXPECT_TRUE(cond) REQUIRE(cond)</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> EXPECT_EQ(a, b) REQUIRE((a) == (b))</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> EXPECT_NEAR(a, b, eps) REQUIRE(std::abs((a)-(b)) &lt;= (eps))</span>

<span class="hljs-comment">// 简化版的夹具模拟</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TestFixture</span> {
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SetUp</span><span class="hljs-params">()</span> </span>{}
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">TearDown</span><span class="hljs-params">()</span> </span>{}
};

<span class="hljs-meta">#<span class="hljs-keyword">define</span> TEST_F(fixture, test_name) \
    TEST_CASE(#fixture <span class="hljs-string">"."</span> #test_name) { \
        fixture f; \
        f.SetUp(); \
        <span class="hljs-comment">/* 测试代码 */</span> \
        f.TearDown(); \
    }</span>
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<h2 data-id="heading-17">六、最佳实践与高级模式</h2>
<h3 data-id="heading-18">6.1 现代C++测试模式</h3>
<p><strong>基于概念的模板测试（C++20）</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// GoogleTest + C++20概念</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">concept</span> Numeric = std::integral&lt;T&gt; || std::floating_point&lt;T&gt;;

<span class="hljs-keyword">template</span>&lt;Numeric T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NumericAlgorithmTest</span> : <span class="hljs-keyword">public</span> testing::Test {};

<span class="hljs-built_in">TYPED_TEST_SUITE</span>(NumericAlgorithmTest, NumericTypes);

<span class="hljs-built_in">TYPED_TEST</span>(NumericAlgorithmTest, CommutativeProperty) {
    TypeParam a = <span class="hljs-number">1</span>, b = <span class="hljs-number">2</span>;
    <span class="hljs-built_in">EXPECT_EQ</span>(<span class="hljs-built_in">add</span>(a, b), <span class="hljs-built_in">add</span>(b, a));
}
</code></pre>
<p><strong>编译时测试验证（doctest特化）</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 利用doctest的快速编译做编译时测试</span>
<span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> <span class="hljs-title">factorial</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> </span>{
    <span class="hljs-keyword">return</span> n &lt;= <span class="hljs-number">1</span> ? <span class="hljs-number">1</span> : n * <span class="hljs-built_in">factorial</span>(n - <span class="hljs-number">1</span>);
}

<span class="hljs-built_in">TEST_CASE</span>(<span class="hljs-string">"compile-time factorial"</span>) {
    <span class="hljs-comment">// 编译时验证</span>
    <span class="hljs-built_in">static_assert</span>(<span class="hljs-built_in">factorial</span>(<span class="hljs-number">5</span>) == <span class="hljs-number">120</span>);
    
    <span class="hljs-comment">// 运行时验证</span>
    <span class="hljs-built_in">REQUIRE</span>(<span class="hljs-built_in">factorial</span>(<span class="hljs-number">5</span>) == <span class="hljs-number">120</span>);
}
</code></pre>
<h3 data-id="heading-19">6.2 性能敏感测试策略</h3>
<p><strong>微基准测试集成</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// Catch2 + 微基准测试</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;catch2/catch_test_macros.hpp&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;catch2/benchmark/catch_benchmark.hpp&gt;</span></span>

<span class="hljs-built_in">TEST_CASE</span>(<span class="hljs-string">"Performance critical path"</span>) {
    <span class="hljs-function">Vector3D <span class="hljs-title">v1</span><span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)</span>, <span class="hljs-title">v2</span><span class="hljs-params">(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)</span></span>;
    
    <span class="hljs-built_in">BENCHMARK</span>(<span class="hljs-string">"dot product"</span>) {
        <span class="hljs-keyword">return</span> v1.<span class="hljs-built_in">dot</span>(v2);
    };
    
    <span class="hljs-built_in">BENCHMARK</span>(<span class="hljs-string">"cross product"</span>) {
        <span class="hljs-keyword">return</span> v1.<span class="hljs-built_in">cross</span>(v2);
    };
    
    <span class="hljs-comment">// 断言性能要求</span>
    <span class="hljs-built_in">REQUIRE</span>(<span class="hljs-built_in">BENCHMARK</span>(<span class="hljs-string">"normalize"</span>) {
        <span class="hljs-keyword">return</span> v1.<span class="hljs-built_in">normalized</span>();
    }.<span class="hljs-built_in">iterations</span>(<span class="hljs-number">1000</span>) &lt; <span class="hljs-number">50</span>ms);
}
</code></pre>
<h2 data-id="heading-20">七、决策检查清单</h2>
<h3 data-id="heading-21">✅ 选择GoogleTest当：</h3>
<ol>
<li>项目需要企业级支持与长期稳定性</li>
<li>必须使用原生Mocking功能</li>
<li>与现有Google生态集成（Protobuf、Abseil等）</li>
<li>需要完整的测试报告与CI集成</li>
<li>团队熟悉传统xUnit模式</li>
</ol>
<h3 data-id="heading-22">✅ 选择Catch2当：</h3>
<ol>
<li>追求现代化、表达性强的测试语法</li>
<li>需要优秀的BDD支持提升可读性</li>
<li>单头文件部署简化依赖管理</li>
<li>注重开发者体验与错误信息质量</li>
<li>项目使用现代C++（14/17/20）特性</li>
</ol>
<h3 data-id="heading-23">✅ 选择doctest当：</h3>
<ol>
<li>编译时间是最重要的考量因素</li>
<li>目标环境资源严重受限（嵌入式）</li>
<li>测试需要极低的内存与二进制开销</li>
<li>希望测试代码对生产代码零侵入</li>
<li>项目需要极简的集成与配置</li>
</ol>
<h3 data-id="heading-24">⚠️ 警告信号（重新评估选择）：</h3>
<ol>
<li>测试编译时间超过实际开发时间30%</li>
<li>Mocking需求频繁但框架支持不足</li>
<li>测试二进制大小影响部署流程</li>
<li>团队对新框架学习成本影响进度</li>
<li>缺少关键生态系统工具支持</li>
</ol>
<hr/>
<p><strong>最终建议</strong>：在关键项目决策前，使用每个框架为项目的<strong>一个代表性模块</strong>编写测试。通过实际体验的客观数据（编译时间、运行时性能、代码可维护性）结合团队的主观偏好，做出平衡技术与人力的最终决策。三个框架都活跃维护，选择后均可获得良好的长期支持。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot + nmap4j 获取端口信息]]></title>    <link>https://juejin.cn/post/7579511463053230099</link>    <guid>https://juejin.cn/post/7579511463053230099</guid>    <pubDate>2025-12-03T13:25:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579511463053230099" data-draft-id="7579450578294325290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot + nmap4j 获取端口信息"/> <meta itemprop="keywords" content="Spring Boot"/> <meta itemprop="datePublished" content="2025-12-03T13:25:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="皮皮林551"/> <meta itemprop="url" content="https://juejin.cn/user/2447981921436084"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot + nmap4j 获取端口信息
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2447981921436084/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    皮皮林551
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T13:25:51.000Z" title="Wed Dec 03 2025 13:25:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><ul>
<li>序言</li>
<li>nmap4j</li>
<li>
<ul>
<li>代码说明</li>
</ul>
</li>
<li>补充</li>
<li>总结</li>
</ul>
<hr/>
<h2 data-id="heading-0"><strong>序言</strong></h2>
<p>今天在工作的时候，领导突然安排和我说一个需求，就是根据一个 ip 和 端口去获取对应服务上对应端口的信息，当时主要是为了确定数据库的版本和型号，比如 MySQL、Oracle 这些数据库，我后面尝试发现其他端口也可以获取信息。</p>
<p>这个在公司里之前是通过 python 来写的，python 里面刚好有这个模块，但是 Java 没有，所以写这篇文章记录一下，帮助大家以后避免踩坑。</p>
<p>代码已经提交到了我的GitHub：</p>
<blockquote>
<p>“</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmaoshengyzx%2FSpringBoot" target="_blank" title="https://github.com/maoshengyzx/SpringBoot" ref="nofollow noopener noreferrer">github.com/maoshengyzx…</a></p>
</blockquote>
<h2 data-id="heading-1"><strong>nmap4j</strong></h2>
<p>nmap4j 是一个用于 Java 语言的 Nmap 端口扫描器的包装库，它允许 Java 开发者在自己的项目中方便地调用 Nmap 的功能进行网络扫描和探测。</p>
<p>GitHub地址:</p>
<blockquote>
<p>“</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnarkisr%2Fnmap4j" target="_blank" title="https://github.com/narkisr/nmap4j" ref="nofollow noopener noreferrer">github.com/narkisr/nma…</a></p>
</blockquote>
<p>在运行这个代码之前，我们是需要下载 nmap 的可执行文件，地址为：</p>
<blockquote>
<p>“</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fnmap.org%2Fdownload.html%255B%255B%23windows%255D()%255D(javascript" target="_blank" title="https://nmap.org/download.html%5B%5B#windows%5D()%5D(javascript" ref="nofollow noopener noreferrer">nmap.org/download.ht…</a>:;)</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ca14facd63f4203beee7a9d315cf5b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373151&amp;x-signature=lXI68tWpQ4VRIwI7TksPmbAlhtE%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<p>这里下载第一个，下载后安装就行了。</p>
<h3 data-id="heading-2">代码说明</h3>
<p>接下来和大家说一下 nmap4j 中的测试代码，这里面有个坑，我当时找了好久，代码在 <code>test/org/nmap4j/Nmap4jTest.java</code></p>
<pre><code class="hljs language-scss" lang="scss">public class Nmap4jTest {
<span class="hljs-keyword">@Test</span>
public void basicNmap4jUsageTest() {

try {
               <span class="hljs-comment">// 这里的路径要改为刚才 nmap 软件的安装路径</span>
   String path = "/usr/local" ;
   
   Nmap4j nmap4j = new <span class="hljs-built_in">Nmap4j</span>( path ) ;
               <span class="hljs-comment">// 这地方使用了 -oX 后面要跟文件名称</span>
   nmap4j<span class="hljs-selector-class">.addFlags</span>( "-sV -T5 -O -oX -" ) ;
   nmap4j<span class="hljs-selector-class">.includeHosts</span>( "localhost" ) ;
   nmap4j<span class="hljs-selector-class">.execute</span>() ;
   <span class="hljs-built_in">if</span>( !nmap4j.hasError() ) {
                        
    NMapRun nmapRun = nmap4j<span class="hljs-selector-class">.getResult</span>() ;  <span class="hljs-comment">// 这一行一定要注释掉，不然会一直报错</span>
    String output = nmap4j<span class="hljs-selector-class">.getOutput</span>() ;  <span class="hljs-comment">// 这一样代码意义也不大，我直接删掉了</span>
    <span class="hljs-built_in">if</span>( output == null ) {
     <span class="hljs-built_in">fail</span>() ;
    }
    String errors = nmap4j<span class="hljs-selector-class">.getExecutionResults</span>()<span class="hljs-selector-class">.getErrors</span>() ;
    if (errors == null ) {
     <span class="hljs-built_in">fail</span>() ;
    }
   }
  } catch (NMapInitializationException e) {
   <span class="hljs-comment">// TODO Auto-generated catch block</span>
   e<span class="hljs-selector-class">.printStackTrace</span>();
   <span class="hljs-built_in">fail</span>() ;
  } catch (NMapExecutionException e) {
   <span class="hljs-comment">// TODO Auto-generated catch block</span>
   e<span class="hljs-selector-class">.printStackTrace</span>();
   <span class="hljs-built_in">fail</span>() ;
  }

 }

}
</code></pre>
<h4 data-id="heading-3">参数说明：</h4>
<p><strong>目标选择参数:</strong></p>
<ul>
<li><strong><code>-iL</code>：</strong>  从文件中读取扫描目标列表。例如，<code>nmap -iL targets.txt</code>，会从<code>targets.txt</code>文件中读取每行一个的 IP 地址或域名作为扫描目标。</li>
<li><strong><code>-iR</code>：</strong>  随机选择指定数量的主机进行扫描。如<code>nmap -iR 100</code>，会随机选取 100 个主机进行扫描。</li>
<li><strong><code>--exclude &lt;host1[,host2,...]&gt;</code>：</strong>  排除指定的主机或网络不进行扫描。例如，<code>nmap 192.168.1.0/24 --exclude 192.168.1.100,192.168.1.200</code>，将扫描<code>192.168.1.0/24</code>网段，但排除<code>192.168.1.100</code>和<code>192.168.1.200</code>这两台主机。</li>
<li><strong><code>--excludefile &lt;exclude_file&gt;</code>：</strong>  从文件中读取要排除的主机或网络列表。</li>
</ul>
<p><strong>扫描类型参数：</strong></p>
<ul>
<li><strong><code>-sS</code>：</strong>  TCP SYN 扫描，也称为半开放扫描。它发送 SYN 包到目标端口，如果收到 <code>SYN/ACK</code> 响应，就表示端口开放；如果收到 RST 响应，则表示端口关闭。这种扫描方式速度快，且不容易被目标系统记录，相对隐蔽，例如<code>nmap -sS 192.168.1.100</code>。</li>
<li><strong><code>-sT</code>：</strong>  TCP 连接扫描，通过完整的 TCP 三次握手来确定端口是否开放。这种扫描方式最准确，但也最容易被检测到，如<code>nmap -sT 192.168.1.100</code>。</li>
<li><strong><code>-sU</code>：</strong>  UDP 扫描，用于检测目标主机上的 UDP 端口是否开放。因为 UDP 是无连接协议，所以判断端口状态相对复杂，<code>nmap -sU 192.168.1.100</code>可对指定主机进行 UDP 扫描。</li>
<li><strong><code>-sF、-sX、-sN</code>：</strong>  分别是 FIN 扫描、XMAS 扫描和 NULL 扫描。这些扫描方式通过发送特殊标志位的 TCP 包来判断端口状态，常用于绕过一些简单的防火墙检测。</li>
</ul>
<p><strong>端口指定参数：</strong></p>
<ul>
<li><strong><code>-p</code>：</strong>  指定要扫描的端口范围。可以是单个端口，如<code>-p 80</code>；也可以是多个端口，如<code>-p 80,443,8080</code>；还可以是端口范围，如<code>-p 1-1000</code>表示扫描 1 到 1000 号端口。</li>
<li><strong><code>--top-ports</code>：</strong>  扫描最常用的指定数量的端口。例如，<code>nmap --top-ports 100 192.168.1.100</code>会扫描目标主机上最常用的 100 个端口。</li>
<li><strong><code>-F</code>：</strong>  快速扫描模式，只扫描一些常见的端口，相当于<code>-p 1-1024</code>加上一些其他常用端口。</li>
</ul>
<p><strong>服务探测参数：</strong></p>
<ul>
<li><strong><code>-sV</code>：</strong>  启用服务版本探测，尝试确定目标主机上运行的服务及其版本信息。例如，<code>nmap -sV 192.168.1.100</code>可以扫描出目标主机开放端口上运行的服务名称和版本号。</li>
<li><strong><code>--version-intensity</code>：</strong>  设置服务版本探测的强度，级别越高，探测越全面，但耗时也越长，取值范围是 0 到 9。</li>
</ul>
<p><strong>操作系统探测参数：</strong></p>
<ul>
<li><strong><code>-O</code>：</strong>  启用操作系统探测，尝试识别目标主机的操作系统类型和版本。如<code>nmap -O 192.168.1.100</code>。</li>
<li><strong><code>--osscan-limit</code>：</strong>  限制操作系统探测只对可能的目标进行，这样可以加快扫描速度，但可能会降低准确性。</li>
<li><strong><code>--osscan-guess</code>：</strong>  更积极地猜测操作系统类型，当 Nmap 不确定时会给出更宽泛的猜测结果。</li>
</ul>
<p><strong>输出参数：</strong></p>
<ul>
<li><strong><code>-oN</code>：</strong>  将扫描结果以正常格式保存到指定文件。例如，<code>nmap -oN scan_results.txt 192.168.1.100</code>会把扫描结果保存到scan_results.txt文件中。</li>
<li><strong><code>-oX</code>：</strong>  将扫描结果以 XML 格式保存到指定文件，方便后续使用脚本或其他工具进行解析和处理。</li>
<li><strong><code>-oG</code>：</strong>  将扫描结果以 Grep 格式保存，这种格式便于使用文本处理工具进行分析。</li>
<li><strong><code>-oA</code>：</strong>  以多种格式（包括正常、XML 和 Grep 格式）保存扫描结果，文件名为指定的基本名称加上相应的扩展名。</li>
<li><strong><code>-v</code>：</strong>  详细输出模式，显示更多的扫描过程信息，如发送的数据包、收到的响应等。使用多个v可以增加详细程度，如<code>-vv</code>、<code>-vvv</code>。</li>
</ul>
<p>这里给大家看一下改造后的代码：</p>
<pre><code class="hljs language-ini" lang="ini">/**
 * 使用 nmap4j 工具进行扫描
 *
 * @param ip    目标 ip
 * @param ports 目标端口
 * @return 端口信息列表
 */
@RequestMapping("/querydb")
public List&lt;NmapPortInfo&gt; querydb(@RequestParam(<span class="hljs-attr">value</span> = <span class="hljs-string">"ip"</span>) String ip, @RequestParam(<span class="hljs-string">"ports"</span>) List&lt;String&gt; ports) {
    ArrayList&lt;NmapPortInfo&gt; <span class="hljs-attr">portInfos</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
    // 1.拼接端口
    String <span class="hljs-attr">portStr</span> = StrUtil.join(<span class="hljs-string">","</span>, ports)<span class="hljs-comment">;</span>
    //2. 指定 nmap 路径
    String <span class="hljs-attr">path</span> = <span class="hljs-string">"D:/StudyApps/nmap"</span><span class="hljs-comment">;</span>
    String <span class="hljs-attr">fileName</span> = <span class="hljs-string">"temp_result.xml"</span><span class="hljs-comment">;</span>

    Nmap4j <span class="hljs-attr">nmap4j</span> = new Nmap4j(path)<span class="hljs-comment">;</span>

    //3.读取端口耗时较长，可以使用异步
    CompletableFuture&lt;Void&gt; <span class="hljs-attr">future</span> = CompletableFuture.runAsync(() -&gt; {
        nmap4j.addFlags("-sV -p " + portStr + " -T5 -O -oX " + fileName)<span class="hljs-comment">;</span>
        nmap4j.includeHosts(ip)<span class="hljs-comment">;</span>
        try {
            nmap4j.execute()<span class="hljs-comment">;</span>
        } catch (Exception e) {
            thrownew RuntimeException(e)<span class="hljs-comment">;</span>
        }
    }, threadPoolExecutor)<span class="hljs-comment">;</span>

    future.join()<span class="hljs-comment">;</span>

    //4. 获取端口信息
    return getPortInfo(portInfos, fileName)<span class="hljs-comment">;</span>
}
/**
     * 获取 ip + 端口信息,封装为集合返回前端
     *
     * @param portInfos 返回前端集合
     * @param fileName  临时的 xml 文件
     * @return 信息列表
     */
    @SneakyThrows
    private List&lt;NmapPortInfo&gt; getPortInfo(List&lt;NmapPortInfo&gt; portInfos, String fileName) {
        // 获取项目所在路径
        String <span class="hljs-attr">projectPath</span> = System.getProperty(<span class="hljs-string">"user.dir"</span>)<span class="hljs-comment">;</span>
        // 拼接文件路径
        String <span class="hljs-attr">filePath</span> = projectPath + FileUtil.FILE_SEPARATOR + fileName<span class="hljs-comment">;</span>
        log.info("文件路径：{}", filePath)<span class="hljs-comment">;</span>

        // nmap 返回 xml 格式固定，使用 dom4j 解析
        SAXReader <span class="hljs-attr">reader</span> = new SAXReader()<span class="hljs-comment">;</span>
        org.dom4j.Document <span class="hljs-attr">document</span> = reader.read(FileUtil.file(filePath))<span class="hljs-comment">;</span>
        org.dom4j.Element <span class="hljs-attr">rootElement</span> = document.getRootElement()<span class="hljs-comment">;</span>
        org.dom4j.Element <span class="hljs-attr">element</span> = rootElement.element(<span class="hljs-string">"host"</span>)<span class="hljs-comment">;</span>

        org.dom4j.Element <span class="hljs-attr">xmlPorts</span> = element.element(<span class="hljs-string">"ports"</span>)<span class="hljs-comment">;</span>

        List&lt;org.dom4j.Element&gt; <span class="hljs-attr">port</span> = xmlPorts.elements(<span class="hljs-string">"port"</span>)<span class="hljs-comment">;</span>
        for (org.dom4j.Element port1 : port) {
            Element <span class="hljs-attr">service</span> = port1.element(<span class="hljs-string">"service"</span>)<span class="hljs-comment">;</span>
            String <span class="hljs-attr">product</span> = service.attributeValue(<span class="hljs-string">"product"</span>)<span class="hljs-comment">;</span>
            String <span class="hljs-attr">version</span> = service.attributeValue(<span class="hljs-string">"version"</span>)<span class="hljs-comment">;</span>
            NmapPortInfo <span class="hljs-attr">nmapPortInfo</span> = new NmapPortInfo(product, version)<span class="hljs-comment">;</span>
            portInfos.add(nmapPortInfo)<span class="hljs-comment">;</span>
        }

        // 删除临时文件
        FileUtil.del(filePath)<span class="hljs-comment">;</span>
        return portInfos<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>我这里就是没有去按照官网上的写法，我的思路是文件已经下载了我直接去读取 xml 文件解决会更快，这里是使用 dom4j 来读取的 xml 文件。代码就这么多，最后请求是可以获取到数据的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84f58cc774ce46be9611f1a2eeebbf3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55qu55qu5p6XNTUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373151&amp;x-signature=BpUqfOJE9cdQQU2gOEVerYzP7oE%3D" alt="图片" loading="lazy"/></p>
<p>图片</p>
<h2 data-id="heading-4"><strong>补充</strong></h2>
<p>由于这段代码是在windows上运行的，而在实际的环境中项目都会部署到 Linux 环境汇总，所以我不得不在 Linux 上去运行调试这段代码。代码如下：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">/**
 * 使用 nmap4j 工具进行扫描, linux系统
 *
 * @param ip    目标 ip
 * @param ports 目标端口
 * @return 端口信息列表
 */</span>
<span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/linux/querydb"</span>)
<span class="hljs-variable">@SneakyThrows</span>
public List&lt;NmapPortInfo&gt; <span class="hljs-built_in">linuxQuerydb</span>(<span class="hljs-variable">@RequestParam</span>(value = <span class="hljs-string">"ip"</span>) String ip, <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"ports"</span>) List&lt;String&gt; ports) {
    <span class="hljs-selector-tag">ArrayList</span>&lt;<span class="hljs-selector-tag">NmapPortInfo</span>&gt; <span class="hljs-selector-tag">portInfos</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">ArrayList</span>&lt;&gt;();
    <span class="hljs-comment">// 1.拼接端口</span>
    <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">portStr</span> = <span class="hljs-selector-tag">StrUtil</span><span class="hljs-selector-class">.join</span>(<span class="hljs-string">","</span>, ports);
    <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">fileName</span> = "<span class="hljs-selector-tag">temp_result</span><span class="hljs-selector-class">.xml</span>";
    <span class="hljs-comment">//2. linux namp 命令</span>
    <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">nmapCommand</span> = "<span class="hljs-selector-tag">nmap</span> <span class="hljs-selector-tag">-sV</span> <span class="hljs-selector-tag">-p</span> " + <span class="hljs-selector-tag">portStr</span> + " <span class="hljs-selector-tag">-T5</span> <span class="hljs-selector-tag">-O</span> <span class="hljs-selector-tag">-oX</span> " + <span class="hljs-selector-tag">fileName</span> + " " + <span class="hljs-selector-tag">ip</span>;

    <span class="hljs-comment">//3. 读取端口耗时较长，可以使用异步</span>
    <span class="hljs-selector-tag">CompletableFuture</span>&lt;<span class="hljs-selector-tag">Void</span>&gt; <span class="hljs-selector-tag">future</span> = <span class="hljs-selector-tag">CompletableFuture</span><span class="hljs-selector-class">.runAsync</span>(() -&gt; {
        <span class="hljs-selector-tag">Process</span> <span class="hljs-selector-tag">nampProcess</span> = <span class="hljs-selector-tag">null</span>;
        <span class="hljs-selector-tag">try</span> {
            <span class="hljs-comment">// 3. 运行命令</span>
            <span class="hljs-selector-tag">nampProcess</span> = <span class="hljs-selector-tag">Runtime</span><span class="hljs-selector-class">.getRuntime</span>()<span class="hljs-selector-class">.exec</span>(nmapCommand);
            <span class="hljs-comment">// 4. 等待命令执行完成</span>
            <span class="hljs-selector-tag">nampProcess</span><span class="hljs-selector-class">.waitFor</span>();
        } <span class="hljs-selector-tag">catch</span> (Exception e) {
            <span class="hljs-selector-tag">thrownew</span> <span class="hljs-selector-tag">RuntimeException</span>(e);
        }
    }, <span class="hljs-selector-tag">threadPoolExecutor</span>);

    <span class="hljs-selector-tag">future</span><span class="hljs-selector-class">.join</span>();

    <span class="hljs-comment">// 5. 获取端口信息</span>
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">getPortInfo</span>(portInfos, fileName);
}
</code></pre>
<p>这里的初步思路是直接调用 Linux 的命令执行 nmap (Linux系统中必须下载 nmap)。至于下载这里就不多说了，大家只需要注意下载的版本最好也为 7.95，其他版本下载的 xml 文件有问题，无法解析。</p>
<h2 data-id="heading-5"><strong>总结</strong></h2>
<p>忘记和大家说了，nmap4j 在maven仓库是搜不到的，所以只通过 jar 包的方式来引入，地址为：</p>
<blockquote>
<p>“</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmaster.dl.sourceforge.net%2Fproject%2Fnmap4j%2F1.1.0%2Forg.nmap4j-1.1.0-RELEASE.zip%3Fviasf%3D1" target="_blank" title="https://master.dl.sourceforge.net/project/nmap4j/1.1.0/org.nmap4j-1.1.0-RELEASE.zip?viasf=1" ref="nofollow noopener noreferrer">master.dl.sourceforge.net/project/nma…</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Visual Studio 2026 正式版下载与安装详细教程！]]></title>    <link>https://juejin.cn/post/7579511003298906155</link>    <guid>https://juejin.cn/post/7579511003298906155</guid>    <pubDate>2025-12-03T13:26:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579511003298906155" data-draft-id="7579511463053131795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Visual Studio 2026 正式版下载与安装详细教程！"/> <meta itemprop="keywords" content="Visual Studio"/> <meta itemprop="datePublished" content="2025-12-03T13:26:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Visual Studio 2026 正式版下载与安装详细教程！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T13:26:19.000Z" title="Wed Dec 03 2025 13:26:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>最近发现很多小伙伴反馈 Visual Studio 2026 安装占用磁盘空间较大，今天大姚出一期 Visual Studio 2026 正式版下载与安装详细教程，我们可以通过仅选择所需的工作负荷、组件、语言包来节省安装时间和磁盘空间，希望可以帮助到有需要的小伙伴！</p>
<h2 data-id="heading-1">Visual Studio 2026 下载</h2>
<ul>
<li><strong>Visual Studio 2026 下载地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fvisualstudio.microsoft.com%2Fzh-hans%2Fdownloads" target="_blank" title="https://visualstudio.microsoft.com/zh-hans/downloads" ref="nofollow noopener noreferrer">visualstudio.microsoft.com/zh-hans/dow…</a></li>
</ul>
<p>Visual Studio 2026 分别提供了社区版（免费）、专业版（付费）、企业版（付费），大家可以按需选择下载。</p>
<p><strong>网友分享的产品密钥：</strong></p>
<ul>
<li><strong>Visual Studio Product Keys：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fzhahost%2Fp%2F19231506" target="_blank" title="https://www.cnblogs.com/zhahost/p/19231506" ref="nofollow noopener noreferrer">www.cnblogs.com/zhahost/p/1…</a></li>
</ul>

<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Professional: NVTDK-QB8J9-M28GR-92BPC-BTHXK</span>
<span class="hljs-section">Enterprise: VYGRN-WPR22-HG4X3-692BF-QGT2V</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b3761586bad440c980c6f0c64ec3c3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=TVUEsS%2FhhFMCTGQR4err2arac70%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">准备 Visual Studio 安装程序</h2>
<p>双击<code>VisualStudioSetup</code>进行安装：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0393dcc59d10412aacf4c51550e19a5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=gkTbiAQFJiLD6bG7gzIADeS%2F45M%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23372b901aee4e839f910f7641a7c8be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=UlJiFel%2FJGxRXw4PV9xqfztsw0Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">选择工作负荷</h2>
<p>安装 Visual Studio 安装程序后，我们可以通过选择所需的工作负载来使用该程序自定义安装（<strong>假如之后有对应的工作负荷改变还是可以重新勾选安装</strong>）：</p>
<h3 data-id="heading-4">.NET Web 开发</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39f9251aaa1f4bf8a29ca1ed9c339240~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=lPGhyo1VfTLRaWKytsF0ge6v4sY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">桌面应用和移动应用开发</h3>
<p><strong>.NET MAUI：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8aa6ec3d5da44014bf8bde72d9425125~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=x71zs5PFyr06HgmTWlU9IzKYUn4%3D" alt="" loading="lazy"/></p>
<p><strong>.NET WPF、WinForm、控制台应用程序：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b297c17e6bb94308b33a334765ccd064~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=yLqkhPlbKTcZ933VAbWOAiuusoI%3D" alt="" loading="lazy"/></p>
<p><strong>.NET WinUI：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82b1fdad3155467793af2b0e2b3f3ee0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=q4hCFFuHo16S%2FPUG7f1Bid05eGM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">安装位置设置</h2>
<p>产品安装位置默认为 C 盘，我们可以移到其他的磁盘中去（<strong>注意只有首次安装的时候才能选择对应的安装位置</strong>）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11e34b76b13a46199157f907e4e44581~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=gjq0%2FzVjYeR0z1Cs8YTRm9OmZXo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4992a499f19425b8c093c463a962801~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=F6aWW%2BYZ1NSq%2BFxuBGMFiootn2o%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">选择单个组件</h2>
<p>按需选择需要的组件：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/730600c24c0b4ae9877d808787d0eb5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=LOtBw%2Fc3Uo7zcgKdeydDt8riTOQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49a5b333763f4bcab5172cfbc8ccf39a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=wNxHGkLipLOck6r%2BI17pE%2BQWohc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f45a14f414c44ae5ab7aaf6252272271~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=Y9r6kyrP94HixPJGoQpTtTGiIs0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">选择语言包</h2>
<p>按需选择需要的语言包：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54e659f4e14c4b1dbc82125f20b7e0bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=Q5yTczsYKPhdhaGeEljk76iOWSM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">Visual Studio 2026 开始安装</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1334a23f8971445e93f1ae635b00d18b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=qzF8Lqn7KDSiPg4SeuJRDiLf5Uc%3D" alt="" loading="lazy"/></p>
<p><strong>安装需要一些时间，来杯咖啡耐心等待：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1f07aff30504852b180692c0d616f84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=CDEUu25zh0aSHSIKciGITdMrKms%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">启动 Visual Studio 2026</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bda8557c370742f98ab3a38043fd0a7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=rGteERtie94jZQBrjpxnsLV3tQk%3D" alt="" loading="lazy"/></p>
<p><strong>选择你喜欢的颜色主题：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/670688413e9149b9b4904095e7f004b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=MLzybi1H%2FEnTdW1jO%2FnWcR3kakw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca79fefe96e2477888adc8f29bf37e4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=Ike37Ng33HaNqgXy2k6OJ6GTb%2Fs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb3e7585b8b24dde9fa8ec12d9057c80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=57bI%2FKF1UIVxmDGOoW0%2Bt42OmDI%3D" alt="" loading="lazy"/></p>
<p><strong>打开 .NET 解决方案：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40c1d1ddfdce41988e10ecaf7c00f35c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=URfrTrRtl8GnKc8StPPwxorgAXo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/258fb28c71f049d6ba2245b5e8525138~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=u6Y6PaowaPHCpIvx5lHmcNuzhGs%3D" alt="" loading="lazy"/></p>
<p><strong>主题设置：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75052814efdb4021afaaf4306c421577~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=3omG8AUc%2ByIG96xxlzHerSTB5AA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1daed7b9ce084d928af986f33ccb2c1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=YkOSILcyayxXbH8ifwEY4TqZVjw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efe49fdad234474cb941559b01308651~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=LDfH%2BTa3yH2FQvHXxhHYwDi1e%2BA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">Visual Studio 实用功能</h2>
<ul>
<li><strong>Visual Studio 实用功能：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98e8e5bd61d94b7cbc8ba9345f83fe36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373179&amp;x-signature=s%2B6eh7S4SbONXegjt%2F6ruNJVFd0%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Prompt工程实战：让AI输出质量提升10倍的技巧]]></title>    <link>https://juejin.cn/post/7579472170905567282</link>    <guid>https://juejin.cn/post/7579472170905567282</guid>    <pubDate>2025-12-03T13:23:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579472170905567282" data-draft-id="7579473409748303923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Prompt工程实战：让AI输出质量提升10倍的技巧"/> <meta itemprop="keywords" content="AIGC,AI编程"/> <meta itemprop="datePublished" content="2025-12-03T13:23:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="技术探索家"/> <meta itemprop="url" content="https://juejin.cn/user/2735240657517816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Prompt工程实战：让AI输出质量提升10倍的技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2735240657517816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    技术探索家
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T13:23:22.000Z" title="Wed Dec 03 2025 13:23:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1770d5fa58a144e088ea8e4ce3b54490~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv5o6i57Si5a62:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765375285&amp;x-signature=MO1fcCTzhjWWEt29YBrP6iqwAB8%3D" alt="20251125-prompt-engineering-guide.jpg" loading="lazy"/>
我记得刚开始用ChatGPT那会儿，特别需要它帮我写一篇关于时间管理的文章。我输入了一句话："帮我写一篇关于时间管理的文章"，然后等了几秒钟，它给了我一篇1000字的标准答案。</p>
<p>说实话，那篇文章看起来挺完整的，该有的都有——开头、分论点、结尾，格式也整整齐齐。但就是感觉...怎么说呢，哪里不对劲。太像模板了，毫无个性，全是大道理，读完就忘那种。我当时真的很郁闷，试了好几次都不行，每次换个说法，出来的东西还是差不多。</p>
<p>后来我才发现，这压根不是ChatGPT的问题,是我的提示词有问题。当我把提示词从简单的一句话，改成一个结构化的指令后，输出质量直接翻了好几倍。这就是Prompt工程的魔力——听起来很玄乎，其实就是"会问问题"。</p>
<p>你肯定也遇到过类似的情况吧？和ChatGPT"聊天"半天才能得到想要的答案，来回修改很多轮；或者AI生成的内容"AI味"太重，缺乏个性和深度，一看就是机器写的。我一开始也不太懂什么是Prompt工程，就觉得不就是"问问题"吗？能有多大学问？但当我真正掌握这些技巧后，才明白差距有多大。</p>
<p>这篇文章，我会把自己踩坑踩出来的7个Prompt优化技巧分享给你，涵盖写作、编程、数据分析等场景，每个技巧都有前后对比案例。学会这些方法，你用AI的效率真的会大不一样。另外，这些技巧不只适用于ChatGPT，Claude、Gemini、文心一言这些AI也能用，底层逻辑是一样的。</p>
<h2 data-id="heading-0">为什么你的ChatGPT"不好用"？</h2>
<p>我观察了很多人使用ChatGPT，发现大家最常犯的错误就是提示词太模糊。</p>
<p>比如这两种问法：</p>
<p><strong>模糊版</strong>：帮我写一篇文章</p>
<p><strong>清晰版</strong>：写一篇800字的产品分析文章，目标读者是B端产品经理，重点分析竞品的增长策略</p>
<p>看出区别了吗？第一种问法，ChatGPT只能给你一个泛泛的回答，因为它根本不知道你要什么类型的文章、给谁看、重点是什么。第二种就清晰多了，AI知道该往哪个方向使劲。</p>
<p>还有一种常见问题是太简单。我之前让ChatGPT"生成代码"，结果它给我的代码能跑，但没有异常处理，也没有注释，代码质量很一般。后来我改成"用Python写一个函数，输入是用户年龄列表，输出是平均值，要包含异常处理和详细注释"，质量立刻就上来了。</p>
<p>说白了，Prompt工程的本质不是"和AI聊天"，而是"给AI下达精确指令"。就像你给助手安排任务一样，越具体越好用。我一开始也不太理解这个道理，总觉得AI应该能理解我的意思，后来才明白——AI虽然很聪明，但它不会读心术，你不说清楚，它就只能猜。</p>
<p>OpenAI在2023年12月发布了一个提示工程指南，里面提到了六大策略：写清晰的指令、提供参考文本、拆解复杂任务、给模型思考时间、使用外部工具、系统性测试改进。这些策略听起来很专业，但归根结底就是一个字：<strong>具体</strong>。</p>
<h2 data-id="heading-1">7个立即见效的Prompt优化技巧</h2>
<p>接下来我要分享7个我自己常用的技巧，每个都配有前后对比。这些技巧都很实用，看完就能用，不需要什么专业背景。</p>
<h3 data-id="heading-2">技巧1：明确角色和背景</h3>
<p>让AI扮演特定角色，它就会调用相应的知识库来回答。这招我用得特别多。</p>
<p><strong>优化前</strong>：</p>
<pre><code class="hljs">帮我分析这个产品
</code></pre>
<p><strong>优化后</strong>：</p>
<pre><code class="hljs">你是一名有10年经验的SaaS产品分析师。请从用户体验、商业模式、技术架构三个维度分析这个产品，重点关注其增长策略的可复制性。
</code></pre>
<p>加上角色定位后，ChatGPT会用更专业的视角来分析问题，输出的深度完全不一样。我用这个方法做过好几次竞品分析，老板看了都说专业，其实很多洞察都是AI帮我想的。</p>
<p><strong>适用场景</strong>：产品分析、市场调研、竞品研究、专业咨询</p>
<h3 data-id="heading-3">技巧2：分步骤引导思考（Chain-of-Thought）</h3>
<p>这个技巧的英文名叫Chain-of-Thought，翻译过来就是"思维链"。让AI展示推理过程，能明显减少错误。</p>
<p><strong>优化前</strong>：</p>
<pre><code class="hljs language-css" lang="css">这道数学题答案是什么？<span class="hljs-selector-attr">[题目]</span>
</code></pre>
<p><strong>优化后</strong>：</p>
<pre><code class="hljs">请一步步解决这道题：
1）先列出已知条件
2）写出解题思路
3）展示计算过程
4）给出最终答案并验证
</code></pre>
<p>我发现这个方法特别适合复杂问题。当AI展示思考过程时，你可以更容易发现哪里出错了，也能学到它的解题思路。有次我让AI帮我算一个复杂的业务指标，直接问答案是错的，但让它分步骤来，我就发现是第二步的假设有问题。</p>
<p><strong>适用场景</strong>：复杂问题分析、逻辑推理、教学辅导、调试代码</p>
<h3 data-id="heading-4">技巧3：提供参考示例</h3>
<p>这个叫Few-shot Learning，说人话就是"照着这个来"。通过示例来定义你想要的输出风格和格式。</p>
<p><strong>优化前</strong>：</p>
<pre><code class="hljs">写个产品文案
</code></pre>
<p><strong>优化后</strong>：</p>
<pre><code class="hljs language-css" lang="css">参考以下风格写一个产品文案：

示例<span class="hljs-number">1</span>：<span class="hljs-selector-attr">[某爆款产品的文案风格]</span>
示例<span class="hljs-number">2</span>：<span class="hljs-selector-attr">[另一个同类产品的文案]</span>

要求：保持相同的结构和语气，突出产品的核心卖点。
</code></pre>
<p>我用这个方法写过几次营销文案，效果比直接让AI写好太多了。因为有了具体的参考，AI就知道你要什么风格，不会乱发挥。特别是当你有一个很喜欢的写作风格，但自己学不来的时候，这招很管用。</p>
<p><strong>适用场景</strong>：文案创作、代码生成、格式化输出、风格模仿</p>
<h3 data-id="heading-5">技巧4：明确输出格式和限制</h3>
<p>这个技巧能让AI的输出更规范，大大减少你后期整理的工作量。</p>
<p><strong>优化前</strong>：</p>
<pre><code class="hljs">总结会议内容
</code></pre>
<p><strong>优化后</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">用Markdown格式输出：

<span class="hljs-section"># 会议要点</span>
<span class="hljs-bullet">-</span> 要点1（不超过20字）
<span class="hljs-bullet">-</span> 要点2
<span class="hljs-bullet">-</span> 要点3

<span class="hljs-section"># 待办事项</span>
<span class="hljs-bullet">-</span> [ ] 任务1（负责人：XX，截止日期：XX）
<span class="hljs-bullet">-</span> [ ] 任务2

字数限制：300字以内
</code></pre>
<p>我现在每次开完会都用这个方法整理会议记录。ChatGPT输出的格式完全按照我的要求来，复制粘贴就能用，不需要再花时间排版。以前整理会议记录要半小时，现在5分钟搞定。</p>
<p><strong>适用场景</strong>：会议记录、报告生成、数据整理、内容结构化</p>
<h3 data-id="heading-6">技巧5：拆解复杂任务</h3>
<p>这是OpenAI官方特别推荐的策略。不要指望一次性让AI完成所有任务，拆分成小步骤，准确性会高很多。</p>
<p><strong>优化前</strong>：</p>
<pre><code class="hljs">帮我完成一个用户调研报告
</code></pre>
<p><strong>优化后</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">第<span class="hljs-number">1</span>轮：<span class="hljs-string">"列出用户调研报告的标准结构和各部分的要点"</span>
第<span class="hljs-number">2</span>轮：<span class="hljs-string">"根据这些用户反馈，写出问题分析部分"</span>
第<span class="hljs-number">3</span>轮：<span class="hljs-string">"基于分析，提出3条优化建议"</span>
</code></pre>
<p>我做过几次大型文档，如果一次性让AI写完，质量肯定不行，东一块西一块的。但分步骤来，每一步都精雕细琢，最后拼起来效果特别好。就像搭积木，一块一块来比一口气全堆上去稳当多了。</p>
<p><strong>适用场景</strong>：大型文档、复杂项目、系统设计、详细报告</p>
<h3 data-id="heading-7">技巧6：添加约束和反面要求</h3>
<p>明确告诉AI什么不要做，这个技巧对去除"AI味"特别有效。</p>
<p><strong>优化前</strong>：</p>
<pre><code class="hljs">写一篇博客
</code></pre>
<p><strong>优化后</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">写一篇博客，要求：

要做的：
<span class="hljs-deletion">- 使用第一人称和真实案例</span>
<span class="hljs-deletion">- 每段不超过4行</span>
<span class="hljs-deletion">- 语言口语化，像朋友聊天</span>

不要做的：
<span class="hljs-deletion">- 不要使用"综上所述""首先其次最后"等套路词</span>
<span class="hljs-deletion">- 不要堆砌专业术语</span>
<span class="hljs-deletion">- 避免说教式语气</span>
</code></pre>
<p>这个方法真的很管用。我现在写文章都会加上"不要做什么"的要求，AI生成的内容明显更自然了。特别是那些一看就是AI写的套路表达，加个限制就能避开。</p>
<p><strong>适用场景</strong>：内容创作、去AI味优化、风格控制、质量把关</p>
<h3 data-id="heading-8">技巧7：迭代优化和追问</h3>
<p>不要指望一次就完美，把AI当做协作者，不断追问和优化。</p>
<p><strong>基础提问</strong>：</p>
<pre><code class="hljs">写一个产品介绍
</code></pre>
<p><strong>追问第一轮</strong>：</p>
<pre><code class="hljs">很好，但能不能加入更多用户痛点的描述？
</code></pre>
<p><strong>追问第二轮</strong>：</p>
<pre><code class="hljs">这个版本不错，但开头能不能更吸引人？可以用一个具体场景开头
</code></pre>
<p>我发现很多人用ChatGPT，一次没效果就放弃了，觉得"AI就这水平"。其实应该像和人沟通一样，不断调整、不断优化。往往第三四轮的输出才是最好的。就像跟设计师改稿，第一稿肯定不是最终稿，慢慢磨才能出好东西。</p>
<p><strong>适用场景</strong>：所有需要迭代优化的内容</p>
<h2 data-id="heading-9">不同场景的Prompt模板</h2>
<p>掌握了技巧，接下来我给你三个实用模板，可以直接复制用。</p>
<h3 data-id="heading-10">场景1：写作提示词模板</h3>
<pre><code class="hljs language-css" lang="css">角色：你是一位<span class="hljs-selector-attr">[领域]</span>的资深作者，擅长<span class="hljs-selector-attr">[风格特点]</span>
任务：写一篇关于<span class="hljs-selector-attr">[主题]</span>的文章
受众：<span class="hljs-selector-attr">[目标读者]</span>，他们的痛点是<span class="hljs-selector-attr">[具体痛点]</span>

要求：
- 字数：<span class="hljs-selector-attr">[X]</span>字
- 结构：<span class="hljs-selector-attr">[具体结构，如：引言+3个要点+总结]</span>
- 风格：<span class="hljs-selector-attr">[语气和风格，如：轻松对话式/专业严谨/幽默风趣]</span>
- 包含：<span class="hljs-selector-attr">[必须包含的要素，如：数据支撑/真实案例/可执行建议]</span>
- 避免：<span class="hljs-selector-attr">[不要出现的内容，如：AI味词汇/说教语气/专业术语堆砌]</span>

参考示例：<span class="hljs-selector-attr">[如果有的话]</span>
</code></pre>
<p><strong>实际案例</strong>：</p>
<p>我用这个模板写过一篇关于远程工作的文章。填入具体内容后是这样的：</p>
<pre><code class="hljs language-diff" lang="diff">角色：你是一位有5年远程工作经验的自由职业者，擅长分享实用技巧
任务：写一篇关于"如何在家高效工作"的文章
受众：刚开始远程工作的职场新人，他们的痛点是容易分心、效率低

要求：
<span class="hljs-deletion">- 字数：1500字</span>
<span class="hljs-deletion">- 结构：引言+5个具体方法+总结</span>
<span class="hljs-deletion">- 风格：轻松对话式，像朋友分享经验</span>
<span class="hljs-deletion">- 包含：个人真实经历、具体的工具推荐、可立即执行的建议</span>
<span class="hljs-deletion">- 避免：理论说教、复杂的时间管理理论、AI味词汇</span>
</code></pre>
<p>输出的文章质量比我直接说"写篇远程工作的文章"好太多了，有细节、有温度、能直接用。</p>
<h3 data-id="heading-11">场景2：编程提示词模板</h3>
<pre><code class="hljs language-css" lang="css">任务：用<span class="hljs-selector-attr">[编程语言]</span>实现<span class="hljs-selector-attr">[功能]</span>
输入：<span class="hljs-selector-attr">[输入格式和类型]</span>
输出：<span class="hljs-selector-attr">[输出格式和类型]</span>

要求：
<span class="hljs-number">1</span>. 代码注释清晰（每个关键步骤都要注释）
<span class="hljs-number">2</span>. 包含异常处理
<span class="hljs-number">3</span>. 时间复杂度要求：<span class="hljs-selector-attr">[如果有]</span>
<span class="hljs-number">4</span>. 使用<span class="hljs-selector-attr">[特定库或框架]</span>

测试用例：
- 输入：<span class="hljs-selector-attr">[测试数据1]</span> → 期望输出：<span class="hljs-selector-attr">[结果1]</span>
- 输入：<span class="hljs-selector-attr">[测试数据2]</span> → 期望输出：<span class="hljs-selector-attr">[结果2]</span>
</code></pre>
<p><strong>实际案例</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">任务：用Python实现一个CSV文件读取和数据清洗功能
输入：包含用户信息的CSV文件（姓名、年龄、邮箱）
输出：清洗后的数据字典列表

要求：
<span class="hljs-bullet">1.</span> 代码注释清晰
<span class="hljs-bullet">2.</span> 包含异常处理（文件不存在、格式错误、空值处理）
<span class="hljs-bullet">3.</span> 使用pandas库
<span class="hljs-bullet">4.</span> 去除重复数据和空值

测试用例：
<span class="hljs-bullet">-</span> 输入：包含3条正常数据的CSV → 输出：3个字典的列表
<span class="hljs-bullet">-</span> 输入：包含重复和空值的CSV → 输出：去重后的有效数据列表
</code></pre>
<p>有了这个模板，AI生成的代码不仅能跑，而且规范、健壮，注释也清楚，可以直接用在项目里。</p>
<h3 data-id="heading-12">场景3：数据分析提示词模板</h3>
<pre><code class="hljs language-markdown" lang="markdown">数据背景：[数据来源和含义]
分析目标：[想要得到什么洞察]

输出格式：
<span class="hljs-bullet">1.</span> 数据摘要（关键指标：总数、平均值、中位数等）
<span class="hljs-bullet">2.</span> 趋势分析（增长/下降趋势及可能原因）
<span class="hljs-bullet">3.</span> 异常值识别（离群数据及其影响）
<span class="hljs-bullet">4.</span> 可执行建议（至少3条具体建议）

注意：[特殊要求或限制]
</code></pre>
<p><strong>实际案例</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">数据背景：过去6个月的网站流量数据，包含访问量、跳出率、转化率
分析目标：找出流量下降的原因，提出优化建议

输出格式：
<span class="hljs-bullet">1.</span> 数据摘要（总访问量、平均跳出率、平均转化率）
<span class="hljs-bullet">2.</span> 趋势分析（哪些指标在下降，可能的原因分析）
<span class="hljs-bullet">3.</span> 异常值识别（异常高/低的数据点）
<span class="hljs-bullet">4.</span> 可执行建议（至少3条改进措施，要具体可落地）

注意：重点关注转化率的变化
</code></pre>
<p>这个模板让ChatGPT能够输出结构化的分析报告，该有的都有，不会遗漏重要信息，省得你自己一项项去想。</p>
<h2 data-id="heading-13">进阶技巧：打造你的Prompt工作流</h2>
<p>掌握了基础技巧和模板，接下来说说怎么建立一套属于自己的工作流。</p>
<h3 data-id="heading-14">1. 建立Prompt模板库</h3>
<p>我现在有个习惯，就是把常用的提示词都保存下来。可以用Notion、Obsidian，或者就是一个简单的文本文档都行。每次遇到效果特别好的prompt，我都会记录下来，标注适用场景和效果。</p>
<p>时间长了，你会发现自己有一套专属的"武器库"。需要的时候，直接复制粘贴，稍微改改参数就能用。这比每次从零开始写高效太多了，而且质量也有保证。</p>
<h3 data-id="heading-15">2. 善用GPT-4o的新能力</h3>
<p>如果你用的是GPT-4o或者更新的模型，有几个新特性值得试试：</p>
<ul>
<li><strong>多模态能力</strong>：可以同时上传图片和文字，比如"参考这张设计图，帮我写代码实现"</li>
<li><strong>更好的上下文理解</strong>：能记住更长的对话历史，适合复杂任务</li>
<li><strong>代码执行能力</strong>：可以直接运行Python代码，验证结果</li>
</ul>
<p>我最近在用多模态功能做UI设计，效果真的挺惊艳的。上传一张设计稿，让AI写出对应的HTML/CSS，准确度很高，省了不少事。</p>
<h3 data-id="heading-16">3. 结合外部工具</h3>
<p>AI虽然强大，但也有局限。结合一些外部工具，能让效果更好：</p>
<ul>
<li><strong>RAG（检索增强生成）</strong>：上传参考资料，让AI基于真实文档回答，减少"胡说八道"的情况</li>
<li><strong>API集成</strong>：让ChatGPT调用实时数据，比如天气、股票、新闻等</li>
<li><strong>提示词优化工具</strong>：比如PromptPerfect，可以帮你优化prompt</li>
</ul>
<p>不过说实话，这些工具都是锦上添花。核心还是要把基础的prompt写好，工具只是辅助。</p>
<h3 data-id="heading-17">4. 持续优化的方法</h3>
<p>我的经验是，不要想着一次就写出完美的prompt。可以这样做：</p>
<ul>
<li><strong>A/B测试</strong>：同一个任务，试试不同版本的prompt，看哪个效果好</li>
<li><strong>记录反馈</strong>：哪些prompt效果好，哪些不行，都记下来，慢慢积累</li>
<li><strong>定期回顾</strong>：每个月看看自己的模板库，更新和优化过时的内容</li>
</ul>
<p>AI技术发展很快，提示词的技巧也在不断进化。保持学习和实践的习惯，你会越用越顺手。</p>
<h2 data-id="heading-18">避坑指南：我踩过的那些坑</h2>
<p>最后，想分享几个我踩过的坑，希望你能避开。</p>
<h3 data-id="heading-19">坑1：一次性塞太多要求</h3>
<p>有段时间我特别喜欢写超长的prompt，恨不得一次性把所有要求都说清楚。结果AI反而不知道重点在哪，输出一团糟，什么都说了但什么都没说清楚。</p>
<p><strong>怎么避开</strong>：拆分任务，多轮对话。第一轮确定大方向，第二轮细化要求，第三轮优化细节。这样比一次性说完效果好，AI也更容易理解你要什么。</p>
<h3 data-id="heading-20">坑2：拿到结果就直接用</h3>
<p>AI生成的内容不一定准确，特别是涉及数据、日期、专业知识的时候。我之前就犯过这个错，直接用AI写的内容发出去了，结果有事实错误，挺尴尬的。</p>
<p><strong>怎么避开</strong>：关键信息一定要人工核查。可以让AI提供信息来源，或者用搜索引擎交叉验证。特别是写正式文档、做决策参考时，严谨一点没坏处。</p>
<h3 data-id="heading-21">坑3：每次都从零开始</h3>
<p>每次都重新开一个对话，不利用之前的对话历史，这样很浪费。ChatGPT其实能记住之前的对话内容，可以基于上下文继续深入。</p>
<p><strong>怎么避开</strong>：充分利用对话历史，建立连续性。比如第一轮让AI分析问题，第二轮基于分析提建议，第三轮细化方案。这样层层递进，效果更好，AI也更理解你的需求。</p>
<h3 data-id="heading-22">坑4：把AI当万能钥匙</h3>
<p>有人指望AI完全替代人工，这不现实。AI是工具，是助手，不是替代品。它能提高效率，但不能代替你的思考和判断。</p>
<p><strong>怎么避开</strong>：把AI当助手，最终决策、创意构思、质量把关还是要靠你自己。AI帮你干活，但拍板的是你。</p>
<h3 data-id="heading-23">坑5：试一次没效果就放弃</h3>
<p>这是最可惜的。Prompt优化本身就是一个迭代的过程，没有人能一次就写出完美的提示词。</p>
<p><strong>怎么避开</strong>：尝试不同表述，逐步优化。没效果就换个问法，多试几次，找到最适合的表达方式。有时候就是换几个词，效果就完全不一样了。</p>
<p>还有一点要特别提醒：<strong>不要输入敏感信息</strong>。公司机密、个人隐私、密码账号这些，千万别输入到ChatGPT里。虽然各家AI公司都说保护隐私，但谨慎一点总没错。</p>
<h2 data-id="heading-24">写在最后</h2>
<p>回顾一下我们聊的这些内容：</p>
<p>Prompt工程的本质，就是把模糊需求变成结构化任务。在7个技巧里，我觉得最重要的是<strong>明确角色</strong>、<strong>分步引导</strong>和<strong>提供示例</strong>。这三个技巧，你只要掌握了，就能解决80%的问题。</p>
<p>至于不同场景的模板，记住一个原则：越具体，越好用。不管是写作、编程还是数据分析，都要明确告诉AI你要什么、怎么要、要成什么样。AI很聪明，但它需要你指明方向。</p>
<p>最后想说的是，这些技巧和模板都是起点，不是终点。每个人的使用场景不同，需要根据实际情况调整。不要生搬硬套，要灵活运用，找到最适合自己的用法。</p>
<p>现在就选择一个你经常使用ChatGPT的场景，用本文的技巧优化你的提示词。试试看，你会立刻看到效果的提升。</p>
<p>如果你想更系统地学习，推荐几个资源：</p>
<ul>
<li>OpenAI官方的Prompt Engineering Guide（这是最权威的）</li>
<li>吴恩达的《ChatGPT Prompt Engineering for Developers》课程（免费的，讲得很清楚）</li>
<li>Prompt Engineering Guide网站（promptingguide.ai，内容很全）</li>
</ul>
<p>把本文的模板保存下来，下次需要的时候直接用。记住，AI是你的助手，不是你的老板。你来主导，告诉它该怎么做，它就能帮你干好活。</p>
<p>希望这些经验对你有用，祝你用AI越来越顺手！</p>
<blockquote>
<p>原文首发<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.betterlink.top%2Fzh%2Fposts%2Fai%2F20251125-prompt-engineering-guide%2F" target="_blank" title="https://blog.betterlink.top/zh/posts/ai/20251125-prompt-engineering-guide/" ref="nofollow noopener noreferrer">自个人博客</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain.js/DeepAgents可观测性]]></title>    <link>https://juejin.cn/post/7579440586694754350</link>    <guid>https://juejin.cn/post/7579440586694754350</guid>    <pubDate>2025-12-03T13:39:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579440586694754350" data-draft-id="7579313396207583247" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain.js/DeepAgents可观测性"/> <meta itemprop="keywords" content="JavaScript,人工智能"/> <meta itemprop="datePublished" content="2025-12-03T13:39:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="桜吹雪"/> <meta itemprop="url" content="https://juejin.cn/user/1179091901098269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain.js/DeepAgents可观测性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1179091901098269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    桜吹雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T13:39:02.000Z" title="Wed Dec 03 2025 13:39:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：为什么 LLM 应用需要“X 光机”？</h2>
<p>在 Generative AI 的热潮中，我们很容易用 LangChain 等框架快速搭建一个 Demo。然而，当我们将这些应用部署到生产环境时，噩梦往往随之而来：</p>
<ul>
<li><strong>成本失控</strong>：一个死循环的 Agent 在几分钟内消耗了数百美元的 Token。</li>
<li><strong>调试困难</strong>：用户反馈“回答错误”，但你不知道是 prompt 问题、检索（RAG）失败，还是 LLM 本身的幻觉。</li>
<li><strong>延迟不可知</strong>：一个请求耗时 10 秒，时间到底花在了网络请求、数据库查询还是模型推理上？</li>
</ul>
<p>对于传统的微服务，我们要的是监控（Monitoring）；而对于充满不确定性的 LLM Agent，我们需要的是<strong>可观测性（Observability）</strong> ，需要关注的维度大概如下：</p>
<ul>
<li><strong>链路追踪 (Tracing)</strong> ：LLM 应用通常包含多个步骤（Prompt -&gt; LLM -&gt; Tool -&gt; Parser）。我们需要看到完整的执行链路，尤其是 Agent 在“思考”时的中间步骤。</li>
<li><strong>成本监控 (Cost &amp; Token Usage)</strong> ：每一次 API 调用都是钱。我们需要精确知道每个功能模块消耗了多少 Token。</li>
<li><strong>延迟分析 (Latency)</strong> ：瓶颈是在向量数据库检索，还是 LLM 生成速度太慢？</li>
<li><strong>评估 (Evaluation)</strong> ：如何确定修改了 Prompt 后，输出质量没有下降？</li>
</ul>
<h2 data-id="heading-1">工具一：LangSmith (LangChain 官方支持)</h2>
<p>LangSmith 是 LangChain 团队推出的全能平台，它与 LangChain.js 的集成是“原生级”的，几乎不需要改动代码。</p>
<h3 data-id="heading-2">核心亮点</h3>
<ul>
<li><strong>开箱即用</strong>：对于 LangChain.js 应用，只需配置环境变量。</li>
<li><strong>可视化调试</strong>：能够清晰地展示 Agent 的递归调用树。</li>
<li><strong>Playground</strong>：可以直接在界面上修改 Prompt 并重新运行某个步骤。</li>
</ul>
<h3 data-id="heading-3">如何在 LangChain.js 中集成</h3>
<p>你甚至不需要安装额外的 SDK，只需要设置环境变量：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> LANGSMITH_TRACING=<span class="hljs-literal">true</span>
<span class="hljs-built_in">export</span> LANGSMITH_API_KEY=&lt;your-api-key&gt;
</code></pre>
<p>或者使用.env文件，并且在根目录下使用bun运行会自动加载</p>
<pre><code class="hljs language-env" lang="env"># .env 文件
LANGSMITH_TRACING=true
LANGSMITH_API_KEY=&lt;your-api-key&gt;
</code></pre>
<p>当然如果要自定义workspace和project可以像下面这样设置</p>
<pre><code class="hljs language-env" lang="env"># .env 文件
LANGSMITH_TRACING=true
LANGSMITH_API_KEY=&lt;your-api-key&gt;
LANGSMITH_WORKSPACE_ID=&lt;your-workspace-id&gt;
LANGSMITH_PROJECT=default
</code></pre>
<p>如果是个人用户免费应该是只有一个workspace，一个workspace里面可以有多个project</p>
<p>如果你看过上一篇文章：<a href="https://juejin.cn/post/7576859345935302710" target="_blank" title="https://juejin.cn/post/7576859345935302710">DeepAgents官方文档（一）</a>，可以再次执行一次，然后登录 LangSmith 后台，你可以看到这次 <code>invoke</code> 的完整过程，包括 Prompt 渲染后的实际内容、LLM 的原始响应、Token 消耗以及耗时。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c143f59547a496b891b92173686638e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qGc5ZC56Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373942&amp;x-signature=jaYUkPe8B2TV%2FahchXcJeZ9nfAA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">工具二：LangFuse (开源与自托管首选)</h2>
<p>LangFuse 是一款开源的 LLM 工程化平台。如果你对数据隐私有极高要求，或者希望私有化部署，LangFuse 是最佳选择。它提供了非常强大的 Analytics（分析）面板。</p>
<h3 data-id="heading-5">核心亮点</h3>
<ul>
<li><strong>完全开源</strong>：支持 Docker 一键部署。</li>
<li><strong>LangChain 集成</strong>：通过 <code>CallbackHandler</code> 轻松接入。</li>
<li><strong>精细的成本分析</strong>：可以按用户、按模型、按功能统计费用。</li>
<li><strong>Prompt 管理</strong>：支持在后台管理 Prompt 版本，代码直接拉取。</li>
</ul>
<h3 data-id="heading-6">如何在 LangChain.js 中集成</h3>
<h4 data-id="heading-7">部署LangFuse</h4>
<p>LangFuse有很多种私有部署方式</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc68c0b6ce764610bc0e596a8d855c13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qGc5ZC56Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765373942&amp;x-signature=rjgRAf%2FwT7LUeb8kkKHVtnyZpmk%3D" alt="image.png" loading="lazy"/></p>
<p>这里为了方便演示使用DockerCompose部署：</p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># 拉取git仓库</span>
git <span class="hljs-built_in">clone</span> https://github.com/langfuse/langfuse.git
<span class="hljs-built_in">cd</span> langfuse
docker compose up
</code></pre>
<p>如果是国内的话，可以将docker-compose.yaml里的docker.io替换成docker.1ms.run加速镜像下载，如果是新的CentOS、Fedora这些系统自带了podman，使用dnf安装一个podman-compose即可代替docker-compose，只需要改成：<code>podman compose up</code>即可</p>
<h4 data-id="heading-8">接入SDK</h4>
<p>首先安装 SDK：</p>
<pre><code class="hljs language-bash" lang="bash">npm i @langfuse/langchain @langfuse/otel @opentelemetry/sdk-node
<span class="hljs-comment">#或者使用bun、pnpm</span>
bun i @langfuse/langchain @langfuse/otel @opentelemetry/sdk-node
pnpm i  @langfuse/langchain @langfuse/otel @opentelemetry/sdk-node
</code></pre>
<p>通过回调函数（Callback）的方式注入监控：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { tool } <span class="hljs-keyword">from</span> <span class="hljs-string">"langchain"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TavilySearch</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/tavily"</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">"zod"</span>;
<span class="hljs-keyword">import</span> { createDeepAgent, <span class="hljs-title class_">FilesystemBackend</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"deepagents"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeSDK</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@opentelemetry/sdk-node"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">LangfuseSpanProcessor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langfuse/otel"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CallbackHandler</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langfuse/langchain"</span>;

<span class="hljs-comment">// 初始化sdk</span>
<span class="hljs-keyword">const</span> sdk = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NodeSDK</span>({
  <span class="hljs-attr">spanProcessors</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">LangfuseSpanProcessor</span>()],
});

sdk.<span class="hljs-title function_">start</span>();

<span class="hljs-keyword">const</span> langfuseHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CallbackHandler</span>({});

<span class="hljs-comment">// ...</span>

<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> agent.<span class="hljs-title function_">invoke</span>(
  {
    <span class="hljs-attr">messages</span>: [{ <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"你是谁"</span> }],
  },
  {
    <span class="hljs-comment">// 这里传入回调</span>
    <span class="hljs-attr">callbacks</span>: [langfuseHandler],
    <span class="hljs-comment">// 这里定义sessionId、userId、tags</span>
    <span class="hljs-attr">metadata</span>: {
      <span class="hljs-attr">langfuse_session_id</span>: <span class="hljs-string">"user-111"</span>,
      <span class="hljs-attr">langfuse_user_id</span>: <span class="hljs-string">"user-222"</span>,
      <span class="hljs-attr">langfuse_tags</span>: [<span class="hljs-string">"production"</span>, <span class="hljs-string">"humor-bot"</span>],
    },
  },
);

<span class="hljs-comment">// 输出Agent的最终响应</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">messages</span>[result.<span class="hljs-property">messages</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-property">content</span>);
</code></pre>
<blockquote>
<p>目前测试langchain@1.1.2、deepagents@1.3.0、@langfuse/langchain@4.4.4、langfuse v3.135.1 OSS，tracing会缺少一些数据，比如input、output、llm调用等节点信息，谨慎使用</p>
</blockquote>
<h2 data-id="heading-9">LangSmith vs LangFuse：如何选择？</h2>



































<table><thead><tr><th align="left">维度</th><th align="left">LangSmith</th><th align="left">LangFuse</th></tr></thead><tbody><tr><td align="left"><strong>集成难度</strong></td><td align="left">极低 (仅需环境变量)</td><td align="left">低 (需添加 Callback 或 SDK)</td></tr><tr><td align="left"><strong>开源属性</strong></td><td align="left">闭源 (SaaS)</td><td align="left"><strong>开源 (MIT License)</strong></td></tr><tr><td align="left"><strong>部署方式</strong></td><td align="left">云托管 (企业版支持私有化)</td><td align="left">云托管 或 <strong>自托管 (Docker、K8S等)</strong></td></tr><tr><td align="left"><strong>生态绑定</strong></td><td align="left">强绑定 LangChain 生态</td><td align="left">框架无关 (支持 LangChain, LlamaIndex, SDK)</td></tr><tr><td align="left"><strong>特色功能</strong></td><td align="left">强大的数据集评估与标注</td><td align="left">强大的成本分析与 Prompt 管理</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-10">深度代理 (Deep Agents) 场景下的建议</h2>
<p>当我们开发复杂的 <strong>DeepAgents</strong>（具备反思、规划、工具使用能力的智能体）时，可观测性不再是“锦上添花”，而是“救命稻草”。</p>
<p>对于这类应用，建议采取以下策略：</p>
<ol>
<li><strong>给 Trace 加上 Tags</strong>：例如标记 <code>environment: production</code> 或 <code>agent_version: v2.1</code>，便于 A/B 测试。</li>
<li><strong>记录 User Feedback</strong>：LangSmith 和 LangFuse 都支持记录用户点赞/点踩。将用户的反馈与具体的 Trace 关联起来，是优化 Agent 表现的最快路径。</li>
<li><strong>监控工具调用参数</strong>：Agent 经常会产生幻觉，调用工具时传入错误的 JSON 格式。通过 Trace 查看 <code>tool_input</code> 是调试此类错误的唯一有效手段。</li>
</ol>
<h2 data-id="heading-11">结语</h2>
<p>无论是使用 LangChain.js 的生态便利，还是 DeepAgents.js 的深度能力，没有可观测性的 AI 应用就像在黑夜中开车。</p>
<ul>
<li>如果你追求<strong>快速上手</strong>且深度依赖 LangChain，<strong>LangSmith</strong> 是不二之选。</li>
<li>如果你需要<strong>数据合规</strong>、<strong>成本控制</strong>或<strong>非 LangChain 框架</strong>，<strong>LangFuse</strong> 则是你的瑞士军刀。</li>
</ul>
<p>希望这篇文章能帮助你在 AI 开发的道路上看得更清、走得更远！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[线下活动｜2025 Kotlin 中文开发者大会北京分会场]]></title>    <link>https://juejin.cn/post/7579127397497225267</link>    <guid>https://juejin.cn/post/7579127397497225267</guid>    <pubDate>2025-12-02T14:40:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579127397497225267" data-draft-id="7579123072825901075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="线下活动｜2025 Kotlin 中文开发者大会北京分会场"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2025-12-02T14:40:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员江同学"/> <meta itemprop="url" content="https://juejin.cn/user/668101431009496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            线下活动｜2025 Kotlin 中文开发者大会北京分会场
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/668101431009496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员江同学
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T14:40:25.000Z" title="Tue Dec 02 2025 14:40:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    102
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>大家好！2025 Kotlin 中文开发者大会来了！</p>
<p>Kotlin 中文开发者大会是由 JetBrains 联合 KUG 举办的一年一度的 Kotlin 分享盛会。本次大会将以「茁壮成长的 KMP」为主题，邀请来自国内外顶尖科技公司的技术领袖与一线开发者，共同见证 Kotlin Multiplatform (KMP) 在过去一年中爆发式的增长与成熟。</p>
<p>我们特别组织了线下分会场，让北京的开发者们可以齐聚一堂，共同观看线上直播，并进行面对面的技术交流与讨论。更有多位讲师亲临现场，与大家分享最新的 Kotlin 技术实践！</p>
<p>让我们一起参加 2025 Kotlin 中文开发者大会吧！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6ee30afc882405bbe40b68086c7c4f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5rGf5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765375027&amp;x-signature=Hysdw6QrQ3fxsTOZ%2FU%2B0SmEQ%2Bc0%3D" alt="p5.png" loading="lazy"/></p>
<h2 data-id="heading-0">活动简介</h2>
<ul>
<li>时间：2025 年 12 月 6-7 日，14:00 - 18:00</li>
<li>地点：北京市朝阳区望京东路4号院恒电大厦C座中华厅（美团北京总部）</li>
<li>形式：线下观看线上直播 + 现场讲师分享 + 技术交流</li>
</ul>
<h2 data-id="heading-1">活动内容</h2>
<h3 data-id="heading-2">12 月 6 日（星期六）</h3>
<ul>
<li>14:00-14:25 开场 &amp; 线上大会直播</li>
<li>14:25-15:05 <strong>Kotlin 新特性速递</strong> - @霍丙乾</li>
<li>15:05-17:45 线上大会直播观看 &amp; 自由交流</li>
<li>17:45-18:00 <strong>Now in Kotlin：多平台开发实践之旅</strong> - @江军祥</li>
</ul>
<h3 data-id="heading-3">12 月 7 日（星期日）</h3>
<ul>
<li>14:00-18:00 线上大会直播观看 &amp; 自由交流</li>
</ul>
<h3 data-id="heading-4">现场抽奖</h3>
<p>欢迎大家来到线下会场，现场参与的小伙伴还有机会抽中 Kotlin 专属周边好礼！精美礼品等你来拿！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c55160ba7ff943ab886b2c3dc870e236~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5rGf5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765375027&amp;x-signature=tjrqZg8fKAaf6UV2ACzJwgeYjt8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">线下分享介绍</h2>
<h3 data-id="heading-6">Kotlin 新特性速递</h3>
<p><strong>讲师简介</strong>：霍丙乾，腾讯视频高级工程师，Google 开发者专家，深耕 Kotlin 语言特性与生态发展。</p>
<p><strong>讲题简介</strong>：随着 Kotlin 2.0 与 K2 编译器 的发布，Kotlin 语言迎来了新的里程碑。然而语言的演进并未止步，自 2.0 发布后又陆续推出了众多新特性。本场分享将为大家详细介绍 Kotlin 2.0 时代的主要语法特性、发展思路与演进方向，并探讨这些更新如何进一步提升开发效率与代码可维护性。无论你是日常使用 Kotlin 的工程师，还是对语言演进方向感兴趣的开发者，都能从这场分享中获得对 Kotlin 未来生态的更深理解与启发。</p>
<h3 data-id="heading-7">Now in Kotlin：多平台开发实践之旅</h3>
<p><strong>讲师简介</strong>：江军祥，猿辅导 Android 开发工程师，北京 KUG 组织者。</p>
<p><strong>讲题简介</strong>：在跨平台开发浪潮下，KMP 为移动应用带来了全新的可能性。本次分享以真实的 Kotlin 资讯类应用 "Now in Kotlin" 为例，展示如何借助 KMP 技术实现多平台间的高效代码共享与统一开发体验。内容涵盖 AI 辅助 UI 设计、自定义路由与 ViewModel 实现、网络图片加载方案，以及如何通过平台互操作集成 WebView 与音视频播放等原生功能。听完这场分享后，你将更深入理解 Kotlin 在多平台生态中的技术实践细节，也能掌握 Kotlin 在跨平台生态中的最新技术进展。</p>
<h2 data-id="heading-8">报名方式</h2>
<h3 data-id="heading-9">线下报名</h3>
<p>我们非常希望您能亲临现场，与我们一起观看大会直播、聆听讲师的分享、参与热烈的技术探讨。如果您有意参加的话，请您填写下方的观众报名表。</p>
<p>报名链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fshimo.im%2Fforms%2FwV3VMM7ZZNUDG8Ay%2Ffill" target="_blank" title="https://shimo.im/forms/wV3VMM7ZZNUDG8Ay/fill" ref="nofollow noopener noreferrer">2025 Kotlin 中文开发者大会北京分会场报名表</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9ba40255b3345d38512601a3121b4cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5rGf5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765375027&amp;x-signature=3%2FRRXjlD%2BOaNvpGpvqKOrR%2BYnGE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">活动群</h3>
<p>我们还创建了一个活动交流群，以便大家进行交流和讨论，并发布活动相关信息。如果您有关于 Kotlin 的问题，欢迎在群里提出，我们将为您解答。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07033dc14ada4edfa2ff5e5047bb8c82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5rGf5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765375027&amp;x-signature=wN4lWq5YpKR2qe5ELcJkj1KyrEo%3D" alt="p14.jpg" loading="lazy"/></p>
<h2 data-id="heading-11">线上观看</h2>
<p>如果您无法到场，也可以直接参加线上大会：</p>
<p>线上报名：<a href="https://link.juejin.cn?target=https%3A%2F%2Flp.jetbrains.com.cn%2Fkotlin-online-chinese-conference-2025%2F" target="_blank" title="https://lp.jetbrains.com.cn/kotlin-online-chinese-conference-2025/" ref="nofollow noopener noreferrer">2025 Kotlin 中文开发者大会</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Hadoop+Spark+python毕设】中风患者数据可视化分析系统、计算机毕业设计、包括数据爬取、Spark、数据分析、数据可视化、Hadoop]]></title>    <link>https://juejin.cn/post/7579472170905255986</link>    <guid>https://juejin.cn/post/7579472170905255986</guid>    <pubDate>2025-12-03T12:14:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579472170905255986" data-draft-id="7579473409748402227" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Hadoop+Spark+python毕设】中风患者数据可视化分析系统、计算机毕业设计、包括数据爬取、Spark、数据分析、数据可视化、Hadoop"/> <meta itemprop="keywords" content="后端,Python,MySQL"/> <meta itemprop="datePublished" content="2025-12-03T12:14:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="计算机毕设小月哥"/> <meta itemprop="url" content="https://juejin.cn/user/95020128928073"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Hadoop+Spark+python毕设】中风患者数据可视化分析系统、计算机毕业设计、包括数据爬取、Spark、数据分析、数据可视化、Hadoop
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/95020128928073/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    计算机毕设小月哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T12:14:30.000Z" title="Wed Dec 03 2025 12:14:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>🎓 作者：计算机毕设小月哥 | 软件开发专家</p>
<p>🖥️ 简介：8年计算机软件程序开发经验。精通Java、Python、微信小程序、安卓、大数据、PHP、.NET|C#、Golang等技术栈。</p>
<p>🛠️ 专业服务 🛠️</p>
<ul>
<li>
<p>需求定制化开发</p>
</li>
<li>
<p>源码提供与讲解</p>
</li>
<li>
<p>技术文档撰写（指导计算机毕设选题【新颖+创新】、任务书、开题报告、文献综述、外文翻译等）</p>
</li>
<li>
<p>项目答辩演示PPT制作</p>
</li>
</ul>
</blockquote>
<blockquote>
<p>🌟 欢迎：点赞 👍 收藏 ⭐ 评论 📝</p>
<p>👇🏻 精选专栏推荐 👇🏻 欢迎订阅关注！</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761129.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761129.html" ref="nofollow noopener noreferrer">大数据实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761131.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761131.html" ref="nofollow noopener noreferrer">PHP|C#.NET|Golang实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761132.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761132.html" ref="nofollow noopener noreferrer">微信小程序|安卓实战项目</a></p>
</blockquote>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761130.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761130.html" ref="nofollow noopener noreferrer">Python实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761126.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761126.html" ref="nofollow noopener noreferrer">Java实战项目</a></p>
<p>🍅 ↓↓主页获取源码联系↓↓🍅</p>
</blockquote>
<h2 data-id="heading-0">基于大数据的中风患者数据可视化分析系统-功能介绍</h2>
<p>本系统是一个基于大数据技术的中风患者数据可视化分析平台，旨在通过高效的数据处理与直观的图表展示，深度挖掘中风患者数据背后的潜在规律与风险因素。系统后端采用Hadoop构建分布式存储环境，利用Spark作为核心计算引擎，实现对海量医疗数据的快速清洗、转换与分析。开发语言选用Python，借助其强大的数据科学生态库，如Pandas与NumPy，进行精细化的数据预处理。系统功能全面，覆盖了从患者群体基础画像（如性别、年龄、职业分布）到核心健康指标（如高血压、血糖、BMI）的统计分析，再到中风风险因素的多维度关联与交叉钻取。通过对年龄、吸烟史、既往病史等变量与中风率的关联计算，系统能够精准定位高风险人群特征。最终，所有分析结果通过Vue前端框架与Echarts可视化组件，以动态交互图表的形式呈现，将复杂的数据转化为易于理解的洞察，为中风病的预防与研究提供数据支持。</p>
<h2 data-id="heading-1">基于大数据的中风患者数据可视化分析系统-选题背景意义</h2>
<p>选题背景
随着社会生活节奏的加快和人口老龄化趋势的显现，中风已经成为威胁公众健康的主要疾病之一，其高发病率、高致残率和高死亡率的特点，给无数家庭和社会带来了沉重的负担。在临床实践中，医院和医疗机构积累了海量的患者电子病历数据，这些数据中蕴含着关于疾病成因、发展规律和风险因素的宝贵信息。然而，这些数据往往体量巨大、结构复杂且分散在不同系统中，传统的数据分析工具和方法难以有效处理和深度挖掘，导致大量有价值的信息被“淹没”。如何利用新兴的大数据技术，对这些庞大的医疗数据进行系统性的整合与分析，从中发现隐藏的关联模式，从而为中风病的早期预警和精准预防提供科学依据，便成了一个具有重要现实意义的课题。
选题意义
这个课题的意义可以从几个方面来看。对于医疗领域的研究者来说，本系统提供了一个快速、多维度的数据分析工具，能够帮助他们验证一些关于中风风险的假设，比如不同生活习惯或基础疾病组合对中风概率的影响，为更深入的流行病学研究提供了方向和初步的数据参考。从公共卫生的角度看，通过系统分析得出的高风险人群画像，可以帮助卫生部门更有针对性地开展健康教育和预防干预活动，比如向特定年龄段和有特定生活习惯的群体推送预防知识，提升整个社会的预防意识。对于我们计算机专业的学生而言，这个项目是一次将大数据理论技术与实际应用场景紧密结合的绝佳实践，完整地走过了从数据采集、存储、清洗、分析到可视化的全流程，锻炼了解决复杂问题的能力，虽然只是一个毕业设计，但希望能为智慧医疗领域的发展提供一个微小的技术探索样本。</p>
<h2 data-id="heading-2">基于大数据的中风患者数据可视化分析系统-技术选型</h2>
<p>大数据框架：Hadoop+Spark（本次没用Hive，支持定制）
开发语言：Python+Java（两个版本都支持）
后端框架：Django+Spring Boot(Spring+SpringMVC+Mybatis)（两个版本都支持）
前端：Vue+ElementUI+Echarts+HTML+CSS+JavaScript+jQuery
详细技术点：Hadoop、HDFS、Spark、Spark SQL、Pandas、NumPy
数据库：MySQL</p>
<h2 data-id="heading-3">基于大数据的中风患者数据可视化分析系统-视频展示</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1ST2xBiEnr%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1ST2xBiEnr/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">基于大数据的中风患者数据可视化分析系统-视频展示</a></p>
<h2 data-id="heading-4">基于大数据的中风患者数据可视化分析系统-图片展示</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c6f62cd97ee4c0e9a98968f504d5a3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765368870&amp;x-signature=qa8IEyxWpx9ug0K%2FRZ56QAxQnlw%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84e856e8419a41afac481a132b4058a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765368870&amp;x-signature=6RDxGePqFf5PSR%2Be%2Ft7F%2BZ%2FLd7I%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a8a9372bce94f5099019137efc8b6e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765368870&amp;x-signature=P%2B6ZMYXjsMZee8i69C1k4FZI3RI%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35004582d1944cfdaf010ec45c63bf98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765368870&amp;x-signature=o15xZgJ0YUNBuPvzUH9Z%2Fi3ZI%2FY%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1f0061516b942bfac23e9e0841e5cc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765368870&amp;x-signature=6VjAk4lwIf5UGFslyM3JgH69Qy4%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ae4d977b0d94aed8d99ef0dd4eb9d10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765368870&amp;x-signature=IcJ7Zj1hZnKEe93WV%2FXM%2FlE%2FHkw%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dde9947dd1ee45008f48e918dca2579a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765368870&amp;x-signature=r7e6maMszFCqTmceuLmluF5b%2ByE%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c958e802e744441aaac2ff7704f92afd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5bCP5pyI5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765368870&amp;x-signature=T8nhkPsOkLxdRM6YbE7m622Cewo%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-5">基于大数据的中风患者数据可视化分析系统-代码展示</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> SparkSession
<span class="hljs-keyword">from</span> pyspark.sql.functions <span class="hljs-keyword">import</span> col, when, count, avg, <span class="hljs-built_in">sum</span> <span class="hljs-keyword">as</span> spark_sum

spark = SparkSession.builder.appName(<span class="hljs-string">"StrokeAnalysis"</span>).getOrCreate()

<span class="hljs-comment"># 核心功能1: 不同性别与年龄段的中风率对比分析 (对应维度3.1)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_stroke_rate_by_age_gender</span>(<span class="hljs-params">df</span>):
    df.createOrReplaceTempView(<span class="hljs-string">"stroke_data"</span>)
    result_df = spark.sql(<span class="hljs-string">"""
        SELECT 
            gender,
            CASE 
                WHEN age &lt; 30 THEN '青年'
                WHEN age BETWEEN 30 AND 50 THEN '中年'
                WHEN age &gt; 50 THEN '老年'
                ELSE '未知'
            END AS age_group,
            COUNT(*) AS total_count,
            SUM(CASE WHEN stroke = 1 THEN 1 ELSE 0 END) AS stroke_count,
            AVG(stroke) AS stroke_rate
        FROM stroke_data
        GROUP BY gender, age_group
        ORDER BY gender, age_group
    """</span>)
    result_df.show()

<span class="hljs-comment"># 核心功能2: 健康风险因子累积效应分析 (对应维度5.1)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_cumulative_risk_effect</span>(<span class="hljs-params">df</span>):
    risk_df = df.withColumn(<span class="hljs-string">"risk_count"</span>, 
        spark_sum(when(col(<span class="hljs-string">"hypertension"</span>) == <span class="hljs-number">1</span>, <span class="hljs-number">1</span>).otherwise(<span class="hljs-number">0</span>) +
                  when(col(<span class="hljs-string">"heart_disease"</span>) == <span class="hljs-number">1</span>, <span class="hljs-number">1</span>).otherwise(<span class="hljs-number">0</span>) +
                  when(col(<span class="hljs-string">"smoking_status"</span>) == <span class="hljs-string">"smokes"</span>, <span class="hljs-number">1</span>).otherwise(<span class="hljs-number">0</span>))
    ).groupBy(<span class="hljs-string">"risk_count"</span>)
    .agg(
        count(<span class="hljs-string">"*"</span>).alias(<span class="hljs-string">"patient_count"</span>),
        avg(<span class="hljs-string">"stroke"</span>).alias(<span class="hljs-string">"stroke_rate"</span>)
    )
    .orderBy(<span class="hljs-string">"risk_count"</span>)
    risk_df.show()

<span class="hljs-comment"># 核心功能3: 患者血糖水平分布分析 (对应维度2.2)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_glucose_level_distribution</span>(<span class="hljs-params">df</span>):
    glucose_binned_df = df.withColumn(<span class="hljs-string">"glucose_level_category"</span>,
        when(col(<span class="hljs-string">"avg_glucose_level"</span>) &lt; <span class="hljs-number">90</span>, <span class="hljs-string">"正常血糖"</span>)
        .when((col(<span class="hljs-string">"avg_glucose_level"</span>) &gt;= <span class="hljs-number">90</span>) &amp; (col(<span class="hljs-string">"avg_glucose_level"</span>) &lt; <span class="hljs-number">126</span>), <span class="hljs-string">"血糖偏高"</span>)
        .otherwise(<span class="hljs-string">"高血糖风险"</span>)
    ).groupBy(<span class="hljs-string">"glucose_level_category"</span>)
    .agg(
        count(<span class="hljs-string">"*"</span>).alias(<span class="hljs-string">"patient_count"</span>)
    )
    .orderBy(col(<span class="hljs-string">"patient_count"</span>).desc())
    glucose_binned_df.show()
</code></pre>
<h2 data-id="heading-6">基于大数据的中风患者数据可视化分析系统-结语</h2>
<blockquote>
<p>🌟 欢迎：点赞 👍 收藏 ⭐ 评论 📝</p>
<p>👇🏻 精选专栏推荐 👇🏻 欢迎订阅关注！</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761129.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761129.html" ref="nofollow noopener noreferrer">大数据实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761131.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761131.html" ref="nofollow noopener noreferrer">PHP|C#.NET|Golang实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761132.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761132.html" ref="nofollow noopener noreferrer">微信小程序|安卓实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761130.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761130.html" ref="nofollow noopener noreferrer">Python实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86721878%2Fcategory_12761126.html" target="_blank" title="https://blog.csdn.net/2401_86721878/category_12761126.html" ref="nofollow noopener noreferrer">Java实战项目</a></p>
<p>🍅 ↓↓主页获取源码联系↓↓🍅</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude用不好浪费钱？10个高级技巧让效率翻3倍]]></title>    <link>https://juejin.cn/post/7579451710303109146</link>    <guid>https://juejin.cn/post/7579451710303109146</guid>    <pubDate>2025-12-03T11:12:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579451710303109146" data-draft-id="7579460553614835763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude用不好浪费钱？10个高级技巧让效率翻3倍"/> <meta itemprop="keywords" content="Claude,AI编程,AIGC"/> <meta itemprop="datePublished" content="2025-12-03T11:12:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="技术探索家"/> <meta itemprop="url" content="https://juejin.cn/user/2735240657517816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude用不好浪费钱？10个高级技巧让效率翻3倍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2735240657517816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    技术探索家
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T11:12:35.000Z" title="Wed Dec 03 2025 11:12:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读24分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d06661f4fc741708b4b0f16824acc9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv5o6i57Si5a62:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765365155&amp;x-signature=lGsWRTuwnesYvzMKMxNt5GMT13s%3D" alt="claude-advanced-tips.jpg" loading="lazy"/></p>
<h3 data-id="heading-0">引言</h3>
<p>半年前我第一次用Claude的时候，说实话挺失望的。感觉就是普通的对话嘛，跟ChatGPT好像也没啥区别。看到同事用Claude做出那些酷炫的交互式工具，还能记住整个项目的背景，我当时真的很困惑：为什么我的Claude就是个"普通聊天机器人"？</p>
<p>后来我才明白，问题不在Claude，在我自己。我压根不知道Claude有那么多隐藏功能——Artifacts、Projects、Extended Thinking...这些功能完全改变了我的工作方式。现在回头看，那半年简直是在"浪费"Claude的能力。</p>
<p>这篇文章我想分享10个实战技巧，外加20多个可以直接复制的Prompt模板。如果你也在用Claude，但总感觉"还能更好"，那这篇文章就是为你写的。预计阅读15分钟，看完立刻就能上手，我敢说你的工作效率至少提升3倍。</p>
<hr/>
<h3 data-id="heading-1">第一部分：Claude vs ChatGPT - 你真的选对了吗？</h3>
<h4 data-id="heading-2">技巧1：了解Claude的3大核心优势</h4>
<p>说实话，刚开始我也分不清Claude和ChatGPT有什么区别。直到我尝试让它们分析一份200页的技术文档，差异才一下子显现出来。</p>
<p><strong>Claude的三大杀手锏</strong>：</p>
<p><strong>1. 200K超长上下文窗口</strong>
这个数字意味着什么？大概能装下500页的文本。我有次把整个项目的代码库（约300个文件）都扔给Claude，它居然能准确理解不同模块之间的关系。ChatGPT的128K虽然也不小，但处理超大型项目时确实力不从心。</p>
<p><strong>2. 写作质量更自然</strong>
这个说起来有点玄学，但Claude的文字确实更像人写的。Anthropic用了"宪法AI"训练方法，让Claude学会了更细腻的语言表达。我之前用它改过一篇技术博客，改出来的版本连我自己都惊讶——完全没有那种"AI味"。</p>
<p><strong>3. 代码能力和安全性更强</strong>
TELUS公司57,000名员工使用Claude，创造了超过9000万美元的业务价值。Zapier团队说他们的自动化任务量因为Claude增长了10倍。这些数字不是吹出来的，Claude在企业级应用中的表现确实出色。</p>
<p><strong>我的使用建议</strong>：</p>
<pre><code class="hljs">长文档分析、代码项目 → 用Claude
日常闲聊、需要记忆功能 → 用ChatGPT
创意brainstorming → 两个都试试
</code></pre>
<p>别误会，我不是说ChatGPT不好。只是不同场景下，真的该用对工具。</p>
<hr/>
<h3 data-id="heading-3">第二部分：基础技巧升级</h3>
<h4 data-id="heading-4">技巧2：系统提示词 - 给Claude一个"人设"</h4>
<p>这个功能我真的强烈推荐！就像给Claude戴了一个专业的"面具"，让它始终保持某种专业状态。</p>
<p><strong>系统提示词是什么？</strong>
简单说，就是在每次对话前，先告诉Claude："你是谁、该怎么回答、用什么风格"。这样你就不用每次都重复背景了。</p>
<p><strong>3种设置方式</strong>：</p>
<ol>
<li><strong>Projects</strong>（我最常用）：在Project设置中添加Custom Instructions</li>
<li><strong>Chat前置</strong>：每次对话开始时先发一条指令</li>
<li><strong>API系统消息</strong>：如果你用API，可以设置system message</li>
</ol>
<p><strong>5个场景模板</strong>，直接复制就能用：</p>
<p><strong>模板1：代码审查专家</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">你是一位资深代码审查专家，专注于：
<span class="hljs-bullet">-</span> 发现潜在的bug和性能问题
<span class="hljs-bullet">-</span> 提供具体的优化建议（而非泛泛而谈）
<span class="hljs-bullet">-</span> 评估代码的可维护性和可扩展性
<span class="hljs-bullet">-</span> 给出1-10分的评分，并说明理由

回答风格：专业但友好，用具体例子说明问题
输出格式：
<span class="hljs-bullet">1.</span> 总体评分
<span class="hljs-bullet">2.</span> 主要问题列表
<span class="hljs-bullet">3.</span> 优化建议（附代码示例）
<span class="hljs-bullet">4.</span> 优先级标注
</code></pre>
<p><strong>模板2：技术文档写作助手</strong></p>
<pre><code class="hljs language-diff" lang="diff">你是技术文档专家，帮助我创作高质量的技术文章。要求：
<span class="hljs-deletion">- 用通俗语言解释复杂概念（假设读者是聪明的新手）</span>
<span class="hljs-deletion">- 每个技术点都配实际例子</span>
<span class="hljs-deletion">- 结构清晰：大纲→详解→总结→实战</span>
<span class="hljs-deletion">- 避免术语堆砌，必要时用类比</span>

语气：60%专业 + 40%对话式
目标读者：有2-3年经验的开发者
</code></pre>
<p><strong>模板3：产品需求分析师</strong></p>
<pre><code class="hljs language-diff" lang="diff">你是产品需求分析师，负责：
<span class="hljs-deletion">- 将模糊的想法转化为清晰的需求文档</span>
<span class="hljs-deletion">- 识别潜在的边界情况和风险</span>
<span class="hljs-deletion">- 评估实现难度和优先级</span>
<span class="hljs-deletion">- 提供技术方案建议</span>

输出格式：
【需求概述】
【用户场景】（3-5个具体场景）
【功能清单】（按优先级排序）
【技术挑战】
【风险评估】
</code></pre>
<p><strong>模板4：数据分析顾问</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">你是数据分析顾问，专长：
<span class="hljs-bullet">-</span> 数据清洗和预处理
<span class="hljs-bullet">-</span> 探索性数据分析（EDA）
<span class="hljs-bullet">-</span> 可视化方案设计
<span class="hljs-bullet">-</span> 洞察提炼和决策建议

分析流程：
<span class="hljs-bullet">1.</span> 数据概览（形状、类型、缺失值）
<span class="hljs-bullet">2.</span> 关键发现（用数字说话）
<span class="hljs-bullet">3.</span> 可视化建议（具体到图表类型）
<span class="hljs-bullet">4.</span> 行动建议（至少3条）

回答中必须包含可运行的Python代码
</code></pre>
<p><strong>模板5：内容创作编辑</strong></p>
<pre><code class="hljs language-diff" lang="diff">你是内容编辑，负责优化文章：
<span class="hljs-deletion">- 去除AI味（避免"因此"、"综上所述"等）</span>
<span class="hljs-deletion">- 增强可读性（短句、段落控制在3-4行）</span>
<span class="hljs-deletion">- 融入真实情感和个人色彩</span>
<span class="hljs-deletion">- SEO优化（自然融入关键词）</span>

编辑原则：
<span class="hljs-deletion">- 保留作者的独特声音</span>
<span class="hljs-deletion">- 用"其实"、"说实话"替代书面语</span>
<span class="hljs-deletion">- 多用具体例子，少用抽象概念</span>
<span class="hljs-deletion">- 每段只表达一个核心思想</span>
</code></pre>
<p><strong>效果对比</strong>：</p>
<ul>
<li><strong>没设置系统提示词</strong>：每次都要解释"我需要专业的代码审查"，回答常常偏题</li>
<li><strong>设置后</strong>：Claude自动进入"专家模式"，回答直击要害，格式统一</li>
</ul>
<p>这个功能让我的工作效率直接翻倍。强烈建议你花5分钟设置一下。</p>
<hr/>
<h4 data-id="heading-5">技巧3：XML标签 - 让Claude理解复杂任务的秘密武器</h4>
<p>这个技巧让我的Claude使用体验直接上了一个台阶。</p>
<p><strong>为什么要用XML标签？</strong>
你有没有遇到过这种情况：任务一复杂，Claude就开始"理解偏差"？XML标签就是解决这个问题的。它把信息结构化，让Claude清楚地知道哪部分是背景、哪部分是任务、哪部分是限制。</p>
<p><strong>常用标签</strong>：</p>
<ul>
<li><code>&lt;context&gt;</code> - 背景信息</li>
<li><code>&lt;task&gt;</code> - 具体任务</li>
<li><code>&lt;examples&gt;</code> - 示例</li>
<li><code>&lt;constraints&gt;</code> - 约束条件</li>
<li><code>&lt;output_format&gt;</code> - 输出格式</li>
</ul>
<p><strong>3个实战模板</strong>：</p>
<p><strong>模板1：代码重构请求</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">context</span>&gt;</span></span>
这是一个用户认证模块，目前使用JWT token，但存在性能问题。
代码库：Python FastAPI
当前问题：token验证耗时过长，影响API响应速度
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">context</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">task</span>&gt;</span></span>
重构auth.py中的token验证逻辑，要求：
<span class="hljs-bullet">1.</span> 优化验证速度（目标：降低50%耗时）
<span class="hljs-bullet">2.</span> 保持安全性不变
<span class="hljs-bullet">3.</span> 添加缓存机制
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">task</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">constraints</span>&gt;</span></span>
<span class="hljs-bullet">-</span> 不能改变API接口
<span class="hljs-bullet">-</span> 必须向后兼容旧token
<span class="hljs-bullet">-</span> 代码风格遵循PEP 8
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">constraints</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">output_format</span>&gt;</span></span>
<span class="hljs-bullet">1.</span> 重构后的完整代码
<span class="hljs-bullet">2.</span> 性能对比分析
<span class="hljs-bullet">3.</span> 测试用例
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">output_format</span>&gt;</span></span>
</code></pre>
<p><strong>模板2：文档分析</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">context</span>&gt;</span>
这是一份产品需求文档，涉及新的支付功能。
目标用户：电商平台商家
技术栈：React + Node.js
<span class="hljs-tag">&lt;/<span class="hljs-name">context</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">task</span>&gt;</span>
分析这份需求文档，识别：
- 技术实现难点
- 潜在的安全风险
- 边界情况
- 开发时间估算
<span class="hljs-tag">&lt;/<span class="hljs-name">task</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">examples</span>&gt;</span>
边界情况示例：
- 用户在支付过程中断网
- 并发支付冲突
- 退款流程异常
<span class="hljs-tag">&lt;/<span class="hljs-name">examples</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">output_format</span>&gt;</span>
【技术难点】（1-5分标注难度）
【安全风险】（高/中/低标注等级）
【边界情况清单】
【开发时间估算】（乐观/悲观/最可能）
<span class="hljs-tag">&lt;/<span class="hljs-name">output_format</span>&gt;</span>
</code></pre>
<p><strong>模板3：多步骤任务</strong></p>
<pre><code class="hljs language-diff" lang="diff">&lt;task&gt;
帮我完成技术博客创作的完整流程：

第1步：主题分析
<span class="hljs-deletion">- 分析"React Hooks最佳实践"这个主题</span>
<span class="hljs-deletion">- 识别目标受众痛点</span>
<span class="hljs-deletion">- 列出3-5个核心要点</span>

第2步：大纲设计
<span class="hljs-deletion">- 创建文章大纲（包含引言、3-4个主要章节、结论）</span>
<span class="hljs-deletion">- 每个章节明确输出价值</span>

第3步：内容创作
<span class="hljs-deletion">- 基于大纲写出完整初稿</span>
<span class="hljs-deletion">- 融入代码示例</span>
<span class="hljs-deletion">- 字数控制在2000-2500字</span>

第4步：优化
<span class="hljs-deletion">- 去除AI味</span>
<span class="hljs-deletion">- SEO优化</span>
<span class="hljs-deletion">- 可读性提升</span>
&lt;/task&gt;

&lt;constraints&gt;
<span class="hljs-deletion">- 目标读者：有1-2年React经验的开发者</span>
<span class="hljs-deletion">- 语气：专业+对话式</span>
<span class="hljs-deletion">- 必须包含可运行的代码示例</span>
&lt;/constraints&gt;
</code></pre>
<p><strong>效果对比</strong>：</p>
<ul>
<li><strong>无结构</strong>："帮我分析这个需求文档" → Claude可能会漏掉关键点</li>
<li><strong>XML结构化</strong>：清晰标注要求 → Claude的回答全面且准确</li>
</ul>
<p>这个技巧特别适合复杂任务。试试看，你会爱上这种精准控制感。</p>
<hr/>
<h4 data-id="heading-6">技巧4：Few-shot Examples - 教Claude"看样学样"</h4>
<p>就像教小孩学习一样，给几个例子效果最好。</p>
<p><strong>什么是Few-shot Learning？</strong>
简单说，就是给Claude看几个"示例答案"，让它模仿你想要的风格和格式。特别适合格式化任务，比如数据提取、代码格式统一、写作风格模仿。</p>
<p><strong>黄金法则</strong>：3-5个示例最佳，太少学不会，太多反而混乱。</p>
<p><strong>3个应用场景</strong>：</p>
<p><strong>场景1：代码格式统一</strong></p>
<pre><code class="hljs language-python" lang="python">任务：将所有函数注释统一为Google风格

示例<span class="hljs-number">1</span>：
输入：
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-comment"># 计算两个数的和</span>
    <span class="hljs-keyword">return</span> a + b

输出：
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-string">"""计算两个数的和

    Args:
        a (int): 第一个加数
        b (int): 第二个加数

    Returns:
        int: 两个数的和
    """</span>
    <span class="hljs-keyword">return</span> a + b

示例<span class="hljs-number">2</span>：
输入：
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):
    <span class="hljs-comment"># 根据ID获取用户信息</span>
    <span class="hljs-keyword">return</span> db.query(<span class="hljs-built_in">id</span>)

输出：
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):
    <span class="hljs-string">"""根据ID获取用户信息

    Args:
        id (str): 用户唯一标识符

    Returns:
        dict: 用户信息字典，包含name、email等字段
        None: 如果用户不存在
    """</span>
    <span class="hljs-keyword">return</span> db.query(<span class="hljs-built_in">id</span>)

现在请处理以下函数：
[你的代码]
</code></pre>
<p><strong>场景2：写作风格模仿</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">任务：将技术说明改写为对话式风格

示例<span class="hljs-number">1</span>：
输入：API调用频率受到限制，超过阈值将返回<span class="hljs-number">429</span>错误。
输出：注意哦，API不能无限制调用。如果你请求太频繁，会收到<span class="hljs-number">429</span>错误，意思是<span class="hljs-string">"慢点，让服务器歇会儿"</span>。

示例<span class="hljs-number">2</span>：
输入：使用JWT token进行身份认证，token有效期为<span class="hljs-number">24</span>小时。
输出：登录后你会拿到一个JWT token，把它当作你的<span class="hljs-string">"通行证"</span>。这个通行证<span class="hljs-number">24</span>小时有效，过期后需要重新登录。

示例<span class="hljs-number">3</span>：
输入：数据库连接采用连接池技术，最大连接数为<span class="hljs-number">100</span>。
输出：为了提升性能，我们用了连接池技术。你可以把它想象成一个<span class="hljs-string">"连接仓库"</span>，里面准备了<span class="hljs-number">100</span>个连接，用完就还回去，下次直接取，不用重新建立。

现在请改写：
[你的技术文本]
</code></pre>
<p><strong>场景3：数据提取任务</strong></p>
<pre><code class="hljs language-css" lang="css">任务：从产品描述中提取结构化信息

示例<span class="hljs-number">1</span>：
输入：iPhone <span class="hljs-number">15</span> Pro，<span class="hljs-number">256</span>GB存储，钛金属材质，支持<span class="hljs-number">5</span>G，价格<span class="hljs-number">8999</span>元
输出：
{
  "product": <span class="hljs-string">"iPhone 15 Pro"</span>,
  <span class="hljs-string">"storage"</span>: <span class="hljs-string">"256GB"</span>,
  <span class="hljs-string">"material"</span>: <span class="hljs-string">"钛金属"</span>,
  <span class="hljs-string">"connectivity"</span>: <span class="hljs-string">"5G"</span>,
  <span class="hljs-string">"price"</span>: <span class="hljs-number">8999</span>
}

示例<span class="hljs-number">2</span>：
输入：MacBook Air M2，<span class="hljs-number">8</span>核CPU，<span class="hljs-number">13.6</span>英寸视网膜显示屏，午夜色，<span class="hljs-number">9499</span>元起
输出：
{
  "product": <span class="hljs-string">"MacBook Air M2"</span>,
  <span class="hljs-string">"cpu"</span>: <span class="hljs-string">"8核"</span>,
  <span class="hljs-string">"screen"</span>: <span class="hljs-string">"13.6英寸视网膜"</span>,
  <span class="hljs-string">"color"</span>: <span class="hljs-string">"午夜色"</span>,
  <span class="hljs-string">"price"</span>: <span class="hljs-number">9499</span>
}

现在请提取：
<span class="hljs-selector-attr">[你的产品描述]</span>
</code></pre>
<p><strong>我的经验</strong>：质量比数量重要。3个高质量示例 &gt; 10个随意的例子。而且示例要覆盖不同情况（简单、复杂、边界情况）。</p>
<hr/>
<h4 data-id="heading-7">技巧5：Extended Thinking - 让Claude"深度思考"</h4>
<p>有时候慢就是快，让Claude多想想真的不一样。</p>
<p><strong>Extended Thinking是什么？</strong>
这是Claude 4的新功能，可以给Claude最高32K tokens的"思考预算"（大概24,000字的思考过程）。它会在回答前先深度思考，推理过程你都能看到。</p>
<p><strong>适用场景</strong>：</p>
<ul>
<li>复杂代码bug调试</li>
<li>多轮推理问题（比如"为什么这个算法慢？"）</li>
<li>战略规划分析</li>
<li>需要权衡多个因素的决策</li>
</ul>
<p><strong>如何触发</strong>：</p>
<ol>
<li><strong>直接要求</strong>："请一步步思考这个问题"</li>
<li><strong>开启Extended Thinking模式</strong>（在设置中）</li>
</ol>
<p><strong>2个实战案例</strong>：</p>
<p><strong>案例1：复杂bug调试</strong></p>
<pre><code class="hljs language-diff" lang="diff">&lt;task&gt;
这段代码有一个难以复现的bug，用户报告在高并发时偶尔会出现数据不一致。
请使用Extended Thinking深度分析可能的原因。

[代码粘贴]

要求：
<span class="hljs-deletion">- 逐步分析每个可能的原因</span>
<span class="hljs-deletion">- 考虑并发、锁机制、数据库事务等因素</span>
<span class="hljs-deletion">- 给出最可能的3个原因及解决方案</span>
&lt;/task&gt;
</code></pre>
<p><strong>案例2：商业策略分析</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">task</span>&gt;</span></span>
我们公司考虑进入AI工具市场，请用Extended Thinking分析：
<span class="hljs-bullet">1.</span> 市场机会（TAM、竞争格局）
<span class="hljs-bullet">2.</span> 我们的优势和劣势
<span class="hljs-bullet">3.</span> 风险因素
<span class="hljs-bullet">4.</span> 进入策略建议

背景：
<span class="hljs-bullet">-</span> 我们是一家B2B SaaS公司，有10万企业用户
<span class="hljs-bullet">-</span> 现有产品是项目管理工具
<span class="hljs-bullet">-</span> 技术团队50人，其中5人有AI经验
<span class="hljs-bullet">-</span> 预算500万美元

请深度思考后给出完整的战略分析报告。
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">task</span>&gt;</span></span>
</code></pre>
<p><strong>高级技巧</strong>：</p>
<p><strong>调整思考预算</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">请使用最大思考预算（32K tokens）分析这个系统架构设计，
重点考虑：
<span class="hljs-deletion">- 可扩展性（未来用户量10倍增长）</span>
<span class="hljs-deletion">- 可维护性（新人能否快速上手）</span>
<span class="hljs-deletion">- 成本（服务器、数据库、CDN成本预估）</span>
<span class="hljs-deletion">- 风险（单点故障、数据丢失风险）</span>

[系统架构图]
</code></pre>
<p><strong>查看思考过程</strong>：
开启Extended Thinking后，Claude会展示思考步骤。你可以看到它如何一步步推理，这对学习和调试很有帮助。</p>
<p><strong>组合使用</strong>：
Extended Thinking + Projects效果最佳。Claude可以基于项目知识库深度思考。</p>
<p><strong>效果对比</strong>：</p>
<ul>
<li><strong>普通模式</strong>：快速给出答案，但可能忽略细节</li>
<li><strong>Extended Thinking</strong>：深度推理，考虑多个角度，更可靠</li>
</ul>
<p>这个功能就像给Claude装了一个"深度思考模式"。遇到复杂问题，别急着要答案，让它慢慢想。</p>
<hr/>
<h3 data-id="heading-8">第三部分：高级功能深度使用</h3>
<h4 data-id="heading-9">技巧6：Artifacts - 3分钟做一个交互式工具</h4>
<p>第一次用Artifacts的时候，我真的震撼到了。</p>
<p><strong>Artifacts是什么？</strong>
简单说，就是Claude创建的"独立内容"——可以是交互式网页、代码工具、数据可视化图表，甚至是小游戏。全球用户已经创建了5亿多个Artifacts，这个数字说明它真的很实用。</p>
<p><strong>2025年的新特性</strong>：</p>
<ul>
<li>MCP集成（可以连接GitHub、Notion等工具）</li>
<li>持久化存储（你的Artifacts不会丢失）</li>
<li>更强的交互性</li>
</ul>
<p><strong>支持的类型</strong>：</p>
<ul>
<li>交互式网页（HTML/CSS/JavaScript）</li>
<li>数据可视化（图表、dashboard）</li>
<li>代码工具（计算器、转换器、生成器）</li>
<li>文档和教程（Markdown格式）</li>
</ul>
<p><strong>3个实战案例</strong>：</p>
<p><strong>案例1：数据可视化dashboard</strong></p>
<pre><code class="hljs language-diff" lang="diff">请创建一个Artifact，展示以下销售数据：

数据：
2024年Q1: 120万
2024年Q2: 150万
2024年Q3: 180万
2024年Q4: 210万

要求：
<span class="hljs-deletion">- 类型：交互式柱状图</span>
<span class="hljs-deletion">- 功能：鼠标悬停显示具体数值</span>
<span class="hljs-deletion">- 样式：现代简约风格，使用蓝色渐变</span>
<span class="hljs-deletion">- 额外显示：同比增长率</span>
</code></pre>
<p><strong>案例2：交互式教程</strong></p>
<pre><code class="hljs language-diff" lang="diff">创建一个Artifact，教新手如何使用Git的基本命令。

要求：
<span class="hljs-deletion">- 格式：分步骤教程</span>
<span class="hljs-deletion">- 每步都有代码示例</span>
<span class="hljs-deletion">- 包含常见错误和解决方法</span>
<span class="hljs-deletion">- 添加"试一试"按钮，模拟命令执行结果</span>
<span class="hljs-deletion">- 风格：友好、无术语</span>
</code></pre>
<p><strong>案例3：实用工具 - JSON格式化器</strong></p>
<pre><code class="hljs language-diff" lang="diff">创建一个JSON格式化工具Artifact：

功能：
<span class="hljs-deletion">- 输入：未格式化的JSON字符串</span>
<span class="hljs-deletion">- 处理：自动格式化、验证语法、高亮显示</span>
<span class="hljs-deletion">- 输出：美化后的JSON + 错误提示</span>
<span class="hljs-deletion">- 额外：提供"压缩"和"美化"两种模式</span>

交互：
<span class="hljs-deletion">- 实时格式化（输入时立即反馈）</span>
<span class="hljs-deletion">- 一键复制格式化结果</span>
<span class="hljs-deletion">- 错误行高亮显示</span>

样式：
<span class="hljs-deletion">- 暗色主题</span>
<span class="hljs-deletion">- 代码高亮（用不同颜色区分键、值、数字）</span>
<span class="hljs-deletion">- 响应式设计（手机上也好用）</span>
</code></pre>
<p><strong>完整操作流程</strong>：</p>
<ol>
<li>用自然语言描述你要的工具</li>
<li>Claude自动生成Artifact</li>
<li>在右侧预览效果</li>
<li>如果不满意，直接说"把颜色改成绿色"或"增加一个搜索功能"</li>
<li>满意后可以分享链接或导出代码</li>
</ol>
<p><strong>我的使用技巧</strong>：</p>
<ul>
<li><strong>明确说明交互</strong>：别只说"做个图表"，说清楚"点击可以筛选数据"</li>
<li><strong>风格描述具体</strong>：别说"好看的设计"，说"扁平化风格，用#4A90E2蓝色"</li>
<li><strong>给出真实数据</strong>：用实际数据测试效果更准确</li>
</ul>
<p>Artifacts真的是我现在最常用的功能之一。以前我要花半天做的演示工具，现在3分钟就能搞定。</p>
<hr/>
<h4 data-id="heading-10">技巧7：Projects - 告别重复解释背景</h4>
<p>自从用了Projects，我再也不用每次都解释项目背景了。</p>
<p><strong>Projects是什么？</strong>
可以把它理解成给Claude准备的"知识库"。你上传项目相关的代码、文档、数据，Claude会自动记住。之后每次对话，它都能调用这些背景信息，不用你重复说明。</p>
<p><strong>核心特性</strong>：</p>
<ul>
<li><strong>200K上下文容量</strong>（大约500页文本）</li>
<li><strong>团队协作</strong>（可以设置不同成员的权限）</li>
<li><strong>与Artifacts结合使用</strong>（基于Project知识创建工具）</li>
</ul>
<p><strong>4步设置流程</strong>：</p>
<p><strong>第1步：创建Project</strong></p>
<ul>
<li>点击"Projects"按钮</li>
<li>命名（比如"电商后端开发"）</li>
<li>选择团队成员（如果是团队项目）</li>
</ul>
<p><strong>第2步：上传背景资料</strong>
我通常会上传：</p>
<ul>
<li>代码库（主要文件，不是全部）</li>
<li>技术文档（API文档、架构图）</li>
<li>数据字典</li>
<li>品牌指南（如果是内容项目）</li>
<li>之前的对话记录</li>
</ul>
<p><strong>第3步：设置Custom Instructions</strong></p>
<pre><code class="hljs language-erlang" lang="erlang">项目：电商平台后端开发
技术栈：Python FastAPI + PostgreSQL + Redis
代码规范：PEP <span class="hljs-number">8</span> + Google风格注释
测试要求：单元测试覆盖率&gt;<span class="hljs-number">80</span><span class="hljs-comment">%</span>

你的角色：后端开发专家
回答风格：直接给出可运行代码，附带简要说明
</code></pre>
<p><strong>第4步：开始对话</strong>
现在你可以直接问："用户模块的认证逻辑怎么优化？"
Claude会自动调用上传的代码和文档，给出针对性建议。</p>
<p><strong>5个应用场景</strong>：</p>
<p><strong>场景1：项目开发</strong>
上传内容：</p>
<ul>
<li>src/目录下的核心代码</li>
<li>README.md</li>
<li>技术架构文档</li>
<li>API设计文档</li>
</ul>
<p>效果：Claude理解你的整个项目结构，可以跨文件分析问题。</p>
<p><strong>场景2：内容创作</strong>
上传内容：</p>
<ul>
<li>品牌指南</li>
<li>之前的文章样本</li>
<li>目标受众画像</li>
<li>SEO关键词列表</li>
</ul>
<p>效果：Claude生成的内容自动符合你的品牌调性和风格。</p>
<p><strong>场景3：学习研究</strong>
上传内容：</p>
<ul>
<li>课程讲义</li>
<li>论文PDF</li>
<li>笔记</li>
<li>练习题</li>
</ul>
<p>效果：Claude成为你的"个人导师"，基于课程内容回答问题。</p>
<p><strong>场景4：数据分析</strong>
上传内容：</p>
<ul>
<li>数据集CSV</li>
<li>数据字典</li>
<li>分析框架文档</li>
<li>之前的分析报告</li>
</ul>
<p>效果：Claude理解你的数据结构，快速生成分析代码。</p>
<p><strong>场景5：团队协作</strong>
上传内容：</p>
<ul>
<li>团队规范文档</li>
<li>项目路线图</li>
<li>会议记录</li>
<li>决策日志</li>
</ul>
<p>效果：所有团队成员与Claude对话时，基于相同的背景知识。</p>
<p><strong>最佳实践</strong>：</p>
<ul>
<li><strong>文档命名清晰</strong>：<code>架构设计.md</code> 比 <code>doc1.md</code> 好</li>
<li><strong>定期更新</strong>：项目有重大变动及时更新知识库</li>
<li><strong>控制文件大小</strong>：上传核心内容即可，不是越多越好</li>
<li><strong>多Project管理</strong>：不同项目分开，别混在一起</li>
</ul>
<p>我现在有5个活跃的Projects：公司项目、个人博客、学习Python、数据分析、写作助手。每个Project就像一个"专属Claude"。</p>
<hr/>
<h4 data-id="heading-11">技巧8：MCP集成 - 连接你的工作流</h4>
<p>MCP让Claude真正融入了我的工作流。</p>
<p><strong>MCP（Model Context Protocol）是什么？</strong>
简单说，就是让Claude连接你日常使用的工具——GitHub、Notion、Slack、Jira等。Claude可以直接读取和操作这些工具中的数据。</p>
<p><strong>可连接的工具</strong>（部分列表）：</p>
<ul>
<li>GitHub（代码审查、issue管理）</li>
<li>Notion（文档读写）</li>
<li>Slack（消息处理）</li>
<li>Google Drive（文件访问）</li>
<li>Jira（任务管理）</li>
<li>Calendar（日程安排）</li>
</ul>
<p><strong>3个实战案例</strong>：</p>
<p><strong>案例1：GitHub集成 - 代码审查自动化</strong></p>
<pre><code class="hljs language-diff" lang="diff">通过MCP访问GitHub仓库 mycompany/backend，
分析最近10个Pull Requests，识别：
<span class="hljs-deletion">- 常见的代码问题</span>
<span class="hljs-deletion">- 代码审查建议是否被采纳</span>
<span class="hljs-deletion">- 哪些开发者需要更多代码质量培训</span>

生成一份团队代码质量报告。
</code></pre>
<p><strong>案例2：Notion集成 - 自动生成文档</strong></p>
<pre><code class="hljs language-diff" lang="diff">通过MCP访问Notion数据库"产品需求"，
将本周新增的5个需求整理成：
<span class="hljs-deletion">- 技术可行性分析文档</span>
<span class="hljs-deletion">- 开发任务分解（存入Jira）</span>
<span class="hljs-deletion">- 时间估算表</span>

自动创建在Notion的"开发文档"页面下。
</code></pre>
<p><strong>案例3：Slack集成 - 智能消息处理</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">通过MCP监听Slack的#support频道，
当有用户提问时：
<span class="hljs-bullet">1.</span> 搜索历史解决方案
<span class="hljs-bullet">2.</span> 如果找到类似问题，直接回复解决方法
<span class="hljs-bullet">3.</span> 如果是新问题，@相关技术人员，并总结问题要点

每天生成一份支持问题汇总报告。
</code></pre>
<p><strong>配置步骤</strong>（以GitHub为例）：</p>
<ol>
<li>安装MCP Server（按官方文档操作）</li>
<li>配置GitHub token</li>
<li>在Claude中授权MCP连接</li>
<li>测试：<code>通过MCP列出我的所有仓库</code></li>
</ol>
<p><strong>我的使用心得</strong>：
MCP的真正价值不是"控制工具"，而是"打通工作流"。比如我现在的写作流程：</p>
<ol>
<li>Claude基于Projects中的知识库写文章</li>
<li>通过MCP自动保存到Notion</li>
<li>通过MCP创建Jira任务：排版、配图、发布</li>
<li>通过MCP发送Slack通知：文章已完成初稿</li>
</ol>
<p>整个流程自动化，我只需要专注内容创作。</p>
<hr/>
<h4 data-id="heading-12">技巧9：Prompt链接技巧 - 组合拳效率翻倍</h4>
<p>掌握了这个技巧，感觉Claude变成了我的专属团队。</p>
<p><strong>什么是Prompt链接？</strong>
把一个复杂任务拆分成多个步骤，每步用专门的Prompt，结果层层传递。就像工厂的流水线，每个环节做好自己的事。</p>
<p><strong>设计原则</strong>：</p>
<ul>
<li><strong>模块化</strong>：每步功能单一明确</li>
<li><strong>上下文传递</strong>：下一步自动引用上一步结果</li>
<li><strong>错误处理</strong>：每步验证输出质量</li>
</ul>
<p><strong>完整工作流示例</strong>：</p>
<p><strong>工作流1：技术博客创作（5步）</strong></p>
<pre><code class="hljs language-diff" lang="diff">第1步：主题研究
&lt;task&gt;
研究主题"React Hooks最佳实践"：
<span class="hljs-deletion">- 分析目标读者痛点（1-2年经验开发者）</span>
<span class="hljs-deletion">- 列出5个核心要点</span>
<span class="hljs-deletion">- 推荐3-5篇权威参考文章</span>
&lt;/task&gt;

第2步：大纲设计
&lt;task&gt;
基于研究结果，设计文章大纲：
<span class="hljs-deletion">- 引言（痛点共鸣）</span>
<span class="hljs-deletion">- 3-4个主要章节</span>
<span class="hljs-deletion">- 每个章节包含：概念、示例、最佳实践、常见错误</span>
<span class="hljs-deletion">- 结论（总结+行动建议）</span>
&lt;/task&gt;

第3步：内容创作
&lt;task&gt;
基于大纲创作完整初稿：
<span class="hljs-deletion">- 字数：2000-2500字</span>
<span class="hljs-deletion">- 包含可运行的代码示例</span>
<span class="hljs-deletion">- 语气：专业+对话式</span>
<span class="hljs-deletion">- 融入个人经历和真实案例</span>
&lt;/task&gt;

第4步：代码示例优化
&lt;task&gt;
检查并优化所有代码示例：
<span class="hljs-deletion">- 确保可运行</span>
<span class="hljs-deletion">- 添加详细注释</span>
<span class="hljs-deletion">- 提供CodeSandbox链接</span>
<span class="hljs-deletion">- 包含边界情况处理</span>
&lt;/task&gt;

第5步：SEO和可读性优化
&lt;task&gt;
最终优化：
<span class="hljs-deletion">- 去除AI味（避免"因此"、"综上所述"）</span>
<span class="hljs-deletion">- SEO优化（自然融入关键词"React Hooks"、"最佳实践"）</span>
<span class="hljs-deletion">- 可读性提升（短段落、小标题、列表）</span>
<span class="hljs-deletion">- 添加元描述和标签建议</span>
&lt;/task&gt;
</code></pre>
<p><strong>工作流2：代码审查到部署（4步）</strong></p>
<pre><code class="hljs language-diff" lang="diff">第1步：代码审查
审查这个PR，输出：
<span class="hljs-deletion">- 代码质量评分（1-10）</span>
<span class="hljs-deletion">- 主要问题列表</span>
<span class="hljs-deletion">- 安全风险（如有）</span>
<span class="hljs-deletion">- 优化建议</span>

第2步：生成测试用例
基于代码审查结果，生成：
<span class="hljs-deletion">- 单元测试（覆盖核心逻辑）</span>
<span class="hljs-deletion">- 集成测试（覆盖关键流程）</span>
<span class="hljs-deletion">- 边界情况测试</span>

第3步：更新文档
自动更新：
<span class="hljs-deletion">- API文档（如有接口变更）</span>
<span class="hljs-deletion">- README（如有使用方式变更）</span>
<span class="hljs-deletion">- CHANGELOG（记录本次更新）</span>

第4步：生成部署检查清单
输出部署前检查清单：
<span class="hljs-deletion">- 测试通过情况</span>
<span class="hljs-deletion">- 数据库迁移脚本</span>
<span class="hljs-deletion">- 配置文件更新</span>
<span class="hljs-deletion">- 回滚方案</span>
</code></pre>
<p><strong>最佳实践</strong>：</p>
<p><strong>1. 明确输出格式</strong>
每步都规定输出格式，方便下一步使用：</p>
<pre><code class="hljs language-erlang" lang="erlang">第<span class="hljs-number">1</span>步输出格式：
【核心要点】
<span class="hljs-number">1</span>. ...
<span class="hljs-number">2</span>. ...

【目标读者痛点】
- ...
- ...

第<span class="hljs-number">2</span>步：基于上一步的【核心要点】设计大纲...
</code></pre>
<p><strong>2. 验证和错误处理</strong></p>
<pre><code class="hljs language-diff" lang="diff">第3步：创作初稿
...

验证：
<span class="hljs-deletion">- 字数是否在2000-2500范围？</span>
<span class="hljs-deletion">- 是否包含至少3个代码示例？</span>
<span class="hljs-deletion">- 是否融入了个人经历？</span>

如果不满足，请重新生成。
</code></pre>
<p><strong>3. Claude Skills的应用</strong>
如果你用Claude Code，可以创建Skills（可复用的Prompt模板）：</p>
<ul>
<li><code>blog-research.md</code> - 主题研究步骤</li>
<li><code>blog-outline.md</code> - 大纲设计步骤</li>
<li><code>blog-draft.md</code> - 内容创作步骤</li>
</ul>
<p>然后用 <code>/blog-research</code> 快速调用。</p>
<p><strong>我的实战经验</strong>：
我现在有5套常用工作流，全部模板化。每次只需要改主题和具体要求，其他步骤自动执行。效率提升不是一点点。</p>
<hr/>
<h3 data-id="heading-13">第四部分：实战场景整合</h3>
<h4 data-id="heading-14">技巧10：5个开箱即用的完整工作流</h4>
<p>这5个工作流都是我实际在用的，真的很实用。</p>
<p><strong>工作流1：技术写作（节省60%时间）</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 主题研究（Projects知识库 + WebSearch）
<span class="hljs-bullet">2.</span> 大纲规划（系统提示词：技术文档专家）
<span class="hljs-bullet">3.</span> 内容创作（Few-shot Examples + XML标签）
<span class="hljs-bullet">4.</span> 代码示例生成（Artifacts创建交互式demo）
<span class="hljs-bullet">5.</span> SEO优化（Extended Thinking深度分析关键词）
<span class="hljs-bullet">6.</span> 发布（MCP自动推送到Notion + GitHub）
</code></pre>
<p><strong>工作流2：代码开发（节省50%时间）</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 需求分析（系统提示词：产品分析师）
<span class="hljs-bullet">2.</span> 架构设计（Extended Thinking + Projects技术文档）
<span class="hljs-bullet">3.</span> 代码实现（逐步生成，每步验证）
<span class="hljs-bullet">4.</span> 单元测试（基于代码自动生成）
<span class="hljs-bullet">5.</span> 文档生成（Artifacts创建API文档）
</code></pre>
<p><strong>工作流3：数据分析（节省70%时间）</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 数据清洗（Python代码生成）
<span class="hljs-bullet">2.</span> 探索分析（系统提示词：数据分析师）
<span class="hljs-bullet">3.</span> 可视化（Artifacts创建交互式dashboard）
<span class="hljs-bullet">4.</span> 洞察报告（Extended Thinking深度分析）
<span class="hljs-bullet">5.</span> 决策建议（基于数据的具体行动建议）
</code></pre>
<p><strong>工作流4：市场调研（节省65%时间）</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 信息收集（WebSearch + 资料整理）
<span class="hljs-bullet">2.</span> 竞品分析（系统提示词：战略分析师）
<span class="hljs-bullet">3.</span> SWOT分析（Extended Thinking）
<span class="hljs-bullet">4.</span> 战略建议（Projects + 公司背景知识）
<span class="hljs-bullet">5.</span> PPT生成（Artifacts创建演示文稿）
</code></pre>
<p><strong>工作流5：内容创作（节省55%时间）</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 选题研究（WebSearch + 趋势分析）
<span class="hljs-bullet">2.</span> 大纲规划（系统提示词：内容策略师）
<span class="hljs-bullet">3.</span> 初稿创作（Few-shot Examples 风格模仿）
<span class="hljs-bullet">4.</span> AI味去除（系统提示词：人性化编辑）
<span class="hljs-bullet">5.</span> SEO优化（关键词自然融入 + meta信息生成）
</code></pre>
<p><strong>使用建议</strong>：</p>
<ul>
<li>选一个工作流先试试，熟练后再尝试其他</li>
<li>根据自己的需求调整步骤</li>
<li>把常用的工作流保存成模板</li>
</ul>
<p>这些工作流我每天都在用，真的让工作效率提升了一个档次。</p>
<hr/>
<h3 data-id="heading-15">结论</h3>
<p>好了，10个技巧全部分享完了。从基础的系统提示词、XML标签，到高级的Artifacts、Projects、MCP集成，再到最后的Prompt链接技巧。</p>
<p><strong>快速回顾一下</strong>：</p>
<ol>
<li>Claude vs ChatGPT - 选对工具</li>
<li>系统提示词 - 给Claude一个"人设"</li>
<li>XML标签 - 结构化复杂任务</li>
<li>Few-shot Examples - 教Claude"看样学样"</li>
<li>Extended Thinking - 让Claude深度思考</li>
<li>Artifacts - 3分钟做交互式工具</li>
<li>Projects - 告别重复解释背景</li>
<li>MCP集成 - 连接工作流</li>
<li>Prompt链接 - 组合拳效率翻倍</li>
<li>完整工作流 - 5个开箱即用的方案</li>
</ol>
<p><strong>我的建议</strong>：别想着一次学会所有技巧。选1-2个最适合你当前需求的，今天就试试。比如：</p>
<ul>
<li>如果你经常处理同一个项目 → 试试Projects</li>
<li>如果你需要创建工具或图表 → 试试Artifacts</li>
<li>如果你的任务很复杂 → 试试XML标签 + Extended Thinking</li>
</ul>
<p>Claude还在快速进化，每几个月就有新功能上线。持续关注官方更新，保持学习，你会发现AI工具的潜力远超想象。</p>
<p>说实话，半年前我真没想到Claude能这么强大。现在它已经成了我的"第二大脑"——帮我写代码、分析数据、创作内容、管理项目。工作效率提升3倍不是夸张，是真实的体验。</p>
<p>你呢？用Claude发现了什么好用的技巧？欢迎在评论区分享，说不定能帮到更多人。</p>
<p>AI工具的真正价值，在于你如何使用它。希望这篇文章能帮你彻底释放Claude的全部潜力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【python大数据毕设实战】强迫症特征与影响因素数据分析系统、Hadoop、计算机毕业设计、包括数据爬取、数据分析、数据可视化、机器学习、实战教学]]></title>    <link>https://juejin.cn/post/7579441333166456841</link>    <guid>https://juejin.cn/post/7579441333166456841</guid>    <pubDate>2025-12-03T11:49:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579441333166456841" data-draft-id="7579451710303174682" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【python大数据毕设实战】强迫症特征与影响因素数据分析系统、Hadoop、计算机毕业设计、包括数据爬取、数据分析、数据可视化、机器学习、实战教学"/> <meta itemprop="keywords" content="后端,Python,MySQL"/> <meta itemprop="datePublished" content="2025-12-03T11:49:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="计算机毕设匠心工作室"/> <meta itemprop="url" content="https://juejin.cn/user/2452372492400835"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【python大数据毕设实战】强迫症特征与影响因素数据分析系统、Hadoop、计算机毕业设计、包括数据爬取、数据分析、数据可视化、机器学习、实战教学
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2452372492400835/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    计算机毕设匠心工作室
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T11:49:02.000Z" title="Wed Dec 03 2025 11:49:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>🍊作者：计算机毕设匠心工作室</p>
<p>🍊简介：毕业后就一直专业从事计算机软件程序开发，至今也有8年工作经验。擅长Java、Python、微信小程序、安卓、大数据、PHP、.NET|C#、Golang等。</p>
<p>擅长：按照需求定制化开发项目、 源码、对代码进行完整讲解、文档撰写、ppt制作。</p>
<p>🍊心愿：点赞 👍 收藏 ⭐评论 📝</p>
<p>👇🏻 精彩专栏推荐订阅 👇🏻 不然下次找不到哟~</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754938.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754938.html" ref="nofollow noopener noreferrer">Java实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754940.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754940.html" ref="nofollow noopener noreferrer">Python实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754945.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754945.html" ref="nofollow noopener noreferrer">微信小程序|安卓实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754947.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754947.html" ref="nofollow noopener noreferrer">大数据实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754949.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754949.html" ref="nofollow noopener noreferrer">PHP|C#.NET|Golang实战项目</a></p>
<p>🍅 ↓↓文末获取源码联系↓↓🍅</p>
</blockquote>
<h2 data-id="heading-0">基于大数据的强迫症特征与影响因素数据分析系统-功能介绍</h2>
<p>本系统是一个基于大数据技术的强迫症特征与影响因素数据分析系统，旨在为心理健康领域的研究提供一个高效、可扩展的数据处理与分析平台。系统整体采用Hadoop生态进行构建，利用HDFS作为底层分布式文件系统，实现对大规模问卷数据的可靠存储。核心计算引擎采用Apache Spark，通过其内存计算能力，对海量数据进行快速清洗、转换和多维度分析，远超传统单机处理工具的性能瓶颈。系统后端采用Python语言开发，利用PySpark无缝对接Spark集群，实现了从数据预处理、特征工程到高级分析的完整流程。具体功能涵盖了四大核心模块：首先，对强迫症患者的人口学特征进行深入剖析，包括年龄、性别、教育水平与病情严重度的交叉分析；其次，对临床特征进行量化研究，探究每日仪式时长、痛苦程度等功能损害指标与病情的关联性；再者，系统对诊断与治疗现状进行统计，揭示不同严重程度下的治疗模式；最后，也是本系统的亮点，系统利用K-Means等机器学习聚类算法，基于患者的核心症状得分进行智能分群，识别出具有不同症状主导模式的强迫症亚型，并为每个亚群绘制详细的人口学与临床画像，从而为精细化诊断和个性化治疗方案的探索提供数据支持与新的视角。</p>
<h2 data-id="heading-1">基于大数据的强迫症特征与影响因素数据分析系统-选题背景意义</h2>
<p>选题背景
强迫症（OCD）是一种常见且致残性高的精神障碍，患者常被反复出现的强迫思维和/或强迫行为所困扰，严重影响其日常生活、工作和社交功能。长期以来，对强迫症的理解与研究多依赖于临床访谈和小样本的问卷调查，虽然这些方法为疾病的基础认知奠定了基础，但它们在捕捉疾病的异质性、识别潜在的亚型以及探索复杂影响因素方面存在局限性。随着信息技术的飞速发展，通过在线平台等方式收集大规模心理健康数据已成为可能，这些数据集蕴含了比传统研究更为丰富和复杂的信息。然而，数据量的激增也带来了新的挑战，比如数据中普遍存在的缺失值、异常值以及数据不一致等问题，传统的数据处理工具和分析方法难以高效、准确地应对。因此，如何利用现代大数据技术，对这些宝贵的心理健康数据进行有效管理和深度挖掘，以揭示隐藏在数据背后的模式和规律，成为当前精神卫生研究领域一个亟待探索的新方向。
选题意义
本课题的意义在于探索并实践了一套完整的大数据分析流程，将其应用于具体的心理健康问题，具有一定的方法论参考价值和实际应用潜力。从方法论层面看，本项目详细展示了如何运用Hadoop和Spark等主流大数据框架，处理真实世界中“脏”数据的全过程，包括数据清洗、缺失值填充、特征转换等关键步骤。这对于其他需要处理类似复杂数据集的学生或研究人员来说，提供了一个可供参考的实践范例，降低了他们学习和应用大数据技术的门槛。从实际应用角度看，虽然本系统作为一个毕业设计，其结论不能直接用于临床诊断，但它所实现的聚类分析功能，能够帮助研究人员从宏观上识别出强迫症患者群体中可能存在的不同症状组合模式。这些通过数据驱动的分群结果，或许能为后续的病因学研究、或者开发更具针对性的心理干预或治疗方案提供一些初步的线索和启发。换个角度看，本系统将复杂的分析结果通过可视化图表进行直观展示，也降低了非专业人士理解复杂数据的难度，有助于心理健康知识的科普和传播。</p>
<h2 data-id="heading-2">基于大数据的强迫症特征与影响因素数据分析系统-技术选型</h2>
<p>大数据框架：Hadoop+Spark（本次没用Hive，支持定制）
开发语言：Python+Java（两个版本都支持）
后端框架：Django+Spring Boot(Spring+SpringMVC+Mybatis)（两个版本都支持）
前端：Vue+ElementUI+Echarts+HTML+CSS+JavaScript+jQuery
详细技术点：Hadoop、HDFS、Spark、Spark SQL、Pandas、NumPy
数据库：MySQL</p>
<h2 data-id="heading-3">基于大数据的强迫症特征与影响因素数据分析系统-视频展示</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1hy2xB3EyK%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1hy2xB3EyK/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">基于大数据的强迫症特征与影响因素数据分析系统-视频展示</a></p>
<h2 data-id="heading-4">基于大数据的强迫症特征与影响因素数据分析系统-图片展示</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6744d06e6bff4901b58218832843d7fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765367341&amp;x-signature=FFhXNqUrcl24Yhax%2BcC%2BWSrIkRE%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19a87d66b41f44929d29b62bf92a64f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765367341&amp;x-signature=oIDgyGYiJIKhMO7ZBdO62%2F7KPO4%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32baac485c8b49d98459ae2b2d1de8fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765367341&amp;x-signature=V73hAgslTri1RwVkZG5oVunBFYA%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/428fb2097b544ae8b90d97536422305d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765367341&amp;x-signature=qIBVbMZm9uqFGNNVG87Aeu9HW6M%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a47ab655345d4863955b68574685e1f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765367341&amp;x-signature=%2FRtGamkoHP6qMCdwTwWaDdr8A2Y%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a604d17703be4534833f415eb019404c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765367341&amp;x-signature=hfiaV9cm%2BbAiL9YcnCprE0vB1eM%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38737f01359b45089d895e6e8c4b29c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765367341&amp;x-signature=KjMbTqu1wuZcsnOYCW3rfanX%2FlA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-5">基于大数据的强迫症特征与影响因素数据分析系统-代码展示</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> SparkSession, functions <span class="hljs-keyword">as</span> F
<span class="hljs-keyword">from</span> pyspark.ml.feature <span class="hljs-keyword">import</span> VectorAssembler, KMeans
<span class="hljs-keyword">from</span> pyspark.sql.types <span class="hljs-keyword">import</span> FloatType

spark = SparkSession.builder \
    .appName(<span class="hljs-string">"OCD_Analysis"</span>) \
    .getOrCreate()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">preprocess_ocd_data</span>(<span class="hljs-params">df</span>):
    df = df.<span class="hljs-built_in">filter</span>(df.respondent_id.isNotNull())
    df = df.withColumn(<span class="hljs-string">'age'</span>, F.when(F.col(<span class="hljs-string">'age'</span>) == <span class="hljs-number">99</span>, <span class="hljs-literal">None</span>).otherwise(F.col(<span class="hljs-string">'age'</span>)))
    symptom_cols = [<span class="hljs-string">f'C<span class="hljs-subst">{i}</span>'</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)] + [<span class="hljs-string">f'CH<span class="hljs-subst">{i}</span>'</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)] + [<span class="hljs-string">f'S<span class="hljs-subst">{i}</span>'</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)] + [<span class="hljs-string">f'IT<span class="hljs-subst">{i}</span>'</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)]
    <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> symptom_cols:
        df = df.withColumn(col, F.col(col).cast(FloatType()))
    avg_age = df.select(F.mean(<span class="hljs-string">'age'</span>)).collect()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]
    avg_onset_age = df.select(F.mean(<span class="hljs-string">'ocd_onset_age'</span>)).collect()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]
    df = df.fillna({<span class="hljs-string">'age'</span>: avg_age, <span class="hljs-string">'ocd_onset_age'</span>: avg_onset_age})
    <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> symptom_cols:
        avg_score = df.select(F.mean(col)).collect()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]
        df = df.fillna({col: avg_score})
    df = df.withColumn(<span class="hljs-string">'ocd_total_score_recalculated'</span>, <span class="hljs-built_in">sum</span>(df[col] <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> symptom_cols))
    df = df.fillna({<span class="hljs-string">'ocd_total_score'</span>: F.col(<span class="hljs-string">'ocd_total_score_recalculated'</span>)})
    df = df.drop(<span class="hljs-string">'ocd_total_score_recalculated'</span>)
    df = df.fillna({<span class="hljs-string">'gender'</span>: <span class="hljs-string">'未知'</span>, <span class="hljs-string">'education'</span>: <span class="hljs-string">'未知'</span>, <span class="hljs-string">'prior_diagnosis'</span>: <span class="hljs-string">'未知'</span>, <span class="hljs-string">'treatment_status'</span>: <span class="hljs-string">'未知'</span>})
    df = df.na.drop(subset=[<span class="hljs-string">'ocd_severity'</span>])
    <span class="hljs-keyword">return</span> df

<span class="hljs-keyword">def</span> <span class="hljs-title function_">perform_kmeans_clustering</span>(<span class="hljs-params">df</span>):
    symptom_cols = [<span class="hljs-string">f'C<span class="hljs-subst">{i}</span>'</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)] + [<span class="hljs-string">f'CH<span class="hljs-subst">{i}</span>'</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)] + [<span class="hljs-string">f'S<span class="hljs-subst">{i}</span>'</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)] + [<span class="hljs-string">f'IT<span class="hljs-subst">{i}</span>'</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)]
    assembler = VectorAssembler(inputCols=symptom_cols, outputCol=<span class="hljs-string">"features"</span>)
    df_features = assembler.transform(df)
    kmeans = KMeans(featuresCol=<span class="hljs-string">'features'</span>, predictionCol=<span class="hljs-string">'cluster'</span>, k=<span class="hljs-number">4</span>, seed=<span class="hljs-number">42</span>)
    model = kmeans.fit(df_features)
    clustered_df = model.transform(df_features)
    cluster_centers = model.clusterCenters()
    cluster_description = {<span class="hljs-number">0</span>: <span class="hljs-string">"症状群1：混合型"</span>, <span class="hljs-number">1</span>: <span class="hljs-string">"症状群2：强迫思维主导型"</span>, <span class="hljs-number">2</span>: <span class="hljs-string">"症状群3：检查行为主导型"</span>, <span class="hljs-number">3</span>: <span class="hljs-string">"症状群4：对称/排序主导型"</span>}
    udf_cluster_description = F.udf(<span class="hljs-keyword">lambda</span> cluster_id: cluster_description.get(cluster_id, <span class="hljs-string">"未知"</span>))
    final_df = clustered_df.withColumn(<span class="hljs-string">'cluster_description'</span>, udf_description(F.col(<span class="hljs-string">'cluster'</span>)))
    <span class="hljs-keyword">return</span> final_df

<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_age_severity_distribution</span>(<span class="hljs-params">df</span>):
    df = df.<span class="hljs-built_in">filter</span>((F.col(<span class="hljs-string">'age'</span>).isNotNull()) &amp; (F.col(<span class="hljs-string">'ocd_severity'</span>).isNotNull()))
    df_with_age_group = df.withColumn(<span class="hljs-string">"age_group"</span>,
                                     F.when((F.col(<span class="hljs-string">'age'</span>) &gt;= <span class="hljs-number">18</span>) &amp; (F.col(<span class="hljs-string">'age'</span>) &lt;= <span class="hljs-number">25</span>), <span class="hljs-string">"18-25岁"</span>)
                                      .when((F.col(<span class="hljs-string">'age'</span>) &gt;= <span class="hljs-number">26</span>) &amp; (F.col(<span class="hljs-string">'age'</span>) &lt;= <span class="hljs-number">35</span>), <span class="hljs-string">"26-35岁"</span>)
                                      .when((F.col(<span class="hljs-string">'age'</span>) &gt;= <span class="hljs-number">36</span>) &amp; (F.col(<span class="hljs-string">'age'</span>) &lt;= <span class="hljs-number">50</span>), <span class="hljs-string">"36-50岁"</span>)
                                      .otherwise(<span class="hljs-string">"50岁以上"</span>))
    severity_order = F.when(F.col(<span class="hljs-string">'ocd_severity'</span>) == <span class="hljs-string">'None/Minimal'</span>, <span class="hljs-number">1</span>)\
                      .when(F.col(<span class="hljs-string">'ocd_severity'</span>) == <span class="hljs-string">'Mild'</span>, <span class="hljs-number">2</span>)\
                      .when(F.col(<span class="hljs-string">'ocd_severity'</span>) == <span class="hljs-string">'Moderate'</span>, <span class="hljs-number">3</span>)\
                      .when(F.col(<span class="hljs-string">'ocd_severity'</span>) == <span class="hljs-string">'Severe'</span>, <span class="hljs-number">4</span>)\
                      .otherwise(<span class="hljs-number">5</span>)
    df_with_severity_order = df_with_age_group.withColumn(<span class="hljs-string">"severity_order"</span>, severity_order)
    result_df = df_with_severity_order.groupBy(<span class="hljs-string">"age_group"</span>, <span class="hljs-string">"ocd_severity"</span>)\
        .count()\
        .withColumn(<span class="hljs-string">"total_count"</span>, F.<span class="hljs-built_in">sum</span>(<span class="hljs-string">"count"</span>).over(Window.partitionBy(<span class="hljs-string">"age_group"</span>)))\
        .withColumn(<span class="hljs-string">"percentage"</span>, F.<span class="hljs-built_in">round</span>((F.col(<span class="hljs-string">"count"</span>) / F.col(<span class="hljs-string">"total_count"</span>)) * <span class="hljs-number">100</span>, <span class="hljs-number">2</span>))
    <span class="hljs-keyword">return</span> result_df.select(<span class="hljs-string">"age_group"</span>, <span class="hljs-string">"ocd_severity"</span>, <span class="hljs-string">"count"</span>, <span class="hljs-string">"percentage"</span>)
</code></pre>
<h2 data-id="heading-6">基于大数据的强迫症特征与影响因素数据分析系统-结语</h2>
<blockquote>
<p>👇🏻 精彩专栏推荐订阅 👇🏻 不然下次找不到哟~</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754938.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754938.html" ref="nofollow noopener noreferrer">Java实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754940.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754940.html" ref="nofollow noopener noreferrer">Python实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754945.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754945.html" ref="nofollow noopener noreferrer">微信小程序|安卓实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754947.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754947.html" ref="nofollow noopener noreferrer">大数据实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754949.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754949.html" ref="nofollow noopener noreferrer">PHP|C#.NET|Golang实战项目</a></p>
<p>🍅 主页获取源码联系🍅</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>