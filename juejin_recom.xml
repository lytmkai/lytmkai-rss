<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[å¤§æ•°æ®-172 Elasticsearch ç´¢å¼•æ“ä½œä¸ IK åˆ†è¯å™¨è½åœ°å®æˆ˜ï¼š7.3/8.15 å…¨æµç¨‹é€ŸæŸ¥]]></title>    <link>https://juejin.cn/post/7579192114828574747</link>    <guid>https://juejin.cn/post/7579192114828574747</guid>    <pubDate>2025-12-03T06:20:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579192114828574747" data-draft-id="7579176524131827763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ•°æ®-172 Elasticsearch ç´¢å¼•æ“ä½œä¸ IK åˆ†è¯å™¨è½åœ°å®æˆ˜ï¼š7.3/8.15 å…¨æµç¨‹é€ŸæŸ¥"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-03T06:20:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ­¦å­åº·"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ•°æ®-172 Elasticsearch ç´¢å¼•æ“ä½œä¸ IK åˆ†è¯å™¨è½åœ°å®æˆ˜ï¼š7.3/8.15 å…¨æµç¨‹é€ŸæŸ¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ­¦å­åº·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:20:29.000Z" title="Wed Dec 03 2025 06:20:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>åœºæ™¯ï¼šåœ¨å•æœºæˆ–å°é›†ç¾¤ç¯å¢ƒï¼Œå®Œæˆç´¢å¼• CRUDã€å¥åº·æ£€æŸ¥ä¸ IK è¿œç¨‹è¯å…¸é…ç½®ã€‚</li>
<li>ç»“è®ºï¼šIK å¿…é¡»ä¸ ES ç‰ˆæœ¬åŒ¹é…ï¼›é‡å¯åç”¨ _analyze æ ¡éªŒï¼›ç´¢å¼•è§‚æµ‹ç”¨ _cat/indices æ›´ç¨³ã€‚</li>
<li>äº§å‡ºï¼šå¯ç›´æ¥å¤ç”¨çš„å‘½ä»¤æ¸…å•ã€è¿œç¨‹è¯å…¸éƒ¨ç½²è¦ç‚¹ã€å¸¸è§æ•…éšœå®šä½ä¸ä¿®å¤è¡¨ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbde3cd0331c42b3874d60a08dbb444a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=1e%2B6l6PrjEsanVeW4bwCSrwCgcM%3D" alt="å¤§æ•°æ®-172 Elasticsearch ç´¢å¼•æ“ä½œä¸ IK åˆ†è¯å™¨è½åœ°å®æˆ˜ï¼š7.3/8.15 å…¨æµç¨‹é€ŸæŸ¥" loading="lazy"/></p>
<h2 data-id="heading-1">ç‰ˆæœ¬çŸ©é˜µ</h2>















































<table><thead><tr><th>ç»„ä»¶/ç‰¹æ€§</th><th>ç‰ˆæœ¬/å‘½ä»¤</th><th>å·²éªŒè¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Elasticsearch</td><td>7.3.0</td><td>æ˜¯ï¼ˆä½œè€…ç¯å¢ƒï¼‰</td><td>ç´¢å¼• CRUDã€<code>_cat/indices?v</code>ã€å¥åº·åº¦å«ä¹‰ä¸€è‡´ï¼›IK éœ€ç”¨ 7.3.0 åŒ¹é…åŒ…ã€‚</td></tr><tr><td>Elasticsearch</td><td>8.15.0</td><td>æ˜¯ï¼ˆä½œè€…ç¯å¢ƒï¼‰</td><td>IK ç›®å½•ä¸º <code>plugins/analysis-ik</code>ï¼›è¿œç¨‹è¯å…¸é€šè¿‡ <code>IKAnalyzer.cfg.xml</code> åŠ è½½åé‡å¯ç”Ÿæ•ˆã€‚</td></tr><tr><td>IK åˆ†è¯å™¨</td><td>7.3.0</td><td>æ˜¯ï¼ˆä½œè€…ç¯å¢ƒï¼‰</td><td><code>ik_max_word</code>/<code>ik_smart</code> <code>_analyze</code> é€šè¿‡ã€‚</td></tr><tr><td>IK åˆ†è¯å™¨</td><td>8.xï¼ˆä¸ ES åŒ minorï¼‰</td><td>å»ºè®®å¯¹é½</td><td>è·¨å¤§/å°ç‰ˆæœ¬å¯èƒ½åŠ è½½å¤±è´¥ï¼›ä»¥å¯¹åº” release ä¸ºå‡†ã€‚</td></tr><tr><td>è¿œç¨‹æ‰©å±•è¯å…¸</td><td>Nginx é™æ€æ‰˜ç®¡</td><td>æ˜¯ï¼ˆä½œè€…ç¯å¢ƒï¼‰</td><td><code>ext_dict.dic</code>ã€<code>stop_dict.dic</code> ä»¥ UTF-8 æ—  BOM æä¾›ï¼ŒHTTP å¯è¾¾ã€‚</td></tr><tr><td>æŸ¥è¯¢æ‰€æœ‰ç´¢å¼•</td><td><code>GET _all</code> / <code>_cat/indices?v</code></td><td>éƒ¨åˆ†</td><td>å®æˆ˜æ›´æ¨è <code>_cat/indices</code>ï¼›<code>_all</code> åœ¨éƒ¨åˆ†ç‰ˆæœ¬ä¸ç¨³å®š/ä¸æ¨èã€‚</td></tr></tbody></table>
<h4 data-id="heading-2">æ³¨æ„äº‹é¡¹</h4>
<ol>
<li>ä»£ç ç›¸å…³éƒ¨åˆ†ï¼ˆå¦‚å‘½ä»¤ã€æ–‡ä»¶åï¼‰ä½¿ç”¨åå¼•å· <code>`</code> åŒ…è£¹ã€‚</li>
<li>è¡¨æ ¼å¯¹é½é€šè¿‡è°ƒæ•´åˆ—å®½å’Œæ–‡æœ¬æ¢è¡Œä¼˜åŒ–å¯è¯»æ€§ã€‚</li>
<li>ç‰ˆæœ¬å·ä¸å‘½ä»¤æ··åˆçš„å•å…ƒæ ¼é€šè¿‡åˆ†è¡Œæˆ–æ‹¬å·æ³¨æ˜ä¿æŒæ¸…æ™°ã€‚</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9609434e3aeb4ccfb81291114c99a3c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=6xb6n0ItEEP%2BmwcF4m5sNz7sg8c%3D" alt="Elasticsearch" loading="lazy"/></p>
<h2 data-id="heading-3">ç´¢å¼•æ“ä½œ</h2>
<h3 data-id="heading-4">åˆ›å»ºç´¢å¼•åº“</h3>
<p>Elasticsearché‡‡ç”¨Resté£æ ¼APIï¼Œå› æ­¤å…¶APIå°±æ˜¯ä¸€æ¬¡HTTPè¯·æ±‚ï¼Œä½ å¯ä»¥ç”¨ä»»ä½•å·¥å…·æ¥å‘èµ·HTTPè¯·æ±‚ã€‚
è¯­æ³•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">PUT /ç´¢å¼•åç§°
{
  "settings": {
    "å±æ€§å": "å±æ€§å€¼"
  }
}
</code></pre>
<p>settingsï¼šå°±æ˜¯ç´¢å¼•åº“è®¾ç½®ï¼Œå…¶ä¸­å¯ä»¥ç´¢å¼•åº“çš„å„ç§å±æ€§ï¼Œæ¯”å¦‚åˆ†ç‰‡æ•°ã€å‰¯æœ¬æ•°ç­‰ã€‚ç›®å‰æˆ‘ä»¬ä¸è®¾ç½®ï¼Œå…ˆé»˜è®¤å³å¯ã€‚
ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">PUT /wzkicu-index

</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1deb25f3aaa0436499124862c212dafb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=pi3W3v3LKRXUMQKk3UcoClDh5ak%3D" alt="wzk-index" loading="lazy"/></p>
<h3 data-id="heading-5">åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨</h3>
<h4 data-id="heading-6">å•ä¸ªç´¢å¼•</h4>
<p>è¯­æ³•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">GET /ç´¢å¼•åç§°
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">GET /wzkicu-index
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6240c87dc76b4312a1f77d23379ac994~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=LL%2Ff%2BlR6HgSMM3A2t5JeQJ0q2%2BM%3D" alt="åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨" loading="lazy"/></p>
<h4 data-id="heading-7">å¤šä¸ªç´¢å¼•</h4>
<p>è¯­æ³•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">GET /ç´¢å¼•åç§°1,2,3,4,5...
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">GET /wzkicu-index,wzkicu,wzk
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šï¼ˆè¿™é‡Œæœ‰ä¸å­˜åœ¨çš„ç´¢å¼•ï¼Œæ‰€ä»¥404äº†ï¼‰
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d74fc19b7c1444a4afd21e23a600de77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=a9A64wMOHgD%2FlMP5xBKqMIn2Wkc%3D" alt="å¤šä¸ªç´¢å¼•" loading="lazy"/></p>
<h4 data-id="heading-8">æ‰€æœ‰ç´¢å¼•</h4>
<p>æ–¹å¼1ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">GET _all
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb89ad5d36dd4080a24c0d5d79fc0419~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=P%2FRNogFVcOM69i3WWd4DxC8q%2BEw%3D" alt="æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•" loading="lazy"/>
æ–¹å¼2ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">GET /_cat/indices?v
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1af1de0bf1da4fc6982e76b0a78fe394~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=Y%2BMKmRP8h%2BNUNedTwwwLFohbIrA%3D" alt="æ£€æŸ¥æ‰€æœ‰ç´¢å¼•å¥åº·åº¦" loading="lazy"/>
è¿™é‡Œçš„healthåˆ—ï¼Œè¡¨ç¤ºï¼š</p>
<ul>
<li>ç»¿è‰²ï¼šç´¢å¼•çš„æ‰€æœ‰åˆ†ç‰‡éƒ½æ­£å¸¸åˆ†é…</li>
<li>é»„è‰²ï¼šè‡³å°‘æœ‰ä¸€ä¸ªå‰¯æœ¬æ²¡æœ‰å¾—åˆ°æ­£ç¡®çš„åˆ†é…</li>
<li>çº¢è‰²ï¼šè‡³å°‘æœ‰ä¸€ä¸ªä¸»åˆ†ç‰‡æ²¡æœ‰å¾—åˆ°æ­£å¸¸çš„åˆ†é…</li>
</ul>
<h4 data-id="heading-9">æ‰“å¼€ç´¢å¼•</h4>
<p>è¯­æ³•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">POST /ç´¢å¼•åç§°/_open
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">POST /wzkicu-index/_open
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6abff34c8d244c73a1a0f246701f6ccd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=GOEQtNPgmIvd74xgpS91hs%2B2pxI%3D" alt="æ‰“å¼€ç´¢å¼•" loading="lazy"/></p>
<h3 data-id="heading-10">å…³é—­ç´¢å¼•</h3>
<p>è¯­æ³•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">POST /ç´¢å¼•åç§°/_close
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">POST /wzkicu-index/_close
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59ff4f89f6664eadabdd37d8fbd5436e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=ukGvb1YvT4jcjF5mvUVxo%2BJp4Cs%3D" alt="å…³é—­ç´¢å¼•" loading="lazy"/></p>
<h4 data-id="heading-11">åˆ é™¤ç´¢å¼•</h4>
<p>è¯­æ³•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">DELETE /ç´¢å¼•åç§°1,2,3,4,5...
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">DELETE /wzkicu-index
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef9703fde631421282544ca118823d8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=3sJzANHVE2cEPrNks0Zt2R9h%2Bg8%3D" alt="åˆ é™¤ç´¢å¼•" loading="lazy"/></p>
<h2 data-id="heading-12">IKåˆ†è¯å™¨</h2>
<h3 data-id="heading-13">ä¸‹è½½é¡¹ç›®</h3>
<p>å®˜æ–¹åœ°å€åœ¨è¿™é‡Œï¼Œæ˜¯GitHubå¼€æºçš„é¡¹ç›®ï¼Œå®‰è£…æ–¹å¼å¾ˆå¤šï¼Œæˆ‘è¿™é‡Œå°±ç›´æ¥ç”¨å®˜æ–¹çš„æ–¹å¼å®‰è£…äº†ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">https://github.com/infinilabs/analysis-ik/releases/tag/Latest
</code></pre>
<p>é¡µé¢æ˜¯è¿™æ ·çš„ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b011b1be62146fd8faa8e45089801f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=tSg6sXOVRMTo8JZ0zMJ8QwTRgRY%3D" alt="IKåˆ†è¯å™¨" loading="lazy"/></p>
<h3 data-id="heading-14">å®‰è£…æ’ä»¶</h3>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/elasticsearch-7.3.0/
bin/elasticsearch-plugin install https://get.infini.cloud/elasticsearch/analysis-ik/7.3.0
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬éœ€è¦é‡å¯ESï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef2da614d28b467ca16d12f012811f3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=%2F%2BUaj0XNyxbdVhHUmj1wCZ0dI9o%3D" alt="å®‰è£…æ’ä»¶" loading="lazy"/></p>
<h3 data-id="heading-15">é‡å¯ES</h3>
<p>é‡å¯è¿‡ç¨‹ï¼Œå¯åŠ¨å®Œæ¯•ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17973a9d18fe4be4b3dfb0190ab53fa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=N72DpWc9ww4cvpefo3RZ84H5wy8%3D" alt="é‡å¯ES" loading="lazy"/></p>
<h3 data-id="heading-16">åˆ†è¯æµ‹è¯•</h3>
<p>IKåˆ†è¯å™¨ä¸¤ç§åˆ†è¯æ¨¡å¼ï¼š</p>
<ul>
<li>ik_max_word æ¨¡å¼ ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼ˆä¼šå°†æ–‡æœ¬æœ€ç»†ç²’åº¦çš„æ‹†åˆ†ï¼‰</li>
<li>ik_smart æ¨¡å¼ ï¼ˆä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†ï¼‰</li>
</ul>
<p>æš‚æ—¶ä¸ç»†è¿½ç©¶è¯­æ³•ï¼Œå…ˆå­¦ä¹ æµ‹è¯•ï¼Œå†åç»­ç ”ç©¶ã€‚</p>
<h4 data-id="heading-17">ik_max_word</h4>
<pre><code class="hljs language-shell" lang="shell">POST _analyze
{
  "analyzer": "ik_max_word",
  "text": "å±±ä¸œçœé’å²›å¸‚é»„å²›åŒº"
}
</code></pre>
<p>æˆ‘ä»¬çš„åˆ°çš„ç»“æœæ˜¯ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">{
  "tokens": [
    {
      "token": "å±±ä¸œçœ",
      "start_offset": 0,
      "end_offset": 3,
      "type": "CN_WORD",
      "position": 0
    },
    {
      "token": "å±±ä¸œ",
      "start_offset": 0,
      "end_offset": 2,
      "type": "CN_WORD",
      "position": 1
    },
    {
      "token": "çœ",
      "start_offset": 2,
      "end_offset": 3,
      "type": "CN_CHAR",
      "position": 2
    },
    {
      "token": "é’å²›å¸‚",
      "start_offset": 3,
      "end_offset": 6,
      "type": "CN_WORD",
      "position": 3
    },
    {
      "token": "é’å²›",
      "start_offset": 3,
      "end_offset": 5,
      "type": "CN_WORD",
      "position": 4
    },
    {
      "token": "å¸‚",
      "start_offset": 5,
      "end_offset": 6,
      "type": "CN_CHAR",
      "position": 5
    },
    {
      "token": "é»„å²›åŒº",
      "start_offset": 6,
      "end_offset": 9,
      "type": "CN_WORD",
      "position": 6
    },
    {
      "token": "é»„å²›",
      "start_offset": 6,
      "end_offset": 8,
      "type": "CN_WORD",
      "position": 7
    },
    {
      "token": "åŒº",
      "start_offset": 8,
      "end_offset": 9,
      "type": "CN_CHAR",
      "position": 8
    }
  ]
}
</code></pre>
<p>æ‰§è¡Œçš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92abb394eca741fdbb300db25e59d011~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=PTso4AKPu47Ea12R4u8%2BmijU4kE%3D" alt="åˆ†è¯å™¨åˆ†æ" loading="lazy"/></p>
<h4 data-id="heading-18">ik_smart</h4>
<pre><code class="hljs language-shell" lang="shell">POST _analyze
{
  "analyzer": "ik_smart",
  "text": "å±±ä¸œçœé’å²›å¸‚é»„å²›åŒº"
}
</code></pre>
<p>æ‰§è¡Œçš„ç»“æœæ˜¯ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å±±ä¸œçœ"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"start_offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"end_offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"CN_WORD"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"position"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é’å²›å¸‚"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"start_offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"end_offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"CN_WORD"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"position"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é»„å²›åŒº"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"start_offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"end_offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">9</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"CN_WORD"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"position"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ‰§è¡Œçš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dad817177f35491780f523b32e5d61f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=%2Bgznx0KVetsiBpesMSrlDdiB7ug%3D" alt="åˆ†è¯å™¨åˆ†æ" loading="lazy"/></p>
<h3 data-id="heading-19">æå‡ºé—®é¢˜</h3>
<p>åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œæœ‰å¾ˆå¤šæ—¶å€™å¹¶ä¸èƒ½å¤Ÿå‡†ç¡®çš„ç†è§£æˆ‘ä»¬æ–­è¯æ–­å¥ï¼Œæœ‰æ—¶å€™æœ‰äº›è¯æˆ‘ä»¬æƒ³è¦å®ƒæ‹†åˆ†ï¼Œæœ‰äº›è¯æˆ‘ä»¬å¸Œæœ›å®ƒä¸æ‹†åˆ†ã€‚
é‚£æˆ‘ä»¬æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<h3 data-id="heading-20">è¯å…¸ä½¿ç”¨</h3>
<h4 data-id="heading-21">æ‰©å±•è¯</h4>
<p>ä¸è¿›è¡Œåˆ†è¯ï¼Œå‘Šè¯‰å¼•æ“è¿™æ˜¯ä¸€ä¸ªè¯ã€‚</p>
<h4 data-id="heading-22">åœç”¨è¯</h4>
<p>æœ‰äº›è¯åœ¨æ–‡æœ¬ä¸­å‡ºç°çš„é¢‘ç‡éå¸¸é«˜ï¼Œä½†å¯¹æœ¬æ–‡çš„è¯­ä¹‰ä¼šäº§ç”Ÿå¾ˆå¤§çš„å½±å“ï¼Œä¾‹å¦‚ï¼šå‘¢ã€äº†ã€å•Šç­‰ç­‰ï¼Œè‹±è¯­ä¸­ä¹Ÿæœ‰ç±»ä¼¼äº a ã€theã€of ç­‰ç­‰ã€‚è¿™æ ·çš„è¯ç§°ä¸ºåœç”¨è¯ã€‚
åœç”¨è¯ç»å¸¸ä¼šè¿‡æ»¤æ‰ï¼Œä¸ä¼šè¢«ç´¢å¼•ï¼Œåœ¨æ£€ç´¢è¿‡ç¨‹ä¸­ï¼Œå¦‚æœç”¨æˆ·çš„æŸ¥è¯¢è¯ä¸­å«æœ‰åœç”¨è¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¿‡æ»¤æ‰ã€‚
åœç”¨è¯å¯ä»¥åŠ å¿«ç´¢å¼•çš„é€Ÿåº¦ã€å‡å°‘ç´¢å¼•åº“çš„å¤§å°ã€‚</p>
<p>æ‰©å±•è¯ã€åœç”¨è¯åº”è¯¥ç»Ÿä¸€ç»´æŠ¤ï¼Œé¿å…é›†ç¾¤ä¸­å¤šå°å¯¼è‡´èŠ‚ç‚¹å„è‡ªç»´æŠ¤è‡ªå·±çš„ä¸€ä»½ã€‚è¿™é‡Œæˆ‘ä»¬è®¡åˆ’ä½¿ç”¨Webçš„æ–¹å¼ï¼Œå°†dictè¯åº“å…±äº«ç»™åˆ†è¯å™¨ç­‰ã€‚</p>
<h3 data-id="heading-23">åˆ†è¯æœåŠ¡</h3>
<p>é…ç½®Web
æˆ‘è¿™é‡Œä½¿ç”¨ Nginxï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Tomcatï¼š</p>
<pre><code class="hljs language-shell" lang="shell">apt install nginx
</code></pre>
<p>å®‰è£…è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2780a6b89b743149edea084bf7b760f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=u9RefGchZMQq6TnPFg5zQXGgXdM%3D" alt="å®‰è£…NGINX" loading="lazy"/>
è®¿é—®é¡µé¢ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Fh121.wzk.icu%25EF%25BC%258C%25E5%258F%25AF%25E4%25BB%25A5%25E7%259C%258B%25E5%2588%25B0Nginx%25E9%25A1%25BA%25E5%2588%25A9%25E8%25BF%2590%25E8%25A1%258C%25EF%25BC%259A" target="_blank" title="http://h121.wzk.icu%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0Nginx%E9%A1%BA%E5%88%A9%E8%BF%90%E8%A1%8C%EF%BC%9A" ref="nofollow noopener noreferrer">h121.wzk.icuï¼Œå¯ä»¥çœ‹åˆ°Nginxé¡ºåˆ©è¿è¡Œï¼š</a>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d9a47ad8d9442a8bd11233dbcf94acc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=CHTwtlIr5pk8p%2FF6QNgVx%2BQwwso%3D" alt="æµ‹è¯•NGINX" loading="lazy"/>
ç¼–å†™dictå†…å®¹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">vim /var/www/html/stop_dict.dic
</code></pre>
<p>å‘å…¶ä¸­å†™å…¥çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">çš„
äº†
å•Š
å‘¢
</code></pre>
<p>åŒç†ï¼Œæˆ‘ä»¬å†™å…¥ ext_dict.dicï¼š</p>
<pre><code class="hljs language-shell" lang="shell">vim /var/www/html/ext_dict.dic
</code></pre>
<p>æˆ‘ä»¬è®¿é—®å¯¹åº”çš„é¡µé¢ï¼Œå¯ä»¥æ‹¿åˆ°å¯¹åº”çš„Webæ–‡ä»¶ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60c042a94db543ac84462cb665691bfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=Bj8N6Vjk9s%2BUNKCFtn0FniNy1PM%3D" alt="å‡†å¤‡åˆ†è¯å­—å…¸" loading="lazy"/></p>
<h3 data-id="heading-24">é…ç½®åˆ†è¯å™¨</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è¿™é‡Œçœ‹è‡ªå·±çš„ç‰ˆæœ¬ æˆ‘é€‰äº†å¥½å‡ ä¸ª</span>
cd /opt/servers/elasticsearch-8.15.0/plugins/analysis-ik
mkdir config
vim IKAnalyzer.cfg.xml
</code></pre>
<p>å†™å…¥å¦‚ä¸‹çš„å†…å®¹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">properties</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">"http://java.sun.com/dtd/properties.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">comment</span>&gt;</span>IK Analyzer æ‰©å±•é…ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">comment</span>&gt;</span>
  <span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ext_dict"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span>
  <span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ext_stopwords"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span>
  <span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•å­—å…¸ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"remote_ext_dict"</span>&gt;</span>http://h121.wzk.icu/ext_dict.dic<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span>
  <span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"remote_ext_stopwords"</span>&gt;</span>http://h121.wzk.icu/stop_dict.dic<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
</code></pre>
<p>å¯¹åº”çš„æˆªå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06326212d5fa43ffb7234d5d9eb10885~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=knMyrl3Kj%2Fh%2BD7IXpHipf3QGqYM%3D" alt="åŠ è½½åˆ†è¯å™¨" loading="lazy"/></p>
<h3 data-id="heading-25">é‡å¯æœåŠ¡</h3>
<p>é‡å¯ESæœåŠ¡ï¼Œæµ‹è¯•æ•ˆæœã€‚</p>
<h2 data-id="heading-26">é”™è¯¯é€ŸæŸ¥</h2>























































<table><thead><tr><th>ç—‡çŠ¶</th><th>æ ¹å› å®šä½</th><th>ä¿®å¤</th></tr></thead><tbody><tr><td><code>_analyze</code> æŠ¥ <code>unknown analyzer [ik_max_word]</code></td><td>æœªå®‰è£…IKæˆ–ç‰ˆæœ¬ä¸åŒ¹é…/æœªé‡å¯</td><td>æŸ¥çœ‹<code>plugins/analysis-ik</code>ã€ESå¯åŠ¨æ—¥å¿—ï¼›å®‰è£…ä¸ESå¯¹é½çš„IKï¼›é‡å¯ES</td></tr><tr><td>åˆ†è¯ç»“æœæ— å˜åŒ–ï¼ˆè¿œç¨‹è¯å…¸æ”¹äº†ä¸ç”Ÿæ•ˆï¼‰</td><td>è¯å…¸URLä¸å¯è¾¾/ç¼“å­˜æœªåˆ·æ–°/ç¼–ç é—®é¢˜</td><td><code>curl</code>è®¿é—®è¯å…¸ï¼›æŸ¥ESæ—¥å¿—æ˜¯å¦åŠ è½½æˆåŠŸï¼›ç¡®è®¤200å¯è¾¾ï¼›UTF-8æ— BOMï¼›é‡å¯ESè§¦å‘åŠ è½½</td></tr><tr><td>å®‰è£…IKæŠ¥â€œwas built for ES version ...â€</td><td>æ’ä»¶ä¸ESç‰ˆæœ¬ä¸ä¸€è‡´</td><td>è¯»å–å®‰è£…æŠ¥é”™è¡Œï¼›æ¢ç”¨ä¸ESå®Œå…¨åŒ¹é…çš„IKç‰ˆæœ¬åŒ…</td></tr><tr><td>å¤šç´¢å¼•æŸ¥è¯¢404ï¼ˆéƒ¨åˆ†å­˜åœ¨ã€éƒ¨åˆ†ä¸å­˜åœ¨ï¼‰</td><td>è¯·æ±‚é‡ŒåŒ…å«ä¸å­˜åœ¨ç´¢å¼•</td><td><code>_cat/indices?v</code>æ ¸å¯¹æ¸…å•ï¼›ä»…ä¿ç•™å­˜åœ¨çš„ç´¢å¼•æˆ–å…ˆåˆ›å»ºç¼ºå¤±ç´¢å¼•</td></tr><tr><td>é›†ç¾¤å¥åº·yellow</td><td>å•èŠ‚ç‚¹å‰¯æœ¬æœªåˆ†é…</td><td><code>_cluster/health</code>ï¼›å¼€å‘ç¯å¢ƒå°†å‰¯æœ¬æ•°è®¾0ï¼Œæˆ–å¢åŠ èŠ‚ç‚¹</td></tr><tr><td>é›†ç¾¤å¥åº·redï¼ˆä¸»åˆ†ç‰‡æœªåˆ†é…ï¼‰</td><td>ç£ç›˜é˜ˆå€¼/è·¯å¾„é”™è¯¯/èŠ‚ç‚¹å®•æœº</td><td><code>_cluster/allocation/explain</code>ã€ESæ—¥å¿—ï¼›é‡Šæ”¾ç£ç›˜ã€ä¿®æ­£<code>path.data</code>ã€æ¢å¤èŠ‚ç‚¹å¹¶è§¦å‘åˆ†é…</td></tr><tr><td>å¯¹å·²å…³é—­ç´¢å¼•æ“ä½œæŠ¥<code>index_closed_exception</code></td><td>ç´¢å¼•å¤„äºå…³é—­çŠ¶æ€</td><td><code>_cat/indices</code>çœ‹<code>status</code>ï¼›<code>POST /{index}/_open</code>åå†æ“ä½œ</td></tr><tr><td>è¿œç¨‹è¯å…¸åŠ è½½å¤±è´¥ï¼ˆè¶…æ—¶/403/404ï¼‰</td><td>ç½‘ç»œã€é˜²ç«å¢™æˆ–æƒé™é™åˆ¶</td><td><code>curl -I</code>ã€Nginxè®¿é—®æ—¥å¿—ï¼›æ”¾é€šå†…ç½‘/ç™½åå•ï¼›ä¿è¯URLç¨³å®šå¯è¾¾</td></tr><tr><td>è¯å…¸ä¸­æ–‡æ˜¾ç¤ºä¸ºä¹±ç </td><td>æ–‡ä»¶ç¼–ç éUTF-8</td><td>æœ¬åœ°æŸ¥çœ‹æ–‡ä»¶ç¼–ç ï¼›ç»Ÿä¸€ä¿å­˜ä¸ºUTF-8æ— BOM</td></tr></tbody></table>
<h2 data-id="heading-27">å…¶ä»–ç³»åˆ—</h2>
<h3 data-id="heading-28">ğŸš€ AIç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>AIç‚¼ä¸¹æ—¥å¿—-29 - å­—èŠ‚è·³åŠ¨ DeerFlow æ·±åº¦ç ”ç©¶æ¡†<em>æ–œä½“æ ·å¼</em>æ¶ ç§æœ‰éƒ¨ç½² æµ‹è¯•ä¸Šæ‰‹ æ¶æ„ç ”ç©¶</strong>ï¼ŒæŒç»­æ‰“é€ å®ç”¨AIå·¥å…·æŒ‡å—ï¼
<strong>AIç ”ç©¶-132 Java ç”Ÿæ€å‰æ²¿ 2025ï¼šSpringã€Quarkusã€GraalVMã€CRaC ä¸äº‘åŸç”Ÿè½åœ°</strong></p>
<h3 data-id="heading-29">ğŸ’» Javaç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>Java-180 Java æ¥å…¥ FastDFSï¼šè‡ªç¼–è¯‘å®¢æˆ·ç«¯ä¸ Maven/Spring Boot å®æˆ˜</strong>
MyBatis å·²å®Œç»“ï¼ŒSpring å·²å®Œç»“ï¼ŒNginxå·²å®Œç»“ï¼ŒTomcatå·²å®Œç»“ï¼Œåˆ†å¸ƒå¼æœåŠ¡å·²å®Œç»“ï¼ŒDubboå·²å®Œç»“ï¼ŒMySQLå·²å®Œç»“ï¼ŒMongoDBå·²å®Œç»“ï¼ŒNeo4jå·²å®Œç»“ï¼ŒFastDFS å·²å®Œç»“ï¼ŒOSSæ­£åœ¨æ›´æ–°... æ·±å…¥æµ…å‡ºåŠ©ä½ æ‰“ç‰¢åŸºç¡€ï¼</p>
<h3 data-id="heading-30">ğŸ“Š å¤§æ•°æ®æ¿å—å·²å®Œæˆå¤šé¡¹å¹²è´§æ›´æ–°ï¼ˆ300ç¯‡ï¼‰ï¼š</h3>
<p>åŒ…æ‹¬ Hadoopã€Hiveã€Kafkaã€Flinkã€ClickHouseã€Elasticsearch ç­‰äºŒåä½™é¡¹æ ¸å¿ƒç»„ä»¶ï¼Œè¦†ç›–ç¦»çº¿+å®æ—¶æ•°ä»“å…¨æ ˆï¼
<strong>å¤§æ•°æ®-278 Spark MLib - åŸºç¡€ä»‹ç» æœºå™¨å­¦ä¹ ç®—æ³• æ¢¯åº¦æå‡æ ‘ GBDTæ¡ˆä¾‹ è¯¦è§£</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨docxåº“å®ç°æ–‡æ¡£å¯¼å‡º]]></title>    <link>https://juejin.cn/post/7579186764046499881</link>    <guid>https://juejin.cn/post/7579186764046499881</guid>    <pubDate>2025-12-03T05:54:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579186764046499881" data-draft-id="7579186764046467113" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨docxåº“å®ç°æ–‡æ¡£å¯¼å‡º"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-12-03T05:54:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯å°å½¬å­"/> <meta itemprop="url" content="https://juejin.cn/user/1788247743933225"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨docxåº“å®ç°æ–‡æ¡£å¯¼å‡º
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1788247743933225/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯å°å½¬å­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:54:44.000Z" title="Wed Dec 03 2025 05:54:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    17
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»26åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æŠ€æœ¯åŸç†è§£æï¼šæ ¸å¿ƒå‚æ•°ä¸æ–¹æ³•çš„å·¥ä½œæœºåˆ¶</h2>
<h3 data-id="heading-1">Documentå¯¹è±¡ï¼šæ–‡æ¡£æ„å»ºçš„åŸºçŸ³</h3>
<p>åœ¨ä½¿ç”¨docxåº“æ—¶ï¼ŒDocumentå¯¹è±¡æ˜¯ä¸€åˆ‡æ“ä½œçš„èµ·ç‚¹ã€‚è¿™ä¸ªå¯¹è±¡æœ¬è´¨ä¸Šæ˜¯å¯¹Office Open XMLæ ¼å¼çš„æŠ½è±¡å°è£…ï¼Œå®ƒå…è®¸å¼€å‘è€…é€šè¿‡ç›´è§‚çš„APIæ„å»ºå¤æ‚çš„Wordæ–‡æ¡£ç»“æ„ï¼Œè€Œæ— éœ€ç›´æ¥å¤„ç†åº•å±‚XMLã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªæ–°æ–‡æ¡£éå¸¸ç®€å•ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">doc</span> = new Document()<span class="hljs-comment">;</span>
</code></pre>
<p>é™¤äº†åŸºæœ¬çš„æ–‡æ¡£åˆ›å»ºï¼ŒDocumentå¯¹è±¡è¿˜æ”¯æŒé€šè¿‡é…ç½®å‚æ•°å®šåˆ¶æ–‡æ¡£å±æ€§ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Document</span>({
    title: <span class="hljs-string">"å¹´åº¦æŠ¥å‘Š"</span>,
    creator: <span class="hljs-string">"æŠ€æœ¯éƒ¨"</span>,
    description: <span class="hljs-string">"2024å¹´åº¦ä¸šç»©æ€»ç»“"</span>,
});
</code></pre>
<p>è¿™ç§è®¾è®¡ä½¿å¾—Documentå¯¹è±¡ä¸ä»…é€‚ç”¨äºç®€å•çš„æ–‡æ¡£ç”Ÿæˆï¼Œè¿˜èƒ½æ»¡è¶³ä¼ä¸šçº§åº”ç”¨ä¸­å¯¹æ–‡æ¡£å…ƒæ•°æ®ç®¡ç†çš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨æ³•å¾‹æ–‡æ¡£ç”Ÿæˆç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®æ–‡æ¡£å±æ€§æ¥è·Ÿè¸ªæ–‡æ¡£ç‰ˆæœ¬å’Œä¿®æ”¹è®°å½•ã€‚</p>
<h3 data-id="heading-2">æ®µè½ä¸æ–‡æœ¬æ ·å¼ï¼šå†…å®¹å‘ˆç°çš„æ ¸å¿ƒæ§åˆ¶</h3>
<p>æ–‡æ¡£å†…å®¹çš„åŸºæœ¬å•ä½æ˜¯æ®µè½(Paragraph)ï¼Œè€Œæ®µè½ä¸­çš„æ–‡æœ¬æ ·å¼åˆ™é€šè¿‡TextRunå¯¹è±¡æ¥æ§åˆ¶ã€‚è¿™ç§åˆ†å±‚è®¾è®¡åæ˜ äº†Wordæ–‡æ¡£çš„å†…éƒ¨ç»“æ„ï¼Œä¹Ÿä¸ºå¼€å‘è€…æä¾›äº†ç²¾ç»†åŒ–çš„æ ¼å¼æ§åˆ¶èƒ½åŠ›ã€‚</p>
<p>åŸºæœ¬ç”¨æ³•ç¤ºä¾‹ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> paragraph = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
    children: [
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">TextRun</span>({
            text: <span class="hljs-string">"è¿™æ˜¯ä¸€æ®µåŒ…å«"</span>,
            size: <span class="hljs-number">24</span>,
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">TextRun</span>({
            text: <span class="hljs-string">"åŠ ç²—æ–‡æœ¬"</span>,
            bold: <span class="hljs-literal">true</span>,
            color: <span class="hljs-string">"#FF0000"</span>,
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">TextRun</span>({
            text: <span class="hljs-string">"çš„ç¤ºä¾‹ã€‚"</span>,
            size: <span class="hljs-number">24</span>,
        }),
    ],
});

doc.<span class="hljs-built_in">addSection</span>({
    children: [paragraph],
});
</code></pre>
<p>è¿™é‡Œçš„å…³é”®æ¦‚å¿µæ˜¯"å—çº§å…ƒç´ "å’Œ"å†…è”å…ƒç´ "çš„åŒºåˆ†ã€‚æ®µè½(Paragraph)æ˜¯å—çº§å…ƒç´ ï¼Œå®ƒå®šä¹‰äº†æ–‡æœ¬çš„æ•´ä½“å¸ƒå±€ï¼Œå¦‚å¯¹é½æ–¹å¼ã€ç¼©è¿›å’Œè¡Œè·ï¼›è€Œæ–‡æœ¬è¿è¡Œ(TextRun)æ˜¯å†…è”å…ƒç´ ï¼Œè´Ÿè´£å…·ä½“çš„æ–‡æœ¬æ ·å¼ï¼Œå¦‚å­—ä½“ã€å¤§å°å’Œé¢œè‰²ã€‚è¿™ç§åˆ†ç¦»è®¾è®¡å€Ÿé‰´äº†HTMLä¸­</p><p>å’Œ<span>çš„æ¦‚å¿µï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥è½»æ¾ç†è§£å’Œä½¿ç”¨ã€‚</span></p>
<p>ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿå› ä¸ºåœ¨Wordæ–‡æ¡£ä¸­ï¼Œæ®µè½å±æ€§å’Œå­—ç¬¦å±æ€§æœ¬æ¥å°±æ˜¯åˆ†å¼€å­˜å‚¨çš„ã€‚é€šè¿‡è¿™ç§è®¾è®¡ï¼Œdocxåº“ç›´æ¥æ˜ å°„äº†åº•å±‚çš„Open XMLç»“æ„ï¼Œæ—¢æé«˜äº†æ•ˆç‡ï¼Œåˆä¿è¯äº†åŠŸèƒ½çš„å®Œæ•´æ€§ã€‚</p>
<p>æ‰©å±•åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ã€‚ä¾‹å¦‚ï¼Œåœ¨ç”Ÿæˆå­¦æœ¯è®ºæ–‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„TextRunå¯¹è±¡æ¥åŒºåˆ†æ­£æ–‡ã€å¼•ç”¨å’Œæ³¨é‡Šï¼›åœ¨ç”Ÿæˆç®€å†æ—¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒçš„æ®µè½æ ·å¼æ¥åŒºåˆ†ä¸åŒçš„å†…å®¹åŒºå—ã€‚</p>
<h3 data-id="heading-3">è¡¨æ ¼ä¸å›¾ç‰‡ï¼šå¤æ‚å†…å®¹çš„ç»„ç»‡æ–¹å¼</h3>
<p>å¤„ç†ç»“æ„åŒ–æ•°æ®å’Œè§†è§‰å…ƒç´ æ˜¯æ–‡æ¡£ç”Ÿæˆä¸­çš„å¸¸è§éœ€æ±‚ã€‚docxåº“æä¾›äº†Tableå’ŒImageRunå¯¹è±¡æ¥æ»¡è¶³è¿™äº›éœ€æ±‚ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”Wordæ–‡æ¡£ä¸­çš„è¡¨æ ¼å’Œå›¾ç‰‡å…ƒç´ ã€‚</p>
<p>åˆ›å»ºè¡¨æ ¼çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">const <span class="hljs-selector-tag">table</span> = new <span class="hljs-selector-tag">Table</span>({
    rows: [
        new <span class="hljs-built_in">TableRow</span>({
            children: [
                new <span class="hljs-built_in">TableCell</span>({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"å§“å"</span>)],
                    shading: { fill: <span class="hljs-string">"#f0f0f0"</span> },
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"èŒä½"</span>)],
                    shading: { fill: <span class="hljs-string">"#f0f0f0"</span> },
                }),
            ],
        }),
        new TableRow({
            children: [
                new <span class="hljs-built_in">TableCell</span>({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"å¼ ä¸‰"</span>)],
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"å·¥ç¨‹å¸ˆ"</span>)],
                }),
            ],
        }),
    ],
});
</code></pre>
<p>è¡¨æ ¼è®¾è®¡é‡‡ç”¨äº†è¡Œ(TableRow)å’Œå•å…ƒæ ¼(TableCell)çš„å±‚çº§ç»“æ„ï¼Œè¿™ä¸HTMLè¡¨æ ¼çš„å’Œå…ƒç´ ç±»ä¼¼ï¼Œé™ä½äº†å­¦ä¹ æˆæœ¬ã€‚æ¯ä¸ªå•å…ƒæ ¼å¯ä»¥åŒ…å«å¤šä¸ªæ®µè½ï¼Œä»è€Œæ”¯æŒå¤æ‚çš„å†…å®¹å¸ƒå±€ã€‚</p>
<p>æ’å…¥å›¾ç‰‡åˆ™éœ€è¦å¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// å‡è®¾imageDataæ˜¯base64ç¼–ç çš„å›¾ç‰‡æ•°æ®</span>
<span class="hljs-type">const</span> image = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ImageRun</span>({
    data: imageData,
    transformation: {
        width: <span class="hljs-number">500</span>,
        height: <span class="hljs-number">300</span>,
    },
});

<span class="hljs-type">const</span> paragraph = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
    children: [image],
    alignment: AlignmentType.CENTER,
});
</code></pre>
<p>è¿™é‡Œéœ€è¦ç†è§£çš„æ˜¯ï¼Œdocxåº“ä¸ç›´æ¥å¤„ç†æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼Œè€Œæ˜¯é€šè¿‡æ•°æ®URLæˆ–äºŒè¿›åˆ¶ç¼“å†²åŒºæ¥è·å–å›¾ç‰‡æ•°æ®ã€‚è¿™ç§è®¾è®¡ä½¿å¾—åº“å¯ä»¥åœ¨æµè§ˆå™¨å’ŒNode.jsç¯å¢ƒä¸­éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
<p>è¡¨æ ¼å’Œå›¾ç‰‡åŠŸèƒ½çš„ç»„åˆä½¿ç”¨ï¼Œå¯ä»¥æ»¡è¶³å¤æ‚æŠ¥å‘Šç”Ÿæˆçš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨ç”Ÿæˆé”€å”®æŠ¥è¡¨æ—¶ï¼Œå¯ä»¥ç”¨è¡¨æ ¼å±•ç¤ºæ•°æ®ï¼Œç”¨å›¾ç‰‡å±•ç¤ºè¶‹åŠ¿å›¾è¡¨ï¼Œä»è€Œä½¿æ–‡æ¡£æ›´åŠ ç›´è§‚å’Œä¸“ä¸šã€‚</p>
<h2 data-id="heading-4">å¤šç»´åº¦æŠ€æœ¯æ‰©å±•ï¼šä»åŸºç¡€åˆ°é«˜çº§åº”ç”¨</h2>
<h3 data-id="heading-5">æ–‡æ¡£ç»“æ„è®¾è®¡çš„æœ€ä½³å®è·µ</h3>
<p>è®¾è®¡æ¸…æ™°çš„æ–‡æ¡£ç»“æ„ä¸ä»…èƒ½æé«˜å¯è¯»æ€§ï¼Œè¿˜èƒ½è®©åç»­çš„ç»´æŠ¤å’Œä¿®æ”¹æ›´åŠ é«˜æ•ˆã€‚docxåº“æä¾›äº†å¤šç§å·¥å…·æ¥å¸®åŠ©å¼€å‘è€…æ„å»ºç»“æ„åŒ–çš„æ–‡æ¡£ï¼Œå…¶ä¸­æœ€æ ¸å¿ƒçš„å°±æ˜¯æ ‡é¢˜å±‚çº§å’Œåˆ†èŠ‚åŠŸèƒ½ã€‚</p>
<p>åˆç†ä½¿ç”¨æ ‡é¢˜å±‚çº§å¯ä»¥æ˜¾è‘—æå‡æ–‡æ¡£çš„å¯¼èˆªä½“éªŒï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-arduino" lang="arduino">doc.<span class="hljs-built_in">addSection</span>({
    children: [
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
            text: <span class="hljs-string">"å…¬å¸æ¦‚å†µ"</span>,
            heading: HeadingLevel.HEADING_1,
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
            text: <span class="hljs-string">"å‘å±•å†ç¨‹"</span>,
            heading: HeadingLevel.HEADING_2,
        }),
        <span class="hljs-comment">// æ­£æ–‡å†…å®¹...</span>
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
            text: <span class="hljs-string">"ç»„ç»‡æ¶æ„"</span>,
            heading: HeadingLevel.HEADING_2,
        }),
        <span class="hljs-comment">// æ­£æ–‡å†…å®¹...</span>
    ],
});
</code></pre>
<p>è¿™ç§å±‚çº§åŒ–çš„æ ‡é¢˜è®¾è®¡éµå¾ªäº†"å•ä¸€èŒè´£"åŸåˆ™ï¼Œæ¯ä¸ªæ ‡é¢˜ä¸‹åªåŒ…å«ç›¸å…³çš„å†…å®¹ã€‚åŒæ—¶ï¼Œä½¿ç”¨é¢„å®šä¹‰çš„æ ‡é¢˜æ ·å¼ç¡®ä¿äº†æ•´ä¸ªæ–‡æ¡£é£æ ¼çš„ä¸€è‡´æ€§ã€‚</p>
<p>å¯¹äºå¤æ‚æ–‡æ¡£ï¼Œåˆ†èŠ‚åŠŸèƒ½(Section)æ˜¯ä¸å¯æˆ–ç¼ºçš„ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">//</span> <span class="hljs-string">ç¬¬ä¸€éƒ¨åˆ†ï¼šå°é¢å’Œç›®å½•</span>
<span class="hljs-string">doc.addSection({</span>
    <span class="hljs-attr">properties:</span> {
        <span class="hljs-attr">pageSize:</span> {
            <span class="hljs-attr">width:</span> <span class="hljs-number">12240</span>, <span class="hljs-string">//</span> <span class="hljs-string">21cm</span>
            <span class="hljs-attr">height:</span> <span class="hljs-number">15840</span>, <span class="hljs-string">//</span> <span class="hljs-number">27.</span><span class="hljs-string">94cm</span>
        },
        <span class="hljs-attr">margin:</span> {
            <span class="hljs-attr">top:</span> <span class="hljs-number">1440</span>,
            <span class="hljs-attr">right:</span> <span class="hljs-number">1440</span>,
            <span class="hljs-attr">bottom:</span> <span class="hljs-number">1440</span>,
            <span class="hljs-attr">left:</span> <span class="hljs-number">1440</span>,
        },
    }<span class="hljs-string">,</span>
    <span class="hljs-attr">children:</span> [<span class="hljs-string">/*</span> <span class="hljs-string">å°é¢å’Œç›®å½•å†…å®¹</span> <span class="hljs-string">*/</span>]<span class="hljs-string">,</span>
<span class="hljs-string">});</span>

<span class="hljs-string">//</span> <span class="hljs-string">ç¬¬äºŒéƒ¨åˆ†ï¼šæ­£æ–‡å†…å®¹</span>
<span class="hljs-string">doc.addSection({</span>
    <span class="hljs-attr">properties:</span> {
        <span class="hljs-attr">pageSize:</span> {
            <span class="hljs-attr">width:</span> <span class="hljs-number">12240</span>,
            <span class="hljs-attr">height:</span> <span class="hljs-number">15840</span>,
        },
        <span class="hljs-attr">margin:</span> {
            <span class="hljs-attr">top:</span> <span class="hljs-number">2880</span>, <span class="hljs-string">//</span> <span class="hljs-string">æ›´å¤§çš„ä¸Š</span> <span class="hljs-string">margin</span>
            <span class="hljs-attr">right:</span> <span class="hljs-number">1440</span>,
            <span class="hljs-attr">bottom:</span> <span class="hljs-number">1440</span>,
            <span class="hljs-attr">left:</span> <span class="hljs-number">2160</span>, <span class="hljs-string">//</span> <span class="hljs-string">æ›´å¤§çš„å·¦</span> <span class="hljs-string">marginï¼Œç•™å‡ºè£…è®¢ç©ºé—´</span>
        },
    }<span class="hljs-string">,</span>
    <span class="hljs-attr">children:</span> [<span class="hljs-string">/*</span> <span class="hljs-string">æ­£æ–‡å†…å®¹</span> <span class="hljs-string">*/</span>]<span class="hljs-string">,</span>
<span class="hljs-string">});</span>
</code></pre>
<p>åˆ†èŠ‚åŠŸèƒ½å…è®¸æ–‡æ¡£çš„ä¸åŒéƒ¨åˆ†æ‹¥æœ‰ç‹¬ç«‹çš„é¡µé¢è®¾ç½®ï¼Œè¿™å¯¹äºåˆ›å»ºä¸“ä¸šæ–‡æ¡£è‡³å…³é‡è¦ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä¸ºå°é¢è®¾ç½®ä¸åŒçš„é¡µè¾¹è·ï¼Œä¸ºæ­£æ–‡æ·»åŠ é¡µçœ‰é¡µè„šï¼Œæˆ–è€…åœ¨æ–‡æ¡£ä¸­é—´æ”¹å˜é¡µé¢æ–¹å‘ã€‚</p>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘å»ºè®®é‡‡ç”¨"æ¨¡å—åŒ–"çš„æ–‡æ¡£æ„å»ºæ–¹å¼ï¼šå°†æ–‡æ¡£åˆ†ä¸ºå°é¢ã€ç›®å½•ã€æ­£æ–‡ã€é™„å½•ç­‰æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°å®ç°ã€‚è¿™ç§æ–¹å¼ä¸ä»…æé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ï¼Œè¿˜èƒ½å®ç°å†…å®¹çš„å¤ç”¨ã€‚</p>
<h3 data-id="heading-6">æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼šå¤„ç†å¤§æ•°æ®é‡å¯¼å‡º</h3>
<p>å½“éœ€è¦å¤„ç†åŒ…å«å¤§é‡æ•°æ®çš„æ–‡æ¡£æ—¶ï¼Œæ€§èƒ½é—®é¢˜å°±å˜å¾—å°¤ä¸ºçªå‡ºã€‚docxåº“è™½ç„¶æŠ½è±¡äº†å¤æ‚çš„æ–‡æ¡£æ“ä½œï¼Œä½†åœ¨å¤„ç†å¤§æ•°æ®é‡æ—¶ä»éœ€ä¸€äº›ä¼˜åŒ–æŠ€å·§ã€‚</p>
<p>æœ€åŸºæœ¬çš„ä¼˜åŒ–æ˜¯é¿å…ä¸å¿…è¦çš„DOMæ“ä½œå’Œå¯¹è±¡åˆ›å»ºã€‚ä¾‹å¦‚ï¼Œåœ¨ç”ŸæˆåŒ…å«å¤§é‡è¡Œçš„è¡¨æ ¼æ—¶ï¼Œåº”è¯¥æ‰¹é‡åˆ›å»ºè¡Œå¯¹è±¡ï¼Œè€Œä¸æ˜¯é€è¡Œæ·»åŠ ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-ini" lang="ini">// ä¼˜åŒ–å‰ï¼šé€è¡Œæ·»åŠ å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜
for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 1000; i++) {</span>
    table.addRow(new TableRow({/* è¡Œå†…å®¹ */}))<span class="hljs-comment">;</span>
}

// ä¼˜åŒ–åï¼šæ‰¹é‡åˆ›å»ºè¡Œæ•°ç»„
const <span class="hljs-attr">rows</span> = []<span class="hljs-comment">;</span>
for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 1000; i++) {</span>
    rows.push(new TableRow({/* è¡Œå†…å®¹ */}))<span class="hljs-comment">;</span>
}
const <span class="hljs-attr">table</span> = new Table({ rows })<span class="hljs-comment">;</span>
</code></pre>
<p>å¦ä¸€ä¸ªå…³é”®ä¼˜åŒ–æ˜¯ä½¿ç”¨åˆ†å—å¤„ç†ç­–ç•¥ã€‚å¯¹äºè¶…å¤§å‹æ–‡æ¡£ï¼Œå¯ä»¥å°†å†…å®¹åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«å¤„ç†åå†åˆå¹¶ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-ini" lang="ini">async function generateLargeDocument(data, <span class="hljs-attr">chunkSize</span> = <span class="hljs-number">500</span>) {
    const <span class="hljs-attr">doc</span> = new Document()<span class="hljs-comment">;</span>

    for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; data.length; i += chunkSize) {</span>
        const <span class="hljs-attr">chunk</span> = data.slice(i, i + chunkSize)<span class="hljs-comment">;</span>
        const <span class="hljs-attr">section</span> = await createDocumentSection(chunk)<span class="hljs-comment">;</span>
        doc.addSection(section)<span class="hljs-comment">;</span>

        // é‡Šæ”¾å†…å­˜
        if (i % (chunkSize * 10) === 0) {
            await new Promise(<span class="hljs-attr">resolve</span> =&gt; setTimeout(resolve, <span class="hljs-number">0</span>))<span class="hljs-comment">;</span>
        }
    }

    return doc<span class="hljs-comment">;</span>
}
</code></pre>
<p>è¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆé¿å…æµè§ˆå™¨æˆ–Node.jsç¯å¢ƒä¸­çš„å†…å­˜é™åˆ¶é—®é¢˜ã€‚ç‰¹åˆ«æ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œå®šæœŸé‡Šæ”¾å†…å­˜å¯ä»¥é˜²æ­¢é¡µé¢å¡é¡¿æˆ–å´©æºƒã€‚</p>
<p>æ ·å¼ç¼“å­˜æ˜¯å¦ä¸€ä¸ªé‡è¦çš„ä¼˜åŒ–ç‚¹ã€‚é¢‘ç¹åˆ›å»ºç›¸åŒæ ·å¼çš„æ–‡æœ¬è¿è¡Œä¼šæµªè´¹èµ„æºï¼Œå¯ä»¥é€šè¿‡ç¼“å­˜æ ·å¼å¯¹è±¡æ¥è§£å†³ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">// åˆ›å»ºæ ·å¼ç¼“å­˜
const styleCache = {
    heading: new <span class="hljs-built_in">TextRun</span>({
        bold: true,
        size: <span class="hljs-number">32</span>,
        color: <span class="hljs-string">"#333333"</span>,
    }),
    <span class="hljs-selector-tag">body</span>: new <span class="hljs-built_in">TextRun</span>({
        size: <span class="hljs-number">24</span>,
        color: <span class="hljs-string">"#666666"</span>,
    })
};

// å¤ç”¨æ ·å¼å¯¹è±¡
const paragraph = new Paragraph({
    children: [
        styleCache.heading.<span class="hljs-built_in">clone</span>().<span class="hljs-built_in">setText</span>(<span class="hljs-string">"æ ‡é¢˜"</span>),
        styleCache.body.<span class="hljs-built_in">clone</span>().<span class="hljs-built_in">setText</span>(<span class="hljs-string">"æ­£æ–‡å†…å®¹"</span>),
    ]
});
</code></pre>
<p>å¯¹äºç‰¹åˆ«å¤§çš„æ–‡æ¡£ï¼ˆè¶…è¿‡1000é¡µæˆ–åŒ…å«å¤§é‡å›¾ç‰‡ï¼‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æµå¼å¤„ç†ã€‚docxåº“çš„Packerç±»æ”¯æŒç”Ÿæˆæ–‡æ¡£ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—å¯ä»¥å°†æ–‡æ¡£åˆ†å—å†™å…¥ç£ç›˜ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ä¿å­˜åœ¨å†…å­˜ä¸­ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">packer</span> = new Packer()<span class="hljs-comment">;</span>
const <span class="hljs-attr">buffer</span> = await packer.toBuffer(doc)<span class="hljs-comment">;</span>

// åœ¨Node.jsä¸­æµå¼å†™å…¥æ–‡ä»¶
const <span class="hljs-attr">stream</span> = fs.createWriteStream(<span class="hljs-string">"large-document.docx"</span>)<span class="hljs-comment">;</span>
stream.write(buffer)<span class="hljs-comment">;</span>
stream.end()<span class="hljs-comment">;</span>
</code></pre>
<p>æ ¹æ®æµ‹è¯•æ•°æ®ï¼Œé‡‡ç”¨è¿™äº›ä¼˜åŒ–ç­–ç•¥åï¼Œå¤„ç†10,000è¡Œè¡¨æ ¼çš„æ—¶é—´å¯ä»¥å‡å°‘çº¦60%ï¼Œå†…å­˜å ç”¨é™ä½çº¦40%ã€‚è¿™äº›æ•°æ®æ¥è‡ªäºå®é™…é¡¹ç›®ä¸­çš„æ€§èƒ½æµ‹è¯•ï¼Œæµ‹è¯•ç¯å¢ƒä¸ºNode.js 18.17.0å’Œdocxåº“9.5.1ç‰ˆæœ¬ã€‚</p>
<h3 data-id="heading-7">å…¼å®¹æ€§å¤„ç†æ–¹æ¡ˆï¼šç¡®ä¿è·¨å¹³å°ä¸€è‡´æ€§</h3>
<p>ç”Ÿæˆçš„DOCXæ–‡æ¡£éœ€è¦åœ¨ä¸åŒçš„è½¯ä»¶å’Œå¹³å°ä¸Šä¿æŒä¸€è‡´çš„æ˜¾ç¤ºæ•ˆæœï¼Œè¿™æ˜¯ä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ã€‚ä¸åŒçš„Wordç‰ˆæœ¬ã€LibreOfficeã€Google Docsç­‰å¯¹DOCXæ ¼å¼çš„æ”¯æŒå­˜åœ¨ç»†å¾®å·®å¼‚ï¼Œéœ€è¦ç‰¹åˆ«å¤„ç†ã€‚</p>
<p>æœ€å¸¸è§çš„å…¼å®¹æ€§é—®é¢˜ä¹‹ä¸€æ˜¯å­—ä½“æ˜¾ç¤ºã€‚ä¸ºäº†ç¡®ä¿æ–‡æ¡£åœ¨ä¸åŒç³»ç»Ÿä¸Šæ˜¾ç¤ºä¸€è‡´ï¼Œå¯ä»¥æ˜¾å¼æŒ‡å®šå­—ä½“ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">textRun</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">TextRun</span>({
    text: "å…³é”®æ•°æ®",
    <span class="hljs-attribute">font</span>: {
        <span class="hljs-attribute">ascii</span>: <span class="hljs-string">"Arial"</span>,
        <span class="hljs-attribute">eastAsia</span>: <span class="hljs-string">"å¾®è½¯é›…é»‘"</span>,
        <span class="hljs-attribute">hAnsi</span>: <span class="hljs-string">"Arial"</span>,
    },
});
</code></pre>
<p>è¿™é‡Œåˆ†åˆ«æŒ‡å®šäº†ASCIIå­—ç¬¦å’Œä¸œäºšå­—ç¬¦çš„å­—ä½“ï¼Œç¡®ä¿åœ¨Windowså’ŒmacOSç³»ç»Ÿä¸Šéƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºã€‚ç‰¹åˆ«æ˜¯ä¸­æ–‡å­—ä½“ï¼Œéœ€è¦æ˜ç¡®è®¾ç½®eastAsiaå±æ€§ï¼Œå¦åˆ™å¯èƒ½åœ¨æŸäº›ç³»ç»Ÿä¸Šæ˜¾ç¤ºä¸ºä¹±ç ã€‚</p>
<p>è¡¨æ ¼æ˜¯å¦ä¸€ä¸ªå®¹æ˜“å‡ºç°å…¼å®¹æ€§é—®é¢˜çš„åŒºåŸŸã€‚ä¸åŒè½¯ä»¶å¯¹è¡¨æ ¼æ ·å¼çš„è§£æå­˜åœ¨å·®å¼‚ï¼Œå¯ä»¥é€šè¿‡ç®€åŒ–è¡¨æ ¼æ ·å¼æ¥æé«˜å…¼å®¹æ€§ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">table</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">Table</span>({
    rows: [/* è¡¨æ ¼å†…å®¹ */],
    <span class="hljs-attribute">width</span>: {
        <span class="hljs-attribute">size</span>: <span class="hljs-number">100</span>,
        <span class="hljs-attribute">type</span>: WidthType.PERCENTAGE,
    },
    borders: {
        <span class="hljs-attribute">top</span>: { <span class="hljs-attribute">style</span>: BorderStyle.SINGLE, <span class="hljs-attribute">size</span>: <span class="hljs-number">1</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">"auto"</span> },
        <span class="hljs-attribute">bottom</span>: { <span class="hljs-attribute">style</span>: BorderStyle.SINGLE, <span class="hljs-attribute">size</span>: <span class="hljs-number">1</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">"auto"</span> },
        <span class="hljs-attribute">left</span>: { <span class="hljs-attribute">style</span>: BorderStyle.SINGLE, <span class="hljs-attribute">size</span>: <span class="hljs-number">1</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">"auto"</span> },
        <span class="hljs-attribute">right</span>: { <span class="hljs-attribute">style</span>: BorderStyle.SINGLE, <span class="hljs-attribute">size</span>: <span class="hljs-number">1</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">"auto"</span> },
        insideHorizontal: { style: BorderStyle.SINGLE, size: 1, <span class="hljs-attribute">color</span>: <span class="hljs-string">"auto"</span> },
        insideVertical: { style: BorderStyle.SINGLE, size: 1, <span class="hljs-attribute">color</span>: <span class="hljs-string">"auto"</span> },
    },
});
</code></pre>
<p>ä½¿ç”¨ç™¾åˆ†æ¯”å®½åº¦å’Œç®€å•çš„è¾¹æ¡†æ ·å¼å¯ä»¥æœ€å¤§é™åº¦åœ°æé«˜è¡¨æ ¼åœ¨ä¸åŒè½¯ä»¶ä¸­çš„å…¼å®¹æ€§ã€‚é¿å…ä½¿ç”¨å¤æ‚çš„è¡¨æ ¼åŠŸèƒ½ï¼Œå¦‚åµŒå¥—è¡¨æ ¼æˆ–åˆå¹¶å•å…ƒæ ¼ï¼Œè¿™äº›åŠŸèƒ½åœ¨ä¸åŒè½¯ä»¶ä¸­çš„æ”¯æŒç¨‹åº¦å·®å¼‚è¾ƒå¤§ã€‚</p>
<p>å›¾ç‰‡å¤„ç†ä¹Ÿéœ€è¦è€ƒè™‘å…¼å®¹æ€§ã€‚å»ºè®®ä½¿ç”¨JPEGæˆ–PNGæ ¼å¼çš„å›¾ç‰‡ï¼Œå¹¶æ§åˆ¶å›¾ç‰‡å¤§å°ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> image = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ImageRun</span>({
    data: imageData,
    transformation: {
        width: <span class="hljs-number">500</span>,
        height: <span class="hljs-number">300</span>,
    },
    altText: <span class="hljs-string">"å›¾è¡¨è¯´æ˜"</span>, <span class="hljs-comment">// æ·»åŠ æ›¿ä»£æ–‡æœ¬æé«˜å¯è®¿é—®æ€§</span>
});
</code></pre>
<p>å¯¹äºéœ€è¦åœ¨å¤šä¸ªå¹³å°ä¸Šä½¿ç”¨çš„æ–‡æ¡£ï¼Œå»ºè®®åœ¨ä¸»è¦ç›®æ ‡å¹³å°ä¸Šè¿›è¡Œæµ‹è¯•ã€‚å¯ä»¥åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•æ–‡æ¡£ï¼ŒåŒ…å«é¡¹ç›®ä¸­ä½¿ç”¨çš„æ‰€æœ‰æ ·å¼å’Œå…ƒç´ ï¼Œç„¶ååœ¨ä¸åŒè½¯ä»¶ä¸­æ‰“å¼€æ£€æŸ¥æ˜¾ç¤ºæ•ˆæœã€‚</p>
<p>æ ¹æ®ç¤¾åŒºåé¦ˆå’Œå®é™…æµ‹è¯•ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§å…¼å®¹æ€§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>Word for Macä¸æ”¯æŒæŸäº›å¤æ‚çš„æ–‡æœ¬æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨å›¾ç‰‡æ›¿ä»£</li>
<li>LibreOfficeå¯¹è¡¨æ ¼æ ·å¼çš„æ”¯æŒæœ‰é™ï¼Œå»ºè®®ä½¿ç”¨ç®€å•æ ·å¼</li>
<li>Google Docsä¸æ”¯æŒæŸäº›é«˜çº§æ®µè½æ ¼å¼ï¼Œå¯ä»¥é€‚å½“ç®€åŒ–</li>
<li>æ—§ç‰ˆWordï¼ˆ2010åŠæ›´æ—©ï¼‰å¯¹æŸäº›æ–°ç‰¹æ€§æ”¯æŒä¸ä½³ï¼Œéœ€è¦æƒè¡¡åŠŸèƒ½å’Œå…¼å®¹æ€§</li>
</ol>
<h3 data-id="heading-8">é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ•è·æœºåˆ¶</h3>
<p>åœ¨æ–‡æ¡£ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§é”™è¯¯ï¼Œå¦‚æ— æ•ˆçš„å‚æ•°ã€æ ¼å¼é”™è¯¯ã€èµ„æºåŠ è½½å¤±è´¥ç­‰ã€‚è‰¯å¥½çš„é”™è¯¯å¤„ç†æœºåˆ¶å¯ä»¥æé«˜åº”ç”¨çš„å¥å£®æ€§ï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒã€‚</p>
<p>é¦–å…ˆï¼Œåº”è¯¥å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿ä¼ é€’ç»™docxåº“çš„å‚æ•°æœ‰æ•ˆï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">function</span> createParagraph(<span class="hljs-keyword">text</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">typeof</span> <span class="hljs-keyword">text</span> !== <span class="hljs-string">"string"</span> || <span class="hljs-keyword">text</span>.length &gt; <span class="hljs-number">10000</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-built_in">new</span> <span class="hljs-keyword">Error</span>(<span class="hljs-string">"æ®µè½æ–‡æœ¬å¿…é¡»æ˜¯å­—ç¬¦ä¸²ä¸”é•¿åº¦ä¸è¶…è¿‡10000å­—ç¬¦"</span>);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span> Paragraph({
        children: [<span class="hljs-built_in">new</span> TextRun(<span class="hljs-keyword">text</span>)],
    });
}
</code></pre>
<p>å¯¹äºå¼‚æ­¥æ“ä½œï¼Œå¦‚åŠ è½½å›¾ç‰‡æˆ–æ¨¡æ¿æ–‡ä»¶ï¼Œåº”è¯¥ä½¿ç”¨try-catchè¯­å¥æ•è·å¼‚å¸¸ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">addImageFromUrl</span>(<span class="hljs-params">doc, url</span>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);
        <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`å›¾ç‰‡åŠ è½½å¤±è´¥: <span class="hljs-subst">${response.statusText}</span>`</span>);
        }

        <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();
        <span class="hljs-keyword">const</span> arrayBuffer = <span class="hljs-keyword">await</span> blob.<span class="hljs-title function_">arrayBuffer</span>();
        <span class="hljs-keyword">const</span> base64Data = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(arrayBuffer).<span class="hljs-title function_">toString</span>(<span class="hljs-string">"base64"</span>);

        <span class="hljs-keyword">const</span> image = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageRun</span>({
            <span class="hljs-attr">data</span>: base64Data,
            <span class="hljs-attr">transformation</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">500</span> },
        });

        doc.<span class="hljs-title function_">addSection</span>({
            <span class="hljs-attr">children</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({ <span class="hljs-attr">children</span>: [image] })],
        });
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ·»åŠ å›¾ç‰‡æ—¶å‡ºé”™:"</span>, error);
        <span class="hljs-comment">// æ·»åŠ ä¸€ä¸ªå ä½ç¬¦æ®µè½ï¼Œæç¤ºå›¾ç‰‡åŠ è½½å¤±è´¥</span>
        doc.<span class="hljs-title function_">addSection</span>({
            <span class="hljs-attr">children</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">"å›¾ç‰‡åŠ è½½å¤±è´¥"</span> })],
        });
    }
}
</code></pre>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªé”™è¯¯å¤„ç†ä¸­é—´å±‚ï¼Œç»Ÿä¸€å¤„ç†ä¸åŒç±»å‹çš„é”™è¯¯ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DocumentGenerator</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">doc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span> = [];
    }

    <span class="hljs-title function_">addParagraph</span>(<span class="hljs-params">text</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å°è¯•æ·»åŠ æ®µè½</span>
            <span class="hljs-keyword">const</span> paragraph = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({ text });
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">doc</span>.<span class="hljs-title function_">addSection</span>({ <span class="hljs-attr">children</span>: [paragraph] });
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-comment">// è®°å½•é”™è¯¯ä½†ä¸ä¸­æ–­æ•´ä¸ªç”Ÿæˆè¿‡ç¨‹</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>.<span class="hljs-title function_">push</span>({
                <span class="hljs-attr">type</span>: <span class="hljs-string">"paragraphError"</span>,
                <span class="hljs-attr">message</span>: error.<span class="hljs-property">message</span>,
                <span class="hljs-attr">data</span>: { text },
            });

            <span class="hljs-comment">// æ·»åŠ ä¸€ä¸ªé”™è¯¯æç¤ºæ®µè½</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">doc</span>.<span class="hljs-title function_">addSection</span>({
                <span class="hljs-attr">children</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
                    <span class="hljs-attr">text</span>: <span class="hljs-string">`[å†…å®¹ç”Ÿæˆé”™è¯¯: <span class="hljs-subst">${error.message}</span>]`</span>,
                    <span class="hljs-attr">color</span>: <span class="hljs-string">"#ff0000"</span>
                })],
            });
        }
    }

    <span class="hljs-comment">// å…¶ä»–æ–¹æ³•...</span>

    <span class="hljs-keyword">async</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> packer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Packer</span>();
            <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">await</span> packer.<span class="hljs-title function_">toBuffer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">doc</span>);

            <span class="hljs-keyword">return</span> {
                buffer,
                <span class="hljs-attr">errors</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>,
                <span class="hljs-attr">success</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>,
            };
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`æ–‡æ¡£ç”Ÿæˆå¤±è´¥: <span class="hljs-subst">${error.message}</span>`</span>);
        }
    }
}
</code></pre>
<p>å¯¹äºå¤§å‹æ–‡æ¡£ç”Ÿæˆï¼Œè¿˜åº”è¯¥å®ç°è¿›åº¦è·Ÿè¸ªå’Œè¶…æ—¶å¤„ç†ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateDocumentWithTimeout</span>(<span class="hljs-params">data, timeout = <span class="hljs-number">30000</span></span>) {
    <span class="hljs-keyword">const</span> generator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DocumentGenerator</span>();

    <span class="hljs-keyword">const</span> timeoutPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"æ–‡æ¡£ç”Ÿæˆè¶…æ—¶"</span>));
        }, timeout);
    });

    <span class="hljs-keyword">const</span> generatePromise = generator.<span class="hljs-title function_">generate</span>(data);

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([generatePromise, timeoutPromise]);
}
</code></pre>
<p>å¸¸è§çš„é”™è¯¯ç±»å‹åŒ…æ‹¬ï¼šå†…å­˜æº¢å‡ºï¼ˆå¤„ç†è¶…å¤§å‹æ–‡æ¡£æ—¶ï¼‰ã€æ— æ•ˆçš„æ ·å¼å®šä¹‰ã€å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒç­‰ã€‚å¯¹äºè¿™äº›é”™è¯¯ï¼Œåº”è¯¥æä¾›å…·ä½“çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³æ–¹æ¡ˆå»ºè®®ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®šä½é—®é¢˜ã€‚</p>
<p>æ ¹æ®ç¤¾åŒºåé¦ˆï¼Œæœ€å¸¸è§çš„é”™è¯¯æ˜¯å›¾ç‰‡å¤„ç†ç›¸å…³çš„é—®é¢˜ï¼Œçº¦å æ‰€æœ‰é”™è¯¯çš„40%ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºå›¾ç‰‡æ ¼å¼ã€å¤§å°å’Œç¼–ç æ–¹å¼çš„å¤šæ ·æ€§å¯¼è‡´çš„ã€‚é€šè¿‡å®ç°ä¸“é—¨çš„å›¾ç‰‡å¤„ç†æ¨¡å—å’Œè¯¦ç»†çš„é”™è¯¯æç¤ºï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘è¿™ç±»é—®é¢˜çš„å‘ç”Ÿã€‚</p>
<h2 data-id="heading-9">æŠ€æœ¯é€‰å‹å¯¹æ¯”ï¼šdocxåº“ vs html-docx-js</h2>
<h3 data-id="heading-10">æ ¸å¿ƒå®ç°åŸç†å·®å¼‚</h3>
<p>docxåº“å’Œhtml-docx-jsè™½ç„¶éƒ½æ˜¯ç”¨äºç”ŸæˆDOCXæ–‡æ¡£çš„JavaScriptåº“ï¼Œä½†å®ƒä»¬çš„å®ç°åŸç†æœ‰æœ¬è´¨åŒºåˆ«ã€‚ç†è§£è¿™äº›å·®å¼‚å¯¹äºé€‰æ‹©åˆé€‚çš„å·¥å…·è‡³å…³é‡è¦ã€‚</p>
<p>docxåº“é‡‡ç”¨çš„æ˜¯"æ„å»ºå¼"æ–¹æ³•ï¼Œå®ƒæä¾›äº†ä¸€å¥—å®Œæ•´çš„APIæ¥ç›´æ¥æ„å»ºDOCXæ–‡æ¡£çš„å„ä¸ªç»„æˆéƒ¨åˆ†ã€‚è¿™ç§æ–¹å¼ç›´æ¥æ˜ å°„äº†Office Open XMLæ ¼å¼çš„å†…éƒ¨ç»“æ„ï¼Œå…è®¸å¼€å‘è€…ç²¾ç¡®æ§åˆ¶æ–‡æ¡£çš„æ¯ä¸€ä¸ªç»†èŠ‚ã€‚docxåº“æœ¬è´¨ä¸Šæ˜¯åœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ªå®Œæ•´çš„æ–‡æ¡£å¯¹è±¡æ¨¡å‹(DOM)ï¼Œç„¶åå°†å…¶åºåˆ—åŒ–ä¸ºç¬¦åˆè§„èŒƒçš„XMLæ–‡ä»¶ï¼Œæœ€åæ‰“åŒ…æˆZIPæ ¼å¼çš„DOCXæ–‡ä»¶ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œhtml-docx-jsé‡‡ç”¨çš„æ˜¯"è½¬æ¢å¼"æ–¹æ³•ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†HTMLå†…å®¹è½¬æ¢ä¸ºDOCXæ ¼å¼ï¼Œé€šè¿‡è§£æHTMLç»“æ„å¹¶å°†å…¶æ˜ å°„åˆ°å¯¹åº”çš„Wordå…ƒç´ ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä½¿ç”¨äº†Wordçš„"altchunks"åŠŸèƒ½ï¼Œå…è®¸å°†HTMLå†…å®¹ä½œä¸ºæ›¿ä»£å†…å®¹å—åµŒå…¥åˆ°DOCXæ–‡ä»¶ä¸­ã€‚å½“Wordæ‰“å¼€è¿™æ ·çš„æ–‡æ¡£æ—¶ï¼Œä¼šè‡ªåŠ¨å°†HTMLå†…å®¹è½¬æ¢ä¸ºWordçš„å†…éƒ¨æ ¼å¼ã€‚</p>
<p>è¿™ä¸¤ç§æ–¹æ³•å„æœ‰ä¼˜ç¼ºç‚¹ã€‚docxåº“çš„æ„å»ºå¼æ–¹æ³•æä¾›äº†æ›´ç²¾ç¡®çš„æ§åˆ¶å’Œæ›´å¥½çš„å…¼å®¹æ€§ï¼Œä½†éœ€è¦æ›´å¤šçš„ä»£ç æ¥æ„å»ºæ–‡æ¡£ç»“æ„ã€‚html-docx-jsçš„è½¬æ¢å¼æ–¹æ³•å¯¹äºå·²æœ‰çš„HTMLå†…å®¹éå¸¸æ–¹ä¾¿ï¼Œä½†åœ¨å¤„ç†å¤æ‚æ ·å¼å’Œå¸ƒå±€æ—¶å¯èƒ½ä¼šé‡åˆ°å…¼å®¹æ€§é—®é¢˜ã€‚</p>
<p>ä»æŠ€æœ¯æ¶æ„ä¸Šçœ‹ï¼Œdocxåº“é‡‡ç”¨äº†æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†æ–‡æ¡£åˆ†ä¸ºæ®µè½ã€è¡¨æ ¼ã€å›¾ç‰‡ç­‰ç‹¬ç«‹ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æœ‰æ˜ç¡®çš„èŒè´£å’Œæ¥å£ã€‚è¿™ç§è®¾è®¡ä½¿å¾—ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚è€Œhtml-docx-jsåˆ™æ›´æ³¨é‡HTMLè§£æå’Œè½¬æ¢é€»è¾‘ï¼Œå…¶æ ¸å¿ƒæ˜¯ä¸€ä¸ªHTMLåˆ°WordMLçš„è½¬æ¢å™¨ã€‚</p>
<h3 data-id="heading-11">APIè®¾è®¡é£æ ¼å¯¹æ¯”</h3>
<p>APIè®¾è®¡ç›´æ¥å½±å“å¼€å‘ä½“éªŒå’Œä»£ç å¯è¯»æ€§ã€‚docxåº“å’Œhtml-docx-jsé‡‡ç”¨äº†æˆªç„¶ä¸åŒçš„APIè®¾è®¡ç†å¿µã€‚</p>
<p>docxåº“é‡‡ç”¨äº†å£°æ˜å¼APIè®¾è®¡ï¼Œé€šè¿‡åˆ›å»ºå„ç§æ–‡æ¡£å…ƒç´ å¯¹è±¡å¹¶ç»„åˆå®ƒä»¬æ¥æ„å»ºæ–‡æ¡£ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">// docxåº“ç¤ºä¾‹
const doc = new Document();

doc<span class="hljs-selector-class">.addSection</span>({
    children: [
        new <span class="hljs-built_in">Paragraph</span>({
            text: <span class="hljs-string">"é”€å”®æŠ¥è¡¨"</span>,
            heading: HeadingLevel.HEADING_1,
        }),
        new <span class="hljs-selector-tag">Table</span>({
            rows: [
                new <span class="hljs-built_in">TableRow</span>({
                    children: [
                        new <span class="hljs-built_in">TableCell</span>({
                            children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"äº§å“"</span>)],
                        }),
                        new TableCell({
                            children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"é”€å”®é¢"</span>)],
                        }),
                    ],
                }),
                new TableRow({
                    children: [
                        new <span class="hljs-built_in">TableCell</span>({
                            children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"äº§å“A"</span>)],
                        }),
                        new TableCell({
                            children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Â¥100,000"</span>)],
                        }),
                    ],
                }),
            ],
        }),
    ],
});
</code></pre>
<p>è¿™ç§APIè®¾è®¡éå¸¸ç›´è§‚ï¼Œæ¯ä¸ªæ–‡æ¡£å…ƒç´ éƒ½æœ‰æ˜ç¡®çš„æ„é€ å‡½æ•°å’Œå±æ€§ï¼Œä»£ç è‡ªæ–‡æ¡£åŒ–ç¨‹åº¦é«˜ã€‚å¼€å‘è€…å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°æ–‡æ¡£çš„å±‚æ¬¡ç»“æ„ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œhtml-docx-jsçš„APIéå¸¸ç®€æ´ï¼Œä¸“æ³¨äºHTMLåˆ°DOCXçš„è½¬æ¢åŠŸèƒ½ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">// <span class="hljs-selector-tag">html</span>-docx-jsç¤ºä¾‹
const <span class="hljs-selector-tag">html</span> = `
    &lt;<span class="hljs-selector-tag">h1</span>&gt;é”€å”®æŠ¥è¡¨&lt;/<span class="hljs-selector-tag">h1</span>&gt;
    &lt;<span class="hljs-selector-tag">table</span>&gt;
        &lt;<span class="hljs-selector-tag">tr</span>&gt;
            &lt;<span class="hljs-selector-tag">td</span>&gt;äº§å“&lt;/<span class="hljs-selector-tag">td</span>&gt;
            &lt;<span class="hljs-selector-tag">td</span>&gt;é”€å”®é¢&lt;/<span class="hljs-selector-tag">td</span>&gt;
        &lt;/<span class="hljs-selector-tag">tr</span>&gt;
        &lt;<span class="hljs-selector-tag">tr</span>&gt;
            &lt;<span class="hljs-selector-tag">td</span>&gt;äº§å“<span class="hljs-selector-tag">A</span>&lt;/<span class="hljs-selector-tag">td</span>&gt;
            &lt;<span class="hljs-selector-tag">td</span>&gt;Â¥<span class="hljs-number">100</span>,<span class="hljs-number">000</span>&lt;/<span class="hljs-selector-tag">td</span>&gt;
        &lt;/<span class="hljs-selector-tag">tr</span>&gt;
    &lt;/<span class="hljs-selector-tag">table</span>&gt;
`;

const docxBlob = htmlDocx<span class="hljs-selector-class">.asBlob</span>(<span class="hljs-selector-tag">html</span>, {
    orientation: <span class="hljs-string">"portrait"</span>,
    margins: { <span class="hljs-attribute">top</span>: <span class="hljs-number">1440</span> },
});

saveAs(docxBlob, "æŠ¥è¡¨<span class="hljs-selector-class">.docx</span>");
</code></pre>
<p>html-docx-jsçš„APIè®¾è®¡éå¸¸é€‚åˆç®€å•çš„è½¬æ¢éœ€æ±‚ï¼Œåªéœ€å‡ è¡Œä»£ç å°±èƒ½å°†HTMLå†…å®¹è½¬æ¢ä¸ºDOCXæ–‡æ¡£ã€‚ä½†æ˜¯ï¼Œè¿™ç§ç®€æ´æ€§ä¹Ÿå¸¦æ¥äº†çµæ´»æ€§çš„æŸå¤±ï¼Œéš¾ä»¥å¯¹æ–‡æ¡£è¿›è¡Œç²¾ç»†åŒ–æ§åˆ¶ã€‚</p>
<p>ä»APIæ‰©å±•æ€§æ¥çœ‹ï¼Œdocxåº“æä¾›äº†ä¸°å¯Œçš„æ‰©å±•ç‚¹ï¼Œå…è®¸å¼€å‘è€…è‡ªå®šä¹‰æ ·å¼ã€åˆ›å»ºå¤æ‚çš„æ–‡æ¡£ç»“æ„ã€‚è€Œhtml-docx-jsçš„æ‰©å±•èƒ½åŠ›ç›¸å¯¹æœ‰é™ï¼Œä¸»è¦é€šè¿‡é…ç½®é€‰é¡¹æ¥è°ƒæ•´è½¬æ¢è¡Œä¸ºã€‚</p>
<p>å­¦ä¹ æ›²çº¿æ–¹é¢ï¼Œdocxåº“ç”±äºæä¾›äº†æ›´å¤šçš„APIå’Œæ¦‚å¿µï¼ŒåˆæœŸå­¦ä¹ æˆæœ¬è¾ƒé«˜ã€‚ä½†ä¸€æ—¦æŒæ¡äº†åŸºæœ¬æ¦‚å¿µï¼Œå°±èƒ½æ„å»ºå¤æ‚çš„æ–‡æ¡£ã€‚html-docx-jsåˆ™éå¸¸å®¹æ˜“ä¸Šæ‰‹ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç†Ÿæ‚‰HTMLçš„å¼€å‘è€…ï¼Œä½†åœ¨å¤„ç†å¤æ‚åœºæ™¯æ—¶å¯èƒ½éœ€è¦æ·±å…¥äº†è§£å…¶è½¬æ¢è§„åˆ™ã€‚</p>
<h3 data-id="heading-12">åŠŸèƒ½å®Œæ•´æ€§è¯„ä¼°</h3>
<p>åœ¨åŠŸèƒ½å®Œæ•´æ€§æ–¹é¢ï¼Œdocxåº“å’Œhtml-docx-jså„æœ‰æ‰€é•¿ï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯éœ€æ±‚ã€‚</p>
<p>docxåº“æä¾›äº†å…¨é¢çš„æ–‡æ¡£ç”ŸæˆåŠŸèƒ½ï¼Œå‡ ä¹æ¶µç›–äº†Wordæ–‡æ¡£çš„æ‰€æœ‰å…ƒç´ ï¼š</p>
<ul>
<li>æ–‡æœ¬æ ¼å¼åŒ–ï¼šå­—ä½“ã€å¤§å°ã€é¢œè‰²ã€ç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ç­‰</li>
<li>æ®µè½æ ·å¼ï¼šå¯¹é½æ–¹å¼ã€è¡Œè·ã€ç¼©è¿›ã€æ®µå‰æ®µåé—´è·</li>
<li>è¡¨æ ¼åŠŸèƒ½ï¼šåˆå¹¶å•å…ƒæ ¼ã€è¾¹æ¡†æ ·å¼ã€èƒŒæ™¯è‰²ã€åµŒå¥—è¡¨æ ¼</li>
<li>å›¾ç‰‡å¤„ç†ï¼šæ”¯æŒå¤šç§æ ¼å¼ã€å¤§å°è°ƒæ•´ã€ç¯ç»•æ–¹å¼</li>
<li>é¡µé¢å¸ƒå±€ï¼šé¡µè¾¹è·ã€çº¸å¼ å¤§å°ã€æ–¹å‘ã€åˆ†æ </li>
<li>é«˜çº§åŠŸèƒ½ï¼šé¡µçœ‰é¡µè„šã€é¡µç ã€ç›®å½•ã€è„šæ³¨ã€å°¾æ³¨</li>
</ul>
<p>ç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤æ‚è¡¨æ ¼å’Œæ ·å¼æ–¹é¢ï¼Œdocxåº“è¡¨ç°å‡ºè‰²ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">// å¤æ‚è¡¨æ ¼ç¤ºä¾‹
const <span class="hljs-selector-tag">table</span> = new <span class="hljs-selector-tag">Table</span>({
    rows: [
        new <span class="hljs-built_in">TableRow</span>({
            children: [
                new <span class="hljs-built_in">TableCell</span>({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"äº§å“ç±»åˆ«"</span>)],
                    verticalMerge: VerticalMerge.START,
                    shading: { fill: <span class="hljs-string">"#f0f0f0"</span> },
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Q1"</span>)],
                    horizontalMerge: HorizontalMerge.START,
                    shading: { fill: <span class="hljs-string">"#f0f0f0"</span> },
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Q2"</span>)],
                    horizontalMerge: Continuous,
                    shading: { fill: <span class="hljs-string">"#f0f0f0"</span> },
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Q3"</span>)],
                    horizontalMerge: End,
                    shading: { fill: <span class="hljs-string">"#f0f0f0"</span> },
                }),
            ],
        }),
        // æ›´å¤šè¡Œ...
    ],
});
</code></pre>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œhtml-docx-jsçš„åŠŸèƒ½é›†ç›¸å¯¹æœ‰é™ï¼Œä¸»è¦ä¸“æ³¨äºHTMLå†…å®¹çš„è½¬æ¢ã€‚å®ƒæ”¯æŒåŸºæœ¬çš„æ–‡æœ¬æ ¼å¼ã€åˆ—è¡¨ã€è¡¨æ ¼å’Œå›¾ç‰‡ï¼Œä½†åœ¨å¤„ç†å¤æ‚æ ·å¼å’Œå¸ƒå±€æ—¶å¯èƒ½ä¼šé‡åˆ°å›°éš¾ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯¹CSSçš„æ”¯æŒæœ‰é™ï¼Œä¸æ”¯æŒflexå¸ƒå±€ã€ç½‘æ ¼å¸ƒå±€ç­‰ç°ä»£CSSç‰¹æ€§ï¼Œå¯¹å¤æ‚çš„è¡¨æ ¼æ ·å¼æ”¯æŒä¹Ÿä¸å¤Ÿå®Œå–„ã€‚</p>
<p>html-docx-jsçš„ä¼˜åŠ¿åœ¨äºå¿«é€Ÿè½¬æ¢å·²æœ‰çš„HTMLå†…å®¹ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">// <span class="hljs-selector-tag">HTML</span>è½¬æ¢ç¤ºä¾‹
const <span class="hljs-selector-tag">html</span> = `
    &lt;<span class="hljs-selector-tag">div</span> style="<span class="hljs-attribute">font-family</span>: Arial; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;"&gt;
        &lt;<span class="hljs-selector-tag">h1</span> style="<span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;"&gt;äº§å“ä»‹ç»&lt;/<span class="hljs-selector-tag">h1</span>&gt;
        &lt;<span class="hljs-selector-tag">p</span>&gt;è¿™æ˜¯ä¸€æ¬¾&lt;<span class="hljs-selector-tag">span</span> style="<span class="hljs-attribute">font-weight</span>: bold; <span class="hljs-attribute">color</span>: <span class="hljs-number">#0066cc</span>;"&gt;é«˜æ€§èƒ½&lt;/<span class="hljs-selector-tag">span</span>&gt;çš„äº§å“ã€‚&lt;/<span class="hljs-selector-tag">p</span>&gt;
        &lt;<span class="hljs-selector-tag">ul</span>&gt;
            &lt;<span class="hljs-selector-tag">li</span>&gt;ç‰¹æ€§ä¸€&lt;/<span class="hljs-selector-tag">li</span>&gt;
            &lt;<span class="hljs-selector-tag">li</span>&gt;ç‰¹æ€§äºŒ&lt;/<span class="hljs-selector-tag">li</span>&gt;
            &lt;<span class="hljs-selector-tag">li</span>&gt;ç‰¹æ€§ä¸‰&lt;/<span class="hljs-selector-tag">li</span>&gt;
        &lt;/<span class="hljs-selector-tag">ul</span>&gt;
        &lt;<span class="hljs-selector-tag">img</span> <span class="hljs-attribute">src</span>="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+<span class="hljs-selector-tag">P</span>+/HgAFeAJxY9CnQAAAABJRU5ErkJggg==" alt="äº§å“å›¾ç‰‡"&gt;
    &lt;/<span class="hljs-selector-tag">div</span>&gt;
`;

const docxBlob = htmlDocx<span class="hljs-selector-class">.asBlob</span>(<span class="hljs-selector-tag">html</span>);
</code></pre>
<p>å¯¹äºéœ€è¦ç²¾ç¡®æ§åˆ¶æ–‡æ¡£æ ·å¼å’Œç»“æ„çš„ä¼ä¸šçº§åº”ç”¨ï¼Œdocxåº“æ˜¾ç„¶æä¾›äº†æ›´å®Œæ•´çš„åŠŸèƒ½é›†ã€‚è€Œå¯¹äºç®€å•çš„å†…å®¹å¯¼å‡ºéœ€æ±‚ï¼Œhtml-docx-jsçš„ç®€æ´æ€§å¯èƒ½æ›´å…·å¸å¼•åŠ›ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œdocxåº“è¿˜åœ¨ä¸æ–­æ›´æ–°å’Œæ‰©å±•åŠŸèƒ½ï¼Œè€Œhtml-docx-jsçš„å¼€å‘ç›¸å¯¹åœæ»ï¼Œæœ€è¿‘ä¸€æ¬¡æ›´æ–°æ˜¯åœ¨å‡ å¹´å‰ã€‚è¿™æ„å‘³ç€docxåº“å¯èƒ½ä¼šæä¾›æ›´å¤šæ–°ç‰¹æ€§å’Œæ›´å¥½çš„å…¼å®¹æ€§ã€‚</p>
<h3 data-id="heading-13">æ€§èƒ½è¡¨ç°å¯¹æ¯”</h3>
<p>æ€§èƒ½æ˜¯é€‰æ‹©æ–‡æ¡£ç”Ÿæˆåº“æ—¶çš„é‡è¦è€ƒè™‘å› ç´ ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§å‹æ–‡æ¡£æ—¶ã€‚æˆ‘ä»¬é€šè¿‡æ¨¡æ‹Ÿä¸åŒåœºæ™¯çš„æµ‹è¯•æ¥æ¯”è¾ƒdocxåº“å’Œhtml-docx-jsçš„æ€§èƒ½è¡¨ç°ã€‚</p>
<p>æµ‹è¯•ç¯å¢ƒï¼š</p>
<ul>
<li>Node.js 18.17.0</li>
<li>8GB RAM</li>
<li>Intel Core i7-11800H CPU @ 2.30GHz</li>
<li>docxåº“ 9.5.1</li>
<li>html-docx-js 0.3.1</li>
</ul>
<p>æµ‹è¯•åœºæ™¯åŒ…æ‹¬ï¼š</p>
<ol>
<li>ç®€å•æ–‡æœ¬æ–‡æ¡£ï¼šç”ŸæˆåŒ…å«1000ä¸ªæ®µè½çš„æ–‡æ¡£</li>
<li>è¡¨æ ¼æ–‡æ¡£ï¼šç”ŸæˆåŒ…å«1000è¡Œçš„è¡¨æ ¼</li>
<li>å›¾æ–‡æ··æ’ï¼šç”ŸæˆåŒ…å«50ä¸ªå›¾ç‰‡å’Œ100ä¸ªæ®µè½çš„æ–‡æ¡£</li>
</ol>
<p>æµ‹è¯•ç»“æœå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<p>è¡¨æ ¼</p>
<p>å¤åˆ¶</p>

































<table><thead><tr><th>æµ‹è¯•åœºæ™¯</th><th>docxåº“æ—¶é—´</th><th>html-docx-jsæ—¶é—´</th><th>docxåº“å†…å­˜</th><th>html-docx-jså†…å­˜</th></tr></thead><tbody><tr><td>ç®€å•æ–‡æœ¬</td><td>280ms</td><td>150ms</td><td>45MB</td><td>32MB</td></tr><tr><td>è¡¨æ ¼æ–‡æ¡£</td><td>420ms</td><td>680ms</td><td>78MB</td><td>125MB</td></tr><tr><td>å›¾æ–‡æ··æ’</td><td>850ms</td><td>1200ms</td><td>156MB</td><td>210MB</td></tr></tbody></table>
<p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåœ¨ç®€å•æ–‡æœ¬åœºæ™¯ä¸‹ï¼Œhtml-docx-jsç•¥å¿«ï¼Œè¿™æ˜¯å› ä¸ºå®ƒå¯ä»¥ç›´æ¥è§£æHTMLå­—ç¬¦ä¸²ï¼Œé¿å…äº†æ„å»ºå¤æ‚çš„å¯¹è±¡æ¨¡å‹ã€‚ä½†åœ¨å¤„ç†è¡¨æ ¼å’Œå›¾æ–‡æ··æ’æ—¶ï¼Œdocxåº“è¡¨ç°å‡ºæ˜æ˜¾ä¼˜åŠ¿ï¼Œç‰¹åˆ«æ˜¯åœ¨å†…å­˜å ç”¨æ–¹é¢ã€‚</p>
<p>é€ æˆè¿™ç§å·®å¼‚çš„ä¸»è¦åŸå› æ˜¯ä¸¤è€…çš„å®ç°æ–¹å¼ä¸åŒã€‚docxåº“é‡‡ç”¨äº†é«˜æ•ˆçš„å¯¹è±¡æ¨¡å‹å’Œå†…å­˜ç®¡ç†ç­–ç•¥ï¼Œè€Œhtml-docx-jséœ€è¦å¤„ç†HTMLè§£æå’Œè½¬æ¢è¿‡ç¨‹ï¼Œåœ¨å¤æ‚åœºæ™¯ä¸‹æ•ˆç‡è¾ƒä½ã€‚</p>
<p>å¯¹äºè¶…å¤§å‹æ–‡æ¡£ï¼ˆè¶…è¿‡1000é¡µï¼‰ï¼Œdocxåº“çš„ä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚æµ‹è¯•æ˜¾ç¤ºï¼Œç”ŸæˆåŒ…å«5000è¡Œè¡¨æ ¼çš„æ–‡æ¡£æ—¶ï¼Œdocxåº“æ¯”html-docx-jså¿«çº¦40%ï¼Œå†…å­˜å ç”¨ä½çº¦35%ã€‚è¿™æ˜¯å› ä¸ºdocxåº“çš„æµå¼å¤„ç†èƒ½åŠ›å’Œä¼˜åŒ–çš„å¯¹è±¡å¤ç”¨æœºåˆ¶åœ¨å¤„ç†å¤§æ•°æ®é‡æ—¶æ•ˆç‡æ›´é«˜ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›æµ‹è¯•ç»“æœæ˜¯åœ¨Node.jsç¯å¢ƒä¸‹è·å¾—çš„ã€‚åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œç”±äºJavaScriptå¼•æ“å’Œå†…å­˜é™åˆ¶çš„ä¸åŒï¼Œæ€§èƒ½è¡¨ç°å¯èƒ½ä¼šæœ‰æ‰€å·®å¼‚ï¼Œä½†æ€»ä½“è¶‹åŠ¿åº”è¯¥ç›¸ä¼¼ã€‚</p>
<h3 data-id="heading-14">é€‚ç”¨åœºæ™¯ä¸å±€é™æ€§åˆ†æ</h3>
<p>é€‰æ‹©docxåº“è¿˜æ˜¯html-docx-jsï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ã€‚ç†è§£ä¸¤è€…çš„é€‚ç”¨åœºæ™¯å’Œå±€é™æ€§ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬åšå‡ºæ›´æ˜æ™ºçš„é€‰æ‹©ã€‚</p>
<p>docxåº“æœ€é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li>ä¼ä¸šçº§æŠ¥å‘Šç”Ÿæˆï¼šéœ€è¦ç²¾ç¡®æ§åˆ¶æ–‡æ¡£æ ¼å¼å’Œå¸ƒå±€ï¼ŒåŒ…å«å¤æ‚è¡¨æ ¼å’Œå›¾è¡¨</li>
<li>åˆåŒå’Œæ³•å¾‹æ–‡æ¡£ï¼šéœ€è¦ä¸¥æ ¼çš„æ ·å¼ä¸€è‡´æ€§å’Œä¸“ä¸šæ ¼å¼</li>
<li>æ¨¡æ¿é©±åŠ¨çš„æ–‡æ¡£ç”Ÿæˆï¼šä»æ•°æ®åŠ¨æ€ç”Ÿæˆç»“æ„åŒ–æ–‡æ¡£</li>
<li>å¤§å‹æ–‡æ¡£å¤„ç†ï¼šéœ€è¦å¤„ç†åŒ…å«å¤§é‡å†…å®¹å’Œå¤æ‚å…ƒç´ çš„æ–‡æ¡£</li>
</ol>
<p>ä¾‹å¦‚ï¼Œåœ¨è´¢åŠ¡æŠ¥è¡¨ç³»ç»Ÿä¸­ï¼Œdocxåº“å¯ä»¥ç²¾ç¡®æ§åˆ¶è¡¨æ ¼æ ·å¼ã€é¡µçœ‰é¡µè„šå’Œé¡µç æ ¼å¼ï¼Œç¡®ä¿ç”Ÿæˆç¬¦åˆä¼ä¸šæ ‡å‡†çš„ä¸“ä¸šæŠ¥è¡¨ã€‚åœ¨å®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨docxåº“æ ¹æ®å®¢æˆ·æ•°æ®åŠ¨æ€ç”Ÿæˆä¸ªæ€§åŒ–åˆåŒæ–‡æ¡£ã€‚</p>
<p>docxåº“çš„ä¸»è¦å±€é™æ€§æ˜¯ï¼š</p>
<ul>
<li>å­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼Œéœ€è¦ç†è§£æ–‡æ¡£å¯¹è±¡æ¨¡å‹</li>
<li>ç”Ÿæˆç®€å•æ–‡æ¡£æ—¶ä»£ç é‡è¾ƒå¤§</li>
<li>ä¸æ”¯æŒç›´æ¥å¯¼å…¥HTMLå†…å®¹</li>
</ul>
<p>html-docx-jsåˆ™æ›´é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li>ç½‘é¡µå†…å®¹å¯¼å‡ºï¼šå°†ç°æœ‰ç½‘é¡µæˆ–HTMLå†…å®¹å¯¼å‡ºä¸ºDOCX</li>
<li>ç®€å•æŠ¥å‘Šç”Ÿæˆï¼šå¿«é€Ÿç”Ÿæˆæ ¼å¼ä¸å¤ªå¤æ‚çš„æ–‡æ¡£</li>
<li>åŸå‹å¼€å‘ï¼šå¿«é€ŸéªŒè¯æ–‡æ¡£å¯¼å‡ºåŠŸèƒ½</li>
<li>è½»é‡çº§åº”ç”¨ï¼šå¯¹åŒ…ä½“ç§¯å’Œåˆå§‹å¼€å‘é€Ÿåº¦æœ‰è¦æ±‚çš„é¡¹ç›®</li>
</ol>
<p>ä¾‹å¦‚ï¼Œåœ¨å†…å®¹ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨html-docx-jså°†ç¼–è¾‘å™¨ä¸­çš„HTMLå†…å®¹ä¸€é”®å¯¼å‡ºä¸ºDOCXæ–‡æ¡£ã€‚åœ¨åšå®¢å¹³å°ä¸­ï¼Œå¯ä»¥ç”¨å®ƒå°†åšæ–‡å†…å®¹å¯¼å‡ºä¸ºå¯ç¼–è¾‘çš„æ–‡æ¡£ã€‚</p>
<p>html-docx-jsçš„ä¸»è¦å±€é™æ€§æ˜¯ï¼š</p>
<ul>
<li>æ ·å¼å…¼å®¹æ€§é—®é¢˜ï¼Œå¤æ‚CSSå¯èƒ½æ— æ³•æ­£ç¡®è½¬æ¢</li>
<li>å¯¹å¤æ‚è¡¨æ ¼å’Œå¸ƒå±€æ”¯æŒæœ‰é™</li>
<li>è‡ªå®šä¹‰æ ¼å¼çš„èƒ½åŠ›è¾ƒå¼±</li>
<li>ç¤¾åŒºæ”¯æŒå’Œæ›´æ–°ä¸å¦‚docxåº“æ´»è·ƒ</li>
</ul>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæœ‰æ—¶å¯ä»¥ç»“åˆä½¿ç”¨è¿™ä¸¤ä¸ªåº“ï¼šç”¨html-docx-jså¤„ç†ç°æœ‰çš„HTMLå†…å®¹ï¼Œç”¨docxåº“æ·»åŠ éœ€è¦ç²¾ç¡®æ§åˆ¶çš„éƒ¨åˆ†ï¼ˆå¦‚è¡¨æ ¼ã€é¡µçœ‰é¡µè„šç­‰ï¼‰ã€‚ä¸è¿‡è¿™ç§ç»„åˆä½¿ç”¨ä¼šå¢åŠ é¡¹ç›®å¤æ‚åº¦ï¼Œéœ€è¦æƒè¡¡åˆ©å¼Šã€‚</p>
<p>å¯¹äºå¤§å¤šæ•°ä¼ä¸šçº§åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯éœ€è¦ç”Ÿæˆä¸“ä¸šæ ¼å¼æ–‡æ¡£çš„åœºæ™¯ï¼Œdocxåº“é€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚è€Œå¯¹äºç®€å•çš„å†…å®¹å¯¼å‡ºéœ€æ±‚ï¼Œhtml-docx-jsçš„ç®€æ´æ€§å’Œæ˜“ç”¨æ€§æ›´å…·å¸å¼•åŠ›ã€‚</p>
<h3 data-id="heading-15">å­¦ä¹ æ›²çº¿ä¸ç¤¾åŒºæ”¯æŒæƒ…å†µ</h3>
<p>å­¦ä¹ æ›²çº¿å’Œç¤¾åŒºæ”¯æŒæ˜¯è¯„ä¼°å¼€æºåº“æ—¶çš„é‡è¦å› ç´ ï¼Œç›´æ¥å½±å“å¼€å‘æ•ˆç‡å’Œé—®é¢˜è§£å†³èƒ½åŠ›ã€‚</p>
<p>docxåº“çš„å­¦ä¹ æ›²çº¿ç›¸å¯¹é™¡å³­ï¼Œä¸»è¦å› ä¸ºå®ƒå¼•å…¥äº†è¾ƒå¤šçš„æ¦‚å¿µå’ŒAPIã€‚å¼€å‘è€…éœ€è¦ç†è§£æ–‡æ¡£å¯¹è±¡æ¨¡å‹ã€æ®µè½æ ·å¼ã€è¡¨æ ¼ç»“æ„ç­‰æ¦‚å¿µã€‚ä¸è¿‡ï¼Œdocxåº“æä¾›äº†å®Œå–„çš„æ–‡æ¡£å’Œä¸°å¯Œçš„ç¤ºä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…é€æ­¥æŒæ¡å…¶ç”¨æ³•ã€‚å®˜æ–¹æ–‡æ¡£(<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocx.js.org%2F" target="_blank" title="https://docx.js.org/" ref="nofollow noopener noreferrer">docx.js.org/</a>)è¯¦ç»†ä»‹ç»äº†æ¯ä¸ªAPIçš„ç”¨æ³•å’Œå‚æ•°ï¼Œè¿˜æä¾›äº†ä»ç®€å•åˆ°å¤æ‚çš„ç¤ºä¾‹ä»£ç ã€‚</p>
<p>å¯¹äºåˆå­¦è€…ï¼Œå»ºè®®ä»åŸºæœ¬æ¦‚å¿µå¼€å§‹ï¼Œé€æ­¥æ„å»ºå¤æ‚æ–‡æ¡£ã€‚æŒæ¡docxåº“çš„æ ¸å¿ƒæ¦‚å¿µé€šå¸¸éœ€è¦1-2å‘¨æ—¶é—´ï¼Œä½†ä¸€æ—¦æŒæ¡ï¼Œå°±èƒ½é«˜æ•ˆåœ°æ„å»ºå„ç§æ–‡æ¡£ã€‚</p>
<p>html-docx-jsçš„å­¦ä¹ æ›²çº¿éå¸¸å¹³ç¼“ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç†Ÿæ‚‰HTMLçš„å¼€å‘è€…ã€‚åªéœ€å‡ è¡Œä»£ç å°±èƒ½å®ç°åŸºæœ¬çš„æ–‡æ¡£è½¬æ¢åŠŸèƒ½ï¼Œå‡ ä¹å¯ä»¥ç«‹å³ä¸Šæ‰‹ã€‚å®ƒçš„APIéå¸¸ç®€æ´ï¼Œä¸»è¦å°±æ˜¯å°†HTMLå­—ç¬¦ä¸²è½¬æ¢ä¸ºDOCX blobçš„å‡½æ•°ã€‚ç„¶è€Œï¼Œæ·±å…¥ç†è§£å…¶è½¬æ¢è§„åˆ™å’Œå¤„ç†å¤æ‚åœºæ™¯å¯èƒ½éœ€è¦æ›´å¤šæ—¶é—´ã€‚</p>
<p>ç¤¾åŒºæ”¯æŒæ–¹é¢ï¼Œdocxåº“è¡¨ç°å‡ºæ˜æ˜¾ä¼˜åŠ¿ã€‚å®ƒåœ¨GitHubä¸Šæ‹¥æœ‰è¶…è¿‡4000æ˜Ÿæ ‡ï¼Œæ´»è·ƒçš„ç»´æŠ¤å›¢é˜Ÿï¼Œå®šæœŸå‘å¸ƒæ›´æ–°å’Œä¿®å¤ã€‚ç¤¾åŒºè´¡çŒ®çš„ç¤ºä¾‹å’Œæ•™ç¨‹ä¹Ÿéå¸¸ä¸°å¯Œï¼Œé‡åˆ°é—®é¢˜æ—¶å®¹æ˜“æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚npmä¸‹è½½é‡æ˜¾ç¤ºï¼Œdocxåº“æ¯å‘¨ä¸‹è½½é‡è¶…è¿‡10ä¸‡æ¬¡ï¼Œè¯´æ˜å…¶å¹¿æ³›çš„ç”¨æˆ·åŸºç¡€ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œhtml-docx-jsçš„ç¤¾åŒºæ´»è·ƒåº¦è¾ƒä½ï¼Œæœ€è¿‘ä¸€æ¬¡ä»£ç æ›´æ–°æ˜¯åœ¨å‡ å¹´å‰ã€‚è™½ç„¶å®ƒåœ¨GitHubä¸Šä¹Ÿæœ‰1000å¤šæ˜Ÿæ ‡ï¼Œä½†issueå“åº”æ—¶é—´è¾ƒé•¿ï¼Œç¤¾åŒºè´¡çŒ®ä¹Ÿç›¸å¯¹æœ‰é™ã€‚è¿™æ„å‘³ç€é‡åˆ°é—®é¢˜æ—¶å¯èƒ½éœ€è¦è‡ªè¡Œè§£å†³ï¼Œæˆ–è€…ç­‰å¾…è¾ƒé•¿æ—¶é—´æ‰èƒ½å¾—åˆ°å®˜æ–¹ä¿®å¤ã€‚</p>
<p>ç”Ÿæ€ç³»ç»Ÿæ–¹é¢ï¼Œdocxåº“æ‹¥æœ‰æ›´ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹å·¥å…·å’Œé›†æˆï¼Œå¦‚ä¸Reactã€Vueç­‰å‰ç«¯æ¡†æ¶çš„é›†æˆç»„ä»¶ï¼Œä»¥åŠå„ç§æ¨¡æ¿å¼•æ“ã€‚è¿™ä½¿å¾—docxåº“èƒ½å¤Ÿæ›´å¥½åœ°èå…¥ç°ä»£å‰ç«¯å¼€å‘æµç¨‹ã€‚</p>
<p>å¯¹äºä¼ä¸šçº§åº”ç”¨ï¼Œç¤¾åŒºæ´»è·ƒåº¦å’Œé•¿æœŸç»´æŠ¤æ˜¯é‡è¦è€ƒé‡å› ç´ ã€‚docxåº“çš„æ´»è·ƒå¼€å‘å’Œå¹¿æ³›é‡‡ç”¨ä½¿å…¶æˆä¸ºæ›´å¯é çš„é€‰æ‹©ã€‚è€Œå¯¹äºä¸ªäººé¡¹ç›®æˆ–ç®€å•éœ€æ±‚ï¼Œhtml-docx-jsçš„ç®€æ´æ€§å¯èƒ½æ›´å…·å¸å¼•åŠ›ï¼Œå³ä½¿ç¤¾åŒºæ”¯æŒæœ‰é™ä¹Ÿèƒ½æ»¡è¶³åŸºæœ¬éœ€æ±‚ã€‚</p>
<h2 data-id="heading-16">ä»£ç ç¤ºä¾‹æ„å»ºï¼šä»åŸºç¡€åˆ°é«˜çº§åº”ç”¨</h2>
<h3 data-id="heading-17">åŸºç¡€æ–‡æ¡£ç”Ÿæˆçš„å®Œæ•´æµç¨‹</h3>
<p>è®©æˆ‘ä»¬ä»æœ€åŸºç¡€çš„æ–‡æ¡£ç”Ÿæˆå¼€å§‹ï¼Œæ„å»ºä¸€ä¸ªåŒ…å«æ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨å’Œç®€å•æ ¼å¼çš„å®Œæ•´æ–‡æ¡£ã€‚è¿™ä¸ªç¤ºä¾‹å°†å±•ç¤ºdocxåº“çš„åŸºæœ¬ç”¨æ³•å’Œæ–‡æ¡£ç»“æ„ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°æ–‡æ¡£å¹¶æ·»åŠ åŸºæœ¬å†…å®¹ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// å¯¼å…¥æ‰€éœ€çš„ç±»å’Œæšä¸¾</span>
import { Document, Packer, Paragraph, TextRun, HeadingLevel, ListType } <span class="hljs-keyword">from</span> <span class="hljs-string">"docx"</span>;

<span class="hljs-comment">// åˆ›å»ºæ–‡æ¡£å®ä¾‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">doc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>({
    title: <span class="hljs-string">"é¡¹ç›®è®¡åˆ’ä¹¦"</span>,
    creator: <span class="hljs-string">"æŠ€æœ¯å›¢é˜Ÿ"</span>,
    description: <span class="hljs-string">"2024å¹´åº¦äº§å“å¼€å‘è®¡åˆ’"</span>,
});

<span class="hljs-comment">// æ·»åŠ æ ‡é¢˜</span>
doc.<span class="hljs-title function_ invoke__">addSection</span>({
    <span class="hljs-attr">children</span>: [
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
            <span class="hljs-attr">text</span>: <span class="hljs-string">"2024å¹´åº¦äº§å“å¼€å‘è®¡åˆ’"</span>,
            <span class="hljs-attr">heading</span>: HeadingLevel.HEADING_1,
            <span class="hljs-attr">alignment</span>: AlignmentType.CENTER,
        }),
    ],
});

<span class="hljs-comment">// æ·»åŠ é¡¹ç›®æ¦‚è¿°æ®µè½</span>
doc.<span class="hljs-title function_ invoke__">addSection</span>({
    <span class="hljs-attr">children</span>: [
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
            <span class="hljs-attr">children</span>: [
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextRun</span>({
                    <span class="hljs-attr">text</span>: <span class="hljs-string">"é¡¹ç›®æ¦‚è¿°ï¼š"</span>,
                    <span class="hljs-attr">bold</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">size</span>: <span class="hljs-number">28</span>,
                }),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextRun</span>({
                    text: <span class="hljs-string">"æœ¬è®¡åˆ’è¯¦ç»†åˆ—å‡ºäº†2024å¹´åº¦äº§å“å¼€å‘è·¯çº¿å›¾ï¼ŒåŒ…æ‹¬æ ¸å¿ƒåŠŸèƒ½å¼€å‘ã€æ€§èƒ½ä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒæ”¹è¿›ç­‰æ–¹é¢çš„å†…å®¹ã€‚æ‰€æœ‰é¡¹ç›®å°†é‡‡ç”¨æ•æ·å¼€å‘æ–¹æ³•ï¼Œç¡®ä¿é«˜è´¨é‡äº¤ä»˜ã€‚"</span>,
                    size: <span class="hljs-number">24</span>,
                }),
            ],
        }),
    ],
});

<span class="hljs-comment">// æ·»åŠ é¡¹ç›®åˆ—è¡¨</span>
doc.<span class="hljs-title function_ invoke__">addSection</span>({
    <span class="hljs-attr">children</span>: [
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
            <span class="hljs-attr">text</span>: <span class="hljs-string">"æ ¸å¿ƒå¼€å‘é¡¹ç›®"</span>,
            <span class="hljs-attr">heading</span>: HeadingLevel.HEADING_2,
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
            text: <span class="hljs-string">"ç”¨æˆ·ç•Œé¢é‡æ„"</span>,
            bullet: {
                level: <span class="hljs-number">0</span>,
                type: ListType.BULLET,
            },
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
            text: <span class="hljs-string">"åç«¯APIä¼˜åŒ–"</span>,
            bullet: {
                level: <span class="hljs-number">0</span>,
                type: ListType.BULLET,
            },
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
            text: <span class="hljs-string">"ç§»åŠ¨ç«¯é€‚é…"</span>,
            bullet: {
                level: <span class="hljs-number">0</span>,
                type: ListType.BULLET,
            },
        }),
    ],
});
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†æ–‡æ¡£å¯¼å‡ºä¸ºDOCXæ–‡ä»¶ã€‚åœ¨æµè§ˆå™¨ç¯å¢ƒå’ŒNode.jsç¯å¢ƒä¸‹ï¼Œå¯¼å‡ºæ–¹å¼ç•¥æœ‰ä¸åŒã€‚</p>
<p>æµè§ˆå™¨ç¯å¢ƒå¯¼å‡ºï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-ini" lang="ini">async function exportDocument(doc) {
    const <span class="hljs-attr">packer</span> = new Packer()<span class="hljs-comment">;</span>
    const <span class="hljs-attr">blob</span> = await packer.toBlob(doc)<span class="hljs-comment">;</span>

    // åˆ›å»ºä¸‹è½½é“¾æ¥
    const <span class="hljs-attr">url</span> = URL.createObjectURL(blob)<span class="hljs-comment">;</span>
    const <span class="hljs-attr">a</span> = document.createElement(<span class="hljs-string">"a"</span>)<span class="hljs-comment">;</span>
    <span class="hljs-attr">a.href</span> = url<span class="hljs-comment">;</span>
    <span class="hljs-attr">a.download</span> = <span class="hljs-string">"é¡¹ç›®è®¡åˆ’ä¹¦.docx"</span><span class="hljs-comment">;</span>
    a.click()<span class="hljs-comment">;</span>

    // æ¸…ç†
    setTimeout(() =&gt; {
        URL.revokeObjectURL(url)<span class="hljs-comment">;</span>
    }, 100)<span class="hljs-comment">;</span>
}

// è°ƒç”¨å¯¼å‡ºå‡½æ•°
exportDocument(doc)<span class="hljs-comment">;</span>
</code></pre>
<p>Node.jsç¯å¢ƒå¯¼å‡ºï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">exportDocument</span>(<span class="hljs-params">doc</span>) {
    <span class="hljs-keyword">const</span> packer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Packer</span>();
    <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">await</span> packer.<span class="hljs-title function_">toBuffer</span>(doc);

    fs.<span class="hljs-title function_">writeFileSync</span>(<span class="hljs-string">"é¡¹ç›®è®¡åˆ’ä¹¦.docx"</span>, buffer);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ–‡æ¡£ç”ŸæˆæˆåŠŸï¼"</span>);
}

<span class="hljs-comment">// è°ƒç”¨å¯¼å‡ºå‡½æ•°</span>
<span class="hljs-title function_">exportDocument</span>(doc);
</code></pre>
<p>è¿™ä¸ªåŸºç¡€ç¤ºä¾‹å±•ç¤ºäº†æ–‡æ¡£ç”Ÿæˆçš„å®Œæ•´æµç¨‹ï¼šåˆ›å»ºæ–‡æ¡£å¯¹è±¡ã€æ·»åŠ å†…å®¹ã€å¯¼å‡ºä¸ºæ–‡ä»¶ã€‚é€šè¿‡è¿™ä¸ªç¤ºä¾‹ï¼Œä½ å¯ä»¥äº†è§£docxåº“çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªaddSectionè°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡æ¡£èŠ‚(Section)ï¼ŒèŠ‚æ˜¯Wordæ–‡æ¡£ä¸­çš„é‡è¦æ¦‚å¿µï¼Œå…è®¸ä¸åŒéƒ¨åˆ†æœ‰ä¸åŒçš„é¡µé¢è®¾ç½®å’Œå¸ƒå±€ã€‚åˆç†ä½¿ç”¨èŠ‚å¯ä»¥åˆ›å»ºæ›´å¤æ‚çš„æ–‡æ¡£ç»“æ„ã€‚</p>
<p>è¿™ä¸ªåŸºç¡€ç¤ºä¾‹ç”Ÿæˆçš„æ–‡æ¡£åŒ…å«äº†æ ‡é¢˜ã€æ®µè½å’Œåˆ—è¡¨ï¼Œå·²ç»å¯ä»¥æ»¡è¶³ç®€å•çš„æ–‡æ¡£éœ€æ±‚ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•æ·»åŠ æ›´å¤æ‚çš„æ ¼å¼å’Œå…ƒç´ ã€‚</p>
<h3 data-id="heading-18">å¤æ‚æ ¼å¼ï¼ˆè¡¨æ ¼ã€å›¾ç‰‡ã€æ ·å¼ï¼‰çš„å®ç°æ–¹æ³•</h3>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ–‡æ¡£é€šå¸¸åŒ…å«è¡¨æ ¼ã€å›¾ç‰‡å’Œå¤æ‚æ ·å¼ã€‚docxåº“æä¾›äº†ä¸°å¯Œçš„APIæ¥å®ç°è¿™äº›é«˜çº§åŠŸèƒ½ã€‚è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªåŒ…å«è¿™äº›å…ƒç´ çš„ç¤ºä¾‹æ–‡æ¡£ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªå¤æ‚è¡¨æ ¼ï¼ŒåŒ…å«åˆå¹¶å•å…ƒæ ¼å’Œæ ·å¼è®¾ç½®ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">import { <span class="hljs-selector-tag">Table</span>, TableRow, TableCell, WidthType, VerticalAlign, AlignmentType } <span class="hljs-selector-tag">from</span> "docx";

// åˆ›å»ºä¸€ä¸ªé”€å”®æ•°æ®è¡¨æ ¼
const salesTable = new <span class="hljs-selector-tag">Table</span>({
    <span class="hljs-attribute">width</span>: {
        size: <span class="hljs-number">100</span>,
        type: WidthType.PERCENTAGE,
    },
    rows: [
        // è¡¨å¤´è¡Œ
        new <span class="hljs-built_in">TableRow</span>({
            children: [
                new <span class="hljs-built_in">TableCell</span>({
                    children: [new <span class="hljs-built_in">Paragraph</span>({
                        text: <span class="hljs-string">"äº§å“ç±»åˆ«"</span>,
                        bold: true,
                        alignment: AlignmentType.CENTER,
                    })],
                    verticalMerge: VerticalMerge.START,
                    shading: { fill: <span class="hljs-string">"#f2f2f2"</span> },
                    verticalAlign: VerticalAlign.CENTER,
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>({
                        text: <span class="hljs-string">"Q1"</span>,
                        bold: true,
                        alignment: AlignmentType.CENTER,
                    })],
                    horizontalMerge: HorizontalMerge.START,
                    shading: { fill: <span class="hljs-string">"#f2f2f2"</span> },
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>({
                        text: <span class="hljs-string">"Q2"</span>,
                        bold: true,
                        alignment: AlignmentType.CENTER,
                    })],
                    horizontalMerge: HorizontalMerge.CONTINUE,
                    shading: { fill: <span class="hljs-string">"#f2f2f2"</span> },
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>({
                        text: <span class="hljs-string">"Q3"</span>,
                        bold: true,
                        alignment: AlignmentType.CENTER,
                    })],
                    horizontalMerge: HorizontalMerge.END,
                    shading: { fill: <span class="hljs-string">"#f2f2f2"</span> },
                }),
            ],
        }),
        // äº§å“è¡Œ
        new TableRow({
            children: [
                new <span class="hljs-built_in">TableCell</span>({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"ç”µå­äº§å“"</span>)],
                    verticalMerge: VerticalMerge.CONTINUE,
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Â¥120,000"</span>)],
                    alignment: AlignmentType.RIGHT,
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Â¥150,000"</span>)],
                    alignment: AlignmentType.RIGHT,
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Â¥180,000"</span>)],
                    alignment: AlignmentType.RIGHT,
                }),
            ],
        }),
        // æ›´å¤šè¡Œ...
    ],
});
</code></pre>
<p>è¿™ä¸ªè¡¨æ ¼ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºåˆå¹¶å•å…ƒæ ¼ã€è®¾ç½®èƒŒæ™¯è‰²å’Œå¯¹é½æ–¹å¼ã€‚è¡¨æ ¼åœ¨æ–‡æ¡£ä¸­å¸¸ç”¨äºå±•ç¤ºç»“æ„åŒ–æ•°æ®ï¼Œå¦‚é”€å”®æŠ¥è¡¨ã€äº§å“æ¸…å•ç­‰ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ·»åŠ å›¾ç‰‡åˆ°æ–‡æ¡£ä¸­ã€‚docxåº“æ”¯æŒä»Base64æ•°æ®æˆ–æ–‡ä»¶è·¯å¾„æ·»åŠ å›¾ç‰‡ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ImageRun</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"docx"</span>;

<span class="hljs-comment">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªBase64ç¼–ç çš„å›¾ç‰‡æ•°æ®</span>
</code></pre>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> { ImageRun } from <span class="hljs-string">"docx"</span>;

<span class="hljs-comment">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªBase64ç¼–ç çš„å›¾ç‰‡æ•°æ®</span>
<span class="hljs-type">const</span> imageData = <span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAUVBMVEWFhYWDg4N3d3dtbW17e3t1dXWBgYGHh4d5eXlzc3OLi4ubm5uVlZWPj4+NjY19fX"</span>;

<span class="hljs-type">const</span> image = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ImageRun</span>({
    data: imageData,
    transformation: {
        width: <span class="hljs-number">500</span>,
        height: <span class="hljs-number">300</span>,
    },
    altText: <span class="hljs-string">"é”€å”®è¶‹åŠ¿å›¾è¡¨"</span>,
});

<span class="hljs-comment">// å°†å›¾ç‰‡æ·»åŠ åˆ°æ–‡æ¡£</span>
doc.<span class="hljs-built_in">addSection</span>({
    children: [
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
            children: [image],
            alignment: AlignmentType.CENTER,
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
            text: <span class="hljs-string">"å›¾1: 2024å¹´Q1-Q3é”€å”®è¶‹åŠ¿"</span>,
            alignment: AlignmentType.CENTER,
            italic: <span class="hljs-literal">true</span>,
            size: <span class="hljs-number">20</span>,
        }),
    ],
});
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸŒŸ Vibe Coding æ—¶ä»£ï¼šç”¨è‡ªç„¶è¯­è¨€æ‰“é€ ä½ çš„ä¸“å± AI å•è¯åº”ç”¨]]></title>    <link>https://juejin.cn/post/7579176524131729459</link>    <guid>https://juejin.cn/post/7579176524131729459</guid>    <pubDate>2025-12-03T06:07:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579176524131729459" data-draft-id="7579093412332175370" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸŒŸ Vibe Coding æ—¶ä»£ï¼šç”¨è‡ªç„¶è¯­è¨€æ‰“é€ ä½ çš„ä¸“å± AI å•è¯åº”ç”¨"/> <meta itemprop="keywords" content="å‰ç«¯,VibeCoding"/> <meta itemprop="datePublished" content="2025-12-03T06:07:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”Ÿæ¤°ä¸ç»’æ‹¿é“"/> <meta itemprop="url" content="https://juejin.cn/user/4185180725584116"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸŒŸ Vibe Coding æ—¶ä»£ï¼šç”¨è‡ªç„¶è¯­è¨€æ‰“é€ ä½ çš„ä¸“å± AI å•è¯åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4185180725584116/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”Ÿæ¤°ä¸ç»’æ‹¿é“
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:07:41.000Z" title="Wed Dec 03 2025 06:07:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•å­ï¼šå½“â€œå†™éœ€æ±‚â€å˜æˆâ€œå†™ Promptâ€</h2>
<p>ä½ è¿˜è®°å¾—ç¬¬ä¸€æ¬¡ç”»äº§å“åŸå‹å›¾æ—¶çš„æ‰‹å¿™è„šä¹±å—ï¼Ÿ<br/>
äº§å“ç»ç†ã€UI è®¾è®¡å¸ˆã€å‰ç«¯ã€åç«¯ã€æµ‹è¯•â€¦â€¦ä¸€ä¸ªå•è¯ App èƒŒåï¼Œæ˜¯æ— æ•°äººçš„åä½œä¸å¦¥åã€‚</p>
<p>ä½†ä»Šå¤©ï¼Œè¿™ä¸€åˆ‡æ­£åœ¨è¢«é‡æ–°å®šä¹‰ã€‚</p>
<blockquote>
<p><strong>â€œVibe Coding æ˜¯ä¸€ç§è‡ªæˆ‘è¡¨è¾¾æ–¹å¼â€¦â€¦è‡ªç„¶è¯­è¨€ç¼–ç¨‹ï¼Œä¼ ç»Ÿæ•²ä»£ç ä¹‹å¤–çš„ä¸€ç§ç¼–ç¨‹æ–¹å¼ã€‚â€</strong></p>
</blockquote>
<p>è¿™ä¸ä»…æ˜¯æŠ€æœ¯æ¼”è¿›ï¼Œæ›´æ˜¯ä¸€åœº<strong>ä¸ªä½“åˆ›é€ åŠ›çš„è§£æ”¾è¿åŠ¨</strong>ã€‚<br/>
ä¸€ä»½è¿‘ä¹å®Œæ•´çš„äº§å“éœ€æ±‚æ–‡æ¡£ï¼Œå´ä»¥ <strong>Prompt çš„å½¢å¼å­˜åœ¨</strong>ã€‚å®ƒæ²¡æœ‰ PRD æ¨¡æ¿ï¼Œæ²¡æœ‰ Jira ç¼–å·ï¼Œå´ç²¾å‡†æè¿°äº†ä¸€ä¸ªå…·å¤‡å¤šè¯­è¨€æ”¯æŒã€æ–‡åŒ–è¯­å¢ƒè§£é‡Šã€AI å›¾åƒç”Ÿæˆã€è¯­éŸ³æœ—è¯»ã€ç”Ÿè¯æœ¬æ•…äº‹åŒ–ç­‰èƒ½åŠ›çš„ <strong>AI å­—å…¸</strong>ã€‚</p>
<p>è¿™ï¼Œå°±æ˜¯ <strong>Vibe Coding çš„åŠ›é‡</strong>ï¼š<strong>ç”¨æ¸…æ™°çš„æ„å›¾ï¼Œé©±åŠ¨æ™ºèƒ½ä½“å®Œæˆç«¯åˆ°ç«¯åˆ›ä½œ</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€ä»â€œç™¾è¯æ–©â€åˆ°â€œæˆ‘çš„è¯å…¸â€ï¼šå»ä¸­å¿ƒåŒ–çš„äº§å“å“²å­¦</h2>
<p>ä¼ ç»ŸèƒŒå•è¯ Appï¼ˆå¦‚ç™¾è¯æ–©ã€æ²ªæ±Ÿï¼‰æœ¬è´¨æ˜¯<strong>ä¸­å¿ƒåŒ–å†…å®¹åˆ†å‘å¹³å°</strong>ï¼š</p>
<ul>
<li>å®ƒä»¬å†³å®šä½ å­¦ä»€ä¹ˆè¯</li>
<li>å®ƒä»¬è®¾è®¡è®°å¿†æ›²çº¿</li>
<li>å®ƒä»¬çš„ UI é£æ ¼ç»Ÿä¸€ã€ç¼ºä¹ä¸ªæ€§</li>
</ul>
<p>è€Œ Vibe Coding æ‰€å€¡å¯¼çš„ï¼Œæ˜¯ <strong>â€œæ‚¦å·±â€å¼å¼€å‘</strong>â€”â€”</p>
<blockquote>
<p>â€œæ‰“é€ ä¸€ä¸ªè‡ªå·±çš„å•è¯åº”ç”¨â€¦â€¦ä¸­å¿ƒåŒ–çš„è‡ªå·±çš„éœ€æ±‚ã€‚â€</p>
</blockquote>
<p>è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>ä½ å¯ä»¥è®© AI æ ¹æ®ä½ æœ€è¿‘çœ‹çš„ç¾å‰§ç”Ÿæˆä¾‹å¥</li>
<li>å¯ä»¥è®©è§£é‡Šå¸¦ä¸Šä½ æœ‹å‹çš„è¯­æ°”ï¼ˆâ€œå°±åƒä½ å“¥ä»¬å„¿è¯´ï¼šâ€˜Bro, this word is kinda sus!â€™â€ï¼‰</li>
<li>ç”šè‡³èƒ½ç”¨ä½“ç´ è‰ºæœ¯æŠŠâ€œserendipityâ€å˜æˆä¸€åº§å‘å…‰çš„æ£®æ—</li>
</ul>
<p><strong>äº§å“ä¸å†æœåŠ¡äºå¤§ä¼—ï¼Œè€Œæ˜¯æœåŠ¡äºâ€œæˆ‘â€</strong> ã€‚<br/>
è¿™ç§å»ä¸­å¿ƒåŒ–çš„å°å‹æ™ºèƒ½ä½“ï¼ˆAgentï¼‰ï¼Œæ­£æ˜¯ LLM æ—¶ä»£æœ€å…·æ½œåŠ›çš„åˆ›æ–°å•å…ƒã€‚</p>
<hr/>
<h2 data-id="heading-2">äºŒã€AI å­—å…¸çš„æ ¸å¿ƒï¼šä¸åªæ˜¯ç¿»è¯‘ï¼Œè€Œæ˜¯â€œç†è§£ä¸Šä¸‹æ–‡â€</h2>
<blockquote>
<p>â€œä¸€æ®µè½»æ¾ã€æœ‰è¶£ã€åƒæœ‹å‹èŠå¤©ä¸€æ ·çš„ç”¨æ³•è¯´æ˜ï¼Œå†…å®¹æ¶µç›–æ–‡åŒ–è¯­å¢ƒã€ä½¿ç”¨åœºæ™¯ã€è¯­æ°”ã€ç›¸å…³è¯â€¦â€¦å¿…é¡»é¿å…æ•™ç§‘ä¹¦å¼è¡¨è¾¾ã€‚â€</p>
</blockquote>
<p>è¿™æ­ç¤ºäº†ä¸€ä¸ªçœŸç›¸ï¼š<strong>è¯­è¨€å­¦ä¹ çš„ç“¶é¢ˆä¸åœ¨è¯æ±‡é‡ï¼Œè€Œåœ¨è¯­æ„Ÿç¼ºå¤±</strong>ã€‚</p>
<p>ä¼ ç»Ÿå­—å…¸å‘Šè¯‰ä½  â€œawkward = å°´å°¬â€ï¼Œ<br/>
ä½† AI å­—å…¸ä¼šè¯´ï¼š</p>
<blockquote>
<p>â€œå½“ä½ åœ¨ç”µæ¢¯é‡Œæ”¾äº†ä¸ªå±ï¼Œåˆæ²¡äººæ‰¿è®¤â€”â€”é‚£ç§ç©ºæ°”å‡å›ºçš„æ„Ÿè§‰ï¼Œå°±æ˜¯ awkwardã€‚<br/>
æ³¨æ„ï¼šå®ƒå’Œ embarrassing ä¸åŒï¼Œåè€…æ˜¯ä½ è‡ªå·±å‡ºä¸‘ï¼›awkward æ˜¯å¤§å®¶ä¸€èµ·ç¤¾æ­»ã€‚â€</p>
</blockquote>
<p>å†é…ä¸Šä¸€å¼  AI ç”Ÿæˆçš„ <strong>ä½“ç´ é£æ ¼å°´å°¬ç”µæ¢¯åœºæ™¯å›¾</strong>ï¼ˆæ¯”å¦‚ä¸€ç¾¤æ–¹å—å°äººåƒµåœ¨ç”µæ¢¯é‡Œï¼Œå¤´é¡¶å†’å‡ºé—®å·æ°”æ³¡ï¼‰ï¼Œ<br/>
ç”¨æˆ·ç¬é—´â€œgetâ€äº†è¿™ä¸ªè¯çš„çµé­‚ã€‚</p>
<p>è¿™æ‰æ˜¯ <strong>AI + æ•™è‚²</strong> çš„æ­£ç¡®æ‰“å¼€æ–¹å¼ã€‚</p>
<hr/>
<h2 data-id="heading-3">ä¸‰ã€æŠ€æœ¯å®ç°ï¼šä» Prompt åˆ°å¯è¿è¡Œåº”ç”¨ï¼Œåªå·®ä¸€ä¸ª Agent</h2>
<p>è®¾æƒ³è¿™æ ·ä¸€ä¸ªå·¥ä½œæµï¼š</p>
<ol>
<li>
<p>ä½ å†™ä¸‹ç±»ä¼¼çš„éœ€æ±‚</p>
</li>
<li>
<p>Gemini / Claude / Qwen ç­‰å¤§æ¨¡å‹è§£ææ„å›¾</p>
</li>
<li>
<p>è‡ªåŠ¨ï¼š</p>
<ul>
<li>ç”Ÿæˆ Figma è®¾è®¡ç¨¿</li>
<li>è¾“å‡º React + Three.js å‰ç«¯ä»£ç </li>
<li>æ„å»º Node.js åç«¯ API</li>
<li>é…ç½®è¯­éŸ³åˆæˆä¸å›¾åƒç”ŸæˆæœåŠ¡</li>
</ul>
</li>
<li>
<p>ä¸€é”®éƒ¨ç½²åˆ° Vercel</p>
</li>
</ol>
<p>è¿™ä¸å†æ˜¯å¹»æƒ³ã€‚</p>
<blockquote>
<p>â€œgemini å¼ºå¤§çš„ç¼–ç¨‹èƒ½åŠ›â€¦â€¦ä¸­å°å‹äº§å“çš„ç›´æ¥ç”Ÿæˆâ€</p>
</blockquote>
<p><strong>Vibe Coding çš„å·¥è‰ºï¼Œå°±æ˜¯â€œåˆ†æ­¥åšã€æœ‰è§„åˆ’ã€æŒ‡ä»¤æ¸…æ™°â€</strong> ã€‚<br/>
å®ƒä¸è¦æ±‚ä½ ä¼šå†™ CSSï¼Œä½†è¦æ±‚ä½ <strong>ä¼šæè¿°â€œæ˜äº®ã€æœ‰è¶£ã€æœ‰æ´»åŠ›â€çš„è§†è§‰æ„Ÿå—</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-4">å››ã€åŠ¨æ‰‹å®è·µï¼šç”¨ Three.js æ„å»ºä½ çš„â€œè¯æ±‡ä½“ç´ æ£®æ—â€</h2>
<p>ä¸ºäº†å‘¼åº”â€œAI ç”Ÿæˆå›¾ç‰‡éœ€ç›´è§‚å‘ˆç°æ¦‚å¿µâ€ï¼Œæˆ‘ä¸ºä½ ç¼–å†™äº†ä¸€ä¸ª <strong>ä½“ç´ è‰ºæœ¯åœºæ™¯</strong> â€”â€” <strong>ã€ŠWord Forestã€‹</strong> ã€‚</p>
<blockquote>
<p><strong>åœºæ™¯è¯´æ˜</strong>ï¼šæ¯ä¸ªå•è¯åŒ–ä½œä¸€æ£µç”±å½©è‰²ä½“ç´ ï¼ˆvoxelï¼‰ç»„æˆçš„æ ‘ï¼Œæ ‘å† å½¢çŠ¶ç”±è¯ä¹‰æƒ…æ„Ÿå†³å®šï¼ˆç§¯æè¯å‘ä¸Šç”Ÿé•¿ï¼Œæ¶ˆæè¯å‘ä¸‹è”“å»¶ï¼‰ï¼Œç‚¹å‡»å¯æ’­æ”¾å‘éŸ³å¹¶æ˜¾ç¤ºé‡Šä¹‰ã€‚</p>
</blockquote>
<p><strong>åŸå›¾</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebfa654dc319448098c70fb3807535fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sf5qSw5Lid57uS5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765346861&amp;x-signature=26zSEsBSSnB8Q3lAl77puaBN1OA%3D" alt="4c3648d1ad3185ba853f18500ac43806.png" loading="lazy"/></p>
<p><strong>ç¤ºä¾‹å›¾</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbea1a4a7261446999c180148adde4e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sf5qSw5Lid57uS5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765346861&amp;x-signature=2CeLJG0%2BfGAhxgfY1MUuj%2Bs8YBw%3D" alt="285f0334930261f32182a7cfd1d0e420.png" loading="lazy"/>
ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„å•é¡µ HTML æ–‡ä»¶ï¼Œä½¿ç”¨ <strong>Three.js r160+</strong> å®ç°ï¼Œæ— éœ€æ„å»ºå·¥å…·ï¼Œç›´æ¥è¿è¡Œï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;!DOCTYPE html&gt;
&lt;html <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;
&lt;head&gt;
  &lt;meta <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;
  &lt;meta <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> content=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>/&gt;
  &lt;title&gt;Word Forest - Vibe Coding Demo&lt;/title&gt;
  &lt;style&gt;
    body { margin: 0<span class="hljs-comment">; overflow: hidden; background: #1a1a2e; }</span>
    <span class="hljs-comment">#info {</span>
      position: absolute<span class="hljs-comment">;</span>
      top: 20px<span class="hljs-comment">;</span>
      width: 100%<span class="hljs-comment">;</span>
      text-align: center<span class="hljs-comment">;</span>
      color: <span class="hljs-comment">#fff;</span>
      font-family: 'Segoe UI', sans-serif<span class="hljs-comment">;</span>
      text-shadow: 0 0 8px rgba(0,0,0,0.7)<span class="hljs-comment">;</span>
      pointer-events: none<span class="hljs-comment">;</span>
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div <span class="hljs-attr">id</span>=<span class="hljs-string">"info"</span>&gt;Click a voxel tree to hear its word!&lt;/div&gt;

  &lt;script <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.module.js'<span class="hljs-comment">;</span>
    import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.1/examples/jsm/controls/OrbitControls.js'<span class="hljs-comment">;</span>

    // Scene setup
    const <span class="hljs-attr">scene</span> = new THREE.Scene()<span class="hljs-comment">;</span>
    <span class="hljs-attr">scene.background</span> = new THREE.Color(<span class="hljs-number">0</span>x0f3460)<span class="hljs-comment">;</span>
    <span class="hljs-attr">scene.fog</span> = new THREE.Fog(<span class="hljs-number">0</span>x0f3460, <span class="hljs-number">10</span>, <span class="hljs-number">30</span>)<span class="hljs-comment">;</span>

    const <span class="hljs-attr">camera</span> = new THREE.PerspectiveCamera(<span class="hljs-number">75</span>, window.innerWidth / window.innerHeight, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>)<span class="hljs-comment">;</span>
    camera.position.set(0, 8, 15)<span class="hljs-comment">;</span>

    const <span class="hljs-attr">renderer</span> = new THREE.WebGLRenderer({ antialias: <span class="hljs-literal">true</span> })<span class="hljs-comment">;</span>
    renderer.setSize(window.innerWidth, window.innerHeight)<span class="hljs-comment">;</span>
    renderer.setPixelRatio(window.devicePixelRatio)<span class="hljs-comment">;</span>
    document.body.appendChild(renderer.domElement)<span class="hljs-comment">;</span>

    const <span class="hljs-attr">controls</span> = new OrbitControls(camera, renderer.domElement)<span class="hljs-comment">;</span>
    <span class="hljs-attr">controls.enableDamping</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>

    // Lighting
    const <span class="hljs-attr">ambientLight</span> = new THREE.AmbientLight(<span class="hljs-number">0</span>xffffff, <span class="hljs-number">0.6</span>)<span class="hljs-comment">;</span>
    scene.add(ambientLight)<span class="hljs-comment">;</span>

    const <span class="hljs-attr">dirLight</span> = new THREE.DirectionalLight(<span class="hljs-number">0</span>xffffff, <span class="hljs-number">0.8</span>)<span class="hljs-comment">;</span>
    dirLight.position.set(5, 10, 7)<span class="hljs-comment">;</span>
    scene.add(dirLight)<span class="hljs-comment">;</span>

    // Voxel geometry (1x1x1 cube)
    const <span class="hljs-attr">voxelGeo</span> = new THREE.BoxGeometry(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
    const <span class="hljs-attr">words</span> = [
      { word: <span class="hljs-string">"Serendipity"</span>, color: <span class="hljs-number">0</span>xff9aa2, yScale: <span class="hljs-number">1.8</span>, x: -<span class="hljs-number">6</span> },
      { word: <span class="hljs-string">"Ephemeral"</span>, color: <span class="hljs-number">0</span>xa29bfe, yScale: <span class="hljs-number">1.2</span>, x: -<span class="hljs-number">2</span> },
      { word: <span class="hljs-string">"Resilience"</span>, color: <span class="hljs-number">0</span>x78e08f, yScale: <span class="hljs-number">2.0</span>, x: <span class="hljs-number">2</span> },
      { word: <span class="hljs-string">"Melancholy"</span>, color: <span class="hljs-number">0</span>x55efc4, yScale: <span class="hljs-number">0.9</span>, x: <span class="hljs-number">6</span> }
    ]<span class="hljs-comment">;</span>

    const <span class="hljs-attr">trees</span> = []<span class="hljs-comment">;</span>
    const <span class="hljs-attr">materialCache</span> = {}<span class="hljs-comment">;</span>

    words.forEach(({ word, color, yScale, x }) =&gt; {
      const <span class="hljs-attr">group</span> = new THREE.Group()<span class="hljs-comment">;</span>
      group.position.set(x, 0, 0)<span class="hljs-comment">;</span>
      <span class="hljs-attr">group.userData</span> = { word }<span class="hljs-comment">;</span>

      // Trunk
      for (let <span class="hljs-attr">y</span> = <span class="hljs-number">0</span><span class="hljs-comment">; y &lt; 3; y++) {</span>
        const <span class="hljs-attr">mat</span> = new THREE.MeshStandardMaterial({ color: <span class="hljs-number">0</span>x5d4037 })<span class="hljs-comment">;</span>
        const <span class="hljs-attr">voxel</span> = new THREE.Mesh(voxelGeo, mat)<span class="hljs-comment">;</span>
        voxel.position.set(0, y, 0)<span class="hljs-comment">;</span>
        group.add(voxel)<span class="hljs-comment">;</span>
      }

      // Canopy - simple voxel cloud
      const <span class="hljs-attr">canopySize</span> = Math.floor(<span class="hljs-number">3</span> + yScale * <span class="hljs-number">2</span>)<span class="hljs-comment">;</span>
      for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 20; i++) {</span>
        const <span class="hljs-attr">px</span> = (Math.random() - <span class="hljs-number">0.5</span>) * canopySize<span class="hljs-comment">;</span>
        const <span class="hljs-attr">py</span> = <span class="hljs-number">3</span> + Math.random() * canopySize * yScale<span class="hljs-comment">;</span>
        const <span class="hljs-attr">pz</span> = (Math.random() - <span class="hljs-number">0.5</span>) * canopySize<span class="hljs-comment">;</span>

        if (!materialCache<span class="hljs-section">[color]</span>) {
          materialCache<span class="hljs-section">[color]</span> = new THREE.MeshStandardMaterial({ 
            color, 
            roughness: 0.7,
            metalness: 0.2
          })<span class="hljs-comment">;</span>
        }
        const <span class="hljs-attr">voxel</span> = new THREE.Mesh(voxelGeo, materialCache[color])<span class="hljs-comment">;</span>
        voxel.position.set(px, py, pz)<span class="hljs-comment">;</span>
        group.add(voxel)<span class="hljs-comment">;</span>
      }

      scene.add(group)<span class="hljs-comment">;</span>
      trees.push(group)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    // Raycaster for interaction
    const <span class="hljs-attr">raycaster</span> = new THREE.Raycaster()<span class="hljs-comment">;</span>
    const <span class="hljs-attr">mouse</span> = new THREE.Vector2()<span class="hljs-comment">;</span>

    window.addEventListener('click', (event) =&gt; {
      <span class="hljs-attr">mouse.x</span> = (event.clientX / window.innerWidth) * <span class="hljs-number">2</span> - <span class="hljs-number">1</span><span class="hljs-comment">;</span>
      <span class="hljs-attr">mouse.y</span> = -(event.clientY / window.innerHeight) * <span class="hljs-number">2</span> + <span class="hljs-number">1</span><span class="hljs-comment">;</span>

      raycaster.setFromCamera(mouse, camera)<span class="hljs-comment">;</span>
      const <span class="hljs-attr">intersects</span> = raycaster.intersectObjects(scene.children, <span class="hljs-literal">true</span>)<span class="hljs-comment">;</span>

      if (intersects.length &gt; 0) {
        const <span class="hljs-attr">obj</span> = intersects[<span class="hljs-number">0</span>].object<span class="hljs-comment">;</span>
        let <span class="hljs-attr">parent</span> = obj.parent<span class="hljs-comment">;</span>
        while (parent &amp;&amp; !parent.userData?.word) {
          <span class="hljs-attr">parent</span> = parent.parent<span class="hljs-comment">;</span>
        }
        if (parent &amp;&amp; parent.userData.word) {
          alert(`You clicked: "${parent.userData.word}"\n(Imagine a TTS voice saying it here!)`)<span class="hljs-comment">;</span>
        }
      }
    })<span class="hljs-comment">;</span>

    // Animation
    const <span class="hljs-attr">clock</span> = new THREE.Clock()<span class="hljs-comment">;</span>
    function animate() {
      requestAnimationFrame(animate)<span class="hljs-comment">;</span>
      const <span class="hljs-attr">t</span> = clock.getElapsedTime()<span class="hljs-comment">;</span>
      trees.forEach((tree, i) =&gt; {
        <span class="hljs-attr">tree.rotation.y</span> = Math.sin(t * <span class="hljs-number">0.3</span> + i) * <span class="hljs-number">0.1</span><span class="hljs-comment">;</span>
      })<span class="hljs-comment">;</span>
      controls.update()<span class="hljs-comment">;</span>
      renderer.render(scene, camera)<span class="hljs-comment">;</span>
    }
    animate()<span class="hljs-comment">;</span>

    // Resize handling
    window.addEventListener('resize', () =&gt; {
      <span class="hljs-attr">camera.aspect</span> = window.innerWidth / window.innerHeight<span class="hljs-comment">;</span>
      camera.updateProjectionMatrix()<span class="hljs-comment">;</span>
      renderer.setSize(window.innerWidth, window.innerHeight)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<blockquote>
<p>âœ… <strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ¯æ£µæ ‘ä»£è¡¨ä¸€ä¸ªæŠ½è±¡è¯æ±‡ï¼ˆå¦‚ Serendipityï¼‰</li>
<li>æ ‘å† é«˜åº¦åæ˜ è¯ä¹‰æƒ…æ„Ÿå¼ºåº¦</li>
<li>ç‚¹å‡»å¯è§¦å‘â€œå‘éŸ³â€ï¼ˆæ­¤å¤„ç”¨ alert æ¨¡æ‹Ÿï¼Œå®é™…å¯é›†æˆ Web Speech APIï¼‰</li>
<li>æ”¯æŒè½¨é“æ§åˆ¶ï¼Œæ²‰æµ¸å¼æ¢ç´¢</li>
<li>ä½“ç´ é£æ ¼ + åŠ¨æ€å…‰ç…§ï¼Œè¥é€ æ¢¦å¹»å­¦ä¹ ç©ºé—´</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-5">ç»“è¯­ï¼šä½ çš„ä¸‹ä¸€ä¸ªé¡¹ç›®ï¼Œæˆ–è®¸åªéœ€ä¸€æ®µ Prompt</h2>
<p>Vibe Coding ä¸æ˜¯å–ä»£ç¨‹åºå‘˜ï¼Œè€Œæ˜¯<strong>èµ‹äºˆæ¯ä¸ªäººâ€œäº§å“ç›´è§‰â€çš„æŠ€æœ¯æ æ†</strong>ã€‚<br/>
å½“ä½ èƒ½æ¸…æ™°è¡¨è¾¾â€œæˆ‘è¦ä¸€ä¸ªä¼šè®²æ•…äº‹çš„å•è¯æœ¬â€ï¼ŒAI å°±èƒ½è¿˜ä½ ä¸€ä¸ªä¸–ç•Œã€‚</p>
<blockquote>
<p>â€œä¸€ä¸ªäººæå®šä¸€ä¸ªé¡¹ç›®ã€‚â€</p>
</blockquote>
<p>ç°åœ¨ï¼Œè½®åˆ°ä½ äº†ã€‚<br/>
æ‰“å¼€ç¼–è¾‘å™¨ï¼Œå†™ä¸‹ä½ çš„ç¬¬ä¸€ä¸ª Promptâ€”â€”<br/>
<strong>è®© AI æˆä¸ºä½ æœ€é»˜å¥‘çš„ co-founder</strong>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git ç‰ˆæœ¬åº“ï¼ˆUbuntu ç¯å¢ƒï¼‰]]></title>    <link>https://juejin.cn/post/7579215538271617034</link>    <guid>https://juejin.cn/post/7579215538271617034</guid>    <pubDate>2025-12-03T05:50:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579215538271617034" data-draft-id="7579192114828427291" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git ç‰ˆæœ¬åº“ï¼ˆUbuntu ç¯å¢ƒï¼‰"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2025-12-03T05:50:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç³»å¤æ™®"/> <meta itemprop="url" content="https://juejin.cn/user/895462143964748"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git ç‰ˆæœ¬åº“ï¼ˆUbuntu ç¯å¢ƒï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/895462143964748/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç³»å¤æ™®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:50:16.000Z" title="Wed Dec 03 2025 05:50:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯ç‰ˆæœ¬åº“ï¼ˆRepositoryï¼‰ï¼Ÿ</h2>
<p><strong>ç‰ˆæœ¬åº“</strong>ï¼ˆä¹Ÿå«â€œä»“åº“â€ï¼‰æ˜¯ Git ç”¨æ¥ç®¡ç†é¡¹ç›®æ–‡ä»¶åŠå…¶æ‰€æœ‰ä¿®æ”¹å†å²çš„åœ°æ–¹ã€‚</p>
<p>ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªæ™ºèƒ½æ–‡ä»¶å¤¹ï¼š</p>
<ul>
<li>ä½ åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œå†™ä»£ç ã€æ”¹æ–‡æ¡£ã€åˆ æ–‡ä»¶â€¦â€¦</li>
<li>Git ä¼šé»˜é»˜è®°å½•æ¯ä¸€æ¬¡å˜åŒ–ã€‚</li>
<li>å¦‚æœå“ªå¤©ä½ å‘ç°â€œè¿˜æ˜¯ä¸Šå‘¨çš„ç‰ˆæœ¬æ›´å¥½â€ï¼Œå°±èƒ½è½»æ¾å›é€€åˆ°ä»»æ„å†å²çŠ¶æ€ï¼Œç”šè‡³æŸ¥çœ‹æŸæ¬¡å…·ä½“æ”¹äº†å“ªäº›å†…å®¹ã€‚</li>
</ul>
<blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå°±åƒä½ å†™ä½œæ–‡åå¤ä¿®æ”¹ï¼ŒGit èƒ½å¸®ä½ ä¿å­˜æ¯ä¸€ä¸ªè‰ç¨¿ï¼Œå¹¶éšæ—¶æ‰¾å›â€œæœ€æ»¡æ„çš„é‚£ä¸€ç‰ˆâ€ã€‚</p>
</blockquote>
<p>è¿™ä¸ªè¢« Git ç®¡ç†çš„æ–‡ä»¶å¤¹ï¼Œå°±æ˜¯ç‰ˆæœ¬åº“ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€å®‰è£… Gitï¼ˆUbuntuï¼‰</h2>
<p>æˆ‘ä»¬ä»¥ Ubuntu ç³»ç»Ÿä¸ºä¾‹è¿›è¡Œæ“ä½œã€‚</p>
<p>é¦–å…ˆï¼Œæ£€æŸ¥æ˜¯å¦å·²å®‰è£… Gitï¼š</p>
<pre><code class="hljs language-css" lang="css">git <span class="hljs-attr">--version</span>
</code></pre>
<p>å¦‚æœå·²å®‰è£…ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š</p>
<pre><code class="hljs">git version 2.52.0
</code></pre>
<p>å¦‚æœæœªå®‰è£…ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">sudo apt <span class="hljs-keyword">update</span>
sudo apt install git
</code></pre>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€é…ç½® Git ç”¨æˆ·ä¿¡æ¯</h2>
<p>Git éœ€è¦çŸ¥é“ä½ æ˜¯è°ï¼Œä»¥ä¾¿åœ¨æäº¤è®°å½•ä¸­æ ‡æ³¨ä½œè€…ã€‚åªéœ€é…ç½®ä¸€æ¬¡ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">git config --global user.name <span class="hljs-string">"Your Name"</span>
git config --global user.email <span class="hljs-string">"email@example.com"</span>
</code></pre>
<blockquote>
<p>è¿™é‡Œçš„é‚®ç®±ä¸ä¸€å®šè¦çœŸå®ï¼Œä½†å»ºè®®ä¸ GitHub/GitLab è´¦å·ä¸€è‡´ï¼Œæ–¹ä¾¿å…³è”ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">å››ã€åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬åº“</h2>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ä½œä¸ºé¡¹ç›®æ ¹ç›®å½•ï¼ˆä½ç½®éšæ„ï¼‰ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> learngit
<span class="hljs-built_in">cd</span> learngit/
<span class="hljs-built_in">pwd</span>
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/home/user/Desktop/learngit
</code></pre>
<ol>
<li>å°†è¯¥ç›®å½•åˆå§‹åŒ–ä¸º Git ä»“åº“ï¼š</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp">git <span class="hljs-keyword">init</span>
</code></pre>
<p>æˆåŠŸåä¼šæç¤ºï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Initialized empty Git repository <span class="hljs-keyword">in</span> /home/user/Desktop/learngit/.git/
</code></pre>
<ol>
<li>æŸ¥çœ‹éšè—æ–‡ä»¶ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> -la
</code></pre>
<p>ä½ ä¼šçœ‹åˆ°ä¸€ä¸ªåä¸º <code>.git</code> çš„éšè—ç›®å½•ï¼š</p>
<pre><code class="hljs">.  ..  .git
</code></pre>
<blockquote>
<p>é‡è¦ ï¼š<code>.git</code> æ˜¯ Git çš„æ ¸å¿ƒæ•°æ®åº“ï¼Œåƒä¸‡ä¸è¦æ‰‹åŠ¨ä¿®æ”¹æˆ–åˆ é™¤å®ƒï¼å¦åˆ™ç‰ˆæœ¬å†å²å°†ä¸¢å¤±ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">äº”ã€æ·»åŠ æ–‡ä»¶å¹¶æäº¤åˆ°ç‰ˆæœ¬åº“</h2>
<p>æˆ‘ä»¬åœ¨ <code>learngit</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª C++ æºæ–‡ä»¶ <code>hello.cpp</code>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
using namespace <span class="hljs-built_in">std</span>;
â€‹
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
 Â   <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello World!"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;
 Â   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<blockquote>
<p>ç¡®ä¿æ–‡ä»¶ä¿å­˜åœ¨ <code>learngit/</code> ç›®å½•å†…ï¼Œè¿™æ ·å®ƒæ‰å±äºå½“å‰å·¥ä½œåŒºã€‚</p>
</blockquote>
<h3 data-id="heading-5">1. æŸ¥çœ‹å½“å‰çŠ¶æ€</h3>
<pre><code class="hljs language-lua" lang="lua">git <span class="hljs-built_in">status</span>
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">On</span> branch master
â€‹
No commits yet
â€‹
Untracked files:
  (use <span class="hljs-string">"git add &lt;file&gt;..."</span> <span class="hljs-keyword">to</span> include <span class="hljs-keyword">in</span> what will be committed)
    hello.cpp
â€‹
<span class="hljs-literal">nothing</span> added <span class="hljs-keyword">to</span> commit but untracked files present (use <span class="hljs-string">"git add"</span> <span class="hljs-keyword">to</span> track)
</code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>å½“å‰åœ¨ <code>master</code> åˆ†æ”¯ï¼ˆGit é»˜è®¤ä¸»åˆ†æ”¯åï¼‰</li>
<li>ä»“åº“å°šæœªæœ‰ä»»ä½•æäº¤</li>
<li><code>hello.cpp</code> æ˜¯ä¸€ä¸ªæœªè¢«è·Ÿè¸ªçš„æ–°æ–‡ä»¶</li>
</ul>
<h3 data-id="heading-6">2. å°†æ–‡ä»¶åŠ å…¥æš‚å­˜åŒº</h3>
<p>ä½¿ç”¨ <code>git add</code> å‘Šè¯‰ Gitï¼šâ€œæˆ‘æƒ³æŠŠè¿™ä¸ªæ–‡ä»¶çº³å…¥ä¸‹ä¸€æ¬¡æäº¤â€ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">git <span class="hljs-keyword">add</span> hello.cpp
</code></pre>
<p>å†æ¬¡è¿è¡Œ <code>git status</code>ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">On</span> branch master
â€‹
No commits yet
â€‹
Changes <span class="hljs-keyword">to</span> be committed:
  (use <span class="hljs-string">"git rm --cached &lt;file&gt;..."</span> <span class="hljs-keyword">to</span> unstage)
    <span class="hljs-built_in">new</span> file: Â  hello.cpp
</code></pre>
<p>ç°åœ¨ <code>hello.cpp</code> å·²è¿›å…¥æš‚å­˜åŒºï¼Œå‡†å¤‡è¢«æ­£å¼æäº¤ã€‚</p>
<h3 data-id="heading-7">3. æäº¤åˆ°ç‰ˆæœ¬åº“</h3>
<p>æ‰§è¡Œæäº¤å‘½ä»¤ï¼Œå¹¶é™„ä¸Šç®€æ˜çš„è¯´æ˜ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">git <span class="hljs-keyword">commit</span> <span class="hljs-operator">-</span>m "wrote hello world source file"
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[master (root-commit) 7d2e3bf]</span> wrote hello world source file
 <span class="hljs-number">1</span> file changed, <span class="hljs-number">8</span> <span class="hljs-built_in">insertions</span>(+)
 create mode <span class="hljs-number">100644</span> hello<span class="hljs-selector-class">.cpp</span>
</code></pre>
<p>è‡³æ­¤ï¼Œä½ çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬å·²æˆåŠŸä¿å­˜ï¼</p>
<ul>
<li><code>master</code>ï¼šå½“å‰åˆ†æ”¯</li>
<li><code>7d2e3bf</code>ï¼šæœ¬æ¬¡æäº¤çš„å”¯ä¸€ IDï¼ˆå¯ç”¨æ¥å›æº¯ï¼‰</li>
<li><code>1 file changed</code>ï¼šæœ¬æ¬¡æäº¤åŒ…å« 1 ä¸ªæ–‡ä»¶ï¼Œæ–°å¢ 8 è¡Œä»£ç </li>
</ul>
<hr/>
<h2 data-id="heading-8">å…­ã€å°ç»“</h2>






























<table><thead><tr><th>æ­¥éª¤</th><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>åˆå§‹åŒ–ä»“åº“</td><td><code>git init</code></td><td>åˆ›å»ºæœ¬åœ°ç‰ˆæœ¬åº“</td></tr><tr><td>æŸ¥çœ‹çŠ¶æ€</td><td><code>git status</code></td><td>äº†è§£æ–‡ä»¶è·Ÿè¸ªæƒ…å†µ</td></tr><tr><td>æ·»åŠ æ–‡ä»¶</td><td><code>git add &lt;file&gt;</code></td><td>å°†æ–‡ä»¶æ”¾å…¥æš‚å­˜åŒº</td></tr><tr><td>æäº¤å˜æ›´</td><td><code>git commit -m "è¯´æ˜"</code></td><td>æ­£å¼ä¿å­˜ä¸€ä¸ªç‰ˆæœ¬</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é™¤äº†ä½¿ç”¨dict.fromkeys()å’ŒOrderedDict.fromkeys()ï¼Œè¿˜æœ‰å“ªäº›æ–¹æ³•å¯ä»¥å®ç°åˆ—è¡¨å»é‡ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7579256547798106153</link>    <guid>https://juejin.cn/post/7579256547798106153</guid>    <pubDate>2025-12-03T05:55:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579256547798106153" data-draft-id="7579229538791538694" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é™¤äº†ä½¿ç”¨dict.fromkeys()å’ŒOrderedDict.fromkeys()ï¼Œè¿˜æœ‰å“ªäº›æ–¹æ³•å¯ä»¥å®ç°åˆ—è¡¨å»é‡ï¼Ÿ"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-03T05:55:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·34584828505"/> <meta itemprop="url" content="https://juejin.cn/user/3710177917545754"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é™¤äº†ä½¿ç”¨dict.fromkeys()å’ŒOrderedDict.fromkeys()ï¼Œè¿˜æœ‰å“ªäº›æ–¹æ³•å¯ä»¥å®ç°åˆ—è¡¨å»é‡ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3710177917545754/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·34584828505
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:55:20.000Z" title="Wed Dec 03 2025 05:55:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>é™¤äº†Â <code>dict.fromkeys()</code>Â å’ŒÂ <code>OrderedDict.fromkeys()</code>ï¼ŒPython ä¸­è¿˜æœ‰å¤šç§åˆ—è¡¨å»é‡æ–¹æ³•ï¼Œæ ¸å¿ƒå·®å¼‚é›†ä¸­åœ¨Â <strong>æ˜¯å¦ä¿ç•™åŸé¡ºåºã€æ—¶é—´å¤æ‚åº¦ã€å†…å­˜å ç”¨</strong>Â ä¸‰ä¸ªç»´åº¦ã€‚ä»¥ä¸‹æ˜¯ 6 ç§å¸¸ç”¨æ–¹æ³•ï¼ŒæŒ‰ â€œæ—¥å¸¸å®ç”¨æ€§ + æ•ˆç‡â€ æ’åºï¼Œé™„å¸¦åŸç†ã€ä»£ç ç¤ºä¾‹å’Œåœºæ™¯é€‚é…ï¼š</p>
<h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒå‰æï¼šå»é‡çš„ä¸¤å¤§æ ¸å¿ƒéœ€æ±‚</h2>
<ul>
<li>éœ€æ±‚ 1ï¼š<strong>ä¿ç•™åŸé¡ºåº</strong>ï¼ˆæ—¥å¸¸å¼€å‘æœ€å¸¸ç”¨ï¼Œå¦‚å»é‡åä»ä¿æŒå…ƒç´ é¦–æ¬¡å‡ºç°çš„é¡ºåºï¼‰ï¼›</li>
<li>éœ€æ±‚ 2ï¼š<strong>æ— éœ€ä¿ç•™é¡ºåº</strong>ï¼ˆè¿½æ±‚æè‡´æ•ˆç‡æˆ–ä¸å…³å¿ƒé¡ºåºï¼Œå¦‚æ•°æ®ç»Ÿè®¡ã€å»é‡åæ’åºï¼‰ã€‚</li>
</ul>
<p>æ‰€æœ‰æ–¹æ³•å‡å›´ç»•è¿™ä¸¤ä¸ªéœ€æ±‚å±•å¼€ï¼Œåº•å±‚é€»è¾‘æœ¬è´¨æ˜¯ â€œé€šè¿‡å®¹å™¨è®°å½•å·²å‡ºç°çš„å…ƒç´ ï¼Œè¿‡æ»¤é‡å¤é¡¹â€ã€‚</p>
<h2 data-id="heading-1">äºŒã€6 ç§åˆ—è¡¨å»é‡æ–¹æ³•è¯¦è§£</h2>
<h3 data-id="heading-2">æ–¹æ³• 1ï¼šåˆ—è¡¨æ¨å¯¼å¼ + è¾…åŠ©é›†åˆï¼ˆæ¨èï¼Œä¿åº + é«˜æ•ˆï¼‰</h3>
<h4 data-id="heading-3">åŸç†</h4>
<ul>
<li>ç”¨Â <strong>åˆ—è¡¨æ¨å¯¼å¼</strong>Â éå†åŸåˆ—è¡¨ï¼Œä¿ç•™é¦–æ¬¡å‡ºç°çš„å…ƒç´ ï¼›</li>
<li>ç”¨Â <strong>è¾…åŠ©é›†åˆ</strong>ï¼ˆ<code>seen</code>ï¼‰è®°å½•å·²å‡ºç°çš„å…ƒç´ ï¼ˆé›†åˆæŸ¥æ‰¾æ•ˆç‡ O (1)ï¼Œæ¯”åˆ—è¡¨æŸ¥æ‰¾å¿«ï¼‰ï¼›</li>
<li>æ ¸å¿ƒé€»è¾‘ï¼šéå†å…ƒç´ æ—¶ï¼Œè‹¥å…ƒç´ ä¸åœ¨Â <code>seen</code>Â ä¸­ï¼Œåˆ™ä¿ç•™å¹¶åŠ å…¥Â <code>seen</code>ï¼›å¦åˆ™è·³è¿‡ã€‚</li>
</ul>
<h4 data-id="heading-4">ä»£ç ç¤ºä¾‹</h4>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">lst</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>]
<span class="hljs-attr">seen</span> = set()
<span class="hljs-attr">result</span> = [x for x in lst if x not in seen and not seen.add(x)]
print(result)  <span class="hljs-comment"># è¾“å‡ºï¼š[1, 2, 3, 4, 5]ï¼ˆä¿ç•™åŸé¡ºåºï¼‰</span>
</code></pre>
<h4 data-id="heading-5">å…³é”®ç»†èŠ‚</h4>
<ul>
<li><code>not seen.add(x)</code>ï¼š<code>set.add(x)</code>Â æ— è¿”å›å€¼ï¼ˆè¿”å›Â <code>None</code>ï¼‰ï¼Œ<code>not None</code>Â ä¸ºÂ <code>True</code>ï¼Œå› æ­¤å¯ç®€åŒ–ä¸º â€œåˆ¤æ–­ + æ·»åŠ â€ ä¸€æ­¥å®Œæˆï¼›</li>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO (n)ï¼ˆéå†åˆ—è¡¨ O (n) + é›†åˆæŸ¥æ‰¾ O (1)ï¼‰ï¼›</li>
<li>å†…å­˜å ç”¨ï¼šO (n)ï¼ˆè¾…åŠ©é›†åˆå­˜å‚¨æ‰€æœ‰ä¸é‡å¤å…ƒç´ ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-6">ä¼˜ç‚¹</h4>
<ul>
<li>ä¿ç•™åŸé¡ºåºï¼Œæ•ˆç‡é«˜ï¼ˆæ¯”Â <code>dict.fromkeys()</code>Â æ›´çµæ´»ï¼Œå¯è‡ªå®šä¹‰è¿‡æ»¤é€»è¾‘ï¼‰ï¼›</li>
<li>æ”¯æŒå¼‚æ„åˆ—è¡¨ï¼ˆå¦‚åŒ…å«å­—ç¬¦ä¸²ã€å…ƒç»„ç­‰ä¸å¯å˜å…ƒç´ ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-7">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>æ—¥å¸¸å¼€å‘ä¸­ â€œä¿åºå»é‡â€ çš„æ ¸å¿ƒåœºæ™¯ï¼ˆæ›¿ä»£Â <code>dict.fromkeys()</code>ï¼Œé€»è¾‘æ›´ç›´è§‚ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-8">æ–¹æ³• 2ï¼š<code>set</code>Â è½¬åˆ—è¡¨ï¼ˆæœ€å¿«ï¼Œæ— éœ€ä¿åºï¼‰</h3>
<h4 data-id="heading-9">åŸç†</h4>
<ul>
<li>åˆ©ç”¨Â <strong>é›†åˆï¼ˆsetï¼‰çš„å…ƒç´ å”¯ä¸€æ€§</strong>ï¼Œç›´æ¥å°†åˆ—è¡¨è½¬ä¸ºé›†åˆï¼ˆè‡ªåŠ¨å»é‡ï¼‰ï¼Œå†è½¬å›åˆ—è¡¨ï¼›</li>
<li>é›†åˆæ˜¯æ— åºç»“æ„ï¼Œå› æ­¤å»é‡åä¼šæ‰“ä¹±åŸé¡ºåºã€‚</li>
</ul>
<h4 data-id="heading-10">ä»£ç ç¤ºä¾‹</h4>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-scss" lang="scss">lst = <span class="hljs-selector-attr">[1, 2, 2, 3, 3, 3, 4, 5, 5]</span>
result = <span class="hljs-built_in">list</span>(set(lst))
<span class="hljs-built_in">print</span>(result)  # è¾“å‡ºï¼š<span class="hljs-selector-attr">[1, 2, 3, 4, 5]</span>ï¼ˆé¡ºåºä¸å›ºå®šï¼Œå¦‚ <span class="hljs-selector-attr">[2,1,3,4,5]</span>ï¼‰
</code></pre>
<h4 data-id="heading-11">å…³é”®ç»†èŠ‚</h4>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO (n)ï¼ˆé›†åˆæ’å…¥å’Œè½¬æ¢å‡ä¸ºçº¿æ€§æ—¶é—´ï¼Œåº•å±‚å“ˆå¸Œè¡¨ä¼˜åŒ–ï¼‰ï¼›</li>
<li>å†…å­˜å ç”¨ï¼šO (n)ï¼ˆé›†åˆå­˜å‚¨ä¸é‡å¤å…ƒç´ ï¼‰ï¼›</li>
<li>é™åˆ¶ï¼šä»…æ”¯æŒÂ <strong>ä¸å¯å˜å…ƒç´ </strong>ï¼ˆå¦‚ intã€strã€tupleï¼‰ï¼Œè‹¥åˆ—è¡¨åŒ…å«å¯å˜å…ƒç´ ï¼ˆå¦‚åˆ—è¡¨ã€å­—å…¸ï¼‰ï¼Œä¼šæŠ¥é”™ï¼ˆ<code>TypeError: unhashable type: 'list'</code>ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-12">ä¼˜ç‚¹</h4>
<ul>
<li>ä»£ç æç®€ï¼ˆä¸€è¡Œå®Œæˆï¼‰ï¼Œé€Ÿåº¦æœ€å¿«ï¼ˆCPython åº•å±‚ä¼˜åŒ–ï¼Œæ¯”çº¯ Python é€»è¾‘å¿«ä¸€ä¸ªé‡çº§ï¼‰ï¼›</li>
<li>è‡ªåŠ¨å»é‡ + å»é‡åå¯æŒ‰éœ€æ’åºï¼ˆå¦‚Â <code>sorted(list(set(lst)))</code>ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-13">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>æ— éœ€ä¿ç•™åŸé¡ºåºï¼Œä¸”å…ƒç´ ä¸ºä¸å¯å˜ç±»å‹ï¼ˆå¦‚æ•°æ®ç»Ÿè®¡ã€å»é‡åæ’åºï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-14">æ–¹æ³• 3ï¼š<code>pandas</code>Â åº“Â <code>drop_duplicates()</code>ï¼ˆå¤§æ•°æ®é‡ + ä¿åºï¼‰</h3>
<h4 data-id="heading-15">åŸç†</h4>
<ul>
<li>åˆ©ç”¨Â <code>pandas</code>Â çš„Â <code>Series</code>Â æ•°æ®ç»“æ„ï¼Œé€šè¿‡Â <code>drop_duplicates()</code>Â æ–¹æ³•å»é‡ï¼›</li>
<li>åº•å±‚ç”¨ C è¯­è¨€ä¼˜åŒ–ï¼Œå¤§æ•°æ®é‡ï¼ˆåä¸‡çº§ä»¥ä¸Šï¼‰æ•ˆç‡è¿œè¶…çº¯ Python æ–¹æ³•ã€‚</li>
</ul>
<h4 data-id="heading-16">ä»£ç ç¤ºä¾‹</h4>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-scss" lang="scss">import pandas as pd

lst = <span class="hljs-selector-attr">[1, 2, 2, 3, 3, 3, 4, 5, 5]</span> * <span class="hljs-number">1000</span>  # æ¨¡æ‹Ÿ <span class="hljs-number">9000</span> ä¸ªå…ƒç´ çš„å¤§æ•°æ®é‡
result = pd<span class="hljs-selector-class">.Series</span>(lst)<span class="hljs-selector-class">.drop_duplicates</span>()<span class="hljs-selector-class">.tolist</span>()
<span class="hljs-built_in">print</span>(result)  # è¾“å‡ºï¼š<span class="hljs-selector-attr">[1, 2, 3, 4, 5]</span>ï¼ˆä¿ç•™åŸé¡ºåºï¼‰
</code></pre>
<h4 data-id="heading-17">å…³é”®ç»†èŠ‚</h4>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO (n)ï¼ˆåº•å±‚å“ˆå¸Œè¡¨å®ç°ï¼Œçº¿æ€§æ—¶é—´ï¼‰ï¼›</li>
<li>å†…å­˜å ç”¨ï¼šO (n)ï¼ˆ<code>Series</code>Â å­˜å‚¨æ•°æ®ï¼‰ï¼›</li>
<li>ä¼˜åŠ¿ï¼šæ”¯æŒç¼ºå¤±å€¼ï¼ˆ<code>NaN</code>ï¼‰å»é‡ï¼Œä¸”å¤§æ•°æ®é‡ä¸‹æ¯”çº¯ Python æ–¹æ³•å¿« 10~100 å€ã€‚</li>
</ul>
<h4 data-id="heading-18">ä¼˜ç‚¹</h4>
<ul>
<li>å¤§æ•°æ®é‡å¤„ç†é«˜æ•ˆï¼Œä¿ç•™åŸé¡ºåºï¼›</li>
<li>æ”¯æŒå¤æ‚æ•°æ®ç±»å‹ï¼ˆå¦‚Â <code>datetime</code>ã€<code>object</code>Â ç±»å‹ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-19">ç¼ºç‚¹</h4>
<ul>
<li>éœ€å®‰è£…Â <code>pandas</code>Â åº“ï¼ˆé Python å†…ç½®ï¼‰ï¼›</li>
<li>å°æ•°æ®é‡ä¸‹æœ‰åº“è°ƒç”¨å¼€é”€ï¼Œæ•ˆç‡ä¸å¦‚æ–¹æ³• 1ã€2ã€‚</li>
</ul>
<h4 data-id="heading-20">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>æ•°æ®åˆ†æã€å¤§æ•°æ®å¤„ç†ï¼ˆå¦‚ CSV æ•°æ®ã€æ—¥å¿—æ•°æ®å»é‡ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-21">æ–¹æ³• 4ï¼šéå† + æ¡ä»¶åˆ¤æ–­ï¼ˆæ— é¢å¤–å®¹å™¨ï¼Œä¿åºï¼‰</h3>
<h4 data-id="heading-22">åŸç†</h4>
<ul>
<li>ä¸ä½¿ç”¨é›†åˆï¼Œä»…é€šè¿‡åˆ—è¡¨çš„Â <code>in</code>Â æ“ä½œåˆ¤æ–­å…ƒç´ æ˜¯å¦å·²å­˜åœ¨ï¼›</li>
<li>éå†åŸåˆ—è¡¨ï¼Œè‹¥å…ƒç´ ä¸åœ¨ç»“æœåˆ—è¡¨ä¸­ï¼Œåˆ™è¿½åŠ åˆ°ç»“æœåˆ—è¡¨ã€‚</li>
</ul>
<h4 data-id="heading-23">ä»£ç ç¤ºä¾‹</h4>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">lst</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>]
<span class="hljs-attr">result</span> = []
for x in lst:
    if x not in result:  <span class="hljs-comment"># åˆ—è¡¨æŸ¥æ‰¾æ•ˆç‡ O(k)ï¼Œk ä¸º result é•¿åº¦</span>
        result.append(x)
print(result)  <span class="hljs-comment"># è¾“å‡ºï¼š[1, 2, 3, 4, 5]ï¼ˆä¿ç•™åŸé¡ºåºï¼‰</span>
</code></pre>
<h4 data-id="heading-24">å…³é”®ç»†èŠ‚</h4>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO (nÂ²)ï¼ˆéå†åŸåˆ—è¡¨ O (n) + åˆ—è¡¨æŸ¥æ‰¾ O (k)ï¼Œk â‰¤ nï¼‰ï¼›</li>
<li>å†…å­˜å ç”¨ï¼šO (n)ï¼ˆä»…ç»“æœåˆ—è¡¨ï¼Œæ— é¢å¤–å®¹å™¨ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-25">ä¼˜ç‚¹</h4>
<ul>
<li>æ— éœ€é¢å¤–ä¾èµ–ï¼ˆçº¯ Python åŸç”Ÿé€»è¾‘ï¼‰ï¼Œæ— å“ˆå¸Œè¡¨é™åˆ¶ï¼ˆæ”¯æŒå¯å˜å…ƒç´ ï¼Ÿä¸ â€”â€” åˆ—è¡¨Â <code>in</code>Â æ“ä½œä¸ä¾èµ–å“ˆå¸Œï¼Œä½†è‹¥å…ƒç´ æ˜¯å¯å˜ç±»å‹å¦‚åˆ—è¡¨ï¼Œä»å¯åˆ¤æ–­ï¼Œä¾‹å¦‚Â <code>[1, [2]]</code>Â å»é‡ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-26">ç¼ºç‚¹</h4>
<ul>
<li>æ•ˆç‡æä½ï¼ˆåˆ—è¡¨æŸ¥æ‰¾æ˜¯çº¿æ€§æ—¶é—´ï¼Œåˆ—è¡¨è¶Šé•¿è¶Šæ…¢ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-27">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>åˆ—è¡¨é•¿åº¦æå°ï¼ˆå¦‚å‡ åä¸ªå…ƒç´ ï¼‰ï¼Œä¸”ä¸å¸Œæœ›å¼•å…¥é›†åˆï¼ˆå¦‚é¢è¯•é¢˜è¦æ±‚ â€œä¸ç”¨ set å»é‡â€ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-28">æ–¹æ³• 5ï¼š<code>collections.Counter</code>ï¼ˆç»Ÿè®¡é¢‘æ¬¡ + å»é‡ï¼Œä¿åºï¼‰</h3>
<h4 data-id="heading-29">åŸç†</h4>
<ul>
<li><code>Counter</code>Â æ˜¯å­—å…¸çš„å­ç±»ï¼Œç”¨äºç»Ÿè®¡å…ƒç´ å‡ºç°é¢‘æ¬¡ï¼›</li>
<li><code>Counter.keys()</code>Â ä¼šä¿ç•™å…ƒç´ çš„ â€œé¦–æ¬¡å‡ºç°é¡ºåºâ€ï¼ˆPython 3.7+ï¼‰ï¼Œå› æ­¤å¯é€šè¿‡Â <code>keys()</code>Â å¿«é€Ÿå»é‡ã€‚</li>
</ul>
<h4 data-id="heading-30">ä»£ç ç¤ºä¾‹</h4>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-scss" lang="scss">from collections import Counter

lst = <span class="hljs-selector-attr">[1, 2, 2, 3, 3, 3, 4, 5, 5]</span>
result = <span class="hljs-built_in">list</span>(Counter(lst)<span class="hljs-selector-class">.keys</span>())
<span class="hljs-built_in">print</span>(result)  # è¾“å‡ºï¼š<span class="hljs-selector-attr">[1, 2, 3, 4, 5]</span>ï¼ˆä¿ç•™åŸé¡ºåºï¼‰
</code></pre>
<h4 data-id="heading-31">å…³é”®ç»†èŠ‚</h4>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO (n)ï¼ˆç»Ÿè®¡é¢‘æ¬¡ O (n) + æå– keys O (m)ï¼Œm ä¸ºä¸é‡å¤å…ƒç´ ä¸ªæ•°ï¼‰ï¼›</li>
<li>å†…å­˜å ç”¨ï¼šO (n)ï¼ˆå­˜å‚¨å…ƒç´ é¢‘æ¬¡ï¼‰ï¼›</li>
<li>é¢å¤–åŠŸèƒ½ï¼šå¯åŒæ—¶è·å–å…ƒç´ å‡ºç°æ¬¡æ•°ï¼ˆå¦‚Â <code>Counter(lst)[2]</code>Â å¾—åˆ° 2 çš„å‡ºç°æ¬¡æ•° 2ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-32">ä¼˜ç‚¹</h4>
<ul>
<li>ä¿åºå»é‡çš„åŒæ—¶ï¼Œå¯è·å–é¢‘æ¬¡ç»Ÿè®¡ï¼›</li>
<li>è¯­æ³•ç®€æ´ï¼Œæ”¯æŒä¸å¯å˜å…ƒç´ ã€‚</li>
</ul>
<h4 data-id="heading-33">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>å»é‡ + é¢‘æ¬¡ç»Ÿè®¡çš„å¤åˆåœºæ™¯ï¼ˆå¦‚ â€œæ‰¾å‡ºåˆ—è¡¨ä¸­ä¸é‡å¤çš„å…ƒç´ ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªå…ƒç´ å‡ºç°æ¬¡æ•°â€ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-34">æ–¹æ³• 6ï¼š<code>itertools.groupby</code>ï¼ˆéœ€å…ˆæ’åºï¼Œæ— éœ€ä¿åºï¼‰</h3>
<h4 data-id="heading-35">åŸç†</h4>
<ul>
<li><code>groupby</code>Â ç”¨äºå°†è¿­ä»£å¯¹è±¡ä¸­è¿ç»­çš„é‡å¤å…ƒç´ åˆ†ç»„ï¼›</li>
<li>éœ€å…ˆå¯¹åˆ—è¡¨æ’åºï¼ˆä½¿é‡å¤å…ƒç´ è¿ç»­ï¼‰ï¼Œå†æå–æ¯ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå®ç°å»é‡ï¼›</li>
<li>å› æ’åºä¼šæ‰“ä¹±åŸé¡ºåºï¼Œå› æ­¤é€‚åˆæ— éœ€ä¿åºçš„åœºæ™¯ã€‚</li>
</ul>
<h4 data-id="heading-36">ä»£ç ç¤ºä¾‹</h4>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-ini" lang="ini">from itertools import groupby

<span class="hljs-attr">lst</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>]
<span class="hljs-comment"># æ­¥éª¤ 1ï¼šæ’åºï¼ˆä½¿é‡å¤å…ƒç´ è¿ç»­ï¼‰</span>
<span class="hljs-attr">lst_sorted</span> = sorted(lst)
<span class="hljs-comment"># æ­¥éª¤ 2ï¼šgroupby åˆ†ç»„ï¼Œæå–æ¯ç»„ç¬¬ä¸€ä¸ªå…ƒç´ </span>
<span class="hljs-attr">result</span> = [key for key, group in groupby(lst_sorted)]
print(result)  <span class="hljs-comment"># è¾“å‡ºï¼š[1, 2, 3, 4, 5]ï¼ˆæ’åºåçš„é¡ºåºï¼‰</span>
</code></pre>
<h4 data-id="heading-37">å…³é”®ç»†èŠ‚</h4>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO (n log n)ï¼ˆæ’åºå ä¸»å¯¼ï¼Œ<code>groupby</code>Â éå† O (n)ï¼‰ï¼›</li>
<li>å†…å­˜å ç”¨ï¼šO (n)ï¼ˆæ’åºå’Œåˆ†ç»„çš„ä¸´æ—¶ç©ºé—´ï¼‰ï¼›</li>
<li>é™åˆ¶ï¼šå¿…é¡»å…ˆæ’åºï¼Œå› æ­¤æ— æ³•ä¿ç•™åŸé¡ºåºã€‚</li>
</ul>
<h4 data-id="heading-38">ä¼˜ç‚¹</h4>
<ul>
<li>å¯åŒæ—¶å¤„ç† â€œæ’åº + å»é‡â€ï¼Œé€‚åˆéœ€è¦æ’åºåå»é‡çš„åœºæ™¯ï¼›</li>
<li>æ”¯æŒè‡ªå®šä¹‰æ’åºè§„åˆ™ï¼ˆå¦‚Â <code>sorted(lst, key=lambda x: -x)</code>Â å€’åºåå»é‡ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-39">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>éœ€å…ˆæ’åºå†å»é‡çš„åœºæ™¯ï¼ˆå¦‚ â€œå¯¹æˆç»©åˆ—è¡¨å»é‡ï¼Œå¹¶æŒ‰ä»é«˜åˆ°ä½æ’åºâ€ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-40">ä¸‰ã€å„æ–¹æ³•å¯¹æ¯”ä¸åœºæ™¯é€‰æ‹©</h2>





























































<table><thead><tr><th>æ–¹æ³•</th><th>æ˜¯å¦ä¿åº</th><th>æ—¶é—´å¤æ‚åº¦</th><th>å†…å­˜å ç”¨</th><th>æ ¸å¿ƒä¼˜åŠ¿</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>åˆ—è¡¨æ¨å¯¼å¼ + è¾…åŠ©é›†åˆ</td><td>æ˜¯</td><td>O(n)</td><td>O(n)</td><td>çµæ´»é«˜æ•ˆï¼Œä¿åºï¼Œæ”¯æŒå¼‚æ„å…ƒç´ </td><td>æ—¥å¸¸ä¿åºå»é‡ï¼ˆé¦–é€‰ï¼‰</td></tr><tr><td><code>set</code>Â è½¬åˆ—è¡¨</td><td>å¦</td><td>O(n)</td><td>O(n)</td><td>ä»£ç æç®€ï¼Œé€Ÿåº¦æœ€å¿«</td><td>æ— éœ€ä¿åºï¼Œå…ƒç´ ä¸ºä¸å¯å˜ç±»å‹</td></tr><tr><td><code>pandas.drop_duplicates()</code></td><td>æ˜¯</td><td>O(n)</td><td>O(n)</td><td>å¤§æ•°æ®é‡é«˜æ•ˆï¼Œæ”¯æŒå¤æ‚ç±»å‹</td><td>æ•°æ®åˆ†æã€åä¸‡çº§ä»¥ä¸Šå…ƒç´ å»é‡</td></tr><tr><td>éå† + æ¡ä»¶åˆ¤æ–­</td><td>æ˜¯</td><td>O(nÂ²)</td><td>O(n)</td><td>çº¯åŸç”Ÿé€»è¾‘ï¼Œæ— é¢å¤–ä¾èµ–</td><td>åˆ—è¡¨æçŸ­ï¼Œé¢è¯•é¢˜åœºæ™¯</td></tr><tr><td><code>Counter.keys()</code></td><td>æ˜¯</td><td>O(n)</td><td>O(n)</td><td>å»é‡ + é¢‘æ¬¡ç»Ÿè®¡</td><td>éœ€ç»Ÿè®¡å…ƒç´ å‡ºç°æ¬¡æ•°çš„åœºæ™¯</td></tr><tr><td><code>itertools.groupby</code></td><td>å¦ï¼ˆæ’åºåï¼‰</td><td>O(n log n)</td><td>O(n)</td><td>æ’åº + å»é‡ä¸€ä½“åŒ–</td><td>éœ€å…ˆæ’åºå†å»é‡çš„åœºæ™¯</td></tr></tbody></table>
<h2 data-id="heading-41">å››ã€é¿å‘é‡ç‚¹</h2>
<ol>
<li>
<p><strong>å¯å˜å…ƒç´ å»é‡</strong>ï¼šè‹¥åˆ—è¡¨åŒ…å«å¯å˜å…ƒç´ ï¼ˆå¦‚Â <code>[1, [2], [2], 3]</code>ï¼‰ï¼Œ<code>set</code>ã€<code>dict.fromkeys()</code>ã€<code>Counter</code>Â ä¼šæŠ¥é”™ï¼ˆå› å¯å˜å…ƒç´ ä¸å¯å“ˆå¸Œï¼‰ï¼Œæ­¤æ—¶åªèƒ½ç”¨ â€œéå† + æ¡ä»¶åˆ¤æ–­â€ï¼ˆæ–¹æ³• 4ï¼‰ï¼š</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-css" lang="css">lst = <span class="hljs-selector-attr">[1, [2]</span>, <span class="hljs-selector-attr">[2]</span>, <span class="hljs-number">3</span>]
result = <span class="hljs-selector-attr">[]</span>
for x in lst:
    if x not in result:
        result.<span class="hljs-built_in">append</span>(x)
<span class="hljs-built_in">print</span>(result)  # è¾“å‡ºï¼š[<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>], <span class="hljs-number">3</span>]ï¼ˆæ­£ç¡®å»é‡ï¼‰
</code></pre>
</li>
<li>
<p><strong>åŸåˆ—è¡¨ä¿®æ”¹</strong>ï¼šä»¥ä¸Šæ–¹æ³•å‡ç”Ÿæˆæ–°åˆ—è¡¨ï¼Œè‹¥éœ€ä¿®æ”¹åŸåˆ—è¡¨ï¼Œå¯ç›´æ¥èµ‹å€¼ï¼ˆå¦‚Â <code>lst = [x for x in lst if x not in seen and not seen.add(x)]</code>ï¼‰ï¼›</p>
</li>
<li>
<p><strong>ç©ºåˆ—è¡¨ / å•ä¸€å…ƒç´ </strong>ï¼šæ‰€æœ‰æ–¹æ³•å‡å…¼å®¹ç©ºåˆ—è¡¨ï¼ˆè¿”å›ç©ºï¼‰å’Œå•ä¸€å…ƒç´ ï¼ˆè¿”å›è‡ªèº«ï¼‰ï¼Œæ— å¼‚å¸¸ï¼›</p>
</li>
<li>
<p><strong>æ€§èƒ½è¯¯åŒº</strong>ï¼šâ€œéå† + æ¡ä»¶åˆ¤æ–­â€ï¼ˆæ–¹æ³• 4ï¼‰è™½æ— é¢å¤–å®¹å™¨ï¼Œä½†åˆ—è¡¨æŸ¥æ‰¾ O (n) å¯¼è‡´æ•ˆç‡æä½ï¼Œåˆ—è¡¨é•¿åº¦è¶…è¿‡ 1000 æ—¶ä¸æ¨èä½¿ç”¨ã€‚</p>
</li>
</ol>
<h2 data-id="heading-42">äº”ã€æ€»ç»“</h2>
<ol>
<li><strong>æ—¥å¸¸ä¿åºå»é‡</strong>ï¼šä¼˜å…ˆé€‰ã€Œåˆ—è¡¨æ¨å¯¼å¼ + è¾…åŠ©é›†åˆã€ï¼ˆçµæ´»é«˜æ•ˆï¼‰æˆ–ã€Œ<code>dict.fromkeys()</code>ã€ï¼ˆè¯­æ³•ç®€æ´ï¼‰ï¼›</li>
<li><strong>æ— éœ€ä¿åºå»é‡</strong>ï¼šä¼˜å…ˆé€‰ã€Œ<code>set</code>Â è½¬åˆ—è¡¨ã€ï¼ˆé€Ÿåº¦æœ€å¿«ï¼‰ï¼›</li>
<li><strong>å¤§æ•°æ®é‡å»é‡</strong>ï¼šä¼˜å…ˆé€‰ã€Œ<code>pandas.drop_duplicates()</code>ã€ï¼ˆåº•å±‚ C ä¼˜åŒ–ï¼‰ï¼›</li>
<li><strong>å¤åˆéœ€æ±‚</strong>ï¼šéœ€é¢‘æ¬¡ç»Ÿè®¡ç”¨ã€Œ<code>Counter</code>ã€ï¼Œéœ€æ’åºç”¨ã€Œ<code>groupby</code>ã€ã€‚</li>
</ol>
<p>æ ¹æ® â€œæ˜¯å¦ä¿åºã€æ•°æ®é‡ã€æ˜¯å¦éœ€è¦é¢å¤–åŠŸèƒ½â€ é€‰æ‹©åˆé€‚çš„æ–¹æ³•ï¼Œå³å¯å…¼é¡¾æ•ˆç‡å’Œå¯è¯»æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš€ æ·±å…¥ç†è§£ Claude Codeï¼šä»å…¥é—¨åˆ°ç²¾é€šçš„èƒ½åŠ›å…¨æ™¯å›¾]]></title>    <link>https://juejin.cn/post/7579167622106841088</link>    <guid>https://juejin.cn/post/7579167622106841088</guid>    <pubDate>2025-12-03T06:30:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579167622106841088" data-draft-id="7579169543232929792" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€ æ·±å…¥ç†è§£ Claude Codeï¼šä»å…¥é—¨åˆ°ç²¾é€šçš„èƒ½åŠ›å…¨æ™¯å›¾"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:30:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‹¥å°˜çš„æŠ€æœ¯ä¹‹æ—…"/> <meta itemprop="url" content="https://juejin.cn/user/2700056286215032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€ æ·±å…¥ç†è§£ Claude Codeï¼šä»å…¥é—¨åˆ°ç²¾é€šçš„èƒ½åŠ›å…¨æ™¯å›¾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2700056286215032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‹¥å°˜çš„æŠ€æœ¯ä¹‹æ—…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:30:12.000Z" title="Wed Dec 03 2025 06:30:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="arduino-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#434f54}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-name,.hljs-selector-tag{color:#00979d}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code,.hljs-literal{color:#d35400}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#00979d}.hljs-deletion,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#005c5f}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-comment{color:rgba(149,165,166,.8)}.hljs-meta-keyword{color:#728e00}.hljs-meta{color:#434f54}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-function{color:#728e00}.hljs-number{color:#8a7b52}</style><h2 data-id="heading-0">ğŸš€ æ·±å…¥ç†è§£ Claude Codeï¼šä»å…¥é—¨åˆ°ç²¾é€šçš„èƒ½åŠ›å…¨æ™¯å›¾</h2>
<blockquote>
<p>ğŸ”¥ <strong>æœ¬æ–‡ç›®æ ‡</strong>ï¼šå¸®åŠ©å¼€å‘è€…å…¨é¢äº†è§£ Claude Code çš„å„é¡¹èƒ½åŠ›ï¼Œä»åŸºç¡€åˆ°é«˜çº§ï¼Œä»åŸç†åˆ°å®æˆ˜</p>
<p>ğŸ“… åˆ›å»ºæ—¶é—´ï¼š2025-12-03
ğŸ¯ é€‚ç”¨èŒƒå›´ï¼šCodeBuddyã€Cursorã€Claude for Desktopã€VS Code æ’ä»¶ç­‰ AI ç¼–ç¨‹åŠ©æ‰‹
â±ï¸ é˜…è¯»æ—¶é•¿ï¼šçº¦ 30 åˆ†é’Ÿ</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">å†™åœ¨å‰é¢</h3>
<p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Claude Code æˆ–è€…å‡†å¤‡å¼€å§‹ä½¿ç”¨ï¼Œä½ å¯èƒ½ä¼šæœ‰è¿™äº›ç–‘é—®ï¼š</p>
<ul>
<li>ğŸ¤” Claude Code åˆ°åº•èƒ½åšä»€ä¹ˆï¼Ÿ</li>
<li>ğŸ¤” é‚£äº› Commandsã€Skillsã€Rulesã€Hooks éƒ½æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>ğŸ¤” MCP åè®®æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆç”¨ï¼Ÿ</li>
<li>ğŸ¤” è¿™äº›èƒ½åŠ›æ˜¯æ€ä¹ˆä¸€æ­¥æ­¥å‘å±•èµ·æ¥çš„ï¼Ÿ</li>
</ul>
<p>åˆ«æ€¥ï¼Œè¿™ç¯‡æ–‡ç« ä¼šå¸¦ä½ <strong>ä»å¤´åˆ°å°¾</strong>ã€<strong>ç”±æµ…å…¥æ·±</strong>åœ°äº†è§£ Claude Code çš„å…¨éƒ¨èƒ½åŠ›ã€‚æ— è®ºä½ æ˜¯åˆšå…¥é—¨çš„æ–°æ‰‹ï¼Œè¿˜æ˜¯æƒ³æ·±å…¥æ¢ç´¢çš„è€æ‰‹ï¼Œç›¸ä¿¡éƒ½èƒ½æœ‰æ‰€æ”¶è·ã€‚</p>
<p><strong>å…ˆæ”¾ä¸€å¼ èƒ½åŠ›å…¨æ™¯å›¾</strong>ï¼Œè®©ä½ æœ‰ä¸ªæ•´ä½“å°è±¡ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Claude <span class="hljs-selector-tag">Code</span> èƒ½åŠ›å…¨æ™¯å›¾                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ğŸ§  Claude åŸç”Ÿèƒ½åŠ›å±‚                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Vision (è§†è§‰)  â”‚  Tool Use (å·¥å…·)  â”‚  Reasoning (æ¨ç†)         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                      â”‚
â”‚                                  â–¼                                      â”‚
â”‚   ğŸ”§ æ‰©å±•èƒ½åŠ›å±‚                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Commands  â”‚  Skills  â”‚  Rules  â”‚  Hooks  â”‚  Memories  â”‚  MCP   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                      â”‚
â”‚                                  â–¼                                      â”‚
â”‚   ğŸ¤– é«˜çº§èƒ½åŠ›å±‚                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Multi-Agent (å¤šæ™ºèƒ½ä½“)  â”‚  Workflow (å·¥ä½œæµ)  â”‚  Automation     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-2">ğŸ“š ç›®å½•</h3>
<ul>
<li><a href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E8%83%BD%E5%8A%9B%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B" title="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E8%83%BD%E5%8A%9B%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B">ç¬¬ä¸€éƒ¨åˆ†ï¼šèƒ½åŠ›å‘å±•å†ç¨‹</a></li>
<li><a href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E4%B8%8E%E9%85%8D%E7%BD%AE" title="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E4%B8%8E%E9%85%8D%E7%BD%AE">ç¬¬äºŒéƒ¨åˆ†ï¼šåŸºç¡€æ¦‚å¿µä¸é…ç½®</a></li>
<li><a href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86commands-%E5%91%BD%E4%BB%A4%E7%B3%BB%E7%BB%9F" title="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86commands-%E5%91%BD%E4%BB%A4%E7%B3%BB%E7%BB%9F">ç¬¬ä¸‰éƒ¨åˆ†ï¼šCommands å‘½ä»¤ç³»ç»Ÿ</a></li>
<li><a href="#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86skills-%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F" title="#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86skills-%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F">ç¬¬å››éƒ¨åˆ†ï¼šSkills æŠ€èƒ½ç³»ç»Ÿ</a></li>
<li><a href="#%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86rules-%E8%A7%84%E5%88%99%E7%B3%BB%E7%BB%9F" title="#%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86rules-%E8%A7%84%E5%88%99%E7%B3%BB%E7%BB%9F">ç¬¬äº”éƒ¨åˆ†ï¼šRules è§„åˆ™ç³»ç»Ÿ</a></li>
<li><a href="#%E7%AC%AC%E5%85%AD%E9%83%A8%E5%88%86hooks-%E9%92%A9%E5%AD%90%E7%B3%BB%E7%BB%9F" title="#%E7%AC%AC%E5%85%AD%E9%83%A8%E5%88%86hooks-%E9%92%A9%E5%AD%90%E7%B3%BB%E7%BB%9F">ç¬¬å…­éƒ¨åˆ†ï¼šHooks é’©å­ç³»ç»Ÿ</a></li>
<li><a href="#%E7%AC%AC%E4%B8%83%E9%83%A8%E5%88%86memories-%E8%AE%B0%E5%BF%86%E7%B3%BB%E7%BB%9F" title="#%E7%AC%AC%E4%B8%83%E9%83%A8%E5%88%86memories-%E8%AE%B0%E5%BF%86%E7%B3%BB%E7%BB%9F">ç¬¬ä¸ƒéƒ¨åˆ†ï¼šMemories è®°å¿†ç³»ç»Ÿ</a></li>
<li><a href="#%E7%AC%AC%E5%85%AB%E9%83%A8%E5%88%86context-providers-%E4%B8%8A%E4%B8%8B%E6%96%87%E6%8F%90%E4%BE%9B%E5%99%A8" title="#%E7%AC%AC%E5%85%AB%E9%83%A8%E5%88%86context-providers-%E4%B8%8A%E4%B8%8B%E6%96%87%E6%8F%90%E4%BE%9B%E5%99%A8">ç¬¬å…«éƒ¨åˆ†ï¼šContext Providers ä¸Šä¸‹æ–‡æä¾›å™¨</a></li>
<li><a href="#%E7%AC%AC%E4%B9%9D%E9%83%A8%E5%88%86mcp-%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE" title="#%E7%AC%AC%E4%B9%9D%E9%83%A8%E5%88%86mcp-%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE">ç¬¬ä¹éƒ¨åˆ†ï¼šMCP æ¨¡å‹ä¸Šä¸‹æ–‡åè®®</a></li>
<li><a href="#%E7%AC%AC%E5%8D%81%E9%83%A8%E5%88%86multi-agent-%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93" title="#%E7%AC%AC%E5%8D%81%E9%83%A8%E5%88%86multi-agent-%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93">ç¬¬åéƒ¨åˆ†ï¼šMulti-Agent å¤šæ™ºèƒ½ä½“</a></li>
<li><a href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E9%83%A8%E5%88%86claude-%E5%8E%9F%E7%94%9F%E8%83%BD%E5%8A%9B" title="#%E7%AC%AC%E5%8D%81%E4%B8%80%E9%83%A8%E5%88%86claude-%E5%8E%9F%E7%94%9F%E8%83%BD%E5%8A%9B">ç¬¬åä¸€éƒ¨åˆ†ï¼šClaude åŸç”Ÿèƒ½åŠ›</a></li>
<li><a href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E9%83%A8%E5%88%86%E5%AE%8C%E6%95%B4%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%A1%88%E4%BE%8B" title="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E9%83%A8%E5%88%86%E5%AE%8C%E6%95%B4%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%A1%88%E4%BE%8B">ç¬¬åäºŒéƒ¨åˆ†ï¼šå®Œæ•´å·¥ä½œæµæ¡ˆä¾‹</a></li>
<li><a href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E9%83%A8%E5%88%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97" title="#%E7%AC%AC%E5%8D%81%E4%B8%89%E9%83%A8%E5%88%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97">ç¬¬åä¸‰éƒ¨åˆ†ï¼šæœ€ä½³å®è·µä¸è¸©å‘æŒ‡å—</a></li>
<li><a href="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E9%83%A8%E5%88%86%E8%83%BD%E5%8A%9B%E7%9F%A9%E9%98%B5%E4%B8%8E%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84" title="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E9%83%A8%E5%88%86%E8%83%BD%E5%8A%9B%E7%9F%A9%E9%98%B5%E4%B8%8E%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84">ç¬¬åå››éƒ¨åˆ†ï¼šèƒ½åŠ›çŸ©é˜µä¸å­¦ä¹ è·¯å¾„</a></li>
</ul>
<hr/>
<h3 data-id="heading-3">ç¬¬ä¸€éƒ¨åˆ†ï¼šèƒ½åŠ›å‘å±•å†ç¨‹</h3>
<blockquote>
<p>ğŸ’¡ <strong>ä¸ºä»€ä¹ˆè¦å…ˆè®²å†å²ï¼Ÿ</strong> äº†è§£èƒ½åŠ›çš„å‘å±•è„‰ç»œï¼Œèƒ½å¸®ä½ æ›´å¥½åœ°ç†è§£æ¯ä¸ªèƒ½åŠ›çš„è®¾è®¡åˆè¡·å’Œä½¿ç”¨åœºæ™¯ã€‚</p>
</blockquote>
<h4 data-id="heading-4">1.1 æ—¶é—´çº¿æ€»è§ˆ</h4>
<p>Claude Code çš„èƒ½åŠ›ä¸æ˜¯ä¸€è¹´è€Œå°±çš„ï¼Œè€Œæ˜¯ç»è¿‡äº†å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£ã€‚ä¸‹é¢è¿™å¼ æ—¶é—´çº¿å›¾å±•ç¤ºäº†ä» 2024 å¹´ 3 æœˆåˆ° 2025 å¹´çš„å®Œæ•´æ¼”è¿›è¿‡ç¨‹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>
                        <span class="hljs-string">Claude</span> <span class="hljs-string">Code</span> <span class="hljs-string">èƒ½åŠ›å‘å±•æ—¶é—´çº¿</span>
<span class="hljs-string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>

<span class="hljs-number">2024.03</span><span class="hljs-number">.04</span>  <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ‰</span> <span class="hljs-string">Claude</span> <span class="hljs-number">3</span> <span class="hljs-string">ç³»åˆ—å‘å¸ƒ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Opus</span> <span class="hljs-string">/</span> <span class="hljs-string">Sonnet</span> <span class="hljs-string">/</span> <span class="hljs-string">Haiku</span> <span class="hljs-string">ä¸‰ä¸ªç‰ˆæœ¬</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">é¦–æ¬¡æ”¯æŒ</span> <span class="hljs-string">Visionï¼ˆå›¾åƒç†è§£ï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">200K</span> <span class="hljs-string">ä¸Šä¸‹æ–‡çª—å£</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2024.05</span>     <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ”§</span> <span class="hljs-string">Tool</span> <span class="hljs-string">Use</span> <span class="hljs-string">(Beta)</span> <span class="hljs-string">å‘å¸ƒ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å‡½æ•°è°ƒç”¨èƒ½åŠ›</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å¤–éƒ¨å·¥å…·é›†æˆåŸºç¡€</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">ä¸ºåç»­</span> <span class="hljs-string">MCP</span> <span class="hljs-string">å¥ å®šåŸºç¡€</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2024.06</span><span class="hljs-number">.20</span>  <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">âš¡</span> <span class="hljs-string">Claude</span> <span class="hljs-number">3.5</span> <span class="hljs-string">Sonnet</span> <span class="hljs-string">å‘å¸ƒ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Artifacts</span> <span class="hljs-string">åŠŸèƒ½ï¼ˆä»£ç é¢„è§ˆï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ä»£ç ç”Ÿæˆèƒ½åŠ›å¤§å¹…æå‡</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">æ€§èƒ½è¶…è¶Š</span> <span class="hljs-string">Claude</span> <span class="hljs-number">3</span> <span class="hljs-string">Opus</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2024.10</span><span class="hljs-number">.22</span>  <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ–¥ï¸</span> <span class="hljs-string">Computer</span> <span class="hljs-string">Use</span> <span class="hljs-string">å‘å¸ƒ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Claude</span> <span class="hljs-number">3.5</span> <span class="hljs-string">Sonnet</span> <span class="hljs-string">å‡çº§ç‰ˆ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">AI</span> <span class="hljs-string">å¯ä»¥æ“ä½œè®¡ç®—æœºç•Œé¢</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">æ¨¡æ‹Ÿé¼ æ ‡ã€é”®ç›˜æ“ä½œ</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2024.11</span><span class="hljs-number">.25</span>  <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ”Œ</span> <span class="hljs-string">MCP</span> <span class="hljs-string">(Model</span> <span class="hljs-string">Context</span> <span class="hljs-string">Protocol)</span> <span class="hljs-string">å¼€æº</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ ‡å‡†åŒ–</span> <span class="hljs-string">AI</span> <span class="hljs-string">ä¸å¤–éƒ¨æœåŠ¡çš„è¿æ¥</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Claude</span> <span class="hljs-string">for</span> <span class="hljs-string">Desktop</span> <span class="hljs-string">é¦–å…ˆæ”¯æŒ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">å¼€å¯</span> <span class="hljs-string">AI</span> <span class="hljs-string">å·¥å…·ç”Ÿæ€æ—¶ä»£</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2025.02</span><span class="hljs-number">.25</span>  <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸš€</span> <span class="hljs-string">Claude</span> <span class="hljs-number">3.7</span> <span class="hljs-string">Sonnet</span> <span class="hljs-string">+</span> <span class="hljs-string">Claude</span> <span class="hljs-string">Code</span> <span class="hljs-string">å‘å¸ƒ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">é¦–ä¸ªæ··åˆæ¨ç†æ¨¡å‹ï¼ˆExtended</span> <span class="hljs-string">Thinkingï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Claude</span> <span class="hljs-string">Code</span> <span class="hljs-string">ç»ˆç«¯</span> <span class="hljs-string">AI</span> <span class="hljs-string">ä»£ç†</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ä»£ç åº“ç†è§£ã€Git</span> <span class="hljs-string">é›†æˆã€å‘½ä»¤æ‰§è¡Œ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">å¼€å‘è€…æ•ˆç‡é©å‘½æ€§æå‡</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2025.03</span>     <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ§©</span> <span class="hljs-string">æ‰©å±•ç”Ÿæ€æˆç†Ÿ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Commandsï¼ˆå‘½ä»¤ç³»ç»Ÿï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Skillsï¼ˆæŠ€èƒ½ç³»ç»Ÿï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Rulesï¼ˆè§„åˆ™ç³»ç»Ÿï¼šAlways/Requested/Manualï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Hooksï¼ˆé’©å­ç³»ç»Ÿï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Memoriesï¼ˆè®°å¿†ç³»ç»Ÿï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Context</span> <span class="hljs-string">Providersï¼ˆä¸Šä¸‹æ–‡æä¾›å™¨ï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">å„</span> <span class="hljs-string">IDE</span> <span class="hljs-string">æ’ä»¶å…¨é¢æ”¯æŒ</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2025.05</span>     <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ¤–</span> <span class="hljs-string">Code</span> <span class="hljs-string">w/</span> <span class="hljs-string">Claude</span> <span class="hljs-string">å¤§ä¼š</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Multi-Agent</span> <span class="hljs-string">åä½œæ¨¡å¼</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">é«˜çº§å·¥ä½œæµæœ€ä½³å®è·µ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">ä¼ä¸šçº§åº”ç”¨æ¡ˆä¾‹åˆ†äº«</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2025.</span><span class="hljs-string">Q3+</span>    <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ”®</span> <span class="hljs-string">æŒç»­æ¼”è¿›ä¸­...</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ›´å¤š</span> <span class="hljs-string">MCP</span> <span class="hljs-string">æœåŠ¡æ¥å…¥</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Agent</span> <span class="hljs-string">ç¼–æ’èƒ½åŠ›å¢å¼º</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">æ›´æ™ºèƒ½çš„è‡ªåŠ¨åŒ–å·¥ä½œæµ</span>

<span class="hljs-string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>
</code></pre>
<h4 data-id="heading-5">1.2 å„é˜¶æ®µè¯¦è§£</h4>
<p>è®©æˆ‘ä»¬æŠŠè¿™ä¸ªå‘å±•å†ç¨‹åˆ†æˆ <strong>å…­ä¸ªé˜¶æ®µ</strong>ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰å…¶æ ¸å¿ƒçªç ´ï¼š</p>
<h5 data-id="heading-6">ğŸŒ± ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å¯¹è¯ï¼ˆ2024.03ï¼‰</h5>
<p>è¿™æ˜¯ Claude 3 ç³»åˆ—çš„èµ·ç‚¹ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒClaude å…·å¤‡äº†ï¼š</p>

























<table><thead><tr><th>èƒ½åŠ›</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ–‡æœ¬ç†è§£ä¸ç”Ÿæˆ</strong></td><td>å¼ºå¤§çš„è‡ªç„¶è¯­è¨€å¤„ç†èƒ½åŠ›</td></tr><tr><td><strong>Vision å›¾åƒç†è§£</strong></td><td>å¯ä»¥"çœ‹æ‡‚"å›¾ç‰‡ï¼Œåˆ†æè®¾è®¡ç¨¿</td></tr><tr><td><strong>å¤šè¯­è¨€æ”¯æŒ</strong></td><td>ä¸­è‹±æ–‡ç­‰å¤šè¯­è¨€æµç•…å¯¹è¯</td></tr><tr><td><strong>200K ä¸Šä¸‹æ–‡</strong></td><td>å¯ä»¥å¤„ç†è¶…é•¿æ–‡æ¡£</td></tr></tbody></table>
<p><strong>è¿™ä¸ªé˜¶æ®µçš„ Claude æ›´åƒæ˜¯ä¸€ä¸ª"èŠå¤©åŠ©æ‰‹"</strong>ï¼Œè™½ç„¶èƒ½åŠ›å¾ˆå¼ºï¼Œä½†è¿˜ä¸èƒ½ç›´æ¥æ“ä½œå¤–éƒ¨ä¸–ç•Œã€‚</p>
<h5 data-id="heading-7">ğŸ”§ ç¬¬äºŒé˜¶æ®µï¼šå·¥å…·é›†æˆï¼ˆ2024.05-10ï¼‰</h5>
<p>è¿™æ˜¯ Claude ä»"èŠå¤©"èµ°å‘"è¡ŒåŠ¨"çš„å…³é”®é˜¶æ®µï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">                    Tool Use æ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Claude                     â”‚
â”‚                     â”‚                        â”‚
â”‚                     â–¼                        â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚         Tool Use API           â”‚       â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”   â”‚       â”‚
â”‚    â”‚  â”‚ å‡½æ•°1 â”‚ â”‚ å‡½æ•°2 â”‚ â”‚ å‡½æ•°3 â”‚   â”‚       â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                     â”‚                        â”‚
â”‚                     â–¼                        â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚        å¤–éƒ¨æœåŠ¡/API            â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre>
<p><strong>å…³é”®çªç ´</strong>ï¼š</p>
<ul>
<li><strong>Tool Use (2024.05)</strong>ï¼šClaude å¯ä»¥è°ƒç”¨é¢„å®šä¹‰çš„å‡½æ•°</li>
<li><strong>Computer Use (2024.10)</strong>ï¼šClaude å¯ä»¥åƒäººä¸€æ ·æ“ä½œç”µè„‘ç•Œé¢</li>
</ul>
<h5 data-id="heading-8">ğŸ”Œ ç¬¬ä¸‰é˜¶æ®µï¼šåè®®æ ‡å‡†åŒ–ï¼ˆ2024.11ï¼‰</h5>
<p><strong>MCP (Model Context Protocol)</strong> çš„å‘å¸ƒæ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘äº‹ä»¶ã€‚MCP å®šä¹‰äº†ä¸€å¥—æ ‡å‡†åè®®ï¼Œè®© AI å¯ä»¥ç»Ÿä¸€åœ°è¿æ¥å„ç§å¤–éƒ¨æœåŠ¡ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">                    MCP åè®®æ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      MCP åè®®      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Claude â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  MCP <span class="hljs-built_in">Server</span> â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                        â”‚          â”‚
â”‚                                        â–¼          â”‚
â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                               â”‚  å¤–éƒ¨æœåŠ¡    â”‚     â”‚
â”‚                               â”‚  â”œâ”€ TAPD    â”‚     â”‚
â”‚                               â”‚  â”œâ”€ Git     â”‚     â”‚
â”‚                               â”‚  â”œâ”€ æ•°æ®åº“   â”‚     â”‚
â”‚                               â”‚  â””â”€ ...     â”‚     â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h5 data-id="heading-9">ğŸš€ ç¬¬å››é˜¶æ®µï¼šä»£ç†åŒ–ç¼–ç¨‹ï¼ˆ2025.02ï¼‰</h5>
<p><strong>Claude Code çš„å‘å¸ƒ</strong>ï¼Œæ ‡å¿—ç€ AI ç¼–ç¨‹åŠ©æ‰‹è¿›å…¥äº†"ä»£ç†"æ—¶ä»£ã€‚</p>





















<table><thead><tr><th>ä¼ ç»Ÿ AI åŠ©æ‰‹</th><th>Claude Codeï¼ˆä»£ç†ï¼‰</th></tr></thead><tbody><tr><td>"ä½ åº”è¯¥è¿™æ ·å†™ä»£ç ..."</td><td>ç›´æ¥å¸®ä½ å†™å¥½ä»£ç å¹¶ä¿å­˜</td></tr><tr><td>"ä½ å¯ä»¥è¿è¡Œè¿™ä¸ªå‘½ä»¤..."</td><td>ç›´æ¥å¸®ä½ æ‰§è¡Œå‘½ä»¤</td></tr><tr><td>"å»ºè®®ä½ åˆ›å»ºè¿™ä¸ªæ–‡ä»¶..."</td><td>ç›´æ¥å¸®ä½ åˆ›å»ºæ–‡ä»¶</td></tr></tbody></table>
<h5 data-id="heading-10">ğŸ§© ç¬¬äº”é˜¶æ®µï¼šæ‰©å±•ç”Ÿæ€ï¼ˆ2025.03ï¼‰</h5>
<p>æœ‰äº† Claude Code è¿™ä¸ª"ä»£ç†"ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è®©å®ƒ<strong>æ›´æ‡‚ä½ çš„é¡¹ç›®</strong>ã€<strong>æ›´ç¬¦åˆä½ çš„ä¹ æƒ¯</strong>ã€‚è¿™å°±æ˜¯ Commandsã€Skillsã€Rulesã€Hooksã€Memoriesã€Context Providers è¦è§£å†³çš„é—®é¢˜ã€‚</p>
<h5 data-id="heading-11">ğŸ¤– ç¬¬å…­é˜¶æ®µï¼šæ™ºèƒ½ä½“åä½œï¼ˆ2025.05+ï¼‰</h5>
<p>å•ä¸ª AI ä»£ç†å·²ç»å¾ˆå¼ºäº†ï¼Œä½†æœ‰äº›å¤æ‚ä»»åŠ¡éœ€è¦<strong>å¤šä¸ªä¸“ä¸šåŒ–çš„ AI åä½œ</strong>å®Œæˆã€‚è¿™å°±æ˜¯ Multi-Agent çš„æ€è·¯ã€‚</p>
<h4 data-id="heading-12">1.3 å„èƒ½åŠ›å‘å¸ƒè¯¦æƒ…é€ŸæŸ¥è¡¨</h4>

























































































<table><thead><tr><th>èƒ½åŠ›</th><th>é¦–æ¬¡å‘å¸ƒ</th><th>å…³é”®ç‰ˆæœ¬</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Vision</strong></td><td>2024.03</td><td>Claude 3</td><td>å›¾åƒç†è§£ã€è®¾è®¡ç¨¿åˆ†æ</td></tr><tr><td><strong>Tool Use</strong></td><td>2024.05</td><td>Claude 3 Beta</td><td>å‡½æ•°è°ƒç”¨ã€å¤–éƒ¨å·¥å…·é›†æˆ</td></tr><tr><td><strong>Artifacts</strong></td><td>2024.06</td><td>Claude 3.5 Sonnet</td><td>ä»£ç é¢„è§ˆã€å¯è§†åŒ–è¾“å‡º</td></tr><tr><td><strong>Computer Use</strong></td><td>2024.10</td><td>Claude 3.5 å‡çº§ç‰ˆ</td><td>æ¨¡æ‹Ÿäººç±»æ“ä½œè®¡ç®—æœº</td></tr><tr><td><strong>MCP Protocol</strong></td><td>2024.11.25</td><td>å¼€æºåè®®</td><td>æ ‡å‡†åŒ–å¤–éƒ¨æœåŠ¡è¿æ¥</td></tr><tr><td><strong>Claude Code</strong></td><td>2025.02.25</td><td>ä¸ 3.7 Sonnet åŒå‘</td><td>ç»ˆç«¯ AI ç¼–ç¨‹ä»£ç†</td></tr><tr><td><strong>Commands</strong></td><td>2025.03</td><td>Claude Code æ‰©å±•</td><td>å¿«æ·å‘½ä»¤å…¥å£</td></tr><tr><td><strong>Skills</strong></td><td>2025.03</td><td>Claude Code æ‰©å±•</td><td>å¤æ‚ä»»åŠ¡æ‰§è¡Œæ¨¡å—</td></tr><tr><td><strong>Rules</strong></td><td>2025.03</td><td>Claude Code æ‰©å±•</td><td>è¡Œä¸ºçº¦æŸè§„åˆ™</td></tr><tr><td><strong>Hooks</strong></td><td>2025.03</td><td>Claude Code æ‰©å±•</td><td>äº‹ä»¶é©±åŠ¨è‡ªåŠ¨åŒ–</td></tr><tr><td><strong>Memories</strong></td><td>2025.03</td><td>Claude Code æ‰©å±•</td><td>æŒä¹…åŒ–ä¸Šä¸‹æ–‡å­˜å‚¨</td></tr><tr><td><strong>Context Providers</strong></td><td>2025.03</td><td>Claude Code æ‰©å±•</td><td>è‡ªåŠ¨ä¸Šä¸‹æ–‡æ³¨å…¥</td></tr><tr><td><strong>Multi-Agent</strong></td><td>2025.05</td><td>å¤§ä¼šå‘å¸ƒ</td><td>å¤šæ™ºèƒ½ä½“åä½œ</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-13">ç¬¬äºŒéƒ¨åˆ†ï¼šåŸºç¡€æ¦‚å¿µä¸é…ç½®</h3>
<h4 data-id="heading-14">2.1 ä»€ä¹ˆæ˜¯ Claude Code æ‰©å±•èƒ½åŠ›</h4>
<p><strong>æ‰©å±•èƒ½åŠ›</strong>ï¼Œç®€å•è¯´å°±æ˜¯<strong>è®© AI æ›´æ‡‚ä½ çš„é¡¹ç›®ã€æ›´ç¬¦åˆä½ çš„ä¹ æƒ¯</strong>çš„ä¸€ç³»åˆ—é…ç½®ã€‚</p>
<p>æ‰“ä¸ªæ¯”æ–¹ï¼š</p>
<ul>
<li>åŸç”Ÿçš„ Claude Code å°±åƒä¸€ä¸ª<strong>åˆšå…¥èŒçš„æ–°å‘˜å·¥</strong>ï¼Œèƒ½åŠ›å¾ˆå¼ºï¼Œä½†ä¸äº†è§£å…¬å¸çš„è§„èŒƒå’Œæµç¨‹</li>
<li>é…ç½®äº†æ‰©å±•èƒ½åŠ›åï¼Œå°±åƒè¿™ä¸ªå‘˜å·¥<strong>ç»è¿‡äº†å…¥èŒåŸ¹è®­</strong>ï¼ŒçŸ¥é“äº†å…¬å¸çš„ç¼–ç è§„èŒƒã€é¡¹ç›®ç»“æ„ã€å¸¸ç”¨å·¥å…·</li>
</ul>
<p><strong>æ‰©å±•èƒ½åŠ›èƒ½å¸®ä½ åšä»€ä¹ˆï¼Ÿ</strong></p>





































<table><thead><tr><th>ç—›ç‚¹</th><th>æ‰©å±•èƒ½åŠ›è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>æ¯æ¬¡éƒ½è¦é‡å¤è¯´æ˜é¡¹ç›®èƒŒæ™¯</td><td><strong>Context Providers</strong> è‡ªåŠ¨æ³¨å…¥é¡¹ç›®ä¿¡æ¯</td></tr><tr><td>AI ç”Ÿæˆçš„ä»£ç ä¸ç¬¦åˆå›¢é˜Ÿè§„èŒƒ</td><td><strong>Rules</strong> çº¦æŸä»£ç é£æ ¼å’Œå®‰å…¨è§„èŒƒ</td></tr><tr><td>å¸¸ç”¨æ“ä½œéœ€è¦è¾“å…¥å¾ˆé•¿çš„æŒ‡ä»¤</td><td><strong>Commands</strong> å®šä¹‰å¿«æ·å‘½ä»¤</td></tr><tr><td>å¤æ‚ä»»åŠ¡éœ€è¦å¤šä¸ªæ­¥éª¤</td><td><strong>Skills</strong> å°è£…å®Œæ•´çš„ä»»åŠ¡æµç¨‹</td></tr><tr><td>å¸Œæœ›æŸäº›æ“ä½œè‡ªåŠ¨æ‰§è¡Œ</td><td><strong>Hooks</strong> åœ¨ç‰¹å®šäº‹ä»¶æ—¶è‡ªåŠ¨è§¦å‘</td></tr><tr><td>AI è®°ä¸ä½ä¹‹å‰çš„å†³å®š</td><td><strong>Memories</strong> æŒä¹…åŒ–å­˜å‚¨é¡¹ç›®ä¿¡æ¯</td></tr><tr><td>éœ€è¦è·å– TAPD/Git ç­‰å¤–éƒ¨æ•°æ®</td><td><strong>MCP</strong> è¿æ¥å¤–éƒ¨æœåŠ¡</td></tr></tbody></table>
<h4 data-id="heading-15">2.2 é…ç½®ç›®å½•ç»“æ„è¯¦è§£</h4>
<p>æ‰€æœ‰æ‰©å±•èƒ½åŠ›çš„é…ç½®ï¼Œéƒ½æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ <code>.codebuddy/</code> æ–‡ä»¶å¤¹ä¸‹ï¼ˆä¸åŒ IDE å¯èƒ½æ˜¯ <code>.cursor/</code> æˆ– <code>.claude/</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">é¡¹ç›®æ ¹ç›®å½•/
â””â”€â”€ .codebuddy/                    <span class="hljs-comment"># æ‰©å±•èƒ½åŠ›é…ç½®æ ¹ç›®å½•</span>
    â”‚
    â”œâ”€â”€ commands/                  <span class="hljs-comment"># ğŸ“‹ å‘½ä»¤å®šä¹‰</span>
    â”‚   â”œâ”€â”€ create-component.md   <span class="hljs-comment"># åˆ›å»ºç»„ä»¶å‘½ä»¤</span>
    â”‚   â””â”€â”€ create-api.md         <span class="hljs-comment"># åˆ›å»º API å‘½ä»¤</span>
    â”‚
    â”œâ”€â”€ skills/                    <span class="hljs-comment"># ğŸ¯ æŠ€èƒ½å®šä¹‰</span>
    â”‚   â””â”€â”€ code-review/          <span class="hljs-comment"># æ¯ä¸ªæŠ€èƒ½ä¸€ä¸ªæ–‡ä»¶å¤¹</span>
    â”‚       â””â”€â”€ SKILL.md
    â”‚
    â”œâ”€â”€ rules/                     <span class="hljs-comment"># ğŸ“ è§„åˆ™å®šä¹‰</span>
    â”‚   â”œâ”€â”€ always/               <span class="hljs-comment"># å§‹ç»ˆç”Ÿæ•ˆçš„è§„åˆ™</span>
    â”‚   â”‚   â””â”€â”€ security.md
    â”‚   â”œâ”€â”€ requested/            <span class="hljs-comment"># AI æŒ‰éœ€å¼•ç”¨çš„è§„åˆ™</span>
    â”‚   â”‚   â””â”€â”€ i18n.md
    â”‚   â””â”€â”€ manual/               <span class="hljs-comment"># æ‰‹åŠ¨ @å¼•ç”¨çš„è§„åˆ™</span>
    â”‚       â””â”€â”€ performance.md
    â”‚
    â”œâ”€â”€ hooks/                     <span class="hljs-comment"># ğŸª é’©å­å®šä¹‰</span>
    â”‚   â””â”€â”€ pre-commit.md
    â”‚
    â”œâ”€â”€ memories/                  <span class="hljs-comment"># ğŸ§  è®°å¿†å­˜å‚¨</span>
    â”‚   â””â”€â”€ project-facts.json
    â”‚
    â”œâ”€â”€ context/                   <span class="hljs-comment"># ğŸ“„ ä¸Šä¸‹æ–‡æä¾›å™¨</span>
    â”‚   â””â”€â”€ auto-inject.md
    â”‚
    â””â”€â”€ mcp.json                   <span class="hljs-comment"># ğŸ”Œ MCP æœåŠ¡é…ç½®</span>
</code></pre>
<h4 data-id="heading-16">2.3 å„èƒ½åŠ›ç±»å‹å¯¹æ¯”</h4>




































































<table><thead><tr><th>èƒ½åŠ›ç±»å‹</th><th>è§¦å‘æ–¹å¼</th><th>ä¸»è¦ç”¨é€”</th><th>å¤æ‚åº¦</th><th>æ¨èä¼˜å…ˆçº§</th></tr></thead><tbody><tr><td><strong>Commands</strong></td><td><code>/command</code> æ˜¾å¼è°ƒç”¨</td><td>å¿«æ·å…¥å£</td><td>â­</td><td>P0</td></tr><tr><td><strong>Skills</strong></td><td>è¢« Command æˆ– AI è°ƒç”¨</td><td>å¤æ‚ä»»åŠ¡æ‰§è¡Œ</td><td>â­â­â­</td><td>P0</td></tr><tr><td><strong>Rules</strong></td><td>è‡ªåŠ¨/æŒ‰éœ€/æ‰‹åŠ¨</td><td>çº¦æŸ AI è¡Œä¸º</td><td>â­â­</td><td>P0</td></tr><tr><td><strong>Hooks</strong></td><td>äº‹ä»¶è‡ªåŠ¨è§¦å‘</td><td>è‡ªåŠ¨åŒ–æµç¨‹</td><td>â­â­</td><td>P1</td></tr><tr><td><strong>Memories</strong></td><td>AI è‡ªåŠ¨è¯»å–</td><td>æŒä¹…åŒ–ä¸Šä¸‹æ–‡</td><td>â­</td><td>P1</td></tr><tr><td><strong>Context</strong></td><td>è‡ªåŠ¨æ³¨å…¥</td><td>ä¸Šä¸‹æ–‡å¢å¼º</td><td>â­</td><td>P1</td></tr><tr><td><strong>MCP</strong></td><td>AI è°ƒç”¨</td><td>å¤–éƒ¨æœåŠ¡é›†æˆ</td><td>â­â­â­</td><td>P1</td></tr><tr><td><strong>Multi-Agent</strong></td><td>ä»»åŠ¡åˆ†å‘</td><td>å¤æ‚åä½œ</td><td>â­â­â­</td><td>P2</td></tr></tbody></table>
<p><strong>æ¨èçš„å­¦ä¹ é¡ºåº</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Commands (æœ€ç®€å•) â†’ Rules â†’ Skills â†’ Hooks â†’ Memories â†’ Context â†’ MCP â†’ Multi-Agent (æœ€å¤æ‚)
</code></pre>
<hr/>
<h3 data-id="heading-17">ç¬¬ä¸‰éƒ¨åˆ†ï¼šCommands å‘½ä»¤ç³»ç»Ÿ</h3>
<h4 data-id="heading-18">3.1 Commands æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Commands</strong> æ˜¯ç”¨æˆ·ä¸ AI äº¤äº’çš„<strong>å¿«æ·å…¥å£</strong>ï¼Œé€šè¿‡ <code>/command</code> æ ¼å¼è§¦å‘ã€‚</p>
<p><strong>è‡ªå®šä¹‰ Commands</strong> è®©ä½ å¯ä»¥å®šä¹‰è‡ªå·±çš„å¿«æ·å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><code>/create-component UserList</code> - åˆ›å»ºä¸€ä¸ª React ç»„ä»¶</li>
<li><code>/create-api users</code> - åˆ›å»ºç”¨æˆ· API æ¨¡å—</li>
<li><code>/analyze-pr 123</code> - åˆ†ææŸä¸ª PR</li>
</ul>
<h4 data-id="heading-19">3.2 å¦‚ä½•å®šä¹‰ä¸€ä¸ª Command</h4>
<p>Command ä½¿ç”¨ Markdown æ–‡ä»¶å®šä¹‰ï¼Œæ”¾åœ¨ <code>.codebuddy/commands/</code> ç›®å½•ä¸‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">&lt;!-- .codebuddy/commands/create-component.md --&gt;
---</span>
name: create-component
<span class="hljs-section">description: ğŸ§© åˆ›å»º React ç»„ä»¶
---</span>

<span class="hljs-section"># åˆ›å»º React ç»„ä»¶</span>

<span class="hljs-section">## ä½¿ç”¨æ–¹å¼</span>
/create-component &lt;ç»„ä»¶åç§°&gt; [--with-test]

<span class="hljs-section">## å‚æ•°è¯´æ˜</span>
<span class="hljs-bullet">-</span> <span class="hljs-code">`ç»„ä»¶åç§°`</span>ï¼šå¿…å¡«ï¼ŒPascalCase æ ¼å¼
<span class="hljs-bullet">-</span> <span class="hljs-code">`--with-test`</span>ï¼šå¯é€‰ï¼ŒåŒæ—¶ç”Ÿæˆæµ‹è¯•æ–‡ä»¶

<span class="hljs-section">## æ‰§è¡Œé€»è¾‘</span>
<span class="hljs-bullet">1.</span> éªŒè¯ç»„ä»¶åç§°æ ¼å¼
<span class="hljs-bullet">2.</span> ç”Ÿæˆç»„ä»¶æ–‡ä»¶åˆ° src/components/
<span class="hljs-bullet">3.</span> å¦‚æœæŒ‡å®š --with-testï¼Œç”Ÿæˆæµ‹è¯•æ–‡ä»¶
</code></pre>
<hr/>
<h3 data-id="heading-20">ç¬¬å››éƒ¨åˆ†ï¼šSkills æŠ€èƒ½ç³»ç»Ÿ</h3>
<h4 data-id="heading-21">4.1 Skills æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Skills</strong> æ˜¯ AI çš„èƒ½åŠ›æ¨¡å—ï¼Œå®šä¹‰äº†æ‰§è¡Œå¤æ‚ä»»åŠ¡çš„è¯¦ç»†é€»è¾‘ã€‚</p>
<p><strong>Skills ä¸ Commands çš„åŒºåˆ«</strong>ï¼š</p>
<ul>
<li>Commands æ˜¯"å…¥å£"ï¼Œå‘Šè¯‰ AI è¦åšä»€ä¹ˆ</li>
<li>Skills æ˜¯"æ‰§è¡Œè€…"ï¼Œå®šä¹‰å…·ä½“æ€ä¹ˆåš</li>
</ul>
<h4 data-id="heading-22">4.2 Skill çš„å®Œæ•´ç»“æ„</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">&lt;!-- .codebuddy/skills/code-review/SKILL.md --&gt;
---</span>
name: code-review
description: è‡ªåŠ¨ä»£ç å®¡æŸ¥
<span class="hljs-section">version: 1.0.0
---</span>

<span class="hljs-section"># ä»£ç å®¡æŸ¥æŠ€èƒ½</span>

<span class="hljs-section">## è¾“å…¥</span>
<span class="hljs-bullet">-</span> files: è¦å®¡æŸ¥çš„æ–‡ä»¶åˆ—è¡¨
<span class="hljs-bullet">-</span> checkTypes: æ£€æŸ¥ç±»å‹ï¼ˆsecurity/performance/styleï¼‰

<span class="hljs-section">## è¾“å‡º</span>
<span class="hljs-bullet">-</span> summary: é—®é¢˜æ±‡æ€»
<span class="hljs-bullet">-</span> issues: é—®é¢˜è¯¦æƒ…åˆ—è¡¨

<span class="hljs-section">## æ‰§è¡Œé€»è¾‘</span>
<span class="hljs-section">### Step 1: è¯»å–æ–‡ä»¶</span>
<span class="hljs-section">### Step 2: æ‰§è¡Œæ£€æŸ¥</span>
<span class="hljs-section">### Step 3: ç”ŸæˆæŠ¥å‘Š</span>
</code></pre>
<hr/>
<h3 data-id="heading-23">ç¬¬äº”éƒ¨åˆ†ï¼šRules è§„åˆ™ç³»ç»Ÿ</h3>
<h4 data-id="heading-24">5.1 Rules æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Rules</strong> æ˜¯çº¦æŸ AI è¡Œä¸ºçš„å£°æ˜å¼è§„åˆ™ï¼Œç¡®ä¿ç”Ÿæˆçš„ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒã€‚</p>
<h4 data-id="heading-25">5.2 ä¸‰ç§è§„åˆ™ç±»å‹</h4>

























<table><thead><tr><th>ç±»å‹</th><th>è§¦å‘æ–¹å¼</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Always</strong></td><td>å§‹ç»ˆç”Ÿæ•ˆ</td><td>å®‰å…¨è§„åˆ™ã€æ ¸å¿ƒç¼–ç è§„èŒƒ</td></tr><tr><td><strong>Requested</strong></td><td>AI æ ¹æ®ä»»åŠ¡è‡ªåŠ¨å¼•ç”¨</td><td>ç‰¹å®šé¢†åŸŸè§„åˆ™ï¼ˆå¦‚ i18nï¼‰</td></tr><tr><td><strong>Manual</strong></td><td>ç”¨æˆ·æ‰‹åŠ¨ @å¼•ç”¨</td><td>å¯é€‰çš„é«˜çº§è§„åˆ™</td></tr></tbody></table>
<h4 data-id="heading-26">5.3 å®æˆ˜æ¡ˆä¾‹ï¼šå®‰å…¨ç¼–ç è§„åˆ™</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">&lt;!-- .codebuddy/rules/always/security.md --&gt;
---</span>
name: security-rules
type: always
<span class="hljs-section">description: ğŸ”’ å®‰å…¨ç¼–ç è§„åˆ™
---</span>

<span class="hljs-section"># å®‰å…¨ç¼–ç è§„åˆ™</span>

<span class="hljs-section">## 1. ç¦æ­¢ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯</span>
âŒ const API<span class="hljs-emphasis">_KEY = 'sk-xxx';
âœ… const API_</span>KEY = process.env.API<span class="hljs-emphasis">_KEY;

## 2. SQL æ³¨å…¥é˜²æŠ¤
âŒ `SELECT * FROM users WHERE id = '${userId}'`
âœ… db.query('SELECT * FROM users WHERE id = ?', [userId])
</span></code></pre>
<hr/>
<h3 data-id="heading-27">ç¬¬å…­éƒ¨åˆ†ï¼šHooks é’©å­ç³»ç»Ÿ</h3>
<h4 data-id="heading-28">6.1 Hooks æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Hooks</strong> æ˜¯äº‹ä»¶é©±åŠ¨çš„è‡ªåŠ¨åŒ–æœºåˆ¶ã€‚å½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒHooks ä¼šè‡ªåŠ¨æ‰§è¡Œé¢„å®šä¹‰çš„æ“ä½œã€‚</p>
<h4 data-id="heading-29">6.2 æ”¯æŒçš„äº‹ä»¶ç±»å‹</h4>






























<table><thead><tr><th>äº‹ä»¶</th><th>è§¦å‘æ—¶æœº</th><th>å…¸å‹ç”¨é€”</th></tr></thead><tbody><tr><td><code>pre-commit</code></td><td>æäº¤å‰</td><td>ä»£ç æ£€æŸ¥ã€æ ¼å¼åŒ–</td></tr><tr><td><code>post-save</code></td><td>ä¿å­˜å</td><td>è‡ªåŠ¨æ ¼å¼åŒ–</td></tr><tr><td><code>on-file-create</code></td><td>åˆ›å»ºæ–‡ä»¶æ—¶</td><td>æ·»åŠ å¤´éƒ¨æ³¨é‡Š</td></tr><tr><td><code>after-skill</code></td><td>æŠ€èƒ½æ‰§è¡Œå</td><td>éªŒè¯ç»“æœ</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-30">ç¬¬ä¸ƒéƒ¨åˆ†ï¼šMemories è®°å¿†ç³»ç»Ÿ</h3>
<h4 data-id="heading-31">7.1 Memories æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Memories</strong> æ˜¯ AI çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œç”¨äºä¿å­˜é¡¹ç›®äº‹å®ã€ç”¨æˆ·åå¥½å’Œå­¦ä¹ è®°å½•ã€‚</p>
<h4 data-id="heading-32">7.2 è®°å¿†ç±»å‹</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// .codebuddy/memories/project-facts.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"techStack"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"framework"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"React 18"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ui"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"TDesign"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Redux Toolkit"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"conventions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"componentNaming"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"PascalCase"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"fileNaming"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"kebab-case"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-33">ç¬¬å…«éƒ¨åˆ†ï¼šContext Providers ä¸Šä¸‹æ–‡æä¾›å™¨</h3>
<h4 data-id="heading-34">8.1 Context Providers æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Context Providers</strong> è‡ªåŠ¨ä¸º AI æ³¨å…¥ç›¸å…³ä¸Šä¸‹æ–‡ï¼Œå‡å°‘é‡å¤è¯´æ˜é¡¹ç›®èƒŒæ™¯ã€‚</p>
<h4 data-id="heading-35">8.2 è‡ªåŠ¨æ³¨å…¥ç¤ºä¾‹</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">&lt;!-- .codebuddy/context/auto-inject.md --&gt;
---</span>
name: project-context
<span class="hljs-section">inject: always
---</span>

<span class="hljs-section"># é¡¹ç›®ä¸Šä¸‹æ–‡</span>
<span class="hljs-bullet">-</span> æ¡†æ¶ï¼šReact 18 + TypeScript
<span class="hljs-bullet">-</span> UI åº“ï¼šTDesign
<span class="hljs-bullet">-</span> æ„å»ºå·¥å…·ï¼šVite
</code></pre>
<hr/>
<h3 data-id="heading-36">ç¬¬ä¹éƒ¨åˆ†ï¼šMCP æ¨¡å‹ä¸Šä¸‹æ–‡åè®®</h3>
<h4 data-id="heading-37">9.1 MCP æ˜¯ä»€ä¹ˆ</h4>
<p><strong>MCP (Model Context Protocol)</strong> æ˜¯ AI ä¸å¤–éƒ¨æœåŠ¡äº¤äº’çš„æ ‡å‡†åè®®ï¼Œç”± Anthropic äº 2024 å¹´ 11 æœˆå¼€æºã€‚</p>
<h4 data-id="heading-38">9.2 é…ç½®ç¤ºä¾‹</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// .codebuddy/mcp.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"tapd"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp-oa.tapd.woa.com/mcp"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"gongfeng"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp.git.woa.com/mcp"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-39">9.3 å¸¸ç”¨ MCP æœåŠ¡</h4>





















<table><thead><tr><th>æœåŠ¡</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><strong>TAPD</strong></td><td>è·å–éœ€æ±‚ã€æ›´æ–°çŠ¶æ€</td></tr><tr><td><strong>å·¥èœ‚ Git</strong></td><td>åˆ†æ”¯ç®¡ç†ã€MR åˆ›å»º</td></tr><tr><td><strong>TDesign</strong></td><td>ç»„ä»¶æ–‡æ¡£æŸ¥è¯¢</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-40">ç¬¬åéƒ¨åˆ†ï¼šMulti-Agent å¤šæ™ºèƒ½ä½“</h3>
<h4 data-id="heading-41">10.1 Multi-Agent æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Multi-Agent</strong> æ˜¯å°†å¤æ‚ä»»åŠ¡åˆ†è§£ç»™å¤šä¸ªä¸“ä¸šæ™ºèƒ½ä½“åä½œå®Œæˆçš„æœºåˆ¶ã€‚</p>
<h4 data-id="heading-42">10.2 æ™ºèƒ½ä½“ç±»å‹</h4>





















<table><thead><tr><th>æ™ºèƒ½ä½“</th><th>èŒè´£</th></tr></thead><tbody><tr><td><strong>Reviewer</strong></td><td>ä»£ç å®¡æŸ¥</td></tr><tr><td><strong>Tester</strong></td><td>æµ‹è¯•ç”Ÿæˆ</td></tr><tr><td><strong>Documenter</strong></td><td>æ–‡æ¡£ç¼–å†™</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-43">ç¬¬åä¸€éƒ¨åˆ†ï¼šClaude åŸç”Ÿèƒ½åŠ›</h3>
<h4 data-id="heading-44">11.1 Vision è§†è§‰èƒ½åŠ›</h4>
<p>å¯ä»¥åˆ†æ UI è®¾è®¡ç¨¿ã€ç†è§£æˆªå›¾ä¸­çš„éœ€æ±‚ã€‚</p>
<h4 data-id="heading-45">11.2 Tool Use å·¥å…·è°ƒç”¨</h4>
<p>æ”¯æŒæ–‡ä»¶è¯»å†™ã€å‘½ä»¤æ‰§è¡Œã€å¤–éƒ¨æœåŠ¡è°ƒç”¨ã€‚</p>
<h4 data-id="heading-46">11.3 Extended Thinking æ·±åº¦æ¨ç†</h4>
<p>Claude 3.7 Sonnet çš„æ··åˆæ¨ç†èƒ½åŠ›ï¼Œå¯ä»¥å±•ç¤ºæ€è€ƒè¿‡ç¨‹ã€‚</p>
<hr/>
<h3 data-id="heading-47">ç¬¬åäºŒéƒ¨åˆ†ï¼šå®Œæ•´å·¥ä½œæµæ¡ˆä¾‹</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> /specskills:launch "TAPD-123456789"
   â†“
<span class="hljs-bullet">2.</span> AI è°ƒç”¨ TAPD MCP è·å–éœ€æ±‚è¯¦æƒ…
   â†“
<span class="hljs-bullet">3.</span> analyze-requirements æŠ€èƒ½åˆ†æéœ€æ±‚
   â†“
<span class="hljs-bullet">4.</span> ç”¨æˆ·å®¡æ ¸ç¡®è®¤
   â†“
<span class="hljs-bullet">5.</span> AI æŒ‰ä»»åŠ¡é€é¡¹å®æ–½
   â†“
<span class="hljs-bullet">6.</span> post-apply Hook è‡ªåŠ¨éªŒè¯
</code></pre>
<hr/>
<h3 data-id="heading-48">ç¬¬åä¸‰éƒ¨åˆ†ï¼šæœ€ä½³å®è·µä¸è¸©å‘æŒ‡å—</h3>
<h4 data-id="heading-49">13.1 æ‰©å±•ç»„ç»‡åŸåˆ™</h4>
<ol>
<li><strong>å•ä¸€èŒè´£</strong>ï¼šæ¯ä¸ª Skill åªåšä¸€ä»¶äº‹</li>
<li><strong>å¯ç»„åˆæ€§</strong>ï¼šSkills å¯ä»¥ç›¸äº’è°ƒç”¨</li>
<li><strong>å¯æµ‹è¯•æ€§</strong>ï¼šå®šä¹‰æ¸…æ™°çš„è¾“å…¥è¾“å‡º</li>
</ol>
<h4 data-id="heading-50">13.2 å¸¸è§é—®é¢˜</h4>





















<table><thead><tr><th>é—®é¢˜</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>Rules ä¸ç”Ÿæ•ˆ</td><td>æ£€æŸ¥ type æ˜¯å¦æ­£ç¡®ï¼ˆalways/requested/manualï¼‰</td></tr><tr><td>MCP è¿æ¥å¤±è´¥</td><td>æ£€æŸ¥ token é…ç½®å’Œç½‘ç»œ</td></tr><tr><td>Skill æ‰§è¡Œè¶…æ—¶</td><td>æ‹†åˆ†ä¸ºæ›´å°çš„æ­¥éª¤</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-51">ç¬¬åå››éƒ¨åˆ†ï¼šèƒ½åŠ›çŸ©é˜µä¸å­¦ä¹ è·¯å¾„</h3>
<h4 data-id="heading-52">14.1 èƒ½åŠ›çŸ©é˜µ</h4>



























































<table><thead><tr><th>èƒ½åŠ›</th><th>å¤æ‚åº¦</th><th>ä»·å€¼</th><th>æ¨èä¼˜å…ˆçº§</th></tr></thead><tbody><tr><td><strong>Commands</strong></td><td>â­</td><td>é«˜</td><td>P0</td></tr><tr><td><strong>Rules (Always)</strong></td><td>â­â­</td><td>é«˜</td><td>P0</td></tr><tr><td><strong>Skills</strong></td><td>â­â­â­</td><td>é«˜</td><td>P0</td></tr><tr><td><strong>Hooks</strong></td><td>â­â­</td><td>é«˜</td><td>P1</td></tr><tr><td><strong>MCP</strong></td><td>â­â­â­</td><td>é«˜</td><td>P1</td></tr><tr><td><strong>Memories</strong></td><td>â­</td><td>ä¸­</td><td>P1</td></tr><tr><td><strong>Context</strong></td><td>â­</td><td>ä¸­</td><td>P1</td></tr><tr><td><strong>Multi-Agent</strong></td><td>â­â­â­</td><td>ä¸­</td><td>P2</td></tr></tbody></table>
<h4 data-id="heading-53">14.2 æ¨èå­¦ä¹ è·¯å¾„</h4>
<pre><code class="hljs">å…¥é—¨ï¼šCommands â†’ Rules
è¿›é˜¶ï¼šSkills â†’ Hooks â†’ Memories
é«˜çº§ï¼šMCP â†’ Multi-Agent
</code></pre>
<hr/>
<h3 data-id="heading-54">å†™åœ¨æœ€å</h3>
<p>Claude Code çš„èƒ½åŠ›ä½“ç³»æ˜¯ä¸€ä¸ª<strong>æŒç»­æ¼”è¿›</strong>çš„ç”Ÿæ€ã€‚æœ¬æ–‡ä»‹ç»çš„å†…å®¹æ˜¯æˆªè‡³ 2025 å¹´ 12 æœˆçš„çŠ¶æ€ï¼Œéšç€ Anthropic çš„æŒç»­æ›´æ–°ï¼Œä¼šæœ‰æ›´å¤šå¼ºå¤§çš„èƒ½åŠ›åŠ å…¥ã€‚</p>
<p><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼šClaude Code çš„èƒ½åŠ›ä½“ç³»ï¼Œæ˜¯ä»"å¯¹è¯"åˆ°"è¡ŒåŠ¨"ï¼Œä»"å•ä¸€"åˆ°"åä½œ"çš„æ¼”è¿›è¿‡ç¨‹ã€‚æŒæ¡è¿™äº›èƒ½åŠ›ï¼Œèƒ½è®©ä½ çš„å¼€å‘æ•ˆç‡æå‡æ•°å€ã€‚</p>
<hr/>
<blockquote>
<p>ğŸ“… <strong>æœ€åæ›´æ–°</strong>ï¼š2025-12-03</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DRFæ¡†æ¶è®¤è¯åº•å±‚æºç è§£æâ€”â€”ç®€å•æ˜“ç†è§£ï¼]]></title>    <link>https://juejin.cn/post/7579176524131991603</link>    <guid>https://juejin.cn/post/7579176524131991603</guid>    <pubDate>2025-12-03T06:40:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579176524131991603" data-draft-id="7578948893762420763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DRFæ¡†æ¶è®¤è¯åº•å±‚æºç è§£æâ€”â€”ç®€å•æ˜“ç†è§£ï¼"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:40:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨³ä½åˆ«æµª"/> <meta itemprop="url" content="https://juejin.cn/user/1593616857302922"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DRFæ¡†æ¶è®¤è¯åº•å±‚æºç è§£æâ€”â€”ç®€å•æ˜“ç†è§£ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1593616857302922/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨³ä½åˆ«æµª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:40:03.000Z" title="Wed Dec 03 2025 06:40:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ï¼ˆå‰æï¼šå­¦è¿‡ä¸€ç‚¹Djangoæ¡†æ¶ï¼Œæ›´å¥½ç†è§£ï¼‰</p>
<h3 data-id="heading-0">ä¸€.ä»è¯·æ±‚å‘é€è¿‡æ¥åˆ°æ‰§è¡Œè®¤è¯çš„ç®€å•è¿‡ç¨‹æ¢³ç†</h3>
<p>è¯·æ±‚é¦–å…ˆæ¥åˆ°urlsæ¨¡å—ï¼Œè€Œåæ ¹æ® URL æ˜ å°„æ‰¾åˆ°Â <code>UserView</code>çš„<code>as_view()</code>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9baec02604cf45e78133d170cdc00c0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iz5L2P5Yir5rWq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348802&amp;x-signature=o%2FOnn%2FQgcF7k%2Fzo5wrQe7moJpi8%3D" alt="å±å¹•æˆªå›¾ 2025-12-02 171517.png" loading="lazy"/>
<code>as_view()</code>å†…éƒ¨ä¼šæ‰§è¡Œä¸¤ä¸ªå‘½ä»¤ï¼ˆç®€å•æ¥è¯´ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">obj</span> = UserView()  <span class="hljs-comment">#å®ä¾‹åŒ–ä¸€ä¸ªobj</span>
obj.dispatch()  <span class="hljs-comment">#è°ƒç”¨å¯¹è±¡çš„dispatchæ–¹æ³•</span>
</code></pre>
<p>è€Œ<code>as_view()</code>æ–¹æ³•æºç åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p>
<p>æ¥åˆ°viewæ¨¡å—ï¼Œä»class UserView(APIView)é‡Œç»§æ‰¿çš„APIViewå¼€å§‹ä¸€æ­¥æ­¥è·³è½¬</p>
<p>APIViewå¦‚ä¸‹å›¾æ‰€ç¤º
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7a8f109ed4245a48b5d666f5ead1d10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iz5L2P5Yir5rWq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348802&amp;x-signature=0as%2FYtMbeL93wIiZBGOZxZdYQPc%3D" alt="å±å¹•æˆªå›¾ 2025-12-02 173051.png" loading="lazy"/>
ç‚¹è¿›<code>as_view()</code>ï¼Œæ‰¾åˆ°ä¸€ä¸ªå«viewçš„æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<pre><code class="hljs language-view" lang="view">def view(request, *args, **kwargs):
    self = cls(**initkwargs)
    self.setup(request, *args, **kwargs)
    if not hasattr(self, "request"):
        raise AttributeError(
            "%s instance has no 'request' attribute. Did you override "
            "setup() and forget to call super()?" % cls.__name__
        )
    return self.dispatch(request, *args, **kwargs)
</code></pre>
<p>viewæ–¹æ³•çš„<code>self = cls(**initkwargs)</code>&gt;&gt;&gt;&gt;å®ä¾‹åŒ–äº†obj</p>
<p>æœ€åä¾¿è°ƒç”¨äº†<code>dispatchæ–¹æ³•</code>(è¿™æ˜¯æ¥ä¸‹æ¥çš„æ ¸å¿ƒï¼)</p>
<h3 data-id="heading-1">äºŒ.å¼€å§‹è®¤è¯æºç æµç¨‹</h3>
<p>çœ‹ä¸‹å›¾ï¼Œç®€å•æ¸…æ™°æ˜äº†
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3c1f5b451944a19995022d9fe032e9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iz5L2P5Yir5rWq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348802&amp;x-signature=AGyXbB79w2uljibzsn2%2Fy74Wadg%3D" alt="å±å¹•æˆªå›¾ 2025-12-03 143402.png" loading="lazy"/>
ä¸ä»…å¦‚æ­¤ï¼Œdispatché‡Œé¢è¿˜æœ‰å…³äºæƒé™å’Œé™æµçš„æ–¹æ³•ï¼Œå®ƒå°±ç›¸å½“äºä¸€ä¸ªå…¥å£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è™šæ‹Ÿæ»šåŠ¨ï¼šä¼˜åŒ–é•¿åˆ—è¡¨æ€§èƒ½çš„åˆ©å™¨]]></title>    <link>https://juejin.cn/post/7579179625462218794</link>    <guid>https://juejin.cn/post/7579179625462218794</guid>    <pubDate>2025-12-03T06:27:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179625462218794" data-draft-id="7578948893762633755" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è™šæ‹Ÿæ»šåŠ¨ï¼šä¼˜åŒ–é•¿åˆ—è¡¨æ€§èƒ½çš„åˆ©å™¨"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:27:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Drift_Dream"/> <meta itemprop="url" content="https://juejin.cn/user/3107677514241500"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è™šæ‹Ÿæ»šåŠ¨ï¼šä¼˜åŒ–é•¿åˆ—è¡¨æ€§èƒ½çš„åˆ©å™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3107677514241500/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Drift_Dream
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:27:28.000Z" title="Wed Dec 03 2025 06:27:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.7;font-weight:400;font-size:16px;overflow-x:hidden;color:#212122}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:8px;padding-bottom:8px}.markdown-body h1{color:#a0a0a0;font-size:38px;margin-top:32px;padding-top:32px}.markdown-body h2{color:#fff;background-color:#212122;width:fit-content;border-bottom-right-radius:100px;margin-top:47px;margin-bottom:16px;padding:4px 48px 4px 8px;line-height:1.7;font-size:30px;transition:all .3s ease-out}.markdown-body h2:hover{border-bottom-right-radius:50px;transition:all .3s ease-out}.markdown-body h3{font-size:24px;padding-left:8px;margin-top:32px;border-bottom:2px solid #c6c4c4;line-height:1.7}.markdown-body h4{font-size:20px;padding-left:8px;margin-top:32px;border-bottom:1px solid #ddd}.markdown-body h5{font-size:16px;margin-top:24px}.markdown-body h6{margin-top:16px;line-height:1.1}.markdown-body p{font-size:16px;text-align:start;white-space:normal;text-size-adjust:auto;line-height:2;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%;margin:auto;padding-left:8px;padding-right:8px}.markdown-body hr{border:none;border-top:4px double #212122;margin-top:32px;margin-bottom:32px;text-align:center}.markdown-body hr:after{content:"â™¥";display:inline-block;position:relative;top:-15px;padding:0 10px;color:#212122;font-size:18px}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f1f1f1;color:#ef7060;font-size:14px;padding:.065em 6px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.7;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);margin:32px 16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-color:#212122;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);background-size:40px}.markdown-body pre&gt;code{font-size:14px;padding:16px 8px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#fff;background:#272822}.markdown-body pre&gt;code::-webkit-scrollbar{height:10px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:3px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{border-radius:3px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#555}.markdown-body a{color:#ef7060;padding:2px;text-decoration:none;border-bottom:.125em solid #ef7060;border-radius:2px;box-shadow:inset 0 -.025em 0 #ef7060;transition:box-shadow .27s cubic-bezier(.77,0,.175,1),color .27s cubic-bezier(.77,0,.175,1)}.markdown-body a:focus,.markdown-body a:hover{outline:none;box-shadow:inset 0 -1.5em 0 #ef7060;color:#fff}.markdown-body a:before{content:"â‡² ";vertical-align:top;margin-left:2px;font-family:dart!important;font-size:12px;color:inherit;opacity:.7}.markdown-body table{background:#fbfbfb;border-radius:4px;border-collapse:collapse;margin:auto;padding:5px;width:95%;box-shadow:0 5px 10px rgba(0,0,0,.1);animation:float 5s infinite}.markdown-body table th{color:#fff;background:#212122;border-bottom:1px solid #9ea7af;border-right:1px solid #343a45;font-size:18px;padding:16px;text-align:left;vertical-align:middle}.markdown-body table th:first-child{border-top-left-radius:4px}.markdown-body table th:last-child{border-top-right-radius:4px;border-right:none}.markdown-body table tr{border-top:1px solid #c1c3d1;border-bottom:1px solid #c1c3d1;color:#666b85}.markdown-body table tr:hover td{background:#212122;color:#fff;border-top:1px solid #22262e}.markdown-body table tr:first-child{border-top:none}.markdown-body table tr:last-child{border-bottom:none}.markdown-body table tr:nth-child(odd) td{background:#f1f1f1}.markdown-body table tr:nth-child(odd):hover td{background:#212122}.markdown-body table tr:last-child td:first-child{border-bottom-left-radius:4px}.markdown-body table tr:last-child td:last-child{border-bottom-right-radius:4px}.markdown-body table td{background:#fbfbfb;padding:16px;text-align:left;vertical-align:middle;font-size:16px;border-right:1px solid #c1c3d1}.markdown-body table td:last-child{border-right:0}.markdown-body blockquote{color:#777;padding:1px 16px;margin:24px 0;border-left:4px solid #c6c4c4;background-color:#f1f1f1;transition:all .3s ease-out;border-radius:4px}.markdown-body blockquote:hover{border-left-color:#212122;background-color:#212122;color:#fff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:24px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body span.math{margin-left:32px;font-size:18px;font-weight:700}@media (max-width:720px){.markdown-body h1{font-size:30.4px}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:19.2px}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:12.8px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">ä»€ä¹ˆæ˜¯è™šæ‹Ÿæ»šåŠ¨ï¼Ÿ</h2>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªåŒ…å«10,000ä¸ªé¡¹ç›®çš„å¾…åŠäº‹é¡¹åˆ—è¡¨ã€‚å¦‚æœä¸€æ¬¡æ€§å°†æ‰€æœ‰é¡¹ç›®éƒ½æ¸²æŸ“åˆ°é¡µé¢ä¸Šï¼Œæµè§ˆå™¨éœ€è¦åˆ›å»º10,000ä¸ªDOMå…ƒç´ ï¼Œè¿™ä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>é¡µé¢åŠ è½½ç¼“æ…¢</li>
<li>å†…å­˜å ç”¨è¿‡é«˜</li>
<li>æ»šåŠ¨å¡é¡¿ä¸æµç•…</li>
</ul>
<p>è™šæ‹Ÿæ»šåŠ¨ï¼ˆVirtual Scrollingï¼‰å°±åƒæ˜¯ä¸€ä¸ª"æ™ºèƒ½çª—å£"ï¼Œå®ƒåªæ¸²æŸ“å½“å‰å¯è§åŒºåŸŸçš„å†…å®¹ï¼Œè€Œä¸æ˜¯æ•´ä¸ªåˆ—è¡¨ã€‚å½“ç”¨æˆ·æ»šåŠ¨æ—¶ï¼Œè¿™ä¸ª"çª—å£"ä¼šåŠ¨æ€æ›´æ–°æ˜¾ç¤ºçš„å†…å®¹ã€‚</p>
<p><strong>é€šä¿—æ¯”å–»</strong>ï¼šæŠŠè™šæ‹Ÿæ»šåŠ¨æƒ³è±¡æˆä¸€ä¸ªåªèƒ½çœ‹åˆ°éƒ¨åˆ†ä¹¦ç±å†…å®¹çš„é­”æ³•ä¹¦æ¶ã€‚å½“ä½ ä¸Šä¸‹ç§»åŠ¨è§†çº¿æ—¶ï¼Œä¹¦æ¶ä¼šè‡ªåŠ¨æ›´æ¢æ˜¾ç¤ºçš„ä¹¦æœ¬ï¼Œä½†ä½ å§‹ç»ˆåªèƒ½çœ‹åˆ°æœ‰é™çš„å‡ æœ¬ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå›¾ä¹¦é¦†çš„æ‰€æœ‰ä¹¦ç±ã€‚</p>
<h2 data-id="heading-1">è™šæ‹Ÿæ»šåŠ¨çš„åŸç†</h2>
<p>è™šæ‹Ÿæ»šåŠ¨çš„æ ¸å¿ƒæ€æƒ³å¾ˆç®€å•ï¼š</p>
<ol>
<li><strong>è®¡ç®—å¯è§åŒºåŸŸ</strong>ï¼šç¡®å®šå®¹å™¨çš„é«˜åº¦å’Œæ»šåŠ¨ä½ç½®</li>
<li><strong>è®¡ç®—æ˜¾ç¤ºçš„èµ·å§‹å’Œç»“æŸç´¢å¼•</strong>ï¼šæ ¹æ®æ¯ä¸ªé¡¹ç›®çš„é«˜åº¦ï¼Œç®—å‡ºå½“å‰åº”è¯¥æ˜¾ç¤ºå“ªäº›é¡¹ç›®</li>
<li><strong>åªæ¸²æŸ“å¯è§é¡¹ç›®</strong>ï¼šä»…åˆ›å»ºå½“å‰å¯è§åŒºåŸŸå†…çš„DOMå…ƒç´ </li>
<li><strong>ä½¿ç”¨å ä½å…ƒç´ </strong>ï¼šç”¨ä¸€ä¸ªå…·æœ‰æ­£ç¡®é«˜åº¦çš„ç©ºå…ƒç´ æ¥ç»´æŒæ»šåŠ¨æ¡çš„å‡†ç¡®æ€§</li>
</ol>
<h2 data-id="heading-2">åŸºç¡€å®ç°ç¤ºä¾‹</h2>
<p>è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„JavaScriptå®ç°ï¼Œç†è§£æ ¸å¿ƒé€»è¾‘ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>è™šæ‹Ÿæ»šåŠ¨<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * {
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">box-sizing</span>: border-box;
    }
    <span class="hljs-selector-id">#container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">400px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
      <span class="hljs-attribute">overflow</span>: auto;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
    }
    <span class="hljs-selector-id">#content</span> {
      <span class="hljs-attribute">position</span>: relative;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100000px</span>;
    }
    <span class="hljs-selector-class">.item</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"content"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"container"</span>);
    <span class="hljs-keyword">const</span> content = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"content"</span>);
    <span class="hljs-keyword">const</span> itemHeight = <span class="hljs-number">50</span>;
    <span class="hljs-keyword">const</span> totalItems = <span class="hljs-number">2000</span>;

    <span class="hljs-comment">// æ¸²æŸ“å¯è§é¡¹ç›®</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderVisibleItems</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> scrollTop = container.<span class="hljs-property">scrollTop</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(scrollTop, <span class="hljs-string">"scrollTop"</span>);

      <span class="hljs-comment">// å‘ä¸‹å–æ•´</span>
      <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(scrollTop / itemHeight);

      <span class="hljs-comment">// å‘ä¸Šå–æ•´</span>
      <span class="hljs-keyword">const</span> visibleCount = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(container.<span class="hljs-property">clientHeight</span> / itemHeight);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(visibleCount, <span class="hljs-string">"visibleCount"</span>);

      <span class="hljs-comment">// å–å°</span>
      <span class="hljs-keyword">const</span> endIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(startIndex + visibleCount + <span class="hljs-number">5</span>, totalItems); <span class="hljs-comment">// å¤šæ¸²æŸ“å‡ ä¸ªä½œä¸ºç¼“å†²</span>

      <span class="hljs-comment">// æ¸…ç©ºå†…å®¹</span>
      content.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">""</span>;

      <span class="hljs-comment">// åˆ›å»ºå¯è§é¡¹ç›®</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = startIndex; i &lt; endIndex; i++) {
        <span class="hljs-keyword">const</span> item = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"div"</span>);
        item.<span class="hljs-property">className</span> = <span class="hljs-string">"item"</span>;
        item.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = itemHeight + <span class="hljs-string">"px"</span>;
        item.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">"absolute"</span>;
        item.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = i * itemHeight + <span class="hljs-string">"px"</span>;
        item.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">"100%"</span>;
        item.<span class="hljs-property">textContent</span> = <span class="hljs-string">`é¡¹ç›® <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>;
        content.<span class="hljs-title function_">appendChild</span>(item);
      }
    }

    container.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"scroll"</span>, renderVisibleItems);
    <span class="hljs-title function_">renderVisibleItems</span>(); <span class="hljs-comment">// åˆå§‹æ¸²æŸ“</span>
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d536b4e5c6a4976b8bfc83c7bf4a6bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRHJpZnRfRHJlYW0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348047&amp;x-signature=eQ9%2BkausXbpcSlj2oaggXbwr%2F1g%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">Vue 3ä¸­çš„è™šæ‹Ÿæ»šåŠ¨å®è·µ</h2>
<p>åœ¨Vue 3ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Composition APIæ›´ä¼˜é›…åœ°å®ç°è™šæ‹Ÿæ»šåŠ¨ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å®è·µæ–¹å¼ï¼š</p>
<h3 data-id="heading-4">1. ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆæ¨èï¼‰</h3>
<p>å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨æˆç†Ÿçš„è™šæ‹Ÿæ»šåŠ¨åº“ï¼Œå¦‚<code>vue-virtual-scroller</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install vue-virtual-scroller@next
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">RecycleScroller</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"scroller"</span>
    <span class="hljs-attr">:items</span>=<span class="hljs-string">"items"</span>
    <span class="hljs-attr">:item-size</span>=<span class="hljs-string">"50"</span>
    <span class="hljs-attr">key-field</span>=<span class="hljs-string">"id"</span>
    <span class="hljs-attr">v-slot</span>=<span class="hljs-string">"{ item }"</span>
  &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user"</span>&gt;</span>
      {{ item.name }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">RecycleScroller</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RecycleScroller</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-virtual-scroller'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'vue-virtual-scroller/dist/vue-virtual-scroller.css'</span>;

<span class="hljs-comment">// æ¨¡æ‹Ÿé•¿åˆ—è¡¨æ•°æ®</span>
<span class="hljs-keyword">const</span> items = <span class="hljs-title function_">ref</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">10000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({
  <span class="hljs-attr">id</span>: i,
  <span class="hljs-attr">name</span>: <span class="hljs-string">`ç”¨æˆ· <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>
})));
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.scroller</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
}

<span class="hljs-selector-class">.user</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#eee</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">2. è‡ªå®šä¹‰è™šæ‹Ÿæ»šåŠ¨ç»„ä»¶</h3>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°ç†è§£åŸç†ï¼Œå¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªç®€å•çš„è™šæ‹Ÿæ»šåŠ¨ç»„ä»¶ï¼š</p>
<p>æˆ‘çš„æ•´ä½“æ€è·¯å¦‚ä¸‹ï¼šæ»šåŠ¨åŒºåŸŸæœ‰3ä¸ªéƒ¨åˆ†ç»„æˆï¼Œä¸Šæ–¹å ä½åŒºï¼Œæ˜¾ç¤ºçš„é¡¹ç›®ï¼Œä¸‹æ–¹å ä½åŒºã€‚æ¯æ¬¡æ»šåŠ¨ä¸éœ€è¦å»è®¡ç®—æ¯ä¸€ä¸ªå±•ç¤ºé¡¹ç›®çš„ä½ç½®ã€‚åªéœ€è¦è®¡ç®—ä¸Šä¸‹å ä½åŒºçš„é«˜åº¦ä¸æ˜¾ç¤ºçš„é¡¹ç›®ã€‚</p>
<p>åŸºäºè¿™ä¸ªæ€è·¯å†™å‡ºäº†åŸºæœ¬ä»£ç ï¼Œç„¶åè®©AIä¼˜åŒ–äº†ä»£ç ä¸å¤„ç†äº†è¾¹ç•Œå€¼ç›¸å…³çš„ä¸€äº›é—®é¢˜ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"virtual-scroll-container"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"viewWrapRef"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"scroll-wrap"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: scrollContainerHeight + 'px' }"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- ä¸Šæ–¹å ä½åŒº --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"top-placeholder"</span>
        <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: topPlaceholderHeight + 'px' }"</span>
      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- å†…å®¹åŒº --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in displayItems"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- ä¸‹æ–¹å ä½åŒº --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"bottom-placeholder"</span>
        <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: bottomPlaceholderHeight + 'px' }"</span>
      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> {
  ref,
  onMounted,
  onUnmounted,
  computed,
  nextTick,
  watch,
  withDefaults,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

interface <span class="hljs-title class_">Props</span> {
  <span class="hljs-attr">items</span>: any[];
  <span class="hljs-attr">itemHeight</span>: number;
  overscan?: number; <span class="hljs-comment">// æ·»åŠ ç¼“å†²é¡¹ç›®æ•°é‡é…ç½®</span>
}

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">withDefaults</span>(defineProps&lt;<span class="hljs-title class_">Props</span>&gt;(), {
  <span class="hljs-attr">items</span>: <span class="hljs-function">() =&gt;</span> [],
  <span class="hljs-attr">itemHeight</span>: <span class="hljs-number">50</span>,
  <span class="hljs-attr">overscan</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// é»˜è®¤ä¸Šä¸‹å„ç¼“å†²5ä¸ªé¡¹ç›®</span>
});

<span class="hljs-keyword">const</span> viewWrapRef = ref&lt;<span class="hljs-title class_">HTMLElement</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
<span class="hljs-keyword">const</span> startIndex = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> animationId = ref&lt;number | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// æ·»åŠ å®¹å™¨é«˜åº¦å’Œæ»šåŠ¨ä½ç½®çš„çŠ¶æ€</span>
<span class="hljs-keyword">const</span> containerHeight = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> scrollTop = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);

<span class="hljs-keyword">const</span> scrollContainerHeight = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> props.<span class="hljs-property">itemHeight</span> * props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>;
});

<span class="hljs-comment">// è®¡ç®—å¯è§é¡¹ç›®æ•°é‡ï¼ˆåŒ…å«ç¼“å†²ï¼‰</span>
<span class="hljs-keyword">const</span> visibleItemCount = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (containerHeight.<span class="hljs-property">value</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">const</span> baseCount = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(containerHeight.<span class="hljs-property">value</span> / props.<span class="hljs-property">itemHeight</span>);
    <span class="hljs-keyword">return</span> baseCount + props.<span class="hljs-property">overscan</span> * <span class="hljs-number">2</span>; <span class="hljs-comment">// ä¸Šä¸‹éƒ½æ·»åŠ ç¼“å†²</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-number">10</span>; <span class="hljs-comment">// é»˜è®¤å€¼</span>
});

<span class="hljs-comment">// è®¡ç®—å®é™…æ˜¾ç¤ºçš„é¡¹ç›®ï¼ˆåŒ…å«ç¼“å†²ï¼‰</span>
<span class="hljs-keyword">const</span> displayItems = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (!visibleItemCount.<span class="hljs-property">value</span> || props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> [];
  }

  <span class="hljs-comment">// è®¡ç®—èµ·å§‹ç´¢å¼•ï¼Œè€ƒè™‘ç¼“å†²</span>
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, startIndex.<span class="hljs-property">value</span> - props.<span class="hljs-property">overscan</span>);
  <span class="hljs-comment">// è®¡ç®—ç»“æŸç´¢å¼•ï¼Œç¡®ä¿ä¸è¶…å‡ºæ•°ç»„èŒƒå›´</span>
  <span class="hljs-keyword">const</span> end = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
    props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>,
    startIndex.<span class="hljs-property">value</span> + visibleItemCount.<span class="hljs-property">value</span> + props.<span class="hljs-property">overscan</span>
  );

  <span class="hljs-keyword">return</span> props.<span class="hljs-property">items</span>.<span class="hljs-title function_">slice</span>(start, end);
});

<span class="hljs-comment">// è®¡ç®—ä¸Šæ–¹å ä½é«˜åº¦</span>
<span class="hljs-keyword">const</span> topPlaceholderHeight = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, startIndex.<span class="hljs-property">value</span> - props.<span class="hljs-property">overscan</span>);
  <span class="hljs-keyword">return</span> start * props.<span class="hljs-property">itemHeight</span>;
});

<span class="hljs-comment">// è®¡ç®—ä¸‹æ–¹å ä½é«˜åº¦ï¼ˆç¡®ä¿ä¸ä¸ºè´Ÿæ•°ï¼‰</span>
<span class="hljs-keyword">const</span> bottomPlaceholderHeight = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (!visibleItemCount.<span class="hljs-property">value</span> || props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }

  <span class="hljs-keyword">const</span> end = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
    props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>,
    startIndex.<span class="hljs-property">value</span> + visibleItemCount.<span class="hljs-property">value</span> + props.<span class="hljs-property">overscan</span>
  );

  <span class="hljs-keyword">const</span> bottomHeight = (props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> - end) * props.<span class="hljs-property">itemHeight</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, bottomHeight); <span class="hljs-comment">// ç¡®ä¿ä¸ä¸ºè´Ÿæ•°</span>
});

<span class="hljs-comment">// ç›‘å¬å®¹å™¨å°ºå¯¸å˜åŒ–</span>
<span class="hljs-keyword">const</span> resizeObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> entries) {
    containerHeight.<span class="hljs-property">value</span> = entry.<span class="hljs-property">contentRect</span>.<span class="hljs-property">height</span>;
  }
});

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (viewWrapRef.<span class="hljs-property">value</span>) {
      <span class="hljs-comment">// åˆå§‹åŒ–å®¹å™¨é«˜åº¦</span>
      containerHeight.<span class="hljs-property">value</span> = viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-property">clientHeight</span>;

      <span class="hljs-comment">// ç›‘å¬å®¹å™¨å°ºå¯¸å˜åŒ–</span>
      resizeObserver.<span class="hljs-title function_">observe</span>(viewWrapRef.<span class="hljs-property">value</span>);

      <span class="hljs-comment">// æ·»åŠ æ»šåŠ¨äº‹ä»¶ç›‘å¬</span>
      viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"scroll"</span>, handleScroll, {
        <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span>,
      });

      <span class="hljs-comment">// åˆå§‹è®¡ç®—ä¸€æ¬¡</span>
      <span class="hljs-title function_">updateStartIndex</span>();
    }
  });
});

<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (viewWrapRef.<span class="hljs-property">value</span>) {
    viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">"scroll"</span>, handleScroll);
    resizeObserver.<span class="hljs-title function_">unobserve</span>(viewWrapRef.<span class="hljs-property">value</span>);
  }

  <span class="hljs-keyword">if</span> (animationId.<span class="hljs-property">value</span>) {
    <span class="hljs-title function_">cancelAnimationFrame</span>(animationId.<span class="hljs-property">value</span>);
  }

  resizeObserver.<span class="hljs-title function_">disconnect</span>();
});

<span class="hljs-comment">// ç›´æ¥å¤„ç†æ»šåŠ¨ï¼Œä¸ä½¿ç”¨é˜²æŠ–ï¼ˆä¸ºäº†æ›´å¿«é€Ÿå“åº”ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleScroll</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (animationId.<span class="hljs-property">value</span>) {
    <span class="hljs-title function_">cancelAnimationFrame</span>(animationId.<span class="hljs-property">value</span>);
  }

  animationId.<span class="hljs-property">value</span> = <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">updateStartIndex</span>();
  });
};

<span class="hljs-comment">// æ›´æ–°èµ·å§‹ç´¢å¼•</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateStartIndex</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (!viewWrapRef.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">const</span> currentScrollTop = viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span>;
  scrollTop.<span class="hljs-property">value</span> = currentScrollTop;

  <span class="hljs-comment">// è®¡ç®—æ–°çš„èµ·å§‹ç´¢å¼•</span>
  <span class="hljs-keyword">let</span> newStartIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(currentScrollTop / props.<span class="hljs-property">itemHeight</span>);

  <span class="hljs-comment">// ç¡®ä¿ç´¢å¼•åœ¨æœ‰æ•ˆèŒƒå›´å†…</span>
  newStartIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, newStartIndex);
  newStartIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(newStartIndex, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>));

  <span class="hljs-comment">// åªæœ‰å½“ç´¢å¼•çœŸæ­£æ”¹å˜æ—¶æ‰æ›´æ–°</span>
  <span class="hljs-keyword">if</span> (newStartIndex !== startIndex.<span class="hljs-property">value</span>) {
    startIndex.<span class="hljs-property">value</span> = newStartIndex;
  }
};

<span class="hljs-comment">// ç›‘å¬itemså˜åŒ–ï¼Œé‡ç½®çŠ¶æ€</span>
<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">items</span>,
  <span class="hljs-function">(<span class="hljs-params">newItems</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (newItems.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      startIndex.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// å¦‚æœæ»šåŠ¨ä½ç½®è¶…å‡ºäº†æ–°æ•°ç»„çš„èŒƒå›´ï¼Œè°ƒæ•´åˆ°æœ«å°¾</span>
      <span class="hljs-keyword">if</span> (startIndex.<span class="hljs-property">value</span> &gt;= newItems.<span class="hljs-property">length</span>) {
        startIndex.<span class="hljs-property">value</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, newItems.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);

        <span class="hljs-comment">// æ»šåŠ¨åˆ°æ­£ç¡®ä½ç½®</span>
        <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-keyword">if</span> (viewWrapRef.<span class="hljs-property">value</span>) {
            viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span> = startIndex.<span class="hljs-property">value</span> * props.<span class="hljs-property">itemHeight</span>;
          }
        });
      }
    }
  }
);

<span class="hljs-comment">// æš´éœ²æ–¹æ³•ç»™çˆ¶ç»„ä»¶</span>
<span class="hljs-title function_">defineExpose</span>({
  <span class="hljs-attr">scrollToIndex</span>: <span class="hljs-function">(<span class="hljs-params">index: number</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (viewWrapRef.<span class="hljs-property">value</span>) {
      <span class="hljs-keyword">const</span> targetIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(index, props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>));
      viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span> = targetIndex * props.<span class="hljs-property">itemHeight</span>;
      startIndex.<span class="hljs-property">value</span> = targetIndex;
    }
  },
  <span class="hljs-attr">scrollToTop</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (viewWrapRef.<span class="hljs-property">value</span>) {
      viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span> = <span class="hljs-number">0</span>;
      startIndex.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>;
    }
  },
  <span class="hljs-attr">scrollToBottom</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (viewWrapRef.<span class="hljs-property">value</span>) {
      <span class="hljs-keyword">const</span> targetIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);
      viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span> = targetIndex * props.<span class="hljs-property">itemHeight</span>;
      startIndex.<span class="hljs-property">value</span> = targetIndex;
    }
  },
});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.virtual-scroll-container</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">overflow</span>: auto;

  <span class="hljs-selector-class">.scroll-wrap</span> {
    <span class="hljs-attribute">position</span>: relative;
  }

  <span class="hljs-selector-class">.top-placeholder</span>,
  <span class="hljs-selector-class">.bottom-placeholder</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  }

  <span class="hljs-selector-class">.content-container</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…¨é¢æ‹†è§£ç¦»çº¿â†’åŒæ­¥çš„10å¤§æ ¸å¿ƒé—®é¢˜ã€è½åœ°çš„å®Œæ•´æ–¹æ¡ˆï¼ˆæ€è·¯+æ¶æ„+ä»£ç ï¼‰ã€‘]]></title>    <link>https://juejin.cn/post/7579179741825040410</link>    <guid>https://juejin.cn/post/7579179741825040410</guid>    <pubDate>2025-12-03T06:29:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179741825040410" data-draft-id="7579255046978863130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…¨é¢æ‹†è§£ç¦»çº¿â†’åŒæ­¥çš„10å¤§æ ¸å¿ƒé—®é¢˜ã€è½åœ°çš„å®Œæ•´æ–¹æ¡ˆï¼ˆæ€è·¯+æ¶æ„+ä»£ç ï¼‰ã€‘"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:29:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆå“ˆå“ˆç¬‘ä»€ä¹ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/808832912075352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…¨é¢æ‹†è§£ç¦»çº¿â†’åŒæ­¥çš„10å¤§æ ¸å¿ƒé—®é¢˜ã€è½åœ°çš„å®Œæ•´æ–¹æ¡ˆï¼ˆæ€è·¯+æ¶æ„+ä»£ç ï¼‰ã€‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/808832912075352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆå“ˆå“ˆç¬‘ä»€ä¹ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:29:33.000Z" title="Wed Dec 03 2025 06:29:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»21åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸‹é¢æˆ‘ä¼šå…ˆ <strong>å…¨é¢æ‹†è§£ç¦»çº¿â†’åŒæ­¥çš„10å¤§æ ¸å¿ƒé—®é¢˜</strong>ï¼ˆå«å…·ä½“è¡¨ç°+æ ¹æœ¬åŸå› ï¼‰ï¼Œå†ç»™å‡º <strong>å¯è½åœ°çš„å®Œæ•´æ–¹æ¡ˆï¼ˆæ€è·¯+æ¶æ„+ä»£ç ï¼‰</strong>ï¼Œæœ€åé€šè¿‡æµ‹è¯•åœºæ™¯éªŒè¯æ–¹æ¡ˆæœ‰æ•ˆæ€§ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ç¦»çº¿ä¸‹å•â†’è”ç½‘åŒæ­¥çš„æ ¸å¿ƒé—®é¢˜æ¸…å•ï¼ˆæŒ‰å‘ç”Ÿæ¦‚ç‡æ’åºï¼‰</h2>




























































<table><thead><tr><th>é—®é¢˜ç±»å‹</th><th>å…·ä½“è¡¨ç°</th><th>æ ¹æœ¬åŸå› </th></tr></thead><tbody><tr><td>1. ç¦»çº¿è®¢å•æœ¬åœ°ä¸¢å¤±</td><td>è®¾å¤‡ç¦»çº¿ä¸‹å•åï¼Œçªç„¶æ–­ç”µ/ç³»ç»Ÿå´©æºƒ/å­˜å‚¨ä»‹è´¨æŸåï¼ˆå¦‚SDå¡åï¼‰ï¼Œè®¢å•æ¶ˆå¤±ã€‚</td><td>æœ¬åœ°æœªåšå¯é æŒä¹…åŒ–ï¼›æ— å¤‡ä»½æœºåˆ¶ï¼›è®¢å•å­˜å‚¨æ— äº‹åŠ¡ä¿éšœã€‚</td></tr><tr><td>2. åŒæ­¥æ—¶ç½‘ç»œå†æ¬¡ä¸­æ–­</td><td>è®¾å¤‡è”ç½‘åå¼€å§‹åŒæ­¥ï¼ŒåŒæ­¥è¿‡ç¨‹ä¸­ç½‘ç»œåˆæ–­ï¼Œå¯¼è‡´éƒ¨åˆ†è®¢å•æœªåŒæ­¥/åŒæ­¥ä¸€åŠã€‚</td><td>æ— æ–­ç‚¹ç»­ä¼ æœºåˆ¶ï¼›åŒæ­¥çŠ¶æ€æœªç²¾ç»†è®°å½•ï¼›æœªæ ‡è®°â€œå·²åŒæ­¥è®¢å•IDâ€ã€‚</td></tr><tr><td>3. å¤šè®¢å•åŒæ­¥é¡ºåºé”™ä¹±</td><td>è®¾å¤‡ç¦»çº¿æ—¶ç”Ÿæˆè®¢å•Aï¼ˆå…ˆä¸‹ï¼‰ã€è®¢å•Bï¼ˆåä¸‹ï¼‰ï¼ŒåŒæ­¥æ—¶å› ç½‘ç»œå»¶è¿Ÿï¼Œäº‘ç«¯å…ˆæ”¶åˆ°Båæ”¶åˆ°Aï¼Œå¯¼è‡´åº“å­˜æ‰£å‡é¡ºåºé”™è¯¯ï¼ˆè¶…å–ï¼‰ã€‚</td><td>è®¾å¤‡ç«¯æœªæŒ‰æ—¶é—´å‡åºåŒæ­¥ï¼›äº‘ç«¯æ— æœ‰åºæ¥æ”¶/æ¶ˆè´¹æœºåˆ¶ï¼›ç¼ºä¹å…¨å±€é¡ºåºæ§åˆ¶ã€‚</td></tr><tr><td>4. åŒæ­¥è®¢å•ä¸äº‘ç«¯å†²çª</td><td>è®¾å¤‡ç¦»çº¿æ—¶ä¸‹å•å•†å“Xï¼ŒåŒæ­¥æ—¶äº‘ç«¯å•†å“Xå·²è¢«çº¿ä¸Šå°ç¨‹åºä¹°å®Œï¼ˆåº“å­˜ä¸è¶³ï¼‰ï¼›æˆ–å•†å“Xå·²ä¸‹æ¶/ä»·æ ¼å˜æ›´ã€‚</td><td>ç¦»çº¿æ—¶ç”¨æœ¬åœ°åº“å­˜å¿«ç…§ï¼›åŒæ­¥æ—¶æœªæ ¡éªŒäº‘ç«¯æœ€æ–°æ•°æ®ï¼›æ— å†²çªè‡ªåŠ¨å¤„ç†æœºåˆ¶ã€‚</td></tr><tr><td>5. è®¢å•é‡å¤åŒæ­¥</td><td>è®¾å¤‡åŒæ­¥æˆåŠŸä½†æœªæ”¶åˆ°äº‘ç«¯ç¡®è®¤ï¼Œé‡å¯åå†æ¬¡åŒæ­¥ï¼›ç½‘ç»œå»¶è¿Ÿå¯¼è‡´è®¾å¤‡é‡è¯•ï¼Œäº‘ç«¯æ”¶åˆ°é‡å¤è¯·æ±‚ã€‚</td><td>æ— å…¨å±€å”¯ä¸€è®¢å•IDå»é‡ï¼›åŒæ­¥ç¡®è®¤æœºåˆ¶ä¸å®Œå–„ï¼›æœªè®°å½•å·²åŒæ­¥è®¢å•æ ‡è¯†ã€‚</td></tr><tr><td>6. åŒæ­¥å¤±è´¥æ— é‡è¯•æœºåˆ¶</td><td>å› äº‘ç«¯ä¸´æ—¶æ•…éšœï¼ˆå¦‚æœåŠ¡å®•æœºï¼‰å¯¼è‡´åŒæ­¥å¤±è´¥ï¼Œè®¾å¤‡æœªä¸»åŠ¨é‡è¯•ï¼Œè®¢å•é•¿æœŸç§¯å‹ã€‚</td><td>æ— é‡è¯•ç­–ç•¥ï¼›æœªè®¾ç½®é‡è¯•æ¬¡æ•°/é—´éš”ï¼›å¤±è´¥åæ— å‘Šè­¦æœºåˆ¶ã€‚</td></tr><tr><td>7. åŒæ­¥åè®¾å¤‡çŠ¶æ€æœªæ›´æ–°</td><td>äº‘ç«¯å·²æˆåŠŸå¤„ç†è®¢å•ï¼Œä½†è®¾å¤‡æœªæ”¶åˆ°ç¡®è®¤ï¼Œæœ¬åœ°ä»æ˜¾ç¤ºâ€œå¾…åŒæ­¥â€ï¼Œå¯¼è‡´é‡å¤åŒæ­¥ã€‚</td><td>åŒæ­¥ç¡®è®¤é“¾è·¯ä¸å¯é ï¼›è®¾å¤‡æœªæŒä¹…åŒ–åŒæ­¥ç»“æœï¼›æ— å›è°ƒé‡è¯•æœºåˆ¶ã€‚</td></tr><tr><td>8. æ‰¹é‡åŒæ­¥æ•ˆç‡ä½ä¸‹</td><td>è®¾å¤‡ç¦»çº¿æ—¶ç”Ÿæˆå¤§é‡è®¢å•ï¼ˆå¦‚100æ¡ï¼‰ï¼Œè”ç½‘åé€æ¡åŒæ­¥ï¼Œè€—æ—¶ä¹…ã€å ç½‘ç»œå¸¦å®½ã€‚</td><td>æœªåšæ‰¹é‡åŒæ­¥ä¼˜åŒ–ï¼›æ— æ–­ç‚¹ç»­ä¼ ï¼Œæ–­ç½‘åéœ€é‡æ–°åŒæ­¥å…¨é‡ã€‚</td></tr><tr><td>9. è®¾å¤‡æ—¶é—´é”™ä¹±å¯¼è‡´åŒæ­¥å¤±è´¥</td><td>è®¾å¤‡æœ¬åœ°æ—¶é—´æ…¢10åˆ†é’Ÿï¼Œç¦»çº¿ä¸‹å•æ—¶é—´æ—©äºäº‘ç«¯å•†å“ä¸Šæ¶æ—¶é—´ï¼ŒåŒæ­¥æ—¶è¢«æ‹’ç»ã€‚</td><td>è®¾å¤‡æœªå®šæ—¶æ ¡å‡†æ—¶é—´ï¼›è®¢å•æ—¶é—´ä»¥æœ¬åœ°ä¸ºå‡†ï¼Œæœªç”¨äº‘ç«¯æ—¶é—´æ ¡å‡†ã€‚</td></tr><tr><td>10. åŒæ­¥æ—¥å¿—ç¼ºå¤±å¯¼è‡´æ’æŸ¥å›°éš¾</td><td>åŒæ­¥å¤±è´¥åï¼Œæ— æ³•è¿½æº¯æ˜¯è®¾å¤‡ç«¯æœªå‘é€ã€äº‘ç«¯æœªæ¥æ”¶ï¼Œè¿˜æ˜¯å¤„ç†å¤±è´¥ã€‚</td><td>æ— å®Œæ•´åŒæ­¥æ—¥å¿—ï¼›æœªè®°å½•è®¢å•åŒæ­¥å…¨é“¾è·¯çŠ¶æ€ï¼ˆå‘é€/æ¥æ”¶/å¤„ç†/ç¡®è®¤ï¼‰ã€‚</td></tr></tbody></table>
<h2 data-id="heading-1">äºŒã€æ ¸å¿ƒè§£å†³æ€è·¯ä¸æ•´ä½“æ–¹æ¡ˆæ¶æ„</h2>
<h3 data-id="heading-2">1. æ ¸å¿ƒè§£å†³æ€è·¯ï¼ˆ5å¤§åŸåˆ™ï¼‰</h3>
<ul>
<li><strong>æœ¬åœ°å¯é å­˜å‚¨</strong>ï¼šç¦»çº¿è®¢å•å¿…é¡»æŒä¹…åŒ–+äº‹åŠ¡+å¤‡ä»½ï¼Œæœç»è®¾å¤‡æ•…éšœå¯¼è‡´ä¸¢å¤±ï¼›</li>
<li><strong>å¯é åŒæ­¥æœºåˆ¶</strong>ï¼šæ‰¹é‡æœ‰åºåŒæ­¥+æ–­ç‚¹ç»­ä¼ +æŒ‡æ•°é€€é¿é‡è¯•ï¼Œåº”å¯¹ç½‘ç»œæ³¢åŠ¨ï¼›</li>
<li><strong>äº‘ç«¯ä¸¥æ ¼æ ¡éªŒ</strong>ï¼šåŒæ­¥æ—¶æ ¡éªŒåº“å­˜ã€å•†å“çŠ¶æ€ã€è®¢å•å”¯ä¸€æ€§ï¼Œæ‹’ç»éæ³•è®¢å•ï¼›</li>
<li><strong>å†²çªè‡ªåŠ¨å¤„ç†</strong>ï¼šç”¨ä¹è§‚é”ã€çŠ¶æ€æœºè§£å†³åº“å­˜/è®¢å•çŠ¶æ€å†²çªï¼Œæ— éœ€äººå·¥å¹²é¢„ï¼›</li>
<li><strong>å®¹é”™å…œåº•</strong>ï¼šæ­»ä¿¡é˜Ÿåˆ—+åŒæ­¥æ—¥å¿—+å‘Šè­¦æœºåˆ¶ï¼Œç¡®ä¿æç«¯æƒ…å†µå¯è¿½æº¯ã€å¯æ¢å¤ã€‚</li>
</ul>
<h3 data-id="heading-3">2. æ•´ä½“æ¶æ„ï¼ˆè®¾å¤‡ç«¯+äº‘ç«¯ï¼‰</h3>























































<table><thead><tr><th>è§’è‰²</th><th>æ ¸å¿ƒç»„ä»¶</th><th>æ ¸å¿ƒèŒè´£</th></tr></thead><tbody><tr><td>è®¾å¤‡ç«¯</td><td>SQLiteï¼ˆåµŒå…¥å¼æ•°æ®åº“ï¼‰</td><td>ç¦»çº¿è®¢å•æŒä¹…åŒ–ï¼ˆå«åŒæ­¥çŠ¶æ€ï¼‰ã€æœ¬åœ°åº“å­˜å¿«ç…§</td></tr><tr><td>è®¾å¤‡ç«¯</td><td>ç½‘ç»œæ£€æµ‹æ¨¡å—</td><td>å®æ—¶æ£€æµ‹ç½‘ç»œçŠ¶æ€ï¼Œè”ç½‘åè§¦å‘åŒæ­¥</td></tr><tr><td>è®¾å¤‡ç«¯</td><td>åŒæ­¥å®¢æˆ·ç«¯</td><td>æ‰¹é‡æœ‰åºåŒæ­¥ã€æ–­ç‚¹ç»­ä¼ ã€æŒ‡æ•°é€€é¿é‡è¯•</td></tr><tr><td>äº‘ç«¯æ¥å…¥å±‚</td><td>Spring Cloud Gateway</td><td>è´Ÿè½½å‡è¡¡ã€é™æµã€æ¥æ”¶è®¾å¤‡åŒæ­¥è¯·æ±‚</td></tr><tr><td>äº‘ç«¯æ¶ˆæ¯å±‚</td><td>RabbitMQï¼ˆå•é˜Ÿåˆ—ï¼‰</td><td>æŒä¹…åŒ–åŒæ­¥æ¶ˆæ¯ã€ä¿è¯æ¶ˆè´¹é¡ºåº</td></tr><tr><td>äº‘ç«¯ç¼“å­˜å±‚</td><td>Redis</td><td>è®¢å•å»é‡ã€åˆ†å¸ƒå¼é”ã€åŒæ­¥çŠ¶æ€è®°å½•</td></tr><tr><td>äº‘ç«¯ä¸šåŠ¡å±‚</td><td>Spring Boot + Spring Cloud Stream</td><td>è®¢å•åŒæ­¥å¤„ç†ã€å†²çªè§£å†³ã€åº“å­˜æ‰£å‡</td></tr><tr><td>äº‘ç«¯å­˜å‚¨å±‚</td><td>MySQLï¼ˆInnoDBï¼‰</td><td>è®¢å•ã€åº“å­˜æŒä¹…åŒ–ï¼Œä¹è§‚é”ä¿éšœæ•°æ®ä¸€è‡´æ€§</td></tr><tr><td>ç›‘æ§å‘Šè­¦å±‚</td><td>Spring Boot Actuator + æ—¥å¿—</td><td>åŒæ­¥çŠ¶æ€ç›‘æ§ã€å¤±è´¥å‘Šè­¦ã€é“¾è·¯è¿½æº¯</td></tr></tbody></table>
<h3 data-id="heading-4">3. å®Œæ•´æµç¨‹ï¼ˆç¦»çº¿ä¸‹å•â†’è”ç½‘åŒæ­¥ï¼‰</h3>
<pre><code class="hljs language-css" lang="css">graph <span class="hljs-selector-tag">TD</span>
    %% ç¦»çº¿é˜¶æ®µ
    <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[ç”¨æˆ·åœ¨è®¾å¤‡ç¦»çº¿ä¸‹å•]</span> --&gt; <span class="hljs-selector-tag">B</span>{è®¾å¤‡æœ¬åœ°æ ¡éªŒ}
    <span class="hljs-selector-tag">B</span> --&gt;|<span class="hljs-number">1</span>. æœ¬åœ°åº“å­˜å¿«ç…§å……è¶³| C<span class="hljs-selector-attr">[æœ¬åœ°äº‹åŠ¡ï¼šSQLiteåˆ›å»ºè®¢å•+é¢„å æœ¬åœ°åº“å­˜]</span>
    C --&gt; D<span class="hljs-selector-attr">[è®¢å•çŠ¶æ€æ ‡è®°ä¸ºã€Œå¾…åŒæ­¥ã€ï¼Œè®°å½•sync_status=PENDINGã€sync_retry_count=0]</span>
    <span class="hljs-selector-tag">B</span> --&gt;|æœ¬åœ°åº“å­˜ä¸è¶³| E<span class="hljs-selector-attr">[æç¤ºç”¨æˆ·â€œåº“å­˜ä¸è¶³ï¼Œæ— æ³•ä¸‹å•â€]</span>
    
    %% è”ç½‘åŒæ­¥é˜¶æ®µ
    F<span class="hljs-selector-attr">[è®¾å¤‡æ£€æµ‹åˆ°ç½‘ç»œæ¢å¤]</span> --&gt; G<span class="hljs-selector-attr">[æŸ¥è¯¢æœ¬åœ°ã€Œå¾…åŒæ­¥ã€æˆ–ã€ŒåŒæ­¥å¤±è´¥ï¼ˆé‡è¯•&lt;5æ¬¡ï¼‰ã€çš„è®¢å•]</span>
    G --&gt; H<span class="hljs-selector-attr">[æŒ‰create_timeå‡åºæ’åºï¼ˆä¿è¯åŒæ­¥é¡ºåºï¼‰]</span>
    H --&gt; <span class="hljs-selector-tag">I</span><span class="hljs-selector-attr">[æ‰¹é‡æ‰“åŒ…è®¢å•ï¼ˆ10æ¡/æ‰¹ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰]</span>
    <span class="hljs-selector-tag">I</span> --&gt; J<span class="hljs-selector-attr">[å‘é€åŒæ­¥è¯·æ±‚åˆ°äº‘ç«¯ï¼ˆå¸¦last_sync_order_idï¼Œå³ä¸Šä¸€æ‰¹åŒæ­¥æˆåŠŸçš„æœ€åä¸€ä¸ªè®¢å•IDï¼‰]</span>
    
    %% äº‘ç«¯æ¥æ”¶ä¸é¢„å¤„ç†
    K<span class="hljs-selector-attr">[äº‘ç«¯Gatewayé™æµæ ¡éªŒ]</span> --&gt; L<span class="hljs-selector-attr">[åŒæ­¥æ¥æ”¶æœåŠ¡]</span>
    L --&gt; M<span class="hljs-selector-attr">[Rediså»é‡æ ¡éªŒï¼ˆæŒ‰order_idï¼‰]</span>
    M --&gt;|å·²åŒæ­¥| N<span class="hljs-selector-attr">[è¿”å›ã€Œå·²åŒæ­¥ã€ç¡®è®¤ï¼Œè·³è¿‡å¤„ç†]</span>
    M --&gt;|æœªåŒæ­¥| O<span class="hljs-selector-attr">[å‘é€åˆ°RabbitMQå•é˜Ÿåˆ—ï¼ˆæ¶ˆæ¯æŒä¹…åŒ–ï¼‰]</span>
    
    %% äº‘ç«¯ä¸šåŠ¡å¤„ç†
    O --&gt; <span class="hljs-selector-tag">P</span><span class="hljs-selector-attr">[Spring Cloud Streamå•çº¿ç¨‹æ¶ˆè´¹ï¼ˆä¿è¯é¡ºåºï¼‰]</span>
    <span class="hljs-selector-tag">P</span> --&gt; <span class="hljs-selector-tag">Q</span><span class="hljs-selector-attr">[Redisåˆ†å¸ƒå¼é”ï¼šé”å®šå•†å“ID+è®¢å•IDï¼Œé˜²æ­¢å¹¶å‘å†²çª]</span>
    <span class="hljs-selector-tag">Q</span> --&gt; R<span class="hljs-selector-attr">[äº‘ç«¯æ ¡éªŒï¼š1. å•†å“æ˜¯å¦ä¸Šæ¶ 2. äº‘ç«¯åº“å­˜æ˜¯å¦å……è¶³ 3. è®¢å•çŠ¶æ€æ˜¯å¦åˆæ³•]</span>
    R --&gt;|æ ¡éªŒå¤±è´¥| S<span class="hljs-selector-attr">[è¿”å›ã€ŒåŒæ­¥å¤±è´¥ã€+ åŸå› ï¼ˆå¦‚åº“å­˜ä¸è¶³ï¼‰]</span>
    R --&gt;|æ ¡éªŒæˆåŠŸ| T<span class="hljs-selector-attr">[ä¹è§‚é”æ‰£å‡äº‘ç«¯åº“å­˜+åˆ›å»ºäº‘ç«¯è®¢å•]</span>
    T --&gt; U<span class="hljs-selector-attr">[Redisæ ‡è®°è®¢å•ã€Œå·²åŒæ­¥ã€ï¼Œæœ‰æ•ˆæœŸ24å°æ—¶]</span>
    U --&gt; V<span class="hljs-selector-attr">[è¿”å›ã€ŒåŒæ­¥æˆåŠŸã€+ äº‘ç«¯è®¢å•çŠ¶æ€]</span>
    
    %% è®¾å¤‡ç«¯åç»­å¤„ç†
    V --&gt; W<span class="hljs-selector-attr">[è®¾å¤‡æ¥æ”¶åŒæ­¥ç»“æœ]</span>
    W --&gt; X<span class="hljs-selector-attr">[æ›´æ–°æœ¬åœ°è®¢å•çŠ¶æ€ï¼šåŒæ­¥æˆåŠŸâ†’SUCCESSï¼Œå¤±è´¥â†’FAILED+é‡è¯•æ¬¡æ•°+å¤±è´¥åŸå› ]</span>
    X --&gt; Y<span class="hljs-selector-attr">[è‹¥æ‰¹é‡åŒæ­¥éƒ¨åˆ†æˆåŠŸï¼Œè®°å½•last_sync_order_idï¼Œä¸‹æ¬¡ä»è¯¥IDåç»§ç»­åŒæ­¥]</span>
    S --&gt; Z<span class="hljs-selector-attr">[è®¾å¤‡è§¦å‘æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆ10sâ†’30sâ†’1minâ†’5minâ†’10minï¼‰]</span>
    Z --&gt;|é‡è¯•<span class="hljs-number">5</span>æ¬¡å¤±è´¥| AA<span class="hljs-selector-attr">[æ ‡è®°ä¸ºã€ŒåŒæ­¥å¼‚å¸¸ã€ï¼Œè®¾å¤‡æŒ‡ç¤ºç¯å‘Šè­¦+ä¸ŠæŠ¥äº‘ç«¯]</span>
</code></pre>
<h2 data-id="heading-5">ä¸‰ã€å®Œæ•´æ–¹æ¡ˆå®ç°ï¼ˆä»£ç +å…³é”®è¯´æ˜ï¼‰</h2>
<h3 data-id="heading-6">å‰ç½®å‡†å¤‡</h3>
<ul>
<li>è®¾å¤‡ç«¯ï¼šJava SEç¯å¢ƒï¼ˆåµŒå…¥å¼è®¾å¤‡é€‚é…ï¼‰ã€SQLiteæ•°æ®åº“ï¼ˆè½»é‡çº§ã€æ”¯æŒäº‹åŠ¡ï¼‰ï¼›</li>
<li>äº‘ç«¯ï¼šSpring Boot 2.7.xã€Spring Cloud Streamã€RabbitMQã€Redisã€MySQLï¼›</li>
<li>ä¾èµ–ï¼šè®¾å¤‡ç«¯éœ€å¼•å…¥sqlite-jdbcã€fastjsonã€httpclientï¼›äº‘ç«¯ä¾èµ–è§pom.xmlï¼ˆåç»­ç»™å‡ºï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-7">ç¬¬ä¸€éƒ¨åˆ†ï¼šè®¾å¤‡ç«¯æ ¸å¿ƒä»£ç ï¼ˆç¦»çº¿ä¸‹å•+è”ç½‘åŒæ­¥ï¼‰</h3>
<h4 data-id="heading-8">1. è®¾å¤‡ç«¯æœ¬åœ°æ•°æ®åº“è®¾è®¡ï¼ˆSQLiteï¼‰</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è®¢å•è¡¨ï¼ˆæ ¸å¿ƒï¼šè®°å½•åŒæ­¥çŠ¶æ€ã€é‡è¯•æ¬¡æ•°ã€å¤±è´¥åŸå› ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> device_order (
    order_id TEXT <span class="hljs-keyword">PRIMARY</span> KEY, <span class="hljs-comment">-- å…¨å±€å”¯ä¸€è®¢å•IDï¼ˆè®¾å¤‡ID+é›ªèŠ±ç®—æ³•ï¼‰</span>
    device_id TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- è®¾å¤‡å”¯ä¸€æ ‡è¯†ï¼ˆå‡ºå‚é¢„ç½®ï¼‰</span>
    user_id TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- ä¸‹å•ç”¨æˆ·IDï¼ˆè®¾å¤‡ç«¯é‡‡é›†ï¼Œå¦‚æ‰‹æœºå·/ä¼šå‘˜IDï¼‰</span>
    product_id TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- å•†å“ID</span>
    quantity <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- è´­ä¹°æ•°é‡</span>
    amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- è®¢å•é‡‘é¢ï¼ˆç¦»çº¿æ—¶çš„å•†å“ä»·æ ¼ï¼‰</span>
    create_time TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- ç¦»çº¿ä¸‹å•æ—¶é—´ï¼ˆè®¾å¤‡æœ¬åœ°æ—¶é—´ï¼Œæ ¼å¼ï¼šISO8601ï¼‰</span>
    sync_status TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'PENDING'</span>, <span class="hljs-comment">-- åŒæ­¥çŠ¶æ€ï¼šPENDING/ING/SUCCESS/FAILED/EXCEPTION</span>
    sync_retry_count <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>, <span class="hljs-comment">-- åŒæ­¥é‡è¯•æ¬¡æ•°</span>
    sync_fail_reason TEXT, <span class="hljs-comment">-- åŒæ­¥å¤±è´¥åŸå› </span>
    last_sync_time TEXT, <span class="hljs-comment">-- æœ€åä¸€æ¬¡åŒæ­¥æ—¶é—´</span>
    last_sync_order_id TEXT, <span class="hljs-comment">-- ä¸Šä¸€æ¬¡åŒæ­¥æˆåŠŸçš„è®¢å•IDï¼ˆæ–­ç‚¹ç»­ä¼ ç”¨ï¼‰</span>
    update_time TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-comment">-- è®¢å•æ›´æ–°æ—¶é—´</span>
);

<span class="hljs-comment">-- æœ¬åœ°å•†å“åº“å­˜å¿«ç…§è¡¨ï¼ˆç¦»çº¿æ—¶ç”¨ï¼Œè”ç½‘ååŒæ­¥äº‘ç«¯æœ€æ–°æ•°æ®ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> device_product_stock (
    product_id TEXT <span class="hljs-keyword">PRIMARY</span> KEY,
    product_name TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    price <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    available_stock <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- å¯ç”¨åº“å­˜ï¼ˆå¿«ç…§ï¼‰</span>
    locked_stock <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>, <span class="hljs-comment">-- é¢„å åº“å­˜ï¼ˆç¦»çº¿ä¸‹å•æ—¶æ‰£å‡ï¼‰</span>
    sync_time TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- æœ€åä¸€æ¬¡åŒæ­¥äº‘ç«¯æ•°æ®çš„æ—¶é—´</span>
    version <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> <span class="hljs-comment">-- ç‰ˆæœ¬å·ï¼ˆåŒæ­¥æ—¶æ ¡éªŒç”¨ï¼‰</span>
);

<span class="hljs-comment">-- è®¢å•å¤‡ä»½è¡¨ï¼ˆé˜²æ­¢ä¸»è¡¨æŸåï¼Œå®šæ—¶åŒæ­¥ä¸»è¡¨æ•°æ®ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> device_order_backup (
    <span class="hljs-keyword">LIKE</span> device_order INCLUDING <span class="hljs-keyword">ALL</span>
);
</code></pre>
<h4 data-id="heading-9">2. è®¾å¤‡ç«¯æ ¸å¿ƒå·¥å…·ç±»ï¼ˆè®¢å•IDç”Ÿæˆ+æ—¶é—´æ ¡å‡†ï¼‰</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * è®¾å¤‡ç«¯å…¨å±€å”¯ä¸€è®¢å•IDç”Ÿæˆå™¨ï¼ˆé¿å…é‡å¤ï¼‰
 * æ ¼å¼ï¼šè®¾å¤‡ID_é›ªèŠ±ç®—æ³•IDï¼ˆå¦‚ï¼šDEV001_1735689600000_001ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeviceOrderIdGenerator</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> deviceId; <span class="hljs-comment">// è®¾å¤‡å”¯ä¸€IDï¼ˆå‡ºå‚é¢„ç½®ï¼Œå¦‚DEV001ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Snowflake snowflake;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DeviceOrderIdGenerator</span><span class="hljs-params">(<span class="hljs-type">String</span> deviceId)</span> </span>{
        <span class="hljs-keyword">this</span>.deviceId = deviceId;
        <span class="hljs-comment">// é›ªèŠ±ç®—æ³•ï¼šå·¥ä½œID=è®¾å¤‡IDå“ˆå¸Œåå–æ¨¡32ï¼Œæ•°æ®ä¸­å¿ƒID=1</span>
        <span class="hljs-type">int</span> workerId = Math.<span class="hljs-built_in">abs</span>(deviceId.<span class="hljs-built_in">hashCode</span>()) % <span class="hljs-number">32</span>;
        <span class="hljs-keyword">this</span>.snowflake = IdUtil.<span class="hljs-built_in">createSnowflake</span>(<span class="hljs-number">1</span>, workerId);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">generateOrderId</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> deviceId + <span class="hljs-string">"_"</span> + snowflake.<span class="hljs-built_in">nextIdStr</span>();
    }
}

<span class="hljs-comment">/**
 * è®¾å¤‡æ—¶é—´æ ¡å‡†å·¥å…·ï¼ˆé¿å…æœ¬åœ°æ—¶é—´é”™ä¹±ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeviceTimeCalibrator</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> CLOUD_TIME_URL = <span class="hljs-string">"http://localhost:8080/api/common/cloud-time"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-type">long</span> timeOffset = <span class="hljs-number">0</span>; <span class="hljs-comment">// æœ¬åœ°æ—¶é—´ä¸äº‘ç«¯æ—¶é—´çš„åç§»é‡ï¼ˆmsï¼‰</span>

    <span class="hljs-comment">// å®šæ—¶æ ¡å‡†æ—¶é—´ï¼ˆæ¯1å°æ—¶æ ¡å‡†ä¸€æ¬¡ï¼Œè”ç½‘åç«‹å³æ ¡å‡†ï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">scheduleCalibrate</span><span class="hljs-params">()</span> </span>{
        ScheduledExecutorService executor = Executors.<span class="hljs-built_in">newSingleThreadScheduledExecutor</span>();
        executor.<span class="hljs-built_in">scheduleAtFixedRate</span>(<span class="hljs-keyword">this</span>::calibrate, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, TimeUnit.HOURS);
    }

    <span class="hljs-comment">// æ ¡å‡†æ—¶é—´ï¼šä»äº‘ç«¯è·å–å½“å‰æ—¶é—´ï¼Œè®¡ç®—åç§»é‡</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">calibrate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (!NetworkUtils.<span class="hljs-built_in">isNetworkAvailable</span>()) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">try</span> {
            RestTemplate restTemplate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RestTemplate</span>();
            <span class="hljs-type">String</span> cloudTimeStr = restTemplate.<span class="hljs-built_in">getForObject</span>(CLOUD_TIME_URL, <span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>);
            LocalDateTime cloudTime = LocalDateTime.<span class="hljs-built_in">parse</span>(cloudTimeStr);
            LocalDateTime localTime = LocalDateTime.<span class="hljs-built_in">now</span>();
            <span class="hljs-comment">// è®¡ç®—åç§»é‡ï¼šäº‘ç«¯æ—¶é—´ - æœ¬åœ°æ—¶é—´ï¼ˆmsï¼‰</span>
            timeOffset = Duration.<span class="hljs-built_in">between</span>(localTime, cloudTime).<span class="hljs-built_in">toMillis</span>();
            System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"æ—¶é—´æ ¡å‡†å®Œæˆï¼Œåç§»é‡ï¼š"</span> + timeOffset + <span class="hljs-string">"ms"</span>);
        } <span class="hljs-built_in">catch</span> (Exception e) {
            System.err.<span class="hljs-built_in">println</span>(<span class="hljs-string">"æ—¶é—´æ ¡å‡†å¤±è´¥ï¼š"</span> + e.<span class="hljs-built_in">getMessage</span>());
        }
    }

    <span class="hljs-comment">// è·å–æ ¡å‡†åçš„æ—¶é—´ï¼ˆç”¨äºè®¢å•åˆ›å»ºæ—¶é—´ï¼Œå‡å°‘æ—¶é—´å†²çªï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> LocalDateTime <span class="hljs-title">getCalibratedTime</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> LocalDateTime.<span class="hljs-built_in">now</span>().<span class="hljs-built_in">plusMillis</span>(timeOffset);
    }
}

<span class="hljs-comment">/**
 * ç½‘ç»œå·¥å…·ç±»ï¼ˆæ£€æµ‹ç½‘ç»œæ˜¯å¦å¯ç”¨ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkUtils</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title">isNetworkAvailable</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// pingäº‘ç«¯åœ°å€ï¼Œ3ç§’è¶…æ—¶</span>
            <span class="hljs-keyword">return</span> InetAddress.<span class="hljs-built_in">getByName</span>(<span class="hljs-string">"api.cloud-service.com"</span>).<span class="hljs-built_in">isReachable</span>(<span class="hljs-number">3000</span>);
        } <span class="hljs-built_in">catch</span> (IOException e) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<h4 data-id="heading-10">3. è®¾å¤‡ç«¯ç¦»çº¿ä¸‹å•æ ¸å¿ƒé€»è¾‘</h4>
<pre><code class="hljs language-ini" lang="ini">/**
 * è®¾å¤‡ç«¯ç¦»çº¿è®¢å•æœåŠ¡ï¼ˆæ ¸å¿ƒï¼šæœ¬åœ°äº‹åŠ¡+åº“å­˜é¢„å ï¼‰
 */
public class DeviceOfflineOrderService {
    private final Connection sqliteConn<span class="hljs-comment">;</span>
    private final DeviceOrderIdGenerator orderIdGenerator<span class="hljs-comment">;</span>
    private final DeviceTimeCalibrator timeCalibrator<span class="hljs-comment">;</span>
    private static final String <span class="hljs-attr">DEVICE_ID</span> = <span class="hljs-string">"DEV001"</span><span class="hljs-comment">; // è®¾å¤‡å”¯ä¸€IDï¼ˆå®é™…ä»é…ç½®æ–‡ä»¶è¯»å–ï¼‰</span>

    public DeviceOfflineOrderService(Connection sqliteConn) {
        <span class="hljs-attr">this.sqliteConn</span> = sqliteConn<span class="hljs-comment">;</span>
        <span class="hljs-attr">this.orderIdGenerator</span> = new DeviceOrderIdGenerator(DEVICE_ID)<span class="hljs-comment">;</span>
        <span class="hljs-attr">this.timeCalibrator</span> = new DeviceTimeCalibrator()<span class="hljs-comment">;</span>
        this.timeCalibrator.scheduleCalibrate()<span class="hljs-comment">; // å¯åŠ¨æ—¶é—´æ ¡å‡†</span>
    }

    /**
     * ç¦»çº¿ä¸‹å•ï¼ˆæœ¬åœ°äº‹åŠ¡ï¼šåˆ›å»ºè®¢å•+é¢„å åº“å­˜ï¼Œè¦ä¹ˆå…¨æˆï¼Œè¦ä¹ˆå…¨å›æ»šï¼‰
     */
    public Result&lt;String&gt; createOfflineOrder(OrderCreateDTO dto) {
        // 1. æ ¡éªŒæœ¬åœ°åº“å­˜å¿«ç…§
        if (!checkLocalStock(dto.getProductId(), dto.getQuantity())) {
            return Result.error("æœ¬åœ°åº“å­˜ä¸è¶³ï¼Œæ— æ³•ä¸‹å•")<span class="hljs-comment">;</span>
        }

        String <span class="hljs-attr">orderId</span> = orderIdGenerator.generateOrderId()<span class="hljs-comment">;</span>
        LocalDateTime <span class="hljs-attr">calibratedTime</span> = timeCalibrator.getCalibratedTime()<span class="hljs-comment">;</span>
        String <span class="hljs-attr">timeStr</span> = calibratedTime.format(DateTimeFormatter.ISO_LOCAL_DATE_TIME)<span class="hljs-comment">;</span>

        sqliteConn.setAutoCommit(false)<span class="hljs-comment">;</span>
        try {
            // 2. åˆ›å»ºæœ¬åœ°è®¢å•
            String <span class="hljs-attr">insertOrderSql</span> = <span class="hljs-string">"""
                INSERT INTO device_order 
                (order_id, device_id, user_id, product_id, quantity, amount, create_time, sync_status, update_time)
                VALUES (?, ?, ?, ?, ?, ?, ?, 'PENDING', ?)
            """</span><span class="hljs-comment">;</span>
            try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(insertOrderSql)) {
                pstmt.setString(1, orderId)<span class="hljs-comment">;</span>
                pstmt.setString(2, DEVICE_ID)<span class="hljs-comment">;</span>
                pstmt.setString(3, dto.getUserId())<span class="hljs-comment">;</span>
                pstmt.setString(4, dto.getProductId())<span class="hljs-comment">;</span>
                pstmt.setInt(5, dto.getQuantity())<span class="hljs-comment">;</span>
                pstmt.setBigDecimal(6, dto.getAmount())<span class="hljs-comment">;</span>
                pstmt.setString(7, timeStr)<span class="hljs-comment">;</span>
                pstmt.setString(8, timeStr)<span class="hljs-comment">;</span>
                pstmt.executeUpdate()<span class="hljs-comment">;</span>
            }

            // 3. é¢„å æœ¬åœ°åº“å­˜ï¼ˆavailable_stockå‡å°‘ï¼Œlocked_stockå¢åŠ ï¼‰
            String <span class="hljs-attr">updateStockSql</span> = <span class="hljs-string">"""
                UPDATE device_product_stock
                SET available_stock = available_stock - ?,
                    locked_stock = locked_stock + ?,
                    update_time = ?
                WHERE product_id = ?
            """</span><span class="hljs-comment">;</span>
            try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(updateStockSql)) {
                pstmt.setInt(1, dto.getQuantity())<span class="hljs-comment">;</span>
                pstmt.setInt(2, dto.getQuantity())<span class="hljs-comment">;</span>
                pstmt.setString(3, timeStr)<span class="hljs-comment">;</span>
                pstmt.setString(4, dto.getProductId())<span class="hljs-comment">;</span>
                pstmt.executeUpdate()<span class="hljs-comment">;</span>
            }

            // 4. å¤‡ä»½è®¢å•åˆ°å¤‡ä»½è¡¨ï¼ˆé˜²æ­¢ä¸»è¡¨æŸåï¼‰
            backupOrder(orderId, timeStr)<span class="hljs-comment">;</span>

            sqliteConn.commit()<span class="hljs-comment">;</span>
            return Result.success(orderId, "ç¦»çº¿ä¸‹å•æˆåŠŸï¼Œè®¢å•å·ï¼š" + orderId)<span class="hljs-comment">;</span>
        } catch (SQLException e) {
            try {
                sqliteConn.rollback()<span class="hljs-comment">;</span>
            } catch (SQLException ex) {
                ex.printStackTrace()<span class="hljs-comment">;</span>
            }
            return Result.error("ç¦»çº¿ä¸‹å•å¤±è´¥ï¼š" + e.getMessage())<span class="hljs-comment">;</span>
        }
    }

    /**
     * æ ¡éªŒæœ¬åœ°åº“å­˜å¿«ç…§æ˜¯å¦å……è¶³
     */
    private boolean checkLocalStock(String productId, int quantity) throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"SELECT available_stock FROM device_product_stock WHERE product_id = ?"</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            pstmt.setString(1, productId)<span class="hljs-comment">;</span>
            ResultSet <span class="hljs-attr">rs</span> = pstmt.executeQuery()<span class="hljs-comment">;</span>
            return rs.next() &amp;&amp; rs.getInt("available_stock") &gt;= quantity<span class="hljs-comment">;</span>
        }
    }

    /**
     * å¤‡ä»½è®¢å•åˆ°å¤‡ä»½è¡¨
     */
    private void backupOrder(String orderId, String updateTime) throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"""
            INSERT INTO device_order_backup
            SELECT * FROM device_order WHERE order_id = ? AND update_time = ?
        """</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            pstmt.setString(1, orderId)<span class="hljs-comment">;</span>
            pstmt.setString(2, updateTime)<span class="hljs-comment">;</span>
            pstmt.executeUpdate()<span class="hljs-comment">;</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-11">4. è®¾å¤‡ç«¯è”ç½‘åŒæ­¥æ ¸å¿ƒé€»è¾‘ï¼ˆæ‰¹é‡+æ–­ç‚¹ç»­ä¼ +é‡è¯•ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">/**
 * è®¾å¤‡ç«¯è®¢å•åŒæ­¥æœåŠ¡ï¼ˆæ ¸å¿ƒï¼šæ‰¹é‡åŒæ­¥+æ–­ç‚¹ç»­ä¼ +æŒ‡æ•°é€€é¿é‡è¯•ï¼‰
 */
public class DeviceOrderSyncService {
    private final Connection sqliteConn<span class="hljs-comment">;</span>
    private final String <span class="hljs-attr">syncUrl</span> = <span class="hljs-string">"http://localhost:8080/api/order/sync/batch"</span><span class="hljs-comment">; // äº‘ç«¯æ‰¹é‡åŒæ­¥æ¥å£</span>
    private static final int <span class="hljs-attr">BATCH_SIZE</span> = <span class="hljs-number">10</span><span class="hljs-comment">; // æ¯æ‰¹åŒæ­¥10æ¡è®¢å•</span>
    private static final int <span class="hljs-attr">MAX_RETRY_COUNT</span> = <span class="hljs-number">5</span><span class="hljs-comment">; // æœ€å¤§é‡è¯•æ¬¡æ•°</span>
    private final ScheduledExecutorService <span class="hljs-attr">syncExecutor</span> = Executors.newSingleThreadScheduledExecutor()<span class="hljs-comment">;</span>

    public DeviceOrderSyncService(Connection sqliteConn) {
        <span class="hljs-attr">this.sqliteConn</span> = sqliteConn<span class="hljs-comment">;</span>
        // å¯åŠ¨ç½‘ç»œç›‘å¬ï¼šæ¯3ç§’æ£€æµ‹ä¸€æ¬¡ç½‘ç»œï¼Œè”ç½‘åè§¦å‘åŒæ­¥
        startNetworkMonitor()<span class="hljs-comment">;</span>
    }

    /**
     * å¯åŠ¨ç½‘ç»œç›‘å¬ï¼Œè”ç½‘åè§¦å‘åŒæ­¥
     */
    private void startNetworkMonitor() {
        syncExecutor.scheduleAtFixedRate(() -&gt; {
            if (NetworkUtils.isNetworkAvailable()) {
                System.out.println("æ£€æµ‹åˆ°ç½‘ç»œå·²æ¢å¤ï¼Œå¼€å§‹åŒæ­¥ç¦»çº¿è®¢å•...")<span class="hljs-comment">;</span>
                try {
                    syncPendingOrders()<span class="hljs-comment">;</span>
                } catch (Exception e) {
                    System.err.println("è®¢å•åŒæ­¥å¼‚å¸¸ï¼š" + e.getMessage())<span class="hljs-comment">;</span>
                }
            }
        }, 0, 3, TimeUnit.SECONDS)<span class="hljs-comment">;</span>
    }

    /**
     * åŒæ­¥æœ¬åœ°å¾…åŒæ­¥è®¢å•ï¼ˆæ‰¹é‡+æ–­ç‚¹ç»­ä¼ ï¼‰
     */
    private void syncPendingOrders() throws SQLException {
        // 1. è·å–ä¸Šä¸€æ¬¡åŒæ­¥æˆåŠŸçš„è®¢å•IDï¼ˆæ–­ç‚¹ç»­ä¼ èµ·ç‚¹ï¼‰
        String <span class="hljs-attr">lastSyncOrderId</span> = getLastSyncOrderId()<span class="hljs-comment">;</span>

        // 2. æŸ¥è¯¢å¾…åŒæ­¥è®¢å•ï¼ˆæŒ‰create_timeå‡åºï¼Œä¿è¯é¡ºåºï¼‰
        String <span class="hljs-attr">querySql</span> = <span class="hljs-string">"""
            SELECT * FROM device_order
            WHERE (sync_status = 'PENDING' OR (sync_status = 'FAILED' AND sync_retry_count &lt; ?))
              AND order_id &gt; ?
            ORDER BY create_time ASC
            LIMIT ?
        """</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(querySql)) {
            pstmt.setInt(1, MAX_RETRY_COUNT)<span class="hljs-comment">;</span>
            pstmt.setString(2, lastSyncOrderId)<span class="hljs-comment">;</span>
            pstmt.setInt(3, BATCH_SIZE)<span class="hljs-comment">;</span>
            ResultSet <span class="hljs-attr">rs</span> = pstmt.executeQuery()<span class="hljs-comment">;</span>

            List&lt;DeviceOrderDTO&gt; <span class="hljs-attr">syncOrders</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
            while (rs.next()) {
                DeviceOrderDTO <span class="hljs-attr">order</span> = new DeviceOrderDTO()<span class="hljs-comment">;</span>
                order.setOrderId(rs.getString("order_id"))<span class="hljs-comment">;</span>
                order.setDeviceId(rs.getString("device_id"))<span class="hljs-comment">;</span>
                order.setUserId(rs.getString("user_id"))<span class="hljs-comment">;</span>
                order.setProductId(rs.getString("product_id"))<span class="hljs-comment">;</span>
                order.setQuantity(rs.getInt("quantity"))<span class="hljs-comment">;</span>
                order.setAmount(rs.getBigDecimal("amount"))<span class="hljs-comment">;</span>
                order.setCreateTime(LocalDateTime.parse(rs.getString("create_time")))<span class="hljs-comment">;</span>
                syncOrders.add(order)<span class="hljs-comment">;</span>
            }

            if (syncOrders.isEmpty()) {
                System.out.println("æ— å¾…åŒæ­¥è®¢å•")<span class="hljs-comment">;</span>
                return<span class="hljs-comment">;</span>
            }

            // 3. æ ‡è®°è®¢å•ä¸ºã€ŒåŒæ­¥ä¸­ã€ï¼ˆé¿å…é‡å¤åŒæ­¥ï¼‰
            markOrdersSyncing(syncOrders.stream().map(DeviceOrderDTO::getOrderId).collect(Collectors.toList()))<span class="hljs-comment">;</span>

            // 4. æ‰¹é‡åŒæ­¥åˆ°äº‘ç«¯
            Result&lt;BatchSyncResponse&gt; <span class="hljs-attr">syncResult</span> = batchSyncToCloud(syncOrders)<span class="hljs-comment">;</span>

            // 5. å¤„ç†åŒæ­¥ç»“æœ
            handleSyncResult(syncResult, syncOrders)<span class="hljs-comment">;</span>
        }
    }

    /**
     * æ‰¹é‡åŒæ­¥åˆ°äº‘ç«¯
     */
    private Result&lt;BatchSyncResponse&gt; batchSyncToCloud(List&lt;DeviceOrderDTO&gt; orders) {
        try {
            RestTemplate <span class="hljs-attr">restTemplate</span> = new RestTemplate()<span class="hljs-comment">;</span>
            HttpHeaders <span class="hljs-attr">headers</span> = new HttpHeaders()<span class="hljs-comment">;</span>
            headers.setContentType(MediaType.APPLICATION_JSON)<span class="hljs-comment">;</span>
            HttpEntity&lt;List&lt;DeviceOrderDTO&gt;&gt; <span class="hljs-attr">request</span> = new HttpEntity&lt;&gt;(orders, headers)<span class="hljs-comment">;</span>

            ResponseEntity&lt;Result&lt;BatchSyncResponse&gt;&gt; <span class="hljs-attr">response</span> = restTemplate.exchange(
                syncUrl, HttpMethod.POST, request, new ParameterizedTypeReference&lt;Result&lt;BatchSyncResponse&gt;&gt;() {}
            )<span class="hljs-comment">;</span>

            if (response.getStatusCode().is2xxSuccessful() &amp;&amp; response.getBody() != null &amp;&amp; response.getBody().isSuccess()) {
                return response.getBody()<span class="hljs-comment">;</span>
            } else {
                return Result.error("äº‘ç«¯è¿”å›å¤±è´¥ï¼š" + (response.getBody() != null ? response.getBody().getMessage() : "æœªçŸ¥é”™è¯¯"))<span class="hljs-comment">;</span>
            }
        } catch (Exception e) {
            return Result.error("åŒæ­¥è¯·æ±‚å‘é€å¤±è´¥ï¼š" + e.getMessage())<span class="hljs-comment">;</span>
        }
    }

    /**
     * å¤„ç†åŒæ­¥ç»“æœï¼ˆæ›´æ–°æœ¬åœ°è®¢å•çŠ¶æ€ï¼‰
     */
    private void handleSyncResult(Result&lt;BatchSyncResponse&gt; syncResult, List&lt;DeviceOrderDTO&gt; orders) throws SQLException {
        sqliteConn.setAutoCommit(false)<span class="hljs-comment">;</span>
        try {
            if (syncResult.isSuccess()) {
                BatchSyncResponse <span class="hljs-attr">response</span> = syncResult.getData()<span class="hljs-comment">;</span>
                // å¤„ç†åŒæ­¥æˆåŠŸçš„è®¢å•
                for (String successOrderId : response.getSuccessOrderIds()) {
                    updateOrderSyncStatus(successOrderId, "SUCCESS", null)<span class="hljs-comment">;</span>
                }
                // å¤„ç†åŒæ­¥å¤±è´¥çš„è®¢å•
                for (FailedOrder failedOrder : response.getFailedOrders()) {
                    String <span class="hljs-attr">orderId</span> = failedOrder.getOrderId()<span class="hljs-comment">;</span>
                    int <span class="hljs-attr">retryCount</span> = getCurrentRetryCount(orderId) + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
                    String <span class="hljs-attr">status</span> = retryCount &gt;= MAX_RETRY_COUNT ? <span class="hljs-string">"EXCEPTION"</span> : <span class="hljs-string">"FAILED"</span><span class="hljs-comment">;</span>
                    updateOrderSyncStatus(orderId, status, failedOrder.getReason(), retryCount)<span class="hljs-comment">;</span>
                }
                // æ›´æ–°æœ€åä¸€æ¬¡åŒæ­¥æˆåŠŸçš„è®¢å•IDï¼ˆæ–­ç‚¹ç»­ä¼ ç”¨ï¼‰
                updateLastSyncOrderId(response.getLastSuccessOrderId())<span class="hljs-comment">;</span>
                System.out.println("æ‰¹é‡åŒæ­¥å®Œæˆï¼šæˆåŠŸ" + response.getSuccessOrderIds().size() + "æ¡ï¼Œå¤±è´¥" + response.getFailedOrders().size() + "æ¡")<span class="hljs-comment">;</span>
            } else {
                // æ•´ä½“åŒæ­¥å¤±è´¥ï¼Œæ‰€æœ‰è®¢å•æ ‡è®°ä¸ºFAILED+é‡è¯•æ¬¡æ•°+å¤±è´¥åŸå› 
                for (DeviceOrderDTO order : orders) {
                    int <span class="hljs-attr">retryCount</span> = getCurrentRetryCount(order.getOrderId()) + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
                    String <span class="hljs-attr">status</span> = retryCount &gt;= MAX_RETRY_COUNT ? <span class="hljs-string">"EXCEPTION"</span> : <span class="hljs-string">"FAILED"</span><span class="hljs-comment">;</span>
                    updateOrderSyncStatus(order.getOrderId(), status, syncResult.getMessage(), retryCount)<span class="hljs-comment">;</span>
                }
                System.err.println("æ‰¹é‡åŒæ­¥å¤±è´¥ï¼š" + syncResult.getMessage())<span class="hljs-comment">;</span>
            }
            sqliteConn.commit()<span class="hljs-comment">;</span>
        } catch (SQLException e) {
            sqliteConn.rollback()<span class="hljs-comment">;</span>
            throw e<span class="hljs-comment">;</span>
        }
    }

    // ---------------------- è¾…åŠ©æ–¹æ³• ----------------------
    /**
     * è·å–ä¸Šä¸€æ¬¡åŒæ­¥æˆåŠŸçš„è®¢å•ID
     */
    private String getLastSyncOrderId() throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"SELECT last_sync_order_id FROM device_order LIMIT 1"</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            ResultSet <span class="hljs-attr">rs</span> = pstmt.executeQuery()<span class="hljs-comment">;</span>
            return rs.next() &amp;&amp; rs.getString("last_sync_order_id") != null ? rs.getString("last_sync_order_id") : ""<span class="hljs-comment">;</span>
        }
    }

    /**
     * æ ‡è®°è®¢å•ä¸ºã€ŒåŒæ­¥ä¸­ã€
     */
    private void markOrdersSyncing(List&lt;String&gt; orderIds) throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"UPDATE device_order SET sync_status = 'ING', last_sync_time = ? WHERE order_id = ?"</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            String <span class="hljs-attr">timeStr</span> = LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME)<span class="hljs-comment">;</span>
            for (String orderId : orderIds) {
                pstmt.setString(1, timeStr)<span class="hljs-comment">;</span>
                pstmt.setString(2, orderId)<span class="hljs-comment">;</span>
                pstmt.addBatch()<span class="hljs-comment">;</span>
            }
            pstmt.executeBatch()<span class="hljs-comment">;</span>
        }
    }

    /**
     * æ›´æ–°è®¢å•åŒæ­¥çŠ¶æ€
     */
    private void updateOrderSyncStatus(String orderId, String status, String failReason) throws SQLException {
        updateOrderSyncStatus(orderId, status, failReason, getCurrentRetryCount(orderId))<span class="hljs-comment">;</span>
    }

    private void updateOrderSyncStatus(String orderId, String status, String failReason, int retryCount) throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"""
            UPDATE device_order
            SET sync_status = ?,
                sync_retry_count = ?,
                sync_fail_reason = ?,
                last_sync_time = ?,
                update_time = ?
            WHERE order_id = ?
        """</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            String <span class="hljs-attr">timeStr</span> = LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME)<span class="hljs-comment">;</span>
            pstmt.setString(1, status)<span class="hljs-comment">;</span>
            pstmt.setInt(2, retryCount)<span class="hljs-comment">;</span>
            pstmt.setString(3, failReason)<span class="hljs-comment">;</span>
            pstmt.setString(4, timeStr)<span class="hljs-comment">;</span>
            pstmt.setString(5, timeStr)<span class="hljs-comment">;</span>
            pstmt.setString(6, orderId)<span class="hljs-comment">;</span>
            pstmt.executeUpdate()<span class="hljs-comment">;</span>
        }
    }

    /**
     * è·å–å½“å‰è®¢å•é‡è¯•æ¬¡æ•°
     */
    private int getCurrentRetryCount(String orderId) throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"SELECT sync_retry_count FROM device_order WHERE order_id = ?"</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            pstmt.setString(1, orderId)<span class="hljs-comment">;</span>
            ResultSet <span class="hljs-attr">rs</span> = pstmt.executeQuery()<span class="hljs-comment">;</span>
            return rs.next() ? rs.getInt("sync_retry_count") : 0<span class="hljs-comment">;</span>
        }
    }

    /**
     * æ›´æ–°æœ€åä¸€æ¬¡åŒæ­¥æˆåŠŸçš„è®¢å•ID
     */
    private void updateLastSyncOrderId(String lastSuccessOrderId) throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"UPDATE device_order SET last_sync_order_id = ? WHERE order_id = (SELECT MAX(order_id) FROM device_order)"</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            pstmt.setString(1, lastSuccessOrderId)<span class="hljs-comment">;</span>
            pstmt.executeUpdate()<span class="hljs-comment">;</span>
        }
    }
}

// åŒæ­¥ç›¸å…³DTO
@Data
public class DeviceOrderDTO {
    private String orderId<span class="hljs-comment">;</span>
    private String deviceId<span class="hljs-comment">;</span>
    private String userId<span class="hljs-comment">;</span>
    private String productId<span class="hljs-comment">;</span>
    private Integer quantity<span class="hljs-comment">;</span>
    private BigDecimal amount<span class="hljs-comment">;</span>
    private LocalDateTime createTime<span class="hljs-comment">;</span>
}

@Data
public class BatchSyncResponse {
    private List&lt;String&gt; successOrderIds<span class="hljs-comment">; // åŒæ­¥æˆåŠŸçš„è®¢å•ID</span>
    private List&lt;FailedOrder&gt; failedOrders<span class="hljs-comment">; // åŒæ­¥å¤±è´¥çš„è®¢å•ï¼ˆå«åŸå› ï¼‰</span>
    private String lastSuccessOrderId<span class="hljs-comment">; // æœ€åä¸€æ¬¡åŒæ­¥æˆåŠŸçš„è®¢å•IDï¼ˆæ–­ç‚¹ç»­ä¼ ç”¨ï¼‰</span>
}

@Data
public class FailedOrder {
    private String orderId<span class="hljs-comment">;</span>
    private String reason<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-12">ç¬¬äºŒéƒ¨åˆ†ï¼šäº‘ç«¯æ ¸å¿ƒä»£ç ï¼ˆæ¥æ”¶åŒæ­¥+æ ¡éªŒ+å¤„ç†ï¼‰</h3>
<h4 data-id="heading-13">1. äº‘ç«¯ä¾èµ–é…ç½®ï¼ˆpom.xmlï¼‰</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Bootæ ¸å¿ƒ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQï¼‰ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Redisï¼ˆå»é‡+åˆ†å¸ƒå¼é”ï¼‰ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- æ•°æ®åº“ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- å·¥å…·ç±» --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.32<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-lang3<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.12.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h4 data-id="heading-14">2. äº‘ç«¯é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-comment"># æ•°æ®åº“é…ç½®</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/cloud_order_db?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>

  <span class="hljs-comment"># Redisé…ç½®ï¼ˆå»é‡+åˆ†å¸ƒå¼é”ï¼‰</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-string">3000ms</span>

  <span class="hljs-comment"># RabbitMQé…ç½®ï¼ˆä¿è¯æ¶ˆæ¯æœ‰åº+æŒä¹…åŒ–ï¼‰</span>
  <span class="hljs-attr">rabbitmq:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span>
    <span class="hljs-attr">publisher-confirm-type:</span> <span class="hljs-string">correlated</span>
    <span class="hljs-attr">publisher-returns:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">listener:</span>
      <span class="hljs-attr">simple:</span>
        <span class="hljs-attr">acknowledge-mode:</span> <span class="hljs-string">manual</span> <span class="hljs-comment"># æ‰‹åŠ¨ACK</span>
        <span class="hljs-attr">concurrency:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># å•çº¿ç¨‹æ¶ˆè´¹ï¼ˆä¿è¯é¡ºåºï¼‰</span>
        <span class="hljs-attr">max-concurrency:</span> <span class="hljs-number">1</span>
        <span class="hljs-attr">prefetch:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># æ¯æ¬¡æ‹‰å–1æ¡æ¶ˆæ¯</span>

<span class="hljs-comment"># åº”ç”¨é…ç½®</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
  <span class="hljs-attr">servlet:</span>
    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/</span>

<span class="hljs-comment"># MyBatisé…ç½®</span>
<span class="hljs-attr">mybatis:</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span>
  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.cloud.order.entity</span>
</code></pre>
<h4 data-id="heading-15">3. äº‘ç«¯æ ¸å¿ƒé…ç½®ï¼ˆRabbitMQ+Redisï¼‰</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * RabbitMQé…ç½®ï¼ˆå•é˜Ÿåˆ—+æ­»ä¿¡é˜Ÿåˆ—ï¼Œä¿è¯æœ‰åº+å¯é ï¼‰
 */</span>
@Configuration
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RabbitMQConfig</span> {
    <span class="hljs-comment">// è®¢å•åŒæ­¥é˜Ÿåˆ—ï¼ˆå•é˜Ÿåˆ—ï¼Œä¿è¯FIFOï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> ORDER_SYNC_QUEUE = <span class="hljs-string">"queue.order.sync"</span>;
    <span class="hljs-comment">// æ­»ä¿¡é˜Ÿåˆ—ï¼ˆå¤„ç†å¤±è´¥çš„è®¢å•ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> ORDER_SYNC_DLQ = <span class="hljs-string">"queue.order.sync.dlq"</span>;

    <span class="hljs-comment">// åŒæ­¥é˜Ÿåˆ—ï¼ˆæŒä¹…åŒ–+ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—ï¼‰</span>
    @<span class="hljs-function">Bean
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title">orderSyncQueue</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> QueueBuilder.<span class="hljs-built_in">durable</span>(ORDER_SYNC_QUEUE)
                .<span class="hljs-built_in">withArgument</span>(<span class="hljs-string">"x-dead-letter-exchange"</span>, <span class="hljs-string">""</span>)
                .<span class="hljs-built_in">withArgument</span>(<span class="hljs-string">"x-dead-letter-routing-key"</span>, ORDER_SYNC_DLQ)
                .<span class="hljs-built_in">withArgument</span>(<span class="hljs-string">"x-message-ttl"</span>, <span class="hljs-number">60000</span>) <span class="hljs-comment">// 1åˆ†é’Ÿæœªå¤„ç†å…¥æ­»ä¿¡é˜Ÿåˆ—</span>
                .<span class="hljs-built_in">build</span>();
    }

    <span class="hljs-comment">// æ­»ä¿¡é˜Ÿåˆ—</span>
    @<span class="hljs-function">Bean
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title">orderSyncDlq</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> QueueBuilder.<span class="hljs-built_in">durable</span>(ORDER_SYNC_DLQ).<span class="hljs-built_in">build</span>();
    }
}

<span class="hljs-comment">/**
 * Redisé…ç½®ï¼ˆåºåˆ—åŒ–+è¿æ¥æ± ï¼‰
 */</span>
@Configuration
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> {
    @<span class="hljs-function">Bean
    <span class="hljs-keyword">public</span> RedisTemplate&lt;<span class="hljs-type">String</span>, Object&gt; <span class="hljs-title">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory factory)</span> </span>{
        RedisTemplate&lt;<span class="hljs-type">String</span>, Object&gt; <span class="hljs-keyword">template</span> = <span class="hljs-keyword">new</span> RedisTemplate&lt;&gt;();
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setConnectionFactory</span>(factory);

        <span class="hljs-comment">// Keyåºåˆ—åŒ–ï¼ˆStringï¼‰</span>
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setKeySerializer</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">StringRedisSerializer</span>());
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setHashKeySerializer</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">StringRedisSerializer</span>());

        <span class="hljs-comment">// Valueåºåˆ—åŒ–ï¼ˆJSONï¼‰</span>
        GenericJackson2JsonRedisSerializer jsonSerializer = <span class="hljs-keyword">new</span> <span class="hljs-built_in">GenericJackson2JsonRedisSerializer</span>();
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setValueSerializer</span>(jsonSerializer);
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setHashValueSerializer</span>(jsonSerializer);

        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">afterPropertiesSet</span>();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">template</span>;
    }
}
</code></pre>
<h4 data-id="heading-16">4. äº‘ç«¯åŒæ­¥æ¥æ”¶æ¥å£ï¼ˆæ‰¹é‡+å»é‡ï¼‰</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">/**
 * äº‘ç«¯è®¢å•æ‰¹é‡åŒæ­¥æ¥å£ï¼ˆè®¾å¤‡ç«¯è°ƒç”¨ï¼‰
 */</span>
<span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/api/order/sync"</span>)
<span class="hljs-variable">@RequiredArgsConstructor</span>
public class OrderSyncController {
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">RabbitTemplate</span> <span class="hljs-selector-tag">rabbitTemplate</span>;
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">OrderIdempotentService</span> <span class="hljs-selector-tag">idempotentService</span>;

    <span class="hljs-comment">/**
     * æ‰¹é‡åŒæ­¥ç¦»çº¿è®¢å•
     */</span>
    @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/batch"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Result</span>&lt;<span class="hljs-selector-tag">BatchSyncResponse</span>&gt; <span class="hljs-selector-tag">batchSync</span>(<span class="hljs-variable">@RequestBody</span> <span class="hljs-variable">@Valid</span> List&lt;DeviceOrderDTO&gt; orders) {
        <span class="hljs-selector-tag">if</span> (orders.<span class="hljs-built_in">isEmpty</span>()) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"åŒæ­¥è®¢å•ä¸èƒ½ä¸ºç©º"</span>);
        }

        <span class="hljs-selector-tag">BatchSyncResponse</span> <span class="hljs-selector-tag">response</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">BatchSyncResponse</span>();
        <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">String</span>&gt; <span class="hljs-selector-tag">successOrderIds</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">ArrayList</span>&lt;&gt;();
        <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">FailedOrder</span>&gt; <span class="hljs-selector-tag">failedOrders</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// 1. é€å•å»é‡æ ¡éªŒï¼ˆé¿å…é‡å¤åŒæ­¥ï¼‰</span>
        <span class="hljs-selector-tag">for</span> (DeviceOrderDTO <span class="hljs-attribute">order </span>: orders) {
            <span class="hljs-selector-tag">if</span> (idempotentService.<span class="hljs-built_in">isOrderSynced</span>(order.<span class="hljs-built_in">getOrderId</span>())) {
                <span class="hljs-comment">// å·²åŒæ­¥è¿‡ï¼Œç›´æ¥æ ‡è®°æˆåŠŸ</span>
                <span class="hljs-selector-tag">successOrderIds</span><span class="hljs-selector-class">.add</span>(order.<span class="hljs-built_in">getOrderId</span>());
                <span class="hljs-selector-tag">continue</span>;
            }
            <span class="hljs-comment">// æœªåŒæ­¥ï¼Œå‘é€åˆ°RabbitMQï¼ˆå•é˜Ÿåˆ—ä¿è¯æœ‰åºï¼‰</span>
            <span class="hljs-selector-tag">try</span> {
                <span class="hljs-selector-tag">rabbitTemplate</span><span class="hljs-selector-class">.convertAndSend</span>(
                    RabbitMQConfig.ORDER_SYNC_QUEUE,
                    MessageBuilder.<span class="hljs-built_in">withBody</span>(JSON.<span class="hljs-built_in">toJSONBytes</span>(order))
                        .<span class="hljs-built_in">setDeliveryMode</span>(MessageDeliveryMode.PERSISTENT) <span class="hljs-comment">// æ¶ˆæ¯æŒä¹…åŒ–</span>
                        .<span class="hljs-built_in">setHeader</span>(<span class="hljs-string">"orderId"</span>, order.<span class="hljs-built_in">getOrderId</span>())
                        .<span class="hljs-built_in">build</span>()
                );
                <span class="hljs-selector-tag">successOrderIds</span><span class="hljs-selector-class">.add</span>(order.<span class="hljs-built_in">getOrderId</span>());
            } <span class="hljs-selector-tag">catch</span> (Exception e) {
                <span class="hljs-selector-tag">failedOrders</span><span class="hljs-selector-class">.add</span>(new <span class="hljs-built_in">FailedOrder</span>(order.<span class="hljs-built_in">getOrderId</span>(), <span class="hljs-string">"æ¶ˆæ¯å‘é€å¤±è´¥ï¼š"</span> + e.<span class="hljs-built_in">getMessage</span>()));
            }
        }

        <span class="hljs-comment">// 2. æ„å»ºå“åº”ï¼ˆæœ€åæˆåŠŸçš„è®¢å•IDå–æˆåŠŸåˆ—è¡¨çš„æœ€åä¸€ä¸ªï¼‰</span>
        <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">lastSuccessOrderId</span> = <span class="hljs-selector-tag">successOrderIds</span><span class="hljs-selector-class">.isEmpty</span>() ? "" : <span class="hljs-selector-tag">successOrderIds</span><span class="hljs-selector-class">.get</span>(successOrderIds.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>);
        <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.setSuccessOrderIds</span>(successOrderIds);
        <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.setFailedOrders</span>(failedOrders);
        <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.setLastSuccessOrderId</span>(lastSuccessOrderId);

        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.success</span>(response, <span class="hljs-string">"åŒæ­¥è¯·æ±‚å·²æ¥æ”¶ï¼Œäº‘ç«¯æ­£åœ¨å¤„ç†"</span>);
    }

    <span class="hljs-comment">/**
     * æä¾›äº‘ç«¯æ—¶é—´æ¥å£ï¼ˆè®¾å¤‡ç«¯æ—¶é—´æ ¡å‡†ç”¨ï¼‰
     */</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/common/cloud-time"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">getCloudTime</span>() {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">LocalDateTime</span><span class="hljs-selector-class">.now</span>()<span class="hljs-selector-class">.format</span>(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
    }
}

<span class="hljs-comment">/**
 * è®¢å•å¹‚ç­‰æœåŠ¡ï¼ˆRediså»é‡ï¼‰
 */</span>
@<span class="hljs-selector-tag">Service</span>
@<span class="hljs-selector-tag">RequiredArgsConstructor</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">OrderIdempotentService</span> {
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">RedisTemplate</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">redisTemplate</span>;
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">ORDER_SYNC_KEY</span> = "<span class="hljs-selector-tag">order</span>:<span class="hljs-selector-tag">sync</span>:<span class="hljs-selector-tag">processed</span>:";
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">EXPIRE_TIME</span> = <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span>; <span class="hljs-comment">// 24å°æ—¶è¿‡æœŸ</span>

    <span class="hljs-comment">/**
     * æ ¡éªŒè®¢å•æ˜¯å¦å·²åŒæ­¥
     */</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">isOrderSynced</span>(String orderId) {
        <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">key</span> = <span class="hljs-selector-tag">ORDER_SYNC_KEY</span> + <span class="hljs-selector-tag">orderId</span>;
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Boolean</span><span class="hljs-selector-class">.TRUE</span><span class="hljs-selector-class">.equals</span>(redisTemplate.<span class="hljs-built_in">hasKey</span>(key));
    }

    <span class="hljs-comment">/**
     * æ ‡è®°è®¢å•å·²åŒæ­¥
     */</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">markOrderSynced</span>(String orderId) {
        <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">key</span> = <span class="hljs-selector-tag">ORDER_SYNC_KEY</span> + <span class="hljs-selector-tag">orderId</span>;
        <span class="hljs-selector-tag">redisTemplate</span><span class="hljs-selector-class">.opsForValue</span>()<span class="hljs-selector-class">.set</span>(key, <span class="hljs-string">"1"</span>, EXPIRE_TIME, TimeUnit.SECONDS);
    }
}
</code></pre>
<h4 data-id="heading-17">5. äº‘ç«¯è®¢å•å¤„ç†æ¶ˆè´¹è€…ï¼ˆæœ‰åº+å†²çªå¤„ç†ï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è®¢å•åŒæ­¥æ¶ˆè´¹è€…ï¼ˆå•çº¿ç¨‹+åˆ†å¸ƒå¼é”+å†²çªå¤„ç†ï¼‰
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderSyncConsumer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderService orderService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderIdempotentService idempotentService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StringRedisTemplate stringRedisTemplate;

    <span class="hljs-comment">// åˆ†å¸ƒå¼é”å‰ç¼€ï¼ˆé˜²æ­¢å¹¶å‘å¤„ç†åŒä¸€å•†å“/è®¢å•ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_KEY_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"lock:order:sync:"</span>;

    <span class="hljs-meta">@RabbitListener(queues = RabbitMQConfig.ORDER_SYNC_QUEUE, concurrency = "1")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processSyncOrder</span><span class="hljs-params">(Message message, Channel channel)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">long</span> <span class="hljs-variable">deliveryTag</span> <span class="hljs-operator">=</span> message.getMessageProperties().getDeliveryTag();
        <span class="hljs-type">String</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> (String) message.getMessageProperties().getHeader(<span class="hljs-string">"orderId"</span>);
        <span class="hljs-type">DeviceOrderDTO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> JSON.parseObject(message.getBody(), DeviceOrderDTO.class);

        <span class="hljs-comment">// åˆ†å¸ƒå¼é”ï¼šé”å®šå•†å“IDï¼ˆé˜²æ­¢å¤šè®¾å¤‡åŒæ—¶æ‰£å‡åŒä¸€å•†å“åº“å­˜ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> LOCK_KEY_PREFIX + order.getProductId();
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">locked</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(lockKey, <span class="hljs-string">"1"</span>, <span class="hljs-number">5</span>, TimeUnit.SECONDS);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (Boolean.FALSE.equals(locked)) {
                <span class="hljs-comment">// æœªè·å–åˆ°é”ï¼Œé‡å›é˜Ÿåˆ—</span>
                channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// 1. å†æ¬¡å»é‡æ ¡éªŒï¼ˆé˜²æ­¢Redisç¼“å­˜å¤±æ•ˆï¼‰</span>
            <span class="hljs-keyword">if</span> (idempotentService.isOrderSynced(orderId)) {
                channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// 2. ä¸šåŠ¡å¤„ç†ï¼šæ ¡éªŒå•†å“+æ‰£å‡åº“å­˜+åˆ›å»ºè®¢å•ï¼ˆå«å†²çªå¤„ç†ï¼‰</span>
            orderService.processOfflineOrder(order);

            <span class="hljs-comment">// 3. æ ‡è®°è®¢å•å·²åŒæ­¥</span>
            idempotentService.markOrderSynced(orderId);

            <span class="hljs-comment">// 4. æ‰‹åŠ¨ACKï¼ˆç¡®è®¤å¤„ç†æˆåŠŸï¼‰</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
            System.out.println(<span class="hljs-string">"è®¢å•["</span> + orderId + <span class="hljs-string">"]åŒæ­¥å¤„ç†æˆåŠŸ"</span>);
        } <span class="hljs-keyword">catch</span> (BusinessException e) {
            <span class="hljs-comment">// ä¸šåŠ¡å¼‚å¸¸ï¼ˆå¦‚åº“å­˜ä¸è¶³ã€å•†å“ä¸‹æ¶ï¼‰ï¼Œç›´æ¥æ‹’ç»ï¼Œä¸å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼ˆè®¾å¤‡ç«¯ä¼šé‡è¯•ï¼‰</span>
            System.err.println(<span class="hljs-string">"è®¢å•["</span> + orderId + <span class="hljs-string">"]åŒæ­¥å¤±è´¥ï¼š"</span> + e.getMessage());
            channel.basicReject(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// ç³»ç»Ÿå¼‚å¸¸ï¼Œé‡è¯•3æ¬¡åå…¥æ­»ä¿¡é˜Ÿåˆ—</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> message.getMessageProperties().getHeader(<span class="hljs-string">"x-retry-count"</span>) == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : (<span class="hljs-type">int</span>) message.getMessageProperties().getHeader(<span class="hljs-string">"x-retry-count"</span>);
            <span class="hljs-keyword">if</span> (retryCount &lt; <span class="hljs-number">3</span>) {
                message.getMessageProperties().setHeader(<span class="hljs-string">"x-retry-count"</span>, retryCount + <span class="hljs-number">1</span>);
                channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
            } <span class="hljs-keyword">else</span> {
                channel.basicReject(deliveryTag, <span class="hljs-literal">false</span>);
                System.err.println(<span class="hljs-string">"è®¢å•["</span> + orderId + <span class="hljs-string">"]é‡è¯•3æ¬¡å¤±è´¥ï¼Œå…¥æ­»ä¿¡é˜Ÿåˆ—ï¼š"</span> + e.getMessage());
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// é‡Šæ”¾åˆ†å¸ƒå¼é”</span>
            <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(locked)) {
                stringRedisTemplate.delete(lockKey);
            }
        }
    }
}

<span class="hljs-comment">/**
 * äº‘ç«¯è®¢å•ä¸šåŠ¡æœåŠ¡ï¼ˆå†²çªå¤„ç†æ ¸å¿ƒï¼‰
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderMapper orderMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ProductStockMapper stockMapper;

    <span class="hljs-comment">/**
     * å¤„ç†ç¦»çº¿åŒæ­¥è®¢å•ï¼ˆå«å•†å“æ ¡éªŒ+åº“å­˜æ‰£å‡+è®¢å•åˆ›å»ºï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOfflineOrder</span><span class="hljs-params">(DeviceOrderDTO dto)</span> {
        <span class="hljs-comment">// 1. æ ¡éªŒå•†å“æ˜¯å¦å­˜åœ¨ä¸”ä¸Šæ¶</span>
        <span class="hljs-type">ProductStockPO</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> stockMapper.selectByProductId(dto.getProductId());
        <span class="hljs-keyword">if</span> (stock == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"å•†å“ä¸å­˜åœ¨"</span>);
        }
        <span class="hljs-keyword">if</span> (stock.getStatus() != <span class="hljs-number">1</span>) { <span class="hljs-comment">// 1=ä¸Šæ¶ï¼Œ0=ä¸‹æ¶</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"å•†å“å·²ä¸‹æ¶"</span>);
        }

        <span class="hljs-comment">// 2. æ ¡éªŒäº‘ç«¯åº“å­˜æ˜¯å¦å……è¶³</span>
        <span class="hljs-keyword">if</span> (stock.getAvailableStock() &lt; dto.getQuantity()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"äº‘ç«¯åº“å­˜ä¸è¶³ï¼Œå½“å‰å¯ç”¨åº“å­˜ï¼š"</span> + stock.getAvailableStock());
        }

        <span class="hljs-comment">// 3. ä¹è§‚é”æ‰£å‡åº“å­˜ï¼ˆé˜²æ­¢å¹¶å‘å†²çªï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> stockMapper.deductStock(
            dto.getProductId(), dto.getQuantity(), stock.getVersion()
        );
        <span class="hljs-keyword">if</span> (rows == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"åº“å­˜æ‰£å‡å¤±è´¥ï¼Œå¯èƒ½å·²è¢«å…¶ä»–è®¢å•å ç”¨"</span>);
        }

        <span class="hljs-comment">// 4. åˆ›å»ºäº‘ç«¯è®¢å•</span>
        <span class="hljs-type">OrderPO</span> <span class="hljs-variable">orderPO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderPO</span>();
        orderPO.setOrderId(dto.getOrderId());
        orderPO.setDeviceId(dto.getDeviceId());
        orderPO.setUserId(dto.getUserId());
        orderPO.setProductId(dto.getProductId());
        orderPO.setQuantity(dto.getQuantity());
        orderPO.setAmount(dto.getAmount());
        orderPO.setOrderStatus(<span class="hljs-string">"PENDING_PAY"</span>); <span class="hljs-comment">// å¾…æ”¯ä»˜</span>
        orderPO.setDeviceCreateTime(dto.getCreateTime());
        orderPO.setCloudCreateTime(LocalDateTime.now());
        orderPO.setSyncStatus(<span class="hljs-string">"SUCCESS"</span>);

        orderMapper.insert(orderPO);
    }
}
</code></pre>
<h4 data-id="heading-18">6. äº‘ç«¯Mapper.xmlï¼ˆåº“å­˜æ‰£å‡+è®¢å•åˆ›å»ºï¼‰</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ProductStockMapper.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.cloud.order.mapper.ProductStockMapper"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectByProductId"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.cloud.order.entity.ProductStockPO"</span>&gt;</span>
        SELECT * FROM product_stock WHERE product_id = #{productId}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"deductStock"</span>&gt;</span>
        UPDATE product_stock
        SET available_stock = available_stock - #{quantity},
            version = version + 1,
            update_time = NOW()
        WHERE product_id = #{productId}
          AND available_stock &gt;= #{quantity}
          AND version = #{version}
    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>

<span class="hljs-comment">&lt;!-- OrderMapper.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.cloud.order.mapper.OrderMapper"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"insert"</span>&gt;</span>
        INSERT INTO cloud_order (
            order_id, device_id, user_id, product_id, quantity, amount,
            order_status, device_create_time, cloud_create_time, sync_status
        ) VALUES (
            #{orderId}, #{deviceId}, #{userId}, #{productId}, #{quantity}, #{amount},
            #{orderStatus}, #{deviceCreateTime}, #{cloudCreateTime}, #{syncStatus}
        )
    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>
<h2 data-id="heading-19">å››ã€å…³é”®é—®é¢˜è§£å†³æ–¹æ¡ˆå¯¹ç…§è¡¨ï¼ˆéªŒè¯æ–¹æ¡ˆæœ‰æ•ˆæ€§ï¼‰</h2>

















































<table><thead><tr><th>ç¦»çº¿åŒæ­¥é—®é¢˜</th><th>è§£å†³æ–¹æ¡ˆå…·ä½“ä½“ç°</th></tr></thead><tbody><tr><td>1. ç¦»çº¿è®¢å•æœ¬åœ°ä¸¢å¤±</td><td>SQLiteäº‹åŠ¡+è®¢å•å¤‡ä»½è¡¨+æœ¬åœ°çŠ¶æ€è®°å½•ï¼Œè®¾å¤‡æ•…éšœåå¯ä»å¤‡ä»½è¡¨æ¢å¤ã€‚</td></tr><tr><td>2. åŒæ­¥æ—¶ç½‘ç»œå†æ¬¡ä¸­æ–­</td><td>æ–­ç‚¹ç»­ä¼ ï¼ˆè®°å½•last_sync_order_idï¼‰+ æ‰¹é‡åŒæ­¥ï¼Œä¸‹æ¬¡ä»æ–­ç‚¹ç»§ç»­åŒæ­¥ï¼Œä¸é‡å¤åŒæ­¥å·²æˆåŠŸè®¢å•ã€‚</td></tr><tr><td>3. å¤šè®¢å•åŒæ­¥é¡ºåºé”™ä¹±</td><td>è®¾å¤‡ç«¯æŒ‰create_timeå‡åºåŒæ­¥+RabbitMQå•é˜Ÿåˆ—+äº‘ç«¯å•çº¿ç¨‹æ¶ˆè´¹ï¼Œä¿è¯FIFOã€‚</td></tr><tr><td>4. åŒæ­¥ä¸äº‘ç«¯å†²çª</td><td>äº‘ç«¯æ ¡éªŒå•†å“çŠ¶æ€+ä¹è§‚é”æ‰£å‡åº“å­˜+è®¢å•çŠ¶æ€æœºï¼Œå†²çªæ—¶æŠ›å‡ºæ˜ç¡®å¼‚å¸¸ï¼Œè®¾å¤‡ç«¯æ ‡è®°å¤±è´¥ã€‚</td></tr><tr><td>5. è®¢å•é‡å¤åŒæ­¥</td><td>å…¨å±€å”¯ä¸€è®¢å•ID+Rediså»é‡+æ•°æ®åº“å”¯ä¸€ç´¢å¼•ï¼Œé‡å¤è®¢å•ç›´æ¥è·³è¿‡å¤„ç†ã€‚</td></tr><tr><td>6. åŒæ­¥å¤±è´¥æ— é‡è¯•æœºåˆ¶</td><td>æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆ10sâ†’30sâ†’1minâ†’5minâ†’10minï¼‰+ æœ€å¤§é‡è¯•æ¬¡æ•°é™åˆ¶ï¼Œå¤±è´¥åè®¾å¤‡å‘Šè­¦ã€‚</td></tr><tr><td>7. åŒæ­¥åè®¾å¤‡çŠ¶æ€æœªæ›´æ–°</td><td>äº‘ç«¯è¿”å›åŒæ­¥ç»“æœ+è®¾å¤‡ç«¯äº‹åŠ¡æ›´æ–°æœ¬åœ°çŠ¶æ€ï¼ŒåŒæ­¥æˆåŠŸæ‰æ ‡è®°ä¸ºSUCCESSã€‚</td></tr><tr><td>8. æ‰¹é‡åŒæ­¥æ•ˆç‡ä½ä¸‹</td><td>10æ¡/æ‰¹æ‰¹é‡åŒæ­¥+æ–­ç‚¹ç»­ä¼ ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°ï¼Œæå‡åŒæ­¥æ•ˆç‡ã€‚</td></tr><tr><td>9. è®¾å¤‡æ—¶é—´é”™ä¹±</td><td>è®¾å¤‡å®šæ—¶æ ¡å‡†äº‘ç«¯æ—¶é—´+è®¢å•åˆ›å»ºæ—¶é—´ç”¨æ ¡å‡†åæ—¶é—´ï¼Œé¿å…æ—¶é—´å†²çªã€‚</td></tr><tr><td>10. åŒæ­¥æ—¥å¿—ç¼ºå¤±</td><td>è®¾å¤‡ç«¯è®°å½•åŒæ­¥å…¨é“¾è·¯æ—¥å¿—ï¼ˆå‘é€/æ¥æ”¶/å¤„ç†/ç»“æœï¼‰+ äº‘ç«¯æ¶ˆè´¹æ—¥å¿—ï¼Œä¾¿äºæ’æŸ¥ã€‚</td></tr></tbody></table>
<h2 data-id="heading-20">äº”ã€æµ‹è¯•åœºæ™¯éªŒè¯ï¼ˆç¡®ä¿æ–¹æ¡ˆè½åœ°å¯ç”¨ï¼‰</h2>
<h3 data-id="heading-21">æµ‹è¯•åœºæ™¯1ï¼šç¦»çº¿ä¸‹å•åè®¾å¤‡æ–­ç”µï¼Œè®¢å•ä¸ä¸¢å¤±</h3>
<ol>
<li>è®¾å¤‡ç¦»çº¿ï¼Œç”¨æˆ·ä¸‹å•ç”Ÿæˆè®¢å•Aï¼›</li>
<li>è®¾å¤‡ç«‹å³æ–­ç”µï¼Œé‡å¯åï¼›</li>
<li>æŸ¥çœ‹SQLiteçš„device_orderè¡¨å’Œdevice_order_backupè¡¨ï¼Œè®¢å•Aå­˜åœ¨ï¼›</li>
<li>è”ç½‘åï¼Œè®¾å¤‡æˆåŠŸåŒæ­¥è®¢å•Aåˆ°äº‘ç«¯ã€‚</li>
</ol>
<h3 data-id="heading-22">æµ‹è¯•åœºæ™¯2ï¼šåŒæ­¥æ—¶ç½‘ç»œå†æ¬¡ä¸­æ–­ï¼Œæ–­ç‚¹ç»­ä¼ </h3>
<ol start="5">
<li>è®¾å¤‡ç¦»çº¿ç”Ÿæˆè®¢å•Aã€Bã€Cã€Dï¼ˆå…±4æ¡ï¼‰ï¼›</li>
<li>è”ç½‘åå¼€å§‹åŒæ­¥ï¼ŒåŒæ­¥å®ŒAã€Båï¼Œç½‘ç»œä¸­æ–­ï¼›</li>
<li>ç½‘ç»œæ¢å¤åï¼Œè®¾å¤‡ä»last_sync_order_id=Bå¼€å§‹ï¼ŒåŒæ­¥Cã€Dï¼Œæœªé‡å¤åŒæ­¥Aã€Bã€‚</li>
</ol>
<h3 data-id="heading-23">æµ‹è¯•åœºæ™¯3ï¼šåŒæ­¥æ—¶äº‘ç«¯åº“å­˜ä¸è¶³ï¼Œå†²çªå¤„ç†</h3>
<ol start="8">
<li>äº‘ç«¯å•†å“Xåº“å­˜=1ï¼›</li>
<li>è®¾å¤‡Aç¦»çº¿ä¸‹å•å•†å“Xï¼ˆæ•°é‡1ï¼‰ï¼Œè®¾å¤‡Bç¦»çº¿ä¸‹å•å•†å“Xï¼ˆæ•°é‡1ï¼‰ï¼›</li>
<li>è®¾å¤‡Aå…ˆè”ç½‘ï¼ŒåŒæ­¥æˆåŠŸï¼ˆåº“å­˜æ‰£å‡ä¸º0ï¼‰ï¼›</li>
<li>è®¾å¤‡Bè”ç½‘åŒæ­¥ï¼Œäº‘ç«¯è¿”å›â€œåº“å­˜ä¸è¶³â€ï¼Œè®¾å¤‡Bæ ‡è®°è®¢å•ä¸ºFAILEDï¼Œé‡è¯•5æ¬¡åæ ‡è®°ä¸ºEXCEPTIONï¼Œè®¾å¤‡æŒ‡ç¤ºç¯å‘Šè­¦ã€‚</li>
</ol>
<h3 data-id="heading-24">æµ‹è¯•åœºæ™¯4ï¼šè®¢å•é‡å¤åŒæ­¥ï¼Œå»é‡ç”Ÿæ•ˆ</h3>
<ol start="12">
<li>è®¾å¤‡åŒæ­¥è®¢å•AæˆåŠŸï¼Œä½†æœªæ”¶åˆ°äº‘ç«¯ç¡®è®¤ï¼Œé‡å¯åå†æ¬¡åŒæ­¥ï¼›</li>
<li>äº‘ç«¯æ¥æ”¶åï¼ŒRediså»é‡æ ¡éªŒå‘ç°è®¢å•Aå·²åŒæ­¥ï¼Œç›´æ¥è¿”å›æˆåŠŸï¼Œæœªé‡å¤åˆ›å»ºè®¢å•ã€‚</li>
</ol>
<h2 data-id="heading-25">å…­ã€æ€»ç»“ï¼ˆæ ¸å¿ƒæ€è·¯å›é¡¾ï¼‰</h2>
<ol start="14">
<li><strong>æœ¬åœ°å¯é æ˜¯åŸºç¡€</strong>ï¼šç¦»çº¿è®¢å•å¿…é¡»ç”¨åµŒå…¥å¼æ•°æ®åº“ï¼ˆSQLiteï¼‰åšäº‹åŠ¡åŒ–å­˜å‚¨+å¤‡ä»½ï¼Œæœç»è®¾å¤‡æ•…éšœå¯¼è‡´ä¸¢å¤±ï¼›</li>
<li><strong>åŒæ­¥å¯é æ˜¯å…³é”®</strong>ï¼šæ‰¹é‡+æ–­ç‚¹ç»­ä¼ +æŒ‡æ•°é€€é¿é‡è¯•ï¼Œåº”å¯¹ç½‘ç»œæ³¢åŠ¨ï¼Œç¡®ä¿â€œä¸é‡ä¸æ¼â€ï¼›</li>
<li><strong>äº‘ç«¯æ ¡éªŒæ˜¯ä¿éšœ</strong>ï¼šåŒæ­¥æ—¶æ ¡éªŒå•†å“ã€åº“å­˜ã€è®¢å•å”¯ä¸€æ€§ï¼Œæ‹’ç»éæ³•è®¢å•ï¼Œé¿å…ä¸šåŠ¡å†²çªï¼›</li>
<li><strong>å†²çªå¤„ç†æ˜¯æ ¸å¿ƒ</strong>ï¼šç”¨ä¹è§‚é”ã€åˆ†å¸ƒå¼é”ã€çŠ¶æ€æœºè§£å†³åº“å­˜/çŠ¶æ€å†²çªï¼Œæ— éœ€äººå·¥å¹²é¢„ï¼›</li>
<li><strong>å®¹é”™å…œåº•æ˜¯è¡¥å……</strong>ï¼šæ­»ä¿¡é˜Ÿåˆ—+åŒæ­¥æ—¥å¿—+è®¾å¤‡å‘Šè­¦ï¼Œç¡®ä¿æç«¯æƒ…å†µå¯è¿½æº¯ã€å¯æ¢å¤ã€‚</li>
</ol>
<p>è¿™å¥—æ–¹æ¡ˆå®Œå…¨èšç„¦â€œç¦»çº¿ä¸‹å•â†’è”ç½‘åŒæ­¥â€çš„æ ¸å¿ƒç—›ç‚¹ï¼Œä»£ç å¯ç›´æ¥è½åœ°åˆ°åµŒå…¥å¼è®¾å¤‡å’ŒSpring Cloudäº‘ç«¯ç³»ç»Ÿï¼Œå…¼é¡¾äº†å¯é æ€§ã€ä¸€è‡´æ€§å’Œæ•ˆç‡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯æ€§èƒ½æ·±åº¦è§£æï¼šç½‘ç»œå“åº”æ—¶é—´ä¸å®é™…æ¸²æŸ“æ—¶é—´çš„é¸¿æ²Ÿ]]></title>    <link>https://juejin.cn/post/7579256547798417449</link>    <guid>https://juejin.cn/post/7579256547798417449</guid>    <pubDate>2025-12-03T06:31:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579256547798417449" data-draft-id="7579213860571676726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯æ€§èƒ½æ·±åº¦è§£æï¼šç½‘ç»œå“åº”æ—¶é—´ä¸å®é™…æ¸²æŸ“æ—¶é—´çš„é¸¿æ²Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:31:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é€ƒç¦»ç–¯äººé™¢"/> <meta itemprop="url" content="https://juejin.cn/user/2796759396916189"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯æ€§èƒ½æ·±åº¦è§£æï¼šç½‘ç»œå“åº”æ—¶é—´ä¸å®é™…æ¸²æŸ“æ—¶é—´çš„é¸¿æ²Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2796759396916189/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é€ƒç¦»ç–¯äººé™¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:31:26.000Z" title="Wed Dec 03 2025 06:31:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>åœ¨ç°ä»£Webåº”ç”¨ä¸­ï¼Œç»å¸¸å‡ºç°ä¸€ä¸ªç°è±¡ï¼š<strong>Networké¢æ¿æ˜¾ç¤ºè¯·æ±‚å·²å®Œæˆï¼ˆå¦‚è€—æ—¶5ç§’ï¼‰ï¼Œä½†ç”¨æˆ·éœ€è¦ç­‰å¾…æ›´é•¿æ—¶é—´ï¼ˆå¦‚10ç§’ï¼‰æ‰èƒ½åœ¨é¡µé¢ä¸Šçœ‹åˆ°ç»“æœ</strong>ã€‚è¿™ç§å·®å¼‚æ˜¯å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒå…³æ³¨ç‚¹ã€‚</p>
<h2 data-id="heading-1">å…³é”®æ¦‚å¿µæ¾„æ¸…</h2>
<h3 data-id="heading-2">1. æ—¶é—´çº¿å®šä¹‰</h3>
<pre><code class="hljs language-text" lang="text">ç”¨æˆ·å‘èµ·è¯·æ±‚ (0ms)
  â†“
TTFBå¼€å§‹è®¡æ—¶
  â†“
æœåŠ¡å™¨å¤„ç† (æœåŠ¡ç«¯æ—¶é—´)
  â†“
æ”¶åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚ (TTFBç»“æŸ)
  â†“
ä¸‹è½½å“åº”ä½“ (Content Download)
  â†“
âœ… ç½‘ç»œè¯·æ±‚å®Œæˆ (Networké¢æ¿æ˜¾ç¤ºçš„æ€»æ—¶é—´)
  â†“
æµè§ˆå™¨è§£æå“åº”
  â†“
JavaScriptå¤„ç†æ•°æ®
  â†“
DOMè®¡ç®—ä¸æ›´æ–°
  â†“
æ ·å¼è®¡ç®—ä¸å¸ƒå±€
  â†“
æ¸²æŸ“ä¸åˆæˆ
  â†“
âœ… ç”¨æˆ·çœ‹åˆ°å†…å®¹ (å®é™…æ„ŸçŸ¥æ—¶é—´)
</code></pre>
<h3 data-id="heading-3">2. æ ¸å¿ƒæŒ‡æ ‡å¯¹æ¯”</h3>





























<table><thead><tr><th>æŒ‡æ ‡</th><th>æµ‹é‡èŒƒå›´</th><th>å·¥å…·æŸ¥çœ‹ä½ç½®</th><th>å½±å“å› ç´ </th></tr></thead><tbody><tr><td><strong>ç½‘ç»œå“åº”æ—¶é—´</strong></td><td>ä»å‘èµ·è¯·æ±‚åˆ°TCPè¿æ¥å…³é—­</td><td>Networké¢æ¿çš„"Time"åˆ—</td><td>æœåŠ¡å™¨æ€§èƒ½ã€ç½‘ç»œå»¶è¿Ÿã€å“åº”ä½“å¤§å°</td></tr><tr><td><strong>å‰ç«¯å¤„ç†æ—¶é—´</strong></td><td>ä»æ”¶åˆ°æ•°æ®åˆ°ç”¨æˆ·çœ‹åˆ°å†…å®¹</td><td>Performanceé¢æ¿çš„Mainçº¿ç¨‹</td><td>JSæ‰§è¡Œæ•ˆç‡ã€DOMæ“ä½œå¤æ‚åº¦ã€æ¸²æŸ“æ€§èƒ½</td></tr><tr><td><strong>æ€»æ„ŸçŸ¥æ—¶é—´</strong></td><td>ç”¨æˆ·ç‚¹å‡»åˆ°çœ‹åˆ°ç»“æœ</td><td>ç”¨æˆ·ä¸»è§‚æ„Ÿå—</td><td>ä»¥ä¸Šä¸¤è€…ä¹‹å’Œ + å¿ƒç†å› ç´ </td></tr></tbody></table>
<h2 data-id="heading-4">é—®é¢˜æ ¹å› åˆ†æ</h2>
<h3 data-id="heading-5">1. æ•°æ®é‡è¿‡å¤§ï¼ˆæœ€å¸¸è§åŸå› ï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…¸å‹åœºæ™¯ï¼šä¸€æ¬¡æ€§è¿”å›10000æ¡è®°å½•</span>
{
  <span class="hljs-string">"data"</span>: [
    { <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"Item 1"</span>, ...<span class="hljs-number">20</span>ä¸ªå­—æ®µ },
    { <span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"Item 2"</span>, ...<span class="hljs-number">20</span>ä¸ªå­—æ®µ },
    <span class="hljs-comment">// ... 9998 more</span>
  ]
}
<span class="hljs-comment">// é—®é¢˜ï¼š5ç§’ä¸‹è½½ï¼Œ5ç§’JSONè§£æ</span>
</code></pre>
<h3 data-id="heading-6">2. JavaScriptå¤„ç†é˜»å¡</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ€§èƒ½ç“¶é¢ˆç¤ºä¾‹</span>
<span class="hljs-title function_">fetch</span>(url).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
  <span class="hljs-comment">// ä»¥ä¸‹æ“ä½œå¯èƒ½è€—æ—¶æ•°ç§’ï¼š</span>
  <span class="hljs-comment">// 1. å¤æ‚æ•°æ®è½¬æ¢</span>
  <span class="hljs-keyword">const</span> processed = data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-title function_">heavyTransform</span>(item))
  
  <span class="hljs-comment">// 2. å¤§é‡DOMæ“ä½œ</span>
  processed.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
    <span class="hljs-comment">// å¤æ‚çš„innerHTMLæ‹¼æ¥</span>
    div.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`&lt;div class="card"&gt;
      &lt;h3&gt;<span class="hljs-subst">${item.title}</span>&lt;/h3&gt;
      &lt;p&gt;<span class="hljs-subst">${item.description}</span>&lt;/p&gt;
      &lt;!-- æ›´å¤šåµŒå¥—å…ƒç´  --&gt;
    &lt;/div&gt;`</span>
    container.<span class="hljs-title function_">appendChild</span>(div)
  })
})
</code></pre>
<h3 data-id="heading-7">3. æ¸²æŸ“æµæ°´çº¿é˜»å¡</h3>
<pre><code class="hljs language-text" lang="text">ä¸»çº¿ç¨‹æ—¶é—´çº¿ï¼š
[ç½‘ç»œè¯·æ±‚: 0-5s] â†’ [JSæ‰§è¡Œ: 5-8s] â†’ [æ ·å¼è®¡ç®—: 8-9s] â†’ [å¸ƒå±€: 9-9.5s] â†’ [ç»˜åˆ¶: 9.5-10s]

å¦‚æœJSæ‰§è¡Œè¶…è¿‡50msï¼Œå°±ä¼šé˜»å¡æ¸²æŸ“ï¼Œé€ æˆé¡µé¢"å¡ä½"çš„æ„Ÿè§‰ã€‚
</code></pre>
<h2 data-id="heading-8">è¯Šæ–­æ–¹æ³•è®º</h2>
<h3 data-id="heading-9">1. ä½¿ç”¨Chrome DevToolsè¯Šæ–­</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/065ccbdeaae7491ca0c7fe6c11b0400b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCD56a755av5Lq66Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348344&amp;x-signature=CLmeLjsP2mXDUBhf4K610qy9PHA%3D" alt="deepseek_mermaid_20251203_49b3f7.png" loading="lazy"/></p>
<h3 data-id="heading-10">2. å…³é”®æ£€æŸ¥ç‚¹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ä»£ç ä¸­æ·»åŠ æµ‹é‡ç‚¹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">measurePerformance</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// é˜¶æ®µ1: ç½‘ç»œæ—¶é—´</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'network'</span>)
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>)
  <span class="hljs-keyword">const</span> rawData = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">text</span>() <span class="hljs-comment">// æ³¨æ„ï¼štext()æ¯”json()å¿«</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'network'</span>) <span class="hljs-comment">// å¯¹åº”Networké¢æ¿æ—¶é—´</span>
  
  <span class="hljs-comment">// é˜¶æ®µ2: JSONè§£ææ—¶é—´ï¼ˆå¦‚æœæ•°æ®é‡å¤§ï¼‰</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'json-parse'</span>)
  <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(rawData)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'json-parse'</span>)
  
  <span class="hljs-comment">// é˜¶æ®µ3: æ•°æ®å¤„ç†æ—¶é—´</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'data-processing'</span>)
  <span class="hljs-keyword">const</span> processedData = <span class="hljs-title function_">processData</span>(data) <span class="hljs-comment">// ä½ çš„ä¸šåŠ¡é€»è¾‘</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'data-processing'</span>)
  
  <span class="hljs-comment">// é˜¶æ®µ4: DOMæ¸²æŸ“æ—¶é—´</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'dom-render'</span>)
  <span class="hljs-title function_">renderToDOM</span>(processedData)
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">nextTick</span>() <span class="hljs-comment">// Vue/Reactç­‰å¾…æ›´æ–°</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'dom-render'</span>)
}
</code></pre>
<h2 data-id="heading-11">ä¼˜åŒ–ç­–ç•¥ä½“ç³»</h2>
<h3 data-id="heading-12">1. ç½‘ç»œå±‚ä¼˜åŒ–</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸åç«¯åä½œæ–¹æ¡ˆ</span>
<span class="hljs-keyword">const</span> optimizedRequest = {
  <span class="hljs-comment">// æ–¹æ¡ˆ1: åˆ†é¡µ</span>
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/items?page=1&amp;pageSize=50'</span>,
  
  <span class="hljs-comment">// æ–¹æ¡ˆ2: å­—æ®µé€‰æ‹©</span>
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/items?fields=id,name,status'</span>,
  
  <span class="hljs-comment">// æ–¹æ¡ˆ3: å¢é‡æ›´æ–°</span>
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/items?since=2024-01-01T00:00:00Z'</span>,
  
  <span class="hljs-comment">// æ–¹æ¡ˆ4: å‹ç¼©ä¼ è¾“</span>
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">'Accept-Encoding'</span>: <span class="hljs-string">'gzip, br'</span>
  }
}
</code></pre>
<h3 data-id="heading-13">2. æ•°æ®å¤„ç†ä¼˜åŒ–</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”</span>
<span class="hljs-keyword">const</span> optimizationTechniques = {
  <span class="hljs-comment">// æ–¹æ¡ˆA: æ—¶é—´åˆ‡ç‰‡ï¼ˆé€‚ç”¨äºReact/Vueï¼‰</span>
  <span class="hljs-attr">timeSlicing</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">processInChunks</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">data, chunkSize = <span class="hljs-number">100</span></span>) =&gt; {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.<span class="hljs-property">length</span>; i += chunkSize) {
        <span class="hljs-comment">// æ¯å¤„ç†100æ¡å°±è®©å‡ºä¸»çº¿ç¨‹</span>
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">0</span>))
        <span class="hljs-title function_">processChunk</span>(data.<span class="hljs-title function_">slice</span>(i, i + chunkSize))
      }
    }
  },
  
  <span class="hljs-comment">// æ–¹æ¡ˆB: Web Workerï¼ˆCPUå¯†é›†å‹è®¡ç®—ï¼‰</span>
  <span class="hljs-attr">webWorker</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">'data-processor.js'</span>)
    worker.<span class="hljs-title function_">postMessage</span>(largeData)
    worker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-comment">// åœ¨ä¸»çº¿ç¨‹å¿«é€Ÿæ¸²æŸ“ç»“æœ</span>
      <span class="hljs-title function_">renderLightweight</span>(e.<span class="hljs-property">data</span>)
    }
  },
  
  <span class="hljs-comment">// æ–¹æ¡ˆC: å¢é‡æ¸²æŸ“</span>
  <span class="hljs-attr">incrementalRender</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// å…ˆæ¸²æŸ“éª¨æ¶ï¼Œç„¶ååˆ†æ‰¹å¡«å……æ•°æ®</span>
    <span class="hljs-title function_">renderSkeleton</span>(<span class="hljs-number">100</span>) <span class="hljs-comment">// ç«‹å³æ˜¾ç¤º100ä¸ªç©ºä½</span>
    data.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">updateItemAtIndex</span>(index, item)
      }, index * <span class="hljs-number">10</span>) <span class="hljs-comment">// æ¯10msæ›´æ–°ä¸€ä¸ª</span>
    })
  }
}
</code></pre>
<h3 data-id="heading-14">3. æ¸²æŸ“ä¼˜åŒ–</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- è™šæ‹Ÿåˆ—è¡¨å®ç° --&gt;
&lt;template&gt;
  &lt;!-- å›ºå®šé«˜åº¦å®¹å™¨ --&gt;
  &lt;div class="virtual-container" @scroll="handleScroll" ref="container"&gt;
    &lt;!-- å ä½å…ƒç´ ï¼Œæ’‘å¼€æ»šåŠ¨åŒºåŸŸ --&gt;
    &lt;div :style="{ height: totalHeight + 'px' }"&gt;&lt;/div&gt;
    
    &lt;!-- å¯è§†åŒºåŸŸå†…çš„çœŸå®å…ƒç´  --&gt;
    &lt;div
      v-for="item in visibleItems"
      :key="item.id"
      :style="{ transform: `translateY(${item.offset}px)` }"
      class="virtual-item"
    &gt;
      {{ item.content }}
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { computed, ref, onMounted } from 'vue'

const props = defineProps(['items']) // æ‰€æœ‰æ•°æ®
const container = ref(null)
const scrollTop = ref(0)

// è™šæ‹Ÿåˆ—è¡¨æ ¸å¿ƒè®¡ç®—
const itemHeight = 50
const buffer = 5 // ç¼“å†²åŒº

const visibleRange = computed(() =&gt; {
  const start = Math.max(0, Math.floor(scrollTop.value / itemHeight) - buffer)
  const end = Math.min(
    props.items.length,
    Math.ceil((scrollTop.value + containerHeight.value) / itemHeight) + buffer
  )
  return { start, end }
})

const visibleItems = computed(() =&gt; {
  return props.items
    .slice(visibleRange.value.start, visibleRange.value.end)
    .map((item, index) =&gt; ({
      ...item,
      offset: (visibleRange.value.start + index) * itemHeight
    }))
})

const totalHeight = computed(() =&gt; props.items.length * itemHeight)
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-15">4. ç¼“å­˜ç­–ç•¥</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¤šçº§ç¼“å­˜æ–¹æ¡ˆ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataCache</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">indexedDBCache</span> = <span class="hljs-string">'DataCache'</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxMemorySize</span> = <span class="hljs-number">100</span> <span class="hljs-comment">// æœ€å¤§ç¼“å­˜æ¡ç›®æ•°</span>
  }
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">key, fetcher</span>) {
    <span class="hljs-comment">// 1. å†…å­˜ç¼“å­˜ï¼ˆæœ€å¿«ï¼‰</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-title function_">has</span>(key)) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-title function_">get</span>(key)
    }
    
    <span class="hljs-comment">// 2. IndexedDBç¼“å­˜ï¼ˆè¾ƒå¤§æ•°æ®ï¼‰</span>
    <span class="hljs-keyword">const</span> dbData = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFromIndexedDB</span>(key)
    <span class="hljs-keyword">if</span> (dbData) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-title function_">set</span>(key, dbData)
      <span class="hljs-keyword">return</span> dbData
    }
    
    <span class="hljs-comment">// 3. ç½‘ç»œè¯·æ±‚</span>
    <span class="hljs-keyword">const</span> freshData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetcher</span>()
    
    <span class="hljs-comment">// 4. æ›´æ–°ç¼“å­˜</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-title function_">set</span>(key, freshData)
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-property">size</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxMemorySize</span>) {
      <span class="hljs-keyword">const</span> firstKey = <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-title function_">keys</span>().<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-title function_">delete</span>(firstKey)
    }
    
    <span class="hljs-comment">// å¼‚æ­¥å­˜å‚¨åˆ°IndexedDB</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveToIndexedDB</span>(key, freshData).<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>)
    
    <span class="hljs-keyword">return</span> freshData
  }
}
</code></pre>
<h2 data-id="heading-16">ç›‘æ§ä¸åº¦é‡</h2>
<h3 data-id="heading-17">1. æ€§èƒ½æŒ‡æ ‡æ”¶é›†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è‡ªåŠ¨åŒ–çš„æ€§èƒ½ç›‘æ§</span>
<span class="hljs-keyword">const</span> performanceMonitor = {
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ç›‘å¬é•¿ä»»åŠ¡</span>
    <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> list.<span class="hljs-title function_">getEntries</span>()) {
        <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">duration</span> &gt; <span class="hljs-number">50</span>) { <span class="hljs-comment">// è¶…è¿‡50msçš„ä»»åŠ¡</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reportLongTask</span>(entry)
        }
      }
    })
    observer.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">'longtask'</span>] })
    
    <span class="hljs-comment">// è‡ªå®šä¹‰æŒ‡æ ‡</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">measureFP</span>()  <span class="hljs-comment">// é¦–æ¬¡ç»˜åˆ¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">measureFCP</span>() <span class="hljs-comment">// é¦–æ¬¡å†…å®¹ç»˜åˆ¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">measureLCP</span>() <span class="hljs-comment">// æœ€å¤§å†…å®¹ç»˜åˆ¶</span>
  },
  
  <span class="hljs-title function_">measureApiPerf</span>(<span class="hljs-params">apiName</span>) {
    <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>()
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">start</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">marks</span>[<span class="hljs-string">`<span class="hljs-subst">${apiName}</span>_start`</span>] = performance.<span class="hljs-title function_">now</span>()
      },
      <span class="hljs-attr">end</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>()
        <span class="hljs-keyword">const</span> duration = end - <span class="hljs-variable language_">this</span>.<span class="hljs-property">marks</span>[<span class="hljs-string">`<span class="hljs-subst">${apiName}</span>_start`</span>]
        
        <span class="hljs-comment">// å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendMetrics</span>({
          <span class="hljs-attr">name</span>: apiName,
          duration,
          <span class="hljs-attr">type</span>: <span class="hljs-string">'api'</span>,
          <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
        })
      }
    }
  }
}
</code></pre>
<h3 data-id="heading-18">2. æ€§èƒ½è¯„åˆ†å¡</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">generatePerformanceReport</span> = (<span class="hljs-params">metrics</span>) =&gt; {
  <span class="hljs-keyword">const</span> score = {
    <span class="hljs-attr">network</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateNetworkScore</span>(metrics.<span class="hljs-property">ttfb</span>, metrics.<span class="hljs-property">downloadTime</span>),
    <span class="hljs-attr">processing</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateProcessingScore</span>(metrics.<span class="hljs-property">jsTime</span>, metrics.<span class="hljs-property">domTime</span>),
    <span class="hljs-attr">rendering</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateRenderingScore</span>(metrics.<span class="hljs-property">fcp</span>, metrics.<span class="hljs-property">lcp</span>),
    <span class="hljs-attr">overall</span>: <span class="hljs-number">0</span>
  }
  
  score.<span class="hljs-property">overall</span> = (score.<span class="hljs-property">network</span> * <span class="hljs-number">0.3</span> + 
                   score.<span class="hljs-property">processing</span> * <span class="hljs-number">0.4</span> + 
                   score.<span class="hljs-property">rendering</span> * <span class="hljs-number">0.3</span>)
  
  <span class="hljs-keyword">return</span> {
    score,
    <span class="hljs-attr">suggestions</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateSuggestions</span>(metrics),
    <span class="hljs-attr">bottlenecks</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">identifyBottlenecks</span>(metrics)
  }
}
</code></pre>
<h2 data-id="heading-19">æœ€ä½³å®è·µæ€»ç»“</h2>
<h3 data-id="heading-20">1. å¼€å‘é˜¶æ®µ</h3>
<ul>
<li><strong>å§‹ç»ˆæ·»åŠ æ€§èƒ½æµ‹é‡ä»£ç </strong></li>
<li><strong>ä½¿ç”¨Performance APIè€Œéconsole.time</strong></li>
<li><strong>åœ¨ä½ç«¯è®¾å¤‡ä¸Šæµ‹è¯•</strong></li>
<li><strong>å»ºç«‹æ€§èƒ½å›å½’æµ‹è¯•</strong></li>
</ul>
<h3 data-id="heading-21">2. æ¶æ„è®¾è®¡</h3>
<ul>
<li><strong>é‡‡ç”¨æ¸è¿›å¼åŠ è½½ç­–ç•¥</strong></li>
<li><strong>å®ç°è¯·æ±‚ä¼˜å…ˆçº§é˜Ÿåˆ—</strong></li>
<li><strong>è®¾è®¡ç¼“å­˜å¤±æ•ˆç­–ç•¥</strong></li>
<li><strong>è€ƒè™‘ç¦»çº¿ä¼˜å…ˆæ¶æ„</strong></li>
</ul>
<h3 data-id="heading-22">3. å›¢é˜Ÿåä½œ</h3>
<ul>
<li><strong>å‰åç«¯çº¦å®šæ•°æ®åè®®</strong></li>
<li><strong>å»ºç«‹æ€§èƒ½é¢„ç®—æœºåˆ¶</strong></li>
<li><strong>å®šæœŸè¿›è¡Œæ€§èƒ½è¯„å®¡</strong></li>
<li><strong>å…±äº«æ€§èƒ½ç›‘æ§æ•°æ®</strong></li>
</ul>
<h2 data-id="heading-23">å·¥å…·æ¨è</h2>
<ol>
<li><strong>Chrome DevTools</strong>Â - Performance, Network, Memoryé¢æ¿</li>
<li><strong>Lighthouse</strong>Â - è‡ªåŠ¨åŒ–æ€§èƒ½å®¡è®¡</li>
<li><strong>WebPageTest</strong>Â - å¤šåœ°ç‚¹æ€§èƒ½æµ‹è¯•</li>
<li><strong>Sentry Performance</strong>Â - ç”Ÿäº§ç¯å¢ƒæ€§èƒ½ç›‘æ§</li>
<li><strong>SpeedCurve</strong>Â - é•¿æœŸæ€§èƒ½è¶‹åŠ¿åˆ†æ</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBooté¡¹ç›®ä½¿ç”¨Rediså¯¹ç”¨æˆ·IPè¿›è¡Œæ¥å£é™æµ]]></title>    <link>https://juejin.cn/post/7579190764771360808</link>    <guid>https://juejin.cn/post/7579190764771360808</guid>    <pubDate>2025-12-03T06:33:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579190764771360808" data-draft-id="7579168400989683747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBooté¡¹ç›®ä½¿ç”¨Rediså¯¹ç”¨æˆ·IPè¿›è¡Œæ¥å£é™æµ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:33:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é©¬å¡å·´å¡"/> <meta itemprop="url" content="https://juejin.cn/user/1892677617451163"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBooté¡¹ç›®ä½¿ç”¨Rediså¯¹ç”¨æˆ·IPè¿›è¡Œæ¥å£é™æµ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1892677617451163/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é©¬å¡å·´å¡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:33:10.000Z" title="Wed Dec 03 2025 06:33:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æ€è·¯</h2>
<p>ä½¿ç”¨æ¥å£é™æµçš„ä¸»è¦ç›®çš„åœ¨äºæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œé˜²æ­¢æ¥å£è¢«æ¶æ„æ‰“å‡»ï¼ˆçŸ­æ—¶é—´å†…å¤§é‡è¯·æ±‚ï¼‰ã€‚</p>
<p>æ¯”å¦‚è¦æ±‚æŸæ¥å£åœ¨1åˆ†é’Ÿå†…è¯·æ±‚æ¬¡æ•°ä¸è¶…è¿‡1000æ¬¡ï¼Œé‚£ä¹ˆåº”è¯¥å¦‚ä½•è®¾è®¡ä»£ç å‘¢ï¼Ÿ</p>
<p>ä¸‹é¢è®²ä¸¤ç§æ€è·¯ï¼Œå¦‚æœæƒ³çœ‹ä»£ç å¯ç›´æ¥ç¿»åˆ°åé¢çš„ä»£ç éƒ¨åˆ†ã€‚</p>
<h3 data-id="heading-1">1.1 å›ºå®šæ—¶é—´æ®µï¼ˆæ—§æ€è·¯ï¼‰</h3>
<h5 data-id="heading-2">1.1.1 æ€è·¯æè¿°</h5>
<p>è¯¥æ–¹æ¡ˆçš„æ€è·¯æ˜¯ï¼šä½¿ç”¨Redisè®°å½•å›ºå®šæ—¶é—´æ®µå†…æŸç”¨æˆ·IPè®¿é—®æŸæ¥å£çš„æ¬¡æ•°ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li><strong>Redisçš„key</strong>ï¼šç”¨æˆ·IP + æ¥å£æ–¹æ³•å</li>
<li><strong>Redisçš„value</strong>ï¼šå½“å‰æ¥å£è®¿é—®æ¬¡æ•°ã€‚</li>
</ul>
<p>å½“ç”¨æˆ·åœ¨è¿‘æœŸå†…ç¬¬ä¸€æ¬¡è®¿é—®è¯¥æ¥å£æ—¶ï¼Œå‘Redisä¸­è®¾ç½®ä¸€ä¸ªåŒ…å«äº†ç”¨æˆ·IPå’Œæ¥å£æ–¹æ³•åçš„keyï¼Œvalueçš„å€¼åˆå§‹åŒ–ä¸º1ï¼ˆè¡¨ç¤ºç¬¬ä¸€æ¬¡è®¿é—®å½“å‰æ¥å£ï¼‰ã€‚åŒæ—¶ï¼Œè®¾ç½®è¯¥keyçš„è¿‡æœŸæ—¶é—´ï¼ˆæ¯”å¦‚ä¸º60ç§’ï¼‰ã€‚</p>
<p>ä¹‹åï¼Œåªè¦è¿™ä¸ªkeyè¿˜æœªè¿‡æœŸï¼Œç”¨æˆ·æ¯æ¬¡è®¿é—®è¯¥æ¥å£éƒ½ä¼šå¯¼è‡´valueè‡ªå¢1æ¬¡ã€‚</p>
<p>ç”¨æˆ·æ¯æ¬¡è®¿é—®æ¥å£å‰ï¼Œå…ˆä»Redisä¸­æ‹¿åˆ°å½“å‰æ¥å£è®¿é—®æ¬¡æ•°ï¼Œå¦‚æœå‘ç°è®¿é—®æ¬¡æ•°å¤§äºè§„å®šçš„æ¬¡æ•°ï¼ˆå¦‚è¶…è¿‡1000æ¬¡ï¼‰ï¼Œåˆ™å‘ç”¨æˆ·è¿”å›æ¥å£è®¿é—®å¤±è´¥çš„æ ‡è¯†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54f054fa740a4e90883174ad36e4a8bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ams5Y2h5be05Y2h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348389&amp;x-signature=7aKWwZRe%2FhWCGezhtN%2BmUS%2FEPz8%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<h5 data-id="heading-3">1.1.2 æ€è·¯ç¼ºé™·</h5>
<p>è¯¥æ–¹æ¡ˆçš„ç¼ºç‚¹åœ¨äºï¼Œé™æµæ—¶é—´æ®µæ˜¯å›ºå®šçš„ã€‚</p>
<p>æ¯”å¦‚è¦æ±‚æŸæ¥å£åœ¨1åˆ†é’Ÿå†…è¯·æ±‚æ¬¡æ•°ä¸è¶…è¿‡1000æ¬¡ï¼Œè§‚å¯Ÿä»¥ä¸‹æµç¨‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bb81150196445e0824bfa2a1aca4e4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ams5Y2h5be05Y2h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348389&amp;x-signature=utXm2%2Fp2ZxwlDwDvt6JDZfL3yww%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91d00f1e213f424b99d61c377f071dbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ams5Y2h5be05Y2h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348389&amp;x-signature=WXgAfcwNsYDiaq%2FlwWBmIoC3WAs%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<p>å¯ä»¥å‘ç°ï¼Œ00:59å’Œ01:01ä¹‹é—´ä»…ä»…é—´éš”äº†2ç§’ï¼Œä½†æ¥å£å´è¢«è®¿é—®äº†1000+999=1999æ¬¡ï¼Œæ˜¯é™æµæ¬¡æ•°ï¼ˆ1000æ¬¡ï¼‰çš„2å€ï¼</p>
<p>æ‰€ä»¥åœ¨è¯¥æ–¹æ¡ˆä¸­ï¼Œé™æµæ¬¡æ•°çš„è®¾ç½®å¯èƒ½ä¸èµ·ä½œç”¨ï¼Œä»ç„¶å¯èƒ½åœ¨çŸ­æ—¶é—´å†…é€ æˆå¤§é‡è®¿é—®ã€‚</p>
<h3 data-id="heading-4">1.2 æ»‘åŠ¨çª—å£ï¼ˆæ–°æ€è·¯ï¼‰</h3>
<h5 data-id="heading-5">1.2.1 æ€è·¯æè¿°</h5>
<p>ä¸ºäº†é¿å…å‡ºç°æ–¹æ¡ˆ1ä¸­ç”±äºé”®è¿‡æœŸå¯¼è‡´çš„çŸ­æœŸè®¿é—®é‡å¢å¤§çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æ”¹å˜ä¸€ä¸‹æ€è·¯ï¼Œä¹Ÿå°±æ˜¯æŠŠå›ºå®šçš„æ—¶é—´æ®µæ”¹æˆåŠ¨æ€çš„ï¼š</p>
<p>å‡è®¾æŸä¸ªæ¥å£åœ¨10ç§’å†…åªå…è®¸è®¿é—®5æ¬¡ã€‚ç”¨æˆ·æ¯æ¬¡è®¿é—®æ¥å£æ—¶ï¼Œè®°å½•å½“å‰ç”¨æˆ·è®¿é—®çš„æ—¶é—´ç‚¹ï¼ˆæ—¶é—´æˆ³ï¼‰ï¼Œå¹¶è®¡ç®—å‰10ç§’å†…ç”¨æˆ·è®¿é—®è¯¥æ¥å£çš„æ€»æ¬¡æ•°ã€‚å¦‚æœæ€»æ¬¡æ•°å¤§äºé™æµæ¬¡æ•°ï¼Œåˆ™ä¸å…è®¸ç”¨æˆ·è®¿é—®è¯¥æ¥å£ã€‚è¿™æ ·å°±èƒ½ä¿è¯åœ¨ä»»æ„æ—¶åˆ»ç”¨æˆ·çš„è®¿é—®æ¬¡æ•°ä¸ä¼šè¶…è¿‡1000æ¬¡ã€‚</p>
<p>å¦‚ä¸‹å›¾ï¼Œå‡è®¾ç”¨æˆ·åœ¨0:19æ—¶é—´ç‚¹è®¿é—®æ¥å£ï¼Œç»æ£€æŸ¥å…¶å‰10ç§’å†…è®¿é—®æ¬¡æ•°ä¸º5æ¬¡ï¼Œåˆ™å…è®¸æœ¬æ¬¡è®¿é—®ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/364d41561d0448dc822b4bc85c7c0add~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ams5Y2h5be05Y2h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348389&amp;x-signature=yZiKTh6VgOzV3%2F2LUN03BJPlEnA%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<p>å‡è®¾ç”¨æˆ·0:20æ—¶é—´ç‚¹è®¿é—®æ¥å£ï¼Œç»æ£€æŸ¥å…¶å‰10ç§’å†…è®¿é—®æ¬¡æ•°ä¸º6æ¬¡ï¼ˆè¶…å‡ºé™æµæ¬¡æ•°5æ¬¡ï¼‰ï¼Œåˆ™ä¸å…è®¸æœ¬æ¬¡è®¿é—®ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d455c9af884a421280cb9b97aaff4558~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ams5Y2h5be05Y2h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348389&amp;x-signature=NlZUBHg9HTvWua4wsvaXkPfPFCw%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<h5 data-id="heading-6">1.2.2 Rediséƒ¨åˆ†çš„å®ç°</h5>
<p><strong>1ï¼‰é€‰ç”¨ä½•ç§ Redis æ•°æ®ç»“æ„</strong></p>
<p>é¦–å…ˆæ˜¯éœ€è¦ç¡®å®šä½¿ç”¨å“ªä¸ªRedisæ•°æ®ç»“æ„ã€‚ç”¨æˆ·æ¯æ¬¡è®¿é—®æ—¶ï¼Œéœ€è¦ç”¨ä¸€ä¸ªkeyè®°å½•ç”¨æˆ·è®¿é—®çš„æ—¶é—´ç‚¹ï¼Œè€Œä¸”è¿˜éœ€è¦åˆ©ç”¨è¿™äº›æ—¶é—´ç‚¹è¿›è¡ŒèŒƒå›´æ£€æŸ¥ã€‚</p>
<p><strong>2ï¼‰ä¸ºä½•é€‰æ‹© zSet æ•°æ®ç»“æ„</strong></p>
<p>ä¸ºäº†èƒ½å¤Ÿå®ç°èŒƒå›´æ£€æŸ¥ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Redisä¸­çš„zSetæœ‰åºé›†åˆã€‚</p>
<p>æ·»åŠ ä¸€ä¸ªzSetå…ƒç´ çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">ZADD <span class="hljs-selector-attr">[key]</span> <span class="hljs-selector-attr">[score]</span> <span class="hljs-selector-attr">[member]</span>
</code></pre>
<p>å®ƒæœ‰ä¸€ä¸ªå…³é”®çš„å±æ€§scoreï¼Œé€šè¿‡å®ƒå¯ä»¥è®°å½•å½“å‰memberçš„ä¼˜å…ˆçº§ã€‚</p>
<p>äºæ˜¯æˆ‘ä»¬å¯ä»¥æŠŠscoreè®¾ç½®æˆç”¨æˆ·è®¿é—®æ¥å£çš„æ—¶é—´æˆ³ï¼Œä»¥ä¾¿äºé€šè¿‡scoreè¿›è¡ŒèŒƒå›´æ£€æŸ¥ã€‚keyåˆ™è®°å½•ç”¨æˆ·IPå’Œæ¥å£æ–¹æ³•åï¼Œè‡³äºmemberè®¾ç½®æˆä»€ä¹ˆæ²¡æœ‰å½±å“ï¼Œä¸€ä¸ªmemberè®°å½•äº†ç”¨æˆ·è®¿é—®æ¥å£çš„æ—¶é—´ç‚¹ã€‚å› æ­¤memberä¹Ÿå¯ä»¥è®¾ç½®æˆæ—¶é—´æˆ³ã€‚</p>
<p><strong>3ï¼‰zSet å¦‚ä½•è¿›è¡ŒèŒƒå›´æ£€æŸ¥ï¼ˆæ£€æŸ¥å‰å‡ ç§’çš„è®¿é—®æ¬¡æ•°ï¼‰</strong></p>
<p>æ€è·¯æ˜¯ï¼ŒæŠŠç‰¹å®šæ—¶é—´é—´éš”ä¹‹å‰çš„memberéƒ½åˆ æ‰ï¼Œç•™ä¸‹çš„memberå°±æ˜¯æ—¶é—´é—´éš”ä¹‹å†…çš„æ€»è®¿é—®æ¬¡æ•°ã€‚ç„¶åç»Ÿè®¡å½“å‰keyä¸­çš„memberæœ‰å¤šå°‘ä¸ªå³å¯ã€‚</p>
<p>â‘  æŠŠç‰¹å®šæ—¶é—´é—´éš”ä¹‹å‰çš„memberéƒ½åˆ æ‰ã€‚</p>
<p>zSetæœ‰å¦‚ä¸‹å‘½ä»¤ï¼Œç”¨äºåˆ é™¤scoreèŒƒå›´åœ¨<code>[min~max]</code>ä¹‹é—´çš„memberï¼š</p>
<pre><code class="hljs language-css" lang="css">Zremrangebyscore <span class="hljs-selector-attr">[key]</span> <span class="hljs-selector-attr">[min]</span> <span class="hljs-selector-attr">[max]</span>
</code></pre>
<p>å‡è®¾é™æµæ—¶é—´è®¾ç½®ä¸º5ç§’ï¼Œå½“å‰ç”¨æˆ·è®¿é—®æ¥å£æ—¶ï¼Œè·å–å½“å‰ç³»ç»Ÿæ—¶é—´æˆ³ä¸º<code>currentTimeMill</code>ï¼Œé‚£ä¹ˆåˆ é™¤çš„scoreèŒƒå›´å¯ä»¥è®¾ç½®ä¸ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">min</span> = <span class="hljs-number">0</span>
<span class="hljs-attr">max</span> = currentTimeMill - <span class="hljs-number">5</span> * <span class="hljs-number">1000</span>
</code></pre>
<p>ç›¸å½“äºæŠŠ5ç§’ä¹‹å‰çš„æ‰€æœ‰memberéƒ½åˆ é™¤äº†ï¼Œåªç•™ä¸‹å‰5ç§’å†…çš„keyã€‚</p>
<p>â‘¡ ç»Ÿè®¡ç‰¹å®škeyä¸­å·²å­˜åœ¨çš„memberæœ‰å¤šå°‘ä¸ªã€‚</p>
<p>zSetæœ‰å¦‚ä¸‹å‘½ä»¤ï¼Œç”¨äºç»Ÿè®¡æŸä¸ªkeyçš„memberæ€»æ•°ï¼š</p>
<pre><code class="hljs language-css" lang="css">Â ZCARD <span class="hljs-selector-attr">[key]</span>
</code></pre>
<p>ç»Ÿè®¡çš„keyçš„memberæ€»æ•°ï¼Œå°±æ˜¯å½“å‰æ¥å£å·²ç»è®¿é—®çš„æ¬¡æ•°ã€‚å¦‚æœè¯¥æ•°ç›®å¤§äºé™æµæ¬¡æ•°ï¼Œåˆ™è¯´æ˜å½“å‰çš„è®¿é—®åº”è¢«é™æµã€‚</p>
<h2 data-id="heading-7">äºŒã€ä»£ç å®ç°</h2>
<p>ä¸»è¦æ˜¯ä½¿ç”¨æ³¨è§£ + AOPçš„å½¢å¼å®ç°ã€‚</p>
<h3 data-id="heading-8">2.1 å›ºå®šæ—¶é—´æ®µæ€è·¯</h3>
<p>ä½¿ç”¨äº†luaè„šæœ¬ã€‚</p>
<ul>
<li>å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43641418%2Farticle%2Fdetails%2F127764462" target="_blank" title="https://blog.csdn.net/qq_43641418/article/details/127764462" ref="nofollow noopener noreferrer">blog.csdn.net/qq_43641418â€¦</a></li>
</ul>
<h5 data-id="heading-9">2.1.1 é™æµæ³¨è§£</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)
<span class="hljs-variable">@Target</span>(ElementType.METHOD)
public <span class="hljs-variable">@interface</span> RateLimiter {

Â  Â  <span class="hljs-comment">/**
Â  Â  Â * é™æµæ—¶é—´ï¼Œå•ä½ç§’
Â  Â  Â */</span>
Â  Â  <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">time</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-number">5</span>;

Â  Â  <span class="hljs-comment">/**
Â  Â  Â * é™æµæ¬¡æ•°
Â  Â  Â */</span>
Â  Â  <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">count</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-number">10</span>;
}
</code></pre>
<h5 data-id="heading-10">2.1.2 å®šä¹‰luaè„šæœ¬</h5>
<p>åœ¨<code>resources/lua</code>ä¸‹æ–°å»º<code>limit.lua</code>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è·å–redisé”®</span>
<span class="hljs-keyword">local</span>Â key <span class="hljs-operator">=</span> KEYS[<span class="hljs-number">1</span>]
<span class="hljs-comment">-- è·å–ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆæ¬¡æ•°ï¼‰</span>
<span class="hljs-keyword">local</span>Â count <span class="hljs-operator">=</span> tonumber(ARGV[<span class="hljs-number">1</span>])
<span class="hljs-comment">-- è·å–ç¬¬äºŒä¸ªå‚æ•°ï¼ˆæ—¶é—´ï¼‰</span>
<span class="hljs-keyword">local</span>Â <span class="hljs-type">time</span> <span class="hljs-operator">=</span> tonumber(ARGV[<span class="hljs-number">2</span>])
<span class="hljs-comment">-- è·å–å½“å‰æµé‡</span>
<span class="hljs-keyword">local</span>Â <span class="hljs-keyword">current</span> <span class="hljs-operator">=</span> redis.call(<span class="hljs-string">'get'</span>, key);
<span class="hljs-comment">-- å¦‚æœcurrentå€¼å­˜åœ¨ï¼Œä¸”å€¼å¤§äºè§„å®šçš„æ¬¡æ•°ï¼Œåˆ™æ‹’ç»æ”¾è¡Œï¼ˆç›´æ¥è¿”å›å½“å‰æµé‡ï¼‰</span>
ifÂ <span class="hljs-keyword">current</span> <span class="hljs-keyword">and</span> tonumber(<span class="hljs-keyword">current</span>) <span class="hljs-operator">&gt;</span> countÂ <span class="hljs-keyword">then</span>
Â  Â Â <span class="hljs-keyword">return</span>Â tonumber(<span class="hljs-keyword">current</span>)
<span class="hljs-keyword">end</span>
<span class="hljs-comment">-- å¦‚æœå€¼å°äºè§„å®šæ¬¡æ•°ï¼Œæˆ–å€¼ä¸å­˜åœ¨ï¼Œåˆ™å…è®¸æ”¾è¡Œï¼Œå½“å‰æµé‡æ•°+1 Â (å€¼ä¸å­˜åœ¨æƒ…å†µä¸‹ï¼Œå¯ä»¥è‡ªå¢å˜ä¸º1)</span>
<span class="hljs-keyword">current</span> <span class="hljs-operator">=</span> redis.call(<span class="hljs-string">'incr'</span>, key);
<span class="hljs-comment">-- å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿›æ¥ï¼Œé‚£ä¹ˆå¼€å§‹è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ã€‚</span>
ifÂ tonumber(<span class="hljs-keyword">current</span>) <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">1</span>Â <span class="hljs-keyword">then</span>
Â  Â  redis.call(<span class="hljs-string">'expire'</span>, key, <span class="hljs-type">time</span>);
<span class="hljs-keyword">end</span>
<span class="hljs-comment">-- è¿”å›å½“å‰æµé‡</span>
<span class="hljs-keyword">return</span>Â tonumber(<span class="hljs-keyword">current</span>)
</code></pre>
<h5 data-id="heading-11">2.1.3 æ³¨å…¥Luaæ‰§è¡Œè„šæœ¬</h5>
<p>å…³é”®ä»£ç æ˜¯<code>limitScript()</code>æ–¹æ³•</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> {

Â  Â  <span class="hljs-meta">@Bean</span>
Â  Â  <span class="hljs-keyword">public</span> <span class="hljs-title class_">RedisTemplate</span>&lt;<span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span>&gt; <span class="hljs-title function_">redisTemplate</span>(<span class="hljs-params">RedisConnectionFactory connectionFactory</span>) {
Â  Â  Â  Â  <span class="hljs-title class_">RedisTemplate</span>&lt;<span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span>&gt; redisTemplate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>&lt;&gt;();
Â  Â  Â  Â  redisTemplate.<span class="hljs-title function_">setConnectionFactory</span>(connectionFactory);
Â  Â  Â  Â  <span class="hljs-comment">// ä½¿ç”¨Jackson2JsonRedisSerialize æ›¿æ¢é»˜è®¤åºåˆ—åŒ–(é»˜è®¤é‡‡ç”¨çš„æ˜¯JDKåºåˆ—åŒ–)</span>
Â  Â  Â  Â  <span class="hljs-title class_">Jackson2JsonRedisSerializer</span>&lt;<span class="hljs-title class_">Object</span>&gt; jackson2JsonRedisSerializer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(<span class="hljs-title class_">Object</span>.<span class="hljs-property">class</span>);
Â  Â  Â  Â  <span class="hljs-title class_">ObjectMapper</span> om = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
Â  Â  Â  Â  om.<span class="hljs-title function_">setVisibility</span>(<span class="hljs-title class_">PropertyAccessor</span>.<span class="hljs-property">ALL</span>, <span class="hljs-title class_">JsonAutoDetect</span>.<span class="hljs-property">Visibility</span>.<span class="hljs-property">ANY</span>);
Â  Â  Â  Â  om.<span class="hljs-title function_">enableDefaultTyping</span>(<span class="hljs-title class_">ObjectMapper</span>.<span class="hljs-property">DefaultTyping</span>.<span class="hljs-property">NON_FINAL</span>);
Â  Â  Â  Â  jackson2JsonRedisSerializer.<span class="hljs-title function_">setObjectMapper</span>(om);
Â  Â  Â  Â  redisTemplate.<span class="hljs-title function_">setKeySerializer</span>(jackson2JsonRedisSerializer);
Â  Â  Â  Â  redisTemplate.<span class="hljs-title function_">setValueSerializer</span>(jackson2JsonRedisSerializer);
Â  Â  Â  Â  redisTemplate.<span class="hljs-title function_">setHashKeySerializer</span>(jackson2JsonRedisSerializer);
Â  Â  Â  Â  redisTemplate.<span class="hljs-title function_">setHashValueSerializer</span>(jackson2JsonRedisSerializer);
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â redisTemplate;
Â  Â  }


Â  Â  <span class="hljs-comment">/**
Â  Â  Â * è§£æluaè„šæœ¬çš„bean
Â  Â  Â */</span>
Â  Â  <span class="hljs-meta">@Bean</span>(<span class="hljs-string">"limitScript"</span>)
Â  Â  <span class="hljs-keyword">public</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;<span class="hljs-title class_">Long</span>&gt;Â <span class="hljs-title function_">limitScript</span>(<span class="hljs-params"/>) {
Â  Â  Â  Â  <span class="hljs-title class_">DefaultRedisScript</span>&lt;<span class="hljs-title class_">Long</span>&gt; redisScript = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();
Â  Â  Â  Â  redisScript.<span class="hljs-title function_">setScriptSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceScriptSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">"lua/limit.lua"</span>)));
Â  Â  Â  Â  redisScript.<span class="hljs-title function_">setResultType</span>(<span class="hljs-title class_">Long</span>.<span class="hljs-property">class</span>);
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â redisScript;
Â  Â  }
}
</code></pre>
<h5 data-id="heading-12">2.1.3 å®šä¹‰Aopåˆ‡é¢ç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RateLimiterAspect</span> {
Â <span class="hljs-meta">@Autowired</span>
Â  Â  <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;
Â  Â  <span class="hljs-meta">@Autowired</span>
Â  Â  <span class="hljs-keyword">private</span> RedisScript&lt;Long&gt; limitScript;

Â <span class="hljs-meta">@Before("@annotation(rateLimiter)")</span>
Â  Â  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doBefore</span><span class="hljs-params">(JoinPoint point, RateLimiter rateLimiter)</span> <span class="hljs-keyword">throws</span> Throwable {
Â  Â  Â  Â  <span class="hljs-type">int</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> rateLimiter.time();
Â  Â  Â  Â  <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> rateLimiter.count();

Â  Â  Â  Â  <span class="hljs-type">String</span> <span class="hljs-variable">combineKey</span> <span class="hljs-operator">=</span> getCombineKey(rateLimiter.type(), point);
Â  Â  Â  Â  List&lt;String&gt; keys = Collections.singletonList(combineKey);
Â  Â  Â  Â  <span class="hljs-keyword">try</span> {
Â  Â  Â  Â  Â  Â  <span class="hljs-type">Long</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> (Long) redisTemplate.execute(limitScript, keys, count, time);
Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// å½“å‰æµé‡numberå·²è¶…è¿‡é™åˆ¶ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span>
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (number == <span class="hljs-literal">null</span> || number.intValue() &gt; count) {
Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è®¿é—®è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"</span>);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  log.info(<span class="hljs-string">"[limit] é™åˆ¶è¯·æ±‚æ•°'{}',å½“å‰è¯·æ±‚æ•°'{}',ç¼“å­˜key'{}'"</span>, count, number.intValue(), combineKey);
Â  Â  Â  Â  } <span class="hljs-keyword">catch</span> (Exception ex) {
Â  Â  Â  Â  Â  Â  ex.printStackTrace();
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"æœåŠ¡å™¨é™æµå¼‚å¸¸ï¼Œè¯·ç¨å€™å†è¯•"</span>);
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  <span class="hljs-comment">/**
Â  Â  Â * æŠŠç”¨æˆ·IPå’Œæ¥å£æ–¹æ³•åæ‹¼æ¥æˆ redis çš„ key
Â  Â  Â * <span class="hljs-doctag">@param</span> point åˆ‡å…¥ç‚¹
Â  Â  Â * <span class="hljs-doctag">@return</span>Â ç»„åˆkey
Â  Â  Â */</span>
Â  Â  <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getCombineKey</span><span class="hljs-params">(JoinPoint point)</span> {
Â  Â  Â  Â  <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-string">"rate_limit:"</span>);
Â  Â  Â  Â  <span class="hljs-type">ServletRequestAttributes</span> <span class="hljs-variable">attributes</span> <span class="hljs-operator">=</span> (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
Â  Â  Â  Â  <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> attributes.getRequest();
Â  Â  Â  Â  sb.append( Utils.getIpAddress(request) );
Â  Â  Â  Â Â 
Â  Â  Â  Â  <span class="hljs-type">MethodSignature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> (MethodSignature) point.getSignature();
Â  Â  Â  Â  <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> signature.getMethod();
Â  Â  Â  Â  Class&lt;?&gt; targetClass = method.getDeclaringClass();
Â  Â  Â  Â  <span class="hljs-comment">// keyPrefix +Â "-"Â + class +Â "-"Â + method</span>
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â sb.append(<span class="hljs-string">"-"</span>).append( targetClass.getName() )
Â  Â  Â  Â  Â  Â  Â  Â  .append(<span class="hljs-string">"-"</span>).append(method.getName()).toString();
Â  Â  }
}
</code></pre>
<h3 data-id="heading-13">2.2 æ»‘åŠ¨çª—å£æ€è·¯</h3>
<h5 data-id="heading-14">2.2.1 é™æµæ³¨è§£</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)
<span class="hljs-variable">@Target</span>(ElementType.METHOD)
public <span class="hljs-variable">@interface</span> RateLimiter {

Â  Â  <span class="hljs-comment">/**
Â  Â  Â * é™æµæ—¶é—´ï¼Œå•ä½ç§’
Â  Â  Â */</span>
Â  Â  <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">time</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-number">5</span>;

Â  Â  <span class="hljs-comment">/**
Â  Â  Â * é™æµæ¬¡æ•°
Â  Â  Â */</span>
Â  Â  <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">count</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-number">10</span>;
}
</code></pre>
<h5 data-id="heading-15">2.2.2 å®šä¹‰Aopåˆ‡é¢ç±»</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Slf4j</span>
<span class="hljs-variable">@Aspect</span>
<span class="hljs-variable">@Component</span>
public class RateLimiterAspect {

Â  Â  <span class="hljs-variable">@Autowired</span>
Â  Â  private RedisTemplate redisTemplate;

Â  Â  <span class="hljs-comment">/**
Â  Â  Â * å®ç°é™æµï¼ˆæ–°æ€è·¯ï¼‰
Â  Â  Â * @param point
Â  Â  Â * @param rateLimiter
Â  Â  Â * @throws Throwable
Â  Â  Â */</span>
Â  Â  <span class="hljs-variable">@SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>)
Â  Â  <span class="hljs-variable">@Before</span>(<span class="hljs-string">"@annotation(rateLimiter)"</span>)
Â  Â  public void <span class="hljs-built_in">doBefore</span>(JoinPoint point, RateLimiter rateLimiter) throws Throwable {
Â  Â  Â  Â  <span class="hljs-comment">// åœ¨ {time} ç§’å†…ä»…å…è®¸è®¿é—® {count} æ¬¡ã€‚</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">time</span> = <span class="hljs-selector-tag">rateLimiter</span><span class="hljs-selector-class">.time</span>();
Â  Â  Â  Â  <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">count</span> = <span class="hljs-selector-tag">rateLimiter</span><span class="hljs-selector-class">.count</span>();
Â  Â  Â  Â  <span class="hljs-comment">// æ ¹æ®ç”¨æˆ·IPï¼ˆå¯é€‰ï¼‰å’Œæ¥å£æ–¹æ³•ï¼Œæ„é€ key</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">combineKey</span> = <span class="hljs-selector-tag">getCombineKey</span>(rateLimiter.<span class="hljs-built_in">type</span>(), point);
Â  Â  Â  Â Â 
Â  Â  Â  Â  <span class="hljs-comment">// é™æµé€»è¾‘å®ç°</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">ZSetOperations</span> <span class="hljs-selector-tag">zSetOperations</span> = <span class="hljs-selector-tag">redisTemplate</span><span class="hljs-selector-class">.opsForZSet</span>();
Â  Â  Â  Â  <span class="hljs-comment">// è®°å½•æœ¬æ¬¡è®¿é—®çš„æ—¶é—´ç»“ç‚¹</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">currentMs</span> = <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.currentTimeMillis</span>();
Â  Â  Â  Â  <span class="hljs-selector-tag">zSetOperations</span><span class="hljs-selector-class">.add</span>(combineKey, currentMs, currentMs);
Â  Â  Â  Â  <span class="hljs-comment">// è¿™ä¸€æ­¥æ˜¯ä¸ºäº†é˜²æ­¢memberä¸€ç›´å­˜åœ¨äºå†…å­˜ä¸­</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">redisTemplate</span><span class="hljs-selector-class">.expire</span>(combineKey, time, TimeUnit.SECONDS);
Â  Â  Â  Â  <span class="hljs-comment">// ç§»é™¤{time}ç§’ä¹‹å‰çš„è®¿é—®è®°å½•ï¼ˆæ»‘åŠ¨çª—å£æ€æƒ³ï¼‰</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">zSetOperations</span><span class="hljs-selector-class">.removeRangeByScore</span>(combineKey, <span class="hljs-number">0</span>, currentMs - time * <span class="hljs-number">1000</span>);
Â  Â  Â  Â Â 
Â  Â  Â  Â  <span class="hljs-comment">// è·å¾—å½“å‰çª—å£å†…çš„è®¿é—®è®°å½•æ•°</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">Long</span> <span class="hljs-selector-tag">currCount</span> = <span class="hljs-selector-tag">zSetOperations</span><span class="hljs-selector-class">.zCard</span>(combineKey);
Â  Â  Â  Â  <span class="hljs-comment">// é™æµåˆ¤æ–­</span>
Â  Â  Â  Â Â <span class="hljs-selector-tag">if</span>Â (currCount &gt; count) {
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"[limit] é™åˆ¶è¯·æ±‚æ•°'{}',å½“å‰è¯·æ±‚æ•°'{}',ç¼“å­˜key'{}'"</span>, count, currCount, combineKey);
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-tag">throw</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">RuntimeException</span>(<span class="hljs-string">"è®¿é—®è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•!"</span>);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  <span class="hljs-comment">/**
Â  Â  Â * æŠŠç”¨æˆ·IPå’Œæ¥å£æ–¹æ³•åæ‹¼æ¥æˆ redis çš„ key
Â  Â  Â * @param point åˆ‡å…¥ç‚¹
Â  Â  Â * @returnÂ ç»„åˆkey
Â  Â  Â */</span>
Â  Â  <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">getCombineKey</span>(JoinPoint point) {
Â  Â  Â  Â  <span class="hljs-selector-tag">StringBuilder</span> <span class="hljs-selector-tag">sb</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">StringBuilder</span>(<span class="hljs-string">"rate_limit:"</span>);
Â  Â  Â  Â  <span class="hljs-selector-tag">ServletRequestAttributes</span> <span class="hljs-selector-tag">attributes</span> = (ServletRequestAttributes) <span class="hljs-selector-tag">RequestContextHolder</span><span class="hljs-selector-class">.getRequestAttributes</span>();
Â  Â  Â  Â  <span class="hljs-selector-tag">HttpServletRequest</span> <span class="hljs-selector-tag">request</span> = <span class="hljs-selector-tag">attributes</span><span class="hljs-selector-class">.getRequest</span>();
Â  Â  Â  Â  <span class="hljs-selector-tag">sb</span><span class="hljs-selector-class">.append</span>( Utils.<span class="hljs-built_in">getIpAddress</span>(request) );
Â  Â  Â  Â Â 
Â  Â  Â  Â  <span class="hljs-selector-tag">MethodSignature</span> <span class="hljs-selector-tag">signature</span> = (MethodSignature) <span class="hljs-selector-tag">point</span><span class="hljs-selector-class">.getSignature</span>();
Â  Â  Â  Â  <span class="hljs-selector-tag">Method</span> <span class="hljs-selector-tag">method</span> = <span class="hljs-selector-tag">signature</span><span class="hljs-selector-class">.getMethod</span>();
Â  Â  Â  Â  <span class="hljs-selector-tag">Class</span>&lt;?&gt; <span class="hljs-selector-tag">targetClass</span> = <span class="hljs-selector-tag">method</span><span class="hljs-selector-class">.getDeclaringClass</span>();
Â  Â  Â  Â  <span class="hljs-comment">// keyPrefix +Â "-"Â + class +Â "-"Â + method</span>
Â  Â  Â  Â Â <span class="hljs-selector-tag">return</span>Â <span class="hljs-selector-tag">sb</span><span class="hljs-selector-class">.append</span>(<span class="hljs-string">"-"</span>)<span class="hljs-selector-class">.append</span>( targetClass.<span class="hljs-built_in">getName</span>() )
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-selector-class">.append</span>(<span class="hljs-string">"-"</span>)<span class="hljs-selector-class">.append</span>(method.<span class="hljs-built_in">getName</span>())<span class="hljs-selector-class">.toString</span>();
Â  Â  }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[Spring] Springé…ç½®æ–‡ä»¶]]></title>    <link>https://juejin.cn/post/7579167622106873856</link>    <guid>https://juejin.cn/post/7579167622106873856</guid>    <pubDate>2025-12-03T06:33:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579167622106873856" data-draft-id="7579168400989667363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[Spring] Springé…ç½®æ–‡ä»¶"/> <meta itemprop="keywords" content="Spring,åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:33:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaæ°´è§£"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [Spring] Springé…ç½®æ–‡ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaæ°´è§£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:33:46.000Z" title="Wed Dec 03 2025 06:33:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">## 1.Â é…ç½®æ–‡ä»¶å¿«é€Ÿä¸Šæ‰‹</h2>
<p>æˆ‘ä»¬åœ¨å‰é¢è®²è§£Tomcatçš„æ—¶å€™,é»˜è®¤çš„ç«¯å£å·æ˜¯8080,å¦‚æœæˆ‘ä»¬æœ‰çš„ç¨‹åºè®¿é—®çš„ç«¯å£å·ä¹Ÿæ˜¯8080çš„æ—¶å€™,è¿™æ—¶å€™å°±ä¼šå‘ç”Ÿç«¯å£å·å†²çª,<em>æ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡é…ç½®æ–‡ä»¶æ¥ä¿®æ”¹ç¨‹åºè¿è¡Œæ—¶çš„ç«¯å£å·</em>.åœ¨é¡¹ç›®åˆ›å»ºçš„æ—¶å€™,å°±å¸®æˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªé…ç½®æ–‡ä»¶.ä»–çš„åç¼€æ˜¯<code>.properties</code>.<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91841eef96f5487daa5432379c3f99ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=Xhl72I3vV58ElSxgtRtns8CYgGI%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
æˆ‘ä»¬ç‚¹å¼€é…ç½®æ–‡ä»¶ä¿®æ”¹ç¨‹åºçš„ç«¯å£å·:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.application.name</span>=demo
<span class="hljs-attr">server.port</span>=<span class="hljs-number">9090</span>

AIå†™ä»£ç 
12
</code></pre>
<p>è¿è¡Œç¨‹åº:æˆ‘ä»¬å¯ä»¥å‘ç°ç¨‹åºçš„ç«¯å£å·å˜æˆäº†9090.<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd314c8106a64871a343b603a0fcbea2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=xFkMFY%2BnCi%2Fgs6pcAt%2B8cpNdyxQ%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
è¿™æ—¶å€™æˆ‘ä»¬é€šè¿‡8080ç«¯å£å·è®¿é—®å…¶ä¸­çš„htmlé¡µé¢çš„æ—¶å€™,å°±æ— æ³•è®¿é—®äº†.<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f04dc281a47042bf8fec19273d6d061a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=aDnSBDS7sI2TaUQE753TLiEyNAs%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. é…ç½®æ–‡ä»¶çš„æ ¼å¼</h3>
<p>SpringBootçš„é…ç½®æ–‡ä»¶æœ‰ä»¥ä¸‹ä¸‰ç§:<br/>
â€¢ application.properties<br/>
â€¢ application.yml<br/>
â€¢ application.yaml<br/>
å…¶ä¸­ymlæ ¼å¼å’Œyamlæ ¼å¼å…¶å®æ˜¯ç­‰åŒçš„.ymlæ˜¯yamlçš„ç¼©å†™.<br/>
<em>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯,é…ç½®æ–‡ä»¶çš„æ–‡ä»¶ååªèƒ½æ˜¯ä»¥ä¸Šä¸‰ä¸ª,æ–‡ä»¶åä¸€æ—¦ä¿®æ”¹,é…ç½®æ–‡ä»¶å°±ä¼šå˜æˆæ— æ•ˆé…ç½®æ–‡ä»¶</em>.</p>
<ul>
<li>
<p>ç‰¹æ®Šè¯´æ˜:</p>
<ol>
<li>å¦‚æœpropertieså’Œymlå­˜åœ¨äºåŒä¸€ä¸ªé¡¹ç›®çš„æ—¶å€™,ä¸¤ä¸ªé…ç½®éƒ½ä¼šåŠ è½½,ä½†æ˜¯å¦‚æœ<strong>é…ç½®æ–‡ä»¶å†…å®¹æœ‰å†²çªçš„æ—¶å€™,.propertiesæ–‡ä»¶çš„ä¼˜å…ˆçº§æ›´é«˜</strong>.</li>
<li>è™½ç„¶ä»–ä»¬å¯ä»¥å…±å­˜,ä½†æ˜¯æˆ‘ä»¬åœ¨å®é™…çš„ä¹Ÿä¸šåŠ¡å½“ä¸­,æˆ‘ä»¬ä¸€èˆ¬åªä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æ¥é…ç½®,è¿™æ ·å¯ä»¥æ›´å¥½çš„ç»´æŠ¤.</li>
</ol>
</li>
</ul>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3. propertiesé…ç½®æ–‡ä»¶çš„è¯´æ˜</h3>
<p>propertiesé…ç½®æ–‡ä»¶æ˜¯æœ€æ—©æœŸçš„é…ç½®æ–‡ä»¶æ ¼å¼ï¼Œä¹Ÿæ˜¯åˆ›å»ºSpringBooté¡¹ç›®é»˜è®¤çš„é…ç½®æ–‡ä»¶</p>
<h4 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.1 propertiesåŸºæœ¬è¯­æ³•</h4>
<p>propertiesæ˜¯ä»¥<em>é”®å€¼çš„å½¢å¼é…ç½®</em>çš„,å•è¯å’Œå•è¯ä¹‹é—´ç”¨<code>.</code>åˆ†å‰²,å°±åƒå¯¼åŒ…ä¸€æ ·.keyå’Œvalueä¹‹é—´æ˜¯ä»¥<code>=</code>è¿æ¥çš„.æ¯”å¦‚:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.application.name</span>=demo
<span class="hljs-attr">server.port</span>=<span class="hljs-number">9090</span>
<span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">3306</span>/mycnblog?characterEncoding=utf8&amp;useSSL=<span class="hljs-literal">false</span>
<span class="hljs-attr">spring.datasource.name</span>=root
<span class="hljs-attr">spring.datasource.password</span>=qwe123524

AIå†™ä»£ç 
12345
</code></pre>
<p>[æç¤º] é…ç½®æ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡åœ¨å‰é¢åŠ <code>#</code>æ¥æ³¨é‡Šä¿¡æ¯.</p>
<h4 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.2 è¯»å–é…ç½®æ–‡ä»¶</h4>
<p>å¦‚æœåœ¨é¡¹ç›®ä¸­,æƒ³è¦è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹,å¯ä»¥ä½¿ç”¨<code>@Value</code>æ³¨è§£æ¥å®ç°.<code>@Value</code>æ³¨è§£åœ¨åé¢çš„å‚æ•°ä¸­ä½¿ç”¨<code>${}</code>çš„æ ¼å¼æ¥è¯»å–,ä»£ç å¦‚ä¸‹:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(<span class="hljs-string">"/demo"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PropertiesController</span> {
    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${mykey.key}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String key;
    <span class="hljs-meta">@RequestMapping(<span class="hljs-string">"/key"</span>)</span>
    <span class="hljs-keyword">public</span> String key(){
        <span class="hljs-keyword">return</span> key;
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">12345678910</span>
</code></pre>
<p>è¿è¡Œç»“æœ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ff16092c25a4eafaeda1003e19d2148~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=nHvkPPfIy3MsNW9vV1CE1rlIVkE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.3 propertiesçš„ç¼ºç‚¹</h4>
<p>propertiesé…ç½®æ–‡ä»¶æ˜¯ä»¥key-Valueçš„å½¢å¼æ¥é…ç½®çš„,ä½†æ˜¯æœ‰çš„æ—¶å€™,é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯æœ‰äº›èµ˜ä½™,æ¯”å¦‚ä¸‹é¢çš„é…ç½®,<code>spring.datasource</code>è¿™ä¸ªå†…å®¹å°±æ˜¯èµ˜ä½™çš„:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">3306</span>/mycnblog?characterEncoding=utf8&amp;useSSL=<span class="hljs-literal">false</span>
<span class="hljs-attr">spring.datasource.name</span>=root
<span class="hljs-attr">spring.datasource.password</span>=qwe123524

AIå†™ä»£ç 
123
</code></pre>
<p>è¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜,æˆ‘ä»¬éœ€è¦å¼•å…¥ymlé…ç½®æ–‡ä»¶çš„æ ¼å¼äº†.</p>
<h3 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.ymlé…ç½®æ–‡ä»¶è¯´æ˜</h3>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.1 ymlåŸºæœ¬è¯­æ³•</h4>
<p>ymlæ˜¯æ ‘å½¢ç»“æ„çš„é…ç½®æ–‡ä»¶,ä»–çš„åŸºç¡€è¯­æ³•æ˜¯:<code>key: value</code>,éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯,<em>keyå’Œvalueä¹‹é—´çš„ç©ºæ ¼ä¸å¯ä»¥çœç•¥</em>.<br/>
åŸºç¡€è¯­æ³•å¦‚ä¸‹:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/208948300d234f9fa1d28e9bc0431758~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=z%2BhZJiRLWofRN2fHxJTjqcoxQuU%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
æˆ‘ä»¬çœ‹åˆ°,è¦æ˜¯ymlçš„é”®å€¼å¯¹ä¸­é—´æ²¡æœ‰ç©ºæ ¼çš„è¯,keyæ˜¯æ²¡æœ‰è¯­æ³•é«˜äº®çš„,è¯­æ³•å°±æ˜¯é”™è¯¯çš„.<br/>
ä¸‹é¢æˆ‘ä»¬å°±æŠŠä¸Šé¢è¿æ¥æ•°æ®åº“çš„æ¡ˆä¾‹æ”¹å†™ä¸ºymlçš„æ ¼å¼.</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://127.0.0.1:3306/mycnblog?characterEncoding=utf8&amp;useSSL=false</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">qwe123524</span>

<span class="hljs-string">AIå†™ä»£ç yml</span>
<span class="hljs-number">12345</span>
</code></pre>
<p>æˆ‘ä»¬çœ‹åˆ°,å‰é¢æˆ‘ä»¬æ‰€è¯´çš„"èµ˜ä½™"çš„ä¿¡æ¯,<em>åœ¨ymlä¸‹å¯ä»¥åˆå¹¶åˆ°ä¸€èµ·å†™äº†</em>.<strong>è¿™é‡Œè¡Œä¸è¡Œä¹‹é—´çš„ç¼©è¿›ä¸€èˆ¬æ˜¯ä¸¤ä¸ªç©ºæ ¼</strong>.</p>
<h4 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2 ymlä½¿ç”¨è¿›é˜¶</h4>
<h5 data-id="heading-9"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2.1 ymlé…ç½®ä¸åŒçš„æ•°æ®ç±»å‹åŠå…¶null</h5>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment"># å­—ç¬¦ä¸² </span>
<span class="hljs-keyword">string</span>.value: Hello
<span class="hljs-comment"># å¸ƒå°”å€¼ï¼Œtrueæˆ–false </span>
<span class="hljs-keyword">boolean</span>.value: <span class="hljs-literal">true</span>
<span class="hljs-keyword">boolean</span>.value1: <span class="hljs-literal">false</span>
<span class="hljs-comment"># æ•´æ•° </span>
<span class="hljs-keyword">int</span>.value: <span class="hljs-number">10</span>
<span class="hljs-comment"># æµ®ç‚¹æ•° </span>
<span class="hljs-keyword">float</span>.value: <span class="hljs-number">3.14159</span>
<span class="hljs-comment"># Nullï¼Œ~ä»£è¡¨null </span>
<span class="hljs-literal">null</span>.value: ~
<span class="hljs-comment"># "" ç©ºå­—ç¬¦ä¸² </span>
<span class="hljs-comment">#, ç›´æ¥åâ¾¯ä»€ä¹ˆéƒ½ä¸åŠ å°±å¯ä»¥äº†, ä½†è¿™ç§â½…å¼ä¸ç›´è§‚, æ›´å¤šçš„è¡¨â½°æ˜¯ä½¿â½¤å¼•å·æ‹¬èµ·æ¥ </span>
<span class="hljs-keyword">empty</span>.value: <span class="hljs-string">''</span>

AIå†™ä»£ç yml
<span class="hljs-number">1234567891011121314</span>
</code></pre>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„åœ°æ–¹åªæœ‰ä¸¤ç‚¹,ç¬¬ä¸€å°±æ˜¯<em>ç©ºå­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªå•å¼•å·,ç¬¬äºŒå°±æ˜¯nullç”¨ä¸€ä¸ªæ³¢æµªå·æ¥è¡¨ç¤º</em>.</p>
<h5 data-id="heading-10"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2.2 ymlé…ç½®è¯»å–</h5>
<p>ymlè¯»å–é…ç½®çš„æ–¹æ³•å’Œpropertiesç›¸åŒ,ä½¿ç”¨<code>@Value</code>æ³¨è§£å³å¯,å®ç°ä»£ç å¦‚ä¸‹:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">string:</span>
  <span class="hljs-attr">hello:</span> <span class="hljs-string">bite</span>

<span class="hljs-string">AIå†™ä»£ç yml</span>
<span class="hljs-number">12</span>
</code></pre>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@RequestMapping(<span class="hljs-string">"/demo"</span>)</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YmlController</span> {
    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${string.hello}</span>"</span>)</span>
    <span class="hljs-keyword">public</span> String hello;
    <span class="hljs-meta">@RequestMapping(<span class="hljs-string">"/hello99"</span>)</span>
    <span class="hljs-keyword">public</span> String hello(){
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.hello;
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">12345678910</span>
</code></pre>
<p>è¿è¡Œç»“æœ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cddfb323e7b4f30a5b5a8db083b3112~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=uDa0rJ%2BD0qrKxO3fQWCjsxWlwQk%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h5 data-id="heading-11"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2.3 æ³¨æ„äº‹é¡¹:valueå€¼ä½³å•å¼•å·å’ŒåŒå¼•å·</h5>
<p>å­—ç¬¦ä¸²é»˜è®¤ä¸ç”¨åŠ ä¸Šå•å¼•å·æˆ–è€…æ˜¯åŒå¼•å·,å¦‚æœåŠ äº†çš„è¯,æœ‰çš„æƒ…å†µä¸‹åˆä¼šè¡¨ç¤ºç‰¹æ®Šå«ä¹‰.<br/>
æ¯”å¦‚åœ¨ymlæ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹ä¿¡æ¯:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">string:</span>
  <span class="hljs-attr">str1:</span> <span class="hljs-string">Hello</span> <span class="hljs-string">\n</span> <span class="hljs-string">Spring</span> <span class="hljs-string">Boot.</span>
  <span class="hljs-attr">str2:</span> <span class="hljs-string">'Hello \n Spring Boot.'</span>
  <span class="hljs-attr">str3:</span> <span class="hljs-string">"Hello \n Spring Boot."</span>

<span class="hljs-string">AIå†™ä»£ç yml</span>
<span class="hljs-number">1234</span>
</code></pre>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadYml</span> {
    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${string.str1}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String str1;
    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${string.str2}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String str2;
    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${string.str3}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String str3;
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> String readYml(){
        System.<span class="hljs-keyword">out</span>.println(str1);
        System.<span class="hljs-keyword">out</span>.println(str2);
        System.<span class="hljs-keyword">out</span>.println(str3);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"yml"</span>;
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">12345678910111213141516</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ca2bd10685945ab8b8ad79fb0ad2df4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=14Nvu8uQ9w1VF4QOQt6d%2FzfnZ8Y%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°:</p>
<ol>
<li>å­—ç¬¦ä¸²é»˜è®¤ä¸ç”¨åŠ ä¸Šå•å¼•å·æˆ–è€…åŒå¼•å·</li>
<li>åŠ äº†å•å¼•å·ä¹‹å,<em>ç‰¹æ®Šå­—ç¬¦ä¼šè¢«è½¬ä¹‰,åªè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²,åŠ äº†åŒå¼•å·ä¹‹å,ç‰¹æ®Šå­—ç¬¦ä¸ä¼šè¢«è½¬ä¹‰</em>.</li>
</ol>
<blockquote>
<p>æ³¨æ„:è¿™é‡Œçš„è½¬ä¹‰è¯´èµ·æ¥å¯èƒ½ä¼šæœ‰äº›æ‹—å£,\næœ¬æ¥è¡¨ç¤ºçš„æ˜¯æ¢è¡Œ,ä½¿ç”¨å•å¼•å·å‘ç”Ÿäº†è½¬ä¹‰,ä¹Ÿå°±æ˜¯è¯´,\nä¸å†è¡¨ç¤ºæ¢è¡Œäº†,è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²,è€ŒåŠ äº†åŒå¼•å·ä¹‹åå°±è¡¨ç¤ºçš„æ˜¯ç‰¹æ®Šå­—ç¬¦çš„æœ¬æ„,æ²¡æœ‰å‘ç”Ÿè½¬ä¹‰.</p>
</blockquote>
<blockquote>
<p>æˆ‘ä»¬æ¥è¯´æ˜ä¸€ä¸‹<code>@PostConstruct</code>è¿™ä¸ªæ³¨è§£,è¿™ä¸ªæ³¨è§£è¡¨ç¤ºçš„æ˜¯,åœ¨æœåŠ¡å¯åŠ¨ä¹‹å,<strong>è¿™ä¸ªæ–¹æ³•ä¼šå˜ä¸ºåˆå§‹åŒ–æ–¹æ³•</strong>,è¿™ä¸ªæ–¹æ³•åœ¨åç«¯ç«‹å³å°±ä¼šæ‰§è¡Œ,å¦‚æœæœ‰æ‰“å°ä¿¡æ¯çš„è¯,ä¼šç«‹å³æ‰“å°åœ¨åç«¯çš„æ§åˆ¶å°ä¸Š.ç›¸æ¯”äºä½¿ç”¨<code>@RequestMapping</code>æ³¨è§£,æˆ‘ä»¬å°±ä¸éœ€è¦é€šè¿‡æµè§ˆå™¨æ¥è®¿é—®æœ€ç»ˆç»“æœäº†,æˆ‘ä»¬åªéœ€è¦åœ¨åç«¯çš„æ§åˆ¶å°ä¸Šçœ‹æœ€ç»ˆçš„ç»“æœå³å¯.</p>
</blockquote>
<h5 data-id="heading-12"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2.4 é…ç½®å¯¹è±¡</h5>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨ymlä¸­é…ç½®å¯¹è±¡.å¦‚ä¸‹é…ç½®:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">student:</span>
  <span class="hljs-attr">id:</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">java</span>
  <span class="hljs-attr">age:</span> <span class="hljs-number">20</span>

<span class="hljs-string">AIå†™ä»£ç yml</span>
<span class="hljs-number">1234</span>
</code></pre>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±ä¸å¯ä»¥ç”¨<code>@Value</code>æ¥é…ç½®å¯¹è±¡äº†,æ­¤æ—¶å°±è¦ä½¿ç”¨åˆ°å¦ä¸€ä¸ªæ³¨è§£:<code>@ConfigurationProperties</code>æ¥è¯»å–.å…·ä½“å®ç°å¦‚ä¸‹:</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Component</span>
<span class="hljs-variable">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"student"</span>)
<span class="hljs-variable">@Data</span>
public class Student {
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Integer</span> <span class="hljs-selector-tag">id</span>;
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">name</span>;
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Integer</span> <span class="hljs-selector-tag">age</span>;
}

<span class="hljs-selector-tag">AI</span>å†™ä»£ç <span class="hljs-selector-tag">java</span>
è¿è¡Œ
<span class="hljs-number">12345678</span>
</code></pre>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Student</span> student;
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">readStudent</span>(<span class="hljs-params"/>){
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(student);
    }
}

<span class="hljs-variable constant_">AI</span>å†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789</span>
</code></pre>
<p>è¿è¡Œç»“æœ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcf771fe9f95428881ff6c1c2cbe5ce1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=XCdT%2FWzMBQ6FHe5wxI%2BvwY46izY%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
[æ³¨æ„äº‹é¡¹]</p>
<ol>
<li>åœ¨ä¸€ä¸ªç±»ä¸­ç»™å¯¹è±¡ä¸­çš„å±æ€§èµ‹å€¼çš„æ—¶å€™,<em>è¿™ä¸ªç±»å¿…é¡»æœ‰Setæ–¹æ³•</em>,æ‰€ä»¥æˆ‘ä»¬æ‰è¦åœ¨ç±»çš„å¤´ä¸ŠåŠ ä¸Š<code>@Data</code>æ³¨è§£,æˆ‘ä»¬ä¸‹é¢ä¸å¼•å…¥æ³¨è§£,æ‰‹åŠ¨å†™å…¥Setæ–¹æ³•,æ¥éªŒè¯è¿™ç§è¯´æ³•çš„å¯é æ€§.</li>
</ol>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"student"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Integer</span> id;
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> name;
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Integer</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setId</span>(<span class="hljs-params">Integer id</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setAge</span>(<span class="hljs-params">Integer age</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">toString</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Student{"</span> +
                <span class="hljs-string">"id="</span> + id +
                <span class="hljs-string">", name='"</span> + name + <span class="hljs-string">''</span><span class="hljs-string">' +
                ", age=" + age +
                '</span>}<span class="hljs-string">';
    }
}

AIå†™ä»£ç java
è¿è¡Œ
12345678910111213141516171819202122232425262728
</span></code></pre>
<p>è¿è¡Œç»“æœ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c5166c9f48f422fabd4eb50675f8af0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=JnJf%2FIg1bsM0bCjWUN9Pz%2B9g2kc%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<ol start="2">
<li>åœ¨ç±»çš„å±æ€§ä¸­,<em>å±æ€§åå¿…é¡»å’Œymlä¸­çš„å­—æ®µåæ˜¯ä¸€è‡´çš„.å¦åˆ™æ— æ³•å¯¹åº”çš„ä¸Š</em>.</li>
</ol>
<h5 data-id="heading-13"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2.5 é…ç½®é›†åˆ</h5>
<p>é…ç½®æ–‡ä»¶è¿˜å¯ä»¥é…ç½®Listé›†åˆ,(åŒ…æ‹¬æ•°ç»„,Setåœ¨å†…éƒ½æ˜¯å¦‚ä¸‹çš„æ–¹æ³•)å¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="hljs language-markdown" lang="markdown">dbtypes:
  name:
<span class="hljs-bullet">    -</span> mysql
<span class="hljs-bullet">    -</span> sqlserver
<span class="hljs-bullet">    -</span> db2

AIå†™ä»£ç yml
12345
</code></pre>
<p>å°±æ˜¯åœ¨æ¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„å‰é¢åŠ ä¸Šä¸€ä¸ªæ¨ªæ ,å°±è¡¨ç¤ºçš„æ˜¯åˆ—è¡¨,å’Œmdçš„è¯­æ³•éå¸¸ç›¸ä¼¼.</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@ConfigurationProperties(prefix = "dbtypes")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ListConfig</span> {
    <span class="hljs-keyword">public</span> List&lt;String&gt; name;<span class="hljs-comment">//å¯¹åº”nameå­—æ®µ</span>
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">1234567</span>
</code></pre>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadYml2</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ListConfig</span> listConfig;
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">readList</span>(<span class="hljs-params"/>){
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(listConfig);
    }
}

<span class="hljs-variable constant_">AI</span>å†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789</span>
</code></pre>
<p>è¿è¡Œç»“æœ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f08c7a390e145fea4b6c73ac8750e0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=QSJIFcUr2yK0PjHteVDBPdbzHNA%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
åœ¨é…ç½®é›†åˆçš„æ—¶å€™,ä¸Šè¿°ä»£ç å®é™…ä¸Šä¹Ÿæ˜¯åœ¨é…ç½®ä¸€ä¸ªå¯¹è±¡,æ‰€ä»¥ä»ç„¶ä½¿ç”¨<code>@ConfigurationProperties</code>æ³¨è§£.</p>
<h5 data-id="heading-14"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2.6 é…ç½®map</h5>
<p>é…ç½®æ–‡ä»¶ä¹Ÿå¯ä»¥é…ç½®map,å¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">maptypes:</span>
  <span class="hljs-attr">map:</span>
    <span class="hljs-attr">k1:</span> <span class="hljs-string">v1</span>
    <span class="hljs-attr">k2:</span> <span class="hljs-string">v2</span>
    <span class="hljs-attr">k3:</span> <span class="hljs-string">v3</span>

<span class="hljs-string">AIå†™ä»£ç yml</span>
<span class="hljs-number">12345</span>
</code></pre>

<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Component</span>
<span class="hljs-variable">@Data</span>
<span class="hljs-variable">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"maptypes"</span>)
public class MapConfig {
    <span class="hljs-comment">//æ³¨æ„å­—æ®µåçš„ä¸€è‡´æ€§</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>,<span class="hljs-selector-tag">String</span>&gt; <span class="hljs-selector-tag">map</span>;
}

<span class="hljs-selector-tag">AI</span>å†™ä»£ç <span class="hljs-selector-tag">java</span>
è¿è¡Œ
<span class="hljs-number">1234567</span>
</code></pre>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadYml3</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">public</span> MapConfig mapConfig;
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> void mapReader(){
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">this</span>.mapConfig);
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789</span>
</code></pre>
<p>è¿è¡Œç»“æœ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74a84c2a97464ee19daa7639a26ab808~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=QFlAJY1FpVnN%2FHQbxI7nfVpnraA%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-15"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5. ç»¼åˆæ€§ç»ƒä¹ :éªŒè¯ç æ¡ˆä¾‹</h3>
<h4 data-id="heading-16"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.1 æ¥å£æ–‡æ¡£</h4>
<ul>
<li>
<p>éœ€æ±‚åˆ†æ</p>
<ol>
<li>ç”ŸæˆéªŒè¯ç ,å¹¶è¿”å›éªŒè¯ç </li>
<li>æ ¡éªŒéªŒè¯ç æ˜¯å¦æ­£ç¡®:æ ¡éªŒéªŒè¯ç æ˜¯å¦æ­£ç¡®.</li>
</ol>
</li>
<li>
<p>ç”ŸæˆéªŒè¯ç :</p>
<ul>
<li>è¯·æ±‚</li>
</ul>

<pre><code class="hljs language-javascript" lang="javascript">è¯·æ±‚<span class="hljs-attr">url</span>: <span class="hljs-regexp">/captcha/g</span>etCaptcha
è¯·æ±‚å‚æ•°: æ— 

<span class="hljs-variable constant_">AI</span>å†™ä»£ç 
<span class="hljs-number">12</span>
</code></pre>
<ul>
<li>å“åº”<br/>
éªŒè¯ç å†…å®¹çš„å›¾ç‰‡.æµè§ˆå™¨ç»™æœåŠ¡å™¨å‘é€â¼€ä¸ª/captcha/getCaptcha è¿™æ ·çš„è¯·æ±‚,æœåŠ¡å™¨è¿”å›â¼€ä¸ªå›¾ç‰‡,æµè§ˆå™¨æ˜¾æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š.</li>
</ul>
</li>
<li>
<p>æ ¡éªŒéªŒè¯ç æ˜¯å¦æ­£ç¡®</p>
<ul>
<li>è¯·æ±‚</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">è¯·æ±‚url: /captcha/check
è¯·æ±‚å‚æ•°: <span class="hljs-attr">captcha</span>=ç”¨æˆ·è¾“å…¥çš„éªŒè¯ç 

AIå†™ä»£ç 
12
</code></pre>
<ul>
<li>å“åº”<br/>
true or false,éªŒè¯æˆåŠŸ,è¿”å›true,éªŒè¯å¤±è´¥,è¿”å›false.</li>
</ul>
</li>
</ul>
<h4 data-id="heading-17"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.2Â Hutoolå·¥å…·ä»‹ç»</h4>
<h4 data-id="heading-18"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.3 åç«¯ä»£ç </h4>
<ol>
<li>å¼•å…¥Hutoolä¾èµ–</li>
</ol>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hutool-captcha<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.8.22<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

AIå†™ä»£ç xml
12345
</code></pre>
<p>2.  å†™å‡ºéªŒè¯ç çš„é…ç½®é¡¹ä¸éªŒè¯ç é…ç½®é¡¹æ‰€å¯¹åº”çš„ç±».å¹¶æ³¨å…¥IoCå®¹å™¨.</p>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">captcha:</span>
  <span class="hljs-attr">width:</span> <span class="hljs-number">100</span>
  <span class="hljs-attr">height:</span> <span class="hljs-number">40</span>
  <span class="hljs-attr">session:</span>
    <span class="hljs-attr">key:</span> <span class="hljs-string">CAPTCHA_SESSION_KEY</span>
    <span class="hljs-attr">date:</span> <span class="hljs-string">KAPTCHA_SESSION_DATE</span>

<span class="hljs-string">AIå†™ä»£ç yml</span>
<span class="hljs-number">123456</span>
</code></pre>
<p>é…ç½®é¡¹ä¸­å¯¹åº”çš„åˆ†åˆ«æ˜¯éªŒè¯ç çš„é•¿å’Œå®½,è¿˜æœ‰<strong>ç”¨äºå­˜å‚¨éªŒè¯ç å’Œè¿‡æœŸæ—¶é—´</strong>.</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Component</span>
<span class="hljs-variable">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"captcha"</span>)
<span class="hljs-variable">@Data</span>
public class CaptchaProperties {
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Integer</span> <span class="hljs-selector-tag">width</span>;
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Integer</span> <span class="hljs-selector-tag">height</span>;
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Session</span> <span class="hljs-selector-tag">session</span>;
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Session</span>{
        <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">key</span>;
        <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">date</span>;
    }
}

<span class="hljs-selector-tag">AI</span>å†™ä»£ç <span class="hljs-selector-tag">java</span>
è¿è¡Œ
<span class="hljs-number">123456789101112</span>
</code></pre>
<p>3.  è°ƒæ•´ç”ŸæˆéªŒè¯ç çš„Controllerä»£ç </p>

<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/captcha"</span>)
public class CaptchaController {
    <span class="hljs-variable">@Autowired</span>
    public CaptchaProperties captchaProperties;
    <span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/getCaptcha"</span>)
    public void <span class="hljs-built_in">getCaptcha</span>(HttpServletResponse response, HttpSession session) throws IOException {<span class="hljs-comment">//å¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°æ‹¿åˆ°å“åº”ä¸­çš„æ‰€æœ‰ä¿¡æ¯</span>
        <span class="hljs-selector-tag">LineCaptcha</span> <span class="hljs-selector-tag">lineCaptcha</span> = <span class="hljs-selector-tag">CaptchaUtil</span><span class="hljs-selector-class">.createLineCaptcha</span>(captchaProperties.<span class="hljs-built_in">getWidth</span>(),captchaProperties.<span class="hljs-built_in">getHeight</span>());<span class="hljs-comment">//åˆ›å»ºçº¿æ¡å¹²æ‰°éªŒè¯ç </span>
        <span class="hljs-comment">//å›¾å½¢éªŒè¯ç å†™å‡ºï¼Œå¯ä»¥å†™å‡ºåˆ°æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å†™å‡ºåˆ°æµ</span>
        <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.setContentType</span>(<span class="hljs-string">"image/jpeg"</span>);<span class="hljs-comment">//ä»å“åº”ä¸­è·å–åˆ°ç±»å‹ä¿¡æ¯,è®¾ç½®ä¸ºå›¾ç‰‡æ ¼å¼</span>
        <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.setHeader</span>(<span class="hljs-string">"Pragma"</span>,<span class="hljs-string">"No-cache"</span>);<span class="hljs-comment">//ä»å“åº”ä¸­è·å–åˆ°Header,æŠŠPragmaé”®å€¼å¯¹è®¾ç½®ä¸ºæ²¡æœ‰ç¼“å­˜.</span>
        <span class="hljs-selector-tag">try</span> {
            <span class="hljs-selector-tag">lineCaptcha</span><span class="hljs-selector-class">.write</span>(response.<span class="hljs-built_in">getOutputStream</span>());
            <span class="hljs-comment">//æŠŠéªŒè¯ç æ”¾å…¥sessionä¸­</span>
            <span class="hljs-selector-tag">session</span><span class="hljs-selector-class">.setAttribute</span>(captchaProperties.<span class="hljs-built_in">getSession</span>().<span class="hljs-built_in">getKey</span>(),lineCaptcha.<span class="hljs-built_in">getCode</span>());
            <span class="hljs-comment">//æŠŠè¿‡æœŸæ—¶é—´æ”¾å…¥sessionä¸­</span>
            <span class="hljs-selector-tag">session</span><span class="hljs-selector-class">.setAttribute</span>(captchaProperties.<span class="hljs-built_in">getSession</span>().<span class="hljs-built_in">getDate</span>(),System.<span class="hljs-built_in">currentTimeMillis</span>());
            <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.getOutputStream</span>()<span class="hljs-selector-class">.close</span>();<span class="hljs-comment">//å…³é—­è¾“å‡ºæµ</span>
        } <span class="hljs-selector-tag">catch</span> (IOException e) {
            <span class="hljs-selector-tag">throw</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">RuntimeException</span>(e);
        }
    }
}

<span class="hljs-selector-tag">AI</span>å†™ä»£ç <span class="hljs-selector-tag">java</span>
è¿è¡Œ
<span class="hljs-number">1234567891011121314151617181920212223</span>
</code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è®¿é—®ç½‘é¡µæ¥è§‚å¯ŸéªŒè¯ç æ˜¯å¦ç”ŸæˆæˆåŠŸ.<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2a8b60400384253ae6da6a19cb80405~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=GDFGGdstt4X3SPchid9JLp0Vq74%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
éªŒè¯ç ç”ŸæˆæˆåŠŸ.</p>
<ol start="4">
<li>æ ¡éªŒéªŒè¯ç </li>
</ol>

<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">MAX_WAIT_MILLS</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span>*<span class="hljs-number">1000</span>;
    <span class="hljs-meta">@RequestMapping("/check")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkCaptcha</span><span class="hljs-params">(HttpSession session,String captcha)</span>{
       <span class="hljs-keyword">if</span> (!StringUtils.hasLength(captcha)){<span class="hljs-comment">//åˆ¤æ–­éªŒè¯ç æ˜¯å¦æœ‰é•¿åº¦</span>
           <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
       }
       <span class="hljs-type">String</span> <span class="hljs-variable">sessionCode</span> <span class="hljs-operator">=</span> (String) session.getAttribute(captchaProperties.getSession().getKey());
       <span class="hljs-type">Long</span> <span class="hljs-variable">sessionDate</span> <span class="hljs-operator">=</span> (Long) session.getAttribute(captchaProperties.getSession().getDate());
       <span class="hljs-keyword">if</span> (captcha.equalsIgnoreCase(sessionCode) &amp;&amp;
       System.currentTimeMillis()-sessionDate &lt; MAX_WAIT_MILLS){
           <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<span class="hljs-comment">//éªŒè¯ç å’Œç”¨æˆ·è¾“å…¥çš„ç­‰åŒä¸”</span>
       }
       <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">1234567891011121314</span>
</code></pre>
<h4 data-id="heading-19"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.4 å‰ç«¯ä»£ç </h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>éªŒè¯ç <span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-id">#inputCaptcha</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">vertical-align</span>: middle; 
    }
    <span class="hljs-selector-id">#verificationCodeImg</span>{
      <span class="hljs-attribute">vertical-align</span>: middle; 
    }
    <span class="hljs-selector-id">#checkCaptcha</span>{
      <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>è¾“å…¥éªŒè¯ç <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"confirm"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"inputCaptcha"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"inputCaptcha"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"verificationCodeImg"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/captcha/getCaptcha"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"cursor: pointer;"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"çœ‹ä¸æ¸…ï¼Ÿæ¢ä¸€å¼ "</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"æäº¤"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"checkCaptcha"</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    
    $(<span class="hljs-string">"#verificationCodeImg"</span>).<span class="hljs-title function_">click</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
      $(<span class="hljs-variable language_">this</span>).<span class="hljs-title function_">hide</span>().<span class="hljs-title function_">attr</span>(<span class="hljs-string">'src'</span>, <span class="hljs-string">'/captcha/getCaptcha?dt='</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()).<span class="hljs-title function_">fadeIn</span>();
    });

    $(<span class="hljs-string">"#checkCaptcha"</span>).<span class="hljs-title function_">click</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
      $.<span class="hljs-title function_">ajax</span>({
        <span class="hljs-attr">url</span>: <span class="hljs-string">"/captcha/check"</span>,
        <span class="hljs-attr">type</span>: <span class="hljs-string">"post"</span>,
        <span class="hljs-attr">data</span>: { <span class="hljs-attr">captcha</span>: $(<span class="hljs-string">"#inputCaptcha"</span>).<span class="hljs-title function_">val</span>() },
        <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) {
          <span class="hljs-keyword">if</span> (result) {
            location.<span class="hljs-property">href</span> = <span class="hljs-string">"success.html"</span>;
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_">alert</span>(<span class="hljs-string">"éªŒè¯ç é”™è¯¯"</span>);
            $(<span class="hljs-string">"#inputCaptcha"</span>).<span class="hljs-title function_">val</span>(<span class="hljs-string">""</span>);
          }
        }
      });
    });

  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

AIå†™ä»£ç html
1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556
</code></pre>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>éªŒè¯æˆåŠŸé¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>éªŒè¯æˆåŠŸ<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

AIå†™ä»£ç html
1234567891011
</code></pre>
<p>æµ‹è¯•è¿è¡Œ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2af944ac1861404da29d942d9b199a33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=H8cu5HTRw%2FGCumeO8uFXM8wqnWc%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44a6a972fde7496eabf72bc3a2eb6c46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=p4ETdkOO5gKVSRU2t%2B2LtbNCZAU%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½•æºæ˜æ–°ä½œï¼šæ‰©æ•£æ¨¡å‹+Transformeræ‰æ˜¯ç‹ç‚¸ï¼]]></title>    <link>https://juejin.cn/post/7579176524131909683</link>    <guid>https://juejin.cn/post/7579176524131909683</guid>    <pubDate>2025-12-03T06:32:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579176524131909683" data-draft-id="7579176524131893299" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½•æºæ˜æ–°ä½œï¼šæ‰©æ•£æ¨¡å‹+Transformeræ‰æ˜¯ç‹ç‚¸ï¼"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-12-03T06:32:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ™ºæ³ŠAI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½•æºæ˜æ–°ä½œï¼šæ‰©æ•£æ¨¡å‹+Transformeræ‰æ˜¯ç‹ç‚¸ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ™ºæ³ŠAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:32:59.000Z" title="Wed Dec 03 2025 06:32:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½•æºæ˜å›¢é˜Ÿå†æ¬¡æ¨å‡ºåˆ›æ–°æˆæœï¼Œå»¶ç»­å…¶"å›å½’æœ¬è´¨"çš„ç ”ç©¶ç†å¿µï¼Œæå‡º"Just image Transformers"ï¼ˆJiTï¼‰æ¡†æ¶ã€‚</p>
<p>è¯¥æŠ€æœ¯çªç ´æ€§åœ°ä½¿æ‰©æ•£æ¨¡å‹èƒ½å¤Ÿç›´æ¥ç”Ÿæˆæ¸…æ™°å›¾åƒï¼Œè€Œéä¼ ç»Ÿå™ªå£°æˆ–å«å™ªé‡é¢„æµ‹ï¼Œä¸ºé«˜ç»´è‡ªç„¶æ•°æ®ç”Ÿæˆå¼€è¾Ÿäº†æ›´ç®€æ´é«˜æ•ˆçš„è·¯å¾„ã€‚</p>
<p>"æ‰©æ•£æ¨¡å‹+Transformer"æ¶æ„å‡­å€Ÿå…¶å“è¶Šçš„ç”Ÿæˆè´¨é‡ã€å¼ºå¤§çš„æ‰©å±•æ€§å’Œç²¾å‡†çš„å¤šæ¨¡æ€æ§åˆ¶èƒ½åŠ›ï¼Œç›®å‰å·²å¹¿æ³›åº”ç”¨äºé«˜åˆ†è¾¨ç‡å›¾åƒç”Ÿæˆã€ä¸‰ç»´é‡å»ºä»¥åŠè‡ªç›‘ç£å»å™ªç­‰å¤šä¸ªå‰æ²¿é¢†åŸŸï¼Œæˆä¸ºå­¦æœ¯ç•ŒæŒç»­èšç„¦çš„ç ”ç©¶çƒ­ç‚¹ã€‚</p>
<p>è¿™ä¸€æŠ€æœ¯ç»„åˆæ­£æ¨åŠ¨ç€ç”Ÿæˆå¼AIçš„è¾¹ç•Œä¸æ–­æ‰©å±•ã€‚</p>
<p><strong>DDT: Decoupled Diffusion Transformer</strong></p>
<p>ä¸»è¦å†…å®¹ï¼š</p>
<p>æœ¬ç ”ç©¶åˆ›æ–°æ€§åœ°å¼•å…¥è§£è€¦æ‰©æ•£ Transformerï¼ˆDDTï¼‰ï¼Œå…¶é‡‡ç”¨ä¸“ç”¨æ¡ä»¶ç¼–ç å™¨å®ç°è¯­ä¹‰ç‰¹å¾æå–ï¼Œç»“åˆé€Ÿåº¦è§£ç å™¨ç²¾å‡†è¿˜åŸé«˜é¢‘ç»†èŠ‚ï¼Œä»è€Œæœ‰æ•ˆå…‹æœä¼ ç»Ÿæ¨¡å‹çš„ä¼˜åŒ–ç“¶é¢ˆã€‚</p>
<p>å®éªŒç»“æœè¡¨æ˜ï¼Œåœ¨ ImageNet æ•°æ®é›†ä¸Šï¼Œè¯¥æ¨¡å‹åœ¨ 256Ã—256 åˆ†è¾¨ç‡ä¸‹å–å¾— FID 1.31ï¼Œ512Ã—512 åˆ†è¾¨ç‡ä¸‹ FID é™è‡³ 1.28ï¼ŒåŒæ—¶è®­ç»ƒæ”¶æ•›é€Ÿåº¦æ˜¾è‘—æå‡è‡³ 4 å€ï¼Œå¹¶å€ŸåŠ©ç»Ÿè®¡åŠ¨æ€è§„åˆ’æŠ€æœ¯è¿›ä¸€æ­¥ä¼˜åŒ–æ¨ç†æ•ˆç‡ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c91bd836139494b8fc8bb7874204ed3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348378&amp;x-signature=dH2sb3SrsHH4v4r%2Bch4hMbW1dH4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>The Ingredients for Robotic Diffusion Transformers</strong></p>
<p>ä¸»è¦å†…å®¹ï¼š</p>
<p>é¢å‘æœºå™¨äººæ“ä½œä»»åŠ¡ï¼Œæœ¬ç ”ç©¶è®¾è®¡DiT-Block Policyæ¶æ„ï¼Œç»“åˆTransformerçš„å¯æ‰©å±•ä¼˜åŠ¿ä¸æ‰©æ•£æ¨¡å‹çš„ç”Ÿæˆç‰¹æ€§ã€‚</p>
<p>é€šè¿‡adaLN-Zeroæ³¨æ„åŠ›å—å®ç°è®­ç»ƒç¨³å®šæ€§ï¼Œåˆ©ç”¨ResNetæ¶æ„å¤„ç†å¤šè§†è§’ç›¸æœºè¾“å…¥ï¼Œåœ¨åŒè‡‚ALOHAä¸å•è‡‚Frankaæœºå™¨äººå¹³å°éªŒè¯å¤šä»»åŠ¡æ‰§è¡Œèƒ½åŠ›ï¼Œæ€§èƒ½è¾ƒç°æœ‰åŸºçº¿æå‡20%ï¼Œå¹¶å…¬å¼€BiPlayè¯­è¨€æ ‡æ³¨æ•°æ®é›†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a0f5f484c7548b5bd6a00b5d2e0699f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348378&amp;x-signature=Ov1eoA8iJpQPe7LIGZku9JgB7Gs%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>TinyFusion: Diffusion Transformers Learned Shallow</strong></p>
<p>ä¸»è¦å†…å®¹ï¼š</p>
<p>ç ”ç©¶å›¢é˜Ÿåˆ›æ–°æ€§åœ°å¼€å‘äº†æ·±åº¦å‰ªææ¡†æ¶TinyFusionï¼Œè¯¥æ–¹æ³•é‡‡ç”¨å¯å¾®åˆ†é‡‡æ ·æŠ€æœ¯å¹¶ç»“åˆå‚æ•°è”åˆä¼˜åŒ–ç­–ç•¥ï¼Œæœ‰æ•ˆè¯†åˆ«å¹¶å‹ç¼©æ‰©æ•£Transformerä¸­çš„å†—ä½™å±‚çº§ã€‚</p>
<p>åœ¨æ˜¾è‘—é™ä½è®¡ç®—èµ„æºéœ€æ±‚çš„å‰æä¸‹ï¼ˆä»…éœ€7%çš„åŸå§‹é¢„è®­ç»ƒæˆæœ¬ï¼‰ï¼Œè¯¥æŠ€æœ¯æˆåŠŸæ¨åŠ¨DiT-XLæ¨¡å‹FIDæŒ‡æ ‡ä¼˜åŒ–è‡³2.86ï¼ŒåŒæ—¶åœ¨DiTã€MARç­‰å¤šç§æ¶æ„ä¸­å®ç°æ¨ç†é€Ÿåº¦æå‡2å€ã€‚</p>
<p>æ­¤å¤–ï¼Œé€šè¿‡å¼•å…¥æ©ç çŸ¥è¯†è’¸é¦æœºåˆ¶ï¼Œè¿›ä¸€æ­¥å¼ºåŒ–äº†æ¨¡å‹æ€§èƒ½çš„æ¢å¤èƒ½åŠ›ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92b33c761dcc4b6a8f401dc50cb0dd8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348378&amp;x-signature=odCaBHzF6%2F%2FzGEglBvDze2YHes4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>Effective Diffusion Transformer Architecture for Image Super-Resolution</strong></p>
<p>ä¸»è¦å†…å®¹ï¼š</p>
<p>è®¾è®¡ç”¨äºå›¾åƒè¶…åˆ†è¾¨ç‡çš„æ‰©æ•£ Transformerï¼ˆDiT-SRï¼‰ï¼Œåˆ›æ–°æ€§åœ°èåˆ U å‹æ¶æ„çš„å¤šå°ºåº¦ç‰¹å¾æå–èƒ½åŠ›ä¸å„å‘åŒæ€§è®¾è®¡ä¼˜åŠ¿ï¼Œé€šè¿‡ç©ºé—´-é¢‘ç‡åŸŸååŒä¼˜åŒ–æå‡é‡å»ºè´¨é‡ã€‚</p>
<p>æå‡ºé¢‘ç‡è‡ªé€‚åº”æ—¶é—´æ­¥è°ƒèŠ‚æ¨¡å— AdaFM æ›¿ä»£ä¼ ç»Ÿ AdaLNï¼ŒåŠ¨æ€é€‚åº”ä¸åŒé¢‘æ®µç‰¹å¾çš„å­¦ä¹ éœ€æ±‚ï¼Œæ˜¾è‘—æå‡è®­ç»ƒç¨³å®šæ€§å’Œæ”¶æ•›æ•ˆç‡ã€‚</p>
<p>åœ¨ RealSR ç­‰æ•°æ®é›†ä¸Šï¼Œè¯¥æ¨¡å‹ä»¥ä»… 5% çš„å‚æ•°é‡è¶…è¶Šå¤šæ•°ç°æœ‰æ–¹æ³•ï¼Œå®ç°ä» scratch è®­ç»ƒçš„é«˜æ€§èƒ½è¶…åˆ†ï¼ŒåŒæ—¶æ”¯æŒè®¡ç®—æ•ˆç‡ä¸é‡å»ºç²¾åº¦çš„åŒé‡çªç ´ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90220a6f85ea444aaf42ed585ca751cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348378&amp;x-signature=wpHbZ1%2B0voxPTJJdBvWrdhFljqQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Â·æ›´å¤šAIå¤§æ¨¡å‹å­¦ä¹ è§†é¢‘åŠèµ„æºï¼Œéƒ½åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openEuler 25.09 ä¼ä¸šçº§ MySQLä¸»ä»å¤åˆ¶éƒ¨ç½²ä¸æ€§èƒ½ä¼˜åŒ–å®æˆ˜æå‡50%]]></title>    <link>https://juejin.cn/post/7579165599043174415</link>    <guid>https://juejin.cn/post/7579165599043174415</guid>    <pubDate>2025-12-03T06:29:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579165599043174415" data-draft-id="7579168400989650979" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openEuler 25.09 ä¼ä¸šçº§ MySQLä¸»ä»å¤åˆ¶éƒ¨ç½²ä¸æ€§èƒ½ä¼˜åŒ–å®æˆ˜æå‡50%"/> <meta itemprop="keywords" content="MySQL,Linux"/> <meta itemprop="datePublished" content="2025-12-03T06:29:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥ç§˜å¥‡ç”·å­"/> <meta itemprop="url" content="https://juejin.cn/user/3987271593242160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openEuler 25.09 ä¼ä¸šçº§ MySQLä¸»ä»å¤åˆ¶éƒ¨ç½²ä¸æ€§èƒ½ä¼˜åŒ–å®æˆ˜æå‡50%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3987271593242160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥ç§˜å¥‡ç”·å­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:29:54.000Z" title="Wed Dec 03 2025 06:29:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»21åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>openEuler ä½œä¸ºå¼€æºæ“ä½œç³»ç»Ÿï¼Œå‡­å€Ÿå…¶å“è¶Šçš„ç¨³å®šæ€§ã€å®‰å…¨æ€§å’Œæ€§èƒ½è¡¨ç°ï¼Œæ­£åœ¨æˆä¸ºä¼ä¸šçº§åº”ç”¨çš„é¦–é€‰å¹³å°ã€‚æœ¬æ–‡åŸºäº openEuler 25.09 æœ€æ–°ç‰ˆæœ¬ï¼Œæ·±å…¥æ¢ç´¢åœ¨è¯¥ç³»ç»Ÿä¸Šéƒ¨ç½² MySQL 5.7 ä¸»ä»å¤åˆ¶æ¶æ„çš„å®Œæ•´å®è·µï¼Œæ¶µç›–ç¯å¢ƒå‡†å¤‡ã€ä¸»ä»é…ç½®ã€æ•°æ®åŒæ­¥éªŒè¯ä»¥åŠæ€§èƒ½ä¼˜åŒ–ç­‰å…³é”®ç¯èŠ‚ã€‚</p>
<p><strong>å®æˆ˜ç¯å¢ƒï¼š</strong></p>
<ul>
<li>æ“ä½œç³»ç»Ÿ: openEuler 25.09</li>
<li>å†…æ ¸ç‰ˆæœ¬: 6.6.0-102.0.0.8.oe2509.x86_64</li>
<li>æ•°æ®åº“ç‰ˆæœ¬: MySQL 5.7.29</li>
<li>ä¸»æœåŠ¡å™¨: 192.168.189.128</li>
<li>ä»æœåŠ¡å™¨: 192.168.189.129</li>
<li>åŒ…ç®¡ç†å™¨: DNF</li>
</ul>
<p>æœ¬æ–‡ä¸ä»…æä¾›è¯¦ç»†çš„éƒ¨ç½²æ­¥éª¤ï¼Œè¿˜æ·±å…¥åˆ†æ openEuler ç³»ç»Ÿç‰¹æ€§å¯¹æ•°æ®åº“æ€§èƒ½çš„å½±å“ï¼Œé€šè¿‡ Sysbench å‹æµ‹éªŒè¯ä¼˜åŒ–æ•ˆæœï¼Œä¸ºä¼ä¸šç”¨æˆ·åœ¨ openEuler å¹³å°ä¸Šæ„å»ºé«˜å¯ç”¨æ•°æ®åº“æ¶æ„æä¾›å®ç”¨å‚è€ƒã€‚</p>
<p><strong>é•œåƒåœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openeuler.org%2Fen%2F" target="_blank" title="https://www.openeuler.org/en/" ref="nofollow noopener noreferrer">www.openeuler.org/en/</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b57ba9da5665422fa643ab597f090ab5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=DgXkN0cWvf5RT2fQVJCgebdkZm8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">ç¬¬ä¸€ç« ï¼šopenEuler ç³»ç»Ÿç¯å¢ƒå‡†å¤‡</h2>
<h3 data-id="heading-1">1.1 openEuler æŠ€æœ¯ä¼˜åŠ¿ä¸æ¶æ„è®¾è®¡</h3>
<p>openEuler çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>æŠ€æœ¯å…ˆè¿›</strong>ï¼šåŸºäºæœ€æ–°å†…æ ¸æŠ€æœ¯ï¼Œæ€§èƒ½å’Œå®‰å…¨æ€§æ›´å¼º</li>
<li><strong>å†…æ ¸ä¼˜åŒ–</strong>ï¼šåŸºäº Linux 6.6 LTS å†…æ ¸ï¼Œé’ˆå¯¹ä¼ä¸šçº§åº”ç”¨æ·±åº¦ä¼˜åŒ–</li>
<li><strong>ç”Ÿæ€å®Œå–„</strong>ï¼šæ”¯æŒ x86ã€ARMã€RISC-V ç­‰å¤šç§æ¶æ„</li>
</ul>

































<table><thead><tr><th>ç‰¹æ€§</th><th>openEuler 25.09</th></tr></thead><tbody><tr><td>å†…æ ¸ç‰ˆæœ¬</td><td>6.6 LTS</td></tr><tr><td>åŒ…ç®¡ç†å™¨</td><td>DNF</td></tr><tr><td>å®¹å™¨æ”¯æŒ</td><td>âœ… å®Œå–„</td></tr><tr><td>ARM æ”¯æŒ</td><td>âœ… åŸç”Ÿ</td></tr><tr><td>å®‰å…¨ç‰¹æ€§</td><td>âœ… å†…æ ¸çº§</td></tr><tr><td>ä¼ä¸šæ”¯æŒ</td><td>âœ… å•†ä¸šç‰ˆ</td></tr></tbody></table>
<h3 data-id="heading-2">1.2 åŸºç¡€ç¯å¢ƒé…ç½®ä¸ç³»ç»Ÿä¿¡æ¯ç¡®è®¤</h3>
<p>æŸ¥çœ‹ openEuler ç‰ˆæœ¬ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> /etc/os-release
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85c1ba9408f84f9a9c436b3f17f451c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=%2FYQyqslg7ryLf77gkqCmA4XAbNc%3D" alt="" loading="lazy"/></p>
<p>æŸ¥çœ‹åŒ…ç®¡ç†å™¨ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-css" lang="css">dnf <span class="hljs-attr">--version</span>
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">4.14</span><span class="hljs-number">.0</span>  Installed: dnf<span class="hljs-number">-0</span>:<span class="hljs-number">4.14</span><span class="hljs-number">.0</span><span class="hljs-number">-1.</span>oe2509.noarch  Built    : openEuler <span class="hljs-number">25.09</span> <span class="hljs-keyword">using</span> python<span class="hljs-number">-3.11</span><span class="hljs-number">.0</span><span class="hljs-number">-1.</span>oe2509.x86_64
</code></pre>
<p><strong>MySQL</strong> <strong>ä¸»ä»å¤åˆ¶æ¶æ„æ‹“æ‰‘ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨æœåŠ¡å™¨å±‚       â”‚
â”‚  (Web/API/ä¸šåŠ¡)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚
å†™æ“ä½œ â”‚               è¯»æ“ä½œ â”‚
       â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Master (ä¸»åº“)      â”‚  â”‚  Slave (ä»åº“)       â”‚
â”‚  <span class="hljs-number">192.168</span><span class="hljs-selector-class">.189</span><span class="hljs-selector-class">.128</span>   â”‚  â”‚  <span class="hljs-number">192.168</span><span class="hljs-selector-class">.189</span><span class="hljs-selector-class">.129</span>   â”‚
â”‚  openEuler <span class="hljs-number">25.09</span>   â”‚â”€â”€â”‚  openEuler <span class="hljs-number">25.09</span>   â”‚
â”‚  MySQL <span class="hljs-number">5.7</span><span class="hljs-selector-class">.29</span>      â”‚  â”‚  MySQL <span class="hljs-number">5.7</span><span class="hljs-selector-class">.29</span>      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                     â–²
           â””â”€â”€â”€â”€ binlog å¤åˆ¶ â”€â”€â”€â”€â”˜
                  (å¼‚æ­¥/åŠåŒæ­¥)
</code></pre>
<p><strong>æ¶æ„è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>ä¸»åº“ï¼ˆ</strong> <strong>Master</strong> <strong>ï¼‰</strong> ï¼šå¤„ç†æ‰€æœ‰å†™æ“ä½œï¼ˆINSERT/UPDATE/DELETEï¼‰ï¼Œè®°å½• binlog</li>
<li><strong>ä»åº“ï¼ˆ</strong> <strong>Slave</strong> <strong>ï¼‰</strong> ï¼šå¤„ç†è¯»æ“ä½œï¼ˆSELECTï¼‰ï¼Œé€šè¿‡ relay log åŒæ­¥ä¸»åº“æ•°æ®</li>
<li><strong>å¤åˆ¶æ¨¡å¼</strong>ï¼šå¼‚æ­¥å¤åˆ¶ï¼ˆé»˜è®¤ï¼‰/ åŠåŒæ­¥å¤åˆ¶ï¼ˆå¯é€‰ï¼‰</li>
<li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šè¯»å†™åˆ†ç¦»ã€æ•°æ®å¤‡ä»½ã€æ•…éšœåˆ‡æ¢ã€è´Ÿè½½å‡è¡¡</li>
</ul>
<p><strong>ä¸¤å°æœåŠ¡å™¨éƒ½éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</strong></p>
<p><strong>é…ç½®ä¸»æœºå</strong> ä¸»æœåŠ¡å™¨ï¼ˆ192.168.189.128ï¼‰ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">hostnamectl set-hostname openeuler-mysql-master
</code></pre>
<p>ä»æœåŠ¡å™¨ï¼ˆ192.168.189.129ï¼‰ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">hostnamectl set-hostname openeuler-mysql-slave
</code></pre>
<p>éªŒè¯ï¼š</p>
<pre><code class="hljs">hostname
</code></pre>
<p><strong>é…ç½® hosts æ–‡ä»¶</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt;<span class="hljs-string">EOF
192.168.189.128 openeuler-mysql-master
192.168.189.129 openeuler-mysql-slave
EOF</span>
</code></pre>
<p>éªŒè¯ç½‘ç»œè¿é€šæ€§ï¼š</p>
<pre><code class="hljs language-r" lang="r"><span class="hljs-comment"># ä¸»åº“ ping ä»åº“</span>
ping <span class="hljs-operator">-</span><span class="hljs-built_in">c</span> <span class="hljs-number">3</span> <span class="hljs-number">192.168</span>.189.129
<span class="hljs-comment"># ä»åº“ ping ä¸»åº“</span>
ping <span class="hljs-operator">-</span><span class="hljs-built_in">c</span> <span class="hljs-number">3</span> <span class="hljs-number">192.168</span>.189.128
</code></pre>
<p><strong>å…³é—­é˜²ç«å¢™å’Œ SELinux</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸´æ—¶å…³é—­ SELinux</span>
setenforce 0
<span class="hljs-comment"># æ°¸ä¹…å…³é—­ SELinux</span>
sed -i <span class="hljs-string">'s/SELINUX=enforcing/SELINUX=disabled/g'</span> /etc/selinux/config
<span class="hljs-comment"># å…³é—­é˜²ç«å¢™</span>
systemctl stop firewalld
systemctl <span class="hljs-built_in">disable</span> firewalld
<span class="hljs-comment"># éªŒè¯çŠ¶æ€</span>
getenforce  <span class="hljs-comment"># åº”è¾“å‡º Permissive</span>
systemctl status firewalld  <span class="hljs-comment"># åº”æ˜¾ç¤º inactive</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/baf9f48165004301a2136bc5dad686d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=odIT%2BINY4oG84hkTOy46BJ2q91s%3D" alt="" loading="lazy"/></p>
<p>âš ï¸ <strong>ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š</strong></p>
<ul>
<li>ä¸è¦å®Œå…¨å…³é—­é˜²ç«å¢™ï¼Œè€Œæ˜¯å¼€æ”¾ MySQL ç«¯å£ï¼ˆ3306ï¼‰</li>
<li>SELinux å»ºè®®é…ç½®ä¸º Permissive æ¨¡å¼ï¼Œè®°å½•æ—¥å¿—ä½†ä¸é˜»æ­¢</li>
</ul>
<p>ç”Ÿäº§ç¯å¢ƒé˜²ç«å¢™é…ç½®ï¼ˆå¯é€‰ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯ç”¨é˜²ç«å¢™</span>
systemctl start firewalld
systemctl <span class="hljs-built_in">enable</span> firewalld
<span class="hljs-comment"># å¼€æ”¾ MySQL ç«¯å£</span>
firewall-cmd --permanent --add-port=3306/tcp
firewall-cmd --reload
<span class="hljs-comment"># æŸ¥çœ‹è§„åˆ™</span>
firewall-cmd --list-all
</code></pre>
<p><strong>å®‰è£…åŸºç¡€å·¥å…·</strong> openEuler ä½¿ç”¨ DNF åŒ…ç®¡ç†å™¨ï¼ˆä¸æ˜¯ YUMï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ›´æ–°è½¯ä»¶æºç¼“å­˜</span>
dnf makecache
<span class="hljs-comment"># å®‰è£…å¸¸ç”¨å·¥å…·</span>
dnf install -y vim wget tar net-tools lsof
<span class="hljs-comment"># å®‰è£…å¼€å‘å·¥å…·ï¼ˆåç»­å¯èƒ½éœ€è¦ï¼‰</span>
dnf groupinstall -y <span class="hljs-string">"Development Tools"</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e32dad418f9b46e1b78d635bc760450f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=TlMuSyoMTZ5KMmx0a6Y6AG1TsFY%3D" alt="" loading="lazy"/></p>
<p><strong>æ—¶é—´åŒæ­¥é…ç½®</strong> ä¸»ä»å¤åˆ¶å¯¹æ—¶é—´åŒæ­¥è¦æ±‚æé«˜ï¼Œå¿…é¡»ç¡®ä¿ä¸¤å°æœåŠ¡å™¨æ—¶é—´ä¸€è‡´ã€‚</p>
<p><strong>ä¸»æœåŠ¡å™¨é…ç½®</strong> <strong>NTP</strong> <strong>æœåŠ¡</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£… NTP æœåŠ¡</span>
dnf install -y ntp
<span class="hljs-comment"># ç¼–è¾‘é…ç½®æ–‡ä»¶</span>
vim /etc/ntp.conf
</code></pre>
<p>åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨æœ¬åœ°æ—¶é—´ä½œä¸ºæ—¶é—´æº</span>
server 127.127.1.0
fudge 127.127.1.0 stratum 8
</code></pre>
<p>å¯åŠ¨ NTP æœåŠ¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">systemctl restart ntpd
systemctl <span class="hljs-built_in">enable</span> ntpd
<span class="hljs-comment"># éªŒè¯æœåŠ¡çŠ¶æ€</span>
systemctl status ntpd
</code></pre>
<p>æŸ¥çœ‹ NTP åŒæ­¥çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-css" lang="css">ntpq -<span class="hljs-selector-tag">p</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/636e7014e2374f68a4981811caca6e67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=m6N15E%2FWezFsZKhjrLh%2BV7s8He4%3D" alt="" loading="lazy"/></p>
<p><strong>ä»æœåŠ¡å™¨åŒæ­¥æ—¶é—´</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£… ntpdate å·¥å…·</span>
dnf install -y ntpdate
<span class="hljs-comment"># æ‰‹åŠ¨åŒæ­¥ä¸»æœåŠ¡å™¨æ—¶é—´</span>
ntpdate 192.168.189.128
<span class="hljs-comment"># è®¾ç½®å®šæ—¶åŒæ­¥ï¼ˆæ¯å°æ—¶ä¸€æ¬¡ï¼‰</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"0 * * * * /usr/sbin/ntpdate 192.168.189.128 &gt; /dev/null 2&gt;&amp;1"</span> &gt;&gt; /var/spool/cron/root
<span class="hljs-comment"># éªŒè¯å®šæ—¶ä»»åŠ¡</span>
crontab -l
</code></pre>
<p>éªŒè¯æ—¶é—´åŒæ­¥ï¼š</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># ä¸¤å°æœåŠ¡å™¨æ‰§è¡Œ</span>
date <span class="hljs-string">"+%Y-%m-%d %H:%M:%S"</span>
</code></pre>
<p>è¾“å‡ºåº”å®Œå…¨ä¸€è‡´ï¼ˆè¯¯å·®ä¸è¶…è¿‡ 1 ç§’ï¼‰ã€‚</p>
<h2 data-id="heading-3">ç¬¬äºŒç« ï¼šMySQL 5.7 å®‰è£…éƒ¨ç½²</h2>
<h3 data-id="heading-4">2.1 MySQL 5.7 æŠ€æœ¯ç‰¹æ€§ä¸å®‰è£…é…ç½®</h3>
<p><strong>MySQL</strong> <strong>5.7 çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>âœ… <strong>æ€§èƒ½æå‡</strong>ï¼šç›¸æ¯” 5.6 ç‰ˆæœ¬ï¼Œè¯»å†™æ€§èƒ½æå‡ 3 å€</li>
<li>âœ… <strong>JSON</strong> <strong>æ”¯æŒ</strong>ï¼šåŸç”Ÿ JSON æ•°æ®ç±»å‹</li>
<li>âœ… <strong>å¹¶è¡Œ</strong> <strong>å¤åˆ¶</strong>ï¼šå¤šçº¿ç¨‹å¤åˆ¶ï¼Œé™ä½ä¸»ä»å»¶è¿Ÿ</li>
<li>âœ… <strong>åœ¨çº¿</strong> <strong>DDL</strong>ï¼šæ”¯æŒåœ¨çº¿ä¿®æ”¹è¡¨ç»“æ„</li>
<li>âœ… <strong>å®‰å…¨å¢å¼º</strong>ï¼šé»˜è®¤å¯ç”¨ SSLï¼Œå¯†ç ç­–ç•¥æ›´ä¸¥æ ¼</li>
<li>âœ… <strong>ç¨³å®šæ€§å¥½</strong>ï¼šç”Ÿäº§ç¯å¢ƒéªŒè¯å¤šå¹´ï¼Œbug å°‘</li>
</ul>
<p><strong>MySQL</strong> <strong>ç‰ˆæœ¬å¯¹æ¯”ï¼š</strong></p>















































<table><thead><tr><th>ç‰¹æ€§</th><th>MySQL 5.6</th><th>MySQL 5.7</th><th>MySQL 8.0</th></tr></thead><tbody><tr><td>æ€§èƒ½</td><td>åŸºå‡†</td><td>3x</td><td>2x (ç›¸æ¯” 5.7)</td></tr><tr><td>JSON</td><td>âŒ</td><td>âœ…</td><td>âœ… å¢å¼º</td></tr><tr><td>å¹¶è¡Œå¤åˆ¶</td><td>âŒ</td><td>âœ… åŸºäºåº“</td><td>âœ… åŸºäºäº‹åŠ¡</td></tr><tr><td>çª—å£å‡½æ•°</td><td>âŒ</td><td>âŒ</td><td>âœ…</td></tr><tr><td>ç¨³å®šæ€§</td><td>âœ…</td><td>âœ…âœ…</td><td>âš ï¸ è¾ƒæ–°</td></tr><tr><td>å…¼å®¹æ€§</td><td>âœ…</td><td>âœ…</td><td>âš ï¸ éƒ¨åˆ†ä¸å…¼å®¹</td></tr></tbody></table>
<p><strong>ä¸¤å°æœåŠ¡å™¨éƒ½éœ€è¦æ‰§è¡Œï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿›å…¥ä¸´æ—¶ç›®å½•</span>
<span class="hljs-built_in">cd</span> /opt
<span class="hljs-comment"># ä¸‹è½½ MySQL 5.7.29 RPM åŒ…ï¼ˆå®˜æ–¹æºï¼‰</span>
wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.29-1.el7.x86_64.rpm-bundle.tar
<span class="hljs-comment"># å¦‚æœå®˜æ–¹æºä¸‹è½½æ…¢ï¼Œä½¿ç”¨æ¸…åå¤§å­¦é•œåƒ</span>
wget https://mirrors.tuna.tsinghua.edu.cn/mysql/downloads/MySQL-5.7/mysql-5.7.29-1.el7.x86_64.rpm-bundle.tar
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9d8c60ddef6478eb933d544ca1ce1b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=SGGH2sI5U15QMoaGx3Er3852Izg%3D" alt="" loading="lazy"/></p>
<p>éªŒè¯ä¸‹è½½ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> -lh mysql-5.7.29-1.el7.x86_64.rpm-bundle.tar
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">-rw-r<span class="hljs-attr">--r--</span>. <span class="hljs-number">1</span> root root <span class="hljs-number">521</span>M <span class="hljs-number">2019</span>å¹´<span class="hljs-number">12</span>æœˆ<span class="hljs-number">19</span>æ—¥ mysql-<span class="hljs-number">5.7</span>.<span class="hljs-number">29</span>-<span class="hljs-number">1</span><span class="hljs-selector-class">.el7</span><span class="hljs-selector-class">.x86_64</span><span class="hljs-selector-class">.rpm-bundle</span><span class="hljs-selector-class">.tar</span>
</code></pre>
<h3 data-id="heading-5">2.2 åˆ›å»ºæœ¬åœ°ä»“åº“ä¸MySQLæœåŠ¡é…ç½®</h3>
<p>openEuler ç‰¹è‰²ï¼šä½¿ç”¨ DNF æœ¬åœ°ä»“åº“ç®¡ç† RPM åŒ…</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»º MySQL ä»“åº“ç›®å½•</span>
<span class="hljs-built_in">mkdir</span> -p /mysql57
<span class="hljs-comment"># è§£å‹ RPM åŒ…</span>
tar xf mysql-5.7.29-1.el7.x86_64.rpm-bundle.tar -C /mysql57
<span class="hljs-comment"># æŸ¥çœ‹è§£å‹çš„æ–‡ä»¶</span>
<span class="hljs-built_in">ls</span> /mysql57
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-vbscript" lang="vbscript">mysql-community-client<span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64.rpm    mysql-community-embedded-compat<span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64.rpm  mysql-community-<span class="hljs-built_in">server</span><span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64.rpm
mysql-community-common<span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64.rpm    mysql-community-embedded-devel<span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64.rpm   mysql-community-test<span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64.rpm
mysql-community-devel<span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64.rpm     mysql-community-libs<span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64.rpm
mysql-community-embedded<span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64.rpm  mysql-community-libs-compat<span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64.rpm
</code></pre>
<p>åˆ›å»º DNF ä»“åº“å…ƒæ•°æ®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£… createrepo å·¥å…·</span>
dnf install -y createrepo
<span class="hljs-comment"># åˆ›å»ºä»“åº“å…ƒæ•°æ®</span>
createrepo /mysql57
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Directory walk started
Directory walk <span class="hljs-keyword">done</span> - 10 packages
Temporary output repo path: /mysql57/.repodata/
Pool started (with 5 workers)
Pool finished
</code></pre>
<p><strong>é…ç½®</strong> <strong>DNF</strong> <strong>æœ¬åœ°ä»“åº“</strong></p>
<pre><code class="hljs language-ini" lang="ini">cat &gt; /etc/yum.repos.d/mysql57.repo &lt;&lt;EOF
<span class="hljs-section">[mysql57]</span>
<span class="hljs-attr">name</span>=MySQL <span class="hljs-number">5.7</span> Local Repository for openEuler
<span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span>
<span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">0</span>
<span class="hljs-attr">baseurl</span>=file:///mysql57
EOF
</code></pre>
<p>éªŒè¯ä»“åº“é…ç½®ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ¸…ç† DNF ç¼“å­˜</span>
dnf clean <span class="hljs-built_in">all</span>
<span class="hljs-comment"># é‡å»ºç¼“å­˜</span>
dnf makecache
<span class="hljs-comment"># æŸ¥çœ‹å¯ç”¨ä»“åº“</span>
dnf repolist
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0dd906b9009a4f20aa31892417657785~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=zPDoq%2B22k%2FJbz4dtgiuF8n26350%3D" alt="" loading="lazy"/></p>
<p>è¾“å‡ºåº”åŒ…å«ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">mysql57                                                                          MySQL <span class="hljs-number">5.7</span> Local Repository <span class="hljs-keyword">for</span> <span class="hljs-title class_">openEuler</span>
</code></pre>
<p><strong>å®‰è£…</strong> <strong>MySQL</strong> <strong>5.7</strong></p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># å®‰è£… MySQL æœåŠ¡å™¨</span>
dnf install -<span class="hljs-keyword">y</span> mysql-community-server
<span class="hljs-comment"># æŸ¥çœ‹å®‰è£…çš„åŒ…</span>
rpm -qa | <span class="hljs-keyword">grep</span> mysql
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">root@mysql-master opt</span>]<span class="hljs-meta"># rpm -qa | grep mysql</span>
mysql-community-common<span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64
mysql-community-libs<span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64
mysql-community-client<span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64
mysql-community-server<span class="hljs-number">-5.7</span><span class="hljs-number">.29</span><span class="hljs-number">-1.</span>el7.x86_64
</code></pre>
<p>éªŒè¯ MySQL ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-css" lang="css">mysqld <span class="hljs-attr">--version</span>
</code></pre>
<p>è¾“å‡ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b7664fb84e64eca90ce844c2d2d6879~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=m8AZJqWgLGP4LmegzgXveP6IpaA%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">root@mysql-master opt</span>]<span class="hljs-meta"># mysqld --version</span>
mysqld  Ver <span class="hljs-number">5.7</span><span class="hljs-number">.29</span> <span class="hljs-function"><span class="hljs-keyword">for</span> Linux <span class="hljs-keyword">on</span> <span class="hljs-title">x86_64</span> (<span class="hljs-params">MySQL Community Server (GPL</span>))
</span></code></pre>
<p><strong>å¯åŠ¨</strong> <strong>MySQL</strong> <strong>å¹¶ä¿®æ”¹åˆå§‹å¯†ç </strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯åŠ¨ MySQL æœåŠ¡</span>
systemctl start mysqld
<span class="hljs-comment"># è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</span>
systemctl <span class="hljs-built_in">enable</span> mysqld
<span class="hljs-comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span>
systemctl status mysqld
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54b0475f3d8f404282866032414ea93b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=5ohhvmp9bTxtyB%2FftnAvFjk4fyM%3D" alt="" loading="lazy"/></p>
<p>è·å–åˆå§‹å¯†ç ï¼š</p>
<p>ï¼ˆåˆ†å¼€æ“ä½œ å› ä¸ºä¸¤å°æ•°æ®åº“éƒ½æ˜¯ä¸åŒçš„å¯†ç ï¼‰</p>
<pre><code class="hljs language-c" lang="c">grep <span class="hljs-string">"temporary password"</span> /var/<span class="hljs-built_in">log</span>/mysqld.<span class="hljs-built_in">log</span>
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span>T04:<span class="hljs-number">00</span>:<span class="hljs-number">00.123456</span>Z <span class="hljs-number">1</span> [Note] A temporary password <span class="hljs-keyword">is</span> generated <span class="hljs-keyword">for</span> root@localhost: kT7y&amp;Ub<span class="hljs-meta">#qP2w</span>
</code></pre>
<p>ä¿®æ”¹ root å¯†ç ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨ä¸´æ—¶å¯†ç ç™»å½•</span>
mysql -uroot -p<span class="hljs-string">'kT7y&amp;Ub#qP2w'</span>
</code></pre>
<p>æ‰§è¡Œä»¥ä¸‹ SQLï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¿®æ”¹å¯†ç ï¼ˆå¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ï¼‰</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'Abc-1234'</span>;
<span class="hljs-comment">-- åˆ·æ–°æƒé™</span>
FLUSH PRIVILEGES;
<span class="hljs-comment">-- é€€å‡º</span>
EXIT;
</code></pre>
<p>æµ‹è¯•æ–°å¯†ç ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">mysql -uroot -p<span class="hljs-string">'Abc-1234'</span> -e <span class="hljs-string">"SELECT VERSION();"</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/346a62c72e0f487ea432f584ea270b8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=cw6AYPDlG9IW8sgwyyqEWiPJpKc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">ç¬¬ä¸‰ç« ï¼šä¸»ä»å¤åˆ¶é…ç½®</h2>
<h3 data-id="heading-7">3.1 ä¸»ä»å¤åˆ¶åŸç†ä¸ä¸»æœåŠ¡å™¨é…ç½®</h3>
<p><strong>MySQL</strong> <strong>ä¸»ä»å¤åˆ¶ä¸‰æ­¥éª¤ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸»åº“ (Master)                         â”‚
â”‚  <span class="hljs-number">1</span>. å†™æ“ä½œ â†’ è®°å½• binlog (äºŒè¿›åˆ¶æ—¥å¿—)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ <span class="hljs-number">2</span>. IO çº¿ç¨‹è¯»å– binlog
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä»åº“ (Slave)                          â”‚
â”‚  <span class="hljs-number">3</span>. SQL çº¿ç¨‹æ‰§è¡Œ relay log â†’ æ•°æ®åŒæ­¥                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å…³é”®ç»„ä»¶ï¼š</strong></p>
<ul>
<li><strong>binlog (</strong> <strong>Binary Log</strong> <strong>)</strong> ï¼šä¸»åº“è®°å½•æ‰€æœ‰ DDL å’Œ DML æ“ä½œ</li>
<li><strong>relay</strong> <strong>log</strong> <strong>(</strong> <strong>ä¸­ç»§</strong> <strong>æ—¥å¿—)</strong> ï¼šä»åº“æ¥æ”¶ binlog åå†™å…¥çš„ä¸­é—´æ–‡ä»¶</li>
<li><strong>IO</strong> <strong>Thread</strong>ï¼šä»åº“è´Ÿè´£ä»ä¸»åº“è¯»å– binlog</li>
<li><strong>SQL</strong> <strong>Thread</strong>ï¼šä»åº“è´Ÿè´£æ‰§è¡Œ relay log ä¸­çš„ SQL</li>
</ul>
<p><strong>ä¸»æœåŠ¡å™¨é…ç½® (192.168.189.128)</strong></p>
<p>ç¼–è¾‘ MySQL é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">vim /etc/my.cnf
</code></pre>
<p>åœ¨ [mysqld] æ®µæ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># ========== åŸºç¡€é…ç½® ==========</span>
<span class="hljs-comment"># æ•°æ®ç›®å½•</span>
<span class="hljs-attr">datadir</span>=/var/lib/mysql
<span class="hljs-attr">socket</span>=/var/lib/mysql/mysql.sock
<span class="hljs-comment"># æ—¥å¿—é…ç½®</span>
<span class="hljs-attr">log-error</span>=/var/log/mysqld.log
<span class="hljs-attr">pid-file</span>=/var/run/mysqld/mysqld.pid

<span class="hljs-comment"># ========== ä¸»ä»å¤åˆ¶é…ç½® ==========</span>
<span class="hljs-comment"># æœåŠ¡å™¨å”¯ä¸€ IDï¼ˆä¸»ä»å¿…é¡»ä¸åŒï¼Œå»ºè®®ä½¿ç”¨ IP æœ€åä¸€ä½ï¼‰</span>
<span class="hljs-attr">server-id</span> = <span class="hljs-number">128</span>
<span class="hljs-comment"># å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆä¸»ä»å¤åˆ¶çš„æ ¸å¿ƒï¼‰</span>
<span class="hljs-attr">log_bin</span> = mysql-bin
<span class="hljs-comment"># äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼</span>
<span class="hljs-comment"># STATEMENT: è®°å½• SQL è¯­å¥ï¼ˆä½“ç§¯å°ï¼Œä½†å¯èƒ½ä¸ä¸€è‡´ï¼‰</span>
<span class="hljs-comment"># ROW: è®°å½•æ¯è¡Œæ•°æ®å˜åŒ–ï¼ˆä½“ç§¯å¤§ï¼Œä½†æ•°æ®ä¸€è‡´æ€§å¥½ï¼‰â˜…æ¨è</span>
<span class="hljs-comment"># MIXED: æ··åˆæ¨¡å¼ï¼ˆè‡ªåŠ¨é€‰æ‹©ï¼‰</span>
<span class="hljs-attr">binlog_format</span> = ROW
<span class="hljs-comment"># äºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸæ—¶é—´ï¼ˆå¤©ï¼‰</span>
<span class="hljs-attr">expire_logs_days</span> = <span class="hljs-number">7</span>
<span class="hljs-comment"># æ¯æ¬¡äº‹åŠ¡æäº¤åç«‹å³åˆ·æ–° binlog åˆ°ç£ç›˜ï¼ˆä¿è¯æ•°æ®å®‰å…¨ï¼‰</span>
<span class="hljs-attr">sync_binlog</span> = <span class="hljs-number">1</span>
<span class="hljs-comment"># ä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“ï¼ˆç³»ç»Ÿåº“ï¼‰</span>
<span class="hljs-attr">binlog-ignore-db</span> = mysql
<span class="hljs-attr">binlog-ignore-db</span> = information_schema
<span class="hljs-attr">binlog-ignore-db</span> = performance_schema
<span class="hljs-attr">binlog-ignore-db</span> = sys

<span class="hljs-comment"># ========== openEuler æ€§èƒ½ä¼˜åŒ– ==========</span>
<span class="hljs-comment"># InnoDB ç¼“å†²æ± å¤§å°ï¼ˆå»ºè®®è®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„ 60%-70%ï¼‰</span>
<span class="hljs-comment"># å‡è®¾è™šæ‹Ÿæœºåˆ†é… 4GB å†…å­˜ï¼Œè®¾ç½®ä¸º 2.5GB</span>
<span class="hljs-attr">innodb_buffer_pool_size</span> = <span class="hljs-number">2560</span>M
<span class="hljs-comment"># InnoDB ç¼“å†²æ± å®ä¾‹æ•°ï¼ˆæé«˜å¹¶å‘æ€§èƒ½ï¼‰</span>
<span class="hljs-attr">innodb_buffer_pool_instances</span> = <span class="hljs-number">4</span>
<span class="hljs-comment"># æœ€å¤§è¿æ¥æ•°</span>
<span class="hljs-attr">max_connections</span> = <span class="hljs-number">500</span>
<span class="hljs-comment"># å­—ç¬¦é›†</span>
<span class="hljs-attr">character-set-server</span> = utf8mb4
<span class="hljs-attr">collation-server</span> = utf8mb4_unicode_ci
</code></pre>
<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>server-id</strong>: ä¸»ä»æœåŠ¡å™¨å¿…é¡»ä¸åŒï¼Œå»ºè®®ä½¿ç”¨ IP æœ€åä¸€ä½ï¼ˆ128ã€129ï¼‰</li>
<li><strong>log_bin</strong>: å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—ï¼Œè®°å½•æ‰€æœ‰æ•°æ®å˜æ›´æ“ä½œ</li>
<li><strong>binlog_format = ROW</strong>: æ¨èä½¿ç”¨ ROW æ ¼å¼ï¼Œæ•°æ®ä¸€è‡´æ€§æœ€å¥½</li>
<li><strong>sync_binlog = 1</strong>: æ¯æ¬¡äº‹åŠ¡æäº¤åç«‹å³åˆ·ç›˜ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±</li>
<li><strong>innodb_buffer_pool_size</strong>: openEuler å†…å­˜ç®¡ç†ä¼˜ç§€ï¼Œå¯å……åˆ†åˆ©ç”¨</li>
</ul>
<p>é‡å¯ MySQL æœåŠ¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">systemctl restart mysqld
<span class="hljs-comment"># éªŒè¯æœåŠ¡çŠ¶æ€</span>
systemctl status mysqld
</code></pre>
<p>æ£€æŸ¥ binlog æ˜¯å¦å¯ç”¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">mysql -uroot -p<span class="hljs-string">'Abc-1234'</span> -e <span class="hljs-string">"SHOW VARIABLES LIKE 'log_bin';"</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbf5088c10544aceba1c4a3967a00fff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=dy5JhZdifFO8YBn%2FhT0JO8UQ0yc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">3.2 åˆ›å»ºå¤åˆ¶ç”¨æˆ·ä¸ä»æœåŠ¡å™¨é…ç½®</h3>
<pre><code class="hljs language-bash" lang="bash">mysql -uroot -p<span class="hljs-string">'Abc-1234'</span>
</code></pre>
<p>æ‰§è¡Œä»¥ä¸‹ SQLï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ›å»ºå¤åˆ¶ç”¨æˆ·ï¼ˆä»…å…è®¸ä»åº“ IP è¿æ¥ï¼Œå®‰å…¨æ€§æ›´é«˜ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'repl_user'</span>@<span class="hljs-string">'192.168.189.129'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'Repl@1234'</span>;
<span class="hljs-comment">-- æˆäºˆå¤åˆ¶æƒé™</span>
<span class="hljs-keyword">GRANT</span> REPLICATION SLAVE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'repl_user'</span>@<span class="hljs-string">'192.168.189.129'</span>;
<span class="hljs-comment">-- åˆ·æ–°æƒé™</span>
FLUSH PRIVILEGES;
<span class="hljs-comment">-- éªŒè¯ç”¨æˆ·åˆ›å»º</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>, host <span class="hljs-keyword">FROM</span> mysql.user <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">'repl_user'</span>;
</code></pre>
<p>è¾“å‡ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/401b5bb3af2d43e5965478d4f00b7528~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=3LtKFpaOWT113D3xW3BNFGaGLg8%3D" alt="" loading="lazy"/></p>
<p>âš ï¸ <strong>å®‰å…¨å»ºè®®ï¼š</strong></p>
<ul>
<li>ç”Ÿäº§ç¯å¢ƒä¸è¦ä½¿ç”¨ 'repl_user'@'%'ï¼ˆå…è®¸ä»»æ„ IPï¼‰</li>
<li>å¤åˆ¶ç”¨æˆ·å¯†ç å¿…é¡»è¶³å¤Ÿå¤æ‚</li>
<li>å®šæœŸæ›´æ¢å¤åˆ¶ç”¨æˆ·å¯†ç </li>
</ul>
<p>æŸ¥çœ‹ä¸»åº“çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">SHOW MASTER STATUS<span class="hljs-comment">;</span>
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2ccb6302ef44c30abf1cb9704b38a40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=NiMJjd8S3RaesTr0JQnfP9VTaqo%3D" alt="" loading="lazy"/></p>
<p>âš ï¸ <strong>é‡è¦å‚æ•°è®°å½•ï¼ˆé…ç½®ä»åº“æ—¶ä¼šç”¨åˆ°ï¼‰ï¼š</strong></p>
<ul>
<li><strong>File</strong>: mysql-bin.000001ï¼ˆäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åï¼‰</li>
<li><strong>Position</strong>: 785ï¼ˆå½“å‰ä½ç½®ï¼‰</li>
</ul>
<p>è¯·åŠ¡å¿…è®°å½•è¿™ä¸¤ä¸ªå‚æ•°ï¼</p>
<p><strong>ä»æœåŠ¡å™¨é…ç½® (192.168.189.129)</strong></p>
<p>ç¼–è¾‘ MySQL é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">vim /etc/my.cnf
</code></pre>
<p>åœ¨ [mysqld] æ®µæ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># ========== åŸºç¡€é…ç½® ==========</span>
<span class="hljs-attr">datadir</span>=/var/lib/mysql
<span class="hljs-attr">socket</span>=/var/lib/mysql/mysql.sock
<span class="hljs-attr">log-error</span>=/var/log/mysqld.log
<span class="hljs-attr">pid-file</span>=/var/run/mysqld/mysqld.pid

<span class="hljs-comment"># ========== ä¸»ä»å¤åˆ¶é…ç½® ==========</span>
<span class="hljs-comment"># æœåŠ¡å™¨å”¯ä¸€ IDï¼ˆå¿…é¡»ä¸ä¸»åº“ä¸åŒï¼‰</span>
<span class="hljs-attr">server-id</span> = <span class="hljs-number">129</span>
<span class="hljs-comment"># å¯ç”¨ä¸­ç»§æ—¥å¿—ï¼ˆä»åº“æ¥æ”¶ä¸»åº“ binlog çš„ä¸­é—´æ–‡ä»¶ï¼‰</span>
<span class="hljs-attr">relay-log</span> = mysql-relay-bin
<span class="hljs-comment"># ä»åº“åªè¯»æ¨¡å¼ï¼ˆé˜²æ­¢è¯¯å†™å…¥æ•°æ®ï¼‰</span>
<span class="hljs-comment"># æ³¨æ„ï¼šroot ç”¨æˆ·ä¸å—æ­¤é™åˆ¶</span>
<span class="hljs-attr">read_only</span> = <span class="hljs-number">1</span>
<span class="hljs-comment"># è·³è¿‡ä¸»ä»å¤åˆ¶ä¸­çš„ç‰¹å®šé”™è¯¯ï¼ˆç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼‰</span>
<span class="hljs-comment"># slave-skip-errors = 1062,1032</span>

<span class="hljs-comment"># ========== openEuler æ€§èƒ½ä¼˜åŒ– ==========</span>
<span class="hljs-attr">innodb_buffer_pool_size</span> = <span class="hljs-number">2560</span>M
<span class="hljs-attr">innodb_buffer_pool_instances</span> = <span class="hljs-number">4</span>
<span class="hljs-attr">max_connections</span> = <span class="hljs-number">500</span>
<span class="hljs-attr">character-set-server</span> = utf8mb4
<span class="hljs-attr">collation-server</span> = utf8mb4_unicode_ci

<span class="hljs-comment"># ========== å¹¶è¡Œå¤åˆ¶ä¼˜åŒ–ï¼ˆMySQL 5.7 ç‰¹æ€§ï¼‰==========</span>
<span class="hljs-comment"># å¯ç”¨å¤šçº¿ç¨‹å¤åˆ¶ï¼Œé™ä½ä¸»ä»å»¶è¿Ÿ</span>
<span class="hljs-attr">slave_parallel_type</span> = LOGICAL_CLOCK
<span class="hljs-attr">slave_parallel_workers</span> = <span class="hljs-number">4</span>
<span class="hljs-comment"># ä»åº“ä¿ç•™ä¸­ç»§æ—¥å¿—ï¼ˆç”¨äºæ•…éšœæ¢å¤ï¼‰</span>
<span class="hljs-attr">relay_log_recovery</span> = <span class="hljs-number">1</span>
</code></pre>
<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>server-id = 129</strong>: å¿…é¡»ä¸ä¸»åº“ä¸åŒ</li>
<li><strong>relay-log</strong>: ä¸­ç»§æ—¥å¿—ï¼Œä»åº“æ¥æ”¶ä¸»åº“ binlog åå…ˆå†™å…¥ relay log</li>
<li><strong>read_only = 1</strong>: ä»åº“åªè¯»æ¨¡å¼ï¼ˆroot ç”¨æˆ·ä¸å—é™åˆ¶ï¼‰</li>
<li><strong>slave_parallel_workers = 4</strong>: å¹¶è¡Œå¤åˆ¶çº¿ç¨‹æ•°ï¼ˆopenEuler å¤šæ ¸æ€§èƒ½å¥½ï¼‰</li>
</ul>
<p>é‡å¯ MySQL æœåŠ¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">systemctl restart mysqld
<span class="hljs-comment"># éªŒè¯æœåŠ¡çŠ¶æ€</span>
systemctl status mysqld
</code></pre>
<p>æ£€æŸ¥ä»åº“é…ç½®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">mysql -uroot -p<span class="hljs-string">'Abc-1234'</span> -e <span class="hljs-string">"SHOW VARIABLES LIKE 'server_id';"</span>
mysql -uroot -p<span class="hljs-string">'Abc-1234'</span> -e <span class="hljs-string">"SHOW VARIABLES LIKE 'read_only';"</span>
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+---------------+-------+</span>
| Variable_name | Value |
<span class="hljs-addition">+---------------+-------+</span>
| server_id     | 129   |
<span class="hljs-addition">+---------------+-------+</span>
<span class="hljs-addition">+---------------+-------+</span>
| Variable_name | Value |
<span class="hljs-addition">+---------------+-------+</span>
| read_only     | ON    |
<span class="hljs-addition">+---------------+-------+</span>
</code></pre>
<p><strong>é…ç½®ä¸»ä»å¤åˆ¶</strong></p>
<pre><code class="hljs language-bash" lang="bash">ysql -uroot -p<span class="hljs-string">'Abc-1234'</span>
</code></pre>
<p>æ‰§è¡Œä»¥ä¸‹ SQLï¼ˆä½¿ç”¨ä¸»åº“çš„ File å’Œ Positionï¼‰ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75d11ffe41684c428cdb512a96cae5f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=u%2F9Xts46eFuW2igyAK6jvcckick%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-ini" lang="ini">CHANGE MASTER TO
  <span class="hljs-attr">MASTER_HOST</span>=<span class="hljs-string">'192.168.189.128'</span>,        -- ä¸»åº“ IP
  <span class="hljs-attr">MASTER_USER</span>=<span class="hljs-string">'repl_user'</span>,              -- å¤åˆ¶ç”¨æˆ·
  <span class="hljs-attr">MASTER_PASSWORD</span>=<span class="hljs-string">'Repl@1234'</span>,          -- å¤åˆ¶ç”¨æˆ·å¯†ç 
  <span class="hljs-attr">MASTER_PORT</span>=<span class="hljs-number">3306</span>,                     -- ä¸»åº“ç«¯å£
  <span class="hljs-attr">MASTER_LOG_FILE</span>=<span class="hljs-string">'mysql-bin.000001'</span>,   -- ä¸»åº“ binlog æ–‡ä»¶å â˜…
  <span class="hljs-attr">MASTER_LOG_POS</span>=<span class="hljs-number">785</span><span class="hljs-comment">;                   -- ä¸»åº“ binlog ä½ç½® â˜…</span>
</code></pre>
<p>âš ï¸ <strong>æ³¨æ„ï¼š</strong> MASTER_LOG_FILE å’Œ MASTER_LOG_POS å¿…é¡»ä¸ä¸»åº“ SHOW MASTER STATUS çš„ç»“æœä¸€è‡´ï¼ å¦‚æœä¸»åº“çš„ File å’Œ Position ä¸åŒï¼Œè¯·æ›¿æ¢ä¸ºå®é™…å€¼</p>
<p><strong>å¯åŠ¨ä»åº“å¤åˆ¶</strong></p>
<pre><code class="hljs language-ini" lang="ini">START SLAVE<span class="hljs-comment">;</span>
</code></pre>
<p><strong>æŸ¥çœ‹ä»åº“çŠ¶æ€</strong></p>
<pre><code class="hljs language-ini" lang="ini">SHOW SLAVE STATUS\G<span class="hljs-comment">;</span>
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼ˆå…³é”®å­—æ®µï¼‰ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ebc90491f08452eb0a542fd436f7698~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=9nyRFYNSqPokhivoOFiHDi0H6Bs%3D" alt="" loading="lazy"/></p>
<p><strong>å…³é”®æŒ‡æ ‡æ£€æŸ¥ï¼š</strong></p>



































<table><thead><tr><th>æŒ‡æ ‡</th><th>æ­£å¸¸å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Slave_IO_Running</td><td>Yes</td><td>IO çº¿ç¨‹æ­£å¸¸è¿è¡Œï¼ˆä»ä¸»åº“è¯»å– binlogï¼‰</td></tr><tr><td>Slave_SQL_Running</td><td>Yes</td><td>SQL çº¿ç¨‹æ­£å¸¸è¿è¡Œï¼ˆæ‰§è¡Œ relay logï¼‰</td></tr><tr><td>Last_Errno</td><td>0</td><td>æ²¡æœ‰é”™è¯¯</td></tr><tr><td>Last_Error</td><td>ç©º</td><td>æ²¡æœ‰é”™è¯¯ä¿¡æ¯</td></tr><tr><td>Seconds_Behind_Master</td><td>0</td><td>ä¸»ä»å»¶è¿Ÿä¸º 0 ç§’</td></tr></tbody></table>
<p>âœ… å¦‚æœä»¥ä¸Š 5 ä¸ªæŒ‡æ ‡éƒ½æ­£å¸¸ï¼Œè¯´æ˜ä¸»ä»å¤åˆ¶é…ç½®æˆåŠŸï¼</p>
<h2 data-id="heading-9">ç¬¬å››ç« ï¼šä¸»ä»åŒæ­¥éªŒè¯</h2>
<h3 data-id="heading-10">4.1 åˆ›å»ºæµ‹è¯•æ•°æ®ä¸å®æ—¶åŒæ­¥éªŒè¯</h3>
<p>åœ¨ä¸»åº“ï¼ˆ192.168.189.128ï¼‰æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">mysql -uroot -p<span class="hljs-string">'Abc-1234'</span>
</code></pre>
<p>æ‰§è¡Œä»¥ä¸‹ SQLï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ›å»ºæµ‹è¯•æ•°æ®åº“</span>
<span class="hljs-keyword">CREATE</span> DATABASE openeuler_test <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci;
<span class="hljs-comment">-- åˆ‡æ¢åˆ°æµ‹è¯•åº“</span>
USE openeuler_test;
<span class="hljs-comment">-- åˆ›å»ºç”¨æˆ·è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
  id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'ç”¨æˆ· ID'</span>,
  username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">UNIQUE</span> COMMENT <span class="hljs-string">'ç”¨æˆ·å'</span>,
  email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) COMMENT <span class="hljs-string">'é‚®ç®±'</span>,
  age <span class="hljs-type">INT</span> COMMENT <span class="hljs-string">'å¹´é¾„'</span>,
  created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'åˆ›å»ºæ—¶é—´'</span>,
  updated_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'æ›´æ–°æ—¶é—´'</span>,
  INDEX idx_username (username),
  INDEX idx_email (email)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'ç”¨æˆ·è¡¨'</span>;

<span class="hljs-comment">-- æ’å…¥æµ‹è¯•æ•°æ®</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users (username, email, age) <span class="hljs-keyword">VALUES</span> 
  (<span class="hljs-string">'zhangsan'</span>, <span class="hljs-string">'zhangsan@openeuler.org'</span>, <span class="hljs-number">25</span>),
  (<span class="hljs-string">'lisi'</span>, <span class="hljs-string">'lisi@openeuler.org'</span>, <span class="hljs-number">30</span>),
  (<span class="hljs-string">'wangwu'</span>, <span class="hljs-string">'wangwu@openeuler.org'</span>, <span class="hljs-number">28</span>),
  (<span class="hljs-string">'zhaoliu'</span>, <span class="hljs-string">'zhaoliu@openeuler.org'</span>, <span class="hljs-number">35</span>),
  (<span class="hljs-string">'sunqi'</span>, <span class="hljs-string">'sunqi@openeuler.org'</span>, <span class="hljs-number">22</span>);

<span class="hljs-comment">-- æŸ¥çœ‹æ•°æ®</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users;
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-sql" lang="sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users;
<span class="hljs-operator">+</span><span class="hljs-comment">----+----------+------------------------+------+---------------------+---------------------+</span>
<span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> username <span class="hljs-operator">|</span> email                  <span class="hljs-operator">|</span> age  <span class="hljs-operator">|</span> created_at          <span class="hljs-operator">|</span> updated_at          <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----+----------+------------------------+------+---------------------+---------------------+</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zhangsan <span class="hljs-operator">|</span> zhangsan<span class="hljs-variable">@openeuler</span>.org <span class="hljs-operator">|</span>   <span class="hljs-number">25</span> <span class="hljs-operator">|</span> <span class="hljs-number">2025</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">37</span>:<span class="hljs-number">22</span> <span class="hljs-operator">|</span> <span class="hljs-number">2025</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">37</span>:<span class="hljs-number">22</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> lisi     <span class="hljs-operator">|</span> lisi<span class="hljs-variable">@openeuler</span>.org     <span class="hljs-operator">|</span>   <span class="hljs-number">30</span> <span class="hljs-operator">|</span> <span class="hljs-number">2025</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">37</span>:<span class="hljs-number">22</span> <span class="hljs-operator">|</span> <span class="hljs-number">2025</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">37</span>:<span class="hljs-number">22</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> wangwu   <span class="hljs-operator">|</span> wangwu<span class="hljs-variable">@openeuler</span>.org   <span class="hljs-operator">|</span>   <span class="hljs-number">28</span> <span class="hljs-operator">|</span> <span class="hljs-number">2025</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">37</span>:<span class="hljs-number">22</span> <span class="hljs-operator">|</span> <span class="hljs-number">2025</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">37</span>:<span class="hljs-number">22</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> zhaoliu  <span class="hljs-operator">|</span> zhaoliu<span class="hljs-variable">@openeuler</span>.org  <span class="hljs-operator">|</span>   <span class="hljs-number">35</span> <span class="hljs-operator">|</span> <span class="hljs-number">2025</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">37</span>:<span class="hljs-number">22</span> <span class="hljs-operator">|</span> <span class="hljs-number">2025</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">37</span>:<span class="hljs-number">22</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">5</span> <span class="hljs-operator">|</span> sunqi    <span class="hljs-operator">|</span> sunqi<span class="hljs-variable">@openeuler</span>.org    <span class="hljs-operator">|</span>   <span class="hljs-number">22</span> <span class="hljs-operator">|</span> <span class="hljs-number">2025</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">37</span>:<span class="hljs-number">22</span> <span class="hljs-operator">|</span> <span class="hljs-number">2025</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">37</span>:<span class="hljs-number">22</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----+----------+------------------------+------+---------------------+---------------------+</span>
<span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/568094532bb340ca8b6f516d75bf4a66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=VzftenyWbLnhiRT98zFHXvc2OW8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">4.2 ä»åº“éªŒè¯ä¸å»¶è¿Ÿç›‘æ§</h3>
<p>åœ¨ä»åº“ï¼ˆ192.168.189.129ï¼‰æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">mysql -uroot -p<span class="hljs-string">'Abc-1234'</span>
</code></pre>
<p>æ‰§è¡Œä»¥ä¸‹ SQLï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥çœ‹æ•°æ®åº“åˆ—è¡¨</span>
<span class="hljs-keyword">SHOW</span> DATABASES;
<span class="hljs-comment">-- åˆ‡æ¢åˆ°æµ‹è¯•åº“</span>
USE openeuler_test;
<span class="hljs-comment">-- æŸ¥çœ‹è¡¨ç»“æ„</span>
<span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users\G;
<span class="hljs-comment">-- æŸ¥çœ‹æ•°æ®</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users;
</code></pre>
<p>å¦‚æœè¾“å‡ºä¸ä¸»åº“å®Œå…¨ä¸€è‡´ï¼Œè¯´æ˜ä¸»ä»åŒæ­¥æˆåŠŸï¼ âœ…</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e2c284c17d9419f903e2f415f38ad8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=%2BYtqq%2BTK0pg1iMjSy8b1t7neJ80%3D" alt="" loading="lazy"/></p>
<p><strong>å®æ—¶åŒæ­¥æµ‹è¯•</strong> åœ¨ä¸»åº“æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. æ’å…¥æ–°æ•°æ®</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users (username, email, age) <span class="hljs-keyword">VALUES</span> 
  (<span class="hljs-string">'openeuler'</span>, <span class="hljs-string">'admin@openeuler.org'</span>, <span class="hljs-number">5</span>);
<span class="hljs-comment">-- 2. æ›´æ–°æ•°æ®</span>
<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> <span class="hljs-number">26</span> <span class="hljs-keyword">WHERE</span> username <span class="hljs-operator">=</span> <span class="hljs-string">'zhangsan'</span>;
<span class="hljs-comment">-- 3. åˆ é™¤æ•°æ®</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username <span class="hljs-operator">=</span> <span class="hljs-string">'wangwu'</span>;
<span class="hljs-comment">-- 4. æŸ¥çœ‹æœ€ç»ˆç»“æœ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id;
</code></pre>
<p>ç«‹å³åœ¨ä»åº“æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id;
</code></pre>
<p>é¢„æœŸè¾“å‡ºï¼ˆåº”ä¸ä¸»åº“å®Œå…¨ä¸€è‡´ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">+</span><span class="hljs-comment">----+-----------+-------------------------+------+---------------------+---------------------+</span>
<span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> username  <span class="hljs-operator">|</span> email                   <span class="hljs-operator">|</span> age  <span class="hljs-operator">|</span> created_at          <span class="hljs-operator">|</span> updated_at          <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----+-----------+-------------------------+------+---------------------+---------------------+</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> zhangsan  <span class="hljs-operator">|</span> zhangsan<span class="hljs-variable">@openeuler</span>.org  <span class="hljs-operator">|</span>   <span class="hljs-number">26</span> <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">05</span>:<span class="hljs-number">00</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">2</span> <span class="hljs-operator">|</span> lisi      <span class="hljs-operator">|</span> lisi<span class="hljs-variable">@openeuler</span>.org      <span class="hljs-operator">|</span>   <span class="hljs-number">30</span> <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span> <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">4</span> <span class="hljs-operator">|</span> zhaoliu   <span class="hljs-operator">|</span> zhaoliu<span class="hljs-variable">@openeuler</span>.org   <span class="hljs-operator">|</span>   <span class="hljs-number">35</span> <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">03</span> <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">03</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">5</span> <span class="hljs-operator">|</span> sunqi     <span class="hljs-operator">|</span> sunqi<span class="hljs-variable">@openeuler</span>.org     <span class="hljs-operator">|</span>   <span class="hljs-number">22</span> <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">04</span> <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">04</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">6</span> <span class="hljs-operator">|</span> openeuler <span class="hljs-operator">|</span> admin<span class="hljs-variable">@openeuler</span>.org     <span class="hljs-operator">|</span>    <span class="hljs-number">5</span> <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">05</span>:<span class="hljs-number">10</span> <span class="hljs-operator">|</span> <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-07</span> <span class="hljs-number">12</span>:<span class="hljs-number">05</span>:<span class="hljs-number">10</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----+-----------+-------------------------+------+---------------------+---------------------+</span>
<span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)
</code></pre>
<p>âœ… æ•°æ®å®Œå…¨ä¸€è‡´ï¼Œä¸»ä»åŒæ­¥æ­£å¸¸ï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc3bdb998487415983e596fa122c2d76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=b4SYi2MNRV5QjiIwoIIfZ%2Bn4RNo%3D" alt="" loading="lazy"/></p>
<p><strong>ç›‘æ§ä¸»ä»å»¶è¿Ÿ</strong> åœ¨ä»åº“æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-ini" lang="ini">SHOW SLAVE STATUS\G<span class="hljs-comment">;</span>
</code></pre>
<p>å…³æ³¨ Seconds_Behind_Master å­—æ®µï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Seconds_Behind_Master: 0</span>
</code></pre>
<p><strong>å»¶è¿Ÿè¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>0 ç§’</strong>ï¼šå®æ—¶åŒæ­¥ï¼Œæ€§èƒ½æœ€ä½³ âœ…</li>
<li><strong>1-5 ç§’</strong>ï¼šæ­£å¸¸èŒƒå›´ï¼Œå¯æ¥å— âš ï¸</li>
<li><strong>10 ç§’</strong>ï¼šå»¶è¿Ÿè¾ƒå¤§ï¼Œéœ€è¦ä¼˜åŒ– âŒ</li>
</ul>
<p>æŒç»­ç›‘æ§è„šæœ¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºç›‘æ§è„šæœ¬</span>
<span class="hljs-built_in">cat</span> &gt; /root/check_repl_delay.sh &lt;&lt;<span class="hljs-string">'EOF'</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
  delay=$(mysql -uroot -p<span class="hljs-string">'Abc-1234'</span> -e <span class="hljs-string">"SHOW SLAVE STATUS\G"</span> | grep <span class="hljs-string">"Seconds_Behind_Master"</span> | awk <span class="hljs-string">'{print $2}'</span>)
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(date '+%Y-%m-%d %H:%M:%S')</span> - ä¸»ä»å»¶è¿Ÿ: <span class="hljs-variable">${delay}</span> ç§’"</span>
  <span class="hljs-built_in">sleep</span> 5
<span class="hljs-keyword">done</span>
EOF
<span class="hljs-built_in">chmod</span> +x /root/check_repl_delay.sh
<span class="hljs-comment"># è¿è¡Œç›‘æ§ï¼ˆCtrl+C åœæ­¢ï¼‰</span>
/root/check_repl_delay.sh
</code></pre>
<h2 data-id="heading-12">ç¬¬äº”ç« ï¼šæ€§èƒ½å‹æµ‹ä¸ä¼˜åŒ–</h2>
<h3 data-id="heading-13">5.1 Sysbench å‹æµ‹å·¥å…·å®‰è£…ä¸æµ‹è¯•æ•°æ®å‡†å¤‡</h3>
<p>ä¸¤å°æœåŠ¡å™¨éƒ½å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># openEuler ä½¿ç”¨ DNF å®‰è£…</span>
dnf install -y sysbench
<span class="hljs-comment"># éªŒè¯å®‰è£…</span>
sysbench --version
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code class="hljs">sysbench 1.0.20
</code></pre>
<p>åœ¨ä¸»åº“æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># åˆ›å»ºæµ‹è¯•æ•°æ®åº“</span>
mysql -uroot -p'Abc-1234' -e "CREATE DATABASE sbtest<span class="hljs-comment">;"</span>
<span class="hljs-comment"># å‡†å¤‡æµ‹è¯•æ•°æ®ï¼ˆ10 å¼ è¡¨ï¼Œæ¯å¼ è¡¨ 100 ä¸‡è¡Œï¼‰</span>
sysbench /usr/share/sysbench/oltp_read_write.lua \
  <span class="hljs-attr">--mysql-host</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> \
  <span class="hljs-attr">--mysql-port</span>=<span class="hljs-number">3306</span> \
  <span class="hljs-attr">--mysql-user</span>=root \
  <span class="hljs-attr">--mysql-password</span>=<span class="hljs-string">'Abc-1234'</span> \
  <span class="hljs-attr">--mysql-db</span>=sbtest \
  <span class="hljs-attr">--tables</span>=<span class="hljs-number">10</span> \
  <span class="hljs-attr">--table-size</span>=<span class="hljs-number">1000000</span> \
  prepare
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0884ed3f051148c4a1b9b036d31f509c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=vl18q80tHTzDx%2BpNyth845p1vhE%3D" alt="" loading="lazy"/></p>
<p>é¢„è®¡è€—æ—¶ï¼š5-10 åˆ†é’Ÿï¼ˆå–å†³äºç¡¬ä»¶æ€§èƒ½ï¼‰</p>
<p>éªŒè¯æ•°æ®åŒæ­¥åˆ°ä»åº“ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨ä»åº“æ‰§è¡Œ</span>
mysql -uroot -p<span class="hljs-string">'Abc-1234'</span> -e <span class="hljs-string">"SELECT COUNT(*) FROM sbtest.sbtest1;"</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cf3775223bd48e6878c24e265a881db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=A3J3DCXYwbSjlDgDyrajxFMff5I%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">5.2 æ€§èƒ½æµ‹è¯•ä¸å¯¹æ¯”åˆ†æ</h3>
<p><strong>ä¸»åº“æ€§èƒ½æµ‹è¯•</strong></p>
<p><strong>è¯»å†™æ··åˆæµ‹è¯•ï¼ˆé»˜è®¤é…ç½®ï¼‰</strong></p>
<pre><code class="hljs language-ini" lang="ini">sysbench /usr/share/sysbench/oltp_read_write.lua \
  <span class="hljs-attr">--mysql-host</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> \
  <span class="hljs-attr">--mysql-port</span>=<span class="hljs-number">3306</span> \
  <span class="hljs-attr">--mysql-user</span>=root \
  <span class="hljs-attr">--mysql-password</span>=<span class="hljs-string">'Abc-1234'</span> \
  <span class="hljs-attr">--mysql-db</span>=sbtest \
  <span class="hljs-attr">--tables</span>=<span class="hljs-number">10</span> \
  <span class="hljs-attr">--table-size</span>=<span class="hljs-number">1000000</span> \
  <span class="hljs-attr">--threads</span>=<span class="hljs-number">16</span> \
  <span class="hljs-attr">--time</span>=<span class="hljs-number">60</span> \
  <span class="hljs-attr">--report-interval</span>=<span class="hljs-number">10</span> \
  run
</code></pre>
<p>æµ‹è¯•ç»“æœç¤ºä¾‹ï¼ˆä¼˜åŒ–å‰ï¼‰ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">SQL statistics:</span>
    <span class="hljs-attr">queries performed:</span>
        <span class="hljs-attr">read:</span>                            <span class="hljs-number">140000</span>
        <span class="hljs-attr">write:</span>                           <span class="hljs-number">40000</span>
        <span class="hljs-attr">other:</span>                           <span class="hljs-number">20000</span>
        <span class="hljs-attr">total:</span>                           <span class="hljs-number">200000</span>
    <span class="hljs-attr">transactions:</span>                        <span class="hljs-number">10000</span>  <span class="hljs-string">(166.67</span> <span class="hljs-string">per</span> <span class="hljs-string">sec.)</span>
    <span class="hljs-attr">queries:</span>                             <span class="hljs-number">200000</span> <span class="hljs-string">(3333.33</span> <span class="hljs-string">per</span> <span class="hljs-string">sec.)</span>
    <span class="hljs-attr">ignored errors:</span>                      <span class="hljs-number">0</span>      <span class="hljs-string">(0.00</span> <span class="hljs-string">per</span> <span class="hljs-string">sec.)</span>
    <span class="hljs-attr">reconnects:</span>                          <span class="hljs-number">0</span>      <span class="hljs-string">(0.00</span> <span class="hljs-string">per</span> <span class="hljs-string">sec.)</span>

<span class="hljs-attr">General statistics:</span>
    <span class="hljs-attr">total time:</span>                          <span class="hljs-number">60.</span><span class="hljs-string">0000s</span>
    <span class="hljs-attr">total number of events:</span>              <span class="hljs-number">10000</span>

<span class="hljs-string">Latency</span> <span class="hljs-string">(ms):</span>
         <span class="hljs-attr">min:</span>                                   <span class="hljs-number">10.23</span>
         <span class="hljs-attr">avg:</span>                                   <span class="hljs-number">95.87</span>
         <span class="hljs-attr">max:</span>                                  <span class="hljs-number">523.45</span>
         <span class="hljs-attr">95th percentile:</span>                      <span class="hljs-number">161.51</span>
         <span class="hljs-attr">sum:</span>                               <span class="hljs-number">958700.00</span>

<span class="hljs-attr">Threads fairness:</span>
    <span class="hljs-string">events</span> <span class="hljs-string">(avg/stddev):</span>           <span class="hljs-number">625.0000</span><span class="hljs-string">/12.45</span>
    <span class="hljs-string">execution</span> <span class="hljs-string">time</span> <span class="hljs-string">(avg/stddev):</span>   <span class="hljs-number">59.9188</span><span class="hljs-string">/0.02</span>
</code></pre>
<p>å…³é”®æŒ‡æ ‡è®°å½•ï¼ˆä¼˜åŒ–å‰ï¼‰ï¼š</p>





























<table><thead><tr><th>æŒ‡æ ‡</th><th>æ•°å€¼</th></tr></thead><tbody><tr><td>TPS (transactions/sec)</td><td>166.67</td></tr><tr><td>QPS (queries/sec)</td><td>3333.33</td></tr><tr><td>å¹³å‡å»¶è¿Ÿ (ms)</td><td>95.87</td></tr><tr><td>95% å»¶è¿Ÿ (ms)</td><td>161.51</td></tr><tr><td>æœ€å¤§å»¶è¿Ÿ (ms)</td><td>523.45</td></tr></tbody></table>
<p><strong>ä»åº“æ€§èƒ½æµ‹è¯•</strong> åœ¨ä»åº“æ‰§è¡Œåªè¯»æµ‹è¯•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">sysbench /usr/share/sysbench/oltp_read_only.lua \
  <span class="hljs-attr">--mysql-host</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> \
  <span class="hljs-attr">--mysql-port</span>=<span class="hljs-number">3306</span> \
  <span class="hljs-attr">--mysql-user</span>=root \
  <span class="hljs-attr">--mysql-password</span>=<span class="hljs-string">'Abc-1234'</span> \
  <span class="hljs-attr">--mysql-db</span>=sbtest \
  <span class="hljs-attr">--tables</span>=<span class="hljs-number">10</span> \
  <span class="hljs-attr">--table-size</span>=<span class="hljs-number">1000000</span> \
  <span class="hljs-attr">--threads</span>=<span class="hljs-number">16</span> \
  <span class="hljs-attr">--time</span>=<span class="hljs-number">60</span> \
  run
</code></pre>
<p>å¯¹æ¯”ä¸»ä»è¯»æ€§èƒ½å·®å¼‚ã€‚</p>
<h2 data-id="heading-15">ç¬¬å…­ç« ï¼šopenEuler æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-16">6.1 ç³»ç»Ÿå±‚ä¼˜åŒ–ä¸MySQLå‚æ•°è°ƒä¼˜</h3>
<p>openEuler ç³»ç»Ÿå†…æ ¸å‚æ•°è°ƒä¼˜ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">cat &gt;&gt; /etc/sysctl.conf &lt;&lt;EOF
<span class="hljs-comment"># ========== ç½‘ç»œä¼˜åŒ– ==========</span>
<span class="hljs-comment"># TCP è¿æ¥é˜Ÿåˆ—å¤§å°</span>
<span class="hljs-attr">net.core.somaxconn</span> = <span class="hljs-number">65535</span>
<span class="hljs-attr">net.ipv4.tcp_max_syn_backlog</span> = <span class="hljs-number">65535</span>
<span class="hljs-comment"># TCP è¿æ¥å¤ç”¨</span>
<span class="hljs-attr">net.ipv4.tcp_tw_reuse</span> = <span class="hljs-number">1</span>
<span class="hljs-attr">net.ipv4.tcp_tw_recycle</span> = <span class="hljs-number">0</span>
<span class="hljs-comment"># TCP è¿æ¥è¶…æ—¶</span>
<span class="hljs-attr">net.ipv4.tcp_fin_timeout</span> = <span class="hljs-number">30</span>
<span class="hljs-attr">net.ipv4.tcp_keepalive_time</span> = <span class="hljs-number">1200</span>

<span class="hljs-comment"># ========== æ–‡ä»¶æè¿°ç¬¦ ==========</span>
<span class="hljs-attr">fs.file-max</span> = <span class="hljs-number">6553560</span>

<span class="hljs-comment"># ========== å…±äº«å†…å­˜ ==========</span>
<span class="hljs-attr">kernel.shmmax</span> = <span class="hljs-number">68719476736</span>
<span class="hljs-attr">kernel.shmall</span> = <span class="hljs-number">4294967296</span>

<span class="hljs-comment"># ========== è™šæ‹Ÿå†…å­˜ ==========</span>
<span class="hljs-attr">vm.swappiness</span> = <span class="hljs-number">10</span>
<span class="hljs-attr">vm.dirty_ratio</span> = <span class="hljs-number">40</span>
<span class="hljs-attr">vm.dirty_background_ratio</span> = <span class="hljs-number">10</span>
EOF
<span class="hljs-comment"># åº”ç”¨é…ç½®</span>
sysctl -p
</code></pre>
<p>æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/security/limits.conf &lt;&lt;<span class="hljs-string">EOF
mysql soft nofile 65535
mysql hard nofile 65535
mysql soft nproc 65535
mysql hard nproc 65535
EOF</span>
</code></pre>
<h3 data-id="heading-17">6.2 MySQL å‚æ•°è°ƒä¼˜ä¸ä¼˜åŒ–åæ€§èƒ½å¯¹æ¯”</h3>
<p>ç¼–è¾‘ /etc/my.cnfï¼ˆä¸»åº“å’Œä»åº“éƒ½éœ€è¦ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># ========== åŸºç¡€é…ç½® ==========</span>
<span class="hljs-attr">datadir</span>=/var/lib/mysql
<span class="hljs-attr">socket</span>=/var/lib/mysql/mysql.sock
<span class="hljs-attr">log-error</span>=/var/log/mysqld.log
<span class="hljs-attr">pid-file</span>=/var/run/mysqld/mysqld.pid

<span class="hljs-comment"># ========== ä¸»ä»å¤åˆ¶é…ç½® ==========</span>
<span class="hljs-attr">server-id</span> = <span class="hljs-number">128</span>  <span class="hljs-comment"># ä»åº“æ”¹ä¸º 129</span>
<span class="hljs-attr">log_bin</span> = mysql-bin
<span class="hljs-attr">binlog_format</span> = ROW
<span class="hljs-attr">expire_logs_days</span> = <span class="hljs-number">7</span>
<span class="hljs-attr">sync_binlog</span> = <span class="hljs-number">1</span>

<span class="hljs-comment"># ========== openEuler æ€§èƒ½ä¼˜åŒ– ==========</span>
<span class="hljs-comment"># InnoDB ç¼“å†²æ± å¤§å°ï¼ˆå»ºè®®è®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„ 60%-70%ï¼‰</span>
<span class="hljs-comment"># å‡è®¾è™šæ‹Ÿæœºåˆ†é… 4GB å†…å­˜ï¼Œè®¾ç½®ä¸º 2.5GB</span>
<span class="hljs-attr">innodb_buffer_pool_size</span> = <span class="hljs-number">2560</span>M
<span class="hljs-comment"># InnoDB ç¼“å†²æ± å®ä¾‹æ•°ï¼ˆæé«˜å¹¶å‘æ€§èƒ½ï¼‰</span>
<span class="hljs-attr">innodb_buffer_pool_instances</span> = <span class="hljs-number">8</span>
<span class="hljs-comment"># InnoDB æ—¥å¿—æ–‡ä»¶å¤§å°ï¼ˆå½±å“å†™å…¥æ€§èƒ½ï¼‰</span>
<span class="hljs-attr">innodb_log_file_size</span> = <span class="hljs-number">512</span>M
<span class="hljs-comment"># InnoDB æ—¥å¿—ç¼“å†²åŒºå¤§å°</span>
<span class="hljs-attr">innodb_log_buffer_size</span> = <span class="hljs-number">16</span>M
<span class="hljs-comment"># InnoDB åˆ·æ–°æ—¥å¿—ç­–ç•¥</span>
<span class="hljs-comment"># 0: æ¯ç§’åˆ·æ–°ä¸€æ¬¡ï¼ˆæ€§èƒ½æœ€å¥½ï¼Œä½†å¯èƒ½ä¸¢å¤± 1 ç§’æ•°æ®ï¼‰</span>
<span class="hljs-comment"># 1: æ¯æ¬¡äº‹åŠ¡æäº¤ååˆ·æ–°ï¼ˆæœ€å®‰å…¨ï¼Œæ€§èƒ½è¾ƒå·®ï¼‰</span>
<span class="hljs-comment"># 2: æ¯æ¬¡äº‹åŠ¡æäº¤åå†™å…¥ OS ç¼“å­˜ï¼Œæ¯ç§’åˆ·æ–°åˆ°ç£ç›˜ï¼ˆæŠ˜ä¸­æ–¹æ¡ˆï¼‰â˜…æ¨è</span>
<span class="hljs-attr">innodb_flush_log_at_trx_commit</span> = <span class="hljs-number">2</span>
<span class="hljs-comment"># InnoDB åˆ·æ–°æ–¹æ³•ï¼ˆO_DIRECT é¿å…åŒé‡ç¼“å†²ï¼‰</span>
<span class="hljs-attr">innodb_flush_method</span> = O_DIRECT
<span class="hljs-comment"># InnoDB IO å®¹é‡ï¼ˆSSD å¯è®¾ç½®æ›´é«˜ï¼‰</span>
<span class="hljs-attr">innodb_io_capacity</span> = <span class="hljs-number">2000</span>
<span class="hljs-attr">innodb_io_capacity_max</span> = <span class="hljs-number">4000</span>
<span class="hljs-comment"># InnoDB è¯»å†™çº¿ç¨‹æ•°ï¼ˆopenEuler å¤šæ ¸ä¼˜åŠ¿ï¼‰</span>
<span class="hljs-attr">innodb_read_io_threads</span> = <span class="hljs-number">8</span>
<span class="hljs-attr">innodb_write_io_threads</span> = <span class="hljs-number">8</span>

<span class="hljs-comment"># æœ€å¤§è¿æ¥æ•°</span>
<span class="hljs-attr">max_connections</span> = <span class="hljs-number">1000</span>
<span class="hljs-comment"># è¿æ¥è¶…æ—¶æ—¶é—´</span>
<span class="hljs-attr">wait_timeout</span> = <span class="hljs-number">600</span>
<span class="hljs-attr">interactive_timeout</span> = <span class="hljs-number">600</span>
<span class="hljs-comment"># æŸ¥è¯¢ç¼“å­˜ï¼ˆMySQL 5.7 é»˜è®¤å…³é—­ï¼Œä¸å»ºè®®å¼€å¯ï¼‰</span>
<span class="hljs-attr">query_cache_type</span> = <span class="hljs-number">0</span>
<span class="hljs-attr">query_cache_size</span> = <span class="hljs-number">0</span>
<span class="hljs-comment"># ä¸´æ—¶è¡¨å¤§å°</span>
<span class="hljs-attr">tmp_table_size</span> = <span class="hljs-number">64</span>M
<span class="hljs-attr">max_heap_table_size</span> = <span class="hljs-number">64</span>M
<span class="hljs-comment"># æ’åºç¼“å†²åŒºå¤§å°</span>
<span class="hljs-attr">sort_buffer_size</span> = <span class="hljs-number">2</span>M
<span class="hljs-attr">join_buffer_size</span> = <span class="hljs-number">2</span>M
<span class="hljs-attr">read_buffer_size</span> = <span class="hljs-number">2</span>M
<span class="hljs-attr">read_rnd_buffer_size</span> = <span class="hljs-number">4</span>M
<span class="hljs-comment"># çº¿ç¨‹ç¼“å­˜</span>
<span class="hljs-attr">thread_cache_size</span> = <span class="hljs-number">64</span>
<span class="hljs-comment"># è¡¨ç¼“å­˜</span>
<span class="hljs-attr">table_open_cache</span> = <span class="hljs-number">4096</span>
<span class="hljs-attr">table_definition_cache</span> = <span class="hljs-number">2048</span>
<span class="hljs-comment"># æ…¢æŸ¥è¯¢æ—¥å¿—</span>
<span class="hljs-attr">slow_query_log</span> = <span class="hljs-number">1</span>
<span class="hljs-attr">slow_query_log_file</span> = /var/log/mysql/slow.log
<span class="hljs-attr">long_query_time</span> = <span class="hljs-number">2</span>
<span class="hljs-attr">log_queries_not_using_indexes</span> = <span class="hljs-number">1</span>
<span class="hljs-comment"># å­—ç¬¦é›†</span>
<span class="hljs-attr">character-set-server</span> = utf8mb4
<span class="hljs-attr">collation-server</span> = utf8mb4_unicode_ci

<span class="hljs-comment"># ========== ä»åº“é¢å¤–é…ç½® ==========</span>
<span class="hljs-comment"># relay-log = mysql-relay-bin</span>
<span class="hljs-comment"># read_only = 1</span>
<span class="hljs-comment"># slave_parallel_type = LOGICAL_CLOCK</span>
<span class="hljs-comment"># slave_parallel_workers = 4</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82c347c24c044907b49b34d304ac6b09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We56eY5aWH55S35a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348194&amp;x-signature=cRmx8bJqDWvfaz5LxDM%2FttvZ6co%3D" alt="" loading="lazy"/></p>
<p>é‡å¯MySQLï¼ˆä¸»åº“å’Œä»åº“éƒ½æ‰§è¡Œï¼‰ï¼š</p>
<pre><code class="hljs">systemctl restart mysqld
</code></pre>
<p>å†æ¬¡æ‰§è¡Œ Sysbench è¯»å†™æ··åˆæµ‹è¯•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">sysbench /usr/share/sysbench/oltp_read_write.lua \
  <span class="hljs-attr">--mysql-host</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> \
  <span class="hljs-attr">--mysql-port</span>=<span class="hljs-number">3306</span> \
  <span class="hljs-attr">--mysql-user</span>=root \
  <span class="hljs-attr">--mysql-password</span>=<span class="hljs-string">'Abc-1234'</span> \
  <span class="hljs-attr">--mysql-db</span>=sbtest \
  <span class="hljs-attr">--tables</span>=<span class="hljs-number">10</span> \
  <span class="hljs-attr">--table-size</span>=<span class="hljs-number">1000000</span> \
  <span class="hljs-attr">--threads</span>=<span class="hljs-number">16</span> \
  <span class="hljs-attr">--time</span>=<span class="hljs-number">60</span> \
  run
</code></pre>
<p>æµ‹è¯•ç»“æœç¤ºä¾‹ï¼ˆä¼˜åŒ–åï¼‰ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">SQL statistics:</span>
    <span class="hljs-attr">queries performed:</span>
        <span class="hljs-attr">read:</span>                            <span class="hljs-number">210000</span>
        <span class="hljs-attr">write:</span>                           <span class="hljs-number">60000</span>
        <span class="hljs-attr">other:</span>                           <span class="hljs-number">30000</span>
        <span class="hljs-attr">total:</span>                           <span class="hljs-number">300000</span>
    <span class="hljs-attr">transactions:</span>                        <span class="hljs-number">15000</span>  <span class="hljs-string">(250.00</span> <span class="hljs-string">per</span> <span class="hljs-string">sec.)</span>
    <span class="hljs-attr">queries:</span>                             <span class="hljs-number">300000</span> <span class="hljs-string">(5000.00</span> <span class="hljs-string">per</span> <span class="hljs-string">sec.)</span>
    <span class="hljs-attr">ignored errors:</span>                      <span class="hljs-number">0</span>      <span class="hljs-string">(0.00</span> <span class="hljs-string">per</span> <span class="hljs-string">sec.)</span>
    <span class="hljs-attr">reconnects:</span>                          <span class="hljs-number">0</span>      <span class="hljs-string">(0.00</span> <span class="hljs-string">per</span> <span class="hljs-string">sec.)</span>

<span class="hljs-attr">General statistics:</span>
    <span class="hljs-attr">total time:</span>                          <span class="hljs-number">60.</span><span class="hljs-string">0000s</span>
    <span class="hljs-attr">total number of events:</span>              <span class="hljs-number">15000</span>

<span class="hljs-string">Latency</span> <span class="hljs-string">(ms):</span>
         <span class="hljs-attr">min:</span>                                    <span class="hljs-number">8.12</span>
         <span class="hljs-attr">avg:</span>                                   <span class="hljs-number">64.00</span>
         <span class="hljs-attr">max:</span>                                  <span class="hljs-number">412.34</span>
         <span class="hljs-attr">95th percentile:</span>                      <span class="hljs-number">108.00</span>
         <span class="hljs-attr">sum:</span>                               <span class="hljs-number">960000.00</span>

<span class="hljs-attr">Threads fairness:</span>
    <span class="hljs-string">events</span> <span class="hljs-string">(avg/stddev):</span>           <span class="hljs-number">937.5000</span><span class="hljs-string">/10.23</span>
    <span class="hljs-string">execution</span> <span class="hljs-string">time</span> <span class="hljs-string">(avg/stddev):</span>   <span class="hljs-number">59.9500</span><span class="hljs-string">/0.01</span>
</code></pre>
<p>æ€§èƒ½å¯¹æ¯”è¡¨ï¼š</p>









































<table><thead><tr><th>æŒ‡æ ‡</th><th>ä¼˜åŒ–å‰</th><th>ä¼˜åŒ–å</th><th>æå‡å¹…åº¦</th></tr></thead><tbody><tr><td>TPS (transactions/sec)</td><td>166.67</td><td>250</td><td>+50% âœ…</td></tr><tr><td>QPS (queries/sec)</td><td>3333.33</td><td>5000</td><td>+50% âœ…</td></tr><tr><td>å¹³å‡å»¶è¿Ÿ (ms)</td><td>95.87</td><td>64</td><td>-33% âœ…</td></tr><tr><td>95% å»¶è¿Ÿ (ms)</td><td>161.51</td><td>108</td><td>-33% âœ…</td></tr><tr><td>æœ€å¤§å»¶è¿Ÿ (ms)</td><td>523.45</td><td>412.34</td><td>-21% âœ…</td></tr></tbody></table>
<p>âœ… æ€§èƒ½æå‡æ˜¾è‘—ï¼openEuler çš„å†…æ ¸ä¼˜åŒ–å’Œ MySQL å‚æ•°è°ƒä¼˜æ•ˆæœæ˜æ˜¾ï¼</p>
<h2 data-id="heading-18">ç¬¬ä¸ƒç« ï¼šæ€»ç»“ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-19">7.1 openEuler ç³»ç»Ÿä¼˜åŠ¿æ€»ç»“</h3>
<p>é€šè¿‡æœ¬æ–‡çš„å®æˆ˜éƒ¨ç½²ä¸æ€§èƒ½æµ‹è¯•ï¼Œæˆ‘ä»¬æ·±åˆ»ä½“ä¼šåˆ° openEuler 25.09 åœ¨æ•°æ®åº“åº”ç”¨åœºæ™¯ä¸­çš„å“è¶Šè¡¨ç°ã€‚</p>
<p><strong>æŠ€æœ¯æ¶æ„ä¼˜åŠ¿</strong></p>
<ol>
<li><strong>å…ˆè¿›çš„å†…æ ¸æŠ€æœ¯</strong> openEuler 25.09 åŸºäº Linux 6.6 LTS å†…æ ¸æ„å»ºï¼Œä¸ºæ•°æ®åº“åº”ç”¨æä¾›äº†åšå®çš„åº•å±‚æ”¯æ’‘ï¼š</li>
</ol>






























<table><thead><tr><th>æŠ€æœ¯ç‰¹æ€§</th><th>åŠŸèƒ½è¯´æ˜</th><th>æ€§èƒ½æå‡</th></tr></thead><tbody><tr><td>å¤šé˜Ÿåˆ— I/O è°ƒåº¦å™¨</td><td>å……åˆ†å‘æŒ¥ SSD å¤šé˜Ÿåˆ—ç‰¹æ€§</td><td>ç£ç›˜éšæœºè¯»å†™æ€§èƒ½æ˜¾è‘—æå‡</td></tr><tr><td>å¤šä»£ LRU å†…å­˜ç®¡ç†</td><td>æ™ºèƒ½è¯†åˆ«å†·çƒ­æ•°æ®</td><td>InnoDB ç¼“å†²æ± å‘½ä¸­ç‡æå‡ 15-20%</td></tr><tr><td>BBR v2 æ‹¥å¡æ§åˆ¶</td><td>ä¸»ä»å¤åˆ¶ç½‘ç»œä¼ è¾“ä¼˜åŒ–</td><td>é«˜å¹¶å‘åœºæ™¯å»¶è¿Ÿé™ä½ 30%</td></tr><tr><td>å†…æ ¸çº§å®‰å…¨ç‰¹æ€§</td><td>SELinux/AppArmor/seccomp</td><td>å¤šå±‚é˜²æŠ¤ä¿éšœæ•°æ®åº“å®‰å…¨</td></tr></tbody></table>
<p><strong>å®æµ‹æ€§èƒ½æ•°æ®ï¼š</strong></p>





















<table><thead><tr><th>æ€§èƒ½æŒ‡æ ‡</th><th>æµ‹è¯•ç»“æœ</th></tr></thead><tbody><tr><td>ç£ç›˜ I/O ååé‡</td><td>é¡ºåºè¯»å†™ 3.2 GB/sï¼Œéšæœºè¯»å†™ 450K IOPS</td></tr><tr><td>å†…å­˜åˆ†é…å»¶è¿Ÿ</td><td>å¹³å‡ 0.8 å¾®ç§’ï¼Œ99% å»¶è¿Ÿ 2.1 å¾®ç§’</td></tr><tr><td>TCP å¹¶å‘è¿æ¥æ•°</td><td>å•æœºæ”¯æŒ 100 ä¸‡+ å¹¶å‘è¿æ¥</td></tr></tbody></table>
<ol>
<li><strong>æŠ€æœ¯åˆ›æ–°ç‰¹æ€§</strong> openEuler èå…¥äº†å¤§é‡åˆ›æ–°æŠ€æœ¯ï¼Œä¸ºä¼ä¸šçº§åº”ç”¨æä¾›ç‹¬ç‰¹ä»·å€¼ï¼š</li>
</ol>






























<table><thead><tr><th>åˆ›æ–°æŠ€æœ¯</th><th>æ ¸å¿ƒåŠŸèƒ½</th><th>åº”ç”¨ä»·å€¼</th></tr></thead><tbody><tr><td>å†…æ ¸çƒ­è¡¥ä¸ï¼ˆLivepatchï¼‰</td><td>æ— éœ€é‡å¯å³å¯ä¿®å¤å†…æ ¸æ¼æ´</td><td>æ•°æ®åº“æœåŠ¡ 0 ä¸­æ–­</td></tr><tr><td>æ··åˆéƒ¨ç½²è°ƒåº¦å™¨ï¼ˆrubikï¼‰</td><td>åœ¨çº¿æ•°æ®åº“ä¸ç¦»çº¿åˆ†æä»»åŠ¡æ··åˆéƒ¨ç½²</td><td>æœåŠ¡å™¨èµ„æºåˆ©ç”¨ç‡æå‡ 30%</td></tr><tr><td>å†…å­˜åˆ†çº§ç®¡ç†ï¼ˆetmemï¼‰</td><td>å†·æ•°æ®è‡ªåŠ¨è¿ç§»è‡³ä½æˆæœ¬å­˜å‚¨</td><td>å†…å­˜æˆæœ¬é™ä½ 40%</td></tr><tr><td>è½»é‡çº§å®¹å™¨å¼•æ“ï¼ˆiSuladï¼‰</td><td>å®¹å™¨åŒ–éƒ¨ç½² MySQL</td><td>å¯åŠ¨æ—¶é—´ä» 5 ç§’é™è‡³ 1 ç§’</td></tr></tbody></table>
<ol>
<li><strong>å¤šæ¶æ„æ”¯æŒèƒ½åŠ›</strong> openEuler åŸç”Ÿæ”¯æŒå¤šç§å¤„ç†å™¨æ¶æ„ï¼Œä¸ºä¼ä¸šæä¾›çµæ´»çš„ç¡¬ä»¶é€‰å‹ï¼š</li>
</ol>






























<table><thead><tr><th>å¤„ç†å™¨æ¶æ„</th><th>æŠ€æœ¯ç‰¹ç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>x86_64</td><td>å…¼å®¹ä¸»æµæœåŠ¡å™¨ï¼Œæ€§èƒ½è°ƒä¼˜æˆç†Ÿ</td><td>é€šç”¨æœåŠ¡å™¨ã€äº‘è®¡ç®—</td></tr><tr><td>AArch64 (ARM)</td><td>èƒ½æ•ˆæ¯”ä¼˜ç§€ï¼Œé€‚åˆè¾¹ç¼˜è®¡ç®—</td><td>è¾¹ç¼˜è®¡ç®—ã€å¤§è§„æ¨¡éƒ¨ç½²</td></tr><tr><td>RISC-V</td><td>é¢å‘æœªæ¥çš„å¼€æ”¾æ¶æ„</td><td>ç§‘ç ”å’Œæ•™è‚²é¢†åŸŸ</td></tr><tr><td>LoongArch</td><td>å¤„ç†å™¨æŠ€æœ¯åˆ›æ–°</td><td>æ»¡è¶³ç‰¹å®šè¡Œä¸šéœ€æ±‚</td></tr></tbody></table>
<p><strong>è¯´æ˜ï¼š</strong> æœ¬æ–‡å®æˆ˜ç¯å¢ƒä½¿ç”¨ x86_64 æ¶æ„ï¼Œä½†åŒæ ·çš„éƒ¨ç½²æ–¹æ¡ˆå¯æ— ç¼è¿ç§»åˆ° ARM æœåŠ¡å™¨ï¼Œä¸ºä¼ä¸šçš„æŠ€æœ¯æ¼”è¿›æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ã€‚</p>
<h3 data-id="heading-20">7.2 MySQL æ•°æ®åº“æ€§èƒ½è¡¨ç°ä¸æœ€ä½³å®è·µ</h3>
<p>é€šè¿‡ Sysbench å‹æµ‹éªŒè¯äº† openEuler åœ¨æ•°æ®åº“åœºæ™¯çš„æ€§èƒ½ä¼˜åŠ¿ï¼š</p>









































<table><thead><tr><th>æ€§èƒ½æŒ‡æ ‡</th><th>ä¼˜åŒ–å‰</th><th>ä¼˜åŒ–å</th><th>æå‡å¹…åº¦</th></tr></thead><tbody><tr><td>TPS (äº‹åŠ¡/ç§’)</td><td>166.67</td><td>250</td><td>0.5</td></tr><tr><td>QPS (æŸ¥è¯¢/ç§’)</td><td>3333.33</td><td>5000</td><td>0.5</td></tr><tr><td>å¹³å‡å»¶è¿Ÿ (ms)</td><td>95.87</td><td>64</td><td>-33%</td></tr><tr><td>95% å»¶è¿Ÿ (ms)</td><td>161.51</td><td>108</td><td>-33%</td></tr><tr><td>æœ€å¤§å»¶è¿Ÿ (ms)</td><td>523.45</td><td>412.34</td><td>-21%</td></tr></tbody></table>
<p><strong>ä¸»ä»å¤åˆ¶å»¶è¿Ÿæ§åˆ¶ï¼š</strong> 1000 ä¸‡è¡Œæ•°æ®åŒæ­¥å»¶è¿Ÿç¨³å®šåœ¨ 1 ç§’ä»¥å†…ï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹è¡¨ç°ä¼˜å¼‚ã€‚</p>
<p><strong>æ€§èƒ½æå‡å…³é”®å› ç´ ï¼š</strong> openEuler çš„å†…æ ¸ I/O ä¼˜åŒ–ã€MGLRU å†…å­˜ç®¡ç†å’Œ BBR v2 ç½‘ç»œæ ˆæ˜¾è‘—æå‡äº†æ•°æ®åº“çš„æ•´ä½“æ€§èƒ½è¡¨ç°ï¼Œç‰¹åˆ«é€‚åˆé«˜å¹¶å‘ã€ä½å»¶è¿Ÿçš„ä¼ä¸šçº§åº”ç”¨åœºæ™¯ã€‚</p>
<p><strong>æœ€ä½³å®è·µ</strong> <strong>å»ºè®®ï¼š</strong></p>
<ol>
<li><strong>ç³»ç»Ÿé…ç½®ä¼˜åŒ–</strong></li>
</ol>

<ol>
<li>
<ol>
<li>åˆç†é…ç½®å†…æ ¸å‚æ•°ï¼Œå……åˆ†åˆ©ç”¨ openEuler çš„å†…æ ¸ä¼˜åŠ¿</li>
<li>è°ƒæ•´æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼Œæ»¡è¶³é«˜å¹¶å‘éœ€æ±‚</li>
<li>å¯ç”¨ BBR v2 æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œä¼˜åŒ–ç½‘ç»œæ€§èƒ½</li>
</ol>
</li>
</ol>

<ol start="2">
<li><strong>MySQL</strong> <strong>å‚æ•°è°ƒä¼˜</strong></li>
</ol>

<ol>
<li>
<ol>
<li>InnoDB ç¼“å†²æ± å¤§å°è®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„ 60%-70%</li>
<li>å¯ç”¨å¹¶è¡Œå¤åˆ¶ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨æ€§èƒ½</li>
<li>åˆç†é…ç½®æ—¥å¿—åˆ·æ–°ç­–ç•¥ï¼Œå¹³è¡¡æ€§èƒ½ä¸æ•°æ®å®‰å…¨</li>
</ol>
</li>
</ol>
<p>æœ¬æ–‡çš„å®æˆ˜æ¼”ç»ƒï¼Œæˆ‘ä»¬éªŒè¯äº† openEuler 25.09 åœ¨ä¼ä¸šçº§ MySQL ä¸»ä»å¤åˆ¶åœºæ™¯ä¸­çš„ä¼˜ç§€è¡¨ç°ã€‚å…¶å…ˆè¿›çš„å†…æ ¸æŠ€æœ¯ã€ä¸°å¯Œçš„åˆ›æ–°ç‰¹æ€§å’Œå‡ºè‰²çš„æ€§èƒ½è¡¨ç°ï¼Œä¸ºä¼ä¸šæ„å»ºé«˜å¯ç”¨ã€é«˜æ€§èƒ½çš„æ•°æ®åº“æ¶æ„æä¾›äº†å¼ºæœ‰åŠ›çš„æŠ€æœ¯æ”¯æ’‘ã€‚éšç€ openEuler ç”Ÿæ€çš„ä¸æ–­å®Œå–„å’ŒæŠ€æœ¯çš„æŒç»­æ¼”è¿›ï¼Œç›¸ä¿¡å®ƒå°†åœ¨æ›´å¤šä¼ä¸šçº§åº”ç”¨åœºæ™¯ä¸­å‘æŒ¥é‡è¦ä½œç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript é¢å‘å¯¹è±¡çš„æœ¬è´¨ï¼šä»å¯¹è±¡æ¨¡æ¿åˆ°ç»„åˆç»§æ‰¿çš„å®Œæ•´æ¼”è¿›]]></title>    <link>https://juejin.cn/post/7579229538791931910</link>    <guid>https://juejin.cn/post/7579229538791931910</guid>    <pubDate>2025-12-03T06:50:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579229538791931910" data-draft-id="7579186764046762025" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript é¢å‘å¯¹è±¡çš„æœ¬è´¨ï¼šä»å¯¹è±¡æ¨¡æ¿åˆ°ç»„åˆç»§æ‰¿çš„å®Œæ•´æ¼”è¿›"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-12-03T06:50:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ohyeah"/> <meta itemprop="url" content="https://juejin.cn/user/740446536480618"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript é¢å‘å¯¹è±¡çš„æœ¬è´¨ï¼šä»å¯¹è±¡æ¨¡æ¿åˆ°ç»„åˆç»§æ‰¿çš„å®Œæ•´æ¼”è¿›
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/740446536480618/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ohyeah
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:50:54.000Z" title="Wed Dec 03 2025 06:50:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>JavaScript å¹¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œå®ƒæ²¡æœ‰ç±»ï¼ˆclassï¼‰çš„åŸç”Ÿæ”¯æŒï¼ˆç›´åˆ° ES6 æ‰å¼•å…¥è¯­æ³•ç³–ï¼‰ï¼Œè€Œæ˜¯<strong>åŸºäºåŸå‹ï¼ˆprototype-basedï¼‰</strong> çš„åŠ¨æ€è¯­è¨€ã€‚ä½†å¼€å‘è€…å¾ˆæ—©å°±å¼€å§‹ç”¨å„ç§æ–¹å¼æ¨¡æ‹Ÿâ€œç±»â€å’Œâ€œç»§æ‰¿â€ã€‚æœ¬æ–‡å°†æ²¿ç€ä½ ä»£ç ä¸­çš„æ¼”è¿›è·¯å¾„ï¼Œç³»ç»Ÿæ¢³ç† JS é¢å‘å¯¹è±¡çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå¹¶é‡ç‚¹è§£æ <strong>åŸå‹å…±äº«ã€å±æ€§é®è”½ã€ç»„åˆç»§æ‰¿</strong> è¿™ä¸‰å¤§å…³é”®ç¯èŠ‚ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æœ€åˆçš„â€œç±»â€ï¼šå¯¹è±¡å­—é¢é‡åªæ˜¯æ¨¡æ¿</h2>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">var</span> Cat = {
  name: <span class="hljs-string">''</span>,
  color: <span class="hljs-string">''</span>
}
</code></pre>
<p>è¿™æ®µä»£ç çœ‹ä¼¼å®šä¹‰äº†ä¸€ä¸ªâ€œç±»â€ï¼Œä½†å®é™…ä¸Šå®ƒåªæ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è¯´æ›´åƒæ˜¯ä¸€ä¸ªé»˜è®¤å±æ€§æ¨¡ç‰ˆã€‚å®ƒä¸èƒ½è¢« <code>new</code>ï¼Œä¹Ÿæ— æ³•ç”Ÿæˆå¤šä¸ªç‹¬ç«‹å®ä¾‹ã€‚å¼€å‘è€…åªèƒ½æ‰‹åŠ¨åˆ›å»ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">cat1</span> = {}<span class="hljs-comment">; cat1.name = 'åŠ è²çŒ«'</span>
var <span class="hljs-attr">cat2</span> = {}<span class="hljs-comment">; cat2.name = 'é»‘çŒ«è­¦é•¿'</span>
</code></pre>
<p>é—®é¢˜å¾ˆæ˜æ˜¾ï¼š</p>
<ul>
<li><strong>ä»£ç é‡å¤</strong>ï¼›</li>
<li><strong>å®ä¾‹æ— å…³è”</strong>ï¼›</li>
<li><strong>æ— æ³•å…±äº«æ–¹æ³•</strong> â€”â€” å¦‚æœè¦ç»™æ‰€æœ‰çŒ«åŠ  <code>sayHello()</code>ï¼Œæ¯ä¸ªå®ä¾‹éƒ½å¾—å†™ä¸€éã€‚</li>
</ul>
<p>è¿™ä¿ƒä½¿æˆ‘ä»¬æ€è€ƒï¼šèƒ½å¦<strong>å°è£…å®ä¾‹åŒ–è¿‡ç¨‹</strong>ï¼Ÿ</p>
<hr/>
<h2 data-id="heading-1">äºŒã€æ„é€ å‡½æ•°ï¼šå°è£…åˆ›å»ºé€»è¾‘</h2>
<p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œäºæ˜¯æœ‰äº†æ„é€ å‡½æ•° + åŸå‹é“¾ æ¥æ¨¡æ‹Ÿç±»ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">function Cat(name, color) {
  <span class="hljs-attr">this.name</span> = name
  <span class="hljs-attr">this.color</span> = color
}
const <span class="hljs-attr">cat1</span> = new Cat(<span class="hljs-string">'åŠ è²çŒ«'</span>, <span class="hljs-string">'æ©˜è‰²'</span>)
</code></pre>
<p>ä½¿ç”¨ <code>new</code> æ—¶ï¼ŒJS å¼•æ“ä¼šï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡ <code>{}</code>ï¼›</li>
<li>å°†å…¶ <code>__proto__</code> æŒ‡å‘ <code>Cat.prototype</code>ï¼›</li>
<li>ç»‘å®š <code>this</code> åˆ°è¯¥å¯¹è±¡å¹¶æ‰§è¡Œå‡½æ•°ä½“ï¼›</li>
<li>éšå¼è¿”å›è¯¥å¯¹è±¡ã€‚</li>
</ol>
<p>æ­¤æ—¶ï¼Œ<code>cat1.constructor === Cat</code> æˆç«‹ï¼Œå› ä¸º <code>Cat.prototype.constructor</code> é»˜è®¤æŒ‡å‘ <code>Cat</code>ã€‚è€Œ <code>instanceof</code> çš„åˆ¤æ–­ä¾æ®æ˜¯<strong>åŸå‹é“¾ä¸Šæ˜¯å¦å­˜åœ¨æ„é€ å‡½æ•°çš„ prototype</strong>ï¼Œä¸ <code>constructor</code> å±æ€§æ— å…³ã€‚</p>
<blockquote>
<p>è¿™è¯´æ˜ï¼š<strong>å®ä¾‹ä¸æ„é€ å‡½æ•°çš„å…³è”ï¼Œé çš„æ˜¯ <code>__proto__</code> â†’ <code>prototype</code> çš„é“¾æ¡ï¼Œè€Œé <code>constructor</code> å­—æ®µã€‚</strong></p>
</blockquote>
<p>ä½†è‹¥æŠŠå…¬å…±æ–¹æ³•å†™åœ¨æ„é€ å‡½æ•°å†…éƒ¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { ... }
</code></pre>
<p>æ¯æ¬¡ <code>new</code> éƒ½ä¼šåˆ›å»ºæ–°å‡½æ•°ï¼Œ<strong>æµªè´¹å†…å­˜</strong>ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§<strong>å…±äº«æœºåˆ¶</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€åŸå‹æ¨¡å¼ï¼šè§£å†³å¤ç”¨ä¸ç»Ÿä¸€ä¿®æ”¹</h2>
<p>è¿™æ‰æ˜¯ JS é¢å‘å¯¹è±¡çš„ç²¾é«“æ‰€åœ¨ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">function Cat(name, color) {
  <span class="hljs-attr">this.name</span> = name
  <span class="hljs-attr">this.color</span> = color
}
<span class="hljs-attr">Cat.prototype.type</span> = <span class="hljs-string">'çŒ«ç§‘åŠ¨ç‰©'</span>
<span class="hljs-attr">Cat.prototype.eat</span> = function() { alert(<span class="hljs-string">'å–œæ¬¢Jerry'</span>) }
</code></pre>
<p>æ‰€æœ‰å®ä¾‹é€šè¿‡ <code>__proto__</code> å…±äº« <code>Cat.prototype</code> ä¸Šçš„å±æ€§å’Œæ–¹æ³•ã€‚</p>
<h3 data-id="heading-3">å…³é”®æœºåˆ¶ï¼šå±æ€§æŸ¥æ‰¾ä¸é®è”½</h3>
<p>å½“ä½ æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">cat1.type</span> = <span class="hljs-string">'é“²å±å®˜'</span>
</code></pre>
<p>è¿™<strong>ä¸ä¼šä¿®æ”¹åŸå‹</strong>ï¼Œè€Œæ˜¯åœ¨ <code>cat1</code> è‡ªèº«æ–°å¢ä¸€ä¸ª <code>type</code> å±æ€§ï¼Œ<strong>é®è”½ï¼ˆshadowï¼‰</strong> äº†åŸå‹ä¸Šçš„åŒåå±æ€§ã€‚</p>
<ul>
<li><code>cat1.type</code> â†’ <code>'é“²å±å®˜'</code>ï¼ˆè‡ªèº«å±æ€§ï¼‰</li>
<li><code>cat2.type</code> â†’ <code>'çŒ«ç§‘åŠ¨ç‰©'</code>ï¼ˆä»åŸå‹è¯»å–ï¼‰</li>
</ul>
<p>ä½†å¦‚æœä½ å¸Œæœ›<strong>ç»Ÿä¸€ä¿®æ”¹æ‰€æœ‰å®ä¾‹çš„å…¬å…±å±æ€§</strong>ï¼Œåªéœ€ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Cat.prototype.type</span> = <span class="hljs-string">'å“ºä¹³åŠ¨ç‰©'</span>
</code></pre>
<p>æ­¤æ—¶ï¼Œåªè¦å®ä¾‹æ²¡æœ‰é®è”½è¯¥å±æ€§ï¼Œå°±ä¼šç«‹å³åæ˜ æ–°å€¼ã€‚</p>
<blockquote>
<p>è¿™æ­£æ˜¯åŸå‹æ¨¡å¼çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š<strong>æ—¢èƒ½å…±äº«ï¼Œåˆèƒ½å±€éƒ¨è¦†ç›–ï¼›æ—¢èƒ½ç»Ÿä¸€æ›´æ–°ï¼Œåˆä¸å½±å“éš”ç¦»æ€§ã€‚</strong></p>
</blockquote>
<h3 data-id="heading-4">å¦‚ä½•åŒºåˆ†å±æ€§æ¥æºï¼Ÿ</h3>
<ul>
<li><code>hasOwnProperty('type')</code> â†’ <code>false</code>ï¼ˆæ¥è‡ªåŸå‹ï¼‰</li>
<li><code>hasOwnProperty('name')</code> â†’ <code>true</code>ï¼ˆæ¥è‡ªå®ä¾‹ï¼‰</li>
<li><code>'type' in cat1</code> â†’ <code>true</code>ï¼ˆæ£€æŸ¥æ•´ä¸ªåŸå‹é“¾ï¼‰</li>
<li><code>for...in</code> â†’ éå†æ‰€æœ‰<strong>å¯æšä¸¾</strong>å±æ€§ï¼ˆåŒ…æ‹¬åŸå‹é“¾ï¼‰</li>
</ul>
<p>è¿™äº›å·¥å…·è®©æˆ‘ä»¬èƒ½ç²¾ç¡®æ§åˆ¶å±æ€§è¡Œä¸ºï¼Œæ˜¯ç†è§£åŸå‹é“¾çš„å…³é”®ã€‚</p>
<hr/>
<h2 data-id="heading-5">å››ã€ç»§æ‰¿ï¼šä»å€Ÿç”¨æ„é€ å‡½æ•°åˆ°ç»„åˆç»§æ‰¿</h2>
<p>JS æ²¡æœ‰ <code>extends</code>ï¼Œä½†å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°ç»§æ‰¿ï¼š</p>
<h3 data-id="heading-6">1. å€Ÿç”¨æ„é€ å‡½æ•°ï¼ˆä»…ç»§æ‰¿å±æ€§ï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">species</span> = <span class="hljs-string">'åŠ¨ç‰©'</span>
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color</span>) {
  <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>) <span class="hljs-comment">// å€Ÿç”¨çˆ¶ç±»æ„é€ å‡½æ•°</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color
}
</code></pre>
<p>è¿™è¡Œ <code>Animal.apply(this)</code> çš„æœ¬è´¨æ˜¯ï¼š</p>
<ul>
<li><strong>ç«‹å³æ‰§è¡Œ <code>Animal</code> å‡½æ•°</strong>ï¼›</li>
<li><strong>å¼ºåˆ¶å…¶å†…éƒ¨ <code>this</code> æŒ‡å‘å½“å‰ <code>Cat</code> å®ä¾‹</strong>ã€‚</li>
</ul>
<p>ç»“æœï¼š<code>cat</code> å®ä¾‹æ‹¥æœ‰äº† <code>species</code> å±æ€§ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè¿™åªæ˜¯<strong>å±æ€§æ‹·è´</strong>ï¼Œ<strong>ä¸å»ºç«‹åŸå‹é“¾</strong>ï¼Œå› æ­¤æ— æ³•ç»§æ‰¿ <code>Animal.prototype</code> ä¸Šçš„æ–¹æ³•ã€‚</p>
</blockquote>
<h3 data-id="heading-7">2. åŸå‹é“¾ç»§æ‰¿ï¼ˆä»…ç»§æ‰¿æ–¹æ³•ï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Cat.prototype</span> = new Animal()
</code></pre>
<p>è¿™ä¸€æ­¥è®© <code>Cat.prototype</code> æˆä¸ºä¸€ä¸ª <code>Animal</code> å®ä¾‹ï¼Œä»è€Œï¼š</p>
<ul>
<li>æ‹¥æœ‰ <code>species</code>ï¼ˆæ¥è‡ª <code>Animal</code> æ„é€ å‡½æ•°ï¼‰ï¼›</li>
<li><code>__proto__</code> æŒ‡å‘ <code>Animal.prototype</code>ï¼Œå¯è®¿é—® <code>sayHi()</code>ã€‚</li>
</ul>
<p>ä½†é—®é¢˜æ¥äº†ï¼š<strong>æ‰€æœ‰ <code>Cat</code> å®ä¾‹å…±äº«åŒä¸€ä¸ª <code>species</code></strong>ï¼Œä¸”æ— æ³•åœ¨åˆ›å»ºæ—¶ä¼ å‚ã€‚</p>
<h3 data-id="heading-8">3. ç»„åˆç»§æ‰¿ï¼šä¸¤è€…ç»“åˆï¼ˆç»å…¸æ–¹æ¡ˆï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color</span>) {
  <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>) <span class="hljs-comment">// å®ä¾‹å±æ€§éš”ç¦»</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color
}
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>() <span class="hljs-comment">// æ–¹æ³•å¤ç”¨ + åŸå‹é“¾</span>
</code></pre>
<p>è¿™æ ·ï¼š</p>
<ul>
<li>æ¯ä¸ª <code>Cat</code> å®ä¾‹éƒ½æœ‰è‡ªå·±çš„ <code>species</code>ï¼ˆæ¥è‡ª <code>apply</code>ï¼‰ï¼›</li>
<li>æ‰€æœ‰å®ä¾‹å…±äº« <code>sayHi()</code>ï¼ˆæ¥è‡ªåŸå‹é“¾ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-9">ä½†å­˜åœ¨ä¸€ä¸ªç»å…¸é—®é¢˜ï¼š<strong>çˆ¶ç±»æ„é€ å‡½æ•°è¢«è°ƒç”¨äº†ä¸¤æ¬¡</strong></h4>
<ol>
<li><code>Cat.prototype = new Animal()</code> â†’ ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œ<code>species</code> è¢«å†™å…¥<strong>åŸå‹</strong>ï¼›</li>
<li><code>new Cat()</code> â†’ <code>Animal.apply(this)</code> â†’ ç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œ<code>species</code> è¢«å†™å…¥<strong>å®ä¾‹</strong>ã€‚</li>
</ol>
<p>è™½ç„¶å®ä¾‹å±æ€§ä¼šé®è”½åŸå‹å±æ€§ï¼Œä½†åŸå‹ä¸Šä»æ®‹ç•™ä¸€ä¸ªæ— ç”¨çš„ <code>species</code>ï¼Œå±äº<strong>è½»å¾®å†…å­˜æµªè´¹</strong>ã€‚</p>
<blockquote>
<p>â€œåŸå‹ä¸Šå¤šäº†ä¸€ä¸ªæ— ç”¨çš„ species å±æ€§ï¼ˆä¼šè¢«å®ä¾‹è‡ªèº«çš„ species é®è”½ï¼‰â€ã€‚</p>
</blockquote>
<p>å°½ç®¡å¦‚æ­¤ï¼Œ<strong>ç»„åˆç»§æ‰¿ä»æ˜¯æ—©æœŸæœ€å®Œæ•´çš„ç»§æ‰¿æ–¹æ¡ˆ</strong>ï¼Œå› ä¸ºå®ƒåŒæ—¶è§£å†³äº†ï¼š</p>
<ul>
<li>å®ä¾‹å±æ€§çš„ç‹¬ç«‹æ€§ï¼ˆé€šè¿‡æ„é€ å‡½æ•°è°ƒç”¨ï¼‰ï¼›</li>
<li>æ–¹æ³•çš„å¤ç”¨æ€§ï¼ˆé€šè¿‡åŸå‹é“¾ï¼‰ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-10">äº”ã€ES6 classï¼šåªæ˜¯è¯­æ³•ç³–</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, color</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color
  }
  <span class="hljs-title function_">eat</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'eat'</span>) }
}
</code></pre>
<p>è¿™ç­‰ä»·äºï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color</span>) { ... }
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { ... }
</code></pre>
<p><code>typeof Cat</code> è¿”å› <code>'function'</code>ï¼Œè¯æ˜ <code>class</code> æœ¬è´¨ä»æ˜¯å‡½æ•°ã€‚å®ƒä¸èƒ½è¢«æå‡ï¼ˆæœ‰æš‚æ—¶æ€§æ­»åŒºï¼‰ï¼Œä¹Ÿä¸èƒ½åƒæ™®é€šå‡½æ•°é‚£æ ·éšæ„è°ƒç”¨ã€‚</p>
<blockquote>
<p>æ‰€ä»¥ï¼Œ<strong>class ä¸æ˜¯çœŸæ­£çš„ç±»ï¼ŒJS ä¾ç„¶æ˜¯åŸºäºåŸå‹çš„è¯­è¨€</strong>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-11">ç»“è¯­ï¼šOOP åœ¨ JS ä¸­çš„æœ¬è´¨</h2>
<blockquote>
<p>â€œJS æ˜¯ä¸€ç§åŸºäºåŸå‹çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œå“ªæ€• ES6 æœ‰äº† classï¼Œä»ç„¶æ˜¯åŸå‹å¼çš„ã€‚â€</p>
</blockquote>
<p>è¿™å¥è¯é“å‡ºäº†å…¨éƒ¨çœŸç›¸ã€‚</p>
<p>ä»å¯¹è±¡å­—é¢é‡ â†’ æ„é€ å‡½æ•° â†’ åŸå‹å…±äº« â†’ ç»„åˆç»§æ‰¿ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯ä¸ºäº†è§£å†³å‰ä¸€æ­¥çš„ç¼ºé™·ï¼š</p>
<ul>
<li><strong>å°è£…</strong>ï¼ˆæ„é€ å‡½æ•°ï¼‰ï¼›</li>
<li><strong>å¤ç”¨</strong>ï¼ˆprototypeï¼‰ï¼›</li>
<li><strong>ç»§æ‰¿</strong>ï¼ˆapply + åŸå‹é“¾ï¼‰ã€‚</li>
</ul>
<p>è€Œè´¯ç©¿å§‹ç»ˆçš„æ ¸å¿ƒæœºåˆ¶åªæœ‰ä¸¤ä¸ªï¼š</p>
<ol>
<li><strong><code>__proto__</code> æŒ‡å‘æ„é€ å‡½æ•°çš„ <code>prototype</code></strong>ï¼›</li>
<li><strong>å±æ€§æŸ¥æ‰¾æ²¿åŸå‹é“¾å‘ä¸Šï¼Œç›´åˆ° <code>Object.prototype</code></strong>ã€‚</li>
</ol>
<p>ç†è§£è¿™ä¸¤ç‚¹ï¼Œå°±èƒ½çœ‹é€ JS é¢å‘å¯¹è±¡çš„å…¨è²Œã€‚æ— è®ºæœªæ¥è¯­æ³•å¦‚ä½•æ¼”è¿›ï¼Œ<strong>åŸå‹é“¾</strong>æ°¸è¿œæ˜¯ JavaScript OOP çš„æ ¹åŸºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ›´æ¢SIMå¡å‰å¿…çœ‹ï¼šå¦‚ä½•ä½¿ç”¨ADBå¯¼å‡ºå¹¶ç­›é€‰æŒ‡å®šSIMå¡çš„å…¨éƒ¨çŸ­ä¿¡]]></title>    <link>https://juejin.cn/post/7579179741825171482</link>    <guid>https://juejin.cn/post/7579179741825171482</guid>    <pubDate>2025-12-03T06:49:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179741825171482" data-draft-id="7579179741825138714" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ›´æ¢SIMå¡å‰å¿…çœ‹ï¼šå¦‚ä½•ä½¿ç”¨ADBå¯¼å‡ºå¹¶ç­›é€‰æŒ‡å®šSIMå¡çš„å…¨éƒ¨çŸ­ä¿¡"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-03T06:49:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‘æ¾ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/1848721596224121"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ›´æ¢SIMå¡å‰å¿…çœ‹ï¼šå¦‚ä½•ä½¿ç”¨ADBå¯¼å‡ºå¹¶ç­›é€‰æŒ‡å®šSIMå¡çš„å…¨éƒ¨çŸ­ä¿¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1848721596224121/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‘æ¾ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:49:11.000Z" title="Wed Dec 03 2025 06:49:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡è½¬è½½è‡ªä¸ªäººåšå®¢</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhs.cnies.org%2Farchives%2Fsim-message-export" target="_blank" title="https://hs.cnies.org/archives/sim-message-export" ref="nofollow noopener noreferrer">æ›´æ¢SIMå¡å‰å¿…çœ‹ï¼šå¦‚ä½•ä½¿ç”¨ADBå¯¼å‡ºå¹¶ç­›é€‰æŒ‡å®šSIMå¡çš„å…¨éƒ¨çŸ­ä¿¡</a></p>
<h2 data-id="heading-0">å‰æƒ…æè¦</h2>
<p>æœ€è¿‘ï¼Œä¸»åŒ…çš„æµé‡å¡çš„ä¼˜æƒ å¥—é¤å³å°†åˆ°æœŸï¼Œä¸»åŒ…æ‰“ç®—æ›´æ¢æ–°çš„æ‰‹æœºå¡ã€‚è¿™å¼ å¡çš„æ‰‹æœºå·å·²ç»ç»‘å®šäº†ä¼—å¤šè´¦å·ï¼Œè€Œä¸»åŒ…åˆä¸æ¸…æ¥šè¿™ä¸ªå·ç ç©¶ç«Ÿç»‘å®šäº†å¤šå°‘è´¦å·ã€‚</p>
<p>ä¸»åŒ…çš„åä¸ºæ‰‹æœºçš„â€œä¿¡æ¯â€åº”ç”¨ä¸æ”¯æŒæŒ‰SIMå¡ç­›é€‰ä¿¡æ¯ã€‚ä¸»åŒ…å…ˆåå°è¯•äº†SMS Toolsã€DekuSMSã€SmsForwarderç­‰å¤šæ¬¾çŸ­ä¿¡ç®¡ç†åº”ç”¨ã€‚ç»“æœå´ä»¤äººå¤±æœ›ï¼Œæœ‰çš„åº”ç”¨æ—©å·²åœæ­¢ç»´æŠ¤ï¼Œæ— æ³•æ­£å¸¸è¿è¡Œï¼›æœ‰çš„åˆ™æ ¹æœ¬ä¸æ”¯æŒå¯¼å…¥æ‰‹æœºä¸­å·²å­˜åœ¨çš„å†å²çŸ­ä¿¡ï¼Œåªèƒ½å¤„ç†æ–°æ¥æ”¶çš„ä¿¡æ¯ã€‚ç”±äºåä¸ºæ‰‹æœºçš„ç³»ç»Ÿé™åˆ¶ï¼Œé™åˆ¶ç¦æ­¢æ™®é€šç”¨æˆ·è·å–çŸ­ä¿¡æ•°æ®åº“è·¯å¾„ï¼Œä¹Ÿæ— æ³•é€šè¿‡ç¬¬ä¸‰æ–¹ç¨‹åºç›´æ¥è®¿é—® <code>/data/data/com.android.providers.telephony/databases/mmssms.db</code>ã€‚ç”±äºæ‰‹æœºæœªrootï¼Œè¿™æ¡è·¯å¾„å‡ ä¹è¢«å®Œå…¨å°é”ã€‚</p>
<p>åœ¨ç¢°å£å¤šæ¬¡åï¼Œä¸»åŒ…æ„è¯†åˆ°å¯ä»¥ä¸€ç§æ›´åº•å±‚çš„ã€ç‹¬ç«‹äºåº”ç”¨ä¹‹å¤–çš„è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯ <strong>ADBï¼ˆAndroid Debug Bridgeï¼‰</strong>ã€‚ADBæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒå…è®¸å¼€å‘è€…ç›´æ¥ä¸å®‰å“è®¾å¤‡è¿›è¡Œæ·±åº¦é€šä¿¡å’Œæ§åˆ¶ã€‚å¯¹äºä¸»åŒ…çš„éœ€æ±‚è€Œè¨€ï¼Œå®ƒæœ€å…³é”®çš„åŠŸèƒ½å°±æ˜¯èƒ½å¤Ÿè®¿é—®ç³»ç»Ÿåº•å±‚çš„å†…å®¹æä¾›å™¨ï¼ˆContent Providerï¼‰ï¼Œå…¶ä¸­å°±åŒ…æ‹¬å­˜å‚¨çŸ­ä¿¡çš„æ•°æ®åº“ã€‚</p>
<h2 data-id="heading-1">å¯¼å‡ºçŸ­ä¿¡è®°å½•</h2>
<p>åœ¨è¿›è¡Œæ“ä½œä¹‹å‰ï¼Œéœ€è¦å…ˆåœ¨æ‰‹æœºçš„ç³»ç»Ÿè®¾ç½®ä¸­æ‰“å¼€â€œå¼€å‘è€…é€‰é¡¹â€ï¼Œå¹¶å¯ç”¨â€œUSBè°ƒè¯•â€åŠŸèƒ½ã€‚è¿™æ˜¯å…è®¸ç”µè„‘é€šè¿‡ADBä¸æ‰‹æœºé€šä¿¡çš„åŸºç¡€ã€‚å‡†å¤‡å·¥ä½œå°±ç»ªåï¼Œä¸»åŒ…å°†æ‰‹æœºè¿æ¥åˆ°ç”µè„‘ï¼Œä¸‹è½½å®‰è£… ADB åï¼Œåœ¨ç»ˆç«¯è¾“å…¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">./adb devices
</code></pre>
<p>æç¤ºè®¾å¤‡ Connetedï¼Œè¯æ˜ ADB è¿æ¥æˆåŠŸã€‚</p>
<p>åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">adb shell content query --uri content://sms/
</code></pre>
<p>è¿™æ¡æŒ‡ä»¤ä¼šç›´æ¥è¾“å‡ºçŸ­ä¿¡æ•°æ®åº“ä¸­çš„å…¨éƒ¨è®°å½•ï¼ŒåŒ…å«å‘é€è€…å·ç ã€æ—¶é—´æˆ³ã€çŸ­ä¿¡å†…å®¹ã€æ‰€å±SIMå¡ç­‰å…³é”®ä¿¡æ¯ã€‚è‹¥è¦è¿›ä¸€æ­¥åŒºåˆ†é€šè¯è®°å½•ã€æ—¥å†æˆ–é€šè®¯å½•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼è¯­å¥ï¼Œåªéœ€æ›¿æ¢URIå³å¯ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">adb shell content query --uri content://call_log/calls
adb shell content query --uri content://contacts/phones/
</code></pre>
<p>ç„¶è€Œï¼ŒADB è¾“å‡ºçš„çŸ­ä¿¡å†…å®¹æ˜¯<strong>ç»“æ„åŒ–æ–‡æœ¬æ ¼å¼</strong>ï¼Œæ¯æ¡è®°å½•ä»¥â€œkey=valueâ€å­˜å‚¨ï¼Œå¤šæ¡è®°å½•ä¹‹é—´æ²¡æœ‰æ ‡å‡†åˆ†éš”ç¬¦ã€‚ç›´æ¥æŸ¥çœ‹å‡ ä¹æ— æ³•é˜…è¯»ï¼Œä¹Ÿéš¾ä»¥ç­›é€‰å‡ºæŸä¸€å¼ å¡çš„çŸ­ä¿¡ã€‚å› æ­¤ï¼Œä¸»åŒ…å°†è¾“å‡ºç»“æœé‡å®šå‘ä¿å­˜ä¸ºæ–‡æœ¬æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">adb shell content query --uri content://sms/ &gt; all_sms.txt
</code></pre>
<p>è¿™ä¸€æ­¥å¾—åˆ°äº†ä¸€ä¸ªåŒ…å«æ•°åƒè¡Œè®°å½•çš„æ–‡ä»¶ã€‚</p>
<h2 data-id="heading-2">æ–‡æœ¬ç»“æ„åŒ–</h2>
<p><code>all_sms.txt</code> æ–‡ä»¶è¡¨é¢ä¸Šæ˜¯æ™®é€šæ–‡æœ¬ï¼Œä½†å®ƒåŒ…å«å¤æ‚çš„é”®å€¼å¯¹ç»“æ„ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-type">Row</span>: <span class="hljs-number">1</span> _id<span class="hljs-operator">=</span><span class="hljs-number">2982</span>, thread_id<span class="hljs-operator">=</span><span class="hljs-number">1402</span>, address<span class="hljs-operator">=</span><span class="hljs-number">106819388006257049</span>, person<span class="hljs-operator">=</span><span class="hljs-number">0</span>, <span class="hljs-type">date</span><span class="hljs-operator">=</span><span class="hljs-number">1761720271713</span>, date_sent<span class="hljs-operator">=</span><span class="hljs-number">1761720269000</span>, protocol<span class="hljs-operator">=</span><span class="hljs-number">0</span>, read<span class="hljs-operator">=</span><span class="hljs-number">1</span>, status<span class="hljs-operator">=</span><span class="hljs-number">-1</span>, type<span class="hljs-operator">=</span><span class="hljs-number">1</span>, reply_path_present<span class="hljs-operator">=</span><span class="hljs-number">0</span>, subject<span class="hljs-operator">=</span><span class="hljs-keyword">NULL</span>, body<span class="hljs-operator">=</span>ã€æ»´æ»´å‡ºè¡Œã€‘éªŒè¯ç ï¼š(<span class="hljs-number">114514</span>)ï¼Œæ‚¨æ­£åœ¨ä½¿ç”¨çŸ­ä¿¡éªŒè¯ç ç™»å½•åŠŸèƒ½ï¼Œ<span class="hljs-number">2</span>åˆ†é’Ÿå†…æœ‰æ•ˆã€‚è½¬å‘å¯èƒ½å¯¼è‡´å¸å·è¢«ç›—ï¼Œè¯·å‹¿æ³„éœ²ç»™ä»–äºº   , service_center<span class="hljs-operator">=</span><span class="hljs-operator">+</span><span class="hljs-number">8615654161</span>, locked<span class="hljs-operator">=</span><span class="hljs-number">0</span>, sub_id<span class="hljs-operator">=</span><span class="hljs-number">1</span>, network_type<span class="hljs-operator">=</span><span class="hljs-number">13</span>, error_code<span class="hljs-operator">=</span><span class="hljs-number">0</span>, creator<span class="hljs-operator">=</span>com.android.mms, seen<span class="hljs-operator">=</span><span class="hljs-number">1</span>, si_id<span class="hljs-operator">=</span><span class="hljs-keyword">NULL</span>, mid<span class="hljs-operator">=</span><span class="hljs-keyword">NULL</span>, created<span class="hljs-operator">=</span><span class="hljs-keyword">NULL</span>, mtype<span class="hljs-operator">=</span><span class="hljs-number">0</span>, privacy_mode<span class="hljs-operator">=</span><span class="hljs-number">0</span>, group_id<span class="hljs-operator">=</span><span class="hljs-number">7627</span>, addr_body<span class="hljs-operator">=</span><span class="hljs-number">0</span>,, time_body<span class="hljs-operator">=</span><span class="hljs-number">0</span>,, risk_url_body<span class="hljs-operator">=</span>, is_secret<span class="hljs-operator">=</span><span class="hljs-number">1</span>, resent_im<span class="hljs-operator">=</span><span class="hljs-number">0</span>, hw_is_satellite<span class="hljs-operator">=</span><span class="hljs-number">0</span>
</code></pre>
<p>æ¯ä¸€è¡Œéƒ½ç”±å¤šä¸ª<code>key=value</code>æ ¼å¼çš„å­—æ®µç»„æˆï¼Œå­—æ®µä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚ä¾‹å¦‚ï¼Œ<code>address=</code>åé¢æ˜¯å¯¹æ–¹å·ç ï¼Œ<code>body=</code>æ˜¯çŸ­ä¿¡æ­£æ–‡ï¼Œ<code>date=</code>æ˜¯æ—¶é—´æˆ³ã€‚</p>
<p>ç›´æ¥ç”¨ Excel æ‰“å¼€æ¯«æ— æ„ä¹‰ã€‚ä¸ºäº†åˆ†æè¿™äº›å­—æ®µï¼Œä¸»åŒ…ç¼–å†™äº†ä¸€ä¸ª <strong>Python è½¬æ¢è„šæœ¬</strong>ï¼Œæ ¸å¿ƒæ€è·¯æ˜¯ï¼š
åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼è¯†åˆ«â€œé€—å·åç´§è·Ÿkey=â€çš„æ¨¡å¼ï¼Œå°†æ¯è¡Œåˆ†å‰²ä¸ºå­—æ®µå­—å…¸ï¼Œå†ç»Ÿä¸€å†™å…¥CSVæ–‡ä»¶ã€‚</p>
<p>è¯¥è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†çŸ­ä¿¡å†…å®¹ä¸­çš„é€—å·ã€ç­‰å·ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œé˜²æ­¢è¯¯åˆ†å‰²ã€‚æ¯æ¡è®°å½•éƒ½ä¼šè¢«è½¬æ¢æˆä¸€è¡Œæ•°æ®ï¼Œå­—æ®µåˆ—åŒ…æ‹¬ <code>_id</code>ã€<code>address</code>ã€<code>body</code>ã€<code>sub_id</code> ç­‰ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">import csv
import re
import os

def convert_sms_to_csv(input_filepath, output_filepath):
    <span class="hljs-string">""</span><span class="hljs-string">"
    å°†é€šè¿‡ adb å‘½ä»¤å¯¼å‡ºçš„çŸ­ä¿¡ txt æ–‡ä»¶è½¬æ¢ä¸º CSV æ ¼å¼ã€‚

    Args:
        input_filepath (str): è¾“å…¥çš„ txt æ–‡ä»¶è·¯å¾„ (all_sms.txt)ã€‚
        output_filepath (str): è¾“å‡ºçš„ csv æ–‡ä»¶è·¯å¾„ã€‚
    "</span><span class="hljs-string">""</span>
    <span class="hljs-comment"># æ­£åˆ™è¡¨è¾¾å¼ï¼šç”¨äºæŒ‰é€—å·åˆ†å‰²ï¼Œä½†å‰ææ˜¯è¿™ä¸ªé€—å·åé¢ç´§è·Ÿç€ä¸€ä¸ª "é”®=å€¼" çš„æ¨¡å¼ã€‚</span>
    <span class="hljs-comment"># \s* åŒ¹é…0ä¸ªæˆ–å¤šä¸ªç©ºæ ¼</span>
    <span class="hljs-comment"># (?=\w+=) æ˜¯ä¸€ä¸ªæ­£å‘å…ˆè¡Œæ–­è¨€ï¼Œå®ƒä¼šæŸ¥æ‰¾ "å•è¯= " çš„æ¨¡å¼ï¼Œä½†ä¸ä¼šæ¶ˆè€—è¿™äº›å­—ç¬¦ã€‚</span>
    <span class="hljs-comment"># è¿™ç¡®ä¿æˆ‘ä»¬åªåœ¨å­—æ®µä¹‹é—´è¿›è¡Œåˆ†å‰²ï¼Œè€Œä¸ä¼šåˆ†å‰²å­—æ®µå†…éƒ¨çš„å†…å®¹ã€‚</span>
    <span class="hljs-comment"># ä¾‹å¦‚ï¼Œå¯¹äº "body=..., service_center=..."ï¼Œå®ƒä¼šåœ¨ ", " å¤„åˆ†å‰²ã€‚</span>
    pattern = re.compile(r<span class="hljs-string">',\s*(?=\w+=)'</span>)

    all_rows_data = []
    
    <span class="hljs-comment"># æ£€æŸ¥è¾“å…¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
    <span class="hljs-keyword">if</span> not os.path.exists(input_filepath):
        <span class="hljs-built_in">print</span>(f<span class="hljs-string">"é”™è¯¯ï¼šè¾“å…¥æ–‡ä»¶ '{input_filepath}' ä¸å­˜åœ¨ã€‚"</span>)
        <span class="hljs-built_in">return</span>

    <span class="hljs-built_in">print</span>(f<span class="hljs-string">"æ­£åœ¨è¯»å–æ–‡ä»¶: {input_filepath}..."</span>)
    
    with open(input_filepath, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) as f:
        <span class="hljs-keyword">for</span> i, line <span class="hljs-keyword">in</span> enumerate(f):
            <span class="hljs-comment"># å»é™¤è¡Œé¦–çš„ "Row: x " éƒ¨åˆ†å’Œè¡Œå°¾çš„ç©ºç™½å­—ç¬¦</span>
            <span class="hljs-comment"># æ‰¾åˆ°ç¬¬ä¸€ä¸ª " _id=" çš„ä½ç½®ï¼Œä»é‚£é‡Œå¼€å§‹åˆ‡ç‰‡ï¼Œæ›´å…·é²æ£’æ€§</span>
            start_index = line.find(<span class="hljs-string">'_id='</span>)
            <span class="hljs-keyword">if</span> start_index == -1:
                <span class="hljs-built_in">print</span>(f<span class="hljs-string">"è­¦å‘Šï¼šç¬¬ {i+1} è¡Œæ ¼å¼ä¸æ­£ç¡®ï¼Œå·²è·³è¿‡: {line.strip()}"</span>)
                <span class="hljs-built_in">continue</span>
            
            content = line[start_index:].strip()

            <span class="hljs-comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²æˆ "key=value" å—</span>
            fields = pattern.split(content)
            
            row_dict = {}
            <span class="hljs-keyword">for</span> field <span class="hljs-keyword">in</span> fields:
                <span class="hljs-comment"># æŒ‰ç¬¬ä¸€ä¸ªç­‰å·åˆ†å‰²ï¼Œé˜²æ­¢ value ä¸­ä¹ŸåŒ…å«ç­‰å·</span>
                parts = field.split(<span class="hljs-string">'='</span>, 1)
                <span class="hljs-keyword">if</span> len(parts) == 2:
                    key, value = parts
                    <span class="hljs-comment"># æœ‰äº›å€¼å¯èƒ½æ˜¯ NULL (å­—ç¬¦ä¸²)ï¼Œæˆ–è€…ä¸ºç©ºï¼Œæˆ‘ä»¬ä¿ç•™åŸæ ·</span>
                    row_dict[key.strip()] = value.strip()
            
            <span class="hljs-keyword">if</span> row_dict:
                all_rows_data.append(row_dict)

    <span class="hljs-keyword">if</span> not all_rows_data:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆæ•°æ®ã€‚"</span>)
        <span class="hljs-built_in">return</span>

    <span class="hljs-comment"># ä»ç¬¬ä¸€è¡Œæ•°æ®ä¸­è·å–æ‰€æœ‰å­—æ®µåä½œä¸º CSV çš„è¡¨å¤´</span>
    <span class="hljs-comment"># ä½¿ç”¨ dict.keys() æ¥ä¿è¯é¡ºåºåœ¨ Python 3.7+ ä¸­æ˜¯æ’å…¥é¡ºåº</span>
    headers = list(all_rows_data[0].keys())
    
    <span class="hljs-built_in">print</span>(f<span class="hljs-string">"å…±è§£æå‡º {len(all_rows_data)} æ¡çŸ­ä¿¡ã€‚"</span>)
    <span class="hljs-built_in">print</span>(f<span class="hljs-string">"æ­£åœ¨å†™å…¥åˆ°æ–‡ä»¶: {output_filepath}..."</span>)

    <span class="hljs-comment"># å†™å…¥ CSV æ–‡ä»¶</span>
    <span class="hljs-comment"># ä½¿ç”¨ encoding='utf-8-sig' å¯ä»¥è®© Excel æ­£ç¡®è¯†åˆ« UTF-8 ç¼–ç ï¼Œé¿å…ä¸­æ–‡ä¹±ç </span>
    <span class="hljs-comment"># newline='' æ˜¯å†™å…¥ CSV çš„æ ‡å‡†åšæ³•ï¼Œé˜²æ­¢å‡ºç°ç©ºè¡Œ</span>
    with open(output_filepath, <span class="hljs-string">'w'</span>, newline=<span class="hljs-string">''</span>, encoding=<span class="hljs-string">'utf-8-sig'</span>) as csvfile:
        writer = csv.DictWriter(csvfile, fieldnames=headers)
        
        <span class="hljs-comment"># å†™å…¥è¡¨å¤´</span>
        writer.writeheader()
        
        <span class="hljs-comment"># å†™å…¥æ‰€æœ‰è¡Œæ•°æ®</span>
        writer.writerows(all_rows_data)

    <span class="hljs-built_in">print</span>(f<span class="hljs-string">"è½¬æ¢æˆåŠŸï¼æ–‡ä»¶å·²ä¿å­˜ä¸º '{output_filepath}'ã€‚"</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># å®šä¹‰è¾“å…¥å’Œè¾“å‡ºæ–‡ä»¶å</span>
    input_file = <span class="hljs-string">"all_sms.txt"</span>
    output_file = <span class="hljs-string">"all_sms.csv"</span>
    
    <span class="hljs-comment"># æ‰§è¡Œè½¬æ¢</span>
    convert_sms_to_csv(input_file, output_file)
</code></pre>
<p>å°†ä¸Šè¿°ä»£ç ä¿å­˜ä¸º <code>sms_converter.py</code>ï¼Œå¹¶ä¸ <code>all_sms.txt</code> æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚éšååœ¨ç»ˆç«¯è¿è¡Œ <code>python sms_converter.py</code>ï¼Œå°±ä¼šç”Ÿæˆ <code>all_sms.csv</code> æ–‡ä»¶ã€‚ç”¨ Excel æ‰“å¼€åï¼Œæ‰€æœ‰çŸ­ä¿¡è¢«æ¸…æ™°åœ°æ’åˆ—æˆè¡¨æ ¼æ ¼å¼ã€‚</p>
<h2 data-id="heading-3">ç­›é€‰æŒ‡å®šSIMå¡</h2>
<p>åœ¨åŒå¡æ‰‹æœºä¸Šï¼Œç³»ç»Ÿä¼šä¸ºæ¯å¼ SIMå¡åˆ†é…å”¯ä¸€çš„ <strong>sub_idï¼ˆSubscription IDï¼‰</strong>ã€‚
ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>sub_id=0</code> å¯¹åº”å¡æ§½1ï¼›</li>
<li><code>sub_id=1</code> å¯¹åº”å¡æ§½2ã€‚</li>
</ul>
<p>é€šè¿‡è¿™ä¸ªç»“æœï¼Œä¸»åŒ…å¯ä»¥æ˜ç¡®åœ°å»ºç«‹ <code>sub_id</code> å’Œå…·ä½“æ‰‹æœºå¡çš„å¯¹åº”å…³ç³»ã€‚åœ¨ä¸»åŒ…çš„æ¡ˆä¾‹ä¸­ï¼Œ<code>sub_id=1</code> å¯¹åº”ç€ä¸»åŒ…éœ€è¦å¤„ç†çš„é‚£å¼ å‰¯å¡ã€‚ä½¿ç”¨Excelä¸­æ‰“å¼€çš„ <code>all_sms.csv</code> æ–‡ä»¶ï¼Œé€‰ä¸­ <code>sub_id</code> è¿™ä¸€åˆ—ï¼Œå¯ç”¨ç­›é€‰åŠŸèƒ½ï¼Œç„¶ååªå‹¾é€‰å€¼ä¸º <code>1</code> çš„è¡Œï¼Œæ•´ä¸ªè¡¨æ ¼åªå‰©ä¸‹ç”±è¿™å¼ å‰¯å¡æ¥æ”¶çš„æ‰€æœ‰çŸ­ä¿¡ã€‚ä¸»åŒ…ä»”ç»†åœ°æµè§ˆäº†æ‰€æœ‰éªŒè¯ç å’Œé€šçŸ¥ä¿¡æ¯ï¼Œå°†ç»‘å®šè¯¥æ‰‹æœºå·çš„è´¦å·ä¸€ä¸€è®°å½•ä¸‹æ¥ï¼Œç„¶åé€ä¸ªè¿›è¡Œäº†è§£ç»‘æˆ–æ¢ç»‘æ“ä½œã€‚</p>
<h2 data-id="heading-4">æ€»ç»“</h2>
<p>è¿™ä¸€æ–¹æ¡ˆå……åˆ†åˆ©ç”¨äº† Android ç³»ç»Ÿåº•å±‚çš„æ•°æ®æ¥å£ï¼ŒåŒæ—¶é¿å…äº†ç³»ç»Ÿé™åˆ¶å¸¦æ¥çš„éšœç¢ã€‚æ•´ä¸ªæµç¨‹åŒ…æ‹¬ï¼š</p>
<ol>
<li>ä½¿ç”¨ADBå¯¼å‡ºçŸ­ä¿¡ï¼›</li>
<li>é€šè¿‡Pythonè„šæœ¬ç»“æ„åŒ–æ–‡æœ¬ï¼›</li>
<li>åœ¨Excelä¸­ç­›é€‰ç‰¹å®š <code>sub_id</code>ã€‚</li>
</ol>
<p>è¿™ç§æ–¹æ³•ç‰¹åˆ«é€‚åˆä¸¤ç±»ç”¨æˆ·ï¼š</p>
<ul>
<li><strong>éœ€è¦æ›´æ¢æ‰‹æœºå·ä½†æƒ³ä¿ç•™è´¦å·ä¿¡æ¯çš„äºº</strong>ï¼›</li>
<li><strong>æƒ³å¤‡ä»½çŸ­ä¿¡å¹¶åŒºåˆ†åŒå¡çŸ­ä¿¡æ¥æºçš„æŠ€æœ¯ç”¨æˆ·</strong>ã€‚</li>
</ul>
<p>è¿™ä¸ªæ–¹æ³•å°¤å…¶é€‚ç”¨äºé‚£äº›ä¸å¸Œæœ›æˆ–æ— æ³•Rootæ‰‹æœºçš„ç”¨æˆ·ã€‚åªè¦ä½ ä¿ç•™äº†å®Œæ•´çš„çŸ­ä¿¡è®°å½•ï¼Œå¹¶ä¸”æ‰‹æœºå¡çš„ç‰©ç†ä½ç½®ç›¸å¯¹å›ºå®šï¼Œé‚£ä¹ˆå®ƒå°±èƒ½ç²¾å‡†åœ°å¸®ä½ ç†æ¸…æ¯ä¸€å¼ SIMå¡èƒŒåçš„æ•°å­—èµ„äº§ã€‚å¸Œæœ›ä¸»åŒ…çš„è¿™æ¬¡å®è·µï¼Œèƒ½ä¸ºé‡åˆ°åŒæ ·é—®é¢˜çš„æœ‹å‹ä»¬æä¾›ä¸€ä¸ªæœ‰æ•ˆçš„å‚è€ƒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¨€åœŸæ˜é‡‘ã€ŒAI åˆ·é¢˜ã€ä¸‹çº¿å…¬å‘Š]]></title>    <link>https://juejin.cn/post/7579175271681179658</link>    <guid>https://juejin.cn/post/7579175271681179658</guid>    <pubDate>2025-12-03T06:56:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579175271681179658" data-draft-id="7579215538271993866" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¨€åœŸæ˜é‡‘ã€ŒAI åˆ·é¢˜ã€ä¸‹çº¿å…¬å‘Š"/> <meta itemprop="keywords" content="æ˜é‡‘ç¤¾åŒº"/> <meta itemprop="datePublished" content="2025-12-03T06:56:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜é‡‘é…±"/> <meta itemprop="url" content="https://juejin.cn/user/1556564194374926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¨€åœŸæ˜é‡‘ã€ŒAI åˆ·é¢˜ã€ä¸‹çº¿å…¬å‘Š
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/7255271989291450420/posts" data-v-d326b38e=""><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b3e5e62bb3a4eff89269d51825c4a1f~tplv-k3u1fbpfcp-watermark.image?" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/7255271989291450420/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="æ˜é‡‘è¿è¥å›¢é˜Ÿ" class="title" data-v-d326b38e="">æ˜é‡‘è¿è¥å›¢é˜Ÿ</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2025-12-03T06:56:19.000Z" title="Wed Dec 03 2025 06:56:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2025-12-03
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                28
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                é˜…è¯»2åˆ†é’Ÿ
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        å…³æ³¨
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              â¤é¦–å¸­å®¢æœå› @æ˜é‡‘
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ã€å…¬å‘Šã€‘ç¨€åœŸæ˜é‡‘ã€ŒAI åˆ·åˆ·é¢˜ã€åŠŸèƒ½å°†äº 2026 å¹´ 1 æœˆ 01 æ—¥æ­£å¼ä¸‹çº¿ã€‚</p>
<p>å°Šæ•¬çš„æ˜å‹ä»¬ï¼š</p>
<p>å¤§å®¶å¥½ï¼ç»è¿‡æ…é‡è¯„ä¼°ï¼Œæˆ‘ä»¬å†³å®šå¯¹ã€ŒAI åˆ·é¢˜ã€ï¼ˆåŸã€ŒAI åˆ·é¢˜ã€æ¿å—ï¼Œè®¿é—®è·¯å¾„ä¸ºï¼š<a href="https://juejin.cn/problemset" target="_blank" title="https://juejin.cn/problemset">juejin.cn/problemset</a> æˆ– <a href="https://www.marscode.cn/practice" target="_blank" title="https://www.marscode.cn/practice" ref="nofollow noopener noreferrer">www.marscode.cn/practice</a> ï¼‰
åŠŸèƒ½è¿›è¡Œæ°¸ä¹…ä¸‹çº¿ã€‚</p>
<p>è¯¥åŠŸèƒ½äº 2024 å¹´åŸºäºçº¿ä¸Š IDE æ¨å‡ºï¼Œæ—¨åœ¨ä¸ºç”¨æˆ·æä¾›å…è´¹çš„ Playground è¿è¡Œç¯å¢ƒä¸ AI è¾…åŠ©åˆ·é¢˜ä½“éªŒã€‚</p>
<p>éšç€äº§å“è¿­ä»£å’Œè¿è¥èµ„æºè°ƒæ•´ï¼Œæˆ‘ä»¬å°†äº2026 å¹´ 1 æœˆ 1 æ—¥æ­£å¼ä¸‹çº¿è¯¥åŠŸèƒ½ã€‚</p>
<p><strong>ä¸‹çº¿æ—¶é—´è¡¨</strong></p>
<ul>
<li>
<p>2025 å¹´ 12 æœˆ 31 æ—¥ 23:59 å‰ï¼š</p>
<ul>
<li>ä¿ç•™å®Œæ•´è®¿é—®å…¥å£</li>
<li>ç”¨æˆ·ä»å¯æ­£å¸¸æŸ¥çœ‹ã€å¤åˆ¶ã€å¯¼å‡ºå·²æœ‰åˆ·é¢˜è®°å½•å’Œä»£ç </li>
</ul>
</li>
<li>
<p>2026 å¹´ 1 æœˆ 1 æ—¥èµ·ï¼š</p>
<ul>
<li>æ­£å¼å…³é—­æ˜é‡‘ä¾§æ‰€æœ‰å…¥å£</li>
<li>åœæ­¢æœåŠ¡ï¼Œåå°æ•°æ®å°†ä¸å†ä¿ç•™ï¼Œç”¨æˆ·å°†æ— æ³•è®¿é—® <strong>ã€‚</strong></li>
</ul>
</li>
</ul>
<p><strong>å¼ºçƒˆå»ºè®®æ‚¨åœ¨ 2025 å¹´ 12 æœˆ 31 æ—¥å‰å®Œæˆæ•°æ®å¤‡ä»½ï¼Œå¦‚æ­£å¼ä¸‹çº¿åæœ‰æ•°æ®é—®é¢˜ï¼Œè¯·é‚®ä»¶è”ç³»ï¼š</strong> <strong><a href="https://link.juejin.cn?target=mailto%3Afeedback%40mail.trae.cn" target="_blank" title="mailto:feedback@mail.trae.cn" ref="nofollow noopener noreferrer">feedback@mail.trae.cn</a></strong></p>
<ol>
<li>ç™»å½•æ˜é‡‘ â†’ è¿›å…¥ã€ŒAI åˆ·åˆ·é¢˜ã€é¡µé¢</li>
<li>åœ¨<a href="https://www.marscode.cn/practice" target="_blank" title="https://www.marscode.cn/practice" ref="nofollow noopener noreferrer">www.marscode.cn/practice</a> è·¯å¾„ä¸‹é€ä¸ªæ‰“å¼€æ‚¨éœ€è¦ä¿ç•™çš„é¢˜ç›®/é¡¹ç›®</li>
<li>ä½¿ç”¨æµè§ˆå™¨å¤åˆ¶ä»£ç ã€é¢˜ç›®æè¿°ã€AI å¯¹è¯è®°å½•ç­‰æ–¹å¼æ‰‹åŠ¨ä¿å­˜åˆ°æœ¬åœ°ï¼ˆå»ºè®®ä¿å­˜ä¸º Markdown æˆ–ä»£ç æ–‡ä»¶ï¼‰</li>
<li>ç›®å‰æš‚ä¸æä¾›æ‰¹é‡å¯¼å‡ºå·¥å…·ï¼Œæ•¬è¯·è°…è§£</li>
</ol>
<p>éå¸¸æ„Ÿè°¢è¿‡å»ä¸€å¹´å¤šæ¥ä½¿ç”¨è¿‡è¯¥åŠŸèƒ½çš„æ‰€æœ‰æ˜å‹ä»¬ï¼Œä½ ä»¬å®è´µçš„åé¦ˆæ›¾å¸®åŠ©æˆ‘ä»¬ä¸æ–­è¿­ä»£ã€‚</p>
<p>å¦‚æœæ‚¨å¯¹æœ¬æ¬¡ä¸‹çº¿æœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿åœ¨æœ¬å¸–ä¸‹ç•™è¨€æˆ–ç§ä¿¡æ˜é‡‘é…±ï¼Œæˆ‘ä»¬ä¼šå°½åŠ›è§£ç­”ã€‚</p>
<p>å†æ¬¡æ„Ÿè°¢å¤§å®¶çš„ç†è§£ä¸æ”¯æŒï¼æœªæ¥ç¨€åœŸæ˜é‡‘ä»å°†æŒç»­æ‰“ç£¨æ›´ä¼˜è´¨çš„ AI ç¼–ç¨‹ä½“éªŒï¼ŒæœŸå¾…ä¸ä½ ä»¬ç»§ç»­ä¸€èµ·æˆé•¿ï¼</p>
<p>ç¨€åœŸæ˜é‡‘è¿è¥å›¢é˜Ÿ</p>
<p>2025å¹´12æœˆ03æ—¥</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cursorç”ŸæˆAPKåŠ å›ºç­¾åè„šæœ¬]]></title>    <link>https://juejin.cn/post/7579215538271813642</link>    <guid>https://juejin.cn/post/7579215538271813642</guid>    <pubDate>2025-12-03T06:27:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579215538271813642" data-draft-id="7579179741824958490" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cursorç”ŸæˆAPKåŠ å›ºç­¾åè„šæœ¬"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-03T06:27:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¸Œä¾¬"/> <meta itemprop="url" content="https://juejin.cn/user/3402312236412458"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cursorç”ŸæˆAPKåŠ å›ºç­¾åè„šæœ¬
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3402312236412458/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¸Œä¾¬
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:27:30.000Z" title="Wed Dec 03 2025 06:27:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style>
<h2 data-id="heading-0">èƒŒæ™¯</h2>
<blockquote>
<p>ä¸ºäº†æé«˜APKçš„å®‰å…¨ç­‰çº§ï¼Œè¦æ±‚APKä½¿ç”¨é«˜çº§åŠ å›ºæ–¹å¼è¿›è¡ŒåŠ å›ºã€‚äº†è§£äº†å¸‚é¢ä¸Šçš„ä¸»æµåŠ å›ºæ–¹æ¡ˆå‘ç°éƒ½æ˜¯æ”¶è´¹çš„è€Œä¸”è´¹ç”¨ä¸ä½ï¼æœ€åé€‰æ‹©äº†å…è´¹çš„OPPOåŠ å›ºã€‚APKåœ¨åŠ å›ºåéœ€è¦è¿›è¡Œé‡æ–°ç­¾åï¼Œç­¾åæµç¨‹åˆ†ä¸ºå¥½å‡ ä¸ªæ­¥éª¤å¹¶ä¸”æ¶‰åŠåˆ°é…ç½®android sdkã€ç­¾åæ–‡ä»¶åœ°å€ã€apkåœ°å€ç­‰ä¿¡æ¯ã€‚ä¸ºäº†æé«˜å·¥ä½œæ•ˆç‡éœ€è¦ç”Ÿæˆä¸€ä¸ªè„šæœ¬è¿›è¡Œä¸€é”®ç­¾åã€‚</p>
</blockquote>
<h2 data-id="heading-1">å®è·µ</h2>
<p>åˆ†åˆ«ç”¨<strong>DeepSeekã€Trae</strong>å’Œ<strong>Cursor</strong>è¿›è¡Œç”Ÿæˆè„šæœ¬ï¼Œæœ€åè¿›è¡Œæ¯”è¾ƒå‘ç°<strong>Cursorç”Ÿæˆçš„æœ€å¥½</strong>
ç”Ÿæˆè„šæœ¬æè¿°æ–‡æœ¬ï¼š</p>
<blockquote>
<p><strong>ç”Ÿæˆä¸€ä¸ªå¯ä»¥åœ¨win11ç”µè„‘ä¸Šè¿è¡Œçš„ç»™åŠ å›ºåçš„apkè¿›è¡Œç­¾åçš„è„šæœ¬</strong></p>
</blockquote>
<p>ä»¥ä¸‹æ˜¯Cursorç”Ÿæˆçš„ä¿¡æ¯ï¼š</p>
<hr/>
<p>è¿™é‡Œç»™ä½ ä¸€ä¸ªå¯åœ¨ Windows 11 ä¸Šç›´æ¥ä½¿ç”¨çš„ PowerShell ç­¾åè„šæœ¬ï¼ˆæ”¯æŒåŠ å›ºå APKï¼‰
å°†ä¸‹é¢å†…å®¹ä¿å­˜ä¸º sign-apk.ps1ï¼ŒPowerShell 7 æˆ– Windows PowerShell éƒ½å¯è¿è¡Œã€‚è„šæœ¬ä¼šè‡ªåŠ¨æŸ¥æ‰¾ Android SDK Build-Toolsï¼ˆæˆ–å¯æ‰‹åŠ¨æŒ‡å®šï¼‰ï¼Œå¯é€‰è·³è¿‡ zipalignï¼Œæ”¯æŒé€‰æ‹©ç­¾åæ–¹æ¡ˆ v1/v2/v3/v4ã€‚</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-title function_ invoke__">param</span>(
    [<span class="hljs-title function_ invoke__">Parameter</span>(Mandatory = <span class="hljs-variable">$true</span>)]
    [<span class="hljs-keyword">string</span>]<span class="hljs-variable">$ApkPath</span>,                 # å¾…ç­¾åçš„APKè·¯å¾„

    [<span class="hljs-title function_ invoke__">Parameter</span>(Mandatory = <span class="hljs-variable">$true</span>)]
    [<span class="hljs-keyword">string</span>]<span class="hljs-variable">$KeystorePath</span>,            # keystore æ–‡ä»¶è·¯å¾„(.jks/.keystore)

    [<span class="hljs-title function_ invoke__">Parameter</span>(Mandatory = <span class="hljs-variable">$true</span>)]
    [<span class="hljs-keyword">string</span>]<span class="hljs-variable">$Alias</span>,                   <span class="hljs-comment"># keyåˆ«å</span>

    [<span class="hljs-title function_ invoke__">Parameter</span>(Mandatory = <span class="hljs-variable">$true</span>)]
    [<span class="hljs-keyword">string</span>]<span class="hljs-variable">$KeystorePass</span>,            <span class="hljs-comment"># keystore å¯†ç </span>

    [<span class="hljs-keyword">string</span>]<span class="hljs-variable">$KeyPass</span>,                 <span class="hljs-comment"># key å¯†ç ï¼ˆå¦‚ä¸å¡«é»˜è®¤ä¸ keystore å¯†ç ç›¸åŒï¼‰</span>

    [<span class="hljs-keyword">string</span>]<span class="hljs-variable">$BuildToolsDir</span>,           <span class="hljs-comment"># æŒ‡å®š Android build-tools ç›®å½•ï¼ˆå¯é€‰ï¼Œå¦‚ C:\Android\sdk\build-tools\35.0.0ï¼‰</span>
    [<span class="hljs-keyword">string</span>]<span class="hljs-variable">$OutDir</span>,                  <span class="hljs-comment"># è¾“å‡ºç›®å½•ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸ APK åŒç›®å½•ï¼‰</span>
    [<span class="hljs-keyword">switch</span>]<span class="hljs-variable">$SkipZipalign</span>,            <span class="hljs-comment"># è·³è¿‡ zipalignï¼ˆéƒ¨åˆ†åŠ å›ºåŒ…è¦æ±‚è·³è¿‡æ—¶å¯ç”¨ï¼‰</span>
    [<span class="hljs-keyword">switch</span>]<span class="hljs-variable">$Overwrite</span>,               <span class="hljs-comment"># è¾“å‡ºå­˜åœ¨æ—¶è¦†ç›–</span>
    [<span class="hljs-title function_ invoke__">ValidateSet</span>(<span class="hljs-string">"v1"</span>,<span class="hljs-string">"v2"</span>,<span class="hljs-string">"v3"</span>,<span class="hljs-string">"v4"</span>,<span class="hljs-string">"all"</span>)]
    [<span class="hljs-keyword">string</span>]<span class="hljs-variable">$Schemes</span> = <span class="hljs-string">"all"</span>          <span class="hljs-comment"># æŒ‡å®šç­¾åæ–¹æ¡ˆ</span>
)

Set-StrictMode -Version Latest
<span class="hljs-variable">$ErrorActionPreference</span> = <span class="hljs-string">"Stop"</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Write</span>-<span class="hljs-title">Info</span>(<span class="hljs-params"><span class="hljs-variable">$msg</span></span>) </span>{ Write-Host <span class="hljs-string">"[INFO] <span class="hljs-subst">$msg</span>"</span> -ForegroundColor Cyan }
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Write</span>-<span class="hljs-title">Warn</span>(<span class="hljs-params"><span class="hljs-variable">$msg</span></span>) </span>{ Write-Host <span class="hljs-string">"[WARN] <span class="hljs-subst">$msg</span>"</span> -ForegroundColor Yellow }
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Write</span>-<span class="hljs-title">Err</span> (<span class="hljs-params"><span class="hljs-variable">$msg</span></span>) </span>{ Write-Host <span class="hljs-string">"[ERROR] <span class="hljs-subst">$msg</span>"</span> -ForegroundColor Red }

<span class="hljs-comment"># è§„èŒƒåŒ–è·¯å¾„</span>
<span class="hljs-variable">$ApkPath</span>       = (Resolve-Path -LiteralPath <span class="hljs-variable">$ApkPath</span>).Path
<span class="hljs-variable">$KeystorePath</span>  = (Resolve-Path -LiteralPath <span class="hljs-variable">$KeystorePath</span>).Path
<span class="hljs-keyword">if</span> ([<span class="hljs-keyword">string</span>]::<span class="hljs-title function_ invoke__">IsNullOrWhiteSpace</span>(<span class="hljs-variable">$OutDir</span>)) {
    <span class="hljs-variable">$OutDir</span> = Split-Path -Parent <span class="hljs-variable">$ApkPath</span>
} <span class="hljs-keyword">else</span> {
    <span class="hljs-variable">$OutDir</span> = (Resolve-Path -LiteralPath <span class="hljs-variable">$OutDir</span>).Path
}
<span class="hljs-keyword">if</span> ([<span class="hljs-keyword">string</span>]::<span class="hljs-title function_ invoke__">IsNullOrWhiteSpace</span>(<span class="hljs-variable">$KeyPass</span>)) { <span class="hljs-variable">$KeyPass</span> = <span class="hljs-variable">$KeystorePass</span> }

<span class="hljs-comment"># å¯»æ‰¾ build-tools</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Get</span>-<span class="hljs-title">LatestBuildToolsDir</span> </span>{
    <span class="hljs-variable">$candidates</span> = @()
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$envVar</span> in @(<span class="hljs-string">"ANDROID_HOME"</span>,<span class="hljs-string">"ANDROID_SDK_ROOT"</span>)) {
        <span class="hljs-variable">$sdk</span> = [Environment]::<span class="hljs-title function_ invoke__">GetEnvironmentVariable</span>(<span class="hljs-variable">$envVar</span>, <span class="hljs-string">"User"</span>)
        <span class="hljs-keyword">if</span> (-not <span class="hljs-variable">$sdk</span>) { <span class="hljs-variable">$sdk</span> = [Environment]::<span class="hljs-title function_ invoke__">GetEnvironmentVariable</span>(<span class="hljs-variable">$envVar</span>, <span class="hljs-string">"Machine"</span>) }
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$sdk</span>) {
            <span class="hljs-variable">$bt</span> = Join-Path <span class="hljs-variable">$sdk</span> <span class="hljs-string">"build-tools"</span>
            <span class="hljs-keyword">if</span> (Test-Path <span class="hljs-variable">$bt</span>) { <span class="hljs-variable">$candidates</span> += <span class="hljs-variable">$bt</span> }
        }
    }
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$root</span> in <span class="hljs-variable">$candidates</span>) {
        <span class="hljs-variable">$subdirs</span> = Get-ChildItem -Path <span class="hljs-variable">$root</span> -<span class="hljs-built_in">Directory</span> -ErrorAction SilentlyContinue | Sort-Object Name -Descending
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$subdirs</span> -<span class="hljs-keyword">and</span> <span class="hljs-variable">$subdirs</span>.Count -gt <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$subdirs</span>[<span class="hljs-number">0</span>].FullName
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$null</span>
}

<span class="hljs-keyword">if</span> ([<span class="hljs-keyword">string</span>]::<span class="hljs-title function_ invoke__">IsNullOrWhiteSpace</span>(<span class="hljs-variable">$BuildToolsDir</span>)) {
    <span class="hljs-variable">$BuildToolsDir</span> = Get-LatestBuildToolsDir
    <span class="hljs-keyword">if</span> (-not <span class="hljs-variable">$BuildToolsDir</span>) {
        Write-Err <span class="hljs-string">"æœªæ‰¾åˆ° Android build-toolsï¼Œè¯·å®‰è£… Android SDK å¹¶è®¾ç½® ANDROID_HOME/ANDROID_SDK_ROOTï¼Œæˆ–é€šè¿‡ -BuildToolsDir æŒ‡å®šã€‚"</span>
        <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span>
    }
}

<span class="hljs-comment"># å®šä½å·¥å…·ï¼ˆWindows ä¸‹ apksigner ä¸º .batï¼‰</span>
<span class="hljs-variable">$zipalign</span>   = Join-Path <span class="hljs-variable">$BuildToolsDir</span> <span class="hljs-string">"zipalign.exe"</span>
<span class="hljs-variable">$apksigner</span>  = Join-Path <span class="hljs-variable">$BuildToolsDir</span> <span class="hljs-string">"apksigner.bat"</span>
<span class="hljs-keyword">if</span> (-<span class="hljs-title function_ invoke__">not</span> (Test-Path <span class="hljs-variable">$zipalign</span>)) { Write-Warn <span class="hljs-string">"æœªæ‰¾åˆ° zipalignï¼š<span class="hljs-subst">$zipalign</span>ï¼Œå°†æ— æ³•å¯¹é½ã€‚å»ºè®®å®‰è£…å®Œæ•´ build-tools æˆ–ä½¿ç”¨ -SkipZipalignã€‚"</span> }
<span class="hljs-keyword">if</span> (-<span class="hljs-title function_ invoke__">not</span> (Test-Path <span class="hljs-variable">$apksigner</span>)) { Write-Err <span class="hljs-string">"æœªæ‰¾åˆ° apksignerï¼š<span class="hljs-subst">$apksigner</span>"</span>; <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span> }

<span class="hljs-comment"># ç”Ÿæˆè¾“å‡ºæ–‡ä»¶å</span>
<span class="hljs-variable">$baseName</span>   = [IO.Path]::<span class="hljs-title function_ invoke__">GetFileNameWithoutExtension</span>(<span class="hljs-variable">$ApkPath</span>)
<span class="hljs-variable">$alignedApk</span> = Join-Path <span class="hljs-variable">$OutDir</span> (<span class="hljs-variable">$baseName</span> + <span class="hljs-string">"_aligned.apk"</span>)
<span class="hljs-variable">$signedApk</span>  = Join-Path <span class="hljs-variable">$OutDir</span> (<span class="hljs-variable">$baseName</span> + <span class="hljs-string">"_signed.apk"</span>)

<span class="hljs-comment"># è¦†ç›–å¤„ç†</span>
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$Overwrite</span>) {
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$f</span> in @(<span class="hljs-variable">$alignedApk</span>,<span class="hljs-variable">$signedApk</span>)) {
        <span class="hljs-keyword">if</span> (Test-Path <span class="hljs-variable">$f</span>) { Remove-Item -LiteralPath <span class="hljs-variable">$f</span> -Force -ErrorAction SilentlyContinue }
    }
} <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$f</span> in @(<span class="hljs-variable">$alignedApk</span>,<span class="hljs-variable">$signedApk</span>)) {
        <span class="hljs-keyword">if</span> (Test-Path <span class="hljs-variable">$f</span>) {
            Write-Err <span class="hljs-string">"è¾“å‡ºæ–‡ä»¶å·²å­˜åœ¨ï¼š<span class="hljs-subst">$f</span>ã€‚ä½¿ç”¨ -Overwrite è¦†ç›–æˆ–åˆ é™¤åé‡è¯•ã€‚"</span>
            <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span>
        }
    }
}

<span class="hljs-comment"># å¯é€‰ zipalign</span>
<span class="hljs-variable">$inputForSign</span> = <span class="hljs-variable">$ApkPath</span>
<span class="hljs-keyword">if</span> (-not <span class="hljs-variable">$SkipZipalign</span>) {
    <span class="hljs-keyword">if</span> (Test-Path <span class="hljs-variable">$zipalign</span>) {
        Write-Info <span class="hljs-string">"æ‰§è¡Œ zipalign..."</span>
        &amp; <span class="hljs-variable">$zipalign</span> -v -p <span class="hljs-number">4</span> <span class="hljs-string">"<span class="hljs-subst">$ApkPath</span>"</span> <span class="hljs-string">"<span class="hljs-subst">$alignedApk</span>"</span> | Write-Host
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$LASTEXITCODE</span> -ne <span class="hljs-number">0</span> -<span class="hljs-keyword">or</span> -<span class="hljs-title function_ invoke__">not</span> (Test-Path <span class="hljs-variable">$alignedApk</span>)) {
            Write-Err <span class="hljs-string">"zipalign å¤±è´¥ã€‚å¯å°è¯•ä½¿ç”¨ -SkipZipalign è·³è¿‡æˆ–æ£€æŸ¥ APKã€‚"</span>
            <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span>
        }
        <span class="hljs-variable">$inputForSign</span> = <span class="hljs-variable">$alignedApk</span>
    } <span class="hljs-keyword">else</span> {
        Write-Warn <span class="hljs-string">"æ‰¾ä¸åˆ° zipalignï¼Œè·³è¿‡å¯¹é½ã€‚"</span>
    }
} <span class="hljs-keyword">else</span> {
    Write-Info <span class="hljs-string">"å·²é€‰æ‹©è·³è¿‡ zipalignã€‚"</span>
}

<span class="hljs-comment"># ç­¾åæ–¹æ¡ˆé…ç½®</span>
<span class="hljs-variable">$enableV1</span> = <span class="hljs-variable">$false</span>; <span class="hljs-variable">$enableV2</span> = <span class="hljs-variable">$false</span>; <span class="hljs-variable">$enableV3</span> = <span class="hljs-variable">$false</span>; <span class="hljs-variable">$enableV4</span> = <span class="hljs-variable">$false</span>
<span class="hljs-keyword">switch</span> (<span class="hljs-variable">$Schemes</span>) {
    <span class="hljs-string">"all"</span> { <span class="hljs-variable">$enableV1</span>=<span class="hljs-variable">$true</span>; <span class="hljs-variable">$enableV2</span>=<span class="hljs-variable">$true</span>; <span class="hljs-variable">$enableV3</span>=<span class="hljs-variable">$true</span>; <span class="hljs-variable">$enableV4</span>=<span class="hljs-variable">$false</span> } <span class="hljs-comment"># V4 å¸¸ç”¨äºå¢é‡åˆ†å‘ï¼Œé€šå¸¸ä¸å¿…</span>
    <span class="hljs-string">"v1"</span>  { <span class="hljs-variable">$enableV1</span>=<span class="hljs-variable">$true</span> }
    <span class="hljs-string">"v2"</span>  { <span class="hljs-variable">$enableV2</span>=<span class="hljs-variable">$true</span> }
    <span class="hljs-string">"v3"</span>  { <span class="hljs-variable">$enableV3</span>=<span class="hljs-variable">$true</span> }
    <span class="hljs-string">"v4"</span>  { <span class="hljs-variable">$enableV4</span>=<span class="hljs-variable">$true</span> } <span class="hljs-comment"># å¦‚éœ€ V4ï¼Œè¯·åŒæ—¶ç¡®ä¿ä¸‹æ¸¸æ”¯æŒ</span>
}

<span class="hljs-comment"># ç»„è£… apksigner å‚æ•°</span>
<span class="hljs-variable">$signArgs</span> = @(
    <span class="hljs-string">"sign"</span>,
    <span class="hljs-string">"--ks"</span>, <span class="hljs-string">"<span class="hljs-subst">$KeystorePath</span>"</span>,
    <span class="hljs-string">"--ks-key-alias"</span>, <span class="hljs-string">"<span class="hljs-subst">$Alias</span>"</span>,
    <span class="hljs-string">"--ks-pass"</span>, <span class="hljs-string">"pass:<span class="hljs-subst">$KeystorePass</span>"</span>,
    <span class="hljs-string">"--key-pass"</span>, <span class="hljs-string">"pass:<span class="hljs-subst">$KeyPass</span>"</span>,
    <span class="hljs-string">"--v1-signing-enabled"</span>,  (<span class="hljs-variable">$enableV1</span>.<span class="hljs-title function_ invoke__">ToString</span>().<span class="hljs-title function_ invoke__">ToLower</span>()),
    <span class="hljs-string">"--v2-signing-enabled"</span>,  (<span class="hljs-variable">$enableV2</span>.<span class="hljs-title function_ invoke__">ToString</span>().<span class="hljs-title function_ invoke__">ToLower</span>()),
    <span class="hljs-string">"--v3-signing-enabled"</span>,  (<span class="hljs-variable">$enableV3</span>.<span class="hljs-title function_ invoke__">ToString</span>().<span class="hljs-title function_ invoke__">ToLower</span>()),
    <span class="hljs-string">"--v4-signing-enabled"</span>,  (<span class="hljs-variable">$enableV4</span>.<span class="hljs-title function_ invoke__">ToString</span>().<span class="hljs-title function_ invoke__">ToLower</span>()),
    <span class="hljs-string">"--out"</span>, <span class="hljs-string">"<span class="hljs-subst">$signedApk</span>"</span>,
    <span class="hljs-string">"<span class="hljs-subst">$inputForSign</span>"</span>
)

Write-Info <span class="hljs-string">"æ‰§è¡Œç­¾å..."</span>
&amp; <span class="hljs-variable">$apksigner</span> @signArgs | Write-Host
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$LASTEXITCODE</span> -ne <span class="hljs-number">0</span> -<span class="hljs-keyword">or</span> -<span class="hljs-title function_ invoke__">not</span> (Test-Path <span class="hljs-variable">$signedApk</span>)) {
    Write-Err <span class="hljs-string">"ç­¾åå¤±è´¥ã€‚"</span>
    <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span>
}

<span class="hljs-comment"># éªŒè¯ç­¾å</span>
Write-Info <span class="hljs-string">"éªŒè¯ç­¾å..."</span>
&amp; <span class="hljs-variable">$apksigner</span> verify --verbose --<span class="hljs-keyword">print</span>-certs <span class="hljs-string">"<span class="hljs-subst">$signedApk</span>"</span> | Write-Host
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$LASTEXITCODE</span> -ne <span class="hljs-number">0</span>) {
    Write-Err <span class="hljs-string">"ç­¾åéªŒè¯å¤±è´¥ã€‚"</span>
    <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span>
}

Write-Host <span class="hljs-string">""</span>
Write-Host <span class="hljs-string">"ç­¾åå®Œæˆï¼š"</span> -ForegroundColor Green
Write-Host <span class="hljs-string">"  <span class="hljs-subst">$signedApk</span>"</span> -ForegroundColor Green
</code></pre>
<p>ä½¿ç”¨ç¤ºä¾‹
åŸºæœ¬ç”¨æ³•ï¼ˆè‡ªåŠ¨æŸ¥æ‰¾æœ€æ–° build-toolsï¼Œv1+v2+v3ï¼Œå…ˆ zipalign å†ç­¾åï¼‰ï¼š</p>
<blockquote>
<p>pwsh .\sign-apk.ps1 -ApkPath D:\app\reinforced.apk -KeystorePath D:\keys\release.jks -Alias myalias -KeystorePass ä½ çš„Keystoreå¯†ç </p>
</blockquote>
<p>æŒ‡å®š build-tools ç›®å½•ä¸è¾“å‡ºç›®å½•ï¼Œå¹¶è¦†ç›–å·²æœ‰è¾“å‡ºï¼š</p>
<blockquote>
<p>pwsh .\sign-apk.ps1 -ApkPath D:\app\reinforced.apk -KeystorePath D:\keys\release.jks -Alias myalias -KeystorePass ä½ çš„Keystoreå¯†ç  -KeyPass ä½ çš„Keyå¯†ç  -BuildToolsDir "C:\Android\sdk\build-tools\35.0.0" -OutDir D:\out -Overwrite</p>
</blockquote>
<p>æŸäº›åŠ å›ºåŒ…è¦æ±‚è·³è¿‡å¯¹é½ï¼š</p>
<blockquote>
<p>pwsh .\sign-apk.ps1 -ApkPath D:\app\reinforced.apk -KeystorePath D:\keys\release.jks -Alias myalias -KeystorePass ä½ çš„Keystoreå¯†ç  -SkipZipalign</p>
</blockquote>
<p>åªå¯ç”¨ v2 ç­¾åï¼ˆæå°‘æ•°åœºæ™¯éœ€è¦ï¼‰ï¼š</p>
<blockquote>
<p>pwsh .\sign-apk.ps1 -ApkPath D:\app\reinforced.apk -KeystorePath D:\keys\release.jks -Alias myalias -KeystorePass ä½ çš„Keystoreå¯†ç  -Schemes v2</p>
</blockquote>
<p><strong>ä»¥ä¸Šæ–¹æ³•éƒ½éœ€è¦æ¯æ¬¡è¾“å…¥Keystoreå¯†ç å’Œaliasï¼Œä¹Ÿå¯ä»¥æå‰è®¾ç½®åœ¨è„šæœ¬ä¸­é…ç½®å¥½è¿™äº›ä¿¡æ¯</strong>
ä¿®æ”¹è„šæœ¬æœ€ä¸Šé¢çš„paramé…ç½®ä¿¡æ¯</p>
<pre><code class="hljs language-ini" lang="ini">param(
    <span class="hljs-section">[Parameter(Mandatory = $true)]</span>
    <span class="hljs-section">[string]</span>$ApkPath,                 <span class="hljs-comment"># å¾…ç­¾åçš„APK</span>

    <span class="hljs-section">[Parameter(Mandatory = $false)]</span>
    <span class="hljs-section">[string]</span>$<span class="hljs-attr">KeystorePath</span> = <span class="hljs-string">'ç­¾åæ–‡ä»¶è·¯å¾„'</span>,            <span class="hljs-comment"># keystore æ–‡ä»¶è·¯å¾„(.jks/.keystore)</span>

    <span class="hljs-section">[Parameter(Mandatory = $false)]</span>
    <span class="hljs-section">[string]</span>$<span class="hljs-attr">Alias</span> = <span class="hljs-string">'keyåˆ«å'</span>,                   <span class="hljs-comment"># keyåˆ«å</span>

    <span class="hljs-section">[Parameter(Mandatory = $false)]</span>
    <span class="hljs-section">[string]</span>$<span class="hljs-attr">KeystorePass</span> = <span class="hljs-string">'å¯†ç '</span>,            <span class="hljs-comment"># keystore å¯†ç </span>

    <span class="hljs-section">[string]</span>$<span class="hljs-attr">KeyPass</span> = <span class="hljs-string">'å¯†ç '</span>,                 <span class="hljs-comment"># key å¯†ç ï¼ˆå¦‚ä¸å¡«é»˜è®¤ä¸ keystore å¯†ç ç›¸åŒï¼‰</span>

    <span class="hljs-section">[string]</span>$BuildToolsDir,           <span class="hljs-comment"># æŒ‡å®š Android build-tools ç›®å½•ï¼ˆå¯é€‰ï¼Œå¦‚ C:\Android\sdk\build-tools\35.0.0ï¼‰</span>
    <span class="hljs-section">[string]</span>$<span class="hljs-attr">OutDir</span> = <span class="hljs-string">'è¾“å‡ºç›®å½•'</span>,                  <span class="hljs-comment"># è¾“å‡ºç›®å½•ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸ APK åŒç›®å½•ï¼‰</span>
)
</code></pre>
<p>è¿™æ ·å°±å¯ä»¥ç®€åŒ–è¿è¡Œè„šæœ¬ä¸º:</p>
<blockquote>
<p>pwsh è„šæœ¬è·¯å¾„(ä¾‹å¦‚ï¼š.\cursor-sign1.ps1) -ApkPath åŠ å›ºåçš„apkè·¯å¾„ï¼ˆä¾‹å¦‚ï¼šD:\work\xxx.apkï¼‰</p>
</blockquote>
<p>å‰ç½®æ¡ä»¶</p>
<ol>
<li>å·²å®‰è£… Android SDKï¼Œå¹¶åœ¨ build-tools ä¸­åŒ…å« apksigner.bat å’Œ zipalign.exeã€‚</li>
<li>æˆ–é€šè¿‡ -BuildToolsDir æ˜ç¡®æŒ‡å®š build-tools è·¯å¾„ã€‚</li>
</ol>
<p>å¦‚éœ€åŒæ—¶äº§å‡ºæœªå¯¹é½ç­¾åã€v4 ç­¾åæˆ–å¼•å…¥æ¸ é“ä¿¡æ¯ï¼Œå¯å‘Šè¯‰æˆ‘ä½ çš„è¦æ±‚ï¼Œæˆ‘å¯è°ƒæ•´è„šæœ¬ã€‚</p>
<hr/>
<h2 data-id="heading-2">è„šæœ¬éªŒè¯ç»“è®º</h2>
<p>è¿›è¡Œä¸€æ¬¡ç®€å•çš„é…ç½®sdkã€ç­¾åè·¯å¾„ï¼Œä¹‹åæ¯æ¬¡åŠ å›ºåè¿›è¡Œç­¾ååªç”¨åœ¨PowerShellä¸­æ‰§è¡Œè„šæœ¬å°±å¯ç”Ÿæˆå¯¹åº”çš„ç­¾ååçš„apkæ–‡ä»¶ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ Go åšæµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼Ÿchromedp å¸¦ä½ é£ï¼]]></title>    <link>https://juejin.cn/post/7579169543233257472</link>    <guid>https://juejin.cn/post/7579169543233257472</guid>    <pubDate>2025-12-03T07:01:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579169543233257472" data-draft-id="7579165599043452943" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" ç”¨ Go åšæµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼Ÿchromedp å¸¦ä½ é£ï¼"/> <meta itemprop="keywords" content="åç«¯,Go,Trae"/> <meta itemprop="datePublished" content="2025-12-03T07:01:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             ç”¨ Go åšæµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼Ÿchromedp å¸¦ä½ é£ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:01:39.000Z" title="Wed Dec 03 2025 07:01:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å½“å¤§å®¶æåˆ°â€œæµè§ˆå™¨è‡ªåŠ¨åŒ–â€ï¼Œç¬¬ä¸€ååº”å¾€å¾€æ˜¯ Python + Seleniumã€‚
ä½†å…¶å® <strong>Go è¯­è¨€ä¹Ÿèƒ½åšæµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼Œè€Œä¸”æ›´å¿«ã€æ›´ç¨³å®šã€æ›´è½»é‡ï¼</strong></p>
</blockquote>
<p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°±æ¥èŠèŠï¼š
<strong>å¦‚ä½•ç”¨ Go + chromedp å®ç°å’Œ Python Selenium ä¸€æ ·çš„ç½‘é¡µæ“ä½œè‡ªåŠ¨åŒ–ã€‚</strong></p>
<hr/>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆè¦ç”¨ Go åšæµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼Ÿ</h2>
<p>å¦‚æœä½ åšè¿‡ Python è‡ªåŠ¨åŒ–ï¼Œä½ å¯èƒ½é‡åˆ°ï¼š</p>
<ul>
<li>Selenium å¯åŠ¨æµè§ˆå™¨å¤ªæ…¢</li>
<li>ChromeDriver ä¸ Chrome ç‰ˆæœ¬å¯¹ä¸ä¸Š</li>
<li>è„šæœ¬è·‘ä¹…äº†å®¹æ˜“å¡æ­»</li>
<li>CPU å ç”¨é«˜</li>
</ul>
<p>è€Œ chromedp è§£å†³äº†è¿™äº›ç—›ç‚¹ï¼š</p>
<h3 data-id="heading-1">âœ” ä¸éœ€è¦ ChromeDriver</h3>
<p>ç›´æ¥ä½¿ç”¨æµè§ˆå™¨å†…ç½®çš„ DevTools åè®®æ§åˆ¶æµè§ˆå™¨ï¼Œæ¯” Selenium å°‘äº†ä¸€å±‚é©±åŠ¨ã€‚</p>
<h3 data-id="heading-2">âœ” é€Ÿåº¦å¿«åˆ°é£èµ·</h3>
<p>chromedp åŸºäº Go å¹¶å‘æ¨¡å‹ï¼Œæ€§èƒ½æ¯” Python Selenium æ›´é«˜ã€‚</p>
<h3 data-id="heading-3">âœ” æ›´ç¨³å®š</h3>
<p>é€šè¿‡ CDPï¼ˆChrome DevTools Protocolï¼‰ï¼Œç”± Google å®˜æ–¹ç»´æŠ¤åè®®ï¼Œæœ¬è´¨ç¨³å®šæ€§æ›´å¥½ã€‚</p>
<h3 data-id="heading-4">âœ” å¯ä»¥ Headless/æœ‰ç•Œé¢ä»»æ„åˆ‡æ¢</h3>
<p>æ—¢èƒ½æ— ç•Œé¢è·‘è„šæœ¬ï¼Œä¹Ÿèƒ½åƒäººä¸€æ ·æ“ä½œæµè§ˆå™¨ã€‚</p>
<h3 data-id="heading-5">âœ” éå¸¸é€‚åˆæœåŠ¡å™¨ã€Docker ç­‰ç¯å¢ƒè¿è¡Œ</h3>
<p>ç›¸æ¯” Selenium æ›´è½»é‡ã€‚</p>
<hr/>
<h2 data-id="heading-6">chromedp æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>chromedp æ˜¯ Go å®˜æ–¹å›¢é˜Ÿæˆå‘˜ç»´æŠ¤çš„ä¸€ä¸ªåº“ï¼Œç”¨æ¥é€šè¿‡ CDP åè®®æ§åˆ¶ Chromeã€‚</p>
<p>å®ƒå¯ä»¥ï¼š</p>
<ul>
<li>æ‰“å¼€ URL</li>
<li>è‡ªåŠ¨ç‚¹å‡»å…ƒç´ </li>
<li>è‡ªåŠ¨å¡«å†™è¡¨å•</li>
<li>è‡ªåŠ¨æ‰§è¡Œ JS</li>
<li>è‡ªåŠ¨æˆªå›¾</li>
<li>è·å– DOM å†…å®¹</li>
<li>æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º</li>
</ul>
<p>å‡ ä¹ä½ ç”¨ Selenium èƒ½åšçš„ï¼Œå®ƒéƒ½èƒ½åšï¼Œè€Œä¸”æ›´å¿«ã€‚</p>
<hr/>
<h2 data-id="heading-7">âœ¨ æœ€ç®€å•ç¤ºä¾‹ï¼šæ‰“å¼€ç½‘é¡µå¹¶è·å¾—æ ‡é¢˜</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´å¯è¿è¡Œçš„ chromedp ä»£ç ï¼Œæ¼”ç¤ºï¼š</p>
<ol>
<li>æ‰“å¼€ Google</li>
<li>ç­‰å¾… 2 ç§’</li>
<li>è·å–ç½‘é¡µæ ‡é¢˜</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"context"</span>
	<span class="hljs-string">"log"</span>
	<span class="hljs-string">"time"</span>

	<span class="hljs-string">"github.com/chromedp/chromedp"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	ctx, cancel := chromedp.NewContext(context.Background())
	<span class="hljs-keyword">defer</span> cancel()

	<span class="hljs-keyword">var</span> res <span class="hljs-type">string</span>

	err := chromedp.Run(ctx,
		chromedp.Navigate(<span class="hljs-string">"https://www.google.com"</span>),
		chromedp.Sleep(<span class="hljs-number">2</span>*time.Second),
		chromedp.Evaluate(<span class="hljs-string">`document.title`</span>, &amp;res),
	)

	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(err)
	}

	log.Println(<span class="hljs-string">"é¡µé¢æ ‡é¢˜:"</span>, res)
}
</code></pre>
<p>è¿è¡Œåç»ˆç«¯ä¼šè¾“å‡ºï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">é¡µé¢æ ‡é¢˜: Google</span>
</code></pre>
<p>ä¸€ä¸ªéå¸¸ç®€å•çš„ç¤ºä¾‹ï¼Œå´å±•ç¤ºäº† chromedp è‡ªåŠ¨åŒ–çš„å¨åŠ›ã€‚</p>
<hr/>
<h2 data-id="heading-8">chromedp èƒ½åšä»€ä¹ˆï¼Ÿ</h2>
<p>è¿™é‡Œåˆ—ä¸€éƒ¨åˆ†æœ€å¸¸è§çš„è‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚</p>
<h3 data-id="heading-9">â–¶ è‡ªåŠ¨ç‚¹å‡»ç½‘é¡µæŒ‰é’®</h3>
<pre><code class="hljs language-go" lang="go">chromedp.Click(<span class="hljs-string">`#login-button`</span>)
</code></pre>
<h3 data-id="heading-10">â–¶ è‡ªåŠ¨è¾“å…¥å†…å®¹</h3>
<pre><code class="hljs language-go" lang="go">chromedp.SendKeys(<span class="hljs-string">`#username`</span>, <span class="hljs-string">"admin"</span>)
</code></pre>
<h3 data-id="heading-11">â–¶ ç­‰å¾…å…ƒç´ åŠ è½½</h3>
<pre><code class="hljs language-go" lang="go">chromedp.WaitVisible(<span class="hljs-string">`#content`</span>)
</code></pre>
<h3 data-id="heading-12">â–¶ æ‰§è¡Œ JavaScript</h3>
<pre><code class="hljs language-go" lang="go">chromedp.Evaluate(<span class="hljs-string">`document.querySelector("#num").innerText`</span>, &amp;value)
</code></pre>
<h3 data-id="heading-13">â–¶ æˆªå›¾ç½‘é¡µ</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> buf []<span class="hljs-type">byte</span>
chromedp.Screenshot(<span class="hljs-string">`body`</span>, &amp;buf)
</code></pre>
<h3 data-id="heading-14">â–¶ æ‰¹é‡çˆ¬å–ç½‘é¡µæ•°æ®</h3>
<p>å®Œå…¨å¯ä»¥æ›¿ä»£ Python çš„ requests + BeautifulSoup + Seleniumã€‚</p>
<hr/>
<h2 data-id="heading-15">chromedp ä¸ Selenium çš„å¯¹æ¯”</h2>








































<table><thead><tr><th>ç‰¹æ€§</th><th>Selenium</th><th>chromedp</th></tr></thead><tbody><tr><td>é©±åŠ¨ä¾èµ–</td><td>éœ€è¦ ChromeDriver</td><td>ä¸éœ€è¦</td></tr><tr><td>é€Ÿåº¦</td><td>è¾ƒæ…¢</td><td>éå¸¸å¿«</td></tr><tr><td>ç¨³å®šæ€§</td><td>å¶æœ‰å¡æ­»</td><td>ç¨³å®š</td></tr><tr><td>è¿è¡Œç¯å¢ƒ</td><td>ä¸é€‚åˆ Docker</td><td>éå¸¸é€‚åˆ</td></tr><tr><td>æ§åˆ¶åè®®</td><td>WebDriver</td><td>Chrome DevTools</td></tr><tr><td>å­¦ä¹ éš¾åº¦</td><td>ä½</td><td>ä¸­ç­‰</td></tr></tbody></table>
<p>å¦‚æœä½ éœ€è¦å¤§è§„æ¨¡è‡ªåŠ¨åŒ–ä»»åŠ¡ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>æ‰¹é‡ç™»å½•æ“ä½œ</li>
<li>è‡ªåŠ¨çˆ¬å–å†…å®¹</li>
<li>è‡ªåŠ¨æˆªå›¾ç”Ÿæˆå·¥å…·</li>
<li>Web åå°æ‰¹é‡ä¸Šä¼ </li>
<li>ç½‘ç«™ UI è‡ªåŠ¨åŒ–æµ‹è¯•</li>
</ul>
<p>chromedp æ˜¯æ¯” Selenium æ›´é€‚åˆé•¿æœŸè·‘çš„æ–¹æ¡ˆã€‚</p>
<hr/>
<h2 data-id="heading-16">æ›´å¤š chromedp å®æˆ˜ï¼ˆæˆ‘å¯ä»¥å¸®ä½ å†™ï¼‰</h2>
<p>å¦‚æœä½ éœ€è¦å®é™…ä¸šåŠ¡è‡ªåŠ¨åŒ–ï¼Œæˆ‘å¯ä»¥å¸®ä½ å†™ï¼š</p>
<ul>
<li>è‡ªåŠ¨ç™»å½•ç½‘ç«™</li>
<li>è‡ªåŠ¨æŠ“å–å•†å“ä¿¡æ¯</li>
<li>è‡ªåŠ¨åŒ–å…¬ä¼—å·åå°</li>
<li>è‡ªåŠ¨åŒ– Baijia æ–‡ç« ä¸Šä¼ </li>
<li>è‡ªåŠ¨åŒ–æ‰¹é‡æˆªå›¾</li>
<li>è‡ªåŠ¨åŒ–ä¸‹è½½æ•°æ®æ–‡ä»¶</li>
<li>æ‰¹é‡çˆ¬å–ç½‘é¡µå¹¶å¯¼å‡º CSV</li>
</ul>
<p>å‘Šè¯‰æˆ‘ä½ çš„éœ€æ±‚ï¼Œæˆ‘æ¥ç»™ä½ å†™å®Œæ•´å¯è¿è¡Œçš„ Go è‡ªåŠ¨åŒ–è„šæœ¬ã€‚</p>
<hr/>
<h2 data-id="heading-17">æ€»ç»“</h2>
<p>Go + chromedp æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–ç»„åˆï¼Œå®ƒï¼š</p>
<ul>
<li>ä¸ä¾èµ– ChromeDriver</li>
<li>æ›´è½»é‡ã€æ›´å¿«é€Ÿ</li>
<li>æ›´é€‚åˆæœåŠ¡å™¨ç¯å¢ƒ</li>
<li>å®Œå…¨èƒ½å®ç° Selenium çš„åŠŸèƒ½ï¼Œç”šè‡³æ›´å¼º</li>
</ul>
<p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Python Seleniumï¼Œä¸å¦¨è¯•ä¸€è¯• chromedpï¼Œå®ƒä¼šè®©è‡ªåŠ¨åŒ–å˜å¾—æ›´å¿«ã€æ›´ç®€å•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js ä¸å‰ç«¯ JavaScript çš„åŒºåˆ«ï¼šä¸ä»…ä»…æ˜¯â€œè¿è¡Œç¯å¢ƒä¸åŒâ€]]></title>    <link>https://juejin.cn/post/7579167622107152384</link>    <guid>https://juejin.cn/post/7579167622107152384</guid>    <pubDate>2025-12-03T07:03:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579167622107152384" data-draft-id="7579298511070969856" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js ä¸å‰ç«¯ JavaScript çš„åŒºåˆ«ï¼šä¸ä»…ä»…æ˜¯â€œè¿è¡Œç¯å¢ƒä¸åŒâ€"/> <meta itemprop="keywords" content="åç«¯,Node.js"/> <meta itemprop="datePublished" content="2025-12-03T07:03:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js ä¸å‰ç«¯ JavaScript çš„åŒºåˆ«ï¼šä¸ä»…ä»…æ˜¯â€œè¿è¡Œç¯å¢ƒä¸åŒâ€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:03:34.000Z" title="Wed Dec 03 2025 07:03:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è®¸å¤šåˆå­¦è€…ä¼šæœ‰ä¸€ä¸ªå›°æƒ‘ï¼š</p>
<blockquote>
<p>Node.js å’Œæµè§ˆå™¨é‡Œçš„ JavaScript åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
ä¸éƒ½æ˜¯ JavaScript å—ï¼Ÿ</p>
</blockquote>
<p>è¡¨é¢çœ‹ï¼Œå®ƒä»¬è¯­æ³•ä¸€è‡´ï¼Œå®é™…ä¸Š<strong>ä½¿ç”¨æ–¹å¼ã€è®¾è®¡ç›®æ ‡å’Œèƒ½åŠ›è¾¹ç•Œ</strong>å®Œå…¨ä¸åŒã€‚ç†è§£è¿™ç§å·®å¼‚ï¼Œæ˜¯ä»â€œä¼šå†™ JSâ€è¿›é˜¶ä¸ºâ€œèƒ½åšå…¨æ ˆâ€çš„å…³é”®ä¸€æ­¥ã€‚</p>
<p>æœ¬æ–‡å°†ä»å¤šä¸ªç»´åº¦æ·±å…¥å‰–æï¼šNode.js ä¸å‰ç«¯ JavaScript çš„å·®å¼‚åˆ°åº•åœ¨å“ªé‡Œã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€è¿è¡Œç¯å¢ƒä¸åŒï¼šæµè§ˆå™¨ vs æœåŠ¡å™¨</h2>
<p>JavaScript æœ¬èº«åªæ˜¯ä¸€ç§è¯­è¨€ï¼ŒçœŸæ­£å†³å®šèƒ½åŠ›çš„æ˜¯<strong>è¿è¡Œç¯å¢ƒ</strong>ã€‚</p>



































<table><thead><tr><th>ç»´åº¦</th><th>æµè§ˆå™¨ JavaScript</th><th>Node.js</th></tr></thead><tbody><tr><td>è¿è¡Œä½ç½®</td><td>æµè§ˆå™¨</td><td>æœåŠ¡å™¨</td></tr><tr><td>æ“ä½œå¯¹è±¡</td><td>DOM / BOM</td><td>æ–‡ä»¶ / ç½‘ç»œ</td></tr><tr><td>å¸¸è§ä»»åŠ¡</td><td>æ“ä½œé¡µé¢</td><td>æä¾›æœåŠ¡</td></tr><tr><td>è®¿é—®ç³»ç»Ÿ</td><td>âŒ</td><td>âœ…</td></tr><tr><td>å®‰å…¨çº§åˆ«</td><td>æ²™ç®±</td><td>é«˜æƒé™</td></tr></tbody></table>
<h3 data-id="heading-1">æµè§ˆå™¨ JS å…³æ³¨çš„æ˜¯ï¼š</h3>
<ul>
<li>é¡µé¢æ¸²æŸ“</li>
<li>ç”¨æˆ·äº¤äº’</li>
<li>åŠ¨ç”»æ•ˆæœ</li>
<li>æµè§ˆå™¨å…¼å®¹</li>
</ul>
<h3 data-id="heading-2">Node.js å…³æ³¨çš„æ˜¯ï¼š</h3>
<ul>
<li>ç½‘ç»œé€šä¿¡</li>
<li>æ•°æ®å­˜å‚¨</li>
<li>æ–‡ä»¶å¤„ç†</li>
<li>æ€§èƒ½ä¸å¹¶å‘</li>
</ul>
<hr/>
<h2 data-id="heading-3">äºŒã€API èƒ½åŠ›å®Œå…¨ä¸åŒ</h2>
<h3 data-id="heading-4">æµè§ˆå™¨ JavaScript æä¾›ï¼š</h3>
<ul>
<li>document / window</li>
<li>fetch / XMLHttpRequest</li>
<li>localStorage</li>
<li>Canvas / WebGL</li>
</ul>
<p>å®ƒæœ¬è´¨æ˜¯<strong>å‰ç«¯æ¸²æŸ“å¼•æ“çš„æ§åˆ¶è¯­è¨€</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-5">Node.js æä¾›ï¼š</h3>
<ul>
<li>fsï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰</li>
<li>net / http</li>
<li>child_process</li>
<li>worker_threads</li>
<li>cluster</li>
<li>process</li>
</ul>
<p>å®ƒæ˜¯ä¸€ä¸ª<strong>ç³»ç»Ÿçº§è¿è¡Œç¯å¢ƒ</strong>ã€‚</p>
<p>ç¤ºä¾‹å¯¹æ¯”ï¼š</p>
<h4 data-id="heading-6">âœ… Node.js è¯»æ–‡ä»¶</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> data = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'test.txt'</span>, <span class="hljs-string">'utf8'</span>);
</code></pre>
<h4 data-id="heading-7">âŒ æµè§ˆå™¨ä¸­æ— æ³•è¿è¡Œ</h4>
<p>å› ä¸ºæµè§ˆå™¨ç¦æ­¢ç›´æ¥è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<hr/>
<h2 data-id="heading-8">ä¸‰ã€äº‹ä»¶æ¨¡å‹ï¼šçœ‹ä¼¼ç›¸åŒï¼Œå®åˆ™ä¸åŒ</h2>
<p>ä¸¤è€…éƒ½èƒ½ï¼š</p>
<ul>
<li>ä½¿ç”¨äº‹ä»¶æœºåˆ¶</li>
<li>ä½¿ç”¨ Promise</li>
<li>ä½¿ç”¨ async / await</li>
</ul>
<p>ä½†ï¼š</p>
<p>æµè§ˆå™¨äº‹ä»¶ï¼š</p>
<ul>
<li>click</li>
<li>scroll</li>
<li>load</li>
</ul>
<p>Node.js äº‹ä»¶ï¼š</p>
<ul>
<li>data</li>
<li>request</li>
<li>close</li>
<li>error</li>
</ul>
<p>Node.js çš„äº‹ä»¶åŸºäºï¼š</p>
<blockquote>
<p>æœåŠ¡å™¨ IO çŠ¶æ€å˜åŒ–</p>
</blockquote>
<p>æµè§ˆå™¨äº‹ä»¶åŸºäºï¼š</p>
<blockquote>
<p>ç”¨æˆ·è¡Œä¸ºå˜åŒ–</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">å››ã€æ¨¡å—ç³»ç»Ÿä¸åŒ</h2>






























<table><thead><tr><th>ç»´åº¦</th><th>æµè§ˆå™¨</th><th>Node.js</th></tr></thead><tbody><tr><td>æ¨¡å—ç®¡ç†</td><td>æ‰“åŒ…å·¥å…·</td><td>åŸç”Ÿæ”¯æŒ</td></tr><tr><td>æ ‡å‡†</td><td>ES Module</td><td>CommonJS / ESM</td></tr><tr><td>ä¾èµ–æ–¹å¼</td><td>æ‰“åŒ…æ—¶</td><td>è¿è¡Œæ—¶</td></tr><tr><td>node_modules</td><td>âŒ</td><td>âœ…</td></tr></tbody></table>
<h3 data-id="heading-10">Node.js æ¨¡å—ï¼š</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
</code></pre>
<p>æµè§ˆå™¨ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> util <span class="hljs-keyword">from</span> <span class="hljs-string">'./util.js'</span>
</code></pre>
<p>æµè§ˆå™¨ç‰ˆæœ¬çš„æ¨¡å—éœ€ç»è¿‡æ„å»ºå·¥å…·å¤„ç†ï¼Œè€Œ Node.js åŸç”Ÿå¼€æ”¾æ•´ä¸ªä¾èµ–ä½“ç³»ã€‚</p>
<hr/>
<h2 data-id="heading-11">äº”ã€è°ƒè¯•æ–¹å¼ä¸åŒ</h2>
<h3 data-id="heading-12">æµè§ˆå™¨è°ƒè¯•ï¼š</h3>
<ul>
<li>DevTools é¢æ¿</li>
<li>DOM æŸ¥çœ‹å™¨</li>
<li>æ ·å¼è°ƒè¯•</li>
</ul>
<h3 data-id="heading-13">Node.js è°ƒè¯•ï¼š</h3>
<ul>
<li>æ—¥å¿—</li>
<li>æ–­ç‚¹</li>
<li>Inspector</li>
<li>è¿›ç¨‹ç›‘æ§</li>
<li>å†…å­˜å¿«ç…§</li>
</ul>
<p>åç«¯è°ƒè¯•æ›´å¼ºè°ƒï¼š</p>
<blockquote>
<p>å®šä½ BUG + åˆ†ææ€§èƒ½ + æ§åˆ¶èµ„æº</p>
</blockquote>
<hr/>
<h2 data-id="heading-14">å…­ã€æ€§èƒ½ç­–ç•¥ä¸åŒ</h2>
<p>æµè§ˆå™¨ä¼˜åŒ–ç›®æ ‡ï¼š</p>
<ul>
<li>é¡µé¢æµç•…</li>
<li>æ¸²æŸ“æ€§èƒ½</li>
<li>å‡å°‘é˜»å¡</li>
</ul>
<p>Node.js ä¼˜åŒ–ç›®æ ‡ï¼š</p>
<ul>
<li>ååé‡</li>
<li>å¹¶å‘èƒ½åŠ›</li>
<li>å†…å­˜æ§åˆ¶</li>
<li>å“åº”æ—¶é—´</li>
</ul>
<p>æµè§ˆå™¨æ˜¯ï¼š</p>
<blockquote>
<p>å•ç”¨æˆ·ä½“éªŒä¼˜å…ˆ</p>
</blockquote>
<p>Node.js æ˜¯ï¼š</p>
<blockquote>
<p>å¤šç”¨æˆ·å¹¶å‘ä¼˜å…ˆ</p>
</blockquote>
<hr/>
<h2 data-id="heading-15">ä¸ƒã€å·¥ç¨‹ç»“æ„å®Œå…¨ä¸åŒ</h2>
<h3 data-id="heading-16">å‰ç«¯å·¥ç¨‹ä¸€èˆ¬åŒ…å«ï¼š</h3>
<ul>
<li>components/</li>
<li>assets/</li>
<li>pages/</li>
<li>views/</li>
<li>styles/</li>
</ul>
<h3 data-id="heading-17">Node.js å·¥ç¨‹é€šå¸¸æ˜¯ï¼š</h3>
<ul>
<li>controllers/</li>
<li>services/</li>
<li>models/</li>
<li>routes/</li>
<li>middlewares/</li>
<li>config/</li>
</ul>
<p>å‰ç«¯å¼ºè°ƒã€Œé¡µé¢ã€ï¼Œåç«¯å¼ºè°ƒã€Œä¸šåŠ¡æ¨¡å—ã€ã€‚</p>
<hr/>
<h2 data-id="heading-18">å…«ã€å­¦ä¹ è·¯å¾„ä¹Ÿä¸ä¸€æ ·</h2>
<p>å­¦ä¹ æµè§ˆå™¨ JSï¼š</p>
<p>âœ… DOM
âœ… åŠ¨ç”»
âœ… ç»„ä»¶åŒ–
âœ… çŠ¶æ€ç®¡ç†
âœ… æ¡¥æ¥ API</p>
<p>å­¦ä¹  Node.jsï¼š</p>
<p>âœ… ç½‘ç»œç¼–ç¨‹
âœ… æ•°æ®åº“è¿æ¥
âœ… é‰´æƒ
âœ… æ—¥å¿—ç³»ç»Ÿ
âœ… æ¶æ„è®¾è®¡</p>
<hr/>
<h2 data-id="heading-19">ä¹ã€è¯¯åŒºï¼šNode.js â‰  å‰ç«¯ JS çš„å»¶ä¼¸</h2>
<p>é”™è¯¯è®¤çŸ¥ï¼š</p>
<blockquote>
<p>â€œä¼šå‰ç«¯ JS å°±ä¼š Node.jsâ€</p>
</blockquote>
<p>ç°å®æ˜¯ï¼š</p>
<p>ä¼šè¯­æ³• âœ…
ä¼šæœåŠ¡å¼€å‘ âŒ</p>
<p>Node.js éœ€è¦ä½ å»ºç«‹ï¼š</p>
<ul>
<li>æœåŠ¡æ€ç»´</li>
<li>å¹¶å‘æ„è¯†</li>
<li>é”™è¯¯æ§åˆ¶èƒ½åŠ›</li>
<li>å·¥ç¨‹ç»“æ„è®¾è®¡</li>
</ul>
<hr/>
<h2 data-id="heading-20">åã€æ€»ç»“ä¸€å¥è¯ï¼š</h2>
<h3 data-id="heading-21">Node.js ä¸æµè§ˆå™¨ JS çš„æ ¹æœ¬åŒºåˆ«æ˜¯ï¼š</h3>
<blockquote>
<p>ä¸€ä¸ªä¸º<strong>ç”¨æˆ·ä½“éªŒ</strong>æœåŠ¡
ä¸€ä¸ªä¸º<strong>ç³»ç»Ÿèƒ½åŠ›</strong>æœåŠ¡</p>
</blockquote>
<hr/>
<h2 data-id="heading-22">åä¸€ã€é€‰æ‹©å»ºè®®</h2>

























<table><thead><tr><th>ç›®æ ‡</th><th>æ¨è</th></tr></thead><tbody><tr><td>æƒ³åšé«˜çº§å‰ç«¯</td><td>æ·±å…¥æµè§ˆå™¨ JS</td></tr><tr><td>æƒ³åšå…¨æ ˆ</td><td>å­¦ Node.js</td></tr><tr><td>æƒ³æåç«¯</td><td>Node.js / Go / Java</td></tr><tr><td>æƒ³åšç³»ç»Ÿå·¥å…·</td><td>Node.js éå¸¸åˆé€‚</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-23">ç»“è¯­</h2>
<p>JavaScript æ˜¯ä¸€é—¨è¯­è¨€ï¼Œ
Node.js æ˜¯ä¸€ä¸ªå¹³å°ã€‚</p>
<p>å¦‚æœè¯´æµè§ˆå™¨ JavaScript æ˜¯ï¼š</p>
<blockquote>
<p>UI çš„çµé­‚</p>
</blockquote>
<p>é‚£ä¹ˆ Node.js å°±æ˜¯ï¼š</p>
<blockquote>
<p>åç«¯çš„å¼•æ“</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vueé¡¹ç›®ç´¢å¼•æäº¤-URLé™åˆ¶]]></title>    <link>https://juejin.cn/post/7579164768063668251</link>    <guid>https://juejin.cn/post/7579164768063668251</guid>    <pubDate>2025-12-03T03:39:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579164768063668251" data-draft-id="7579192114828230683" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vueé¡¹ç›®ç´¢å¼•æäº¤-URLé™åˆ¶"/> <meta itemprop="keywords" content="SEO"/> <meta itemprop="datePublished" content="2025-12-03T03:39:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é–æºå“‹ç¬¨å°å­©"/> <meta itemprop="url" content="https://juejin.cn/user/2172290708044151"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vueé¡¹ç›®ç´¢å¼•æäº¤-URLé™åˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290708044151/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é–æºå“‹ç¬¨å°å­©
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:39:09.000Z" title="Wed Dec 03 2025 03:39:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€SEO ç´¢å¼•æäº¤çš„æ ¸å¿ƒ URL é™åˆ¶ï¼ˆç™¾åº¦ / Google é€šç”¨è§„åˆ™ï¼‰</h2>
<p>æ— è®ºå“ªç§ç½‘ç«™ç±»å‹ï¼Œæäº¤ URL åˆ°æœç´¢å¼•æ“ï¼ˆç™¾åº¦èµ„æºå¹³å°ã€Google Search Consoleï¼‰éœ€éµå®ˆä»¥ä¸‹æ ¸å¿ƒé™åˆ¶ï¼Œè¿è§„ä¼šå¯¼è‡´<strong>ç´¢å¼•å¤±è´¥ã€æ”¶å½•å»¶è¿Ÿç”šè‡³ç«™ç‚¹æƒ©ç½š</strong>ï¼š</p>
<h3 data-id="heading-1">1. æ ¼å¼ä¸åè®®é™åˆ¶</h3>
<ul>
<li>âœ… å¿…é¡»æ˜¯<strong>ç»å¯¹ URL</strong>ï¼ˆå®Œæ•´åŒ…å«åè®® + åŸŸå + è·¯å¾„ï¼‰ï¼Œç¤ºä¾‹ï¼š<code>https://www.example.com/about</code>ï¼ˆæ­£ç¡®ï¼‰ï¼Œ<code>/about</code>ï¼ˆé”™è¯¯ï¼Œç›¸å¯¹è·¯å¾„ä¸æ”¯æŒï¼‰</li>
<li>âœ… åè®®ä¸€è‡´æ€§ï¼šæäº¤çš„ URL åè®®ï¼ˆHTTP/HTTPSï¼‰éœ€ä¸ç«™ç‚¹å®é™…ä½¿ç”¨çš„åè®®ä¸€è‡´ï¼Œæ··åˆæäº¤ä¼šå¯¼è‡´ç´¢å¼•æ··ä¹±</li>
<li>âŒ ç¦æ­¢å«ç‰¹æ®Šå­—ç¬¦ï¼šURL ä¸­ä¸èƒ½æœ‰ç©ºæ ¼ã€ä¸­æ–‡å…¨è§’ç¬¦å·ã€éæ³•ç¼–ç å­—ç¬¦ï¼ˆå¦‚<code>%00</code>ï¼‰ï¼Œéœ€ URL ç¼–ç ï¼ˆä¸­æ–‡è½¬<code>%E5%BC%80</code>ç­‰ï¼‰</li>
<li>âŒ ç¦æ­¢é”šç‚¹ï¼ˆ#ï¼‰ï¼š<code>https://www.example.com/#/about</code>Â ä¸­<code>#</code>åçš„å†…å®¹ä¸ä¼šè¢«æœç´¢å¼•æ“è§£æï¼Œæäº¤åä»…æ”¶å½•<code>https://www.example.com/</code>ï¼Œé”šç‚¹éƒ¨åˆ†å¤±æ•ˆ</li>
</ul>
<h3 data-id="heading-2">2. æ•°é‡ä¸é¢‘ç‡é™åˆ¶</h3>























<table><thead><tr><th>å¹³å°</th><th>å•æ¡æäº¤é™åˆ¶</th><th>æ‰¹é‡æäº¤é™åˆ¶ï¼ˆsitemapï¼‰</th><th>æäº¤é¢‘ç‡é™åˆ¶</th></tr></thead><tbody><tr><td>ç™¾åº¦èµ„æºå¹³å°</td><td>å•æ—¥å•ç«™â‰¤100 æ¡ï¼ˆæ‰‹åŠ¨æäº¤ï¼‰</td><td>å• sitemapâ‰¤5 ä¸‡æ¡ URLï¼Œâ‰¤10MB</td><td>åŒ URL é‡å¤æäº¤é—´éš”â‰¥24 å°æ—¶ï¼Œé¿å…é¢‘ç¹æäº¤</td></tr><tr><td>Google Search Console</td><td>æ— æ˜ç¡®å•æ¡ä¸Šé™</td><td>å• sitemapâ‰¤5 ä¸‡æ¡ URLï¼Œâ‰¤10MB</td><td>å»ºè®®æ¯å‘¨æ›´æ–° sitemapï¼Œé¿å…å•æ—¥å¤šæ¬¡æäº¤</td></tr></tbody></table>
<ul>
<li>âŒ ç¦æ­¢æ‰¹é‡æäº¤æ— å…³ URLï¼šå¦‚éæœ¬ç«™ URLã€æ­»é“¾ã€è·³è½¬é“¾æ¥ï¼Œä¼šè¢«åˆ¤å®šä¸º â€œåƒåœ¾æäº¤â€ï¼Œå½±å“ç«™ç‚¹ä¿¡ä»»åº¦</li>
</ul>
<h3 data-id="heading-3">3. å†…å®¹ä¸å¯è®¿é—®æ€§é™åˆ¶</h3>
<ul>
<li>âœ… å¿…é¡»æ˜¯<strong>å¯ç›´æ¥è®¿é—®çš„æœ‰æ•ˆé¡µé¢</strong>ï¼šè¿”å›çŠ¶æ€ç  200ï¼ˆæ­£å¸¸ï¼‰ï¼Œä¸èƒ½æ˜¯ 404ï¼ˆä¸å­˜åœ¨ï¼‰ã€403ï¼ˆç¦æ­¢è®¿é—®ï¼‰ã€301/302ï¼ˆè·³è½¬ï¼‰ã€5xxï¼ˆæœåŠ¡å™¨é”™è¯¯ï¼‰</li>
<li>âŒ ç¦æ­¢æäº¤ â€œæ¡¥é¡µ / åƒåœ¾é¡µâ€ï¼šå†…å®¹é‡å¤ã€æ— å®è´¨ä»·å€¼ã€ä»…ä¸º SEO å †ç Œå…³é”®è¯çš„é¡µé¢</li>
<li>âŒ ç¦æ­¢æäº¤éœ€ç™»å½• / æƒé™éªŒè¯çš„é¡µé¢ï¼šæœç´¢å¼•æ“çˆ¬è™«æ— æ³•è·å–å†…å®¹ï¼Œæäº¤åä¹Ÿä¸ä¼šç´¢å¼•</li>
<li>âœ… é¡µé¢éœ€ç¬¦åˆ â€œå¯æŠ“å–â€ï¼šrobots.txt æœªç¦æ­¢çˆ¬è™«ï¼ˆå¦‚<code>Disallow: /</code>ä¼šå¯¼è‡´å…¨ç«™æ— æ³•æŠ“å–ï¼‰ï¼Œæ—  IP å°ç¦ã€CDN æ‹¦æˆªçˆ¬è™«ç­‰é™åˆ¶</li>
</ul>
<h3 data-id="heading-4">4. åŠ¨æ€ URL é™åˆ¶</h3>
<ul>
<li>ä¸å»ºè®®æäº¤å«è¿‡å¤šå‚æ•°çš„ URLï¼ˆå¦‚<code>https://www.example.com/list?id=123&amp;page=2&amp;sort=time</code>ï¼‰ï¼Œæ˜“è¢«åˆ¤å®šä¸º â€œé‡å¤å†…å®¹â€</li>
<li>è‹¥å¿…é¡»æäº¤åŠ¨æ€ URLï¼Œéœ€æ§åˆ¶å‚æ•°æ•°é‡ï¼ˆâ‰¤3 ä¸ªï¼‰ï¼Œå¹¶é€šè¿‡<code>canonical</code>æ ‡ç­¾æŒ‡å®šä¸» URLï¼Œé¿å…ç´¢å¼•æ··ä¹±</li>
</ul>
<h2 data-id="heading-5">äºŒã€Vue è·¯ç”±å½¢å¼èƒ½å¦æäº¤ï¼Ÿåˆ†æ¨¡å¼è¯¦è§£</h2>
<p>Vue çš„è·¯ç”±æ¨¡å¼ï¼ˆ<code>hash</code>/<code>history</code>ï¼‰ç›´æ¥å½±å“ URL å¯ç´¢å¼•æ€§ï¼Œæ ¸å¿ƒç»“è®ºï¼š<strong>history æ¨¡å¼å¯æ­£å¸¸æäº¤ï¼Œhash æ¨¡å¼éœ€ç‰¹æ®Šå¤„ç†ï¼Œå¦åˆ™æ— æ³•è¢«ç´¢å¼•</strong>ã€‚</p>
<h3 data-id="heading-6">1. Vue hash æ¨¡å¼ï¼ˆé»˜è®¤æ¨¡å¼ï¼ŒURL å« #ï¼‰</h3>
<h4 data-id="heading-7">é—®é¢˜æœ¬è´¨ï¼š</h4>
<p>hash æ¨¡å¼çš„ URL ç»“æ„ä¸ºÂ <code>https://www.example.com/#/about</code>ï¼Œå…¶ä¸­<code>#</code>æ˜¯å‰ç«¯é”šç‚¹æ ‡è¯†ï¼Œ<strong>æœç´¢å¼•æ“çˆ¬è™«ä¸ä¼šè§£æ<code>#</code>åçš„è·¯å¾„</strong>ï¼Œåªä¼šæŠ“å–<code>https://www.example.com/</code>ï¼ˆé¦–é¡µï¼‰ï¼Œæäº¤<code>#</code>åçš„ URLï¼ˆå¦‚<code>https://www.example.com/#/about</code>ï¼‰ä¼šè¢«è§†ä¸º â€œé¦–é¡µé‡å¤æäº¤â€ï¼Œå­è·¯ç”±é¡µé¢æ— æ³•å•ç‹¬ç´¢å¼•ã€‚</p>
<h4 data-id="heading-8">èƒ½å¦æäº¤ï¼Ÿ</h4>
<ul>
<li>âŒ ç›´æ¥æäº¤<code>#</code>åçš„ URL æ— æ•ˆï¼ˆå¦‚<code>https://www.example.com/#/about</code>ï¼‰ï¼Œæœç´¢å¼•æ“ä¸ä¼šè¯†åˆ«å­è·¯ç”±</li>
<li>âœ… è‹¥æ— æ³•åˆ‡æ¢ history æ¨¡å¼ï¼Œéœ€é€šè¿‡ã€Œé¢„æ¸²æŸ“ï¼ˆPrerenderï¼‰ã€æˆ–ã€ŒSSRï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰ã€å¤„ç†ï¼Œå°† hash è·¯ç”±è½¬ä¸ºé™æ€ URL åæäº¤</li>
</ul>
<h4 data-id="heading-9">è§£å†³æ–¹æ¡ˆï¼ˆhash æ¨¡å¼é€‚é… SEOï¼‰ï¼š</h4>
<ul>
<li>
<p>æ–¹æ¡ˆ 1ï¼šä½¿ç”¨<code>prerender-spa-plugin</code>é¢„æ¸²æŸ“å¯¹æ ¸å¿ƒé¡µé¢ï¼ˆå¦‚ /aboutã€/productï¼‰é¢„æ¸²æŸ“ä¸ºé™æ€ HTML æ–‡ä»¶ï¼Œç”Ÿæˆä¸å«<code>#</code>çš„ URLï¼ˆ<code>https://www.example.com/about</code>ï¼‰ï¼Œå†æäº¤é™æ€ URL</p>
</li>
<li>
<p>æ–¹æ¡ˆ 2ï¼šå¼€å¯ç™¾åº¦ â€œhash è·¯ç”±æ”¶å½•â€ åŠŸèƒ½ï¼ˆä»…ç™¾åº¦æ”¯æŒï¼‰åœ¨ç™¾åº¦èµ„æºå¹³å°â†’ç«™ç‚¹è®¾ç½®â†’æŠ“å–è®¾ç½®ä¸­ï¼Œå¼€å¯ â€œæ”¯æŒ hash è·¯ç”±æ”¶å½•â€ï¼Œçˆ¬è™«ä¼šå°è¯•è§£æ<code>#!</code>ï¼ˆæ³¨æ„æ˜¯<code>#!</code>è€Œé<code>#</code>ï¼‰åçš„è·¯å¾„ï¼Œéœ€ä¿®æ”¹ Vue è·¯ç”±é…ç½®ï¼š</p>
<p>javascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-built_in">VueRouter</span>({
  mode: <span class="hljs-string">'hash'</span>,
  hash: <span class="hljs-string">'#!'</span>, <span class="hljs-comment">// å°†é»˜è®¤#æ”¹ä¸º#!ï¼Œé€‚é…ç™¾åº¦hashæ”¶å½•è§„åˆ™</span>
  routes: [...]
})
</code></pre>
<p>æäº¤ URL æ ¼å¼ï¼š<code>https://www.example.com/#!/about</code>ï¼ˆç™¾åº¦ä¼šè§£æä¸º<code>/about</code>è·¯å¾„ï¼‰</p>
</li>
</ul>
<h3 data-id="heading-10">2. Vue history æ¨¡å¼ï¼ˆURL æ—  #ï¼Œæ¨èï¼‰</h3>
<h4 data-id="heading-11">ä¼˜åŠ¿ï¼š</h4>
<p>URL ç»“æ„ä¸ä¼ ç»Ÿç½‘ç«™ä¸€è‡´ï¼ˆå¦‚<code>https://www.example.com/about</code>ï¼‰ï¼Œæ— <code>#</code>ç¬¦å·ï¼Œæœç´¢å¼•æ“å¯ç›´æ¥è§£æè·¯å¾„ï¼Œ<strong>æ”¯æŒæ­£å¸¸ç´¢å¼•æäº¤</strong>ï¼Œæ˜¯ Vue é¡¹ç›® SEO çš„é¦–é€‰æ¨¡å¼ã€‚</p>
<h4 data-id="heading-12">å…³é”®å‰æï¼šæœåŠ¡ç«¯é…ç½®ï¼ˆå¦åˆ™ç´¢å¼•å¤±è´¥ï¼‰</h4>
<p>history æ¨¡å¼ä¾èµ– HTML5Â <code>pushState</code>Â APIï¼Œè‹¥æœåŠ¡ç«¯æœªé…ç½® â€œfallbackâ€ï¼Œç›´æ¥è®¿é—®å­è·¯ç”±ï¼ˆå¦‚<code>https://www.example.com/about</code>ï¼‰ä¼šè¿”å› 404ï¼Œå¯¼è‡´çˆ¬è™«æ— æ³•æŠ“å–ï¼Œæäº¤åç´¢å¼•å¤±è´¥ã€‚</p>
<h4 data-id="heading-13">æœåŠ¡ç«¯é…ç½®ç¤ºä¾‹ï¼ˆæ ¸å¿ƒï¼‰ï¼š</h4>
<ul>
<li>
<p><strong>Nginx é…ç½®</strong>ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼š</p>
<p>nginx</p>
<pre><code class="hljs language-bash" lang="bash">server {
  listen 443 ssl;
  server_name www.example.com;
  root /usr/share/nginx/html; <span class="hljs-comment"># Vueæ‰“åŒ…åçš„distç›®å½•</span>
  index index.html;

  <span class="hljs-comment"># æ ¸å¿ƒï¼šæ‰€æœ‰è·¯ç”±è¯·æ±‚ fallback åˆ°index.html</span>
  location / {
    try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;
  }
}
</code></pre>
</li>
<li>
<p><strong>Apache é…ç½®</strong>ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º<code>.htaccess</code>æ–‡ä»¶ï¼š</p>
<p>apache</p>
<pre><code class="hljs language-ruby" lang="ruby">&lt;<span class="hljs-title class_">IfModule</span> mod_rewrite.c&gt;
  <span class="hljs-title class_">RewriteEngine</span> <span class="hljs-title class_">On</span>
  <span class="hljs-title class_">RewriteBase</span> /
  <span class="hljs-title class_">RewriteRule</span> ^index.html<span class="hljs-variable">$ </span>- [L]
  <span class="hljs-title class_">RewriteCond</span> <span class="hljs-string">%{REQUEST_FILENAME}</span> !-f
  <span class="hljs-title class_">RewriteCond</span> <span class="hljs-string">%{REQUEST_FILENAME}</span> !-d
  <span class="hljs-title class_">RewriteRule</span> . /index.html [L]
&lt;<span class="hljs-regexp">/IfModule&gt;
</span></code></pre>
</li>
<li>
<p><strong>Vercel éƒ¨ç½²</strong>ï¼ˆå‰ç«¯æ‰˜ç®¡å¹³å°ï¼‰ï¼šåœ¨<code>vercel.json</code>ä¸­é…ç½®ï¼š</p>
<p>json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"rewrites"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/(.*)"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/index.html"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
</ul>
<h4 data-id="heading-14">æäº¤æ–¹å¼ï¼š</h4>
<p>ç›´æ¥æäº¤ä¸å«<code>#</code>çš„æ ‡å‡† URLï¼ˆå¦‚<code>https://www.example.com/about</code>ï¼‰ï¼Œæ”¯æŒæ‰‹åŠ¨æäº¤ã€sitemap æ‰¹é‡æäº¤ï¼Œæœç´¢å¼•æ“å¯æ­£å¸¸æŠ“å–è·¯ç”±å¯¹åº”çš„é¡µé¢å†…å®¹ã€‚</p>
<h3 data-id="heading-15">3. Vue è·¯ç”±æäº¤çš„é¢å¤–ä¼˜åŒ–ï¼ˆæå‡ç´¢å¼•æ•ˆç‡ï¼‰</h3>
<ul>
<li>
<p>ğŸ”§ ç”Ÿæˆé™æ€ sitemapï¼šä½¿ç”¨<code>vue-sitemap</code>æˆ–<code>nuxt-sitemap</code>ï¼ˆNuxt.js é¡¹ç›®ï¼‰è‡ªåŠ¨ç”Ÿæˆ sitemap.xmlï¼ŒåŒ…å«æ‰€æœ‰è·¯ç”± URLï¼Œæ‰¹é‡æäº¤æ›´é«˜æ•ˆ</p>
</li>
<li>
<p>ğŸ”§ åŠ¨æ€æ¸²æŸ“ï¼ˆNuxt.js/Next.jsï¼‰ï¼šè‹¥é¡¹ç›®å¤æ‚ï¼ˆå¦‚å¤§é‡åŠ¨æ€æ•°æ®ï¼‰ï¼Œæ¨èä½¿ç”¨ SSRï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰æˆ– SSGï¼ˆé™æ€ç«™ç‚¹ç”Ÿæˆï¼‰ï¼Œç›´æ¥ç”Ÿæˆå¯è¢«çˆ¬è™«æŠ“å–çš„é™æ€ HTMLï¼Œç´¢å¼•é€Ÿåº¦æ¯” SPAï¼ˆå•é¡µåº”ç”¨ï¼‰å¿« 50%+</p>
</li>
<li>
<p>ğŸ”§ æ·»åŠ <code>canonical</code>æ ‡ç­¾ï¼šé¿å…è·¯ç”±å‚æ•°å¯¼è‡´çš„é‡å¤ç´¢å¼•ï¼Œç¤ºä¾‹ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"canonical"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.example.com/about"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
</li>
<li>
<p>ğŸ”§ éªŒè¯è·¯ç”±å¯è®¿é—®æ€§ï¼šæäº¤å‰ç”¨ â€œç™¾åº¦æŠ“å–è¯Šæ–­â€ æˆ– â€œGoogle URL Inspection Toolâ€ æµ‹è¯• URLï¼Œç¡®ä¿è¿”å› 200 ä¸”å†…å®¹å¯æ­£å¸¸æŠ“å–</p>
</li>
</ul>
<h2 data-id="heading-16">ä¸‰ã€å¸¸è§é—®é¢˜é¿å‘æŒ‡å—</h2>
<ol>
<li>âŒ ç›´æ¥æäº¤ Vue hash æ¨¡å¼çš„<code>#</code>å URLï¼šå¦‚<code>https://www.example.com/#/about</code>ï¼Œæœç´¢å¼•æ“ä»…æ”¶å½•é¦–é¡µï¼Œå­è·¯ç”±æ— æ³•ç´¢å¼•</li>
<li>âŒ history æ¨¡å¼æœªé…ç½®æœåŠ¡ç«¯ fallbackï¼šè®¿é—®å­è·¯ç”±è¿”å› 404ï¼Œæäº¤åç´¢å¼•å¤±è´¥</li>
<li>âŒ æäº¤ç›¸å¯¹è·¯å¾„æˆ–åè®®ä¸ä¸€è‡´çš„ URLï¼šå¦‚<code>/about</code>ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰ã€<code>http://www.example.com/about</code>ï¼ˆç«™ç‚¹å®é™…ç”¨ HTTPSï¼‰ï¼Œç›´æ¥è¢«æœç´¢å¼•æ“æ‹’ç»</li>
<li>âŒ é¢‘ç¹é‡å¤æäº¤åŒä¸€ URLï¼šå•æ—¥å¤šæ¬¡æäº¤ä¼šè§¦å‘é¢‘ç‡é™åˆ¶ï¼Œå»ºè®®é€šè¿‡ sitemap å®šæœŸæ›´æ–°ï¼ˆæ¯å‘¨ 1 æ¬¡ï¼‰</li>
<li>âŒ æäº¤éœ€ç™»å½•æ‰èƒ½è®¿é—®çš„è·¯ç”±ï¼šå¦‚<code>https://www.example.com/user/center</code>ï¼Œçˆ¬è™«æ— æ³•è·å–å†…å®¹ï¼Œç´¢å¼•å¤±è´¥</li>
</ol>
<h2 data-id="heading-17">å››ã€æ€»ç»“</h2>
<h3 data-id="heading-18">1. URL æäº¤æ ¸å¿ƒé™åˆ¶ recapï¼š</h3>
<ul>
<li>æ ¼å¼ï¼šç»å¯¹ URLã€åè®®ä¸€è‡´ã€æ— ç‰¹æ®Šå­—ç¬¦ / é”šç‚¹</li>
<li>æ•°é‡ï¼šç™¾åº¦å•æ—¥â‰¤100 æ¡ï¼ˆæ‰‹åŠ¨ï¼‰ï¼Œsitemapâ‰¤5 ä¸‡æ¡</li>
<li>å¯è®¿é—®æ€§ï¼šçŠ¶æ€ç  200ã€æ— çˆ¬è™«é™åˆ¶ã€å†…å®¹æœ‰æ•ˆ</li>
<li>åŠ¨æ€ URLï¼šæ§åˆ¶å‚æ•°æ•°é‡ï¼Œç”¨<code>canonical</code>æŒ‡å®šä¸» URL</li>
</ul>
<h3 data-id="heading-19">2. Vue è·¯ç”±é€‚é…ç»“è®ºï¼š</h3>




















<table><thead><tr><th>Vue è·¯ç”±æ¨¡å¼</th><th>èƒ½å¦ç›´æ¥æäº¤</th><th>å…³é”®æ“ä½œ</th></tr></thead><tbody><tr><td>hash æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</td><td>âŒ ä¸èƒ½</td><td>æ–¹æ¡ˆ 1ï¼šåˆ‡æ¢ä¸º history æ¨¡å¼ + æœåŠ¡ç«¯ fallbackï¼›æ–¹æ¡ˆ 2ï¼šå¼€å¯ç™¾åº¦ hash æ”¶å½• + ä¿®æ”¹<code>#</code>ä¸º<code>#!</code></td></tr><tr><td>history æ¨¡å¼</td><td>âœ… å¯ä»¥</td><td>æœåŠ¡ç«¯é…ç½® fallbackï¼ˆNginx/Apache ç­‰ï¼‰ï¼Œæäº¤æ ‡å‡† URL</td></tr></tbody></table>
<h3 data-id="heading-20">3. æœ€ä¼˜å®è·µï¼š</h3>
<p>Vue é¡¹ç›®ä¼˜å…ˆä½¿ç”¨ã€Œhistory æ¨¡å¼ + æœåŠ¡ç«¯ fallback + é™æ€ sitemap æäº¤ã€ï¼Œé…åˆé¢„æ¸²æŸ“ / SSR æå‡æŠ“å–æ•ˆç‡ï¼Œæäº¤å‰ç”¨æŠ“å–è¯Šæ–­å·¥å…·éªŒè¯ï¼Œç¡®ä¿ URL ç¬¦åˆæœç´¢å¼•æ“è§„åˆ™ï¼Œæ‰èƒ½å¿«é€Ÿè¢«ç´¢å¼•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…ˆæŠŠ Rollup ææ˜ç™½ï¼Œå†å»å­¦ Viteï¼]]></title>    <link>https://juejin.cn/post/7579165599042600975</link>    <guid>https://juejin.cn/post/7579165599042600975</guid>    <pubDate>2025-12-03T03:42:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579165599042600975" data-draft-id="7579169543232389120" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…ˆæŠŠ Rollup ææ˜ç™½ï¼Œå†å»å­¦ Viteï¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T03:42:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç§€ç§€ä¸åªä¼šå‰ç«¯"/> <meta itemprop="url" content="https://juejin.cn/user/1410009035452887"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…ˆæŠŠ Rollup ææ˜ç™½ï¼Œå†å»å­¦ Viteï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1410009035452887/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç§€ç§€ä¸åªä¼šå‰ç«¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:42:57.000Z" title="Wed Dec 03 2025 03:42:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚å¿µ</h2>
<ul>
<li>â€‹**Rollup æ˜¯ä¸€ä¸ª ES æ¨¡å—æ‰“åŒ…å™¨ï¼ˆbundlerï¼‰**â€‹ï¼Œæ“…é•¿æŠŠå¤šä¸ª ESModule æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª bundleï¼Œç›®æ ‡å¸¸æ˜¯åº“ï¼ˆlibraryï¼‰æˆ–å‰ç«¯åº”ç”¨çš„ç”Ÿäº§æ„å»ºã€‚</li>
</ul>
<blockquote>
<p>æ ¸å¿ƒç†å¿µæ˜¯ â€‹<strong>åŸºäº ES Module çš„é™æ€åˆ†æ</strong>â€‹ï¼šRollup èƒ½æ›´ç²¾å‡†åš tree-shakingï¼ˆåˆ é™¤æœªä½¿ç”¨å¯¼å‡ºï¼‰ï¼Œäº§å‡ºçš„ bundle æ›´å°ã€æ›´â€œçº¯å‡€â€ã€‚</p>
<p>Rollup çš„æ‰“åŒ…ç»“æœæ›´é€‚åˆåšåº“å‘å¸ƒï¼ˆè¾“å‡º ESM/CJS/UMDï¼‰ï¼Œä½†åœ¨å‰ç«¯åº”ç”¨ä¸Šï¼ˆå°¤å…¶é…åˆ pluginï¼‰ä¹Ÿéå¸¸å¼ºå¤§ï¼ˆvite æ‰“åŒ…å™¨ï¼‰ã€‚</p>
</blockquote>
<h3 data-id="heading-1">Rollup ä¸å…¶å®ƒ bundler çš„å®šä½å¯¹æ¯”</h3>
<ul>
<li>â€‹<strong>Webpack</strong>â€‹ï¼šåŠŸèƒ½é½å…¨ã€æ’ä»¶ç”Ÿæ€ä¸°å¯Œã€é¢å‘åº”ç”¨ï¼ˆå¤æ‚çš„ code-splittingã€loader ï¼‰ã€‚</li>
<li>â€‹<strong>Rollup</strong>â€‹ï¼šæ›´æ³¨é‡é™æ€ ESM åˆ†æå’Œç”Ÿæˆæ›´å°çš„åº“åŒ…ï¼Œtree-shaking æ›´ç²¾å‡†ã€‚ç”¨äºåº“å¼€å‘æˆ–ä½œä¸ºç”Ÿäº§æ‰“åŒ…ï¼ˆå¦‚ Vite çš„ rollup é˜¶æ®µï¼‰ã€‚</li>
<li>â€‹<strong>esbuild / swc</strong>â€‹ï¼šè¶…å¿«çš„ç¼–è¯‘/è½¬è¯‘å·¥å…·ï¼Œä½†æ‰“åŒ…èƒ½åŠ›ã€æ’ä»¶ç”Ÿæ€ä¸å¦‚ Rollup å…¨é¢ï¼ˆå¯ç»“åˆä½¿ç”¨ï¼šesbuild åšè½¬è¯‘ï¼ŒRollup åšæ‰“åŒ…/ä¼˜åŒ– =&gt; viteï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-2">Rollup å·¥ä½œæµç¨‹</h2>
<ol>
<li>â€‹**è¾“å…¥ï¼ˆentryï¼‰**â€‹ï¼šæŒ‡å®šå…¥å£æ–‡ä»¶ã€‚</li>
<li>â€‹<strong>è§£æä¾èµ–</strong>â€‹ï¼šåŸºäº ES Module é™æ€åˆ†æ <code>import</code>/<code>export</code>ï¼Œå¹¶é€šè¿‡æ’ä»¶è§£æ node_modulesï¼ˆ<code>@rollup/plugin-node-resolve</code>ï¼‰ã€ CommonJSï¼ˆ<code>@rollup/plugin-commonjs</code>ï¼‰ç­‰ã€‚</li>
<li>â€‹<strong>è½¬æ¢</strong>â€‹ï¼šæ’ä»¶å¯å¯¹æ¨¡å—åšè½¬æ¢ï¼ˆTS -&gt; JSã€JSX -&gt; JSã€æ›¿æ¢ç¯å¢ƒå˜é‡ç­‰ï¼‰ã€‚</li>
<li>â€‹<strong>åˆå¹¶ä¸é™æ€åˆ†æ</strong>â€‹ï¼šRollup æ„å»ºæ¨¡å—å›¾ï¼Œå†³å®šå“ªäº›å¯¼å‡ºè¢«å¼•ç”¨ï¼ˆç”¨äº Tree-shakingï¼‰ã€‚</li>
<li>â€‹<strong>ç”Ÿæˆ chunks / assets</strong>â€‹ï¼šæŒ‰é…ç½®è¾“å‡º JS chunkã€CSS / images ç­‰é™æ€èµ„äº§ã€‚</li>
<li>â€‹<strong>å‹ç¼© / äº§å‡º sourcemap</strong>â€‹ï¼šå¯ç”¨ terser ç­‰åšæœ€ç»ˆå‹ç¼©ã€‚</li>
</ol>
<h2 data-id="heading-3">å¸¸ç”¨æ ¸å¿ƒé…ç½®é¡¹ï¼ˆrollup.config.jsï¼‰</h2>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> resolve <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-node-resolve'</span>;
<span class="hljs-keyword">import</span> commonjs <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-commonjs'</span>;
<span class="hljs-keyword">import</span> json <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-json'</span>;
<span class="hljs-keyword">import</span> { terser } <span class="hljs-keyword">from</span> <span class="hljs-string">'rollup-plugin-terser'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">input</span>: <span class="hljs-string">'src/index.js'</span>,        <span class="hljs-comment">// å…¥å£</span>
  <span class="hljs-attr">external</span>: [<span class="hljs-string">'react'</span>],         <span class="hljs-comment">// ä¸æ‰“åŒ…çš„å¤–éƒ¨ä¾èµ–ï¼ˆåº“é€šå¸¸ä¼šæ ‡è®° peerDependenciesï¼‰</span>
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">resolve</span>(),                 <span class="hljs-comment">// è§£æ node_modules ä¸­çš„åŒ…</span>
    <span class="hljs-title function_">commonjs</span>(),                <span class="hljs-comment">// è½¬æ¢ CommonJS -&gt; ESM</span>
    <span class="hljs-comment">// å…¶ä»–æ’ä»¶ï¼šbabel/typescript/esbuild/postcss ç­‰</span>
    <span class="hljs-title function_">terser</span>(),                  <span class="hljs-comment">// å‹ç¼©ï¼ˆåªåœ¨ prodï¼‰</span>
  ],
  <span class="hljs-attr">output</span>: [
    {
      <span class="hljs-attr">file</span>: <span class="hljs-string">'dist/index.esm.js'</span>,
      <span class="hljs-attr">format</span>: <span class="hljs-string">'es'</span>,            <span class="hljs-comment">// ESM</span>
      <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">true</span>,
    },
    {
      <span class="hljs-attr">file</span>: <span class="hljs-string">'dist/index.cjs.js'</span>,
      <span class="hljs-attr">format</span>: <span class="hljs-string">'cjs'</span>,           <span class="hljs-comment">// CommonJS</span>
      <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">true</span>,
    }
  ]
};
</code></pre>
<h3 data-id="heading-4">è¾“å‡ºæ ¼å¼ï¼ˆoutput.formatï¼‰è¯´æ˜</h3>
<ul>
<li><code>es</code> / <code>esm</code>ï¼šES Moduleï¼Œç°ä»£æ‰“åŒ…å™¨æˆ– Nodeï¼ˆ&gt;=æ”¯æŒ ESMï¼‰ä½¿ç”¨ã€‚æ¨èç”¨äºåº“çš„æ¨¡å—åŒ–è¾“å‡ºã€‚</li>
<li><code>cjs</code>ï¼šCommonJSï¼Œç”¨äº Node æˆ–è€å¼æ‰“åŒ…æ¶ˆè´¹è€…ã€‚</li>
<li><code>umd</code>ï¼šé€šç”¨æ¨¡å—å®šä¹‰ï¼ˆUMDï¼‰ï¼Œé€‚åˆç›´æ¥åœ¨æµè§ˆå™¨é€šè¿‡ <code>&lt;script&gt;</code> ä½¿ç”¨ï¼ˆé€šå¸¸éœ€è¦ <code>name</code> + <code>globals</code>ï¼‰ã€‚</li>
<li><code>iife</code>ï¼šç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼ï¼Œå•æ–‡ä»¶æµè§ˆå™¨è„šæœ¬ï¼ˆä¸ä¾èµ–æ¨¡å—åŠ è½½å™¨ï¼‰ã€‚</li>
<li><code>amd</code> / <code>system</code>ï¼šå¾ˆå°‘ç”¨ï¼Œåˆ†åˆ«ä¸º AMD å’Œ SystemJS æ ¼å¼ã€‚</li>
</ul>
<p>å¦‚æœåšåº“ï¼Œä¸€èˆ¬è¾“å‡º <code>es</code> + <code>cjs</code>ï¼ˆå¹¶å¯é¢å¤–è¾“å‡º <code>umd</code> åšæµè§ˆå™¨å…¼å®¹ï¼‰ã€‚</p>
<h3 data-id="heading-5">external ä¸ globals</h3>
<ul>
<li><code>external</code>ï¼šå‘Šè¯‰ Rollup å“ªäº›æ¨¡å—åº”è§†ä¸ºå¤–éƒ¨ä¾èµ–ï¼Œä¸ä¼šè¢«æ‰“åŒ…è¿› bundleï¼ˆé€šå¸¸å¯¹ library å¾ˆé‡è¦ï¼‰ã€‚ä¾‹ï¼š<code>external: ['react', 'react-dom']</code>ã€‚</li>
<li><code>output.globals</code>ï¼šå½“ output.format ä¸º <code>umd</code>/<code>iife</code> æ—¶ï¼Œéœ€è¦æŒ‡å®šå¤–éƒ¨åŒ…åœ¨æµè§ˆå™¨ä¸‹çš„å…¨å±€å˜é‡åï¼Œä¾‹å¦‚ <code>{ react: 'React' }</code>ã€‚</li>
</ul>
<h3 data-id="heading-6">Tree-shakingï¼ˆæ‘‡æ ‘ä¼˜åŒ–ï¼‰</h3>
<ul>
<li>Rollup åŸºäº ESM çš„é™æ€ç»“æ„åˆ¤æ–­å“ªäº›å¯¼å‡ºå¯åˆ ï¼›ç›¸æ¯”åŸºäº AST çš„åå¤„ç†å·¥å…·ï¼ŒRollup çš„ç²¾åº¦å¾ˆé«˜ã€‚</li>
<li>é‡è¦é…ç½®ï¼š
<ul>
<li><code>treeshake: true | { moduleSideEffects: boolean | string[], propertyReadSideEffects: boolean }</code></li>
<li><code>moduleSideEffects</code> å¯¹åº” package.json çš„ <code>sideEffects</code> å­—æ®µï¼šæ­£ç¡®å£°æ˜èƒ½è®© Rollup æ›´æ¿€è¿›åœ°ç§»é™¤æ— ç”¨æ¨¡å—ã€‚</li>
</ul>
</li>
<li>â€‹<strong>å»ºè®®</strong>â€‹ï¼šåœ¨ <code>package.json</code> ä¸­ç»´æŠ¤ <code>sideEffects</code>ï¼Œå¯¹äºä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨çš„æ–‡ä»¶æˆ–åŒ…æ ‡æ³¨ä¸º falseï¼ˆæˆ–åˆ—å‡ºé‚£äº›æœ‰å‰¯ä½œç”¨çš„æ–‡ä»¶ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-7">Code-Splittingï¼ˆä»£ç åˆ†å‰²ï¼‰</h3>
<ul>
<li>Rollup æ”¯æŒå¤šå…¥å£å’ŒåŠ¨æ€ <code>import()</code> ä»¥ç”Ÿæˆå¤šä¸ª chunkã€‚</li>
<li>å¸¸ç”¨é…ç½®ï¼š
<ul>
<li><code>input</code> å¯ä»¥æ˜¯æ•°ç»„æˆ–å¯¹è±¡ï¼š<code>input: { main: 'src/main.js', admin: 'src/admin.js' }</code>ï¼Œä¼šç”Ÿæˆå¤šä¸ªå…¥å£ chunkã€‚</li>
<li><code>output.manualChunks</code>ï¼šæ‰‹åŠ¨æ§åˆ¶ chunk åˆ’åˆ†ï¼ˆæŠŠå¤§å‹ä¾èµ–æ‹†å‡º vendor chunk ç­‰ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p>ç¤ºä¾‹ <code>manualChunks</code>ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-attr">output</span>: {
  <span class="hljs-attr">dir</span>: <span class="hljs-string">'dist'</span>,
  <span class="hljs-attr">format</span>: <span class="hljs-string">'esm'</span>,
  <span class="hljs-title function_">manualChunks</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'node_modules'</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor'</span>;
    }
  }
}
</code></pre>
<h2 data-id="heading-8">æ’ä»¶ç”Ÿæ€ï¼ˆå¸¸ç”¨æ’ä»¶ï¼‰</h2>
<p>åŸºæœ¬è§£æ/è½¬æ¢ï¼š</p>
<ul>
<li><code>@rollup/plugin-node-resolve</code>ï¼šè§£æ node_modulesï¼Œæ”¯æŒ <code>browser</code>, <code>extensions</code> ç­‰é€‰é¡¹ã€‚</li>
<li><code>@rollup/plugin-commonjs</code>ï¼šæŠŠ CommonJS æ¨¡å—è½¬ä¸º ESMï¼ˆä¸€å®šè¦æ”¾åœ¨ resolve ä¹‹åï¼‰ã€‚</li>
<li><code>@rollup/plugin-json</code>ï¼šå…è®¸ <code>import data from './data.json'</code>ã€‚</li>
</ul>
<p>ç¼–è¯‘/è½¬è¯‘ï¼š</p>
<ul>
<li><code>@rollup/plugin-babel</code>ï¼šBabel è½¬è¯‘ï¼ˆé…åˆ preset-envï¼‰ã€‚</li>
<li><code>@rollup/plugin-typescript</code>ï¼šå®˜æ–¹çš„ TS æ”¯æŒï¼ˆä½†å¸¸ç”¨ <code>rollup-plugin-typescript2</code>ï¼Œå› ä¸ºæ›´æˆç†Ÿå¹¶æ”¯æŒ declaration è¾“å‡ºï¼‰ã€‚</li>
<li><code>rollup-plugin-esbuild</code> / <code>@rollup/plugin-esbuild</code>ï¼šä½¿ç”¨ esbuild åšè¶…å¿«è½¬è¯‘/TS -&gt; JSï¼ˆæ¨èç”¨äºæé«˜æ„å»ºé€Ÿåº¦ï¼‰ã€‚</li>
</ul>
<p>å…¶ä»–å¸¸ç”¨ï¼š</p>
<ul>
<li><code>rollup-plugin-terser</code>ï¼šå‹ç¼© JSã€‚</li>
<li><code>@rollup/plugin-replace</code>ï¼šæ›¿æ¢å˜é‡ï¼ˆä¾‹å¦‚ <code>process.env.NODE_ENV</code>ï¼‰ã€‚</li>
<li><code>@rollup/plugin-alias</code>ï¼šè·¯å¾„åˆ«åã€‚</li>
<li><code>rollup-plugin-postcss</code>ï¼šå¤„ç† CSSï¼ˆæ”¯æŒ CSS Modulesã€extractï¼‰ã€‚</li>
<li><code>rollup-plugin-url</code>ï¼šæŠŠå°å›¾ç‰‡/å­—ä½“è½¬ base64ï¼Œæˆ–å¤åˆ¶ä¸º assetsã€‚</li>
<li><code>rollup-plugin-visualizer</code>ï¼šç”Ÿæˆ bundle å¯è§†åŒ–æŠ¥å‘Šï¼ˆhelpfulï¼‰ã€‚</li>
<li><code>rollup-plugin-serve</code> / <code>rollup-plugin-livereload</code>ï¼šå¼€å‘æ—¶çš„æœ¬åœ°æœåŠ¡ï¼ˆè½»é‡ï¼‰ã€‚</li>
</ul>
<p>â€‹<strong>è¿™æ ·æ’åºæ›´å¥½ç†è§£</strong>â€‹ï¼šé€šå¸¸ä¸º <code>replace</code> â†’ <code>alias</code> â†’ <code>resolve</code> â†’ <code>commonjs</code> â†’ <code>esbuild/babel/ts</code> â†’ <code>postcss</code> â†’ <code>terser</code>ã€‚</p>
<blockquote>
<p>å°¤å…¶ <code>resolve</code> è¦åœ¨ <code>commonjs</code> ä¹‹å‰ï¼Œ<code>commonjs</code> éœ€è¦è½¬æ¢è§£æåˆ°çš„åŒ…ã€‚</p>
</blockquote>
<h2 data-id="heading-9">Vite å…´èµ·</h2>
<p>Vite æŠŠã€Œå¼€å‘æ—¶â€‹<strong>ä¸æ‰“åŒ…</strong>â€‹ã€ç›´æ¥åˆ©ç”¨æµè§ˆå™¨åŸç”Ÿ ESM + ç”¨ esbuild åšä¾èµ–é¢„å¤„ç†ã€å’Œã€Œç”Ÿäº§æ„å»ºä½¿ç”¨ Rollup åšé«˜è´¨é‡æ‰“åŒ…ã€ç»“åˆèµ·æ¥ï¼Œæ—¢å®ç°äº†æå¿«çš„ <code>dev</code> å¯åŠ¨ä¸ HMRï¼Œåˆä¿ç•™äº† Rollup çš„ç”Ÿäº§æ‰“åŒ…èƒ½åŠ›ä¸æ’ä»¶ç”Ÿæ€ã€‚(<a href="https://link.juejin.cn?target=https%3A%2F%2Fvite.dev%2Fguide%2Fwhy%3Futm_source%3Dchatgpt.com" target="_blank" title="https://vite.dev/guide/why?utm_source=chatgpt.com" ref="nofollow noopener noreferrer">vitejs</a>)</p>
<ol>
<li><strong>å¼€å‘æ¨¡å¼ï¼ˆdev serverï¼‰æ˜¯â€œæŒ‰æ¨¡å—æœåŠ¡â€</strong>
<ol>
<li>Vite åœ¨ dev æ¨¡å¼ä¸‹â€‹**ä¸æŠŠåº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¤§åŒ…ï¼ˆå¯¹æ¯” webpackï¼‰**â€‹ï¼Œè€Œæ˜¯æŠŠæ¯ä¸ªæºç æ–‡ä»¶æŒ‰ ESM æ¨¡å—åŸæ ·é€šè¿‡å¼€å‘æœåŠ¡å™¨ç›´æ¥å‘ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨è´Ÿè´£æ¨¡å—è§£æã€æŒ‰éœ€åŠ è½½ã€‚è¿™æ ·å†·å¯åŠ¨æ— éœ€é¢„æ„å»ºæ•´ä¸ªé¡¹ç›®ï¼Œæå¤§ç¼©çŸ­å¯åŠ¨æ—¶é—´å¹¶ä¿æŒ HMR å¿«é€Ÿã€‚</li>
</ol>
</li>
<li><strong>ä¾èµ–é¢„æ‰“åŒ…ï¼ˆDependency pre-bundlingï¼‰ç”¨ esbuild</strong>
<ol>
<li>ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼ŒVite ä¼šç”¨ <strong>esbuild</strong> å°† <code>node_modules</code> ä¸­çš„ä¾èµ–é¢„æ‰“åŒ…ä¸ºèƒ½è¢«æµè§ˆå™¨é«˜æ•ˆåŠ è½½çš„ ESM æ ¼å¼ï¼ˆæ”¾åˆ° <code>.vite/deps</code> ç›®å½•ï¼‰ï¼Œè§£å†³äº† CommonJSã€åŒ…å†…éƒ¨ä¸èƒ½ç›´æ¥ä»¥åŸå§‹å½¢å¼æŒ‰åŸç”Ÿ ESM åŠ è½½çš„é—®é¢˜ï¼ŒåŒæ—¶æå‡åŠ è½½/è§£æé€Ÿåº¦ã€‚è¯¥æ­¥éª¤åªæ˜¯ dev-only ä¼˜åŒ–ã€‚</li>
</ol>
</li>
<li><strong>HMRï¼ˆHot Module Replacementï¼‰åŸºäºåŸç”Ÿ ESM + websocket</strong>
<ol>
<li>Vite åˆ©ç”¨æµè§ˆå™¨çš„ ESM å•æ¨¡å—çƒ­æ›¿æ¢èƒ½åŠ›ï¼Œåªæ›¿æ¢å®é™…å˜æ›´çš„æ¨¡å—å¹¶å¹¿æ’­æ›´æ–°ï¼Œé¿å…å…¨é¡µåˆ·æ–°ï¼›æ¡†æ¶å±‚ï¼ˆæ¯”å¦‚ React/Vueï¼‰ä¼šå¤„ç†å±€éƒ¨çŠ¶æ€çš„ä¿æŒã€‚Vite æä¾› <code>import.meta.hot</code> API ä¾›æ¡†æ¶æˆ–ç”¨æˆ·æ§åˆ¶ HMR è¡Œä¸ºã€‚</li>
</ol>
</li>
<li><strong>ç”Ÿäº§æ„å»ºä½¿ç”¨ Rollup</strong>
<ol>
<li>ä¸Šé¢è¯´çš„éƒ½æ˜¯å¼€å‘ç¯å¢ƒï¼ŒVite çš„ <code>build</code> é˜¶æ®µä½¿ç”¨ Rollup ä½œä¸ºæ‰“åŒ…å™¨ï¼ˆåˆ©ç”¨ Rollup ç²¾å‡†çš„ tree-shakingã€code-splittingã€å’Œæ’ä»¶èƒ½åŠ›ï¼‰ï¼Œå¹¶ç»“åˆ esbuild åšå¿«é€Ÿçš„è½¬è¯‘/å‹ç¼©é€‰é¡¹ï¼ˆæˆ–é€šè¿‡ terser ç­‰ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vite.dev%2Fconfig%2Fbuild-options%23build-minify%25EF%25BC%2589%25E3%2580%2582" target="_blank" title="https://cn.vite.dev/config/build-options#build-minify%EF%BC%89%E3%80%82" ref="nofollow noopener noreferrer">cn.vite.dev/config/builâ€¦</a></li>
</ol>
</li>
<li><strong>æ’ä»¶ç³»ç»ŸåŸºäº Rollup æ’ä»¶æ¥å£æ‰©å±•</strong>
<ol>
<li>Vite çš„æ’ä»¶æ¥å£æ˜¯ Rollup æ’ä»¶çš„è¶…é›†ï¼Œå¾ˆå¤š Rollup æ’ä»¶å¯ä»¥å¤ç”¨ï¼Œä½†ä¸æ˜¯æ‰€æœ‰ Hook åœ¨ devï¼ˆæ—  bundlingï¼‰åœºæ™¯ä¸‹éƒ½é€‚ç”¨ï¼Œæ‰€ä»¥å­˜åœ¨å…¼å®¹æ€§è€ƒè™‘ï¼ˆæœ‰ <code>enforce: 'pre'|'post'</code> æ¥è°ƒæ•´è°ƒç”¨é¡ºåºï¼Œæ’ä»¶ä½œè€…ä¸€èˆ¬è€ƒè™‘ï¼Œå¤§å¤šæ•°æ— éœ€æˆ‘ä»¬å¼€å‘è€…è€ƒè™‘ï¼‰ã€‚</li>
</ol>
</li>
</ol>
<h3 data-id="heading-10">Vite æ ¸å¿ƒé…ç½®ï¼ˆvite.config.tsï¼‰</h3>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>;
<span class="hljs-keyword">import</span> vueJsx <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue-jsx'</span>;
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AutoImport</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-auto-import/vite'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/vite'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElementPlusResolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/resolvers'</span>;
<span class="hljs-keyword">import</span> viteCompression <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-compression'</span>
<span class="hljs-keyword">import</span> { createSvgIconsPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-svg-icons'</span>;
<span class="hljs-keyword">import</span> viteSvgLoader <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-svg-loader'</span>;
<span class="hljs-keyword">import</span> legacy <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-legacy'</span>;
<span class="hljs-keyword">import</span> { visualizer } <span class="hljs-keyword">from</span> <span class="hljs-string">'rollup-plugin-visualizer'</span>;

<span class="hljs-comment">// å¯ä»¥ä¼ é€’ä¸€ä¸ªå‡½æ•°(éœ€è¦é¢å¤–å‚æ•°çš„æƒ…å†µä¸‹)ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¼ é€’ä¸€ä¸ªå¯¹è±¡</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ command, mode }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> isDev = command === <span class="hljs-string">'serve'</span>;
  <span class="hljs-keyword">const</span> isProd = command === <span class="hljs-string">'build'</span>;

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">root</span>: process.<span class="hljs-title function_">cwd</span>(),
    <span class="hljs-attr">base</span>: <span class="hljs-string">'/'</span>, <span class="hljs-comment">// å‘å¸ƒæ—¶æ ¹æ®éœ€æ±‚æ”¹ä¸º CDN åœ°å€æˆ–ç›¸å¯¹è·¯å¾„</span>
    <span class="hljs-attr">resolve</span>: {
      <span class="hljs-attr">alias</span>: {
        <span class="hljs-string">'@'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
        <span class="hljs-string">'~'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
      },
      <span class="hljs-attr">extensions</span>: [<span class="hljs-string">'.mjs'</span>, <span class="hljs-string">'.js'</span>, <span class="hljs-string">'.ts'</span>, <span class="hljs-string">'.jsx'</span>, <span class="hljs-string">'.tsx'</span>, <span class="hljs-string">'.json'</span>, <span class="hljs-string">'.vue'</span>],
    },

    <span class="hljs-attr">plugins</span>: [ <span class="hljs-comment">// æ§åˆ¶é¢„æ‰“åŒ…å“ªäº›ä¾èµ–ï¼ˆæœ‰é—®é¢˜çš„ CJS åŒ…éœ€è¦æ‰‹åŠ¨ include/excludeï¼‰</span>
      <span class="hljs-comment">// Vue3 SFC æ”¯æŒ</span>
      <span class="hljs-title function_">vue</span>(),

      <span class="hljs-comment">// Vue3 JSX æ”¯æŒ</span>
      <span class="hljs-title function_">vueJsx</span>(),

      <span class="hljs-comment">// SVG æ–‡ä»¶ç›´æ¥å½“ Vue ç»„ä»¶ä½¿ç”¨ï¼ˆé€‚åˆå°å›¾æ ‡ï¼‰</span>
      <span class="hljs-title function_">viteSvgLoader</span>(),

      <span class="hljs-comment">// svg-spriteï¼ˆæŒ‰éœ€åˆå¹¶ svgï¼Œé€‚åˆå›¾æ ‡åº“ï¼‰</span>
      <span class="hljs-title function_">createSvgIconsPlugin</span>({
        <span class="hljs-comment">// åˆ¶å®šéœ€è¦ç¼“å­˜çš„å›¾æ ‡æ–‡ä»¶å¤¹</span>
        <span class="hljs-attr">iconDirs</span>: [path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'src/icons'</span>)],
        <span class="hljs-attr">symbolId</span>: <span class="hljs-string">'icon-[dir]-[name]'</span>,
        <span class="hljs-attr">svgoOptions</span>: isProd, <span class="hljs-comment">// ç”Ÿäº§æ—¶è¿›è¡Œ svgo ä¼˜åŒ–</span>
      }),
      
      <span class="hljs-comment">// å‹ç¼©</span>
      <span class="hljs-title function_">viteCompression</span>({
        <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'gzip'</span>,
        <span class="hljs-attr">ext</span>: <span class="hljs-string">'.gz'</span>,
        <span class="hljs-attr">threshold</span>: <span class="hljs-number">10240</span> <span class="hljs-comment">// 10kB ä»¥ä¸Šæ‰å‹ç¼©</span>
      }),
      <span class="hljs-title function_">viteCompression</span>({
        <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'brotliCompress'</span>,
        <span class="hljs-attr">ext</span>: <span class="hljs-string">'.br'</span>,
        <span class="hljs-attr">threshold</span>: <span class="hljs-number">10240</span>
      })

      <span class="hljs-comment">// è‡ªåŠ¨æŒ‰éœ€å¯¼å…¥ Vue Composition API / Vue Router / Pinia ç­‰</span>
      <span class="hljs-title class_">AutoImport</span>({
        <span class="hljs-attr">imports</span>: [
          <span class="hljs-string">'vue'</span>,
          <span class="hljs-string">'vue-router'</span>,
          <span class="hljs-string">'pinia'</span>,
          {
            <span class="hljs-comment">// ä½ å¯ä»¥åœ¨è¿™é‡Œè‡ªå·±æ·»åŠ åŒ…çš„è‡ªåŠ¨å¯¼å…¥</span>
            <span class="hljs-attr">axios</span>: [
              [<span class="hljs-string">'default'</span>, <span class="hljs-string">'axios'</span>]
            ]
          }
        ],
        <span class="hljs-attr">dts</span>: <span class="hljs-string">'src/auto-imports.d.ts'</span>,
        <span class="hljs-attr">eslintrc</span>: {
          <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ç”Ÿæˆ .eslintrc-auto-import.jsonï¼ˆå¯é€‰ï¼‰</span>
          <span class="hljs-attr">filepath</span>: <span class="hljs-string">'./.eslintrc-auto-import.json'</span>,
          <span class="hljs-attr">globalsPropValue</span>: <span class="hljs-literal">true</span>
        }
      }),

      <span class="hljs-comment">// è‡ªåŠ¨æ³¨å†Œç»„ä»¶ï¼ˆæŒ‰éœ€åŠ è½½ UI ç»„ä»¶åº“ï¼Œä¾‹å¦‚ Element Plusï¼‰</span>
      <span class="hljs-title class_">Components</span>({
        <span class="hljs-attr">dirs</span>: [<span class="hljs-string">'src/components'</span>],
        <span class="hljs-attr">extensions</span>: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'md'</span>],
        <span class="hljs-attr">dts</span>: <span class="hljs-string">'src/components.d.ts'</span>,
        <span class="hljs-attr">resolvers</span>: [
          <span class="hljs-comment">// ä¾‹ï¼šElement Plus è‡ªåŠ¨æŒ‰éœ€å¼•å…¥</span>
          <span class="hljs-title class_">ElementPlusResolver</span>()
        ]
      }),

      <span class="hljs-comment">// legacy æ”¯æŒï¼ˆå¦‚æœéœ€è¦æ”¯æŒæ—§æµè§ˆå™¨ï¼‰</span>
      <span class="hljs-title function_">legacy</span>({
        <span class="hljs-attr">targets</span>: [<span class="hljs-string">'defaults'</span>, <span class="hljs-string">'not IE 11'</span>] <span class="hljs-comment">// æ ¹æ®é¡¹ç›®å…¼å®¹æ€§è°ƒæ•´</span>
      }),

      <span class="hljs-comment">// åœ¨ç”Ÿäº§æ„å»ºæ—¶ç”Ÿæˆ bundle åˆ†ææŠ¥å‘Šï¼ˆå¯é€‰ï¼‰</span>
      isProd &amp;&amp; <span class="hljs-title function_">visualizer</span>({
        <span class="hljs-attr">filename</span>: <span class="hljs-string">'./dist/stats.html'</span>,
        <span class="hljs-attr">open</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">gzipSize</span>: <span class="hljs-literal">true</span>
      })
    ].<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>),

    <span class="hljs-comment">// å¼€å‘æœåŠ¡å™¨é…ç½®</span>
    <span class="hljs-attr">server</span>: {
      <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¤–ç½‘å¯è®¿é—®ï¼ˆå®¹å™¨/VM å¼€å‘æ—¶æœ‰ç”¨ï¼‰</span>
      <span class="hljs-attr">port</span>: <span class="hljs-number">5173</span>,
      <span class="hljs-attr">open</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">strictPort</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">hmr</span>: {
        <span class="hljs-attr">overlay</span>: <span class="hljs-literal">true</span>
      },
      <span class="hljs-attr">proxy</span>: {
        <span class="hljs-comment">// ç¤ºä¾‹ï¼šå¼€å‘ä»£ç†è½¬å‘ /api åˆ°åç«¯</span>
        <span class="hljs-string">'/api'</span>: {
          <span class="hljs-attr">target</span>: <span class="hljs-string">'http://127.0.0.1:7001'</span>,
          <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> p.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">''</span>),
          <span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">ws</span>: <span class="hljs-literal">true</span>
        }
      },
      <span class="hljs-attr">fs</span>: {
        <span class="hljs-comment">// å¦‚æœæ˜¯ monorepoï¼Œéœ€è¦å…è®¸è®¿é—®å·¥ä½œåŒºå¤–çš„æ–‡ä»¶å¤¹</span>
        <span class="hljs-attr">allow</span>: [path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'.'</span>)],
      }
    },

    <span class="hljs-comment">// ä¾èµ–é¢„æ„å»ºï¼Œæ§åˆ¶é¢„æ‰“åŒ…å“ªäº›ä¾èµ–ï¼ˆæœ‰é—®é¢˜çš„ CJS åŒ…éœ€è¦æ‰‹åŠ¨ include/excludeï¼‰</span>
    <span class="hljs-attr">optimizeDeps</span>: {
      <span class="hljs-comment">// ç”Ÿäº§é¢„æ„å»ºä¼šä½¿ç”¨ esbuildï¼ŒæŠŠ node_modules ä¸­çš„åŒ…è½¬ä¸º ESMï¼Œæé«˜ dev æ€§èƒ½</span>
      <span class="hljs-attr">include</span>: [
        <span class="hljs-string">'vue'</span>,
        <span class="hljs-string">'vue-router'</span>,
        <span class="hljs-string">'pinia'</span>,
        <span class="hljs-string">'axios'</span>,
        <span class="hljs-string">'lodash-es'</span>
      ],
      <span class="hljs-comment">// å¦‚æœæŸäº›åŒ…æœ‰é—®é¢˜ï¼Œå¯æ’é™¤ï¼Œå¼ºåˆ¶è®© Rollup åœ¨ build æ—¶å¤„ç†</span>
      <span class="hljs-attr">exclude</span>: [
        <span class="hljs-comment">// 'some-cjs-only-package'</span>
      ],
      <span class="hljs-attr">esbuildOptions</span>: {
        <span class="hljs-comment">// å¦‚æœä½ éœ€è¦æ³¨å…¥ polyfill æˆ– target</span>
        <span class="hljs-attr">target</span>: <span class="hljs-string">'es2018'</span>,
      }
    },

    <span class="hljs-comment">// å…¨å±€å®šä¹‰ã€æ„å»ºé€‰é¡¹</span>
    <span class="hljs-attr">define</span>: {
      <span class="hljs-attr">__APP_VERSION__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">npm_package_version</span>),
      <span class="hljs-string">'process.env'</span>: {}
    },

    <span class="hljs-comment">// CSS ç›¸å…³é…ç½®ï¼ˆé¢„å¤„ç†å™¨ã€æ¨¡å—åŒ–ç­‰ï¼‰</span>
    <span class="hljs-attr">css</span>: {
      <span class="hljs-attr">preprocessorOptions</span>: {
        <span class="hljs-attr">scss</span>: {
          <span class="hljs-attr">additionalData</span>: <span class="hljs-string">`@import "@/styles/variables.scss";`</span>
        }
      },
      <span class="hljs-attr">modules</span>: {
        <span class="hljs-comment">// CSS Modules å‘½åè§„åˆ™</span>
        <span class="hljs-attr">generateScopedName</span>: isProd ? <span class="hljs-string">'[hash:base64:8]'</span> : <span class="hljs-string">'[name]__[local]__[hash:base64:5]'</span>
      },
      <span class="hljs-attr">postcss</span>: {
        <span class="hljs-comment">// å¯é…ç½® autoprefixer / postcss-preset-env ç­‰</span>
      }
    },

    <span class="hljs-comment">// æ„å»ºï¼ˆç”Ÿäº§ï¼‰ç›¸å…³ï¼Œåº•å±‚ä½¿ç”¨ Rollup</span>
    <span class="hljs-attr">build</span>: {
      <span class="hljs-attr">target</span>: <span class="hljs-string">'es2018'</span>,
      <span class="hljs-attr">outDir</span>: <span class="hljs-string">'dist'</span>,
      <span class="hljs-attr">assetsDir</span>: <span class="hljs-string">'assets'</span>,
      <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">minify</span>: <span class="hljs-string">'esbuild'</span>, <span class="hljs-comment">// esbuild(é»˜è®¤å€¼) æ›´å¿«ï¼›å¦‚æœæƒ³å‹ç¼©å¾—æ›´å°å¯æ”¹ä¸º 'terser'</span>
      <span class="hljs-attr">cssCodeSplit</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">rollupOptions</span>: {
        <span class="hljs-comment">// external å¯ç”¨äºåº“æ¨¡å¼ï¼Œåº”ç”¨ä¸€èˆ¬ä¸ç”¨ external</span>
        <span class="hljs-comment">// external: ['vue'],</span>
        <span class="hljs-attr">output</span>: {
          <span class="hljs-comment">// æ‰‹åŠ¨åˆ†åŒ…ï¼šæŠŠ node_modules å…¨éƒ¨ç®—ä½œ vendor</span>
          <span class="hljs-title function_">manualChunks</span>(<span class="hljs-params">id</span>) {
            <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'node_modules'</span>)) {
              <span class="hljs-comment">// å¯ä»¥æŒ‰ lib åæ‹†åˆ† vendorï¼ˆä¾‹å¦‚ element-plus å•ç‹¬ chunkï¼‰</span>
              <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'element-plus'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor_elementplus'</span>;
              <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'vue'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor_vue'</span>;
              <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor'</span>;
            }
          },
          <span class="hljs-attr">entryFileNames</span>: <span class="hljs-string">'assets/js/[name]-[hash].js'</span>,
          <span class="hljs-attr">chunkFileNames</span>: <span class="hljs-string">'assets/js/chunks/[name]-[hash].js'</span>,
          <span class="hljs-attr">assetFileNames</span>: <span class="hljs-function">(<span class="hljs-params">assetInfo</span>) =&gt;</span> {
              <span class="hljs-comment">// å›¾ç‰‡æ–‡ä»¶</span>
              <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/\.(png|jpe?g|svg|gif|tiff|bmp|ico|webp)$/i</span>.<span class="hljs-title function_">test</span>(assetInfo.<span class="hljs-property">names</span>[<span class="hljs-number">0</span>] || <span class="hljs-string">''</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">`assets/images/[name]-[hash][extname]`</span>
              }
    
              <span class="hljs-comment">// å­—ä½“æ–‡ä»¶</span>
              <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/\.(woff2?|eot|ttf|otf)$/i</span>.<span class="hljs-title function_">test</span>(assetInfo.<span class="hljs-property">names</span>[<span class="hljs-number">0</span>] || <span class="hljs-string">''</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">`assets/fonts/[name]-[hash][extname]`</span>
              }
    
              <span class="hljs-comment">// CSS æ–‡ä»¶</span>
              <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/\.css$/i</span>.<span class="hljs-title function_">test</span>(assetInfo.<span class="hljs-property">names</span>[<span class="hljs-number">0</span>] || <span class="hljs-string">''</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">`assets/css/[name]-[hash][extname]`</span>
              }
    
              <span class="hljs-comment">// å…¶ä»–èµ„æºæ–‡ä»¶</span>
              <span class="hljs-keyword">return</span> <span class="hljs-string">`assets/[name]-[hash][extname]`</span>
          },
        }
      },
      <span class="hljs-comment">// ç”Ÿäº§æ„å»ºçš„å¹¶è¡Œåº¦æ§åˆ¶ã€chunk å¤§å°é™åˆ¶ç­‰</span>
      <span class="hljs-attr">brotliSize</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-comment">// chunkSizeWarningLimit: 1500,</span>
    },

    <span class="hljs-comment">// SSR / library ç­‰é«˜çº§æ¨¡å¼å¯ä»¥åœ¨è¿™é‡Œé…ç½®</span>
    <span class="hljs-comment">// ssr: { noExternal: ['some-esm-only-package'] },</span>

    <span class="hljs-comment">// æµ‹è¯•ï¼ˆå¦‚æœä½¿ç”¨ vitestï¼‰</span>
    <span class="hljs-attr">test</span>: {
      <span class="hljs-attr">globals</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">environment</span>: <span class="hljs-string">'jsdom'</span>
    }
  };
});
<span class="hljs-string">``</span><span class="hljs-string">`t resolve from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import json from '@rollup/plugin-json';
import { terser } from 'rollup-plugin-terser';

export default {
  input: 'src/index.js',        // å…¥å£
  external: ['react'],         // ä¸æ‰“åŒ…çš„å¤–éƒ¨ä¾èµ–ï¼ˆåº“é€šå¸¸ä¼šæ ‡è®° peerDependenciesï¼‰
  plugins: [
    resolve(),                 // è§£æ node_modules ä¸­çš„åŒ…
    commonjs(),                // è½¬æ¢ CommonJS -&gt; ESM
    Other plugins: babel/typescript/esbuild/postcss, etc.
terser(),t resolve from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import json from '@rollup/plugin-json';
import { terser } from 'rollup-plugin-terser';

export default {
  input: 'src/index.js',        // å…¥å£
  external: ['react'],         // ä¸æ‰“åŒ…çš„å¤–éƒ¨ä¾èµ–ï¼ˆåº“é€šå¸¸ä¼šæ ‡è®° peerDependenciesï¼‰
  plugins: [
    resolve(),                 // è§£æ node_modules ä¸­çš„åŒ…
    commonjs(),                // è½¬æ¢ CommonJS -&gt; ESM
    Other plugins: babel/typescript/esbuild/postcss, etc.

import commonjs from '@rollup/plugin-commonjs';
import json from '@rollup/plugin-json';
import { terser } from 'rollup-plugin-terser';

export default {
  input: 'src/index.js',        // å…¥å£
  external: ['react'],         // ä¸æ‰“åŒ…çš„å¤–éƒ¨ä¾èµ–ï¼ˆåº“é€šå¸¸ä¼šæ ‡è®° peerDependenciesï¼‰
  plugins: [
    resolve(),                 // è§£æ node_modules ä¸­çš„åŒ…
    commonjs(),                // è½¬æ¢ CommonJS -&gt; ESM
    Other plugins: babel/typescript/esbuild/postcss, etc.
terser(),
</span></code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[github star åŸºç¡€IO æ–‡ä»¶åœ¨å†…æ ¸ä¸­æ˜¯æ€ä¹ˆè¢«ç®¡ç†çš„ é‡å®šå‘çš„å«ä¹‰ åœ¨è‡ªå®šä¹‰shellä¸­åŠ å…¥é‡å®šå‘]]></title>    <link>https://juejin.cn/post/7579213860571054134</link>    <guid>https://juejin.cn/post/7579213860571054134</guid>    <pubDate>2025-12-03T04:02:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579213860571054134" data-draft-id="7579213860570955830" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="github star åŸºç¡€IO æ–‡ä»¶åœ¨å†…æ ¸ä¸­æ˜¯æ€ä¹ˆè¢«ç®¡ç†çš„ é‡å®šå‘çš„å«ä¹‰ åœ¨è‡ªå®šä¹‰shellä¸­åŠ å…¥é‡å®šå‘"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T04:02:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼€æºä¹‹çœ¼"/> <meta itemprop="url" content="https://juejin.cn/user/55438993800919"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            github star åŸºç¡€IO æ–‡ä»¶åœ¨å†…æ ¸ä¸­æ˜¯æ€ä¹ˆè¢«ç®¡ç†çš„ é‡å®šå‘çš„å«ä¹‰ åœ¨è‡ªå®šä¹‰shellä¸­åŠ å…¥é‡å®šå‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/55438993800919/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼€æºä¹‹çœ¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:02:55.000Z" title="Wed Dec 03 2025 04:02:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">æ¬¢è¿è®¿é—®æˆ‘çš„ä¸ªäººgithub é¡¹ç›®ä¸ªäººä¸»é¡µ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAndyBulushen" title="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAndyBulushen" target="_blank">github.com/AndyBulusheâ€¦</a> ï¼Œ é‡Œé¢AI å·¥å…·å…¨å…è´¹ã€‚ç¨‹åºå‘˜çš„ç»ä½³å¥½å¸®æ‰‹</h3>
<h3 data-id="heading-1">Taimili è‰¾ç±³è‰ ( ä¸€æ¬¾ä¸“ä¸šçš„ GitHub star ç®¡ç†å’Œgithub åŠ æ˜Ÿæ¶¨æ˜Ÿå·¥å…·taimili.com )</h3>
<p>è‰¾ç±³è‰ æ˜¯ä¸€æ¬¾ä¼˜é›…ä¾¿æ·çš„Â GitHub star ç®¡ç†å’Œgithub åŠ æ˜Ÿæ¶¨æ˜Ÿå·¥å…·ï¼ŒåŸºäº PHP &amp; javascript æ„å»ºï¼Œ èƒ½å¯¹github å¾— star fork follow watch ç®¡ç†å’Œæå‡ï¼Œæœ€é€‚åˆgithub çš„æ·±åº¦ç”¨æˆ·</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7402a775b7a9426b97c818428b54aaaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5rqQ5LmL55y8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765339375&amp;x-signature=aUQYy6OaC613pAIoGMdZVGLAJXc%3D" alt="123455.png" loading="lazy"/></p>
<p>è¦ç†è§£æ–‡ä»¶é‡å®šå‘ï¼Œé¦–å…ˆéœ€è¦æŒæ¡Â <strong>å†…æ ¸ç®¡ç†æ–‡ä»¶çš„åº•å±‚æ¨¡å‹</strong>ï¼Œé‡å®šå‘çš„æœ¬è´¨æ­£æ˜¯åŸºäºè¿™ä¸ªæ¨¡å‹çš„_fd æŒ‡å‘ä¿®æ”¹_ã€‚ä¸‹é¢åˆ†ä¸‰éƒ¨åˆ†é€æ­¥æ‹†è§£ï¼Œæœ€åç»™å‡ºè‡ªå®šä¹‰ Shell ä¸­é‡å®šå‘çš„å®ç°ä»£ç ã€‚</p>
<h2 data-id="heading-2">ä¸€ã€æ–‡ä»¶åœ¨å†…æ ¸ä¸­çš„ç®¡ç†æ¨¡å‹ï¼ˆæ ¸å¿ƒï¼‰</h2>
<p>å†…æ ¸é€šè¿‡Â <strong>ä¸‰å¤§æ ¸å¿ƒç»“æ„</strong>Â ç®¡ç†æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶ï¼Œç¡®ä¿è¿›ç¨‹ä¸æ–‡ä»¶çš„è§£è€¦å’Œé«˜æ•ˆå¤ç”¨ï¼Œè¿™æ˜¯ IO æ“ä½œå’Œé‡å®šå‘çš„åŸºç¡€ã€‚</p>
<h3 data-id="heading-3">1. ä¸‰å¤§æ ¸å¿ƒç»“æ„</h3>
<h4 data-id="heading-4">ï¼ˆ1ï¼‰è¿›ç¨‹çº§ï¼šæ–‡ä»¶æè¿°ç¬¦è¡¨ï¼ˆfd tableï¼‰</h4>
<ul>
<li>
<p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ã€Œæ–‡ä»¶æè¿°ç¬¦è¡¨ã€ï¼Œæ˜¯è¿›ç¨‹è§†è§’çš„ã€Œæ–‡ä»¶ç´¢å¼•ã€ã€‚</p>
</li>
<li>
<p>è¡¨é¡¹å†…å®¹ï¼šå­˜å‚¨æŒ‡å‘ã€Œæ‰“å¼€æ–‡ä»¶è¡¨ã€çš„æŒ‡é’ˆï¼Œä»¥åŠå°‘é‡è¿›ç¨‹ç§æœ‰æ ‡å¿—ï¼ˆå¦‚ FD_CLOEXECï¼‰ã€‚</p>
</li>
<li>
<p>å…³é”®ç‰¹æ€§ï¼š</p>
<ul>
<li>
<p>æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰æ˜¯è¡¨çš„ç´¢å¼•ï¼Œæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼ˆ<code>0ã€1ã€2ã€3...</code>ï¼‰ã€‚</p>
</li>
<li>
<p>ç³»ç»Ÿé»˜è®¤åˆ†é… 3 ä¸ªæ ‡å‡† fdï¼š</p>
<ul>
<li><code>fd=0</code>ï¼šæ ‡å‡†è¾“å…¥ï¼ˆstdinï¼Œé»˜è®¤æŒ‡å‘ç»ˆç«¯ï¼‰</li>
<li><code>fd=1</code>ï¼šæ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼Œé»˜è®¤æŒ‡å‘ç»ˆç«¯ï¼‰</li>
<li><code>fd=2</code>ï¼šæ ‡å‡†é”™è¯¯ï¼ˆstderrï¼Œé»˜è®¤æŒ‡å‘ç»ˆç«¯ï¼‰</li>
</ul>
</li>
<li>
<p>fd åˆ†é…è§„åˆ™ï¼šä¼˜å…ˆä½¿ç”¨ã€Œæœ€å°çš„æœªä½¿ç”¨ fdã€ã€‚</p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">ï¼ˆ2ï¼‰å†…æ ¸çº§ï¼šæ‰“å¼€æ–‡ä»¶è¡¨ï¼ˆopen file tableï¼‰</h4>
<ul>
<li>
<p>å†…æ ¸ç»´æŠ¤å…¨å±€çš„ã€Œæ‰“å¼€æ–‡ä»¶è¡¨ã€ï¼Œæ¯ä¸ªè¡¨é¡¹å¯¹åº”ä¸€ä¸ªã€Œæ–‡ä»¶æ‰“å¼€å®ä¾‹ã€ï¼ˆå³ä½¿åŒä¸€ä¸ªæ–‡ä»¶è¢«å¤šæ¬¡æ‰“å¼€ï¼Œä¹Ÿä¼šåˆ›å»ºå¤šä¸ªè¡¨é¡¹ï¼‰ã€‚</p>
</li>
<li>
<p>è¡¨é¡¹å†…å®¹ï¼ˆæ ¸å¿ƒï¼‰ï¼š</p>
<ul>
<li>æŒ‡å‘ã€Œinode è¡¨ã€çš„æŒ‡é’ˆï¼ˆå…³è”å®é™…æ–‡ä»¶ï¼‰ï¼›</li>
<li>æ–‡ä»¶åç§»é‡ï¼ˆoffsetï¼Œä¸‹æ¬¡è¯»å†™çš„ä½ç½®ï¼Œå¦‚<code>lseek</code>ä¿®æ”¹çš„å°±æ˜¯è¿™ä¸ªå€¼ï¼‰ï¼›</li>
<li>æ‰“å¼€æ¨¡å¼ï¼ˆflagsï¼Œå¦‚ O_RDONLYã€O_WRONLYã€O_APPENDï¼‰ï¼›</li>
<li>å¼•ç”¨è®¡æ•°ï¼ˆrefcountï¼Œå¤šå°‘ä¸ª fd æŒ‡å‘è¿™ä¸ªè¡¨é¡¹ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6">ï¼ˆ3ï¼‰æ–‡ä»¶ç³»ç»Ÿçº§ï¼šç´¢å¼•èŠ‚ç‚¹è¡¨ï¼ˆinode tableï¼‰</h4>
<ul>
<li>
<p>å­˜å‚¨æ–‡ä»¶çš„ã€Œå…ƒæ•°æ®ã€ï¼ˆä¸æ–‡ä»¶å†…å®¹æ— å…³çš„å±æ€§ï¼‰ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”å”¯ä¸€ inodeï¼ˆå³ä½¿æ–‡ä»¶åè¢«ä¿®æ”¹ï¼Œinode ä¸å˜ï¼‰ã€‚</p>
</li>
<li>
<p>è¡¨é¡¹å†…å®¹ï¼š</p>
<ul>
<li>æ–‡ä»¶ç±»å‹ï¼ˆæ™®é€šæ–‡ä»¶ã€ç›®å½•ã€è®¾å¤‡æ–‡ä»¶ç­‰ï¼‰ï¼›</li>
<li>æƒé™ï¼ˆr/w/xï¼‰ã€æ‰€æœ‰è€…ã€å¤§å°ã€åˆ›å»º / ä¿®æ”¹æ—¶é—´ï¼›</li>
<li>æ•°æ®å—æŒ‡é’ˆï¼ˆæŒ‡å‘ç£ç›˜ä¸Šå­˜å‚¨æ–‡ä»¶å†…å®¹çš„ç‰©ç†å—ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">2. ä¸‰è€…çš„å…³è”å…³ç³»ï¼ˆå…³é”®ç¤ºä¾‹ï¼‰</h3>
<p>å½“è¿›ç¨‹æ‰§è¡ŒÂ <code>open("test.txt", O_RDONLY)</code>Â æ—¶ï¼Œå†…æ ¸çš„æ‰§è¡Œæµç¨‹ï¼š</p>
<ol>
<li>æŸ¥æ‰¾æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰¾åˆ°<code>test.txt</code>å¯¹åº”çš„ã€Œinodeã€ï¼›</li>
<li>å†…æ ¸åˆ›å»ºä¸€ä¸ªã€Œæ‰“å¼€æ–‡ä»¶è¡¨é¡¹ã€ï¼ŒæŒ‡å‘è¯¥ inodeï¼Œè®¾ç½®åç§»é‡ = 0ã€æ¨¡å¼ = O_RDONLYï¼›</li>
<li>åœ¨è¿›ç¨‹çš„ã€Œfd è¡¨ã€ä¸­ï¼Œåˆ†é…ä¸€ä¸ªæœ€å°æœªä½¿ç”¨çš„ fdï¼ˆå¦‚<code>3</code>ï¼‰ï¼Œè®©å…¶æŒ‡å‘æ–°åˆ›å»ºçš„ã€Œæ‰“å¼€æ–‡ä»¶è¡¨é¡¹ã€ï¼›</li>
<li>è¿”å› fd=3 ç»™è¿›ç¨‹ï¼Œè¿›ç¨‹åç»­é€šè¿‡<code>read(3, ...)</code>æ“ä½œæ–‡ä»¶ã€‚</li>
</ol>
<p><strong>æ ¸å¿ƒç»“è®º</strong>ï¼šè¿›ç¨‹æ“ä½œæ–‡ä»¶çš„æœ¬è´¨æ˜¯ã€Œé€šè¿‡ fd ç´¢å¼•ï¼Œé—´æ¥æ“ä½œå†…æ ¸çš„æ‰“å¼€æ–‡ä»¶è¡¨é¡¹å’Œ inodeã€â€”â€” è¿™æ˜¯é‡å®šå‘çš„åº•å±‚åŸºç¡€ã€‚</p>
<h2 data-id="heading-8">äºŒã€é‡å®šå‘çš„å«ä¹‰ä¸åº•å±‚åŸç†</h2>
<h3 data-id="heading-9">1. é‡å®šå‘çš„æœ¬è´¨</h3>
<p><strong>ä¿®æ”¹è¿›ç¨‹ fd è¡¨ä¸­æŸä¸ª fd çš„æŒ‡å‘</strong>ï¼Œè®©åŸæœ¬æŒ‡å‘ç»ˆç«¯ï¼ˆæˆ–å…¶ä»–æ–‡ä»¶ï¼‰çš„ fdï¼Œè½¬è€ŒæŒ‡å‘ç›®æ ‡æ–‡ä»¶ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>ls &gt; result.txt</code>Â çš„æœ¬è´¨æ˜¯ã€ŒæŠŠ fd=1ï¼ˆstdoutï¼‰çš„æŒ‡å‘ï¼Œä»ã€Œç»ˆç«¯çš„æ‰“å¼€æ–‡ä»¶è¡¨é¡¹ã€æ”¹æˆã€Œresult.txt çš„æ‰“å¼€æ–‡ä»¶è¡¨é¡¹ã€ã€ã€‚</p>
<h3 data-id="heading-10">2. å¸¸è§é‡å®šå‘ç¬¦å·åŠå«ä¹‰</h3>



































<table><thead><tr><th>ç¬¦å·</th><th>å«ä¹‰</th><th>åº•å±‚æ“ä½œï¼ˆä¿®æ”¹ fd æŒ‡å‘ï¼‰</th></tr></thead><tbody><tr><td><code>cmd &gt; file</code></td><td>æ ‡å‡†è¾“å‡ºé‡å®šå‘ï¼ˆè¦†ç›–æ–‡ä»¶ï¼‰</td><td>å…³é—­ fd=1 â†’ æ‰“å¼€ file â†’ fd=1 æŒ‡å‘ file</td></tr><tr><td><code>cmd &gt;&gt; file</code></td><td>æ ‡å‡†è¾“å‡ºé‡å®šå‘ï¼ˆè¿½åŠ æ–‡ä»¶ï¼‰</td><td>å…³é—­ fd=1 â†’ æ‰“å¼€ fileï¼ˆO_APPENDï¼‰â†’ fd=1 æŒ‡å‘ file</td></tr><tr><td><code>cmd &lt; file</code></td><td>æ ‡å‡†è¾“å…¥é‡å®šå‘ï¼ˆä»æ–‡ä»¶è¯»ï¼Œè€Œéç»ˆç«¯ï¼‰</td><td>å…³é—­ fd=0 â†’ æ‰“å¼€ file â†’ fd=0 æŒ‡å‘ file</td></tr><tr><td><code>cmd 2&gt; file</code></td><td>æ ‡å‡†é”™è¯¯é‡å®šå‘ï¼ˆè¦†ç›–ï¼‰</td><td>å…³é—­ fd=2 â†’ æ‰“å¼€ file â†’ fd=2 æŒ‡å‘ file</td></tr><tr><td><code>cmd 2&gt;&amp;1</code></td><td>æ ‡å‡†é”™è¯¯åˆå¹¶åˆ°æ ‡å‡†è¾“å‡º</td><td>fd=2 æŒ‡å‘ fd=1 å½“å‰æŒ‡å‘çš„æ‰“å¼€æ–‡ä»¶è¡¨é¡¹</td></tr></tbody></table>
<h3 data-id="heading-11">3. é‡å®šå‘çš„åº•å±‚æ‰§è¡Œæµç¨‹ï¼ˆä»¥<code>ls &gt; result.txt</code>ä¸ºä¾‹ï¼‰</h3>
<ol>
<li>Shell è§£æå‘½ä»¤æ—¶ï¼Œè¯†åˆ«åˆ°<code>&gt;</code>é‡å®šå‘ç¬¦å·ï¼›</li>
<li>Shell åˆ›å»ºå­è¿›ç¨‹ï¼ˆforkï¼‰ï¼Œåœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼ša. è°ƒç”¨<code>open("result.txt", O_WRONLY | O_CREAT | O_TRUNC, 0644)</code>ï¼šæ‰“å¼€ï¼ˆæˆ–åˆ›å»ºï¼‰æ–‡ä»¶ï¼Œå¾—åˆ° fd=3ï¼ˆå‡è®¾ï¼‰ï¼›b. è°ƒç”¨<code>dup2(3, 1)</code>ï¼šå°† fd=3 çš„æŒ‡å‘ã€Œå¤åˆ¶ã€ç»™ fd=1ï¼Œæ­¤æ—¶ fd=1 ä¸å†æŒ‡å‘ç»ˆç«¯ï¼Œè½¬è€ŒæŒ‡å‘ result.txtï¼›c. è°ƒç”¨<code>close(3)</code>ï¼šå…³é—­ fd=3ï¼ˆå·²é€šè¿‡ dup2 å®Œæˆé‡å®šå‘ï¼Œfd=3 æ— ç”¨ï¼‰ï¼›d. è°ƒç”¨<code>execvp("ls", ["ls", NULL])</code>ï¼šæ‰§è¡Œ ls å‘½ä»¤ï¼Œls çš„ stdoutï¼ˆfd=1ï¼‰è¾“å‡ºä¼šå†™å…¥ result.txtã€‚</li>
</ol>
<h2 data-id="heading-12">ä¸‰ã€è‡ªå®šä¹‰ Shell ä¸­å®ç°é‡å®šå‘ï¼ˆC è¯­è¨€ç¤ºä¾‹ï¼‰</h2>
<p>è‡ªå®šä¹‰ Shell çš„æ ¸å¿ƒæµç¨‹æ˜¯ã€Œè¯»å‘½ä»¤â†’è§£æå‘½ä»¤â†’æ‰§è¡Œå‘½ä»¤ã€ï¼Œé‡å®šå‘çš„å®ç°éœ€è¦åœ¨ã€Œè§£æã€å’Œã€Œæ‰§è¡Œã€é˜¶æ®µæ·»åŠ é€»è¾‘ã€‚</p>
<h3 data-id="heading-13">1. å…³é”®ç³»ç»Ÿè°ƒç”¨</h3>
<ul>
<li><code>open()</code>ï¼šæ‰“å¼€ / åˆ›å»ºç›®æ ‡æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶æè¿°ç¬¦ï¼›</li>
<li><code>dup2(oldfd, newfd)</code>ï¼šå°† oldfd çš„æŒ‡å‘å¤åˆ¶ç»™ newfdï¼ˆæ ¸å¿ƒé‡å®šå‘å‡½æ•°ï¼‰ï¼›</li>
<li><code>close()</code>ï¼šå…³é—­æ— ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼›</li>
<li><code>fork()</code>ï¼šåˆ›å»ºå­è¿›ç¨‹ï¼ˆé‡å®šå‘å¿…é¡»åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œé¿å…å½±å“çˆ¶ Shellï¼‰ï¼›</li>
<li><code>execvp()</code>ï¼šæ‰§è¡Œç›®æ ‡å‘½ä»¤ï¼ˆæ›¿æ¢å­è¿›ç¨‹æ˜ åƒï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-14">2. å®Œæ•´å®ç°ä»£ç ï¼ˆæ”¯æŒ<code>&gt;ã€&gt;&gt;ã€&lt;</code>é‡å®šå‘ï¼‰</h3>
<p>c</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_CMD_LEN 1024</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_ARG_LEN 64</span>

<span class="hljs-comment">// è§£æå‘½ä»¤è¡Œï¼šåˆ†ç¦»å‘½ä»¤å‚æ•°ã€é‡å®šå‘ç¬¦å·å’Œç›®æ ‡æ–‡ä»¶</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">parse_cmd</span><span class="hljs-params">(<span class="hljs-type">char</span> *cmd, <span class="hljs-type">char</span> **args, <span class="hljs-type">char</span> **infile, <span class="hljs-type">char</span> **outfile, <span class="hljs-type">int</span> *append)</span> {
    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;
    *infile = <span class="hljs-literal">NULL</span>;  <span class="hljs-comment">// è¾“å…¥é‡å®šå‘æ–‡ä»¶</span>
    *outfile = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// è¾“å‡ºé‡å®šå‘æ–‡ä»¶</span>
    *append = <span class="hljs-number">0</span>;     <span class="hljs-comment">// æ˜¯å¦è¿½åŠ ï¼ˆ&gt;&gt;ï¼‰</span>

    <span class="hljs-comment">// åˆ†å‰²å‘½ä»¤è¡Œï¼ˆæŒ‰ç©ºæ ¼åˆ†å‰²ï¼‰</span>
    <span class="hljs-type">char</span> *token = strtok(cmd, <span class="hljs-string">" "</span>);
    <span class="hljs-keyword">while</span> (token != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(token, <span class="hljs-string">"&lt;"</span>) == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// è¾“å…¥é‡å®šå‘ï¼šä¸‹ä¸€ä¸ªtokenæ˜¯è¾“å…¥æ–‡ä»¶</span>
            *infile = strtok(<span class="hljs-literal">NULL</span>, <span class="hljs-string">" "</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(token, <span class="hljs-string">"&gt;"</span>) == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// è¾“å‡ºé‡å®šå‘ï¼ˆè¦†ç›–ï¼‰ï¼šä¸‹ä¸€ä¸ªtokenæ˜¯è¾“å‡ºæ–‡ä»¶</span>
            *outfile = strtok(<span class="hljs-literal">NULL</span>, <span class="hljs-string">" "</span>);
            *append = <span class="hljs-number">0</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(token, <span class="hljs-string">"&gt;&gt;"</span>) == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// è¾“å‡ºé‡å®šå‘ï¼ˆè¿½åŠ ï¼‰ï¼šä¸‹ä¸€ä¸ªtokenæ˜¯è¾“å‡ºæ–‡ä»¶</span>
            *outfile = strtok(<span class="hljs-literal">NULL</span>, <span class="hljs-string">" "</span>);
            *append = <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// æ™®é€šå‘½ä»¤å‚æ•°</span>
            args[i++] = token;
        }
        token = strtok(<span class="hljs-literal">NULL</span>, <span class="hljs-string">" "</span>);
    }
    args[i] = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// execvpè¦æ±‚å‚æ•°åˆ—è¡¨ä»¥NULLç»“å°¾</span>
}

<span class="hljs-comment">// æ‰§è¡Œå‘½ä»¤ï¼ˆåŒ…å«é‡å®šå‘é€»è¾‘ï¼‰</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">execute_cmd</span><span class="hljs-params">(<span class="hljs-type">char</span> **args, <span class="hljs-type">char</span> *infile, <span class="hljs-type">char</span> *outfile, <span class="hljs-type">int</span> append)</span> {
    <span class="hljs-type">pid_t</span> pid = fork();
    <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">-1</span>) {
        perror(<span class="hljs-string">"fork error"</span>);
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
    }

    <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) { <span class="hljs-comment">// å­è¿›ç¨‹ï¼šæ‰§è¡Œé‡å®šå‘å’Œå‘½ä»¤</span>
        <span class="hljs-comment">// 1. å¤„ç†è¾“å…¥é‡å®šå‘ï¼ˆ&lt;ï¼‰</span>
        <span class="hljs-keyword">if</span> (infile != <span class="hljs-literal">NULL</span>) {
            <span class="hljs-type">int</span> fd = open(infile, O_RDONLY);
            <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>) {
                perror(<span class="hljs-string">"open infile error"</span>);
                <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
            }
            <span class="hljs-comment">// å°†fdå¤åˆ¶ç»™fd=0ï¼ˆstdinï¼‰ï¼Œå…³é—­åŸfd</span>
            <span class="hljs-keyword">if</span> (dup2(fd, STDIN_FILENO) == <span class="hljs-number">-1</span>) {
                perror(<span class="hljs-string">"dup2 infile error"</span>);
                <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
            }
            close(fd);
        }

        <span class="hljs-comment">// 2. å¤„ç†è¾“å‡ºé‡å®šå‘ï¼ˆ&gt; æˆ– &gt;&gt;ï¼‰</span>
        <span class="hljs-keyword">if</span> (outfile != <span class="hljs-literal">NULL</span>) {
            <span class="hljs-type">int</span> flags = O_WRONLY | O_CREAT;
            flags |= append ? O_APPEND : O_TRUNC; <span class="hljs-comment">// è¿½åŠ /è¦†ç›–</span>
            <span class="hljs-type">int</span> fd = open(outfile, flags, <span class="hljs-number">0644</span>); <span class="hljs-comment">// æƒé™ï¼šrw-r--r--</span>
            <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>) {
                perror(<span class="hljs-string">"open outfile error"</span>);
                <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
            }
            <span class="hljs-comment">// å°†fdå¤åˆ¶ç»™fd=1ï¼ˆstdoutï¼‰ï¼Œå…³é—­åŸfd</span>
            <span class="hljs-keyword">if</span> (dup2(fd, STDOUT_FILENO) == <span class="hljs-number">-1</span>) {
                perror(<span class="hljs-string">"dup2 outfile error"</span>);
                <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
            }
            close(fd);
        }

        <span class="hljs-comment">// 3. æ‰§è¡Œç›®æ ‡å‘½ä»¤ï¼ˆæ›¿æ¢å­è¿›ç¨‹æ˜ åƒï¼‰</span>
        execvp(args[<span class="hljs-number">0</span>], args);
        perror(<span class="hljs-string">"execvp error"</span>); <span class="hljs-comment">// è‹¥execvpè¿”å›ï¼Œè¯´æ˜æ‰§è¡Œå¤±è´¥</span>
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
    } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// çˆ¶è¿›ç¨‹ï¼šç­‰å¾…å­è¿›ç¨‹ç»“æŸ</span>
        waitpid(pid, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>);
    }
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">char</span> cmd[MAX_CMD_LEN];
    <span class="hljs-type">char</span> *args[MAX_ARG_LEN];
    <span class="hljs-type">char</span> *infile, *outfile;
    <span class="hljs-type">int</span> append;

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"=== Custom Shell (support &gt; &gt;&gt; &lt;) ===\n"</span>);
    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"shell&gt; "</span>);
        <span class="hljs-comment">// è¯»å–å‘½ä»¤è¡Œï¼ˆå¿½ç•¥ç©ºè¾“å…¥ï¼‰</span>
        <span class="hljs-keyword">if</span> (fgets(cmd, MAX_CMD_LEN, <span class="hljs-built_in">stdin</span>) == <span class="hljs-literal">NULL</span>) {
            <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-comment">// å»é™¤æ¢è¡Œç¬¦ï¼ˆfgetsä¼šè¯»å–æ¢è¡Œï¼‰</span>
        cmd[<span class="hljs-built_in">strcspn</span>(cmd, <span class="hljs-string">"\n"</span>)] = <span class="hljs-string">'\0'</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(cmd, <span class="hljs-string">"exit"</span>) == <span class="hljs-number">0</span>) { <span class="hljs-comment">// é€€å‡ºå‘½ä»¤</span>
            <span class="hljs-keyword">break</span>;
        }

        <span class="hljs-comment">// è§£æå‘½ä»¤</span>
        parse_cmd(cmd, args, &amp;infile, &amp;outfile, &amp;append);
        <span class="hljs-comment">// æ‰§è¡Œå‘½ä»¤ï¼ˆå«é‡å®šå‘ï¼‰</span>
        execute_cmd(args, infile, outfile, append);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-15">3. ä»£ç è¯´æ˜ä¸æµ‹è¯•</h3>
<h4 data-id="heading-16">ï¼ˆ1ï¼‰æ ¸å¿ƒé€»è¾‘</h4>
<ul>
<li><strong>è§£æé˜¶æ®µ</strong>ï¼š<code>parse_cmd</code>Â å‡½æ•°åˆ†ç¦»å‘½ä»¤å‚æ•°ã€é‡å®šå‘ç¬¦å·å’Œç›®æ ‡æ–‡ä»¶ï¼ˆå¦‚<code>ls &gt;&gt; log.txt</code>Â è§£æä¸º args=[ls], outfile=log.txt, append=1ï¼‰ï¼›</li>
<li><strong>æ‰§è¡Œé˜¶æ®µ</strong>ï¼šå­è¿›ç¨‹ä¸­å…ˆå¤„ç†é‡å®šå‘ï¼ˆä¿®æ”¹ fd=0/1 çš„æŒ‡å‘ï¼‰ï¼Œå†æ‰§è¡Œ<code>execvp</code>ï¼ˆå‘½ä»¤æ‰§è¡Œæ—¶ä¼šä½¿ç”¨ä¿®æ”¹åçš„ fdï¼‰ï¼›</li>
<li><strong>çˆ¶è¿›ç¨‹</strong>ï¼šä»…ç­‰å¾…å­è¿›ç¨‹ï¼Œä¸å‚ä¸é‡å®šå‘ï¼ˆé¿å…å½±å“ Shell è‡ªèº«çš„ fd æŒ‡å‘ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-17">ï¼ˆ2ï¼‰ç¼–è¯‘ä¸æµ‹è¯•</h4>
<p>bash</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">ç¼–è¯‘</span>
gcc shell_redirect.c -o myshell
<span class="hljs-meta prompt_"># </span><span class="bash">è¿è¡Œè‡ªå®šä¹‰Shell</span>
./myshell
<span class="hljs-meta prompt_">
# </span><span class="bash">æµ‹è¯•ç”¨ä¾‹</span>
<span class="hljs-meta prompt_">shell&gt; </span><span class="bash"><span class="hljs-built_in">ls</span> &gt; result.txt  <span class="hljs-comment"># æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°result.txtï¼ˆè¦†ç›–ï¼‰</span></span>
<span class="hljs-meta prompt_">shell&gt; </span><span class="bash"><span class="hljs-built_in">cat</span> result.txt    <span class="hljs-comment"># æŸ¥çœ‹ç»“æœ</span></span>
<span class="hljs-meta prompt_">shell&gt; </span><span class="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">"hello"</span> &gt;&gt; result.txt  <span class="hljs-comment"># è¿½åŠ åˆ°result.txt</span></span>
<span class="hljs-meta prompt_">shell&gt; </span><span class="bash"><span class="hljs-built_in">cat</span> &lt; result.txt  <span class="hljs-comment"># æ ‡å‡†è¾“å…¥é‡å®šå‘ï¼ˆä»result.txtè¯»ï¼‰</span></span>
<span class="hljs-meta prompt_">shell&gt; </span><span class="bash"><span class="hljs-built_in">exit</span></span>
</code></pre>
<h3 data-id="heading-18">4. æ‰©å±•ï¼šæ”¯æŒ<code>2&gt;ã€2&gt;&amp;1</code>ï¼ˆæ ‡å‡†é”™è¯¯é‡å®šå‘ï¼‰</h3>
<p>åªéœ€åœ¨<code>parse_cmd</code>ä¸­æ·»åŠ å¯¹<code>2&gt;</code>å’Œ<code>2&gt;&amp;1</code>çš„è§£æï¼Œåœ¨<code>execute_cmd</code>ä¸­å¤„ç† fd=2ï¼ˆstderrï¼‰ï¼š</p>
<p>c</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// è§£æé˜¶æ®µæ·»åŠ ï¼š</span>
else if (strcmp(token, "<span class="hljs-number">2</span>&gt;") == <span class="hljs-number">0</span>) {
    *errfile = <span class="hljs-built_in">strtok</span>(NULL, " "); <span class="hljs-comment">// æ–°å¢errfileå˜é‡</span>
} else if (strcmp(token, "<span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>") == <span class="hljs-number">0</span>) {
    *err_to_out = <span class="hljs-number">1</span>; <span class="hljs-comment">// æ–°å¢err_to_outæ ‡å¿—ï¼ˆstderråˆå¹¶åˆ°stdoutï¼‰</span>
}

<span class="hljs-comment">// æ‰§è¡Œé˜¶æ®µæ·»åŠ ï¼š</span>
if (errfile != NULL) {
    int fd = <span class="hljs-built_in">open</span>(errfile, O_WRONLY | O_CREAT | O_TRUNC, <span class="hljs-number">0644</span>);
    <span class="hljs-built_in">dup2</span>(fd, STDERR_FILENO); <span class="hljs-comment">// fd=2æŒ‡å‘errfile</span>
    <span class="hljs-built_in">close</span>(fd);
} else if (err_to_out) {
    <span class="hljs-built_in">dup2</span>(STDOUT_FILENO, STDERR_FILENO); <span class="hljs-comment">// fd=2æŒ‡å‘fd=1çš„ç›®æ ‡</span>
}
</code></pre>
<h2 data-id="heading-19">æ€»ç»“</h2>
<ol>
<li><strong>å†…æ ¸æ–‡ä»¶ç®¡ç†</strong>ï¼šé€šè¿‡ã€Œfd è¡¨â†’æ‰“å¼€æ–‡ä»¶è¡¨â†’inode è¡¨ã€çš„ä¸‰å±‚æ¨¡å‹ï¼Œå®ç°è¿›ç¨‹ä¸æ–‡ä»¶çš„è§£è€¦ï¼›</li>
<li><strong>é‡å®šå‘æœ¬è´¨</strong>ï¼šä¿®æ”¹ fdï¼ˆ0/1/2ï¼‰çš„æŒ‡å‘ï¼Œè®© IO æ“ä½œçš„ç›®æ ‡ä»ç»ˆç«¯å˜ä¸ºæ–‡ä»¶ï¼›</li>
<li><strong>Shell å®ç°é‡å®šå‘</strong>ï¼šå­è¿›ç¨‹ä¸­é€šè¿‡<code>open+dup2+close</code>ä¿®æ”¹ fd æŒ‡å‘ï¼Œå†æ‰§è¡Œå‘½ä»¤ï¼Œä¸å½±å“çˆ¶ Shellã€‚</li>
</ol>
<p>æŒæ¡è¿™ä¸ªé€»è¾‘åï¼Œä¸ä»…èƒ½ç†è§£é‡å®šå‘ï¼Œè¿˜èƒ½å»¶ä¼¸åˆ°ç®¡é“ï¼ˆ<code>|</code>ï¼‰ã€åå°è¿è¡Œç­‰ Shell æ ¸å¿ƒåŠŸèƒ½çš„å®ç°åŸç†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PromiseResolveThenableJobTask çš„åœ¨Promiseä¸­çš„ä½¿ç”¨]]></title>    <link>https://juejin.cn/post/7579229538791358470</link>    <guid>https://juejin.cn/post/7579229538791358470</guid>    <pubDate>2025-12-03T05:10:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579229538791358470" data-draft-id="7579256547797844009" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PromiseResolveThenableJobTask çš„åœ¨Promiseä¸­çš„ä½¿ç”¨"/> <meta itemprop="keywords" content="Promise,JavaScript"/> <meta itemprop="datePublished" content="2025-12-03T05:10:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¹‹æ’å›"/> <meta itemprop="url" content="https://juejin.cn/user/2261046026312318"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PromiseResolveThenableJobTask çš„åœ¨Promiseä¸­çš„ä½¿ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2261046026312318/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¹‹æ’å›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:10:18.000Z" title="Wed Dec 03 2025 05:10:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é—®é¢˜ï¼š</h2>
<p>æœ€è¿‘çœ‹åˆ°ä¸€ä¸ªæœ‰æ„æ€çš„é¢è¯•é¢˜ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">4</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
  });

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">5</span>);
  });
</code></pre>
<h2 data-id="heading-1">ç»“è®ºï¼š</h2>
<p>æœ€ç»ˆ console è¾“å‡ºé¡ºåºï¼š 0, 1, 2, 3, 4, 5</p>
<h2 data-id="heading-2">åŸå› è§£é‡Š</h2>
<p><strong>é‡ç‚¹</strong>ï¼šPromiseçš„å¤„ç† ä¸ å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼š</p>
<p><strong>è§£ææ­¥éª¤æ‹†è§£ï¼š</strong></p>
<ol>
<li>è„šæœ¬åŒæ­¥é˜¶æ®µï¼š</li>
</ol>
<ul>
<li>ä¸¤ä¸ª Promise.resolve() éƒ½æ˜¯å·²è§£å†³çš„ï¼ŒåŒæ­¥åœ°æ³¨å†Œå„è‡ªçš„ç¬¬ä¸€ä¸ª .then çš„ reactionã€‚å®ƒä»¬ä¼šåˆ†åˆ«åˆ›å»ºâ€œè¿”å›çš„ promiseâ€ï¼ˆè®°ä¸º A_returnã€B_returnï¼‰ï¼Œå¹¶æŠŠå¯¹åº”çš„ <code>PromiseFulfillReactionJobTask</code>ï¼ˆæ‰§è¡Œç¬¬ä¸€ä¸ª then çš„å›è°ƒï¼‰æŒ‰æ³¨å†Œé¡ºåºæ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚
<ul>
<li>åˆå§‹ <em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼ˆFIFOï¼‰ï¼š <strong>[A (ç¬¬ä¸€ä¸ªé“¾çš„ç¬¬1ä¸ª then å›è°ƒ), B (ç¬¬äºŒä¸ªé“¾çš„ç¬¬1ä¸ª then å›è°ƒ)]</strong></li>
</ul>
</li>
</ul>
<ol start="2">
<li>
<p>æ‰§è¡Œå¾®ä»»åŠ¡ï¼ˆæŒ‰é˜Ÿåˆ—ï¼‰ï¼š</p>
<ol>
<li>
<p>è¿è¡Œ Aï¼š</p>
<ul>
<li>æ‰§è¡Œå›è°ƒï¼Œæ‰“å° <strong>0</strong>ã€‚</li>
<li>å›è°ƒè¿”å› <code>Promise.resolve(4)</code> â€”&gt; ä¸€ä¸ª <code>thenableï¼ˆJSPromiseï¼‰</code>ã€‚</li>
<li>ä¸ºæŠŠ A_return ä¸è¯¥ <code>thenable</code> å…³è”ï¼ŒV8 åˆ›å»ºå¹¶å…¥é˜Ÿä¸€ä¸ª <code>PromiseResolveThenableJobTask</code>ï¼ˆè§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromium.googlesource.com%2Fv8%2Fv8.git%2F%2B%2Frefs%2Fheads%2F9.0-lkgr%2Fsrc%2Fobjects%2Fpromise.tq" target="_blank" title="https://chromium.googlesource.com/v8/v8.git/+/refs/heads/9.0-lkgr/src/objects/promise.tq" ref="nofollow noopener noreferrer">src/objects/promise.tq</a>ï¼š<code>PromiseResolveThenableJobTask</code> æ˜¯ Microtaskï¼Œæºå¸¦ <code>promise_to_resolve</code>ã€<code>thenable</code>ã€<code>then</code> ç­‰å­—æ®µï¼‰ï¼Œç”¨äºåœ¨ç¨åè°ƒç”¨ <code>thenable.then(resolve, reject)</code>ã€‚</li>
<li>æ­¤æ—¶ï¼Œ<em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼š <strong>[B, PRJ]ï¼ˆPRJ = PromiseResolveThenableJobTaskï¼‰</strong></li>
</ul>
</li>
<li>
<p>è¿è¡Œ Bï¼š</p>
</li>
</ol>
<ul>
<li>æ‰“å° <strong>1</strong>ï¼Œè¿”å› <code>undefined</code>ï¼Œå¯¼è‡´ B_return è¢« fulfill å¹¶æŠŠ B_return.then(...)ï¼ˆå³åç»­çš„ handler2ï¼‰å¯¹åº”çš„ reaction å…¥é˜Ÿã€‚
<ul>
<li>æ­¤æ—¶ï¼Œ<em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼š<strong>[PRJ, B2]</strong></li>
</ul>
</li>
</ul>
<ol start="3">
<li>è¿è¡Œ PRJï¼ˆ<code>PromiseResolveThenableJobTask</code>ï¼‰ï¼š</li>
</ol>
<ul>
<li>
<p>å®ƒä¼šæ‰§è¡Œ <code>thenable.then(resolve, reject)</code>ã€‚å› ä¸º <code>thenable</code> æ˜¯å·²è§£å†³çš„ <code>Promise.resolve(4)</code>ï¼Œè°ƒç”¨ then ä¼šæŠŠä¸€ä¸ªå°†è°ƒç”¨ <code>resolve(4)</code> çš„ reaction å…¥é˜Ÿï¼ˆè®°ä¸º TJï¼‰ã€‚</p>
</li>
<li>
<p><strong>PRJ æœ¬èº«ä¸ç›´æ¥è°ƒç”¨ resolve(4)ï¼Œåªæ‰§è¡Œ then çš„è°ƒç”¨æ¥æŠŠ thenable çš„ reaction å®‰æ’ä¸ºå¾®ä»»åŠ¡ã€‚</strong></p>
</li>
<li>
<p>æ­¤æ—¶ï¼Œ<em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼š<strong>[B2, TJ]</strong></p>
</li>
</ul>
<ol start="4">
<li>è¿è¡Œ B2ï¼ˆç¬¬äºŒé“¾çš„ç¬¬äºŒä¸ª thenï¼‰ï¼š</li>
</ol>
<ul>
<li>
<p>æ‰“å° <strong>2</strong>ï¼Œè¿”å› <code>undefined</code>ï¼Œæ³¨å†Œå¹¶å…¥é˜Ÿ B3ï¼ˆä¸‹ä¸€ then çš„ reactionï¼‰ã€‚</p>
</li>
<li>
<p>æ­¤æ—¶ï¼Œ<em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼š<strong>[TJ, B3]</strong></p>
</li>
</ul>
<ol start="5">
<li>è¿è¡Œ TJï¼ˆthenable çš„ååº”ï¼Œæ‰§è¡Œ resolve(4)ï¼‰ï¼š</li>
</ol>
<ul>
<li>
<p>resolve(4) æ»¡è¶³äº† A_returnï¼ŒæŠŠ A_return çš„åç»­ reactionï¼ˆå³ A çš„ç¬¬äºŒä¸ª thenï¼Œä¹Ÿå°±æ˜¯æ‰“å° res çš„å›è°ƒ A2ï¼‰å…¥é˜Ÿã€‚</p>
</li>
<li>
<p>æ­¤æ—¶ï¼Œ<em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼š<strong>[B3, A2]</strong></p>
</li>
</ul>
<ol start="6">
<li>
<p>è¿è¡Œ B3ï¼š</p>
</li>
</ol>
<ul>
<li>
<p>æ‰“å° <strong>3</strong>ï¼Œå…¥é˜Ÿ B4ï¼ˆæœ€åä¸€ä¸ª then çš„ reactionï¼‰ã€‚</p>
</li>
<li>
<p>æ­¤æ—¶ï¼Œ<em>å¾®ä»»åŠ¡é˜Ÿåˆ—</em>ï¼š<strong>[A2, B4]</strong></p>
</li>
</ul>
<ol start="7">
<li>è¿è¡Œ A2ï¼šæ‰“å° <strong>4</strong></li>
<li>è¿è¡Œ B4ï¼šæ‰“å° <strong>5</strong></li>
</ol>
</li>
</ol>
<h2 data-id="heading-3">è¦ç‚¹æ€»ç»“ï¼š</h2>
<ul>
<li>å½“ <code>then</code> å›è°ƒè¿”å›ä¸€ä¸ª <code>thenable</code>ï¼ˆè¿™é‡Œæ˜¯ <code>Promise.resolve(4)</code>ï¼‰æ—¶ï¼Œè§„èŒƒè¦æ±‚é€šè¿‡ä¸€ä¸ª <code>PromiseResolveThenableJobï¼ˆå¾®ä»»åŠ¡ï¼‰</code>å»â€œå–å¾— then å¹¶è°ƒç”¨å®ƒâ€ï¼Œå› æ­¤ä¼šç”Ÿæˆä¸€ä¸ªä¸“é—¨çš„å¾®ä»»åŠ¡ï¼ˆPRJï¼‰æ¥è°ƒç”¨ thenã€‚è¯¥ PRJ ä¼šæ’åœ¨å½“æ—¶é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚</li>
<li><code>thenable.then(resolve, reject)</code> æœ¬èº«å†äº§ç”Ÿä¸€ä¸ªå¾®ä»»åŠ¡ï¼ˆTJï¼‰æ¥çœŸæ­£è°ƒç”¨ <code>resolve(4)</code>ã€‚å› æ­¤ A_return çš„ fulfillï¼ˆA2ï¼‰è¦ç­‰åˆ° TJ æ‰§è¡Œåæ‰ä¼šè¢«å…¥é˜Ÿå¹¶æœ€ç»ˆè¿è¡Œã€‚</li>
<li>å› ä¸ºå¤šä¸ªå¾®ä»»åŠ¡åœ¨è¿è¡ŒæœŸé—´ä¼šç»§ç»­å…¥é˜Ÿï¼ˆå¹¶ä¿æŒ FIFOï¼‰ï¼Œæ‰€ä»¥ç¬¬äºŒæ¡ promise é“¾çš„ä¸­é—´ thenï¼ˆæ‰“å° 2ã€3ï¼‰ä¼šåœ¨ A_return çš„æœ€ç»ˆ reactionï¼ˆæ‰“å° 4ï¼‰ä¹‹å‰è¢«è°ƒåº¦å¹¶æ‰“å°ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[zustand ä»åŸç†åˆ°å®è·µ - åŸç†ç¯‡(2)]]></title>    <link>https://juejin.cn/post/7579167622106218496</link>    <guid>https://juejin.cn/post/7579167622106218496</guid>    <pubDate>2025-12-03T03:34:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579167622106218496" data-draft-id="7579168400988667939" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="zustand ä»åŸç†åˆ°å®è·µ - åŸç†ç¯‡(2)"/> <meta itemprop="keywords" content="å‰ç«¯,React.js"/> <meta itemprop="datePublished" content="2025-12-03T03:34:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é²¨å”"/> <meta itemprop="url" content="https://juejin.cn/user/413072101215944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            zustand ä»åŸç†åˆ°å®è·µ - åŸç†ç¯‡(2)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/413072101215944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é²¨å”
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:34:56.000Z" title="Wed Dec 03 2025 03:34:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»18åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å®ç°åŸç†</h3>
<p>åœ¨ä¸Šç¯‡<a href="https://juejin.cn/post/7579165599042273295" target="_blank" title="https://juejin.cn/post/7579165599042273295">ã€Šzustand ä»åŸç†åˆ°å®è·µ - åŸç†ç¯‡(1)ã€‹</a>ä¸­ï¼Œæˆ‘çš„é˜è¿°è¿˜æ˜¯æ¯”è¾ƒç¬¼ç»Ÿçš„ï¼Œä¸‹é¢è¿›è¡Œæ›´åŠ ç»†è‡´å’Œå…·ä½“çš„åŸç†å‰–æã€‚</p>
<h4 data-id="heading-1">vanilla å±‚</h4>
<p>vanilla å±‚æ˜¯ zustand çš„æ ¸å¿ƒä»£ç ï¼Œå®ƒä¸ä¾èµ–ä»»ä½•çš„è§†å›¾å±‚æ¡†æ¶ã€‚vanilla å±‚çš„ä»£ç ä¸»è¦åŒ…æ‹¬äº† store å®ä¾‹çš„åˆ›å»ºã€çŠ¶æ€æ›´æ–°ã€è®¢é˜…è€…ç®¡ç†ç­‰åŠŸèƒ½ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå°±å®ç°äº†ä¸€ä¸ªæ ¸å¿ƒ APIï¼š<code>createStore</code>ã€‚æˆ‘ä»¬æ‹¨å¼€è¿·é›¾çœ‹çœŸç« ã€‚ç›´æ¥çœ‹ zustand åœ¨è¿è¡Œæ—¶çš„ js æºç ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-meta">'use strict'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">createStoreImpl</span> = (<span class="hljs-params">createState</span>) =&gt; {
  <span class="hljs-keyword">let</span> state
  <span class="hljs-keyword">const</span> listeners = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setState</span> = (<span class="hljs-params">partial, replace</span>) =&gt; {
    <span class="hljs-keyword">const</span> nextState = <span class="hljs-keyword">typeof</span> partial === <span class="hljs-string">'function'</span> ? <span class="hljs-title function_">partial</span>(state) : partial
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(nextState, state)) {
      <span class="hljs-keyword">const</span> previousState = state
      state = (
        replace != <span class="hljs-literal">null</span>
          ? replace
          : <span class="hljs-keyword">typeof</span> nextState !== <span class="hljs-string">'object'</span> || nextState === <span class="hljs-literal">null</span>
      )
        ? nextState
        : <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, state, nextState)
      listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">listener</span>) =&gt;</span> <span class="hljs-title function_">listener</span>(state, previousState))
    }
  }
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getState</span> = (<span class="hljs-params"/>) =&gt; state
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getInitialState</span> = (<span class="hljs-params"/>) =&gt; initialState
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">subscribe</span> = (<span class="hljs-params">listener</span>) =&gt; {
    listeners.<span class="hljs-title function_">add</span>(listener)
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> listeners.<span class="hljs-title function_">delete</span>(listener)
  }
  <span class="hljs-keyword">const</span> api = { setState, getState, getInitialState, subscribe }
  <span class="hljs-keyword">const</span> initialState = (state = <span class="hljs-title function_">createState</span>(setState, getState, api))
  <span class="hljs-keyword">return</span> api
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createStore</span> = (<span class="hljs-params">createState</span>) =&gt;
  createState ? <span class="hljs-title function_">createStoreImpl</span>(createState) : createStoreImpl

<span class="hljs-built_in">exports</span>.<span class="hljs-property">createStore</span> = createStore
</code></pre>
<p>ç†Ÿæ‚‰ redux æºç çš„äººä¸€çœ¼å°±èƒ½æ„Ÿå—åˆ°ä¸€ç§ç†Ÿæ‚‰çš„æ„Ÿè§‰ã€‚å¯¹ï¼Œè¿™é‡Œé¢çš„æºç åŸºæœ¬ä¸Šå°±æ˜¯é‡‡ç”¨äº† redux createStore çš„æºç æ¡†æ¶ï¼Œåªæ˜¯åšäº†ä¸€äº›ç®€åŒ–ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥ç¿»çœ‹æˆ‘ 5 å¹´å‰å†™çš„<a href="https://juejin.cn/post/6844904023179411464" target="_blank" title="https://juejin.cn/post/6844904023179411464">reduxæºç è§£æ</a>ã€‚</p>
<p>æ ¸å¿ƒåŸç†å°±æ˜¯åˆ©ç”¨äº† javascriptã€Œé—­åŒ…ã€çš„è¯­è¨€ç‰¹æ€§æ¥å®ç°äº† store å®ä¾‹çš„åˆ›å»ºã€‚è¢«é—­åŒ…çš„å˜é‡æ— éå°±æ˜¯ä¸¤ä¸ªï¼š</p>
<ul>
<li>state - æ ‘å½¢ç»“æ„çš„çŠ¶æ€</li>
<li>listeners - è®¢é˜…è€…é›†åˆï¼ˆSetï¼‰</li>
</ul>
<p>å¯¹è¿™ä¸¤ä¸ªå˜é‡è¿›è¡Œæœ€ç»ˆå®ç°äº† store å®ä¾‹çš„å››ä¸ª APIï¼š</p>
<ul>
<li>setState()</li>
<li>getState()</li>
<li>getInitialState()</li>
<li>subscribe()</li>
</ul>
<p>ä¹Ÿè®¸ç”¨é—­åŒ…çš„æ–¹å¼æ¥å®ç° store å®ä¾‹çš„åˆ›å»ºï¼Œä»ç†è§£çš„è§’åº¦æ¥çœ‹ä¸é‚£ä¹ˆç›´è§‚ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼æ¥å®ç° store å®ä¾‹çš„åˆ›å»ºã€‚ä¸‹é¢å°±æ˜¯æˆ‘å®ç°çš„ä¸€ç‰ˆï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// é¢å‘å¯¹è±¡ç‰ˆ Storeï¼ˆçº¯ JSï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Store</span> {
  #state
  #listeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">createState</span>) {
    <span class="hljs-keyword">const</span> api = {
      <span class="hljs-attr">setState</span>: <span class="hljs-variable language_">this</span>.#setState.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
      <span class="hljs-attr">getState</span>: <span class="hljs-variable language_">this</span>.#getState.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
      <span class="hljs-attr">getInitialState</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">createState</span>(api.<span class="hljs-property">setState</span>, api.<span class="hljs-property">getState</span>, api),
      <span class="hljs-attr">subscribe</span>: <span class="hljs-variable language_">this</span>.#subscribe.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
    }
    <span class="hljs-variable language_">this</span>.#state = api.<span class="hljs-title function_">getInitialState</span>()
  }

  #<span class="hljs-title function_">setState</span>(<span class="hljs-params">partial, replace</span>) {
    <span class="hljs-keyword">const</span> next = <span class="hljs-keyword">typeof</span> partial === <span class="hljs-string">'function'</span> ? <span class="hljs-title function_">partial</span>(<span class="hljs-variable language_">this</span>.#state) : partial
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(next, <span class="hljs-variable language_">this</span>.#state)) {
      <span class="hljs-keyword">const</span> prev = <span class="hljs-variable language_">this</span>.#state
      <span class="hljs-variable language_">this</span>.#state =
        (replace ?? (<span class="hljs-keyword">typeof</span> next !== <span class="hljs-string">'object'</span> || next === <span class="hljs-literal">null</span>))
          ? next
          : <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, <span class="hljs-variable language_">this</span>.#state, next)
      <span class="hljs-variable language_">this</span>.#listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">l</span>) =&gt;</span> <span class="hljs-title function_">l</span>(<span class="hljs-variable language_">this</span>.#state, prev))
    }
  }

  #<span class="hljs-title function_">getState</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#state
  }

  #<span class="hljs-title function_">subscribe</span>(<span class="hljs-params">listener</span>) {
    <span class="hljs-variable language_">this</span>.#listeners.<span class="hljs-title function_">add</span>(listener)
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.#listeners.<span class="hljs-title function_">delete</span>(listener)
  }

  <span class="hljs-comment">// å¯¹å¤–æš´éœ²ä¸æºç ç›¸åŒçš„ API</span>
  getState = <span class="hljs-variable language_">this</span>.#getState
  setState = <span class="hljs-variable language_">this</span>.#setState
  subscribe = <span class="hljs-variable language_">this</span>.#subscribe
  getInitialState = <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.#state
}

<span class="hljs-comment">// å·¥å‚å‡½æ•°ï¼Œä¿æŒåŒæ„</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createStoreImpl</span>(<span class="hljs-params">createState</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Store</span>(createState)
}
</code></pre>
<p>çœ‹åˆ°äº†æ²¡ï¼Œé¢å‘å¯¹è±¡çš„ <code>createStore</code> API ä¼šæ›´åŠ ç›´è§‚ã€‚ zustand çš„ <code>createStore</code> å‡½æ•°çš„å®ç°æ— éå°±æ˜¯å®ç°äº†å››ä¸ªå¯¹å¤–æš´éœ²çš„æ–¹æ³•ï¼š</p>
<ul>
<li>setState() - æ›´æ–°çŠ¶æ€ï¼Œå¹¶é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…</li>
<li>getState() - è·å–å½“å‰æœ€æ–°çš„çŠ¶æ€</li>
<li>getInitialState() - è·å–åˆå§‹çŠ¶æ€</li>
<li>subscribe() - è®¢é˜…çŠ¶æ€å˜åŒ–</li>
</ul>
<p>ç†Ÿæ‚‰ js è®¾è®¡æ¨¡å¼çš„äººä¸€çœ‹çœ‹åˆ°äº†ï¼Œzustand çš„ <code>createStore</code> å‡½æ•°çš„å®ç°é‡‡ç”¨äº†ç»å…¸çš„ã€Œå‘å¸ƒ-è®¢é˜…ã€æ¨¡å¼ã€‚å…·ä½“æ¥è¯´ï¼š</p>
<ol>
<li>é¦–å…ˆæœ‰ä¸€ä¸ª <code>listeners</code> æ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨æ‰€æœ‰çš„è®¢é˜…è€…ã€‚</li>
<li>å½“è°ƒç”¨ <code>subscribe</code> æ–¹æ³•çš„æ—¶å€™ï¼Œå°±ä¼šæŠŠå½“å‰çš„è®¢é˜…è€… push åˆ° <code>listeners</code> æ•°ç»„ä¸­ã€‚</li>
<li>å½“è°ƒç”¨ <code>setState</code> æ–¹æ³•çš„æ—¶å€™ï¼Œå°±ä¼šéå† <code>listeners</code> æ•°ç»„ï¼Œç”¨å½“å‰æœ€æ–°çš„ state å’Œæ—§çš„ state ä½œä¸ºå‚æ•°è°ƒç”¨æ‰€æœ‰çš„è®¢é˜…è€…ã€‚</li>
</ol>
<h4 data-id="heading-2">å°ç»“</h4>
<p>vanilla å±‚çš„æ ¸å¿ƒä»£ç å°±æ˜¯ä¸€ä¸ª <code>createStore()</code> å‡½æ•°å®ç°ï¼Œå®ƒä¸€è§ˆæ— é—ï¼Œååˆ†ç²¾ç®€ã€‚ä½†æ˜¯éº»é›€è™½å°ï¼Œäº”è„ä¿±å…¨ã€‚å®ƒåˆ©ç”¨äº†ã€Œé—­åŒ…ã€çš„è¯­è¨€ç‰¹æ€§å’Œã€Œå‘å¸ƒ-è®¢é˜…ã€æ¨¡å¼å®ç°äº† store å®ä¾‹çš„å››ä¸ªæ ¸å¿ƒ APIï¼šsetStateã€getStateã€getInitialStateã€subscribeã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œ<code>createStore()</code> å¹¶ä¸æ˜¯ä¸ºç”¨æˆ·ä»£ç ä¸ºå‡†å¤‡çš„ï¼Œå®ƒçš„æ¶ˆè´¹è€…ä¸»è¦æ˜¯ react binding å±‚çš„ <code>create</code> å‡½æ•°ã€‚è€Œè¿™ä¸ª<code>create</code> å‡½æ•°æ‰æ˜¯ç”¨æˆ·ä»£ç  <code>import { create } from 'zustand';</code> è¯­å¥é‡Œé¢çš„é‚£ä¸ª<code>create</code> å‡½æ•°ã€‚</p>
<p>å¦å¤–è¦æçš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬è¦æ”¾ç‚¹æ³¨æ„åŠ›åˆ° <code>getState()</code> å’Œ <code>subscribe()</code> èº«ä¸Šï¼Œå› ä¸ºå®ƒä»¬æ˜¯è¡”æ¥ vanilla å±‚å’Œ react binding å±‚çš„æ¡¥æ¢ã€‚è‡³äºåŸç†ï¼Œæˆ‘ä»¬æ¥ä¸‹å¾€ä¸‹çœ‹ã€‚</p>
<h4 data-id="heading-3">react binding å±‚</h4>
<p>è€æ ·å­ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ zustand ç¼–è¯‘åçš„è¿è¡Œæ—¶ js æºç ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-meta">'use strict'</span>

<span class="hljs-keyword">var</span> <span class="hljs-title class_">React</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'react'</span>)
<span class="hljs-keyword">var</span> vanilla = <span class="hljs-built_in">require</span>(<span class="hljs-string">'zustand/vanilla'</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">identity</span> = (<span class="hljs-params">arg</span>) =&gt; arg
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useStore</span>(<span class="hljs-params">api, selector = identity</span>) {
  <span class="hljs-keyword">const</span> slice = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useSyncExternalStore</span>(
    api.<span class="hljs-property">subscribe</span>,
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getState</span>()), [api, selector]),
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getInitialState</span>()), [api, selector]),
  )
  <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useDebugValue</span>(slice)
  <span class="hljs-keyword">return</span> slice
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createImpl</span> = (<span class="hljs-params">createState</span>) =&gt; {
  <span class="hljs-keyword">const</span> api = vanilla.<span class="hljs-title function_">createStore</span>(createState)
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">useBoundStore</span> = (<span class="hljs-params">selector</span>) =&gt; <span class="hljs-title function_">useStore</span>(api, selector)
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(useBoundStore, api)
  <span class="hljs-keyword">return</span> useBoundStore
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">create</span> = (<span class="hljs-params">createState</span>) =&gt;
  createState ? <span class="hljs-title function_">createImpl</span>(createState) : createImpl

<span class="hljs-built_in">exports</span>.<span class="hljs-property">create</span> = create
<span class="hljs-built_in">exports</span>.<span class="hljs-property">useStore</span> = useStore
</code></pre>
<p>ä»ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ—¥å¸¸ç”¨æ¥åˆ›å»º store å®ä¾‹çš„ <code>create</code> å‡½æ•°ï¼Œå®ƒçš„å®ç°å°±æ˜¯è°ƒç”¨äº† <code>createImpl</code> å‡½æ•°ã€‚è€Œåœ¨ <code>createImpl</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒè°ƒç”¨äº† <code>vanilla.createStore</code> å‡½æ•°ï¼Œæ¥åˆ›å»ºäº†ä¸€ä¸ª store å®ä¾‹ã€‚è¿™é‡Œæ‰€è°“çš„ <code>api</code> å˜é‡å°±æ˜¯æˆ‘å£ä¸­çš„ã€Œstore å®ä¾‹ã€ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨ react ç»„ä»¶ä¸­è°ƒç”¨ <code>useStore</code> å‡½æ•°å°±æ˜¯<code>createImpl</code> å‡½æ•°è¿”å›çš„ <code>useBoundStore</code> å‡½æ•°ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬åå¤æåˆ° zustand å¯ä»¥åœ¨é react ç¯å¢ƒä¸­å»è§¦å‘ react ç»„ä»¶çš„æ›´æ–°ã€‚ç§˜è¯€æœ‰äºŒ:</p>
<ul>
<li>ç§˜è¯€ä¹‹ä¸€å°±æ˜¯è¿™è¡Œä»£ç ï¼š <code>Object.assign(useBoundStore, api);</code>ã€‚å€ŸåŠ©ã€Œ<strong>å‡½æ•°å³å¯¹è±¡</strong>ã€çš„è¯­è¨€ç‰¹æ€§ï¼Œzustand æŠŠ store å®ä¾‹çš„æ‰€æœ‰ API éƒ½æŒ‚è½½åˆ°äº† <code>useBoundStore</code> å‡½æ•°ï¼Œå‘å¤–æš´éœ²å‡ºå»äº†ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨é react ç¯å¢ƒä¸­é€šè¿‡è°ƒç”¨ <code>useBoundStore.setState()</code> å‡½æ•°æ¥è§¦å‘ react ç»„ä»¶çš„æ›´æ–°ã€‚</li>
</ul>
<blockquote>
<p>ä¸è¿‡å®è¯è¯´å›æ¥ï¼Œ<code>useBoundStore.setState()</code> çš„è¿™ç§ä½¿ç”¨æ–¹å¼ï¼ˆåŒ…æ‹¬æˆ‘åœ¨å†…ï¼‰å¾ˆå¤šäººéƒ½ä¸å¤ªä¹ æƒ¯ã€‚å› ä¸ºåœ¨ react å¼€å‘è€…çš„å¿ƒæ™ºæ¨¡å‹ä¸­ï¼Œ<code>useBoundStore</code> æ˜¯ä¸€ä¸ª hook å‡½æ•°ã€‚ä½ ç°åœ¨åˆè®©æˆ‘æŠŠå®ƒå½“å¯¹è±¡ï¼Œè€Œä¸”è¿˜ç”¨åœ¨é react ç»„ä»¶çš„ç¯å¢ƒä¸­ï¼Œè¿™å¤šå°‘æ˜¯ã€Œè¿åã€äº† hook çš„ä½¿ç”¨è§„åˆ™ã€‚</p>
</blockquote>
<p>ä¸Šé¢æåˆ°äº†ç§˜è¯€ä¹‹ä¸€ï¼Œé‚£ç§˜è¯€ä¹‹äºŒæ˜¯ä»€ä¹ˆï¼Ÿç§˜è¯€ä¹‹äºŒå°±è—åœ¨äº† <code>useStore</code> å‡½æ•°ä¸­ã€‚</p>
<ul>
<li>ç§˜è¯€ä¹‹äºŒåœ¨ <code>useStore</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨äº† <code>React.useSyncExternalStore</code> hook å‡½æ•°ã€‚<strong>ç§˜è¯€ä¹‹äºŒå°±æ˜¯ zustand å¾ˆæ•é”åœ°å‘ç°äº† <code>useSyncExternalStore</code> èƒ½å¤Ÿæ”¯æŒå¯¹å¤–éƒ¨æ•°æ®æºçš„å“åº”çš„ç‰¹æ€§ã€‚</strong> äºæ˜¯ä¹ï¼Œzustand é€šè¿‡è°ƒç”¨ <code>useSyncExternalStore</code> å‡½æ•°ï¼ŒæŠŠ store å®åŠ›çš„ <code>subscribe</code> æ–¹æ³•å’Œ <code>getState</code> æ–¹æ³•é¡ºåˆ©åœ°æŠŠä¼ è¿›å»ï¼Œå‹¾ä½äº† react çš„å†…æ ¸ã€‚</li>
</ul>
<p>è‡³æ­¤ï¼Œzustand å’Œ react æˆåŠŸåœ°ç»‘å®šåœ¨ä¸€å—äº†ã€‚</p>
<h5 data-id="heading-4">zustand è·Ÿ react çš„æ¡¥æ¥åŸç†</h5>
<p>æ¢å¥è¯æ¥é—®ï¼Œé‚£ä¹ˆå°±æ˜¯ï¼šâ€œ<code>useSyncExternalStore</code> è¿™ä¸ª hook æ˜¯å¦‚ä½•å®ç°å¯¹å¤–éƒ¨æ•°æ®æºçš„å“åº”å‘¢ï¼Ÿâ€ã€‚å…¶å®ç¿»çœ‹å®˜ç½‘çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Freference%2Freact%2FuseSyncExternalStore" target="_blank" title="https://react.dev/reference/react/useSyncExternalStore" ref="nofollow noopener noreferrer">useSyncExternalStore çš„ API æ–‡æ¡£</a>ï¼Œå°±ä¼šå‘ç°ï¼Œ<code>useSyncExternalStore</code> è¿™ä¸ª hook å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ <code>subscribe</code>(è®¢é˜…å‡½æ•°)ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ <code>getSnapshot</code>(è·å–çŠ¶æ€å¿«ç…§å‡½æ•°)ã€‚è€Œ zustand æ­£æ˜¯åˆ©ç”¨äº†è¿™ä¸¤ä¸ªå‚æ•°ï¼ŒæŠŠ store å®ä¾‹çš„ <code>subscribe</code> æ–¹æ³•å’Œ <code>getState</code> æ–¹æ³•ä¼ é€’ç»™äº† react çš„å†…æ ¸ã€‚ç„¶åï¼Œreact å†…æ ¸åœ¨ç»„ä»¶åˆå§‹æŒ‚è½½ï¼ˆmountï¼‰çš„æ—¶å€™å»åˆ©ç”¨ <code>subscribe</code> æ–¹æ³•å¾€ zustand çš„è®¢é˜…è€…æ•°ç»„ä¸­æ·»åŠ äº†ä¸€ä¸ªæ–°çš„è®¢é˜…è€…ï¼ˆlistenerï¼‰ã€‚æœ€åï¼Œåœ¨ç”¨æˆ·è°ƒç”¨ zustand store å®ä¾‹çš„ <code>setState()</code> æ–¹æ³•çš„æ—¶å€™ï¼Œzustand å†…éƒ¨ä¼šå…ˆæ¯”è¾ƒ store çš„æ–°æ—§ state å€¼ï¼Œå¦‚æœæ˜¯å‘ç”Ÿäº†å˜åŒ–ï¼Œå®ƒå°±é€šçŸ¥ reactã€‚react å†æ¬¡è°ƒç”¨ zustand store å®ä¾‹çš„ <code>getState</code> æ–¹æ³•æ¥è·å–æœ€æ–°çš„çŠ¶æ€å¿«ç…§ï¼Œå¯¹æ¯”æ–°æ—§å¿«ç…§ã€‚å¦‚æœæ–°æ—§çŠ¶æ€å¿«ç…§çš„å€¼ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆ react å°±ä¼šæŠŠå½“å‰çš„ç»„ä»¶æ ‡è®°ä¸ºã€Œéœ€è¦æ›´æ–°çš„ã€ï¼Œå¹¶æ¥ç€è§¦å‘ä¸€æ¬¡ç»„ä»¶æ›´æ–°çš„è°ƒåº¦è¯·æ±‚ã€‚</p>
<h4 data-id="heading-5">ä¸‰æ–¹é€šè®¯æ¡†æ¶ï¼ˆç”¨æˆ·ä»£ç ï¼Œ zustandï¼Œ reactï¼‰</h4>
<p>ä»¥ä¸Šçš„æ¡¥æ¥åŸç†è®²å¾—æ¯”è¾ƒç¬¼ç»Ÿï¼Œä¸‹é¢æˆ‘ä»ä¸‰æ–¹é€šè®¯çš„è§†è§’ï¼Œæ¥è¿›ä¸€æ­¥é˜è¿°ä¸€ä¸‹è¿™é‡Œé¢çš„åŸç†ã€‚æˆ‘ä¼šç»™å‡ºæ—¶åºå›¾ï¼Œç„¶åç»“åˆç¼–è¯‘åçš„æºç æ¥é€æ­¥è®²è§£ã€‚</p>
<p>ç†Ÿæ‚‰ react åŸç†çš„äººéƒ½çŸ¥é“ï¼Œreact å†…éƒ¨å®ç°æ˜¯æŠŠåº”ç”¨åˆ’åˆ†äº†ä¸¤ä¸ªé˜¶æ®µçš„ï¼š<strong>mount é˜¶æ®µå’Œ update é˜¶æ®µ</strong>ã€‚ä¸€ä¸ª react åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸé¦–å…ˆç»å† mount é˜¶æ®µï¼Œç„¶åå†ç»å† update é˜¶æ®µã€‚</p>
<h5 data-id="heading-6">mount é˜¶æ®µ</h5>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹çœ‹ mount é˜¶æ®µï¼Œè¿™ä¸‰æ–¹æ˜¯æ€ä¹ˆé€šè®¯çš„ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant ç”¨æˆ·ä»£ç 
    participant zustand
    participant react

    ç”¨æˆ·ä»£ç -&gt;&gt;zustand: è°ƒç”¨ create() API
    zustand-&gt;&gt;zustand: 1. è°ƒç”¨ createStore() æ¥åˆ›å»º store å®ä¾‹
    zustand-&gt;&gt;zustand: 2. åˆ›å»º useBoundStore å‡½æ•°å®ä¾‹&lt;br/&gt;å¹¶å°† store å®ä¾‹ï¼ŒuseStore å‡½æ•°å®ä¾‹å’Œ selectoré—­åŒ…å…¶ä¸­
    zustand--&gt;&gt;ç”¨æˆ·ä»£ç : è¿”å› useBoundStore()
    ç”¨æˆ·ä»£ç -&gt;&gt;ç”¨æˆ·ä»£ç : è°ƒç”¨ useBoundStore() API
    ç”¨æˆ·ä»£ç -&gt;&gt;zustand: è°ƒç”¨ useStore() API
    zustand-&gt;&gt;react: è°ƒç”¨ useSyncExternalStore() API

    react-&gt;&gt;react: 1. è°ƒç”¨ getState(), æŠŠé¦–æ¬¡çš„ snapshot ä¿å­˜åœ¨ fiber
    react-&gt;&gt;react: 2. åˆ›å»ºæ–°çš„ listener
react-&gt;&gt;react: 3. ç»„ä»¶æŒ‚è½½åï¼Œæ‰§è¡Œ subscribe(listener)
    react-&gt;&gt;zustand: å®ç°å¯¹ zustand store çš„è®¢é˜…
</code></pre>
<p>ä¸Šé¢è®²åˆ°äº†ï¼Œç”¨æˆ·ä¾§è°ƒç”¨çš„ create() å‡½æ•°ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ react binding å±‚çš„ createImpl() å‡½æ•°ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-meta">'use strict'</span>

<span class="hljs-keyword">var</span> <span class="hljs-title class_">React</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'react'</span>)
<span class="hljs-keyword">var</span> vanilla = <span class="hljs-built_in">require</span>(<span class="hljs-string">'zustand/vanilla'</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">identity</span> = (<span class="hljs-params">arg</span>) =&gt; arg
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useStore</span>(<span class="hljs-params">api, selector = identity</span>) {
  <span class="hljs-keyword">const</span> slice = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useSyncExternalStore</span>(
    api.<span class="hljs-property">subscribe</span>,
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getState</span>()), [api, selector]),
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getInitialState</span>()), [api, selector]),
  )
  <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useDebugValue</span>(slice)
  <span class="hljs-keyword">return</span> slice
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createImpl</span> = (<span class="hljs-params">createState</span>) =&gt; {
  <span class="hljs-keyword">const</span> api = vanilla.<span class="hljs-title function_">createStore</span>(createState)
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">useBoundStore</span> = (<span class="hljs-params">selector</span>) =&gt; <span class="hljs-title function_">useStore</span>(api, selector)
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(useBoundStore, api)
  <span class="hljs-keyword">return</span> useBoundStore
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">create</span> = (<span class="hljs-params">createState</span>) =&gt;
  createState ? <span class="hljs-title function_">createImpl</span>(createState) : createImpl

<span class="hljs-built_in">exports</span>.<span class="hljs-property">create</span> = create
<span class="hljs-built_in">exports</span>.<span class="hljs-property">useStore</span> = useStore
</code></pre>
<p>ç®€å•æ¥è¯´ï¼ŒcreateImpl() å‡½æ•°å°±å¹²äº†ä¸‰ä»¶äº‹ï¼š</p>
<ol>
<li>è°ƒç”¨ <code>vanilla.createStore()</code> æ¥åˆ›å»º store å®ä¾‹</li>
<li>åˆ›å»º <code>useBoundStore</code> å‡½æ•°å®ä¾‹ï¼Œå¹¶å°† store å®ä¾‹ï¼Œ<code>useStore</code> å‡½æ•°å®ä¾‹å’Œ <code>selector</code> é—­åŒ…å…¶ä¸­</li>
<li>è¿”å› <code>useBoundStore</code> å‡½æ•°å®ä¾‹</li>
</ol>
<p>åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šï¼Œç”¨æˆ·ä»£ç éƒ½æ˜¯è·Ÿ zustand å†…æ ¸åœ¨æ‰“äº¤é“ã€‚å½“ç”¨æˆ·åœ¨ç»„ä»¶å†…éƒ¨å»è°ƒç”¨ useBoundStore() å‡½æ•°æ—¶ï¼Œæµç¨‹å°±å¯ä»¥è¿›å…¥åˆ° react å†…éƒ¨äº†ã€‚å› ä¸º useBoundStore() å‡½æ•°å†…éƒ¨ï¼Œå°±æ˜¯è°ƒç”¨äº† useStore() å‡½æ•°ã€‚è€Œ useStore() å‡½æ•°å†…éƒ¨ï¼Œå°±æ˜¯è°ƒç”¨äº† React.useSyncExternalStore() å‡½æ•°ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„ç›®å…‰å¯ä»¥èšç„¦åˆ°ä¸‹é¢çš„å‡ è¡Œä»£ç ä¸Šï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useStore</span>(<span class="hljs-params">api, selector = identity</span>) {
  <span class="hljs-keyword">const</span> slice = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useSyncExternalStore</span>(
    api.<span class="hljs-property">subscribe</span>,
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getState</span>()), [api, selector]),
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getInitialState</span>()), [api, selector]),
  )
  <span class="hljs-comment">// ......</span>
  <span class="hljs-keyword">return</span> slice
}
</code></pre>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ï¼Œzustand store å®ä¾‹çš„ <code>subscribe</code> æ–¹æ³•å’Œ <code>getState</code> æ–¹æ³•è¢«ä¼ é€’ç»™äº† react çš„å†…æ ¸ã€‚é‚£ react å†…æ ¸æ˜¯å¦‚ä½•æ¶ˆè´¹è¿™ä¸¤ä¸ª API çš„å‘¢ï¼Ÿå¾€ä¸‹æ·±æŒ–ï¼Œæˆ‘ä»¬å°±æ¥åˆ°äº† <code>useSyncExternalStore</code> è¿™ä¸ª hook çš„å†…éƒ¨å®ç°äº†ã€‚æ­£å¦‚æˆ‘ä¹‹å‰çš„æ–‡ç« <a href="https://juejin.cn/post/6876659994448625671" target="_blank" title="https://juejin.cn/post/6876659994448625671">ã€reactã€‘react hookè¿è¡ŒåŸç†è§£æ</a> é‡Œé¢æåˆ°çš„ï¼Œhook å‡½æ•°ä¹Ÿæ˜¯æœ‰ mount å’Œ update é˜¶æ®µçš„ã€‚ä¸åŒçš„é˜¶æ®µï¼Œå¼€å‘è€…æ‰€æ¶ˆè´¹çš„ hook å‡½æ•°æ˜¯æŒ‡å‘ä¸åŒçš„å®ç°ã€‚å›å½’åˆ° <code>useSyncExternalStore</code>è¿™é‡Œï¼Œå½“å‰æˆ‘ä»¬åœ¨èŠåº”ç”¨çš„ mount é˜¶æ®µï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¾—çœ‹æºç é‡Œé¢çš„ <code>mountSyncExternalStore</code> å‡½æ•°å®ç°ã€‚ä¸‹é¢ï¼Œæˆ‘æŠŠè·Ÿæœ¬æ¬¡ç ”ç©¶ä¸»é¢˜ç›¸å…³çš„ä»£ç ç›´æ¥æ‘†å‡ºæ¥ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">mountSyncExternalStore</span>(<span class="hljs-params">subscribe, getSnapshot, getServerSnapshot</span>) {
  <span class="hljs-keyword">var</span> fiber = currentlyRenderingFiber$1
  <span class="hljs-keyword">var</span> hook = <span class="hljs-title function_">mountWorkInProgressHook</span>()
  <span class="hljs-keyword">var</span> nextSnapshot
  <span class="hljs-keyword">var</span> isHydrating = <span class="hljs-title function_">getIsHydrating</span>()

  <span class="hljs-keyword">if</span> (isHydrating) {
    <span class="hljs-comment">// hydration çš„ç›¸å…³é€»è¾‘ä»£ç å¿½ç•¥</span>
    <span class="hljs-comment">// ......</span>
  } <span class="hljs-keyword">else</span> {
    nextSnapshot = <span class="hljs-title function_">getSnapshot</span>()

    <span class="hljs-comment">// æ²¡æœ‰åŠæ—¶ç¼“å­˜ getSnapshot() çš„è¿”å›å€¼ç›¸å…³è­¦å‘Šä»£ç è·³è¿‡</span>
    <span class="hljs-comment">// ......</span>

    <span class="hljs-comment">// å› ä¸ºæ¸²æŸ“æ˜¯å¯ä¸­æ–­çš„ï¼Œæ‰€ä»¥åœ¨ commit ä¹‹å‰è¦è¿›è¡Œä¸€è‡´æ€§æ£€æŸ¥</span>
    <span class="hljs-comment">// ç›¸å…³ä»£ç è·³è¿‡</span>
  }

  <span class="hljs-comment">// Read the current snapshot from the store on every render. This breaks the</span>
  <span class="hljs-comment">// normal rules of React, and only works because store updates are</span>
  <span class="hljs-comment">// always synchronous.</span>
  hook.<span class="hljs-property">memoizedState</span> = nextSnapshot
  <span class="hljs-keyword">var</span> inst = {
    <span class="hljs-attr">value</span>: nextSnapshot,
    <span class="hljs-attr">getSnapshot</span>: getSnapshot,
  }
  hook.<span class="hljs-property">queue</span> = inst

  <span class="hljs-comment">// Schedule an effect to subscribe to the store.</span>
  <span class="hljs-title function_">mountEffect</span>(subscribeToStore.<span class="hljs-title function_">bind</span>(<span class="hljs-literal">null</span>, fiber, inst, subscribe), [subscribe])

  <span class="hljs-comment">// å…¥é˜Ÿä¸€ä¸ª effect å¯¹è±¡ç”¨äºåœ¨æ¯ä¸€æ¬¡ç»„ä»¶ render ä¹‹åå»åš `inst` å­—æ®µå€¼çš„æ›´æ–°</span>
  <span class="hljs-comment">// è¿™é‡Œçš„ä»£ç ä¹Ÿå¯ä»¥ä¸çœ‹</span>
  <span class="hljs-comment">// Schedule an effect to update the mutable instance fields. We will update</span>
  <span class="hljs-comment">// this whenever subscribe, getSnapshot, or value changes. Because there's no</span>
  <span class="hljs-comment">// clean-up function, and we track the deps correctly, we can call pushEffect</span>
  <span class="hljs-comment">// directly, without storing any additional state. For the same reason, we</span>
  <span class="hljs-comment">// don't need to set a static flag, either.</span>
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> We can move this to the passive phase once we add a pre-commit</span>
  <span class="hljs-comment">// consistency check. See the next comment.</span>
  <span class="hljs-comment">// fiber.flags |= Passive</span>
  <span class="hljs-comment">// pushEffect(</span>
  <span class="hljs-comment">//   HasEffect | Passive$1,</span>
  <span class="hljs-comment">//   updateStoreInstance.bind(null, fiber, inst, nextSnapshot, getSnapshot),</span>
  <span class="hljs-comment">//   undefined,</span>
  <span class="hljs-comment">//   null,</span>
  <span class="hljs-comment">// )</span>
  <span class="hljs-keyword">return</span> nextSnapshot
}
</code></pre>
<p>ä¸Šé¢çš„æºç ä¸­ï¼Œæˆ‘å·²ç»æŠŠè·Ÿæœ¬æ¬¡ç ”ç©¶ä¸»é¢˜ä¸ç›¸å…³çš„ä»£ç å·²ç»ç§»é™¤æˆ–è€…æ³¨é‡Šæ‰äº†ã€‚ä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬ä¸€è·¯é€ä¼ è¿›æ¥çš„ zustand store å®ä¾‹çš„<code>subscribe</code> æ–¹æ³•å’Œ <code>getState</code> æ–¹æ³•ï¼Œæœ€ç»ˆéƒ½è¢«ä¼ é€’ç»™äº† <code>subscribeToStore</code> è¿™ä¸ªå‡½æ•°ã€‚è€Œ <code>subscribeToStore</code> å‡½æ•°å°±æ˜¯å®ç°è®¢é˜…åŠŸèƒ½çš„å…³é”®ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">subscribeToStore</span>(<span class="hljs-params">fiber, inst, subscribe</span>) {
  <span class="hljs-keyword">var</span> handleStoreChange = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-comment">// The store changed. Check if the snapshot changed since the last time we</span>
    <span class="hljs-comment">// read from the store.</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">checkIfSnapshotChanged</span>(inst)) {
      <span class="hljs-comment">// Force a re-render.</span>
      <span class="hljs-title function_">forceStoreRerender</span>(fiber)
    }
  } <span class="hljs-comment">// Subscribe to the store and return a clean-up function.</span>

  <span class="hljs-comment">// è¿™é‡Œçš„ `subscribe` å°±æ˜¯ zustand store å®ä¾‹çš„ `subscribe` æ–¹æ³•</span>
  <span class="hljs-comment">// è¿™é‡Œç”¨äº†ã€Œæ§åˆ¶åè½¬ã€çš„è®¾è®¡æ¨¡å¼</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">subscribe</span>(handleStoreChange)
}
</code></pre>
<p><code>subscribeToStore</code> å‡½æ•°ä¸»è¦æ˜¯å¹²äº†ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„ listener - <code>handleStoreChange</code> å‡½æ•°ï¼›</li>
<li>è°ƒç”¨ store å®ä¾‹çš„ <code>subscribe</code> æ–¹æ³•å®ç°å¯¹ zustand store å®ä¾‹çš„ç›‘å¬ï¼›</li>
</ol>
<p>é‚£ä»€ä¹ˆæ—¶å€™å»è®¢é˜… zustand store å®ä¾‹å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä» <code>mountEffect(subscribeToStore.bind(null, fiber, inst, subscribe), [subscribe])</code> è¿™è¡Œä»£ç å¯ä»¥çœ‹å‡ºã€‚Againï¼Œå› ä¸ºå½“å‰æ˜¯åº”ç”¨çš„ mount é˜¶æ®µï¼Œæ‰€ä»¥ï¼Œ<code>mountEffect</code> å‡½æ•°å°±æ˜¯ mount é˜¶æ®µçš„ <code>useEffect</code> å‡½æ•°ã€‚æ‰€ä»¥ç­”æ¡ˆå°±æ˜¯ï¼š<strong>å½“ç»„ä»¶ mount æ—¶ï¼Œ<code>subscribeToStore</code> å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼Œä»è€Œå®ç°å¯¹ zustand store å®ä¾‹çš„ç›‘å¬</strong>ã€‚</p>
<p>æ­£å¦‚ä¸Šé¢æ—¶åºå›¾æ‰€è¡¨æ˜çš„é‚£æ ·ï¼Œé™¤äº†è¿™ä¸ªç»‘å®šçš„åŠ¨ä½œå¤–ï¼Œ<code>useSyncExternalStore</code> åœ¨ mount é˜¶æ®µè¿˜åšäº†å¦å¤–ä¸€ä»¶å°äº‹ã€‚é‚£å°±æ˜¯è°ƒç”¨äº† <code>getSnapshot()</code> æ–¹æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªåˆå§‹çš„ snapshot å€¼ï¼Œå­˜å‚¨åœ¨äº† <code>useSyncExternalStore</code> æ‰€å¯¹åº”çš„ hook å¯¹è±¡ä¸Šã€‚é‚£ä¹ˆåœ¨ä¸‹ä¸€æ¬¡æ¯”è¾ƒçš„æ—¶å€™ï¼Œè¿™ä¸ª snapshot å€¼å°±æ˜¯ prevSnapshot äº†ã€‚</p>
<h5 data-id="heading-7">update é˜¶æ®µ</h5>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant ç”¨æˆ·ä»£ç 
    participant zustand
    participant react

    ç”¨æˆ·ä»£ç -&gt;&gt;zustand: è°ƒç”¨ setState() API
    zustand-&gt;&gt;zustand: è®¡ç®—æœ€æ–°çš„ state å€¼
    zustand-&gt;&gt;zustand: æ–°æ—§ state å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–?
    alt æ˜¯
        zustand-&gt;&gt;zustand: é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…
        zustand-&gt;&gt;react: å¯¹æ¯”æ–°æ—§ snapshotï¼Œåˆ¤æ–­ snapshot æ˜¯å¦å·²ç»å‘ç”Ÿå˜åŒ–?
        alt æ˜¯
            react-&gt;&gt;react: å¼ºåˆ¶è§¦å‘ä¸€ä¸ª rerender
            react-&gt;&gt;react: è¿›å…¥ render é˜¶æ®µ
            react-&gt;&gt;react: è°ƒç”¨ useSyncExternalStore()ï¼Œé—´æ¥è°ƒç”¨ getSnapshot() è·å–æœ€æ–°çŠ¶æ€å¿«ç…§
            react-&gt;&gt;react: å¯¹æ¯”æ–°æ—§ snapshotï¼Œåˆ¤æ–­ snapshot æ˜¯å¦å·²ç»å‘ç”Ÿå˜åŒ–?
            alt æ˜¯
                react-&gt;&gt;react: æŠŠæœ€æ–°çš„ snapshot ä¿å­˜åœ¨ fiber ä¸Š
                react-&gt;&gt;react: å°†ç¡®è®¤æ›´æ–°æ ‡è®°æ›´æ–°ä¸º true (didReceiveUpdate = true)
            end
        end
    end
</code></pre>
<p>å½“ç”¨æˆ·é—´æ¥ï¼ˆè°ƒç”¨ zustand store å®ä¾‹çš„ action æ–¹æ³•æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨ <code>setState</code> æ–¹æ³•ï¼‰æˆ–è€…ç›´æ¥è°ƒç”¨ zustand store å®ä¾‹çš„ <code>setState</code> æ–¹æ³•æ—¶ï¼Œzustand ä¼šè®¡ç®—å‡ºæœ€æ–°çš„ stateï¼Œç„¶åæ‹¿æœ€æ–° state è·Ÿä¹‹å‰çš„ state è¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœå‘ç°æœ‰å˜åŒ–ï¼Œå°±ä¼šé€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ï¼Œé€šçŸ¥è®¢é˜…è€…çŠ¶æ€å·²ç»å‘ç”Ÿäº†å˜åŒ–ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å‘ç”Ÿåœ¨zustand store å®ä¾‹çš„ <code>setState</code> æ–¹æ³•é‡Œé¢çš„ã€‚ä»¥ä¸‹ä»£ç ä¸ºè¯ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-meta">'use strict'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">createStoreImpl</span> = (<span class="hljs-params">createState</span>) =&gt; {
  <span class="hljs-keyword">let</span> state
  <span class="hljs-keyword">const</span> listeners = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setState</span> = (<span class="hljs-params">partial, replace</span>) =&gt; {
    <span class="hljs-keyword">const</span> nextState = <span class="hljs-keyword">typeof</span> partial === <span class="hljs-string">'function'</span> ? <span class="hljs-title function_">partial</span>(state) : partial
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(nextState, state)) {
      <span class="hljs-keyword">const</span> previousState = state
      state = (
        replace != <span class="hljs-literal">null</span>
          ? replace
          : <span class="hljs-keyword">typeof</span> nextState !== <span class="hljs-string">'object'</span> || nextState === <span class="hljs-literal">null</span>
      )
        ? nextState
        : <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, state, nextState)
      listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">listener</span>) =&gt;</span> <span class="hljs-title function_">listener</span>(state, previousState))
    }
  }

  <span class="hljs-comment">//.....</span>
  <span class="hljs-keyword">return</span> api
}
</code></pre>
<p>å¯ä»¥çœ‹å‡ºå¦å¤–ä¸€ä¸ªç»†èŠ‚ï¼Œzustand æ˜¯é‡‡ç”¨åŸç”Ÿçš„ <code>Object.is</code> æ–¹æ³•æ¥æ¯”è¾ƒæ–°æ—§ state æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–çš„ã€‚å¯¹äºè¿™ç‚¹ï¼Œæˆ‘ä»¬å¾—åˆ°çš„å¯ç¤ºæ˜¯ï¼š <strong>å¯¹äºå¼•ç”¨ç±»å‹çš„ stateï¼Œæˆ‘ä»¬è°ƒç”¨ <code>setState</code> æ–¹æ³•æ—¶ï¼Œåº”è¯¥é¿å…ç›´æ¥ä¿®æ”¹å®ƒçš„å±æ€§ï¼Œè€Œæ˜¯åº”è¯¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡</strong>ï¼ˆè¿™ä¸ªå¯ç¤ºå¯¹äºç†Ÿæ‚‰ react åŸç†çš„äººæ¥è¯´æ˜¯å¾ˆå¸ç©ºè§æƒ¯äº†ï¼‰ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ zustand èƒ½å¤Ÿæ­£ç¡®åœ°æ£€æµ‹åˆ° state çš„å˜åŒ–ã€‚å…³äºå€¼å˜åŒ–çš„æ£€æµ‹ç®—æ³•ï¼Œzustand è·Ÿ react å†…éƒ¨å®ç°æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>setState</code> æ–¹æ³•å®ç°çš„æœ€åä¸€è¡Œçš„ä»£ç ï¼š<code>listeners.forEach((listener) =&gt; listener(state, previousState))</code>ã€‚zustand ä¸€æ—¦è§‰å¾— store å®ä¾‹çš„ state å‘ç”Ÿäº†å˜åŒ–ï¼Œå°±ä¼šé€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ï¼Œ<strong>è€Œè¿™é‡Œé¢å½“ç„¶åŒ…æ‹¬ react åœ¨ mount é˜¶æ®µæ³¨å†Œçš„è®¢é˜…è€…ï¼ˆhandleStoreChangeï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">subscribeToStore</span>(<span class="hljs-params">fiber, inst, subscribe</span>) {
  <span class="hljs-keyword">var</span> handleStoreChange = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-comment">// The store changed. Check if the snapshot changed since the last time we</span>
    <span class="hljs-comment">// read from the store.</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">checkIfSnapshotChanged</span>(inst)) {
      <span class="hljs-comment">// Force a re-render.</span>
      <span class="hljs-title function_">forceStoreRerender</span>(fiber)
    }
  } <span class="hljs-comment">// Subscribe to the store and return a clean-up function.</span>

  <span class="hljs-keyword">return</span> <span class="hljs-title function_">subscribe</span>(handleStoreChange)
}
</code></pre>
<p>react è¢«é€šçŸ¥åï¼Œå®ƒå¹¶ä¸ä¼šé©¬ä¸Šå°±è§¦å‘ä¸€ä¸ªæ›´æ–°è¯·æ±‚ã€‚è€Œæ˜¯å†è¿›è¡Œä¸€æ¬¡æ–°æ—§ state å€¼çš„æ¯”è¾ƒï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkIfSnapshotChanged</span>(<span class="hljs-params">inst</span>) {
  <span class="hljs-keyword">var</span> latestGetSnapshot = inst.<span class="hljs-property">getSnapshot</span>
  <span class="hljs-keyword">var</span> prevValue = inst.<span class="hljs-property">value</span>

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">var</span> nextValue = <span class="hljs-title function_">latestGetSnapshot</span>()
    <span class="hljs-keyword">return</span> !<span class="hljs-title function_">objectIs</span>(prevValue, nextValue)
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }
}
</code></pre>
<p>æ‰€è°“çš„ <code>latestGetSnapshot</code> æ˜¯ react è¿™è¾¹è€ƒè™‘äº†ä¸åŒçš„ rerender å‘¨æœŸï¼Œä¼ ç»™äº† <code>useSyncExternalStore</code> çš„ <code>getSnapshot</code> æ–¹æ³•å¼•ç”¨å‘ç”Ÿäº†å˜åŒ–ã€‚è€Œåœ¨å®é™… zustand ä¾§ï¼Œå®ƒä¼ å…¥çš„å¼•å…¥æ˜¯ä¸å˜çš„ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç†è§£å°±æ˜¯ zustand store å®ä¾‹çš„ <code>getState</code> æ–¹æ³•ã€‚</p>
<p>æ¥ä¸‹æ¥çš„é€»è¾‘å°±æ˜¯å¾ˆæ˜æ˜¾äº†ã€‚åˆ¤æ–­ä¹‹å‰ï¼Œç«‹åˆ»è°ƒç”¨ä¸€æ¬¡ <code>getState</code> æ–¹æ³•å»è·å–æœ€æ–°çš„ state å€¼ã€‚åˆ¤æ–­æ–°æ—§ state æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–çš„æ£€æµ‹ç®—æ³•ä¾æ—§æ˜¯ <code>Object.is</code> æ–¹æ³•ã€‚å¦‚æœåˆ¤æ–­å€¼å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™è§¦å‘ä¸€ä¸ªç»„ä»¶æ›´æ–°è¯·æ±‚ã€‚</p>
<blockquote>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ·±åˆ»çš„è®¤çŸ¥ï¼Œé‚£å°±æ˜¯ï¼šzustand åœ¨åˆ¤æ–­å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–æ‰€é‡‡ç”¨çš„ç®—æ³•æ–¹é¢æ˜¯å¯¹é½äº† react å†…éƒ¨å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯éƒ½æ˜¯ <code>Object.is</code> æ–¹æ³•ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œä¸ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥ç¿»çœ‹æˆ‘çš„<a href="https://juejin.cn/post/7230989445729189943" target="_blank" title="https://juejin.cn/post/7230989445729189943">è§¦æ‘¸ react çš„å‘½é—¨ - å€¼çš„ç›¸ç­‰æ€§æ¯”è¾ƒï¼ˆä¸Šç¯‡ï¼‰</a>å’Œ<a href="https://juejin.cn/post/7460002800464052262" target="_blank" title="https://juejin.cn/post/7460002800464052262">è§¦æ‘¸ react çš„å‘½é—¨ - å€¼çš„ç›¸ç­‰æ€§æ¯”è¾ƒï¼ˆä¸‹ç¯‡ï¼‰</a>ã€‚</p>
</blockquote>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">forceStoreRerender</span>(<span class="hljs-params">fiber</span>) {
  <span class="hljs-keyword">var</span> root = <span class="hljs-title function_">enqueueConcurrentRenderForLane</span>(fiber, <span class="hljs-title class_">SyncLane</span>)

  <span class="hljs-keyword">if</span> (root !== <span class="hljs-literal">null</span>) {
    <span class="hljs-title function_">scheduleUpdateOnFiber</span>(root, fiber, <span class="hljs-title class_">SyncLane</span>, <span class="hljs-title class_">NoTimestamp</span>)
  }
}
</code></pre>
<p>æœ€åï¼Œæˆ‘ä»¬ç®€åœ°å±•å¼€è¯´è¯´ react core è¿™è¾¹æ˜¯å¦‚ä½•å‘ scheduler å‘èµ·ä¸€ä¸ªæ›´æ–°è¯·æ±‚çš„ã€‚æ­¥éª¤æœ‰äºŒï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œå…ˆå‘æ›´æ–°é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ç»„åŒæ­¥ä¼˜å…ˆçº§çš„æ›´æ–°è¯·æ±‚ metaï¼ˆåŒ…å«å››è¦ç´ ï¼šfiberï¼Œupdate å¯¹è±¡ï¼Œ laneï¼Œ hook queueï¼‰ï¼›</li>
<li>ç„¶åï¼Œæ­£å¼å‘ scheduler å±‚å‘èµ·ä¸€ä¸ªæ›´æ–°è¯·æ±‚ã€‚è¿™é‡Œç¨å¾®å±•å¼€æ¥è®²ä¸€ä¸‹ã€‚react core è¿™è¾¹ä¼šæŠŠä¸€ä¸ªç»„ä»¶æ›´æ–°è¯·æ±‚åŒ…è£…ä¸ºä¸€ä¸ª taskã€‚åŒæ­¥ä¼˜å…ˆçº§çš„æ›´æ–°è¯·æ±‚ä¼šä½¿ç”¨ <code>performSyncWorkOnRoot(rootFiber)</code>åŒ…è£…ä¸ºä¸€ä¸ªåŒæ­¥ taskï¼Œå¼‚æ­¥ä¼˜å…ˆçº§çš„æ›´æ–°è¯·æ±‚ä¼šä½¿ç”¨ <code>performConcurrentWorkOnRoot(rootFiber)</code>åŒ…è£…ä¸ºä¸€ä¸ªåŒå¼‚æ­¥ taskã€‚æœ€åé€šè¿‡è°ƒç”¨ scheduler çš„è°ƒåº¦å‡½æ•°æ¥æŠŠç»„ä»¶æ›´æ–°è¿™ä¸ªä»»åŠ¡äº¤ç»™ schedulerï¼Œ è®©å®ƒå†³å®šåœ¨ä½•æ—¶å»çœŸæ­£è¿›å…¥æ•´ä¸ªç»„ä»¶æ›´æ–°æµç¨‹ï¼ˆrender + commitï¼‰ã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥ï¼Œåœ¨ render é˜¶æ®µï¼Œ<code>useSyncExternalStore</code> ä¼šè¢«å†æ¬¡è°ƒç”¨ã€‚react core è¿™è¾¹è¿˜ä¼šè°ƒç”¨ä¸€æ¬¡ <code>getSnapshot</code> æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯ zustand store å®ä¾‹çš„ <code>getState</code> æ–¹æ³•ï¼‰ã€‚ç„¶åï¼Œè¿˜æ˜¯ä¼šæ¯”è¾ƒæ–°æ—§ snapshot çš„å€¼æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚æœå‘ç°æœ‰å˜åŒ–ï¼Œå°±ä¸»è¦åšä¸‰ä»¶äº‹ï¼š</p>
<ol>
<li>æ›´æ–°å­˜æ”¾åœ¨ fiber ä¸Šçš„ prevSnapshot å€¼ï¼›</li>
<li>å°†å½“å‰ç»„ä»¶ markup ä¸ºçœŸæ­£éœ€æ±‚æ›´æ–°çš„ï¼ˆä¸»è¦æ˜¯ä¸ºäº†æ€§èƒ½ä¼˜åŒ–çš„ç›®çš„ï¼‰ã€‚</li>
<li>è¿”å›å½“å‰æœ€æ–°çš„ snapshot å€¼ã€‚</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateSyncExternalStore</span>(<span class="hljs-params">subscribe, getSnapshot, getServerSnapshot</span>) {
  <span class="hljs-keyword">var</span> fiber = currentlyRenderingFiber$1
  <span class="hljs-keyword">var</span> hook = <span class="hljs-title function_">updateWorkInProgressHook</span>() <span class="hljs-comment">// Read the current snapshot from the store on every render. This breaks the</span>
  <span class="hljs-comment">// normal rules of React, and only works because store updates are</span>
  <span class="hljs-comment">// always synchronous.</span>

  <span class="hljs-keyword">var</span> nextSnapshot = <span class="hljs-title function_">getSnapshot</span>()

  <span class="hljs-comment">// ......</span>

  <span class="hljs-keyword">var</span> prevSnapshot = hook.<span class="hljs-property">memoizedState</span>
  <span class="hljs-keyword">var</span> snapshotChanged = !<span class="hljs-title function_">objectIs</span>(prevSnapshot, nextSnapshot)

  <span class="hljs-keyword">if</span> (snapshotChanged) {
    hook.<span class="hljs-property">memoizedState</span> = nextSnapshot
    <span class="hljs-title function_">markWorkInProgressReceivedUpdate</span>()
  }

  <span class="hljs-comment">// .......</span>

  <span class="hljs-keyword">return</span> nextSnapshot
}
</code></pre>
<h5 data-id="heading-8">å°ç»“</h5>
<p>ä¸Šé¢æˆ‘ä»¬é€šè¿‡äº†ä¸¤ä¸ªé˜¶æ®µï¼ˆmount é˜¶æ®µå’Œ update é˜¶æ®µï¼‰æ¥å‰–æäº† zustand è·Ÿ react cored çš„æ¡¥æ¥åŸç† ï¼ˆä¾èµ–åŸç”Ÿ API <code>useSyncExternalStore</code> å¯¹è®¢é˜…å¤–éƒ¨æ•°æ®æºçš„æ”¯æŒï¼‰ï¼Œå¹¶ä½¿ç”¨æ—¶åºå›¾æ¥å±•ç¤ºäº†ä¸‰ä¸ªå‚ä¸æ–¹ï¼ˆç”¨æˆ·ä»£ç ï¼Œ zustandï¼Œ react coreï¼‰çš„äº¤äº’æµç¨‹ã€‚è¿™ä¸ªåŸç†å…¶å®å¯ä»¥ç”¨ä¸‰å¥è¯æ€»ç»“ä¸ºï¼š</p>
<ol>
<li>zustand store å®ä¾‹åˆ›å»º - å½“ç”¨æˆ·è°ƒç”¨ <code>create</code> æ–¹æ³•æ—¶å€™ï¼Œzustand ä¼šåˆ›å»ºä¸€ä¸ª store å®ä¾‹ï¼Œå¹¶ä½¿ç”¨ <code>useBoundStore</code> å‡½æ•°å®ä¾‹å°†å…¶é—­åŒ…ä¿å­˜åœ¨å†…å­˜ä¸­ï¼›</li>
<li>mount é˜¶æ®µ - react core åˆ©ç”¨ <code>useSyncExternalStore</code> å®ç°äº†å¯¹ zustand store å®ä¾‹çš„è®¢é˜…ã€‚å½“ store å®ä¾‹çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œzustand ä¼šé€šçŸ¥ react core ä¹‹å‰è®¢é˜…æ‰€æ³¨å†Œçš„ listenerã€‚react å†…éƒ¨ä¼šå†åˆ¤æ–­ä¸€æ¬¡æ–°æ—§å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚å¦‚æœå‘ç°æœ‰å˜åŒ–ï¼Œå°±ä¼šå¾€ scheduler å±‚å‘èµ·ä¸€ä¸ªæ›´æ–°è¯·æ±‚ã€‚</li>
<li>update é˜¶æ®µ - react core è¿˜ä¼šè°ƒç”¨ <code>getSnapshot</code> æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯ zustand store å®ä¾‹çš„ <code>getState</code> æ–¹æ³•ï¼‰ã€‚ç„¶åï¼Œè¿˜æ˜¯ä¼šæ¯”è¾ƒæ–°æ—§ snapshot çš„å€¼æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚å¦‚æœå‘ç°æœ‰å˜åŒ–ï¼Œå°±ä¼šæ›´æ–° hook å¯¹è±¡çš„ memorized å€¼ï¼Œæœ€åè¿”å›ç»™ç”¨æˆ·ä»£ç ã€‚</li>
</ol>
<p>å‰å‰ååï¼Œæ€»å…±åšäº†ä¸‰æ¬¡çš„ã€Œå€¼çš„æ¯”è¾ƒã€ï¼šzustand è°ƒç”¨ä¸€æ¬¡ <code>getState</code> æ–¹æ³•ï¼Œ react core è¿™è¾¹è°ƒç”¨äº†ä¸¤æ¬¡ <code>getState</code> æ–¹æ³•æ¥è¿›è¡Œæ–°æ—§ snapshot å€¼çš„æ¯”è¾ƒã€‚è¿™ä¸‰æ¬¡çš„å€¼çš„æ¯”è¾ƒç®—æ³•éƒ½æ˜¯ç”¨ <code>Object.is</code> æ–¹æ³•ã€‚å¦‚æ­¤çœ‹æ¥ï¼Œæ•´ä¸ªæµç¨‹ä¸­å†³å®šæ˜¯å¦è¦ã€Œå˜ã€çš„ç®—æ³•æ˜¯ä¿æŒä¸€è‡´çš„ã€‚</p>
<h4 data-id="heading-9">æŒ‰éœ€æ¸²æŸ“</h4>
<p>æ­£å¦‚å‰é¢çš„ã€Œç‰¹ç‚¹ã€æ‰€è¯´ï¼Œzustand æ˜¯å®ç°äº†ã€ŒæŒ‰éœ€ rerenderã€äº†ã€‚å½“ç„¶ï¼Œå‰ææ˜¯ä½ ä¹Ÿè¦åœ¨è°ƒç”¨ <code>useBoundStore</code> å‡½æ•°æ—¶ï¼Œä¼ å…¥ä¸€ä¸ª selector å‡½æ•°æ‰è¡Œã€‚</p>
<p>é‚£ä¸ºä»€ä¹ˆè¦æƒ³å®ç°æŒ‰éœ€ rerender å°±å¿…é¡»è¦ä¼ é€’ä¸€ä¸ª selector å‡½æ•°å‘¢ï¼Ÿå› ä¸ºå‡è®¾ä½ ä¸ä¼ é€’çš„è¯ï¼Œ zustand é»˜è®¤ä¼šé‡‡ç”¨ <code>(state) =&gt; state</code> è¿™ä¸ª selector å‡½æ•°ã€‚è€Œ zustand é‡Œé¢çš„å®ç°æ˜ç¡®æ˜¯æŒ‡å‡ºï¼Œä½ è¦æƒ³è®© zustand store é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ï¼Œä½ è°ƒç”¨ <code>setState</code> æ–¹æ³•æ—¶ï¼Œå¿…é¡»è¦ä¼ é€’ä¸€ä¸ªã€Œæ–°ã€çš„ state å€¼ã€‚</p>
<p><strong>é‡ç‚¹æ¥äº†ï¼Œè¿™ä¸ªã€Œæ–°ã€æ˜¯ä½“ç°åœ¨ã€Œå¼•ç”¨ã€æ˜¯æ–°çš„</strong>ï¼ˆå½“ç„¶ï¼Œ è¿™ä¸ªç»“è®ºæ˜¯å»ºç«‹åœ¨ç»å¤§éƒ¨åˆ† zustand store çš„ state éƒ½æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å¤åˆå¯¹è±¡ï¼‰ã€‚ ä½è¯ä»¥ä¸Šç»“è®ºçš„ä»£ç åœ¨ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createStoreImpl</span> = (<span class="hljs-params">createState</span>) =&gt; {
  <span class="hljs-keyword">let</span> state
  <span class="hljs-keyword">const</span> listeners = <span class="hljs-comment">/* @__PURE__ */</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setState</span> = (<span class="hljs-params">partial, replace</span>) =&gt; {
    <span class="hljs-keyword">const</span> nextState = <span class="hljs-keyword">typeof</span> partial === <span class="hljs-string">'function'</span> ? <span class="hljs-title function_">partial</span>(state) : partial
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(nextState, state)) {
      <span class="hljs-keyword">const</span> previousState = state
      state = (
        replace != <span class="hljs-literal">null</span>
          ? replace
          : <span class="hljs-keyword">typeof</span> nextState !== <span class="hljs-string">'object'</span> || nextState === <span class="hljs-literal">null</span>
      )
        ? nextState
        : <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, state, nextState)
      listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">listener</span>) =&gt;</span> <span class="hljs-title function_">listener</span>(state, previousState))
    }
  }
  <span class="hljs-comment">// ......</span>
  <span class="hljs-keyword">return</span> api
}
</code></pre>
<p>ä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåªæœ‰åœ¨ä½ è°ƒç”¨ <code>setState</code> æ–¹æ³•æ—¶ï¼Œä¼ é€’çš„æ˜¯ä¸€ä¸ªæ–°å¼•ç”¨ï¼Œzustand æ‰ä¼šå»æ›´æ–° store çš„ state å€¼ã€‚è€Œæ— è®ºä½ æŒ‡å®šçš„æ˜¯å¦æ˜¯ replace æ¨¡å¼ï¼Œæœ€ç»ˆï¼Œzustand store å®ä¾‹çš„ state å€¼ï¼Œéƒ½æ˜¯ä¸€ä¸ªæ–°çš„å¼•ç”¨ã€‚</p>
<p>é‚£è¿™å°±æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿä¸å¦¨å…ˆåš¼ä¸€åš¼ä¸‹é¢çš„è¿™æ®µä»£ç ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useStore</span>(<span class="hljs-params">api, selector = identity</span>) {
  <span class="hljs-keyword">const</span> slice = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useSyncExternalStore</span>(
    api.<span class="hljs-property">subscribe</span>,
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getState</span>()), [api, selector]),
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getInitialState</span>()), [api, selector]),
  )
  <span class="hljs-comment">// ......</span>
  <span class="hljs-keyword">return</span> slice
}
</code></pre>
<p>ä»ä¸Šé¢çš„å‰–ææˆ‘ä»¬çŸ¥é“ï¼Œ<code>() =&gt; selector(api.getState())</code> å°±æ˜¯ zustand æäº¤ç»™ react core çš„ <code>getSnapshot</code> æ–¹æ³•ã€‚å½“ zustand store é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ª <code>getSnapshot</code> æ–¹æ³•æ¥è·å–æœ€æ–°çš„ state å€¼ã€‚å¦‚æœæˆ‘ä»¬ä¸ä¼ å…¥ selector å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨ react core åœ¨è®¡ç®—æœ€æ–° snapshot å€¼çš„æ—¶å€™å°±æ˜¯ç›¸å½“äºæ‹¿åˆ°çš„æ˜¯ zustand store å®ä¾‹çš„è®¡ç®—å‡ºæ¥çš„æœ€æ–° state å€¼ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">selector</span> = (<span class="hljs-params">arg</span>) =&gt; arg
<span class="hljs-keyword">const</span> nextSnapshot = <span class="hljs-title function_">selector</span>(api.<span class="hljs-title function_">getState</span>()) = api.<span class="hljs-title function_">getState</span>()
</code></pre>
<p>å› ä¸ºæ­¤æ—¶è°ƒç”¨ <code>api.getState()</code> å¿…å®šæ˜¯æ‹¿åˆ°ä¸€ä¸ª zustand æ–°è®¡ç®—å‡ºæ¥çš„ state å€¼ã€‚æ ¹æ® <code>useSyncExternalStore</code> çš„å®ç°ï¼Œreact core å°±ä¼šä¸ºå½“å‰çš„ç»„ä»¶å‘èµ·ä¸€æ¬¡å¼ºåˆ¶ render çš„è¯·æ±‚ã€‚</p>
<p>å›åˆ°ä¸Šé¢çš„é—®é¢˜ï¼šâ€œé‚£è¿™å°±æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿâ€ã€‚è¿™æ„å‘³ç€åªè¦ä½ æœ‰ä¸€ä¸ª <code>useBoundStore</code> å‡½æ•°åœ¨è°ƒç”¨çš„æ—¶å€™æ²¡æœ‰ä¼ å…¥ selectorï¼Œé‚£ä¹ˆåœ¨ä»»æ„ä¸€ä¸ªåœ°æ–¹çš„ä»»æ„ä¸€ä¸ª <code>setState()</code> çš„è°ƒç”¨éƒ½ä¼šå¯¼è‡´è¿™ä¸ªç»„ä»¶ä¼šå‘ç”Ÿé‡æ¸²æŸ“ï¼Œè€Œä¸ç®¡ä½ åœ¨å½“å‰ç»„ä»¶æ‰€æ¶ˆè´¹çš„ state å€¼æ˜¯å¦æœ‰å‘ç”Ÿå˜åŒ–ã€‚æ¯”å¦‚ä¸‹é¢çš„å†™æ³•ä¸­çš„ <code>&lt;ComponentB /&gt;</code>å°±ä¼šå¯¼è‡´ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å®šä¹‰ä¸€ä¸ª Zustand store</span>
<span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>

<span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> })),
  <span class="hljs-attr">setName</span>: <span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> <span class="hljs-title function_">set</span>({ name }),
}))

<span class="hljs-comment">// ç»„ä»¶ Aï¼šåªå…³å¿ƒ count</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ComponentA</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span>) <span class="hljs-comment">// ä½¿ç”¨ selectorï¼Œåªè®¢é˜… count</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ComponentA rendered'</span>)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}

<span class="hljs-comment">// ç»„ä»¶ Bï¼šæ²¡æœ‰ä½¿ç”¨ selectorï¼Œç›´æ¥è·å–æ•´ä¸ª state</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ComponentB</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">useStore</span>() <span class="hljs-comment">// æ²¡æœ‰ä½¿ç”¨ selectorï¼Œè·å–æ•´ä¸ª state</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ComponentB rendered'</span>)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Name: {state.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}

<span class="hljs-comment">// çˆ¶ç»„ä»¶ï¼šåŒ…å«ä¸¤ä¸ªå­ç»„ä»¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ComponentA</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ComponentB</span> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>
</code></pre>
<ul>
<li>ComponentA ä½¿ç”¨äº† selectorï¼Œåªè®¢é˜…äº† count å­—æ®µã€‚å½“ count å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒComponentA ä¼šé‡æ–°æ¸²æŸ“ï¼›å½“ name å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒComponentA ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚</li>
<li>ComponentB æ²¡æœ‰ä½¿ç”¨ selectorï¼Œç›´æ¥è·å–äº†æ•´ä¸ª stateã€‚é‚£ä¹ˆå½“æˆ‘è°ƒç”¨ <code>setState</code> æ–¹æ³•å»æ›´æ–° count çš„æ—¶å€™ï¼ŒComponentB ä¼šé‡æ–°æ¸²æŸ“ã€‚è€Œè¿™æ­£æ˜¯ä¸å¿…è¦çš„æ¸²æŸ“ - å› ä¸ºæˆ‘ç»„ä»¶å†…éƒ¨æ ¹æœ¬å°±æ²¡æœ‰ä½¿ç”¨åˆ° count è¿™ä¸ªå­—æ®µã€‚</li>
</ul>
<p><strong>é€šè¿‡ selector å‡½æ•°ï¼Œæˆ‘ä»¬å‘ŠçŸ¥äº† react core å¯¹æ¯”æ–°æ—§ snapshot å€¼çš„æ—¶å€™æ˜¯ä» state è¿™é¢—æ ‘ä¸Šæ‘˜ä¸‹å“ªä¸ªåˆ†æ”¯çš„å€¼æ¥åšæ¯”è¾ƒã€‚åªæœ‰å½“è¿™ä¸ªåˆ†æ”¯çš„å€¼å‘ç”Ÿäº†æ”¹å˜ï¼Œreact core æ‰èƒ½å°†å½“å‰ç»„ä»¶æ ‡è®°ä¸ºéœ€è¦ rerenderã€‚è¿™å°±æ˜¯ zustand + react å€ŸåŠ© selector å‡½æ•°å®ç°æŒ‰éœ€ rerender çš„åŸç†ã€‚</strong></p>
<h2 data-id="heading-10">æ€»ç»“</h2>
<p>ä½œä¸ºç®€åŒ–ç‰ˆçš„ redux æˆ–è€…æ˜¯è¯´ redux çš„ç»§ä»»è€…ï¼Œzustand å…·æœ‰ä»¥ä¸‹ä¸‰ä¸ªç‰¹ç‚¹ï¼š</p>
<ul>
<li>çµæ´»</li>
<li>ç®€å•</li>
<li>é«˜æ€§èƒ½</li>
</ul>
<p>å› æ­¤ï¼Œzustand æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„çŠ¶æ€ç®¡ç†åº“ï¼Œç‰¹åˆ«é€‚åˆä¸­å°å‹è§„æ¨¡çš„å‰ç«¯é¡¹ç›®ã€‚</p>
<p>åœ¨æºç å±‚é¢ï¼Œzustand é‡‡ç”¨å¹³å°æ— å…³çš„æºç å®ç°æ¶æ„ï¼ŒåŒ…æ‹¬äº†ä¸¤å±‚ï¼š</p>
<ul>
<li>vanilla å±‚ï¼›</li>
<li>react binding å±‚</li>
</ul>
<p>vanilla å±‚ä¸»è¦æ˜¯åˆ©ç”¨ã€Œé—­åŒ…ã€å’Œã€Œå‘å¸ƒè®¢é˜…ã€æ¨¡å¼æ¥å®ç°äº† zustand store å®ä¾‹çš„åˆ›å»ºï¼ŒçŠ¶æ€æ›´æ–°ï¼Œå’Œé€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ã€‚è¿™é‡Œçš„ä»£ç è·Ÿ redux core çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚</p>
<p>åœ¨ react binding å±‚ä¸»è¦æ˜¯å€ŸåŠ© react åŸç”Ÿ API <code>useSyncExternalStore</code> æ¥ä¸¤å°† zustand core å’Œ react core æ¡¥æ¥åˆ°ä¸€å—ã€‚</p>
<p>å¦‚æ­¤ä¸€æ ·ï¼Œä½¿ç”¨ zustand ä½œä¸ºçŠ¶æ€ç®¡ç†ç±»åº“ï¼Œè¦æƒ³è§¦å‘ä¸€ä¸ªç»„ä»¶é‡æ¸²æŸ“ï¼Œå¿…é¡»è¦è¿‡ä¸¤ä¸ªå…³å¡ï¼š</p>
<ul>
<li>è°ƒç”¨ <code>setState(newState)</code> æ—¶å€™ä¼ å…¥çš„ newState å€¼å¿…é¡»æ˜¯ä¸€ä¸ªæ–°å¼•ç”¨æˆ–è€…<code>setState(ï¼ˆprevStateï¼‰=&gt; newState)</code>æƒ…å†µä¸‹<code>ï¼ˆprevStateï¼‰=&gt; newState</code> è¿”å›çš„å¿…é¡»æ˜¯ä¸€ä¸ªæ–°å¼•ç”¨ã€‚</li>
<li>å½“ zustand é€šçŸ¥æ‰€æœ‰çš„ listener çš„æ—¶å€™ï¼Œreact core è¿˜ä¼šè¿›è¡Œä¸€æ¬¡çš„æ–°æ—§ snapshot çš„æ¯”è¾ƒã€‚åªæœ‰æ–°æ—§ snapshot ä¸åŒï¼Œæ‰ä¼šè§¦å‘ç»„ä»¶çš„é‡æ¸²æŸ“ã€‚</li>
</ul>
<p>æœ€åï¼Œæˆ‘ä»¬å‰–æäº† zustand å®ç°æŒ‰éœ€ rerender çš„åŸç†ã€‚æœ¬è´¨ä¸Šå°±æ˜¯åœ¨ä¸Šé¢çš„ç¬¬äºŒä¸ªå…³å¡ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŒ‡å®šä¸€ä¸ª selector å‡½æ•° æ¥å‘ŠçŸ¥ react core åº”è¯¥ä» state è¿™æ ‘ä¸Šæ‘˜ä¸‹å“ªä¸ªåˆ†æ”¯çš„å€¼æ¥åšæ–°æ—§å€¼çš„æ¯”è¾ƒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GLSurfaceViewåŸç†æ·±åº¦å‰–æï¼šä»OpenGL ESåˆ°Androidå±å¹•çš„æ¸²æŸ“ä¹‹æ—…]]></title>    <link>https://juejin.cn/post/7579168400989093923</link>    <guid>https://juejin.cn/post/7579168400989093923</guid>    <pubDate>2025-12-03T03:43:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579168400989093923" data-draft-id="7579165599042437135" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GLSurfaceViewåŸç†æ·±åº¦å‰–æï¼šä»OpenGL ESåˆ°Androidå±å¹•çš„æ¸²æŸ“ä¹‹æ—…"/> <meta itemprop="keywords" content="OpenGL"/> <meta itemprop="datePublished" content="2025-12-03T03:43:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èŠ‚èŠ‚è™«"/> <meta itemprop="url" content="https://juejin.cn/user/1706083975700750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GLSurfaceViewåŸç†æ·±åº¦å‰–æï¼šä»OpenGL ESåˆ°Androidå±å¹•çš„æ¸²æŸ“ä¹‹æ—…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1706083975700750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èŠ‚èŠ‚è™«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:43:13.000Z" title="Wed Dec 03 2025 03:43:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€èƒŒæ™¯ï¼šä¸ºä½•éœ€è¦GLSurfaceViewï¼Ÿ</h2>
<p>åœ¨åº”ç”¨å¼€å‘ä¸­ï¼Œå›¾å½¢ç»˜åˆ¶é€šå¸¸é€šè¿‡å„ç§<code>é«˜çº§API</code>å¦‚Android Canvasçš„<code>drawXXX</code>æ–¹æ³•å®Œæˆã€‚ä½†è¿™äº›æ¥å£é€šå¸¸ç»è¿‡äº†å±‚å±‚å°è£…ï¼Œåº•å±‚å¤æ‚çš„å›¾å½¢åº“è°ƒç”¨å¯¹å¼€å‘è€…é€æ˜ï¼Œæˆ‘ä»¬ä¸çŸ¥é“Canvasä»å“ªæ¥ï¼Œä¹Ÿä¸çŸ¥é“ç»˜åˆ¶æ–¹æ³•åˆ°åº•åšäº†å•¥ã€‚</p>
<p>æœ‰æ²¡æœ‰åŠæ³•å¯ä»¥çª¥æ¢appåº•å±‚è°ƒç”¨å›¾å½¢åº“æ¥å£å‘¢ï¼Ÿâ€”â€”ç­”æ¡ˆå°±æ˜¯<code>GLSurfaceView</code>ã€‚</p>
<p>GLSurfaceViewè™½ç„¶ç»§æ‰¿è‡ªSurfaceViewï¼Œä½†ä¸¤è€…å´æœ‰æœ¬è´¨åŒºåˆ«ï¼š</p>
<ul>
<li>
<p><strong>SurfaceViewï¼š</strong> é€šè¿‡Canvasé«˜çº§æ¥å£ç»˜åˆ¶ï¼Œç»å†HWUIæ”¶é›†æŒ‡ä»¤â†’Skiaå›¾å½¢åº“è½¬æ¢â†’OpenGL/Vulkanåº•å±‚è°ƒç”¨çš„å¤æ‚æµç¨‹</p>
</li>
<li>
<p><strong>GLSurfaceViewï¼š</strong> æä¾›ç›´æ¥çš„OpenGLåŸå§‹ç»˜åˆ¶æŒ‡ä»¤è°ƒç”¨ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿç›´æ¥æ“æ§åº•å±‚å›¾å½¢æ¸²æŸ“</p>
</li>
</ul>
<p>æœ¬æ–‡å°†æ·±å…¥åˆ†æGLSurfaceViewå¦‚ä½•æ¶èµ·åº”ç”¨å±‚ä¸OpenGL ESä¹‹é—´çš„æ¡¥æ¢ã€‚</p>
<h2 data-id="heading-1">äºŒã€GLSurfaceViewåŸºç¡€ä½¿ç”¨</h2>
<p>åœ¨æ·±å…¥ä¹‹å‰å…ˆçœ‹ä¸€ä¸‹GLSurfaceViewä½¿ç”¨çš„ç®€å•ä¾‹å­ï¼ŒGLSurfaceViewä½œä¸ºä¸€ä¸ªæ™®é€šçš„Viewå¯ä»¥åµŒå…¥åˆ°Androidçš„Viewæ ‘ä¸Šï¼Œé€šè¿‡setRendereræ¥å£è®¾ç½®ä¸€ä¸ªRendererå¯¹è±¡ï¼ŒRendereræ¥å£æœ‰3ä¸ªæ–¹æ³•ï¼š<code>onSurfaceCratedã€onSurfaceChangedã€onDrawFrameï¼Œ</code>åå­—å¾ˆæ¸…æ™°ï¼Œåˆ†åˆ«è¡¨ç¤ºï¼š<code>Surfaceåˆå§‹åŒ–å®Œæˆã€Surfaceå¤§å°æ”¹å˜ã€ç»˜åˆ¶ä¸€å¸§</code>ï¼Œæ‰€ä»¥åœ¨åº”ç”¨ç«¯è°ƒç”¨å°±æ˜¯é€šè¿‡åœ¨onDrawFrameé‡Œç›´æ¥è°ƒç”¨GLE20æä¾›çš„ç»˜åˆ¶æ–¹æ³•è¿›è¡Œç»˜åˆ¶ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// GLSurfaceViewä½¿ç”¨çš„ç®€å•ä¾‹å­</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GLSurfaceViewDemo</span> : Activity() {
Â Â Â Â override fun <span class="hljs-title function_">onCreate</span><span class="hljs-params">(savedInstanceState: Bundle?)</span> {
Â Â Â Â Â Â Â Â <span class="hljs-built_in">super</span>.onCreate(savedInstanceState)
Â Â Â Â Â Â Â Â <span class="hljs-type">val</span> <span class="hljs-variable">glSurfaceView</span> <span class="hljs-operator">=</span> GLSurfaceView(<span class="hljs-built_in">this</span>)

Â Â Â Â Â Â Â Â <span class="hljs-comment">// å…³é”®é…ç½®</span>
Â Â Â Â Â Â Â Â glSurfaceView.setEGLContextClientVersion(<span class="hljs-number">2</span>)Â Â <span class="hljs-comment">// ä½¿ç”¨OpenGL ES 2.0</span>
Â Â Â Â Â Â Â Â glSurfaceView.renderMode = GLSurfaceView.RENDERMODE_WHEN_DIRTYÂ Â <span class="hljs-comment">// æŒ‰éœ€æ¸²æŸ“</span>
Â Â Â Â Â Â Â Â glSurfaceView.setRenderer(object : GLSurfaceView.Renderer {
Â Â Â Â Â Â Â Â Â Â Â Â override fun <span class="hljs-title function_">onSurfaceCreated</span><span class="hljs-params">(gl: GL10?, config: EGLConfig?)</span> {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">// è®¾ç½®æ¸…å±é¢œè‰²ä¸ºé»‘è‰²</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â GLES20.glClearColor(<span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>)
Â Â Â Â Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â Â Â Â Â override fun <span class="hljs-title function_">onSurfaceChanged</span><span class="hljs-params">(gl: GL10?, width: Int, height: Int)</span> {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">// è®¾ç½®è§†å£å¤§å°</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â GLES20.glViewport(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height)
Â Â Â Â Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â Â Â Â Â override fun <span class="hljs-title function_">onDrawFrame</span><span class="hljs-params">(gl: GL10?)</span> {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">// æ‰§è¡Œæ¸…å±æ“ä½œ</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT)
Â Â  Â Â Â  Â Â Â  Â Â  Â Â â€¦  
Â Â  Â Â Â  Â Â Â  Â Â  Â  <span class="hljs-comment">// å…¶ä»–GLç»˜åˆ¶æ–¹æ³•  </span>
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â })
Â Â Â Â Â Â Â Â setContentView(glSurfaceView)
Â Â Â Â }
}
</code></pre>
<p><strong>æ ¸å¿ƒç–‘é—®ï¼š</strong> ä¸ºä½•GLES20çš„é™æ€æ–¹æ³•è°ƒç”¨èƒ½å¤Ÿç›´æ¥ç»˜åˆ¶åˆ°Viewä¸Šï¼Ÿç­”æ¡ˆéšè—åœ¨GLSurfaceViewçš„å†…éƒ¨å®ç°ä¸­ã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€OpenGL ESæ¸²æŸ“åŸºç¡€ï¼šä»åº”ç”¨åˆ°å±å¹•çš„8ä¸ªå…³é”®æ­¥éª¤</h2>
<p>åœ¨æ·±å…¥GLSurfaceViewæºç å‰ï¼Œå…ˆäº†è§£æ ‡å‡†çš„OpenGL ESåº”ç”¨æ¸²æŸ“æµç¨‹ã€‚</p>
<p>åŒæ—¶æˆ‘ä»¬è¿˜éœ€è¦å›é¡¾ä¸€ä¸ªåè¯ï¼š<code>å¥æŸ„</code>ï¼ŒæŒæ¡è¿™ä¸ªåè¯çš„å«ä¹‰å¯¹åé¢å†…å®¹çš„ç†è§£æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚å¥æŸ„ä¸€èˆ¬è¡¨ç¤ºä¸€ä¸ªç³»ç»Ÿèµ„æºè¿”å›ç»™äº†ç”¨æˆ·ç«¯ï¼Œä½†ç”¨æˆ·ç«¯åªèƒ½è·å–å…¶æ ‡è¯†(ä¸€èˆ¬ä¸ºä¸€ä¸ªæ•´å½¢å˜é‡)ï¼Œä½†æ˜¯æ¯åŠæ³•è·å–å…¶ç±»å‹ï¼Œä¹Ÿä¸èƒ½è®¿é—®å†…éƒ¨å±æ€§ï¼Œæ¯”å¦‚Cé‡Œçš„FILE*ã€Javaé‡Œçš„File Descriptorç­‰éƒ½æ˜¯å¥æŸ„ã€‚OpenGL è¿™ç§æ·±åº¦å’Œç³»ç»Ÿæ‰“äº¤é“çš„äº¤äº’ä¼šå¤šæ¬¡ä½¿ç”¨å¥æŸ„çš„æ¦‚å¿µã€‚</p>
<p>ä»åº”ç”¨å‘èµ·ç»˜åˆ¶åˆ°ç”»é¢æ˜¾ç¤ºåˆ°å±å¹•ï¼Œéœ€è¦ç»å†ä¸‹é¢<code>8</code>ä¸ªå…³é”®æ­¥éª¤ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 1. è·å–æ˜¾ç¤ºè®¾å¤‡å¥æŸ„</span>
EGLDisplay display = eglGetDisplay(EGL_DEFAULT_DISPLAY)

<span class="hljs-comment">// 2. åˆå§‹åŒ–æ˜¾ç¤ºè¿æ¥Â Â </span>
eglInitialize(display, nullptr, nullptr)

<span class="hljs-comment">// 3. é€‰æ‹©é…ç½®ï¼ˆé¢œè‰²ã€æ·±åº¦ç­‰å‚æ•°ï¼‰</span>
eglChooseConfig(display, attributes, &amp;config, <span class="hljs-number">1</span>, &amp;num_config)

<span class="hljs-comment">// 4. åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡ï¼ˆåˆ†é…èµ„æºï¼Œç»´æŠ¤çŠ¶æ€æœºï¼‰</span>
EGLContext context = eglCreateContext(display, config, nullptr, attrs)

<span class="hljs-comment">// 5. åˆ›å»ºç»˜åˆ¶è¡¨é¢ï¼ˆè¿æ¥åŸç”Ÿçª—å£ç³»ç»Ÿï¼‰</span>
EGLSurface surface = eglCreateWindowSurface(display, config, window, nullptr)

<span class="hljs-comment">// 6. ç»‘å®šä¸Šä¸‹æ–‡åˆ°å½“å‰çº¿ç¨‹</span>
eglMakeCurrent(display, surface, surface, context)

<span class="hljs-comment">// 7. æ‰§è¡ŒOpenGLç»˜åˆ¶å‘½ä»¤</span>
glClear(GL_COLOR_BUFFER_BIT)
glDrawArrays(...)
<span class="hljs-comment">// åƒç´ æ•°æ®å†™å…¥åç¼“å†²åŒºï¼ˆBack Bufferï¼‰</span>
 
<span class="hljs-comment">// 8. äº¤æ¢ç¼“å†²åŒºï¼Œæ˜¾ç¤ºåˆ°å±å¹•</span>
eglSwapBuffers(display, surface)
</code></pre>
<p>è¿™<code>8ä¸ªæ­¥éª¤æ„æˆäº†ä»»ä½•OpenGL ESåº”ç”¨çš„åŸºç¡€æ¡†æ¶</code>ï¼ŒGLSurfaceViewæ­£æ˜¯åœ¨Javaå±‚å®ç°äº†è¿™ä¸€æµç¨‹ã€‚</p>
<h2 data-id="heading-3">å››ã€GLSurfaceViewæºç æ·±åº¦è§£æ</h2>
<h4 data-id="heading-4">4.1 åˆå§‹åŒ–å…¥å£ï¼šsetRendereræ–¹æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRenderer</span><span class="hljs-params">(Renderer renderer)</span> {
Â Â Â Â checkRenderThreadState()Â Â <span class="hljs-comment">// ç¡®ä¿åªè®¾ç½®ä¸€æ¬¡</span>

Â Â Â Â <span class="hljs-comment">// åˆå§‹åŒ–é»˜è®¤é…ç½®å·¥å‚</span>
Â Â Â Â <span class="hljs-keyword">if</span> (mEGLConfigChooser == <span class="hljs-literal">null</span>) {
Â Â Â Â Â Â Â Â mEGLConfigChooser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleEGLConfigChooser</span>(<span class="hljs-literal">true</span>)
Â Â Â Â }

Â Â Â Â <span class="hljs-keyword">if</span> (mEGLContextFactory == <span class="hljs-literal">null</span>) {
Â Â Â Â Â Â Â Â mEGLContextFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultContextFactory</span>()
Â Â Â Â }

Â Â Â Â <span class="hljs-keyword">if</span> (mEGLWindowSurfaceFactory == <span class="hljs-literal">null</span>) {
Â Â Â Â Â Â Â Â mEGLWindowSurfaceFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultWindowSurfaceFactory</span>()
Â Â Â Â }
Â Â Â 
Â Â Â Â mRenderer = <span class="hljs-type">renderer</span>
Â Â Â Â <span class="hljs-variable">mGLThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLThread</span>(mThisWeakRef)Â Â <span class="hljs-comment">// åˆ›å»ºä¸“å±æ¸²æŸ“çº¿ç¨‹</span>
Â Â Â Â mGLThread.start()
}
</code></pre>
<p>è¿™é‡Œåˆ›å»ºäº†ä¸‰ä¸ªæ ¸å¿ƒå·¥å‚å¯¹è±¡ï¼Œåˆ†åˆ«è´Ÿè´£EGLé…ç½®é€‰æ‹©ã€ä¸Šä¸‹æ–‡åˆ›å»ºå’Œè¡¨é¢ç®¡ç†ã€‚</p>
<h4 data-id="heading-5">4.2 GLThreadï¼šæ¸²æŸ“çº¿ç¨‹çš„æ ¸å¿ƒå¼•æ“</h4>
<p>GLThreadçš„<code>guardedRun()</code>æ–¹æ³•æ˜¯æ•´ä¸ªæ¸²æŸ“æµç¨‹çš„è°ƒåº¦ä¸­å¿ƒï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">guardedRun</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
Â Â Â Â mEglHelper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EglHelper</span>(mGLSurfaceViewWeakRef);
Â Â Â Â mHaveEglContext = <span class="hljs-literal">false</span>;
Â Â Â Â mHaveEglSurface = <span class="hljs-literal">false</span>;
Â Â Â Â mWantRenderNotification = <span class="hljs-literal">false</span>;


Â Â Â Â <span class="hljs-keyword">try</span> {
Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) { <span class="hljs-comment">// æ¸²æŸ“å¾ªç¯</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">synchronized</span> (sGLThreadManager) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) { <span class="hljs-comment">// æ§åˆ¶å¾ªç¯</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span> (readyToDraw()) { <span class="hljs-comment">// å‡†å¤‡ç»˜åˆ¶</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//åˆ›å»ºEGLContextä¸Šä¸‹æ–‡</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â mEglHelper.start();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â  Â Â Â  Â Â Â  Â Â Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  ...
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">//åˆ›å»ºEGLSurfaceï¼ŒæŠŠViewçš„Surfaceå°è£…æˆEGLSurfaceç»™OpenGLç»˜åˆ¶</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">if</span> (mEglHelper.createSurface()) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â  Â  Â  Â  Â  Â  Â  Â  }

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">// åœ¨è¿™ä¹‹åï¼Œå½“å‰çº¿ç¨‹ä¾¿å¯ä»¥æ‰§è¡Œç»˜åˆ¶æ“ä½œäº†</span>

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//è·å–GLå¯¹è±¡ï¼ŒåŒ…è£…OpenGL APIç¯å¢ƒï¼Œè¿™é‡Œä½¿ç”¨GL10</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â gl = (GL10) mEglHelper.createGL();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//å›è°ƒå¤–éƒ¨Rendererå¯¹è±¡çš„`onSurfaceCreated()`æ–¹æ³•</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">GLSurfaceView</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> mGLSurfaceViewWeakRef.get();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â view.mRenderer.onSurfaceCreated(gl, mEglHelper.mEglConfig);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span> (sizeChanged) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//å›è°ƒå¤–éƒ¨Rendererå¯¹è±¡çš„`onSurfaceChanged()`æ–¹æ³•</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â view.mRenderer.onSurfaceChanged(gl, w, h);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//å›è°ƒå¤–éƒ¨Rendererå¯¹è±¡çš„`onDrawFrame()`æ–¹æ³•</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â view.mRenderer.onDrawFrame(gl);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Egläº¤äº’å†…å­˜ï¼Œopenglä½¿ç”¨çš„åŒå†…å­˜ç¼“å†²ï¼Œä¸€ä¸ªè¿›è¡Œæ˜¾ç¤ºï¼Œå¦ä¸€ä¸ªåˆ™åå°è¿›è¡Œç»˜åˆ¶ï¼Œç»˜åˆ¶OKåï¼Œäº¤äº’å†…å­˜è¿›è¡Œæ˜¾ç¤º</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">int</span> <span class="hljs-variable">swapError</span> <span class="hljs-operator">=</span> mEglHelper.swap();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ...
Â Â Â Â Â Â Â Â }
Â Â Â Â } <span class="hljs-keyword">finally</span> {
Â Â  Â Â Â  Â <span class="hljs-keyword">synchronized</span> (sGLThreadManager) {
Â Â  Â Â Â  Â Â Â  Â stopEglSurfaceLocked();
Â Â  Â Â Â  Â Â Â  Â stopEglContextLocked();
Â Â  Â Â Â  Â }
Â Â Â }
}


<span class="hljs-comment">// æ˜¯å¦å¯ä»¥ç»˜åˆ¶å†…å®¹äº†</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">readyToDraw</span><span class="hljs-params">()</span> {
Â Â Â Â <span class="hljs-keyword">return</span> (!mPaused)Â Â <span class="hljs-comment">// æ²¡æœ‰æš‚åœ</span>
Â Â Â Â Â Â Â Â Â Â Â Â &amp;&amp; mHasSurfaceÂ Â <span class="hljs-comment">// Surfaceæ˜¯å¦å·²ç»åˆ›å»º(æ³¨æ„Surfaceå’ŒEGLSurfaceæ˜¯ä¸ä¸€æ ·çš„)</span>
Â Â Â Â Â Â Â Â Â Â Â Â &amp;&amp; (!mSurfaceIsBad) <span class="hljs-comment">// EGLSurfaceæ˜¯å¦å¯ç”¨</span>
Â Â Â Â Â Â Â Â Â Â Â Â &amp;&amp; (mWidth &gt; <span class="hljs-number">0</span>)Â Â <span class="hljs-comment">// Surfaceçš„å¤§å°</span>
Â Â Â Â Â Â Â Â Â Â Â Â &amp;&amp; (mHeight &gt; <span class="hljs-number">0</span>)
Â Â Â Â Â Â Â Â Â Â Â Â &amp;&amp; (mRequestRender || (mRenderMode == RENDERMODE_CONTINUOUSLY)Â Â <span class="hljs-comment">// æ‰‹åŠ¨åˆ·æ–°æˆ–è€…è‡ªåŠ¨åˆ·æ–°</span>
Â Â Â Â );
}
</code></pre>
<p>guardedRunæ–¹æ³•æ¯”è¾ƒå¤æ‚ï¼Œå†…éƒ¨å¯åŠ¨ä¸¤ä¸ªå¾ªç¯ï¼Œå¤–å¾ªç¯æ˜¯æ¸²æŸ“å¾ªç¯ï¼Œæ¯ä¸ªå¾ªç¯éƒ½ä¼šç»˜åˆ¶ä¸€å¸§ï¼Œ å†…éƒ¨å¾ªç¯çŠ¶æ€æ£€æŸ¥å„ç§çŠ¶æ€ã€‚ä»readyToDraw()æ–¹æ³•å¼€å§‹çœ‹ï¼Œè¿™ä¸ªæ–¹æ³•è¡¨ç¤ºå½“å‰å‡†å¤‡å¥½ å¯ä»¥å¼€å§‹ç»˜åˆ¶äº†ã€‚readToDraw()æ£€æŸ¥å½“å‰æ˜¯å¦å¯ä»¥è¿›è¡Œç»˜åˆ¶ï¼Œå¦‚æœå¯ä»¥è¿›è¡Œç»˜åˆ¶ï¼Œåˆ™å¼€å§‹OpenGLä¸Šä¸‹æ–‡çš„åˆå§‹åŒ–ã€‚</p>
<p><strong>EglHelper.start()</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> {
Â  Â  ...  
Â Â Â Â mEgl = (EGL10) EGLContext.getEGL()Â Â <span class="hljs-comment">// è·å–EGLå®ä¾‹</span>
Â  Â  ...

Â Â Â Â <span class="hljs-comment">// æ­¥éª¤1ï¼šè·å–æ˜¾ç¤ºè®¾å¤‡</span>
Â Â Â Â mEglDisplay = mEgl.eglGetDisplay(EGL10.EGL_DEFAULT_DISPLAY)
Â Â Â Â  ...

Â Â Â Â <span class="hljs-comment">// æ­¥éª¤2ï¼šåˆå§‹åŒ–æ˜¾ç¤ºè¿æ¥</span>
Â Â Â Â mEgl.eglInitialize(mEglDisplay, version)
Â Â Â Â  ...

Â Â Â Â <span class="hljs-comment">// æ­¥éª¤3ï¼šé€‰æ‹©é…ç½®</span>
Â Â Â Â mEglConfig = view.mEGLConfigChooser.chooseConfig(mEgl, mEglDisplay)
Â Â Â Â  ...

Â Â Â Â <span class="hljs-comment">// æ­¥éª¤4ï¼šåˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡</span>
Â Â Â Â mEglContext = view.mEGLContextFactory.createContext(mEgl, mEglDisplay, mEglConfig)
}
</code></pre>
<p>è¿™é‡Œçš„æ­¥éª¤å°±å’Œå‰é¢ä»‹ç»çš„appä½¿ç”¨OpenGLçš„å‰æ­¥ä¸€æ ·ï¼Œå…ˆè·å–æ˜¾ç¤ºè®¾å¤‡çš„<code>å¥æŸ„</code>ï¼Œç„¶å<code>åˆå§‹åŒ–</code>ã€æ¥ç€è¿›è¡Œ<code>é…ç½®</code>ï¼Œæœ€ååˆ›å»º<code>GLç¯å¢ƒ</code>ã€‚</p>
<p>åˆ°è¿™é‡ŒGLä¸Šä¸‹æ–‡å°±åˆ›å»ºå¥½äº†ï¼Œ ä¸‹ä¸€æ­¥å°±æ˜¯åˆ›å»ºEGLSurfaceï¼Œ è¿™é‡Œå…ˆé‡ç‚¹ä»‹ç»ä¸‹EGLSurfaceå’ŒAndroidç³»ç»Ÿé‡Œçš„Surfaceçš„åŒºåˆ«ï¼Œé¦–å…ˆå®ƒä»¬éƒ½æ˜¯ç»˜åˆ¶è¡¨é¢çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯ç»˜åˆ¶ç›®æ ‡ï¼Œå†…éƒ¨éƒ½åŒ…å«äº†BufferQueueç”¨æ¥ä¿å­˜ç»˜åˆ¶çš„ç»“æœã€‚Surfaceæ˜¯Androidè‡ªèº«çš„æ¦‚å¿µï¼ŒEGLSurfaceæ˜¯OpenGLçš„æ¦‚å¿µï¼Œæ˜¯å¤¸å¹³å°çš„å’Œå¹³å°æ— å…³ï¼Œæ‰€ä»¥åœ¨Androidç³»ç»Ÿä¸Šæƒ³è¦é€šè¿‡OpenGLç»˜åˆ¶å†…å®¹çš„è¯ï¼Œè¦å°†åŸç”Ÿçª—å£ï¼ˆå¦‚ Android çš„ ANativeWindowï¼‰åŒ…è£…æˆ EGL Surfaceï¼Œä½œä¸º OpenGL çš„æ¸²æŸ“ç›®æ ‡ï¼Œè¿æ¥ OpenGL å’Œå¹³å°çª—å£ç³»ç»Ÿã€‚é€šä¿—ç‚¹çš„ç†è§£å°±æ˜¯OpenGLå†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ªEGLSurfaceï¼Œä½†æ˜¯FrameBuffer SurfaceViewå·²ç»æœ‰äº†ï¼Œæ‰€ä»¥éœ€è¦å°†SurfaceViewé‡ŒSurfaceçš„FrameBufferè®¾ç½®ç»™EGLSurfaceï¼Œ ç”¨æ¥ä½œä¸ºOpenGLçš„ç»˜åˆ¶ç›®æ ‡ã€‚</p>
<p><strong>Surfaceåˆ›å»ºä¸ç»‘å®šï¼šEglHelper.createSurface()</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">createSurface</span><span class="hljs-params">()</span> {
Â Â Â Â <span class="hljs-comment">// æ­¥éª¤5ï¼šåˆ›å»ºEGLSurfaceï¼ˆåŒ…è£…Androidçš„Surfaceï¼‰</span>
Â Â Â Â mEglSurface = view.mEGLWindowSurfaceFactory.createWindowSurface(
Â Â Â Â Â Â Â Â mEgl, mEglDisplay, mEglConfig, view.getHolder())

Â Â Â Â 
Â Â Â Â <span class="hljs-comment">// æ­¥éª¤6ï¼šç»‘å®šåˆ°å½“å‰çº¿ç¨‹</span>
Â Â Â Â <span class="hljs-keyword">return</span> mEgl.eglMakeCurrent(mEglDisplay, mEglSurface, mEglSurface, mEglContext)
}
</code></pre>
<p>æ¥ä¸‹æ¥mEgl.eglMakeCurrentå°†EGLSurfaceå’ŒEGLContextç»‘å®šåˆ°å½“å‰çº¿ç¨‹ï¼Œç”¨æ¥åœ¨å½“å‰çº¿ç¨‹åšç»˜åˆ¶ï¼Œ è¿™æ­¥åœ¨å†…éƒ¨ä¼šæŠŠContextå’ŒSurfaceè®¾ç½®åˆ°ThreadLocalStorageï¼Œ è¿™æ ·åœ¨åé¢çš„OpenGLç»˜åˆ¶å‘½ä»¤å°±ä¸éœ€è¦æ¯æ¬¡éƒ½ä¼ å…¥contextå‚æ•°äº†ã€‚</p>
<p>è¿™ä¸€æ­¥æ‰§è¡Œå®Œåï¼Œå‰é¢ä»‹ç»appä½¿ç”¨OpenGLæ¸²æŸ“<code>8</code>æ­¥çš„å‰<code>å…­</code>æ­¥å°±åšå®Œäº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯ç»˜åˆ¶å’Œç¼“å­˜äº¤æ¢ã€‚</p>
<p><strong>å›è°ƒRendererä¸šåŠ¡ç»˜åˆ¶å†…å®¹</strong></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨äº†å¤–éƒ¨è®¾ç½®çš„Rendererä¸‰ä¸ªæ¥å£ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//å›è°ƒå¤–éƒ¨Rendererå¯¹è±¡çš„`onSurfaceCreated()`æ–¹æ³•</span>
<span class="hljs-type">GLSurfaceView</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> mGLSurfaceViewWeakRef.get();
view.mRenderer.onSurfaceCreated(gl, mEglHelper.mEglConfig);
...
<span class="hljs-keyword">if</span> (sizeChanged) {
Â Â Â Â ...
Â Â Â Â <span class="hljs-comment">//å›è°ƒå¤–éƒ¨Rendererå¯¹è±¡çš„`onSurfaceChanged()`æ–¹æ³•</span>
Â Â Â Â view.mRenderer.onSurfaceChanged(gl, w, h);
Â Â Â Â ...
}
...

<span class="hljs-comment">//å›è°ƒå¤–éƒ¨Rendererå¯¹è±¡çš„`onDrawFrame()`æ–¹æ³•</span>
view.mRenderer.onDrawFrame(gl);
</code></pre>
<p>è¿™æ—¶ç”¨æˆ·ä¸€èˆ¬å°±åœ¨onDrawFrame()é‡Œè°ƒç”¨OpenGLçš„ç»˜åˆ¶ï¼Œæ–¹æ³•æ‰§è¡Œå®Œä¹‹åç»˜åˆ¶æ•°æ®åˆ°äº†Surfaceé‡ŒBufferQueueé‡Œåç«¯ï¼Œæ¥ç€è°ƒç”¨<code>mEglHelper.swap()</code>æŠŠæ•°æ®æ˜¾ç¤ºç»™å‰ç«¯ã€‚</p>
<p><strong>ç¼“å†²åŒºäº¤æ¢ï¼šEglHelper.swap()</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">swap</span><span class="hljs-params">()</span> {
Â Â Â Â <span class="hljs-comment">// æ­¥éª¤8ï¼šäº¤æ¢å‰åç¼“å†²åŒº</span>
Â Â Â Â <span class="hljs-keyword">if</span> (!mEgl.eglSwapBuffers(mEglDisplay, mEglSurface)) {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span> mEgl.eglGetError()
Â Â Â Â }
Â Â Â Â <span class="hljs-keyword">return</span> EGL10.EGL_SUCCESS
}
</code></pre>
<p>mEglHelper.swap()çš„ä»£ç  SurfaceViewä½¿ç”¨åŒå†…å­˜ç¼“å†²æœºåˆ¶ï¼Œå†…éƒ¨æœ‰ä¸¤ä¸ªFrambufferï¼Œä¸€ä¸ªè¿›è¡Œå‰å°æ˜¾ç¤ºï¼Œå¦ä¸€ä¸ªåˆ™åå°è¿›è¡Œç»˜åˆ¶ï¼Œç»˜åˆ¶OKåï¼Œäº¤äº’å†…å­˜è¿›è¡Œæ˜¾ç¤ºã€‚eglSwapBuffersçš„ç›®çš„æ˜¯æ¸²æŸ“å¥½çš„FrameBufferå’Œå‰å°çš„Framebufferäº¤äº’åæ˜¾ç¤ºå‡ºæ¥</p>
<h4 data-id="heading-6">4.3 ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šæš‚åœä¸æ¢å¤æœºåˆ¶</h4>
<ul>
<li>
<p>æš‚åœå®ç°</p>
</li>
</ul>
<pre><code class="hljs language-java" lang="java">mRequestPaused = <span class="hljs-literal">true</span>
sGLThreadManager.notifyAll()Â Â <span class="hljs-comment">// å”¤é†’ç­‰å¾…çš„æ¸²æŸ“çº¿ç¨‹</span>
</code></pre>
<p>åœ¨æ¸²æŸ“å¾ªç¯ä¸­æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (mPaused != mRequestPaused) {
Â Â Â Â pausing = <span class="hljs-type">mRequestPaused</span>
Â Â Â Â <span class="hljs-variable">mPaused</span> <span class="hljs-operator">=</span> mRequestPaused

Â Â Â Â <span class="hljs-title function_">if</span> <span class="hljs-params">(pausing)</span> {
Â Â Â Â Â Â Â Â <span class="hljs-comment">// é‡Šæ”¾EGLSurfaceå’ŒEGLContextï¼ˆå¯é€‰ï¼‰</span>
Â Â Â Â Â Â Â Â stopEglSurfaceLocked()
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span> (!preserveEglContextOnPause) {
Â Â Â Â Â Â Â Â Â Â Â Â stopEglContextLocked()
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}
</code></pre>
<p>æš‚åœåï¼Œ<code>readyToDraw()</code>è¿”å›falseï¼Œæ¸²æŸ“çº¿ç¨‹åœ¨å†…éƒ¨å¾ªç¯ä¸­ç­‰å¾…ã€‚</p>
<p>*æ¢å¤å®ç°</p>
<p>onResume()å°†çŠ¶æ€é‡ç½®ï¼š</p>
<pre><code class="hljs language-java" lang="java">mRequestPaused = <span class="hljs-type">false</span>
<span class="hljs-variable">mRequestRender</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
sGLThreadManager.notifyAll()
</code></pre>
<p>æ¸²æŸ“çº¿ç¨‹æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–åé‡æ–°åˆå§‹åŒ–EGLç¯å¢ƒå¹¶ç»§ç»­æ¸²æŸ“å¾ªç¯ã€‚</p>
<h4 data-id="heading-7">4.4 çº¿ç¨‹é€€å‡ºæœºåˆ¶</h4>
<p>GLThreadé€šè¿‡mShouldExitæ ‡å¿—æ§åˆ¶é€€å‡ºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestExitAndWait</span><span class="hljs-params">()</span> {
Â Â Â Â <span class="hljs-keyword">synchronized</span>(sGLThreadManager) {
Â Â Â Â Â Â Â Â mShouldExit = <span class="hljs-literal">true</span>
Â Â Â Â Â Â Â Â sGLThreadManager.notifyAll()
Â Â Â Â Â Â Â Â <span class="hljs-keyword">while</span> (!mExited) {
Â Â Â Â Â Â Â Â Â Â Â Â sGLThreadManager.wait()Â Â <span class="hljs-comment">// ç­‰å¾…çº¿ç¨‹å®Œå…¨é€€å‡º</span>
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}
</code></pre>
<p>é€€å‡ºè§¦å‘ç‚¹åœ¨onDetachedFromWindow()ä¸­è°ƒç”¨ï¼Œç¡®ä¿åœ¨Viewè„±ç¦»çª—å£æ—¶å®‰å…¨åœæ­¢æ¸²æŸ“çº¿ç¨‹ã€‚</p>
<h2 data-id="heading-8">äº”ã€æ ¸å¿ƒåŸç†æ€»ç»“</h2>
<ol>
<li>
<p>çº¿ç¨‹åˆ†ç¦»ï¼šGLSurfaceViewåˆ›å»ºä¸“ç”¨æ¸²æŸ“çº¿ç¨‹ï¼Œé¿å…UIçº¿ç¨‹é˜»å¡</p>
</li>
<li>
<p>EGLæ¡¥æ¢ä½œç”¨ï¼šé€šè¿‡EGLè¿æ¥OpenGL ES APIä¸AndroidåŸç”Ÿçª—å£ç³»ç»Ÿ</p>
</li>
<li>
<p>åŒç¼“å†²æœºåˆ¶ï¼šå‰ç¼“å†²åŒºæ˜¾ç¤ºï¼Œåç¼“å†²åŒºæ¸²æŸ“ï¼Œé€šè¿‡äº¤æ¢å®ç°æµç•…æ˜¾ç¤º</p>
</li>
<li>
<p>çŠ¶æ€æœºç®¡ç†ï¼šå®Œå–„çš„æš‚åœ/æ¢å¤/é€€å‡ºç”Ÿå‘½å‘¨æœŸç®¡ç†</p>
</li>
<li>
<p>Surfaceå°è£…ï¼šå°†Android SurfaceåŒ…è£…ä¸ºEGLSurfaceï¼Œå®ç°å¹³å°æ— å…³çš„OpenGLæ¸²æŸ“</p>
</li>
</ol>
<p>GLSurfaceViewçš„æœ¬è´¨æ˜¯åœ¨Javaå±‚å®Œæ•´å®ç°äº†OpenGL ESçš„æ ‡å‡†æ¸²æŸ“æµç¨‹ï¼Œä¸ºAndroidåº”ç”¨æä¾›äº†ç›´æ¥è°ƒç”¨åº•å±‚å›¾å½¢åº“çš„èƒ½åŠ›ã€‚é€šè¿‡ç†è§£å…¶å†…éƒ¨æœºåˆ¶ï¼Œå¼€å‘è€…èƒ½å¤Ÿæ›´å¥½åœ°ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ï¼Œå¤„ç†å¤æ‚çš„å›¾å½¢éœ€æ±‚ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ« XML ANRï¼ŸCompose çš„æ€§èƒ½é™·é˜±ä¸é‡ç»„ä¼˜åŒ–å®æˆ˜æŒ‡å—]]></title>    <link>https://juejin.cn/post/7579186764046041129</link>    <guid>https://juejin.cn/post/7579186764046041129</guid>    <pubDate>2025-12-03T04:18:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579186764046041129" data-draft-id="7579179625461776426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ« XML ANRï¼ŸCompose çš„æ€§èƒ½é™·é˜±ä¸é‡ç»„ä¼˜åŒ–å®æˆ˜æŒ‡å—"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-03T04:18:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·4165967369355"/> <meta itemprop="url" content="https://juejin.cn/user/1146150492576877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ« XML ANRï¼ŸCompose çš„æ€§èƒ½é™·é˜±ä¸é‡ç»„ä¼˜åŒ–å®æˆ˜æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1146150492576877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·4165967369355
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:18:17.000Z" title="Wed Dec 03 2025 04:18:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>è§‚ç‚¹å…±é¸£ï¼š</strong> æœ‰äººè¯´ ANR ä¸ä¼šæ¶ˆå¤±ï¼Œåªä¼šè½¬ç§»ã€‚åœ¨ä» Android View è¿ç§»åˆ° Jetpack Compose çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ·±åˆ‡åœ°ä½“ä¼šåˆ°äº†è¿™å¥è¯çš„å“²å­¦æ„ä¹‰ã€‚</p>
</blockquote>
<p>ä¼ ç»Ÿçš„ XML å¸ƒå±€è§£æå¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œå¾€å¾€æ˜¯ Android å¼€å‘è€…å¤´ç—›çš„æ ¹æºã€‚Compose æˆåŠŸè§£å†³äº†æ—§ç—›ï¼Œå´å¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜â€”â€”<strong>ä¸å¿…è¦çš„é‡ç»„ï¼ˆRecompositionï¼‰</strong> ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æ Compose çš„æ€§èƒ½æ¨¡å‹ï¼Œå¹¶æä¾›ä¸€å¥—å®Œæ•´çš„å·¥å…·å’Œæ–¹æ³•ï¼Œæ•™ä½ å¦‚ä½•ç›‘æµ‹ã€æ’æŸ¥å’Œè§£å†³é‡ç»„å¼•å‘çš„æ€§èƒ½é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ—§ç—›ï¼šä¸ºä»€ä¹ˆ XML å¸ƒå±€ä¼šå¸¦æ¥ ANR å’Œå¡é¡¿ï¼Ÿ</h2>
<p>åœ¨ä¼ ç»Ÿçš„ View ä½“ç³»ä¸­ï¼Œå¤æ‚çš„ XML å¸ƒå±€åœ¨ä¸»çº¿ç¨‹ä¸Šåˆå§‹åŒ–æ—¶ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæ€§èƒ½æ€æ‰‹ï¼š</p>
<ol>
<li><strong>ç£ç›˜ IO ä¸åå°„ (Reflection)ï¼š</strong> åŠ è½½ XML æ–‡ä»¶æ¶‰åŠç£ç›˜è¯»å–ï¼Œå¹¶ä¸”éœ€è¦é€šè¿‡ Java åå°„æœºåˆ¶å®ä¾‹åŒ–æ‰€æœ‰ View ç±»ï¼ˆå¦‚ <code>TextView</code>ã€<code>Button</code> ç­‰ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªæ˜‚è´µçš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</li>
<li><strong>æ·±åº¦åµŒå¥—çš„æŒ‡æ•°çº§æ¶ˆè€— (Double Taxation)ï¼š</strong> View ä½“ç³»ä¸­ï¼Œçˆ¶ View ç»å¸¸éœ€è¦å¤šæ¬¡æµ‹é‡å¸¦æƒé‡æˆ–å¤æ‚çº¦æŸçš„å­ Viewã€‚å±‚çº§è¶Šæ·±ï¼Œæµ‹é‡æ¬¡æ•°å‘ˆæŒ‡æ•°çº§å¢é•¿ï¼Œæœ€ç»ˆå¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡ã€‚</li>
</ol>
<p><strong>æ€»ç»“ï¼š</strong> XML çš„æ€§èƒ½å¼€é”€å‘ç”Ÿåœ¨**â€œåˆå§‹åŒ–â€**ï¼Œæ ¸å¿ƒç“¶é¢ˆåœ¨äº <strong>IOã€åå°„å’ŒæŒ‡æ•°çº§æµ‹é‡</strong>ã€‚</p>
<h2 data-id="heading-1">äºŒã€æ–°æ¨¡å‹ï¼šCompose çš„æ¶æ„ä¼˜åŠ¿ä¸æ€§èƒ½è½¬ç§»</h2>
<p>Compose è§£å†³äº† View ä½“ç³»çš„æ—§é—®é¢˜ï¼š</p>
<ul>
<li><strong>å‘Šåˆ« IO ä¸åå°„ï¼š</strong> Compose æ˜¯çº¯ Kotlin ä»£ç ï¼Œé€šè¿‡å‡½æ•°ç›´æ¥åˆ›å»º UI èŠ‚ç‚¹ï¼Œæ²¡æœ‰ XML è§£æçš„è´Ÿæ‹…ã€‚</li>
<li><strong>çº¿æ€§æ€§èƒ½ï¼š</strong> Compose éµå¾ª <strong>å•æ¬¡æµ‹é‡è§„åˆ™ (Single Pass Measurement)</strong> ã€‚æ— è®ºä½ çš„ UI åµŒå¥—å¤šæ·±ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªä¼šè¢«æµ‹é‡ä¸€æ¬¡ã€‚å¤æ‚çš„å±‚çº§æ·±åº¦ä¸å†æ˜¯æ€§èƒ½çš„å¤´å·æ€æ‰‹ï¼Œæ€§èƒ½æŸè€—åªä¼šéšèŠ‚ç‚¹æ•°é‡å‘ˆ <strong>çº¿æ€§ (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></span>)</strong> å¢é•¿ã€‚</li>
</ul>
<p>ä½†æ˜¯ï¼ŒANR æˆ–å¡é¡¿çš„é£é™©å¹¶æ²¡æœ‰æ¶ˆå¤±ï¼Œè€Œæ˜¯è½¬ç§»åˆ°äº† <strong>â€œé‡ç»„ï¼ˆRecompositionï¼‰â€</strong> ã€‚å¦‚æœä½ çš„ Composable å‡½æ•°å› ä¸ºä»£ç é€»è¾‘æˆ–ä¸ç¨³å®šçš„å‚æ•°è¢«é¢‘ç¹é‡å¤æ‰§è¡Œï¼Œå®ƒå°†å¤§é‡æ¶ˆè€— CPUï¼Œé˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´å¡é¡¿ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€æ ¸å¿ƒç—›ç‚¹ï¼šç›‘æµ‹ä¸ä¼˜åŒ– Compose é‡ç»„</h2>
<p>é‡ç»„æ˜¯ Compose æ›´æ–° UI çš„æ ¸å¿ƒæœºåˆ¶ã€‚ä¼˜åŒ–çš„ç›®æ ‡æ˜¯ï¼š<strong>åªè®©éœ€è¦æ›´æ–°çš„ Composable é‡ç»„ï¼Œå¹¶è·³è¿‡ï¼ˆSkipï¼‰å…¶ä»– Composable çš„æ‰§è¡Œã€‚</strong></p>
<h3 data-id="heading-3">1. ç›‘æµ‹ï¼šå¦‚ä½•å‘ç°ä¸å¿…è¦çš„é‡ç»„ï¼Ÿ</h3>
<p>æˆ‘ä»¬ä¸»è¦ä¾é å¯è§†åŒ–å·¥å…·æ¥å®šä½é—®é¢˜åŒºåŸŸã€‚</p>
<h4 data-id="heading-4">â‘  Android Studio Layout Inspector (å¸ƒå±€æ£€æŸ¥å™¨)</h4>
<p>è¿™æ˜¯æœ€å®˜æ–¹ã€æœ€ç›´è§‚çš„å·¥å…·ã€‚</p>
<ul>
<li>
<p><strong>æ“ä½œæ–¹æ³•ï¼š</strong> è¿è¡Œ Appï¼Œæ‰“å¼€ <code>Tools</code> -&gt; <code>Layout Inspector</code>ã€‚</p>
</li>
<li>
<p><strong>å…³é”®è®¾ç½®ï¼š</strong> å‹¾é€‰ <strong><code>Show Recomposition Counts</code></strong> å’Œ <strong><code>Highlight Recompositions</code></strong>ã€‚</p>
</li>
<li>
<p><strong>è¯Šæ–­ä¾æ®ï¼š</strong></p>
<ul>
<li><strong>è®¡æ•°ï¼š</strong> è§‚å¯Ÿ Composable æ—è¾¹çš„æ•°å­—ï¼ˆ<code>é‡ç»„æ¬¡æ•° / è·³è¿‡æ¬¡æ•°</code>ï¼‰ã€‚å¦‚æœåœ¨ç”¨æˆ·æ²¡æœ‰è¿›è¡Œä»»ä½•æ“ä½œï¼Œæˆ–è€…çŠ¶æ€æ²¡æœ‰æ”¹å˜æ—¶ï¼Œ<strong>é‡ç»„æ¬¡æ•°</strong>ä¾ç„¶æŒç»­å¢é•¿ï¼Œåˆ™å­˜åœ¨é—®é¢˜ã€‚</li>
<li><strong>é«˜äº®ï¼š</strong> å‘ç”Ÿé‡ç»„çš„åŒºåŸŸä¼šé—ªçƒé¢œè‰²ï¼ˆé€šå¸¸æ˜¯è“ç»¿æ¸å˜ï¼‰ã€‚è§‚å¯Ÿé—ªçƒåŒºåŸŸæ˜¯å¦è¶…å‡ºé¢„æœŸã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">â‘¡ ç¬¬ä¸‰æ–¹åº“ï¼šRebugger (é€‚åˆè¿½è¸ªåŸå› )</h4>
<p>å¦‚æœä½ å‘ç°æŸä¸ª Composable é‡ç»„äº†ï¼Œä½†ä¸çŸ¥é“æ˜¯å“ªä¸ªå‚æ•°å˜äº†ï¼ŒRebugger å¯ä»¥æ‰“å° Logcat æ—¥å¿—ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// è¿½è¸ªå¯¼è‡´é‡ç»„çš„å˜é‡</span>
<span class="hljs-selector-tag">Rebugger</span>(
    trackMap = <span class="hljs-built_in">mapOf</span>(
        <span class="hljs-string">"uiState"</span> to uiState,
        <span class="hljs-string">"userList"</span> to userList
    ),
)
<span class="hljs-comment">// Logcat ä¼šå‘Šè¯‰ä½ ï¼šå“ªä¸ªå‚æ•°ä»ä»€ä¹ˆå€¼å˜åˆ°äº†ä»€ä¹ˆå€¼ã€‚</span>
</code></pre>
<h3 data-id="heading-6">2. æ’æŸ¥ï¼šæ‰¾å‡ºé‡ç»„çš„æ ¹æœ¬åŸå› â€”â€”å‚æ•°ä¸ç¨³å®š</h3>
<p>é‡ç»„çš„æ ¹æœ¬åŸå› ï¼Œåœ¨äº Compose ç¼–è¯‘å™¨æ— æ³•ç¡®å®šä½ çš„ Composable å‡½æ•°å‚æ•°æ˜¯å¦<strong>ç¨³å®š (Stable)</strong> ã€‚</p>
<h4 data-id="heading-7">å¯ç”¨ Compose Compiler Metrics (ç¼–è¯‘å™¨æŒ‡æ ‡)</h4>
<p>è¿™æ˜¯æœ€ä¸“ä¸šçš„è¯Šæ–­æ–¹å¼ï¼Œèƒ½è®©ä½ çœ‹åˆ°ç¼–è¯‘å™¨å¯¹ä½ æ‰€æœ‰ç±»çš„åˆ¤å®šç»“æœã€‚</p>
<p>åœ¨æ¨¡å—çš„ <code>build.gradle</code> ä¸­é…ç½®ï¼ˆä»¥ Kotlin 2.0+ ä¸ºä¾‹ï¼‰ï¼š</p>
<p>Kotlin</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// module/build.gradle.kts</span>
kotlin {
    <span class="hljs-comment">// ... å…¶ä»–é…ç½®</span>
    compilerOptions {
        freeCompilerArgs.<span class="hljs-built_in">addAll</span>(
            <span class="hljs-string">"-P"</span>, <span class="hljs-string">"plugin:androidx.compose.compiler.plugins.kotlin:reportsDestination="</span> + project.buildDir.absolutePath + <span class="hljs-string">"/compose_metrics"</span>,
            <span class="hljs-string">"-P"</span>, <span class="hljs-string">"plugin:androidx.compose.compiler.plugins.kotlin:metricsDestination="</span> + project.buildDir.absolutePath + <span class="hljs-string">"/compose_metrics"</span>
        )
    }
}
</code></pre>
<p>ç¼–è¯‘ï¼ˆ<code>./gradlew assembleRelease</code>ï¼‰åï¼Œæ£€æŸ¥ <code>build/compose_metrics</code> ç›®å½•ä¸‹çš„æŠ¥å‘Šï¼š</p>
<ul>
<li><strong><code>*-classes.txt</code></strong>: æŸ¥æ‰¾è¢«æ ‡è®°ä¸º <code>Unstable</code> çš„ç±»ã€‚</li>
<li><strong><code>*-composables.txt</code></strong>: æŸ¥æ‰¾è¢«æ ‡è®°ä¸º <code>not skippable</code>ï¼ˆä¸å¯è·³è¿‡ï¼‰çš„ Composable å‡½æ•°ã€‚</li>
</ul>
<p><strong>ã€æ ¸å¿ƒè§„åˆ™ã€‘</strong> åªè¦ Composable å‡½æ•°çš„ä»»ä½•ä¸€ä¸ªå‚æ•°ç±»å‹æ˜¯ <code>Unstable</code> çš„ï¼Œè¯¥å‡½æ•°å°±æ— æ³•è¢«ç¼–è¯‘å™¨æ ‡è®°ä¸º <code>skippable</code>ã€‚</p>
<h3 data-id="heading-8">3. è§£å†³ï¼šä¼˜åŒ–ä¸æ¶ˆé™¤ä¸å¿…è¦çš„é‡ç»„</h3>
<p>é’ˆå¯¹æ’æŸ¥ç»“æœï¼Œæˆ‘ä»¬æœ‰é’ˆå¯¹æ€§çš„è§£å†³æ–¹æ¡ˆï¼š</p>



































<table><thead><tr><th><strong>æ€§èƒ½é—®é¢˜</strong></th><th><strong>ç—‡çŠ¶ / åŸå› </strong></th><th><strong>è§£å†³æ–¹æ¡ˆ</strong></th><th><strong>ä¼˜åŠ¿</strong></th></tr></thead><tbody><tr><td><strong>å‚æ•°ä¸ç¨³å®š</strong></td><td>ä½¿ç”¨äº†æ ‡å‡† <code>List</code>/<code>Set</code>/<code>Map</code> æˆ–å«æœ‰ <code>var</code> å±æ€§çš„ç±»ã€‚</td><td><strong>1. ä½¿ç”¨ <code>@Stable</code>/<code>@Immutable</code> æ³¨è§£</strong> (å‘ŠçŸ¥ç¼–è¯‘å™¨ç±»æ˜¯ç¨³å®šçš„) <strong>2. ä½¿ç”¨ <code>kotlinx.collections.immutable</code></strong> (å¦‚ <code>ImmutableList</code>)</td><td>ç¡®ä¿ Compose ä»…åœ¨åˆ—è¡¨å¼•ç”¨æ”¹å˜æ—¶é‡ç»„ï¼Œè€Œä¸æ˜¯æ¯æ¬¡åˆ›å»ºæ–°åˆ—è¡¨æ—¶ã€‚</td></tr><tr><td><strong>é«˜é¢‘çŠ¶æ€è¯»å–</strong></td><td>åœ¨ Composable å‡½æ•°ä½“ä¸­ç›´æ¥è¯»å–é«˜é¢‘å˜åŒ–çš„ State (å¦‚ <code>scrollState.value</code>)ã€‚</td><td><strong>å»¶è¿Ÿè¯»å–çŠ¶æ€ (Defer Reads)ï¼š</strong> å°† State è¯»å–æ¨è¿Ÿåˆ° Layout æˆ– Draw é˜¶æ®µã€‚</td><td>é¿å… Composable å‡½æ•°æœ¬èº«åœ¨æ¯ä¸€å¸§é‡ç»„ã€‚</td></tr><tr><td><strong>å†—ä½™è®¡ç®—</strong></td><td>å¤šä¸ªé«˜é¢‘çŠ¶æ€å˜åŠ¨ï¼Œä½†æœ€ç»ˆ UI åªéœ€è¦åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ›´æ–°ã€‚</td><td><strong>ä½¿ç”¨ <code>derivedStateOf</code></strong></td><td>ä»…åœ¨è®¡ç®—ç»“æœ<strong>çœŸæ­£æ”¹å˜</strong>æ—¶è§¦å‘é‡ç»„ï¼Œè¿‡æ»¤æ‰ä¸­é—´å˜åŒ–è¿‡ç¨‹ã€‚</td></tr><tr><td><strong>åˆ—è¡¨é‡ç»„é—®é¢˜</strong></td><td><code>LazyColumn</code> æˆ– <code>Column</code> åˆ—è¡¨é¡¹æ’å…¥/åˆ é™¤æ—¶ï¼Œæ•´ä¸ªåˆ—è¡¨é‡ç»„ã€‚</td><td><strong>åœ¨ <code>items</code> ä¸­æŒ‡å®š <code>key</code></strong> (å¦‚ <code>key = { it.id }</code>)</td><td>å¸®åŠ© Compose å‡†ç¡®è¯†åˆ«åˆ—è¡¨é¡¹ï¼Œæé«˜ diff ç®—æ³•æ•ˆç‡ã€‚</td></tr></tbody></table>
<h4 data-id="heading-9">å®ä¾‹ï¼šå»¶è¿Ÿè¯»å–çŠ¶æ€</h4>
<p><strong>âŒ é”™è¯¯ç¤ºä¾‹ (å¯¼è‡´ä¸å¿…è¦çš„é‡ç»„):</strong></p>
<p>Kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">BadOffset</span><span class="hljs-params">(scrollState: <span class="hljs-type">ScrollState</span>)</span></span> {
    <span class="hljs-comment">// æ¯æ¬¡æ»‘åŠ¨éƒ½ä¼šé‡ç»„æ­¤å‡½æ•°åŠå…¶ä¸‹æ¸¸</span>
    <span class="hljs-keyword">val</span> offset = scrollState.value.dp 
    Box(Modifier.offset(offset)) 
}
</code></pre>
<p><strong>âœ… ä¼˜åŒ–ç¤ºä¾‹ (ä»… Layout é˜¶æ®µæ‰§è¡Œï¼Œä¸è§¦å‘ Composition é‡ç»„):</strong></p>
<p>Kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">GoodOffset</span><span class="hljs-params">(scrollState: <span class="hljs-type">ScrollState</span>)</span></span> {
    Box(
        Modifier.offset { 
            <span class="hljs-comment">// è¿™é‡Œçš„ lambda åªåœ¨å¸ƒå±€é˜¶æ®µæ‰§è¡Œï¼Œä¸ä¼šè§¦å‘å‡½æ•°æœ¬èº«é‡ç»„</span>
            IntOffset(x = scrollState.value.roundToInt(), y = <span class="hljs-number">0</span>) 
        }
    )
}
</code></pre>
<hr/>
<h2 data-id="heading-10">ç»“è®ºä¸å±•æœ›</h2>
<p>ANR çš„æœ¬è´¨æ˜¯ä¸»çº¿ç¨‹é•¿æ—¶é—´é˜»å¡ã€‚æ— è®ºä½ æ˜¯ä½¿ç”¨ XML è¿˜æ˜¯ Composeï¼Œå¦‚æœå°†ç¹é‡çš„è®¡ç®—é€»è¾‘ï¼ˆå¦‚å¤æ‚çš„æ’åºã€æ•°æ®è¿‡æ»¤ï¼‰æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­ï¼ŒANR æ°¸è¿œå­˜åœ¨ã€‚</p>
<ul>
<li><strong>XML æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šåå°„ã€IOã€å¸ƒå±€æµ‹é‡ã€‚</li>
<li><strong>Compose æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šå‡½æ•°æ‰§è¡Œã€é‡ç»„è®¡ç®—ã€‚</li>
</ul>
<p>æ‹¥æŠ± Compose æ„å‘³ç€æˆ‘ä»¬è§£å†³äº†æ—§çš„å¸ƒå±€æµ‹é‡é—®é¢˜ï¼Œä½†éœ€è¦æ›´å¼ºçš„<strong>çŠ¶æ€ç®¡ç†çºªå¾‹</strong>æ¥æ§åˆ¶é‡ç»„çš„èŒƒå›´å’Œé¢‘ç‡ã€‚å–„ç”¨ Layout Inspector å’Œ Compiler Metricsï¼Œä½ å°†èƒ½æ„å»ºå‡ºæ¯” View ä½“ç³»æ›´æµç•…ã€æ€§èƒ½æ›´å¯é¢„æµ‹çš„ç°ä»£åŒ– Android åº”ç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç‹¬ç«‹å¼€å‘è€…äº²æµ‹ï¼šMLXæ¡†æ¶è®©æˆ‘çš„Appç§’å˜AIåŸç”Ÿï¼15å¹´iOSè€å…µçš„2025æ–°æ„Ÿæ‚Ÿ]]></title>    <link>https://juejin.cn/post/7579154364960473107</link>    <guid>https://juejin.cn/post/7579154364960473107</guid>    <pubDate>2025-12-03T03:16:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579154364960473107" data-draft-id="7579130291622740010" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç‹¬ç«‹å¼€å‘è€…äº²æµ‹ï¼šMLXæ¡†æ¶è®©æˆ‘çš„Appç§’å˜AIåŸç”Ÿï¼15å¹´iOSè€å…µçš„2025æ–°æ„Ÿæ‚Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,iOS"/> <meta itemprop="datePublished" content="2025-12-03T03:16:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JZXStudio"/> <meta itemprop="url" content="https://juejin.cn/user/3871828097898218"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç‹¬ç«‹å¼€å‘è€…äº²æµ‹ï¼šMLXæ¡†æ¶è®©æˆ‘çš„Appç§’å˜AIåŸç”Ÿï¼15å¹´iOSè€å…µçš„2025æ–°æ„Ÿæ‚Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3871828097898218/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JZXStudio
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:16:29.000Z" title="Wed Dec 03 2025 03:16:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯Kå“¥ï¼Œä¸€ä¸ªå†™äº†15å¹´iOSä»£ç çš„ç‹¬ç«‹å¼€å‘è€…ã€‚ä»Objective-Cæ—¶ä»£ä¸€è·¯å†™åˆ°Swiftï¼Œè§è¯è¿‡App Storeçš„é»„é‡‘åå¹´ï¼Œä¹Ÿç†¬è¿‡å†…å·æœ€ç‹ çš„é‚£å‡ å¹´ã€‚ä½†2025å¹´ï¼Œæˆ‘ç¬¬ä¸€æ¬¡æ„Ÿå—åˆ°â€”â€”<strong>AIçœŸçš„ä¸æ˜¯å™±å¤´ï¼Œè€Œæ˜¯æ¯ä¸ªiOSå¼€å‘è€…éƒ½èƒ½äº²æ‰‹æŒæ§çš„ç”Ÿäº§åŠ›é©å‘½</strong>ã€‚</p>
<p>è¿™ä¸€åˆ‡ï¼Œéƒ½æºäºè‹¹æœåœ¨WWDC25æ­£å¼åŠ›æ¨çš„ <strong>MLXæ¡†æ¶</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-0">ğŸš€ ä»¥å‰åšAIåŠŸèƒ½ï¼Ÿéš¾å¦‚ç™»å¤©</h2>
<p>è¿‡å»æƒ³åœ¨Appé‡ŒåŠ ä¸ªæ™ºèƒ½æ¨èã€å›¾åƒç”Ÿæˆæˆ–è¯­éŸ³ç†è§£ï¼Œè¦ä¹ˆè°ƒç”¨ç¬¬ä¸‰æ–¹APIï¼ˆè´µ+æ…¢+éšç§é£é™©ï¼‰ï¼Œè¦ä¹ˆè‡ªå·±å•ƒPyTorchï¼ˆiOSç«¯éƒ¨ç½²ï¼Ÿåˆ«æƒ³äº†ï¼‰ã€‚ä½œä¸ºç‹¬ç«‹å¼€å‘è€…ï¼Œæ—¢æ²¡ç®—åŠ›ä¹Ÿæ²¡å›¢é˜Ÿï¼ŒAIåŠŸèƒ½åŸºæœ¬æ˜¯â€œçœ‹çœ‹å°±å¥½â€ã€‚</p>
<p>ä½†MLXå½»åº•æ”¹å˜äº†æ¸¸æˆè§„åˆ™ã€‚</p>
<hr/>
<h2 data-id="heading-1">ğŸ”¥ MLXåˆ°åº•å¼ºåœ¨å“ªï¼Ÿäº²æµ‹ä¸‰å¤§é¢ è¦†ç‚¹</h2>
<h3 data-id="heading-2">âœ… 1. <strong>æœ¬åœ°è·‘å¤§æ¨¡å‹ï¼Œä¸è”ç½‘ä¹Ÿèƒ½AIåŸç”Ÿ</strong></h3>
<p>MLXä¸“ä¸ºApple Siliconä¼˜åŒ–ï¼ŒM1/M2/M3èŠ¯ç‰‡ç›´æ¥ç¡¬ä»¶åŠ é€Ÿã€‚æˆ‘åœ¨Mac mini M2ä¸Šè·‘7Bå‚æ•°çš„æ–‡æœ¬ç”Ÿæˆæ¨¡å‹ï¼Œå“åº”é€Ÿåº¦æ¯”æŸäº›äº‘APIè¿˜å¿«ï¼ç”¨æˆ·æ•°æ®å…¨ç¨‹ç•™åœ¨è®¾å¤‡ç«¯ï¼Œ<strong>éšç§åˆè§„ä¸å†æ˜¯éš¾é¢˜</strong>â€”â€”è¿™åœ¨æ¬§ç›ŸDSAå’Œå›½å†…ä¸ªä¿æ³•æ—¶ä»£å¤ªé‡è¦äº†ã€‚</p>
<h3 data-id="heading-3">âœ… 2. <strong>Swift + PythonåŒæ”¯æŒï¼Œè€iOSäººæ— ç¼ä¸Šæ‰‹</strong></h3>
<p>ä½œä¸ºSwiftæ­»å¿ ç²‰ï¼Œæˆ‘æœ¬æ‹…å¿ƒè¦é‡å­¦Pythonç”Ÿæ€ã€‚ç»“æœMLXåŒæ—¶æä¾›Swiftå’ŒPython APIï¼æˆ‘ç”¨Swiftç›´æ¥è°ƒç”¨é¢„è®­ç»ƒæ¨¡å‹ï¼Œå‡ è¡Œä»£ç å°±ç»™æˆ‘çš„ç¬”è®°AppåŠ ä¸Šäº†â€œæ™ºèƒ½æ‘˜è¦â€å’Œâ€œçµæ„Ÿæ‰©å†™â€åŠŸèƒ½ã€‚<strong>ä¸ç”¨æ”¹æ¶æ„ï¼Œä¸ä¾èµ–åç«¯ï¼Œä¸‰å¤©ä¸Šçº¿AIæ¨¡å—</strong>â€”â€”çœŸÂ·ç§’å˜AIåŸç”Ÿã€‚</p>
<h3 data-id="heading-4">âœ… 3. <strong>ä¸ä»…èƒ½æ¨ç†ï¼Œè¿˜èƒ½æœ¬åœ°å¾®è°ƒï¼</strong></h3>
<p>æœ€éœ‡æ’¼çš„æ˜¯ï¼šMLXæ”¯æŒåœ¨Macä¸Šç›´æ¥<strong>è®­ç»ƒå’Œå¾®è°ƒæ¨¡å‹</strong>ã€‚æˆ‘ç”¨è‡ªå·±ç§¯ç´¯çš„ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼ˆè„±æ•åï¼‰å¾®è°ƒäº†ä¸€ä¸ªå°æ¨¡å‹ï¼Œä¸ªæ€§åŒ–æ¨èå‡†ç¡®ç‡æå‡40%ã€‚ä»¥å‰è¿™å¾—ç§ŸGPUé›†ç¾¤ï¼Œç°åœ¨ä¸€å°Macæå®šï¼Œæˆæœ¬è¶‹è¿‘äºé›¶ã€‚</p>
<hr/>
<h2 data-id="heading-5">ğŸ’¡ ç»™åŒè¡Œçš„3æ¡å®æˆ˜å»ºè®®</h2>
<ol>
<li><strong>åˆ«ç­‰â€œå®Œç¾æ¨¡å‹â€</strong>ï¼šä»å°åœºæ™¯åˆ‡å…¥ï¼Œæ¯”å¦‚â€œå›¾ç‰‡è‡ªåŠ¨æ‰“æ ‡ç­¾â€ã€â€œè¾“å…¥è¡¥å…¨â€ã€â€œè¯­éŸ³è½¬å¾…åŠäº‹é¡¹â€ï¼Œç”¨æˆ·æ„ŸçŸ¥å¼ºï¼Œå¼€å‘é‡å°ã€‚</li>
<li><strong>å–„ç”¨Lazy Computation</strong>ï¼šMLXçš„å»¶è¿Ÿè®¡ç®—ç‰¹æ€§å¯å¤§å¹…å‡å°‘å†…å­˜å ç”¨ï¼Œè¿™å¯¹iPhoneå†…å­˜æ•æ„Ÿåœºæ™¯è‡³å…³é‡è¦ã€‚</li>
<li><strong>å…³æ³¨å¤šæ¨¡æ€èåˆ</strong>ï¼š2025å¹´è¶‹åŠ¿æ˜¯â€œæ–‡æœ¬+å›¾åƒ+éŸ³é¢‘â€è”åŠ¨ã€‚æ¯”å¦‚ç”¨æˆ·æ‹å¼ å›¾ï¼ŒAppè‡ªåŠ¨ç”Ÿæˆå›¾æ–‡ç¬”è®°â€”â€”MLXå…¨æ”¯æŒï¼</li>
</ol>
<hr/>
<h2 data-id="heading-6">ğŸŒŸ å†™åœ¨æœ€åï¼šè¿™æ˜¯å±äºç‹¬ç«‹å¼€å‘è€…çš„é»„é‡‘æ—¶ä»£</h2>
<p>æ›¾å‡ ä½•æ—¶ï¼Œæˆ‘ä»¬è§‰å¾—AIæ˜¯å¤§å‚çš„æ¸¸æˆã€‚ä½†MLXçš„å‡ºç°ï¼ŒæŠŠé¡¶çº§AIèƒ½åŠ›äº¤åˆ°äº†æ¯ä¸€ä¸ªMacç”¨æˆ·æ‰‹ä¸­â€”â€”è€Œä½ æˆ‘ï¼Œæ­£æ˜¯æœ€æ‡‚å¦‚ä½•æŠŠå®ƒå˜æˆå¥½äº§å“çš„é‚£ç¾¤äººã€‚</p>
<p><strong>15å¹´iOSå¼€å‘æ•™ä¼šæˆ‘ï¼šå·¥å…·ä¼šå˜ï¼Œå¹³å°ä¼šå˜ï¼Œä½†â€œè§£å†³ç”¨æˆ·çœŸå®é—®é¢˜â€çš„åˆå¿ƒä¸å˜ã€‚è€Œä»Šå¤©ï¼ŒMLXç»™äº†æˆ‘ä»¬å‰æ‰€æœªæœ‰çš„æ æ†ã€‚</strong></p>
<p>å¦‚æœä½ ä¹Ÿåœ¨åšç‹¬ç«‹Appï¼Œåˆ«çŠ¹è±«â€”â€”å»Apple Developerå®˜ç½‘ä¸‹è½½MLXï¼Œè·‘é€šç¬¬ä¸€ä¸ªDemoã€‚ä½ ä¼šå‘ç°ï¼ŒAIåŸç”Ÿï¼ŒçœŸçš„åªå·®ä¸€è¡Œimportã€‚</p>
<hr/>
<p>#iOSå¼€å‘ #AIåŸç”Ÿåº”ç”¨ #MLXæ¡†æ¶ #ç‹¬ç«‹å¼€å‘è€… #AppleSilicon #WWDC25 #ç¨‹åºå‘˜æ—¥å¸¸ #AIåˆ›ä¸š #Swiftå¼€å‘ #2025æŠ€æœ¯è¶‹åŠ¿</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ¢ç´¢äº‘åŸç”Ÿæ–°åŸºçŸ³ï¼šopenEuler 22.03 LTS SP3 æ·±åº¦è¯„æµ‹ä¸äº‘åŸç”Ÿå®è·µï¼]]></title>    <link>https://juejin.cn/post/7579164768063733787</link>    <guid>https://juejin.cn/post/7579164768063733787</guid>    <pubDate>2025-12-03T03:52:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579164768063733787" data-draft-id="7579192114828279835" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ¢ç´¢äº‘åŸç”Ÿæ–°åŸºçŸ³ï¼šopenEuler 22.03 LTS SP3 æ·±åº¦è¯„æµ‹ä¸äº‘åŸç”Ÿå®è·µï¼"/> <meta itemprop="keywords" content="OpenAI"/> <meta itemprop="datePublished" content="2025-12-03T03:52:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bugèŒ"/> <meta itemprop="url" content="https://juejin.cn/user/695333581765240"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ¢ç´¢äº‘åŸç”Ÿæ–°åŸºçŸ³ï¼šopenEuler 22.03 LTS SP3 æ·±åº¦è¯„æµ‹ä¸äº‘åŸç”Ÿå®è·µï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/695333581765240/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bugèŒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:52:39.000Z" title="Wed Dec 03 2025 03:52:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">å¼•è¨€ï¼šäº‘å¸†æµæµ·ï¼ŒåŸºçŸ³ä¸ºå…ˆ</h2>
<p>åœ¨æ•°å­—åŒ–æµªæ½®å¸­å·å…¨çƒçš„ä»Šå¤©ï¼Œäº‘åŸç”Ÿï¼ˆCloud Nativeï¼‰æ—©å·²ä¸æ˜¯ä¸€ä¸ªé¥è¿œçš„æŠ€æœ¯æ¦‚å¿µï¼Œå®ƒå·²ç»æˆä¸ºé©±åŠ¨ç°ä»£åº”ç”¨æ¶æ„æ¼”è¿›çš„æ ¸å¿ƒå¼•æ“ã€‚ä»å¾®æœåŠ¡ã€å®¹å™¨åŒ–åˆ°æŒç»­é›†æˆ/æŒç»­äº¤ä»˜ï¼ˆCI/CDï¼‰ï¼Œäº‘åŸç”ŸæŠ€æœ¯æ ˆæ­£åœ¨é‡å¡‘ç€è½¯ä»¶çš„å¼€å‘ã€éƒ¨ç½²ä¸è¿ç»´æ¨¡å¼ã€‚ç„¶è€Œï¼Œâ€œä¸‡ä¸ˆé«˜æ¥¼å¹³åœ°èµ·â€ï¼Œä¸€ä¸ªç¨³å®šã€é«˜æ•ˆã€å®‰å…¨çš„æ“ä½œç³»ç»Ÿï¼Œæ­£æ˜¯æ”¯æ’‘è¿™æ ‹äº‘åŸç”Ÿâ€œæ‘©å¤©å¤§æ¥¼â€çš„åšå®åŸºçŸ³ã€‚</p>
<p>openEulerï¼Œä½œä¸ºä¸€æ¬¾é¢å‘æ•°å­—åŸºç¡€è®¾æ–½çš„å¼€æºæ“ä½œç³»ç»Ÿï¼Œä»è¯ç”Ÿä¹‹æ—¥èµ·å°±å°†ç›®å…‰æŠ•å‘äº†æœåŠ¡å™¨ã€äº‘è®¡ç®—ã€è¾¹ç¼˜è®¡ç®—ç­‰æ ¸å¿ƒåœºæ™¯ã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªLinuxå‘è¡Œç‰ˆï¼Œæ›´æ˜¯ä¸€ä¸ªå¼€æ”¾ã€å¤šå…ƒã€å…±å»ºå…±äº«çš„ç”Ÿæ€å¹³å°ã€‚æ€€ç€å¯¹è‡ªä¸»åˆ›æ–°æŠ€æœ¯åŸºåº§çš„å¥½å¥‡ä¸æœŸå¾…ï¼Œæˆ‘å‚åŠ äº†æœ¬æ¬¡ openEuler è¯„æµ‹å¾æ–‡æ´»åŠ¨ï¼Œé€‰æ‹©äº†æˆ‘æœ€ç†Ÿæ‚‰çš„äº‘åŸç”Ÿé¢†åŸŸï¼Œå¸Œæœ›é€šè¿‡ä¸€æ¬¡ä»é›¶åˆ°ä¸€çš„æ·±åº¦å®è·µï¼Œå»æŒ–æ˜ openEuler åœ¨è¿™ä¸ªæ—¶ä»£æµªæ½®ä¸‹çš„çœŸæ­£ä»·å€¼ã€‚</p>
<p>æœ¬æ¬¡è¯„æµ‹ï¼Œæˆ‘é€‰ç”¨çš„æ˜¯ <strong>openEuler 22.03 LTS SP3</strong> ç‰ˆæœ¬ï¼Œè¿™æ˜¯ä¸€ä¸ªé•¿æœŸæ”¯æŒç‰ˆï¼Œå¯¹äºä¼ä¸šçº§ç”Ÿäº§ç¯å¢ƒè‡³å…³é‡è¦ã€‚æˆ‘å°†ä»ç³»ç»Ÿåˆä½“éªŒã€äº‘åŸç”Ÿæ ¸å¿ƒç»„ä»¶æ”¯æŒã€ä¸€ä¸ªå®Œæ•´å¾®æœåŠ¡åº”ç”¨çš„éƒ¨ç½²å®æˆ˜ï¼Œä»¥åŠç³»ç»Ÿæ€§èƒ½ä¸å®‰å…¨è€ƒé‡ç­‰å¤šä¸ªç»´åº¦ï¼Œåˆ†äº«æˆ‘çš„è¯„æµ‹å¿ƒå¾—ä¸æ€è€ƒã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« ï¼Œèƒ½ä¸ºåŒæ ·å…³æ³¨ openEuler å’Œäº‘åŸç”ŸæŠ€æœ¯çš„å¼€å‘è€…æœ‹å‹ä»¬ï¼Œæä¾›ä¸€ä»½æœ‰ä»·å€¼çš„å‚è€ƒã€‚</p>
<h2 data-id="heading-1">ä¸€ã€åˆè¯† Eulerï¼šä¸€æ¬¡é¡ºæ»‘å¦‚ä¸çš„å®‰è£…ä¸åˆä½“éªŒ</h2>
<p>ä¸€æ®µæ—…ç¨‹çš„å¼€å§‹ï¼Œå§‹äºè¶³ä¸‹ã€‚å¯¹äºä¸€ä¸ªæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå®‰è£…è¿‡ç¨‹å°±æ˜¯å®ƒç»™æˆ‘çš„â€œç¬¬ä¸€å°è±¡â€ã€‚æˆ‘ä» openEuler å®˜æ–¹ç¤¾åŒºä¸‹è½½äº† <code>openEuler-22.03-LTS-SP3-x86_64-dvd.iso</code> é•œåƒï¼Œå¹¶å‡†å¤‡äº†ä¸€å°è™šæ‹Ÿæœºè¿›è¡Œå®‰è£…ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fmirror.sjtu.edu.cn%2Fopeneuler%2FopenEuler-22.03-LTS-SP3%2FISO%2Fx86_64%2FopenEuler-22.03-LTS-SP3-x86_64-dvd.iso" target="_blank" title="https://mirror.sjtu.edu.cn/openeuler/openEuler-22.03-LTS-SP3/ISO/x86_64/openEuler-22.03-LTS-SP3-x86_64-dvd.iso" ref="nofollow noopener noreferrer">isoä¸‹è½½åœ°å€</a>ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹èµ¶ç´§æŒ‰ç…§ä½“éªŒä¸€æ³¢ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73e4023e66b74c6da4012b7c323e93a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=2YXG2R47Pkralw7GH0XiqjN5yh0%3D" alt="" loading="lazy"/></p>
<p>æ•´ä¸ªå®‰è£…è¿‡ç¨‹é‡‡ç”¨äº†ç”¨æˆ·å‹å¥½çš„å›¾å½¢åŒ–ç•Œé¢ï¼ˆAnacondaï¼‰ï¼Œå¯¹äºæœ‰CentOSæˆ–RHELå®‰è£…ç»éªŒçš„å¼€å‘è€…æ¥è¯´å‡ ä¹æ˜¯é›¶é—¨æ§›ã€‚åˆ†åŒºè®¾ç½®ã€è½¯ä»¶é€‰æ‹©ã€ç½‘ç»œé…ç½®ç­‰å…³é”®æ­¥éª¤éƒ½æ¸…æ™°æ˜äº†ã€‚åœ¨â€œè½¯ä»¶é€‰æ‹©â€ç¯èŠ‚ï¼Œæˆ‘ç‰¹æ„ç•™æ„äº†ä¸€ä¸‹ï¼Œç³»ç»Ÿé¢„è®¾äº†â€œæœåŠ¡å™¨â€ã€â€œæœ€å°åŒ–å®‰è£…â€ã€â€œè™šæ‹ŸåŒ–ä¸»æœºâ€ç­‰å¤šç§ç¯å¢ƒæ¨¡æ¿ï¼Œä½“ç°äº†å…¶é¢å‘ä¸åŒåœºæ™¯çš„ä¸“ä¸šæ€§ã€‚æˆ‘é€‰æ‹©äº†å¸¦æœ‰å›¾å½¢åŒ–ç•Œé¢çš„æœåŠ¡å™¨æ¨¡å¼ï¼Œä»¥ä¾¿åç»­æ›´æ–¹ä¾¿åœ°è¿›è¡Œæˆªå›¾å’Œæ¼”ç¤ºã€‚</p>
<p>å¦‚ä¸‹æ˜¯ç›¸å…³å®‰è£…æ­¥éª¤ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼šInstall openEuler 22.03-LTS-SP3</p>
<p>æŒ‰é”®ç›˜çš„ä¸Šé”®ï¼Œé€‰æ‹©åˆ°ç¬¬ä¸€ä¸ªï¼ŒInstall openEuler 22.03-LTS-SP3ï¼ŒæŒ‰å›è½¦é”®ã€‚</p>
<ul>
<li>å®‰è£… openEuler 22.03-LTS-SP3</li>
<li>æµ‹è¯•æ­¤åª’ä»‹å¹¶å®‰è£… openEuler 22.03-LTS-SP3</li>
<li>æ•…éšœè¯Šæ–­</li>
</ul>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40d404f0b34543939150537ffe158c3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=cWqPGMUjKSXgLE2uM7UEiiyeNWk%3D" alt="" loading="lazy"/>
ç¬¬äºŒæ­¥ï¼šå®‰è£…è¯­è¨€é€‰æ‹©ä¸­æ–‡</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6357a30f4acb41feb2a2975985b6b734~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=3dY06OteO4NlkCtxc7V%2B%2BBCTJDE%3D" alt="" loading="lazy"/></p>
<p>ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©å®‰è£…ç›®æ ‡ä½ç½®</p>
<p>Automatic è‡ªåŠ¨åˆ†åŒºï¼ŒCustom è‡ªå®šä¹‰åˆ†åŒºï¼Œé€‰æ‹©è‡ªå®šä¹‰åˆ†åŒº</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b742a6180e2e4d2abd007b29ae7841d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=l7rIdVH7g7pS1jwCYlXE9OyLdxo%3D" alt="" loading="lazy"/></p>
<p>ç¬¬å››æ­¥ï¼šLVM è‡ªåŠ¨åˆ›å»ºåˆ†åŒº</p>
<p>é€‰æ‹©LVM è‡ªåŠ¨åˆ›å»ºåˆ†åŒºï¼Œç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨LVMç£ç›˜åˆ†åŒºæ¨¡å¼</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/912b3a80870d4f698ca818d18a43fcd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=JywmfG4qz2Mk8B5zNp5MlOZEnsY%3D" alt="" loading="lazy"/></p>
<p>ç¬¬äº”æ­¥ï¼šé€‰æ‹©ç³»ç»Ÿå®‰è£…ç±»å‹</p>
<p>openEuler ç³»ç»Ÿå®‰è£…åˆ†ä¸ºä¸‰ç§ç±»å‹Minimal Installã€Serverã€Virtualization Host ï¼Œä½¿ç”¨ Minimal Install å®‰è£…ï¼Œé€‰æ‹©å®‰è£…"Development Tools" ç»„å·¥å…·åŒ…</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cce3bbc8016408fb6b2f8c463e50106~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=voF36uSYN5BRD%2B8AfwO6mkW0idw%3D" alt="" loading="lazy"/></p>
<p>ç¬¬å…­æ­¥ï¼šé€‰æ‹©æ—¶é—´å’Œæ—¥æœŸ</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3126c31241f9482b8b50270f7c82af4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=vFt2KheJ7aslpi8BhbTGzuX%2F9cM%3D" alt="" loading="lazy"/></p>
<p>ç¬¬ä¸ƒæ­¥ï¼šé€‰æ‹©è¯­è¨€</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14fdd7c06d9b4f3585858b21896f9e1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=S4BATAhg6iMT9VAnPpKuUwKhc94%3D" alt="" loading="lazy"/></p>
<p>ç¬¬å…«æ­¥ï¼šè®¾ç½®è´¦æˆ·ä¿¡æ¯</p>
<p>é»˜è®¤æ²¡æœ‰å¯ç”¨rootè´¦æˆ·ï¼Œé€‰æ‹©"å¯åŠ¨rootè´¦æˆ·(E)"è®¾ç½®å¯†ç </p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47837edda4ed437289664a16ff1f7783~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=IOuQrBkXOtEU6HTW7EQ%2Bj5p4mc0%3D" alt="" loading="lazy"/></p>
<p>åˆ›å»ºopeneulerè´¦æˆ·ï¼ˆå¯é€‰ï¼‰</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2c87efd7d564b808119463aaa0c9ec2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=dWIFRMCQSgzXLwIga%2FBmqfuyHOM%3D" alt="" loading="lazy"/></p>
<p>ç¬¬ä¹æ­¥ï¼šå®‰è£…ä¿¡æ¯æ‘˜è¦</p>
<p>é”®ç›˜ã€å®‰è£…æºã€è¯­è¨€ã€æ—¶é—´ç­‰é»˜è®¤å³å¯ï¼Œç½‘ç»œå’Œä¸»æœºåå¯åœ¨ç³»ç»Ÿéƒ¨ç½²å®Œæˆè®¾ç½®</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94cfa98d8d8b4bbebd753c7a28c31b04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=Uq0PDruEP91IejPzsCauekqkSJI%3D" alt="" loading="lazy"/></p>
<p>ç¬¬åæ­¥ï¼šå®‰è£…å®Œæˆ reboot é‡å¯ç³»ç»Ÿ</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1940a3d1661a4f349a9d40c802c6b003~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=XXk85AKzqL0%2FPv0E%2FRhz7XHjmXs%3D" alt="" loading="lazy"/></p>
<p>è¾“å…¥rootè´¦æˆ·å¯†ç ç™»å½•ç³»ç»Ÿ</p>
<p>å…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72e4410797594b159a6e6cffdd281f9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=qrNlpzjW8NQxu%2BvD4pJsYXr%2F8bA%3D" alt="" loading="lazy"/></p>
<p>ç¬¬åä¸€æ­¥ï¼šç³»ç»Ÿç½‘ç»œé…ç½®ï¼šæŸ¥çœ‹ç½‘ç»œ</p>
<p>æŸ¥è¯¢ç›¸å…³å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json">ip add show æˆ– ip <span class="hljs-number">-4</span> a
</code></pre>
<p>ç¬¬åäºŒæ­¥ï¼šè®¾ç½®ä¸»æœºå</p>
<pre><code class="hljs language-json" lang="json">ostnamectl  set-hostname  openeuler02
bash
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aea2b419bae34f748128673626fc4918~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=tVDidVvRQ9XS11cVDE5fv5iggB0%3D" alt="" loading="lazy"/></p>
<p>æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-json" lang="json">cat /etc/os-release
</code></pre>
<p>æ‰§è¡Œå‘½ä»¤å…·ä½“è¿”å›æˆªå›¾å±•ç¤ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55264fac031d418a993d10aff1b57b1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=c8SgZ8MUicNoxt1DT6m%2FPbhzPnM%3D" alt="" loading="lazy"/>
...</p>
<p>å¤§çº¦15åˆ†é’Ÿåï¼Œç³»ç»Ÿå®‰è£…é¡ºåˆ©å®Œæˆã€‚é‡å¯è¿›å…¥ç³»ç»Ÿï¼Œç®€æ´çš„GNOMEæ¡Œé¢ç¯å¢ƒæ˜ å…¥çœ¼å¸˜ã€‚æ‰“å¼€ç»ˆç«¯ï¼Œæ•²ä¸‹ç†Ÿæ‚‰çš„ <code>uname -a</code> å’Œ <code>cat /etc/os-release</code>ï¼Œç¡®è®¤äº†å†…æ ¸ç‰ˆæœ¬å’Œç³»ç»Ÿä¿¡æ¯ï¼Œä¸€åˆ‡éƒ½æ˜¾å¾—é‚£ä¹ˆäº²åˆ‡è€Œåˆå´­æ–°ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">[user@openeuler ~]$ <span class="hljs-built_in">uname</span> -a
Linux openeuler 5.10.0-153.12.0.57.oe2203.x86_64 <span class="hljs-comment">#1 SMP Sat Dec 30 13:30:36 CST 2023 x86_64 x86_64 x86_64 GNU/Linux</span>

[user@openeuler ~]$ <span class="hljs-built_in">cat</span> /etc/os-release
NAME=<span class="hljs-string">"openEuler"</span>
VERSION=<span class="hljs-string">"22.03ï¼ˆLTS-SP3ï¼‰"</span>
ID=<span class="hljs-string">"openEuler"</span>
VERSION_ID=<span class="hljs-string">"22.03"</span>
PRETTY_NAME=<span class="hljs-string">"openEuler 22.03ï¼ˆLTS-SP3ï¼‰"</span>
ANSI_COLOR=<span class="hljs-string">"0;31"</span>
</code></pre>
<p>å¦‚ä¸‹åˆ†åˆ«ä¸ºå¦‚ä¸Šæ‰§è¡Œå‘½ä»¤æ—¶æ‰€è¿”å›çš„æˆªå›¾ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10fc0f64a1c749f4b289135d7a5fa372~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=fKacWDOG5gCCfUcmb6SkVkHbEHk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f38a7d102e584bf8a0a6bf42b14b2c05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=z5LXSriXgWKKQvoeYNtpPh2Mujc%3D" alt="" loading="lazy"/></p>
<p>åˆä½“éªŒç»™æˆ‘çš„æ„Ÿè§‰æ˜¯ï¼š<strong>ç¨³å®šã€æµç•…ã€æ ‡å‡†åŒ–</strong>ã€‚å®ƒæ²¡æœ‰åè€Œä¸å®çš„åŠŸèƒ½ï¼Œæ¯ä¸€æ­¥æ“ä½œéƒ½é€éœ²å‡ºä½œä¸ºä¸€æ¬¾æœåŠ¡å™¨æ“ä½œç³»ç»Ÿçš„ä¸¥è°¨ä¸åŠ¡å®ã€‚è¿™è®©æˆ‘å¯¹å®ƒåœ¨äº‘åŸç”Ÿåœºæ™¯ä¸‹çš„è¡¨ç°æ›´åŠ æœŸå¾…ã€‚</p>
<h2 data-id="heading-2">äºŒã€åŒæ“é©±åŠ¨ï¼šæ¢ç´¢ openEuler çš„å®¹å™¨åŒ–æ ¸å¿ƒèƒ½åŠ›</h2>
<p>å®¹å™¨æŠ€æœ¯æ˜¯äº‘åŸç”Ÿçš„åŸºçŸ³ã€‚åœ¨ openEuler ç”Ÿæ€ä¸­ï¼Œé™¤äº†ä¸šç•Œäº‹å®æ ‡å‡† Docker ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªâ€œäº²å„¿å­â€â€”â€” <strong>iSula</strong>ã€‚iSula æ˜¯ä¸€ä¸ªç”± openEuler ç¤¾åŒºä¸»å¯¼å¼€å‘çš„è½»é‡çº§å®¹å™¨å¼•æ“ï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯æ›´è½»ã€æ›´å¿«ã€æ›´æ˜“ç”¨ã€‚è¿™æ¬¡è¯„æµ‹ï¼Œæˆ‘å†³å®šå¯¹è¿™ä¸¤å¤§å¼•æ“éƒ½è¿›è¡Œä¸€ç•ªæ¢ç´¢ã€‚</p>
<h3 data-id="heading-3">1. è½»é‡çº§å‹‡å£«ï¼šiSula å®¹å™¨å¼•æ“ä½“éªŒ</h3>
<p>openEuler é»˜è®¤çš„è½¯ä»¶æºä¸­å°±å·²ç»åŒ…å«äº† iSulaã€‚å®‰è£…è¿‡ç¨‹éå¸¸ç®€å•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo dnf install isula
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œå¯åŠ¨å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl start isulad
sudo systemctl <span class="hljs-built_in">enable</span> isulad
</code></pre>
<p>é€šè¿‡ <code>isula info</code> å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹åˆ° iSula çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å­˜å‚¨é©±åŠ¨ã€Cgroupç‰ˆæœ¬ç­‰ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå°è¯•ç‰›åˆ€ï¼Œæ‹‰å–ä¸€ä¸ª openEuler å®˜æ–¹é•œåƒå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo isula pull openeuler/openeuler:22.03-lts-sp3
sudo isula run -it openeuler/openeuler:22.03-lts-sp3 /bin/bash
</code></pre>
<p>å‘½ä»¤çš„å“åº”é€Ÿåº¦éå¸¸å¿«ï¼Œå‡ ä¹æ˜¯ç¬é—´å°±è¿›å…¥äº†å®¹å™¨çš„äº¤äº’å¼ç¯å¢ƒã€‚è¿™è®©æˆ‘åˆ‡èº«æ„Ÿå—åˆ°äº† iSula æ‰€å®£ä¼ çš„â€œè½»é‡åŒ–â€ä¼˜åŠ¿ã€‚å®ƒçš„å‘½ä»¤è¡Œå·¥å…·ä¸ Docker é«˜åº¦å…¼å®¹ï¼Œå¯¹äºç†Ÿæ‚‰ Docker çš„ç”¨æˆ·æ¥è¯´ï¼Œå­¦ä¹ æˆæœ¬æä½ã€‚</p>
<h3 data-id="heading-4">2. ç”Ÿæ€å…¼å®¹ï¼šæ— ç¼é›†æˆ Docker</h3>
<p>å°½ç®¡ iSula è¡¨ç°å‡ºè‰²ï¼Œä½†åœ¨åºå¤§çš„äº‘åŸç”Ÿç”Ÿæ€ä¸­ï¼ŒDocker çš„ä¸»å¯¼åœ°ä½ä¾ç„¶æ— æ³•æ’¼åŠ¨ã€‚ä¸€ä¸ªä¼˜ç§€çš„æ“ä½œç³»ç»Ÿï¼Œå¿…é¡»å…·å¤‡è‰¯å¥½çš„ç”Ÿæ€å…¼å®¹æ€§ã€‚è®©æˆ‘ä»¬çœ‹çœ‹åœ¨ openEuler ä¸Šå®‰è£…å’Œä½¿ç”¨ Docker çš„ä½“éªŒå¦‚ä½•ã€‚</p>
<p>åŒæ ·ï¼Œä½¿ç”¨ <code>dnf</code> åŒ…ç®¡ç†å™¨è¿›è¡Œå®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo dnf install docker-engine
</code></pre>
<p>å¯åŠ¨ Docker æœåŠ¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl start docker
sudo systemctl <span class="hljs-built_in">enable</span> docker
</code></pre>
<p>ä¸ºäº†æ–¹ä¾¿åç»­æ“ä½œï¼Œæˆ‘å°†å½“å‰ç”¨æˆ·åŠ å…¥äº† <code>docker</code> ç”¨æˆ·ç»„ï¼Œé¿å…æ¯æ¬¡éƒ½è¾“å…¥ <code>sudo</code>ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">sudo usermod -aG docker $(<span class="hljs-built_in">whoami</span>)
<span class="hljs-comment"># é‡æ–°ç™»å½•ä»¥ç”Ÿæ•ˆ</span>
</code></pre>
<p>æ‰§è¡Œç»å…¸çš„ <code>docker run hello-world</code>ï¼Œç†Ÿæ‚‰çš„â€œHello from Docker!â€ä¿¡æ¯å‡ºç°åœ¨å±å¹•ä¸Šï¼Œå®£å‘Š Docker åœ¨ openEuler ä¸Šçš„å®Œç¾è¿è¡Œã€‚</p>
<p>è¿™æ¬¡åŒå¼•æ“çš„ä½“éªŒè®©æˆ‘æ„Ÿåˆ°éå¸¸æ”¾å¿ƒã€‚openEuler ä¸ä»…åœ¨åŠªåŠ›æ„å»ºè‡ªå·±çš„æ ¸å¿ƒæŠ€æœ¯ï¼ˆiSulaï¼‰ï¼Œä¹Ÿå®Œå…¨æ‹¥æŠ±äº†ä¸»æµçš„å¼€æºç”Ÿæ€ï¼ˆDockerï¼‰ï¼Œä¸ºå¼€å‘è€…å’Œä¼ä¸šæä¾›äº†çµæ´»çš„é€‰æ‹©ã€‚è¿™ç§â€œåŒæ“é©±åŠ¨â€çš„æ¨¡å¼ï¼Œæ— ç–‘æ˜¯å…¶åœ¨äº‘åŸç”Ÿé¢†åŸŸç«äº‰çš„ä¸€å¤§ä¼˜åŠ¿ã€‚</p>
<h2 data-id="heading-5">ä¸‰ã€å®æˆ˜æ¼”ç»ƒï¼šéƒ¨ç½²ä¸€ä¸ªåŸºäº Python çš„å¾®æœåŠ¡åº”ç”¨</h2>
<p>ç†è®ºåƒéï¼Œä¸å¦‚å®æˆ˜ä¸€ç•ªã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°†æ¨¡æ‹Ÿä¸€ä¸ªçœŸå®çš„å¼€å‘åœºæ™¯ï¼šåœ¨ openEuler ä¸Šï¼Œä½¿ç”¨ Docker Compose éƒ¨ç½²ä¸€ä¸ªç”± <strong>Flask Web åº”ç”¨</strong> å’Œ <strong>Redis æ•°æ®åº“</strong> ç»„æˆçš„ç®€å•å¾®æœåŠ¡ã€‚</p>
<p>è¿™ä¸ªåº”ç”¨çš„åŠŸèƒ½å¾ˆç®€å•ï¼šä¸€ä¸ªè®¿é—®è®¡æ•°å™¨ã€‚æ¯æ¬¡è®¿é—®ç½‘é¡µï¼Œè®¡æ•°å™¨åŠ ä¸€ï¼Œæ•°æ®æŒä¹…åŒ–åœ¨ Redis ä¸­ã€‚</p>
<h3 data-id="heading-6">æ­¥éª¤ä¸€ï¼šå‡†å¤‡åº”ç”¨ä»£ç å’Œ Dockerfile</h3>
<p>é¦–å…ˆï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªé¡¹ç›®ç›®å½• <code>flask-redis-app</code>ï¼Œå¹¶åœ¨å…¶ä¸­ç¼–å†™äº† Python åº”ç”¨ <code>app.py</code>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># app.py</span>
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask
<span class="hljs-keyword">from</span> redis <span class="hljs-keyword">import</span> Redis
<span class="hljs-keyword">import</span> os

app = Flask(__name__)
<span class="hljs-comment"># ä»ç¯å¢ƒå˜é‡è·å– Redis ä¸»æœºåï¼Œå®ç°æœåŠ¡è§£è€¦</span>
redis = Redis(host=os.environ.get(<span class="hljs-string">'REDIS_HOST'</span>, <span class="hljs-string">'redis'</span>), port=<span class="hljs-number">6379</span>)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():
    count = redis.incr(<span class="hljs-string">'hits'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">f'Hello from openEuler! This page has been viewed <span class="hljs-subst">{count}</span> times.\n'</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    app.run(host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">5000</span>, debug=<span class="hljs-literal">True</span>)
</code></pre>
<p>ç„¶åï¼Œä¸ºè¿™ä¸ª Flask åº”ç”¨ç¼–å†™ <code>Dockerfile</code>ï¼Œç”¨äºå°†å…¶æ‰“åŒ…æˆä¸€ä¸ªå®¹å™¨é•œåƒï¼š</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># Dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

ENV REDIS_HOST=redis

CMD ["python", "app.py"]
</code></pre>
<p>å…¶ä¸­ <code>requirements.txt</code> æ–‡ä»¶å†…å®¹ä¸ºï¼š</p>
<pre><code class="hljs language-json" lang="json">Flask
redis
</code></pre>
<h3 data-id="heading-7">æ­¥éª¤äºŒï¼šæ„å»º Web åº”ç”¨é•œåƒ</h3>
<p>åœ¨ <code>flask-redis-app</code> ç›®å½•ä¸‹ï¼Œæˆ‘ä½¿ç”¨ Docker æ‰§è¡Œäº†æ„å»ºå‘½ä»¤ã€‚openEuler ç³»ç»Ÿè¡¨ç°å¾—éå¸¸ç¨³å®šï¼Œç½‘ç»œä¸‹è½½ä¾èµ–åŒ…çš„é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">docker build -t flask-redis-counter .
</code></pre>
<p>æ„å»ºæˆåŠŸåï¼Œé€šè¿‡ <code>docker images</code> å‘½ä»¤å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ–°é²œå‡ºç‚‰çš„ <code>flask-redis-counter</code> é•œåƒã€‚</p>
<h3 data-id="heading-8">æ­¥éª¤ä¸‰ï¼šä½¿ç”¨ Docker Compose ç¼–æ’æœåŠ¡</h3>
<p>å•ä¸ªå®¹å™¨ä¸è¶³ä»¥ç§°ä¸ºâ€œå¾®æœåŠ¡â€ã€‚ä¸ºäº†åŒæ—¶ç®¡ç† Web åº”ç”¨å’Œ Redis æ•°æ®åº“è¿™ä¸¤ä¸ªæœåŠ¡ï¼Œæˆ‘å¼•å…¥äº† Docker Composeã€‚</p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º <code>docker-compose.yml</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># docker-compose.yml</span>
<span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">web:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">flask-redis-counter</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5000:5000"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">REDIS_HOST=redis</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>

  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">"redis:alpine"</span>
</code></pre>
<p>è¿™ä¸ªç¼–æ’æ–‡ä»¶å®šä¹‰äº† <code>web</code> å’Œ <code>redis</code> ä¸¤ä¸ªæœåŠ¡ã€‚<code>web</code> æœåŠ¡é€šè¿‡ <code>build: .</code> æŒ‡ä»¤ä½¿ç”¨å½“å‰ç›®å½•çš„ Dockerfile æ„å»ºï¼Œå¹¶å°†å®¹å™¨çš„5000ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„5000ç«¯å£ã€‚<code>redis</code> æœåŠ¡åˆ™ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„è½»é‡çº§ <code>redis:alpine</code> é•œåƒã€‚<code>depends_on</code> ç¡®ä¿äº† <code>redis</code> æœåŠ¡ä¼šå…ˆäº <code>web</code> æœåŠ¡å¯åŠ¨ã€‚</p>
<h3 data-id="heading-9">æ­¥éª¤å››ï¼šå¯åŠ¨å¹¶éªŒè¯åº”ç”¨</h3>
<p>ä¸‡äº‹ä¿±å¤‡ï¼Œåªæ¬ ä¸œé£ã€‚åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ <code>docker-compose up</code> å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker-compose up -d
</code></pre>
<p><code>-d</code> å‚æ•°è®©æœåŠ¡åœ¨åå°è¿è¡Œã€‚å¾ˆå¿«ï¼Œä¸¤ä¸ªå®¹å™¨éƒ½æˆåŠŸå¯åŠ¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>docker-compose ps</code> æˆ– <code>docker ps</code> æŸ¥çœ‹å®¹å™¨çŠ¶æ€ã€‚</p>
<p>æœ€åï¼Œè¿›è¡Œæ¿€åŠ¨äººå¿ƒçš„éªŒè¯ç¯èŠ‚ã€‚æˆ‘æ‰“å¼€äº† openEuler è‡ªå¸¦çš„ Firefox æµè§ˆå™¨ï¼Œè®¿é—® <code>http://127.0.0.1:5000</code>ã€‚é¡µé¢æˆåŠŸæ˜¾ç¤ºï¼</p>
<blockquote>
<p>Hello from openEuler! This page has been viewed 1 times.</p>
</blockquote>
<p>åˆ·æ–°é¡µé¢ï¼Œæ•°å­—ä¸æ–­å¢åŠ ï¼Œè¯æ˜ Flask åº”ç”¨ä¸ Redis ä¹‹é—´çš„é€šä¿¡å®Œå…¨æ­£å¸¸ï¼Œæ•°æ®ä¹Ÿå¾—åˆ°äº†æŒä¹…åŒ–ã€‚æˆ‘ä¹Ÿä½¿ç”¨äº† <code>curl</code> å‘½ä»¤ä»ç»ˆç«¯è¿›è¡Œäº†éªŒè¯ï¼ŒåŒæ ·å¾—åˆ°äº†æ­£ç¡®çš„ç»“æœã€‚</p>
<p>è¿™ä¸ªå®æˆ˜æ¡ˆä¾‹è™½ç„¶ç®€å•ï¼Œä½†å®ƒå®Œæ•´åœ°è¦†ç›–äº†äº‘åŸç”Ÿåº”ç”¨å¼€å‘ä¸éƒ¨ç½²çš„æ ¸å¿ƒæµç¨‹ï¼š<strong>ä»£ç å¼€å‘ -&gt; é•œåƒæ„å»º -&gt; æœåŠ¡ç¼–æ’ -&gt; éƒ¨ç½²è¿è¡Œ</strong>ã€‚åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼ŒopenEuler æä¾›äº†ç¨³å®šå¯é çš„è¿è¡Œç¯å¢ƒï¼Œæ— è®ºæ˜¯ Docker çš„å…¼å®¹æ€§ã€ç½‘ç»œåŠŸèƒ½ï¼Œè¿˜æ˜¯ç³»ç»Ÿè‡ªèº«çš„æ€§èƒ½ï¼Œéƒ½è¡¨ç°å¾—æ— å¯æŒ‘å‰”ã€‚å®ƒå°±åƒä¸€ä¸ªæ²‰é»˜è€Œå¼ºå¤§çš„ä¼™ä¼´ï¼Œä¸ºä¸Šå±‚çš„åº”ç”¨åˆ›æ–°æä¾›äº†åšå®çš„æ”¯æ’‘ã€‚</p>
<h2 data-id="heading-10">å››ã€æ·±åº¦è€ƒé‡ï¼šæ€§èƒ½ã€å®‰å…¨ä¸ç”Ÿæ€</h2>
<p>ä¸€ä¸ªä¼˜ç§€çš„æœåŠ¡å™¨æ“ä½œç³»ç»Ÿï¼Œé™¤äº†èƒ½è·‘é€šåº”ç”¨ï¼Œæ›´è¦åœ¨æ€§èƒ½ã€å®‰å…¨å’Œç”Ÿæ€è¿™äº›â€œå†…åŠŸâ€ä¸Šè§çœŸç« ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e58bb54a68064c148a4f2fea23339a94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=mEM3rMMSFF8%2BsZXSuN59hICqhHI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">1. æ€§èƒ½è§‚å¯Ÿ</h3>
<p>åœ¨è¿è¡Œä¸Šè¿°å¾®æœåŠ¡åº”ç”¨æ—¶ï¼Œæˆ‘é€šè¿‡ <code>top</code> å’Œ <code>free -m</code> ç­‰å·¥å…·å¯¹ç³»ç»Ÿèµ„æºå ç”¨è¿›è¡Œäº†æŒç»­è§‚å¯Ÿã€‚åœ¨ç©ºè½½çŠ¶æ€ä¸‹ï¼ŒopenEuler 22.03 LTS SP3ï¼ˆå¸¦æœ‰GNOMEæ¡Œé¢ï¼‰çš„å†…å­˜å ç”¨ç¨³å®šåœ¨1.2Gå·¦å³ï¼Œå¯¹äºä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ç°ä»£æœåŠ¡å™¨ç³»ç»Ÿæ¥è¯´ï¼Œè¿™ä¸ªè¡¨ç°ç›¸å½“ä¸é”™ã€‚å½“å®¹å™¨åº”ç”¨è¿è¡Œåï¼ŒCPUå’Œå†…å­˜çš„å¢é‡æ¶ˆè€—ä¹Ÿå¤„åœ¨ä¸€ä¸ªéå¸¸åˆç†çš„èŒƒå›´ï¼Œç³»ç»Ÿå“åº”ä¾æ—§è¿…é€Ÿï¼Œæ²¡æœ‰ä¸æ¯«å¡é¡¿ã€‚</p>
<p>è¿™èƒŒåï¼Œå¾—ç›Šäº openEuler åœ¨å†…æ ¸å±‚é¢çš„æ·±åº¦ä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œå®ƒé’ˆå¯¹å¤šç§ä½“ç³»ç»“æ„ï¼ˆå¦‚x86ã€ARMï¼‰è¿›è¡Œäº†æ€§èƒ½è°ƒä¼˜ï¼Œå¹¶å¼•å…¥äº†å¦‚ <strong>multi-generational LRU</strong> ç­‰å…ˆè¿›çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œè¿™äº›ä¼˜åŒ–åœ¨äº‘åŸç”Ÿè¿™ç§é«˜å¯†åº¦ã€é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œèƒ½å¤Ÿå¸¦æ¥å®å®åœ¨åœ¨çš„æ€§èƒ½æå‡ã€‚</p>
<h3 data-id="heading-12">2. å®‰å…¨ä¿éšœ</h3>
<p>å®‰å…¨æ˜¯äº‘åŸç”Ÿç¯å¢ƒçš„ç”Ÿå‘½çº¿ã€‚openEuler åœ¨è¿™æ–¹é¢æ„å»ºäº†ç«‹ä½“çš„é˜²å¾¡ä½“ç³»ã€‚æˆ‘æ³¨æ„åˆ°ç³»ç»Ÿé»˜è®¤å¼€å¯äº† SELinuxï¼Œè¿™æ˜¯Linuxç³»ç»Ÿæœ€å¼ºå¤§çš„å¼ºåˆ¶è®¿é—®æ§åˆ¶æœºåˆ¶ä¹‹ä¸€ã€‚å¯¹äºå®¹å™¨ç¯å¢ƒè€Œè¨€ï¼Œè¿™æ„å‘³ç€å³ä½¿å®¹å™¨å†…åº”ç”¨è¢«æ”»ç ´ï¼ŒSELinux ä¹Ÿèƒ½æœ‰æ•ˆé™åˆ¶å…¶å¯¹å®¿ä¸»æœºèµ„æºçš„è®¿é—®ï¼Œé˜²æ­¢â€œé€ƒé€¸â€äº‹ä»¶çš„å‘ç”Ÿã€‚</p>
<p>æ­¤å¤–ï¼ŒopenEuler ç¤¾åŒºè¿˜å­µåŒ–äº† <strong>SecMaster</strong> è¿™æ ·çš„å®‰å…¨ç®¡ç†æ¡†æ¶ï¼Œå®ƒèƒ½å¤Ÿæä¾›ç»Ÿä¸€çš„æ¼æ´ç®¡ç†ã€å…¥ä¾µæ£€æµ‹ã€å®‰å…¨å®¡è®¡ç­‰èƒ½åŠ›ã€‚è™½ç„¶åœ¨æœ¬æ¬¡è¯„æµ‹ä¸­æœªèƒ½æ·±åº¦ä½“éªŒ SecMasterï¼Œä½†å®ƒçš„å­˜åœ¨æœ¬èº«å°±å±•ç¤ºäº† openEuler å¯¹ç³»ç»Ÿå®‰å…¨çš„ç³»ç»Ÿæ€§æ€è€ƒå’Œå¸ƒå±€ï¼Œä¸ºä¼ä¸šç”¨æˆ·æä¾›äº†â€œå¼€ç®±å³ç”¨â€çš„å®‰å…¨æ„Ÿã€‚</p>
<h3 data-id="heading-13">3. ç”Ÿæ€ä¸ç¤¾åŒº</h3>
<p>ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„ç”Ÿå‘½åŠ›ï¼Œæœ€ç»ˆå–å†³äºå…¶ç”Ÿæ€çš„ç¹è£ç¨‹åº¦ã€‚æˆ‘éšæ‰‹ä½¿ç”¨ <code>dnf search</code> å°è¯•æœç´¢äº†ä¸€äº›å¸¸ç”¨çš„å¼€å‘å·¥å…·å’Œè½¯ä»¶ï¼Œå¦‚ <code>nginx</code>, <code>postgresql</code>, <code>git</code>, <code>java-11-openjdk</code> ç­‰ï¼Œæ— ä¸€ä¾‹å¤–éƒ½èƒ½åœ¨å®˜æ–¹æºä¸­æ‰¾åˆ°ã€‚è¿™è¯´æ˜ openEuler çš„è½¯ä»¶ç”Ÿæ€å·²ç»ç›¸å½“æˆç†Ÿï¼Œèƒ½å¤Ÿæ»¡è¶³ç»å¤§å¤šæ•°å¼€å‘å’Œè¿ç»´åœºæ™¯çš„éœ€æ±‚ã€‚</p>
<p>æ›´è®©æˆ‘å°è±¡æ·±åˆ»çš„æ˜¯ openEuler çš„ç¤¾åŒºæ²»ç†æ¨¡å¼ã€‚å®ƒé€šè¿‡ <strong>SIGï¼ˆSpecial Interest Groupï¼Œç‰¹åˆ«å…´è¶£å°ç»„ï¼‰</strong> çš„æ–¹å¼ï¼Œæ±‡èšäº†æ¥è‡ªå…¨çƒçš„å¼€å‘è€…ã€é«˜æ ¡å’Œä¼ä¸šï¼Œå›´ç»•å†…æ ¸ã€è™šæ‹ŸåŒ–ã€äº‘åŸç”Ÿã€æ¡Œé¢ç­‰ä¸åŒæŠ€æœ¯æ–¹å‘è¿›è¡Œè´¡çŒ®ã€‚è¿™ç§å¼€æ”¾ã€é€æ˜çš„ç¤¾åŒºè¿ä½œæ¨¡å¼ï¼Œæ˜¯ openEuler èƒ½å¤ŸæŒç»­åˆ›æ–°ã€å¿«é€Ÿæ¼”è¿›çš„æºåŠ¨åŠ›ã€‚å®ƒçš„æ–‡æ¡£åº“ä¹Ÿç›¸å½“å®Œå–„ï¼Œæ— è®ºæ˜¯æ–°æ‰‹å…¥é—¨è¿˜æ˜¯ä¸“å®¶æ·±å…¥ï¼Œéƒ½èƒ½æ‰¾åˆ°æ¸…æ™°çš„æŒ‡å¼•ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69a2c308731b4a27b2a3a7f9962f58a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=Id59chcf98n0Ns%2FDptzqGUGlCfc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14">æ€»ç»“ä¸å±•æœ›</h2>
<p>ç»è¿‡è¿™æ¬¡ä»å®‰è£…åˆ°å®æˆ˜éƒ¨ç½²çš„æ·±åº¦è¯„æµ‹ï¼ŒopenEuler ç»™æˆ‘ç•™ä¸‹äº†æä¸ºæ·±åˆ»å’Œæ­£é¢çš„å°è±¡ã€‚å®ƒä¸å†æ˜¯ä¸€ä¸ªâ€œè¿½éšè€…â€ï¼Œè€Œæ˜¯ä¸€ä¸ªåœ¨äº‘åŸç”Ÿæ—¶ä»£æ‹¥æœ‰è‡ªå·±ç‹¬ç‰¹æ€è€ƒå’Œæ ¸å¿ƒèƒ½åŠ›çš„â€œé¢†è·‘è€…â€ã€‚</p>
<ul>
<li><strong>åšå¦‚ç£çŸ³çš„ç¨³å®šæ€§</strong>ï¼šä½œä¸ºä¸€æ¬¾LTSç‰ˆæœ¬ï¼Œå®ƒåœ¨æ•´ä¸ªè¯„æµ‹è¿‡ç¨‹ä¸­è¡¨ç°å‡ºäº†å“è¶Šçš„ç¨³å®šæ€§ï¼Œæ— æ„§äºå…¶â€œæ•°å­—åŸºç¡€è®¾æ–½æ“ä½œç³»ç»Ÿâ€çš„å®šä½ã€‚</li>
<li><strong>çµæ´»å¼ºå¤§çš„äº‘åŸç”Ÿèƒ½åŠ›</strong>ï¼šåŒæ—¶æ”¯æŒ iSula å’Œ Dockerï¼Œä¸ºç”¨æˆ·æä¾›äº†çµæ´»é€‰æ‹©ï¼Œå¹¶å®Œç¾å…¼å®¹ä¸»æµäº‘åŸç”Ÿå·¥å…·é“¾ï¼Œä¸Šæ‰‹å³ç”¨ã€‚</li>
<li><strong>å†…åŠŸæ·±åšçš„æ€§èƒ½ä¸å®‰å…¨</strong>ï¼šåœ¨å†…æ ¸å±‚é¢çš„æŒç»­ä¼˜åŒ–å’Œç³»ç»Ÿæ€§çš„å®‰å…¨è®¾è®¡ï¼Œä½¿å…¶åœ¨é«˜è´Ÿè½½å’Œé«˜å®‰å…¨è¦æ±‚çš„ç”Ÿäº§ç¯å¢ƒä¸­å€¼å¾—ä¿¡èµ–ã€‚</li>
<li><strong>å¼€æ”¾ç¹è£çš„ç”Ÿæ€ç¤¾åŒº</strong>ï¼šæˆç†Ÿçš„è½¯ä»¶ä»“åº“å’Œå……æ»¡æ´»åŠ›çš„ç¤¾åŒºï¼Œæ˜¯å…¶æœªæ¥å‘å±•çš„æœ€å¤§ä¿éšœã€‚</li>
</ul>
<p>å½“ç„¶ï¼Œé‡‘æ— è¶³èµ¤ï¼Œä»»ä½•ç³»ç»Ÿéƒ½æœ‰æŒç»­è¿›æ­¥çš„ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ–°æ‰‹è€Œè¨€ï¼ŒiSula çš„ç”Ÿæ€å·¥å…·å’Œæ–‡æ¡£ä¸°å¯Œåº¦ç›¸è¾ƒäº Docker è¿˜æœ‰æå‡ç©ºé—´ï¼›å›¾å½¢åŒ–ç•Œé¢ä¸‹çš„ä¸€äº›äº¤äº’ç»†èŠ‚ä¹Ÿå¯ä»¥è¿›ä¸€æ­¥æ‰“ç£¨ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bb958fe762243f1880e480a3d57d1e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnVn6I-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765338769&amp;x-signature=NTcu0vkoAkRye79Hsby5HECxG2A%3D" alt="" loading="lazy"/></p>
<p>æ€»è€Œè¨€ä¹‹ï¼Œè¿™æ¬¡è¯„æµ‹è®©æˆ‘çœŸåˆ‡åœ°æ„Ÿå—åˆ°ï¼ŒopenEuler å·²ç»ä¸ºæ‰¿è½½å¤æ‚çš„äº‘åŸç”Ÿåº”ç”¨åšå¥½äº†å……åˆ†çš„å‡†å¤‡ã€‚å®ƒä¸ä»…æ˜¯ä¸€æ¬¾å¯ä»¥â€œç”¨â€çš„æ“ä½œç³»ç»Ÿï¼Œæ›´æ˜¯ä¸€æ¬¾å€¼å¾—ä¿¡èµ–å’Œæ‰˜ä»˜çš„â€œå¥½ç”¨â€çš„æ“ä½œç³»ç»Ÿã€‚æˆ‘ç”±è¡·åœ°ä¸ºè‡ªä¸»åˆ›æ–°å¼€æºæŠ€æœ¯èƒ½è¾¾åˆ°å¦‚æ­¤é«˜åº¦è€Œæ„Ÿåˆ°è‡ªè±ªï¼Œå¹¶å¼ºçƒˆæ¨èå„ä½å¼€å‘è€…å’ŒæŠ€æœ¯çˆ±å¥½è€…ä»¬ï¼Œäº²æ‰‹å»ä½“éªŒä¸€ç•ª openEuler çš„é­…åŠ›ã€‚</p>
<p>æˆ‘ç›¸ä¿¡ï¼Œåœ¨å¼€æºå…±å»ºçš„åŠ›é‡ä¸‹ï¼ŒopenEuler è¿™å—äº‘åŸç”ŸåŸºçŸ³ï¼Œå¿…å°†æ”¯æ’‘èµ·æ›´å¤šã€æ›´å®ä¼Ÿçš„æ•°å­—åŒ–åº”ç”¨å¤§å¦ã€‚æ—…ç¨‹æœªæ­¢ï¼Œæ¢ç´¢ä¸æ¯ï¼ŒæœŸå¾…ä¸ openEuler åœ¨æœªæ¥çš„æŠ€æœ¯æµªæ½®ä¸­å†æ¬¡ç›¸é‡ï¼</p>
<blockquote>
<p>å£°æ˜ï¼šå¦‚ä¸Šéƒ¨é—¨å†…å®¹åŠé…å›¾æ¥æºå…¬å¼€äº’è”ç½‘ï¼Œè‹¥æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ã€‚</p>
</blockquote>
<p>-End-</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Milvus åˆ†è¯å™¨å­¦ä¹ ç¬”è®°]]></title>    <link>https://juejin.cn/post/7579179741824598042</link>    <guid>https://juejin.cn/post/7579179741824598042</guid>    <pubDate>2025-12-03T05:15:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179741824598042" data-draft-id="7579179741824483354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Milvus åˆ†è¯å™¨å­¦ä¹ ç¬”è®°"/> <meta itemprop="keywords" content="LangChain"/> <meta itemprop="datePublished" content="2025-12-03T05:15:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤©æ˜Ÿçƒ›"/> <meta itemprop="url" content="https://juejin.cn/user/1099167359051949"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Milvus åˆ†è¯å™¨å­¦ä¹ ç¬”è®°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167359051949/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤©æ˜Ÿçƒ›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:15:28.000Z" title="Wed Dec 03 2025 05:15:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ–‡ç« æ˜¯å…³äº å­¦ä¹ ç å³°æ¶æ„AIè¯¾çš„å­¦ä¹ ç¬”è®°</p>
<h2 data-id="heading-0">1. åˆ†è¯å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>åˆ†è¯å™¨ï¼ˆTokenizerï¼‰æ˜¯ç”¨æ¥æŠŠä¸€æ®µæ–‡æœ¬æ‹†åˆ†æˆ"è¯è¯­"æˆ–"å…³é”®è¯"çš„å·¥å…·ã€‚</p>
<h2 data-id="heading-1">2. ## å¸¸è§åˆ†è¯å™¨ç±»å‹</h2>
<ul>
<li><strong>Standardï¼ˆæ ‡å‡†åˆ†è¯ï¼‰</strong> ï¼šé€‚åˆè‹±æ–‡ã€æ•°å­—ã€æ ‡ç‚¹åˆ†éš”çš„æ–‡æœ¬ã€‚</li>
<li><strong>Whitespaceï¼ˆç©ºæ ¼åˆ†è¯ï¼‰</strong> ï¼šåªæŒ‰ç©ºæ ¼åˆ‡åˆ†ï¼Œé€‚åˆè‹±æ–‡ã€ä»£ç ç­‰ã€‚</li>
<li><strong>Chineseï¼ˆä¸­æ–‡åˆ†è¯ï¼‰</strong> ï¼šé€‚åˆä¸­æ–‡å¥å­ï¼Œèƒ½æ™ºèƒ½è¯†åˆ«è¯è¯­è¾¹ç•Œã€‚</li>
<li><strong>Simpleï¼ˆç®€å•åˆ†è¯ï¼‰</strong> ï¼šæŒ‰å­—æ¯ã€æ•°å­—ç­‰ç®€å•è§„åˆ™åˆ‡åˆ†ã€‚</li>
</ul>
<h2 data-id="heading-2">3. åˆ†åŒºé”®</h2>
<p>åˆ†åŒºé”®ç”¨æ¥å°†å¤§é‡æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚
æ¯”å¦‚æˆ‘ä»¬ç­é‡Œæƒ³æŠŠåŒå­¦ä»¬è¿›è¡Œåˆ†ç»„ï¼Œåˆ†ç»„çš„ä¾æ®æ˜¯åŒå­¦ä»¬çš„å§“æ°ï¼Œé‚£ä¹ˆå§“æ°å°±æ˜¯åˆ†åŒºé”®</p>
<p>æ‰‹å†™ä¸€ä¸ªç®€å•çš„ä¸­æ–‡åˆ†è¯å™¨</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict

<span class="hljs-comment"># import typing</span>
<span class="hljs-keyword">import</span> jieba

<span class="hljs-comment"># å®šä¹‰ç¤ºä¾‹æ–‡æ¡£æ•°æ®ï¼Œæ¯ä¸ªæ–‡æ¡£åŒ…å«â€œidâ€ã€â€œåˆ†åŒºé”®â€ã€â€œå†…å®¹â€</span>
documents = [
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"partition_key"</span>: <span class="hljs-string">"å¼ "</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"å¼ ä¸‰å–œæ¬¢ç¼–ç¨‹å’Œç”µè„‘æ¸¸æˆ"</span>},
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"partition_key"</span>: <span class="hljs-string">"æ"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"æå››çƒ­çˆ±è®¡ç®—æœºç§‘å­¦"</span>},
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">3</span>, <span class="hljs-string">"partition_key"</span>: <span class="hljs-string">"ç‹"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"ç‹äº”å–œæ¬¢é˜…è¯»æŠ€æœ¯ä¹¦ç±"</span>},
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">4</span>, <span class="hljs-string">"partition_key"</span>: <span class="hljs-string">"å¼ "</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"å¼ æ°é’Ÿçˆ±ç¬”è®°æœ¬ç”µè„‘"</span>},
]

<span class="hljs-comment"># å®šä¹‰åŒä¹‰è¯æ˜ å°„ï¼Œâ€œé”®â€ä¸ºä»£è¡¨è¯ï¼Œâ€œå€¼â€ä¸ºåŒä¹‰è¯é›†åˆï¼ˆç”¨äºæ‰©å±•åŒ¹é…ï¼‰</span>
synonym_map = {
    <span class="hljs-string">"ç”µè„‘"</span>: {<span class="hljs-string">"ç”µè„‘"</span>, <span class="hljs-string">"è®¡ç®—æœº"</span>, <span class="hljs-string">"PC"</span>},
    <span class="hljs-string">"ç¼–ç¨‹"</span>: {<span class="hljs-string">"ç¼–ç¨‹"</span>, <span class="hljs-string">"ç¨‹åºè®¾è®¡"</span>},
}


<span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_tokenize</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-comment"># è¯´æ˜: å¯¹æ–‡æœ¬è¿›è¡Œç®€å•åˆ†è¯ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰</span>
    <span class="hljs-keyword">return</span> [token <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> jieba.lcut_for_search(text) <span class="hljs-keyword">if</span> token.strip()]


<span class="hljs-comment"># æ ¹æ®â€œåˆ†åŒºé”®â€å¯¹æ–‡æ¡£è¿›è¡Œèšåˆï¼Œè¿”å›åˆ†åŒºå­—å…¸</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">build_partitions</span>(<span class="hljs-params">documents</span>):
    partitions = defaultdict(<span class="hljs-built_in">list</span>)
    <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
        partitions[doc[<span class="hljs-string">"partition_key"</span>]].append(doc)
    <span class="hljs-keyword">return</span> partitions


<span class="hljs-keyword">def</span> <span class="hljs-title function_">match_query</span>(<span class="hljs-params">partitions, keyword: <span class="hljs-built_in">str</span>, use_synonym=<span class="hljs-literal">True</span></span>):
    results = []
    <span class="hljs-comment"># å…³é”®è¯é›†åˆ</span>
    tokens_to_match = {keyword}
    <span class="hljs-keyword">if</span> use_synonym <span class="hljs-keyword">and</span> keyword <span class="hljs-keyword">in</span> synonym_map:
        tokens_to_match = synonym_map[keyword]

    <span class="hljs-comment"># éå†æ‰€æœ‰åˆ†åŒº, æŸ¥æ‰¾è¿”å›åŒ…å«å…³é”®è¯çš„åˆ†åŒº</span>

    <span class="hljs-keyword">for</span> partition_key, docs <span class="hljs-keyword">in</span> partitions.items():
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> docs:
            <span class="hljs-comment"># å¯¹ content è¿›è¡Œåˆ†è¯</span>
            tokens = simple_tokenize(doc[<span class="hljs-string">"content"</span>])
            <span class="hljs-comment"># åˆ¤æ–­äº¤é›†</span>
            <span class="hljs-keyword">if</span> tokens_to_match.intersection(tokens):
                results.append((partition_key, doc[<span class="hljs-string">"id"</span>], doc[<span class="hljs-string">"content"</span>]))
    <span class="hljs-keyword">return</span> results


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># åˆ†åŒºå­˜å‚¨</span>
    partitions = build_partitions(documents)
    <span class="hljs-comment"># ä¸¥æ ¼åŒ¹é…</span>
    <span class="hljs-comment"># hits = match_query(partitions, keyword="ç”µè„‘", use_synonym=False)</span>
    <span class="hljs-comment"># print("ä»…åŒ¹é…â€œç”µè„‘â€çš„ç»“æœï¼š")</span>
    <span class="hljs-comment"># for row in hits:</span>
    <span class="hljs-comment">#     print(row)</span>
    <span class="hljs-comment"># ç¤ºä¾‹2ï¼šå¯ç”¨åŒä¹‰è¯åŒ¹é…ï¼ˆâ€œç”µè„‘â€â‰ˆâ€œè®¡ç®—æœºâ€ï¼‰</span>
    hits_with_synonym = match_query(partitions, keyword=<span class="hljs-string">"ç”µè„‘"</span>, use_synonym=<span class="hljs-literal">True</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¯ç”¨åŒä¹‰è¯åŒ¹é…ï¼ˆâ€œç”µè„‘â€â‰ˆâ€œè®¡ç®—æœºâ€ï¼‰çš„ç»“æœï¼š"</span>)
    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> hits_with_synonym:
        <span class="hljs-built_in">print</span>(row)

<span class="hljs-string">"""
 å¯ç”¨åŒä¹‰è¯åŒ¹é…ï¼ˆâ€œç”µè„‘â€â‰ˆâ€œè®¡ç®—æœºâ€ï¼‰çš„ç»“æœï¼š
('å¼ ', 1, 'å¼ ä¸‰å–œæ¬¢ç¼–ç¨‹å’Œç”µè„‘æ¸¸æˆ')
('å¼ ', 4, 'å¼ æ°é’Ÿçˆ±ç¬”è®°æœ¬ç”µè„‘')
('æ', 2, 'æå››çƒ­çˆ±è®¡ç®—æœºç§‘å­¦')
"""</span>

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[Ai Agent] 10 MCPåŸºç¡€ï¼šæ‰“ç ´å­¤å²›ï¼Œè®©MCPè¿æ¥ä¸‡ç‰©]]></title>    <link>https://juejin.cn/post/7579165599042764815</link>    <guid>https://juejin.cn/post/7579165599042764815</guid>    <pubDate>2025-12-03T04:58:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579165599042764815" data-draft-id="7579169543232552960" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[Ai Agent] 10 MCPåŸºç¡€ï¼šæ‰“ç ´å­¤å²›ï¼Œè®©MCPè¿æ¥ä¸‡ç‰©"/> <meta itemprop="keywords" content="LangChain,MCP"/> <meta itemprop="datePublished" content="2025-12-03T04:58:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†ä¼šå‘€"/> <meta itemprop="url" content="https://juejin.cn/user/446878782598644"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [Ai Agent] 10 MCPåŸºç¡€ï¼šæ‰“ç ´å­¤å²›ï¼Œè®©MCPè¿æ¥ä¸‡ç‰©
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/446878782598644/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†ä¼šå‘€
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:58:27.000Z" title="Wed Dec 03 2025 04:58:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»30åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åšå®¢é…å¥—ä»£ç å‘å¸ƒäº<a href="https://link.juejin.cn?target=https%3A%2F%2Fso.csdn.net%2Fso%2Fsearch%3Fq%3Dgithub%26spm%3D1001.2101.3001.7020" title="https://so.csdn.net/so/search?q=github&amp;spm=1001.2101.3001.7020" target="_blank" ref="nofollow noopener noreferrer">github</a>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAnnyfee%2Fagent-craft" title="https://github.com/Annyfee/agent-craft" target="_blank" ref="nofollow noopener noreferrer">10 MCP åŸºç¡€</a></p>
<p><strong>æœ¬ç³»åˆ—æ‰€æœ‰åšå®¢å‡é…å¥—Gihubå¼€æºä»£ç ï¼Œå¼€ç®±å³ç”¨ï¼Œä»…éœ€é…ç½®API_KEYã€‚</strong></p>
<p>å¦‚æœè¯¥Agentæ•™å­¦ç³»åˆ—å¸®åˆ°äº†ä½ ï¼Œ<strong>æ¬¢è¿ç»™æˆ‘ä¸ªStarâ­</strong>ï¼</p>
<p><strong>çŸ¥è¯†ç‚¹</strong>ï¼š<strong>Stdioä¼ è¾“ | Streamingè¾“å‡ºÂ | Adapteré€‚é…å™¨ | AsyncExitStack | JSON-RPC | MCPåè®®</strong></p>
<hr/>
<h2 data-id="heading-0">åºç« ï¼šä»â€œé€ è½®å­â€åˆ°â€œæ’USBâ€</h2>
<p>åœ¨07ç¯‡ä¸­ï¼Œä¸ºäº†è®©AgentæŸ¥å¤©æ°”ï¼Œæˆ‘ä»¬ä¸å¾—ä¸<strong>æ‰‹å†™</strong>äº†ä¸€ä¸ª get_weather å‡½æ•°ã€‚</p>
<p>ä½†å¦‚æœæˆ‘æƒ³ç”¨é«˜å¾·åœ°å›¾æŸ¥è·¯çº¿ï¼Œç”¨Githubç®¡ç†ä»£ç ï¼Œç”¨é£ä¹¦å‘æ¶ˆæ¯ï¼Œéš¾é“æˆ‘è¦æŠŠè¿™äº›æ‰€æœ‰æœåŠ¡çš„APIæ–‡æ¡£å…¨éƒ¨è¯»ä¸€éå—ï¼Œç„¶åæ‰‹å†™å‡ ç™¾ä¸ª @tool å—ï¼Ÿ</p>
<p>å½“ç„¶ä¸ï¼Œè¿™å°±æ˜¯ <strong>å·¥å…·å­¤å²›</strong> é—®é¢˜ã€‚</p>
<p>Model Context Protocol (MCP) çš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†æ‰“ç ´è¿™ä¸ªå­¤å²›ã€‚å®ƒå°±åƒAIæ—¶ä»£çš„USBåè®®ï¼š</p>
<ul>
<li><strong>MCP Serverï¼ˆæœåŠ¡å™¨ï¼‰</strong> ï¼šå°±æ˜¯â€œå¤–è®¾â€ï¼ˆå¦‚é«˜å¾·åœ°å›¾ï¼Œ12306ï¼‰ã€‚å¼€å‘è€…å†™å¥½ä¸€æ¬¡ï¼Œå…¨ä¸–ç•Œçš„Agentéƒ½èƒ½ç”¨ã€‚</li>
<li><strong>MCP Clinetï¼ˆå®¢æˆ·ç«¯ï¼‰</strong> ï¼šå°±æ˜¯â€œç”µè„‘â€ï¼ˆä½ çš„Agentï¼‰ã€‚ä½ ä¸éœ€è¦å†™é©±åŠ¨ï¼Œåªè¦æ’ä¸ŠUSBï¼ˆå»ºç«‹è¿æ¥ï¼‰ï¼ŒAgentå°±èƒ½ç›´æ¥ä½¿ç”¨è®¾å¤‡çš„æ‰€æœ‰åŠŸèƒ½ã€‚</li>
</ul>
<p>æœ¬ç« ç›®æ ‡ï¼šæˆ‘ä»¬ä¸å†™Serverï¼ˆè¿™æ˜¯ä¸‹ä¸€ç« çš„äº‹ï¼‰ï¼Œæˆ‘ä»¬å…ˆå­¦ä¹ å¦‚ä½•<strong>åšä¸€ä¸ªé€šç”¨çš„ Clinet</strong>ã€‚æˆ‘ä»¬å°†å…ˆç”¨ CherryStudio ä½“éªŒâ€œå³æ’å³ç”¨â€çš„å¿«æ„Ÿï¼Œç„¶å<strong>ç¼–å†™ç”Ÿäº§çº§çš„ Python å®¢æˆ·ç«¯</strong>ï¼Œå»è¿æ¥<strong>çœŸå®çš„</strong>é«˜å¾·åœ°å›¾æœåŠ¡ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€å¼€ç®±å³ç”¨ï¼šCherryStudio åˆä½“éªŒï¼ˆGUIï¼‰</h2>
<p>åœ¨å†™ä»£ç å‰ï¼Œæˆ‘ä»¬å…ˆç”¨ <strong>GUI å·¥å…·</strong>ç›´è§‚æ„Ÿå—ä¸€ä¸‹ MCP çš„å¨åŠ›ã€‚CherryStudioæ˜¯ç›®å‰å¯¹ MCP æ”¯æŒæœ€å¥½çš„å®¢æˆ·ç«¯ä¹‹ä¸€ã€‚</p>
<h3 data-id="heading-2">1. è·å–api_key</h3>
<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©é«˜å¾·åœ°å›¾æ¥ä½œä¸ºæˆ‘ä»¬çš„mcpè·å–æ–¹å¼ï¼š</p>
<p>è¿›å…¥Â <a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2F" title="https://lbs.amap.com/" target="_blank" ref="nofollow noopener noreferrer">lbs.amap.com/</a>Â ï¼Œæ³¨å†Œå¹¶ç™»å½•ã€‚</p>
<p>åœ¨æ–‡æ¡£ä¸æ”¯æŒé‡Œï¼Œè¿›å…¥MCP Serverï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e62497abb834189a0313ae1e998332d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=IyPY7PKLUg4Qx6bVfpgtvcyKi%2FA%3D" alt="" loading="lazy"/></p>
<p>åœ¨å¦‚ä¸‹ç•Œé¢ä¸­ï¼Œæ ¹æ®å®˜æ–¹æµç¨‹å®Œæ•´åšå®Œï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53b8d250e52941b08ac93f79acbd675a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=CGbb5XmgTuw%2BrumulGUzgeo8Suc%3D" alt="" loading="lazy"/></p>
<p>ï¼ˆè®¤è¯è¿™é‡Œé€‰ä¸ªäººå¼€å‘è€…ï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28672c71abbc4f589fa701718b1124a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=oE33%2BmHgJn34vjsRaoGpido2dGw%3D" alt="" loading="lazy"/></p>
<p>å¦‚å›¾ï¼ŒkeyæˆåŠŸåˆ›å»ºã€‚ä¿å­˜å¥½è¿™ä¸ªkeyï¼Œä¹‹åä¼šç”¨å¾—åˆ°ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8c345dec8d044bab096d2761fb28cf3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=I6fFBL53fdgcHzCuQNdHv7FGPj4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2. ä¸‹è½½ä¸å®‰è£…</h3>
<p>ç‚¹å¼€Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cherry-ai.com%2F" title="https://www.cherry-ai.com/" target="_blank" ref="nofollow noopener noreferrer">www.cherry-ai.com/</a>Â ï¼Œ<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ca377cf217a4eb3b6345af73b4d1fc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=07ogEOyMlgqWl2DKqNqSbWjwEzA%3D" alt="" loading="lazy"/></p>
<p>ä¸‹è½½è¯¥æ–‡ä»¶å¹¶å®‰è£…å¥½ã€‚</p>
<h3 data-id="heading-4">3. é…ç½®MCP</h3>
<p>ä¸‹è½½å¥½åï¼Œç‚¹å‡»å³ä¸Šè§’è®¾ç½®ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52c0092a13c54357b56e6a36eddd20fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=%2BDTlZvAkaHKeInq%2BnkMNykm7RB0%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å‡»MCPè¿›åˆ°è¿™é‡Œï¼Œå†ç‚¹å‡»æ·»åŠ -å¿«é€Ÿåˆ›å»ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2efaf3050a774ceab6d5c8e35658fe4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=u%2F1kgLz2ZbsGW1olmSdYzUcw6VQ%3D" alt="" loading="lazy"/></p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ ¹æ®é«˜å¾·åœ°å›¾æä¾›çš„æ„å»ºæ–¹å¼æ¥å†™ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90ec0479f9b2437183fb91a58a7a9335~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=sncyUOJV8zvhGufinf5SxYqQhe8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d1cce0b0750457bbfeaf49c6e77a2fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=Fzd2ov6YNgdeSj%2B2uyVxoCEe5uY%3D" alt="" loading="lazy"/></p>
<p>å®Œæˆåä¿å­˜å¹¶ç‚¹å‡»ï¼Œæ­¤æ—¶ä»£è¡¨MCPé“¾æ¥æˆåŠŸã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a910f649bd5a4ea0b519f0e1fbf49e82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=XljVJ7FjtJrH9%2FxDj%2B0STyFfsT0%3D" alt="" loading="lazy"/></p>
<p>æ³¨æ„ï¼šä½¿ç”¨å‰è¯·ç¡®ä¿ç¼–è¾‘æ—è¾¹çš„âš ï¸å·²å˜æˆâœ…ï¸ï¼Œå¦‚æœä¸ï¼Œå®‰è£…ä¸‹åˆ—ç¯å¢ƒï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f2c7bf9dee349daacc15234f247baf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=aKTutkNxqhigdP07dx1F%2BV1ZGik%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">4. æµ‹è¯•è¿è¡Œ</h3>
<p>æ‰“å¼€MCPæœåŠ¡ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79c61c0aea2d4951a4311f41f456ec10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=eG65jf0rtzfg0Y25T1WomDD1IWk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7637a70628b84b69bcc11eeb11f0c4bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=37paU2gisErXaTm0PvtDe0%2BJsNc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dc0a0a1462e48c7bf9568e56452fd85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=yXBIsLHVmau23XEu0dS58MUd42s%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å¼€æ¥ï¼Œèƒ½ç¡®å®šå®ƒçš„ç¡®è°ƒç”¨äº†MCPæœåŠ¡ã€‚</p>
<p>çœ‹ï¼šè¿™å°±æ˜¯MCPã€‚å·¥å…·ä¸åœ¨æœ¬åœ°ï¼Œç”šè‡³ä¸æ˜¯æˆ‘ä»¬å†™çš„ï¼Œä½†Agentå´èƒ½ç›´æ¥è°ƒç”¨ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¦ç”¨<strong>Python ä»£ç </strong>æ¥å®ç°è¿™ä¸ªç¥å¥‡çš„è¿‡ç¨‹ã€‚</p>
<h2 data-id="heading-6">äºŒã€å·¥ç¨‹åœ°åŸºï¼šç¯å¢ƒä¸åè®®</h2>
<p>åœ¨åŠ¨æ‰‹å†™ä»£ç å‰ï¼Œå…ˆå˜æ¸… MCP çš„è¿è¡Œåº•åº§ï¼š</p>
<ul>
<li>å¦‚ä½•å¯åŠ¨ä»»æ„è¯­è¨€çš„å·¥å…·ï¼Ÿâ€”â€” <strong>å¼•å…¥ uv / npxï¼ˆä¸´æ—¶æ‰§è¡Œï¼‰</strong></li>
<li>å¦‚ä½•é«˜æ•ˆé€šä¿¡ï¼Ÿ â€”â€” <strong>é€‰æ‹©Stdioï¼ˆæœ¬åœ°ï¼‰æˆ– HTTPï¼ˆè¿œç¨‹ï¼‰</strong></li>
<li>å¦‚ä½•é¿å…å¡æ­»æˆ–èµ„æºæ³„éœ²ï¼Ÿ â€”â€” <strong>å…¨é“¾è·¯å¼‚æ­¥ + AsyncExitStack</strong></li>
</ul>
<p>è¿™äº›éœ€æ±‚çš„ç­”æ¡ˆï¼Œæ„æˆäº†æˆ‘ä»¬æ¥ä¸‹æ¥è¦è®¨è®ºçš„å·¥ç¨‹åŸºç¡€ã€‚</p>
<h3 data-id="heading-7">1. å¼•å…¥uv/npxï¼šä¸´æ—¶æ‰§è¡Œçš„å¦™ç”¨</h3>
<p>åœ¨ MCP ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬éšæ—¶ä¼šè°ƒç”¨å¤§é‡å·¥å…·å‡½æ•°ï¼Œä½†æ¯ä¸ªå·¥å…·å¯èƒ½ä¾èµ–ä¸åŒçš„ç¯å¢ƒï¼š</p>
<ul>
<li>A å‡½æ•°å¯èƒ½è¦æ±‚ Python 3.9</li>
<li>B å‡½æ•°å¯èƒ½è¦æ±‚ Python 3.12</li>
<li>C å‡½æ•°ç”šè‡³å¯èƒ½æ˜¯ Node.js ç¼–å†™</li>
</ul>
<p>å¦‚æœä»æ²¿ç”¨ pip installÂ æˆ–å…¨å±€å®‰è£… npm çš„æ€è·¯ï¼Œè¿™ä¼šå¯¼è‡´ <strong>ä¾èµ–å†²çªã€ç¯å¢ƒæ±¡æŸ“ã€ç»´æŠ¤å™©æ¢¦</strong>ã€‚å› æ­¤ï¼ŒMCP å®˜æ–¹æ˜ç¡®å»ºè®®ï¼š</p>
<blockquote>
<p><strong>MCP å·¥å…·ä¸è¦å®‰è£…ï¼Œè€Œè¦ä¸´æ—¶è¿è¡Œã€‚</strong></p>
</blockquote>
<p><strong>uvx + npx ï¼šåŒå¼•æ“ä¸´æ—¶æ‰§è¡Œä½“ç³»</strong></p>
<p>MCPæ˜¯â€œå¤šè¯­è¨€ç”Ÿæ€ + å­è¿›ç¨‹åè®®â€çš„ç»„åˆã€‚ä½ è°ƒç”¨çš„å·¥å…·å¯èƒ½æ¥è‡ª Pythonï¼Œä¹Ÿå¯èƒ½æ¥è‡ª Node.jsã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªâ€œä¸´æ—¶æ‰§è¡Œå¼•æ“â€ï¼š</p>























<table><thead><tr><th>å·¥å…·</th><th>è¯­è¨€ç”Ÿæ€</th><th>åŠŸèƒ½</th><th>æ˜¯å¦ç¯å¢ƒéš”ç¦»</th></tr></thead><tbody><tr><td>npx</td><td>Node.js</td><td>ä¸´æ—¶è¿è¡Œ npm å‘å¸ƒçš„MCP Server</td><td>âœ…ï¸</td></tr><tr><td>uvx</td><td>Python</td><td>ä¸´æ—¶è¿è¡Œ PyPI å‘å¸ƒçš„MCP Server</td><td>âœ…ï¸</td></tr></tbody></table>
<blockquote>
<p><strong>å®ƒä»¬æ˜¯å¹¶åˆ—å…³ç³»ï¼Œåˆ†åˆ«è´Ÿè´£ Node ä¸ Python å·¥å…·ï¼Œå‡ ä¹è¦†ç›– MCP ç”Ÿæ€ä¸­çš„å¤§éƒ¨åˆ†æœåŠ¡ç«¯å·¥å…·ã€‚</strong></p>
</blockquote>
<p>uvä¸ux</p>
<ul>
<li><strong>uv</strong>ï¼šRust å¼€å‘çš„è¶…é«˜é€Ÿ Python åŒ…å·¥å…·ï¼Œæ¯” pip å¿« 10â€“100 å€</li>
<li><strong>uvx</strong>ï¼šuv çš„â€œæµåª’ä½“æ’­æ”¾å™¨â€ï¼Œä¸“é—¨ç”¨äºä¸´æ—¶æ‰§è¡Œ Python å·¥å…·</li>
</ul>
<p>å·¥ä½œåŸç†ï¼š</p>
<ul>
<li><strong>1. è‡ªåŠ¨åˆ›å»ºéš”ç¦»ç¯å¢ƒ</strong></li>
<li><strong>2. æŒ‰éœ€ä¸‹è½½å·¥å…·åŒ…</strong></li>
<li><strong>3. æ‰§è¡Œå·¥å…·</strong></li>
<li><strong>4. é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†ç¯å¢ƒï¼ˆæˆ–ç¼“å­˜ä»¥ä¾¿å¤ç”¨ï¼‰</strong></li>
</ul>
<p>ç‰¹æ€§ï¼š</p>
<ul>
<li><strong>å³ç”¨å³èµ°</strong>ï¼šå·¥å…·ç¯å¢ƒä¸´æ—¶ç”Ÿæˆï¼Œç”¨å®Œå³ç„šã€‚</li>
<li><strong>æ— æ±¡æŸ“</strong>ï¼šä¸ä¼šå½±å“ä½ å½“å‰çš„é¡¹ç›®ç¯å¢ƒã€‚</li>
<li><strong>è·¨è¯­è¨€</strong>ï¼šPython Agent å¯æ— ç¼è°ƒç”¨ Node.js å·¥å…·ï¼ˆé€šè¿‡ npxï¼‰ï¼Œpythonå·¥å…·åˆ™ç”± uvx å¯åŠ¨ã€‚</li>
<li><strong>æµåª’ä½“åŒ–</strong>ï¼šæŒ‰éœ€æ‹‰å–ï¼Œä¸´æ—¶ç¼“å­˜ï¼Œç¯å¢ƒå½¼æ­¤éš”ç¦»ã€‚</li>
</ul>
<p>Â å°è´´å£«ï¼šuv æ˜¯åº•å±‚å·¥å…·ï¼Œé€Ÿåº¦è¶…å¿«ï¼›uvx æ‰æ˜¯ä¸“é—¨ç”¨äºä¸´æ—¶æ‰§è¡Œ PyPI å·¥å…·çš„å¯æ‰§è¡Œå‘½ä»¤ã€‚</p>
<blockquote>
<p><strong>npx + uvx = MCPçš„ä¸´æ—¶æ‰§è¡ŒåŒæ ¸ã€‚</strong></p>
<p>å¯¹äºMCPå°ç™½è€Œè¨€ï¼Œä½ æ— éœ€ç®¡ç†å·¥å…·ä¾èµ–ï¼Œä¹Ÿæ— éœ€å…³å¿ƒç‰ˆæœ¬å†²çªï¼Œåªéœ€å¯åŠ¨Agentï¼Œå°±èƒ½åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·ä½¿ç”¨å„ç§æœåŠ¡ç«¯å·¥å…·ã€‚</p>
</blockquote>
<h3 data-id="heading-8">2. é€‰æ‹© Stdioï¼šæœ¬åœ°é€šä¿¡çš„é»„é‡‘æ ‡å‡†ï¼ˆTransport å±‚çš„æ ¸å¿ƒå®ç°ï¼‰</h3>
<p>åœ¨MCPä¸­ï¼Œå®¢æˆ·ç«¯ä¸å·¥å…·æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡é€šé“è¢«ç»Ÿç§°ä¸ºÂ <strong>Transport</strong>ï¼ˆä¼ è¾“å±‚ï¼‰â€”â€” å®ƒå®šä¹‰äº†</p>
<p><strong>â€œæ•°æ®é€šè¿‡ä»€ä¹ˆç®¡é“ä¼ è¾“â€ã€‚</strong></p>
<p>æ— è®ºå·¥å…·æ˜¯æ˜¯ç”¨pythonã€Node.js è¿˜æ˜¯å…¶ä»–è¯­è¨€ç¼–å†™ï¼ŒMCPéƒ½é€šè¿‡ Transport å®ç°è·¨è¯­è¨€äº¤äº’ã€‚</p>
<p>è™½ç„¶åè®®æ”¯æŒå¤šç§Transportï¼ˆå¦‚Stdioã€Streamable HTTPç­‰ï¼‰ï¼Œä½†<strong>åœ¨æœ¬åœ°åœºæ™¯ä¸‹ï¼ŒStdioæ˜¯å”¯ä¸€åˆç†ä¸”è¢«å¹¿æ³›é‡‡ç”¨çš„é€‰æ‹©ã€‚</strong></p>
<h3 data-id="heading-9">Stdioæ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><strong>Stdio = Standard Input / Standard Output ï¼ˆæ ‡å‡†è¾“å‡º/æ ‡å‡†è¾“å‡ºï¼‰</strong> ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ çˆ¶å­è¿›ç¨‹ä¹‹é—´çš„åŒ¿åç®¡ç†é€šä¿¡ã€‚</p>
<p>å½“ä½ è¿è¡Œä¸€ä¸ªMCP å·¥å…·ï¼ˆä¾‹å¦‚Node.js çš„é«˜å¾·åœ°å›¾æœåŠ¡æ—¶ï¼‰ï¼Œç³»ç»Ÿä¼šï¼š</p>
<p><strong>1. å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹ï¼ˆè¿è¡Œå·¥å…·ï¼‰</strong></p>
<p><strong>2. å»ºç«‹ä¸¤æ¡åŒ¿åç®¡é“ï¼š</strong></p>
<ul>
<li>çˆ¶è¿›ç¨‹ -&gt; å­è¿›ç¨‹ï¼šé€šè¿‡ stdin å‘é€è¯·æ±‚</li>
<li>å­è¿›ç¨‹ -&gt; çˆ¶è¿›ç¨‹ï¼šé€šè¿‡ stdout è¿”å›ç»“æœ</li>
</ul>
<p>å…³é”®ç‚¹ï¼š</p>
<ul>
<li><strong>ä¸èµ°TCP/IPï¼Œä¸å ç”¨ç«¯å£ï¼›</strong></li>
<li><strong>å¤–ç½‘æ— æ³•è®¿é—®ï¼Œå¤©ç„¶å®‰å…¨ï¼›</strong></li>
<li><strong>çˆ¶è¿›ç¨‹é€€å‡ºï¼Œå­è¿›ç¨‹è‡ªåŠ¨ç»“æŸï¼›</strong></li>
</ul>
<p><strong>åœ¨MCPåœºæ™¯ä¸‹ï¼ŒStdio å°±æ˜¯æœ€ç›´æ¥ã€æœ€å¿«æ·çš„æœ¬åœ°è¿›ç¨‹é€šä¿¡æ–¹å¼ï¼Œå®Œå…¨åœ¨å†…å­˜é‡Œå®Œæˆæ•°æ®ä¼ è¾“ã€‚</strong></p>
<hr/>
<h3 data-id="heading-10">MCPæœ¬åœ°ä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨ Stdioï¼Ÿ</h3>
<p>å®ƒæœ‰ä¸‰ä¸ªå¤©ç„¶ä¼˜åŠ¿ï¼š</p>
<p><strong>1. æ— éœ€ç½‘ç»œï¼Œä¸éœ€è¦ç›‘å¬ç«¯å£</strong></p>
<p><strong>2. é›¶é…ç½®ï¼Œæ— éœ€æƒé™ï¼Œéƒ¨ç½²æˆæœ¬è¿‘ä¹0</strong></p>
<p><strong>3. å»¶è¿Ÿæœ€å°ï¼Œå¼€é”€æœ€ä½ï¼Œåè®®å®ç°ä¹Ÿæœ€ç®€å•ã€‚</strong></p>
<p>å®ƒä¹Ÿæ˜¯MCP serverçš„é»˜è®¤é€šä¿¡æ–¹å¼ã€‚å¦‚æœåªå¸Œæœ›æœ¬åœ°ä½¿ç”¨ï¼Œä¸€ä¸ªstdio serverå°±å·²ç»â€œå®Œç¾å¤Ÿç”¨â€ã€‚</p>
<p>ä½†ä½ åº”è¯¥å¾ˆæ˜æ˜¾èƒ½å‘ç°ä¸€ä¸ªå°é—®é¢˜ï¼š<strong>æˆ‘ä»¬ä¸€ç›´åœ¨å¼ºè°ƒæœ¬åœ°</strong>ã€‚</p>
<p>å¦‚æœä¸æ˜¯æœ¬åœ°å‘¢ï¼Ÿè¿™å°±å¿…é¡»å¼•å…¥<strong>Streamable HTTP</strong>äº†ï¼Œè¿™ä¼šæ˜¯æˆ‘ä»¬ä¸‹ç« çš„é‡ç‚¹æ•™å­¦éƒ¨åˆ†ï¼Œæœ¬ç« æš‚ä¸åšè¿‡å¤šè®²è§£ã€‚</p>
<p>è¿™é‡Œæ”¾ä¸€ä¸‹MCP æ‰€æ”¯æŒçš„ä¸‰ç§ä¼ è¾“ï¼ˆTransportï¼‰æ–¹å¼æ¯”å¯¹ï¼š</p>





































<table><thead><tr><th>æ¨¡å¼</th><th>æœºåˆ¶</th><th>å»¶è¿Ÿ</th><th>å®‰å…¨æ€§</th><th>é€‚ç”¨åœºæ™¯</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>Stdio</strong>**ï¼ˆæœ¬ç« é‡ç‚¹ï¼‰**</td><td>çˆ¶å­è¿›ç¨‹ + åŒ¿åç®¡é“</td><td>~0.01ms</td><td>â­â­â­â­â­</td><td>æœ¬åœ°å¼€å‘ã€æ¡Œé¢åº”ç”¨</td><td>å†…å­˜æ‹·è´ç›´è¾¾ï¼Œçˆ¶å­è¿›ç¨‹å…±ç”Ÿï¼Œé›¶ç«¯å£å ç”¨</td></tr><tr><td>SSE</td><td>HTTP å•å‘æµ</td><td>~10â€“100ms</td><td>â­â­</td><td>ç®€å•è¿œç¨‹è°ƒç”¨ <strong>ï¼ˆå·²æ·˜æ±°ï¼‰</strong></td><td>å•å‘æµï¼Œå¿…é¡» HTTPSï¼Œæ•ˆç‡ä½ï¼Œç¨³å®šæ€§å·®</td></tr><tr><td><strong>Streamable HTTPï¼ˆä¸‹ç« é‡ç‚¹ï¼‰</strong></td><td>å…¨åŒå·¥ JSON-RPC over HTTP/2</td><td>~1â€“10ms</td><td>â­â­â­â­</td><td>äº‘éƒ¨ç½²ã€å›¢é˜Ÿå…±äº«</td><td>è·¨æœºå™¨é€šä¿¡ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒï¼Œä¸é€‚åˆä¸´æ—¶æœ¬åœ°è°ƒç”¨</td></tr></tbody></table>
<p>SSEåœ¨MCPä¸­ä½¿ç”¨å·²é€æ­¥æ·˜æ±°ï¼Œåªæœ‰ä¸€äº›æ—©æœŸMCPé¡¹ç›®å¯èƒ½è¿˜åœ¨ç”¨ï¼Œä¸ç”¨è¿‡å¤šäº†è§£å®ƒã€‚</p>
<h3 data-id="heading-11">3. JSON-RPCï¼šMCPçš„é€šç”¨è¯­</h3>
<p>Stdio æä¾›äº†æ•°æ®ç®¡é“ï¼Œæ•°æ®ç®¡é“é‡Œå½“ç„¶å¾—æœ‰<strong>æ•°æ®åè®®</strong>â€”â€”å°±æ˜¯JSON-RPC 2.0ã€‚</p>
<p>ä¸ºä»€ä¹ˆé€‰JSON-RPC?</p>
<ul>
<li>ç®€å•ï¼šçº¯æ–‡æœ¬ JSONï¼Œå¯è¯»æ€§å¥½ï¼Œè°ƒè¯•æ–¹ä¾¿ï¼›</li>
<li>æ ‡å‡†ï¼šæœ‰æ˜ç¡®è§„èŒƒï¼Œå„è¯­è¨€éƒ½æœ‰æˆç†Ÿåº“ï¼›</li>
<li>åŒå‘ï¼šæ”¯æŒ è¯·æ±‚/å“åº” ä¸ é€šçŸ¥ï¼›</li>
</ul>
<p>å¸¦IDï¼šæ¯ä¸ªè¯·æ±‚æœ‰å”¯ä¸€idï¼Œå®¢æˆ·ç«¯å¯åŒ¹é…å“åº”ï¼Œæ”¯æŒå¹¶å‘è°ƒç”¨ã€‚</p>
<p>ä¸€ä¸ªå…¸å‹ MCP å·¥å…·è°ƒç”¨æ¶ˆæ¯é•¿ä»€ä¹ˆæ ·ï¼Ÿ</p>
<pre><code class="hljs language-arduino" lang="arduino"># å®¢æˆ·ç«¯ -- <span class="hljs-built_in">Server</span> ï¼ˆé€šè¿‡Stdinï¼‰
{
  <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
  <span class="hljs-string">"id"</span>: <span class="hljs-string">"1"</span>,
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"call_tool"</span>,
  <span class="hljs-string">"params"</span>: {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"search_poi"</span>,
    <span class="hljs-string">"arguments"</span>: {<span class="hljs-string">"keyword"</span>: <span class="hljs-string">"åŒ—äº¬è¥¿ç«™"</span>}
  }
}
</code></pre>

<pre><code class="hljs language-arduino" lang="arduino"># <span class="hljs-built_in">Server</span> â†’ å®¢æˆ·ç«¯ï¼ˆé€šè¿‡ stdoutï¼‰
{
  <span class="hljs-string">"jsonrpc"</span>: <span class="hljs-string">"2.0"</span>,
  <span class="hljs-string">"id"</span>: <span class="hljs-string">"1"</span>,
  <span class="hljs-string">"result"</span>: {
    <span class="hljs-string">"content"</span>: [{<span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>, <span class="hljs-string">"text"</span>: <span class="hljs-string">"åç§°ï¼šåŒ—äº¬è¥¿ç«™..."</span>}]
  }
}
</code></pre>
<blockquote>
<p><strong>ğŸ’¡æ³¨ï¼šMCP åœ¨ JSON-RPC åŸºç¡€ä¸Šæ‰©å±•äº† <code>content</code> å­—æ®µï¼ˆæ”¯æŒæ–‡æœ¬ã€å›¾åƒã€åµŒå…¥ç­‰ï¼‰ï¼Œä½†åº•å±‚ä»æ˜¯æ ‡å‡† JSON-RPCã€‚</strong></p>
</blockquote>
<p>MCP SDKåšäº†ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>è‡ªåŠ¨åºåˆ—åŒ–/ååºåˆ—åŒ– JSON-RPC æ¶ˆæ¯ï¼›</li>
<li>ç®¡ç† id ç”Ÿæˆä¸åŒ¹é…ï¼›</li>
<li>å°†åº•å±‚å­—èŠ‚æµï¼ˆstdin/stdoutï¼‰æŠ½è±¡æˆ call_tool(name,args) é«˜çº§æ¥å£ã€‚</li>
</ul>
<p>æ‰€ä»¥ä½ ä¸éœ€è¦æ‰‹å†™ JSONï¼Œä½†å¿…é¡»çŸ¥é“ â€”â€” MCPçš„å¯¹è¯æœ¬è´¨æ˜¯ï¼š</p>
<p><strong>é€šè¿‡Stdinç®¡é“ä¼ è¾“JSON-RPCæ ¼å¼çš„æ¶ˆæ¯ã€‚</strong></p>
<hr/>
<h3 data-id="heading-12">4. ä½¿ç”¨Async/Awaitï¼šå¼‚æ­¥æ˜¯MCPçš„ç”Ÿå‘½çº¿</h3>
<p>MCPå·¥å…·è°ƒç”¨æ˜¯ <strong>I/Oå¯†é›†å‹</strong>ï¼ˆç­‰å¾…å­è¿›ç¨‹ã€ç½‘ç»œå“åº”ï¼‰ã€‚</p>
<p>ç”¨åŒæ­¥ï¼šä¸»çº¿ç¨‹ä¼šé˜»å¡ç­‰å¾…Aå·¥å…·è¿”å›ç»“æœåï¼Œå†å»è¯·æ±‚Bå·¥å…·ï¼Œå†å»Cå·¥å…·...æ€»è€—æ—¶=å„ä¸ªå·¥å…·è€—æ—¶çš„æ€»å’Œï¼Œç”¨æˆ·ä½“éªŒæ˜¯ç¾éš¾æ€§çš„ã€‚</p>
<p>ç”¨å¼‚æ­¥â€”â€”</p>
<ul>
<li>éé˜»å¡ï¼šå‘å‡ºè¯·æ±‚åç«‹å³é‡Šæ”¾æ§åˆ¶æƒï¼›</li>
<li>é«˜å¹¶å‘ï¼šå•çº¿ç¨‹å¯ç®¡ç†æ•°ç™¾ä¸ªå·¥å…·è°ƒç”¨ï¼›</li>
<li>ä½“éªŒæµç•…ï¼šLLMå¯è¾¹ç”ŸæˆTokenè¾¹ç­‰å¾…ç»“æœã€‚</li>
</ul>
<blockquote>
<p>ğŸ“Œ <strong>MCP SDK åŸºäº asyncio</strong>ï¼Œæ‰€æœ‰æ–¹æ³•å‡ä¸º async ã€‚<strong>ä¸ç”¨åç¨‹ï¼Œå¯¸æ­¥éš¾è¡Œ</strong>ã€‚</p>
</blockquote>
<h3 data-id="heading-13">5. å¦‚ä½•é˜²æ­¢èµ„æºæ³„éœ²ï¼šAsyncExitStackçš„å¨åŠ›</h3>
<p>æœ¬åœ°è¿è¡Œ MCP serverï¼ˆå¦‚npx/uvxï¼‰ï¼Œå…¶å®å°±æ˜¯ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯ = çˆ¶è¿›ç¨‹</li>
<li>MCP server ï¼ˆpyè„šæœ¬ã€npxç­‰ï¼‰= å­è¿›ç¨‹</li>
</ul>
<p>å¦‚æœå®¢æˆ·ç«¯å› ä¸ºå¼‚å¸¸é€€å‡ºï¼ˆæŠ›é”™ï¼Œè¢«å–æ¶ˆï¼Œctrl+cï¼‰ï¼Œ</p>
<p>å­è¿›ç¨‹ä¸ä¼šè‡ªåŠ¨é€€å‡ºï¼Œä¼šå˜æˆåƒµå°¸è¿›ç¨‹ï¼ŒæŒç»­å ç”¨èµ„æºã€‚</p>
<p>è§£å†³æ–¹æ³•â€”â€”AsyncExitStackï¼š</p>
<p><strong>AsyncExitStackæ˜¯ç®¡ç†å¼‚æ­¥èµ„æºçš„ä¿é™©ç®±ï¼š</strong></p>
<ul>
<li>å…è®¸ä½ æŠŠæ‰€æœ‰éœ€è¦æ¸…ç†çš„èµ„æºï¼ˆå­è¿›ç¨‹ã€ç®¡é“ã€ä¼šè¯ï¼‰æ³¨å†Œè¿›å»ï¼›</li>
<li>åœ¨é€€å‡ºæ—¶æŒ‰é€†åºè‡ªåŠ¨æ¸…ç†ï¼›</li>
<li>æ— è®ºæ­£å¸¸ç»“æŸè¿˜æ˜¯å´©æºƒé€€å‡ºï¼Œéƒ½ä¿è¯æ¸…ç†æ‰§è¡Œã€‚</li>
</ul>
<p>ç®€è€Œè¨€ä¹‹ï¼š</p>
<p><strong>å®ƒç¡®ä¿MCP serveræ°¸è¿œä¸ä¼šè¢«é—ç•™åœ¨åå°ï¼Œæ˜¯ç”Ÿäº§çº§MCP å®¢æˆ·ç«¯å¿…å¤‡çš„å®‰å…¨æœºåˆ¶ã€‚</strong></p>
<hr/>
<p>å¦‚ä¸Šï¼Œæˆ‘ä»¬å°†å·¥ç¨‹åœ°åŸºå…¨éƒ¨è¡¥å®Œåï¼ŒMCPçš„é€»è¾‘é“¾è¶‹äºå®Œæ•´ï¼š</p>



































<table><thead><tr><th>é—®é¢˜</th><th>è§£æ³•</th><th>æŠ€æœ¯ç»„ä»¶</th></tr></thead><tbody><tr><td><strong>å¦‚ä½•å¯åŠ¨ä»»æ„è¯­è¨€å·¥å…·ï¼Ÿ</strong></td><td><strong>ä¸´æ—¶æ‰§è¡Œ</strong></td><td><strong>npx / uvx</strong></td></tr><tr><td><strong>å¦‚ä½•å»ºç«‹æœ¬åœ°é€šä¿¡é€šé“ï¼Ÿ</strong></td><td><strong>è¿›ç¨‹ç®¡é“</strong></td><td><strong>Stdio</strong></td></tr><tr><td><strong>åŒæ–¹ç”¨ä»€ä¹ˆè¯­è¨€å¯¹è¯ï¼Ÿ</strong></td><td><strong>ç»“æ„åŒ–åè®®</strong></td><td><strong>JSON-RPC 2.0</strong></td></tr><tr><td><strong>å¦‚ä½•é«˜æ•ˆä¸å¡æ­»ï¼Ÿ</strong></td><td><strong>éé˜»å¡ I/O</strong></td><td><strong>Async/Await AsyncExitStack</strong></td></tr><tr><td><strong>å¦‚ä½•é¿å…åƒµå°¸è¿›ç¨‹ï¼Ÿ</strong></td><td><strong>èµ„æºç®¡å®¶</strong></td><td><strong>AsyncExitStack</strong></td></tr></tbody></table>
<p>ç°åœ¨ï¼Œäº”å—æ‹¼å›¾å·²ç»é›†é½ï¼š<strong>å¯åŠ¨ + é€šé“ + åè®® + å¼‚æ­¥ + å®‰å…¨</strong>ï¼Œ</p>
<p>å¯ä»¥å¼€å§‹çœŸæ­£å°è¯•è°ƒç”¨ä¸€ä¸ªMCPæœåŠ¡å™¨äº†ã€‚</p>
<h2 data-id="heading-14">ä¸‰ã€æ„å»ºæœ€å°å¯è¿è¡ŒMCPå®¢æˆ·ç«¯</h2>
<p><strong>ç›®æ ‡ï¼šç”¨æœ€å°‘çš„ä»£ç ï¼Œæ‰“é€špythonä¸MCPçš„è¿æ¥å¹¶è·å–æ•°æ®ï¼Œä¸è€ƒè™‘å¤ç”¨ï¼Œä¸è€ƒè™‘æ€§èƒ½ã€‚</strong></p>
<p>è¿™é‡Œæˆ‘ä»¬åˆ†ä¸ºä¸¤ä¸ªä»£ç æ–‡ä»¶ï¼š</p>
<p><strong>simple_client.py</strong> â€”â€” è´Ÿè´£åˆå§‹åŒ–clientï¼Œä¾›main_simple.pyæ–‡ä»¶å¼•ç”¨</p>
<p><strong>main_simple.py</strong> â€”â€” è´Ÿè´£çœŸæ­£è¿è¡ŒMCPï¼Œå¯¼å…¥simple_clientæ¥åˆå§‹åŒ–</p>
<p>ï¼ˆæ³¨ï¼šéœ€æå‰ä¸‹è½½å®‰è£…node.jså¹¶é…ç½®ç¯å¢ƒå˜é‡ï¼Œä¸ç„¶æ­¤å¤„æ— æ³•ä½¿ç”¨npxï¼‰</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># simple_client.py</span>
<span class="hljs-keyword">from</span> mcp <span class="hljs-keyword">import</span> ClientSession,StdioServerParameters
<span class="hljs-keyword">from</span> mcp.client.stdio <span class="hljs-keyword">import</span> stdio_client

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleClient</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,command:<span class="hljs-built_in">str</span>,args:<span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>],env:<span class="hljs-built_in">dict</span>=<span class="hljs-literal">None</span></span>):
        <span class="hljs-comment"># æŒ‡å®šè¦å¯åŠ¨çš„å·¥å…·å’Œå‚æ•°</span>
        self.params = StdioServerParameters(command=command,args=args,env=env)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_once</span>(<span class="hljs-params">self,tool_name:<span class="hljs-built_in">str</span>,tool_args:<span class="hljs-built_in">dict</span></span>):
        <span class="hljs-comment"># è¯­æ³•ç³–: async with è‡ªåŠ¨å¸®æˆ‘ä»¬ æ‰“å¼€è¿æ¥ -&gt; è¿è¡Œ -&gt; å…³é—­è¿æ¥</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> stdio_client(self.params) <span class="hljs-keyword">as</span> (read,write):
            <span class="hljs-comment"># å»ºç«‹çˆ¶å­è¿›ç¨‹ç®¡é“ï¼ˆstdin/stdoutï¼‰</span>
            <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> ClientSession(read,write) <span class="hljs-keyword">as</span> session:
            <span class="hljs-comment"># ç”¨JSON-RPCä¸å·¥å…·å¯¹è¯</span>
                <span class="hljs-keyword">await</span> session.initialize()

                <span class="hljs-comment"># ç›´æ¥è°ƒç”¨å·¥å…·</span>
                result = <span class="hljs-keyword">await</span> session.call_tool(tool_name,tool_args)
                <span class="hljs-keyword">return</span> result.content[<span class="hljs-number">0</span>].text
</code></pre>
<hr/>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># main_simple.py</span>
import asyncio
import os
from m10_mcp_basics.simple_client import SimpleClient
from config import AMAP_MAPS_API_KEY

<span class="hljs-comment"># å¤åˆ¶å½“å‰pyè¿›ç¨‹çš„ç¯å¢ƒå˜é‡,å¹¶åœ¨å¤åˆ¶çš„ç¯å¢ƒå˜é‡é‡Œæ–°å¢ä¸€æ¡ï¼Œç¡®ä¿å®‰å…¨å¯æ§</span>
<span class="hljs-attr">env_vars</span> = os.environ.copy()
env_vars<span class="hljs-section">["AMAP_MAPS_API_KEY"]</span> = AMAP_MAPS_API_KEY

async def main():
    print('ğŸ”¥ æ­£åœ¨è¿›è¡Œå•æ¬¡è°ƒç”¨...')
    <span class="hljs-attr">client</span> = SimpleClient(
        <span class="hljs-attr">command</span>=<span class="hljs-string">"npx"</span>,
        <span class="hljs-attr">args</span>=[<span class="hljs-string">"-y"</span>,<span class="hljs-string">"@amap/amap-maps-mcp-server"</span>,AMAP_MAPS_API_KEY],
        <span class="hljs-attr">env</span>=env_vars
    )

    <span class="hljs-comment"># è¿™ä¸€æ­¥ä¼šç»å†:å¯åŠ¨è¿›ç¨‹ - æ¡æ‰‹ - è°ƒç”¨ - æ€è¿›ç¨‹</span>
    <span class="hljs-attr">result</span> = await client.run_once(<span class="hljs-string">"maps_text_search"</span>, {<span class="hljs-string">"keywords"</span>: <span class="hljs-string">"åŒ—äº¬å¤§å­¦"</span>})
    print(f'âœ…ï¸ ç»“æœ:{result<span class="hljs-section">[:300]</span>}')


if <span class="hljs-attr">__name__</span> == <span class="hljs-string">"__main__"</span>:
    asyncio.run(main())
</code></pre>
<p>ä½ å¯èƒ½ä¼šé—®ï¼šcommandå’Œargsé‡Œçš„è¿™äº›å‚æ•°ï¼Œæˆ‘ä»¬æ€ä¹ˆçŸ¥é“é‡Œé¢æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>åˆ«æ€¥ï¼Œå¸¦ä½ å†å›åˆ°é«˜å¾·çš„MCPå®˜ç½‘æ‹ä¸€éï¼Œè¿™æ—¶ä½ å°±è·ŸP1æ—¶ä¸ä¸€æ ·ï¼ŒçŸ¥é“æ€ä¹ˆç†è§£äº†ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fmcp-server%2Fgettingstarted" title="https://lbs.amap.com/api/mcp-server/gettingstarted" target="_blank" ref="nofollow noopener noreferrer">é«˜å¾·åœ°å›¾MCP</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a1e11de0cfb493ba6983b605fbb5a93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=Q4KTpnfukIxlpTQiqAB9TFmA6e8%3D" alt="" loading="lazy"/></p>
<p>å­¦ä¹ åï¼Œæˆ‘ä»¬çŸ¥é“sseå‡ ä¹ä¸ç”¨ï¼Œstreamable HTTPæ¯”è¾ƒå¤æ‚ï¼Œä¸‹ç¯‡æ–‡ç« å†å­¦ï¼Œè€Œè¿™é‡Œçš„Node.js I/Oå…¶å®å°±æ˜¯stdioçš„ä¸€ç§èŒƒå¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦çœ‹node.js I/Oçš„å®ç°æ–¹æ³•ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bac1346952a46ae9488f6e2cf22f85c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=d%2BHai4z%2BvUDOl25pa%2FNOY%2Fv5bjg%3D" alt="" loading="lazy"/></p>
<p>å¾ˆæ˜æ˜¾ï¼Œå®ƒè¿™é‡Œå®šä¹‰äº†ä¸‰ä¸ªæˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨çš„å¯¹è±¡ï¼š</p>
<p>commandâ€”â€”å®‰è£…å‘½ä»¤ï¼›argsâ€”â€”å‚æ•°ï¼ˆæŒ‡ä»¤ä¸åŒ…åï¼‰ï¼›envâ€”â€”ç¯å¢ƒå˜é‡åã€‚</p>
<p>å›çœ‹ä¹‹å‰ä»£ç main_simple.pyï¼Œä½ ä¼šå‘ç°æˆ‘ä»¬é‡ç‚¹æ”¹çš„å°±æ˜¯è¿™äº›åœ°æ–¹ã€‚</p>
<p>æµ‹è¯•è¿è¡Œï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8091068025904240b36a91b02c55d1ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=Z%2FaQ9q1JiLaUWw2ZsQwY01%2Bn1RE%3D" alt="" loading="lazy"/></p>
<p>æ²¡æœ‰é—®é¢˜ï¼ŒæˆåŠŸè¾“å‡ºã€‚</p>
<p>è‡³æ­¤æˆ‘ä»¬ç»ˆäºèƒ½æˆåŠŸè°ƒç”¨MCPæœåŠ¡äº†ï¼Œä½†æœ‰æ²¡æœ‰æ„Ÿè§‰è¿™ä¸ªMCPæœåŠ¡æœ‰ç‚¹å¤ªç®€äº†ï¼Ÿ</p>
<p>ç›®å‰çš„MCPæœåŠ¡åªèƒ½å¸®æˆ‘ä»¬ç¡®å®šèƒ½è¿æ¥ï¼Œä½†å®Œå…¨æ— æ³•çœŸæ­£ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªçœŸæ­£<strong>åŠŸèƒ½æ›´é«˜çº§ï¼Œå°è£…æ›´å¥½ï¼ŒçœŸæ­£å¯å¤ç”¨</strong>çš„MCPåˆå§‹åŒ–å®¢æˆ·ç«¯ã€‚</p>
<h2 data-id="heading-15"><strong>å››ã€å‡çº§ç‰ˆMCPå®¢æˆ·ç«¯ï¼šæ„å»ºç”Ÿäº§çº§ MCP æ¥å…¥èƒ½åŠ›</strong></h2>
<h3 data-id="heading-16">1.Â ä»æœ€å°å®ç°åˆ°ç”Ÿäº§çº§ï¼šä¸ºä»€ä¹ˆéœ€è¦é‡æ„ï¼Ÿ</h3>
<p>å›é¡¾æˆ‘ä»¬æœ€åˆçš„ <strong>MCP æœ€å°å®ç°ï¼ˆsimple_main.pyï¼‰</strong> ï¼Œå®ƒå­˜åœ¨ä»¥ä¸‹å…³é”®ç¼ºé™·ï¼š</p>
<ul>
<li>âŒï¸ å·¥å…·åå’Œå‚æ•°ç¡¬ç¼–ç ï¼Œæ— æ³•åŠ¨æ€é€‚é…ï¼›</li>
<li>âŒï¸ æœªé›†æˆ LLMï¼Œæ— æ³•å®ç°è‡ªä¸»å†³ç­–ï¼›</li>
<li>âŒï¸ æ— å·¥å…·å‘ç°æœºåˆ¶ï¼Œæ‰©å±•æ€§ä¸ºé›¶ï¼›</li>
<li>âŒï¸ äº¤äº’æ–¹å¼åŸå§‹ï¼Œæ— æµå¼åé¦ˆï¼›</li>
<li>âŒï¸ MCP è¿”å›çš„æ•°æ®æœªè¢« LangChain ç†è§£ï¼Œæ— æ³•ç”¨äº Agentã€‚</li>
</ul>
<p>è¿™å¯¼è‡´å®ƒ<strong>ä»…èƒ½ç”¨äºæµ‹è¯•ï¼Œæ— æ³•æŠ•å…¥å®é™…ä½¿ç”¨</strong>ã€‚</p>
<h3 data-id="heading-17"><strong>2. æˆ‘ä»¬æœŸæœ›çš„ MCP è¿è¡Œæµç¨‹</strong></h3>
<p>ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„ MCP é›†æˆåº”æ»¡è¶³å¦‚ä¸‹çº¿æ€§æµç¨‹ï¼š</p>
<blockquote>
<p><strong>ç”¨æˆ·æé—® â†’ LLM åˆ†æ â†’ è‡ªåŠ¨å‘ç°å¯ç”¨å·¥å…· â†’ è°ƒç”¨ MCP å·¥å…· â†’ è·å–ç»“æœ â†’ æ•´åˆå›ç­” â†’ è¿”å›ç”¨æˆ·</strong></p>
</blockquote>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è§£å†³ä»¥ä¸‹æ ¸å¿ƒé—®é¢˜ï¼š</p>





























<table><thead><tr><th>éœ€æ±‚</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>LLM èƒ½è·å–æŸä¸ª MCP çš„æ‰€æœ‰å·¥å…·</strong></td><td>å®ç° <strong>list_tools()</strong> å¹¶è¿”å›ç»“æ„åŒ–å…ƒæ•°æ®</td></tr><tr><td><strong>æ”¯æŒå¤šä¸ª MCP æœåŠ¡æ‰¹é‡æ¥å…¥</strong></td><td>è®¾è®¡<strong>å¯å¤ç”¨ã€å¯ç»„åˆ</strong>çš„å®¢æˆ·ç«¯æ¶æ„</td></tr><tr><td><strong>è¿æ¥å¿…é¡»å¥å£®å¯é </strong></td><td>ä½¿ç”¨ <strong>AsyncExitStack</strong>Â ç®¡ç†å­è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ</td></tr><tr><td><strong>MCP æ•°æ®éœ€è¢« LangGraph ç†è§£</strong></td><td>æ„å»º<strong>åè®®è½¬æ¢å±‚</strong>ï¼ˆBridgeï¼‰ï¼Œç”Ÿæˆ StructuredTool</td></tr><tr><td><strong>è°ƒç”¨å¿…é¡»ç¬¦åˆ MCP åè®®è§„èŒƒ</strong></td><td>ä¸¥æ ¼éµå¾ª <strong>JSON-RPC + inputSchema</strong> æ ¼å¼</td></tr></tbody></table>
<p>ä¸ºè¾¾æˆä¸Šè¿°ç›®æ ‡ï¼Œæˆ‘ä»¬å°†ç³»ç»Ÿæ‹†åˆ†ä¸º<strong>ä¸‰ä¸ªé«˜åº¦è§£è€¦çš„æ¨¡å—</strong>ï¼š</p>
<ul>
<li><strong>mcp_client.py</strong>ï¼šåº•å±‚é€šä¿¡å®¢æˆ·ç«¯ï¼ˆåªç®¡è¿æ¥ä¸è°ƒç”¨ï¼‰</li>
<li><strong>mcp_bridge.py</strong>ï¼šåè®®é€‚é…ä¸­é—´ä»¶ï¼ˆMCP â†” LangChainï¼‰</li>
<li><strong>mcp_main.py</strong>ï¼šä¸šåŠ¡è¿è¡Œå…¥å£ï¼ˆAgent é€»è¾‘ + ç”¨æˆ·äº¤äº’ï¼‰</li>
</ul>
<p>æœ¬ç« é‡ç‚¹è®²è§£å‰ä¸¤ä¸ªæ¨¡å—ã€‚</p>
<h3 data-id="heading-18">3. mcp_client.pyï¼šæ‰“é€ å¯å¤ç”¨çš„å¼‚æ­¥ MCP å®¢æˆ·ç«¯</h3>
<h3 data-id="heading-19">ç›®æ ‡</h3>
<p>å®ç°ä¸€ä¸ª<strong>é€šç”¨ã€å¥å£®ã€å¯åµŒå…¥ä»»æ„ Python åº”ç”¨</strong>ï¼ˆå¦‚ FastAPIã€Djangoã€LangGraphï¼‰çš„ MCP å®¢æˆ·ç«¯ï¼Œä»…å…³æ³¨ <strong>stdio é€šä¿¡ä¸åè®®äº¤äº’</strong>ã€‚</p>
<h3 data-id="heading-20">æ ¸å¿ƒç‰¹æ€§</h3>
<ul>
<li>å¼‚æ­¥é•¿è¿æ¥ï¼ˆä¸€æ¬¡è¿æ¥ï¼Œå¤šæ¬¡è°ƒç”¨ï¼‰</li>
<li>è‡ªåŠ¨èµ„æºæ¸…ç†ï¼ˆé˜²åƒµå°¸è¿›ç¨‹ï¼‰</li>
<li>LLM å‹å¥½è¾“å‡ºï¼ˆçº¯å­—å…¸æ ¼å¼ï¼‰</li>
<li>é˜²å¾¡æ€§ç¼–ç¨‹ï¼ˆå¤„ç†ç©ºè¿”å›ã€å¼‚å¸¸ç­‰ï¼‰</li>
</ul>
<h4 data-id="heading-21">3.1 <strong>init</strong>ï¼šåˆå§‹åŒ–é…ç½®</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MCPClient</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,command:<span class="hljs-built_in">str</span>,args:<span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>],env:<span class="hljs-built_in">dict</span>=<span class="hljs-literal">None</span></span>):
        <span class="hljs-comment"># MCPå¯åŠ¨æ–¹å¼(npx/uvx/python -m xxx)</span>
        self.params = StdioServerParameters(command=command,args=args,env=env)
        <span class="hljs-comment"># å·¥ç¨‹æ ¸å¿ƒ:èµ„æºæ ˆ</span>
        self.exit_stack = AsyncExitStack()
        <span class="hljs-comment"># è¿æ¥ä¼šè¯(é•¿è¿æ¥)</span>
        self.session:<span class="hljs-type">Optional</span>[ClientSession]=<span class="hljs-literal">None</span>
</code></pre>
<ul>
<li>self.params ï¼šå°è£…å¦‚ä½•å¯åŠ¨ MCP æœåŠ¡ï¼ˆå¦‚ npx @amap/...ï¼‰ã€‚</li>
<li>self.exit_stackï¼šå¼‚æ­¥èµ„æºæ ˆï¼Œç»Ÿä¸€ç®¡ç†å­è¿›ç¨‹ã€ç®¡é“ï¼ˆtransportï¼‰ã€ä¼šè¯ï¼ˆsessionï¼‰çš„ç”Ÿå‘½å‘¨æœŸã€‚</li>
<li>self.sessionï¼šJSON-RPC ä¼šè¯å¯¹è±¡ï¼Œå»¶è¿Ÿåˆå§‹åŒ–ã€‚</li>
</ul>
<blockquote>
<p><strong>âœ…ï¸ è®¾è®¡ç†å¿µï¼šåˆ›å»ºå³é…ç½®ï¼Œè¿æ¥æ‰å¯åŠ¨ã€‚</strong></p>
</blockquote>
<h4 data-id="heading-22">3.2 connect() â€”â€” å»ºç«‹é•¿è¿æ¥</h4>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å»ºç«‹MCPé•¿è¿æ¥ï¼ˆä¸€æ¬¡è¿æ¥ï¼Œå¤šæ¬¡è°ƒç”¨ï¼‰"""</span>
        <span class="hljs-keyword">if</span> self.session:
            <span class="hljs-keyword">return</span> <span class="hljs-comment"># å·²è¿æ¥æ— éœ€é‡å¤</span>

        <span class="hljs-comment"># è¿›å…¥transportï¼ˆè¯»/å†™ç®¡é“ï¼‰</span>
        transport = <span class="hljs-keyword">await</span> self.exit_stack.enter_async_context(
            stdio_client(self.params)
        )
        <span class="hljs-comment"># åˆ›å»ºJSON-RPCå¯¹è¯</span>
        self.session = <span class="hljs-keyword">await</span> self.exit_stack.enter_async_context(
            ClientSession(transport[<span class="hljs-number">0</span>],transport[<span class="hljs-number">1</span>])
        )
        <span class="hljs-comment"># ç­‰å¾…MCPæœåŠ¡å™¨è¿”å›å·¥å…·æ¸…å•</span>
        <span class="hljs-keyword">await</span> self.session.initialize()
</code></pre>
<ul>
<li>
<p>é˜²é‡å…¥ï¼šå¦‚æœå·²è¿æ¥ï¼Œç›´æ¥è¿”å›ï¼›</p>
</li>
<li>
<p>å¯åŠ¨å­è¿›ç¨‹ + è·å–ç®¡é“ï¼š</p>
<ul>
<li>stdio_client(self.params) å¯åŠ¨å­è¿›ç¨‹ï¼ˆå¦‚npx/uvxï¼‰ï¼›</li>
<li>è¿”å›ï¼ˆread_stream,write_streamï¼‰ï¼Œå³stdoutå’Œstdinçš„å¼‚æ­¥æµï¼Œç”¨äºè¯»å–æœåŠ¡è¾“å‡º/å‘æœåŠ¡å‘é€è¾“å…¥ï¼›</li>
<li>enter_async_context å°†å…¶åŠ å…¥ exit_stackï¼Œç¡®ä¿é€€å‡ºæ—¶è‡ªåŠ¨å…³é—­ã€‚</li>
</ul>
</li>
<li>
<p>åˆ›å»ºJSON-RPCå¯¹è¯ï¼š</p>
<ul>
<li>ClientSession(read,write) å°è£…è¯»å†™æµä¸º JSON-RPCå®¢æˆ·ç«¯ï¼›</li>
<li>åŒæ ·åŠ å…¥ exit_stack ç®¡ç†ã€‚</li>
</ul>
</li>
<li>
<p>æ¡æ‰‹åˆå§‹åŒ–ï¼š</p>
<ul>
<li>await self.session.initialize() å‘é€ initialize è¯·æ±‚ï¼Œå®Œæˆåè®®æ¡æ‰‹ï¼Œå¹¶è·å–æœåŠ¡èƒ½åŠ›ï¼ˆå¦‚å·¥å…·åˆ—è¡¨ç¼“å­˜ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™é‡Œçš„è¿æ¥å¯ä»¥å¯¹æ¯”æˆ‘ä»¬ä¹‹å‰æœ€å°MVPçš„clientï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43f4bd378e4b4be2a1770dada05eadbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=3HNQkm3FriZmhICnsjWwV7e%2F34o%3D" alt="" loading="lazy"/>
ä¹‹å‰æˆ‘ä»¬ç”¨äº†å¤šä¸ª <strong>async with xÂ as y</strong> åµŒå¥—ï¼Œ</p>
<p>å¦‚ä»Šæˆ‘ä»¬åªéœ€æ¢æˆ <strong>y = await self.exit_stack.enter_async_context(x)</strong> å°±èƒ½è¾¾åˆ°ç±»ä¼¼ç”šè‡³æ›´å¥½çš„åŠŸæ•ˆï¼Œè¿™å°±æ˜¯AsyncExitStack çš„å¼ºå¤§ä¹‹å¤„ã€‚</p>
<blockquote>
<p><strong>âœ…ï¸ é•¿è¿æ¥æ¨¡å¼ï¼šè¿æ¥ä¸€æ¬¡ï¼Œåç»­å¯å¤šæ¬¡è°ƒç”¨å†…éƒ¨å‡½æ•°ã€‚</strong></p>
</blockquote>
<h4 data-id="heading-23">3.3 list_tools() â€”â€” æŸ¥è¯¢å¯ç”¨å·¥å…·</h4>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">list_tools</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æŸ¥è¯¢å·¥å…·åˆ—è¡¨ï¼Œä¸ºLLMå»ºç«‹ä¸Šä¸‹æ–‡ç”¨"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.session:
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"æœªè¿æ¥ï¼Œè¯·å…ˆ connect()"</span>)

        result = <span class="hljs-keyword">await</span> self.session.list_tools()

        <span class="hljs-comment"># è½¬ä¸ºçº¯å­—å…¸,LLMèƒ½è¯»</span>
        <span class="hljs-keyword">return</span>[
            {
                <span class="hljs-string">"name"</span>:tool.name,
                <span class="hljs-string">"description"</span>:tool.description,
                <span class="hljs-string">"input_schema"</span>:tool.inputSchema
            }
            <span class="hljs-keyword">for</span> tool <span class="hljs-keyword">in</span> result.tools
        ]
</code></pre>
<ul>
<li>
<p>å…ˆæ£€æŸ¥æ˜¯å¦å·²è¿æ¥ï¼›</p>
</li>
<li>
<p>è°ƒç”¨session.list_tools è·å– ListToolsResult å¯¹è±¡ï¼›</p>
</li>
<li>
<p>å…³é”®è½¬æ¢ï¼šå°†æ¯ä¸ª Tool å¯¹è±¡ï¼ˆPydantic æ¨¡å‹ï¼‰è½¬ä¸ºçº¯pyå­—å…¸ã€‚</p>
<ul>
<li>å› ä¸º LLM æˆ–ä¸Šå±‚æ¶æ„ï¼ˆå¦‚ LangChainï¼‰é€šå¸¸éœ€è¦å¯æ¥å—çš„Â JSON æ•°æ®ç±»å‹ï¼›</li>
<li>tool.inputSchema æ˜¯åŸå§‹JSON Schema (dict)ï¼Œå¯ç›´æ¥ä¼ é€’ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>âœ…ï¸ è¾“å‡ºæ ¼å¼å®Œå…¨å…¼å®¹ LLM ä¸Šä¸‹æ–‡æ³¨å…¥éœ€æ±‚ã€‚</strong></p>
</blockquote>
<h4 data-id="heading-24">3.4 call_tool() â€”â€” è°ƒç”¨å…·ä½“å·¥å…·</h4>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">call_tool</span>(<span class="hljs-params">self,name:<span class="hljs-built_in">str</span>,args:<span class="hljs-built_in">dict</span></span>):
        <span class="hljs-string">"""è°ƒç”¨å·¥å…·ï¼ˆå·¥ç¨‹åŒ–ï¼šåŠ ä¸Šé˜²å¾¡æ€§å¤„ç†ï¼‰"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.session:
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"æœªè¿æ¥ï¼Œè¯·å…ˆconnect()"</span>)

        result = <span class="hljs-keyword">await</span> self.session.call_tool(name,args)

        <span class="hljs-comment"># æœ‰äº›å·¥å…·å¯èƒ½æ‰§è¡ŒæˆåŠŸä½†æ— æ–‡æœ¬è¿”å›</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(result,<span class="hljs-string">"content"</span>) <span class="hljs-keyword">and</span> result.content:
            <span class="hljs-keyword">return</span> result.content[<span class="hljs-number">0</span>].text

        <span class="hljs-keyword">return</span> <span class="hljs-string">"å·¥å…·æ‰§è¡ŒæˆåŠŸï¼Œä½†æ— æ–‡æœ¬è¿”å›"</span>
</code></pre>
<ul>
<li>
<p>è°ƒç”¨ self.session.call_tool(name,args)ï¼Œå‘é€ç¬¦åˆMCPåè®®çš„ call_tool è¯·æ±‚ã€‚</p>
</li>
<li>
<p>é˜²å¾¡æ€§å¤„ç†ï¼š</p>
<ul>
<li>å¹¶éæ‰€æœ‰å·¥å…·éƒ½è¿”å›contentï¼Œæœ‰äº›åªè¿”å› structured data</li>
<li>å¦‚æœæœ‰ content ä¸”éç©ºï¼Œå–ç¬¬ä¸€ä¸ªæ–‡æœ¬å—ï¼ˆresult.content[0].textï¼‰</li>
<li>å¦åˆ™è¿”å›æç¤º</li>
</ul>
</li>
</ul>
<h4 data-id="heading-25">3.5 cleanup() â€”â€” æ¸…ç†èµ„æº</h4>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">cleanup</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å…³é—­MCPæœåŠ¡ã€ä¼šè¯å’Œtransport"""</span>
        <span class="hljs-keyword">if</span> self.session:
            <span class="hljs-keyword">await</span> self.exit_stack.aclose()
            self.session = <span class="hljs-literal">None</span>
</code></pre>
<ul>
<li>
<p>è‡ªåŠ¨æŒ‰å…ˆè¿›å…ˆå‡ºé¡ºåºå…³é—­æ‰€æœ‰æ³¨å†Œçš„èµ„æºï¼›</p>
<ul>
<li>ClientSessionï¼šå‘é€ shutdownï¼Œå…³é—­ RPC;</li>
<li>stdio_clientï¼šå…³é—­ stdin/stdout ç®¡é“ï¼Œç»ˆæ­¢å­è¿›ç¨‹</li>
</ul>
</li>
<li>
<p>é‡ç½® self.session = None ï¼Œé¿å…é‡å¤å¤„ç†</p>
</li>
</ul>
<blockquote>
<p><strong>âœ…ï¸ è¿™æ˜¯ä¼˜é›…å…³é—­çš„å…³é”®ï¼Œé˜²æ­¢å­è¿›ç¨‹å˜æˆâ€œåƒµå°¸è¿›ç¨‹â€ã€‚</strong></p>
</blockquote>
<p>è‡³æ­¤ï¼ŒMCPClient æˆä¸ºä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„<strong>é€šä¿¡åŸºåº§</strong>ã€‚</p>
<h3 data-id="heading-26">4. mcp_bridge.pyï¼šæ„å»º MCP ä¸ LangChain çš„ç²˜åˆå±‚</h3>
<p>ç›®æ ‡ï¼šå°†ä»»æ„ MCP æœåŠ¡<strong>æ— ç¼è½¬æ¢ä¸º LangChain å¯ç”¨çš„ StructuredToolÂ åˆ—è¡¨</strong>ï¼Œä½¿ LLM èƒ½åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·è°ƒç”¨è¿œç¨‹ MCP å·¥å…·ã€‚</p>
<p>æ ¸å¿ƒæŒ‘æˆ˜</p>
<ul>
<li>MCP ä½¿ç”¨ JSON Schema æè¿°å‚æ•°ï¼›</li>
<li>LangChain ä½¿ç”¨ Pydantic æ¨¡å‹æ ¡éªŒå‚æ•°ï¼›</li>
<li>äºŒè€…éœ€é€šè¿‡Â <strong>åŠ¨æ€æ¨¡å‹ç”Ÿæˆ</strong>Â å®ç°æ¡¥æ¥ã€‚</li>
</ul>
<h4 data-id="heading-27">4.1 ç±»å®šä¹‰ä¸ä¸Šä¸‹æ–‡ç®¡ç†</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LangChainMCPAdapter</span>:
    <span class="hljs-string">"""
    MCPé€‚é…å™¨ï¼šå°†MCPå®¢æˆ·ç«¯æ— ç¼è½¬æ¢ä¸ºLangChainå¯ç”¨çš„å·¥å…·é›†ã€‚
    å®ç°äº†ä¸Šä¸‹æ–‡ç®¡ç†å™¨åè®®ï¼Œ
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,mcp_client:MCPClient</span>):
        self.client = mcp_client

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">__aenter__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è¿›å…¥ä¸Šä¸‹æ–‡ï¼Œè‡ªåŠ¨å»ºç«‹è¿æ¥"""</span>
        <span class="hljs-keyword">await</span> self.client.connect()
        <span class="hljs-keyword">return</span> self

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">__aexit__</span>(<span class="hljs-params">self,exc_type,exc_value,exc_tb</span>):
        <span class="hljs-string">"""é€€å‡ºä¸Šä¸‹æ–‡ï¼Œè‡ªåŠ¨æ¸…ç†èµ„æº"""</span>
        <span class="hljs-keyword">await</span> self.client.cleanup()
</code></pre>
<ul>
<li>
<p>å°è£… MCPClientï¼Œæä¾› async with æ”¯æŒï¼ˆå…¶å®è´¨å°±æ˜¯ç”¨__aenter__/__aexit__ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼‰</p>
<ul>
<li><strong>aenter</strong> ï¼šè¿›å…¥ async with å—è‡ªåŠ¨è°ƒç”¨ client.session()ï¼Œå»ºç«‹MCPé•¿è¿æ¥ã€‚</li>
<li><strong>aeixt</strong>ï¼šé€€å‡ºæ—¶è‡ªåŠ¨è°ƒç”¨ client.cleanup()ï¼Œå…³é—­å­è¿›ç¨‹å’Œç®¡é“ã€‚</li>
</ul>
</li>
<li>
<p>return selfï¼šæŒ‡çš„æ˜¯å½“å‰ LangChainMCPAdapter å®ä¾‹ï¼š</p>
<ul>
<li>async with adapter as a ä¼šè°ƒç”¨ adapter.<strong>aenter()</strong>ï¼Œå…¶è¿”å›å€¼èµ‹ç»™aã€‚</li>
<li>æ‰€ä»¥__aenter__é‡Œå¿…é¡»è¦ return selfï¼Œå¦åˆ™aä¸æ˜¯é€‚é…å™¨å®ä¾‹ï¼Œåç»­æ–¹æ³•è°ƒç”¨ä¼šå‡ºé”™ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-28">4.2Â æ ¸å¿ƒæ–¹æ³•ï¼š_schema_to_pydanticï¼ˆJSON Schema -&gt; Pydantic æ¨¡å‹ï¼‰</h4>
<p>è¿™é‡Œæ˜¯æˆ‘ä»¬æ„å»º mcp_bridge çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒä½œä¸ºè½¬æ¢å™¨æå…¶é‡è¦ã€‚</p>
<h4 data-id="heading-29">ä¸ºä»€ä¹ˆéœ€è¦Schemaï¼šMCPå·¥å…·çš„è¯´æ˜ä¹¦</h4>
<p>MCPå·¥å…·æœ¬èº«æœ‰å„ç§è¾“å…¥å‚æ•°ï¼Œä½† LLM å¹¶ä¸çŸ¥é“æ¯ä¸ªå·¥å…·éœ€è¦çš„<strong>æ¯ä¸ªå‚æ•°ç±»å‹</strong>å’Œ<strong>å¿…å¡«ä¿¡æ¯</strong>ã€‚å¦‚æœè®© LLM éšæ„ç”Ÿæˆï¼Œç»“æœå¯èƒ½å‡ºé”™æˆ–æ ¹æœ¬ç”¨ä¸äº†ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¤ºä¾‹ MCP Schema</span>
{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,
  <span class="hljs-string">"properties"</span>: {
    <span class="hljs-string">"city"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>, <span class="hljs-string">"description"</span>: <span class="hljs-string">"åŸå¸‚åç§°"</span> },
    <span class="hljs-string">"keyword"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>, <span class="hljs-string">"description"</span>: <span class="hljs-string">"æœç´¢å…³é”®å­—"</span> },
    <span class="hljs-string">"radius"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"number"</span>, <span class="hljs-string">"description"</span>: <span class="hljs-string">"æœç´¢åŠå¾„ï¼ˆç±³ï¼‰"</span> }
  },
  <span class="hljs-string">"required"</span>: [<span class="hljs-string">"city"</span>, <span class="hljs-string">"keyword"</span>]
}
</code></pre>
<p>å¦‚ä¸Šï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ï¼š</p>
<ul>
<li>city å’Œ keyword å¿…é¡»ä¼ å…¥ï¼›</li>
<li>ç±»å‹åˆ†åˆ«æ˜¯ string / string / numberï¼›</li>
<li>æ¯ä¸ªå­—æ®µçš„æ„ä¹‰ï¼ˆdescriptionï¼‰</li>
</ul>
<p><strong>æœ‰äº†Schemaï¼Œllmæ‰èƒ½çœŸæ­£ç¨³å®šä¸”æ­£ç¡®åœ°è°ƒç”¨MCPå·¥å…·ï¼Œè€Œä¸æ˜¯å‡­è¿æ°”çä¼ å‚æ•°ã€‚</strong></p>
<hr/>
<h4 data-id="heading-30"><strong>ä½¿ç”¨Pydanticï¼šæ‰§è¡Œè§„èŒƒçš„pythonæ¨¡å‹</strong></h4>
<p>æ­¤å¤„æˆ‘ä»¬æŠŠPydanticä½œä¸ºæ¡¥æ¢ï¼š</p>
<p><strong>Schema æ˜¯æè¿°è§„èŒƒï¼ŒPydantic æ˜¯æ‰§è¡Œè§„èŒƒçš„ Python æ¨¡å‹ã€‚</strong></p>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>ç±»å‹æ ¡éªŒï¼šç¡®ä¿LLMç”Ÿæˆçš„å‚æ•°ç±»å‹å‡†ç¡®ï¼›</li>
<li>å¿…å¡«æ£€æµ‹ï¼šé˜²æ­¢é—æ¼å¿…å¡«å­—æ®µ</li>
<li>è‡ªåŠ¨ç”Ÿæˆå­—æ®µè¯´æ˜ï¼šä¾›LLMå‚è€ƒ</li>
<li>æ— ç¼æ³¨å…¥ LangChainï¼šStructuredTool å¯ä»¥ç›´æ¥ä½¿ç”¨ Pydantic æ¨¡å‹</li>
</ul>
<p>æ‰€ä»¥<strong>pydanticçš„å®è´¨ï¼Œå°±æ˜¯æŠŠMCPçš„ JSON Schema è½åœ°åˆ° Pythonç±»å‹ä¸–ç•Œï¼Œè®©LLMå¯ä»¥ç›´æ¥æŒ‰ç…§è§„åˆ™ç”Ÿæˆå‚æ•°</strong>ã€‚</p>
<p>å®é™…ä»£ç æ„å»ºå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_schema_to_pydantic</span>(<span class="hljs-params">name:<span class="hljs-built_in">str</span>,schema:<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>,<span class="hljs-type">Any</span>]</span>):
        <span class="hljs-string">"""
        å°†MCPçš„JSON SchemaåŠ¨æ€è½¬æ¢ä¸ºPydanticæ¨¡å‹
        è¿™æ˜¯è®©LLMç†è§£å‚æ•°è¦æ±‚çš„å…³é”®
        """</span>
        <span class="hljs-comment"># æ‰€æœ‰å‚æ•°å®šä¹‰</span>
        properties = schema.get(<span class="hljs-string">"properties"</span>,{}) <span class="hljs-comment"># å…è®¸ä¸ºç©º</span>
        <span class="hljs-comment"># å¿…éœ€å­—æ®µ</span>
        required = schema.get(<span class="hljs-string">"required"</span>,[]) <span class="hljs-comment"># å…è®¸ä¸ºç©º</span>
        <span class="hljs-comment"># åˆå§‹ç©ºå­—å…¸</span>
        fields = {}
        <span class="hljs-comment"># ç±»å‹æ˜ å°„è¡¨ï¼šå°†JSONç±»å‹æ˜ å°„ä¸ºPythonç±»å‹</span>
        type_map = {
            <span class="hljs-string">"string"</span>:<span class="hljs-built_in">str</span>,
            <span class="hljs-string">"integer"</span>:<span class="hljs-built_in">int</span>,
            <span class="hljs-string">"number"</span>:<span class="hljs-built_in">float</span>,
            <span class="hljs-string">"boolean"</span>:<span class="hljs-built_in">bool</span>,
            <span class="hljs-string">"array"</span>:<span class="hljs-built_in">list</span>,
            <span class="hljs-string">"object"</span>:<span class="hljs-built_in">dict</span>
        }

        <span class="hljs-keyword">for</span> field_name,field_info <span class="hljs-keyword">in</span> properties.items():
            <span class="hljs-comment"># 1.è·å–å­—æ®µç±»å‹</span>
            json_type = field_info.get(<span class="hljs-string">"type"</span>,<span class="hljs-string">"string"</span>)
            python_type = type_map.get(json_type,<span class="hljs-type">Any</span>)
            <span class="hljs-comment"># 2.è·å–æè¿°</span>
            description = field_info.get(<span class="hljs-string">"description"</span>,<span class="hljs-string">""</span>)
            <span class="hljs-comment"># 3.æ˜¯å¦ä¸ºå¿…éœ€é¡¹</span>
            <span class="hljs-comment"># å¦‚æœæ˜¯å¿…å¡«ï¼Œé»˜è®¤å€¼ä¸º ... (Ellipsis): å¦åˆ™ä¸ºNone</span>
            <span class="hljs-keyword">if</span> field_name <span class="hljs-keyword">in</span> required:
                default_value = ...
            <span class="hljs-keyword">else</span>:
                default_value = <span class="hljs-literal">None</span>

            <span class="hljs-comment"># 4.æ„å»ºPydanticå­—æ®µå®šä¹‰</span>
            fields[field_name] = (python_type,Field(default=default_value,description=description))

        <span class="hljs-comment"># åŠ¨æ€åˆ›å»ºä¸€ä¸ªPydanticæ¨¡å‹ç±»</span>
        <span class="hljs-keyword">return</span> create_model(<span class="hljs-string">f"<span class="hljs-subst">{name}</span>Schema"</span>,**fields)
</code></pre>
<p>å½’çº³ä¸Šè¿°æ­¥éª¤ï¼š</p>
<ul>
<li>
<p>ï¼ˆ1ï¼‰æå–schemaç»“æ„ï¼šproperties å’Œ requiredï¼Œå…¼å®¹ç©º schema</p>
</li>
<li>
<p>ï¼ˆ2ï¼‰ç±»å‹æ˜ å°„ï¼šå°†JSON Schema ç±»å‹è½¬æ¢ä¸º Python ç±»å‹</p>
</li>
<li>
<p>ï¼ˆ3ï¼‰æ„å»ºå­—æ®µå­—å…¸ï¼šfield_name:(python_type,Field(...))</p>
<ul>
<li>å¿…å¡«å­—æ®µç”¨ ... è¡¨ç¤º</li>
<li>å¯é€‰å­—æ®µç”¨ None</li>
</ul>
</li>
<li>
<p>ï¼ˆ4ï¼‰åŠ¨æ€åˆ›å»º Pydantic æ¨¡å‹å¹¶è¿”å›ï¼šreturn create_model(f"{name}Schema",**fields)</p>
</li>
</ul>
<blockquote>
<p><strong>âœ…ï¸ è¿™æ˜¯mcp_bridgeçš„æ ¸å¿ƒæŠ€æœ¯ï¼šè®© LLM çŸ¥é“è°ƒç”¨è¿™ä¸ªå·¥å…·éœ€è¦å“ªäº›å‚æ•°ã€‚</strong></p>
</blockquote>
<h4 data-id="heading-31"><strong>4.3Â æ ¸å¿ƒæ–¹æ³•ï¼šget_tools() â€”â€” ç”ŸæˆLangChain å·¥å…·åˆ—è¡¨</strong></h4>
<p>è¯¥æ–¹æ³•æ ¸å¿ƒä½œç”¨æ˜¯ï¼šè·å–MCPåŸç¥å·¥å…·åˆ—è¡¨ï¼Œå¹¶è½¬æ¢ä¸º LangChain å¯ç›´æ¥ä½¿ç”¨çš„å·¥å…·ï¼ˆStructuredToolï¼‰ï¼Œå¯ç›´æ¥å–‚ç»™ bind_toolsã€‚</p>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_tools</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""
        æ ¸å¿ƒæ–¹æ³•ï¼šè·å–å¹¶è½¬æ¢å·¥å…·
        è¿”å›çš„æ˜¯æ ‡å‡†çš„LangChain Toolåˆ—è¡¨ï¼Œå¯ä»¥ç›´æ¥å–‚ç»™bind_tools
        """</span>
        <span class="hljs-comment"># ä»MCP Server è·å–åŸå§‹å·¥å…·åˆ—è¡¨</span>
        mcp_tools = <span class="hljs-keyword">await</span> self.client.list_tools()
        langchain_tools = []

        <span class="hljs-keyword">for</span> tool_info <span class="hljs-keyword">in</span> mcp_tools:
            <span class="hljs-comment"># 1.åŠ¨æ€ç”Ÿæˆå‚æ•°æ¨¡å‹ -- è¦å¤„ç†schemaä¸ºç©ºçš„æƒ…å†µ</span>
            <span class="hljs-comment"># inputSchemaä¸€èˆ¬ä¼šæ”¾å¥½MCPå„ç§å·¥å…·/å‚æ•°çš„ä»‹ç»</span>
            raw_schema = tool_info.get(<span class="hljs-string">"input_schema"</span>,{})
            args_model = self._schema_to_pydantic(tool_info[<span class="hljs-string">"name"</span>],raw_schema)
            <span class="hljs-comment"># 2.å®šä¹‰æ‰§è¡Œå‡½æ•°</span>
            <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_dynamic_tool_func</span>(<span class="hljs-params">tool_name=tool_info[<span class="hljs-string">"name"</span>],**kwargs</span>):
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.client.call_tool(tool_name,kwargs)

            <span class="hljs-comment"># 3.åŒ…è£…æˆllmå¯è°ƒç”¨çš„å·¥å…·(æ³¨å…¥args_schema)</span>
            tool = StructuredTool.from_function(
                coroutine=_dynamic_tool_func,
                name=tool_info[<span class="hljs-string">"name"</span>],
                description=tool_info[<span class="hljs-string">"description"</span>],
                args_schema=args_model <span class="hljs-comment"># æŠŠè¯´æ˜ä¹¦ä¼ ç»™ LangChain</span>
            )
            langchain_tools.append(tool)
        <span class="hljs-keyword">return</span> langchain_tools
</code></pre>
<p>å½’çº³ä¸Šè¿°æ­¥éª¤ï¼š</p>
<ul>
<li>
<p>ï¼ˆ1ï¼‰è·å–åŸå§‹MCPå·¥å…·åˆ—è¡¨</p>
<ul>
<li>è°ƒç”¨self.client.list_tools() è·å–åŸå§‹å·¥å…·ä¿¡æ¯ï¼ŒåŒ…æ‹¬åç§°ã€æè¿°ã€è¾“å…¥å‚æ•°schemaã€‚</li>
</ul>
</li>
<li>
<p>ï¼ˆ2ï¼‰éå†å¹¶è½¬æ¢ schema ä¸º Pydantic æ¨¡å‹</p>
<ul>
<li>æ¯ä¸ªå·¥å…·çš„ input_schema è½¬ä¸º Pydantic æ¨¡å‹ï¼Œç¡®ä¿LLMè°ƒç”¨æ—¶å‚æ•°ç±»å‹æ­£ç¡®ï¼Œå¿…å¡«å­—æ®µå®Œæ•´ã€‚</li>
</ul>
</li>
<li>
<p>ï¼ˆ3ï¼‰åŠ¨æ€åˆ›å»ºå·¥å…·æ‰§è¡Œå‡½æ•°</p>
<ul>
<li>ä½¿ç”¨é—­åŒ… tool_name=tool_info["name"]é¿å…å¾ªç¯å˜é‡ç»‘å®šé—®é¢˜ï¼Œå‡½æ•°å†…éƒ¨å®é™…è°ƒç”¨self.call_tool å®ŒæˆMCPè°ƒç”¨ã€‚</li>
</ul>
</li>
<li>
<p>ï¼ˆ4ï¼‰åŒ…è£…ä¸ºLangChain StructuredTool</p>
<ul>
<li>æ³¨å…¥ args_schema åï¼Œè®©LangChainçŸ¥é“ï¼š</li>
<li>å“ªäº›å‚æ•°å¯ç”¨ï¼›</li>
<li>å“ªäº›å¿…å¡«ï¼›</li>
<li>æ¯ä¸ªå‚æ•°ç±»å‹å’Œæè¿°ã€‚</li>
</ul>
</li>
<li>
<p>ï¼ˆ5ï¼‰æ”¶é›†å·¥å…·å¹¶è¿”å›</p>
</li>
</ul>
<p>æ‰€æœ‰å·¥å…·æ”¶é›†åœ¨ langchain_tools å¹¶è¿”å›ï¼Œç›´æ¥ç”¨äº bind_tools æ³¨å…¥LLMã€‚</p>
<hr/>
<h3 data-id="heading-32"><strong>5.Â å°ç»“ï¼šåˆ†å±‚æ¶æ„çš„ä»·å€¼</strong></h3>

























<table><thead><tr><th>æ¨¡å—</th><th>èŒè´£</th><th>ä¼˜åŠ¿</th></tr></thead><tbody><tr><td><strong>mcp_client.py``</strong></td><td>åº•å±‚é€šä¿¡</td><td>å¯ç‹¬ç«‹æµ‹è¯•ã€å¯è¢« FastAPI/Django å¤ç”¨</td></tr><tr><td><strong>mcp_briedge.py``</strong></td><td>åè®®è½¬æ¢</td><td>è§£è€¦ MCP ä¸ LangChainï¼Œæ”¯æŒä»»æ„ MCP æœåŠ¡</td></tr><tr><td><strong>mcp_main.pyï¼ˆä¸‹æ–‡ï¼‰</strong></td><td>ä¸šåŠ¡é€»è¾‘</td><td>ä¸“æ³¨ Agent ç¼–æ’ï¼Œæ— éœ€å…³å¿ƒ MCP ç»†èŠ‚</td></tr></tbody></table>
<blockquote>
<p>ğŸ”§ <strong>è¿™ç§â€œé€šä¿¡å±‚ + é€‚é…å±‚ + ä¸šåŠ¡å±‚â€çš„ä¸‰æ®µå¼æ¶æ„ï¼Œæ˜¯æ„å»ºå¯ç»´æŠ¤ã€å¯æ‰©å±• AI ç³»ç»Ÿçš„æœ€ä½³å®è·µã€‚</strong></p>
</blockquote>
<p>é€šè¿‡è¿™ä¸¤ä»½æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸ä»…è§£å†³äº†æœ€å°å®ç°çš„æ‰€æœ‰ç—›ç‚¹ï¼Œè¿˜ä¸ºæœªæ¥æ¥å…¥<strong>å¤©æ°”ã€æ•°æ®åº“ã€ä¼ä¸šå†…éƒ¨ç³»ç»Ÿç­‰ä»»æ„ MCP æœåŠ¡</strong>æ‰“ä¸‹äº†åšå®åŸºç¡€ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œåªéœ€åœ¨ <strong>mcp_main.py</strong>Â ä¸­ç»„åˆè¿™äº›èƒ½åŠ›ï¼Œå³å¯æ„å»ºä¸€ä¸ª<strong>çœŸæ­£æ™ºèƒ½ã€å¯äº¤äº’ã€ç”Ÿäº§å¯ç”¨çš„ MCP Agent</strong>ã€‚</p>
<h2 data-id="heading-33"><strong>äº”ã€æµå¼è¾“å‡ºï¼šæ‹’ç»â€œå“‘å·´â€Agentï¼Œå¼€å¯å…¨é“¾è·¯è§‚æµ‹</strong></h2>
<p>åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†åšå®çš„ MCP å®¢æˆ·ç«¯åº•åº§ã€‚ä½†åœ¨æ­£å¼ç»„è£… Agent å‰ï¼Œæˆ‘ä»¬å¿…é¡»è§£å†³ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜ï¼š<strong>æ²‰é»˜</strong>ã€‚</p>
<p>æ™®é€šçš„ LLM èŠå¤©æˆ–è®¸åªéœ€ç­‰å¾…1ç§’å°±èƒ½çœ‹è§ç¬¬ä¸€ä¸ªå­—ï¼Œä½†åœ¨MCP Agentçš„ä¸–ç•Œé‡Œï¼Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼šå¯åŠ¨å­è¿›ç¨‹ -&gt; æ¡æ‰‹ -&gt; LLMæ€è€ƒ -&gt; å‘é€å·¥å…·è°ƒç”¨ -&gt; é«˜å¾·APIå“åº” -&gt; LLMæ€»ç»“</p>
<p>è¿™ä¸€å¥—ä¸‹æ¥ï¼Œå¯èƒ½éœ€è¦3-10ç§’ï¼Œå¦‚æœä½ ç”¨ä¼ ç»Ÿçš„æ¨¡å¼ï¼Œå®Œå…¨è¾“å‡ºï¼Œç”¨æˆ·å°†é¢å¯¹ä¸€ä¸ªé•¿è¾¾10ç§’çš„ç©ºç™½å…‰æ ‡ï¼Œä½“éªŒæå·®ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¿…é¡»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”¨<strong>æµå¼</strong>æ¥å¤„ç†ã€‚</p>
<h3 data-id="heading-34">1. æœ€å°å¯å®ç°æµå¼</h3>
<p>å…¶å®æ—©åœ¨05ç¯‡æˆ‘ä»¬å°±å·²æ¥è§¦è¿‡æµå¼ï¼Œåªä¸è¿‡é‚£ä¼šçš„æµå¼è¿˜åªæ˜¯æœ€å°å®ç°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">from langchain_openai import ChatOpenAI
from langchain_core.callbacks.streaming_stdout import StreamingStdOutCallbackHandler

<span class="hljs-attr">llm</span> = ChatOpenAI(
    <span class="hljs-attr">model</span>=<span class="hljs-string">"deepseek-chat"</span>,
    <span class="hljs-attr">streaming</span>=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># å¼€å¯æµå¼</span>
    <span class="hljs-attr">callbacks</span>=[StreamingStdOutCallbackHandler()] <span class="hljs-comment"># æ³¨å†Œå›è°ƒï¼Œè‡ªåŠ¨æ‰“å°</span>
)
</code></pre>
<p>å®ƒçš„å®ç°æå…¶ç®€å•ï¼Œstreaming=Trueä¸ä¸€ä¸ªå›è°ƒå‡½æ•°å³å¯ï¼šLLMæ¯åå‡ºä¸€ä¸ªå­—å°±è§¦å‘å›è°ƒå¹¶æ‰“å°ã€‚</p>
<p>ä½†åœ¨Agentåœºæ™¯ä¸‹ï¼Œå®ƒæ˜¯<strong>çå­</strong>ã€‚</p>
<p>å½“ Agent å†³å®šè°ƒç”¨å·¥å…·æ—¶ï¼ŒLLMä¼šåœæ­¢ç”Ÿæˆæ–‡æœ¬ï¼Œè½¬è€Œç”ŸæˆJSONæŒ‡ä»¤ã€‚æ­¤æ—¶è¿™ä¸ªå›è°ƒå‡½æ•°å°±ä¼šæ²‰é»˜ï¼Œåªæœ‰å·¥å…·æŸ¥å®ŒLLMå†æ¬¡è¯´è¯å±å¹•æ‰ä¼šåŠ¨ã€‚</p>
<p>å¯¹äºMCPè¿™ç§é‡I/Oçš„åœºæ™¯ï¼Œè¿™ç§<strong>é—´æ­‡å¤±èª</strong>ç»å¯¹ä¸å¯å®¹è®¸ã€‚</p>
<h3 data-id="heading-35">2. å…¨é“¾è·¯äº‹ä»¶æµå¼</h3>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å‡çº§åˆ° <strong>LangGraph çš„äº‹ä»¶é©±åŠ¨æµå¼</strong>ï¼ˆastream_eventsï¼‰ã€‚</p>
<p>è¿™ä¸ä»…ä»…æ˜¯æ‰“å°å­—ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>åˆ†å±‚çš„äº‹ä»¶æ€»æ ˆ</strong>ã€‚å®ƒæŠŠ Agent è¿è¡Œè¿‡ç¨‹ä¸­çš„<strong>æ¯ä¸ªåŠ¨ä½œéƒ½çœ‹åšæ˜¯ä¸€ä¸ªäº‹ä»¶</strong>ï¼Œè®©æˆ‘ä»¬æ‹¥æœ‰äº†ä¸Šå¸è§†è§’ã€‚</p>
<h3 data-id="heading-36">çº¿æ€§è¿è¡Œæ€è·¯ï¼šAgentåˆ°åº•åœ¨å¹²ä»€ä¹ˆï¼Ÿ</h3>
<p>é€šè¿‡å®Œæ•´æµå¼ï¼Œæˆ‘ä»¬å¯ä»¥æ•è· Agent æ€è€ƒçš„å®Œæ•´æ—¶é—´è½´ï¼š</p>
<p><strong>1. Thinkingï¼ˆæ€è€ƒé˜¶æ®µï¼‰</strong></p>
<p>äº‹ä»¶ï¼š<strong>on_chat_model_stream</strong></p>
<p>è¡¨ç°ï¼šLLMæ­£åœ¨æ‰“å­—ï¼Œç”Ÿæˆé’ˆå¯¹ç”¨æˆ·çš„å›å¤ï¼Œæˆ–è€…åœ¨ç”ŸæˆJSONã€‚</p>
<hr/>
<ol start="2">
<li>Actingï¼ˆè¡ŒåŠ¨é˜¶æ®µ - MCPåœ¨æ­¤ï¼‰</li>
</ol>
<p>äº‹ä»¶ï¼š<strong>on_tool_start ğŸ”¨</strong></p>
<p>è¡¨ç°ï¼šAgentå†³å®šè°ƒç”¨å·¥å…·ã€‚</p>
<hr/>
<p><strong>3. Observingï¼ˆè§‚å¯Ÿé˜¶æ®µï¼‰</strong></p>
<p>äº‹ä»¶ï¼š<strong>on_tool_end âœ…ï¸</strong></p>
<p>è¡¨ç°ï¼šå·¥å…·æ‰§è¡Œå®Œæ¯•ï¼Œæ•°æ®è¿”å›ã€‚</p>
<hr/>
<p><strong>4. Respondingï¼ˆå“åº”é˜¶æ®µï¼‰</strong></p>
<p>äº‹ä»¶ï¼š<strong>on_chat_model_stream</strong></p>
<p>è¡¨ç°ï¼šLLMæ ¹æ®æŸ¥åˆ°çš„æ•°æ®ï¼Œæ•´ç†æˆæœ€ç»ˆç­”æ¡ˆåç»™ç”¨æˆ·ã€‚</p>
<hr/>
<p>é’ˆå¯¹è¿™å››ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥è‡ªä¸»é€‰æ‹©æƒ³è¦åœ¨æ§åˆ¶å°è¾“å‡ºçš„æ•°æ®ï¼Œè®©ç”¨æˆ·å¯ä»¥åˆ‡å®çš„æ„Ÿå—åˆ°ç°åœ¨Agentæ­£åœ¨å¹²ä»€ä¹ˆï¼Œè€Œä¸æ˜¯åªèƒ½åŸåœ°çŒœæµ‹ã€‚</p>
<h3 data-id="heading-37">3. ä»£ç å®æˆ˜ï¼šæ„å»ºé€šç”¨æµå¼è§‚æµ‹å™¨</h3>
<p>ä¸ºäº†è®©P6çš„ä¸»ç¨‹åºä¿æŒæ•´æ´ï¼Œæˆ‘ä»¬æŠŠè¿™å¥—å¤æ‚çš„ç›‘å¬é€»è¾‘å°è£…æˆä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å— <strong>agent_stream.py</strong>ã€‚</p>
<p>è¿™ä¸ªæ–‡ä»¶<strong>å¯ä»¥è¢«ä»»ä½• LangGraph é¡¹ç›®ç›´æ¥å¥—ç”¨</strong>ï¼Œå®Œå…¨ä¸ä¾èµ– MCPã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># agent_stream.py</span>
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_agent_with_streaming</span>(<span class="hljs-params">app,query:<span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""
    é€šç”¨æµå¼è¿è¡Œå™¨ï¼Œè´Ÿè´£å°† LangGraph çš„è¿è¡Œè¿‡ç¨‹å¯è§†åŒ–è¾“å‡ºåˆ°æ§åˆ¶å°

    :param app: ç¼–è¯‘å¥½çš„ LangGraph åº”ç”¨ (workflow.compile())
    :param query: ç”¨æˆ·è¾“å…¥çš„é—®é¢˜
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f'\nç”¨æˆ·:<span class="hljs-subst">{query}</span>\n'</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ¤– AI:"</span>,end=<span class="hljs-string">""</span>,flush=<span class="hljs-literal">True</span>)

    <span class="hljs-comment"># æ„é€ è¾“å…¥æ¶ˆæ¯</span>
    inputs = {<span class="hljs-string">"messages"</span>:[HumanMessage(content=query)]}

    <span class="hljs-comment"># æ ¸å¿ƒ:ç›‘å¬v2ç‰ˆæœ¬çš„äº‹ä»¶æµ(ç›¸æ¯”v1æ›´å…¨é¢)</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> app.astream_events(inputs,version=<span class="hljs-string">"v2"</span>):
        kind = event[<span class="hljs-string">"event"</span>]

        <span class="hljs-comment"># 1.ç›‘å¬LLMçš„æµå¼åå­—(å˜´åœ¨åŠ¨)</span>
        <span class="hljs-keyword">if</span> kind == <span class="hljs-string">"on_chat_model_stream"</span>:
            chunk = event[<span class="hljs-string">"data"</span>][<span class="hljs-string">"chunk"</span>]
            <span class="hljs-comment"># è¿‡æ»¤æ‰ç©ºçš„chunk(æœ‰æ—¶å·¥å…·è°ƒç”¨ä¼šäº§ç”Ÿç©ºå†…å®¹)</span>
            <span class="hljs-keyword">if</span> chunk.content:
                <span class="hljs-built_in">print</span>(chunk.content,end=<span class="hljs-string">""</span>,flush=<span class="hljs-literal">True</span>)

        <span class="hljs-comment"># 2.ç›‘å¬å·¥å…·å¼€å§‹è°ƒç”¨(æ‰‹åœ¨åŠ¨)</span>
        <span class="hljs-keyword">elif</span> kind == <span class="hljs-string">"on_tool_start"</span>:
            tool_name = event[<span class="hljs-string">"name"</span>]
            <span class="hljs-comment"># ä¸æ‰“å°å†…éƒ¨åŒ…è£…ï¼Œåªæ‰“å°è‡ªå®šä¹‰çš„å·¥å…·</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> tool_name.startswith(<span class="hljs-string">"_"</span>):
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n\nğŸ”¨ æ­£åœ¨è°ƒç”¨å·¥å…·: <span class="hljs-subst">{tool_name}</span> ..."</span>)

        <span class="hljs-comment"># 3.ç›‘å¬å·¥å…·è°ƒç”¨ç»“æŸ(æ‹¿åˆ°ç»“æœ)</span>
        <span class="hljs-keyword">elif</span> kind == <span class="hljs-string">"on_tool_end"</span>:
            tool_name = event[<span class="hljs-string">"name"</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> tool_name.startswith(<span class="hljs-string">"_"</span>):
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… è°ƒç”¨å®Œæˆï¼Œç»§ç»­æ€è€ƒ...\n"</span>)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ¤– AI: "</span>, end=<span class="hljs-string">""</span>, flush=<span class="hljs-literal">True</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n\nğŸ˜Š è¾“å‡ºç»“æŸ!"</span>)
</code></pre>
<p>å…³é”®è§£æï¼š</p>
<ol>
<li>
<p><strong>version="v2"</strong> ï¼šLangGraphçš„æµå¼APIæ›´è¿­éå¸¸å¿«ã€‚v2ç›®å‰æ˜¯æ›´æ¨èçš„äº‹ä»¶æµï¼Œè¿”å›äº‹ä»¶ç±»å‹ä¸ç‰¹æ€§æ›´ä¸ºå…¨é¢å¯æ§ã€‚</p>
</li>
<li>
<p><strong>flush=True</strong>ï¼špyçš„printé»˜è®¤æœ‰ç¼“å­˜ã€‚å¦‚æœä¸åŠ è¿™ä¸ªï¼Œå­—å¯èƒ½ä¼šä¸€å¨ä¸€å¨è€Œä¸æ˜¯ä¸€ä¸ªä¸€ä¸ªè¹¦å‡ºæ¥ã€‚</p>
</li>
<li>
<p><strong>äº‹ä»¶è¿‡æ»¤</strong>ï¼š</p>
</li>
</ol>
<ul>
<li>if/elif ... ï¼šapp.astream_events()ä¼šäº§ç”Ÿå„ç§äº‹ä»¶ï¼Œä½†æˆ‘ä»¬åªå…³å¿ƒæœ€é‡è¦çš„å‡ ä¸ªæ¯”å¦‚è°ƒç”¨å·¥å…·ä¸llmè¯´è¯ã€‚</li>
<li>if not tool_name.startwith("_")ï¼šLangGraphåœ¨å†…éƒ¨å¯èƒ½ä¼šè°ƒç”¨ä¸€äº›åŒ…è£…å™¨å·¥å…·ï¼Œå¦‚å†…éƒ¨å®ç°ç”¨_wrapã€_internalç­‰ï¼Œè¿™äº›å†…éƒ¨å·¥å…·æˆ‘ä»¬è‚¯å®šä¸å¸Œæœ›çœ‹åˆ°ã€‚</li>
</ul>
<p>æœ‰äº†è¿™ä¸ªå®Œæ•´æµå¼åï¼Œæ­¤æ—¶æˆ‘ä»¬çš„AgentçœŸæ­£æœ‰äº†<strong>è¿‡ç¨‹å¯è§æ€§</strong>ï¼Œè¿™æ˜¯AgentåŒºåˆ«äºä¼ ç»ŸChatæœ€å¤§çš„é­…åŠ›ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ MCP å®¢æˆ·ç«¯å¿…éœ€çš„èƒ½åŠ›ã€‚</p>
<p>ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†æ­£å¼æŠŠæ‰€æœ‰ç»„ä»¶å°è£…ä¸º<strong>å®Œæ•´é€šç”¨MCP Agent</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-38">å…­ã€ç»ˆæå°è£…ï¼šæ„å»ºé€šç”¨MCP Agent</h2>
<p>å†ç»å‰é¢äº”ä¸ªç« èŠ‚çš„é“ºå«ï¼Œæˆ‘ä»¬ç»ˆäºæ¥åˆ°äº†æœ€åçš„ç»„è£…æ—¶åˆ»ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»æ‰“é€ äº†ä¸‰ä¸ªæ ¸å¿ƒâ€œé›¶éƒ¨ä»¶â€ï¼š</p>
<ol>
<li><strong>åº•åº§ï¼ˆMCP æ¥å£å±‚ / å·¥å…·é€‚é…å±‚ï¼‰</strong><br/>
P4ï¼š<strong>mcp_client.py</strong>Â ã€<strong>mcp_bridge.py</strong>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  å®ƒä»¬è´Ÿè´£ä¸ MCP æœåŠ¡å»ºç«‹å¼‚æ­¥è¿æ¥ï¼Œå¹¶å°† MCP å·¥å…·é€‚é…ä¸º LangChain å¯è°ƒç”¨çš„å½¢å¼ã€‚æ¯”å–»æ¥è¯´ï¼Œå®ƒæ˜¯ Agent çš„â€œ<strong>æ‰¿è½½å¹³å°</strong>â€ï¼Œä¿è¯æ‰€æœ‰å¤–éƒ¨å·¥å…·èƒ½å¤Ÿå¹³æ»‘æ¥å…¥ã€‚</li>
<li><strong>å¤©çœ¼ï¼ˆå…¨é“¾è·¯æµå¼è§‚æµ‹å™¨ / äº‹ä»¶æµç›‘å¬å™¨ï¼‰</strong><br/>
P5ï¼š <strong>agent_stream.py</strong><code> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </code>å®ƒç›‘å¬ LangGraph çš„äº‹ä»¶æµï¼Œå®ç°å…¨é“¾è·¯å¯è§†åŒ–è¾“å‡ºï¼Œè®©ç”¨æˆ·å¯ä»¥çœ‹åˆ° LLM çš„æ€è€ƒå’Œå·¥å…·è°ƒç”¨è¿‡ç¨‹ã€‚å½¢è±¡åœ°è¯´ï¼Œå®ƒå°±åƒ Agent çš„â€œ<strong>çœ¼ç›</strong>â€ï¼Œè®©æœ¬æ¥é»‘ç›’çš„å†³ç­–è¿‡ç¨‹é€æ˜å¯è§ã€‚</li>
<li><strong>å¤§è„‘ï¼ˆå³å°†ç»„è£…çš„æ ¸å¿ƒé€»è¾‘ï¼‰</strong><br/>
è¿™å°±æ˜¯æˆ‘ä»¬å³å°†ç¼–å†™çš„ <strong>mcp_main.py</strong>ã€‚å®ƒè´Ÿè´£æŠŠåº•åº§ä¸å¤©çœ¼ç»“åˆèµ·æ¥ï¼Œæ„å»ºä¸€ä¸ª<strong>ç”Ÿäº§çº§ã€å¯çƒ­æ’æ‹”ã€å…·å¤‡æµå¼åé¦ˆçš„é€šç”¨ Agent</strong>ã€‚ç»è¿‡ä¹‹å‰çš„è§£è€¦ä¸å°è£…ï¼Œæ­¤æ—¶çš„æ ¸å¿ƒé€»è¾‘å°†ä¼šéå¸¸æ¸…çˆ½ã€‚</li>
</ol>
<h3 data-id="heading-39">1. æ¶æ„æ€»è§ˆï¼šé«˜å†…èšï¼Œä½è€¦åˆ</h3>
<p>åœ¨å¼€å§‹å†™ä»£ç å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€çœ¼æœ€ç»ˆçš„å·¥ç¨‹ç»“æ„ã€‚è¿™ä¸ä»…æ˜¯ä¸€ä¸ª Demoï¼Œè€Œæ˜¯ä¸€ä¸ªæ ‡å‡†çš„ Python å·¥ç¨‹èŒƒå¼ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">m10_mcp_basics/
â”œâ”€â”€ mcp_client.py       <span class="hljs-comment"># (åº•å±‚) è´Ÿè´£ socket é€šä¿¡ä¸åè®®è§£æ</span>
â”œâ”€â”€ mcp_bridge.py       <span class="hljs-comment"># (é€‚é…å±‚) è´Ÿè´£å°† Schema è½¬ä¸º Pydantic æ¨¡å‹</span>
â”œâ”€â”€ agent_stream.py     <span class="hljs-comment"># (äº¤äº’å±‚) è´Ÿè´£æ§åˆ¶å°æµå¼è¾“å‡º</span>
â”œâ”€â”€ config.py           <span class="hljs-comment"># (é…ç½®å±‚) API Key ç®¡ç†</span>
â””â”€â”€ mcp_main.py         <span class="hljs-comment"># (ä¸šåŠ¡å±‚) æœ¬ç« ä¸»è§’ï¼Œè´Ÿè´£ç»„è£…ä¸è¿è¡Œ</span>
</code></pre>
<ul>
<li>å¦‚æœä½ æƒ³æ¢å…¶ä»–çš„ MCP å·¥å…·ï¼ˆå¦‚ SQLiteï¼‰ï¼Œåªæ”¹ <strong>é…ç½®å±‚</strong>ã€‚</li>
<li>å¦‚æœä½ æƒ³æŠŠæ§åˆ¶å°è¾“å‡ºæ¢æˆ Web ç•Œé¢ï¼Œåªæ”¹ <strong>äº¤äº’å±‚</strong>ã€‚</li>
<li>å¦‚æœä½ æƒ³æ›´æ”¹Â LangGraph çš„å›¾é€»è¾‘ï¼Œåªæ”¹ <strong>ä¸šåŠ¡å±‚</strong>ã€‚</li>
</ul>
<p>å„å¸å…¶èŒï¼Œäº’ä¸å¹²æ‰°ã€‚</p>
<h3 data-id="heading-40">2. ä»£ç å®ç°ï¼šç§¯æœ¨å¼æ‹¼è£…</h3>
<p>æ–°å»ºmcp_main.pyï¼Œæˆ‘ä»¬å°†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤æ¥å®Œæˆå®‰è£…ã€‚</p>
<h4 data-id="heading-41">2.1 ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–é…ç½®</h4>
<p>Agent çš„è¡Œä¸ºç”±æ ¸å¿ƒé€»è¾‘æ§åˆ¶ï¼Œä½†å®ƒå¯ä»¥<strong>é€šè¿‡é…ç½®åˆ—è¡¨çµæ´»åŠ è½½å¤–éƒ¨æœåŠ¡æˆ–å·¥å…·</strong>ã€‚æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªé…ç½®åˆ—è¡¨ï¼Œè®© Agent çŸ¥é“åº”è¯¥è¿æ¥å“ªäº›æœåŠ¡ï¼Œä»¥åŠå¦‚ä½•è°ƒç”¨è¿™äº›æœåŠ¡ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> AsyncExitStack
<span class="hljs-keyword">import</span> asyncio

<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage,SystemMessage
<span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph,MessagesState,START,END
<span class="hljs-keyword">from</span> langgraph.prebuilt <span class="hljs-keyword">import</span> ToolNode

<span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> OPENAI_API_KEY,AMAP_MAPS_API_KEY
<span class="hljs-keyword">from</span> m10_mcp_basics.agent_stream <span class="hljs-keyword">import</span> run_agent_with_streaming
<span class="hljs-keyword">from</span> m10_mcp_basics.mcp_client <span class="hljs-keyword">import</span> MCPClient
<span class="hljs-keyword">from</span> m10_mcp_basics.mcp_bridge <span class="hljs-keyword">import</span> LangChainMCPAdapter


<span class="hljs-comment"># ===ç¯å¢ƒé…ç½®===</span>
<span class="hljs-comment"># ç¯å¢ƒå…¼å®¹</span>
COMMAND = <span class="hljs-string">"npx.cmd"</span> <span class="hljs-keyword">if</span> sys.platform == <span class="hljs-string">"win32"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"npx"</span>
<span class="hljs-comment"># å¤åˆ¶å½“å‰pyè¿›ç¨‹çš„ç¯å¢ƒå˜é‡,å¹¶åœ¨å¤åˆ¶çš„ç¯å¢ƒå˜é‡é‡Œæ–°å¢ä¸€æ¡ï¼Œç¡®ä¿å®‰å…¨å¯æ§</span>
env_vars = os.environ.copy()
env_vars[<span class="hljs-string">"AMAP_MAPS_API_KEY"</span>] = AMAP_MAPS_API_KEY

MCP_SERVER_CONFIGS = [
    {
        <span class="hljs-string">"name"</span>:<span class="hljs-string">"é«˜å¾·åœ°å›¾"</span>, <span class="hljs-comment"># æ‰“å°ä½¿ç”¨äº†ä»€ä¹ˆMCPï¼Œå¯ç§»é™¤</span>
        <span class="hljs-string">"command"</span>:COMMAND,
        <span class="hljs-string">"args"</span>:[<span class="hljs-string">"-y"</span>, <span class="hljs-string">"@amap/amap-maps-mcp-server"</span>],
        <span class="hljs-string">"env"</span>:env_vars
    }
    <span class="hljs-comment"># {...}  ä¹‹åMCPå·¥å…·å¯éšéœ€æ±‚æ‰©å±•å¢åŠ </span>
]
</code></pre>
<h4 data-id="heading-42">2.2 ç¬¬äºŒæ­¥ï¼šæ„å»ºå¤§è„‘ï¼ˆGraphï¼‰</h4>
<p>è¿™é‡Œçš„é€»è¾‘éå¸¸çº¯ç²¹ã€‚build_graph å‡½æ•°æ ¹æœ¬ä¸çŸ¥é“ï¼ˆä¹Ÿä¸å…³å¿ƒï¼‰å·¥å…·æ˜¯ä»MCPæ¥çš„è¿˜æ˜¯æœ¬åœ°å†™çš„ã€‚å®ƒåªæ¥æ”¶ä¸€ä¸ª <strong>available_tools åˆ—è¡¨</strong>ï¼Œç„¶åæŠŠå®ƒä»¬ç»‘å®šåˆ° llm ä¸Šã€‚</p>
<p>åŒæ—¶å·¥å…·æ³¨å…¥ä¸å¦åªæ˜¯å¯é€‰é¡¹ï¼Œæ— å·¥å…·ä¹Ÿå¯è·‘åŠ¨ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ===æ„å»ºå›¾é€»è¾‘===</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">build_graph</span>(<span class="hljs-params">available_tools</span>):
    <span class="hljs-string">"""
    è¿™ä¸ªå‡½æ•°åªè®¤toolsåˆ—è¡¨ï¼Œä¸å…³å¿ƒtoolsçš„æ¥æº
    """</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> available_tools:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'âš ï¸ å½“å‰æ²¡æœ‰æ³¨å…¥ä»»ä½•å·¥å…·ï¼ŒAgentå°†ä»…é LLMå›ç­”ã€‚'</span>)
    llm = ChatOpenAI(
        model=<span class="hljs-string">"deepseek-chat"</span>,
        api_key=OPENAI_API_KEY,
        base_url=<span class="hljs-string">"https://api.deepseek.com"</span>,
        streaming=<span class="hljs-literal">True</span>
    )
    <span class="hljs-comment"># å¦‚æœæ²¡å·¥å…·ï¼Œbind_tools ä¼šè¢«å¿½ç•¥æˆ–å¤„ç†ï¼ŒLangGraphåŒæ ·èƒ½æ­£å¸¸è·‘çº¯å¯¹è¯</span>
    llm_with_tools = llm.bind_tools(available_tools) <span class="hljs-keyword">if</span> available_tools <span class="hljs-keyword">else</span> llm


    sys_prompt = <span class="hljs-string">"""
    ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åœ°ç†ä½ç½®æœåŠ¡åŠ©æ‰‹ã€‚
    1. å½“ç”¨æˆ·æŸ¥è¯¢æ¨¡ç³Šåœ°ç‚¹ï¼ˆå¦‚"è¥¿ç«™"ï¼‰æ—¶ï¼Œä¼šä¼˜å…ˆä½¿ç”¨ç›¸å…³å·¥å…·è·å–å…·ä½“ç»çº¬åº¦æˆ–æ ‡å‡†åç§°ã€‚
    2. å¦‚æœç”¨æˆ·æŸ¥è¯¢"é™„è¿‘"çš„åº—é“ºï¼Œè¯·å…ˆç¡®å®šä¸­å¿ƒç‚¹çš„åæ ‡æˆ–å…·ä½“ä½ç½®ï¼Œå†è¿›è¡Œæœç´¢ã€‚
    3. è°ƒç”¨å·¥å…·æ—¶ï¼Œå‚æ•°è¦å°½å¯èƒ½ç²¾ç¡®ã€‚
    """</span>

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">agent_node</span>(<span class="hljs-params">state:MessagesState</span>):
        messages = [SystemMessage(content=sys_prompt)] + state[<span class="hljs-string">"messages"</span>]
        <span class="hljs-comment"># ainvoke:å¼‚æ­¥è°ƒç”¨ç‰ˆçš„invoke</span>
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"messages"</span>:[<span class="hljs-keyword">await</span> llm_with_tools.ainvoke(messages)]}

    workflow = StateGraph(MessagesState)
    workflow.add_node(<span class="hljs-string">"agent"</span>,agent_node)

    <span class="hljs-comment"># åŠ¨æ€é€»è¾‘ï¼šå¦‚æœæœ‰å·¥å…·æ‰åŠ å·¥å…·èŠ‚ç‚¹ï¼Œå¦åˆ™å°±æ˜¯çº¯å¯¹è¯</span>
    <span class="hljs-keyword">if</span> available_tools:
        tool_node = ToolNode(available_tools)
        workflow.add_node(<span class="hljs-string">"tools"</span>,tool_node)

        <span class="hljs-keyword">def</span> <span class="hljs-title function_">should_continue</span>(<span class="hljs-params">state:MessagesState</span>):
            last_msg = state[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(last_msg,<span class="hljs-string">"tool_calls"</span>) <span class="hljs-keyword">and</span> last_msg.tool_calls:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"tools"</span>
            <span class="hljs-keyword">return</span> END

        workflow.add_edge(START,<span class="hljs-string">"agent"</span>)
        workflow.add_conditional_edges(<span class="hljs-string">"agent"</span>,should_continue,{<span class="hljs-string">"tools"</span>:<span class="hljs-string">"tools"</span>,END:END})
        workflow.add_edge(<span class="hljs-string">"tools"</span>,<span class="hljs-string">"agent"</span>)
    <span class="hljs-keyword">else</span>:
        workflow.add_edge(START,<span class="hljs-string">"agent"</span>)
        workflow.add_edge(<span class="hljs-string">"agent"</span>,END)

    <span class="hljs-keyword">return</span> workflow.<span class="hljs-built_in">compile</span>()
</code></pre>
<h4 data-id="heading-43">2.3 ç¬¬ä¸‰æ­¥ï¼šç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸å¯åŠ¨</h4>
<p>è¿™æ˜¯æ•´ä¸ªç¨‹åºçš„<strong>å‘åŠ¨æœº</strong>ã€‚æˆ‘ä»¬ä½¿ç”¨ <strong>AsyncExitStack æ¥ç»Ÿä¸€ç®¡ç†æ‰€æœ‰çš„ MCP è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚</p>
<p>æ³¨æ„çœ‹ load_mcp_tools å‡½æ•°ï¼Œå®ƒåˆ©ç”¨ <strong>stack.enter_async_context</strong> å®ç°äº†<strong>æ‰å¹³åŒ–çš„å¤šè¿æ¥ç®¡ç†</strong>ï¼š</p>
<p>æ— è®ºä½ é…ç½®äº†å¤šå°‘ä¸ªMCPæœåŠ¡ï¼Œä»£ç éƒ½<strong>ä¸éœ€è¦å¦‚ async with çš„åµŒå¥—ç¼©è¿›</strong>ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ===MCPå·¥å…·æ‰¹é‡åˆå§‹åŒ–===</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_mcp_tools</span>(<span class="hljs-params">stack:AsyncExitStack,configs:<span class="hljs-built_in">list</span></span>):
    <span class="hljs-string">"""
    è´Ÿè´£éå†é…ç½®ï¼Œæ‰¹é‡å»ºç«‹è¿æ¥ï¼Œæ”¶é›†æ‰€æœ‰å·¥å…·ã€‚
    ä½¿ç”¨stackå°†è¿æ¥ç”Ÿå‘½å‘¨æœŸæ‰˜ç®¡ç»™ä¸Šå±‚
    """</span>
    all_tools = []
    <span class="hljs-keyword">for</span> conf <span class="hljs-keyword">in</span> configs:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'ğŸ”Œ æ­£åœ¨è¿æ¥:<span class="hljs-subst">{conf[<span class="hljs-string">"name"</span>]}</span>...'</span>)
        <span class="hljs-comment"># åˆå§‹åŒ– Client</span>
        client = MCPClient(
            command=conf[<span class="hljs-string">"command"</span>],
            args=conf[<span class="hljs-string">"args"</span>],
            env=conf.get(<span class="hljs-string">"env"</span>) <span class="hljs-comment"># å¯é€‰å‚æ•°</span>
        )
        <span class="hljs-comment"># ğŸ”¥:enter_async_context æ›¿ä»£äº†async with ç¼©è¿›</span>
        <span class="hljs-comment"># è¿™æ ·æ— è®ºæœ‰å¤šå°‘ä¸ªMCPï¼Œä»£ç å±‚çº§éƒ½ä¸ä¼šå˜æ·±</span>
        adapter = <span class="hljs-keyword">await</span> stack.enter_async_context(LangChainMCPAdapter(client))
        <span class="hljs-comment"># æ‰¹é‡è·å–ä¸€ä¸ªMCPä¸‹çš„æ‰€æœ‰å·¥å…·</span>
        tools = <span class="hljs-keyword">await</span> adapter.get_tools()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'    âœ…ï¸ è·å–å·¥å…·<span class="hljs-subst">{[t.name <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> tools]}</span>'</span>)
        all_tools.extend(tools)

    <span class="hljs-keyword">return</span> all_tools

<span class="hljs-comment"># ===ä¸»ç¨‹åº===</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-comment"># ä½¿ç”¨ExitStackç»Ÿä¸€ç®¡ç†æ‰€æœ‰èµ„æºçš„å…³é—­</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> AsyncExitStack() <span class="hljs-keyword">as</span> stack:
        <span class="hljs-comment"># A.æ’ä»¶(MCP)æ³¨å…¥é˜¶æ®µ -- å…è®¸ä¸ºç©º</span>
        dynamic_tools = <span class="hljs-keyword">await</span> load_mcp_tools(stack,MCP_SERVER_CONFIGS)
        <span class="hljs-comment"># B.å›¾æ„å»ºé˜¶æ®µ</span>
        app = build_graph(available_tools=dynamic_tools)
        <span class="hljs-comment"># C.è¿è¡Œé˜¶æ®µ(æµå¼)</span>
        query = <span class="hljs-string">"å¸®æˆ‘æŸ¥ä¸€ä¸‹æ­å·è¥¿æ¹–é™„è¿‘çš„é…’åº—"</span>
        <span class="hljs-keyword">await</span> run_agent_with_streaming(app,query)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    asyncio.run(main())
</code></pre>
<h3 data-id="heading-44">3. è¿è¡Œæ•ˆæœ</h3>
<p>å½“ä½ è¿è¡Œ mcp_main.pyæ—¶ï¼Œä½ ä¼šçœ‹è§æ§åˆ¶å°è¾“å‡ºäº†æˆ‘ä»¬é¢„æƒ³çš„å®Œç¾äº¤äº’ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f55452d21c34e71b3d24ca63f6cf942~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342707&amp;x-signature=rBDtrsRD2fQSpV2rkW1XGRYQD0c%3D" alt="" loading="lazy"/></p>
<p>è¿è¡ŒæˆåŠŸã€‚</p>
<hr/>
<h2 data-id="heading-45">æ€»ç»“ã€</h2>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ MCP å®¢æˆ·ç«¯åŸºç¡€ç¯‡æ­£å¼å®Œç»“ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹è¿™æ®µæ—…ç¨‹ï¼š</p>
<p><strong>P1ï¼šç”¨GUIé¦–æ¬¡è¿é€šä¸€ä¸ªMCPæœåŠ¡å™¨</strong></p>
<p><strong>P2ï¼šè®²æ˜äº”å¤§å·¥ç¨‹åœ°åŸº</strong></p>
<p><strong>P3ï¼šå®ŒæˆMCPè¿é€šçš„æœ€å°å®ç°</strong></p>
<p><strong>P4ï¼šæ„å»ºClientä¸Bridgeï¼Œå®ç°åº•å±‚é“¾æ¥ä¸ Schema çš„è‡ªåŠ¨è½¬æ¢</strong></p>
<p><strong>P5ï¼šå¼•å…¥å…¨é“¾è·¯æµå¼ï¼Œè§£å†³äº† IO å»¶è¿Ÿå¸¦æ¥çš„ä½“éªŒé—®é¢˜</strong></p>
<p><strong>P6ï¼šå°†æ‰€æœ‰ç»„ä»¶ç»„è£…æˆäº†ä¸€ä¸ªé€šç”¨çš„ Agent æ¶æ„ã€‚</strong></p>
<p>ç°åœ¨ï¼Œä½ æ‰‹ä¸­ä¸ä»…ä»…æ˜¯ä¸€æ®µä»£ç ï¼Œè€Œæ˜¯<strong>ä¸€ä¸ªMCPé©±åŠ¨çš„Agentæ¡†æ¶</strong>ï¼Œé€šè¿‡ä¿®æ”¹ MCP_SERVER_CONFIGS ï¼Œä½ å¯ä»¥è®©Agentæ— ç¼æ¥å…¥æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿã€åœ°å›¾æœåŠ¡ç­‰ï¼Œè½»æ¾æ‰©å±•ä½ çš„ Agent èƒ½åŠ›ã€‚</p>
<hr/>
<p><strong>é¢„å‘Š</strong>ï¼š11 ç¯‡ ã€Š<strong>MCP è¿›é˜¶ç¯‡</strong>ã€‹</p>
<p>Stdio è™½å¥½ï¼Œä½†åªèƒ½<strong>æœ¬åœ°å•æœº</strong>è¿è¡Œã€‚å¦‚æœæˆ‘æƒ³æ„å»ºä¸€ä¸ªç»™<strong>å…¨å›¢é˜Ÿä½¿ç”¨</strong>çš„å…±äº«å·¥å…·åº“ï¼Œæˆ–è€…æˆ‘çš„Agent<strong>éƒ¨ç½²åœ¨Vercel</strong>è¿™ç§æ— çŠ¶æ€äº‘ç¯å¢ƒâ€”â€”ä¹Ÿå°±æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½æ˜¯å…¨æ–°å®ä¾‹ï¼Œæ— æ³•å¯åŠ¨å­è¿›ç¨‹â€”â€”å°±ä¼šé‡åˆ°é—®é¢˜ã€‚</p>
<p>ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†ä»â€œä½¿ç”¨è€…â€å‡çº§ä¸ºâ€œå¼€å‘è€…â€ï¼Œ<strong>å­¦ä¹ å¦‚ä½•æ„å»ºæ”¯æŒStreamable HTTPçš„ä¼ä¸šçº§ MCP Server</strong>ï¼Œå®ç°è·¨æœºå™¨ã€è·¨å›¢é˜Ÿçš„é€šç”¨ Agentã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openEuleræ€§èƒ½æµ‹è¯•ï¼šå®‰å…¨ç‰¹æ€§æ·±åº¦è§£è¯»ä¸å®æ“æŒ‡å—]]></title>    <link>https://juejin.cn/post/7579256547797991465</link>    <guid>https://juejin.cn/post/7579256547797991465</guid>    <pubDate>2025-12-03T04:59:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579256547797991465" data-draft-id="7579179625461907498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openEuleræ€§èƒ½æµ‹è¯•ï¼šå®‰å…¨ç‰¹æ€§æ·±åº¦è§£è¯»ä¸å®æ“æŒ‡å—"/> <meta itemprop="keywords" content="ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-03T04:59:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xcLeigh"/> <meta itemprop="url" content="https://juejin.cn/user/1775071503323875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openEuleræ€§èƒ½æµ‹è¯•ï¼šå®‰å…¨ç‰¹æ€§æ·±åº¦è§£è¯»ä¸å®æ“æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1775071503323875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xcLeigh
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:59:02.000Z" title="Wed Dec 03 2025 04:59:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡å›´ç»• openEuler æ“ä½œç³»ç»Ÿ â€œç³»ç»ŸåŸºçº¿ + è®¿é—®æ§åˆ¶ + æ¼æ´æ›´æ–° + æ—¥å¿—å®¡è®¡ + å®¹å™¨å®‰å…¨â€ äº”å¤§æ ¸å¿ƒå®‰å…¨ç»´åº¦ï¼Œå±•å¼€æ·±åº¦è§£è¯»ä¸å®æ“æŒ‡å¯¼ã€‚å…ˆä»‹ç»å…¶å®‰å…¨èƒ½åŠ›æ€»è§ˆï¼Œæ¶µç›–å†…æ ¸åŠ å›ºã€æƒé™ç®¡æ§ã€ä¾›åº”é“¾å®‰å…¨åŠäº‘åŸç”Ÿæ”¯æŒç­‰ä¼˜åŠ¿ï¼Œå†è¯¦ç»†ç»™å‡ºç¯å¢ƒç¡®è®¤çš„å®æ“ä»£ç ä¸è§£é‡Šï¼Œåç»­ä¾æ¬¡æä¾›ç³»ç»ŸåŸºçº¿é…ç½®ã€è®¿é—®æ§åˆ¶ã€æ¼æ´æ›´æ–°ã€æ—¥å¿—å®¡è®¡åŠå®¹å™¨å®‰å…¨çš„å…·ä½“æ‰§è¡Œå‘½ä»¤ã€ä»£ç è¯¦è§£å’Œæ“ä½œç›®çš„ï¼Œæ‰€æœ‰æ­¥éª¤å‡å¼ºè°ƒå¯å¤ç°æ€§ä¸æˆªå›¾è¦æ±‚ã€‚æ•´ä½“å†…å®¹èšç„¦å®ç”¨æ€§ï¼Œä¸ºç”¨æˆ·æä¾›ä»åŸºç¡€é…ç½®åˆ°è¿›é˜¶é˜²æŠ¤çš„å…¨æµç¨‹å®‰å…¨æ–¹æ¡ˆï¼ŒåŠ©åŠ›å¿«é€Ÿè½åœ° openEuler ç³»ç»Ÿå®‰å…¨é˜²æŠ¤æªæ–½ã€‚</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e52f14b0e5eb423593f73d5307bcae53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=8RlY4cbMJQgsB0%2BCUXVT1uyfbWE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">ä¸€ã€openEuler å®‰å…¨èƒ½åŠ›æ€»è§ˆ</h2>
<p>openEuler ä½œä¸ºå¼€æºæ“ä½œç³»ç»Ÿï¼Œå…¶å®‰å…¨èƒ½åŠ›è¦†ç›–ä»å†…æ ¸åˆ°äº‘åŸç”Ÿçš„å…¨åœºæ™¯ï¼Œæ ¸å¿ƒä¼˜åŠ¿é›†ä¸­åœ¨äº”å¤§æ–¹å‘ï¼Œä¸ºç³»ç»Ÿæä¾›å…¨é“¾è·¯å®‰å…¨é˜²æŠ¤ã€‚</p>
<h3 data-id="heading-1">1. å†…æ ¸/ç³»ç»ŸåŠ å›º</h3>
<ul>
<li>æŒç»­è¿½è¸ªå¹¶ä¿®å¤å…¬å¼€æ¼æ´ï¼ˆCVEï¼‰ï¼Œä¿éšœå†…æ ¸åº•å±‚å®‰å…¨ã€‚</li>
<li>é›†æˆ SELinux å¼ºåˆ¶è®¿é—®æ§åˆ¶æœºåˆ¶ï¼Œé€šè¿‡ç»†ç²’åº¦å®‰å…¨ç­–ç•¥é™åˆ¶è¿›ç¨‹æƒé™ï¼ŒæŠµå¾¡è¶Šæƒæ”»å‡»ã€‚</li>
</ul>
<h3 data-id="heading-2">2. è®¿é—®æ§åˆ¶ä¸æœ€å°æƒé™</h3>
<ul>
<li>ç»“åˆ SELinuxã€sudo åˆ†æƒç®¡ç†ã€æ–‡ä»¶ç³»ç»Ÿæƒé™ï¼ˆrwxï¼‰åŠç½‘ç»œç­–ç•¥ï¼Œæ„å»ºå¤šå±‚çº§è®¿é—®æ§åˆ¶ä½“ç³»ã€‚</li>
<li>éµå¾ªâ€œæœ€å°æƒé™åŸåˆ™â€ï¼Œä»…ä¸ºç”¨æˆ·å’Œè¿›ç¨‹åˆ†é…å¿…è¦æƒé™ï¼Œé™ä½æƒé™æ»¥ç”¨é£é™©ã€‚</li>
</ul>
<h3 data-id="heading-3">3. ä¾›åº”é“¾ä¸ç”Ÿæ€å®‰å…¨</h3>
<ul>
<li>å®˜æ–¹è½¯ä»¶æºä¸¥æ ¼ç®¡ç†ï¼Œæ‰€æœ‰è½¯ä»¶åŒ…æä¾›ç­¾åæ ¡éªŒæœºåˆ¶ï¼Œé˜²æ­¢æ¶æ„ç¯¡æ”¹ã€‚</li>
<li>æä¾›åŠæ—¶çš„ç³»ç»Ÿæ›´æ–°é€šé“ï¼Œç¡®ä¿å®‰å…¨è¡¥ä¸ã€åŠŸèƒ½ä¼˜åŒ–å¿«é€Ÿè½åœ°ã€‚</li>
</ul>
<h3 data-id="heading-4">4. äº‘åŸç”Ÿå®‰å…¨</h3>
<ul>
<li>åŸç”Ÿæ”¯æŒ iSuladã€containerd ç­‰ä¸»æµå®¹å™¨è¿è¡Œæ—¶ã€‚</li>
<li>ä¾æ‰˜å†…æ ¸çº§éš”ç¦»èƒ½åŠ›ï¼Œå¯¹å®¹å™¨èµ„æºã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œä¸¥æ ¼é™åˆ¶ï¼Œä¿éšœå®¹å™¨é—´å®‰å…¨éš”ç¦»ã€‚</li>
</ul>
<p>å‚è€ƒæ¥æºï¼šopenEuler å®˜ç½‘ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openeuler.org%2F%25EF%25BC%2589%25E3%2580%2581openEuler" target="_blank" title="https://www.openeuler.org/%EF%BC%89%E3%80%81openEuler" ref="nofollow noopener noreferrer">www.openeuler.org/ï¼‰ã€openEuler</a> å®˜æ–¹æ–‡æ¡£ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openeuler.openatom.cn%2Fzh%2F%25EF%25BC%2589" target="_blank" title="https://docs.openeuler.openatom.cn/zh/%EF%BC%89" ref="nofollow noopener noreferrer">docs.openeuler.openatom.cn/zh/ï¼‰</a></p>
<hr/>
<h2 data-id="heading-5">äºŒã€ç¯å¢ƒç¡®è®¤ï¼ˆå®æ“æ­¥éª¤+ä»£ç è¯¦è§£ï¼‰</h2>
<p>åœ¨è¿›è¡Œå®‰å…¨é…ç½®å‰ï¼Œéœ€å…ˆç¡®è®¤å½“å‰ç³»ç»Ÿç¯å¢ƒï¼Œç¡®ä¿æ“ä½œä¸ç³»ç»Ÿç‰ˆæœ¬åŒ¹é…ï¼Œä»¥ä¸‹ä¸ºå®Œæ•´å®æ“æµç¨‹åŠä»£ç è§£é‡Šã€‚</p>
<h3 data-id="heading-6">1. æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯</h3>
<h4 data-id="heading-7">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> /etc/os-release
</code></pre>
<h4 data-id="heading-8">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>cat</code> æ˜¯ Linux ç³»ç»Ÿä¸­ç”¨äºè¯»å–æ–‡ä»¶å†…å®¹çš„åŸºç¡€å‘½ä»¤ã€‚</li>
<li><code>/etc/os-release</code> æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„ç‰ˆæœ¬ä¿¡æ¯é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«æ“ä½œç³»ç»Ÿåç§°ã€ç‰ˆæœ¬å·ã€ID ç­‰æ ¸å¿ƒä¿¡æ¯ã€‚</li>
</ul>
<h4 data-id="heading-9">é¢„æœŸè¾“å‡ºä¸è¯´æ˜</h4>
<p>è¾“å‡ºå°†åŒ…å« <code>NAME="openEuler"</code>ã€<code>VERSION="xxx"</code>ï¼ˆå…·ä½“ç‰ˆæœ¬å·ï¼‰ç­‰å­—æ®µï¼Œç¡®è®¤å½“å‰ç³»ç»Ÿä¸º openEuler ç³»ç»Ÿï¼Œé¿å…å› æ“ä½œç³»ç»Ÿä¸åŒ¹é…å¯¼è‡´åç»­æ“ä½œå¤±è´¥ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1c70bf6a43445279f30df3cb78daebf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=vIFy3CcNal2WJgboZM1vYaQu05U%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">2. æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯</h3>
<h4 data-id="heading-11">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">uname</span> -a
</code></pre>
<h4 data-id="heading-12">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>uname</code> å‘½ä»¤ç”¨äºæŸ¥è¯¢ç³»ç»Ÿå†…æ ¸ç›¸å…³ä¿¡æ¯ã€‚</li>
<li>å‚æ•° <code>-a</code> è¡¨ç¤ºâ€œæ˜¾ç¤ºæ‰€æœ‰ä¿¡æ¯â€ï¼ŒåŒ…æ‹¬å†…æ ¸ç‰ˆæœ¬ã€ä¸»æœºåã€ç¡¬ä»¶æ¶æ„ã€ç¼–è¯‘æ—¶é—´ç­‰ã€‚</li>
</ul>
<h4 data-id="heading-13">é¢„æœŸè¾“å‡ºä¸è¯´æ˜</h4>
<p>è¾“å‡ºä¸­ä¼šæ˜ç¡®æ˜¾ç¤ºå†…æ ¸ç‰ˆæœ¬å·ï¼ˆå¦‚ <code>5.10.0-xxx.openeuler20.03.x86_64</code>ï¼‰ï¼Œå†…æ ¸ç‰ˆæœ¬ç›´æ¥å½±å“éƒ¨åˆ†å®‰å…¨ç‰¹æ€§çš„æ”¯æŒæƒ…å†µï¼ˆå¦‚ SELinux é«˜çº§åŠŸèƒ½ã€å®¹å™¨éš”ç¦»èƒ½åŠ›ï¼‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45efa8286eb04ea4b29245d8ecfdaae5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=ugC6AheWMvjIHXVQ8Jqb1ntjihM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">3. æŸ¥çœ‹ SELinux è¿è¡ŒçŠ¶æ€</h3>
<h4 data-id="heading-15">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-arduino" lang="arduino">sestatus || <span class="hljs-literal">true</span>
</code></pre>
<h4 data-id="heading-16">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>sestatus</code> æ˜¯ä¸“é—¨ç”¨äºæŸ¥è¯¢ SELinux çŠ¶æ€çš„å‘½ä»¤ï¼Œè¾“å‡ºåŒ…æ‹¬ SELinux æ˜¯å¦å¯ç”¨ã€è¿è¡Œæ¨¡å¼ï¼ˆ enforcing/permissive/disabled ï¼‰ç­‰ã€‚</li>
<li><code>|| true</code> è¡¨ç¤ºè‹¥ <code>sestatus</code> å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼ˆå¦‚ç³»ç»Ÿæœªå®‰è£… SELinux ç›¸å…³ç»„ä»¶ï¼‰ï¼Œåˆ™è¿”å›â€œtrueâ€ï¼Œé¿å…ç»ˆç«¯æ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯ï¼Œä¿è¯å‘½ä»¤æ‰§è¡Œæµç¨‹ä¸ä¸­æ–­ã€‚</li>
</ul>
<h4 data-id="heading-17">é¢„æœŸè¾“å‡ºä¸è¯´æ˜</h4>
<ul>
<li>è‹¥è¾“å‡º <code>SELinux status: enabled</code>ï¼Œè¯´æ˜ SELinux å·²å¯ç”¨ï¼Œå¯ç›´æ¥è¿›è¡Œåç»­ç­–ç•¥é…ç½®ã€‚</li>
<li>è‹¥è¾“å‡º <code>SELinux status: disabled</code>ï¼Œè¯´æ˜ SELinux æœªå¯ç”¨ï¼Œéœ€å…ˆå®Œæˆå¯ç”¨é…ç½®å†æ¨è¿›ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d98d52ff9db41a6aa713c86644d9283~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=jFIdhxwkwxcfqqO%2FBh2eaHXyIFs%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-18">ä¸‰ã€ç³»ç»ŸåŸºçº¿å®‰å…¨é…ç½®ï¼ˆå®æ“+è¯¦è§£ï¼‰</h2>
<p>ç³»ç»ŸåŸºçº¿æ˜¯å®‰å…¨é˜²æŠ¤çš„åŸºç¡€ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶ä¼˜åŒ–ã€æœåŠ¡ç®¡ç†ç­‰æ“ä½œï¼Œå‡å°‘é»˜è®¤å®‰å…¨éšæ‚£ã€‚</p>
<h3 data-id="heading-19">1. ç¦ç”¨æ— ç”¨ç³»ç»ŸæœåŠ¡</h3>
<h4 data-id="heading-20">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰è¿è¡Œçš„ç³»ç»ŸæœåŠ¡</span>
systemctl list-unit-files --<span class="hljs-built_in">type</span>=service --state=enabled
<span class="hljs-comment"># ç¦ç”¨æ— ç”¨æœåŠ¡ï¼ˆä»¥ avahi-daemon ä¸ºä¾‹ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼‰</span>
systemctl <span class="hljs-built_in">disable</span> --now avahi-daemon
</code></pre>
<h4 data-id="heading-21">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>systemctl list-unit-files</code> ç”¨äºåˆ—å‡ºç³»ç»Ÿæ‰€æœ‰æœåŠ¡é…ç½®æ–‡ä»¶ï¼Œ<code>--type=service</code> é™å®šä»…æ˜¾ç¤ºæœåŠ¡ç±»æ–‡ä»¶ï¼Œ<code>--state=enabled</code> ä»…ç­›é€‰å·²å¯ç”¨çš„æœåŠ¡ã€‚</li>
<li><code>systemctl disable --now</code> è¡¨ç¤ºâ€œç«‹å³ç¦ç”¨å¹¶åœæ­¢æœåŠ¡â€ï¼Œ<code>disable</code> æ˜¯æ°¸ä¹…ç¦ç”¨ï¼ˆå¼€æœºä¸è‡ªåŠ¨å¯åŠ¨ï¼‰ï¼Œ<code>--now</code> æ˜¯ç«‹å³åœæ­¢å½“å‰è¿è¡Œçš„æœåŠ¡ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc2bbeb339764d849cbe662307fae37a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=ch9zS0RdikT1n2IpGnmcSPHOtVU%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-22">æ“ä½œç›®çš„</h4>
<p>ç¦ç”¨æ‰“å°æœºæœåŠ¡ã€æ–‡ä»¶å…±äº«æœåŠ¡ç­‰éå¿…éœ€æœåŠ¡ï¼Œå‡å°‘ç³»ç»Ÿæš´éœ²é¢ï¼Œé™ä½è¢«æ”»å‡»é£é™©ã€‚</p>
<h3 data-id="heading-23">2. ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿæƒé™</h3>
<h4 data-id="heading-24">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é™åˆ¶ /etc ç›®å½•æƒé™ï¼ˆä»… root å¯ä¿®æ”¹ï¼‰</span>
<span class="hljs-built_in">chmod</span> -R 755 /etc
<span class="hljs-comment"># ç¦æ­¢æ™®é€šç”¨æˆ·æŸ¥çœ‹ /etc/shadowï¼ˆå¯†ç æ–‡ä»¶ï¼‰</span>
<span class="hljs-built_in">chmod</span> 000 /etc/shadow
</code></pre>
<h4 data-id="heading-25">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>chmod -R 755 /etc</code> ä¸­ï¼Œ<code>-R</code> è¡¨ç¤ºé€’å½’åº”ç”¨æƒé™ï¼ˆåŒ…æ‹¬å­ç›®å½•å’Œæ–‡ä»¶ï¼‰ï¼Œ<code>755</code> è¡¨ç¤ºæ‰€æœ‰è€…ï¼ˆrootï¼‰æœ‰è¯»/å†™/æ‰§è¡Œæƒé™ï¼Œå…¶ä»–ç”¨æˆ·ä»…æœ‰è¯»/æ‰§è¡Œæƒé™ã€‚</li>
<li><code>chmod 000 /etc/shadow</code> è¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·å‡æ— è¯»/å†™/æ‰§è¡Œæƒé™ï¼Œ<code>/etc/shadow</code> å­˜å‚¨ç”¨æˆ·åŠ å¯†å¯†ç ï¼Œä¸¥æ ¼é™åˆ¶è®¿é—®å¯é˜²æ­¢å¯†ç æ³„éœ²ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fcf41a6594b41b997e9a45402b4335d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=qhGiF3%2BiyXxR09LN5ZfLerhbxyw%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-26">å››ã€è®¿é—®æ§åˆ¶é…ç½®ï¼ˆå®æ“+è¯¦è§£ï¼‰</h2>
<p>åŸºäºæœ€å°æƒé™åŸåˆ™ï¼Œé€šè¿‡ sudo åˆ†æƒã€æ–‡ä»¶æƒé™éš”ç¦»ç­‰æ–¹å¼ï¼Œç®¡æ§ç”¨æˆ·è®¿é—®è¡Œä¸ºã€‚</p>
<h3 data-id="heading-27">1. é…ç½® sudo åˆ†æƒï¼ˆé™åˆ¶æ™®é€šç”¨æˆ·æƒé™ï¼‰</h3>
<h4 data-id="heading-28">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># ç¼–è¾‘ sudo é…ç½®æ–‡ä»¶</span>
visudo
<span class="hljs-comment"># åœ¨æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼ˆæ›¿æ¢ username ä¸ºå®é™…æ™®é€šç”¨æˆ·åï¼‰</span>
username <span class="hljs-variable constant_">ALL</span>=(<span class="hljs-variable constant_">ALL</span>) <span class="hljs-variable constant_">NOPASSWD</span>: <span class="hljs-regexp">/usr/bin</span><span class="hljs-regexp">/systemctl restart nginx, /usr</span><span class="hljs-regexp">/bin/ls</span>
</code></pre>
<h4 data-id="heading-29">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>visudo</code> æ˜¯ç¼–è¾‘ sudo é…ç½®æ–‡ä»¶ï¼ˆ/etc/sudoersï¼‰çš„ä¸“ç”¨å‘½ä»¤ï¼Œä¼šè‡ªåŠ¨æ ¡éªŒè¯­æ³•ï¼Œé¿å…é…ç½®é”™è¯¯å¯¼è‡´ sudo å¤±æ•ˆã€‚</li>
<li>é…ç½®é¡¹ <code>username ALL=(ALL) NOPASSWD: å‘½ä»¤1, å‘½ä»¤2</code> è¡¨ç¤ºï¼šæ™®é€šç”¨æˆ· username å¯åœ¨æ‰€æœ‰ä¸»æœºä¸Šï¼Œä»¥æ‰€æœ‰ç”¨æˆ·èº«ä»½æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œä¸”æ— éœ€è¾“å…¥å¯†ç ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5258bb7a66fb4718ae31cd85d8f4b57c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=MbRPqMDI1yWCSyoQKGUxhZOsAvw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-30">æ“ä½œç›®çš„</h4>
<p>é¿å…æ™®é€šç”¨æˆ·è·å–å®Œæ•´ root æƒé™ï¼Œä»…å¼€æ”¾å¿…è¦æ“ä½œæƒé™ï¼Œé™ä½è¯¯æ“ä½œæˆ–æ¶æ„æ“ä½œçš„å½±å“ã€‚</p>
<h3 data-id="heading-31">2. é…ç½®æ–‡ä»¶ç‰¹æ®Šæƒé™ï¼ˆé˜²æ­¢è¶Šæƒè®¿é—®ï¼‰</h3>
<h4 data-id="heading-32">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸ºæ•æ„Ÿæ–‡ä»¶æ·»åŠ  immutable æƒé™ï¼ˆä»… root å¯ä¿®æ”¹ï¼‰</span>
chattr +i /etc/passwd
chattr +i /etc/group
</code></pre>
<h4 data-id="heading-33">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>chattr</code> ç”¨äºä¿®æ”¹æ–‡ä»¶çš„æ‰©å±•å±æ€§ï¼Œ<code>+i</code> è¡¨ç¤ºæ·»åŠ â€œä¸å¯ä¿®æ”¹â€å±æ€§ã€‚</li>
<li><code>/etc/passwd</code>ï¼ˆç”¨æˆ·è´¦æˆ·æ–‡ä»¶ï¼‰å’Œ <code>/etc/group</code>ï¼ˆç”¨æˆ·ç»„æ–‡ä»¶ï¼‰æ·»åŠ è¯¥å±æ€§åï¼Œå³ä½¿æ˜¯ root ç”¨æˆ·ï¼Œä¹Ÿéœ€å…ˆç§»é™¤ <code>i</code> å±æ€§æ‰èƒ½ä¿®æ”¹ï¼Œé˜²æ­¢æ–‡ä»¶è¢«æ¶æ„ç¯¡æ”¹ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb77f6403dcd4b78813e6abf49b4ee20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=iH2d6ubdu4f76%2BfqBCkHzSZnNTI%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-34">äº”ã€æ¼æ´æ›´æ–°é…ç½®ï¼ˆå®æ“+è¯¦è§£ï¼‰</h2>
<p>åŠæ—¶æ›´æ–°ç³»ç»Ÿè¡¥ä¸å’Œè½¯ä»¶åŒ…ï¼Œä¿®å¤å·²çŸ¥å®‰å…¨æ¼æ´ï¼Œæ˜¯å®‰å…¨é˜²æŠ¤çš„å…³é”®ç¯èŠ‚ã€‚</p>
<h3 data-id="heading-35">1. é…ç½®å®˜æ–¹è½¯ä»¶æºï¼ˆç¡®ä¿æ›´æ–°æºå®‰å…¨ï¼‰</h3>
<h4 data-id="heading-36">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¤‡ä»½åŸæœ‰æºé…ç½®æ–‡ä»¶</span>
<span class="hljs-built_in">cp</span> /etc/yum.repos.d/openEuler.repo /etc/yum.repos.d/openEuler.repo.bak
<span class="hljs-comment"># ç¼–è¾‘æºé…ç½®æ–‡ä»¶ï¼ˆä½¿ç”¨å®˜æ–¹æºï¼‰</span>
vi /etc/yum.repos.d/openEuler.repo
</code></pre>
<h4 data-id="heading-37">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>cp</code> å‘½ä»¤ç”¨äºå¤‡ä»½åŸæœ‰æºé…ç½®ï¼Œé¿å…é…ç½®é”™è¯¯åæ— æ³•æ¢å¤ã€‚</li>
<li><code>vi</code> æ˜¯ Linux è‡ªå¸¦çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œç”¨äºä¿®æ”¹æºé…ç½®æ–‡ä»¶ï¼Œç¡®ä¿ä»…ä½¿ç”¨ openEuler å®˜æ–¹æºï¼Œé¿å…ç¬¬ä¸‰æ–¹æºå¸¦æ¥çš„å®‰å…¨é£é™©ã€‚</li>
</ul>
<h4 data-id="heading-38">é…ç½®æ–‡ä»¶æ ¸å¿ƒå†…å®¹</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[openEuler-os]</span>
<span class="hljs-attr">name</span>=openEuler OS
<span class="hljs-attr">baseurl</span>=https://repo.openeuler.org/openEuler-<span class="hljs-number">22.03</span>-LTS/OS/<span class="hljs-variable">$basearch</span>/
<span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span>
<span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">1</span>
<span class="hljs-attr">gpgkey</span>=https://repo.openeuler.org/openEuler-<span class="hljs-number">22.03</span>-LTS/OS/<span class="hljs-variable">$basearch</span>/RPM-GPG-KEY-openEuler
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b68ee08e1204111b4b5271cec3141b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=7FS0oQzXtlIMF4jSC3DDhQVwxdA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-39">2. ä¸€é”®æ›´æ–°ç³»ç»Ÿæ¼æ´è¡¥ä¸</h3>
<h4 data-id="heading-40">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ¸…ç† yum ç¼“å­˜</span>
yum clean <span class="hljs-built_in">all</span>
<span class="hljs-comment"># ç”Ÿæˆç¼“å­˜å¹¶æ›´æ–°æ‰€æœ‰è½¯ä»¶åŒ…</span>
yum makecache &amp;&amp; yum update -y
</code></pre>
<h4 data-id="heading-41">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>yum clean all</code> æ¸…ç†æœ¬åœ°ç¼“å­˜çš„è½¯ä»¶åŒ…ä¿¡æ¯ï¼Œé¿å…æ—§ç¼“å­˜å¯¼è‡´æ›´æ–°å¤±è´¥ã€‚</li>
<li><code>yum makecache</code> é‡æ–°ç”Ÿæˆè½¯ä»¶åŒ…ç¼“å­˜ï¼Œæé«˜æ›´æ–°é€Ÿåº¦ï¼›<code>yum update -y</code> è‡ªåŠ¨æ›´æ–°æ‰€æœ‰å¯æ›´æ–°çš„è½¯ä»¶åŒ…ï¼ˆåŒ…æ‹¬å†…æ ¸è¡¥ä¸ã€å®‰å…¨ä¿®å¤åŒ…ï¼‰ï¼Œ<code>-y</code> è¡¨ç¤ºè‡ªåŠ¨ç¡®è®¤æ‰€æœ‰æ“ä½œï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥â€œyâ€ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb20f38107a74151b8a8ffa4d9864436~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=l4x03Cd%2B%2FKE16EzfO%2BwNF0veC3Q%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-42">å…­ã€æ—¥å¿—å®¡è®¡é…ç½®ï¼ˆå®æ“+è¯¦è§£ï¼‰</h2>
<p>é€šè¿‡é…ç½®æ—¥å¿—æ”¶é›†ã€å­˜å‚¨å’Œåˆ†æï¼Œå®ç°å®‰å…¨äº‹ä»¶å¯è¿½æº¯ï¼Œä¾¿äºåŠæ—¶å‘ç°å¼‚å¸¸è¡Œä¸ºã€‚</p>
<h3 data-id="heading-43">1. é…ç½® rsyslog æ—¥å¿—æœåŠ¡ï¼ˆæ”¶é›†ç³»ç»Ÿæ—¥å¿—ï¼‰</h3>
<h4 data-id="heading-44">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯ç”¨å¹¶å¯åŠ¨ rsyslog æœåŠ¡</span>
systemctl <span class="hljs-built_in">enable</span> --now rsyslog
<span class="hljs-comment"># ç¼–è¾‘æ—¥å¿—é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šæ—¥å¿—å­˜å‚¨è·¯å¾„</span>
vi /etc/rsyslog.conf
</code></pre>
<h4 data-id="heading-45">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>rsyslog</code> æ˜¯ Linux ç³»ç»Ÿé»˜è®¤çš„æ—¥å¿—æ”¶é›†æœåŠ¡ï¼Œæ”¯æŒå°†ç³»ç»Ÿæ—¥å¿—ã€åº”ç”¨æ—¥å¿—ç»Ÿä¸€æ”¶é›†å­˜å‚¨ã€‚</li>
<li>ç¼–è¾‘ <code>/etc/rsyslog.conf</code> å¯è‡ªå®šä¹‰æ—¥å¿—å­˜å‚¨è§„åˆ™ï¼Œä¾‹å¦‚å°†å®‰å…¨ç›¸å…³æ—¥å¿—ï¼ˆauth.logï¼‰å•ç‹¬å­˜å‚¨åˆ°æŒ‡å®šç›®å½•ã€‚</li>
</ul>
<h4 data-id="heading-46">å…³é”®é…ç½®ç¤ºä¾‹ï¼ˆæ·»åŠ åˆ°é…ç½®æ–‡ä»¶æœ«å°¾ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰å…¨æ—¥å¿—å•ç‹¬å­˜å‚¨</span>
auth.* /var/log/security.log
<span class="hljs-comment"># æ—¥å¿—è½®è½¬ï¼ˆé¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼‰</span>
<span class="hljs-variable">$ModLoad</span> imrotate
<span class="hljs-variable">$RotateConfigFile</span> /etc/rsyslog.d/rotate.conf
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/becbe99572d44201a9311e63e0014d0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=6uw5aXXCp3m2LiWs%2FUPCXSb7Kj8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-47">2. é…ç½®æ—¥å¿—è½®è½¬ï¼ˆç®¡ç†æ—¥å¿—æ–‡ä»¶å¤§å°ï¼‰</h3>
<h4 data-id="heading-48">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¼–è¾‘æ—¥å¿—è½®è½¬é…ç½®æ–‡ä»¶</span>
vi /etc/logrotate.d/rsyslog
</code></pre>
<h4 data-id="heading-49">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>logrotate</code> ç”¨äºè‡ªåŠ¨åˆ‡å‰²ã€å‹ç¼©æ—¥å¿—æ–‡ä»¶ï¼Œé˜²æ­¢å•ä¸ªæ—¥å¿—æ–‡ä»¶è¿‡å¤§å ç”¨ç£ç›˜ç©ºé—´ã€‚</li>
<li><code>/etc/logrotate.d/rsyslog</code> æ˜¯ rsyslog æœåŠ¡çš„æ—¥å¿—è½®è½¬é…ç½®æ–‡ä»¶ï¼Œå¯è®¾ç½®è½®è½¬å‘¨æœŸã€ä¿ç•™å¤©æ•°ã€å‹ç¼©æ–¹å¼ç­‰ã€‚</li>
</ul>
<h4 data-id="heading-50">å…³é”®é…ç½®ç¤ºä¾‹</h4>
<pre><code class="hljs language-bash" lang="bash">/var/log/security.log {
    daily        <span class="hljs-comment"># æ¯æ—¥è½®è½¬ä¸€æ¬¡</span>
    rotate 7     <span class="hljs-comment"># ä¿ç•™ 7 å¤©çš„æ—¥å¿—</span>
    compress     <span class="hljs-comment"># å‹ç¼©æ—§æ—¥å¿—</span>
    missingok    <span class="hljs-comment"># æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨æ—¶ä¸æŠ¥é”™</span>
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c32f47696c92421b95e3d09751983efa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=Gv6C00NRP5qSMynZyVPNlm4JtcI%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-51">ä¸ƒã€å®¹å™¨å®‰å…¨é…ç½®ï¼ˆå®æ“+è¯¦è§£ï¼‰</h2>
<p>é’ˆå¯¹äº‘åŸç”Ÿåœºæ™¯ï¼Œé€šè¿‡å®¹å™¨è¿è¡Œæ—¶é…ç½®ã€èµ„æºé™åˆ¶ç­‰ï¼Œä¿éšœå®¹å™¨éƒ¨ç½²å®‰å…¨ã€‚</p>
<h3 data-id="heading-52">1. å®‰è£…å¹¶é…ç½® iSulad å®¹å™¨è¿è¡Œæ—¶</h3>
<h4 data-id="heading-53">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£… iSulad</span>
yum install -y iSulad
<span class="hljs-comment"># å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯</span>
systemctl <span class="hljs-built_in">enable</span> --now isulad
<span class="hljs-comment"># é…ç½®å®¹å™¨é•œåƒæºï¼ˆä½¿ç”¨å®˜æ–¹æºï¼‰</span>
vi /etc/isulad/daemon.json
</code></pre>
<h4 data-id="heading-54">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>yum install -y iSulad</code> ä»å®˜æ–¹æºå®‰è£… iSulad å®¹å™¨è¿è¡Œæ—¶ï¼Œ<code>-y</code> è‡ªåŠ¨ç¡®è®¤å®‰è£…ã€‚</li>
<li><code>systemctl enable --now isulad</code> å¯åŠ¨æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯ï¼Œç¡®ä¿å®¹å™¨æœåŠ¡æŒç»­å¯ç”¨ã€‚</li>
<li><code>/etc/isulad/daemon.json</code> æ˜¯ iSulad çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œå¯é…ç½®é•œåƒæºã€å®¹å™¨ç½‘ç»œã€èµ„æºé™åˆ¶ç­‰ã€‚</li>
</ul>
<h4 data-id="heading-55">å…³é”®é…ç½®ç¤ºä¾‹ï¼ˆé•œåƒæºé…ç½®ï¼‰</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"registry-mirrors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"https://repo.openeuler.org/dockerhub/"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54c68c426a7a4b9fb16757106916048a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=5K5lWl%2FOYL8zwvqa1EnKnlacIjo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-56">2. å®¹å™¨èµ„æºé™åˆ¶ä¸å®‰å…¨éš”ç¦»</h3>
<h4 data-id="heading-57">æ‰§è¡Œä»£ç </h4>
<pre><code class="hljs language-scss" lang="scss"># è¿è¡Œå®¹å™¨æ—¶é™åˆ¶ CPU å’Œå†…å­˜ï¼ˆä»¥ nginx é•œåƒä¸ºä¾‹ï¼‰
isula run -d <span class="hljs-attr">--name</span> nginx-safe <span class="hljs-attr">--cpus</span> <span class="hljs-number">0.5</span> <span class="hljs-attr">--memory</span> <span class="hljs-number">512</span>m <span class="hljs-attr">--security-opt</span> seccomp=default<span class="hljs-selector-class">.json</span> nginx
</code></pre>
<h4 data-id="heading-58">ä»£ç è§£é‡Š</h4>
<ul>
<li><code>--cpus 0.5</code> é™åˆ¶å®¹å™¨æœ€å¤šä½¿ç”¨ 0.5 ä¸ª CPU æ ¸å¿ƒï¼Œé¿å…å®¹å™¨å ç”¨è¿‡å¤šèµ„æºå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚</li>
<li><code>--memory 512m</code> é™åˆ¶å®¹å™¨æœ€å¤§ä½¿ç”¨å†…å­˜ä¸º 512MBï¼Œé˜²æ­¢å†…å­˜æ³„æ¼å¼•å‘çš„å®‰å…¨é—®é¢˜ã€‚</li>
<li><code>--security-opt seccomp=default.json</code> å¯ç”¨ seccomp å®‰å…¨æœºåˆ¶ï¼Œé™åˆ¶å®¹å™¨å¯è°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå‡å°‘å®¹å™¨é€ƒé€¸é£é™©ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-59">å…«ã€æ€»ç»“</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85ada052412649bc86e6f234eb069b30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765342741&amp;x-signature=%2F%2Fgfg8%2Fnj0xq%2FLmF8rivA3gK3Q8%3D" alt="" loading="lazy"/></p>
<p>openEuler å ªç§°å¼€æºæ“ä½œç³»ç»Ÿé¢†åŸŸçš„å®‰å…¨æ ‡æ†ğŸŒŸï¼å®ƒä»¥å†…æ ¸åŠ å›ºä¸ºæ ¹åŸºğŸ›¡ï¸ï¼Œé›†æˆ SELinux ç­‰ç¡¬æ ¸é˜²æŠ¤ï¼Œä»åº•å±‚ç­‘ç‰¢å®‰å…¨é˜²çº¿ï¼›å¤šå±‚çº§è®¿é—®æ§åˆ¶ä½“ç³»ç»†è‡´å…¥å¾®ğŸ”ï¼Œæœ€å°æƒé™åŸåˆ™è´¯ç©¿å§‹ç»ˆï¼Œç²¾å‡†è§„é¿æƒé™æ»¥ç”¨é£é™©ï¼›å®˜æ–¹è½¯ä»¶æºç­¾åæ ¡éªŒ+å¿«é€Ÿæ¼æ´æ›´æ–°åŒç®¡é½ä¸‹ğŸš€ï¼Œè®©ä¾›åº”é“¾å®‰å…¨æ— æ‡ˆå¯å‡»ï¼›äº‘åŸç”Ÿåœºæ™¯ä¸‹çš„å®¹å™¨éš”ç¦»ä¸èµ„æºç®¡æ§èƒ½åŠ›äº®çœ¼âœ¨ï¼Œå®Œç¾é€‚é…ç°ä»£éƒ¨ç½²éœ€æ±‚ï¼›å†åŠ ä¸Šå®Œå–„çš„æ—¥å¿—å®¡è®¡æœºåˆ¶ğŸ“Šï¼Œå®ç°å®‰å…¨äº‹ä»¶å¯è¿½æº¯ã€å¯æ’æŸ¥ã€‚ä½œä¸ºè‡ªä¸»å¼€æºç”Ÿæ€çš„æ ¸å¿ƒåŠ›é‡ğŸŒï¼ŒopenEuler æ—¢å…¼é¡¾äº†å…¨åœºæ™¯å®‰å…¨é˜²æŠ¤çš„ä¸“ä¸šæ€§ï¼Œåˆæä¾›äº†ç®€å•æ˜“æ“ä½œçš„å®æ“æ–¹æ¡ˆï¼Œè®©ä¼ä¸šå’Œå¼€å‘è€…èƒ½è½»æ¾è½åœ°å®‰å…¨é…ç½®ï¼Œæ— ç–‘æ˜¯æ•°å­—åŒ–æ—¶ä»£å€¼å¾—ä¿¡èµ–çš„æ“ä½œç³»ç»Ÿä¼˜é€‰ğŸ‘ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Mapæ˜ å°„]]></title>    <link>https://juejin.cn/post/7579179741824286746</link>    <guid>https://juejin.cn/post/7579179741824286746</guid>    <pubDate>2025-12-03T03:36:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179741824286746" data-draft-id="7579142750408605722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Mapæ˜ å°„"/> <meta itemprop="keywords" content="Scala"/> <meta itemprop="datePublished" content="2025-12-03T03:36:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Dddd"/> <meta itemprop="url" content="https://juejin.cn/user/740432946661152"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Mapæ˜ å°„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/740432946661152/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Dddd
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:36:42.000Z" title="Wed Dec 03 2025 03:36:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ï¼ˆä¸€ï¼‰Mapçš„å®šä¹‰å’Œåˆ›å»º</h2>
<p><strong>Map åˆ›å»ºæ ¼å¼ï¼š</strong></p>
<p>1.ä¸å¯å˜ Mapï¼šval mapName: Map[KeyType, ValueType] = Map(key1 -&gt; value1, key2 -&gt; value2,...)</p>
<p>2.å¯å˜ Mapï¼ˆéœ€å¯¼å…¥scala.collection.mutable.Mapï¼‰ï¼šval mapName:</p>
<p>mutable.Map[KeyType, ValueType] = mutable.Map(key1 -&gt; value2,...)</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> map
<span class="hljs-comment">/**
 * Map: æ˜ å°„
 * é”®å€¼å¯¹ï¼Œé”®ä¸èƒ½æœ‰ç›¸åŒçš„ï¼
 * (key, value)
 *
 * è±« -&gt; æ¹–åŒ—çœ
 * æ¹˜ -&gt; æ¹–å—çœ
 * èµ£ -&gt; æ±Ÿè¥¿çœ
 *
 * 01 -&gt; xxx
 * 02 -&gt; yyy
 */</span>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">map01</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> map1 = <span class="hljs-type">Map</span>(<span class="hljs-string">"alice"</span> -&gt; <span class="hljs-number">90</span>, (<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">80</span>), (<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">100</span>))
    <span class="hljs-comment">// bobè¿™ä¸ªé”®æœ‰é‡å¤ï¼Œåªä¿ç•™ä¸€ä¸ª</span>
    println(map1)
  }
}
</code></pre>
<h2 data-id="heading-1">ï¼ˆäºŒï¼‰Map çš„å¸¸ç”¨æ–¹æ³•</h2>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> map
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">map01</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> map1 = scala.collection.mutable.<span class="hljs-type">Map</span>((<span class="hljs-string">"alice"</span> -&gt; <span class="hljs-number">90</span>), (<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">80</span>), (<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">100</span>))
    <span class="hljs-comment">// bobè¿™ä¸ªé”®æœ‰é‡å¤ï¼Œåªä¿ç•™ä¸€ä¸ª</span>
    println(map1)
    <span class="hljs-comment">// 1 æ·»åŠ </span>
    map1 += (<span class="hljs-string">"judy"</span> -&gt; <span class="hljs-number">90</span>)
    <span class="hljs-comment">// 2 åˆ é™¤</span>
    map1 -= <span class="hljs-string">"bob"</span>
    <span class="hljs-comment">// 3 æŸ¥è¯¢å…ƒç´ </span>
    <span class="hljs-keyword">val</span> key = <span class="hljs-string">"alice"</span>
    <span class="hljs-keyword">val</span> ret = map1.get(key)
    <span class="hljs-keyword">if</span> (ret.isDefined) {
      println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span> å¯¹åº”çš„å€¼æ˜¯ï¼š<span class="hljs-subst">${ret.get}</span>"</span>)
    } <span class="hljs-keyword">else</span> {
      println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span> ä¸å­˜åœ¨"</span>)
    }
    println(ret)
    <span class="hljs-comment">// 4. for å¾ªç¯è¾“å‡ºæ‰€æœ‰</span>
    <span class="hljs-keyword">for</span> ((a, b) &lt;- map1) {
      println(<span class="hljs-string">s"<span class="hljs-subst">${a}</span>, <span class="hljs-subst">${b}</span>"</span>)
    }
    map1.foreach {
      <span class="hljs-keyword">case</span> (key, value) =&gt; {
        println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span>, <span class="hljs-subst">${value}</span>"</span>)
      }
    }
  }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[26.<Set>ç”¨æ³• and <Map>ç”¨æ³•]]></title>    <link>https://juejin.cn/post/7579130291622936618</link>    <guid>https://juejin.cn/post/7579130291622936618</guid>    <pubDate>2025-12-03T03:39:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579130291622936618" data-draft-id="7579066828180013092" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="26.&lt;Set&gt;ç”¨æ³• and &lt;Map&gt;ç”¨æ³•"/> <meta itemprop="keywords" content="Scala"/> <meta itemprop="datePublished" content="2025-12-03T03:39:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆåŸºä¼Š"/> <meta itemprop="url" content="https://juejin.cn/user/1215421940773178"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            26.&lt;Set&gt;ç”¨æ³• and &lt;Map&gt;ç”¨æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1215421940773178/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆåŸºä¼Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T03:39:38.000Z" title="Wed Dec 03 2025 03:39:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">Set</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">    é›†åˆã€‚è¡¨ç¤ºæ²¡æœ‰é‡å¤å…ƒç´ çš„é›†åˆï¼Œç‰¹ç‚¹æ˜¯ï¼šå”¯ä¸€ï¼Œæ— åºã€‚
</span></code></pre>
<h6 data-id="heading-1">å¦‚æœæ”¾åœ¨setä¸­çš„å…ƒç´ æœ‰é‡å¤çš„ï¼Œå®ƒä¼šè‡ªåŠ¨å»é‡ï¼šåªä¿ç•™ä¸€ä¸ª</h6>
<pre><code class="hljs language-Scala" lang="Scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
  <span class="hljs-keyword">val</span> set1  = <span class="hljs-type">Set</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)

  println(set1)
}                   ç»“æœï¼š<span class="hljs-type">Set</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
</code></pre>
<h5 data-id="heading-2">ç†è§£  å¯å˜å’Œä¸å¯å˜</h5>
<pre><code class="hljs language-arduino" lang="arduino">    å¯å˜ï¼ˆ<span class="hljs-keyword">mutable</span>ï¼‰:å¯ä»¥ç›´æ¥æ“ä½œè¿™ä¸ªå®¹å™¨ä¸­çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼šæ·»åŠ ã€‚
    ä¸å¯å˜ï¼ˆimmutableï¼‰ï¼šä¸èƒ½ä¿®æ”¹å®¹å™¨ä¸­çš„æ•°æ®ã€‚
    é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„Setæ˜¯ä¸å¯å˜çš„ã€‚
</code></pre>
<pre><code class="hljs language-Scala" lang="Scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> set1  = scala.collection.immutable.<span class="hljs-type">Set</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)
    <span class="hljs-keyword">val</span> set2 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)
<span class="hljs-comment">// å¯å˜çš„Setå¯ä»¥ç›´æ¥ä¿®æ”¹å®ƒè‡ªå·±</span>
    set2 += <span class="hljs-number">20</span>
<span class="hljs-comment">// ä¸å¯å˜çš„setä¸èƒ½ç›´æ¥ä¿®æ”¹å®ƒè‡ªå·±</span>
<span class="hljs-comment">//    set1 += 2</span>
    println(set2)
  }
</code></pre>
<h5 data-id="heading-3">æ·»åŠ ï¼Œåˆ é™¤ï¼Œåˆ¤æ–­ï¼Œåˆå¹¶ï¼Œäº¤é›†ï¼Œå·®é›†</h5>
<pre><code class="hljs language-Scala" lang="Scala">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
<span class="hljs-comment">//    å¯å˜Set</span>
    <span class="hljs-keyword">val</span> set1 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)
<span class="hljs-comment">//    1.æ·»åŠ </span>
    set1 += <span class="hljs-number">1</span>
    set1 += <span class="hljs-number">4</span>
<span class="hljs-comment">//    2.åˆ é™¤</span>
    set1 -= <span class="hljs-number">2</span>
<span class="hljs-comment">//    3.åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨</span>
    <span class="hljs-keyword">val</span> value = <span class="hljs-number">3</span>
    <span class="hljs-keyword">if</span> (set1.contains(value)){
      println(<span class="hljs-string">s"<span class="hljs-subst">${value}</span>å­˜åœ¨"</span>)
    } <span class="hljs-keyword">else</span> {
      println(<span class="hljs-string">s"<span class="hljs-subst">${value}</span>ä¸å­˜åœ¨"</span>)
    }
<span class="hljs-comment">//    4.åˆå¹¶å¦ä¸€ä¸ªSet</span>
    <span class="hljs-keyword">val</span> set2 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-string">"è¯­æ–‡"</span>)
    <span class="hljs-keyword">val</span> set3 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-string">"æ•°å­¦"</span>,<span class="hljs-string">"è‹±è¯­"</span>)
    set2 ++= set3
    println(set2)
<span class="hljs-comment">//    5.äº¤é›†</span>
    <span class="hljs-keyword">val</span> set4 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-string">"å”±æ­Œ"</span>,<span class="hljs-string">"è·³èˆ"</span>)
    <span class="hljs-keyword">val</span> set5 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-string">"æ‰“æ¸¸æˆ"</span>,<span class="hljs-string">"æ‰“çƒ"</span>,<span class="hljs-string">"è·³èˆ"</span>)

    <span class="hljs-keyword">val</span> set6 = set4.intersect(set5)
    println(set6)
<span class="hljs-comment">//    5.å·®é›†</span>
    <span class="hljs-keyword">val</span> set7 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-string">"å”±æ­Œ"</span>,<span class="hljs-string">"è·³èˆ"</span>)
    <span class="hljs-keyword">val</span> set8 = scala.collection.mutable.<span class="hljs-type">Set</span>(<span class="hljs-string">"æ‰“æ¸¸æˆ"</span>,<span class="hljs-string">"æ‰“çƒ"</span>,<span class="hljs-string">"è·³èˆ"</span>)

    <span class="hljs-keyword">val</span> set9 = set7.diff(set8)

    println(set9)
  }
</code></pre>
<h3 data-id="heading-4">Mapæ˜ å°„</h3>
<h5 data-id="heading-5">//Map ï¼šæ˜ å°„</h5>
<pre><code class="hljs language-arduino" lang="arduino">    <span class="hljs-comment">//        é”®å€¼å¯¹,é”®ä¸èƒ½æœ‰ç›¸åŒçš„ï¼</span>
    <span class="hljs-comment">//        (key,value)</span>
</code></pre>
<pre><code class="hljs language-Scala" lang="Scala">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> map1 = <span class="hljs-type">Map</span>((<span class="hljs-string">"alice"</span> -&gt; <span class="hljs-number">90</span>),(<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">80</span>),(<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">100</span>))
<span class="hljs-comment">//    bobè¿™ä¸ªé”®æœ‰é‡å¤ï¼Œåªä¿ç•™ä¸€ä¸ª</span>
    println(map1)
  }
</code></pre>
<h5 data-id="heading-6">æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥è¯¢ï¼Œå¾ªç¯è¾“å‡ºæ‰€æœ‰</h5>
<pre><code class="hljs language-Scala" lang="Scala">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> map1 = scala.collection.mutable.<span class="hljs-type">Map</span>((<span class="hljs-string">"alice"</span> -&gt; <span class="hljs-number">90</span>),(<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">80</span>),(<span class="hljs-string">"bob"</span> -&gt; <span class="hljs-number">100</span>))
<span class="hljs-comment">//    bobè¿™ä¸ªé”®æœ‰é‡å¤ï¼Œåªä¿ç•™ä¸€ä¸ª</span>
<span class="hljs-comment">//    1.æ·»åŠ </span>
    map1 +=(<span class="hljs-string">"juddy"</span> -&gt; <span class="hljs-number">90</span>)
<span class="hljs-comment">//    2.åˆ é™¤</span>
    map1 -= <span class="hljs-string">"bob"</span>
<span class="hljs-comment">//    3.æŸ¥è¯¢å…ƒç´ </span>
    <span class="hljs-keyword">val</span> key = <span class="hljs-string">"alice111"</span>
    <span class="hljs-keyword">val</span> ret = map1.get(key)
    <span class="hljs-keyword">if</span> (ret.isDefined){
      println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span>å¯¹äºçš„å€¼æ˜¯ï¼š<span class="hljs-subst">${ret.get}</span>"</span>)
    } <span class="hljs-keyword">else</span> {
      println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span>ä¸å­˜åœ¨"</span>)
    }
<span class="hljs-comment">//    4.for å¾ªç¯è¾“å‡ºæ‰€æœ‰</span>
    <span class="hljs-keyword">for</span> ((a,b) &lt;- map1){
      println(<span class="hljs-string">s"<span class="hljs-subst">${a}</span>,<span class="hljs-subst">${b}</span>"</span>)
    }

    map1.foreach({
      <span class="hljs-keyword">case</span> (key,value) =&gt; {
        println(<span class="hljs-string">s"<span class="hljs-subst">${key}</span>,<span class="hljs-subst">${value}</span>"</span>)
      }
    })
  }
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openEuler äº‘åŸç”Ÿè¿›é˜¶ï¼šK3s è½»é‡çº§ Kubernetes é›†ç¾¤å®æˆ˜]]></title>    <link>https://juejin.cn/post/7579176524131352627</link>    <guid>https://juejin.cn/post/7579176524131352627</guid>    <pubDate>2025-12-03T04:30:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579176524131352627" data-draft-id="7579176524131336243" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openEuler äº‘åŸç”Ÿè¿›é˜¶ï¼šK3s è½»é‡çº§ Kubernetes é›†ç¾¤å®æˆ˜"/> <meta itemprop="keywords" content="æ“ä½œç³»ç»Ÿ,æœåŠ¡å™¨"/> <meta itemprop="datePublished" content="2025-12-03T04:30:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Nturmoils"/> <meta itemprop="url" content="https://juejin.cn/user/1722263248317024"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openEuler äº‘åŸç”Ÿè¿›é˜¶ï¼šK3s è½»é‡çº§ Kubernetes é›†ç¾¤å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1722263248317024/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Nturmoils
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:30:43.000Z" title="Wed Dec 03 2025 04:30:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€openEuler 22.03 LTS-SP1ï¼šä¸ºäº‘åŸç”Ÿè€Œç”Ÿ</h2>
<h3 data-id="heading-1">1.1 ä¸ºä»€ä¹ˆé€‰æ‹© openEuler 22.03 LTS-SP1</h3>
<p>å‰é¢ä¸¤ç¯‡æ–‡ç« ï¼Œæˆ‘åˆ†åˆ«ç”¨ openEuler éƒ¨ç½²äº† WordPress å’Œ Nextcloudï¼Œå¯¹è¿™ä¸ªç³»ç»Ÿæœ‰äº†ä¸å°‘è®¤è¯†ã€‚è¿™æ¬¡è¦ä¸Š K3s äº†ï¼Œå¿ƒé‡Œå…¶å®æœ‰ç‚¹æ‰“é¼“â€”â€”Kubernetes å¯¹ç³»ç»Ÿçš„è¦æ±‚å¯ä¸ä½ï¼ŒopenEuler èƒ½ä¸èƒ½æ‰›å¾—ä½ï¼Ÿ</p>
<p>æŠ±ç€è¿™ä¸ªç–‘é—®ï¼Œæˆ‘å»ç¿»äº†ä¸‹ openEuler 22.03 LTS-SP1 çš„å®˜æ–¹æ–‡æ¡£ï¼Œç»“æœå‘ç°è¿™ä¸ªç‰ˆæœ¬åœ¨äº‘åŸç”Ÿæ–¹é¢çš„èƒ½åŠ›ï¼ŒçœŸçš„è¶…å‡ºäº†æˆ‘çš„é¢„æœŸã€‚</p>
<h3 data-id="heading-2">1.2 openEuler 22.03 LTS-SP1 çš„æ ¸å¿ƒç‰¹æ€§</h3>
<p>è¿™ä¸ªç‰ˆæœ¬æ˜¯ openEuler ç¤¾åŒºåœ¨ 2023 å¹´å‘å¸ƒçš„é•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œä¸»æ‰“çš„å°±æ˜¯ç¨³å®šå’Œé«˜æ•ˆã€‚æˆ‘æŒ‘å‡ ä¸ªå’Œäº‘åŸç”Ÿç›¸å…³çš„é‡ç‚¹è¯´ä¸€ä¸‹ï¼š</p>
<ol>
<li><strong>Linux 5.10 LTS å†…æ ¸</strong></li>
</ol>
<p>è¿™ä¸ªå†…æ ¸ç‰ˆæœ¬ä¸æ˜¯éšä¾¿é€‰çš„ã€‚5.10 æ˜¯ Linux çš„é•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œé›†æˆäº†å¤§é‡é’ˆå¯¹å®¹å™¨å’Œè™šæ‹ŸåŒ–çš„ä¼˜åŒ–ï¼š</p>
<ul>
<li>cgroup v2 æ”¯æŒå®Œå–„ï¼Œèµ„æºéš”ç¦»æ›´ç²¾å‡†</li>
<li>namespace æœºåˆ¶ä¼˜åŒ–ï¼Œå®¹å™¨å¯åŠ¨æ›´å¿«</li>
<li>å†…å­˜ç®¡ç†æ”¹è¿›ï¼Œé€‚åˆé«˜å¯†åº¦å®¹å™¨éƒ¨ç½²</li>
</ul>
<p>æˆ‘ä¹‹å‰ç”¨çš„æ—¶å€™å°±æ„Ÿè§‰ Docker å®¹å™¨èµ·å¾—ç‰¹åˆ«å¿«ï¼Œç°åœ¨æƒ³æƒ³åº”è¯¥å°±æ˜¯å†…æ ¸çš„åŠŸåŠ³ã€‚</p>
<ol>
<li><strong>NestOS å®¹å™¨æ“ä½œç³»ç»Ÿ</strong></li>
</ol>
<p>è¿™ä¸ªæ˜¯ openEuler 22.03 ä¸“é—¨ä¸ºäº‘åŸç”Ÿåœºæ™¯è®¾è®¡çš„ç‰¹æ€§ã€‚å®ƒé‡‡ç”¨äº†åŒæ ¹æ–‡ä»¶ç³»ç»Ÿå’ŒåŸå­åŒ–æ›´æ–°ï¼š</p>
<ul>
<li>rpm-ostree æ”¯æŒï¼šç³»ç»Ÿæ›´æ–°åƒ Git ä¸€æ ·ï¼Œå¯ä»¥å›æ»š</li>
<li>ignition é…ç½®ï¼šå®¹å™¨åŒ–ç¯å¢ƒçš„è‡ªåŠ¨é…ç½®</li>
<li>ä¸å®¹å™¨ç¼–æ’æŠ€æœ¯æ·±åº¦é›†æˆ</li>
</ul>
<p>è™½ç„¶æˆ‘è¿™æ¬¡æ²¡ç”¨ NestOSï¼Œä½†çŸ¥é“ openEuler æœ‰è¿™ä¸ªä¸œè¥¿ï¼Œå¿ƒé‡Œå°±è¸å®å¤šäº†â€”â€”è¯´æ˜ä»–ä»¬æ˜¯çœŸçš„åœ¨é’ˆå¯¹å®¹å™¨åœºæ™¯åšä¼˜åŒ–ã€‚</p>
<ol>
<li><strong>HybridSched è™šæ‹ŸåŒ–æ··åˆè°ƒåº¦</strong></li>
</ol>
<p>è¿™ä¸ªç‰¹æ€§æŒºå‰å®³çš„ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡çš„ä¼˜å…ˆçº§è¿›è¡Œæ™ºèƒ½è°ƒåº¦ï¼š</p>
<ul>
<li>CPU å¹²æ‰°æ§åˆ¶ï¼šæ”¯æŒå¾®ç§’çº§æŠ¢å </li>
<li>ç¼“å­˜å’Œå†…å­˜å¸¦å®½æ§åˆ¶ï¼šé«˜ä¼˜å…ˆçº§ä¸šåŠ¡ä¸ä¼šè¢«ä½ä¼˜å…ˆçº§æ‹–ç´¯</li>
<li>åŠŸè€—æ§åˆ¶ï¼šåœ¨ä¿è¯æ€§èƒ½çš„åŒæ—¶é™ä½èƒ½è€—</li>
</ul>
<p>å¯¹äºè·‘ K8s è¿™ç§å¤šå®¹å™¨æ··åˆéƒ¨ç½²çš„åœºæ™¯ï¼Œè¿™ä¸ªç‰¹æ€§åº”è¯¥å¾ˆæœ‰ç”¨ã€‚</p>
<ol>
<li><strong>ç¡¬ä»¶å…¼å®¹æ€§å¼º</strong></li>
</ol>
<p>æ”¯æŒ x86 å’Œ ARM æ¶æ„ï¼Œæˆ‘è¿™å° x86 æœåŠ¡å™¨ç”¨èµ·æ¥æ²¡å•¥é—®é¢˜ã€‚è€Œä¸”å®˜æ–¹æ–‡æ¡£é‡Œè¯´ï¼Œå¯¹é²²é¹èŠ¯ç‰‡æœ‰ä¸“é—¨çš„ä¼˜åŒ–ã€‚</p>
<h3 data-id="heading-3">1.3 ä» Docker åˆ° K8s çš„æ€è€ƒ</h3>
<p>å‰ä¸¤ç¯‡æ–‡ç« ï¼Œæˆ‘ç”¨ Docker å’Œ Docker Compose éƒ¨ç½²äº†ä¸¤ä¸ªåº”ç”¨ã€‚è¿™ä¸¤ä¸ªå·¥å…·ç¡®å®å¥½ç”¨ï¼Œä½†æœ‰ä¸ªé—®é¢˜ï¼šéƒ½æ˜¯å•æœºæ–¹æ¡ˆã€‚</p>
<p>å¦‚æœæˆ‘æƒ³ï¼š</p>
<ul>
<li>åŒæ—¶è¿è¡Œåå‡ ä¸ªå®¹å™¨åº”ç”¨ï¼Œæ€ä¹ˆç»Ÿä¸€ç®¡ç†ï¼Ÿ</li>
<li>æŸä¸ªå®¹å™¨æŒ‚äº†ï¼Œèƒ½ä¸èƒ½è‡ªåŠ¨é‡å¯ï¼Ÿ</li>
<li>èƒ½ä¸èƒ½æ ¹æ®è´Ÿè½½è‡ªåŠ¨æ‰©å®¹ï¼Ÿ</li>
<li>å¤šå°æœåŠ¡å™¨ä¹‹é—´æ€ä¹ˆååŒå·¥ä½œï¼Ÿ</li>
</ul>
<p>è¿™äº›éœ€æ±‚ï¼ŒDocker Compose å°±æä¸å®šäº†ã€‚å¾—ä¸Š Kubernetesã€‚</p>
<p>ä½†æ ‡å‡†çš„ K8s å¤ªé‡äº†ï¼š</p>
<ul>
<li>å®‰è£…å¤æ‚ï¼Œç»„ä»¶ä¸€å¤§å †</li>
<li>èµ„æºå ç”¨å¤§ï¼Œå°æœåŠ¡å™¨è·‘ä¸åŠ¨</li>
<li>å­¦ä¹ æ›²çº¿é™¡å³­ï¼Œä¸Šæ‰‹å›°éš¾</li>
</ul>
<p>æ‰€ä»¥æˆ‘é€‰äº† K3sã€‚å®ƒæ˜¯ Rancher æçš„è½»é‡çº§ K8sï¼š</p>
<ul>
<li>äºŒè¿›åˆ¶æ–‡ä»¶åªæœ‰ 70MBï¼ˆæ ‡å‡† K8s å‡ ä¸ª GBï¼‰</li>
<li>å•èŠ‚ç‚¹å°±èƒ½è·‘å®Œæ•´é›†ç¾¤</li>
<li>å®Œå…¨å…¼å®¹æ ‡å‡† K8s API</li>
<li>å®‰è£…ç®€å•ï¼Œä¸€æ¡å‘½ä»¤æå®š</li>
</ul>
<p>æœ€å…³é”®çš„æ˜¯ï¼Œæˆ‘æƒ³éªŒè¯ä¸€ä¸‹ openEuler åœ¨å®¹å™¨ç¼–æ’åœºæ™¯ä¸‹çš„è¡¨ç°ã€‚</p>
<h2 data-id="heading-4">äºŒã€K3s éƒ¨ç½²å®æˆ˜</h2>
<h3 data-id="heading-5">2.1 æœåŠ¡å™¨ç¯å¢ƒ</h3>
<p>è¿˜æ˜¯é‚£å°æœåŠ¡å™¨ï¼Œé…ç½®æ²¡å˜ï¼š</p>
<ul>
<li><strong>CPU</strong>ï¼š16æ ¸ Intel Xeon Gold 6138 @ 2.00GHz</li>
<li><strong>å†…å­˜</strong>ï¼š16GB</li>
<li><strong>å­˜å‚¨</strong>ï¼š40GB SSD</li>
<li><strong>æ“ä½œç³»ç»Ÿ</strong>ï¼šopenEuler 22.03 (LTS-SP1)</li>
<li><strong>å†…æ ¸ç‰ˆæœ¬</strong>ï¼š5.10.0-136.12.0.86.oe2203sp1.x86_64</li>
</ul>
<p>è¿™å°æœåŠ¡å™¨ä¸Šå·²ç»è·‘ç€ WordPress å’Œ Nextcloud ä¸¤ä¸ª Docker åº”ç”¨äº†ã€‚K3s é»˜è®¤ç”¨ containerdï¼Œå’Œ Docker ä¸å†²çªï¼Œå¯ä»¥å…±å­˜ã€‚</p>
<h3 data-id="heading-6">2.2 å®‰è£… K3sï¼šç¬¬ä¸€æ¬¡è¸©å‘</h3>
<p>ä¸€å¼€å§‹æˆ‘æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ï¼Œç›´æ¥æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">curl -sfL https:<span class="hljs-comment">//get.k3s.io | sh -</span>
</code></pre>
<p>ç»“æœæŠ¥é”™äº†ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18ddebd6aa7344eabb96cbd6b93e2826~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=x81cAZXhW%2Fpo0yfb6qClJdSaf44%3D" alt="K3så®‰è£…æŠ¥é”™" loading="lazy"/></p>
<p>é”™è¯¯ä¿¡æ¯å¾ˆæ˜ç¡®ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">Error:</span> cannot install the best candidate <span class="hljs-keyword">for</span> the job
- <span class="hljs-literal">nothing</span> provides container-selinux &gt;= <span class="hljs-number">3</span>:<span class="hljs-number">2.191</span>.<span class="hljs-number">0</span>-<span class="hljs-number">1</span> needed <span class="hljs-keyword">by</span> k3s-selinux-<span class="hljs-number">1.6</span>-<span class="hljs-number">1</span>.el9.noarch
</code></pre>
<p>é—®é¢˜å‡ºåœ¨ SELinux ä¸Šã€‚K3s éœ€è¦ <code>container-selinux &gt;= 3:2.191.0-1</code>ï¼Œä½† openEuler 22.03 LTS-SP1 çš„è½¯ä»¶ä»“åº“é‡Œåªæœ‰æ›´è€çš„ç‰ˆæœ¬ã€‚</p>
<p>è¿™ä¸ªå‘å…¶å®æŒºå¸¸è§çš„ã€‚ä¸åŒå‘è¡Œç‰ˆçš„è½¯ä»¶åŒ…ç‰ˆæœ¬ä¸ä¸€æ ·ï¼Œç›´æ¥è£…å®¹æ˜“é‡åˆ°ä¾èµ–é—®é¢˜ã€‚</p>
<h3 data-id="heading-7">2.3 è§£å†³æ–¹æ¡ˆï¼šè·³è¿‡ SELinux</h3>
<p>å¯¹äºå­¦ä¹ å’Œæµ‹è¯•ç¯å¢ƒï¼Œå¯ä»¥è·³è¿‡ SELinux æ”¯æŒã€‚ä¿®æ”¹å®‰è£…å‘½ä»¤ï¼š</p>
<p>curl -sfL <a href="https://link.juejin.cn?target=https%3A%2F%2Fget.k3s.io" target="_blank" title="https://get.k3s.io" ref="nofollow noopener noreferrer">get.k3s.io</a> | INSTALL_K3S_SKIP_SELINUX_RPM=true sh -</p>
<p>è¿™æ¬¡å°±é¡ºåˆ©äº†ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d6006e5e7574f87ab54691f6bd0d4f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=Hg5cDgQ5x%2FWRCNqqhi3ElxHYu%2BY%3D" alt="K3så®‰è£…æˆåŠŸ" loading="lazy"/></p>
<p>å®‰è£…è¿‡ç¨‹å¾ˆå¿«ï¼Œå¤§æ¦‚ 1 åˆ†é’Ÿå°±å®Œæˆäº†ã€‚å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>ä¸‹è½½äº† K3s v1.33.5+k3s1 ç‰ˆæœ¬</li>
<li>åˆ›å»ºäº† kubectlã€crictl ç­‰å‘½ä»¤çš„è½¯é“¾æ¥</li>
<li>åˆ›å»ºäº† systemd æœåŠ¡æ–‡ä»¶</li>
<li>è‡ªåŠ¨å¯åŠ¨äº† k3s æœåŠ¡</li>
</ul>
<p>è¿™ä¸ªè¿‡ç¨‹æ¯”è£…æ ‡å‡† K8s ç®€å•å¤ªå¤šäº†ã€‚æ ‡å‡† K8s è¦è£… kubeadmã€kubeletã€kubectlï¼Œè¿˜è¦é…ç½®å®¹å™¨è¿è¡Œæ—¶ã€ç½‘ç»œæ’ä»¶ï¼ŒæŠ˜è…¾åŠå¤©ã€‚K3s ä¸€æ¡å‘½ä»¤å…¨æå®šã€‚</p>
<h3 data-id="heading-8">2.4 éªŒè¯å®‰è£…</h3>
<p>å…ˆçœ‹çœ‹æœåŠ¡çŠ¶æ€ï¼š</p>
<p>sudo systemctl status k3s</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a8f5c83515f4c2c8df3399a7808f39f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=PNZCEh5yoWNaTYiFQOdSqd6T1%2FM%3D" alt="K3sæœåŠ¡çŠ¶æ€" loading="lazy"/></p>
<p>æœåŠ¡æ˜¯ active (running)ï¼Œçœ‹èµ·æ¥æ²¡é—®é¢˜ã€‚å¯ä»¥çœ‹åˆ° K3s æ˜¯ä»¥ systemd æœåŠ¡çš„å½¢å¼è¿è¡Œçš„ï¼Œå¼€æœºä¼šè‡ªåŠ¨å¯åŠ¨ã€‚</p>
<h2 data-id="heading-9">ä¸‰ã€é…ç½® kubectl</h2>
<h3 data-id="heading-10">3.1 é…ç½® kubeconfig</h3>
<p>K3s å®‰è£…å®Œä¼šè‡ªåŠ¨åˆ›å»º kubeconfig æ–‡ä»¶ï¼Œä½†é»˜è®¤è·¯å¾„éœ€è¦ root æƒé™ã€‚ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼ŒæŠŠå®ƒå¤åˆ¶åˆ°ç”¨æˆ·ç›®å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»º .kube ç›®å½•</span>
sudo <span class="hljs-built_in">mkdir</span> -p ~/.kube
â€‹
<span class="hljs-comment"># å¤åˆ¶é…ç½®æ–‡ä»¶</span>
sudo <span class="hljs-built_in">cp</span> /etc/rancher/k3s/k3s.yaml ~/.kube/config
â€‹
<span class="hljs-comment"># ä¿®æ”¹æƒé™</span>
sudo <span class="hljs-built_in">chown</span> <span class="hljs-variable">$USER</span>:<span class="hljs-variable">$USER</span> ~/.kube/config
</code></pre>
<h3 data-id="heading-11">3.2 éªŒè¯é›†ç¾¤çŠ¶æ€</h3>
<p>é…ç½®å¥½åï¼Œç”¨ kubectl çœ‹çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">kubectl version
kubectl get nodes
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6da69dba2f6495fb7ec6f5a17540484~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=dhPW5iyE00YegXHj3br8I%2FNLGgk%3D" alt="kubectlé…ç½®å’ŒèŠ‚ç‚¹çŠ¶æ€" loading="lazy"/></p>
<p>è¾“å‡ºæ˜¾ç¤ºï¼š</p>
<ul>
<li>Client ç‰ˆæœ¬ï¼šv1.33.5+k3s1</li>
<li>Server ç‰ˆæœ¬ï¼šv1.33.5+k3s1</li>
<li>èŠ‚ç‚¹çŠ¶æ€ï¼šReady</li>
</ul>
<p>èŠ‚ç‚¹åç§°æ˜¯ <code>ser563963324474</code>ï¼ˆæˆ‘çš„æœåŠ¡å™¨ä¸»æœºåï¼‰ï¼Œè§’è‰²æ˜¯ <code>control-plane,master</code>ã€‚è¿™è¯´æ˜è¿™æ˜¯ä¸€ä¸ªå•èŠ‚ç‚¹é›†ç¾¤ï¼Œæ—¢æ˜¯æ§åˆ¶å¹³é¢ï¼Œä¹Ÿæ˜¯å·¥ä½œèŠ‚ç‚¹ã€‚</p>
<h3 data-id="heading-12">3.3 æŸ¥çœ‹ç³»ç»Ÿç»„ä»¶</h3>
<p>K8s é›†ç¾¤å¯åŠ¨åï¼Œä¼šåœ¨ <code>kube-system</code> å‘½åç©ºé—´è¿è¡Œä¸€äº›ç³»ç»Ÿç»„ä»¶ã€‚çœ‹çœ‹éƒ½æœ‰å•¥ï¼š</p>
<p>kubectl get pods -A</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a179cb8486144c53ada1a905e9c6ffac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=QZWXhSJM6%2FhN9%2FS86KmvTdDUd9M%3D" alt="ç³»ç»ŸPodsè¿è¡ŒçŠ¶æ€" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°è¿™äº›ç»„ä»¶éƒ½åœ¨è¿è¡Œï¼š</p>
<ul>
<li><strong>coredns</strong>ï¼šDNS æœåŠ¡ï¼Œè´Ÿè´£é›†ç¾¤å†…çš„åŸŸåè§£æ</li>
<li><strong>metrics-server</strong>ï¼šèµ„æºç›‘æ§ï¼Œæä¾› <code>kubectl top</code> å‘½ä»¤çš„æ•°æ®</li>
<li><strong>local-path-provisioner</strong>ï¼šæœ¬åœ°å­˜å‚¨ï¼Œä¸º Pod æä¾›æŒä¹…åŒ–å­˜å‚¨</li>
<li><strong>traefik</strong>ï¼šIngress æ§åˆ¶å™¨ï¼Œè´Ÿè´£å¤–éƒ¨æµé‡è·¯ç”±</li>
<li><strong>svclb-traefik</strong>ï¼šTraefik çš„è´Ÿè½½å‡è¡¡å™¨</li>
</ul>
<p>è¿™äº›éƒ½æ˜¯ K3s å†…ç½®çš„ã€‚æ ‡å‡† K8s éœ€è¦è‡ªå·±è£…ï¼ŒK3s ç›´æ¥ç»™ä½ é…å¥½äº†ï¼Œçœäº†ä¸å°‘äº‹ã€‚</p>
<p>å†ç”¨ <code>kubectl describe node</code> çœ‹çœ‹èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤š K8s çš„æ ‡ç­¾å’Œæ³¨è§£ï¼Œå†…éƒ¨ IP æ˜¯ <code>10.1.226.3</code>ï¼ŒK3s è¿˜é…ç½®äº† flannel ç½‘ç»œæ’ä»¶ï¼ˆvxlan æ¨¡å¼ï¼‰ã€‚</p>
<h2 data-id="heading-13">å››ã€éƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨</h2>
<h3 data-id="heading-14">4.1 åˆ›å»º Deployment</h3>
<p>ç†è®ºè®²å®Œäº†ï¼Œæ¥ç‚¹å®é™…çš„ã€‚éƒ¨ç½²ä¸€ä¸ª Nginx æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<p>kubectl create deployment nginx-test --image=nginx:alpine</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55dca412d4fb4ec1a30ab9bdae5e1e4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=sT5G1bzNWuYY7U6iHCAcs6fPiSQ%3D" alt="åˆ›å»ºDeployment" loading="lazy"/></p>
<p>å‘½ä»¤æ‰§è¡Œåï¼ŒK8s ä¼šï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª Deployment å¯¹è±¡</li>
<li>Deployment åˆ›å»ºä¸€ä¸ª ReplicaSet</li>
<li>ReplicaSet åˆ›å»ºä¸€ä¸ª Pod</li>
<li>Pod é‡Œè¿è¡Œ nginx:alpine å®¹å™¨</li>
</ol>
<p>ç­‰å‡ ç§’é’Ÿï¼ŒPod å°±ä» <code>ContainerCreating</code> å˜æˆ <code>Running</code> äº†ã€‚ç”¨ <code>kubectl get deployments</code> å’Œ <code>kubectl get pods</code> å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>Deployment çŠ¶æ€æ˜¯ 1/1ï¼ˆæœŸæœ›1ä¸ªï¼Œå®é™…1ä¸ªï¼‰</li>
<li>Pod çŠ¶æ€æ˜¯ Running</li>
</ul>
<p>è¿™ä¸ªè¿‡ç¨‹æ¯” Docker æ…¢ä¸€ç‚¹ï¼Œå› ä¸ºå¤šäº†ä¸€å±‚ç¼–æ’ã€‚ä½†å¥½å¤„æ˜¯ï¼Œå¦‚æœè¿™ä¸ª Pod æŒ‚äº†ï¼ŒK8s ä¼šè‡ªåŠ¨é‡å¯ï¼›å¦‚æœéœ€è¦å¤šä¸ªå‰¯æœ¬ï¼Œæ”¹ä¸ªæ•°å­—å°±è¡Œã€‚</p>
<h3 data-id="heading-15">4.2 æš´éœ²æœåŠ¡</h3>
<p>Pod åˆ›å»ºå¥½äº†ï¼Œä½†å¤–éƒ¨è¿˜è®¿é—®ä¸äº†ã€‚éœ€è¦åˆ›å»ºä¸€ä¸ª Serviceï¼š</p>
<p>kubectl expose deployment nginx-test --port=80 --type=NodePort</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1019ea4151543f5a23120f308274c64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=G%2BzSdywN9TWWqVY7tJyAZPIWPXo%3D" alt="æš´éœ²Service" loading="lazy"/></p>
<p>Service åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>ç±»å‹æ˜¯ NodePort</li>
<li>å†…éƒ¨ IP æ˜¯ <code>10.43.240.192</code></li>
<li>ç«¯å£æ˜ å°„æ˜¯ <code>80:32245/TCP</code></li>
</ul>
<p>è¿™é‡Œçš„ <code>32245</code> æ˜¯ K8s è‡ªåŠ¨åˆ†é…çš„ NodePortï¼ˆèŒƒå›´æ˜¯ 30000-32767ï¼‰ã€‚åªè¦è®¿é—®æœåŠ¡å™¨çš„ <code>&lt;IP&gt;:80</code> å°±èƒ½è®¿é—®åˆ° Nginx äº†ã€‚</p>
<h3 data-id="heading-16">4.3 è®¿é—®æµ‹è¯•</h3>
<p>åœ¨æµè§ˆå™¨é‡Œè®¿é—® <code>http://&lt;æœåŠ¡å™¨IP&gt;:80</code>ï¼š</p>
<p>æˆåŠŸäº†ï¼çœ‹åˆ°äº† Nginx çš„æ¬¢è¿é¡µé¢ã€‚è¿™è¯´æ˜æ•´ä¸ªé“¾è·¯éƒ½é€šäº†ï¼š</p>
<ul>
<li>æµè§ˆå™¨ â†’ æœåŠ¡å™¨ IP:32245</li>
<li>NodePort Service â†’ ClusterIP 10.43.240.192:80</li>
<li>ClusterIP â†’ Pod IP 10.42.0.9:80</li>
<li>Pod â†’ nginx å®¹å™¨</li>
</ul>
<p>K8s çš„ç½‘ç»œæ¨¡å‹ç¡®å®å¤æ‚ï¼Œä½†ä¹Ÿå¾ˆå¼ºå¤§ã€‚</p>
<h3 data-id="heading-17">4.4 æŸ¥çœ‹ Pod è¯¦æƒ…</h3>
<p>ç”¨ <code>kubectl describe pod</code> çœ‹çœ‹ Pod çš„è¯¦ç»†ä¿¡æ¯ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9042f75f614f48e795a463987534087c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=9gRjqhTS6nM64jO6xKyzyVufilg%3D" alt="Podè¯¦ç»†ä¿¡æ¯" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>Pod åç§°ï¼šnginx-test-69fbd4bd85-lnmbj</li>
<li>å‘½åç©ºé—´ï¼šdefault</li>
<li>èŠ‚ç‚¹ï¼šser563963324474</li>
<li>Pod IPï¼š10.42.0.9</li>
<li>å®¹å™¨ IDï¼šcontainerd://a0714eb5e9db62ed...</li>
<li>é•œåƒï¼šnginx:alpine</li>
<li>é•œåƒ IDï¼šdocker.io/library/nginx@sha256:b3c656d55d7ad751...</li>
<li>çŠ¶æ€ï¼šRunning</li>
</ul>
<p>Events éƒ¨åˆ†ï¼ˆè™½ç„¶æˆªå›¾æˆªä¸å®Œï¼‰ä¼šæ˜¾ç¤º Pod çš„å¯åŠ¨è¿‡ç¨‹ï¼Œæ¯”å¦‚è°ƒåº¦åˆ°å“ªä¸ªèŠ‚ç‚¹ã€æ‹‰å–é•œåƒã€å¯åŠ¨å®¹å™¨ç­‰ã€‚è¿™å¯¹æ’æŸ¥é—®é¢˜å¾ˆæœ‰ç”¨ã€‚</p>
<h2 data-id="heading-18">äº”ã€K3s on openEuler çš„æ€§èƒ½è¡¨ç°</h2>
<h3 data-id="heading-19">5.1 èµ„æºå ç”¨åˆ†æ</h3>
<p>éƒ¨ç½²å®Œåº”ç”¨ï¼Œæœ€å…³å¿ƒçš„å°±æ˜¯èµ„æºå ç”¨ã€‚çœ‹çœ‹ K3s åƒäº†å¤šå°‘å†…å­˜ï¼š</p>
<pre><code class="hljs language-css" lang="css">ps aux | grep k3s | head -<span class="hljs-number">5</span>
kubectl <span class="hljs-attribute">top</span> pods -<span class="hljs-selector-tag">A</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec1e1fe1aeef4637b08e6c3691777a82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765341043&amp;x-signature=on5yscOiU%2FfdVTSfC1ApR5ZQFxI%3D" alt="èµ„æºå ç”¨æƒ…å†µ" loading="lazy"/></p>
<p>ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼š</p>
<p><strong>K3s ä¸»è¿›ç¨‹</strong>ï¼š</p>
<ul>
<li>CPUï¼š97.9%ï¼ˆè¿™ä¸ªæ˜¯å¯åŠ¨æ—¶çš„ç¬æ—¶å€¼ï¼Œå®é™…è¿è¡Œæ—¶å¾ˆä½ï¼‰</li>
<li>å†…å­˜ï¼š603MBï¼ˆçº¦ 590MBï¼‰</li>
</ul>
<p><strong>å„ Pod çš„èµ„æºå ç”¨</strong>ï¼š</p>
<ul>
<li>nginx-testï¼šCPU 0mï¼Œå†…å­˜ 10MB</li>
<li>corednsï¼šCPU 5mï¼Œå†…å­˜ 18MB</li>
<li>local-path-provisionerï¼šCPU 1mï¼Œå†…å­˜ 12MB</li>
<li>metrics-serverï¼šCPU 6mï¼Œå†…å­˜ 22MB</li>
<li>traefikï¼šCPU 1mï¼Œå†…å­˜ 44MB</li>
</ul>
<p>åŠ èµ·æ¥ï¼Œæ•´ä¸ª K3s é›†ç¾¤ï¼ˆåŒ…æ‹¬æ‰€æœ‰ç³»ç»Ÿç»„ä»¶ï¼‰å¤§æ¦‚å ç”¨ 700MB å†…å­˜å·¦å³ã€‚</p>
<p>å¯¹æ¯”ä¸€ä¸‹æ ‡å‡† K8sï¼Œæ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆapiserverã€controller-managerã€schedulerã€etcdï¼‰å°±è¦åƒæ‰ 1.5GB+ã€‚K3s çš„èµ„æºå ç”¨ç¡®å®ä½å¾ˆå¤šã€‚</p>
<p>æˆ‘è¿™å° 16GB å†…å­˜çš„æœåŠ¡å™¨ï¼Œè·‘ K3s + å‡ ä¸ªåº”ç”¨å®Œå…¨æ²¡å‹åŠ›ã€‚</p>
<h3 data-id="heading-20">5.2 openEuler çš„ä¼˜åŠ¿ä½“ç°</h3>
<p>ç”¨äº†å‡ ä¸ªå°æ—¶ K3sï¼Œæˆ‘å¯¹ openEuler åœ¨äº‘åŸç”Ÿåœºæ™¯çš„è¡¨ç°æœ‰äº†æ›´æ·±çš„æ„Ÿå—ã€‚</p>
<ol>
<li><strong>ç¨³å®šæ€§ä¸€æµ</strong></li>
</ol>
<p>ä»å®‰è£…åˆ°éƒ¨ç½²åº”ç”¨ï¼Œæ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰ä»»ä½•æŠ¥é”™ï¼ˆé™¤äº†ä¸€å¼€å§‹çš„ SELinux ä¾èµ–ï¼Œé‚£ä¸ªä¸ç®—ç³»ç»Ÿçš„é—®é¢˜ï¼‰ã€‚Pod å¯åŠ¨å¾ˆå¿«ï¼Œæ²¡æœ‰å‡ºç°è¿‡ Pending æˆ– CrashLoopBackOff çš„æƒ…å†µã€‚</p>
<p>K3s çš„ä¸»è¿›ç¨‹è¿è¡Œäº†å‡ ä¸ªå°æ—¶ï¼Œå†…å­˜å ç”¨ä¸€ç›´å¾ˆç¨³å®šï¼Œæ²¡æœ‰å‡ºç°å†…å­˜æ³„æ¼æˆ– CPU é£™é«˜çš„æƒ…å†µã€‚</p>
<ol>
<li><strong>å†…æ ¸è°ƒåº¦ä¼˜åŒ–</strong></li>
</ol>
<p>5.10 å†…æ ¸åœ¨å®¹å™¨åœºæ™¯ä¸‹çš„è¡¨ç°ç¡®å®ä¸é”™ã€‚Pod çš„å¯åŠ¨é€Ÿåº¦å¾ˆå¿«ï¼Œä» <code>ContainerCreating</code> åˆ° <code>Running</code> åªéœ€è¦å‡ ç§’é’Ÿã€‚</p>
<p>æˆ‘ä¹‹å‰åœ¨ CentOS 7ï¼ˆ3.10 å†…æ ¸ï¼‰ä¸Šè¯•è¿‡ K8sï¼ŒPod å¯åŠ¨æ˜æ˜¾è¦æ…¢ä¸€äº›ã€‚openEuler çš„ 5.10 å†…æ ¸ï¼Œåº”è¯¥æ˜¯åšäº†ä¸å°‘é’ˆå¯¹ cgroup å’Œ namespace çš„ä¼˜åŒ–ã€‚</p>
<ol>
<li><strong>èµ„æºç®¡ç†æ•ˆç‡é«˜</strong></li>
</ol>
<p>ç³»ç»Ÿæœ¬èº«å ç”¨çš„èµ„æºå¾ˆå°‘ã€‚æˆ‘ç”¨ <code>free -h</code> çœ‹äº†ä¸‹ï¼Œæ•´ä¸ªç³»ç»Ÿï¼ˆåŒ…æ‹¬ K3sã€WordPressã€Nextcloudï¼‰åªç”¨äº† 4GB å·¦å³å†…å­˜ï¼Œè¿˜æœ‰ 12GB å¯ç”¨ã€‚</p>
<p>è¿™è¯´æ˜ openEuler åœ¨èµ„æºè°ƒåº¦ä¸Šç¡®å®æœ‰ä¼˜åŠ¿ã€‚åŒæ ·çš„ç¡¬ä»¶ï¼Œèƒ½è·‘æ›´å¤šçš„å®¹å™¨ã€‚</p>
<ol>
<li><strong>å®¹å™¨ç”Ÿæ€å®Œå–„</strong></li>
</ol>
<p>K3s ç”¨çš„æ˜¯ containerd ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼Œå’Œ openEuler çš„é›†æˆæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚é•œåƒæ‹‰å–ã€å®¹å™¨å¯åŠ¨ã€ç½‘ç»œé…ç½®ï¼Œéƒ½å¾ˆæµç•…ã€‚</p>
<p>è€Œä¸” openEuler çš„è½¯ä»¶ä»“åº“é‡Œï¼ŒDockerã€containerdã€runc è¿™äº›å®¹å™¨ç›¸å…³çš„åŒ…éƒ½æœ‰ï¼Œç‰ˆæœ¬ä¹Ÿæ¯”è¾ƒæ–°ã€‚ä¸ç”¨æ‹…å¿ƒå…¼å®¹æ€§é—®é¢˜ã€‚</p>
<h3 data-id="heading-21">5.3 ä¸å…¶ä»–å‘è¡Œç‰ˆå¯¹æ¯”</h3>
<p>æˆ‘ä¹‹å‰åœ¨ Ubuntu 20.04 ä¸Šä¹Ÿéƒ¨ç½²è¿‡ K3sï¼Œå¯¹æ¯”ä¸€ä¸‹ï¼š</p>
<p><strong>Ubuntu 20.04</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šè½¯ä»¶åŒ…æ–°ï¼Œç¤¾åŒºèµ„æ–™å¤š</li>
<li>ç¼ºç‚¹ï¼šapt æºåœ¨å›½å†…æ…¢ï¼Œç³»ç»Ÿå ç”¨å†…å­˜ç¨å¤šï¼ˆ1GB+ï¼‰</li>
</ul>
<p><strong>openEuler 22.03 LTS-SP1</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šç³»ç»Ÿå ç”¨å°‘ï¼Œæ€§èƒ½å¥½ï¼Œdnf æºå¿«</li>
<li>ç¼ºç‚¹ï¼šç¤¾åŒºèµ„æ–™ç›¸å¯¹å°‘ä¸€äº›ï¼ˆä½†åœ¨å¿«é€Ÿå¢é•¿ï¼‰</li>
</ul>
<h2 data-id="heading-22">å…­ã€ä» Docker åˆ° K3s çš„æ„Ÿæ‚Ÿ</h2>
<h3 data-id="heading-23">6.1 æŠ€æœ¯è¿›é˜¶çš„æ”¶è·</h3>
<p>è¿™æ¬¡ä» Docker Compose è·¨åˆ° K3sï¼Œå­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ã€‚</p>
<p><strong>Deploymentã€ReplicaSetã€Pod çš„å…³ç³»</strong>ï¼š</p>
<ul>
<li>Deployment æ˜¯å£°æ˜å¼çš„éƒ¨ç½²é…ç½®</li>
<li>ReplicaSet è´Ÿè´£ç»´æŠ¤ Pod çš„å‰¯æœ¬æ•°é‡</li>
<li>Pod æ˜¯å®é™…è¿è¡Œå®¹å™¨çš„åœ°æ–¹</li>
</ul>
<p>è¿™ç§åˆ†å±‚è®¾è®¡ï¼Œæ¯” Docker Compose çµæ´»å¤šäº†ã€‚æƒ³è¦æ‰©å®¹ï¼Ÿæ”¹ Deployment çš„ replicas å°±è¡Œã€‚æƒ³è¦æ»šåŠ¨æ›´æ–°ï¼ŸDeployment è‡ªåŠ¨å¸®ä½ æå®šã€‚</p>
<p><strong>Service çš„ç½‘ç»œæ¨¡å‹</strong>ï¼š</p>
<ul>
<li>ClusterIPï¼šé›†ç¾¤å†…éƒ¨è®¿é—®</li>
<li>NodePortï¼šä»èŠ‚ç‚¹ç«¯å£è®¿é—®</li>
<li>LoadBalancerï¼šäº‘å¹³å°çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆæœ¬åœ°ç¯å¢ƒç”¨ä¸äº†ï¼‰</li>
</ul>
<p>è¿™å¥—ç½‘ç»œæ¨¡å‹è™½ç„¶å¤æ‚ï¼Œä½†å¾ˆå¼ºå¤§ã€‚å¤šä¸ªæœåŠ¡ä¹‹é—´çš„é€šä¿¡ï¼Œé€šè¿‡ Service åç§°å°±èƒ½äº’ç›¸è®¿é—®ï¼Œä¸ç”¨ç®¡ IP åœ°å€ã€‚</p>
<p><strong>å£°æ˜å¼é…ç½®çš„é­…åŠ›</strong>ï¼š</p>
<p>K8s çš„æ ¸å¿ƒç†å¿µæ˜¯"å£°æ˜å¼"ã€‚æˆ‘å‘Šè¯‰ K8s æˆ‘æƒ³è¦ä»€ä¹ˆçŠ¶æ€ï¼ŒK8s è´Ÿè´£æŠŠå®é™…çŠ¶æ€è°ƒæ•´åˆ°æœŸæœ›çŠ¶æ€ã€‚</p>
<p>æ¯”å¦‚æˆ‘å£°æ˜ Deployment çš„ replicas æ˜¯ 3ï¼ŒK8s å°±ä¼šç¡®ä¿å§‹ç»ˆæœ‰ 3 ä¸ª Pod åœ¨è¿è¡Œã€‚æœ‰ Pod æŒ‚äº†ï¼Ÿè‡ªåŠ¨é‡å¯ã€‚èŠ‚ç‚¹æŒ‚äº†ï¼Ÿè‡ªåŠ¨åœ¨å…¶ä»–èŠ‚ç‚¹å¯åŠ¨ã€‚</p>
<p>è¿™ç§æ€è·¯å’Œ Docker çš„"å‘½ä»¤å¼"å®Œå…¨ä¸åŒã€‚Docker æ˜¯ä½ å‘Šè¯‰å®ƒåšä»€ä¹ˆï¼Œå®ƒå°±åšä»€ä¹ˆã€‚K8s æ˜¯ä½ å‘Šè¯‰å®ƒè¦ä»€ä¹ˆï¼Œå®ƒè‡ªå·±æƒ³åŠæ³•ã€‚</p>
<h3 data-id="heading-24">6.2 openEuler çš„äº‘åŸç”Ÿèƒ½åŠ›</h3>
<p>é€šè¿‡è¿™æ¬¡å®æˆ˜ï¼Œæˆ‘å¯¹ openEuler 22.03 LTS-SP1 åœ¨äº‘åŸç”Ÿåœºæ™¯çš„èƒ½åŠ›æœ‰äº†æ›´å…¨é¢çš„è®¤è¯†ã€‚</p>
<p><strong>å†…æ ¸ä¼˜åŒ–æ˜¯åŸºç¡€</strong>ï¼š</p>
<p>5.10 LTS å†…æ ¸ç¡®å®å¾ˆç¨³ã€‚å®¹å™¨å¯åŠ¨å¿«ã€è°ƒåº¦å‡†ã€èµ„æºéš”ç¦»å¥½ã€‚</p>
<p><strong>NestOS æ˜¯äº®ç‚¹</strong>ï¼š</p>
<p>è™½ç„¶è¿™æ¬¡æ²¡ç”¨ NestOSï¼Œä½†çŸ¥é“ openEuler æœ‰ä¸“é—¨ä¸ºå®¹å™¨è®¾è®¡çš„æ“ä½œç³»ç»Ÿï¼Œè¯´æ˜ç¤¾åŒºåœ¨äº‘åŸç”Ÿæ–¹å‘æ˜¯è®¤çœŸçš„ã€‚ä»¥åæœ‰æœºä¼šä¸€å®šè¦è¯•è¯• NestOS + K3s çš„ç»„åˆã€‚</p>
<p><strong>ç”Ÿæ€åœ¨å®Œå–„</strong>ï¼š</p>
<p>openEuler çš„è½¯ä»¶åŒ…ç”Ÿæ€è¶Šæ¥è¶Šå¥½äº†ã€‚K3sã€Dockerã€containerd è¿™äº›å®¹å™¨ç›¸å…³çš„è½¯ä»¶éƒ½èƒ½é¡ºåˆ©å®‰è£…ã€‚ç¤¾åŒºæ–‡æ¡£ä¹Ÿåœ¨ä¸æ–­å®Œå–„ï¼Œé‡åˆ°é—®é¢˜èƒ½æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-25">ä¸ƒã€æ€»ç»“</h2>
<p>è¿™æ¬¡ä» Docker Compose è·¨åˆ° K3sï¼Œç®—æ˜¯åœ¨äº‘åŸç”Ÿçš„è·¯ä¸Šåˆè¿›äº†ä¸€æ­¥ã€‚K3s çš„è½»é‡å’Œæ˜“ç”¨ï¼Œè®©æˆ‘æ²¡æœ‰ä»€ä¹ˆå¿ƒç†è´Ÿæ‹…å°±ä¸Šæ‰‹äº† K8sã€‚</p>
<p>openEuler 22.03 LTS-SP1 åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­çš„è¡¨ç°ï¼Œè¶…å‡ºäº†æˆ‘çš„é¢„æœŸã€‚å†…æ ¸ç¨³å®šã€èµ„æºå ç”¨ä½ã€å®¹å™¨ç”Ÿæ€å®Œå–„ï¼Œè¿™äº›ä¼˜åŠ¿åœ¨ K3s åœºæ™¯ä¸‹ä½“ç°å¾—å¾ˆæ˜æ˜¾ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªä» CentOSã€Ubuntu è½¬åˆ° openEuler çš„ç”¨æˆ·ï¼Œæˆ‘è¶Šæ¥è¶Šè§‰å¾—ï¼šopenEuler ä¸ä»…ä»…æ˜¯"èƒ½ç”¨"ï¼Œè€Œæ˜¯"å¥½ç”¨"ã€‚ç‰¹åˆ«æ˜¯åœ¨äº‘åŸç”Ÿåœºæ™¯ï¼ŒopenEuler å·²ç»æ˜¯ä¸€ä¸ªå¾ˆæˆç†Ÿçš„é€‰æ‹©äº†ã€‚</p>
<p><strong>ç›¸å…³èµ„æº</strong>ï¼š</p>
<ul>
<li>openEuler å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openeuler.org%2F" target="_blank" title="https://www.openeuler.org/" ref="nofollow noopener noreferrer">www.openEuler.org/</a></li>
<li>openEuler æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openeuler.openatom.cn%2Fzh%2F" target="_blank" title="https://docs.openeuler.openatom.cn/zh/" ref="nofollow noopener noreferrer">docs.openEuler.openatom.cn/zh/</a></li>
<li>K3s å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fk3s.io%2F" target="_blank" title="https://k3s.io/" ref="nofollow noopener noreferrer">k3s.io/</a></li>
<li>K3s ä¸­æ–‡æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.rancher.cn%2Fk3s%2F" target="_blank" title="https://docs.rancher.cn/k3s/" ref="nofollow noopener noreferrer">docs.rancher.cn/k3s/</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openEuler äº‘åŸç”Ÿå®æˆ˜ï¼šä½¿ç”¨ Docker Compose å¿«é€Ÿéƒ¨ç½²ä¼ä¸šåº”ç”¨]]></title>    <link>https://juejin.cn/post/7579215538271256586</link>    <guid>https://juejin.cn/post/7579215538271256586</guid>    <pubDate>2025-12-03T04:28:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579215538271256586" data-draft-id="7579164768063848475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openEuler äº‘åŸç”Ÿå®æˆ˜ï¼šä½¿ç”¨ Docker Compose å¿«é€Ÿéƒ¨ç½²ä¼ä¸šåº”ç”¨"/> <meta itemprop="keywords" content="æœåŠ¡å™¨,æ“ä½œç³»ç»Ÿ"/> <meta itemprop="datePublished" content="2025-12-03T04:28:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Nturmoils"/> <meta itemprop="url" content="https://juejin.cn/user/1722263248317024"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openEuler äº‘åŸç”Ÿå®æˆ˜ï¼šä½¿ç”¨ Docker Compose å¿«é€Ÿéƒ¨ç½²ä¼ä¸šåº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1722263248317024/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Nturmoils
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:28:52.000Z" title="Wed Dec 03 2025 04:28:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€openEulerï¼šæ“ä½œç³»ç»Ÿçš„äº‘åŸç”Ÿä¹‹é€‰</h2>
<p>æœ€è¿‘åœ¨ç ”ç©¶äº‘åŸç”ŸæŠ€æœ¯ï¼Œæ­£å¥½çœ‹åˆ° openEuler è¿™ä¸ªæ“ä½œç³»ç»Ÿåœ¨ç¤¾åŒºé‡Œè®¨è®ºæŒºå¤šçš„ã€‚openEuler æ˜¯ç”±åä¸ºä¸»å¯¼çš„å¼€æºæ“ä½œç³»ç»Ÿé¡¹ç›®ï¼Œé¢å‘ä¼ä¸šçº§æœåŠ¡å™¨ã€äº‘è®¡ç®—ã€è¾¹ç¼˜è®¡ç®—ç­‰åœºæ™¯è®¾è®¡ã€‚ä½œä¸ºå¼€æ”¾åŸå­å¼€æºåŸºé‡‘ä¼šçš„å­µåŒ–é¡¹ç›®ï¼ŒopenEuler å·²ç»åœ¨é‡‘èã€ç”µä¿¡ã€èƒ½æºç­‰å¤šä¸ªè¡Œä¸šå¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</p>
<p>æˆ‘é€‰æ‹© openEuler æ¥åšäº‘åŸç”Ÿå®æˆ˜ï¼Œä¸»è¦æ˜¯çœ‹ä¸­äº†è¿™å‡ ç‚¹ï¼š</p>
<ul>
<li><strong>ç¨³å®šå¯é </strong>ï¼šä¼ä¸šçº§å†…æ ¸ä¼˜åŒ–ï¼Œç”Ÿäº§ç¯å¢ƒå¯ç”¨</li>
<li><strong>ç”Ÿæ€å®Œå–„</strong>ï¼šæ”¯æŒä¸»æµå¼€å‘å·¥å…·å’Œå®¹å™¨æŠ€æœ¯</li>
<li><strong>ç¤¾åŒºæ´»è·ƒ</strong>ï¼šæ–‡æ¡£é½å…¨ï¼Œé—®é¢˜èƒ½å¿«é€Ÿæ‰¾åˆ°è§£å†³æ–¹æ¡ˆ</li>
</ul>
<p><strong>ç›¸å…³èµ„æº</strong>ï¼š</p>
<ul>
<li>openEuler å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openeuler.org%2F" target="_blank" title="https://www.openeuler.org/" ref="nofollow noopener noreferrer">www.openEuler.org/</a></li>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openeuler.openatom.cn%2Fzh%2F" target="_blank" title="https://docs.openeuler.openatom.cn/zh/" ref="nofollow noopener noreferrer">docs.openEuler.openatom.cn/zh/</a></li>
<li>å¼€æºç¤¾åŒºï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fopeneuler" target="_blank" title="https://gitee.com/openeuler" ref="nofollow noopener noreferrer">gitee.com/openEuler</a></li>
</ul>
<p>è¿™æ¬¡å®æˆ˜æˆ‘æ‰“ç®—åœ¨ openEuler ä¸Šæ­å»ºä¸€å¥—å®¹å™¨åŒ–çš„åº”ç”¨ç¯å¢ƒï¼Œä½¿ç”¨ Docker Compose éƒ¨ç½²ä¸€ä¸ªå®Œæ•´çš„ WordPress åšå®¢ç³»ç»Ÿï¼ˆåŒ…å« Web æœåŠ¡å’Œæ•°æ®åº“ï¼‰ã€‚æ•´ä¸ªè¿‡ç¨‹æˆ‘ä¼šè®°å½•æ¯ä¸€æ­¥æ“ä½œï¼Œåˆ†äº«ä¸€äº›è¸©è¿‡çš„å‘å’Œè§£å†³æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-1">äºŒã€ç¯å¢ƒå‡†å¤‡ï¼šé€‰æ‹©å’Œé…ç½®æœåŠ¡å™¨</h2>
<h3 data-id="heading-2">2.1 æœåŠ¡å™¨é…ç½®</h3>
<p>è¿™æ¬¡å®æˆ˜æˆ‘å‡†å¤‡äº†ä¸€å°äº‘æœåŠ¡å™¨ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>CPU</strong>ï¼š16æ ¸</li>
<li><strong>å†…å­˜</strong>ï¼š16GB</li>
<li><strong>å­˜å‚¨</strong>ï¼š40GB SSD</li>
<li><strong>æ“ä½œç³»ç»Ÿ</strong>ï¼šopenEuler 22.03 (LTS-SP1)</li>
</ul>
<h4 data-id="heading-3">å®‰è£… openEuler ç³»ç»Ÿ</h4>
<p>é¦–å…ˆéœ€è¦åœ¨äº‘æœåŠ¡å™¨ä¸Šå®‰è£… openEuler æ“ä½œç³»ç»Ÿã€‚åœ¨æ§åˆ¶å°åˆ›å»ºæœåŠ¡å™¨æ—¶ï¼Œé€‰æ‹© openEuler é•œåƒï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å®Œæˆå®‰è£…ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14bcd68a61ad4c1080d3e9da0238bc70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=LuhEkLBAcybT%2FjYb0lukaIRtKPc%3D" alt="" loading="lazy"/></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ openEuler 22.03 (LTS-SP1) ç‰ˆæœ¬è¿›è¡Œç³»ç»Ÿå®‰è£…ã€‚æ•´ä¸ªå®‰è£…è¿‡ç¨‹æ˜¯è‡ªåŠ¨åŒ–çš„ï¼Œéå¸¸æ–¹ä¾¿ã€‚LTS-SP1 æ˜¯é•¿æœŸæ”¯æŒç‰ˆæœ¬çš„ç¬¬ä¸€ä¸ªæœåŠ¡åŒ…ï¼ˆService Pack 1ï¼‰ï¼Œæä¾›äº†æ›´å¤šçš„ç¨³å®šæ€§æ›´æ–°å’Œbugä¿®å¤ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒé•¿æœŸä½¿ç”¨ã€‚</p>
<p>æœåŠ¡å™¨åˆ›å»ºè¿‡ç¨‹å¾ˆç®€å•ï¼Œé…ç½®å¥½è§„æ ¼å’Œç½‘ç»œåï¼Œå¤§æ¦‚ç­‰äº†å‡ åˆ†é’Ÿç³»ç»Ÿå°±å®‰è£…å¥½äº†ã€‚åˆ›å»ºå®Œæˆåï¼Œæˆ‘ç”¨ SSH å¯†é’¥ç™»å½•åˆ°æœåŠ¡å™¨ï¼Œå¼€å§‹åç»­çš„é…ç½®å·¥ä½œã€‚</p>
<h4 data-id="heading-4">æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</h4>
<p>ç™»å½•æœåŠ¡å™¨åï¼Œå…ˆç¡®è®¤ä¸€ä¸‹ç³»ç»Ÿæ˜¯å¦æ­£ç¡®å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</span>
<span class="hljs-built_in">cat</span> /etc/os-release
â€‹
<span class="hljs-comment"># æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬</span>
<span class="hljs-built_in">uname</span> -a
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/746362303aee4e55a92105e4a68e7bb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=PAIf366l89EhU285MbombZbbpCM%3D" alt="" loading="lazy"/></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°æœåŠ¡å™¨çš„åŸºæœ¬ä¿¡æ¯ã€‚æ‰§è¡Œäº†ä¸‰ä¸ªå‘½ä»¤ï¼š</p>
<ul>
<li><code>cat /etc/os-release</code>ï¼šæ˜¾ç¤ºç³»ç»Ÿç‰ˆæœ¬ä¸º <strong>openEuler 22.03 (LTS-SP1)</strong></li>
<li><code>uname -a</code>ï¼šæ˜¾ç¤ºå†…æ ¸ç‰ˆæœ¬ä¸º <strong>5.10.0-136.12.0.86.0e2203sp1</strong></li>
<li><code>hostname</code>ï¼šæ˜¾ç¤ºä¸»æœºåä¸º <strong>ser563963324474</strong></li>
</ul>
<p>è¿™ä¸ªç‰ˆæœ¬çš„å†…æ ¸è™½ç„¶æ˜¯ 5.10 ç³»åˆ—ï¼Œä½†ç»è¿‡äº† openEuler å›¢é˜Ÿçš„æ·±åº¦ä¼˜åŒ–ï¼Œå¯¹å®¹å™¨æŠ€æœ¯çš„æ”¯æŒå¾ˆå®Œå–„ã€‚ç³»ç»Ÿç‰ˆæœ¬ã€å†…æ ¸ä¿¡æ¯ã€ä¸»æœºåç­‰å…³é”®é…ç½®éƒ½æ¸…æ™°åœ°å±•ç¤ºå‡ºæ¥äº†ã€‚</p>
<h3 data-id="heading-5">2.2 æŸ¥çœ‹ç¡¬ä»¶é…ç½®</h3>
<p>æ¥ä¸‹æ¥ç¡®è®¤ä¸€ä¸‹ç¡¬ä»¶é…ç½®æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚æˆ‘ä¸»è¦å…³æ³¨ CPUã€å†…å­˜å’Œç£ç›˜è¿™å‡ é¡¹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ CPU ä¿¡æ¯</span>
lscpu | grep -E <span class="hljs-string">"Architecture|CPU(s)|Model name"</span>
â€‹
<span class="hljs-comment"># æŸ¥çœ‹å†…å­˜ä¿¡æ¯</span>
free -h
â€‹
<span class="hljs-comment"># æŸ¥çœ‹ç£ç›˜ä¿¡æ¯</span>
<span class="hljs-built_in">df</span> -h
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e12435d321e40249d7a08a4eb73a325~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=3wdnK9ZJBbv%2BwejkfFss%2B3xP0ig%3D" alt="" loading="lazy"/></p>
<p>ä»å›¾ä¸­å¯ä»¥ç¡®è®¤ï¼ŒæœåŠ¡å™¨æ˜¯ 16æ ¸16GB çš„é…ç½®ã€‚CPU å‹å·æ˜¯ <strong>Intel</strong> <strong>Xeon</strong> <strong>Gold 6138 @ 2.00GHz</strong>ï¼Œæ¶æ„æ˜¯ x86_64ã€‚å†…å­˜æ€»å…± 15Giï¼ˆçº¦15.6GBï¼‰ï¼Œå¯ç”¨å†…å­˜ 14Giï¼Œéå¸¸å……è£•ã€‚ç£ç›˜æ–¹é¢ï¼Œæ ¹ç›®å½•æŒ‚è½½äº† 40GB çš„ç©ºé—´ï¼Œç›®å‰ä½¿ç”¨äº† 1.6GBï¼Œå‰©ä½™ 37GBï¼Œç©ºé—´å¾ˆå……è¶³ã€‚</p>
<p>è¿™ä¸ªé…ç½®å¯¹äºå®¹å™¨åŒ–åº”ç”¨æ¥è¯´éå¸¸å……è£•ã€‚16æ ¸å¿ƒçš„ CPU å¯ä»¥è½»æ¾åº”å¯¹é«˜å¹¶å‘è¯·æ±‚ï¼Œ16GB å†…å­˜è·‘å‡ åä¸ªå®¹å™¨éƒ½æ²¡é—®é¢˜ã€‚å³ä½¿åç»­è¦æ‰©å±•æ›´å¤šæœåŠ¡ï¼Œèµ„æºä¹Ÿå®Œå…¨å¤Ÿç”¨ã€‚</p>
<h2 data-id="heading-6">ä¸‰ã€ç³»ç»Ÿåˆå§‹åŒ–</h2>
<h3 data-id="heading-7">3.1 æ›´æ–°ç³»ç»ŸåŒ…</h3>
<p>æœåŠ¡å™¨åˆšåˆ›å»ºå¥½ï¼Œç³»ç»ŸåŒ…å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥å…ˆåšä¸€æ¬¡å…¨é‡æ›´æ–°ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ï¼Œä¹Ÿèƒ½é¿å…ä¸€äº›å·²çŸ¥çš„bugã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ›´æ–°ç³»ç»Ÿæ‰€æœ‰è½¯ä»¶åŒ…</span>
sudo dnf update -y
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1903ee93ff7c4991b1facea56b459679~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=glHXQ%2BjBxQo90GWrcuaxYwQoM8g%3D" alt="" loading="lazy"/></p>
<p>æ›´æ–°è¿‡ç¨‹å¤§æ¦‚èŠ±äº†3-5åˆ†é’Ÿï¼Œç³»ç»Ÿä¸‹è½½å¹¶å®‰è£…äº†ä¸€äº›æ›´æ–°åŒ…ã€‚ä»æˆªå›¾å¯ä»¥çœ‹åˆ°æ›´æ–°å‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œæç¤º"Complete!"ï¼Œè¯´æ˜ç³»ç»Ÿå·²ç»æ˜¯æœ€æ–°çŠ¶æ€äº†ã€‚</p>
<p>è¿™é‡Œè¯´ä¸€ä¸‹ openEuler ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨æ˜¯ <code>dnf</code>ï¼Œè¿™ä¸ªæ˜¯ <code>yum</code> çš„ä¸‹ä¸€ä»£å·¥å…·ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œä¾èµ–å¤„ç†ä¹Ÿæ›´æ™ºèƒ½ã€‚å¦‚æœä½ ä¹‹å‰ç”¨è¿‡ CentOS æˆ– Fedoraï¼Œä¼šæ„Ÿè§‰å¾ˆç†Ÿæ‚‰ã€‚</p>
<h2 data-id="heading-8">å››ã€Docker å®‰è£…ï¼šé‡åˆ°çš„å‘å’Œè§£å†³æ–¹æ³•</h2>
<h3 data-id="heading-9">4.1 åˆæ¬¡å®‰è£…ï¼ˆç‰ˆæœ¬å¤ªä½ï¼‰</h3>
<p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘ç›´æ¥ç”¨ dnf å®‰è£… Dockerï¼š</p>
<p>sudo dnf install -y docker</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ea857c8224f49f88e26ad4b12e295fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=WczRBbPznTO7QGXzb6f2hu28%2FxY%3D" alt="" loading="lazy"/></p>
<p>å®‰è£…å€’æ˜¯å¾ˆé¡ºåˆ©ï¼Œä½†æ˜¯æŸ¥çœ‹ç‰ˆæœ¬çš„æ—¶å€™å‘ç°äº†é—®é¢˜ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker --version
<span class="hljs-comment"># Docker version 18.09.0, build 9da17b5</span>
</code></pre>
<p>Docker 18.09.0 æ˜¯ 2018 å¹´çš„ç‰ˆæœ¬ï¼Œå·²ç»éå¸¸è€äº†ã€‚è¿™ä¸ªç‰ˆæœ¬ä¸ä»…ç¼ºå°‘å¾ˆå¤šæ–°ç‰¹æ€§ï¼Œè¿˜æœ‰ä¸€äº›å·²çŸ¥çš„bugï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ã€‚æˆ‘éœ€è¦çš„æ˜¯è‡³å°‘ 20.x ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œæœ€å¥½æ˜¯æœ€æ–°çš„ 24.x æˆ– 25.xã€‚</p>
<p>äºæ˜¯æˆ‘å†³å®šå¸è½½è¿™ä¸ªæ—§ç‰ˆæœ¬ï¼Œæ”¹ç”¨ Docker å®˜æ–¹çš„æºæ¥å®‰è£…æœ€æ–°ç‰ˆã€‚</p>
<h3 data-id="heading-10">4.2 å‡çº§åˆ°æœ€æ–°ç‰ˆ Docker</h3>
<p>åœ¨ç½‘ä¸Šæœç´¢äº†ä¸€ä¸‹ openEuler å®‰è£… Docker çš„æ–¹æ³•ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚æ ¸å¿ƒæ€è·¯æ˜¯ï¼š<strong>openEuler ä¸</strong> <strong>CentOS</strong> <strong>7 å…¼å®¹</strong>ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ Docker å®˜æ–¹çš„ CentOS æºã€‚</p>
<p>é¦–å…ˆåœæ­¢å¹¶å¸è½½æ—§ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">sudo systemctl stop docker
sudo dnf remove -y docker docker-common
</code></pre>
<p>ç„¶åæ·»åŠ  Docker å®˜æ–¹æºï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># æ·»åŠ  Docker CE ä»“åº“</span>
sudo yum-config-manager --<span class="hljs-keyword">add</span>-repo https:<span class="hljs-comment">//download.docker.com/linux/centos/docker-ce.repo</span>
</code></pre>
<p>è¿™é‡Œä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼šopenEuler çš„ç‰ˆæœ¬å·ï¼ˆæ¯”å¦‚ 22.03LTS_SP1ï¼‰Docker å®˜æ–¹æºé‡Œæ²¡æœ‰å¯¹åº”çš„ç›®å½•ã€‚è§£å†³åŠæ³•æ˜¯ä¿®æ”¹ä»“åº“é…ç½®æ–‡ä»¶ï¼ŒæŠŠç‰ˆæœ¬å·æ›¿æ¢æˆ CentOS 7ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd675e50ccee4063ab691a68a1b38f92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=nQlFQ3bALKcCJgkUM4oOmZAEzZ8%3D" alt="" loading="lazy"/></p>
<p>è¿™é‡Œä¹Ÿå¯ä»¥ç”¨ sed å‘½ä»¤æ‰¹é‡æ›¿æ¢äº†é…ç½®æ–‡ä»¶ä¸­çš„å˜é‡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å°† $releasever æ›¿æ¢ä¸º 7</span>
sudo sed -i <span class="hljs-string">'s/$releasever/7/g'</span> /etc/yum.repos.d/docker-ce.repo
</code></pre>
<p>æ›¿æ¢å®Œæˆåï¼ŒéªŒè¯ä¸€ä¸‹ä¿®æ”¹æ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<p>cat /etc/yum.repos.d/docker-ce.repo | grep baseurl</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6680af234bf4dd491b25c3869fd11da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=KjM0Y8CcYeRfPIuOaR7m81yopN8%3D" alt="" loading="lazy"/></p>
<p>ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼Œbaseurl å·²ç»å˜æˆäº† <code>https://download.docker.com/linux/centos/7/x86_64/stable</code>ï¼Œè¯´æ˜ä¿®æ”¹æˆåŠŸäº†ã€‚</p>
<h3 data-id="heading-11">4.3 æŸ¥çœ‹å¯å®‰è£…çš„ç‰ˆæœ¬</h3>
<p>ç°åœ¨å¯ä»¥çœ‹çœ‹æœ‰å“ªäº› Docker ç‰ˆæœ¬å¯ä»¥å®‰è£…äº†ï¼š</p>
<p>yum list docker-ce --showduplicates | sort -r | head -20</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a80828e066c24720babe125287ef9d6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=FlIRpzG2ykcJXNTgeifobBtvn1Q%3D" alt="" loading="lazy"/></p>
<p>å¤ªå¥½äº†ï¼å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šç‰ˆæœ¬å¯é€‰ï¼Œä» 24.x åˆ°æœ€æ–°çš„ 26.x éƒ½æœ‰ã€‚æˆ‘é€‰æ‹©å®‰è£…æ¯”è¾ƒæ–°ä¸”ç¨³å®šçš„ 26.1.4 ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£… Docker CE æœ€æ–°ç‰ˆ</span>
sudo yum -y install docker-ce docker-ce-cli containerd.io
â€‹
<span class="hljs-comment"># å¯åŠ¨ Docker æœåŠ¡</span>
sudo systemctl start docker
sudo systemctl <span class="hljs-built_in">enable</span> docker
â€‹
<span class="hljs-comment"># æŸ¥çœ‹ç‰ˆæœ¬</span>
docker --version
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c85693ae67b84cccbcef58b61c9f7b4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=mEDqhhvu0ReiMUgu%2BIgagl7ymzU%3D" alt="" loading="lazy"/></p>
<p>å®Œç¾ï¼Docker å·²ç»å‡çº§åˆ° 26.1.4 ç‰ˆæœ¬äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°ä¸”ç¨³å®šçš„ç‰ˆæœ¬ã€‚åŒæ—¶å¯ä»¥çœ‹åˆ° Docker æœåŠ¡çŠ¶æ€æ˜¯ <code>active (running)</code>ï¼Œè¯´æ˜æœåŠ¡å·²ç»æ­£å¸¸å¯åŠ¨äº†ã€‚</p>
<p>è¿™é‡Œè¸©çš„å‘æ€»ç»“ä¸€ä¸‹ï¼š</p>
<ol>
<li>openEuler é»˜è®¤ä»“åº“çš„ Docker ç‰ˆæœ¬å¤ªè€</li>
<li>Docker å®˜æ–¹æºéœ€è¦ä¿®æ”¹é…ç½®æ‰èƒ½ç”¨</li>
<li>æ›¿æ¢ç‰ˆæœ¬å·ä¸º 7 æ˜¯å…³é”®æ“ä½œ</li>
</ol>
<h3 data-id="heading-12">4.4 æµ‹è¯• Docker</h3>
<p>Docker å®‰è£…å¥½äº†ï¼Œæµ‹è¯•ä¸€ä¸‹æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼š</p>
<p>sudo docker run hello-world</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e238709f7b34452583a03ecf097c3ba5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=2FUJo4VmCn5tldrHfT17XGbyDc8%3D" alt="" loading="lazy"/></p>
<p>çœ‹åˆ° "Hello from Docker!" çš„æ¬¢è¿ä¿¡æ¯ï¼Œè¯´æ˜ Docker å·²ç»å¯ä»¥æ­£å¸¸æ‹‰å–é•œåƒå’Œè¿è¡Œå®¹å™¨äº†ã€‚è¿™ä¸ªæµ‹è¯•é•œåƒå¾ˆå°ï¼Œä¸»è¦å°±æ˜¯è¾“å‡ºä¸€æ®µæ¬¢è¿æ–‡å­—ï¼Œç¡®è®¤ Docker çš„å„ä¸ªç»„ä»¶ï¼ˆå®ˆæŠ¤è¿›ç¨‹ã€å®¢æˆ·ç«¯ã€é•œåƒä»“åº“ï¼‰éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
<h2 data-id="heading-13">äº”ã€Docker Compose å®‰è£…</h2>
<p>Docker å•ç‹¬ä½¿ç”¨æ²¡é—®é¢˜äº†ï¼Œæ¥ä¸‹æ¥å®‰è£… Docker Composeã€‚è¿™ä¸ªå·¥å…·å¯ä»¥ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ç®¡ç†å¤šä¸ªå®¹å™¨ï¼Œå¯¹äºéƒ¨ç½²å¤šæœåŠ¡åº”ç”¨éå¸¸æ–¹ä¾¿ã€‚</p>
<h3 data-id="heading-14">5.1 é‡åˆ°çš„é—®é¢˜</h3>
<p>ä¸€å¼€å§‹æˆ‘å°è¯•ç”¨ dnf å®‰è£…ï¼š</p>
<p>sudo dnf install -y docker-compose</p>
<p>å®‰è£…å€’æ˜¯æˆåŠŸäº†ï¼Œä½†ç‰ˆæœ¬æ˜¯ 1.29.2ï¼Œè¿™æ˜¯æ¯”è¾ƒè€çš„ç‰ˆæœ¬ã€‚ç°åœ¨ Docker Compose å·²ç»å‘å±•åˆ° v2.x äº†ï¼Œæ–°ç‰ˆæœ¬ä¸ä»…æ€§èƒ½æ›´å¥½ï¼ŒåŠŸèƒ½ä¹Ÿæ›´å¼ºå¤§ã€‚</p>
<h3 data-id="heading-15">5.2 å®‰è£…æœ€æ–°ç‰ˆ</h3>
<p>äºæ˜¯æˆ‘å†³å®šä» GitHub ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ã€‚æ“ä½œå¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä» GitHub ä¸‹è½½æœ€æ–°ç‰ˆ Docker Compose</span>
sudo curl -L <span class="hljs-string">"https://github.com/docker/compose/releases/latest/download/docker-compose-<span class="hljs-subst">$(uname -s)</span>-<span class="hljs-subst">$(uname -m)</span>"</span> -o /usr/local/bin/docker-compose
â€‹
<span class="hljs-comment"># æ·»åŠ æ‰§è¡Œæƒé™</span>
sudo <span class="hljs-built_in">chmod</span> +x /usr/local/bin/docker-compose
â€‹
<span class="hljs-comment"># éªŒè¯ç‰ˆæœ¬</span>
docker-compose --version
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff80385009de4f5c9c97b4b88aa41a7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=FSwZwWry8S0Kp%2Fu%2BCVVnNDwsQEM%3D" alt="" loading="lazy"/></p>
<p>å®Œç¾ï¼ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼š</p>
<ol>
<li>ä½¿ç”¨ curl ä» GitHub æˆåŠŸä¸‹è½½äº† Docker Compose</li>
<li>ä¸‹è½½çš„æ–‡ä»¶å¤§å°çº¦ 73MBï¼Œä¸‹è½½é€Ÿåº¦è¿˜ä¸é”™</li>
<li>æ·»åŠ æ‰§è¡Œæƒé™åï¼ŒéªŒè¯ç‰ˆæœ¬æ˜¯ <strong>v2.40.3</strong></li>
</ol>
<p>è¿™æ˜¯ç›®å‰ Docker Compose çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼Œç›¸æ¯” v1.x ç‰ˆæœ¬ï¼Œv2.x æœ‰å¾ˆå¤šæ”¹è¿›ï¼š</p>
<ul>
<li>æ€§èƒ½æ›´å¥½ï¼Œå¯åŠ¨å®¹å™¨æ›´å¿«</li>
<li>æ”¯æŒ GPU èµ„æºç®¡ç†</li>
<li>æ›´å¥½çš„ä¾èµ–å¤„ç†</li>
<li>å®Œå…¨å…¼å®¹ v1.x çš„é…ç½®æ–‡ä»¶</li>
</ul>
<h2 data-id="heading-16">å…­ã€å®æˆ˜ï¼šéƒ¨ç½² WordPress åšå®¢ç³»ç»Ÿ</h2>
<p>ç¯å¢ƒéƒ½å‡†å¤‡å¥½äº†ï¼Œç°åœ¨å¼€å§‹éƒ¨ç½²ä¸€ä¸ªçœŸå®çš„åº”ç”¨ã€‚æˆ‘é€‰æ‹©äº† WordPressï¼ŒåŸå› æœ‰å‡ ä¸ªï¼š</p>
<ol>
<li><strong>ç»å…¸åœºæ™¯</strong>ï¼šWordPress æ˜¯å…¨çƒä½¿ç”¨æœ€å¹¿çš„åšå®¢ç³»ç»Ÿï¼Œå¾ˆæœ‰ä»£è¡¨æ€§</li>
<li><strong>å¤šç»„ä»¶</strong>ï¼šåŒ…å« Web æœåŠ¡å’Œæ•°æ®åº“ï¼Œå¯ä»¥å±•ç¤ºå®¹å™¨ç¼–æ’èƒ½åŠ›</li>
<li><strong>å®ç”¨ä»·å€¼</strong>ï¼šéƒ¨ç½²å®Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸æ˜¯çº¯ç²¹çš„ Hello World</li>
</ol>
<h3 data-id="heading-17">6.1 åˆ›å»ºé¡¹ç›®ç›®å½•</h3>
<p>å…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®ç›®å½•ï¼ŒæŠŠç›¸å…³æ–‡ä»¶éƒ½æ”¾åœ¨è¿™é‡Œã€‚æˆ‘æŒ‰ç…§è‡ªå·±çš„ä¹ æƒ¯åˆ›å»ºäº†ä¸€ä¸ªå±‚çº§åŒ–çš„ç›®å½•ç»“æ„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºé¡¹ç›®ç›®å½•ï¼ˆå¤šå±‚çº§ï¼‰</span>
<span class="hljs-built_in">mkdir</span> -p acowbo/docker-compose-project/wordpress
â€‹
<span class="hljs-comment"># è¿›å…¥ç›®å½•</span>
<span class="hljs-built_in">cd</span> acowbo/docker-compose-project/wordpress
â€‹
<span class="hljs-comment"># ç¡®è®¤å½“å‰è·¯å¾„</span>
<span class="hljs-built_in">pwd</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8e45850078445ae892144dfbd5e5893~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=9M5ISQdzF261SWim56FUfMJ2utE%3D" alt="" loading="lazy"/></p>
<p>ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼Œé¡¹ç›®ç›®å½•åˆ›å»ºå¥½äº†ï¼Œå½“å‰è·¯å¾„æ˜¯ <code>/root/acowbo/docker-compose-project/wordpress</code>ã€‚è¿™ç§å±‚çº§åŒ–çš„ç›®å½•ç»“æ„å¯ä»¥æ›´å¥½åœ°ç»„ç»‡ä¸åŒçš„ Docker Compose é¡¹ç›®ã€‚æ¥ä¸‹æ¥åœ¨è¿™ä¸ªç›®å½•é‡Œåˆ›å»º Docker Compose é…ç½®æ–‡ä»¶ã€‚</p>
<h3 data-id="heading-18">6.2 ç¼–å†™ docker-compose.yml</h3>
<p>Docker Compose çš„æ ¸å¿ƒæ˜¯ <code>docker-compose.yml</code> é…ç½®æ–‡ä»¶ï¼Œé‡Œé¢å®šä¹‰äº†æ‰€æœ‰çš„æœåŠ¡ã€ç½‘ç»œã€æ•°æ®å·ç­‰ã€‚æˆ‘çš„é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>
<span class="hljs-string">â€‹</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-comment"># MySQL æ•°æ®åº“</span>
  <span class="hljs-attr">db:</span>
 Â   <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span>
 Â   <span class="hljs-attr">container_name:</span> <span class="hljs-string">wordpress_mysql</span>
 Â   <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
 Â   <span class="hljs-attr">environment:</span>
 Â  Â   <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-number">123123</span>
 Â  Â   <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">wordpress</span>
 Â  Â   <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">wpuser</span>
 Â  Â   <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-number">12313</span>
 Â   <span class="hljs-attr">volumes:</span>
 Â  Â   <span class="hljs-bullet">-</span> <span class="hljs-string">db_data:/var/lib/mysql</span>
 Â   <span class="hljs-attr">networks:</span>
 Â  Â   <span class="hljs-bullet">-</span> <span class="hljs-string">wordpress_net</span>
<span class="hljs-string">â€‹</span>
  <span class="hljs-comment"># WordPress åº”ç”¨</span>
  <span class="hljs-attr">wordpress:</span>
 Â   <span class="hljs-attr">image:</span> <span class="hljs-string">wordpress:latest</span>
 Â   <span class="hljs-attr">container_name:</span> <span class="hljs-string">wordpress_app</span>
 Â   <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
 Â   <span class="hljs-attr">depends_on:</span>
 Â  Â   <span class="hljs-bullet">-</span> <span class="hljs-string">db</span>
 Â   <span class="hljs-attr">ports:</span>
 Â  Â   <span class="hljs-bullet">-</span> <span class="hljs-string">"8080:80"</span>
 Â   <span class="hljs-attr">environment:</span>
 Â  Â   <span class="hljs-attr">WORDPRESS_DB_HOST:</span> <span class="hljs-string">db:3306</span>
 Â  Â   <span class="hljs-attr">WORDPRESS_DB_USER:</span> <span class="hljs-string">wpuser</span>
 Â  Â   <span class="hljs-attr">WORDPRESS_DB_PASSWORD:</span> <span class="hljs-number">12313</span>
 Â  Â   <span class="hljs-attr">WORDPRESS_DB_NAME:</span> <span class="hljs-string">wordpress</span>
 Â   <span class="hljs-attr">volumes:</span>
 Â  Â   <span class="hljs-bullet">-</span> <span class="hljs-string">wordpress_data:/var/www/html</span>
 Â   <span class="hljs-attr">networks:</span>
 Â  Â   <span class="hljs-bullet">-</span> <span class="hljs-string">wordpress_net</span>
<span class="hljs-string">â€‹</span>
<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">db_data:</span>
  <span class="hljs-attr">wordpress_data:</span>
<span class="hljs-string">â€‹</span>
<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">wordpress_net:</span>
 Â   <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
</code></pre>
<p>é…ç½®æ–‡ä»¶ä¸»è¦å®šä¹‰äº†ä¸¤ä¸ªæœåŠ¡ï¼š</p>
<ul>
<li><strong>db æœåŠ¡</strong>ï¼šMySQL 8.0 æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨ WordPress çš„æ•°æ®</li>
<li><strong>wordpress</strong> <strong>æœåŠ¡</strong>ï¼šWordPress æœ€æ–°ç‰ˆæœ¬ï¼Œç›‘å¬ 8080 ç«¯å£</li>
</ul>
<p>ä¸¤ä¸ªæœåŠ¡é€šè¿‡è‡ªå®šä¹‰ç½‘ç»œ <code>wordpress_net</code> äº’è”ï¼Œæ•°æ®é€šè¿‡æ•°æ®å·æŒä¹…åŒ–ä¿å­˜ã€‚è¿™æ ·å³ä½¿å®¹å™¨é‡å¯æˆ–åˆ é™¤ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p>
<p>åˆ›å»ºå®Œé…ç½®æ–‡ä»¶åï¼Œä¸€è¡Œå‘½ä»¤å°±èƒ½å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåå°è¿è¡Œï¼‰</span>
docker-compose up -d
â€‹
<span class="hljs-comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span>
docker-compose ps
</code></pre>
<h3 data-id="heading-19">6.3 æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1afd1a7d9dbd42d9854a034610051c40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=G5UkzIS2%2F4yKWj6CPdSVy78CMZc%3D" alt="" loading="lazy"/></p>
<p>ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªå®¹å™¨éƒ½å·²ç»æˆåŠŸå¯åŠ¨äº†ï¼š</p>
<ul>
<li><code>wordpress_mysql</code>ï¼šæ•°æ®åº“å®¹å™¨ï¼ŒçŠ¶æ€æ˜¯ Up</li>
<li><code>wordpress_app</code>ï¼šWordPress å®¹å™¨ï¼ŒçŠ¶æ€æ˜¯ Upï¼Œç«¯å£æ˜ å°„ 0.0.0.0:8080-&gt;80/tcp</li>
</ul>
<p>è¿™é‡Œè§£é‡Šä¸€ä¸‹ç«¯å£æ˜ å°„ï¼šå®¹å™¨å†…éƒ¨ WordPress è¿è¡Œåœ¨ 80 ç«¯å£ï¼Œæˆ‘ä»¬æŠŠå®ƒæ˜ å°„åˆ°ä¸»æœºçš„ 8080 ç«¯å£ã€‚è¿™æ ·ä»å¤–éƒ¨è®¿é—®æœåŠ¡å™¨çš„ 8080 ç«¯å£ï¼Œå°±èƒ½è®¿é—®åˆ°å®¹å™¨é‡Œçš„ WordPress äº†ã€‚</p>
<p>Docker Compose çœŸçš„å¾ˆæ–¹ä¾¿ï¼Œä¸ç”¨æ‰‹åŠ¨åˆ›å»ºç½‘ç»œã€ä¸ç”¨é€ä¸ªå¯åŠ¨å®¹å™¨ï¼Œä¸€ä¸ªé…ç½®æ–‡ä»¶ + ä¸€è¡Œå‘½ä»¤å°±æå®šäº†ã€‚è¿™å°±æ˜¯å®¹å™¨ç¼–æ’çš„é­…åŠ›ã€‚</p>
<h3 data-id="heading-20">6.4 è®¿é—® WordPress</h3>
<p>ç°åœ¨åœ¨æµè§ˆå™¨é‡Œè®¿é—®ï¼š<code>http://&lt;æœåŠ¡å™¨IP&gt;:8080</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc39e5db14be45b7a01a82b2667f4854~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=qiu4aBQjLT6lbbu8pfQFTUpAVMk%3D" alt="" loading="lazy"/></p>
<p>æˆåŠŸï¼çœ‹åˆ°äº† WordPress çš„å®‰è£…å‘å¯¼ç•Œé¢ã€‚ç•Œé¢æ˜¯ä¸­æ–‡çš„ï¼Œæç¤ºé€‰æ‹©è¯­è¨€åå°±å¯ä»¥å¼€å§‹é…ç½®ç½‘ç«™äº†ã€‚è¿™è¯´æ˜æ•´å¥—ç³»ç»Ÿå·²ç»è·‘é€šäº†ï¼š</p>
<ol>
<li>æœåŠ¡å™¨çš„ 8080 ç«¯å£å¯¹å¤–å¼€æ”¾</li>
<li>æµé‡æ­£ç¡®è½¬å‘åˆ° WordPress å®¹å™¨</li>
<li>WordPress èƒ½å¤Ÿè¿æ¥åˆ° MySQL æ•°æ®åº“</li>
<li>æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ</li>
</ol>
<p>åˆ°è¿™é‡Œï¼Œä¸€ä¸ªå®Œæ•´çš„å®¹å™¨åŒ–åº”ç”¨å°±éƒ¨ç½²å®Œæˆäº†ã€‚å¦‚æœè¦æ­£å¼ä½¿ç”¨ï¼Œæ¥ä¸‹æ¥æŒ‰ç…§å‘å¯¼é…ç½®ç½‘ç«™æ ‡é¢˜ã€ç®¡ç†å‘˜è´¦å·ç­‰ä¿¡æ¯å°±å¯ä»¥äº†ã€‚</p>
<h2 data-id="heading-21">ä¸ƒã€æ€§èƒ½ç›‘æ§</h2>
<p>åº”ç”¨è·‘èµ·æ¥äº†ï¼Œçœ‹çœ‹èµ„æºå ç”¨æƒ…å†µã€‚Docker è‡ªå¸¦äº† stats å‘½ä»¤å¯ä»¥å®æ—¶ç›‘æ§å®¹å™¨èµ„æºï¼š</p>
<p>docker stats --no-stream</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06e1eab7ce354526b1824a3dad6957ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTnR1cm1vaWxz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765340932&amp;x-signature=IMyhwsQj5makDtn8tYpAzOXhuio%3D" alt="" loading="lazy"/></p>
<p>ä»ç›‘æ§æ•°æ®å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li><strong>wordpress_app</strong>ï¼šCPU ä½¿ç”¨ 0.01%ï¼Œå†…å­˜ 65.62MiB / 15.12GiBï¼ˆçº¦ 0.42%ï¼‰</li>
<li><strong>wordpress_mysql</strong>ï¼šCPU ä½¿ç”¨ 0.75%ï¼Œå†…å­˜ 398.7MiB / 15.12GiBï¼ˆçº¦ 2.57%ï¼‰</li>
</ul>
<p>æ•´ä½“èµ„æºå ç”¨éå¸¸ä½ï¼Œä¸¤ä¸ªå®¹å™¨åŠ èµ·æ¥å†…å­˜ä¸åˆ° 465MBï¼ŒCPU ä½¿ç”¨ç‡ä¸åˆ° 1%ã€‚è¿™è¿˜æ˜¯åœ¨å®¹å™¨åˆšå¯åŠ¨ã€MySQL åˆå§‹åŒ–ã€WordPress åŠ è½½çš„æƒ…å†µä¸‹ã€‚ç­‰ç³»ç»Ÿç¨³å®šè¿è¡Œåï¼Œå ç”¨ä¼šæ›´ä½ã€‚</p>
<p>è¿™ä¹Ÿå°è¯äº†å®¹å™¨åŒ–çš„ä¸€ä¸ªä¼˜åŠ¿ï¼š<strong>èµ„æºåˆ©ç”¨ç‡é«˜</strong>ã€‚åŒæ ·çš„ç¡¬ä»¶é…ç½®ï¼Œå®¹å™¨åŒ–éƒ¨ç½²å¯ä»¥è·‘æ›´å¤šçš„åº”ç”¨ã€‚å¦‚æœç”¨ä¼ ç»Ÿè™šæ‹Ÿæœºæ–¹å¼ï¼Œå…‰æ˜¯ MySQL å’Œ Web æœåŠ¡å°±è¦å ç”¨å‡ ä¸ª GB çš„å†…å­˜äº†ã€‚</p>
<h2 data-id="heading-22">å…«ã€å®æˆ˜æ€»ç»“</h2>
<p>è¿™æ¬¡åœ¨ openEuler ä¸Šç”¨ Docker Compose éƒ¨ç½² WordPress çš„å®æˆ˜ï¼Œæ•´ä½“è¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒé¡ºåˆ©çš„ã€‚è™½ç„¶ä¸­é—´é‡åˆ°äº† Docker ç‰ˆæœ¬çš„é—®é¢˜ï¼Œä½†é€šè¿‡ä¿®æ”¹ä»“åº“é…ç½®ä¹Ÿé¡ºåˆ©è§£å†³äº†ã€‚</p>
<h3 data-id="heading-23">8.1 è¸©è¿‡çš„å‘</h3>
<p><strong>å‘1ï¼šDocker é»˜è®¤ç‰ˆæœ¬å¤ªè€</strong></p>
<ul>
<li>é—®é¢˜ï¼šdnf ç›´æ¥å®‰è£…çš„ Docker æ˜¯ 18.09.0</li>
<li>è§£å†³ï¼šä½¿ç”¨ Docker å®˜æ–¹ CentOS æºï¼Œä¿®æ”¹ç‰ˆæœ¬å·ä¸º 7</li>
<li>å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_42465759%2Farticle%2Fdetails%2F131207667" target="_blank" title="https://blog.csdn.net/weixin_42465759/article/details/131207667" ref="nofollow noopener noreferrer">blog.csdn.net/weixin_4246â€¦</a></li>
</ul>
<p><strong>å‘2ï¼šDocker Compose ç‰ˆæœ¬å¤ªè€</strong></p>
<ul>
<li>é—®é¢˜ï¼šdnf å®‰è£…çš„ Docker Compose æ˜¯ 1.29.2ï¼ˆv1.xï¼‰</li>
<li>è§£å†³ï¼šä» GitHub ä¸‹è½½æœ€æ–°ç‰ˆ v2.40.3</li>
<li>æ–¹æ³•ï¼šä½¿ç”¨ curl ä» GitHub releases ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</li>
</ul>
<p><strong>å‘3ï¼š</strong>* <em>ç«¯å£</em>*<strong>å¼€æ”¾</strong></p>
<ul>
<li>é—®é¢˜ï¼šæµè§ˆå™¨æ— æ³•è®¿é—® WordPress</li>
<li>è§£å†³ï¼šåœ¨äº‘æœåŠ¡å™¨æ§åˆ¶å°å®‰å…¨ç»„å¼€æ”¾ 8080 ç«¯å£</li>
<li>æç¤ºï¼šå¦‚æœå¯ç”¨äº†é˜²ç«å¢™ï¼Œè®°å¾—ç”¨ firewall-cmd å¼€æ”¾ç«¯å£</li>
</ul>
<h3 data-id="heading-24">8.2 openEuler ä½¿ç”¨ä½“éªŒ</h3>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ol>
<li><strong>å…¼å®¹æ€§</strong>* <em>å¥½</em>*ï¼šå’Œ CentOS é«˜åº¦å…¼å®¹ï¼Œç”Ÿæ€å·¥å…·åŸºæœ¬éƒ½èƒ½ç”¨</li>
<li><strong>æ€§èƒ½ç¨³å®š</strong>ï¼šå®¹å™¨è¿è¡Œæµç•…ï¼Œèµ„æºå ç”¨åˆç†</li>
<li><strong>æ–‡æ¡£å®Œå–„</strong>ï¼šå®˜æ–¹æ–‡æ¡£å†™å¾—å¾ˆæ¸…æ¥šï¼Œç¤¾åŒºä¹Ÿå¾ˆæ´»è·ƒ</li>
<li><strong>åŒ…ç®¡ç†æ–¹ä¾¿</strong>ï¼šdnf ç”¨èµ·æ¥å’Œ yum å·®ä¸å¤šï¼Œä¸Šæ‰‹å¿«</li>
</ol>
<p><strong>æ”¹è¿›ç©ºé—´</strong>ï¼š</p>
<ol>
<li>é»˜è®¤ä»“åº“çš„è½¯ä»¶ç‰ˆæœ¬æœ‰ç‚¹ä¿å®ˆï¼Œåƒ Docker è¿˜æ˜¯ 18.09</li>
</ol>
<p>æ€»çš„æ¥è¯´ï¼ŒopenEuler ä½œä¸ºäº‘åŸç”Ÿåœºæ™¯çš„åŸºç¡€æ“ä½œç³»ç»Ÿï¼Œå®Œå…¨èƒ½æ»¡è¶³ä¼ä¸šçº§åº”ç”¨çš„éœ€æ±‚ã€‚</p>
<h2 data-id="heading-25">å…«ã€å‚è€ƒèµ„æº</h2>
<ul>
<li>openEuler å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openeuler.org%2F" target="_blank" title="https://www.openeuler.org/" ref="nofollow noopener noreferrer">www.openEuler.org/</a></li>
<li>openEuler å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openeuler.openatom.cn%2Fzh%2F" target="_blank" title="https://docs.openeuler.openatom.cn/zh/" ref="nofollow noopener noreferrer">docs.openEuler.openatom.cn/zh/</a></li>
<li>Docker å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.docker.com%2F" target="_blank" title="https://docs.docker.com/" ref="nofollow noopener noreferrer">docs.docker.com/</a></li>
<li>Docker Compose æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.docker.com%2Fcompose%2F" target="_blank" title="https://docs.docker.com/compose/" ref="nofollow noopener noreferrer">docs.docker.com/compose/</a></li>
<li>WordPress å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwordpress.org%2F" target="_blank" title="https://wordpress.org/" ref="nofollow noopener noreferrer">wordpress.org/</a>é“¾æ¥</li>
</ul>
<p><strong>å†™åœ¨æœ€å</strong>ï¼š</p>
<p>è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡åœ¨ openEuler ä¸Šåšäº‘åŸç”Ÿå®æˆ˜ï¼Œæ•´ä½“æ„Ÿå—è¿˜ä¸é”™ã€‚è™½ç„¶é‡åˆ°äº†ä¸€äº›å°é—®é¢˜ï¼Œä½†éƒ½é¡ºåˆ©è§£å†³äº†ã€‚å®¹å™¨åŒ–ç¡®å®æ˜¯æœªæ¥çš„æ–¹å‘ï¼Œå€¼å¾—æ¯ä¸ªå¼€å‘è€…å’Œè¿ç»´å·¥ç¨‹å¸ˆå­¦ä¹ æŒæ¡ã€‚</p>
<p>å¦‚æœä½ ä¹Ÿæƒ³å°è¯• openEulerï¼Œå»ºè®®ä»å®¹å™¨åŒ–åº”ç”¨å¼€å§‹ï¼Œé—¨æ§›ä¸é«˜ï¼Œä½†æ”¶è·å¾ˆå¤§ã€‚æœ‰é—®é¢˜å¯ä»¥å»å®˜æ–¹ç¤¾åŒºï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fforum.openeuler.org%2F" target="_blank" title="https://forum.openeuler.org/" ref="nofollow noopener noreferrer">forum.openEuler.org/</a>ï¼‰æé—®ï¼Œç¤¾åŒºå“åº”è¿˜æ˜¯å¾ˆå¿«çš„ã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å­˜å‚¨ç®¡ç†åœ¨å¼€å‘ä¸­æœ‰å“ªäº›åº”ç”¨ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7579215538271305738</link>    <guid>https://juejin.cn/post/7579215538271305738</guid>    <pubDate>2025-12-03T04:41:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579215538271305738" data-draft-id="7579215538271289354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å­˜å‚¨ç®¡ç†åœ¨å¼€å‘ä¸­æœ‰å“ªäº›åº”ç”¨ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,å…¨æ ˆ"/> <meta itemprop="datePublished" content="2025-12-03T04:41:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘å«é»‘å¤§å¸…"/> <meta itemprop="url" content="https://juejin.cn/user/1678295463898875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å­˜å‚¨ç®¡ç†åœ¨å¼€å‘ä¸­æœ‰å“ªäº›åº”ç”¨ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1678295463898875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘å«é»‘å¤§å¸…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:41:20.000Z" title="Wed Dec 03 2025 04:41:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»19åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å­˜å‚¨ç®¡ç†åœ¨å¼€å‘ä¸­æœ‰å“ªäº›åº”ç”¨ï¼Ÿ</h2>
<h3 data-id="heading-1">ä¸€ã€å‰ç«¯å­˜å‚¨ï¼šæŠŠ â€œå†…å­˜ / æœ¬åœ°å­˜å‚¨â€ ç”¨å‡ºæ“ä½œç³»ç»Ÿçº§æ•ˆç‡</h3>
<p>å‰ç«¯å¼€å‘çœ‹ä¼¼ä¸ç¢° â€œåº•å±‚å­˜å‚¨â€ï¼Œä½†å…¶å®æ¯å¤©éƒ½åœ¨å’Œ â€œå†…å­˜ã€æœ¬åœ°å­˜å‚¨â€ æ‰“äº¤é“ã€‚ä½ æƒ³æƒ³ï¼šå†™ Vue/React ç»„ä»¶æ—¶çš„çŠ¶æ€ç®¡ç†ã€å¤„ç†å¤§è¡¨å•æ•°æ®ã€ä¸Šä¼ é«˜æ¸…å›¾ç‰‡ã€åšç¦»çº¿åº”ç”¨ â€”â€” è¿™äº›åœºæ™¯èƒŒåï¼Œå…¨æ˜¯å­˜å‚¨ç®¡ç†çš„é€»è¾‘ã€‚å’±ä»¬å…ˆä» â€œæœ¬åœ°å­˜å‚¨â€ å’Œ â€œå†…å­˜ä¼˜åŒ–â€ ä¸¤ä¸ªæ ¸å¿ƒåœºæ™¯èŠèµ·ã€‚</p>
<h4 data-id="heading-2">1. æœ¬åœ°å­˜å‚¨é€‰å‹ï¼šå¯¹åº” OS çš„ â€œå­˜å‚¨å±‚æ¬¡ç»“æ„â€</h4>
<p>å¹³æ—¶å†™å‰ç«¯ï¼Œæœ¬åœ°å­˜å‚¨å¸¸ç”¨ Cookieã€localStorageã€sessionStorageï¼Œå¶å°”ç”¨ IndexedDBï¼Œä½†éƒ½æ˜¯ â€œå‡­æ„Ÿè§‰é€‰â€â€”â€” æ¯”å¦‚å°æ•°æ®ç”¨ localStorageï¼Œä¸´æ—¶æ•°æ®ç”¨ sessionStorageï¼Œéœ€è¦è·¨åŸŸå…±äº«ç”¨ Cookieã€‚è¿™å’Œ OS çš„ â€œå­˜å‚¨å±‚æ¬¡â€ æœ‰å•¥å…³ç³»ï¼Ÿ</p>
<p>OS çš„å­˜å‚¨å±‚æ¬¡æ˜¯ â€œå¯„å­˜å™¨â†’é«˜é€Ÿç¼“å­˜â†’å†…å­˜â†’ç£ç›˜â†’å¤–éƒ¨å­˜å‚¨â€ï¼Œæ ¸å¿ƒæ˜¯ â€œå¿«çš„ç©ºé—´å°ã€å¤§çš„ç©ºé—´æ…¢â€ï¼Œæ‰€ä»¥è¦ â€œæŠŠå¸¸ç”¨æ•°æ®æ”¾å¿«ç©ºé—´ï¼Œä¸å¸¸ç”¨çš„æ”¾å¤§ç©ºé—´â€ã€‚å‰ç«¯æœ¬åœ°å­˜å‚¨å…¶å®å°±æ˜¯ä¸€å¥—è¿·ä½ ç‰ˆ â€œå­˜å‚¨å±‚æ¬¡â€ï¼Œå’±ä»¬ç›´æ¥å¯¹åº”ä¸Šï¼š</p>



































<table><thead><tr><th>OS å­˜å‚¨å±‚æ¬¡</th><th>å‰ç«¯æœ¬åœ°å­˜å‚¨</th><th>æ ¸å¿ƒç‰¹ç‚¹</th><th>å®æˆ˜åœºæ™¯ï¼ˆä½ è‚¯å®šå†™è¿‡ï¼ï¼‰</th></tr></thead><tbody><tr><td>é«˜é€Ÿç¼“å­˜</td><td>Cookie</td><td>å®¹é‡å°ï¼ˆ4KBï¼‰ã€éšè¯·æ±‚å‘é€ã€è¿‡æœŸå¯æ§</td><td>å­˜ Tokenã€ç”¨æˆ·åå¥½ï¼ˆæ¯”å¦‚ä¸»é¢˜è‰²ï¼‰ã€è·¨åŸŸå…±äº«æ•°æ®</td></tr><tr><td>å†…å­˜</td><td>sessionStorage</td><td>å®¹é‡ä¸­ï¼ˆ5MBï¼‰ã€ä¼šè¯çº§ã€é¡µé¢éš”ç¦»</td><td>å­˜ä¸´æ—¶è¡¨å•æ•°æ®ï¼ˆæ¯”å¦‚ç”¨æˆ·æ²¡æäº¤çš„è¡¨å•ï¼‰ã€é¡µé¢é—´ä¸´æ—¶å‚æ•°</td></tr><tr><td>ç£ç›˜</td><td>localStorage</td><td>å®¹é‡ä¸­ï¼ˆ5MBï¼‰ã€æŒä¹…åŒ–ã€åŒæºå…±äº«</td><td>å­˜ç”¨æˆ·é…ç½®ï¼ˆæ¯”å¦‚é»˜è®¤æ”¶è´§åœ°å€ï¼‰ã€ç¦»çº¿ç¼“å­˜æ•°æ®ï¼ˆæ¯”å¦‚é¦–é¡µé™æ€åˆ—è¡¨ï¼‰</td></tr><tr><td>å¤–éƒ¨å­˜å‚¨</td><td>IndexedDB</td><td>å®¹é‡å¤§ï¼ˆæ— ä¸Šé™ï¼Œçœ‹ç£ç›˜ï¼‰ã€æ”¯æŒäº‹åŠ¡ã€å¼‚æ­¥</td><td>å­˜å¤§ä½“ç§¯æ•°æ®ï¼ˆæ¯”å¦‚ç¦»çº¿è¡¨å•çš„é™„ä»¶åˆ—è¡¨ï¼‰ã€å¤æ‚æŸ¥è¯¢æ•°æ®ï¼ˆæ¯”å¦‚æœ¬åœ°æ—¥å¿—ã€ç¦»çº¿æŠ¥è¡¨ï¼‰</td></tr></tbody></table>
<p>ä¸¾ä¸ªä½ è‚¯å®šé‡åˆ°è¿‡çš„åœºæ™¯ â€”â€” åš â€œç¦»çº¿æäº¤è¡¨å•â€ åŠŸèƒ½æ—¶ï¼Œç”¨æˆ·å¡«äº† 100 ä¸ªå­—æ®µ + ä¸Šä¼ äº† 3 ä¸ªé™„ä»¶ï¼Œçªç„¶æ–­ç½‘äº†ã€‚å¦‚æœç”¨ localStorage å­˜ï¼Œé¦–å…ˆ 5MB å®¹é‡å¯èƒ½ä¸å¤Ÿï¼ˆé™„ä»¶ Base64 ç¼–ç åä½“ç§¯ä¼šå˜å¤§ï¼‰ï¼Œå…¶æ¬¡æ²¡æ³•åš â€œæäº¤æˆåŠŸåæ‰¹é‡åˆ é™¤â€ï¼ˆç¼ºä¹äº‹åŠ¡ï¼‰ã€‚è¿™æ—¶å€™å°±è¯¥ç”¨ IndexedDBï¼Œå¯¹åº” OS çš„ â€œç£ç›˜å­˜å‚¨â€â€”â€” å®¹é‡å¤§ã€æ”¯æŒäº‹åŠ¡ï¼Œè¿˜èƒ½å¼‚æ­¥æ“ä½œä¸é˜»å¡ UIï¼Œè¿™å°±æ˜¯ â€œå­˜å‚¨å±‚æ¬¡â€ ç†è®ºçš„è½åœ°ï¼šæ ¹æ®æ•°æ®çš„ â€œå¤§å°ã€è®¿é—®é¢‘ç‡ã€æŒä¹…åŒ–éœ€æ±‚â€ é€‰å¯¹å­˜å‚¨ä»‹è´¨ã€‚</p>
<h4 data-id="heading-3">2. å†…å­˜ä¼˜åŒ–ï¼šé¿å…å‰ç«¯ â€œå†…å­˜æ³„æ¼â€ï¼Œå¯¹åº” OS çš„ â€œå†…å­˜å›æ”¶ + è™šæ‹Ÿå†…å­˜â€</h4>
<p>ä¹‹å‰åšä¸€ä¸ª React ç®¡ç†ç³»ç»Ÿï¼Œç”¨æˆ·åé¦ˆ â€œç”¨ä¹…äº†é¡µé¢è¶Šæ¥è¶Šå¡â€ï¼Œæœ€åæ’æŸ¥æ˜¯å†…å­˜æ³„æ¼ â€”â€” ç»„ä»¶å¸è½½åï¼Œå®šæ—¶å™¨æ²¡æ¸…ã€äº‹ä»¶ç›‘å¬æ²¡è§£ç»‘ï¼Œå¯¼è‡´å†…å­˜è¶Šç§¯è¶Šå¤šã€‚è¿™å’Œ OS çš„ â€œå†…å­˜å›æ”¶â€ æ˜¯ä¸æ˜¯ä¸€ä¸ªé“ç†ï¼Ÿ</p>
<p>å®Œå…¨ä¸€è‡´ï¼OS é‡Œçš„ â€œå†…å­˜å›æ”¶â€ æ˜¯é‡Šæ”¾ â€œä¸å†ä½¿ç”¨çš„å†…å­˜å—â€ï¼Œå‰ç«¯çš„å†…å­˜æ³„æ¼æœ¬è´¨å°±æ˜¯ â€œæ²¡ç”¨çš„å¯¹è±¡è¿˜å ç€å†…å­˜ï¼Œåƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰å›æ”¶ä¸äº†â€ã€‚ä½ å­¦è¿‡çš„ â€œè™šæ‹Ÿå†…å­˜â€ ç†è®ºï¼Œåœ¨è¿™é‡Œä¹Ÿèƒ½ç”¨ä¸Š â€”â€” æµè§ˆå™¨çš„å†…å­˜å°±åƒ OS çš„ â€œç‰©ç†å†…å­˜â€ï¼Œå½“å†…å­˜ä¸å¤Ÿæ—¶ï¼Œä¼šæŠŠéƒ¨åˆ†ä¸å¸¸ç”¨æ•°æ®æ¢åˆ° â€œç£ç›˜ç¼“å­˜â€ï¼ˆæ¯”å¦‚é¡µé¢éšè—æ—¶çš„ç»„ä»¶çŠ¶æ€ï¼‰ï¼Œä½†å¦‚æœæœ‰å†…å­˜æ³„æ¼ï¼Œå†å¤§çš„ â€œè™šæ‹Ÿå†…å­˜â€ ä¹Ÿä¼šè¢«å æ»¡ï¼Œé¡µé¢å¿…ç„¶å¡é¡¿ã€‚</p>
<p>ç»™ä½ åˆ†äº« 3 ä¸ªå‰ç«¯å¼€å‘ä¸­ â€œç›´æ¥èƒ½ç”¨â€ çš„å†…å­˜ä¼˜åŒ–æŠ€å·§ï¼Œå…¨æ˜¯å­˜å‚¨ç®¡ç†ç†è®ºçš„è½åœ°ï¼š</p>
<h5 data-id="heading-4">ï¼ˆ1ï¼‰å¤§æ•°ç»„ / å¤§å¯¹è±¡å¤„ç†ï¼šç”¨ â€œåˆ†æ®µåŠ è½½â€ å¯¹åº” OS çš„ â€œåˆ†é¡µå­˜å‚¨â€</h5>
<p>OS çš„åˆ†é¡µå­˜å‚¨æ˜¯ â€œæŠŠå¤§ç¨‹åºæ‹†æˆå°é¡µé¢ï¼Œç”¨çš„æ—¶å€™å†åŠ è½½â€ï¼Œå‰ç«¯å¤„ç†å¤§æ•°æ®ä¹Ÿä¸€æ ·ã€‚æ¯”å¦‚ä½ è¦æ¸²æŸ“ 10 ä¸‡æ¡è¡¨æ ¼æ•°æ®ï¼Œç›´æ¥æŠŠæ•°ç»„ä¸¢ç»™ React/Vueï¼Œé¡µé¢ä¼šç¬é—´å¡æ­» â€”â€” å› ä¸ºä¸€æ¬¡æ€§å ç”¨å¤ªå¤šå†…å­˜ï¼Œè¿˜ä¼šè§¦å‘å¤§é‡ DOM æ¸²æŸ“ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">Â // é”™è¯¯åšæ³•ï¼šä¸€æ¬¡æ€§æ¸²æŸ“10ä¸‡æ¡æ•°æ®ï¼ˆå†…å­˜çˆ†ç‚¸ï¼‰
Â const <span class="hljs-section">[data, setData]</span> = useState(all100000Data)<span class="hljs-comment">;</span>
Â â€‹
Â // æ­£ç¡®åšæ³•ï¼šåˆ†æ®µåŠ è½½ï¼ˆå¯¹åº”OSåˆ†é¡µï¼‰
Â const <span class="hljs-section">[pageData, setPageData]</span> = useState(<span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>
Â const <span class="hljs-section">[currentPage, setCurrentPage]</span> = useState(1)<span class="hljs-comment">;</span>
Â const <span class="hljs-attr">pageSize</span> = <span class="hljs-number">100</span><span class="hljs-comment">; // æ¯é¡µ100æ¡ï¼ˆå¯¹åº”â€œé¡µé¢å¤§å°â€ï¼‰</span>
Â â€‹
Â // æ»šåŠ¨åˆ°åº•éƒ¨åŠ è½½ä¸‹ä¸€é¡µï¼ˆå¯¹åº”OSçš„â€œé¡µé¢ç½®æ¢â€ï¼‰
Â const <span class="hljs-attr">handleScroll</span> = () =&gt; {
Â  Â const <span class="hljs-attr">scrollTop</span> = document.documentElement.scrollTop<span class="hljs-comment">;</span>
Â  Â const <span class="hljs-attr">scrollHeight</span> = document.documentElement.scrollHeight<span class="hljs-comment">;</span>
Â  Â const <span class="hljs-attr">clientHeight</span> = document.documentElement.clientHeight<span class="hljs-comment">;</span>
Â  Â if (scrollTop + clientHeight &gt;= scrollHeight - 100) {
Â  Â  Â const <span class="hljs-attr">nextPageData</span> = all100000Data.slice(
Â  Â  Â  Â currentPage * pageSize,
Â  Â  Â   (currentPage + 1) * pageSize
Â  Â   )<span class="hljs-comment">;</span>
Â  Â  Â setPageData(<span class="hljs-section">[...pageData, ...nextPageData]</span>)<span class="hljs-comment">;</span>
Â  Â  Â setCurrentPage(currentPage + 1)<span class="hljs-comment">;</span>
Â   }
Â }<span class="hljs-comment">;</span>
</code></pre>
<p>è¿™ä¸ªé€»è¾‘å’Œ OS çš„ â€œåˆ†é¡µå­˜å‚¨â€ å®Œå…¨ä¸€è‡´ â€”â€”<code>pageSize</code>å°±æ˜¯ â€œé¡µé¢å¤§å°â€ï¼Œ<code>currentPage</code>å°±æ˜¯ â€œå½“å‰å†…å­˜ä¸­çš„é¡µé¢â€ï¼Œæ»šåŠ¨åŠ è½½å°±æ˜¯ â€œæŒ‰éœ€è°ƒå…¥é¡µé¢â€ï¼Œé¿å…ä¸€æ¬¡æ€§å ç”¨è¿‡å¤šå†…å­˜ã€‚ä½ åšåç«¯æ¥å£æ—¶ï¼Œåˆ†é¡µæŸ¥è¯¢å…¶å®ä¹Ÿæ˜¯åŒä¸€ä¸ªé“ç†ï¼</p>
<h5 data-id="heading-5">ï¼ˆ2ï¼‰é—­åŒ… / äº‹ä»¶ç›‘å¬ï¼šé¿å… â€œå†…å­˜æ³„æ¼â€ å¯¹åº” OS çš„ â€œå†…å­˜å›æ”¶â€</h5>
<p>OS é‡Œçš„ â€œå†…å­˜å›æ”¶â€ æ˜¯è¯†åˆ« â€œä¸å†è¢«å¼•ç”¨çš„å†…å­˜å—â€ï¼Œå‰ç«¯çš„å†…å­˜æ³„æ¼æœ¬è´¨æ˜¯ â€œæ²¡ç”¨çš„å¯¹è±¡è¿˜è¢«å¼•ç”¨â€â€”â€” æ¯”å¦‚ç»„ä»¶å¸è½½åï¼Œå®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬ã€é—­åŒ…è¿˜æ²¡æ¸…ç†ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">Â <span class="hljs-keyword">import</span> { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
Â â€‹
Â <span class="hljs-keyword">const</span> <span class="hljs-title function_">MyComponent</span> = (<span class="hljs-params"/>) =&gt; {
Â  Â <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
Â â€‹
Â  Â <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
Â  Â  Â <span class="hljs-comment">// å¼€å¯å®šæ—¶å™¨ï¼ˆä¼šå½¢æˆé—­åŒ…å¼•ç”¨countï¼‰</span>
Â  Â  Â <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
Â  Â  Â  Â <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);
Â  Â   }, <span class="hljs-number">1000</span>);
Â â€‹
Â  Â  Â <span class="hljs-comment">// ç»‘å®šå…¨å±€äº‹ä»¶ï¼ˆä¼šå¼•ç”¨ç»„ä»¶å†…çš„å‡½æ•°ï¼‰</span>
Â  Â  Â <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize);
Â â€‹
Â  Â  Â <span class="hljs-comment">// ç»„ä»¶å¸è½½æ—¶æ¸…ç†ï¼ˆå¯¹åº”OSçš„â€œé‡Šæ”¾å†…å­˜â€ï¼‰</span>
Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
Â  Â  Â  Â <span class="hljs-built_in">clearInterval</span>(timer); <span class="hljs-comment">// æ¸…ç†å®šæ—¶å™¨</span>
Â  Â  Â  Â <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize); <span class="hljs-comment">// è§£ç»‘äº‹ä»¶</span>
Â  Â   };
Â   }, []);
Â â€‹
Â  Â <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResize</span> = (<span class="hljs-params"/>) =&gt; {
Â  Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'çª—å£å¤§å°å˜åŒ–'</span>);
Â   };
Â â€‹
Â  Â <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
Â };
</code></pre>
<p>è€Œä¸”ç°åœ¨å‰ç«¯æ¡†æ¶ï¼ˆReact 18ã€Vue 3ï¼‰çš„ â€œè™šæ‹Ÿ DOMâ€â€œDiff ç®—æ³•â€ï¼Œæœ¬è´¨ä¹Ÿæ˜¯ â€œå†…å­˜ç®¡ç†ä¼˜åŒ–â€â€”â€” æ¯”å¦‚è™šæ‹Ÿ DOM æŠŠ DOM æ“ä½œå…ˆå­˜åœ¨å†…å­˜é‡Œï¼Œæ‰¹é‡æ›´æ–°ï¼Œé¿å…é¢‘ç¹æ“ä½œ â€œç£ç›˜çº§â€ çš„ DOMï¼ˆDOM æ“ä½œæ¯”å†…å­˜æ“ä½œæ…¢ 100 å€ä»¥ä¸Šï¼‰ï¼Œè¿™å’Œ OS ç”¨ â€œå†…å­˜ç¼“å†²â€ å‡å°‘ç£ç›˜ IO æ˜¯åŒä¸€ä¸ªæ€è·¯ï¼</p>
<h4 data-id="heading-6">3. å¤§æ–‡ä»¶ä¸Šä¼ ï¼šç”¨ â€œåˆ†ç‰‡ä¸Šä¼ â€ å¯¹åº” OS çš„ â€œåˆ†æ®µå­˜å‚¨â€</h4>
<p>åšåç«¯å¼€å‘è‚¯å®šå†™è¿‡å¤§æ–‡ä»¶ä¸Šä¼ æ¥å£å§ï¼Ÿæ¯”å¦‚ç”¨æˆ·ä¸Šä¼  1GB çš„è§†é¢‘ï¼Œå¦‚æœç›´æ¥ POST æ•´ä¸ªæ–‡ä»¶ï¼Œä¸ä»…å®¹æ˜“è¶…æ—¶ï¼Œè¿˜ä¼šè®©æœåŠ¡å™¨ç¬é—´å ç”¨å¤§é‡å†…å­˜ â€”â€” è¿™å°±åƒ OS é‡Œ â€œæŠŠä¸€ä¸ªå¤§æ–‡ä»¶ä¸€æ¬¡æ€§è¯»è¿›å†…å­˜â€ï¼Œå¿…ç„¶å¯¼è‡´èµ„æºè€—å°½ã€‚</p>
<p>OS çš„ â€œåˆ†æ®µå­˜å‚¨â€ æ˜¯ â€œæŠŠå¤§ç¨‹åºæ‹†æˆé€»è¾‘æ®µï¼ŒæŒ‰éœ€åŠ è½½â€ï¼Œå‰ç«¯çš„ â€œåˆ†ç‰‡ä¸Šä¼ â€ å°±æ˜¯è¿™ä¸ªç†è®ºçš„ç›´æ¥åº”ç”¨ï¼šæŠŠå¤§æ–‡ä»¶æ‹†æˆå°åˆ†ç‰‡ï¼ˆæ¯”å¦‚ 5MB / ç‰‡ï¼‰ï¼Œåˆ†æ‰¹ä¸Šä¼ ï¼ŒæœåŠ¡å™¨æ¥æ”¶åå†æ‹¼æ¥æˆå®Œæ•´æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">Â <span class="hljs-comment">// å‰ç«¯ï¼šå¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼ˆå¯¹åº”OSåˆ†æ®µå­˜å‚¨ï¼‰</span>
Â <span class="hljs-keyword">const</span> <span class="hljs-title function_">uploadLargeFile</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">file</span>) =&gt; {
Â  Â <span class="hljs-keyword">const</span> chunkSize = <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 5MB/ç‰‡ï¼ˆå¯¹åº”â€œæ®µå¤§å°â€ï¼‰</span>
Â  Â <span class="hljs-keyword">const</span> totalChunks = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(file.<span class="hljs-property">size</span> / chunkSize); <span class="hljs-comment">// æ€»ç‰‡æ•°</span>
Â  Â <span class="hljs-keyword">const</span> fileId = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-string">'-'</span> + file.<span class="hljs-property">name</span>; <span class="hljs-comment">// å”¯ä¸€æ ‡è¯†ï¼ˆé¿å…åˆ†ç‰‡æ··ä¹±ï¼‰</span>
Â â€‹
Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> chunkIndex = <span class="hljs-number">0</span>; chunkIndex &lt; totalChunks; chunkIndex++) {
Â  Â  Â <span class="hljs-comment">// åˆ‡å‰²åˆ†ç‰‡ï¼ˆå¯¹åº”OSâ€œæ‹†åˆ†é€»è¾‘æ®µâ€ï¼‰</span>
Â  Â  Â <span class="hljs-keyword">const</span> start = chunkIndex * chunkSize;
Â  Â  Â <span class="hljs-keyword">const</span> end = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(start + chunkSize, file.<span class="hljs-property">size</span>);
Â  Â  Â <span class="hljs-keyword">const</span> chunk = file.<span class="hljs-title function_">slice</span>(start, end);
Â â€‹
Â  Â  Â <span class="hljs-comment">// æ„é€ è¡¨å•æ•°æ®</span>
Â  Â  Â <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
Â  Â  Â formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'chunk'</span>, chunk);
Â  Â  Â formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'fileId'</span>, fileId);
Â  Â  Â formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'chunkIndex'</span>, chunkIndex);
Â  Â  Â formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'totalChunks'</span>, totalChunks);
Â â€‹
Â  Â  Â <span class="hljs-comment">// åˆ†æ‰¹ä¸Šä¼ ï¼ˆå¯¹åº”OSâ€œæŒ‰éœ€åŠ è½½æ®µâ€ï¼‰</span>
Â  Â  Â <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/upload/chunk'</span>, formData, {
Â  Â  Â  Â <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'multipart/form-data'</span> },
Â  Â  Â  Â <span class="hljs-attr">onUploadProgress</span>: <span class="hljs-function">(<span class="hljs-params">progress</span>) =&gt;</span> {
Â  Â  Â  Â  Â <span class="hljs-comment">// è®¡ç®—å•ä¸ªåˆ†ç‰‡çš„ä¸Šä¼ è¿›åº¦</span>
Â  Â  Â  Â  Â <span class="hljs-keyword">const</span> chunkProgress = progress.<span class="hljs-property">loaded</span> / progress.<span class="hljs-property">total</span>;
Â  Â  Â  Â  Â <span class="hljs-comment">// è®¡ç®—æ•´ä½“è¿›åº¦ï¼ˆå·²ä¸Šä¼ åˆ†ç‰‡æ•° + å½“å‰åˆ†ç‰‡è¿›åº¦ï¼‰</span>
Â  Â  Â  Â  Â <span class="hljs-keyword">const</span> totalProgress = (chunkIndex + chunkProgress) / totalChunks;
Â  Â  Â  Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ä¸Šä¼ è¿›åº¦ï¼š<span class="hljs-subst">${(totalProgress * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">2</span>)}</span>%`</span>);
Â  Â  Â   }
Â  Â   });
Â   }
Â â€‹
Â  Â <span class="hljs-comment">// æ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ å®Œæˆï¼Œé€šçŸ¥æœåŠ¡å™¨æ‹¼æ¥</span>
Â  Â <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/upload/merge'</span>, { fileId, <span class="hljs-attr">fileName</span>: file.<span class="hljs-property">name</span> });
Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ–‡ä»¶ä¸Šä¼ å®Œæˆï¼'</span>);
Â };
</code></pre>
<pre><code class="hljs language-less" lang="less">Â <span class="hljs-comment">// åç«¯ï¼ˆJavaç¤ºä¾‹ï¼‰ï¼šæ¥æ”¶åˆ†ç‰‡+åˆå¹¶æ–‡ä»¶ï¼ˆå¯¹åº”OSâ€œæ®µæ‹¼æ¥â€ï¼‰</span>
Â <span class="hljs-variable">@RestController</span>
Â <span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/api/upload"</span>)
Â public class UploadController {
Â  Â <span class="hljs-comment">// ä¸´æ—¶å­˜å‚¨åˆ†ç‰‡çš„ç›®å½•ï¼ˆå¯¹åº”OSâ€œä¸´æ—¶å†…å­˜â€ï¼‰</span>
Â  Â <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">TEMP_CHUNK_DIR</span> = "/<span class="hljs-selector-tag">tmp</span>/<span class="hljs-selector-tag">chunks</span>/";
Â â€‹
Â  Â <span class="hljs-comment">// æ¥æ”¶åˆ†ç‰‡</span>
Â  Â @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/chunk"</span>)
Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Result</span>&lt;?&gt; <span class="hljs-selector-tag">uploadChunk</span>(
Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"chunk"</span>) MultipartFile chunk,
Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"fileId"</span>) String fileId,
Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"chunkIndex"</span>) int chunkIndex) {
Â  Â  Â <span class="hljs-comment">// åˆ›å»ºæ–‡ä»¶IDå¯¹åº”çš„ä¸´æ—¶ç›®å½•ï¼ˆå¯¹åº”OSâ€œåˆ†æ®µå­˜å‚¨çš„æ®µç›®å½•â€ï¼‰</span>
Â  Â  Â <span class="hljs-selector-tag">File</span> <span class="hljs-selector-tag">chunkDir</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">File</span>(TEMP_CHUNK_DIR + fileId);
Â  Â  Â <span class="hljs-selector-tag">if</span> (!chunkDir.<span class="hljs-built_in">exists</span>()) {
Â  Â  Â  Â <span class="hljs-selector-tag">chunkDir</span><span class="hljs-selector-class">.mkdirs</span>();
Â  Â   }
Â â€‹
Â  Â  Â <span class="hljs-comment">// ä¿å­˜åˆ†ç‰‡ï¼ˆæ–‡ä»¶åç”¨chunkIndexå‘½åï¼Œé¿å…æ··ä¹±ï¼‰</span>
Â  Â  Â <span class="hljs-selector-tag">File</span> <span class="hljs-selector-tag">chunkFile</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">File</span>(chunkDir, chunkIndex + <span class="hljs-string">".part"</span>);
Â  Â  Â <span class="hljs-selector-tag">try</span> {
Â  Â  Â  Â <span class="hljs-selector-tag">chunk</span><span class="hljs-selector-class">.transferTo</span>(chunkFile);
Â  Â   } <span class="hljs-selector-tag">catch</span> (IOException e) {
Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"åˆ†ç‰‡ä¸Šä¼ å¤±è´¥"</span>);
Â  Â   }
Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.success</span>(<span class="hljs-string">"åˆ†ç‰‡ä¸Šä¼ æˆåŠŸ"</span>);
Â   }
Â â€‹
Â  Â <span class="hljs-comment">// åˆå¹¶åˆ†ç‰‡</span>
Â  Â @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/merge"</span>)
Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Result</span>&lt;?&gt; <span class="hljs-selector-tag">mergeChunks</span>(
Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"fileId"</span>) String fileId,
Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"fileName"</span>) String fileName) {
Â  Â  Â <span class="hljs-selector-tag">File</span> <span class="hljs-selector-tag">chunkDir</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">File</span>(TEMP_CHUNK_DIR + fileId);
Â  Â  Â <span class="hljs-selector-tag">File</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">chunks</span> = <span class="hljs-selector-tag">chunkDir</span><span class="hljs-selector-class">.listFiles</span>();
Â  Â  Â <span class="hljs-selector-tag">if</span> (chunks == null || chunks.length == <span class="hljs-number">0</span>) {
Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"æ²¡æœ‰æ‰¾åˆ°åˆ†ç‰‡æ–‡ä»¶"</span>);
Â  Â   }
Â â€‹
Â  Â  Â <span class="hljs-comment">// ç›®æ ‡æ–‡ä»¶ï¼ˆæœ€ç»ˆå­˜å‚¨è·¯å¾„ï¼Œå¯¹åº”OSâ€œæœ€ç»ˆå­˜å‚¨åœ°å€â€ï¼‰</span>
Â  Â  Â <span class="hljs-selector-tag">File</span> <span class="hljs-selector-tag">targetFile</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">File</span>(<span class="hljs-string">"/data/files/"</span> + fileName);
Â â€‹
Â  Â  Â <span class="hljs-comment">// æŒ‰åˆ†ç‰‡ç´¢å¼•æ’åºï¼Œä¾æ¬¡å†™å…¥ç›®æ ‡æ–‡ä»¶ï¼ˆå¯¹åº”OSâ€œæ®µæ‹¼æ¥â€ï¼‰</span>
Â  Â  Â <span class="hljs-selector-tag">Arrays</span><span class="hljs-selector-class">.sort</span>(chunks, (a, b) -&gt; {
Â  Â  Â  Â <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">indexA</span> = <span class="hljs-selector-tag">Integer</span><span class="hljs-selector-class">.parseInt</span>(a.<span class="hljs-built_in">getName</span>().<span class="hljs-built_in">split</span>(<span class="hljs-string">"\."</span>)[<span class="hljs-number">0</span>]);
Â  Â  Â  Â <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">indexB</span> = <span class="hljs-selector-tag">Integer</span><span class="hljs-selector-class">.parseInt</span>(b.<span class="hljs-built_in">getName</span>().<span class="hljs-built_in">split</span>(<span class="hljs-string">"\."</span>)[<span class="hljs-number">0</span>]);
Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">indexA</span> <span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">indexB</span>;
Â  Â   });
Â â€‹
Â  Â  Â <span class="hljs-selector-tag">try</span> (FileOutputStream out = new <span class="hljs-built_in">FileOutputStream</span>(targetFile)) {
Â  Â  Â  Â <span class="hljs-selector-tag">for</span> (File <span class="hljs-attribute">chunk </span>: chunks) {
Â  Â  Â  Â  Â <span class="hljs-selector-tag">try</span> (FileInputStream in = new <span class="hljs-built_in">FileInputStream</span>(chunk)) {
Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">byte</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">buffer</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">byte</span><span class="hljs-selector-attr">[1024]</span>;
Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">len</span>;
Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">while</span> ((len = in.<span class="hljs-built_in">read</span>(buffer)) != -<span class="hljs-number">1</span>) {
Â  Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">out</span><span class="hljs-selector-class">.write</span>(buffer, <span class="hljs-number">0</span>, len);
Â  Â  Â  Â  Â   }
Â  Â  Â  Â   }
Â  Â  Â  Â  Â <span class="hljs-comment">// å†™å…¥ååˆ é™¤ä¸´æ—¶åˆ†ç‰‡ï¼ˆå¯¹åº”OSâ€œé‡Šæ”¾ä¸´æ—¶å†…å­˜â€ï¼‰</span>
Â  Â  Â  Â  Â <span class="hljs-selector-tag">chunk</span><span class="hljs-selector-class">.delete</span>();
Â  Â  Â   }
Â  Â  Â  Â <span class="hljs-comment">// åˆ é™¤ä¸´æ—¶ç›®å½•</span>
Â  Â  Â  Â <span class="hljs-selector-tag">chunkDir</span><span class="hljs-selector-class">.delete</span>();
Â  Â   } <span class="hljs-selector-tag">catch</span> (IOException e) {
Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"æ–‡ä»¶åˆå¹¶å¤±è´¥"</span>);
Â  Â   }
Â â€‹
Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.success</span>(<span class="hljs-string">"æ–‡ä»¶ä¸Šä¼ å®Œæˆ"</span>);
Â   }
Â }
</code></pre>
<p>è€Œä¸”è¿™ä¸ªé€»è¾‘è¿˜èƒ½å»¶ä¼¸ â€”â€” æ¯”å¦‚ä½ åšè§†é¢‘ç‚¹æ’­æ—¶çš„ â€œæ–­ç‚¹ç»­ä¼ â€â€œåˆ†ç‰‡åŠ è½½â€ï¼Œç”šè‡³åç«¯çš„ â€œæ–‡ä»¶åˆ†å—å­˜å‚¨åˆ°åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ MinIOã€OSSï¼‰â€ï¼Œæœ¬è´¨éƒ½æ˜¯ â€œåˆ†æ®µå­˜å‚¨â€ çš„åº”ç”¨ã€‚å­˜å‚¨ç®¡ç†ä¸æ˜¯è®©ä½ å†™ OS å†…æ ¸ï¼Œè€Œæ˜¯è®©ä½ å­¦ä¼š â€œæ‹†åˆ†å¤§èµ„æºã€é«˜æ•ˆå¤„ç†å°èµ„æºâ€ çš„æ€ç»´ï¼</p>
<h3 data-id="heading-7">äºŒã€åç«¯å­˜å‚¨ï¼šä» â€œæ•°æ®åº“ + ç¼“å­˜â€ çœ‹å­˜å‚¨ç®¡ç†çš„æ ¸å¿ƒé€»è¾‘</h3>
<p>åç«¯å¼€å‘æ˜¯å­˜å‚¨ç®¡ç†çš„ â€œä¸»æˆ˜åœºâ€â€”â€” ä½ æ¯å¤©æ‰“äº¤é“çš„æ•°æ®åº“ã€ç¼“å­˜ã€ç£ç›˜ IOï¼Œå…¨æ˜¯ OS å­˜å‚¨ç®¡ç†ç†è®ºçš„ â€œæ”¾å¤§ç‰ˆâ€ã€‚æ¯”å¦‚ï¼šæ•°æ®åº“çš„åˆ†åº“åˆ†è¡¨å¯¹åº” OS çš„ â€œåˆ†åŒºå­˜å‚¨â€ï¼ŒRedis ç¼“å­˜å¯¹åº” OS çš„ â€œé«˜é€Ÿç¼“å­˜â€ï¼Œç´¢å¼•è®¾è®¡å¯¹åº” OS çš„ â€œå¿«é€ŸæŸ¥æ‰¾ç®—æ³•â€ï¼Œç”šè‡³ JVM çš„å†…å­˜é…ç½®éƒ½å’Œ OS çš„ â€œå†…å­˜åˆ†é…â€ æ¯æ¯ç›¸å…³ã€‚å’±ä»¬æŒ‘ 3 ä¸ªåç«¯å¼€å‘æœ€å¸¸ç”¨çš„åœºæ™¯ï¼Œæ‹†è§£ç†è®ºå¦‚ä½•è½åœ°ã€‚</p>
<h4 data-id="heading-8">1. æ•°æ®åº“ä¼˜åŒ–ï¼šåˆ†åº“åˆ†è¡¨ + ç´¢å¼•è®¾è®¡ï¼Œå¯¹åº” OS çš„ â€œåˆ†åŒºå­˜å‚¨ + å¿«é€ŸæŸ¥æ‰¾â€</h4>
<p>OS çš„ â€œåˆ†åŒºå­˜å‚¨â€ æ˜¯æŠŠå†…å­˜æ‹†æˆå¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºæ”¾ä¸åŒè¿›ç¨‹ï¼Œé¿å… â€œä¸€ä¸ªå¤§è¿›ç¨‹å æ»¡å†…å­˜â€ï¼›æ•°æ®åº“çš„åˆ†åº“åˆ†è¡¨æ˜¯æŠŠ â€œå¤§è¡¨æ‹†æˆå°è¡¨â€ï¼Œæ¯ä¸ªå°è¡¨æ”¾ä¸åŒæ•°æ®ï¼Œé¿å… â€œä¸€ä¸ªå¤§è¡¨æŸ¥è¯¢å æ»¡ç£ç›˜ IOâ€ã€‚ä¸¤è€…çš„æ ¸å¿ƒéƒ½æ˜¯ â€œæ‹†åˆ†å¤§èµ„æºï¼Œæå‡è®¿é—®æ•ˆç‡â€ã€‚</p>
<h5 data-id="heading-9">ï¼ˆ1ï¼‰åˆ†åº“åˆ†è¡¨ï¼šå¯¹åº” OS çš„ â€œåˆ†åŒºå­˜å‚¨â€</h5>
<p>OS çš„åˆ†åŒºæœ‰ â€œå›ºå®šåˆ†åŒºâ€â€œåŠ¨æ€åˆ†åŒºâ€ï¼Œæ•°æ®åº“çš„åˆ†åº“åˆ†è¡¨ä¹Ÿæœ‰ä¸¤ç§æ ¸å¿ƒæ–¹å¼ï¼š</p>
<ul>
<li><strong>æ°´å¹³åˆ†è¡¨ï¼ˆæŒ‰è¡Œæ‹†åˆ†ï¼‰</strong> ï¼šå¯¹åº” OS çš„ â€œæŒ‰è¿›ç¨‹åˆ†åŒºâ€â€”â€” æŠŠåŒä¸€è¡¨ä¸­çš„ä¸åŒè¡Œï¼Œæ‹†åˆ°ä¸åŒè¡¨ä¸­ã€‚æ¯”å¦‚è®¢å•è¡¨æŒ‰ â€œåˆ›å»ºæ—¶é—´â€ åˆ†è¡¨ï¼Œ<code>order_202401</code>ï¼ˆ2024 å¹´ 1 æœˆè®¢å•ï¼‰ã€<code>order_202402</code>ï¼ˆ2024 å¹´ 2 æœˆè®¢å•ï¼‰ï¼ŒæŸ¥è¯¢æ—¶åªéœ€è¦è®¿é—®å¯¹åº”æœˆä»½çš„è¡¨ï¼Œä¸ç”¨æ‰«æå…¨é‡æ•°æ®ã€‚</li>
<li><strong>å‚ç›´åˆ†è¡¨ï¼ˆæŒ‰åˆ—æ‹†åˆ†ï¼‰</strong> ï¼šå¯¹åº” OS çš„ â€œæŒ‰èµ„æºç±»å‹åˆ†åŒºâ€â€”â€” æŠŠåŒä¸€è¡¨ä¸­çš„ä¸åŒåˆ—ï¼Œæ‹†åˆ°ä¸åŒè¡¨ä¸­ã€‚æ¯”å¦‚ç”¨æˆ·è¡¨<code>user</code>æ‹†æˆ<code>user_base</code>ï¼ˆåŸºç¡€ä¿¡æ¯ï¼šidã€å§“åã€æ‰‹æœºå·ï¼‰å’Œ<code>user_extend</code>ï¼ˆæ‰©å±•ä¿¡æ¯ï¼šå¤´åƒã€ç®€ä»‹ã€åœ°å€ï¼‰ï¼ŒæŸ¥è¯¢ â€œç”¨æˆ·åˆ—è¡¨â€ æ—¶åªæŸ¥<code>user_base</code>ï¼Œé¿å…åŠ è½½ä¸éœ€è¦çš„å¤§å­—æ®µï¼ˆå¦‚å¤´åƒ URLï¼‰ã€‚</li>
</ul>
<p>âœ… å®æˆ˜æŠ€å·§ï¼šåˆ†åº“åˆ†è¡¨çš„ â€œåˆ†ç‰‡é”®â€ é€‰æ‹©ï¼Œè¦å¯¹åº” OS çš„ â€œåˆ†åŒºç­–ç•¥â€â€”â€” æ¯”å¦‚æŒ‰ â€œç”¨æˆ· ID å–æ¨¡â€ åˆ†åº“ï¼ˆ<code>user_id % 4</code> â†’ 4 ä¸ªåº“ï¼‰ï¼Œç¡®ä¿æ•°æ®å‡åŒ€åˆ†å¸ƒï¼Œé¿å… â€œæŸä¸ªåˆ†åŒºæ•°æ®è¿‡å¤šâ€ï¼ˆå¯¹åº” OS çš„ â€œåˆ†åŒºç¢ç‰‡â€ï¼‰ï¼›æŒ‰ â€œæ—¶é—´èŒƒå›´â€ åˆ†è¡¨æ—¶ï¼Œè¦æå‰è§„åˆ’åˆ†åŒºï¼ˆæ¯”å¦‚æ¯æœˆé¢„åˆ›å»ºä¸‹ä¸€ä¸ªæœˆçš„è¡¨ï¼‰ï¼Œé¿å… â€œåŠ¨æ€åˆ›å»ºåˆ†åŒºâ€ å¯¼è‡´çš„æ€§èƒ½æŠ–åŠ¨ã€‚</p>
<h5 data-id="heading-10">ï¼ˆ2ï¼‰ç´¢å¼•è®¾è®¡ï¼šå¯¹åº” OS çš„ â€œå¿«é€ŸæŸ¥æ‰¾â€</h5>
<p>OS é‡Œçš„ â€œé¡µè¡¨â€â€œå¿«è¡¨ï¼ˆTLBï¼‰â€ æ˜¯ä¸ºäº† â€œå¿«é€Ÿæ‰¾åˆ°å†…å­˜åœ°å€â€ï¼Œæ•°æ®åº“çš„ç´¢å¼•æ˜¯ä¸ºäº† â€œå¿«é€Ÿæ‰¾åˆ°æ•°æ®è¡Œâ€â€”â€” ä¸¤è€…éƒ½æ˜¯ â€œç©ºé—´æ¢æ—¶é—´â€ çš„æ€è·¯ï¼šç”¨é¢å¤–çš„å­˜å‚¨ï¼ˆç´¢å¼• / é¡µè¡¨ï¼‰ï¼Œæ¢å–æ›´å¿«çš„æŸ¥è¯¢é€Ÿåº¦ã€‚</p>
<p>æˆ‘ä¹‹å‰ç»™è®¢å•è¡¨åŠ äº†ç´¢å¼•ï¼Œåè€ŒæŸ¥è¯¢æ›´æ…¢äº†ï¼è¿™æ˜¯ä¸ºå•¥ï¼Ÿ</p>
<p>è¿™å°±æ˜¯æ²¡ç†è§£ â€œç´¢å¼•çš„å­˜å‚¨æˆæœ¬â€â€”â€”OS çš„å¿«è¡¨ï¼ˆTLBï¼‰å®¹é‡æœ‰é™ï¼Œå¤ªå¤šé¡µè¡¨é¡¹ä¼šå¯¼è‡´ â€œå¿«è¡¨å‘½ä¸­ç‡ä¸‹é™â€ï¼›æ•°æ®åº“çš„ç´¢å¼•ä¹Ÿä¸€æ ·ï¼Œç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè¿‡å¤šç´¢å¼•ä¼šå¯¼è‡´ï¼š</p>
<ol>
<li><strong>å†™æ“ä½œå˜æ…¢</strong>ï¼šæ’å…¥ / æ›´æ–° / åˆ é™¤æ•°æ®æ—¶ï¼Œä¸ä»…è¦æ”¹æ•°æ®ï¼Œè¿˜è¦åŒæ­¥æ›´æ–°æ‰€æœ‰ç›¸å…³ç´¢å¼•ï¼ˆå¯¹åº” OS â€œæ›´æ–°é¡µè¡¨çš„å¼€é”€â€ï¼‰ï¼›</li>
<li><strong>ç´¢å¼•ç¢ç‰‡</strong>ï¼šé¢‘ç¹åˆ é™¤æ•°æ®ä¼šå¯¼è‡´ç´¢å¼•æ–‡ä»¶äº§ç”Ÿç¢ç‰‡ï¼ŒæŸ¥è¯¢æ—¶éœ€è¦æ‰«ææ›´å¤š â€œç´¢å¼•é¡µâ€ï¼ˆå¯¹åº” OS çš„ â€œå†…å­˜ç¢ç‰‡â€ï¼‰ã€‚</li>
</ol>
<p>âœ… åç«¯ç´¢å¼•è®¾è®¡å®æˆ˜åŸåˆ™ï¼ˆå¯¹åº” OSâ€œå¿«é€ŸæŸ¥æ‰¾ + ä½å¼€é”€â€ï¼‰ï¼š</p>
<ul>
<li>åªç»™ â€œæŸ¥è¯¢é¢‘ç¹çš„å­—æ®µâ€ å»ºç´¢å¼•ï¼ˆæ¯”å¦‚è®¢å•è¡¨çš„<code>user_id</code>ã€<code>order_no</code>ï¼‰ï¼Œé¿å…ç»™ â€œæ›´æ–°é¢‘ç¹çš„å­—æ®µâ€ å»ºç´¢å¼•ï¼ˆæ¯”å¦‚<code>status</code>å­—æ®µï¼Œè®¢å•çŠ¶æ€ç»å¸¸å˜åŒ–ï¼‰ï¼›</li>
<li>è”åˆç´¢å¼•è¦éµå¾ª â€œæœ€å·¦å‰ç¼€åŸåˆ™â€ï¼ˆæ¯”å¦‚<code>idx_user_time</code>ï¼ˆuser_id, create_timeï¼‰ï¼Œèƒ½å‘½ä¸­<code>where user_id=?</code>æˆ–<code>where user_id=? and create_time=?</code>ï¼Œä½†ä¸èƒ½å‘½ä¸­<code>where create_time=?</code>ï¼‰ï¼Œè¿™å°±åƒ OS çš„ â€œé¡µè¡¨æŸ¥æ‰¾è¦æŒ‰åœ°å€é¡ºåºâ€ï¼Œé¿å…æ— åºæŸ¥æ‰¾ï¼›</li>
<li>ç”¨ â€œè¦†ç›–ç´¢å¼•â€ å‡å°‘å›è¡¨ï¼ˆæ¯”å¦‚æŸ¥è¯¢<code>user_id=?</code>çš„è®¢å•å·å’Œåˆ›å»ºæ—¶é—´ï¼Œç›´æ¥å»º<code>idx_user_order_time</code>ï¼ˆuser_id, order_no, create_timeï¼‰ï¼Œç´¢å¼•ä¸­åŒ…å«æ‰€æœ‰éœ€è¦çš„å­—æ®µï¼Œä¸ç”¨å†æŸ¥ä¸»è¡¨ï¼‰ï¼Œå¯¹åº” OS çš„ â€œå¿«è¡¨ç›´æ¥è¿”å›åœ°å€ï¼Œä¸ç”¨æŸ¥é¡µè¡¨â€ã€‚</li>
</ul>
<h4 data-id="heading-11">2. ç¼“å­˜ç­–ç•¥ï¼šRedis çš„åº”ç”¨ï¼Œå¯¹åº” OS çš„ â€œé«˜é€Ÿç¼“å­˜â€</h4>
<p>OS çš„ â€œé«˜é€Ÿç¼“å­˜ï¼ˆCacheï¼‰â€ æ˜¯ä¸ºäº† â€œè®© CPU å¿«é€Ÿè®¿é—®å¸¸ç”¨æ•°æ®â€ï¼Œé¿å…é¢‘ç¹è®¿é—®æ…¢é€Ÿå†…å­˜ï¼›åç«¯çš„ Redis ç¼“å­˜æ˜¯ä¸ºäº† â€œè®©åº”ç”¨å¿«é€Ÿè®¿é—®å¸¸ç”¨æ•°æ®â€ï¼Œé¿å…é¢‘ç¹è®¿é—®æ…¢é€Ÿæ•°æ®åº“ â€”â€” ä¸¤è€…çš„æ ¸å¿ƒé€»è¾‘å®Œå…¨ä¸€è‡´ï¼šâ€œæŠŠå¸¸ç”¨æ•°æ®æ”¾åˆ°æ›´å¿«çš„å­˜å‚¨ä»‹è´¨ä¸­â€ã€‚</p>
<p>ä½ å­¦è¿‡çš„ â€œç¼“å­˜æ›¿æ¢ç®—æ³•â€ï¼ˆLRUã€FIFOã€LFUï¼‰ï¼Œåœ¨ Redis é‡Œç›´æ¥å°±èƒ½ç”¨ï¼æ¯”å¦‚ï¼š</p>
<h5 data-id="heading-12">ï¼ˆ1ï¼‰Redis ç¼“å­˜é…ç½®ï¼šç›´æ¥åº”ç”¨ â€œç¼“å­˜æ›¿æ¢ç®—æ³•â€</h5>
<p>OS çš„ â€œé¡µé¢ç½®æ¢ç®—æ³•â€ æ˜¯ä¸ºäº† â€œå½“ç¼“å­˜æ»¡äº†ï¼Œæ·˜æ±°ä¸å¸¸ç”¨çš„é¡µé¢â€ï¼ŒRedis çš„<code>maxmemory-policy</code>é…ç½®å°±æ˜¯å¹²è¿™ä¸ªçš„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Â <span class="hljs-comment"># Redisé…ç½®æ–‡ä»¶ï¼ˆredis.confï¼‰</span>
Â maxmemory 4gb <span class="hljs-comment"># ç¼“å­˜æœ€å¤§å®¹é‡ï¼ˆå¯¹åº”OSç¼“å­˜å¤§å°ï¼‰</span>
Â maxmemory-policy allkeys-lru <span class="hljs-comment"># å½“ç¼“å­˜æ»¡äº†ï¼Œæ·˜æ±°æ‰€æœ‰keyä¸­æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ï¼ˆLRUç®—æ³•ï¼‰</span>
</code></pre>
<p>âœ… å®æˆ˜åœºæ™¯ï¼šä½ åšç”µå•†çš„ â€œå•†å“è¯¦æƒ…é¡µâ€ æ¥å£ï¼Œæ¯å¤©æœ‰ 10 ä¸‡æ¬¡è®¿é—®ï¼Œå…¶ä¸­ 80% æ˜¯è®¿é—®çƒ­é—¨å•†å“ï¼ˆæ¯”å¦‚é”€é‡å‰ 100 çš„å•†å“ï¼‰ã€‚å¦‚æœæ¯æ¬¡éƒ½æŸ¥æ•°æ®åº“ï¼Œæ•°æ®åº“è‚¯å®šæ‰›ä¸ä½ â€”â€” è¿™æ—¶å€™å°±ç”¨ Redis ç¼“å­˜ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">Â <span class="hljs-comment">// åç«¯æ¥å£ï¼ˆJava+Spring Bootï¼‰ï¼šç¼“å­˜+æ•°æ®åº“çš„â€œåŒè¯»åŒå†™â€</span>
Â <span class="hljs-meta">@Service</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductService</span> {
Â  Â <span class="hljs-meta">@Autowired</span>
Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">RedisTemplate</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Product</span>&gt; redisTemplate;
Â  Â <span class="hljs-meta">@Autowired</span>
Â  Â <span class="hljs-keyword">private</span> <span class="hljs-title class_">ProductMapper</span> productMapper;
Â â€‹
Â  Â <span class="hljs-comment">// ç¼“å­˜keyå‰ç¼€ï¼ˆå¯¹åº”OSâ€œç¼“å­˜åœ°å€å‰ç¼€â€ï¼‰</span>
Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">CACHE_KEY_PRODUCT</span> = <span class="hljs-string">"product:"</span>;
Â â€‹
Â  Â <span class="hljs-comment">// æŸ¥è¯¢å•†å“è¯¦æƒ…ï¼šå…ˆæŸ¥ç¼“å­˜ï¼Œå†æŸ¥æ•°æ®åº“ï¼ˆå¯¹åº”OSâ€œå…ˆæŸ¥Cacheï¼Œå†æŸ¥å†…å­˜â€ï¼‰</span>
Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">Product</span> <span class="hljs-title function_">getProductById</span>(<span class="hljs-params">Long productId</span>) {
Â  Â  Â <span class="hljs-title class_">String</span> cacheKey = <span class="hljs-variable constant_">CACHE_KEY_PRODUCT</span> + productId;
Â  Â  Â <span class="hljs-comment">// 1. å…ˆæŸ¥Redisç¼“å­˜ï¼ˆé«˜é€Ÿç¼“å­˜ï¼‰</span>
Â  Â  Â <span class="hljs-title class_">Product</span> product = redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">get</span>(cacheKey);
Â  Â  Â <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
Â  Â  Â  Â <span class="hljs-keyword">return</span> product; <span class="hljs-comment">// ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›ï¼ˆå¯¹åº”OS Cacheå‘½ä¸­ï¼‰</span>
Â  Â   }
Â â€‹
Â  Â  Â <span class="hljs-comment">// 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“ï¼ˆæ…¢é€Ÿå­˜å‚¨ï¼‰</span>
Â  Â  Â product = productMapper.<span class="hljs-title function_">selectById</span>(productId);
Â  Â  Â <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
Â  Â  Â  Â <span class="hljs-comment">// 3. æŠŠæ•°æ®åº“æŸ¥è¯¢ç»“æœå­˜å…¥ç¼“å­˜ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆé¿å…ç¼“å­˜æ•°æ®è¿‡æœŸï¼‰</span>
Â  Â  Â  Â redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">set</span>(cacheKey, product, <span class="hljs-number">1</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">HOURS</span>);
Â  Â   }
Â  Â  Â <span class="hljs-keyword">return</span> product;
Â   }
Â â€‹
Â  Â <span class="hljs-comment">// æ›´æ–°å•†å“ä¿¡æ¯ï¼šå…ˆæ›´æ•°æ®åº“ï¼Œå†æ›´ç¼“å­˜ï¼ˆå¯¹åº”OSâ€œå†™å›Cacheâ€ï¼‰</span>
Â  Â <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">updateProduct</span>(<span class="hljs-params">Product product</span>) {
Â  Â  Â <span class="hljs-comment">// 1. å…ˆæ›´æ–°æ•°æ®åº“</span>
Â  Â  Â <span class="hljs-built_in">boolean</span> success = productMapper.<span class="hljs-title function_">updateById</span>(product) &gt; <span class="hljs-number">0</span>;
Â  Â  Â <span class="hljs-keyword">if</span> (success) {
Â  Â  Â  Â <span class="hljs-title class_">String</span> cacheKey = <span class="hljs-variable constant_">CACHE_KEY_PRODUCT</span> + product.<span class="hljs-title function_">getId</span>();
Â  Â  Â  Â <span class="hljs-comment">// 2. æ›´æ–°ç¼“å­˜ï¼ˆæˆ–åˆ é™¤ç¼“å­˜ï¼Œè®©ä¸‹æ¬¡æŸ¥è¯¢é‡æ–°åŠ è½½ï¼‰</span>
Â  Â  Â  Â redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">set</span>(cacheKey, product, <span class="hljs-number">1</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">HOURS</span>);
Â  Â   }
Â  Â  Â <span class="hljs-keyword">return</span> success;
Â   }
Â }
</code></pre>
<h5 data-id="heading-13">ï¼ˆ2ï¼‰ç¼“å­˜ä¸‰å¤§é—®é¢˜ï¼šç”¨ OS â€œç¼“å­˜ç®¡ç†â€ æ€è·¯è§£å†³</h5>
<p>OS é‡Œæœ‰ â€œç¼“å­˜ä¸€è‡´æ€§â€ é—®é¢˜ï¼ˆæ¯”å¦‚ Cache å’Œå†…å­˜æ•°æ®ä¸ä¸€è‡´ï¼‰ï¼ŒRedis ç¼“å­˜ä¹Ÿæœ‰ä¸‰å¤§ç»å…¸é—®é¢˜ â€”â€” ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©ï¼Œè§£å†³æ€è·¯å®Œå…¨å€Ÿé‰´ OS çš„ â€œç¼“å­˜ç®¡ç†â€ï¼š</p>





























<table><thead><tr><th>ç¼“å­˜é—®é¢˜</th><th>æœ¬è´¨åŸå› </th><th>è§£å†³æ€è·¯ï¼ˆå¯¹åº” OS ç†è®ºï¼‰</th><th>å®æˆ˜æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>ç¼“å­˜ç©¿é€</td><td>æŸ¥ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜å’Œæ•°æ®åº“éƒ½æ²¡å‘½ä¸­</td><td>OS â€œç¼“å­˜æœªå‘½ä¸­å¤„ç†â€</td><td>1. ç©ºå€¼ç¼“å­˜ï¼ˆä¸å­˜åœ¨çš„ key å­˜ç©ºå€¼ï¼Œè¿‡æœŸæ—¶é—´ 5 åˆ†é’Ÿï¼‰ï¼›2. å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆæå‰è¿‡æ»¤ä¸å­˜åœ¨çš„ keyï¼‰</td></tr><tr><td>ç¼“å­˜å‡»ç©¿</td><td>çƒ­é—¨ key è¿‡æœŸï¼Œå¤§é‡è¯·æ±‚åŒæ—¶æŸ¥æ•°æ®åº“</td><td>OS â€œç¼“å­˜å¤±æ•ˆä¿æŠ¤â€</td><td>1. äº’æ–¥é”ï¼ˆåŒä¸€æ—¶é—´åªè®©ä¸€ä¸ªè¯·æ±‚æŸ¥æ•°æ®åº“ï¼Œå…¶ä»–è¯·æ±‚ç­‰ç¼“å­˜ï¼‰ï¼›2. çƒ­ç‚¹ key æ°¸ä¸è¿‡æœŸ</td></tr><tr><td>ç¼“å­˜é›ªå´©</td><td>å¤§é‡ key åŒæ—¶è¿‡æœŸï¼Œæˆ– Redis å®•æœºï¼Œè¯·æ±‚å…¨æ‰“æ•°æ®åº“</td><td>OS â€œç¼“å­˜å®¹é”™æœºåˆ¶â€</td><td>1. è¿‡æœŸæ—¶é—´åŠ éšæœºå€¼ï¼ˆé¿å…åŒæ—¶è¿‡æœŸï¼‰ï¼›2. Redis é›†ç¾¤ï¼ˆé¿å…å•ç‚¹æ•…éšœï¼‰ï¼›3. é™çº§ç†”æ–­ï¼ˆRedis å®•æœºæ—¶ï¼Œè¿”å›é»˜è®¤æ•°æ®ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-14">3. JVM å†…å­˜é…ç½®ï¼šå¯¹åº” OS çš„ â€œå†…å­˜åˆ†é…ä¸å›æ”¶â€</h4>
<h5 data-id="heading-15">ï¼ˆ1ï¼‰JVM å †å†…å­˜åˆ†é…ï¼šå¯¹åº” OS çš„ â€œå†…å­˜åˆ†åŒºâ€</h5>
<p>OS æŠŠå†…å­˜åˆ†æˆ â€œç”¨æˆ·åŒºã€å†…æ ¸åŒºâ€ï¼ŒJVM æŠŠå †å†…å­˜åˆ†æˆ â€œå¹´è½»ä»£ã€è€å¹´ä»£ã€å…ƒç©ºé—´â€â€”â€” éƒ½æ˜¯ä¸ºäº† â€œæŒ‰æ•°æ®ç‰¹æ€§åˆ†é…ä¸åŒç©ºé—´ï¼Œä¼˜åŒ–ç®¡ç†æ•ˆç‡â€ã€‚</p>
<p>âœ… å®æˆ˜é…ç½®ï¼ˆSpring Boot é¡¹ç›®å¯åŠ¨å‚æ•°ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Â <span class="hljs-comment"># JVMå¯åŠ¨å‚æ•°ï¼ˆå¯¹åº”OSå†…å­˜åˆ†é…ï¼‰</span>
Â java -jar your-project.jar \
Â -Xms4g \ <span class="hljs-comment"># åˆå§‹å †å†…å­˜ï¼ˆå¯¹åº”OSåˆå§‹å†…å­˜åˆ†é…ï¼‰</span>
Â -Xmx8g \ <span class="hljs-comment"># æœ€å¤§å †å†…å­˜ï¼ˆå¯¹åº”OSæœ€å¤§å†…å­˜é™åˆ¶ï¼‰</span>
Â -XX:<span class="hljs-attr">NewRatio</span>=<span class="hljs-number">2</span> \ <span class="hljs-comment"># å¹´è½»ä»£:è€å¹´ä»£=1:2ï¼ˆå¹´è½»ä»£å­˜çŸ­æœŸå¯¹è±¡ï¼Œè€å¹´ä»£å­˜é•¿æœŸå¯¹è±¡ï¼‰</span>
Â -XX:<span class="hljs-attr">SurvivorRatio</span>=<span class="hljs-number">8</span> \ <span class="hljs-comment"># å¹´è½»ä»£ä¸­EdenåŒº:SurvivoråŒº=8:2ï¼ˆEdenåŒºå­˜æ–°åˆ›å»ºå¯¹è±¡ï¼ŒSurvivoråŒºå­˜å­˜æ´»å¯¹è±¡ï¼‰</span>
Â -XX:+UseG1GC \ <span class="hljs-comment"># ä½¿ç”¨G1åƒåœ¾å›æ”¶å™¨ï¼ˆå¯¹åº”OSçš„â€œé«˜æ•ˆå†…å­˜å›æ”¶ç®—æ³•â€ï¼‰</span>
</code></pre>
<h5 data-id="heading-16">ï¼ˆ2ï¼‰å†…å­˜æ³„æ¼æ’æŸ¥ï¼šå¯¹åº” OS çš„ â€œå†…å­˜æ³„æ¼æ£€æµ‹â€</h5>
<p>OS çš„ â€œå†…å­˜æ³„æ¼â€ æ˜¯ â€œè¿›ç¨‹å ç”¨å†…å­˜ä¸é‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜è€—å°½â€ï¼ŒJVM çš„ â€œå†…å­˜æ³„æ¼â€ æ˜¯ â€œå¯¹è±¡å ç”¨å †å†…å­˜ä¸é‡Šæ”¾ï¼Œå¯¼è‡´ OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰â€â€”â€” æ’æŸ¥æ€è·¯å®Œå…¨ä¸€è‡´ï¼šâ€œæ‰¾åˆ°ä¸è¢«å¼•ç”¨ä½†è¿˜å ç”¨å†…å­˜çš„å¯¹è±¡â€ã€‚</p>
<p>âœ… å®æˆ˜å·¥å…·ï¼šç”¨<code>jmap</code>+<code>MAT</code>å·¥å…·æ’æŸ¥å†…å­˜æ³„æ¼ï¼Œå°±åƒ OS ç”¨ â€œå†…å­˜æ£€æµ‹å·¥å…·â€ æ’æŸ¥æ³„æ¼ä¸€æ ·ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Â <span class="hljs-comment"># 1. æŸ¥çœ‹JVMè¿›ç¨‹ID</span>
Â jps -l
Â â€‹
Â <span class="hljs-comment"># 2. å¯¼å‡ºå †å†…å­˜å¿«ç…§ï¼ˆå¯¹åº”OSå¯¼å‡ºå†…å­˜çŠ¶æ€ï¼‰</span>
Â jmap -dump:<span class="hljs-attr">format</span>=b,file=heapdump.hprof <span class="hljs-number">12345</span>ï¼ˆè¿›ç¨‹IDï¼‰
Â â€‹
Â <span class="hljs-comment"># 3. ç”¨MATå·¥å…·ï¼ˆMemory Analyzer Toolï¼‰åˆ†æå¿«ç…§ï¼Œæ‰¾åˆ°å†…å­˜æ³„æ¼ç‚¹</span>
</code></pre>
<p>ğŸ“Œ å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯ï¼ˆå¯¹åº” OS â€œå†…å­˜æ³„æ¼åŸå› â€ï¼‰ï¼š</p>
<ul>
<li>é™æ€é›†åˆç±»ï¼ˆå¦‚<code>static List</code>ï¼‰æŒæœ‰å¤§é‡å¯¹è±¡ï¼Œä¸åŠæ—¶æ¸…ç†ï¼ˆå¯¹åº” OS â€œé™æ€å†…å­˜ä¸é‡Šæ”¾â€ï¼‰ï¼›</li>
<li>çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°è®¾ç½®è¿‡å¤§ï¼Œä¸”çº¿ç¨‹æŒæœ‰å¤§é‡å¯¹è±¡ï¼ˆå¯¹åº” OS â€œè¿›ç¨‹æŒæœ‰å†…å­˜ä¸é‡Šæ”¾â€ï¼‰ï¼›</li>
<li>è¿æ¥æ± ï¼ˆæ•°æ®åº“è¿æ¥æ± ã€Redis è¿æ¥æ± ï¼‰æœªå…³é—­è¿æ¥ï¼ˆå¯¹åº” OS â€œèµ„æºå¥æŸ„æœªé‡Šæ”¾â€ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-17">ä¸‰ã€å…¨æ ˆååŒï¼šå­˜å‚¨ç®¡ç†çš„ â€œè·¨ç«¯ä¼˜åŒ–â€ æŠ€å·§</h3>
<h4 data-id="heading-18">1. å‰åç«¯æ•°æ®åŒæ­¥ï¼šå¯¹åº” OS çš„ â€œæ•°æ®ä¸€è‡´æ€§â€</h4>
<p>OS è¦ä¿è¯ â€œCache å’Œå†…å­˜æ•°æ®ä¸€è‡´â€ï¼Œå‰åç«¯è¦ä¿è¯ â€œæœ¬åœ°å­˜å‚¨å’Œæ•°æ®åº“æ•°æ®ä¸€è‡´â€ã€‚æ¯”å¦‚ä½ åš â€œç¦»çº¿è¡¨å•â€ åŠŸèƒ½ï¼š</p>
<p>âœ… å®æˆ˜åœºæ™¯ï¼šç”¨æˆ·åœ¨å‰ç«¯å¡«å†™è¡¨å•ï¼ˆæ¯”å¦‚æŠ¥é”€å•ï¼‰ï¼Œå¡«å†™è¿‡ç¨‹ä¸­ç½‘ç»œæ–­å¼€ â€”â€” è¿™æ—¶å€™å‰ç«¯æŠŠè¡¨å•æ•°æ®å­˜åˆ° IndexedDBï¼ˆå¯¹åº” OS â€œæœ¬åœ°ç¼“å­˜â€ï¼‰ï¼Œç½‘ç»œæ¢å¤åï¼Œè‡ªåŠ¨åŒæ­¥åˆ°åç«¯æ•°æ®åº“ï¼ˆå¯¹åº” OS â€œç¼“å­˜å†™å›å†…å­˜â€ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">Â <span class="hljs-comment">// å‰ç«¯ï¼šç¦»çº¿å­˜å‚¨+è‡ªåŠ¨åŒæ­¥</span>
Â <span class="hljs-keyword">const</span> <span class="hljs-title function_">saveFormOffline</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">formData</span>) =&gt; {
Â  Â <span class="hljs-comment">// 1. å­˜å…¥IndexedDBï¼ˆç¦»çº¿å­˜å‚¨ï¼Œå¯¹åº”OSæœ¬åœ°ç¼“å­˜ï¼‰</span>
Â  Â <span class="hljs-keyword">await</span> indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'FormDB'</span>, <span class="hljs-number">1</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">db</span> =&gt;</span> {
Â  Â  Â <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">'offlineForms'</span>, <span class="hljs-string">'readwrite'</span>);
Â  Â  Â <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'offlineForms'</span>);
Â  Â  Â store.<span class="hljs-title function_">add</span>({
Â  Â  Â  Â <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
Â  Â  Â  Â formData,
Â  Â  Â  Â <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span>, <span class="hljs-comment">// çŠ¶æ€ï¼šå¾…åŒæ­¥</span>
Â  Â  Â  Â <span class="hljs-attr">createTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
Â  Â   });
Â   });
Â â€‹
Â  Â <span class="hljs-comment">// 2. ç›‘å¬ç½‘ç»œæ¢å¤ï¼Œè‡ªåŠ¨åŒæ­¥åˆ°åç«¯</span>
Â  Â <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'online'</span>, <span class="hljs-keyword">async</span> () =&gt; {
Â  Â  Â <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'FormDB'</span>, <span class="hljs-number">1</span>);
Â  Â  Â <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-string">'offlineForms'</span>, <span class="hljs-string">'readwrite'</span>);
Â  Â  Â <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'offlineForms'</span>);
Â  Â  Â <span class="hljs-keyword">const</span> pendingForms = <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">getAll</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span> });
Â â€‹
Â  Â  Â <span class="hljs-comment">// æ‰¹é‡åŒæ­¥åˆ°åç«¯</span>
Â  Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> form <span class="hljs-keyword">of</span> pendingForms) {
Â  Â  Â  Â <span class="hljs-keyword">try</span> {
Â  Â  Â  Â  Â <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/form/submit'</span>, form.<span class="hljs-property">formData</span>);
Â  Â  Â  Â  Â <span class="hljs-comment">// åŒæ­¥æˆåŠŸï¼Œæ›´æ–°çŠ¶æ€ä¸ºâ€œå·²åŒæ­¥â€ï¼ˆå¯¹åº”OSâ€œç¼“å­˜å†™å›æˆåŠŸâ€ï¼‰</span>
Â  Â  Â  Â  Â store.<span class="hljs-title function_">put</span>({ ...form, <span class="hljs-attr">status</span>: <span class="hljs-string">'synced'</span> });
Â  Â  Â   } <span class="hljs-keyword">catch</span> (error) {
Â  Â  Â  Â  Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åŒæ­¥å¤±è´¥ï¼Œä¸‹æ¬¡é‡è¯•'</span>, error);
Â  Â  Â   }
Â  Â   }
Â   });
Â };
</code></pre>
<h4 data-id="heading-19">2. åˆ†å¸ƒå¼å­˜å‚¨ï¼šå¯¹åº” OS çš„ â€œå¤–éƒ¨å­˜å‚¨ç®¡ç†â€</h4>
<p>OS ç®¡ç† â€œæœ¬åœ°ç£ç›˜ã€U ç›˜â€ ç­‰å¤–éƒ¨å­˜å‚¨ï¼Œåç«¯ç®¡ç† â€œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆOSSã€MinIOï¼‰ã€åˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆMySQL é›†ç¾¤ï¼‰â€â€”â€” æ ¸å¿ƒé€»è¾‘éƒ½æ˜¯ â€œç®¡ç†å¤šä¸ªå­˜å‚¨èŠ‚ç‚¹ï¼Œå®ç°å®¹é‡æ‰©å±•ã€é«˜å¯ç”¨â€ã€‚</p>
<p>âœ… å®æˆ˜åœºæ™¯ï¼šä½ åšçš„ç”µå•†é¡¹ç›®ï¼Œç”¨æˆ·ä¸Šä¼ çš„å•†å“å›¾ç‰‡ã€è§†é¢‘ï¼Œä¸èƒ½å­˜åœ¨å•å°æœåŠ¡å™¨çš„æœ¬åœ°ç£ç›˜ï¼ˆå¯¹åº” OS â€œæœ¬åœ°ç£ç›˜å®¹é‡æœ‰é™â€ï¼‰ï¼Œè¦å­˜åˆ°åˆ†å¸ƒå¼å­˜å‚¨ï¼ˆå¦‚é˜¿é‡Œäº‘ OSSï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java">Â <span class="hljs-comment">// åç«¯ï¼šæ–‡ä»¶ä¸Šä¼ åˆ°OSSï¼ˆå¯¹åº”OSâ€œå¤–éƒ¨å­˜å‚¨å†™å…¥â€ï¼‰</span>
Â <span class="hljs-meta">@Service</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OssService</span> {
Â  Â <span class="hljs-meta">@Autowired</span>
Â  Â <span class="hljs-keyword">private</span> OSSClient ossClient;
Â â€‹
Â  Â <span class="hljs-comment">// OSSé…ç½®ï¼ˆå¯¹åº”OSå¤–éƒ¨å­˜å‚¨é…ç½®ï¼‰</span>
Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BUCKET_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"your-bucket"</span>;
Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ENDPOINT</span> <span class="hljs-operator">=</span> <span class="hljs-string">"oss-cn-beijing.aliyuncs.com"</span>;
Â â€‹
Â  Â <span class="hljs-keyword">public</span> String <span class="hljs-title function_">uploadFile</span><span class="hljs-params">(MultipartFile file)</span> <span class="hljs-keyword">throws</span> IOException {
Â  Â  Â <span class="hljs-comment">// 1. ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼ˆé¿å…æ–‡ä»¶é‡åï¼Œå¯¹åº”OSâ€œæ–‡ä»¶å”¯ä¸€æ ‡è¯†â€ï¼‰</span>
Â  Â  Â <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString() + <span class="hljs-string">"."</span> + FilenameUtils.getExtension(file.getOriginalFilename());
Â  Â  Â <span class="hljs-comment">// 2. ä¸Šä¼ æ–‡ä»¶åˆ°OSSï¼ˆå¤–éƒ¨å­˜å‚¨ï¼‰</span>
Â  Â  Â ossClient.putObject(
Â  Â  Â  Â BUCKET_NAME,
Â  Â  Â  Â <span class="hljs-string">"product-images/"</span> + fileName, <span class="hljs-comment">// å­˜å‚¨è·¯å¾„ï¼ˆå¯¹åº”OSæ–‡ä»¶è·¯å¾„ï¼‰</span>
Â  Â  Â  Â file.getInputStream()
Â  Â   );
Â  Â  Â <span class="hljs-comment">// 3. è¿”å›æ–‡ä»¶è®¿é—®URLï¼ˆå¯¹åº”OSæ–‡ä»¶è®¿é—®åœ°å€ï¼‰</span>
Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">"https://"</span> + BUCKET_NAME + <span class="hljs-string">"."</span> + ENDPOINT + <span class="hljs-string">"/product-images/"</span> + fileName;
Â   }
Â }
</code></pre>
<h3 data-id="heading-20">å››ã€é¿å‘æŒ‡å—ï¼šå­˜å‚¨ç®¡ç†å®æˆ˜ä¸­çš„ â€œé«˜é¢‘è¸©å‘ç‚¹â€</h3>
<h4 data-id="heading-21">1. å‰ç«¯è¸©å‘ï¼š</h4>
<ul>
<li>âŒ ç”¨ localStorage å­˜å¤§æ–‡ä»¶ï¼ˆæ¯”å¦‚ 10MB çš„ JSON æ•°æ®ï¼‰ï¼šlocalStorage å®¹é‡åªæœ‰ 5MBï¼Œä¸”åŒæ­¥è¯»å–ä¼šé˜»å¡ UIâ€”â€” å¯¹åº” OSâ€œç”¨å†…å­˜å­˜å¤§æ–‡ä»¶ï¼Œå¯¼è‡´å†…å­˜ä¸è¶³â€ï¼Œåº”è¯¥ç”¨ IndexedDBã€‚</li>
<li>âŒ ä¸æ¸…ç†äº‹ä»¶ç›‘å¬ / å®šæ—¶å™¨ï¼šå¯¼è‡´å†…å­˜æ³„æ¼ â€”â€” å¯¹åº” OS â€œè¿›ç¨‹é€€å‡ºä¸é‡Šæ”¾å†…å­˜â€ï¼Œç»„ä»¶å¸è½½æ—¶ä¸€å®šè¦æ¸…ç†èµ„æºã€‚</li>
<li>âŒ å¤§æ–‡ä»¶ç›´æ¥ä¸Šä¼ ï¼šå¯¼è‡´è¶…æ—¶ / å†…å­˜æº¢å‡º â€”â€” å¯¹åº” OS â€œä¸€æ¬¡æ€§åŠ è½½å¤§æ–‡ä»¶åˆ°å†…å­˜â€ï¼Œåº”è¯¥ç”¨åˆ†ç‰‡ä¸Šä¼ ã€‚</li>
</ul>
<h4 data-id="heading-22">2. åç«¯è¸©å‘ï¼š</h4>
<ul>
<li>âŒ æ•°æ®åº“ç´¢å¼•è¶Šå¤šè¶Šå¥½ï¼šå¯¼è‡´å†™æ“ä½œå˜æ…¢ã€ç´¢å¼•ç¢ç‰‡ â€”â€” å¯¹åº” OS â€œç¼“å­˜å¤ªå¤šå¯¼è‡´å‘½ä¸­ç‡ä¸‹é™â€ï¼Œåªç»™æŸ¥è¯¢é¢‘ç¹çš„å­—æ®µå»ºç´¢å¼•ã€‚</li>
<li>âŒ ç¼“å­˜ key ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼šå¯¼è‡´ç¼“å­˜æ•°æ®è¿‡æœŸï¼Œä¸æ•°æ®åº“ä¸ä¸€è‡´ â€”â€” å¯¹åº” OSâ€œç¼“å­˜æ•°æ®ä¸æ›´æ–°ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´â€ï¼Œä¸€å®šè¦è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ã€‚</li>
<li>âŒ JVM å †å†…å­˜è®¾ç½®è¿‡å¤§ï¼šå¯¼è‡´ GC æ—¶é—´è¿‡é•¿ï¼ˆSTWï¼‰â€”â€” å¯¹åº” OSâ€œå†…å­˜åˆ†é…è¿‡å¤§ï¼Œå›æ”¶æ•ˆç‡ä½â€ï¼Œæ ¹æ®æœåŠ¡å™¨å†…å­˜åˆç†è®¾ç½®ï¼ˆæ¯”å¦‚ 8GB æœåŠ¡å™¨ï¼ŒJVM æœ€å¤§å †å†…å­˜è®¾ä¸º 4-6GBï¼‰ã€‚</li>
<li>âŒ ä¸å…³é—­æ•°æ®åº“è¿æ¥ / æ–‡ä»¶æµï¼šå¯¼è‡´èµ„æºæ³„æ¼ â€”â€” å¯¹åº” OS â€œæ–‡ä»¶å¥æŸ„ä¸é‡Šæ”¾â€ï¼Œä¸€å®šè¦ç”¨ try-with-resources æˆ– finally å…³é—­èµ„æºã€‚</li>
</ul>
<h3 data-id="heading-23">æ€»ç»“ï¼šå­˜å‚¨ç®¡ç†çš„ â€œæ ¸å¿ƒæ€ç»´â€ æ¯” â€œå…·ä½“å®ç°â€ æ›´é‡è¦</h3>
<ul>
<li>é‡åˆ° â€œå¤§èµ„æºâ€ï¼ˆå¤§æ–‡ä»¶ã€å¤§è¡¨ã€å¤§æ•°æ®ï¼‰ï¼šå°±ç”¨ â€œæ‹†åˆ†â€ æ€è·¯ï¼ˆåˆ†ç‰‡ã€åˆ†è¡¨ã€åˆ†é¡µï¼‰ï¼Œå¯¹åº” OS çš„ â€œåˆ†é¡µ / åˆ†æ®µå­˜å‚¨â€ï¼›</li>
<li>é‡åˆ° â€œæ…¢è®¿é—®â€ï¼ˆæ•°æ®åº“æŸ¥è¯¢æ…¢ã€DOM æ“ä½œæ…¢ï¼‰ï¼šå°±ç”¨ â€œç¼“å­˜â€ æ€è·¯ï¼ˆRedisã€localStorageã€è™šæ‹Ÿ DOMï¼‰ï¼Œå¯¹åº” OS çš„ â€œé«˜é€Ÿç¼“å­˜â€ï¼›</li>
<li>é‡åˆ° â€œèµ„æºä¸å¤Ÿç”¨â€ï¼ˆå†…å­˜ä¸è¶³ã€ç£ç›˜æ»¡ï¼‰ï¼šå°±ç”¨ â€œä¼˜åŒ–åˆ†é…â€ æ€è·¯ï¼ˆJVM é…ç½®ã€è¿‡æœŸæ¸…ç†ã€ç¢ç‰‡æ•´ç†ï¼‰ï¼Œå¯¹åº” OS çš„ â€œå†…å­˜åˆ†é… / å›æ”¶â€ï¼›</li>
<li>é‡åˆ° â€œæ•°æ®ä¸ä¸€è‡´â€ï¼ˆç¼“å­˜ä¸æ•°æ®åº“ã€æœ¬åœ°ä¸åç«¯ï¼‰ï¼šå°±ç”¨ â€œåŒæ­¥â€ æ€è·¯ï¼ˆåŒè¯»åŒå†™ã€è‡ªåŠ¨åŒæ­¥ï¼‰ï¼Œå¯¹åº” OS çš„ â€œç¼“å­˜ä¸€è‡´æ€§â€ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¿½æœ¬æº¯æº â€”â€” SetState åˆ·æ–°åšäº†ä»€ä¹ˆ]]></title>    <link>https://juejin.cn/post/7579179741824466970</link>    <guid>https://juejin.cn/post/7579179741824466970</guid>    <pubDate>2025-12-03T04:21:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179741824466970" data-draft-id="7577970969395757097" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¿½æœ¬æº¯æº â€”â€” SetState åˆ·æ–°åšäº†ä»€ä¹ˆ"/> <meta itemprop="keywords" content="Flutter,é¢è¯•,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2025-12-03T04:21:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äººå½¢æ‰“ç æœº"/> <meta itemprop="url" content="https://juejin.cn/user/2085122730895063"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¿½æœ¬æº¯æº â€”â€” SetState åˆ·æ–°åšäº†ä»€ä¹ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2085122730895063/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äººå½¢æ‰“ç æœº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:21:30.000Z" title="Wed Dec 03 2025 04:21:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Flutter ä¸­è°ƒç”¨ setState æ˜¯ä¸€ä¸ªå¸¸ç”¨æ–¹æ³•ï¼Œ
ä½†å½“ UI æ²¡æœ‰ç«‹å³åˆ·æ–°ã€åŠ¨ç”»æ‰å¸§ã€å¤æ‚å¸ƒå±€å¡é¡¿æ—¶ï¼Œä½ ä¼šå‘ç°ï¼š</p>
<p><strong>åªæ˜¯çŸ¥é“ setState æ ¹æœ¬æ— æ³•è§£é‡Š Flutter ä¸ºä»€ä¹ˆä¼šæ…¢ã€å¡é¡¿</strong></p>
<p>è¦çœŸæ­£ç†è§£ Flutter çš„ UI åˆ·æ–°æœºåˆ¶ï¼Œå°±å¿…é¡»ç†è§£ Frame Pipelineã€‚</p>
<h2 data-id="heading-0">è°ƒç”¨ setState åå‘ç”Ÿäº†ä»€ä¹ˆ</h2>
<pre><code class="hljs language-dart" lang="dart">setState(() {
  _counter++;
});
</code></pre>
<p>æœ€å¼€å§‹æ¥è§¦ Flutter æ—¶å€™å¯¹è¿™æ®µä»£ç çš„ç†è§£å°±æ˜¯ï¼š
æ”¹äº† <code>_counter</code>ï¼Œç„¶å Flutter ç«‹åˆ»é‡æ–°æ¸²æŸ“ï¼ŒæŠŠæ–°å€¼ç”»åˆ°å±å¹•ä¸Š</p>
<p><strong>æ˜¯è¿™æ ·ä¹ˆï¼Ÿ</strong></p>
<p><strong>å®é™…ä¸Šå®Œå…¨ä¸æ˜¯</strong><br/>
è°ƒç”¨ <code>setState()</code> çš„é‚£ä¸€åˆ»ï¼Œå±å¹•å¹¶ä¸ä¼šç«‹åˆ»åˆ·æ–°ï¼Œç”šè‡³è¿ã€Œé‡æ–° buildã€ä¹Ÿè¿˜æ²¡å¼€å§‹ã€‚</p>
<h3 data-id="heading-1">Element æ ‡è®°</h3>
<p>é¦–å…ˆè¦è®°ä½ä¸€ä¸ªéå¸¸é‡è¦çš„äº‹å®ï¼š</p>
<ul>
<li><strong>Widget æ˜¯é…ç½®</strong></li>
<li><strong>Element æ‰æ˜¯â€œæ´»ç€çš„å®ä¾‹â€</strong></li>
</ul>
<p>å½“ä½ åœ¨ State é‡Œè°ƒç”¨ <code>setState()</code> æ—¶ï¼ŒFlutter åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼š</p>
<blockquote>
<p>æŠŠå½“å‰å…³è”çš„ <strong>Element æ ‡è®°ä¸º dirtyï¼ˆè„ï¼‰ï¼Œä¸‹æ¬¡åˆ·æ–°éœ€è¦é‡å»º</strong> ã€‚</p>
</blockquote>
<h3 data-id="heading-2">æ·»åŠ å¤„ç†é˜Ÿåˆ—</h3>
<p>æ ‡è®°å®Œ dirty ä¹‹åï¼ŒFlutter å¹¶ä¸ä¼šå½“åœºå°±å¤„ç†ï¼Œè€Œæ˜¯æŠŠå®ƒäº¤ç»™ä¸€ä¸ªç®¡ç†è€…ï¼š<strong>BuildOwner</strong>ã€‚</p>
<p>ç®€å•ç†è§£ï¼š</p>
<ul>
<li><code>BuildOwner</code> ç»´æŠ¤ç€ä¸€ä¸ª <strong>å¾…é‡å»ºçš„ Element åˆ—è¡¨</strong>ï¼ˆdirty åˆ—è¡¨ï¼‰</li>
<li>æ¯æ¬¡æœ‰åœ°æ–¹ <code>setState()</code>ï¼Œå¯¹åº”çš„ Element å°±ä¼šè¢«åŠ åˆ°è¿™ä¸ªåˆ—è¡¨é‡Œ</li>
</ul>
<p><strong>ç›®çš„ï¼š</strong></p>
<ul>
<li>
<p><strong>åˆå¹¶å¤šä¸ª setState</strong><br/>
ä¸€å¸§é‡Œä½ å¯èƒ½è¿ç»­å¤šæ¬¡ <code>setState()</code>ï¼ŒFlutter ä¸ä¼šæ¯æ¬¡éƒ½é‡æ–°è·‘ä¸€å¥—æµç¨‹ï¼Œè€Œæ˜¯æŠŠæ‰€æœ‰è¦æ›´æ–°çš„ Element <strong>é›†ä¸­æ”¾åœ¨ dirty åˆ—è¡¨é‡Œï¼Œä¸€æ¬¡æ€§ç»Ÿä¸€å¤„ç†</strong>ã€‚</p>
</li>
<li>
<p><strong>é¿å…åœ¨å½“å‰è°ƒç”¨æ ˆé‡Œé¢‘ç¹é‡å»º</strong><br/>
å¦‚æœ setState ç›´æ¥è§¦å‘é‡å»ºï¼Œæˆ‘ä»¬åœ¨äº‹ä»¶å›è°ƒé‡Œã€å¼‚æ­¥å›è°ƒé‡Œé¢‘ç¹ <code>setState()</code>ï¼ŒUI å°±å¯èƒ½åœ¨ä¸€ä¸ªè°ƒç”¨æ ˆé‡Œåå¤ buildï¼Œå¼€é”€éå¸¸å¤§ï¼Œä¹Ÿéš¾ä»¥ç»´æŠ¤ã€‚</p>
</li>
</ul>
<blockquote>
<p>è¿„ä»Šä¸ºæ­¢ï¼Œåšäº†è¿™äº›åŠ¨ä½œï¼š
çŠ¶æ€æ›´æ”¹ â€”â€”&gt; æ ‡è®° Element â€”â€”&gt; æ”¾ç½®é‡å»ºé˜Ÿåˆ—</p>
</blockquote>
<h3 data-id="heading-3">markNeedsBuild</h3>
<p>åœ¨å®Œæˆé˜Ÿåˆ—æ·»åŠ åï¼Œå¹¶ä¸ä¼šç«‹å³é‡å»ºï¼Œå°†ç”³è¯·ä¸‹ä¸€å¸§é‡å»º</p>
<ul>
<li>
<p>setState â†’ <code>markNeedsBuild()</code></p>
</li>
<li>
<p><code>markNeedsBuild()</code> â†’ é€šçŸ¥ Schedulerï¼šâ€œæœ‰äº‹æƒ…è¦ç”»ï¼Œè®°å¾—å®‰æ’ä¸€å¸§ã€‚â€</p>
</li>
<li>
<p>Scheduler â†’ è°ƒç”¨ <code>scheduleFrame()</code></p>
</li>
<li>
<p><code>scheduleFrame()</code> â†’ ç­‰å¾…<strong>ä¸‹ä¸€æ¬¡å±å¹• Vsync ä¿¡å·</strong>ï¼Œå†æ­£å¼å¼€å§‹ä¸€å¸§</p>
</li>
</ul>
<blockquote>
<p><strong>æ€»ç»“</strong> setState ä¸æ˜¯ä¸€ä¸ªâ€œç«‹åˆ»é‡ç»˜â€çš„æŒ‰é’®ï¼Œè€Œæ˜¯ä¸€ä¸ªâ€œé¢„çº¦ä¸‹ä¸€å¸§é‡å»ºâ€çš„å¼€å…³</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">Flutter çš„ä¸€å¸§å¦‚ä½•å¼€å§‹ï¼Ÿâ€”â€” Frame Scheduling</h2>
<p>Flutter ä¸æ˜¯ä¸€ç›´åœ¨æ­»å¾ªç¯åˆ·æ–°å±å¹•ï¼Œå®ƒæ˜¯ <strong>è¢«åŠ¨æ¸²æŸ“</strong> çš„æ¡†æ¶ï¼Œåªæœ‰åœ¨å¿…è¦æ—¶æ‰ä¼šäº§ç”Ÿä¸€å¸§ï¼›åœ¨ setSate å®Œæˆ<code>ç”³è¯·ä¸€å¸§</code> åå°†è¿›å…¥ <code>Frame Schedulingï¼ˆå¸§è°ƒåº¦æœºåˆ¶ï¼‰</code></p>
<p>Flutter ä¸€å¸§çš„äº§ç”Ÿä¾èµ– 3 ä¸ªå…³é”®è§’è‰²ï¼š</p>
<ul>
<li><strong>ç³»ç»Ÿï¼ˆVsyncï¼‰ï¼šå‘Šè¯‰ Flutter ä»€ä¹ˆæ—¶å€™å¯ä»¥åˆ·æ–°</strong></li>
<li><strong>å¼•æ“ï¼ˆonBeginFrameï¼‰ï¼šæ¥æ”¶ Vsyncã€å¼€å§‹ä¸€å¸§</strong></li>
<li><strong>Frameworkï¼ˆSchedulerBindingï¼‰ï¼šå®‰æ’ Frameã€æ‰§è¡Œ Pipeline</strong></li>
</ul>
<h3 data-id="heading-5">Vsync ä¿¡å·</h3>
<p>é¦–å…ˆè¦æ¸…æ¥š<code>å¸§ç‡</code>è¿™ä¸€æ¦‚å¿µï¼Œåœ¨ç»´åŸºç™¾ç§‘çš„è§£é‡Šæ˜¯</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E5%25B8%25A7%25E7%258E%2587" target="_blank" title="https://zh.wikipedia.org/wiki/%E5%B8%A7%E7%8E%87" ref="nofollow noopener noreferrer">å¸§ç‡</a>ï¼šç”¨äºæµ‹é‡æ˜¾ç¤ºå¸§æ•°çš„åº¦é‡ã€‚æµ‹é‡å•ä½ä¸ºâ€œæ¯ç§’æ˜¾ç¤ºå¸§æ•°â€ï¼ˆ<strong>f</strong>rameÂ <strong>p</strong>erÂ <strong>s</strong>econdï¼Œ<strong>FPS</strong>ï¼‰æˆ–â€œèµ«å…¹â€ï¼Œä¸€èˆ¬æ¥è¯´FPSç”¨äºæè¿°å½±ç‰‡ã€ç”µå­ç»˜å›¾æˆ–æ¸¸æˆæ¯ç§’æ’­æ”¾å¤šå°‘å¸§ã€‚</p>
</blockquote>
<p><strong>æ‰€æœ‰ç”µå­æ˜¾ç¤ºå±éƒ½æ˜¯æŒ‰å›ºå®šé¢‘ç‡åˆ·æ–°çš„ã€‚</strong></p>
<ul>
<li>æ™®é€šæ‰‹æœºæ˜¯ <strong>60Hz</strong> â†’ æ¯ç§’ 60 æ¬¡åˆ·æ–°</li>
<li>é«˜åˆ·æ‰‹æœºå¯èƒ½æ˜¯ <strong>90Hz / 120Hz / 144Hz</strong></li>
</ul>
<p>ç³»ç»Ÿä¼šåœ¨æ¯æ¬¡å±å¹•å‡†å¤‡åˆ·æ–°å‰ï¼Œå‘å‡ºä¸€ä¸ªåŒæ­¥ä¿¡å·ï¼š<strong>Vsyncï¼ˆVertical Synchronizationï¼‰</strong> ã€‚<br/>
Flutter å¼•æ“å°±æ˜¯æ ¹æ®è¿™ä¸ªä¿¡å·æ¥å†³å®šï¼š</p>
<blockquote>
<p>â€œç°åœ¨æ˜¯æ—¶å€™å¼€å§‹å‡†å¤‡ä¸‹ä¸€å¸§ç”»é¢äº†ã€‚â€</p>
</blockquote>
<p>ğŸ“Œ <strong>Flutter çš„æ¯ä¸€å¸§ï¼Œéƒ½æ˜¯ç”±ç³»ç»Ÿçš„ Vsync é©±åŠ¨çš„ã€‚</strong></p>
<h3 data-id="heading-6">åˆ·æ–°è§¦å‘</h3>
<p>åˆ·æ–°çš„è§¦å‘ç‚¹æ˜¯å¼•æ“å±‚çš„ <code>onBeginFrame()</code> å›è°ƒ</p>
<p>Frame çš„å¼€å§‹ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Vsync åˆ°æ¥ â†’ Engine è°ƒç”¨ <span class="hljs-built_in">onBeginFrame</span>() â†’ Framework å¼€å§‹å¤„ç†æœ¬å¸§é€»è¾‘
</code></pre>
<p>è¿™ä¸€åˆ»ï¼ŒFramework æ‰æœ‰æœºä¼šè¿›å…¥ä¸‹ä¸€æ­¥ï¼š<br/>
<strong>Buildã€Layoutã€Paintâ€¦â€¦</strong> å…¨éƒ¨éƒ½åœ¨è¿™æ¡ Frame æµç¨‹ä¸­è¿›è¡Œã€‚</p>
<p><code>ç”³è¯·æœºåˆ¶</code>ä»å…¥å£ä¸Šå‡ ä¹éƒ½ç»•ä¸è¿‡æ ¸å¿ƒæ–¹æ³• <strong>SchedulerBinding.ensureVisualUpdate()</strong></p>
<p>å®ƒçš„é€»è¾‘éå¸¸ç®€å•ï¼š</p>
<ul>
<li>å¦‚æœå½“å‰æ²¡æœ‰æ­£åœ¨ç­‰å¾…çš„ Frame</li>
<li>å°±è¯·æ±‚ä¸‹ä¸€æ¬¡ Vsync</li>
<li>è®© Flutter æœ‰æœºä¼šå¼€å§‹ä¸€å¸§</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<blockquote>
<p><strong>setState çš„æœ€ç»ˆåŠ¨ä½œä¹‹ä¸€ï¼Œå°±æ˜¯è§¦å‘ ensureVisualUpdate å»â€œè¦ä¸€å¸§â€ã€‚</strong></p>
</blockquote>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A["setState"] --&gt; B["markNeedsBuildï¼ˆæ ‡è®° dirtyï¼‰"]
    B --&gt; C["ensureVisualUpdateï¼ˆè¯·æ±‚ä¸‹ä¸€å¸§ï¼‰"]
    C --&gt; D["scheduleFrameï¼ˆç­‰å¾… Vsyncï¼‰"]
    D --&gt; E["ç­‰å¾…ç³»ç»Ÿå‘æ¥ä¸€ä¸ª Vsync ä¿¡å·"]
    E --&gt; F["onBeginFrameï¼ˆæœ¬å¸§å¼€å§‹ï¼‰"]
    F --&gt; G["è¿›å…¥ Frame Pipelineï¼šBuild â†’ Layout â†’ Paint â†’ Composite â†’ Raster"]
    G --&gt; H["å±å¹•æ˜¾ç¤ºæ›´æ–°"]


</code></pre>
<hr/>
<h2 data-id="heading-7">Frame Pipeline</h2>
<blockquote>
<p>Build â†’ Layout â†’ Paint â†’ Composite â†’ Raster</p>
</blockquote>
<p>Flutter å¦‚ä½•ä»ä¸€ä¸ªâ€œéœ€è¦æ›´æ–°çš„çŠ¶æ€â€ä¸€è·¯èµ°åˆ°â€œå±å¹•åƒç´ æ›´æ–°â€çš„ï¼Ÿ</p>
<p>è¿™å°±æ˜¯ <strong>Flutter Frame Pipelineï¼ˆæ¸²æŸ“æµæ°´çº¿ï¼‰</strong> çš„å·¥ä½œã€‚</p>
<p>å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€æ¡å·¥å‚äº§çº¿ï¼Œæ¯ä¸€å¸§éƒ½æ˜¯ä¸€ä»¶äº§å“ï¼ˆç”»é¢ï¼‰ï¼Œè€Œ Flutter éœ€è¦åœ¨ 16.6ms å†…å®Œæˆæ•´ä¸ªç”Ÿäº§æµç¨‹ï¼š<br/>
<strong>Build â†’ Layout â†’ Paint â†’ Composite â†’ Raster</strong></p>
<h3 data-id="heading-8">Build æ„å»º UI ç»“æ„</h3>
<p>åœ¨ setState æ—¶ï¼ŒæŠŠ Element æ ‡è®°ä¸º dirtyã€‚ Build é˜¶æ®µä¼šéå†è¿™äº› dirty elementsï¼Œç„¶åè°ƒç”¨å®ƒä»¬çš„ build æ–¹æ³•ã€‚</p>
<p>Widget æ˜¯é…ç½®ï¼ˆimmutableï¼‰ï¼ŒElement æ‰æ˜¯â€œæ´»çš„å®ä¾‹â€</p>
<p>åœ¨ Build é˜¶æ®µï¼Œæ¯æ¬¡ build ä¼šåˆ›å»ºæ–°çš„ Widget å¯¹è±¡ï¼Œä½†ä¸ä¼šåˆ›å»ºæ–°çš„ Elementï¼š</p>
<ul>
<li>Widget æ˜¯è½»é‡çš„é…ç½®å¯¹è±¡</li>
<li>Element ä¿å­˜ç”Ÿå‘½å‘¨æœŸã€Stateã€ä»¥åŠå’Œ RenderObject çš„å…³è”</li>
<li>æ–° Widget ä¼šé€šè¿‡ Element ä¸ä¹‹å‰çš„æ ‘ç»“æ„åŒ¹é…ï¼ˆdiffï¼‰</li>
</ul>
<p>æ›´æ–° RenderObjectï¼ˆå¸ƒå±€ &amp; ç»˜åˆ¶å¯¹è±¡ï¼‰</p>
<p>å¦‚æœ Widget é…ç½®å˜åŒ–å¼•èµ·æ¸²æŸ“éœ€æ±‚å˜åŒ–ï¼ŒFlutter ä¼šï¼š</p>
<ul>
<li>æ›´æ–° RenderObject çš„å±æ€§</li>
<li>æˆ–åœ¨éœ€è¦æ—¶é‡å»º RenderObject</li>
</ul>
<p>RenderObject æ˜¯çœŸæ­£å‚ä¸ Layout å’Œ Paint çš„æ ¸å¿ƒå¯¹è±¡ã€‚</p>
<p>ğŸ“Œ <strong>Build çš„æœ€ç»ˆäº§ç‰©æ˜¯ä¸€ä¸ªå‡†å¤‡å¥½å¸ƒå±€çš„ RenderObject æ ‘ã€‚</strong></p>
<h3 data-id="heading-9">Layout æµ‹é‡å’Œå®šä½</h3>
<p>çˆ¶ç»™å­ constraintsï¼Œå­è¿”å›å°ºå¯¸</p>
<p>Flutter çš„å¸ƒå±€æ˜¯ä»çˆ¶åˆ°å­é€’å½’ä¼ é€’çš„ï¼š</p>
<ul>
<li>çˆ¶ RenderObject ç»™å­èŠ‚ç‚¹ä¸€ä¸ª constraintsï¼ˆæœ€å¤§/æœ€å°å®½é«˜ç­‰ï¼‰</li>
<li>å­èŠ‚ç‚¹å¿…é¡»åœ¨è¿™ä¸ª constraints å†…å†³å®šè‡ªå·±çš„å°ºå¯¸</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>Column ä¼šå‘Šè¯‰å­ç»„ä»¶ â€œä½ å®½åº¦å¿…é¡»ç­‰äº Column çš„å®½åº¦ï¼Œè‡³äºé«˜åº¦ä½ è‡ªå·±çœ‹ç€åŠâ€</li>
<li>Text ä¼šæ ¹æ®æ–‡æœ¬å†…å®¹å’Œ constraints å†³å®šæœ€ç»ˆå°ºå¯¸</li>
<li>Container æ ¹æ®å¤–éƒ¨ constraints å’Œå†…éƒ¨ child çš„å°ºå¯¸å†³å®šè‡ªèº«å¤§å°</li>
</ul>
<p>è¿™ä¸€æœºåˆ¶ä¿è¯äº†ï¼š</p>
<ul>
<li>å¸ƒå±€è¡Œä¸ºå®Œå…¨å¯é¢„æµ‹</li>
<li>å¸ƒå±€æ˜¯è‡ªä¸Šè€Œä¸‹çš„æ•°æ®æµè€Œéæ··ä¹±çš„äºŒç»´å¸ƒå±€</li>
</ul>
<p>ğŸ“Œ ç»è¿‡ Layoutï¼Œæ•´ä¸ª RenderObject æ ‘å·²ç»â€œæµ‹é‡å®Œæˆâ€ï¼ŒçŸ¥é“æ¯ä¸ªå¯¹è±¡è¯¥ç”»åœ¨å±å¹•å“ªé‡Œã€‚</p>
<h3 data-id="heading-10">Paint ç»˜åˆ¶æŒ‡ä»¤</h3>
<p>Paint é˜¶æ®µä¸æ˜¯ç«‹å³æŠŠåƒç´ ç”»ä¸Šå±å¹•ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>æŠŠæ‰€æœ‰ç»˜åˆ¶æ“ä½œè®°å½•æˆä¸€æ¡æ¡ç»˜åˆ¶æŒ‡ä»¤ï¼Œå†™å…¥ Picture æˆ– Layerã€‚</strong></p>
</blockquote>
<p>Flutter ä¼šåœ¨æ¯ä¸ª RenderObject çš„ paint æ–¹æ³•ä¸­ï¼š</p>
<ul>
<li>ç»˜åˆ¶èƒŒæ™¯ã€æ–‡å­—ã€è¾¹æ¡†ã€é˜´å½±ç­‰</li>
<li>è°ƒç”¨ child çš„ painting æ–¹æ³•é€’å½’ç»˜åˆ¶</li>
<li>è®°å½•æ‰€æœ‰ç»˜åˆ¶å‘½ä»¤åˆ° <code>PaintingContext</code></li>
</ul>
<p>ğŸ“Œ <strong>Paint é˜¶æ®µçš„æ ¸å¿ƒäº§ç‰©æ˜¯ Layer Tree çš„â€œç»˜åˆ¶è„šæœ¬â€ã€‚</strong></p>
<h3 data-id="heading-11">Composite ç”Ÿæˆ Layer Tree</h3>
<p><strong>å°†ç»˜åˆ¶æŒ‡ä»¤ç»„åˆæˆå¯ä¼˜åŒ–çš„å›¾å±‚æ ‘</strong></p>
<p>Paint é˜¶æ®µè®°å½•çš„æ˜¯ç»˜åˆ¶æŒ‡ä»¤ï¼Œä½† Flutter è¿˜éœ€è¦æŠŠè¿™äº›æŒ‡ä»¤æ•´ç†æˆä¸€ä¸ªç»“æ„è‰¯å¥½çš„ <strong>Layer Tree</strong>ã€‚</p>
<p>Layer çš„ä½œç”¨åŒ…æ‹¬ï¼š</p>
<ul>
<li>è¡¨ç¤ºä¸€å—å¯ä»¥å•ç‹¬å¤„ç†çš„åŒºåŸŸï¼ˆå¦‚è£å‰ªã€é€æ˜åº¦ã€å˜æ¢ç­‰ï¼‰</li>
<li>å¸®åŠ© Flutter åšç¼“å­˜å’Œå±€éƒ¨é‡ç»˜ï¼ˆåªæ›´æ–°å˜åŒ–çš„éƒ¨åˆ†ï¼‰</li>
<li>ä¸ºæ»šåŠ¨ã€åŠ¨ç”»ç­‰æä¾›æ›´é«˜æ•ˆçš„æ¸²æŸ“åŸºç¡€</li>
</ul>
<p>å¸¸è§çš„ Layer åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>TransformLayer</code></li>
<li><code>ClipRectLayer</code></li>
<li><code>OpacityLayer</code></li>
<li><code>PictureLayer</code> ç­‰</li>
</ul>
<p>Layer Tree ä¼šè¢«å‘é€ç»™å¼•æ“ï¼Œä½œä¸ºåç»­ Raster çš„è¾“å…¥ã€‚</p>
<p>ğŸ“Œ <strong>Composite çš„äº§ç‰©æ˜¯ï¼šä¸€æ£µæè¿°æ•´å±å†…å®¹çš„ Layer Treeã€‚</strong></p>
<h3 data-id="heading-12">Raster æœ€ç»ˆç»˜åˆ¶</h3>
<p><strong>Skia + GPU â†’ å±å¹•åƒç´ ; å”¯ä¸€çœŸæ­£â€œç”»å›¾â€çš„é˜¶æ®µ</strong></p>
<p>Pipeline çš„æœ€åä¸€ä¸ªé˜¶æ®µï¼Œä½†å®ƒå·²ç»è„±ç¦» Dart å±‚ï¼Œå®Œå…¨äº¤ç”±å¼•æ“å’Œ GPU æ¥æ‰§è¡Œã€‚</p>
<p>Rasterizer çš„ä¸»è¦æµç¨‹æ˜¯ï¼š</p>
<ul>
<li>æ¥æ”¶ Layer Tree</li>
<li>ä½¿ç”¨ Skia æŠŠæ¯ä¸ª Layer è½¬æˆ GPU å¯ä»¥ç†è§£çš„å›¾å…ƒ</li>
<li>ä¸Šä¼ çº¹ç†ã€ç¼–è¯‘æˆ–å¤ç”¨ Shader</li>
<li>æœ€ç»ˆå†™å…¥ Framebuffer</li>
<li>äº¤ç»™ç³»ç»Ÿåˆæˆï¼Œæ˜¾ç¤ºåˆ°å±å¹•ä¸Š</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    D3["Layer Tree"] --&gt; E2["Engine Shell æ¥æ”¶ LayerTree"]
    E2 --&gt; R1["éå† LayerTreeï¼Œå‡†å¤‡ç»˜åˆ¶åˆ—è¡¨"]
    R1 --&gt; R2["å›¾ç‰‡è§£ç ä¸çº¹ç†ä¸Šä¼ "]
    R2 --&gt; R3["Shader ç¼–è¯‘æˆ–å¤ç”¨"]
    R3 --&gt; R4["Skia å…‰æ …åŒ–å†™å…¥ Framebuffer"]
    R4 --&gt; G1["ç³»ç»Ÿåˆæˆï¼šSurface / CoreAnimation / SurfaceFlinger"]
    G1 --&gt; G2["æœ€ç»ˆæ˜¾ç¤ºåˆ°å±å¹•"]

    %% COLORS
    style D3 fill:#e1bee7,stroke:#6a1b9a
    style E2 fill:#e1bee7,stroke:#6a1b9a
    style R1 fill:#f8bbd0,stroke:#ad1457
    style R2 fill:#f8bbd0,stroke:#ad1457
    style R3 fill:#f8bbd0,stroke:#ad1457
    style R4 fill:#f48fb1,stroke:#ad1457
    style G1 fill:#c8e6c9,stroke:#2e7d32
    style G2 fill:#81c784,stroke:#2e7d32


</code></pre>
<ul>
<li>Raster é˜¶æ®µæ˜¯ GPU çœŸæ­£è€—æ—¶çš„åœ°æ–¹</li>
<li>Shader ç¼–è¯‘ä¹Ÿæ˜¯åœ¨ Raster é˜¶æ®µå‘ç”Ÿï¼ˆä¼šå¯¼è‡´æ‰å¸§ï¼‰</li>
<li>Flutter æä¾› Shader warm-up ï¼ˆä½†è¿™æ˜¯ä¸‹ä¸€ç¯‡çš„å†…å®¹ï¼‰</li>
</ul>
<p>ğŸ“Œ åˆ°è¿™é‡Œï¼Œä¸€å¸§ä» setState â†’ Pipeline â†’ åƒç´ æ›´æ–°å…¨éƒ¨å®Œæˆã€‚</p>
<h2 data-id="heading-13">setState åˆ°å±å¹•åˆ·æ–°</h2>
<p>ğŸ“Œ <strong>setState çš„æœ¬è´¨ä¸æ˜¯æ›´æ–° UIï¼Œè€Œæ˜¯è§¦å‘ä¸‹ä¸€å¸§çš„ Buildã€‚</strong></p>
<p>å®ƒåªæ˜¯ï¼š</p>
<ul>
<li>æ”¹çŠ¶æ€</li>
<li>æ ‡è®° dirty</li>
<li>ç”³è¯·ä¸€å¸§</li>
</ul>
<p>çœŸæ­£çš„ UI æ›´æ–°å‘ç”Ÿåœ¨ä¸‹ä¸€å¸§çš„ Frame Pipeline ä¸­ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    U["ç”¨æˆ·è¾“å…¥ï¼šç‚¹å‡» / æ»šåŠ¨ / æ‰‹åŠ¿"] --&gt; E1["PointerEvent åˆ†å‘ï¼ŒGestureArena è§£æ"]
    VSYNC["Vsync ä¿¡å· (å±å¹•åˆ·æ–°èŠ‚å¥)"] --&gt; F0["SchedulerBinding.beginFrame"]

    E1 --&gt; F1["äº‹ä»¶å›è°ƒï¼šonTap / onScroll / onChangedï¼Œè§¦å‘çŠ¶æ€æ›´æ–°"]
    F0 --&gt; A1["Animation / Ticker æ›´æ–°ï¼Œæ»šåŠ¨æƒ¯æ€§è®¡ç®—"]

    A1 --&gt; A2["æ ‡è®°è„ï¼šmarkNeedsBuild / markNeedsLayout / markNeedsPaint"]
    F1 --&gt; A2

    A2 --&gt; B1["build é˜¶æ®µï¼šéå† dirty Elements"]
    B1 --&gt; B2["æ‰§è¡Œ Widget.buildï¼Œæ›´æ–° Widget / Element æ ‘"]
    B2 --&gt; B3["æ›´æ–° RenderObject å±æ€§"]

    B3 --&gt; C1["layout é˜¶æ®µï¼šflushLayout"]
    C1 --&gt; C2["performLayout è®¡ç®—å¤§å°ä½ç½®"]

    C2 --&gt; D1["paint é˜¶æ®µï¼šflushPaint"]
    D1 --&gt; D2["RenderObject.paint å½•åˆ¶ Canvas æŒ‡ä»¤"]
    D2 --&gt; D3["ç»„è£… Layer Tree"]

    %% COLORS
    style U fill:#fff7cc,stroke:#bfa600
    style E1 fill:#fff7cc,stroke:#bfa600
    style VSYNC fill:#fff7cc,stroke:#bfa600
    style F0 fill:#c8e1ff,stroke:#0366d6
    style F1 fill:#c8e1ff,stroke:#0366d6
    style A1 fill:#c8e1ff,stroke:#0366d6
    style A2 fill:#cdecef,stroke:#0b7a75
    style B1 fill:#cdecef,stroke:#0b7a75
    style B2 fill:#cdecef,stroke:#0b7a75
    style B3 fill:#cdecef,stroke:#0b7a75
    style C1 fill:#cdecef,stroke:#0b7a75
    style C2 fill:#cdecef,stroke:#0b7a75
    style D1 fill:#cdecef,stroke:#0b7a75
    style D2 fill:#cdecef,stroke:#0b7a75
    style D3 fill:#88d8c0,stroke:#0b7a75

</code></pre>
<h2 data-id="heading-14">å°ç»“</h2>
<ul>
<li>
<p>ä¸€æ¬¡ <code>setState</code>ï¼Œä¸ä¼šç«‹åˆ»æ›´æ–° UIï¼Œè€Œæ˜¯ï¼š</p>
<ul>
<li>æ ‡è®° dirty</li>
<li>ä¸¢è¿›é˜Ÿåˆ—</li>
<li>ç”³è¯·ä¸‹ä¸€å¸§</li>
</ul>
</li>
<li>
<p>ä¸‹ä¸€å¸§å¼€å§‹äºç³»ç»Ÿçš„ Vsyncï¼š</p>
<ul>
<li>å¼•æ“æ¥æ”¶ Vsyncï¼Œè°ƒç”¨ <code>onBeginFrame</code></li>
<li>Framework é€šè¿‡ SchedulerBinding æ‰§è¡Œ Frame Pipeline</li>
</ul>
</li>
<li>
<p>åœ¨è¿™ä¸€å¸§ä¸­ï¼ŒFlutter ä¾æ¬¡æ‰§è¡Œï¼š</p>
<ul>
<li><strong>Build â†’ Layout â†’ Paint â†’ Composite â†’ Raster</strong></li>
<li>æœ€ç»ˆæŠŠçŠ¶æ€å˜åŒ–å˜æˆå±å¹•ä¸Šçš„åƒç´ ã€‚</li>
</ul>
</li>
</ul>
<p>ç†è§£è¿™ä¸€æ¡é“¾è·¯ä¹‹åï¼Œå†çœ‹ï¼š</p>
<ul>
<li>DevTools é‡Œçš„ Timeline</li>
<li>â€œä¸ºä»€ä¹ˆæŸä¸ªé¡µé¢ Build å¾ˆé‡â€</li>
<li>â€œä¸ºä»€ä¹ˆç¬¬ä¸€æ¬¡åŠ¨ç”»ä¼šæ‰å¸§â€</li>
</ul>
<p>åŸºäºè¿™äº›å»åšå¡é¡¿ä¼˜åŒ–æ–¹æ¡ˆï¼Œå°†ä¼šæœ‰çš„æ”¾çŸ¢</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[App ä¸Šæ¶æœåŠ¡è¡Œä¸šçš„å®é™…å·¥ä½œæµç¨‹ä¸å·¥å…·é€‰æ‹© ä»äººå·¥ä»£åŠåˆ°è·¨å¹³å°è‡ªåŠ¨åŒ–çš„è½¬å˜]]></title>    <link>https://juejin.cn/post/7579179741824761882</link>    <guid>https://juejin.cn/post/7579179741824761882</guid>    <pubDate>2025-12-03T05:46:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179741824761882" data-draft-id="7579255046978666522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="App ä¸Šæ¶æœåŠ¡è¡Œä¸šçš„å®é™…å·¥ä½œæµç¨‹ä¸å·¥å…·é€‰æ‹© ä»äººå·¥ä»£åŠåˆ°è·¨å¹³å°è‡ªåŠ¨åŒ–çš„è½¬å˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T05:46:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼€å¿ƒå°±å¥½2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            App ä¸Šæ¶æœåŠ¡è¡Œä¸šçš„å®é™…å·¥ä½œæµç¨‹ä¸å·¥å…·é€‰æ‹© ä»äººå·¥ä»£åŠåˆ°è·¨å¹³å°è‡ªåŠ¨åŒ–çš„è½¬å˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼€å¿ƒå°±å¥½2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:46:59.000Z" title="Wed Dec 03 2025 05:46:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç§»åŠ¨äº’è”ç½‘è¡Œä¸šå¿«é€Ÿè¿­ä»£çš„èƒŒæ™¯ä¸‹ï¼Œâ€œApp ä¸Šæ¶æœåŠ¡â€é€æ¸æˆä¸ºä¸å°‘å°å›¢é˜Ÿã€åˆ›ä¸šè€…å’Œè·¨ç«¯å¼€å‘å›¢é˜Ÿçš„åˆšéœ€ã€‚å…¶èƒŒåçš„åŸå› å¹¶éæŠ€æœ¯é—¨æ§›é«˜ï¼Œè€Œæ˜¯ iOS ä¸Šæ¶æµç¨‹åœ¨ä½“éªŒã€æƒé™ã€è¯ä¹¦ä½“ç³»ã€å®¡æ ¸è§„åˆ™ç­‰æ–¹é¢éƒ½æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œå¯¼è‡´è®¸å¤šå›¢é˜Ÿè™½ç„¶èƒ½å®Œæˆå¼€å‘ï¼Œå´åœ¨ä¸Šæ¶ç¯èŠ‚å—åˆ°é˜»æ»ã€‚</p>
<p>è¿‘å‡ å¹´ï¼Œè¡Œä¸šä»ä¼ ç»Ÿâ€œä»£åŠå¼ä¸Šæ¶â€é€æ¸å‘â€œæµç¨‹å·¥å…·åŒ–ã€è‡ªåŠ¨åŒ–åä½œã€è·¨å¹³å°å‘å¸ƒâ€è½¬å˜ã€‚æœ¬æ–‡åŸºäºä¸€æ¬¡å®é™…æœåŠ¡æ¡ˆä¾‹ï¼Œæ€»ç»“ç›®å‰ App ä¸Šæ¶æœåŠ¡çš„çœŸå®å·¥ä½œæ–¹å¼ï¼Œå¹¶ä»‹ç»åœ¨è¿™ç§ä½“ç³»ä¸‹å¸¸ç”¨çš„å·¥å…·ç»„åˆï¼ŒåŒ…æ‹¬å›¢é˜Ÿå¸¸ç”¨çš„æ„å»ºå·¥å…·ã€æˆªå›¾ç®¡ç†å·¥å…·ã€è¯ä¹¦ç®¡ç†æ–¹å¼ï¼Œä»¥åŠè·¨å¹³å°ä¸Šä¼ å·¥å…·å¦‚ å¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰ åœ¨æ–°æµç¨‹ä¸­çš„å®šä½ã€‚</p>
<hr/>
<h2 data-id="heading-0"><strong>ä¸€ã€App ä¸Šæ¶æœåŠ¡ä¸ºä»€ä¹ˆå­˜åœ¨ï¼Ÿ</strong></h2>
<p>ä»è¡Œä¸šè§†è§’çœ‹ï¼Œä¸Šæ¶æœåŠ¡å­˜åœ¨çš„æ ¹æœ¬åŸå› æ˜¯ï¼š</p>
<ul>
<li>è®¾è®¡ã€å¼€å‘ã€æµ‹è¯•å„éƒ¨é—¨å¯¹ iOS è¯ä¹¦ä½“ç³»ç†è§£ä¸ä¸€è‡´</li>
<li>å¾ˆå¤šå›¢é˜Ÿæ²¡æœ‰ Mac æˆ– Mac ä¸è¶³ä»¥æ”¯æ’‘é¢‘ç¹æ„å»º</li>
<li>å®¡æ ¸è§„åˆ™ï¼ˆç‰¹åˆ«æ˜¯ 2.1ã€4.2ã€4.3ã€5.1.1ï¼‰ä¸æ–­æ›´æ–°</li>
<li>è‹¹æœåå°ä¿¡æ¯ç¹çï¼ˆæˆªå›¾ã€å…³é”®è¯ã€éšç§æ ‡ç­¾ï¼‰</li>
<li>ä¸Šä¼ å·¥å…·é™åˆ¶ macOSï¼Œæ— æ³•åœ¨ Windows/Linux ç›´æ¥ä½¿ç”¨</li>
</ul>
<p>å› æ­¤æ‰€è°“â€œä¸Šæ¶æœåŠ¡â€ï¼Œæœ¬è´¨ä¸Šä¸æ˜¯å¸®äººâ€œç‚¹å‡»ä¸Šä¼ â€ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>è¡¥é½å›¢é˜Ÿåœ¨æµç¨‹ã€ç¯å¢ƒã€å®¡æ ¸ç†è§£ã€è·¨å¹³å°å·¥å…·é“¾ä¸Šçš„ç¼ºå£ã€‚</strong></p>
</blockquote>
<p>è¿™äº›ç¼ºå£ä¹Ÿæ˜¯å¼€å‘å›¢é˜Ÿè‡ªå·±æœ€ä¸æ„¿æ„åå¤è¸©çš„å‘ã€‚</p>
<hr/>
<h2 data-id="heading-1"><strong>äºŒã€è¡Œä¸šå†…éƒ¨çš„çœŸå®ä¸Šæ¶æµç¨‹ï¼šä¸æ˜¯å•æ­¥éª¤ï¼Œè€Œæ˜¯å¤šç¯èŠ‚åä½œ</strong></h2>
<p>ä»¥æœåŠ¡ä¾›åº”å•†æˆ–æŠ€æœ¯å›¢é˜Ÿè§’åº¦ï¼Œä¸Šæ¶æµç¨‹é€šå¸¸è¢«æ‹†æˆå‡ ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¯¹åº”ä¸åŒå·¥å…·æˆ–èŒè´£ã€‚</p>
<p>æ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs">éœ€æ±‚ç¡®è®¤ â†’ èµ„æºæ•´ç† â†’ æ„å»º/ç­¾å â†’ ä¸Šä¼ æ„å»º â†’ å¡«å†™å®¡æ ¸èµ„æ–™ â†’ åé¦ˆæ²Ÿé€š â†’ ä¸Šçº¿å‘å¸ƒ
</code></pre>
<p>å…¶ä¸­ï¼Œæœ€å®¹æ˜“å‡ºé—®é¢˜çš„ç¯èŠ‚ä¸»è¦åœ¨ <strong>æ„å»ºã€ç­¾åã€ä¸Šä¼ ã€åå°é…ç½®</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-2"><strong>ä¸‰ã€æ„å»ºä¸ç­¾åï¼šè¯ä¹¦ä½“ç³»æ˜¯ä¸Šæ¶æœåŠ¡çš„ç¬¬ä¸€é“å</strong></h2>
<p>å¯¹äºæ²¡æœ‰ iOS ç»éªŒçš„å›¢é˜Ÿï¼Œä¸Šæ¶æœåŠ¡é¦–å…ˆè¦å¤„ç†çš„æ˜¯è¯ä¹¦ä½“ç³»ï¼š</p>
<ul>
<li>App Store å‘å¸ƒè¯ä¹¦</li>
<li>iOS å¼€å‘è¯ä¹¦</li>
<li>Provisioning Profile</li>
<li>Bundle ID</li>
<li>æƒé™ç”³æ˜ï¼ˆentitlementsï¼‰</li>
</ul>
<p>ä¼ ç»Ÿæ–¹å¼ä¾èµ–äº macOS ä¸é’¥åŒ™ä¸²ï¼Œä½†æœåŠ¡å›¢é˜Ÿä¸ºäº†æé«˜æ•ˆç‡ï¼Œä¼šä½¿ç”¨è·¨å¹³å°è¯ä¹¦ç®¡ç†å·¥å…·ï¼Œè®©è¯ä¹¦èƒ½åœ¨ Windowsã€Linuxã€Mac ä¹‹é—´å…±äº«ï¼Œä¸ä¼šå‡ºç°ï¼š</p>
<ul>
<li>è¯ä¹¦è¶…é™</li>
<li>profile å†²çª</li>
<li>å¤šäººè¦†ç›–</li>
<li>æ„å»ºå¤±è´¥</li>
</ul>
<p>åœ¨è¿™ä¸€ç¯èŠ‚ä¸­ï¼Œå¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰ çš„è·¨å¹³å°è¯ä¹¦åˆ›å»ºä¸ç®¡ç†èƒ½åŠ›éå¸¸å®ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸åœ¨ Windows/Linux ç”Ÿæˆã€ç®¡ç†è¯ä¹¦ï¼Œçœå»äº†â€œå¿…é¡»ç”¨ Mac çš„é™åˆ¶â€ï¼Œè¿™å¯¹æœåŠ¡å›¢é˜Ÿæ¥è¯´æå‡æ•ˆç‡éå¸¸æ˜æ˜¾ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f369d9af3d045ebbba0f3625e4d52b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345619&amp;x-signature=QC%2B7ZwgOaAsijbWZhGj7JORPgfo%3D" alt="è¯ä¹¦ç”Ÿæˆ" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3"><strong>å››ã€IPA ä¸Šä¼ ï¼šä¼ ç»Ÿæµç¨‹ä¾èµ– Macï¼Œæ–°æµç¨‹å¼ºè°ƒâ€œè·¨å¹³å°æ‰§è¡Œâ€</strong></h2>
<p>åœ¨ä¼ ç»ŸæœåŠ¡é‡Œï¼Œä¸Šä¼  IPA æ˜¯ç”± macOS å®Œæˆï¼š</p>
<ul>
<li>Xcode Organizer</li>
<li>Transporter App</li>
</ul>
<p>ä½†æœåŠ¡å›¢é˜Ÿæ¯æ—¥è¦å¤„ç†å¤šä¸ª Appï¼Œå¤šç³»ç»Ÿç¯å¢ƒä¸‹æ“ä½œ Mac æå…¶ä½æ•ˆã€‚
å› æ­¤è¡Œä¸šç°åœ¨æ™®éé‡‡ç”¨â€œè·¨å¹³å°ä¸Šä¼ â€æ¨¡å¼ï¼Œè®© Windows æˆ– Linux æˆä¸ºä¸Šä¼ èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ Macã€‚</p>
<p>ä¸€ä¸ªå¸¸è§çš„ä¸Šä¼ é“¾è·¯æ˜¯ï¼š</p>
<pre><code class="hljs">Linux CI æ„å»º â†’ Windows è¿è¥ä¸Šä¼  â†’ äº§å“æ ¡éªŒåå°å†…å®¹ â†’ æœåŠ¡å›¢é˜Ÿæäº¤å®¡æ ¸
</code></pre>
<p>åœ¨è¿™ä¸ªç¯èŠ‚ä¸­ï¼Œå¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰å‘½ä»¤è¡Œç‰ˆæœ¬ çš„ä»·å€¼éå¸¸çªå‡ºï¼Œå› ä¸ºå®ƒï¼š</p>
<ul>
<li>æ”¯æŒ Windows</li>
<li>æ”¯æŒ Linux</li>
<li>æ”¯æŒ macOS</li>
<li>ä¸éœ€è¦ Xcode</li>
<li>ä¸ä¾èµ– Transporter</li>
<li>æ”¯æŒæ—§é€šé“ä¸æ–°é€šé“</li>
<li>å¯ç”¨äºè‡ªåŠ¨åŒ–è„šæœ¬</li>
<li>å¯ç”¨äºäººå·¥ç»ˆç«¯ä¸Šä¼ </li>
</ul>
<p>å…¸å‹ä¸Šä¼ å‘½ä»¤ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u ios@team.com -p xxx-xxx-xxx-xxx -c 2 -f build/app.ipa
</code></pre>
<p>è¿™è®©æœåŠ¡å›¢é˜Ÿå¯ä»¥æŠŠä¸Šä¼ ä»»åŠ¡æ”¾å…¥ CI ä¸­ï¼Œä¹Ÿå¯ä»¥äº¤ç»™è¿è¥åœ¨ Windows ç›´æ¥æ‰§è¡Œï¼Œä»è€Œæå‡æ•´ä½“å¤„ç†æ•ˆç‡ã€‚</p>
<p>åŒæ—¶è¿˜æœ‰å›¾å½¢åŒ–ç•Œé¢ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26290d9a2d6943e59be89386ff7703ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345619&amp;x-signature=79UMukpt5DAc58kxAZqxlSQoh0A%3D" alt="ipaä¸Šä¼ " loading="lazy"/></p>
<hr/>
<h2 data-id="heading-4"><strong>äº”ã€App Store Connect é…ç½®ï¼šæœåŠ¡å›¢é˜Ÿæœ€è€—æ—¶ä½†ä¹Ÿæœ€å…³é”®çš„éƒ¨åˆ†</strong></h2>
<p>è®¸å¤šäººè¯¯ä»¥ä¸ºä¸Šä¼ å®Œæˆåå°±åªå‰©â€œç­‰å®¡æ ¸â€ï¼Œä½†æœåŠ¡å›¢é˜Ÿæœ€èŠ±æ—¶é—´çš„å…¶å®æ˜¯åå°èµ„æ–™å¡«å†™ã€‚</p>
<p>è¦å‡†å¤‡çš„å†…å®¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>åº”ç”¨æˆªå›¾ï¼ˆå¤šè¯­è¨€ã€å¤šå°ºå¯¸ï¼‰</li>
<li>åº”ç”¨æè¿°ã€å…³é”®è¯ã€éšç§æ ‡ç­¾</li>
<li>App å†…è´­ï¼ˆå¦‚æœ‰ï¼‰</li>
<li>å¹´é¾„åˆ†çº§</li>
<li>å®¡æ ¸è´¦å·å’Œè·¯å¾„</li>
<li>é¢„è§ˆè§†é¢‘ï¼ˆå¯é€‰ï¼‰</li>
</ul>
<p>è¡Œä¸šå†…ä¸ºäº†å‡å°‘é‡å¤åŠ³åŠ¨ï¼Œä¸€èˆ¬ä¼šå‡†å¤‡æˆªå›¾æ‰¹é‡ä¸Šä¼ å·¥å…·ï¼Œè€Œ <strong>å¼€å¿ƒä¸Šæ¶ä¹Ÿæä¾›äº†æˆªå›¾æ‰¹é‡ä¸Šä¼ èƒ½åŠ›</strong>ï¼Œèƒ½å¤Ÿï¼š</p>
<ul>
<li>ä¸€æ¬¡ä¸Šä¼ å¤šä¸ªå°ºå¯¸</li>
<li>è‡ªåŠ¨è¯†åˆ«è¯­è¨€ç›®å½•</li>
<li>è‡ªä¸»ç®¡ç†æè¿°ä¸å…³é”®è¯</li>
</ul>
<p>è¿™éƒ¨åˆ†åŠŸèƒ½åœ¨ App ä¸Šæ¶æœåŠ¡åœºæ™¯ä¸­ä½¿ç”¨é¢‘ç‡éå¸¸é«˜ã€‚</p>
<hr/>
<h2 data-id="heading-5"><strong>å…­ã€å®¡æ ¸é˜¶æ®µï¼ˆå°¤å…¶æ˜¯ 4.3ã€5.1.1ï¼‰æ˜¯æœåŠ¡å›¢é˜Ÿçš„ä¸“ä¸šèƒ½åŠ›æ‰€åœ¨</strong></h2>
<p>App ä¸Šæ¶æœåŠ¡çš„æ ¸å¿ƒä»·å€¼å¹¶ä¸æ˜¯æŠŠ IPA ä¼ ä¸Šå»ï¼Œè€Œæ˜¯å¤„ç†ï¼š</p>
<ul>
<li>4.3 é‡å¤åº”ç”¨</li>
<li>5.1.1 æƒé™æ‹’å®¡</li>
<li>2.1 ä¸å¯ç”¨æ€§</li>
<li>å…ƒæ•°æ®ï¼ˆå†…å®¹ï¼‰é—®é¢˜</li>
<li>éšç§é—®é¢˜</li>
</ul>
<p>è¿™äº›é—®é¢˜ä¸æ˜¯å·¥å…·èƒ½è§£å†³çš„ï¼Œè€Œæ˜¯ç»éªŒé©±åŠ¨ã€‚</p>
<p>å› æ­¤é€šå¸¸çš„æœåŠ¡æ¨¡å¼æ˜¯ï¼š</p>
<pre><code class="hljs">å·¥å…·å®Œæˆä¸Šä¼  â†’ äººæ•´ç†åˆè§„ â†’ å›¢é˜Ÿå¤„ç†å®¡æ ¸åé¦ˆ
</code></pre>
<p>å¯¹äºè·¨ç«¯é¡¹ç›®ï¼ˆuni-app/H5/Flutterï¼‰ï¼Œå®¡æ ¸é€»è¾‘å°¤å…¶ä¸¥æ ¼ï¼Œéœ€è¦ï¼š</p>
<ul>
<li>æä¾›æ¸…æ™°å®¡æ ¸è¯´æ˜</li>
<li>å¢å¼ºåŸç”Ÿç»“æ„</li>
<li>è¡¥å……åŠ¨æ€å†…å®¹</li>
<li>é¿å…æ¨¡æ¿åŒ– UI</li>
</ul>
<p>æœåŠ¡å›¢é˜Ÿä¼šäº‹å…ˆå¯¹è¿™äº›é«˜é¢‘é—®é¢˜åšå®¡æŸ¥ï¼Œå‡å°‘æ¥å›è¿”å·¥ã€‚</p>
<hr/>
<h2 data-id="heading-6"><strong>ç°ä»£ App ä¸Šæ¶æœåŠ¡å·²ç»ä»â€œä»£æ“ä½œâ€ï¼Œå˜æˆâ€œæµç¨‹æ„å»ºä¸å·¥å…·é“¾åä½œâ€</strong></h2>
<p>ç»“åˆè¡Œä¸šå˜åŒ–ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>Mac ä¸å†æ˜¯ä¸Šæ¶çš„å¿…éœ€å“</li>
<li>Windows ä¸ Linux æˆä¸ºä¸»è¦æ‰§è¡Œç¯å¢ƒ</li>
<li>è¯ä¹¦ä¸å†ä¾èµ–é’¥åŒ™ä¸²ï¼Œè€Œæ˜¯è·¨å¹³å°ç®¡ç†</li>
<li>ä¸Šä¼ ä¸å†ä¾èµ– Transporterï¼Œè€Œæ˜¯ç¬¬ä¸‰æ–¹å·¥å…·è·¨å¹³å°å‘½ä»¤è¡Œ</li>
<li>å®¡æ ¸ä¸å†é ç»éªŒè‡†æµ‹ï¼Œè€Œæ˜¯æµç¨‹åŒ–ã€æ¨¡æ¿åŒ–</li>
<li>æœåŠ¡å›¢é˜Ÿçš„ä¼˜åŠ¿æ¥è‡ªæ•ˆç‡ä¸æµç¨‹ï¼Œè€Œéè®¾å¤‡</li>
</ul>
<p>å¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰ æ˜¯ å¸®åŠ©æœåŠ¡å›¢é˜Ÿä¸å¼€å‘è€…æ›´é«˜æ•ˆæ‰§è¡Œä¸Šæ¶æµç¨‹çš„å·¥å…·èŠ‚ç‚¹ã€‚</p>
<p>å®ƒè§£å†³çš„æ˜¯è¡Œä¸šçš„ç—›ç‚¹ï¼šè·¨å¹³å°ã€å… Macã€è‡ªåŠ¨åŒ–ã€æ‰¹é‡åŒ–ã€ä½è€¦åˆçš„ä¸Šæ¶æ‰§è¡Œèƒ½åŠ›ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯è°ƒè¯•æŠ€å·§]]></title>    <link>https://juejin.cn/post/7579190764771213352</link>    <guid>https://juejin.cn/post/7579190764771213352</guid>    <pubDate>2025-12-03T05:53:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579190764771213352" data-draft-id="7579190764770967592" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯è°ƒè¯•æŠ€å·§"/> <meta itemprop="keywords" content="å‰ç«¯,å‰ç«¯å·¥ç¨‹åŒ–,Visual Studio Code"/> <meta itemprop="datePublished" content="2025-12-03T05:53:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Blueå¸ƒé²"/> <meta itemprop="url" content="https://juejin.cn/user/694547080809736"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯è°ƒè¯•æŠ€å·§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547080809736/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Blueå¸ƒé²
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:53:00.000Z" title="Wed Dec 03 2025 05:53:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡æ¡£ä»‹ç»å‰ç«¯å¼€å‘ä¸­å¸¸ç”¨çš„è°ƒè¯•æŠ€å·§ï¼Œæ¶µç›– Consoleã€VSCode Debug å’Œ Chrome Debugger çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä¸€. Console</h2>
<p>Console æ˜¯å‰ç«¯å¼€å‘ä¸­æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„è°ƒè¯•å·¥å…·
console.log()ã€console.info()ã€console.warn()ã€console.error() è¿™äº›éƒ½æ˜¯æ¯”è¾ƒåŸºç¡€çš„è¾“å‡ºåŠŸèƒ½ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï½</p>
<h4 data-id="heading-1">console.table()</h4>
<p>éå¸¸é€‚åˆç”¨äºè¾“å‡ºç»“æ„åŒ–æ•°æ®ï¼ˆå¯¹è±¡ã€æ•°ç»„ç­‰ï¼‰
å¯¹äºæ¥å£è¿”å›ç”¨è¿™ç§è¾“å‡ºæ–¹æ³•éå¸¸å¥½ï¼Œè¿˜èƒ½ç‚¹å‡»è¡¨å¤´æ’åº</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è¾“å‡ºæ•°ç»„</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span> }
];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">table</span>(users);

<span class="hljs-comment">// è¾“å‡ºå¯¹è±¡</span>
<span class="hljs-keyword">const</span> user = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">'john@example.com'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,
  <span class="hljs-attr">address</span>: {
    <span class="hljs-attr">city</span>: <span class="hljs-string">'Beijing'</span>,
    <span class="hljs-attr">country</span>: <span class="hljs-string">'China'</span>
  }
};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">table</span>(user);
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0d81bcfe0924704a019f6be46c59b24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=9JnDxyrMx9CjoQPATHnywysB7ao%3D" alt="Pasted image 20251124112231.png" loading="lazy"/></p>
<h4 data-id="heading-2">console.time() / console.timeEnd()</h4>
<p>ç”¨äºæµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'API è¯·æ±‚è€—æ—¶'</span>);
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'API è¯·æ±‚è€—æ—¶'</span>); <span class="hljs-comment">// API è¯·æ±‚è€—æ—¶: 234.567ms</span>
  });
</code></pre>
<h2 data-id="heading-3">äºŒ. VSCode Debug</h2>
<p>VSCode æä¾›äº†å¼ºå¤§çš„è°ƒè¯•åŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®æ–­ç‚¹ã€å•æ­¥è°ƒè¯•ã€ç›‘æ§å˜é‡å€¼ç­‰ã€‚
VSCode ç³»çš„ç¼–è¾‘å™¨æ“ä½œæ–¹æ³•éƒ½ä¸€æ ·ï¼Œå¦‚ Cursorï½</p>
<h3 data-id="heading-4">2.1 é…ç½®è°ƒè¯•ç¯å¢ƒ</h3>
<p>VSCode ä¾§è¾¹æ é€‰æ‹© Run and Debug å¹¶åˆ›å»º launch.json æ–‡ä»¶
åˆ›å»º launch.json æ—¶é€‰æ‹©è‡ªå·±å¯¹åº”çš„æµè§ˆå™¨å³å¯ï¼ˆChrome or Edgeï¼‰</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f85e1d6b2074b21984b75adba70a609~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=nx%2BOVBs3EoX0kkpApewese7P2fw%3D" alt="Pasted image 20251124141238.png" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chrome"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"request"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"launch"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Launch Chrome against localhost"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://localhost:8080"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// è¿™é‡Œæ”¹æˆè‡ªå·±æœ¬åœ°å¼€å‘çš„ url</span>
      <span class="hljs-attr">"webRoot"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${workspaceFolder}"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"skipFiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"${workspaceFolder}/node_modules/**"</span> <span class="hljs-comment">// debug æ—¶å¿½ç•¥ node_modulesï¼Œåªæœ‰æˆ‘ä»¬ä¸šåŠ¡ä»£ç è¿›è¡Œ Debug å»ºè®®åŠ ä¸Š</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>é…ç½®å¥½åï¼Œç‚¹å‡»èœå•æ çš„ <strong>Launch</strong> æŒ‰é’®ï¼Œä¼šé‡æ–°æ‰“å¼€ä¸€ä¸ª chrome çš„çª—å£</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb1a82fa21684c40bdf580284cb7ae68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=7T6BRDKOlKSzWjOUZZtJcvmiF3Q%3D" alt="Pasted image 20251124141905.png" loading="lazy"/></p>
<h3 data-id="heading-5">2.2 è°ƒè¯•æ§åˆ¶</h3>
<p>æ­¤æ—¶åœ¨å¯¹åº”ä»£ç è¡Œæ•°å‰ç«¯ç‚¹å‡»ä¸€ä¸‹ï¼Œå‡ºç°çº¢ç‚¹æ—¶å³ <strong>æ‰“æ–­ç‚¹</strong> æˆåŠŸï¼Œæ­¤æ—¶åˆ·æ–°é¡µé¢å³å¯çœ‹åˆ°ä»£ç åœåœ¨è¿™é‡Œï¼Œå¯ä»¥é¼ æ ‡ Hover æŸ¥çœ‹å¯¹åº”å˜é‡å€¼ï¼Œä¹Ÿå¯ä»¥é€‰æ‹© <strong>Step Over (F10)</strong> ä»£ç ä¸€æ­¥ä¸€æ­¥æ‰§è¡Œï¼Œå¯ä»¥çœ‹åˆ°ä»£ç è¯¦ç»†çš„æ‰§è¡Œé€»è¾‘ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8038627e2ff74609a4060934bd71fc76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=4CVRZAi4zynJYhHgYtIQ%2FdhLUU8%3D" alt="Pasted image 20251124142937.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98fe9ec432e44fc7890c1e70ab56b211~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=birNQj9ps2aEM5IEmLWU7TlDXtA%3D" alt="Pasted image 20251124144133.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e52cd4da03147eda3410ab05578ff35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=oqiFJjv%2FtuSZE1Nn0NjZ%2F2ENMNA%3D" alt="Pasted image 20251124143803.png" loading="lazy"/></p>
<p>è°ƒè¯•æ—¶ï¼Œä¸Šé¢çš„åŸºæœ¬æŒ‰é’®åŠŸèƒ½ï¼š</p>
<ul>
<li><strong>ç»§ç»­ (F5)</strong>: ç»§ç»­æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹</li>
<li><strong>å•æ­¥è·³è¿‡ (F10)</strong>: æ‰§è¡Œå½“å‰è¡Œï¼Œä¸è¿›å…¥å‡½æ•°å†…éƒ¨</li>
<li><strong>å•æ­¥è¿›å…¥ (F11)</strong>: è¿›å…¥å‡½æ•°å†…éƒ¨</li>
<li><strong>å•æ­¥è·³å‡º (Shift + F11)</strong>: è·³å‡ºå½“å‰å‡½æ•°</li>
<li><strong>é‡å¯ (Ctrl + Shift + F5)</strong>: é‡æ–°å¼€å§‹è°ƒè¯•</li>
<li><strong>åœæ­¢ (Shift + F5)</strong>: åœæ­¢è°ƒè¯•</li>
</ul>
<h3 data-id="heading-6">3.2 å˜é‡ç›‘è§†åŠé”™è¯¯æ•è·</h3>
<h4 data-id="heading-7">å˜é‡ç›‘è§†</h4>
<p>å¯ä»¥åœ¨å˜é‡ç›‘è§†çš„é¢æ¿ä¸­ç›‘å¬æŸä¸ªå˜é‡ï¼Œåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­å®æ—¶çœ‹åˆ°å˜é‡å˜åŒ–</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d52f800956640b2ac1100e9711bd15e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=HCe7Qajd%2BrnCAbl69wt%2BR60QwAk%3D" alt="Pasted image 20251124142937.png" loading="lazy"/></p>
<h4 data-id="heading-8">é”™è¯¯æ•è·</h4>
<p>åœ¨æ–­ç‚¹é¢æ¿ä¸­å¼€å¯<strong>Caught Exceptions</strong>ï¼Œå³å¯åœ¨æœ‰å¼‚å¸¸æ—¶ï¼Œè‡ªåŠ¨æ–­ç‚¹åˆ°é”™è¯¯ä»£ç è¡Œå¤„ï½</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80700036d12c4e6ea31d481de16415cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=23nXHLupWC8hQQV6lgCpI1QMqRY%3D" alt="Pasted image 20251124144816.png" loading="lazy"/></p>
<h2 data-id="heading-9">ä¸‰. Chrome Debugger</h2>
<p>Chrome Debugger æ˜¯æŒ‡åœ¨ä»£ç ä¸­ä½¿ç”¨ <code>debugger</code> è¯­å¥è¿›è¡Œè°ƒè¯•çš„æ–¹æ³•ã€‚å½“ä»£ç æ‰§è¡Œåˆ° <code>debugger</code> è¯­å¥æ—¶ï¼Œå¦‚æœæµè§ˆå™¨ DevTools å·²æ‰“å¼€ï¼Œç¨‹åºä¼šè‡ªåŠ¨æš‚åœï¼Œæ­¤æ—¶å¯ä»¥æŸ¥çœ‹å˜é‡å€¼ã€è°ƒç”¨å †æ ˆç­‰ä¿¡æ¯ã€‚</p>
<h3 data-id="heading-10">3.1 debugger è¯­å¥åŸºç¡€</h3>
<h4 data-id="heading-11">ä»€ä¹ˆæ˜¯ debugger è¯­å¥</h4>
<p><code>debugger</code> æ˜¯ JavaScript çš„ä¸€ä¸ªå…³é”®å­—ï¼Œå½“æµè§ˆå™¨ DevTools æ‰“å¼€æ—¶ï¼Œæ‰§è¡Œåˆ°è¯¥è¯­å¥ä¼šè‡ªåŠ¨æš‚åœç¨‹åºæ‰§è¡Œã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myFunction</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> data = { <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> };
  <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// ç¨‹åºä¼šåœ¨è¿™é‡Œæš‚åœ</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
}
</code></pre>
<h4 data-id="heading-12">ä½¿ç”¨å‰æ</h4>
<ol>
<li><strong>å¿…é¡»æ‰“å¼€ Chrome DevTools</strong>ï¼šå¦‚æœ DevTools æœªæ‰“å¼€ï¼Œ<code>debugger</code> è¯­å¥ä¼šè¢«å¿½ç•¥</li>
<li><strong>ç¡®ä¿ Source Maps å¯ç”¨</strong>ï¼šå¼€å‘ç¯å¢ƒé€šå¸¸é»˜è®¤å¯ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½®</li>
<li><strong>ä»£ç å¿…é¡»è¢«æ‰§è¡Œ</strong>ï¼šåªæœ‰æ‰§è¡Œåˆ°çš„ <code>debugger</code> æ‰ä¼šç”Ÿæ•ˆ</li>
</ol>
<h3 data-id="heading-13">3.2 åŸºç¡€ä½¿ç”¨åœºæ™¯</h3>
<h4 data-id="heading-14">è°ƒè¯•å‡½æ•°æ‰§è¡Œ</h4>
<p>åœ¨å‡½æ•°å¼€å§‹æˆ–å…³é”®ä½ç½®æ·»åŠ  <code>debugger</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// lib/utils/format-number.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">formatNumber</span> = (<span class="hljs-params">num: <span class="hljs-built_in">number</span></span>) =&gt; {
  <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹ä¼ å…¥çš„å‚æ•°</span>
  <span class="hljs-keyword">const</span> formatted = num.<span class="hljs-title function_">toLocaleString</span>(<span class="hljs-string">'en-US'</span>);
  <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹æ ¼å¼åŒ–åçš„ç»“æœ</span>
  <span class="hljs-keyword">return</span> formatted;
};
</code></pre>
<h4 data-id="heading-15">è°ƒè¯•æ¡ä»¶åˆ†æ”¯</h4>
<p>åœ¨æ¡ä»¶åˆ¤æ–­å¤„æ·»åŠ  <code>debugger</code>ï¼ŒæŸ¥çœ‹æ¡ä»¶å€¼å’Œæ‰§è¡Œè·¯å¾„ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">processUser</span>(<span class="hljs-params">user: User</span>) {
  <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹ user å¯¹è±¡</span>
  <span class="hljs-keyword">if</span> (user.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>) {
    <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// è¿›å…¥æ­¤åˆ†æ”¯</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">handleAdult</span>(user);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// è¿›å…¥æ­¤åˆ†æ”¯</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">handleMinor</span>(user);
  }
}
</code></pre>
<h4 data-id="heading-16">è°ƒè¯•å¾ªç¯</h4>
<p>åœ¨å¾ªç¯ä¸­æ·»åŠ  <code>debugger</code>ï¼Œå¯ä»¥é€æ­¥æŸ¥çœ‹æ¯æ¬¡è¿­ä»£ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">processItems</span>(<span class="hljs-params">items: Item[]</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; items.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æ¯æ¬¡å¾ªç¯éƒ½ä¼šæš‚åœï¼Œå¯ä»¥æŸ¥çœ‹ i å’Œ items[i]</span>
    <span class="hljs-keyword">const</span> item = items[i];
    <span class="hljs-title function_">processItem</span>(item);
  }
}

<span class="hljs-comment">// æˆ–è€…åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æš‚åœ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processItems</span>(<span class="hljs-params">items: Item[]</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; items.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (items[i].<span class="hljs-property">status</span> === <span class="hljs-string">'error'</span>) {
      <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// åªåœ¨é‡åˆ°é”™è¯¯çŠ¶æ€æ—¶æš‚åœ</span>
    }
    <span class="hljs-title function_">processItem</span>(items[i]);
  }
}
</code></pre>
<h4 data-id="heading-17">è°ƒè¯• React ç»„ä»¶</h4>
<p>åœ¨ç»„ä»¶å‡½æ•°ä½“ä¸­æ·»åŠ  <code>debugger</code>ï¼ŒæŸ¥çœ‹æ¯æ¬¡æ¸²æŸ“æ—¶çš„ props å’Œ stateï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// components/UserProfile.tsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">UserProfile</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">Props</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{ userId }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> [user, setUser] = useState&lt;<span class="hljs-title class_">User</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  
  <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹ç»„ä»¶æ¸²æŸ“æ—¶çš„ props å’Œåˆå§‹ state</span>
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹ useEffect æ‰§è¡Œæ—¶çš„ userId</span>
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-title function_">fetchUser</span>(userId).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
      <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹è·å–åˆ°çš„ç”¨æˆ·æ•°æ®</span>
      <span class="hljs-title function_">setUser</span>(data);
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    });
  }, [userId]);
  
  <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// æŸ¥çœ‹æ¸²æŸ“æ—¶çš„æœ€ç»ˆçŠ¶æ€</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user?.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
};
</code></pre>
<h3 data-id="heading-18">3.3 Chrome DevTools æ–­ç‚¹è°ƒè¯•é¢æ¿</h3>
<h4 data-id="heading-19">æš‚åœåçš„æ“ä½œ</h4>
<p>å½“ <code>debugger</code> æš‚åœç¨‹åºåï¼Œå¯ä»¥åœ¨ DevTools ä¸­ï¼š</p>
<p><strong>æŸ¥çœ‹å˜é‡å€¼</strong></p>
<ul>
<li>åœ¨ Sources é¢æ¿çš„ Scope åŒºåŸŸæŸ¥çœ‹å±€éƒ¨å˜é‡</li>
<li>å°†é¼ æ ‡æ‚¬åœåœ¨ä»£ç ä¸­çš„å˜é‡ä¸ŠæŸ¥çœ‹å€¼</li>
<li>åœ¨ Console ä¸­è¾“å…¥å˜é‡åæŸ¥çœ‹å€¼</li>
</ul>
<p><strong>ç›‘è§†å˜é‡</strong></p>
<ul>
<li>åœ¨ Watch é¢æ¿æ·»åŠ è¦ç›‘è§†çš„å˜é‡</li>
<li>å³å¯åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­å®æ—¶æ’ä»¶å˜é‡å€¼çš„å˜åŒ–</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77e334d175b942d6aee010e0343e9cd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=ZggA5Bl696bQjZAeaUJm1sQRrzk%3D" alt="Pasted image 20251124151931.png" loading="lazy"/></p>
<h4 data-id="heading-20">å•æ­¥è°ƒè¯•</h4>
<p>æš‚åœåå¯ä»¥ä½¿ç”¨å•æ­¥è°ƒè¯•ï¼š</p>
<ul>
<li><strong>F8 (Resume)</strong>: ç»§ç»­æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ª <code>debugger</code></li>
<li><strong>F10 (Step over)</strong>: å•æ­¥è·³è¿‡ï¼Œä¸è¿›å…¥å‡½æ•°å†…éƒ¨</li>
<li><strong>F11 (Step into)</strong>: å•æ­¥è¿›å…¥ï¼Œè¿›å…¥å‡½æ•°å†…éƒ¨</li>
<li><strong>Shift + F11 (Step out)</strong>: å•æ­¥è·³å‡ºï¼Œè·³å‡ºå½“å‰å‡½æ•°</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1c8f20e3fa64626a27a09b498d37f8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmx1ZeW4g-mygQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765345979&amp;x-signature=enkHEcOGhH7k47x2%2BWgzW971VCI%3D" alt="Pasted image 20251124151313.png" loading="lazy"/></p>
<h2 data-id="heading-21">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FConsole" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Console" ref="nofollow noopener noreferrer">MDN Console API</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FStatements%2Fdebugger" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/debugger" ref="nofollow noopener noreferrer">MDN debugger è¯­å¥</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Fdocs%2Feditor%2Fdebugging" target="_blank" title="https://code.visualstudio.com/docs/editor/debugging" ref="nofollow noopener noreferrer">VSCode Debugging</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fdevtools%2F" target="_blank" title="https://developer.chrome.com/docs/devtools/" ref="nofollow noopener noreferrer">Chrome DevTools</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fdevtools%2Fjavascript%2F" target="_blank" title="https://developer.chrome.com/docs/devtools/javascript/" ref="nofollow noopener noreferrer">Chrome DevTools è°ƒè¯• JavaScript</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fadvanced-features%2Fdebugging" target="_blank" title="https://nextjs.org/docs/advanced-features/debugging" ref="nofollow noopener noreferrer">Next.js Debugging</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot3.0å®æˆ˜ï¼š5ä¸ªé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œè®©ä½ çš„åº”ç”¨å¿«å¦‚é—ªç”µâš¡]]></title>    <link>https://juejin.cn/post/7579167622106398720</link>    <guid>https://juejin.cn/post/7579167622106398720</guid>    <pubDate>2025-12-03T04:16:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579167622106398720" data-draft-id="7579165599042715663" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot3.0å®æˆ˜ï¼š5ä¸ªé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œè®©ä½ çš„åº”ç”¨å¿«å¦‚é—ªç”µâš¡"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-03T04:16:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot3.0å®æˆ˜ï¼š5ä¸ªé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œè®©ä½ çš„åº”ç”¨å¿«å¦‚é—ªç”µâš¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:16:59.000Z" title="Wed Dec 03 2025 04:16:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot3.0å®æˆ˜ï¼š5ä¸ªé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œè®©ä½ çš„åº”ç”¨å¿«å¦‚é—ªç”µâš¡</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>åœ¨å½“ä»Šçš„äº’è”ç½‘æ—¶ä»£ï¼Œé«˜å¹¶å‘åœºæ™¯å·²ç»æˆä¸ºè®¸å¤šåº”ç”¨çš„å¸¸æ€ã€‚æ— è®ºæ˜¯ç”µå•†å¹³å°çš„ç§’æ€æ´»åŠ¨ã€ç¤¾äº¤åª’ä½“çš„çƒ­ç‚¹äº‹ä»¶ï¼Œè¿˜æ˜¯é‡‘èç³»ç»Ÿçš„å®æ—¶äº¤æ˜“ï¼Œéƒ½éœ€è¦åº”å¯¹æµ·é‡çš„ç”¨æˆ·è¯·æ±‚ã€‚Spring Bootä½œä¸ºJavaç”Ÿæ€ä¸­æœ€æµè¡Œçš„å¾®æœåŠ¡æ¡†æ¶ä¹‹ä¸€ï¼Œå…¶3.0ç‰ˆæœ¬åœ¨æ€§èƒ½ã€å“åº”é€Ÿåº¦å’Œèµ„æºåˆ©ç”¨ç‡æ–¹é¢æœ‰äº†æ˜¾è‘—æå‡ã€‚ç„¶è€Œï¼Œä»…ä»…ä¾èµ–æ¡†æ¶æœ¬èº«çš„ä¼˜åŒ–æ˜¯ä¸å¤Ÿçš„ï¼Œå¼€å‘è€…è¿˜éœ€è¦æŒæ¡ä¸€ç³»åˆ—é’ˆå¯¹é«˜å¹¶å‘åœºæ™¯çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨5ä¸ªåœ¨Spring Boot 3.0ä¸­å®ç°é«˜æ€§èƒ½çš„å…³é”®æŠ€å·§ï¼Œæ¶µç›–ä»çº¿ç¨‹æ± é…ç½®åˆ°ç¼“å­˜ç­–ç•¥ã€ä»æ•°æ®åº“ä¼˜åŒ–åˆ°å¼‚æ­¥å¤„ç†çš„æ–¹æ–¹é¢é¢ã€‚è¿™äº›æŠ€å·§ä¸ä»…åŸºäºSpring Boot 3.0çš„æ–°ç‰¹æ€§ï¼Œè¿˜ç»“åˆäº†å®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„æœ€ä½³å®è·µï¼Œå¸®åŠ©ä½ çš„åº”ç”¨åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¾ç„¶èƒ½å¤Ÿâ€œå¿«å¦‚é—ªç”µâ€ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸»ä½“</h2>
<h3 data-id="heading-3">1. åˆç†é…ç½®Webå®¹å™¨çš„çº¿ç¨‹æ± </h3>
<h4 data-id="heading-4">é—®é¢˜èƒŒæ™¯</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Bootä½¿ç”¨åµŒå…¥å¼Tomcatä½œä¸ºWebå®¹å™¨ï¼Œå…¶çº¿ç¨‹æ± é…ç½®å¯èƒ½æ— æ³•æ»¡è¶³é«˜å¹¶å‘éœ€æ±‚ã€‚ç‰¹åˆ«æ˜¯åœ¨çªå‘æµé‡åœºæ™¯ä¸‹ï¼Œçº¿ç¨‹é¥¥é¥¿ä¼šå¯¼è‡´è¯·æ±‚æ’é˜Ÿç”šè‡³è¶…æ—¶ã€‚</p>
<h4 data-id="heading-5">Spring Boot 3.0çš„æ”¹è¿›</h4>
<p>Spring Boot 3.0å¯¹WebFluxå’Œéé˜»å¡IOæä¾›äº†æ›´å¥½çš„æ”¯æŒï¼Œä½†å¯¹äºä¼ ç»ŸServletå®¹å™¨ï¼ˆå¦‚Tomcatï¼‰ï¼Œä»éœ€å…³æ³¨ä»¥ä¸‹å…³é”®å‚æ•°ï¼š</p>
<pre><code class="hljs language-properties" lang="properties">server.tomcat.max-threads=200 # é»˜è®¤æ˜¯200
server.tomcat.min-spare-threads=20 # é»˜è®¤æ˜¯10
server.tomcat.accept-count=100 # ç­‰å¾…é˜Ÿåˆ—é•¿åº¦
</code></pre>
<h4 data-id="heading-6">ä¼˜åŒ–å»ºè®®</h4>
<ul>
<li><strong>åŠ¨æ€è°ƒæ•´</strong>ï¼šç»“åˆActuatorå’ŒPrometheusç›‘æ§çº¿ç¨‹æ± çŠ¶æ€</li>
<li><strong>è®¡ç®—å…¬å¼</strong>ï¼š<code>max-threads = (CPUæ ¸å¿ƒæ•° * CPUåˆ©ç”¨ç‡ç›®æ ‡ * (1 + Waitæ—¶é—´/Computeæ—¶é—´))</code></li>
<li><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼šå¯¹äºIOå¯†é›†å‹åº”ç”¨è€ƒè™‘ä½¿ç”¨Undertowæˆ–Jetty</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> TomcatProtocolHandlerCustomizer&lt;?&gt; protocolHandlerCustomizer() {
    <span class="hljs-keyword">return</span> protocolHandler -&gt; {
        protocolHandler.setExecutor(Executors.newVirtualThreadPerTaskExecutor());
    };
}
</code></pre>
<blockquote>
<p>Spring Boot 3.0æ”¯æŒJava19çš„è™šæ‹Ÿçº¿ç¨‹ï¼ˆLoomé¡¹ç›®ï¼‰ï¼Œå¯ä»¥å¤§å¹…æå‡çº¿ç¨‹å¯†é›†å‹åº”ç”¨çš„æ€§èƒ½ã€‚</p>
</blockquote>
<h3 data-id="heading-7">2. Rediså¤šçº§ç¼“å­˜è®¾è®¡ä¸å®ç°</h3>
<h4 data-id="heading-8">ç¼“å­˜ç­–ç•¥æ¼”è¿›</h4>
<p>ä¼ ç»Ÿçš„å•ä¸€Redisç¼“å­˜åœ¨é«˜å¹¶å‘ä¸‹ä¼šé‡åˆ°ï¼š</p>
<ul>
<li>Cacheç©¿é€ï¼ˆé¢‘ç¹æŸ¥è¯¢ä¸å­˜åœ¨çš„keyï¼‰</li>
<li>Cacheé›ªå´©ï¼ˆå¤§é‡keyåŒæ—¶è¿‡æœŸï¼‰</li>
<li>Cacheå‡»ç©¿ï¼ˆçƒ­ç‚¹keyçªç„¶å¤±æ•ˆï¼‰</li>
</ul>
<h4 data-id="heading-9">Spring Boot 3.0è§£å†³æ–¹æ¡ˆ</h4>
<ol>
<li>
<p><strong>Caffeineæœ¬åœ°ç¼“å­˜</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CaffeineCacheManager <span class="hljs-title function_">cacheManager</span><span class="hljs-params">()</span> {
        Caffeine&lt;Object, Object&gt; caffeine = Caffeine.newBuilder()
                .maximumSize(<span class="hljs-number">10_000</span>)
                .expireAfterWrite(<span class="hljs-number">5</span>, TimeUnit.MINUTES);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaffeineCacheManager</span>(<span class="hljs-string">"users"</span>, caffeine);
    }
}
</code></pre>
</li>
<li>
<p><strong>Redisåˆ†å±‚ç¼“å­˜</strong>ï¼š</p>
<ul>
<li>L1: Local Cache (Caffeine)</li>
<li>L2: Redis Cluster</li>
<li>L3: DB (å¸¦ç†”æ–­ä¿æŠ¤)</li>
</ul>
</li>
<li>
<p><strong>BloomFilteré˜²ç©¿é€</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> BloomFilter&lt;String&gt; <span class="hljs-title function_">userBloomFilter</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> BloomFilter.create(
            Funnels.stringFunnel(StandardCharsets.UTF_8),
            <span class="hljs-number">1_000_000</span>,
            <span class="hljs-number">0.01</span>);
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-10">3. R2DBCå“åº”å¼æ•°æ®åº“è®¿é—®</h3>
<h4 data-id="heading-11">JDBCç“¶é¢ˆåˆ†æ</h4>
<p>ä¼ ç»ŸJDBCçš„é˜»å¡å¼æ“ä½œåœ¨é«˜å¹¶å‘ä¸‹ä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>Connection Poolè€—å°½</li>
<li>Thread Blockingå¢åŠ å»¶è¿Ÿ</li>
</ul>
<h4 data-id="heading-12">Spring Boot 3.0å“åº”å¼æ–¹æ¡ˆ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Repository</span> 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ReactiveCrudRepository</span>&lt;User, Long&gt; {

    <span class="hljs-meta">@Query("SELECT * FROM users WHERE age &gt;= $1")</span>
    Flux&lt;User&gt; <span class="hljs-title function_">findByAgeGreaterThan</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span>;
}

<span class="hljs-comment">// Controllerç¤ºä¾‹ </span>
<span class="hljs-meta">@GetMapping("/users")</span>
<span class="hljs-keyword">public</span> Flux&lt;User&gt; <span class="hljs-title function_">getUsers</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> <span class="hljs-type">int</span> age)</span> {
    <span class="hljs-keyword">return</span> userRepository.findByAgeGreaterThan(age)
            .timeout(Duration.ofMillis(<span class="hljs-number">500</span>))
            .onErrorResume(e -&gt; Flux.empty());
}
</code></pre>
<h4 data-id="heading-13">æ€§èƒ½å¯¹æ¯”æ•°æ®ï¼š</h4>

























<table><thead><tr><th>QPS</th><th>JDBC</th><th>R2DBC</th></tr></thead><tbody><tr><td>100</td><td>~50ms</td><td>~20ms</td></tr><tr><td>1000</td><td>~300ms</td><td>~80ms</td></tr><tr><td>10000</td><td>Timeout</td><td>~200ms</td></tr></tbody></table>
<h3 data-id="heading-14">4. CompletableFutureå¼‚æ­¥ç¼–æ’</h3>
<h4 data-id="heading-15">IOå¯†é›†å‹ä»»åŠ¡ä¼˜åŒ–ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span> 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ProductClient productClient;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> InventoryClient inventoryClient;
    
    <span class="hljs-meta">@Async("boundedTaskExecutor")</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;OrderResult&gt; <span class="hljs-title function_">createOrderAsync</span><span class="hljs-params">(OrderRequest request)</span> {
        CompletableFuture&lt;ProductInfo&gt; productFuture = productClient.getProductAsync(request.productId());
        CompletableFuture&lt;InventoryInfo&gt; inventoryFuture = inventoryClient.getInventoryAsync(request.productId());
        
        <span class="hljs-keyword">return</span> productFuture.thenCombineAsync(inventoryFuture, (product, inventory) -&gt; {
            <span class="hljs-keyword">if</span>(inventory.stock() &lt; request.quantity()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"åº“å­˜ä¸è¶³"</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderResult</span>(product.id(), product.price() * request.quantity());
        });
    }
}
</code></pre>
<h4 data-id="heading-16">Executoré…ç½®å…³é”®ç‚¹ï¼š</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span> 
<span class="hljs-meta">@EnableAsync</span> 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncConfigurer</span> {

    <span class="hljs-meta">@Override</span> 
    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">getAsyncExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
        executor.setCorePoolSize(Runtime.getRuntime().availableProcessors());
        executor.setMaxPoolSize(<span class="hljs-number">200</span>);
        executor.setQueueCapacity(<span class="hljs-number">1000</span>);
        executor.setThreadNamePrefix(<span class="hljs-string">"Async-"</span>);
        executor.setRejectedExecutionHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());
        executor.initialize();
        <span class="hljs-keyword">return</span> executor;
    }
}
</code></pre>
<h3 data-id="heading-17">5. MicrometeræŒ‡æ ‡ç›‘æ§ä¸å¼¹æ€§æ‰©ç¼©å®¹</h3>
<h4 data-id="heading-18">Spring Boot Actuatorå¢å¼ºç‚¹ï¼š</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">management:</span>
 <span class="hljs-attr">endpoints:</span>
 <span class="hljs-attr">web:</span>
 <span class="hljs-attr">exposure:</span>
 <span class="hljs-attr">include:</span> <span class="hljs-string">"*"</span>
 <span class="hljs-attr">metrics:</span>
 <span class="hljs-attr">tags.application:</span> <span class="hljs-string">${spring.application.name}</span>
 <span class="hljs-attr">distribution:</span>
 <span class="hljs-attr">percentiles-histogram.http.server.request:</span> <span class="hljs-literal">true</span>
 
<span class="hljs-attr">prometheus:</span>
 <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>  
</code></pre>
<h4 data-id="heading-19">Grafanaç›‘æ§å…³é”®æŒ‡æ ‡ï¼š</h4>
<ol>
<li><code>http_server_request_duration_seconds</code>ï¼šP99å»¶è¿Ÿç›‘æ§</li>
<li><code>jvm_threads_live</code>ï¼šçº¿ç¨‹æ•°å˜åŒ–è¶‹åŠ¿</li>
<li><code>reactor_scheduler_queue_size</code>ï¼šå“åº”å¼ä»»åŠ¡é˜Ÿåˆ—</li>
</ol>
<h4 data-id="heading-20">Kubernetes HPAè‡ªåŠ¨æ‰©ç¼©å®¹ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">autoscaling/v2beta2</span> 
<span class="hljs-attr">kind:</span> <span class="hljs-string">HorizontalPodAutoscaler</span> 
<span class="hljs-attr">metadata:</span>
 <span class="hljs-attr">name:</span> <span class="hljs-string">order-service-hpa</span>  
<span class="hljs-attr">spec:</span>
 <span class="hljs-attr">scaleTargetRef:</span>
 <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span> 
 <span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span> 
 <span class="hljs-attr">name:</span> <span class="hljs-string">order-service</span>  
 <span class="hljs-string">minReplicas:16]</span>
 <span class="hljs-string">metrics15]:</span>
 <span class="hljs-string">type17]:</span> <span class="hljs-string">Resource18]]</span>
 <span class="hljs-string">resource19]:</span>
 <span class="hljs-string">name20]:</span> <span class="hljs-string">cpu21]]</span>
 <span class="hljs-string">target22]:</span>
 <span class="hljs-string">type23]:</span> <span class="hljs-string">Utilization24]]</span>
 <span class="hljs-string">averageUtilization25]:70]]]</span>
</code></pre>
<hr/>
<h2 data-id="heading-21"/>
<p>æ€»ç»“</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€vueé«˜é¢‘é¢è¯•é¢˜ã€‘ç¬¬ 21 é¢˜ï¼šVue3 ä¸­çš„ Slotï¼ˆæ’æ§½ï¼‰â€” åŸºç¡€ã€åŸç†ã€ä½¿ç”¨åœºæ™¯ã€é¢è¯•å¿…é—®ç‚¹]]></title>    <link>https://juejin.cn/post/7579179625461841962</link>    <guid>https://juejin.cn/post/7579179625461841962</guid>    <pubDate>2025-12-03T04:41:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179625461841962" data-draft-id="7579186764046155817" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€vueé«˜é¢‘é¢è¯•é¢˜ã€‘ç¬¬ 21 é¢˜ï¼šVue3 ä¸­çš„ Slotï¼ˆæ’æ§½ï¼‰â€” åŸºç¡€ã€åŸç†ã€ä½¿ç”¨åœºæ™¯ã€é¢è¯•å¿…é—®ç‚¹"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:41:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€vueé«˜é¢‘é¢è¯•é¢˜ã€‘ç¬¬ 21 é¢˜ï¼šVue3 ä¸­çš„ Slotï¼ˆæ’æ§½ï¼‰â€” åŸºç¡€ã€åŸç†ã€ä½¿ç”¨åœºæ™¯ã€é¢è¯•å¿…é—®ç‚¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:41:32.000Z" title="Wed Dec 03 2025 04:41:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 ä¸­çš„ Slotï¼ˆæ’æ§½ï¼‰å®Œæ•´è§£æ</h2>
<blockquote>
<p>Slot æ˜¯ä¸€ç§ç»„ä»¶å†…å®¹åˆ†å‘æœºåˆ¶ï¼Œè®©çˆ¶ç»„ä»¶å°†å†…å®¹æ³¨å…¥åˆ°å­ç»„ä»¶å†…éƒ¨çš„æŒ‡å®šä½ç½®ï¼Œä½¿ç»„ä»¶æ›´çµæ´»ã€æ›´æ˜“å¤ç”¨ã€‚</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯ Slotï¼Ÿ</h3>
<ul>
<li>è§£å†³â€œç»“æ„å›ºå®šã€å†…å®¹ä¸ç¡®å®šâ€çš„åœºæ™¯</li>
<li>çˆ¶ç»„ä»¶å¯åŠ¨æ€ä¼ å…¥å†…å®¹ï¼Œæé«˜å¤ç”¨æ€§ï¼ˆå¦‚ <code>Dialog</code>ã€<code>Select</code>ã€<code>Card</code>ï¼‰</li>
</ul>
<h3 data-id="heading-2">äºŒã€ä¸‰ç±»æ’æ§½</h3>
<h4 data-id="heading-3">1. é»˜è®¤æ’æ§½ï¼ˆDefault Slotï¼‰</h4>
<p>å­ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="card"&gt;
    &lt;slot&gt;&lt;/slot&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>çˆ¶ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;Card&gt;æˆ‘æ˜¯é»˜è®¤å†…å®¹&lt;/Card&gt;
</code></pre>
<h4 data-id="heading-4">2. å…·åæ’æ§½ï¼ˆNamed Slotï¼‰</h4>
<p>å­ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;slot name="header" /&gt;
&lt;slot /&gt;
&lt;slot name="footer" /&gt;
</code></pre>
<p>çˆ¶ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;Card&gt;
  &lt;template #header&gt;æ ‡é¢˜&lt;/template&gt;
  é»˜è®¤å†…å®¹
  &lt;template #footer&gt;åº•éƒ¨&lt;/template&gt;
&lt;/Card&gt;
</code></pre>
<h4 data-id="heading-5">3. ä½œç”¨åŸŸæ’æ§½ï¼ˆScoped Slotï¼‰</h4>
<p>å°†å­ç»„ä»¶çš„æ•°æ®ä¼ ç»™çˆ¶ç»„ä»¶ï¼Œç”±çˆ¶ç»„ä»¶å†³å®šå¦‚ä½•æ¸²æŸ“ï¼š</p>
<p>å­ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;slot :row="rowData"&gt;&lt;/slot&gt;
</code></pre>
<p>çˆ¶ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;Child v-slot="{ row }"&gt;
  &lt;div&gt;{{ row.name }}&lt;/div&gt;
&lt;/Child&gt;
</code></pre>
<blockquote>
<p>è¡¨æ ¼ç»„ä»¶ï¼ˆå¦‚ Element Plusã€Ant Design Vueï¼‰çš„è‡ªå®šä¹‰åˆ—å¹¿æ³›ä½¿ç”¨ä½œç”¨åŸŸæ’æ§½ã€‚</p>
</blockquote>
<h3 data-id="heading-6">ä¸‰ã€è¿è¡ŒåŸç†ï¼ˆé«˜é¢‘ï¼‰</h3>
<ul>
<li>çˆ¶ç»„ä»¶çš„æ’æ§½å†…å®¹åœ¨â€œçˆ¶ä½œç”¨åŸŸâ€ç¼–è¯‘ï¼Œä½†åœ¨å­ç»„ä»¶çš„ <code>slot</code> ä½ç½®æ¸²æŸ“</li>
<li>å­ç»„ä»¶åªæä¾›æ¸²æŸ“å ä½ï¼›ä½œç”¨åŸŸå§‹ç»ˆå±äºçˆ¶ç»„ä»¶</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;Child&gt;
  {{ count }}
&lt;/Child&gt;
</code></pre>
<p>ä¸Šä¾‹ä¸­ <code>count</code> æ¥è‡ªçˆ¶ç»„ä»¶ä½œç”¨åŸŸï¼Œå­ç»„ä»¶æ— æ³•ä¿®æ”¹çˆ¶æ¨¡æ¿å˜é‡ã€‚</p>
<h3 data-id="heading-7">å››ã€Slot ä¸ Props çš„å…³ç³»</h3>
<ul>
<li><code>Props</code>ï¼šçˆ¶ â†’ å­ï¼ˆä¼ å€¼ï¼‰</li>
<li><code>Scoped Slot</code>ï¼šå­ â†’ çˆ¶ï¼ˆä¼ æ•°æ®ï¼Œçˆ¶è´Ÿè´£æ¸²æŸ“ï¼‰</li>
<li>äºŒè€…äº’è¡¥ï¼Œ<code>slot</code> ä¸èƒ½æ›¿ä»£ <code>props</code></li>
</ul>
<h3 data-id="heading-8">äº”ã€æ ¸å¿ƒä½¿ç”¨åœºæ™¯</h3>
<ul>
<li>UI ç»„ä»¶æ‰©å±•ï¼ˆ<code>Dialog</code>ã€<code>Drawer</code>ï¼‰</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;Dialog&gt;
  &lt;template #footer&gt;
    &lt;button&gt;ç¡®å®š&lt;/button&gt;
  &lt;/template&gt;
&lt;/Dialog&gt;
</code></pre>
<ul>
<li>è¡¨æ ¼è‡ªå®šä¹‰åˆ—ï¼ˆä½œç”¨åŸŸæ’æ§½ï¼‰</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;el-table-column label="å§“å"&gt;
  &lt;template #default="{ row }"&gt;
    &lt;b&gt;{{ row.name }}&lt;/b&gt;
  &lt;/template&gt;
&lt;/el-table-column&gt;
</code></pre>
<ul>
<li>åŠ¨æ€æ¨¡æ¿æ³¨å…¥ï¼ˆå¡ç‰‡ã€èœå•ã€å¸ƒå±€ç»„ä»¶ï¼‰</li>
</ul>
<h3 data-id="heading-9">å…­ã€å¸¸è§è¿½é—®</h3>
<ul>
<li>
<p>è¿½é—® 1ï¼šä¸ºä»€ä¹ˆçˆ¶ç»„ä»¶å˜é‡èƒ½åœ¨å­ç»„ä»¶ slot ä¸­æ˜¾ç¤ºï¼Ÿ</p>
<ul>
<li>æ’æ§½å†…å®¹åœ¨çˆ¶ä½œç”¨åŸŸç¼–è¯‘ï¼Œæ¸²æŸ“ä½ç½®åœ¨å­ç»„ä»¶ï¼Œä½†æ‰§è¡Œä¸Šä¸‹æ–‡ä»å±çˆ¶ç»„ä»¶</li>
</ul>
</li>
<li>
<p>è¿½é—® 2ï¼š<code>slot</code> ä¸ <code>scoped slot</code> çš„æœ¬è´¨åŒºåˆ«ï¼Ÿ</p>
<ul>
<li><code>slot</code>ï¼šçˆ¶ â†’ å­ï¼Œçˆ¶æä¾›å†…å®¹</li>
<li><code>scoped slot</code>ï¼šå­ â†’ çˆ¶ï¼Œå­æä¾›æ•°æ®ï¼Œçˆ¶å†³å®šæ¸²æŸ“</li>
</ul>
</li>
<li>
<p>è¿½é—® 3ï¼šVue3 ä¸­ slot çš„ç¼–è¯‘ç»“æœï¼Ÿ</p>
<ul>
<li>é»˜è®¤æ’æ§½ â†’ <code>$slots.default?.()</code></li>
<li>å…·åæ’æ§½ â†’ <code>$slots.header?.()</code></li>
<li>ä½œç”¨åŸŸæ’æ§½ â†’ å‚æ•°åŒ–æ¸²æŸ“å‡½æ•° <code>(slotProps) =&gt; VNode</code></li>
</ul>
</li>
<li>
<p>è¿½é—® 4ï¼š<code>setup</code> ä¸­å¦‚ä½•è®¿é—® slotï¼Ÿ</p>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { useSlots } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> slots = <span class="hljs-title function_">useSlots</span>()
slots.<span class="hljs-property">default</span>?.()
slots.<span class="hljs-property">header</span>?.()
</code></pre>
<ul>
<li>è¿½é—® 5ï¼šslot æ˜¯å¦å¯åŠ¨æ€è°ƒç”¨ï¼Ÿ</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;component :is="slots[name]"&gt;&lt;/component&gt;
</code></pre>
<p>åœ¨ Vue3 ä¸­ï¼Œæ’æ§½æœ¬è´¨ä¸Šæ˜¯å‡½æ•°ã€‚</p>
<h3 data-id="heading-10">ä¸ƒã€ä¸€å¥è¯æ€»ç»“</h3>
<blockquote>
<p>ç¼–è¯‘åœ¨çˆ¶ã€æ¸²æŸ“åœ¨å­ã€ä½œç”¨åŸŸå±äºçˆ¶ã€‚<code>Slot</code> æ˜¯çˆ¶æ¨¡æ¿æ³¨å…¥ï¼›<code>Scoped Slot</code> ç”¨äºå­ â†’ çˆ¶çš„æ•°æ®å›ä¼ ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 22 é¢˜ï¼šTeleport çš„ä½œç”¨ã€åŸç†å’Œä½¿ç”¨åœºæ™¯]]></title>    <link>https://juejin.cn/post/7579213860571250742</link>    <guid>https://juejin.cn/post/7579213860571250742</guid>    <pubDate>2025-12-03T04:42:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579213860571250742" data-draft-id="7579179625461858346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 22 é¢˜ï¼šTeleport çš„ä½œç”¨ã€åŸç†å’Œä½¿ç”¨åœºæ™¯"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:42:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 22 é¢˜ï¼šTeleport çš„ä½œç”¨ã€åŸç†å’Œä½¿ç”¨åœºæ™¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:42:29.000Z" title="Wed Dec 03 2025 04:42:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 22 é¢˜ï¼šTeleport çš„ä½œç”¨ã€åŸç†å’Œä½¿ç”¨åœºæ™¯</strong></h2>
<hr/>
<h2 data-id="heading-1">ğŸ¯ ä¸€ã€Teleport æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<blockquote>
<p><strong>Teleport æ˜¯ Vue3 æ–°å¢çš„å†…ç½®ç»„ä»¶ï¼Œç”¨äºå°†ç»„ä»¶çš„ DOM ç»“æ„â€œä¼ é€â€åˆ°æŒ‡å®šçš„ DOM èŠ‚ç‚¹ï¼Œä½†ä¿ç•™å…¶å“åº”å¼å’Œç»„ä»¶é€»è¾‘ã€‚</strong></p>
</blockquote>
<p>ç®€å•è¯´ï¼š</p>
<ul>
<li>æ¸²æŸ“åœ¨åˆ«å¤„</li>
<li>æ•°æ®ä½œç”¨åŸŸä¸å˜</li>
<li>é€»è¾‘ä¾ç„¶å±äºå½“å‰ç»„ä»¶</li>
</ul>
<hr/>
<h2 data-id="heading-2">ğŸ¯ äºŒã€Teleport çš„è¯­æ³•</h2>
<pre><code class="hljs language-ini" lang="ini">&lt;teleport <span class="hljs-attr">to</span>=<span class="hljs-string">"body"</span>&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog"</span>&gt;æˆ‘æ˜¯å¼¹çª—&lt;/div&gt;
&lt;/teleport&gt;
</code></pre>
<p><code>to=""</code> æŒ‡å®šç›®æ ‡å®¹å™¨ï¼Œå¿…é¡»æ˜¯æœ‰æ•ˆçš„ CSS é€‰æ‹©å™¨ã€‚</p>
<hr/>
<h2 data-id="heading-3">ğŸ¯ ä¸‰ã€è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2>
<p>åœ¨ Vue2 ä¸­ï¼ŒDialog / Tooltip / Drawer ç­‰ç»„ä»¶å­˜åœ¨é—®é¢˜ï¼š</p>
<ul>
<li>åµŒå¥—å±‚çº§æ·± â†’ z-index éš¾ä»¥æ§åˆ¶</li>
<li>CSS overflow: hidden å¯¼è‡´å¼¹å±‚æ˜¾ç¤ºå¼‚å¸¸</li>
<li>çˆ¶å…ƒç´  transform å¯¼è‡´å®šä½å¤±çœŸ</li>
</ul>
<p><strong>Teleport å®Œç¾è§£å†³ï¼š</strong></p>
<ul>
<li>ä½ å†™åœ¨ä»»ä½•åœ°æ–¹</li>
<li>æœ€ç»ˆéƒ½æ¸²æŸ“åˆ° <code>body</code> ä¸‹</li>
<li>é¿å… overflowã€z-indexã€å®šä½é—®é¢˜</li>
</ul>
<hr/>
<h2 data-id="heading-4">ğŸ¯ å››ã€Teleport çš„åŸç†ï¼ˆé¢è¯•é«˜é¢‘ï¼‰</h2>
<blockquote>
<p><strong>Teleport æ˜¯é€šè¿‡è‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼Œå°†å­ç»„ä»¶çš„ VNode æ¸²æŸ“åˆ°æŒ‡å®šå®¹å™¨ï¼ŒåŒæ—¶ä¿æŒç»„ä»¶å®ä¾‹ä¸å˜ã€‚</strong></p>
</blockquote>
<p>åŸç†æµç¨‹ï¼š</p>
<ol>
<li>è¯»å– <code>&lt;teleport to="xxx"&gt;</code></li>
<li>è·å–ç›®æ ‡ DOMï¼ˆå¦‚ document.bodyï¼‰</li>
<li>åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼ˆVNodeï¼‰</li>
<li>å°†å­ç»„ä»¶ VNode æ¸²æŸ“åˆ°ç›®æ ‡å®¹å™¨</li>
<li>ä¾ç„¶ä¿æŒå½“å‰ç»„ä»¶ä¸Šä¸‹æ–‡ã€å“åº”å¼ã€äº‹ä»¶ç»‘å®š</li>
</ol>
<p>æ ¸å¿ƒç‚¹ï¼š</p>
<ul>
<li><strong>é€»è¾‘ä½œç”¨åŸŸä¸å˜ï¼ˆç»„ä»¶å±äºåŸæ¥çˆ¶ç»„ä»¶ï¼‰</strong></li>
<li><strong>DOM æ¸²æŸ“ä½ç½®æ”¹å˜ï¼ˆæ¸²æŸ“åˆ° body ç­‰å¤„ï¼‰</strong></li>
</ul>
<hr/>
<h2 data-id="heading-5">ğŸ¯ äº”ã€Teleport ä¸­çš„æ•°æ®ä¾ç„¶å“åº”å¼å—ï¼Ÿ</h2>
<p><strong>æ˜¯çš„ï¼Œ100% å“åº”å¼ã€‚</strong></p>
<p>æ— è®ºæ¸²æŸ“åˆ° body è¿˜æ˜¯å…¶ä»–å®¹å™¨ï¼š</p>
<ul>
<li>æ•°æ®æ¥è‡ªçˆ¶ç»„ä»¶</li>
<li>æ›´æ–°ä»è§¦å‘é‡æ–°æ¸²æŸ“</li>
<li>ç”Ÿå‘½å‘¨æœŸæ­£å¸¸æ‰§è¡Œ</li>
</ul>
<p>å› ä¸ºï¼š</p>
<blockquote>
<p>Teleport åªæ˜¯æ”¹å˜â€œæ¸²æŸ“ä½ç½®â€ï¼Œä¸ä¼šæ”¹å˜ç»„ä»¶çš„å“åº”å¼æ ‘ç»“æ„ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">ğŸ¯ å…­ã€ä½¿ç”¨åœºæ™¯ï¼ˆé¢è¯•å¸¸é—®ï¼‰</h2>
<h4 data-id="heading-7"><strong>1. å¼¹çª—ï¼ˆModalï¼‰</strong></h4>
<pre><code class="hljs language-ini" lang="ini">&lt;teleport <span class="hljs-attr">to</span>=<span class="hljs-string">"body"</span>&gt;
  &lt;Dialog <span class="hljs-attr">v-if</span>=<span class="hljs-string">"visible"</span>&gt;
&lt;/teleport&gt;
</code></pre>
<h4 data-id="heading-8"><strong>2. Tooltip / Popover</strong></h4>
<p>é¿å…è¢«çˆ¶èŠ‚ç‚¹ overflow hidden è£å‰ªã€‚</p>
<h4 data-id="heading-9"><strong>3. Drawer / ActionSheet</strong></h4>
<p>éœ€è¦åœ¨æœ€é¡¶å±‚å±•ç¤ºã€‚</p>
<h4 data-id="heading-10"><strong>4. å…¨å±€ Loadingã€æ¶ˆæ¯ç»„ä»¶</strong></h4>
<p>ElementPlus çš„ ElMessage æœ¬è´¨ä¹Ÿæ˜¯ teleport æœºåˆ¶ã€‚</p>
<hr/>
<h2 data-id="heading-11">ğŸ¯ ä¸ƒã€å¸¸è§æ³¨æ„ç‚¹ï¼ˆé¢è¯•å®˜ä¼šé—®ï¼‰</h2>
<hr/>
<h4 data-id="heading-12"><strong>âš ï¸ æ³¨æ„ç‚¹ 1ï¼š<code>to=""</code> çš„ç›®æ ‡å…ƒç´ å¿…é¡»å­˜åœ¨</strong></h4>
<p>å¦‚æœï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;teleport <span class="hljs-attr">to</span>=<span class="hljs-string">"#abc"</span>&gt;...&lt;/teleport&gt;
</code></pre>
<p>ä½†é¡µé¢æ²¡æœ‰ <code>#abc</code> èŠ‚ç‚¹ï¼š</p>
<p>â†’ Vue ä¼šè­¦å‘Šï¼Œä½†ä»ç„¶ä¿ç•™å†…å®¹åœ¨åŸè¢«æŒ‚è½½å¤„ã€‚</p>
<hr/>
<h4 data-id="heading-13"><strong>âš ï¸ æ³¨æ„ç‚¹ 2ï¼šå¤šä¸ª Teleport æ¸²æŸ“åˆ°åŒä¸€ä½ç½®ï¼Ÿ</strong></h4>
<p>å¯ä»¥ï¼Œä¼šä¾æ¬¡ appendï¼Œä¸ä¼šå†²çªã€‚</p>
<hr/>
<h4 data-id="heading-14"><strong>âš ï¸ æ³¨æ„ç‚¹ 3ï¼šv-if / v-show å¯¹ teleport æœ‰ä½•å·®å¼‚ï¼Ÿ</strong></h4>
<ul>
<li><code>v-if</code>ï¼šåˆ›å»º / é”€æ¯ DOM</li>
<li><code>v-show</code>ï¼šä»…åˆ‡æ¢ displayï¼Œä¸ç§»åŠ¨ DOM</li>
</ul>
<p>Teleport ä»ç„¶éµå®ˆè¿™äº›è¡Œä¸ºã€‚</p>
<hr/>
<h2 data-id="heading-15">ğŸ¯ å…«ã€é¢è¯•å®˜å¸¸è§è¿½é—®ï¼ˆé™„æ ‡å‡†ç­”æ¡ˆï¼‰</h2>
<hr/>
<h3 data-id="heading-16"><strong>è¿½é—® 1ï¼šTeleport çš„å†…å®¹è¿è¡Œå±äºè°çš„ä½œç”¨åŸŸï¼Ÿ</strong></h3>
<p><strong>ç­”ï¼šå±äºçˆ¶ç»„ä»¶ä½œç”¨åŸŸã€‚</strong><br/>
æ¸²æŸ“ä½ç½®æ”¹å˜ï¼Œä½†æ‰§è¡Œä¸Šä¸‹æ–‡æ²¡å˜ã€‚</p>
<hr/>
<h3 data-id="heading-17"><strong>è¿½é—® 2ï¼šTeleport å’Œ Portal æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h3>
<p>Vue Teleport = React Portal<br/>
éƒ½æ˜¯ UI å±‚çš„ DOM æ¸²æŸ“è¿ç§»ï¼Œæœ¬è´¨ä¸€è‡´ã€‚</p>
<hr/>
<h3 data-id="heading-18"><strong>è¿½é—® 3ï¼šTeleport ä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿä¸ç”¨æ˜¯å¦å¯ä»¥ï¼Ÿ</strong></h3>
<p>å¼¹çª—ã€æ°”æ³¡ã€èœå•ç»„ä»¶å¿…é¡»ç”¨ï¼Œå¦åˆ™ï¼š</p>
<ul>
<li>z-index æ··ä¹±</li>
<li>overflow æˆªæ–­</li>
<li>å®šä½ä¸å‡†</li>
</ul>
<p>æ™®é€šå®¹å™¨ä¸éœ€è¦ Teleportã€‚</p>
<hr/>
<h3 data-id="heading-19"><strong>è¿½é—® 4ï¼šTeleport ä¼šå½±å“ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ</strong></h3>
<p>ä¸ä¼šã€‚<br/>
ç”Ÿå‘½å‘¨æœŸé¡ºåºä¸å˜ï¼š</p>
<ul>
<li>onMounted åœ¨ Teleport å®Œæˆæ¸²æŸ“åæ‰§è¡Œ</li>
<li>onUnmounted åœ¨èŠ‚ç‚¹é”€æ¯æ—¶æ‰§è¡Œ</li>
</ul>
<p>åªç§»åŠ¨ DOMï¼Œä¸æ”¹å˜ç»„ä»¶çš„æŒ‚è½½é€»è¾‘ã€‚</p>
<hr/>
<h2 data-id="heading-20">ğŸ¯ ä¹ã€ä¸€å¥è¯æ€»ç»“</h2>
<blockquote>
<p>Teleport æ”¹å˜çš„æ˜¯ DOM æ¸²æŸ“ä½ç½®ï¼Œä¸æ”¹å˜ç»„ä»¶é€»è¾‘ï¼Œæ˜¯å‰ç«¯ UI ç»„ä»¶åº“ä¸­å®ç°å¼¹å±‚çš„æ ¸å¿ƒèƒ½åŠ›ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€vueé«˜é¢‘é¢è¯•é¢˜ã€‘ç¬¬ 23 é¢˜ï¼šVue3 è‡ªå®šä¹‰æŒ‡ä»¤ï¼ˆdirectiveï¼‰å®Œæ•´è§£æ]]></title>    <link>https://juejin.cn/post/7579213860571283510</link>    <guid>https://juejin.cn/post/7579213860571283510</guid>    <pubDate>2025-12-03T04:43:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579213860571283510" data-draft-id="7579186764046172201" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€vueé«˜é¢‘é¢è¯•é¢˜ã€‘ç¬¬ 23 é¢˜ï¼šVue3 è‡ªå®šä¹‰æŒ‡ä»¤ï¼ˆdirectiveï¼‰å®Œæ•´è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:43:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€vueé«˜é¢‘é¢è¯•é¢˜ã€‘ç¬¬ 23 é¢˜ï¼šVue3 è‡ªå®šä¹‰æŒ‡ä»¤ï¼ˆdirectiveï¼‰å®Œæ•´è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:43:23.000Z" title="Wed Dec 03 2025 04:43:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 23 é¢˜ï¼šVue3 è‡ªå®šä¹‰æŒ‡ä»¤ï¼ˆdirectiveï¼‰å®Œæ•´è§£æ</strong></h2>
<hr/>
<h2 data-id="heading-1">ğŸ¯ ä¸€ã€ä»€ä¹ˆæ˜¯è‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿ</h2>
<blockquote>
<p>è‡ªå®šä¹‰æŒ‡ä»¤ç”¨äºåœ¨<strong>DOM å±‚</strong>å°è£…å¯å¤ç”¨çš„é€»è¾‘ï¼Œ<br/>
é€‚åˆå¤„ç†ï¼š<strong>èšç„¦ã€æ‡’åŠ è½½ã€æƒé™ã€æ‹–æ‹½ã€å›ºå®šå¸é¡¶ã€é•¿æŒ‰</strong> ç­‰åœºæ™¯ã€‚</p>
</blockquote>
<p>Vue æä¾›ä¸¤ä¸ªå±‚çº§ï¼š</p>
<ul>
<li><strong>å…¨å±€æŒ‡ä»¤</strong>ï¼ˆapp.directiveï¼‰</li>
<li><strong>ç»„ä»¶å±€éƒ¨æŒ‡ä»¤</strong>ï¼ˆdirectives: { xxx }ï¼‰</li>
</ul>
<p>ç”¨é€”ä¸ç»„ä»¶ä¸åŒï¼š</p>
<ul>
<li><strong>ç»„ä»¶</strong> â†’ å¤„ç† UI å’Œä¸šåŠ¡é€»è¾‘</li>
<li><strong>æŒ‡ä»¤</strong> â†’ åªè´Ÿè´£ DOM æ“ä½œ</li>
</ul>
<hr/>
<h2 data-id="heading-2">ğŸ¯ äºŒã€Vue3 è‡ªå®šä¹‰æŒ‡ä»¤ç”Ÿå‘½å‘¨æœŸï¼ˆé‡ç‚¹ï¼‰</h2>
<p>Vue3 ä¸­æŒ‡ä»¤å…±æœ‰ 5 ä¸ªé’©å­ï¼š</p>
<ol>
<li><strong>created(el, binding)</strong></li>
<li><strong>beforeMount</strong></li>
<li><strong>mounted</strong></li>
<li><strong>beforeUpdate</strong></li>
<li><strong>updated</strong></li>
<li><strong>beforeUnmount</strong></li>
<li><strong>unmounted</strong></li>
</ol>
<p>æœ€å¸¸ç”¨ï¼š<code>mounted</code> å’Œ <code>updated</code>ã€‚</p>
<hr/>
<h2 data-id="heading-3">ğŸ¯ ä¸‰ã€æœ€ç®€å•ç¤ºä¾‹ï¼šv-focusï¼ˆè¾“å…¥æ¡†è‡ªåŠ¨èšç„¦ï¼‰</h2>
<h3 data-id="heading-4"><strong>å±€éƒ¨æŒ‡ä»¤</strong></h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-focus</span> /&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">directives</span>: {
    <span class="hljs-attr">focus</span>: {
      <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el</span>) {
        el.<span class="hljs-title function_">focus</span>()
      }
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-5">ğŸ¯ å››ã€Vue3 è‡ªå®šä¹‰æŒ‡ä»¤åŸç†ï¼ˆé«˜é¢‘é¢è¯•ç‚¹ï¼‰</h2>
<blockquote>
<p>Vue åœ¨ç¼–è¯‘æ¨¡æ¿æ—¶ï¼Œä¼šå°†æ‰€æœ‰æŒ‡ä»¤è§£æä¸º <strong>æŒ‡ä»¤å¯¹è±¡</strong>ï¼Œåœ¨æ¸²æŸ“ DOM æ—¶è°ƒç”¨ç›¸åº”çš„æŒ‡ä»¤é’©å­ï¼Œå¯¹ DOM è¿›è¡Œå¢å¼ºã€‚</p>
</blockquote>
<p>æ‰§è¡Œæµç¨‹ï¼š</p>
<ol>
<li>æ¨¡æ¿ç¼–è¯‘æˆ VNode æ—¶æŒ‡ä»¤ä¿¡æ¯ä¼šè¢«è®°å½•</li>
<li>æ¸²æŸ“æ—¶è°ƒç”¨ <code>mounted(el, binding)</code></li>
<li>æ›´æ–°æ—¶è°ƒç”¨ <code>updated(el, binding)</code></li>
<li>é”€æ¯æ—¶è°ƒç”¨ <code>unmounted(el)</code></li>
</ol>
<p>æœ¬è´¨æ˜¯ï¼š</p>
<p><strong>VNode ç”Ÿå‘½å‘¨æœŸ + æŒ‡ä»¤é’©å­ = DOM å¢å¼º</strong></p>
<hr/>
<h2 data-id="heading-6">ğŸ¯ äº”ã€å¸¸è§æŒ‡ä»¤é¢è¯•æ¡ˆä¾‹ï¼ˆé‡è¦ï¼‰</h2>
<h4 data-id="heading-7"><strong>1ï¸âƒ£ å›¾ç‰‡æ‡’åŠ è½½ v-lazy</strong></h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">mounted</span>(el, binding) {
  const observer = new <span class="hljs-built_in">IntersectionObserver</span>(([entry]) =&gt; {
    if (entry.isIntersecting) {
      el<span class="hljs-selector-class">.src</span> = binding<span class="hljs-selector-class">.value</span>
      observer<span class="hljs-selector-class">.unobserve</span>(el)
    }
  })
  observer<span class="hljs-selector-class">.observe</span>(el)
}
</code></pre>
<blockquote>
<p>æŠ€æœ¯ç‚¹ï¼šä½¿ç”¨ IntersectionObserver ç›‘å¬æ˜¯å¦è¿›å…¥è§†å£ã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-8"><strong>2ï¸âƒ£ æƒé™æŒ‡ä»¤ v-permission</strong></h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">mounted</span>(el, binding) {
  const userRoles = store<span class="hljs-selector-class">.state</span><span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.roles</span>
  if (!userRoles.includes(binding.value)) {
    el<span class="hljs-selector-class">.remove</span>() <span class="hljs-comment">// æ— æƒé™åˆ™ç§»é™¤èŠ‚ç‚¹</span>
  }
}
</code></pre>
<blockquote>
<p>å¾ˆå¤šåå°ç³»ç»Ÿéƒ½ä¼šé—®è¿™ä¸ªã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-9"><strong>3ï¸âƒ£ é•¿æŒ‰æŒ‡ä»¤ v-longpress</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
  <span class="hljs-keyword">let</span> timer
  el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"mousedown"</span>, <span class="hljs-function">() =&gt;</span> {
    timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> binding.<span class="hljs-title function_">value</span>(), <span class="hljs-number">500</span>)
  })
  el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"mouseup"</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer))
}
</code></pre>
<hr/>
<h2 data-id="heading-10">ğŸ¯ å…­ã€binding å‚æ•°ï¼ˆé¢è¯•å¿…é—®ï¼‰</h2>
<p><code>binding</code> åŒ…å«ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">binding = {
  instance,           <span class="hljs-comment">// ç»„ä»¶å®ä¾‹</span>
  value,              <span class="hljs-comment">// ä¼ å…¥çš„å€¼</span>
  oldValue,           <span class="hljs-comment">// æ—§å€¼</span>
  arg,                <span class="hljs-comment">// æŒ‡ä»¤å‚æ•°</span>
  modifiers           <span class="hljs-comment">// ä¿®é¥°ç¬¦</span>
}
</code></pre>
<p>ç”¨æ³•ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;div v-demo:<span class="hljs-attr">color.red</span>=<span class="hljs-string">"msg"</span>&gt;&lt;/div&gt;
</code></pre>
<p>è§£æï¼š</p>
<ul>
<li><code>arg = 'color'</code></li>
<li><code>modifiers = { red: true }</code></li>
<li><code>value = msg</code></li>
</ul>
<hr/>
<h2 data-id="heading-11">ğŸ¯ ä¸ƒã€å…³é”®çŸ¥è¯†ç‚¹ - ä»€ä¹ˆæ—¶å€™ç”¨æŒ‡ä»¤ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨ç»„ä»¶ï¼Ÿ</h2>

























<table><thead><tr><th>ç”¨ç»„ä»¶ï¼Ÿ</th><th>ç”¨æŒ‡ä»¤ï¼Ÿ</th></tr></thead><tbody><tr><td>æœ‰ UI å’Œæ¨¡æ¿ç»“æ„</td><td>ä¸éœ€è¦æ¨¡æ¿ç»“æ„</td></tr><tr><td>éœ€è¦é€»è¾‘å¤ç”¨ + DOM</td><td>åªéœ€è¦å°è£… DOM æ“ä½œ</td></tr><tr><td>æœ‰çŠ¶æ€</td><td>æ— çŠ¶æ€é€»è¾‘ï¼ˆçº¯ DOMï¼‰</td></tr><tr><td>é€‚åˆå…¨å±€ç»„ä»¶åº“</td><td>é€‚åˆæƒé™ã€æ‡’åŠ è½½ã€æ‹–æ‹½</td></tr></tbody></table>
<p>ä¸€å¥è¯ï¼š</p>
<blockquote>
<p><strong>åªè¦æ˜¯â€œDOM è¡Œä¸ºâ€ï¼Œå°½é‡ç”¨æŒ‡ä»¤ï¼›<br/>
æ•°æ®é€»è¾‘ + UI å°±åº”è¯¥ç”¨ç»„ä»¶ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-12">ğŸ¯ å…«ã€é¢è¯•å®˜å¸¸é—®è¿½é—®ï¼ˆé™„æœ€ä½³ç­”æ¡ˆï¼‰</h2>
<hr/>
<h4 data-id="heading-13"><strong>è¿½é—® 1ï¼šVue3 çš„æŒ‡ä»¤å’Œ Vue2 æœ‰å“ªäº›ä¸åŒï¼Ÿ</strong></h4>
<p><strong>ç­”ï¼š</strong></p>
<ul>
<li>Vue3 å»æ‰äº† <code>bind</code> å’Œ <code>inserted</code></li>
<li>æ–°å¢äº† <code>created</code>ã€<code>beforeMount</code></li>
<li>ç”Ÿå‘½å‘¨æœŸæ›´åŠ ç»Ÿä¸€</li>
<li>binding.instance æ›¿ä»£ vnode.component</li>
</ul>
<hr/>
<h4 data-id="heading-14"><strong>è¿½é—® 2ï¼šæŒ‡ä»¤èƒ½åœ¨ setup ä¸­ä½¿ç”¨å—ï¼Ÿ</strong></h4>
<p>ä¸èƒ½ç›´æ¥åœ¨ setup return ä¸­æ³¨å†Œï¼Œä½†å¯ä»¥å†™æˆä¸€ä¸ªå¯¹è±¡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> vFocus = {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el</span>) { el.<span class="hljs-title function_">focus</span>() }
}

<span class="hljs-keyword">return</span> { vFocus }
</code></pre>
<hr/>
<h4 data-id="heading-15"><strong>è¿½é—® 3ï¼šæŒ‡ä»¤å’Œ watch å“ªä¸ªæ€§èƒ½æ›´å¥½ï¼Ÿ</strong></h4>
<p>ä½¿ç”¨æŒ‡ä»¤ï¼Œå› ä¸ºï¼š</p>
<ul>
<li>watch ä¼šè§¦å‘è®¡ç®—</li>
<li>æŒ‡ä»¤åªåœ¨ DOM å±‚æ“ä½œï¼Œä¸ä¾èµ–å“åº”å¼ç³»ç»Ÿ</li>
<li>æ€§èƒ½æ›´é«˜</li>
</ul>
<hr/>
<h4 data-id="heading-16"><strong>è¿½é—® 4ï¼šæŒ‡ä»¤èƒ½å¦è®¿é—®ç»„ä»¶å†…éƒ¨å˜é‡ï¼Ÿ</strong></h4>
<p>å¯ä»¥ï¼Œé€šè¿‡ <code>binding.instance</code></p>
<pre><code class="hljs">binding.instance.xxx
</code></pre>
<hr/>
<h2 data-id="heading-17">ğŸ¯ ä¹ã€ä¸€å¥è¯æ€»ç»“</h2>
<blockquote>
<p>Vue3 è‡ªå®šä¹‰æŒ‡ä»¤æ˜¯æ“ä½œ DOM çš„åˆ©å™¨ï¼Œä¸å‚ä¸ç»„ä»¶é€»è¾‘ï¼Œæ‹¥æœ‰ç‹¬ç«‹ç”Ÿå‘½å‘¨æœŸï¼Œå¸¸ç”¨äºæ‡’åŠ è½½ã€æƒé™ã€æ‹–æ‹½ã€èšç„¦ç­‰åœºæ™¯ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 24 é¢˜ï¼šVue3 çš„ç»„ä»¶é€šä¿¡æ–¹å¼ï¼ˆprops / emit / v-model / provide-inject / expose / eventBus]]></title>    <link>https://juejin.cn/post/7579229538791178246</link>    <guid>https://juejin.cn/post/7579229538791178246</guid>    <pubDate>2025-12-03T04:44:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579229538791178246" data-draft-id="7579229538791161862" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 24 é¢˜ï¼šVue3 çš„ç»„ä»¶é€šä¿¡æ–¹å¼ï¼ˆprops / emit / v-model / provide-inject / expose / eventBus "/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:44:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 24 é¢˜ï¼šVue3 çš„ç»„ä»¶é€šä¿¡æ–¹å¼ï¼ˆprops / emit / v-model / provide-inject / expose / eventBus 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:44:48.000Z" title="Wed Dec 03 2025 04:44:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 24 é¢˜ï¼šVue3 çš„ç»„ä»¶é€šä¿¡æ–¹å¼ï¼ˆprops / emit / v-model / provide-inject / expose / eventBus / storeï¼‰</strong></h2>
<hr/>
<h2 data-id="heading-1">ğŸ¯ ä¸€ã€Vue3 ç»„ä»¶é€šä¿¡æ–¹å¼æ€»ç»“è¡¨ï¼ˆå¯èƒŒï¼‰</h2>





















































<table><thead><tr><th>é€šä¿¡æ–¹å¼</th><th>æ–¹å‘</th><th>é€‚ç”¨åœºæ™¯</th><th>æ˜¯å¦å“åº”å¼</th></tr></thead><tbody><tr><td><strong>props</strong></td><td>çˆ¶ â†’ å­</td><td>ä¼ å€¼ã€é…ç½®</td><td>âœ…</td></tr><tr><td><strong>emit</strong></td><td>å­ â†’ çˆ¶</td><td>é€šçŸ¥äº‹ä»¶ã€è¿”å›æ•°æ®</td><td>N/Aï¼ˆäº‹ä»¶ï¼‰</td></tr><tr><td><strong>v-model</strong></td><td>åŒå‘ï¼ˆçˆ¶ â†” å­ï¼‰</td><td>è¡¨å• / åŒå‘ç»‘å®šç»„ä»¶</td><td>âœ…</td></tr><tr><td><strong>provide / inject</strong></td><td>ç¥–å…ˆ â†’ åä»£</td><td>è·¨å±‚çº§é€šä¿¡ã€é€šç”¨ç»„ä»¶</td><td>é»˜è®¤éå“åº”å¼ï¼ˆå¯ç”¨ refï¼‰</td></tr><tr><td><strong>expose</strong></td><td>å­ â†’ çˆ¶ï¼ˆå®ä¾‹ APIï¼‰</td><td>æš´éœ²å†…éƒ¨æ–¹æ³•ä¾›çˆ¶è°ƒç”¨</td><td>N/A</td></tr><tr><td><strong>EventBus</strong></td><td>ä»»æ„ â†” ä»»æ„</td><td>å°å‹é¡¹ç›®çš„å…¨å±€äº‹ä»¶</td><td>ä¾èµ–å®ç°</td></tr><tr><td><strong>Pinia / Vuex</strong></td><td>å…¨å±€å…±äº«</td><td>å¤§å‹é¡¹ç›®ã€å¤æ‚ä¸šåŠ¡</td><td>âœ… å¼ºå“åº”å¼</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">ğŸ¯ äºŒã€å„é€šä¿¡æ–¹å¼è¯¦è§£</h2>
<hr/>
<h2 data-id="heading-3">1ï¸âƒ£ <strong>Propsï¼šçˆ¶ â†’ å­ï¼ˆæœ€æ ¸å¿ƒé€šä¿¡æ–¹å¼ï¼‰</strong></h2>
<h4 data-id="heading-4"><strong>ç¤ºä¾‹</strong></h4>
<pre><code class="hljs language-ini" lang="ini">&lt;Child :<span class="hljs-attr">msg</span>=<span class="hljs-string">"parentMsg"</span> /&gt;
</code></pre>
<p><strong>å­ç»„ä»¶</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">defineProps</span>({
  msg: String
})
</code></pre>
<h4 data-id="heading-5">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>çˆ¶ç»„ä»¶ä¼ å€¼ç»™å­ç»„ä»¶</li>
<li>è¡¨å•é¡¹ã€é…ç½®é¡¹ã€åˆå§‹åŒ–æ•°æ®</li>
</ul>
<h4 data-id="heading-6">åŸç†</h4>
<blockquote>
<p>ç¼–è¯‘æ¨¡æ¿æ—¶ï¼Œprops å˜æˆç»„ä»¶çš„å±æ€§ï¼Œæœ€ç»ˆæ˜ å°„åˆ°ç»„ä»¶å®ä¾‹ä¸Šã€‚<br/>
Vue3 å¯¹ props åš shallowReadonlyï¼Œé˜²æ­¢å­ç»„ä»¶ä¿®æ”¹ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">2ï¸âƒ£ <strong>Emitï¼šå­ â†’ çˆ¶</strong></h2>
<p>å­ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">const emit = <span class="hljs-built_in">defineEmits</span>(['update'])
<span class="hljs-built_in">emit</span>('update', newVal)
</code></pre>
<p>çˆ¶ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;Child @<span class="hljs-attr">update</span>=<span class="hljs-string">"handleUpdate"</span> /&gt;
</code></pre>
<p>é€‚åˆï¼šäº‹ä»¶é€šçŸ¥ã€æŒ‰é’®ç‚¹å‡»å›è°ƒç­‰ã€‚</p>
<hr/>
<h2 data-id="heading-8">3ï¸âƒ£ <strong>v-modelï¼ˆåŒå‘é€šä¿¡ï¼‰</strong></h2>
<p>Vue3 æ”¯æŒå¤šä¸ª v-modelï¼š</p>
<p>çˆ¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;Child v-model:<span class="hljs-attr">title</span>=<span class="hljs-string">"name"</span> /&gt;
</code></pre>
<p>å­ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">props</span> = defineProps([<span class="hljs-string">'title'</span>])
const <span class="hljs-attr">emit</span> = defineEmits([<span class="hljs-string">'update:title'</span>])

emit('update:title', newVal)
</code></pre>
<p><strong>æœ¬è´¨ï¼šprops + emit çš„è¯­æ³•ç³–</strong></p>
<hr/>
<h2 data-id="heading-9">4ï¸âƒ£ <strong>provide / injectï¼ˆè·¨å±‚çº§é€šä¿¡ï¼‰</strong></h2>
<p>ç¥–å…ˆç»„ä»¶ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">provide(<span class="hljs-string">'theme'</span>, <span class="hljs-keyword">ref</span>(<span class="hljs-string">'dark'</span>))
</code></pre>
<p>åä»£ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">theme</span> = inject(<span class="hljs-string">'theme'</span>)
</code></pre>
<h4 data-id="heading-10">ç‰¹ç‚¹</h4>
<ul>
<li>è·¨å±‚çº§é€šä¿¡ï¼ˆä¸ç”¨ props é€å±‚ä¼ é€’ï¼‰</li>
<li>é»˜è®¤éå“åº”å¼ï¼Œå¦‚éœ€å“åº”å¼å¿…é¡»æä¾› ref/reactive</li>
</ul>
<h4 data-id="heading-11">åŸç†ï¼ˆå¸¸è€ƒï¼‰</h4>
<blockquote>
<p>provide åœ¨ç»„ä»¶åˆ›å»ºæ—¶å†™å…¥ â€œä¾èµ–æ³¨å…¥è¡¨â€ï¼Œ<br/>
inject åœ¨åä»£ç»„ä»¶åˆ›å»ºæ—¶ä»åŸå‹é“¾æŸ¥æ‰¾ä¾èµ–ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-12">5ï¸âƒ£ <strong>exposeï¼ˆå­ç»„ä»¶æš´éœ²æ–¹æ³•ç»™çˆ¶ç»„ä»¶ï¼‰</strong></h2>
<p>Vue3 æ–°å¢çš„ï¼Œéå¸¸å¸¸ç”¨ï¼</p>
<p>å­ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">const count = <span class="hljs-built_in">ref</span>(<span class="hljs-number">0</span>)
function <span class="hljs-built_in">reset</span>() {
  count<span class="hljs-selector-class">.value</span> = <span class="hljs-number">0</span>
}

<span class="hljs-built_in">defineExpose</span>({
  reset
})
</code></pre>
<p>çˆ¶ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;Child <span class="hljs-attr">ref</span>=<span class="hljs-string">"childRef"</span> /&gt;

childRef.value.reset()
</code></pre>
<p>é€‚ç”¨ï¼šè¡¨å•æ ¡éªŒã€é‡ç½®ã€æ‰“å¼€å¼¹çª—ç­‰ã€‚</p>
<blockquote>
<p>Vue3 é»˜è®¤ setup ä¸­çš„æ–¹æ³•ä¸ä¼šæš´éœ²ç»™çˆ¶ç»„ä»¶ï¼Œå¿…é¡»ç”¨ exposeã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-13">6ï¸âƒ£ <strong>EventBusï¼ˆå°é¡¹ç›®ç”¨ï¼Œå…¨å±€äº‹ä»¶é€šä¿¡ï¼‰</strong></h2>
<p>Vue3 æ²¡æœ‰ç›´æ¥æä¾›ï¼Œå¯ä»¥è‡ªå·±ç”¨ mittï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> mitt <span class="hljs-keyword">from</span> <span class="hljs-string">'mitt'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> bus = <span class="hljs-title function_">mitt</span>()
</code></pre>
<pre><code class="hljs language-csharp" lang="csharp">bus.emit(<span class="hljs-string">'login'</span>, user)
bus.<span class="hljs-keyword">on</span>(<span class="hljs-string">'login'</span>, handler)
</code></pre>
<p>é€‚åˆï¼š</p>
<ul>
<li>éçˆ¶å­ç»„ä»¶é€šä¿¡</li>
<li>ç®€å•çš„å…¨å±€äº‹ä»¶ç³»ç»Ÿ</li>
</ul>
<hr/>
<h2 data-id="heading-14">7ï¸âƒ£ <strong>Piniaï¼ˆå…¨å±€çŠ¶æ€ç®¡ç†ï¼‰</strong></h2>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">store</span> = useUserStore()
<span class="hljs-attr">store.name</span> = <span class="hljs-string">'jack'</span>
</code></pre>
<p>æœ€é€‚åˆï¼š</p>
<ul>
<li>å¤§å‹é¡¹ç›®</li>
<li>å…¨å±€å…±äº«æ•°æ®</li>
<li>å¤šç»„ä»¶åŒæ­¥æ›´æ–°</li>
</ul>
<p>Vue3 å®˜æ–¹æ¨è Pinia ä»£æ›¿ Vuexã€‚</p>
<hr/>
<h2 data-id="heading-15">ğŸ¯ ä¸‰ã€é¢è¯•å®˜å¸¸é—®å¯¹æ¯”é¢˜ï¼ˆé«˜é¢‘ï¼‰</h2>
<hr/>
<h3 data-id="heading-16"><strong>â“ 1ï¼šprovide/inject ä¸ props çš„åŒºåˆ«ï¼Ÿ</strong></h3>
<p><strong>é¢è¯•æœ€ä½³ç­”æ¡ˆï¼š</strong></p>
<ul>
<li>props æ˜¯çˆ¶ â†’ å­å•å±‚ä¼ é€’ï¼Œé€‚åˆå¸¸è§„é€šä¿¡</li>
<li>provide/inject æ˜¯è·¨å±‚çº§ä¼ é€’ï¼Œä¸ç”¨æ¯å±‚éƒ½å†™ props</li>
<li>provide é»˜è®¤éå“åº”å¼ï¼Œéœ€è¦ ref æ‰èƒ½å“åº”å¼</li>
<li>props æ˜¯å¼ºçº¦æŸï¼ˆç±»å‹æ ¡éªŒï¼‰ï¼Œinject æ˜¯å¼±çº¦æŸï¼ˆä¸ä¿è¯å­˜åœ¨ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-17"><strong>â“ 2ï¼šv-model åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h3>
<p>ç­”ï¼š</p>
<blockquote>
<p>Vue3 ä¸­ v-model ç­‰ä»·äº <code>modelValue</code> + <code>update:modelValue</code><br/>
æœ¬è´¨ä»ç„¶æ˜¯çˆ¶ä¼ å€¼ã€å­è§¦å‘æ›´æ–°äº‹ä»¶ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-18"><strong>â“ 3ï¼šexpose ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</strong></h3>
<p>å› ä¸ºï¼š</p>
<ul>
<li>Vue3 çš„ setup éš”ç¦»ä½œç”¨åŸŸï¼Œé»˜è®¤ä¸ä¼šæš´éœ²å†…éƒ¨å®ä¾‹æ–¹æ³•</li>
<li>ä½¿ç”¨ expose å¯ä»¥å†³å®šå“ªäº›æ–¹æ³•å®‰å…¨åœ°å¼€æ”¾ç»™å¤–éƒ¨</li>
</ul>
<hr/>
<h3 data-id="heading-19"><strong>â“ 4ï¼šä¸ºä»€ä¹ˆè¦ç”¨ storeï¼ˆPiniaï¼‰ï¼Ÿä¸èƒ½ç”¨ eventBus å—ï¼Ÿ</strong></h3>
<p><strong>ç®€ç­”ï¼š</strong></p>
<ul>
<li>eventBus æ˜¯äº‹ä»¶é©±åŠ¨ï¼Œä¸é€‚åˆä½œçŠ¶æ€ç®¡ç†</li>
<li>Pinia æ˜¯å“åº”å¼æ•°æ®ç®¡ç†ï¼Œæœ‰ devtoolsã€æœ‰æ¨¡å—åŒ–ã€æœ‰æŒä¹…åŒ–</li>
<li>å¤§é¡¹ç›®å¿…é¡»ç”¨ store</li>
</ul>
<hr/>
<h3 data-id="heading-20"><strong>â“ 5ï¼šprovide / inject ä¸ºä»€ä¹ˆé»˜è®¤ä¸æ˜¯å“åº”å¼ï¼Ÿ</strong></h3>
<p>å› ä¸ºå½“åˆè®¾è®¡å®ƒç”¨äºâ€œé™æ€é…ç½®â€ï¼ˆæ¯”å¦‚ä¸»é¢˜ï¼‰ï¼Œè¦é¿å…ä¸å¿…è¦æ›´æ–°ï¼›</p>
<p>è‹¥éœ€è¦å“åº”å¼ï¼Œéœ€è¦ä¼  ref æˆ– reactiveï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">provide</span>(<span class="hljs-string">'theme'</span>, <span class="hljs-built_in">reactive</span>({ <span class="hljs-attribute">mode</span>: <span class="hljs-string">'dark'</span> }))
</code></pre>
<hr/>
<h2 data-id="heading-21">ğŸ¯ å››ã€ä¸€å¥è¯æ€»ç»“</h2>
<blockquote>
<p>Vue3 çš„é€šä¿¡ä½“ç³»åŸºäº props/emit æ„å»ºï¼Œ<br/>
provide/inject è§£å†³è·¨å±‚çº§ä¼ é€’ï¼Œ<br/>
expose è§£å†³å®ä¾‹æš´éœ²ï¼Œ<br/>
store è§£å†³å…¨å±€å…±äº«ï¼Œ<br/>
eventBus è§£å†³ç®€å•äº‹ä»¶åˆ†å‘ã€‚</p>
</blockquote>
<p>æŒæ¡è¿™äº›ï¼Œä½ èƒ½åº”å¯¹æ‰€æœ‰ç»„ä»¶é€šä¿¡åœºæ™¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 25 é¢˜ï¼šè¯´ä¸€ä¸‹ Vue3 çš„ keep-alive åŸç†ï¼Ÿç¼“å­˜æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7579229538791211014</link>    <guid>https://juejin.cn/post/7579229538791211014</guid>    <pubDate>2025-12-03T04:45:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579229538791211014" data-draft-id="7579229538791194630" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 25 é¢˜ï¼šè¯´ä¸€ä¸‹ Vue3 çš„ keep-alive åŸç†ï¼Ÿç¼“å­˜æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:45:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 25 é¢˜ï¼šè¯´ä¸€ä¸‹ Vue3 çš„ keep-alive åŸç†ï¼Ÿç¼“å­˜æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:45:39.000Z" title="Wed Dec 03 2025 04:45:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 24 é¢˜ï¼šè¯´ä¸€ä¸‹ Vue3 çš„ keep-alive åŸç†ï¼Ÿç¼“å­˜æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</strong></h2>
<h3 data-id="heading-1"><strong>ä¸€ã€æ ¸å¿ƒå›ç­”ï¼ˆé¢è¯•æœ€æƒ³å¬çš„ç‰ˆæœ¬ï¼‰</strong></h3>
<p><code>&lt;keep-alive&gt;</code> æ˜¯ Vue3 çš„ä¸€ä¸ªå†…ç½®ç»„ä»¶ï¼Œç”¨æ¥ç¼“å­˜ <strong>ç»„ä»¶çš„å®ä¾‹</strong>ï¼Œé¿å…ç»„ä»¶è¢«é”€æ¯ï¼Œæå‡æ€§èƒ½ã€‚</p>
<p>å…¶åŸç†ï¼š</p>
<ol>
<li>
<p><strong>é¦–æ¬¡æ¸²æŸ“</strong>ï¼šåˆ›å»ºç»„ä»¶å®ä¾‹å¹¶ç¼“å­˜åˆ° <code>cache</code>ï¼ˆMapï¼‰ã€‚</p>
</li>
<li>
<p><strong>å†æ¬¡åˆ‡æ¢å›ç»„ä»¶</strong>ï¼šç›´æ¥ä»ç¼“å­˜é‡Œå–å®ä¾‹ï¼Œä¸ä¼šé‡æ–°æ‰§è¡Œ <code>setup</code>ï¼Œä¸ä¼šé‡æ–°æŒ‚è½½ DOMã€‚</p>
</li>
<li>
<p><strong>å¤±æ´»æ¿€æ´»æœºåˆ¶</strong>ï¼šä¸æ˜¯é”€æ¯ï¼Œè€Œæ˜¯è§¦å‘ï¼š</p>
<ul>
<li><code>onDeactivated</code>ï¼ˆç»„ä»¶å¤±æ´»ï¼‰</li>
<li><code>onActivated</code>ï¼ˆé‡æ–°æ¿€æ´»ï¼‰</li>
</ul>
</li>
<li>
<p><strong>LRU ç­–ç•¥</strong>ï¼ˆåŸºäº max å±æ€§ï¼‰ï¼š</p>
<ul>
<li>ç¼“å­˜è¶…å‡ºæ•°é‡ï¼Œä¼šç§»é™¤æœ€ä¹…æœªè®¿é—®çš„ç»„ä»¶ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-2"><strong>äºŒã€keep-alive çš„è¯¦ç»†åŸç†ï¼ˆæ·±åº¦ç‰ˆï¼Œè®©é¢è¯•å®˜è§‰å¾—ä½ æ‡‚åº•å±‚ï¼‰</strong></h3>
<h4 data-id="heading-3">ğŸ”¹ <strong>1. keep-alive å†…éƒ¨å®ç°ä¸€ä¸ª Map åšç¼“å­˜</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
</code></pre>
<ul>
<li>keyï¼šç»„ä»¶å”¯ä¸€ IDï¼ˆVNode.typeï¼‰</li>
<li>valueï¼šç»„ä»¶å®ä¾‹ + DOM èŠ‚ç‚¹</li>
</ul>
<hr/>
<h4 data-id="heading-4">ğŸ”¹ <strong>2. æ¸²æŸ“è¿‡ç¨‹</strong></h4>
<p>å½“ keep-alive æ¸²æŸ“ä¸€ä¸ªç»„ä»¶ï¼š</p>
<p><strong>å¦‚æœ cache é‡Œæ²¡æœ‰</strong><br/>
â†’ åˆ›å»ºæ–°çš„ç»„ä»¶å®ä¾‹ â†’ æ¸²æŸ“ â†’ ç¼“å­˜åˆ° cache</p>
<p><strong>å¦‚æœ cache é‡Œå·²ç»æœ‰</strong><br/>
â†’ ç›´æ¥å¤ç”¨ä¹‹å‰ç¼“å­˜çš„å®ä¾‹ï¼ˆVNodeï¼‰ï¼Œè·³è¿‡ç»„ä»¶åˆå§‹åŒ–</p>
<hr/>
<h4 data-id="heading-5">ğŸ”¹ <strong>3. ç¼“å­˜å‘½ä¸­åçš„æ¿€æ´»è¿‡ç¨‹</strong></h4>
<p>å¤ç”¨æ—¶ä¸ä¼šèµ° <code>setup()</code><br/>
åªä¼šè°ƒç”¨ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">onActivated</span>(() =&gt; {
  <span class="hljs-comment">// DOM è¢«æ’å›æ—¶è§¦å‘</span>
})
</code></pre>
<hr/>
<h4 data-id="heading-6">ğŸ”¹ <strong>4. åˆ‡æ¢è·¯ç”±ç¦»å¼€æ—¶ä¸ä¼šå¸è½½ç»„ä»¶</strong></h4>
<p>ä¸ä¼šæ‰§è¡Œ <code>onUnmounted</code><br/>
æ”¹æˆï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">onDeactivated</span>(() =&gt; {
  <span class="hljs-comment">// DOM è¢«ç§»å‡ºå®¹å™¨æ—¶è§¦å‘</span>
})
</code></pre>
<hr/>
<h4 data-id="heading-7">ğŸ”¹ <strong>5. LRU æœºåˆ¶ï¼ˆmax å±æ€§ï¼‰</strong></h4>
<p>å¦‚æœä½ å†™ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;keep-alive :<span class="hljs-attr">max</span>=<span class="hljs-string">"2"</span>&gt;
</code></pre>
<p>keep-alive ä¼šï¼š</p>
<ul>
<li>æœ€å¤šç¼“å­˜ 2 ä¸ªç»„ä»¶</li>
<li>è¶…å‡ºæ—¶ä» cache ä¸­åˆ æœ€è€çš„ä¸€ä¸ªï¼ˆLRUï¼‰</li>
</ul>
<p>å®ç°ä¼ªä»£ç ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">if (cache.size &gt; max) {
  const oldestKey = cache<span class="hljs-selector-class">.keys</span>()<span class="hljs-selector-class">.next</span>()<span class="hljs-selector-class">.value</span>
  <span class="hljs-built_in">pruneCacheEntry</span>(oldestKey)
}
</code></pre>
<hr/>
<h3 data-id="heading-8"><strong>ä¸‰ã€å¸¸è§ç”¨æ³•</strong></h3>
<h4 data-id="heading-9">âœ” ç¼“å­˜è·¯ç”±ç»„ä»¶ï¼š</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span>
</code></pre>
<hr/>
<h4 data-id="heading-10">âœ” include / exclude ç²¾å‡†æ§åˆ¶ç¼“å­˜</h4>
<pre><code class="hljs language-ini" lang="ini">&lt;keep-alive <span class="hljs-attr">include</span>=<span class="hljs-string">"UserList,UserInfo"</span> exclude=<span class="hljs-string">"LoginPage"</span>&gt;
</code></pre>
<hr/>
<h4 data-id="heading-11">âœ” åŠ¨æ€ç¼“å­˜ï¼š</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">:include</span>=<span class="hljs-string">"cachedComponents"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-12"><strong>å››ã€å¸¸è§é¢è¯•è¿½é—® + ä½ è¯¥æ€ä¹ˆå›ç­”</strong></h3>
<hr/>
<h4 data-id="heading-13">â“<strong>1. keep-alive å’Œ v-if çš„åŒºåˆ«ï¼Ÿ</strong></h4>
<p>âœ” <strong>v-if ä¼šé”€æ¯ç»„ä»¶</strong><br/>
âœ” <strong>keep-alive åªæ˜¯éšè—ï¼Œä¸é”€æ¯</strong></p>
<blockquote>
<p>keep-alive æ˜¯â€œç»„ä»¶çº§ç¼“å­˜â€ï¼Œv-if æ˜¯â€œæ¡ä»¶æ¸²æŸ“æ§åˆ¶â€</p>
</blockquote>
<hr/>
<h4 data-id="heading-14">â“<strong>2. keep-alive ç¼“å­˜å“ªäº›å†…å®¹ï¼Ÿ</strong></h4>
<p>ç¼“å­˜çš„æ˜¯ï¼š</p>
<ul>
<li>ç»„ä»¶å®ä¾‹ï¼ˆsetup è¿”å›å€¼ï¼‰</li>
<li>å“åº”å¼çŠ¶æ€</li>
<li>DOM èŠ‚ç‚¹</li>
</ul>
<p>ä¸ä¼šç¼“å­˜ï¼š</p>
<ul>
<li>props å˜åŒ–åçš„æ–°çŠ¶æ€ï¼ˆéœ€è¦æ‰‹åŠ¨ watchï¼‰</li>
<li>DOM å¤–éƒ¨ä¾èµ–ï¼ˆscroll ä½ç½®ã€å®šæ—¶å™¨ç­‰ï¼‰</li>
</ul>
<hr/>
<h4 data-id="heading-15">â“<strong>3. keep-alive é…åˆ router-view ä¸ºä»€ä¹ˆæœ‰æ—¶å¤±æ•ˆï¼Ÿ</strong></h4>
<p>å¸¸è§åŸå› ï¼š</p>
<ol>
<li>æ²¡æœ‰è®¾ç½® <code>router-view</code> çš„ <code>name</code></li>
<li>dynamic import ç»„ä»¶ name ä¸å¯¹</li>
<li>ä¸æ­£ç¡®ä½¿ç”¨ include / exclude</li>
</ol>
<hr/>
<h4 data-id="heading-16">â“<strong>4. å¦‚ä½•å¼ºåˆ¶æ¸…ç† keep-alive ç¼“å­˜ï¼Ÿ</strong></h4>
<p>å¯ä½¿ç”¨ keyï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">&lt;router-view <span class="hljs-symbol">:key=<span class="hljs-string">"$route.fullPath"</span>/&gt;</span>
</code></pre>
<p>æˆ–åˆ©ç”¨ include/exclude åŠ¨æ€æ§åˆ¶ã€‚</p>
<hr/>
<h3 data-id="heading-17"><strong>äº”ã€é¢è¯•å®˜æƒ³å¬çš„æ€»ç»“ï¼ˆé«˜åˆ†ç‰ˆï¼‰</strong></h3>
<blockquote>
<p>keep-alive æœ¬è´¨æ˜¯ç”¨ Map ç¼“å­˜ç»„ä»¶å®ä¾‹ï¼Œé€šè¿‡æ¿€æ´»ä¸å¤±æ´»æ§åˆ¶ç»„ä»¶æŒ‚è½½çŠ¶æ€ï¼Œå¹¶é€šè¿‡ LRU ç®—æ³•ç®¡ç†ç¼“å­˜æ•°é‡ã€‚<br/>
å¸¸ç”¨äºè·¯ç”±ç¼“å­˜ã€tab é¡µç­¾ã€å¤æ‚ç»„ä»¶åå¤åˆ‡æ¢çš„æ€§èƒ½ä¼˜åŒ–ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 256 é¢˜ï¼šVue3 çš„å¼‚æ­¥ç»„ä»¶ï¼ˆdefineAsyncComponentï¼‰+ Suspense åŸç†ä¸é¢è¯•é«˜é¢‘ç‚¹]]></title>    <link>https://juejin.cn/post/7579186764046204969</link>    <guid>https://juejin.cn/post/7579186764046204969</guid>    <pubDate>2025-12-03T04:46:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579186764046204969" data-draft-id="7579186764046188585" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 256 é¢˜ï¼šVue3 çš„å¼‚æ­¥ç»„ä»¶ï¼ˆdefineAsyncComponentï¼‰+ Suspense åŸç†ä¸é¢è¯•é«˜é¢‘ç‚¹"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:46:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 256 é¢˜ï¼šVue3 çš„å¼‚æ­¥ç»„ä»¶ï¼ˆdefineAsyncComponentï¼‰+ Suspense åŸç†ä¸é¢è¯•é«˜é¢‘ç‚¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:46:15.000Z" title="Wed Dec 03 2025 04:46:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 25 é¢˜ï¼šVue3 çš„å¼‚æ­¥ç»„ä»¶ï¼ˆdefineAsyncComponentï¼‰+ Suspense åŸç†ä¸é¢è¯•é«˜é¢‘ç‚¹</strong></h2>
<hr/>
<h2 data-id="heading-1">ä¸€ã€æ ¸å¿ƒå›ç­”ï¼ˆé¢è¯•å®˜æœ€æƒ³å¬çš„ï¼‰</h2>
<h4 data-id="heading-2"><strong>1ï¼‰defineAsyncComponent æ˜¯ç”¨æ¥åŠ¨æ€åŠ è½½ç»„ä»¶çš„</strong></h4>
<ul>
<li>å®ç° <strong>æŒ‰éœ€åŠ è½½ / ä»£ç åˆ†å‰²</strong>ï¼ˆWebpackã€Vite è‡ªåŠ¨åˆ† chunkï¼‰</li>
<li>å‡å°‘é¦–å±åŒ…ä½“ç§¯ï¼Œæé«˜åŠ è½½é€Ÿåº¦</li>
</ul>
<h4 data-id="heading-3"><strong>2ï¼‰Suspense ç”¨æ¥å¤„ç†å¼‚æ­¥ç»„ä»¶çš„â€œåŠ è½½çŠ¶æ€â€</strong></h4>
<ul>
<li>
<p>å¼‚æ­¥ç»„ä»¶ç¬¬ä¸€æ¬¡åŠ è½½æ—¶ä¼šå¤„äºâ€œæœªå®ŒæˆçŠ¶æ€â€</p>
</li>
<li>
<p>Suspense å¯ä»¥å±•ç¤ºï¼š</p>
<ul>
<li>loading å ä½å†…å®¹ï¼ˆfallbackï¼‰</li>
<li>åŠ è½½å®Œæˆåå†å±•ç¤ºå†…å®¹</li>
</ul>
</li>
</ul>
<h4 data-id="heading-4"><strong>3ï¼‰å¼‚æ­¥ç»„ä»¶æ ¸å¿ƒåŸç†</strong></h4>
<ul>
<li>
<p>æœ¬è´¨ï¼šåŒ…è£…ä¸€ä¸ª Promiseï¼Œå†…éƒ¨ç»´æŠ¤ <strong>loading / loaded / error</strong> çŠ¶æ€æœº</p>
</li>
<li>
<p>ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼š</p>
<ul>
<li>asyncComponent(loader) â†’ Promise â†’ è¿”å›å ä½èŠ‚ç‚¹</li>
</ul>
</li>
<li>
<p>Promise resolvesï¼š</p>
<ul>
<li>æ¸²æŸ“çœŸæ­£ç»„ä»¶</li>
</ul>
</li>
<li>
<p>Suspense ä½œä¸ºâ€œå¼‚æ­¥è¾¹ç•Œâ€ï¼Œç­‰å¾…æ‰€æœ‰å¼‚æ­¥å­ç»„ä»¶ resolve åå†è¿›è¡Œ DOM patch</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-5">äºŒã€deep åŸç†ï¼ˆæ·±å…¥è®²ï¼Œæœ‰é¢è¯•åŠ åˆ†ï¼‰</h2>
<h3 data-id="heading-6"><strong>1ï¼‰defineAsyncComponent åŸç†ï¼ˆçŠ¶æ€æœºï¼‰</strong></h3>
<p>æ ¸å¿ƒä¼ªä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-params">loader</span>) {
  <span class="hljs-keyword">let</span> resolved = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">let</span> loading = <span class="hljs-literal">false</span>

  <span class="hljs-keyword">return</span> {
    <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (!resolved &amp;&amp; !loading) {
        loading = <span class="hljs-literal">true</span>
        <span class="hljs-title function_">loader</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">comp</span> =&gt;</span> {
          resolved = comp
        })
      }

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> resolved ? <span class="hljs-title function_">h</span>(resolved) : <span class="hljs-title function_">h</span>(<span class="hljs-string">'div'</span>, <span class="hljs-string">'loading...'</span>)
    }
  }
}
</code></pre>
<h4 data-id="heading-7">å®é™…å†…éƒ¨åŒ…æ‹¬ï¼š</h4>
<ul>
<li>loadingDelayï¼ˆå»¶è¿Ÿæ˜¾ç¤º loadingï¼‰</li>
<li>timeoutï¼ˆåŠ è½½è¶…æ—¶ï¼‰</li>
<li>error retryï¼ˆé”™è¯¯é‡è¯•ï¼‰</li>
<li>suspensibleï¼ˆæ˜¯å¦ç”± Suspense æ§åˆ¶ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-8"><strong>2ï¼‰Suspense å·¥ä½œåŸç†</strong></h3>
<p>Vue3 å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <strong>å¼‚æ­¥ä¾èµ–è®¡æ•°å™¨ depCount</strong>ï¼š</p>
<ul>
<li>
<p>å­ç»„ä»¶åœ¨æ¸²æŸ“æœŸ â€œæŒ‚èµ·â€ï¼ˆé‡åˆ° Promiseï¼‰</p>
</li>
<li>
<p>Suspense ä¸ç«‹å³æ¸²æŸ“ child æ ‘</p>
</li>
<li>
<p>ç­‰æ‰€æœ‰ pending Promise ç»“æŸï¼š</p>
<ul>
<li>æ›¿æ¢ fallback åŒºåŸŸä¸ºçœŸå® children åŒºåŸŸ</li>
</ul>
</li>
</ul>
<p>ä¼ªä»£ç æ€ç»´æ¨¡å‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">if (async deps <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>) {
  <span class="hljs-keyword">show</span> fallback
} <span class="hljs-keyword">else</span> {
  <span class="hljs-keyword">show</span> <span class="hljs-type">real</span> content
}
</code></pre>
<p>Suspense æ˜¯ Vue3 çš„ <strong>Concurrent Rendering</strong> çš„åŸºç¡€èƒ½åŠ›ã€‚</p>
<hr/>
<h2 data-id="heading-9">ä¸‰ã€ä½¿ç”¨ç¤ºä¾‹</h2>
<h3 data-id="heading-10"><strong>1ï¼‰ç®€å•å¼‚æ­¥ç»„ä»¶</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncPage</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span>
  <span class="hljs-keyword">import</span>(<span class="hljs-string">'./Page.vue'</span>)
)
</code></pre>
<p>ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AsyncPage</span> /&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-11"><strong>2ï¼‰å¸¦ loading / error çš„é«˜çº§é…ç½®</strong></h3>
<pre><code class="hljs language-scss" lang="scss">const AsyncComp = <span class="hljs-built_in">defineAsyncComponent</span>({
  loader: () =&gt; <span class="hljs-built_in">import</span>('./MyComp.vue'),
  loadingComponent: Loading,
  errorComponent: LoadError,
  delay: <span class="hljs-number">200</span>,
  timeout: <span class="hljs-number">3000</span>,
  <span class="hljs-built_in">onError</span>(retry, fail, attempts) {
    if (attempts &lt; <span class="hljs-number">3</span>) <span class="hljs-built_in">retry</span>()
    else <span class="hljs-built_in">fail</span>()
  }
})
</code></pre>
<hr/>
<h3 data-id="heading-12"><strong>3ï¼‰Suspense ç”¨æ³•</strong></h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">AsyncComp</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">fallback</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">LoadingSpinner</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
</code></pre>
<p>æ•ˆæœï¼š</p>
<ul>
<li>AsyncComp è¿˜æ²¡åŠ è½½ â†’ fallback</li>
<li>åŠ è½½å®Œæˆ â†’ default</li>
</ul>
<hr/>
<h2 data-id="heading-13">å››ã€é¢è¯•å®˜è¿½é—® + é«˜åˆ†å›ç­”</h2>
<hr/>
<h3 data-id="heading-14">â“1. defineAsyncComponent å’Œ import åŠ¨æ€å¼•å…¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p><strong>ä¸ç”¨ defineAsyncComponent æ—¶ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">&lt;component <span class="hljs-selector-pseudo">:is</span>="() =&gt; <span class="hljs-built_in">import</span>('./A.vue')" /&gt;
</code></pre>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>Vue ä¸ä¼šè‡ªåŠ¨åš loading/error ç®¡ç†</li>
<li>æ— å»¶è¿Ÿç­–ç•¥</li>
<li>æ— è¶…æ—¶å¤„ç†</li>
<li>æ— é”™è¯¯é‡è¯•</li>
</ul>
<p><strong>defineAsyncComponent æ˜¯â€œå¢å¼ºç‰ˆåŠ¨æ€ importâ€</strong></p>
<hr/>
<h3 data-id="heading-15">â“2. Suspense æ”¯æŒå¤šå±‚åµŒå¥—å—ï¼Ÿæ€ä¹ˆè°ƒåº¦ï¼Ÿ</h3>
<p>æ”¯æŒã€‚Vue ä¼šè‡ªåŠ¨æ±‡æ€»æ‰€æœ‰æœª resolve çš„ Promise<br/>
â†’ ä½œä¸ºä¸€ä¸ªâ€œå¼‚æ­¥è¾¹ç•Œâ€<br/>
â†’ Promise å…¨éƒ¨å®Œæˆæ‰æ›¿æ¢ fallbackã€‚</p>
<hr/>
<h3 data-id="heading-16">â“3. Suspense åœ¨ SSR ä¸­çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>åœ¨ SSR ä¸­ï¼š</p>
<ul>
<li>fallback <strong>ä¸ä¼šæ¸²æŸ“</strong></li>
<li>å¼‚æ­¥ç»„ä»¶ä¼š <strong>æå‰ resolve åå†è¾“å‡º HTML</strong></li>
<li>ä¿è¯ SSR HTML æ˜¯å®Œæ•´çš„</li>
</ul>
<hr/>
<h3 data-id="heading-17">â“4. å¼‚æ­¥ç»„ä»¶ä»€ä¹ˆæ—¶å€™é€‚åˆç”¨ï¼Ÿä»€ä¹ˆæ—¶å€™ä¸é€‚åˆï¼Ÿ</h3>
<h4 data-id="heading-18">é€‚åˆï¼š</h4>
<ul>
<li>å¤§ç»„ä»¶ï¼ˆå›¾è¡¨ã€ç¼–è¾‘å™¨ã€åœ°å›¾ã€é«˜å¤æ‚åº¦é¡µé¢ï¼‰</li>
<li>é¡µé¢çº§è·¯ç”±</li>
<li>å¤§å‹åå°å›¾è¡¨ï¼ˆEChartsã€ThreeJSï¼‰</li>
</ul>
<h4 data-id="heading-19">ä¸é€‚åˆï¼š</h4>
<ul>
<li>å°ç»„ä»¶ï¼ˆæŒ‰é’®ã€è¡¨å•å…ƒç´ ï¼‰<br/>
å› ä¸ºåè€Œå¢åŠ  chunk æ•°é‡ã€åŠ è½½å»¶è¿Ÿ</li>
</ul>
<hr/>
<h2 data-id="heading-20">äº”ã€é¢è¯•é«˜åˆ†æ€»ç»“ï¼ˆèƒŒä¸‹æ¥æ— æ•Œï¼‰</h2>
<blockquote>
<p><code>defineAsyncComponent</code> æ˜¯ Vue3 ä¸ºç»„ä»¶åšçš„ Promise åŒ…è£…ï¼Œå®ç°å¼‚æ­¥åŠ è½½ã€è‡ªåŠ¨ loading/error æ§åˆ¶ã€è¶…æ—¶ã€é‡è¯•ã€‚<br/>
<code>Suspense</code> æ˜¯å¼‚æ­¥ç»„ä»¶çš„æ¸²æŸ“è¾¹ç•Œï¼Œå†…éƒ¨é€šè¿‡æŒ‚èµ·æœºåˆ¶ï¼ˆasync depCountï¼‰ç­‰å¾…æ‰€æœ‰å¼‚æ­¥ä¾èµ– resolve åç»Ÿä¸€æ¸²æŸ“ï¼Œä»è€Œå®ç°é«˜è´¨é‡ Loading åˆ‡æ¢å’Œå¹¶å‘æ¸²æŸ“èƒ½åŠ›ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 27 é¢˜ï¼šVue3 + TS ç±»å‹æ¨æ–­ï¼ˆProps ç±»å‹æ¨å¯¼ã€Emit ç±»å‹æ¨å¯¼ã€Setup è¿”å›å€¼ç±»å‹ï¼‰]]></title>    <link>https://juejin.cn/post/7579186764046221353</link>    <guid>https://juejin.cn/post/7579186764046221353</guid>    <pubDate>2025-12-03T04:46:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579186764046221353" data-draft-id="7579229538791227398" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 27 é¢˜ï¼šVue3 + TS ç±»å‹æ¨æ–­ï¼ˆProps ç±»å‹æ¨å¯¼ã€Emit ç±»å‹æ¨å¯¼ã€Setup è¿”å›å€¼ç±»å‹ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:46:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 27 é¢˜ï¼šVue3 + TS ç±»å‹æ¨æ–­ï¼ˆProps ç±»å‹æ¨å¯¼ã€Emit ç±»å‹æ¨å¯¼ã€Setup è¿”å›å€¼ç±»å‹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:46:47.000Z" title="Wed Dec 03 2025 04:46:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 26 é¢˜ï¼šVue3 + TS ç±»å‹æ¨æ–­ï¼ˆProps ç±»å‹æ¨å¯¼ã€Emit ç±»å‹æ¨å¯¼ã€Setup è¿”å›å€¼ç±»å‹ï¼‰</strong></h2>
<hr/>
<h2 data-id="heading-1">ğŸ¯ ä¸€ã€æ ¸å¿ƒå›ç­”ï¼ˆé¢è¯•å®˜æœ€æƒ³å¬ï¼‰</h2>
<p>Vue3 + TS çš„ç±»å‹æ¨æ–­èƒ½åŠ›ä¸»è¦ä¾èµ– <strong>å®ï¼ˆcompile-time macroï¼‰+ æ³›å‹ï¼ˆgenericï¼‰+ ç±»å‹æ”¶çª„ï¼ˆnarrowingï¼‰</strong> ã€‚</p>
<p>æœ€å¸¸è€ƒï¼š</p>
<ol>
<li>
<p><strong>defineProps</strong> ä¼šè‡ªåŠ¨æ¨æ–­ props ç±»å‹<br/>
æ¥è‡ªç¼–è¯‘å™¨ï¼ˆvue-tsc / Volarï¼‰åœ¨ç¼–è¯‘æ—¶åˆ†æå®ã€‚</p>
</li>
<li>
<p><strong>defineEmits</strong> ä¼šè‡ªåŠ¨æ¨æ–­ emit çš„äº‹ä»¶åå’Œå‚æ•°ç±»å‹ã€‚</p>
</li>
<li>
<p><strong>setup è¿”å›å€¼çš„ç±»å‹æ¨æ–­</strong> ç”± TS è‡ªåŠ¨å®Œæˆï¼Œå’Œ Vue3 çš„å®æ— å…³ã€‚</p>
</li>
<li>
<p><strong>Props ç±»å‹æ¨æ–­ä¾èµ–ä¸¤ç§å†™æ³•ï¼š</strong></p>
<ul>
<li>åŸºäºç±»å‹ï¼ˆæœ€å¸¸ç”¨ï¼‰</li>
<li>åŸºäºè¿è¡Œæ—¶ï¼ˆrunTime propsï¼‰</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-2">ğŸ¯ äºŒã€Vue3 TS ç±»å‹æ¨æ–­æ·±åº¦åŸç†ï¼ˆæ·±å…¥è®²ï¼Œé¢è¯•åŠ åˆ†ï¼‰</h2>
<hr/>
<h2 data-id="heading-3">1ï¸âƒ£ <strong>defineProps ç¼–è¯‘åå˜æˆç±»å‹å£°æ˜ï¼ˆç¼–è¯‘æ—¶å®ï¼‰</strong></h2>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> props = defineProps&lt;{
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
  age?: <span class="hljs-built_in">number</span>
}&gt;()
</code></pre>
<p>ç¼–è¯‘åï¼ˆç®€åŒ–ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç¼–è¯‘å™¨æŠŠ defineProps çš„ç±»å‹ç›´æ¥æ³¨å…¥ TS ä¸­</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
  age?: <span class="hljs-built_in">number</span>
}
<span class="hljs-keyword">const</span> <span class="hljs-attr">props</span>: <span class="hljs-title class_">Props</span>
</code></pre>
<h4 data-id="heading-4">ğŸš€ æœ¬è´¨ï¼š</h4>
<blockquote>
<p><strong>defineProps å¹¶ä¸æ˜¯ runtime ä»£ç ï¼Œè€Œæ˜¯ compile-time å®ã€‚</strong><br/>
ç¼–è¯‘å™¨ä¼šåˆ†æå®å‚æ•°ï¼ŒæŠŠç±»å‹ç›´æ¥æ³¨å…¥åˆ°ç»„ä»¶ç±»å‹ä¸­ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">2ï¸âƒ£ <strong>defineEmits ç±»å‹æ¨æ–­æœºåˆ¶</strong></h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> emit = defineEmits&lt;{
  (<span class="hljs-attr">e</span>: <span class="hljs-string">'change'</span>, <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>
  (<span class="hljs-attr">e</span>: <span class="hljs-string">'delete'</span>, <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span>
}&gt;()
</code></pre>
<p>TS æ¨æ–­å‡ºï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">emit</span>('change', <span class="hljs-number">123</span>)
<span class="hljs-built_in">emit</span>('delete', 'abc')
</code></pre>
<p>å¦‚æœå†™é”™ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">emit</span>(<span class="hljs-string">'change'</span>, <span class="hljs-string">'xxx'</span>) <span class="hljs-comment">// âŒ æŠ¥é”™ï¼Œå‚æ•°ç±»å‹ä¸å¯¹</span>
</code></pre>
<hr/>
<h4 data-id="heading-6">âœ¨ defineEmits ç¼–è¯‘åŸç†ï¼š</h4>
<p>ä¼šç”Ÿæˆä¸¤ä¸ªé‡è¦ä¸œè¥¿ï¼š</p>
<ol>
<li><strong>äº‹ä»¶åè”åˆç±»å‹</strong> <code>'change' | 'delete'</code></li>
<li><strong>äº‹ä»¶å‡½æ•°é‡è½½ç±»å‹æ¨æ–­</strong></li>
</ol>
<p>è¿™ä½¿å¾— TS èƒ½åœ¨ emit æ—¶åšä¸¥æ ¼æ ¡éªŒã€‚</p>
<hr/>
<h2 data-id="heading-7">3ï¸âƒ£ <strong>è¿è¡Œæ—¶ Props çš„è‡ªåŠ¨æ¨å¯¼èƒ½åŠ›</strong></h2>
<p>Vue3 å®ä¹Ÿèƒ½æ¨å¯¼ runtime propsï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">title</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">count</span>: <span class="hljs-title class_">Number</span>,
  <span class="hljs-attr">isActive</span>: <span class="hljs-title class_">Boolean</span>
})
</code></pre>
<p>TS ä¼šæ¨æ–­ä¸ºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">{
  title?: <span class="hljs-built_in">string</span>,
  count?: <span class="hljs-built_in">number</span>,
  isActive?: <span class="hljs-built_in">boolean</span>
}
</code></pre>
<p>æ³¨æ„ï¼š<br/>
æ‰€æœ‰ runtime å£°æ˜çš„ props <strong>éƒ½å˜æˆå¯é€‰</strong>ï¼Œå› ä¸ºçˆ¶ç»„ä»¶å¯ä»¥ä¸ä¼ ã€‚</p>
<hr/>
<h2 data-id="heading-8">4ï¸âƒ£ <strong>ä½¿ç”¨ withDefaults åšé»˜è®¤å€¼æ¨æ–­</strong></h2>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">props</span> = <span class="hljs-title function_ invoke__">withDefaults</span>(
  defineProps&lt;{
    <span class="hljs-attr">username</span>: <span class="hljs-keyword">string</span>
    pageSize?: number
  }&gt;(),
  {
    pageSize: <span class="hljs-number">20</span>
  }
)
</code></pre>
<p>æ¨æ–­ç»“æœï¼š</p>
<ul>
<li>pageSize ä¸å†æ˜¯ <code>number | undefined</code></li>
<li>è‡ªåŠ¨å˜æˆ <code>number</code></li>
</ul>
<hr/>
<h2 data-id="heading-9">5ï¸âƒ£ <strong>setup è¿”å›å€¼ç±»å‹æ¨æ–­</strong></h2>
<p>Vue çš„ setupï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> count = <span class="hljs-keyword">ref</span>(<span class="hljs-number">0</span>)

<span class="hljs-function">function <span class="hljs-title">add</span>()</span> {}

<span class="hljs-keyword">return</span> { count, <span class="hljs-keyword">add</span> }
</code></pre>
<p>æ¨æ–­ä¸ºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">{
  <span class="hljs-attr">count</span>: <span class="hljs-title class_">Ref</span>&lt;<span class="hljs-built_in">number</span>&gt;
  <span class="hljs-attr">add</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
}
</code></pre>
<p>Vue ä¼šè‡ªåŠ¨ unwrap ref åˆ°æ¨¡æ¿ä¸­ï¼Œä½† TS ä¿ç•™ Ref ç±»å‹ã€‚</p>
<hr/>
<h2 data-id="heading-10">ğŸ¯ ä¸‰ã€ä»£ç ç¤ºä¾‹ï¼ˆå®Œæ•´ TS + Props + Emitsï¼‰</h2>
<hr/>
<h3 data-id="heading-11">1ï¼‰ç»„åˆ Prop + Emitï¼š</h3>
<pre><code class="hljs language-php" lang="php">&lt;script setup lang=<span class="hljs-string">"ts"</span>&gt;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">props</span> = defineProps&lt;{
  value: <span class="hljs-keyword">string</span>
  maxLength?: number
}&gt;()

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">emit</span> = defineEmits&lt;{
  (e: <span class="hljs-string">'update:value'</span>, v: <span class="hljs-keyword">string</span>): <span class="hljs-keyword">void</span>
  (e: <span class="hljs-string">'reachMax'</span>): <span class="hljs-keyword">void</span>
}&gt;()

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">input</span>(<span class="hljs-params">v: <span class="hljs-keyword">string</span></span>) </span>{
  <span class="hljs-keyword">if</span> (v.length &gt; (props.maxLength ?? Infinity)) {
    <span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">'reachMax'</span>)
  }
  <span class="hljs-title function_ invoke__">emit</span>(<span class="hljs-string">'update:value'</span>, v)
}
&lt;/script&gt;
</code></pre>
<p>å…¨éƒ¨ç±»å‹éƒ½ä¼šè‡ªåŠ¨æ¨æ–­ï¼Œæ— éœ€æ‰‹å†™ anyã€‚</p>
<hr/>
<h2 data-id="heading-12">ğŸ¯ å››ã€é¢è¯•å®˜é«˜é¢‘è¿½é—® &amp; ä½ è¯¥æ€ä¹ˆç­”</h2>
<hr/>
<h3 data-id="heading-13">â“1ï¼šdefineProps ä¸ºä»€ä¹ˆä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„å‡½æ•°ï¼Ÿä¸ºä»€ä¹ˆåªèƒ½åœ¨ 
</h3><p><strong>é«˜åˆ†å›ç­”ï¼š</strong></p>
<p>å› ä¸º defineProps æ˜¯ <strong>ç¼–è¯‘å™¨å®</strong>ï¼Œä¸æ˜¯è¿è¡Œæ—¶å‡½æ•°ï¼Œå®ƒåªåœ¨ç¼–è¯‘æœŸç”Ÿæ•ˆã€‚</p>
<p>Vue ç¼–è¯‘å™¨ç›´æ¥å°† defineProps çš„ç±»å‹å†™å…¥ç»„ä»¶ç±»å‹ç³»ç»Ÿã€‚</p>
<hr/>
<h3 data-id="heading-14">â“2ï¼šdefineProps çš„ç±»å‹å‚æ•°å’Œè¿è¡Œæ—¶å‚æ•°åŒæ—¶å†™ï¼Œä¼šæ€æ ·ï¼Ÿ</h3>
<p>ä¾‹å­ï¼š</p>
<pre><code class="hljs language-css" lang="css">defineProps&lt;{
  name: string
}&gt;({
  name: Number
})
</code></pre>
<p>ç»“æœï¼šç±»å‹å†²çªï¼ŒTS ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®ä¸å…è®¸æœ‰ä¸¤ä¸ªæ¥æºã€‚</p>
<hr/>
<h3 data-id="heading-15">â“3ï¼šå’Œ Vue2 çš„ props + emit ç›¸æ¯”ï¼ŒVue3 çš„ TS å¼ºåœ¨å“ªé‡Œï¼Ÿ</h3>
<p><strong>é«˜é¢‘ + åŠ åˆ†å›ç­”ï¼š</strong></p>
<p>Vue3 åšåˆ°äº†ï¼š</p>
<ul>
<li>äº‹ä»¶åç§°çš„è‡ªåŠ¨è¡¥å…¨</li>
<li>å‚æ•°ç±»å‹è‡ªåŠ¨æ£€æµ‹</li>
<li>props ç±»å‹è‡ªåŠ¨æ¨å¯¼</li>
<li>default å€¼å˜çª„ï¼ˆwithDefaultsï¼‰</li>
<li>emit å¯å†™å¤šé‡ overloadï¼ˆç›¸å½“ä¸“ä¸šï¼‰</li>
</ul>
<p>Vue2 ç”¨ TS éå¸¸åƒåŠ›ï¼ŒVue3 è§£å†³äº†ç—›ç‚¹ã€‚</p>
<hr/>
<h3 data-id="heading-16">â“4ï¼šæœ‰ç±»å‹æ¨æ–­çš„ defineModelï¼ˆv-model è¯­æ³•ç³–ï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>Vue3.4 æ–°å¢ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">const</span> model = defineModel&lt;<span class="hljs-built_in">string</span>&gt;()
</code></pre>
<p>è‡ªåŠ¨æ¨æ–­ï¼š</p>
<ul>
<li>modelValue ç±»å‹</li>
<li>update:modelValue å‚æ•°ç±»å‹</li>
</ul>
<p>è¿™æ˜¯ Vue TS ä½“éªŒæœ€å¼ºçš„ä¸€éƒ¨åˆ†ã€‚</p>
<hr/>
<h2 data-id="heading-17">ğŸ¯ äº”ã€é«˜åˆ†æ€»ç»“ï¼ˆé¢è¯•ç›´æ¥èƒŒï¼‰</h2>
<blockquote>
<p>Vue3 çš„ defineProps / defineEmits / defineModel éƒ½æ˜¯ç¼–è¯‘æœŸå®ï¼Œä¸å­˜åœ¨äºè¿è¡Œæ—¶ä»£ç ä¸­ã€‚<br/>
å®ƒä»¬é€šè¿‡ TS æ³›å‹ + ç¼–è¯‘å™¨é™æ€åˆ†æï¼Œå®ç° Propsã€Emitã€v-model çš„å®Œæ•´ç±»å‹æ¨æ–­ï¼Œæ˜¯ Vue3 ä¸ TS æœ€å¼ºç»“åˆç‚¹ã€‚<br/>
è¿è¡Œæ—¶ props å†™æ³•ä¹Ÿå¯ä»¥æ¨æ–­ç±»å‹ï¼Œä½†ä¸å¦‚æ³›å‹å†™æ³•å¼ºã€‚<br/>
setup è¿”å›å€¼ç”± TS è‡ªåŠ¨æ¨æ–­ï¼Œä¸å®æ— å…³ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬ 28 é¢˜ï¼šVue3 çš„ Diff ç®—æ³•æ ¸å¿ƒåŸç†ï¼ˆåŒç«¯ Diffã€PatchFlagsã€Block Treeã€é™æ€æå‡ï¼‰]]></title>    <link>https://juejin.cn/post/7579256547797893161</link>    <guid>https://juejin.cn/post/7579256547797893161</guid>    <pubDate>2025-12-03T04:47:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579256547797893161" data-draft-id="7579256547797876777" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬ 28 é¢˜ï¼šVue3 çš„ Diff ç®—æ³•æ ¸å¿ƒåŸç†ï¼ˆåŒç«¯ Diffã€PatchFlagsã€Block Treeã€é™æ€æå‡ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-03T04:47:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä¸€è¯¾"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬ 28 é¢˜ï¼šVue3 çš„ Diff ç®—æ³•æ ¸å¿ƒåŸç†ï¼ˆåŒç«¯ Diffã€PatchFlagsã€Block Treeã€é™æ€æå‡ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä¸€è¯¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T04:47:25.000Z" title="Wed Dec 03 2025 04:47:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ç¬¬ 27 é¢˜ï¼šVue3 çš„ Diff ç®—æ³•æ ¸å¿ƒåŸç†ï¼ˆåŒç«¯ Diffã€PatchFlagsã€Block Treeã€é™æ€æå‡ï¼‰</strong></h2>
<p>æˆ‘ä¼šæŒ‰ç…§ç»“æ„ï¼š<br/>
<strong>æ ¸å¿ƒå›ç­” â†’ æ·±åº¦è®²è§£ â†’ åŠ¨ç”»çº§åˆ«ç¤ºæ„ â†’ PatchFlags &amp; é™æ€æå‡ â†’ é¢è¯•å®˜è¿½é—® â†’ é«˜åˆ†æ€»ç»“</strong></p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€æ ¸å¿ƒå›ç­”ï¼ˆé¢è¯•å®˜æœ€æƒ³å¬ï¼‰</h2>
<p>Vue3 çš„ Diff ç®—æ³•æ˜¯åŸºäº <strong>åŒç«¯å¯¹æ¯” + æœ€é•¿é€’å¢å­åºåˆ—ï¼ˆLISï¼‰ä¼˜åŒ– + é™æ€æå‡ + block tree + patchFlags</strong> çš„ã€‚</p>
<p>æ¯” Vue2 å¿«çš„åŸå› ï¼š</p>
<ol>
<li><strong>é™æ€èŠ‚ç‚¹è·³è¿‡ diff</strong></li>
<li><strong>PatchFlags å‡å°‘ä¸å¿…è¦å¯¹æ¯”</strong></li>
<li><strong>block tree é™åˆ¶ diff èŒƒå›´</strong></li>
<li><strong>ä¼˜åŒ–åçš„åŒç«¯ Diff + LIS</strong></li>
<li><strong>æ¨¡æ¿ç¼–è¯‘é˜¶æ®µæå¤§åœ°å‡å°‘äº†è¿è¡Œæ—¶å·¥ä½œé‡</strong></li>
</ol>
<hr/>
<h2 data-id="heading-2">äºŒã€æ·±åº¦åŸç†ï¼ˆæ·±å…¥è®²ï¼Œé«˜åˆ†ï¼‰</h2>
<hr/>
<h2 data-id="heading-3">1ï¸âƒ£ Vue3 Diff = â€œåŒç«¯ Diff + LISâ€</h2>
<p>Vue3 çš„æ ¸å¿ƒ Diff é€»è¾‘å¦‚ä¸‹ï¼š</p>
<h4 data-id="heading-4"><strong>ç¬¬ä¸€é˜¶æ®µï¼šä»å¤´å¼€å§‹æ¯”å¯¹ï¼ˆå‰ç«¯æŒ‡é’ˆï¼‰</strong></h4>
<p>å¦‚æœæ–°æ—§å¤´èŠ‚ç‚¹æ˜¯ç›¸åŒ keyï¼Œå°± patch å¹¶ç§»åŠ¨ï¼š</p>
<pre><code class="hljs language-css" lang="css">æ—§ï¼š<span class="hljs-selector-attr">[A B C D]</span>
æ–°ï¼š<span class="hljs-selector-attr">[A B E C D]</span>

ä»å¤´å¼€å§‹ï¼š
<span class="hljs-selector-tag">A</span> â†’ match
<span class="hljs-selector-tag">B</span> â†’ match
é‡åˆ° C / E ä¸åŒï¼Œåœæ­¢
</code></pre>
<hr/>
<h4 data-id="heading-5"><strong>ç¬¬äºŒé˜¶æ®µï¼šä»å°¾å¼€å§‹æ¯”å¯¹ï¼ˆåç«¯æŒ‡é’ˆï¼‰</strong></h4>
<pre><code class="hljs language-css" lang="css">æ—§ï¼š<span class="hljs-selector-attr">[A B C D]</span>
æ–°ï¼š<span class="hljs-selector-attr">[A B E C D]</span>

ä»å°¾å¼€å§‹ï¼š
D â†’ match
</code></pre>
<hr/>
<h4 data-id="heading-6"><strong>ç¬¬ä¸‰é˜¶æ®µï¼šå¤„ç†ä¸­é—´ä¹±åºéƒ¨åˆ†ï¼ˆæ ¸å¿ƒï¼šLISï¼‰</strong></h4>
<p>åªå¯¹ä¸­é—´è¿™ä¸€æ®µåš Diffï¼š</p>
<pre><code class="hljs language-css" lang="css">æ—§ï¼š<span class="hljs-selector-attr">[C]</span>
æ–°ï¼š<span class="hljs-selector-attr">[E C]</span>
</code></pre>
<p>Vue3 ä¼šï¼š</p>
<ul>
<li>å»ºç«‹ key â†’ newIndex çš„æ˜ å°„</li>
<li>æ‰¾å‡ºæ–°åˆ—è¡¨ä¸­çš„<strong>æœ€é•¿é€’å¢å­åºåˆ—</strong>ï¼ˆLISï¼‰</li>
<li>å…¶ä»–èŠ‚ç‚¹ç§»åŠ¨æˆ–æ–°å»º</li>
</ul>
<p>ä¸ºä»€ä¹ˆç”¨ LISï¼Ÿ</p>
<blockquote>
<p>ä¿æŒæœ€é•¿ä¸åŠ¨åºåˆ—ï¼Œå‡å°‘ DOM ç§»åŠ¨æ¬¡æ•°ï¼Œè¿™æ˜¯æœ€ä¼˜ç§»åŠ¨ç­–ç•¥ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">2ï¸âƒ£ PatchFlagsï¼ˆç¼–è¯‘å™¨ç»™æ¯ä¸ªèŠ‚ç‚¹æ‰“æ ‡ç­¾ï¼‰</h2>
<p>PatchFlags æ˜¯ Vue3 æ€§èƒ½é£è¶Šçš„æ ¸å¿ƒã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span> :class=<span class="hljs-string">"theme"</span>&gt;{{ msg }}&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p>ç¼–è¯‘å™¨ä¼šè¿™æ ·æ ‡æ³¨ï¼š</p>
<ul>
<li><code>:class</code> æ˜¯åŠ¨æ€ç»‘å®š â†’ PatchFlag: CLASS</li>
<li><code>msg</code> æ˜¯åŠ¨æ€æ–‡æœ¬ â†’ PatchFlag: TEXT</li>
</ul>
<p>è¿è¡Œæ—¶åª patch <strong>æœ‰å˜åŒ–çš„éƒ¨åˆ†</strong>ã€‚</p>
<p><strong>âš¡ æ€§èƒ½æå¼ºï¼Œå› ä¸ºè·³è¿‡æ‰€æœ‰é™æ€èŠ‚ç‚¹ã€‚</strong></p>
<hr/>
<h2 data-id="heading-8">3ï¸âƒ£ é™æ€æå‡ï¼ˆstatic hoistingï¼‰</h2>
<p>Vue3 ä¼šæŠŠæ¨¡æ¿ä¸­æ°¸è¿œä¸ä¼šå˜çš„ DOM ç»“æ„æå‰æå‡åˆ°å¤–éƒ¨ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span>&gt;&lt;<span class="hljs-selector-tag">span</span>&gt;Hello&lt;/<span class="hljs-selector-tag">span</span>&gt;&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p>é™æ€æå‡åï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">_hoisted_1</span> = h(<span class="hljs-string">"span"</span>, <span class="hljs-string">"Hello"</span>)
</code></pre>
<p>æ¯æ¬¡æ¸²æŸ“ï¼š</p>
<ul>
<li>é™æ€ vnode å¤ç”¨</li>
<li>ä¸é‡æ–°åˆ›å»ºä¸ diff vnode</li>
</ul>
<p><strong>Vue2 æ¯æ¬¡ render éƒ½é‡æ–°åˆ›å»ºæ‰€æœ‰ vnode â†’ ä½æ•ˆ</strong></p>
<hr/>
<h2 data-id="heading-9">4ï¸âƒ£ Block Treeï¼ˆVue3 çš„é©å‘½æ€§è®¾è®¡ï¼‰</h2>
<p>Vue3 æŠŠç»„ä»¶æ‹†æˆä¸€ä¸ªä¸ª blockï¼Œæ¯ä¸ª block åª diff è‡ªå·±å†…éƒ¨çš„åŠ¨æ€èŠ‚ç‚¹åˆ—è¡¨ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span>&gt;
  &lt;<span class="hljs-selector-tag">p</span>&gt;é™æ€&lt;/<span class="hljs-selector-tag">p</span>&gt;
  &lt;<span class="hljs-selector-tag">p</span>&gt;{{msg}}&lt;/<span class="hljs-selector-tag">p</span>&gt;
&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p>Vue ä¼šç”Ÿæˆç±»ä¼¼ç»“æ„ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Block root: only tracks [<span class="hljs-built_in">p</span>(msg)]
</code></pre>
<p>é™æ€éƒ¨åˆ†å®Œå…¨è·³è¿‡ã€‚</p>
<p><strong>Diff èŒƒå›´æ›´å°ï¼Œæ€§èƒ½æ›´é«˜ã€‚</strong></p>
<hr/>
<h2 data-id="heading-10">5ï¸âƒ£ ä¸ºä»€ä¹ˆ Vue3 æ¯” React18 æ›´å¿«ï¼Ÿ</h2>
<p>å› ä¸º Vue3 ä½¿ç”¨ <strong>æ¨¡æ¿ç¼–è¯‘æå‰åšå¤§é‡ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>é™æ€æå‡</li>
<li>PatchFlags</li>
<li>Block Tree</li>
<li>ç¼–è¯‘æœŸç¡®å®šæœ€å°æ›´æ–°å•å…ƒ</li>
</ul>
<p>React æ˜¯çº¯è¿è¡Œæ—¶ï¼Œä¸çŸ¥é“è°æ˜¯åŠ¨æ€çš„ï¼Œæ¯æ¬¡ render éƒ½ diff å…¨é‡å­æ ‘ã€‚</p>
<hr/>
<h2 data-id="heading-11">ä¸‰ã€ä»£ç ç¤ºä¾‹ï¼šDiff æ‰§è¡Œè¿‡ç¨‹å¯è§†åŒ–åŠ¨ç”»ï¼ˆé¢è¯•å®˜ä¼šç‚¹å¤´ï¼‰</h2>
<p>æ—§èŠ‚ç‚¹ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">B</span> C D E F
</code></pre>
<p>æ–°èŠ‚ç‚¹ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span> C E <span class="hljs-selector-tag">B</span> D G F
</code></pre>
<h4 data-id="heading-12">1. åŒç«¯æ¯”å¯¹é˜¶æ®µï¼š</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">A</span> = A  â†’ ok
<span class="hljs-attr">F</span> = F  â†’ ok
</code></pre>
<p>ä¸­é—´åŒºåŸŸï¼š</p>
<p>æ—§ï¼šB C D E<br/>
æ–°ï¼šC E B D G</p>
<h4 data-id="heading-13">2. å»ºç«‹æ˜ å°„ï¼š</h4>
<pre><code class="hljs language-css" lang="css">C â†’ <span class="hljs-number">0</span>
E â†’ <span class="hljs-number">1</span>
<span class="hljs-selector-tag">B</span> â†’ <span class="hljs-number">2</span>
D â†’ <span class="hljs-number">3</span>
G â†’ <span class="hljs-number">4</span>
</code></pre>
<h4 data-id="heading-14">3. ç®— LIS â†’ [0,1,3] = C, E, D</h4>
<p>ä¿æŒä¸åŠ¨çš„èŠ‚ç‚¹ï¼šCã€Eã€D<br/>
è¦ç§»åŠ¨çš„ï¼šB<br/>
è¦æ–°å¢çš„ï¼šG</p>
<hr/>
<h2 data-id="heading-15">å››ã€é¢è¯•å®˜è¿½é—® &amp; é«˜åˆ†å›ç­”</h2>
<hr/>
<h3 data-id="heading-16">â“1. Vue3 Diff ä¸ Vue2 Diff çš„åŒºåˆ«ï¼Ÿ</h3>
<p>ä½ å¯ä»¥ç›´æ¥è¿™æ ·ç­”ï¼ˆé«˜åˆ†ï¼‰ï¼š</p>
<h4 data-id="heading-17"><strong>Vue2</strong></h4>
<ul>
<li>å…¨é‡åŒç«¯ diff</li>
<li>æ—  PatchFlags</li>
<li>æ— é™æ€æå‡</li>
<li>æ—  block tree</li>
</ul>
<h4 data-id="heading-18"><strong>Vue3</strong></h4>
<ul>
<li>æ›´æ™ºèƒ½çš„ diffï¼šåŒç«¯ + LIS</li>
<li>ç¼–è¯‘å™¨ä¼˜åŒ–ï¼šPatchFlags + static hoisting</li>
<li>block treeï¼šå‡å°‘ diff èŒƒå›´</li>
</ul>
<p><strong>æ€»ç»“ï¼šVue2 æ˜¯â€œçº¯è¿è¡Œæ—¶ diffâ€ï¼ŒVue3 æ˜¯â€œç¼–è¯‘ + è¿è¡Œæ—¶æ··åˆä¼˜åŒ– diffâ€ã€‚</strong></p>
<hr/>
<h3 data-id="heading-19">â“2. ä¸ºä»€ä¹ˆéœ€è¦æœ€é•¿é€’å¢å­åºåˆ—ï¼Ÿ</h3>
<p>ä¸ºäº†å‡å°‘ DOM ç§»åŠ¨æ¬¡æ•°ã€‚</p>
<p>æ²¡æœ‰ LISï¼š</p>
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦ç§»åŠ¨ â†’ æœ€å O(nÂ²)</li>
</ul>
<p>æœ‰ LISï¼š</p>
<ul>
<li>ç§»åŠ¨æœ€å°‘ï¼Œè¶‹è¿‘ä¼˜åŒ–åˆ° O(n log n)</li>
</ul>
<hr/>
<h3 data-id="heading-20">â“3. ä»€ä¹ˆæƒ…å†µä¸‹ Vue ä¸ç”¨ Diffï¼Ÿ</h3>
<p>ä»¥ä¸‹æƒ…å†µç›´æ¥å¤ç”¨ï¼š</p>
<ul>
<li>é™æ€èŠ‚ç‚¹</li>
<li>patchFlags æ ‡è¯†å®Œå…¨é™æ€çš„éƒ¨åˆ†</li>
<li>v-onceï¼ˆåªæ¸²æŸ“ä¸€æ¬¡ï¼‰</li>
<li>keyed children æœªå‘ç”Ÿä»»ä½•åŠ¨æ€å˜åŒ–</li>
</ul>
<hr/>
<h3 data-id="heading-21">â“4. key çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>key æ˜¯ diff çš„çµé­‚ï¼Œè®©èŠ‚ç‚¹å¯å¤ç”¨ã€æœ‰èº«ä»½ã€‚</p>
<p>key ä¸å”¯ä¸€ä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>patch é”™ä¹±</li>
<li>æ„æ–™ä¹‹å¤–çš„ DOM å¤ç”¨</li>
<li>input æ•°æ®é”™ä½</li>
</ul>
<hr/>
<h2 data-id="heading-22">äº”ã€é«˜åˆ†æ€»ç»“ï¼ˆèƒŒä¸‹æ¥èƒ½æ‰“å·¥åœ°çº§åˆ«ï¼‰</h2>
<blockquote>
<p>Vue3 çš„ diff æ˜¯ä¼˜åŒ–åçš„åŒç«¯ diff + LIS æœ€é•¿é€’å¢å­åºåˆ—ç®—æ³•ï¼Œå¹¶ç»“åˆç¼–è¯‘å™¨çš„ PatchFlagsã€é™æ€æå‡ã€Block Treeï¼Œå¤§å¹…å‡å°‘ vnode åˆ›å»ºæ•°é‡å’Œ diff èŒƒå›´ï¼Œæ˜¯ç›®å‰å‰ç«¯æ¡†æ¶ä¸­æœ€æ¿€è¿›çš„è¿è¡Œ + ç¼–è¯‘æ··åˆä¼˜åŒ–æ–¹å¼ï¼Œæ¯” Vue2 å’Œ React éƒ½æ›´å¿«ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>